var ls = Object.defineProperty;
var OA = (Z) => {
  throw TypeError(Z);
};
var ss = (Z, I, g) => I in Z ? ls(Z, I, { enumerable: !0, configurable: !0, writable: !0, value: g }) : Z[I] = g;
var UA = (Z, I, g) => ss(Z, typeof I != "symbol" ? I + "" : I, g), jC = (Z, I, g) => I.has(Z) || OA("Cannot " + g);
var v = (Z, I, g) => (jC(Z, I, "read from private field"), g ? g.call(Z) : I.get(Z)), yI = (Z, I, g) => I.has(Z) ? OA("Cannot add the same private member more than once") : I instanceof WeakSet ? I.add(Z) : I.set(Z, g), hI = (Z, I, g, C) => (jC(Z, I, "write to private field"), C ? C.call(Z, g) : I.set(Z, g), g), MI = (Z, I, g) => (jC(Z, I, "access private method"), g);
var vA = (Z, I, g, C) => ({
  set _(A) {
    hI(Z, I, A, g);
  },
  get _() {
    return v(Z, I, C);
  }
});
const aI = typeof process == "object" && process + "" == "[object process]" && !process.versions.nw && !(process.versions.electron && process.type && process.type !== "browser"), iA = [1e-3, 0, 0, 1e-3, 0, 0], QC = 1.35, nI = {
  ANY: 1,
  DISPLAY: 2,
  PRINT: 4,
  ANNOTATIONS_FORMS: 16,
  ANNOTATIONS_STORAGE: 32,
  ANNOTATIONS_DISABLE: 64,
  IS_EDITING: 128,
  OPLIST: 256
}, _I = {
  DISABLE: 0,
  ENABLE: 1,
  ENABLE_FORMS: 2,
  ENABLE_STORAGE: 3
}, Og = "pdfjs_internal_editor_", k = {
  DISABLE: -1,
  NONE: 0,
  FREETEXT: 3,
  HIGHLIGHT: 9,
  STAMP: 13,
  INK: 15,
  POPUP: 16,
  SIGNATURE: 101,
  COMMENT: 102
}, j = {
  RESIZE: 1,
  CREATE: 2,
  FREETEXT_SIZE: 11,
  FREETEXT_COLOR: 12,
  FREETEXT_OPACITY: 13,
  INK_COLOR: 21,
  INK_THICKNESS: 22,
  INK_OPACITY: 23,
  HIGHLIGHT_COLOR: 31,
  HIGHLIGHT_THICKNESS: 32,
  HIGHLIGHT_FREE: 33,
  HIGHLIGHT_SHOW_ALL: 34,
  DRAW_STEP: 41
}, ds = {
  PRINT: 4,
  MODIFY_CONTENTS: 8,
  COPY: 16,
  MODIFY_ANNOTATIONS: 32,
  FILL_INTERACTIVE_FORMS: 256,
  COPY_FOR_ACCESSIBILITY: 512,
  ASSEMBLE: 1024,
  PRINT_HIGH_QUALITY: 2048
}, ZI = {
  FILL: 0,
  STROKE: 1,
  FILL_STROKE: 2,
  INVISIBLE: 3,
  FILL_STROKE_MASK: 3,
  ADD_TO_PATH_FLAG: 4
}, wC = {
  GRAYSCALE_1BPP: 1,
  RGB_24BPP: 2,
  RGBA_32BPP: 3
}, iI = {
  TEXT: 1,
  LINK: 2,
  FREETEXT: 3,
  LINE: 4,
  SQUARE: 5,
  CIRCLE: 6,
  POLYGON: 7,
  POLYLINE: 8,
  HIGHLIGHT: 9,
  UNDERLINE: 10,
  SQUIGGLY: 11,
  STRIKEOUT: 12,
  STAMP: 13,
  CARET: 14,
  INK: 15,
  POPUP: 16,
  FILEATTACHMENT: 17,
  SOUND: 18,
  MOVIE: 19,
  WIDGET: 20,
  SCREEN: 21,
  PRINTERMARK: 22,
  TRAPNET: 23,
  WATERMARK: 24,
  THREED: 25,
  REDACT: 26
}, tg = {
  SOLID: 1,
  DASHED: 2,
  BEVELED: 3,
  INSET: 4,
  UNDERLINE: 5
}, KC = {
  ERRORS: 0,
  WARNINGS: 1,
  INFOS: 5
}, Ug = {
  dependency: 1,
  setLineWidth: 2,
  setLineCap: 3,
  setLineJoin: 4,
  setMiterLimit: 5,
  setDash: 6,
  setRenderingIntent: 7,
  setFlatness: 8,
  setGState: 9,
  save: 10,
  restore: 11,
  transform: 12,
  moveTo: 13,
  lineTo: 14,
  curveTo: 15,
  curveTo2: 16,
  curveTo3: 17,
  closePath: 18,
  rectangle: 19,
  stroke: 20,
  closeStroke: 21,
  fill: 22,
  eoFill: 23,
  fillStroke: 24,
  eoFillStroke: 25,
  closeFillStroke: 26,
  closeEOFillStroke: 27,
  endPath: 28,
  clip: 29,
  eoClip: 30,
  beginText: 31,
  endText: 32,
  setCharSpacing: 33,
  setWordSpacing: 34,
  setHScale: 35,
  setLeading: 36,
  setFont: 37,
  setTextRenderingMode: 38,
  setTextRise: 39,
  moveText: 40,
  setLeadingMoveText: 41,
  setTextMatrix: 42,
  nextLine: 43,
  showText: 44,
  showSpacedText: 45,
  nextLineShowText: 46,
  nextLineSetSpacingShowText: 47,
  setCharWidth: 48,
  setCharWidthAndBounds: 49,
  setStrokeColorSpace: 50,
  setFillColorSpace: 51,
  setStrokeColor: 52,
  setStrokeColorN: 53,
  setFillColor: 54,
  setFillColorN: 55,
  setStrokeGray: 56,
  setFillGray: 57,
  setStrokeRGBColor: 58,
  setFillRGBColor: 59,
  setStrokeCMYKColor: 60,
  setFillCMYKColor: 61,
  shadingFill: 62,
  beginInlineImage: 63,
  beginImageData: 64,
  endInlineImage: 65,
  paintXObject: 66,
  markPoint: 67,
  markPointProps: 68,
  beginMarkedContent: 69,
  beginMarkedContentProps: 70,
  endMarkedContent: 71,
  beginCompat: 72,
  endCompat: 73,
  paintFormXObjectBegin: 74,
  paintFormXObjectEnd: 75,
  beginGroup: 76,
  endGroup: 77,
  beginAnnotation: 80,
  endAnnotation: 81,
  paintImageMaskXObject: 83,
  paintImageMaskXObjectGroup: 84,
  paintImageXObject: 85,
  paintInlineImageXObject: 86,
  paintInlineImageXObjectGroup: 87,
  paintImageXObjectRepeat: 88,
  paintImageMaskXObjectRepeat: 89,
  paintSolidColorImageMask: 90,
  constructPath: 91,
  setStrokeTransparent: 92,
  setFillTransparent: 93,
  rawFillPath: 94
}, lC = {
  moveTo: 0,
  lineTo: 1,
  curveTo: 2,
  closePath: 3
}, Zs = {
  NEED_PASSWORD: 1,
  INCORRECT_PASSWORD: 2
};
let SC = KC.WARNINGS;
function cs(Z) {
  Number.isInteger(Z) && (SC = Z);
}
function Gs() {
  return SC;
}
function pC(Z) {
  SC >= KC.INFOS && console.info(`Info: ${Z}`);
}
function L(Z) {
  SC >= KC.WARNINGS && console.warn(`Warning: ${Z}`);
}
function f(Z) {
  throw new Error(Z);
}
function Q(Z, I) {
  Z || f(I);
}
function bs(Z) {
  switch (Z?.protocol) {
    case "http:":
    case "https:":
    case "ftp:":
    case "mailto:":
    case "tel:":
      return !0;
    default:
      return !1;
  }
}
function gl(Z, I = null, g = null) {
  if (!Z)
    return null;
  if (g && typeof Z == "string" && (g.addDefaultProtocol && Z.startsWith("www.") && Z.match(/\./g)?.length >= 2 && (Z = `http://${Z}`), g.tryConvertEncoding))
    try {
      Z = ts(Z);
    } catch {
    }
  const C = I ? URL.parse(Z, I) : URL.parse(Z);
  return bs(C) ? C : null;
}
function Cl(Z, I, g = !1) {
  const C = URL.parse(Z);
  return C ? (C.hash = I, C.href) : g && gl(Z, "http://example.com") ? Z.split("#", 1)[0] + `${I ? `#${I}` : ""}` : "";
}
function T(Z, I, g, C = !1) {
  return Object.defineProperty(Z, I, {
    value: g,
    enumerable: !C,
    configurable: !0,
    writable: !1
  }), g;
}
const og = (function() {
  function I(g, C) {
    this.message = g, this.name = C;
  }
  return I.prototype = new Error(), I.constructor = I, I;
})();
class EA extends og {
  constructor(I, g) {
    super(I, "PasswordException"), this.code = g;
  }
}
class xC extends og {
  constructor(I, g) {
    super(I, "UnknownErrorException"), this.details = g;
  }
}
let lA = class extends og {
  constructor(I) {
    super(I, "InvalidPDFException");
  }
}, uC = class extends og {
  constructor(I, g, C) {
    super(I, "ResponseException"), this.status = g, this.missing = C;
  }
};
class os extends og {
  constructor(I) {
    super(I, "FormatError");
  }
}
let Ig = class extends og {
  constructor(I) {
    super(I, "AbortException");
  }
};
function Al(Z) {
  (typeof Z != "object" || Z?.length === void 0) && f("Invalid argument for bytesToString");
  const I = Z.length, g = 8192;
  if (I < g)
    return String.fromCharCode.apply(null, Z);
  const C = [];
  for (let A = 0; A < I; A += g) {
    const i = Math.min(A + g, I), l = Z.subarray(A, i);
    C.push(String.fromCharCode.apply(null, l));
  }
  return C.join("");
}
function qg(Z) {
  typeof Z != "string" && f("Invalid argument for stringToBytes");
  const I = Z.length, g = new Uint8Array(I);
  for (let C = 0; C < I; ++C)
    g[C] = Z.charCodeAt(C) & 255;
  return g;
}
function ms(Z) {
  return String.fromCharCode(Z >> 24 & 255, Z >> 16 & 255, Z >> 8 & 255, Z & 255);
}
function as() {
  const Z = new Uint8Array(4);
  return Z[0] = 1, new Uint32Array(Z.buffer, 0, 1)[0] === 1;
}
function es() {
  try {
    return new Function(""), !0;
  } catch {
    return !1;
  }
}
class GI {
  static get isLittleEndian() {
    return T(this, "isLittleEndian", as());
  }
  static get isEvalSupported() {
    return T(this, "isEvalSupported", es());
  }
  static get isOffscreenCanvasSupported() {
    return T(this, "isOffscreenCanvasSupported", typeof OffscreenCanvas < "u");
  }
  static get isImageDecoderSupported() {
    return T(this, "isImageDecoderSupported", typeof ImageDecoder < "u");
  }
  static get platform() {
    const {
      platform: I,
      userAgent: g
    } = navigator;
    return T(this, "platform", {
      isAndroid: g.includes("Android"),
      isLinux: I.includes("Linux"),
      isMac: I.includes("Mac"),
      isWindows: I.includes("Win"),
      isFirefox: g.includes("Firefox")
    });
  }
  static get isCSSRoundSupported() {
    return T(this, "isCSSRoundSupported", globalThis.CSS?.supports?.("width: round(1.5px, 1px)"));
  }
}
const OC = Array.from(Array(256).keys(), (Z) => Z.toString(16).padStart(2, "0"));
let M = class {
  static makeHexColor(I, g, C) {
    return `#${OC[I]}${OC[g]}${OC[C]}`;
  }
  static domMatrixToTransform(I) {
    return [I.a, I.b, I.c, I.d, I.e, I.f];
  }
  static scaleMinMax(I, g) {
    let C;
    I[0] ? (I[0] < 0 && (C = g[0], g[0] = g[2], g[2] = C), g[0] *= I[0], g[2] *= I[0], I[3] < 0 && (C = g[1], g[1] = g[3], g[3] = C), g[1] *= I[3], g[3] *= I[3]) : (C = g[0], g[0] = g[1], g[1] = C, C = g[2], g[2] = g[3], g[3] = C, I[1] < 0 && (C = g[1], g[1] = g[3], g[3] = C), g[1] *= I[1], g[3] *= I[1], I[2] < 0 && (C = g[0], g[0] = g[2], g[2] = C), g[0] *= I[2], g[2] *= I[2]), g[0] += I[4], g[1] += I[5], g[2] += I[4], g[3] += I[5];
  }
  static transform(I, g) {
    return [I[0] * g[0] + I[2] * g[1], I[1] * g[0] + I[3] * g[1], I[0] * g[2] + I[2] * g[3], I[1] * g[2] + I[3] * g[3], I[0] * g[4] + I[2] * g[5] + I[4], I[1] * g[4] + I[3] * g[5] + I[5]];
  }
  static multiplyByDOMMatrix(I, g) {
    return [I[0] * g.a + I[2] * g.b, I[1] * g.a + I[3] * g.b, I[0] * g.c + I[2] * g.d, I[1] * g.c + I[3] * g.d, I[0] * g.e + I[2] * g.f + I[4], I[1] * g.e + I[3] * g.f + I[5]];
  }
  static applyTransform(I, g, C = 0) {
    const A = I[C], i = I[C + 1];
    I[C] = A * g[0] + i * g[2] + g[4], I[C + 1] = A * g[1] + i * g[3] + g[5];
  }
  static applyTransformToBezier(I, g, C = 0) {
    const A = g[0], i = g[1], l = g[2], s = g[3], d = g[4], c = g[5];
    for (let G = 0; G < 6; G += 2) {
      const b = I[C + G], o = I[C + G + 1];
      I[C + G] = b * A + o * l + d, I[C + G + 1] = b * i + o * s + c;
    }
  }
  static applyInverseTransform(I, g) {
    const C = I[0], A = I[1], i = g[0] * g[3] - g[1] * g[2];
    I[0] = (C * g[3] - A * g[2] + g[2] * g[5] - g[4] * g[3]) / i, I[1] = (-C * g[1] + A * g[0] + g[4] * g[1] - g[5] * g[0]) / i;
  }
  static axialAlignedBoundingBox(I, g, C) {
    const A = g[0], i = g[1], l = g[2], s = g[3], d = g[4], c = g[5], G = I[0], b = I[1], o = I[2], m = I[3];
    let e = A * G + d, a = e, h = A * o + d, t = h, W = s * b + c, B = W, w = s * m + c, n = w;
    if (i !== 0 || l !== 0) {
      const V = i * G, N = i * o, R = l * b, Y = l * m;
      e += R, t += R, h += Y, a += Y, W += V, n += V, w += N, B += N;
    }
    C[0] = Math.min(C[0], e, h, a, t), C[1] = Math.min(C[1], W, w, B, n), C[2] = Math.max(C[2], e, h, a, t), C[3] = Math.max(C[3], W, w, B, n);
  }
  static inverseTransform(I) {
    const g = I[0] * I[3] - I[1] * I[2];
    return [I[3] / g, -I[1] / g, -I[2] / g, I[0] / g, (I[2] * I[5] - I[4] * I[3]) / g, (I[4] * I[1] - I[5] * I[0]) / g];
  }
  static singularValueDecompose2dScale(I, g) {
    const C = I[0], A = I[1], i = I[2], l = I[3], s = C ** 2 + A ** 2, d = C * i + A * l, c = i ** 2 + l ** 2, G = (s + c) / 2, b = Math.sqrt(G ** 2 - (s * c - d ** 2));
    g[0] = Math.sqrt(G + b || 1), g[1] = Math.sqrt(G - b || 1);
  }
  static normalizeRect(I) {
    const g = I.slice(0);
    return I[0] > I[2] && (g[0] = I[2], g[2] = I[0]), I[1] > I[3] && (g[1] = I[3], g[3] = I[1]), g;
  }
  static intersect(I, g) {
    const C = Math.max(Math.min(I[0], I[2]), Math.min(g[0], g[2])), A = Math.min(Math.max(I[0], I[2]), Math.max(g[0], g[2]));
    if (C > A)
      return null;
    const i = Math.max(Math.min(I[1], I[3]), Math.min(g[1], g[3])), l = Math.min(Math.max(I[1], I[3]), Math.max(g[1], g[3]));
    return i > l ? null : [C, i, A, l];
  }
  static pointBoundingBox(I, g, C) {
    C[0] = Math.min(C[0], I), C[1] = Math.min(C[1], g), C[2] = Math.max(C[2], I), C[3] = Math.max(C[3], g);
  }
  static rectBoundingBox(I, g, C, A, i) {
    i[0] = Math.min(i[0], I, C), i[1] = Math.min(i[1], g, A), i[2] = Math.max(i[2], I, C), i[3] = Math.max(i[3], g, A);
  }
  static #I(I, g, C, A, i, l, s, d, c, G) {
    if (c <= 0 || c >= 1)
      return;
    const b = 1 - c, o = c * c, m = o * c, e = b * (b * (b * I + 3 * c * g) + 3 * o * C) + m * A, a = b * (b * (b * i + 3 * c * l) + 3 * o * s) + m * d;
    G[0] = Math.min(G[0], e), G[1] = Math.min(G[1], a), G[2] = Math.max(G[2], e), G[3] = Math.max(G[3], a);
  }
  static #g(I, g, C, A, i, l, s, d, c, G, b, o) {
    if (Math.abs(c) < 1e-12) {
      Math.abs(G) >= 1e-12 && this.#I(I, g, C, A, i, l, s, d, -b / G, o);
      return;
    }
    const m = G ** 2 - 4 * b * c;
    if (m < 0)
      return;
    const e = Math.sqrt(m), a = 2 * c;
    this.#I(I, g, C, A, i, l, s, d, (-G + e) / a, o), this.#I(I, g, C, A, i, l, s, d, (-G - e) / a, o);
  }
  static bezierBoundingBox(I, g, C, A, i, l, s, d, c) {
    c[0] = Math.min(c[0], I, s), c[1] = Math.min(c[1], g, d), c[2] = Math.max(c[2], I, s), c[3] = Math.max(c[3], g, d), this.#g(I, C, i, s, g, A, l, d, 3 * (-I + 3 * (C - i) + s), 6 * (I - 2 * C + i), 3 * (C - I), c), this.#g(I, C, i, s, g, A, l, d, 3 * (-g + 3 * (A - l) + d), 6 * (g - 2 * A + l), 3 * (A - g), c);
  }
};
function ts(Z) {
  return decodeURIComponent(escape(Z));
}
let UC = null, PA = null;
function hs(Z) {
  return UC || (UC = /([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu, PA = /* @__PURE__ */ new Map([["ﬅ", "ſt"]])), Z.replaceAll(UC, (I, g, C) => g ? g.normalize("NFKC") : PA.get(C));
}
function il() {
  if (typeof crypto.randomUUID == "function")
    return crypto.randomUUID();
  const Z = new Uint8Array(32);
  return crypto.getRandomValues(Z), Al(Z);
}
const yA = "pdfjs_internal_id_";
function Bs(Z, I, g) {
  if (!Array.isArray(g) || g.length < 2)
    return !1;
  const [C, A, ...i] = g;
  if (!Z(C) && !Number.isInteger(C) || !I(A))
    return !1;
  const l = i.length;
  let s = !0;
  switch (A.name) {
    case "XYZ":
      if (l < 2 || l > 3)
        return !1;
      break;
    case "Fit":
    case "FitB":
      return l === 0;
    case "FitH":
    case "FitBH":
    case "FitV":
    case "FitBV":
      if (l > 1)
        return !1;
      break;
    case "FitR":
      if (l !== 4)
        return !1;
      s = !1;
      break;
    default:
      return !1;
  }
  for (const d of i)
    if (!(typeof d == "number" || s && d === null))
      return !1;
  return !0;
}
function eI(Z, I, g) {
  return Math.min(Math.max(Z, I), g);
}
function ll(Z) {
  return Uint8Array.prototype.toBase64 ? Z.toBase64() : btoa(Al(Z));
}
function Ws(Z) {
  return Uint8Array.fromBase64 ? Uint8Array.fromBase64(Z) : qg(atob(Z));
}
typeof Promise.try != "function" && (Promise.try = function(Z, ...I) {
  return new Promise((g) => {
    g(Z(...I));
  });
});
typeof Math.sumPrecise != "function" && (Math.sumPrecise = function(Z) {
  return Z.reduce((I, g) => I + g, 0);
});
class vg {
  static textContent(I) {
    const g = [], C = {
      items: g,
      styles: /* @__PURE__ */ Object.create(null)
    };
    function A(i) {
      if (!i)
        return;
      let l = null;
      const s = i.name;
      if (s === "#text")
        l = i.value;
      else if (vg.shouldBuildText(s))
        i?.attributes?.textContent ? l = i.attributes.textContent : i.value && (l = i.value);
      else return;
      if (l !== null && g.push({
        str: l
      }), !!i.children)
        for (const d of i.children)
          A(d);
    }
    return A(I), C;
  }
  static shouldBuildText(I) {
    return !(I === "textarea" || I === "input" || I === "option" || I === "select");
  }
}
let sl = class {
  static setupStorage(I, g, C, A, i) {
    const l = A.getValue(g, {
      value: null
    });
    switch (C.name) {
      case "textarea":
        if (l.value !== null && (I.textContent = l.value), i === "print")
          break;
        I.addEventListener("input", (s) => {
          A.setValue(g, {
            value: s.target.value
          });
        });
        break;
      case "input":
        if (C.attributes.type === "radio" || C.attributes.type === "checkbox") {
          if (l.value === C.attributes.xfaOn ? I.setAttribute("checked", !0) : l.value === C.attributes.xfaOff && I.removeAttribute("checked"), i === "print")
            break;
          I.addEventListener("change", (s) => {
            A.setValue(g, {
              value: s.target.checked ? s.target.getAttribute("xfaOn") : s.target.getAttribute("xfaOff")
            });
          });
        } else {
          if (l.value !== null && I.setAttribute("value", l.value), i === "print")
            break;
          I.addEventListener("input", (s) => {
            A.setValue(g, {
              value: s.target.value
            });
          });
        }
        break;
      case "select":
        if (l.value !== null) {
          I.setAttribute("value", l.value);
          for (const s of C.children)
            s.attributes.value === l.value ? s.attributes.selected = !0 : s.attributes.hasOwnProperty("selected") && delete s.attributes.selected;
        }
        I.addEventListener("input", (s) => {
          const d = s.target.options, c = d.selectedIndex === -1 ? "" : d[d.selectedIndex].value;
          A.setValue(g, {
            value: c
          });
        });
        break;
    }
  }
  static setAttributes({
    html: I,
    element: g,
    storage: C = null,
    intent: A,
    linkService: i
  }) {
    const {
      attributes: l
    } = g, s = I instanceof HTMLAnchorElement;
    l.type === "radio" && (l.name = `${l.name}-${A}`);
    for (const [d, c] of Object.entries(l))
      if (c != null)
        switch (d) {
          case "class":
            c.length && I.setAttribute(d, c.join(" "));
            break;
          case "dataId":
            break;
          case "id":
            I.setAttribute("data-element-id", c);
            break;
          case "style":
            Object.assign(I.style, c);
            break;
          case "textContent":
            I.textContent = c;
            break;
          default:
            (!s || d !== "href" && d !== "newWindow") && I.setAttribute(d, c);
        }
    s && i.addLinkAttributes(I, l.href, l.newWindow), C && l.dataId && this.setupStorage(I, l.dataId, g, C);
  }
  static render(I) {
    const g = I.annotationStorage, C = I.linkService, A = I.xfaHtml, i = I.intent || "display", l = document.createElement(A.name);
    A.attributes && this.setAttributes({
      html: l,
      element: A,
      intent: i,
      linkService: C
    });
    const s = i !== "richText", d = I.div;
    if (d.append(l), I.viewport) {
      const b = `matrix(${I.viewport.transform.join(",")})`;
      d.style.transform = b;
    }
    s && d.setAttribute("class", "xfaLayer xfaFont");
    const c = [];
    if (A.children.length === 0) {
      if (A.value) {
        const b = document.createTextNode(A.value);
        l.append(b), s && vg.shouldBuildText(A.name) && c.push(b);
      }
      return {
        textDivs: c
      };
    }
    const G = [[A, -1, l]];
    for (; G.length > 0; ) {
      const [b, o, m] = G.at(-1);
      if (o + 1 === b.children.length) {
        G.pop();
        continue;
      }
      const e = b.children[++G.at(-1)[1]];
      if (e === null)
        continue;
      const {
        name: a
      } = e;
      if (a === "#text") {
        const t = document.createTextNode(e.value);
        c.push(t), m.append(t);
        continue;
      }
      const h = e?.attributes?.xmlns ? document.createElementNS(e.attributes.xmlns, a) : document.createElement(a);
      if (m.append(h), e.attributes && this.setAttributes({
        html: h,
        element: e,
        storage: g,
        intent: i,
        linkService: C
      }), e.children?.length > 0)
        G.push([e, -1, h]);
      else if (e.value) {
        const t = document.createTextNode(e.value);
        s && vg.shouldBuildText(a) && c.push(t), h.append(t);
      }
    }
    for (const b of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))
      b.setAttribute("readOnly", !0);
    return {
      textDivs: c
    };
  }
  static update(I) {
    const g = `matrix(${I.viewport.transform.join(",")})`;
    I.div.style.transform = g, I.div.hidden = !1;
  }
};
const rI = "http://www.w3.org/2000/svg";
let Hg = class {
  static CSS = 96;
  static PDF = 72;
  static PDF_TO_CSS_UNITS = this.CSS / this.PDF;
};
async function $g(Z, I = "text") {
  if (Lg(Z, document.baseURI)) {
    const g = await fetch(Z);
    if (!g.ok)
      throw new Error(g.statusText);
    switch (I) {
      case "arraybuffer":
        return g.arrayBuffer();
      case "blob":
        return g.blob();
      case "json":
        return g.json();
    }
    return g.text();
  }
  return new Promise((g, C) => {
    const A = new XMLHttpRequest();
    A.open("GET", Z, !0), A.responseType = I, A.onreadystatechange = () => {
      if (A.readyState === XMLHttpRequest.DONE) {
        if (A.status === 200 || A.status === 0) {
          switch (I) {
            case "arraybuffer":
            case "blob":
            case "json":
              g(A.response);
              return;
          }
          g(A.responseText);
          return;
        }
        C(new Error(A.statusText));
      }
    }, A.send(null);
  });
}
class IC {
  constructor({
    viewBox: I,
    userUnit: g,
    scale: C,
    rotation: A,
    offsetX: i = 0,
    offsetY: l = 0,
    dontFlip: s = !1
  }) {
    this.viewBox = I, this.userUnit = g, this.scale = C, this.rotation = A, this.offsetX = i, this.offsetY = l, C *= g;
    const d = (I[2] + I[0]) / 2, c = (I[3] + I[1]) / 2;
    let G, b, o, m;
    switch (A %= 360, A < 0 && (A += 360), A) {
      case 180:
        G = -1, b = 0, o = 0, m = 1;
        break;
      case 90:
        G = 0, b = 1, o = 1, m = 0;
        break;
      case 270:
        G = 0, b = -1, o = -1, m = 0;
        break;
      case 0:
        G = 1, b = 0, o = 0, m = -1;
        break;
      default:
        throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.");
    }
    s && (o = -o, m = -m);
    let e, a, h, t;
    G === 0 ? (e = Math.abs(c - I[1]) * C + i, a = Math.abs(d - I[0]) * C + l, h = (I[3] - I[1]) * C, t = (I[2] - I[0]) * C) : (e = Math.abs(d - I[0]) * C + i, a = Math.abs(c - I[1]) * C + l, h = (I[2] - I[0]) * C, t = (I[3] - I[1]) * C), this.transform = [G * C, b * C, o * C, m * C, e - G * C * d - o * C * c, a - b * C * d - m * C * c], this.width = h, this.height = t;
  }
  get rawDims() {
    const I = this.viewBox;
    return T(this, "rawDims", {
      pageWidth: I[2] - I[0],
      pageHeight: I[3] - I[1],
      pageX: I[0],
      pageY: I[1]
    });
  }
  clone({
    scale: I = this.scale,
    rotation: g = this.rotation,
    offsetX: C = this.offsetX,
    offsetY: A = this.offsetY,
    dontFlip: i = !1
  } = {}) {
    return new IC({
      viewBox: this.viewBox.slice(),
      userUnit: this.userUnit,
      scale: I,
      rotation: g,
      offsetX: C,
      offsetY: A,
      dontFlip: i
    });
  }
  convertToViewportPoint(I, g) {
    const C = [I, g];
    return M.applyTransform(C, this.transform), C;
  }
  convertToViewportRectangle(I) {
    const g = [I[0], I[1]];
    M.applyTransform(g, this.transform);
    const C = [I[2], I[3]];
    return M.applyTransform(C, this.transform), [g[0], g[1], C[0], C[1]];
  }
  convertToPdfPoint(I, g) {
    const C = [I, g];
    return M.applyInverseTransform(C, this.transform), C;
  }
}
let XA = class extends og {
  constructor(I, g = 0) {
    super(I, "RenderingCancelledException"), this.extraDelay = g;
  }
};
function FC(Z) {
  const I = Z.length;
  let g = 0;
  for (; g < I && Z[g].trim() === ""; )
    g++;
  return Z.substring(g, g + 5).toLowerCase() === "data:";
}
function HA(Z) {
  return typeof Z == "string" && /\.pdf$/i.test(Z);
}
function ws(Z) {
  return [Z] = Z.split(/[#?]/, 1), Z.substring(Z.lastIndexOf("/") + 1);
}
function ns(Z, I = "document.pdf") {
  if (typeof Z != "string")
    return I;
  if (FC(Z))
    return L('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'), I;
  const C = ((s) => {
    try {
      return new URL(s);
    } catch {
      try {
        return new URL(decodeURIComponent(s));
      } catch {
        try {
          return new URL(s, "https://foo.bar");
        } catch {
          try {
            return new URL(decodeURIComponent(s), "https://foo.bar");
          } catch {
            return null;
          }
        }
      }
    }
  })(Z);
  if (!C)
    return I;
  const A = (s) => {
    try {
      let d = decodeURIComponent(s);
      return d.includes("/") ? (d = d.split("/").at(-1), d.test(/^\.pdf$/i) ? d : s) : d;
    } catch {
      return s;
    }
  }, i = /\.pdf$/i, l = C.pathname.split("/").at(-1);
  if (i.test(l))
    return A(l);
  if (C.searchParams.size > 0) {
    const s = Array.from(C.searchParams.values()).reverse();
    for (const c of s)
      if (i.test(c))
        return A(c);
    const d = Array.from(C.searchParams.keys()).reverse();
    for (const c of d)
      if (i.test(c))
        return A(c);
  }
  if (C.hash) {
    const d = /[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(C.hash);
    if (d)
      return A(d[0]);
  }
  return I;
}
class fA {
  started = /* @__PURE__ */ Object.create(null);
  times = [];
  time(I) {
    I in this.started && L(`Timer is already running for ${I}`), this.started[I] = Date.now();
  }
  timeEnd(I) {
    I in this.started || L(`Timer has not been started for ${I}`), this.times.push({
      name: I,
      start: this.started[I],
      end: Date.now()
    }), delete this.started[I];
  }
  toString() {
    const I = [];
    let g = 0;
    for (const {
      name: C
    } of this.times)
      g = Math.max(C.length, g);
    for (const {
      name: C,
      start: A,
      end: i
    } of this.times)
      I.push(`${C.padEnd(g)} ${i - A}ms
`);
    return I.join("");
  }
}
function Lg(Z, I) {
  const g = I ? URL.parse(Z, I) : URL.parse(Z);
  return g?.protocol === "http:" || g?.protocol === "https:";
}
function RI(Z) {
  Z.preventDefault();
}
function II(Z) {
  Z.preventDefault(), Z.stopPropagation();
}
function Ys(Z) {
  console.log("Deprecated API usage: " + Z);
}
let sA = class {
  static #I;
  static toDateObject(I) {
    if (I instanceof Date)
      return I;
    if (!I || typeof I != "string")
      return null;
    this.#I ||= new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");
    const g = this.#I.exec(I);
    if (!g)
      return null;
    const C = parseInt(g[1], 10);
    let A = parseInt(g[2], 10);
    A = A >= 1 && A <= 12 ? A - 1 : 0;
    let i = parseInt(g[3], 10);
    i = i >= 1 && i <= 31 ? i : 1;
    let l = parseInt(g[4], 10);
    l = l >= 0 && l <= 23 ? l : 0;
    let s = parseInt(g[5], 10);
    s = s >= 0 && s <= 59 ? s : 0;
    let d = parseInt(g[6], 10);
    d = d >= 0 && d <= 59 ? d : 0;
    const c = g[7] || "Z";
    let G = parseInt(g[8], 10);
    G = G >= 0 && G <= 23 ? G : 0;
    let b = parseInt(g[9], 10) || 0;
    return b = b >= 0 && b <= 59 ? b : 0, c === "-" ? (l += G, s += b) : c === "+" && (l -= G, s -= b), new Date(Date.UTC(C, A, i, l, s, d));
  }
};
function Vs(Z, {
  scale: I = 1,
  rotation: g = 0
}) {
  const {
    width: C,
    height: A
  } = Z.attributes.style, i = [0, 0, parseInt(C), parseInt(A)];
  return new IC({
    viewBox: i,
    userUnit: 1,
    scale: I,
    rotation: g
  });
}
function gC(Z) {
  if (Z.startsWith("#")) {
    const I = parseInt(Z.slice(1), 16);
    return [(I & 16711680) >> 16, (I & 65280) >> 8, I & 255];
  }
  return Z.startsWith("rgb(") ? Z.slice(4, -1).split(",").map((I) => parseInt(I)) : Z.startsWith("rgba(") ? Z.slice(5, -1).split(",").map((I) => parseInt(I)).slice(0, 3) : (L(`Not a valid color format: "${Z}"`), [0, 0, 0]);
}
function Ns(Z) {
  const I = document.createElement("span");
  I.style.visibility = "hidden", I.style.colorScheme = "only light", document.body.append(I);
  for (const g of Z.keys()) {
    I.style.color = g;
    const C = window.getComputedStyle(I).color;
    Z.set(g, gC(C));
  }
  I.remove();
}
function q(Z) {
  const {
    a: I,
    b: g,
    c: C,
    d: A,
    e: i,
    f: l
  } = Z.getTransform();
  return [I, g, C, A, i, l];
}
function DI(Z) {
  const {
    a: I,
    b: g,
    c: C,
    d: A,
    e: i,
    f: l
  } = Z.getTransform().invertSelf();
  return [I, g, C, A, i, l];
}
function cg(Z, I, g = !1, C = !0) {
  if (I instanceof IC) {
    const {
      pageWidth: A,
      pageHeight: i
    } = I.rawDims, {
      style: l
    } = Z, s = GI.isCSSRoundSupported, d = `var(--total-scale-factor) * ${A}px`, c = `var(--total-scale-factor) * ${i}px`, G = s ? `round(down, ${d}, var(--scale-round-x))` : `calc(${d})`, b = s ? `round(down, ${c}, var(--scale-round-y))` : `calc(${c})`;
    !g || I.rotation % 180 === 0 ? (l.width = G, l.height = b) : (l.width = b, l.height = G);
  }
  C && Z.setAttribute("data-main-rotation", I.rotation);
}
let Gg = class dA {
  constructor() {
    const {
      pixelRatio: I
    } = dA;
    this.sx = I, this.sy = I;
  }
  get scaled() {
    return this.sx !== 1 || this.sy !== 1;
  }
  get symmetric() {
    return this.sx === this.sy;
  }
  limitCanvas(I, g, C, A, i = -1) {
    let l = 1 / 0, s = 1 / 0, d = 1 / 0;
    C = dA.capPixels(C, i), C > 0 && (l = Math.sqrt(C / (I * g))), A !== -1 && (s = A / I, d = A / g);
    const c = Math.min(l, s, d);
    return this.sx > c || this.sy > c ? (this.sx = c, this.sy = c, !0) : !1;
  }
  static get pixelRatio() {
    return globalThis.devicePixelRatio || 1;
  }
  static capPixels(I, g) {
    if (g >= 0) {
      const C = Math.ceil(window.screen.availWidth * window.screen.availHeight * this.pixelRatio ** 2 * (1 + g / 100));
      return I > 0 ? Math.min(I, C) : C;
    }
    return I;
  }
};
const ZA = ["image/apng", "image/avif", "image/bmp", "image/gif", "image/jpeg", "image/png", "image/svg+xml", "image/webp", "image/x-icon"];
class us {
  static get isDarkMode() {
    return T(this, "isDarkMode", !!window?.matchMedia?.("(prefers-color-scheme: dark)").matches);
  }
}
let Rs = class {
  static get commentForegroundColor() {
    const I = document.createElement("span");
    I.classList.add("comment", "sidebar");
    const {
      style: g
    } = I;
    g.width = g.height = "0", g.display = "none", g.color = "var(--comment-fg-color)", document.body.append(I);
    const {
      color: C
    } = window.getComputedStyle(I);
    return I.remove(), T(this, "commentForegroundColor", gC(C));
  }
};
function ys(Z, I, g, C) {
  C = Math.min(Math.max(C ?? 1, 0), 1);
  const A = 255 * (1 - C);
  return Z = Math.round(Z * C + A), I = Math.round(I * C + A), g = Math.round(g * C + A), [Z, I, g];
}
function _A(Z, I) {
  const g = Z[0] / 255, C = Z[1] / 255, A = Z[2] / 255, i = Math.max(g, C, A), l = Math.min(g, C, A), s = (i + l) / 2;
  if (i === l)
    I[0] = I[1] = 0;
  else {
    const d = i - l;
    switch (I[1] = s < 0.5 ? d / (i + l) : d / (2 - i - l), i) {
      case g:
        I[0] = ((C - A) / d + (C < A ? 6 : 0)) * 60;
        break;
      case C:
        I[0] = ((A - g) / d + 2) * 60;
        break;
      case A:
        I[0] = ((g - C) / d + 4) * 60;
        break;
    }
  }
  I[2] = s;
}
function cA(Z, I) {
  const g = Z[0], C = Z[1], A = Z[2], i = (1 - Math.abs(2 * A - 1)) * C, l = i * (1 - Math.abs(g / 60 % 2 - 1)), s = A - i / 2;
  switch (Math.floor(g / 60)) {
    case 0:
      I[0] = i + s, I[1] = l + s, I[2] = s;
      break;
    case 1:
      I[0] = l + s, I[1] = i + s, I[2] = s;
      break;
    case 2:
      I[0] = s, I[1] = i + s, I[2] = l + s;
      break;
    case 3:
      I[0] = s, I[1] = l + s, I[2] = i + s;
      break;
    case 4:
      I[0] = l + s, I[1] = s, I[2] = i + s;
      break;
    case 5:
    case 6:
      I[0] = i + s, I[1] = s, I[2] = l + s;
      break;
  }
}
function qA(Z) {
  return Z <= 0.03928 ? Z / 12.92 : ((Z + 0.055) / 1.055) ** 2.4;
}
function $A(Z, I, g) {
  cA(Z, g), g.map(qA);
  const C = 0.2126 * g[0] + 0.7152 * g[1] + 0.0722 * g[2];
  cA(I, g), g.map(qA);
  const A = 0.2126 * g[0] + 0.7152 * g[1] + 0.0722 * g[2];
  return C > A ? (C + 0.05) / (A + 0.05) : (A + 0.05) / (C + 0.05);
}
const Ii = /* @__PURE__ */ new Map();
function Xs(Z, I) {
  const g = Z[0] + Z[1] * 256 + Z[2] * 65536 + I[0] * 16777216 + I[1] * 4294967296 + I[2] * 1099511627776;
  let C = Ii.get(g);
  if (C)
    return C;
  const A = new Float32Array(9), i = A.subarray(0, 3), l = A.subarray(3, 6);
  _A(Z, l);
  const s = A.subarray(6, 9);
  _A(I, s);
  const d = s[2] < 0.5, c = d ? 12 : 4.5;
  if (l[2] = d ? Math.sqrt(l[2]) : 1 - Math.sqrt(1 - l[2]), $A(l, s, i) < c) {
    let G, b;
    d ? (G = l[2], b = 1) : (G = 0, b = l[2]);
    const o = 5e-3;
    for (; b - G > o; ) {
      const m = l[2] = (G + b) / 2;
      d === $A(l, s, i) < c ? G = m : b = m;
    }
    l[2] = d ? b : G;
  }
  return cA(l, i), C = M.makeHexColor(Math.round(i[0] * 255), Math.round(i[1] * 255), Math.round(i[2] * 255)), Ii.set(g, C), C;
}
function dl({
  html: Z,
  dir: I,
  className: g
}, C) {
  const A = document.createDocumentFragment();
  if (typeof Z == "string") {
    const i = document.createElement("p");
    i.dir = I || "auto";
    const l = Z.split(/(?:\r\n?|\n)/);
    for (let s = 0, d = l.length; s < d; ++s) {
      const c = l[s];
      i.append(document.createTextNode(c)), s < d - 1 && i.append(document.createElement("br"));
    }
    A.append(i);
  } else
    sl.render({
      xfaHtml: Z,
      div: A,
      intent: "richText"
    });
  A.firstChild.classList.add("richText", g), C.append(A);
}
class Tg {
  #I = null;
  #g = null;
  #A;
  #C = null;
  #i = null;
  #l = null;
  #s = null;
  #d = null;
  static #c = null;
  constructor(I) {
    this.#A = I, Tg.#c ||= Object.freeze({
      freetext: "pdfjs-editor-remove-freetext-button",
      highlight: "pdfjs-editor-remove-highlight-button",
      ink: "pdfjs-editor-remove-ink-button",
      stamp: "pdfjs-editor-remove-stamp-button",
      signature: "pdfjs-editor-remove-signature-button"
    });
  }
  render() {
    const I = this.#I = document.createElement("div");
    I.classList.add("editToolbar", "hidden"), I.setAttribute("role", "toolbar");
    const g = this.#A._uiManager._signal;
    g instanceof AbortSignal && !g.aborted && (I.addEventListener("contextmenu", RI, {
      signal: g
    }), I.addEventListener("pointerdown", Tg.#Z, {
      signal: g
    }));
    const C = this.#C = document.createElement("div");
    C.className = "buttons", I.append(C);
    const A = this.#A.toolbarPosition;
    if (A) {
      const {
        style: i
      } = I, l = this.#A._uiManager.direction === "ltr" ? 1 - A[0] : A[0];
      i.insetInlineEnd = `${100 * l}%`, i.top = `calc(${100 * A[1]}% + var(--editor-toolbar-vert-offset))`;
    }
    return I;
  }
  get div() {
    return this.#I;
  }
  static #Z(I) {
    I.stopPropagation();
  }
  #o(I) {
    this.#A._focusEventsAllowed = !1, II(I);
  }
  #b(I) {
    this.#A._focusEventsAllowed = !0, II(I);
  }
  #m(I) {
    const g = this.#A._uiManager._signal;
    return !(g instanceof AbortSignal) || g.aborted ? !1 : (I.addEventListener("focusin", this.#o.bind(this), {
      capture: !0,
      signal: g
    }), I.addEventListener("focusout", this.#b.bind(this), {
      capture: !0,
      signal: g
    }), I.addEventListener("contextmenu", RI, {
      signal: g
    }), !0);
  }
  hide() {
    this.#I.classList.add("hidden"), this.#g?.hideDropdown();
  }
  show() {
    this.#I.classList.remove("hidden"), this.#i?.shown(), this.#l?.shown();
  }
  addDeleteButton() {
    const {
      editorType: I,
      _uiManager: g
    } = this.#A, C = document.createElement("button");
    C.classList.add("basic", "deleteButton"), C.tabIndex = 0, C.setAttribute("data-l10n-id", Tg.#c[I]), this.#m(C) && C.addEventListener("click", (A) => {
      g.delete();
    }, {
      signal: g._signal
    }), this.#C.append(C);
  }
  get #t() {
    const I = document.createElement("div");
    return I.className = "divider", I;
  }
  async addAltText(I) {
    const g = await I.render();
    this.#m(g), this.#C.append(g, this.#t), this.#i = I;
  }
  addComment(I, g = null) {
    if (this.#l)
      return;
    const C = I.renderForToolbar();
    if (!C)
      return;
    this.#m(C);
    const A = this.#s = this.#t;
    g ? (this.#C.insertBefore(C, g), this.#C.insertBefore(A, g)) : this.#C.append(C, A), this.#l = I, I.toolbar = this;
  }
  addColorPicker(I) {
    if (this.#g)
      return;
    this.#g = I;
    const g = I.renderButton();
    this.#m(g), this.#C.append(g, this.#t);
  }
  async addEditSignatureButton(I) {
    const g = this.#d = await I.renderEditButton(this.#A);
    this.#m(g), this.#C.append(g, this.#t);
  }
  removeButton(I) {
    switch (I) {
      case "comment":
        this.#l?.removeToolbarCommentButton(), this.#l = null, this.#s?.remove(), this.#s = null;
        break;
    }
  }
  async addButton(I, g) {
    switch (I) {
      case "colorPicker":
        this.addColorPicker(g);
        break;
      case "altText":
        await this.addAltText(g);
        break;
      case "editSignature":
        await this.addEditSignatureButton(g);
        break;
      case "delete":
        this.addDeleteButton();
        break;
      case "comment":
        this.addComment(g);
        break;
    }
  }
  async addButtonBefore(I, g, C) {
    const A = this.#C.querySelector(C);
    A && I === "comment" && this.addComment(g, A);
  }
  updateEditSignatureButton(I) {
    this.#d && (this.#d.title = I);
  }
  remove() {
    this.#I.remove(), this.#g?.destroy(), this.#g = null;
  }
}
class Hs {
  #I = null;
  #g = null;
  #A;
  constructor(I) {
    this.#A = I;
  }
  #C() {
    const I = this.#g = document.createElement("div");
    I.className = "editToolbar", I.setAttribute("role", "toolbar");
    const g = this.#A._signal;
    g instanceof AbortSignal && !g.aborted && I.addEventListener("contextmenu", RI, {
      signal: g
    });
    const C = this.#I = document.createElement("div");
    return C.className = "buttons", I.append(C), this.#A.hasCommentManager() && this.#l("commentButton", "pdfjs-comment-floating-button", "pdfjs-comment-floating-button-label", () => {
      this.#A.commentSelection("floating_button");
    }), this.#l("highlightButton", "pdfjs-highlight-floating-button1", "pdfjs-highlight-floating-button-label", () => {
      this.#A.highlightSelection("floating_button");
    }), I;
  }
  #i(I, g) {
    let C = 0, A = 0;
    for (const i of I) {
      const l = i.y + i.height;
      if (l < C)
        continue;
      const s = i.x + (g ? i.width : 0);
      if (l > C) {
        A = s, C = l;
        continue;
      }
      g ? s > A && (A = s) : s < A && (A = s);
    }
    return [g ? 1 - A : A, C];
  }
  show(I, g, C) {
    const [A, i] = this.#i(g, C), {
      style: l
    } = this.#g ||= this.#C();
    I.append(this.#g), l.insetInlineEnd = `${100 * A}%`, l.top = `calc(${100 * i}% + var(--editor-toolbar-vert-offset))`;
  }
  hide() {
    this.#g.remove();
  }
  #l(I, g, C, A) {
    const i = document.createElement("button");
    i.classList.add("basic", I), i.tabIndex = 0, i.setAttribute("data-l10n-id", g);
    const l = document.createElement("span");
    i.append(l), l.className = "visuallyHidden", l.setAttribute("data-l10n-id", C);
    const s = this.#A._signal;
    s instanceof AbortSignal && !s.aborted && (i.addEventListener("contextmenu", RI, {
      signal: s
    }), i.addEventListener("click", A, {
      signal: s
    })), this.#I.append(i);
  }
}
function Zl(Z, I, g) {
  for (const C of g)
    I.addEventListener(C, Z[C].bind(Z));
}
class Ms {
  #I = 0;
  get id() {
    return `${Og}${this.#I++}`;
  }
}
class MA {
  #I = il();
  #g = 0;
  #A = null;
  static get _isSVGFittingCanvas() {
    const I = 'data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>', C = new OffscreenCanvas(1, 3).getContext("2d", {
      willReadFrequently: !0
    }), A = new Image();
    A.src = I;
    const i = A.decode().then(() => (C.drawImage(A, 0, 0, 1, 1, 0, 0, 1, 3), new Uint32Array(C.getImageData(0, 0, 1, 1).data.buffer)[0] === 0));
    return T(this, "_isSVGFittingCanvas", i);
  }
  async #C(I, g) {
    this.#A ||= /* @__PURE__ */ new Map();
    let C = this.#A.get(I);
    if (C === null)
      return null;
    if (C?.bitmap)
      return C.refCounter += 1, C;
    try {
      C ||= {
        bitmap: null,
        id: `image_${this.#I}_${this.#g++}`,
        refCounter: 0,
        isSvg: !1
      };
      let A;
      if (typeof g == "string" ? (C.url = g, A = await $g(g, "blob")) : g instanceof File ? A = C.file = g : g instanceof Blob && (A = g), A.type === "image/svg+xml") {
        const i = MA._isSVGFittingCanvas, l = new FileReader(), s = new Image(), d = new Promise((c, G) => {
          s.onload = () => {
            C.bitmap = s, C.isSvg = !0, c();
          }, l.onload = async () => {
            const b = C.svgUrl = l.result;
            s.src = await i ? `${b}#svgView(preserveAspectRatio(none))` : b;
          }, s.onerror = l.onerror = G;
        });
        l.readAsDataURL(A), await d;
      } else
        C.bitmap = await createImageBitmap(A);
      C.refCounter = 1;
    } catch (A) {
      L(A), C = null;
    }
    return this.#A.set(I, C), C && this.#A.set(C.id, C), C;
  }
  async getFromFile(I) {
    const {
      lastModified: g,
      name: C,
      size: A,
      type: i
    } = I;
    return this.#C(`${g}_${C}_${A}_${i}`, I);
  }
  async getFromUrl(I) {
    return this.#C(I, I);
  }
  async getFromBlob(I, g) {
    const C = await g;
    return this.#C(I, C);
  }
  async getFromId(I) {
    this.#A ||= /* @__PURE__ */ new Map();
    const g = this.#A.get(I);
    if (!g)
      return null;
    if (g.bitmap)
      return g.refCounter += 1, g;
    if (g.file)
      return this.getFromFile(g.file);
    if (g.blobPromise) {
      const {
        blobPromise: C
      } = g;
      return delete g.blobPromise, this.getFromBlob(g.id, C);
    }
    return this.getFromUrl(g.url);
  }
  getFromCanvas(I, g) {
    this.#A ||= /* @__PURE__ */ new Map();
    let C = this.#A.get(I);
    if (C?.bitmap)
      return C.refCounter += 1, C;
    const A = new OffscreenCanvas(g.width, g.height);
    return A.getContext("2d").drawImage(g, 0, 0), C = {
      bitmap: A.transferToImageBitmap(),
      id: `image_${this.#I}_${this.#g++}`,
      refCounter: 1,
      isSvg: !1
    }, this.#A.set(I, C), this.#A.set(C.id, C), C;
  }
  getSvgUrl(I) {
    const g = this.#A.get(I);
    return g?.isSvg ? g.svgUrl : null;
  }
  deleteId(I) {
    this.#A ||= /* @__PURE__ */ new Map();
    const g = this.#A.get(I);
    if (!g || (g.refCounter -= 1, g.refCounter !== 0))
      return;
    const {
      bitmap: C
    } = g;
    if (!g.url && !g.file) {
      const A = new OffscreenCanvas(C.width, C.height);
      A.getContext("bitmaprenderer").transferFromImageBitmap(C), g.blobPromise = A.convertToBlob();
    }
    C.close?.(), g.bitmap = null;
  }
  isValidId(I) {
    return I.startsWith(`image_${this.#I}_`);
  }
}
class Ds {
  #I = [];
  #g = !1;
  #A;
  #C = -1;
  constructor(I = 128) {
    this.#A = I;
  }
  add({
    cmd: I,
    undo: g,
    post: C,
    mustExec: A,
    type: i = NaN,
    overwriteIfSameType: l = !1,
    keepUndo: s = !1
  }) {
    if (A && I(), this.#g)
      return;
    const d = {
      cmd: I,
      undo: g,
      post: C,
      type: i
    };
    if (this.#C === -1) {
      this.#I.length > 0 && (this.#I.length = 0), this.#C = 0, this.#I.push(d);
      return;
    }
    if (l && this.#I[this.#C].type === i) {
      s && (d.undo = this.#I[this.#C].undo), this.#I[this.#C] = d;
      return;
    }
    const c = this.#C + 1;
    c === this.#A ? this.#I.splice(0, 1) : (this.#C = c, c < this.#I.length && this.#I.splice(c)), this.#I.push(d);
  }
  undo() {
    if (this.#C === -1)
      return;
    this.#g = !0;
    const {
      undo: I,
      post: g
    } = this.#I[this.#C];
    I(), g?.(), this.#g = !1, this.#C -= 1;
  }
  redo() {
    if (this.#C < this.#I.length - 1) {
      this.#C += 1, this.#g = !0;
      const {
        cmd: I,
        post: g
      } = this.#I[this.#C];
      I(), g?.(), this.#g = !1;
    }
  }
  hasSomethingToUndo() {
    return this.#C !== -1;
  }
  hasSomethingToRedo() {
    return this.#C < this.#I.length - 1;
  }
  cleanType(I) {
    if (this.#C !== -1) {
      for (let g = this.#C; g >= 0; g--)
        if (this.#I[g].type !== I) {
          this.#I.splice(g + 1, this.#C - g), this.#C = g;
          return;
        }
      this.#I.length = 0, this.#C = -1;
    }
  }
  destroy() {
    this.#I = null;
  }
}
class CC {
  constructor(I) {
    this.buffer = [], this.callbacks = /* @__PURE__ */ new Map(), this.allKeys = /* @__PURE__ */ new Set();
    const {
      isMac: g
    } = GI.platform;
    for (const [C, A, i = {}] of I)
      for (const l of C) {
        const s = l.startsWith("mac+");
        g && s ? (this.callbacks.set(l.slice(4), {
          callback: A,
          options: i
        }), this.allKeys.add(l.split("+").at(-1))) : !g && !s && (this.callbacks.set(l, {
          callback: A,
          options: i
        }), this.allKeys.add(l.split("+").at(-1)));
      }
  }
  #I(I) {
    I.altKey && this.buffer.push("alt"), I.ctrlKey && this.buffer.push("ctrl"), I.metaKey && this.buffer.push("meta"), I.shiftKey && this.buffer.push("shift"), this.buffer.push(I.key);
    const g = this.buffer.join("+");
    return this.buffer.length = 0, g;
  }
  exec(I, g) {
    if (!this.allKeys.has(g.key))
      return;
    const C = this.callbacks.get(this.#I(g));
    if (!C)
      return;
    const {
      callback: A,
      options: {
        bubbles: i = !1,
        args: l = [],
        checker: s = null
      }
    } = C;
    s && !s(I, g) || (A.bind(I, ...l, g)(), i || II(g));
  }
}
class DA {
  static _colorsMapping = /* @__PURE__ */ new Map([["CanvasText", [0, 0, 0]], ["Canvas", [255, 255, 255]]]);
  get _colors() {
    const I = /* @__PURE__ */ new Map([["CanvasText", null], ["Canvas", null]]);
    return Ns(I), T(this, "_colors", I);
  }
  convert(I) {
    const g = gC(I);
    if (!window.matchMedia("(forced-colors: active)").matches)
      return g;
    for (const [C, A] of this._colors)
      if (A.every((i, l) => i === g[l]))
        return DA._colorsMapping.get(C);
    return g;
  }
  getHexCode(I) {
    const g = this._colors.get(I);
    return g ? M.makeHexColor(...g) : I;
  }
}
let Eg = class GA {
  #I = new AbortController();
  #g = null;
  #A = null;
  #C = /* @__PURE__ */ new Map();
  #i = /* @__PURE__ */ new Map();
  #l = null;
  #s = null;
  #d = null;
  #c = new Ds();
  #Z = null;
  #o = null;
  #b = null;
  #m = 0;
  #t = /* @__PURE__ */ new Set();
  #a = null;
  #G = null;
  #e = /* @__PURE__ */ new Set();
  _editorUndoBar = null;
  #B = !1;
  #W = !1;
  #h = !1;
  #N = null;
  #w = null;
  #n = null;
  #R = null;
  #Y = !1;
  #u = null;
  #M = new Ms();
  #y = !1;
  #X = !1;
  #p = !1;
  #K = null;
  #S = null;
  #F = null;
  #z = null;
  #x = null;
  #H = k.NONE;
  #V = /* @__PURE__ */ new Set();
  #D = null;
  #r = null;
  #j = null;
  #P = null;
  #k = null;
  #v = {
    isEditing: !1,
    isEmpty: !0,
    hasSomethingToUndo: !1,
    hasSomethingToRedo: !1,
    hasSelectedEditor: !1,
    hasSelectedText: !1
  };
  #Q = [0, 0];
  #J = null;
  #O = null;
  #f = null;
  #q = null;
  #T = null;
  static TRANSLATE_SMALL = 1;
  static TRANSLATE_BIG = 10;
  static get _keyboardManager() {
    const I = GA.prototype, g = (l) => l.#O.contains(document.activeElement) && document.activeElement.tagName !== "BUTTON" && l.hasSomethingToControl(), C = (l, {
      target: s
    }) => {
      if (s instanceof HTMLInputElement) {
        const {
          type: d
        } = s;
        return d !== "text" && d !== "number";
      }
      return !0;
    }, A = this.TRANSLATE_SMALL, i = this.TRANSLATE_BIG;
    return T(this, "_keyboardManager", new CC([[["ctrl+a", "mac+meta+a"], I.selectAll, {
      checker: C
    }], [["ctrl+z", "mac+meta+z"], I.undo, {
      checker: C
    }], [["ctrl+y", "ctrl+shift+z", "mac+meta+shift+z", "ctrl+shift+Z", "mac+meta+shift+Z"], I.redo, {
      checker: C
    }], [["Backspace", "alt+Backspace", "ctrl+Backspace", "shift+Backspace", "mac+Backspace", "mac+alt+Backspace", "mac+ctrl+Backspace", "Delete", "ctrl+Delete", "shift+Delete", "mac+Delete"], I.delete, {
      checker: C
    }], [["Enter", "mac+Enter"], I.addNewEditorFromKeyboard, {
      checker: (l, {
        target: s
      }) => !(s instanceof HTMLButtonElement) && l.#O.contains(s) && !l.isEnterHandled
    }], [[" ", "mac+ "], I.addNewEditorFromKeyboard, {
      checker: (l, {
        target: s
      }) => !(s instanceof HTMLButtonElement) && l.#O.contains(document.activeElement)
    }], [["Escape", "mac+Escape"], I.unselectAll], [["ArrowLeft", "mac+ArrowLeft"], I.translateSelectedEditors, {
      args: [-A, 0],
      checker: g
    }], [["ctrl+ArrowLeft", "mac+shift+ArrowLeft"], I.translateSelectedEditors, {
      args: [-i, 0],
      checker: g
    }], [["ArrowRight", "mac+ArrowRight"], I.translateSelectedEditors, {
      args: [A, 0],
      checker: g
    }], [["ctrl+ArrowRight", "mac+shift+ArrowRight"], I.translateSelectedEditors, {
      args: [i, 0],
      checker: g
    }], [["ArrowUp", "mac+ArrowUp"], I.translateSelectedEditors, {
      args: [0, -A],
      checker: g
    }], [["ctrl+ArrowUp", "mac+shift+ArrowUp"], I.translateSelectedEditors, {
      args: [0, -i],
      checker: g
    }], [["ArrowDown", "mac+ArrowDown"], I.translateSelectedEditors, {
      args: [0, A],
      checker: g
    }], [["ctrl+ArrowDown", "mac+shift+ArrowDown"], I.translateSelectedEditors, {
      args: [0, i],
      checker: g
    }]]));
  }
  constructor(I, g, C, A, i, l, s, d, c, G, b, o, m, e, a, h) {
    const t = this._signal = this.#I.signal;
    this.#O = I, this.#f = g, this.#q = C, this.#l = A, this.#Z = i, this.#r = l, this.#k = d, this._eventBus = s, s._on("editingaction", this.onEditingAction.bind(this), {
      signal: t
    }), s._on("pagechanging", this.onPageChanging.bind(this), {
      signal: t
    }), s._on("scalechanging", this.onScaleChanging.bind(this), {
      signal: t
    }), s._on("rotationchanging", this.onRotationChanging.bind(this), {
      signal: t
    }), s._on("setpreference", this.onSetPreference.bind(this), {
      signal: t
    }), s._on("switchannotationeditorparams", (W) => this.updateParams(W.type, W.value), {
      signal: t
    }), window.addEventListener("pointerdown", () => {
      this.#X = !0;
    }, {
      capture: !0,
      signal: t
    }), window.addEventListener("pointerup", () => {
      this.#X = !1;
    }, {
      capture: !0,
      signal: t
    }), this.#ZI(), this.#oI(), this.#gI(), this.#s = d.annotationStorage, this.#N = d.filterFactory, this.#j = c, this.#R = G || null, this.#B = b, this.#W = o, this.#h = m, this.#x = e || null, this.viewParameters = {
      realScale: Hg.PDF_TO_CSS_UNITS,
      rotation: 0
    }, this.isShiftKeyDown = !1, this._editorUndoBar = a || null, this._supportsPinchToZoom = h !== !1, i?.setSidebarUiManager(this);
  }
  destroy() {
    this.#T?.resolve(), this.#T = null, this.#I?.abort(), this.#I = null, this._signal = null;
    for (const I of this.#i.values())
      I.destroy();
    this.#i.clear(), this.#C.clear(), this.#e.clear(), this.#z?.clear(), this.#g = null, this.#V.clear(), this.#c.destroy(), this.#l?.destroy(), this.#Z?.destroy(), this.#r?.destroy(), this.#u?.hide(), this.#u = null, this.#F?.destroy(), this.#F = null, this.#A = null, this.#w && (clearTimeout(this.#w), this.#w = null), this.#J && (clearTimeout(this.#J), this.#J = null), this._editorUndoBar?.destroy(), this.#k = null;
  }
  combinedSignal(I) {
    return AbortSignal.any([this._signal, I.signal]);
  }
  get mlManager() {
    return this.#x;
  }
  get useNewAltTextFlow() {
    return this.#W;
  }
  get useNewAltTextWhenAddingImage() {
    return this.#h;
  }
  get hcmFilter() {
    return T(this, "hcmFilter", this.#j ? this.#N.addHCMFilter(this.#j.foreground, this.#j.background) : "none");
  }
  get direction() {
    return T(this, "direction", getComputedStyle(this.#O).direction);
  }
  get _highlightColors() {
    return T(this, "_highlightColors", this.#R ? new Map(this.#R.split(",").map((I) => (I = I.split("=").map((g) => g.trim()), I[1] = I[1].toUpperCase(), I))) : null);
  }
  get highlightColors() {
    const {
      _highlightColors: I
    } = this;
    if (!I)
      return T(this, "highlightColors", null);
    const g = /* @__PURE__ */ new Map(), C = !!this.#j;
    for (const [A, i] of I) {
      const l = A.endsWith("_HCM");
      if (C && l) {
        g.set(A.replace("_HCM", ""), i);
        continue;
      }
      !C && !l && g.set(A, i);
    }
    return T(this, "highlightColors", g);
  }
  get highlightColorNames() {
    return T(this, "highlightColorNames", this.highlightColors ? new Map(Array.from(this.highlightColors, (I) => I.reverse())) : null);
  }
  getNonHCMColor(I) {
    if (!this._highlightColors)
      return I;
    const g = this.highlightColorNames.get(I);
    return this._highlightColors.get(g) || I;
  }
  getNonHCMColorName(I) {
    return this.highlightColorNames.get(I) || I;
  }
  setCurrentDrawingSession(I) {
    I ? (this.unselectAll(), this.disableUserSelect(!0)) : this.disableUserSelect(!1), this.#b = I;
  }
  setMainHighlightColorPicker(I) {
    this.#F = I;
  }
  editAltText(I, g = !1) {
    this.#l?.editAltText(this, I, g);
  }
  hasCommentManager() {
    return !!this.#Z;
  }
  editComment(I, g, C, A) {
    this.#Z?.showDialog(this, I, g, C, A);
  }
  selectComment(I, g) {
    this.#i.get(I)?.getEditorByUID(g)?.toggleComment(!0, !0);
  }
  updateComment(I) {
    this.#Z?.updateComment(I.getData());
  }
  updatePopupColor(I) {
    this.#Z?.updatePopupColor(I);
  }
  removeComment(I) {
    this.#Z?.removeComments([I.uid]);
  }
  toggleComment(I, g, C = void 0) {
    this.#Z?.toggleCommentPopup(I, g, C);
  }
  makeCommentColor(I, g) {
    return I && this.#Z?.makeCommentColor(I, g) || null;
  }
  getCommentDialogElement() {
    return this.#Z?.dialogElement || null;
  }
  async waitForEditorsRendered(I) {
    if (this.#i.has(I - 1))
      return;
    const {
      resolve: g,
      promise: C
    } = Promise.withResolvers(), A = (i) => {
      i.pageNumber === I && (this._eventBus._off("editorsrendered", A), g());
    };
    this._eventBus.on("editorsrendered", A), await C;
  }
  getSignature(I) {
    this.#r?.getSignature({
      uiManager: this,
      editor: I
    });
  }
  get signatureManager() {
    return this.#r;
  }
  switchToMode(I, g) {
    this._eventBus.on("annotationeditormodechanged", g, {
      once: !0,
      signal: this._signal
    }), this._eventBus.dispatch("showannotationeditorui", {
      source: this,
      mode: I
    });
  }
  setPreference(I, g) {
    this._eventBus.dispatch("setpreference", {
      source: this,
      name: I,
      value: g
    });
  }
  onSetPreference({
    name: I,
    value: g
  }) {
    switch (I) {
      case "enableNewAltTextWhenAddingImage":
        this.#h = g;
        break;
    }
  }
  onPageChanging({
    pageNumber: I
  }) {
    this.#m = I - 1;
  }
  focusMainContainer() {
    this.#O.focus();
  }
  findParent(I, g) {
    for (const C of this.#i.values()) {
      const {
        x: A,
        y: i,
        width: l,
        height: s
      } = C.div.getBoundingClientRect();
      if (I >= A && I <= A + l && g >= i && g <= i + s)
        return C;
    }
    return null;
  }
  disableUserSelect(I = !1) {
    this.#f.classList.toggle("noUserSelect", I);
  }
  addShouldRescale(I) {
    this.#e.add(I);
  }
  removeShouldRescale(I) {
    this.#e.delete(I);
  }
  onScaleChanging({
    scale: I
  }) {
    this.commitOrRemove(), this.viewParameters.realScale = I * Hg.PDF_TO_CSS_UNITS;
    for (const g of this.#e)
      g.onScaleChanging();
    this.#b?.onScaleChanging();
  }
  onRotationChanging({
    pagesRotation: I
  }) {
    this.commitOrRemove(), this.viewParameters.rotation = I;
  }
  #E({
    anchorNode: I
  }) {
    return I.nodeType === Node.TEXT_NODE ? I.parentElement : I;
  }
  #_(I) {
    const {
      currentLayer: g
    } = this;
    if (g.hasTextLayer(I))
      return g;
    for (const C of this.#i.values())
      if (C.hasTextLayer(I))
        return C;
    return null;
  }
  highlightSelection(I = "", g = !1) {
    const C = document.getSelection();
    if (!C || C.isCollapsed)
      return;
    const {
      anchorNode: A,
      anchorOffset: i,
      focusNode: l,
      focusOffset: s
    } = C, d = C.toString(), G = this.#E(C).closest(".textLayer"), b = this.getSelectionBoxes(G);
    if (!b)
      return;
    C.empty();
    const o = this.#_(G), m = this.#H === k.NONE, e = () => {
      const a = o?.createAndAddNewEditor({
        x: 0,
        y: 0
      }, !1, {
        methodOfCreation: I,
        boxes: b,
        anchorNode: A,
        anchorOffset: i,
        focusNode: l,
        focusOffset: s,
        text: d
      });
      m && this.showAllEditors("highlight", !0, !0), g && a?.editComment();
    };
    if (m) {
      this.switchToMode(k.HIGHLIGHT, e);
      return;
    }
    e();
  }
  commentSelection(I = "") {
    this.highlightSelection(I, !0);
  }
  #sI() {
    const I = document.getSelection();
    if (!I || I.isCollapsed)
      return;
    const C = this.#E(I).closest(".textLayer"), A = this.getSelectionBoxes(C);
    A && (this.#u ||= new Hs(this), this.#u.show(C, A, this.direction === "ltr"));
  }
  getAndRemoveDataFromAnnotationStorage(I) {
    if (!this.#s)
      return null;
    const g = `${Og}${I}`, C = this.#s.getRawValue(g);
    return C && this.#s.remove(g), C;
  }
  addToAnnotationStorage(I) {
    !I.isEmpty() && this.#s && !this.#s.has(I.id) && this.#s.setValue(I.id, I);
  }
  a11yAlert(I, g = null) {
    const C = this.#q;
    C && (C.setAttribute("data-l10n-id", I), g ? C.setAttribute("data-l10n-args", JSON.stringify(g)) : C.removeAttribute("data-l10n-args"));
  }
  #dI() {
    const I = document.getSelection();
    if (!I || I.isCollapsed) {
      this.#D && (this.#u?.hide(), this.#D = null, this.#L({
        hasSelectedText: !1
      }));
      return;
    }
    const {
      anchorNode: g
    } = I;
    if (g === this.#D)
      return;
    const A = this.#E(I).closest(".textLayer");
    if (!A) {
      this.#D && (this.#u?.hide(), this.#D = null, this.#L({
        hasSelectedText: !1
      }));
      return;
    }
    if (this.#u?.hide(), this.#D = g, this.#L({
      hasSelectedText: !0
    }), !(this.#H !== k.HIGHLIGHT && this.#H !== k.NONE) && (this.#H === k.HIGHLIGHT && this.showAllEditors("highlight", !0, !0), this.#Y = this.isShiftKeyDown, !this.isShiftKeyDown)) {
      const i = this.#H === k.HIGHLIGHT ? this.#_(A) : null;
      if (i?.toggleDrawing(), this.#X) {
        const l = new AbortController(), s = this.combinedSignal(l), d = (c) => {
          c.type === "pointerup" && c.button !== 0 || (l.abort(), i?.toggleDrawing(!0), c.type === "pointerup" && this.#$("main_toolbar"));
        };
        window.addEventListener("pointerup", d, {
          signal: s
        }), window.addEventListener("blur", d, {
          signal: s
        });
      } else
        i?.toggleDrawing(!0), this.#$("main_toolbar");
    }
  }
  #$(I = "") {
    this.#H === k.HIGHLIGHT ? this.highlightSelection(I) : this.#B && this.#sI();
  }
  #ZI() {
    document.addEventListener("selectionchange", this.#dI.bind(this), {
      signal: this._signal
    });
  }
  #cI() {
    if (this.#n)
      return;
    this.#n = new AbortController();
    const I = this.combinedSignal(this.#n);
    window.addEventListener("focus", this.focus.bind(this), {
      signal: I
    }), window.addEventListener("blur", this.blur.bind(this), {
      signal: I
    });
  }
  #GI() {
    this.#n?.abort(), this.#n = null;
  }
  blur() {
    if (this.isShiftKeyDown = !1, this.#Y && (this.#Y = !1, this.#$("main_toolbar")), !this.hasSelection)
      return;
    const {
      activeElement: I
    } = document;
    for (const g of this.#V)
      if (g.div.contains(I)) {
        this.#S = [g, I], g._focusEventsAllowed = !1;
        break;
      }
  }
  focus() {
    if (!this.#S)
      return;
    const [I, g] = this.#S;
    this.#S = null, g.addEventListener("focusin", () => {
      I._focusEventsAllowed = !0;
    }, {
      once: !0,
      signal: this._signal
    }), g.focus();
  }
  #gI() {
    if (this.#K)
      return;
    this.#K = new AbortController();
    const I = this.combinedSignal(this.#K);
    window.addEventListener("keydown", this.keydown.bind(this), {
      signal: I
    }), window.addEventListener("keyup", this.keyup.bind(this), {
      signal: I
    });
  }
  #bI() {
    this.#K?.abort(), this.#K = null;
  }
  #CI() {
    if (this.#o)
      return;
    this.#o = new AbortController();
    const I = this.combinedSignal(this.#o);
    document.addEventListener("copy", this.copy.bind(this), {
      signal: I
    }), document.addEventListener("cut", this.cut.bind(this), {
      signal: I
    }), document.addEventListener("paste", this.paste.bind(this), {
      signal: I
    });
  }
  #AI() {
    this.#o?.abort(), this.#o = null;
  }
  #oI() {
    const I = this._signal;
    document.addEventListener("dragover", this.dragOver.bind(this), {
      signal: I
    }), document.addEventListener("drop", this.drop.bind(this), {
      signal: I
    });
  }
  addEditListeners() {
    this.#gI(), this.#CI();
  }
  removeEditListeners() {
    this.#bI(), this.#AI();
  }
  dragOver(I) {
    for (const {
      type: g
    } of I.dataTransfer.items)
      for (const C of this.#G)
        if (C.isHandlingMimeForPasting(g)) {
          I.dataTransfer.dropEffect = "copy", I.preventDefault();
          return;
        }
  }
  drop(I) {
    for (const g of I.dataTransfer.items)
      for (const C of this.#G)
        if (C.isHandlingMimeForPasting(g.type)) {
          C.paste(g, this.currentLayer), I.preventDefault();
          return;
        }
  }
  copy(I) {
    if (I.preventDefault(), this.#g?.commitOrRemove(), !this.hasSelection)
      return;
    const g = [];
    for (const C of this.#V) {
      const A = C.serialize(!0);
      A && g.push(A);
    }
    g.length !== 0 && I.clipboardData.setData("application/pdfjs", JSON.stringify(g));
  }
  cut(I) {
    this.copy(I), this.delete();
  }
  async paste(I) {
    I.preventDefault();
    const {
      clipboardData: g
    } = I;
    for (const i of g.items)
      for (const l of this.#G)
        if (l.isHandlingMimeForPasting(i.type)) {
          l.paste(i, this.currentLayer);
          return;
        }
    let C = g.getData("application/pdfjs");
    if (!C)
      return;
    try {
      C = JSON.parse(C);
    } catch (i) {
      L(`paste: "${i.message}".`);
      return;
    }
    if (!Array.isArray(C))
      return;
    this.unselectAll();
    const A = this.currentLayer;
    try {
      const i = [];
      for (const d of C) {
        const c = await A.deserialize(d);
        if (!c)
          return;
        i.push(c);
      }
      const l = () => {
        for (const d of i)
          this.#iI(d);
        this.#lI(i);
      }, s = () => {
        for (const d of i)
          d.remove();
      };
      this.addCommands({
        cmd: l,
        undo: s,
        mustExec: !0
      });
    } catch (i) {
      L(`paste: "${i.message}".`);
    }
  }
  keydown(I) {
    !this.isShiftKeyDown && I.key === "Shift" && (this.isShiftKeyDown = !0), this.#H !== k.NONE && !this.isEditorHandlingKeyboard && GA._keyboardManager.exec(this, I);
  }
  keyup(I) {
    this.isShiftKeyDown && I.key === "Shift" && (this.isShiftKeyDown = !1, this.#Y && (this.#Y = !1, this.#$("main_toolbar")));
  }
  onEditingAction({
    name: I
  }) {
    switch (I) {
      case "undo":
      case "redo":
      case "delete":
      case "selectAll":
        this[I]();
        break;
      case "highlightSelection":
        this.highlightSelection("context_menu");
        break;
      case "commentSelection":
        this.commentSelection("context_menu");
        break;
    }
  }
  #L(I) {
    Object.entries(I).some(([C, A]) => this.#v[C] !== A) && (this._eventBus.dispatch("annotationeditorstateschanged", {
      source: this,
      details: Object.assign(this.#v, I)
    }), this.#H === k.HIGHLIGHT && I.hasSelectedEditor === !1 && this.#U([[j.HIGHLIGHT_FREE, !0]]));
  }
  #U(I) {
    this._eventBus.dispatch("annotationeditorparamschanged", {
      source: this,
      details: I
    });
  }
  setEditingState(I) {
    I ? (this.#cI(), this.#CI(), this.#L({
      isEditing: this.#H !== k.NONE,
      isEmpty: this.#II(),
      hasSomethingToUndo: this.#c.hasSomethingToUndo(),
      hasSomethingToRedo: this.#c.hasSomethingToRedo(),
      hasSelectedEditor: !1
    })) : (this.#GI(), this.#AI(), this.#L({
      isEditing: !1
    }), this.disableUserSelect(!1));
  }
  registerEditorTypes(I) {
    if (!this.#G) {
      this.#G = I;
      for (const g of this.#G)
        this.#U(g.defaultPropertiesToUpdate);
    }
  }
  getId() {
    return this.#M.id;
  }
  get currentLayer() {
    return this.#i.get(this.#m);
  }
  getLayer(I) {
    return this.#i.get(I);
  }
  get currentPageIndex() {
    return this.#m;
  }
  addLayer(I) {
    this.#i.set(I.pageIndex, I), this.#y ? I.enable() : I.disable();
  }
  removeLayer(I) {
    this.#i.delete(I.pageIndex);
  }
  async updateMode(I, g = null, C = !1, A = !1, i = !1) {
    if (this.#H !== I && !(this.#T && (await this.#T.promise, !this.#T))) {
      if (this.#T = Promise.withResolvers(), this.#b?.commitOrRemove(), this.#H === k.POPUP && this.#Z?.hideSidebar(), this.#Z?.destroyPopup(), this.#H = I, I === k.NONE) {
        this.setEditingState(!1), this.#aI();
        for (const l of this.#C.values())
          l.hideStandaloneCommentButton();
        this._editorUndoBar?.hide(), this.toggleComment(null), this.#T.resolve();
        return;
      }
      for (const l of this.#C.values())
        l.addStandaloneCommentButton();
      I === k.SIGNATURE && await this.#r?.loadSignatures(), this.setEditingState(!0), await this.#mI(), this.unselectAll();
      for (const l of this.#i.values())
        l.updateMode(I);
      if (I === k.POPUP) {
        this.#A ||= await this.#k.getAnnotationsByType(new Set(this.#G.map((d) => d._editorType)));
        const l = /* @__PURE__ */ new Set(), s = [];
        for (const d of this.#C.values()) {
          const {
            annotationElementId: c,
            hasComment: G,
            deleted: b
          } = d;
          c && l.add(c), G && !b && s.push(d.getData());
        }
        for (const d of this.#A) {
          const {
            id: c,
            popupRef: G,
            contentsObj: b
          } = d;
          G && b?.str && !l.has(c) && !this.#t.has(c) && s.push(d);
        }
        this.#Z?.showSidebar(s);
      }
      if (!g) {
        C && this.addNewEditorFromKeyboard(), this.#T.resolve();
        return;
      }
      for (const l of this.#C.values())
        l.uid === g ? (this.setSelected(l), i ? l.editComment() : A ? l.enterInEditMode() : l.focus()) : l.unselect();
      this.#T.resolve();
    }
  }
  addNewEditorFromKeyboard() {
    this.currentLayer.canCreateNewEmptyEditor() && this.currentLayer.addNewEditor();
  }
  updateToolbar(I) {
    I.mode !== this.#H && this._eventBus.dispatch("switchannotationeditormode", {
      source: this,
      ...I
    });
  }
  updateParams(I, g) {
    if (this.#G) {
      switch (I) {
        case j.CREATE:
          this.currentLayer.addNewEditor(g);
          return;
        case j.HIGHLIGHT_SHOW_ALL:
          this._eventBus.dispatch("reporttelemetry", {
            source: this,
            details: {
              type: "editing",
              data: {
                type: "highlight",
                action: "toggle_visibility"
              }
            }
          }), (this.#P ||= /* @__PURE__ */ new Map()).set(I, g), this.showAllEditors("highlight", g);
          break;
      }
      if (this.hasSelection)
        for (const C of this.#V)
          C.updateParams(I, g);
      else
        for (const C of this.#G)
          C.updateDefaultParams(I, g);
    }
  }
  showAllEditors(I, g, C = !1) {
    for (const i of this.#C.values())
      i.editorType === I && i.show(g);
    (this.#P?.get(j.HIGHLIGHT_SHOW_ALL) ?? !0) !== g && this.#U([[j.HIGHLIGHT_SHOW_ALL, g]]);
  }
  enableWaiting(I = !1) {
    if (this.#p !== I) {
      this.#p = I;
      for (const g of this.#i.values())
        I ? g.disableClick() : g.enableClick(), g.div.classList.toggle("waiting", I);
    }
  }
  async #mI() {
    if (!this.#y) {
      this.#y = !0;
      const I = [];
      for (const g of this.#i.values())
        I.push(g.enable());
      await Promise.all(I);
      for (const g of this.#C.values())
        g.enable();
    }
  }
  #aI() {
    if (this.unselectAll(), this.#y) {
      this.#y = !1;
      for (const I of this.#i.values())
        I.disable();
      for (const I of this.#C.values())
        I.disable();
    }
  }
  *getEditors(I) {
    for (const g of this.#C.values())
      g.pageIndex === I && (yield g);
  }
  getEditor(I) {
    return this.#C.get(I);
  }
  addEditor(I) {
    this.#C.set(I.id, I);
  }
  removeEditor(I) {
    I.div.contains(document.activeElement) && (this.#w && clearTimeout(this.#w), this.#w = setTimeout(() => {
      this.focusMainContainer(), this.#w = null;
    }, 0)), this.#C.delete(I.id), I.annotationElementId && this.#z?.delete(I.annotationElementId), this.unselect(I), (!I.annotationElementId || !this.#t.has(I.annotationElementId)) && this.#s?.remove(I.id);
  }
  addDeletedAnnotationElement(I) {
    this.#t.add(I.annotationElementId), this.addChangedExistingAnnotation(I), I.deleted = !0;
  }
  isDeletedAnnotationElement(I) {
    return this.#t.has(I);
  }
  removeDeletedAnnotationElement(I) {
    this.#t.delete(I.annotationElementId), this.removeChangedExistingAnnotation(I), I.deleted = !1;
  }
  #iI(I) {
    const g = this.#i.get(I.pageIndex);
    g ? g.addOrRebuild(I) : (this.addEditor(I), this.addToAnnotationStorage(I));
  }
  setActiveEditor(I) {
    this.#g !== I && (this.#g = I, I && this.#U(I.propertiesToUpdate));
  }
  get #eI() {
    let I = null;
    for (I of this.#V)
      ;
    return I;
  }
  updateUI(I) {
    this.#eI === I && this.#U(I.propertiesToUpdate);
  }
  updateUIForDefaultProperties(I) {
    this.#U(I.defaultPropertiesToUpdate);
  }
  toggleSelected(I) {
    if (this.#V.has(I)) {
      this.#V.delete(I), I.unselect(), this.#L({
        hasSelectedEditor: this.hasSelection
      });
      return;
    }
    this.#V.add(I), I.select(), this.#U(I.propertiesToUpdate), this.#L({
      hasSelectedEditor: !0
    });
  }
  setSelected(I) {
    this.updateToolbar({
      mode: I.mode,
      editId: I.id
    }), this.#b?.commitOrRemove();
    for (const g of this.#V)
      g !== I && g.unselect();
    this.#V.clear(), this.#V.add(I), I.select(), this.#U(I.propertiesToUpdate), this.#L({
      hasSelectedEditor: !0
    });
  }
  isSelected(I) {
    return this.#V.has(I);
  }
  get firstSelectedEditor() {
    return this.#V.values().next().value;
  }
  unselect(I) {
    I.unselect(), this.#V.delete(I), this.#L({
      hasSelectedEditor: this.hasSelection
    });
  }
  get hasSelection() {
    return this.#V.size !== 0;
  }
  get isEnterHandled() {
    return this.#V.size === 1 && this.firstSelectedEditor.isEnterHandled;
  }
  undo() {
    this.#c.undo(), this.#L({
      hasSomethingToUndo: this.#c.hasSomethingToUndo(),
      hasSomethingToRedo: !0,
      isEmpty: this.#II()
    }), this._editorUndoBar?.hide();
  }
  redo() {
    this.#c.redo(), this.#L({
      hasSomethingToUndo: !0,
      hasSomethingToRedo: this.#c.hasSomethingToRedo(),
      isEmpty: this.#II()
    });
  }
  addCommands(I) {
    this.#c.add(I), this.#L({
      hasSomethingToUndo: !0,
      hasSomethingToRedo: !1,
      isEmpty: this.#II()
    });
  }
  cleanUndoStack(I) {
    this.#c.cleanType(I);
  }
  #II() {
    if (this.#C.size === 0)
      return !0;
    if (this.#C.size === 1)
      for (const I of this.#C.values())
        return I.isEmpty();
    return !1;
  }
  delete() {
    this.commitOrRemove();
    const I = this.currentLayer?.endDrawingSession(!0);
    if (!this.hasSelection && !I)
      return;
    const g = I ? [I] : [...this.#V], C = () => {
      this._editorUndoBar?.show(A, g.length === 1 ? g[0].editorType : g.length);
      for (const i of g)
        i.remove();
    }, A = () => {
      for (const i of g)
        this.#iI(i);
    };
    this.addCommands({
      cmd: C,
      undo: A,
      mustExec: !0
    });
  }
  commitOrRemove() {
    this.#g?.commitOrRemove();
  }
  hasSomethingToControl() {
    return this.#g || this.hasSelection;
  }
  #lI(I) {
    for (const g of this.#V)
      g.unselect();
    this.#V.clear();
    for (const g of I)
      g.isEmpty() || (this.#V.add(g), g.select());
    this.#L({
      hasSelectedEditor: this.hasSelection
    });
  }
  selectAll() {
    for (const I of this.#V)
      I.commit();
    this.#lI(this.#C.values());
  }
  unselectAll() {
    if (!(this.#g && (this.#g.commitOrRemove(), this.#H !== k.NONE)) && !this.#b?.commitOrRemove() && this.hasSelection) {
      for (const I of this.#V)
        I.unselect();
      this.#V.clear(), this.#L({
        hasSelectedEditor: !1
      });
    }
  }
  translateSelectedEditors(I, g, C = !1) {
    if (C || this.commitOrRemove(), !this.hasSelection)
      return;
    this.#Q[0] += I, this.#Q[1] += g;
    const [A, i] = this.#Q, l = [...this.#V], s = 1e3;
    this.#J && clearTimeout(this.#J), this.#J = setTimeout(() => {
      this.#J = null, this.#Q[0] = this.#Q[1] = 0, this.addCommands({
        cmd: () => {
          for (const d of l)
            this.#C.has(d.id) && (d.translateInPage(A, i), d.translationDone());
        },
        undo: () => {
          for (const d of l)
            this.#C.has(d.id) && (d.translateInPage(-A, -i), d.translationDone());
        },
        mustExec: !1
      });
    }, s);
    for (const d of l)
      d.translateInPage(I, g), d.translationDone();
  }
  setUpDragSession() {
    if (this.hasSelection) {
      this.disableUserSelect(!0), this.#a = /* @__PURE__ */ new Map();
      for (const I of this.#V)
        this.#a.set(I, {
          savedX: I.x,
          savedY: I.y,
          savedPageIndex: I.pageIndex,
          newX: 0,
          newY: 0,
          newPageIndex: -1
        });
    }
  }
  endDragSession() {
    if (!this.#a)
      return !1;
    this.disableUserSelect(!1);
    const I = this.#a;
    this.#a = null;
    let g = !1;
    for (const [{
      x: A,
      y: i,
      pageIndex: l
    }, s] of I)
      s.newX = A, s.newY = i, s.newPageIndex = l, g ||= A !== s.savedX || i !== s.savedY || l !== s.savedPageIndex;
    if (!g)
      return !1;
    const C = (A, i, l, s) => {
      if (this.#C.has(A.id)) {
        const d = this.#i.get(s);
        d ? A._setParentAndPosition(d, i, l) : (A.pageIndex = s, A.x = i, A.y = l);
      }
    };
    return this.addCommands({
      cmd: () => {
        for (const [A, {
          newX: i,
          newY: l,
          newPageIndex: s
        }] of I)
          C(A, i, l, s);
      },
      undo: () => {
        for (const [A, {
          savedX: i,
          savedY: l,
          savedPageIndex: s
        }] of I)
          C(A, i, l, s);
      },
      mustExec: !0
    }), !0;
  }
  dragSelectedEditors(I, g) {
    if (this.#a)
      for (const C of this.#a.keys())
        C.drag(I, g);
  }
  rebuild(I) {
    if (I.parent === null) {
      const g = this.getLayer(I.pageIndex);
      g ? (g.changeParent(I), g.addOrRebuild(I)) : (this.addEditor(I), this.addToAnnotationStorage(I), I.rebuild());
    } else
      I.parent.addOrRebuild(I);
  }
  get isEditorHandlingKeyboard() {
    return this.getActive()?.shouldGetKeyboardEvents() || this.#V.size === 1 && this.firstSelectedEditor.shouldGetKeyboardEvents();
  }
  isActive(I) {
    return this.#g === I;
  }
  getActive() {
    return this.#g;
  }
  getMode() {
    return this.#H;
  }
  isEditingMode() {
    return this.#H !== k.NONE;
  }
  get imageManager() {
    return T(this, "imageManager", new MA());
  }
  getSelectionBoxes(I) {
    if (!I)
      return null;
    const g = document.getSelection();
    for (let c = 0, G = g.rangeCount; c < G; c++)
      if (!I.contains(g.getRangeAt(c).commonAncestorContainer))
        return null;
    const {
      x: C,
      y: A,
      width: i,
      height: l
    } = I.getBoundingClientRect();
    let s;
    switch (I.getAttribute("data-main-rotation")) {
      case "90":
        s = (c, G, b, o) => ({
          x: (G - A) / l,
          y: 1 - (c + b - C) / i,
          width: o / l,
          height: b / i
        });
        break;
      case "180":
        s = (c, G, b, o) => ({
          x: 1 - (c + b - C) / i,
          y: 1 - (G + o - A) / l,
          width: b / i,
          height: o / l
        });
        break;
      case "270":
        s = (c, G, b, o) => ({
          x: 1 - (G + o - A) / l,
          y: (c - C) / i,
          width: o / l,
          height: b / i
        });
        break;
      default:
        s = (c, G, b, o) => ({
          x: (c - C) / i,
          y: (G - A) / l,
          width: b / i,
          height: o / l
        });
        break;
    }
    const d = [];
    for (let c = 0, G = g.rangeCount; c < G; c++) {
      const b = g.getRangeAt(c);
      if (!b.collapsed)
        for (const {
          x: o,
          y: m,
          width: e,
          height: a
        } of b.getClientRects())
          e === 0 || a === 0 || d.push(s(o, m, e, a));
    }
    return d.length === 0 ? null : d;
  }
  addChangedExistingAnnotation({
    annotationElementId: I,
    id: g
  }) {
    (this.#d ||= /* @__PURE__ */ new Map()).set(I, g);
  }
  removeChangedExistingAnnotation({
    annotationElementId: I
  }) {
    this.#d?.delete(I);
  }
  renderAnnotationElement(I) {
    const g = this.#d?.get(I.data.id);
    if (!g)
      return;
    const C = this.#s.getRawValue(g);
    C && (this.#H === k.NONE && !C.hasBeenModified || C.renderAnnotationElement(I));
  }
  setMissingCanvas(I, g, C) {
    const A = this.#z?.get(I);
    A && (A.setCanvas(g, C), this.#z.delete(I));
  }
  addMissingCanvas(I, g) {
    (this.#z ||= /* @__PURE__ */ new Map()).set(I, g);
  }
};
class zI {
  #I = null;
  #g = !1;
  #A = null;
  #C = null;
  #i = null;
  #l = null;
  #s = !1;
  #d = null;
  #c = null;
  #Z = null;
  #o = null;
  #b = !1;
  static #m = null;
  static _l10n = null;
  constructor(I) {
    this.#c = I, this.#b = I._uiManager.useNewAltTextFlow, zI.#m ||= Object.freeze({
      added: "pdfjs-editor-new-alt-text-added-button",
      "added-label": "pdfjs-editor-new-alt-text-added-button-label",
      missing: "pdfjs-editor-new-alt-text-missing-button",
      "missing-label": "pdfjs-editor-new-alt-text-missing-button-label",
      review: "pdfjs-editor-new-alt-text-to-review-button",
      "review-label": "pdfjs-editor-new-alt-text-to-review-button-label"
    });
  }
  static initialize(I) {
    zI._l10n ??= I;
  }
  async render() {
    const I = this.#A = document.createElement("button");
    I.className = "altText", I.tabIndex = "0";
    const g = this.#C = document.createElement("span");
    I.append(g), this.#b ? (I.classList.add("new"), I.setAttribute("data-l10n-id", zI.#m.missing), g.setAttribute("data-l10n-id", zI.#m["missing-label"])) : (I.setAttribute("data-l10n-id", "pdfjs-editor-alt-text-button"), g.setAttribute("data-l10n-id", "pdfjs-editor-alt-text-button-label"));
    const C = this.#c._uiManager._signal;
    I.addEventListener("contextmenu", RI, {
      signal: C
    }), I.addEventListener("pointerdown", (i) => i.stopPropagation(), {
      signal: C
    });
    const A = (i) => {
      i.preventDefault(), this.#c._uiManager.editAltText(this.#c), this.#b && this.#c._reportTelemetry({
        action: "pdfjs.image.alt_text.image_status_label_clicked",
        data: {
          label: this.#t
        }
      });
    };
    return I.addEventListener("click", A, {
      capture: !0,
      signal: C
    }), I.addEventListener("keydown", (i) => {
      i.target === I && i.key === "Enter" && (this.#s = !0, A(i));
    }, {
      signal: C
    }), await this.#a(), I;
  }
  get #t() {
    return this.#I && "added" || this.#I === null && this.guessedText && "review" || "missing";
  }
  finish() {
    this.#A && (this.#A.focus({
      focusVisible: this.#s
    }), this.#s = !1);
  }
  isEmpty() {
    return this.#b ? this.#I === null : !this.#I && !this.#g;
  }
  hasData() {
    return this.#b ? this.#I !== null || !!this.#Z : this.isEmpty();
  }
  get guessedText() {
    return this.#Z;
  }
  async setGuessedText(I) {
    this.#I === null && (this.#Z = I, this.#o = await zI._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer", {
      generatedAltText: I
    }), this.#a());
  }
  toggleAltTextBadge(I = !1) {
    if (!this.#b || this.#I) {
      this.#d?.remove(), this.#d = null;
      return;
    }
    if (!this.#d) {
      const g = this.#d = document.createElement("div");
      g.className = "noAltTextBadge", this.#c.div.append(g);
    }
    this.#d.classList.toggle("hidden", !I);
  }
  serialize(I) {
    let g = this.#I;
    return !I && this.#Z === g && (g = this.#o), {
      altText: g,
      decorative: this.#g,
      guessedText: this.#Z,
      textWithDisclaimer: this.#o
    };
  }
  get data() {
    return {
      altText: this.#I,
      decorative: this.#g
    };
  }
  set data({
    altText: I,
    decorative: g,
    guessedText: C,
    textWithDisclaimer: A,
    cancel: i = !1
  }) {
    C && (this.#Z = C, this.#o = A), !(this.#I === I && this.#g === g) && (i || (this.#I = I, this.#g = g), this.#a());
  }
  toggle(I = !1) {
    this.#A && (!I && this.#l && (clearTimeout(this.#l), this.#l = null), this.#A.disabled = !I);
  }
  shown() {
    this.#c._reportTelemetry({
      action: "pdfjs.image.alt_text.image_status_label_displayed",
      data: {
        label: this.#t
      }
    });
  }
  destroy() {
    this.#A?.remove(), this.#A = null, this.#C = null, this.#i = null, this.#d?.remove(), this.#d = null;
  }
  async #a() {
    const I = this.#A;
    if (!I)
      return;
    if (this.#b) {
      if (I.classList.toggle("done", !!this.#I), I.setAttribute("data-l10n-id", zI.#m[this.#t]), this.#C?.setAttribute("data-l10n-id", zI.#m[`${this.#t}-label`]), !this.#I) {
        this.#i?.remove();
        return;
      }
    } else {
      if (!this.#I && !this.#g) {
        I.classList.remove("done"), this.#i?.remove();
        return;
      }
      I.classList.add("done"), I.setAttribute("data-l10n-id", "pdfjs-editor-alt-text-edit-button");
    }
    let g = this.#i;
    if (!g) {
      this.#i = g = document.createElement("span"), g.className = "tooltip", g.setAttribute("role", "tooltip"), g.id = `alt-text-tooltip-${this.#c.id}`;
      const A = 100, i = this.#c._uiManager._signal;
      i.addEventListener("abort", () => {
        clearTimeout(this.#l), this.#l = null;
      }, {
        once: !0
      }), I.addEventListener("mouseenter", () => {
        this.#l = setTimeout(() => {
          this.#l = null, this.#i.classList.add("show"), this.#c._reportTelemetry({
            action: "alt_text_tooltip"
          });
        }, A);
      }, {
        signal: i
      }), I.addEventListener("mouseleave", () => {
        this.#l && (clearTimeout(this.#l), this.#l = null), this.#i?.classList.remove("show");
      }, {
        signal: i
      });
    }
    this.#g ? g.setAttribute("data-l10n-id", "pdfjs-editor-alt-text-decorative-tooltip") : (g.removeAttribute("data-l10n-id"), g.textContent = this.#I), g.parentNode || I.append(g), this.#c.getElementForAltText()?.setAttribute("aria-describedby", g.id);
  }
}
class sC {
  #I = null;
  #g = null;
  #A = !1;
  #C = null;
  #i = null;
  #l = null;
  #s = null;
  #d = null;
  #c = !1;
  #Z = null;
  constructor(I) {
    this.#C = I;
  }
  renderForToolbar() {
    const I = this.#g = document.createElement("button");
    return I.className = "comment", this.#o(I, !1);
  }
  renderForStandalone() {
    const I = this.#I = document.createElement("button");
    I.className = "annotationCommentButton";
    const g = this.#C.commentButtonPosition;
    if (g) {
      const {
        style: C
      } = I;
      C.insetInlineEnd = `calc(${100 * (this.#C._uiManager.direction === "ltr" ? 1 - g[0] : g[0])}% - var(--comment-button-dim))`, C.top = `calc(${100 * g[1]}% - var(--comment-button-dim))`;
      const A = this.#C.commentButtonColor;
      A && (C.backgroundColor = A);
    }
    return this.#o(I, !0);
  }
  focusButton() {
    setTimeout(() => {
      (this.#I ?? this.#g)?.focus();
    }, 0);
  }
  onUpdatedColor() {
    if (!this.#I)
      return;
    const I = this.#C.commentButtonColor;
    I && (this.#I.style.backgroundColor = I), this.#C._uiManager.updatePopupColor(this.#C);
  }
  get commentButtonWidth() {
    return (this.#I?.getBoundingClientRect().width ?? 0) / this.#C.parent.boundingClientRect.width;
  }
  get commentPopupPositionInLayer() {
    if (this.#Z)
      return this.#Z;
    if (!this.#I)
      return null;
    const {
      x: I,
      y: g,
      height: C
    } = this.#I.getBoundingClientRect(), {
      x: A,
      y: i,
      width: l,
      height: s
    } = this.#C.parent.boundingClientRect;
    return [(I - A) / l, (g + C - i) / s];
  }
  set commentPopupPositionInLayer(I) {
    this.#Z = I;
  }
  hasDefaultPopupPosition() {
    return this.#Z === null;
  }
  removeStandaloneCommentButton() {
    this.#I?.remove(), this.#I = null;
  }
  removeToolbarCommentButton() {
    this.#g?.remove(), this.#g = null;
  }
  setCommentButtonStates({
    selected: I,
    hasPopup: g
  }) {
    this.#I && (this.#I.classList.toggle("selected", I), this.#I.ariaExpanded = g);
  }
  #o(I, g) {
    if (!this.#C._uiManager.hasCommentManager())
      return null;
    I.tabIndex = "0", I.ariaHasPopup = "dialog", g ? (I.ariaControls = "commentPopup", I.setAttribute("data-l10n-id", "pdfjs-show-comment-button")) : (I.ariaControlsElements = [this.#C._uiManager.getCommentDialogElement()], I.setAttribute("data-l10n-id", "pdfjs-editor-edit-comment-button"));
    const C = this.#C._uiManager._signal;
    if (!(C instanceof AbortSignal) || C.aborted)
      return I;
    I.addEventListener("contextmenu", RI, {
      signal: C
    }), g && (I.addEventListener("focusin", (i) => {
      this.#C._focusEventsAllowed = !1, II(i);
    }, {
      capture: !0,
      signal: C
    }), I.addEventListener("focusout", (i) => {
      this.#C._focusEventsAllowed = !0, II(i);
    }, {
      capture: !0,
      signal: C
    })), I.addEventListener("pointerdown", (i) => i.stopPropagation(), {
      signal: C
    });
    const A = (i) => {
      i.preventDefault(), I === this.#g ? this.edit() : this.#C.toggleComment(!0);
    };
    return I.addEventListener("click", A, {
      capture: !0,
      signal: C
    }), I.addEventListener("keydown", (i) => {
      i.target === I && i.key === "Enter" && (this.#A = !0, A(i));
    }, {
      signal: C
    }), I.addEventListener("pointerenter", () => {
      this.#C.toggleComment(!1, !0);
    }, {
      signal: C
    }), I.addEventListener("pointerleave", () => {
      this.#C.toggleComment(!1, !1);
    }, {
      signal: C
    }), I;
  }
  edit(I) {
    const g = this.commentPopupPositionInLayer;
    let C, A;
    if (g)
      [C, A] = g;
    else {
      [C, A] = this.#C.commentButtonPosition;
      const {
        width: G,
        height: b,
        x: o,
        y: m
      } = this.#C;
      C = o + C * G, A = m + A * b;
    }
    const i = this.#C.parent.boundingClientRect, {
      x: l,
      y: s,
      width: d,
      height: c
    } = i;
    this.#C._uiManager.editComment(this.#C, l + C * d, s + A * c, {
      ...I,
      parentDimensions: i
    });
  }
  finish() {
    this.#g && (this.#g.focus({
      focusVisible: this.#A
    }), this.#A = !1);
  }
  isDeleted() {
    return this.#c || this.#s === "";
  }
  isEmpty() {
    return this.#s === null;
  }
  hasBeenEdited() {
    return this.isDeleted() || this.#s !== this.#i;
  }
  serialize() {
    return this.data;
  }
  get data() {
    return {
      text: this.#s,
      richText: this.#l,
      date: this.#d,
      deleted: this.isDeleted()
    };
  }
  set data(I) {
    if (I !== this.#s && (this.#l = null), I === null) {
      this.#s = "", this.#c = !0;
      return;
    }
    this.#s = I, this.#d = /* @__PURE__ */ new Date(), this.#c = !1;
  }
  setInitialText(I, g = null) {
    this.#i = I, this.data = I, this.#d = null, this.#l = g;
  }
  shown() {
  }
  destroy() {
    this.#g?.remove(), this.#g = null, this.#I?.remove(), this.#I = null, this.#s = "", this.#l = null, this.#d = null, this.#C = null, this.#A = !1, this.#c = !1;
  }
}
let cl = class Gl {
  #I;
  #g = !1;
  #A = null;
  #C;
  #i;
  #l;
  #s;
  #d = null;
  #c;
  #Z = null;
  #o;
  #b = null;
  constructor({
    container: I,
    isPinchingDisabled: g = null,
    isPinchingStopped: C = null,
    onPinchStart: A = null,
    onPinching: i = null,
    onPinchEnd: l = null,
    signal: s
  }) {
    this.#I = I, this.#A = C, this.#C = g, this.#i = A, this.#l = i, this.#s = l, this.#o = new AbortController(), this.#c = AbortSignal.any([s, this.#o.signal]), I.addEventListener("touchstart", this.#m.bind(this), {
      passive: !1,
      signal: this.#c
    });
  }
  get MIN_TOUCH_DISTANCE_TO_PINCH() {
    return 35 / Gg.pixelRatio;
  }
  #m(I) {
    if (this.#C?.())
      return;
    if (I.touches.length === 1) {
      if (this.#d)
        return;
      const A = this.#d = new AbortController(), i = AbortSignal.any([this.#c, A.signal]), l = this.#I, s = {
        capture: !0,
        signal: i,
        passive: !1
      }, d = (c) => {
        c.pointerType === "touch" && (this.#d?.abort(), this.#d = null);
      };
      l.addEventListener("pointerdown", (c) => {
        c.pointerType === "touch" && (II(c), d(c));
      }, s), l.addEventListener("pointerup", d, s), l.addEventListener("pointercancel", d, s);
      return;
    }
    if (!this.#b) {
      this.#b = new AbortController();
      const A = AbortSignal.any([this.#c, this.#b.signal]), i = this.#I, l = {
        signal: A,
        capture: !1,
        passive: !1
      };
      i.addEventListener("touchmove", this.#t.bind(this), l);
      const s = this.#a.bind(this);
      i.addEventListener("touchend", s, l), i.addEventListener("touchcancel", s, l), l.capture = !0, i.addEventListener("pointerdown", II, l), i.addEventListener("pointermove", II, l), i.addEventListener("pointercancel", II, l), i.addEventListener("pointerup", II, l), this.#i?.();
    }
    if (II(I), I.touches.length !== 2 || this.#A?.()) {
      this.#Z = null;
      return;
    }
    let [g, C] = I.touches;
    g.identifier > C.identifier && ([g, C] = [C, g]), this.#Z = {
      touch0X: g.screenX,
      touch0Y: g.screenY,
      touch1X: C.screenX,
      touch1Y: C.screenY
    };
  }
  #t(I) {
    if (!this.#Z || I.touches.length !== 2)
      return;
    II(I);
    let [g, C] = I.touches;
    g.identifier > C.identifier && ([g, C] = [C, g]);
    const {
      screenX: A,
      screenY: i
    } = g, {
      screenX: l,
      screenY: s
    } = C, d = this.#Z, {
      touch0X: c,
      touch0Y: G,
      touch1X: b,
      touch1Y: o
    } = d, m = b - c, e = o - G, a = l - A, h = s - i, t = Math.hypot(a, h) || 1, W = Math.hypot(m, e) || 1;
    if (!this.#g && Math.abs(W - t) <= Gl.MIN_TOUCH_DISTANCE_TO_PINCH)
      return;
    if (d.touch0X = A, d.touch0Y = i, d.touch1X = l, d.touch1Y = s, !this.#g) {
      this.#g = !0;
      return;
    }
    const B = [(A + l) / 2, (i + s) / 2];
    this.#l?.(B, W, t);
  }
  #a(I) {
    I.touches.length >= 2 || (this.#b && (this.#b.abort(), this.#b = null, this.#s?.()), this.#Z && (II(I), this.#Z = null, this.#g = !1));
  }
  destroy() {
    this.#o?.abort(), this.#o = null, this.#d?.abort(), this.#d = null;
  }
};
class F {
  #I = null;
  #g = null;
  #A = null;
  #C = null;
  #i = null;
  #l = !1;
  #s = null;
  #d = "";
  #c = null;
  #Z = null;
  #o = null;
  #b = null;
  #m = null;
  #t = "";
  #a = !1;
  #G = null;
  #e = !1;
  #B = !1;
  #W = !1;
  #h = null;
  #N = 0;
  #w = 0;
  #n = null;
  #R = null;
  isSelected = !1;
  _isCopy = !1;
  _editToolbar = null;
  _initialOptions = /* @__PURE__ */ Object.create(null);
  _initialData = null;
  _isVisible = !0;
  _uiManager = null;
  _focusEventsAllowed = !0;
  static _l10n = null;
  static _l10nResizer = null;
  #Y = !1;
  #u = F._zIndex++;
  static _borderLineWidth = -1;
  static _colorManager = new DA();
  static _zIndex = 1;
  static _telemetryTimeout = 1e3;
  static get _resizerKeyboardManager() {
    const I = F.prototype._resizeWithKeyboard, g = Eg.TRANSLATE_SMALL, C = Eg.TRANSLATE_BIG;
    return T(this, "_resizerKeyboardManager", new CC([[["ArrowLeft", "mac+ArrowLeft"], I, {
      args: [-g, 0]
    }], [["ctrl+ArrowLeft", "mac+shift+ArrowLeft"], I, {
      args: [-C, 0]
    }], [["ArrowRight", "mac+ArrowRight"], I, {
      args: [g, 0]
    }], [["ctrl+ArrowRight", "mac+shift+ArrowRight"], I, {
      args: [C, 0]
    }], [["ArrowUp", "mac+ArrowUp"], I, {
      args: [0, -g]
    }], [["ctrl+ArrowUp", "mac+shift+ArrowUp"], I, {
      args: [0, -C]
    }], [["ArrowDown", "mac+ArrowDown"], I, {
      args: [0, g]
    }], [["ctrl+ArrowDown", "mac+shift+ArrowDown"], I, {
      args: [0, C]
    }], [["Escape", "mac+Escape"], F.prototype._stopResizingWithKeyboard]]));
  }
  constructor(I) {
    this.parent = I.parent, this.id = I.id, this.width = this.height = null, this.pageIndex = I.parent.pageIndex, this.name = I.name, this.div = null, this._uiManager = I.uiManager, this.annotationElementId = null, this._willKeepAspectRatio = !1, this._initialOptions.isCentered = I.isCentered, this._structTreeParentId = null, this.annotationElementId = I.annotationElementId || null, this.creationDate = I.creationDate || /* @__PURE__ */ new Date(), this.modificationDate = I.modificationDate || null;
    const {
      rotation: g,
      rawDims: {
        pageWidth: C,
        pageHeight: A,
        pageX: i,
        pageY: l
      }
    } = this.parent.viewport;
    this.rotation = g, this.pageRotation = (360 + g - this._uiManager.viewParameters.rotation) % 360, this.pageDimensions = [C, A], this.pageTranslation = [i, l];
    const [s, d] = this.parentDimensions;
    this.x = I.x / s, this.y = I.y / d, this.isAttachedToDOM = !1, this.deleted = !1;
  }
  get editorType() {
    return Object.getPrototypeOf(this).constructor._type;
  }
  get mode() {
    return Object.getPrototypeOf(this).constructor._editorType;
  }
  static get isDrawer() {
    return !1;
  }
  static get _defaultLineColor() {
    return T(this, "_defaultLineColor", this._colorManager.getHexCode("CanvasText"));
  }
  static deleteAnnotationElement(I) {
    const g = new Ks({
      id: I.parent.getNextId(),
      parent: I.parent,
      uiManager: I._uiManager
    });
    g.annotationElementId = I.annotationElementId, g.deleted = !0, g._uiManager.addToAnnotationStorage(g);
  }
  static initialize(I, g) {
    if (F._l10n ??= I, F._l10nResizer ||= Object.freeze({
      topLeft: "pdfjs-editor-resizer-top-left",
      topMiddle: "pdfjs-editor-resizer-top-middle",
      topRight: "pdfjs-editor-resizer-top-right",
      middleRight: "pdfjs-editor-resizer-middle-right",
      bottomRight: "pdfjs-editor-resizer-bottom-right",
      bottomMiddle: "pdfjs-editor-resizer-bottom-middle",
      bottomLeft: "pdfjs-editor-resizer-bottom-left",
      middleLeft: "pdfjs-editor-resizer-middle-left"
    }), F._borderLineWidth !== -1)
      return;
    const C = getComputedStyle(document.documentElement);
    F._borderLineWidth = parseFloat(C.getPropertyValue("--outline-width")) || 0;
  }
  static updateDefaultParams(I, g) {
  }
  static get defaultPropertiesToUpdate() {
    return [];
  }
  static isHandlingMimeForPasting(I) {
    return !1;
  }
  static paste(I, g) {
    f("Not implemented");
  }
  get propertiesToUpdate() {
    return [];
  }
  get _isDraggable() {
    return this.#Y;
  }
  set _isDraggable(I) {
    this.#Y = I, this.div?.classList.toggle("draggable", I);
  }
  get uid() {
    return this.annotationElementId || this.id;
  }
  get isEnterHandled() {
    return !0;
  }
  center() {
    const [I, g] = this.pageDimensions;
    switch (this.parentRotation) {
      case 90:
        this.x -= this.height * g / (I * 2), this.y += this.width * I / (g * 2);
        break;
      case 180:
        this.x += this.width / 2, this.y += this.height / 2;
        break;
      case 270:
        this.x += this.height * g / (I * 2), this.y -= this.width * I / (g * 2);
        break;
      default:
        this.x -= this.width / 2, this.y -= this.height / 2;
        break;
    }
    this.fixAndSetPosition();
  }
  addCommands(I) {
    this._uiManager.addCommands(I);
  }
  get currentLayer() {
    return this._uiManager.currentLayer;
  }
  setInBackground() {
    this.div.style.zIndex = 0;
  }
  setInForeground() {
    this.div.style.zIndex = this.#u;
  }
  setParent(I) {
    I !== null ? (this.pageIndex = I.pageIndex, this.pageDimensions = I.pageDimensions) : (this.#J(), this.#b?.remove(), this.#b = null), this.parent = I;
  }
  focusin(I) {
    this._focusEventsAllowed && (this.#a ? this.#a = !1 : this.parent.setSelected(this));
  }
  focusout(I) {
    !this._focusEventsAllowed || !this.isAttachedToDOM || I.relatedTarget?.closest(`#${this.id}`) || (I.preventDefault(), this.parent?.isMultipleSelection || this.commitOrRemove());
  }
  commitOrRemove() {
    this.isEmpty() ? this.remove() : this.commit();
  }
  commit() {
    this.isInEditMode() && this.addToAnnotationStorage();
  }
  addToAnnotationStorage() {
    this._uiManager.addToAnnotationStorage(this);
  }
  setAt(I, g, C, A) {
    const [i, l] = this.parentDimensions;
    [C, A] = this.screenToPageTranslation(C, A), this.x = (I + C) / i, this.y = (g + A) / l, this.fixAndSetPosition();
  }
  _moveAfterPaste(I, g) {
    const [C, A] = this.parentDimensions;
    this.setAt(I * C, g * A, this.width * C, this.height * A), this._onTranslated();
  }
  #M([I, g], C, A) {
    [C, A] = this.screenToPageTranslation(C, A), this.x += C / I, this.y += A / g, this._onTranslating(this.x, this.y), this.fixAndSetPosition();
  }
  translate(I, g) {
    this.#M(this.parentDimensions, I, g);
  }
  translateInPage(I, g) {
    this.#G ||= [this.x, this.y, this.width, this.height], this.#M(this.pageDimensions, I, g), this.div.scrollIntoView({
      block: "nearest"
    });
  }
  translationDone() {
    this._onTranslated(this.x, this.y);
  }
  drag(I, g) {
    this.#G ||= [this.x, this.y, this.width, this.height];
    const {
      div: C,
      parentDimensions: [A, i]
    } = this;
    if (this.x += I / A, this.y += g / i, this.parent && (this.x < 0 || this.x > 1 || this.y < 0 || this.y > 1)) {
      const {
        x: b,
        y: o
      } = this.div.getBoundingClientRect();
      this.parent.findNewParent(this, b, o) && (this.x -= Math.floor(this.x), this.y -= Math.floor(this.y));
    }
    let {
      x: l,
      y: s
    } = this;
    const [d, c] = this.getBaseTranslation();
    l += d, s += c;
    const {
      style: G
    } = C;
    G.left = `${(100 * l).toFixed(2)}%`, G.top = `${(100 * s).toFixed(2)}%`, this._onTranslating(l, s), C.scrollIntoView({
      block: "nearest"
    });
  }
  _onTranslating(I, g) {
  }
  _onTranslated(I, g) {
  }
  get _hasBeenMoved() {
    return !!this.#G && (this.#G[0] !== this.x || this.#G[1] !== this.y);
  }
  get _hasBeenResized() {
    return !!this.#G && (this.#G[2] !== this.width || this.#G[3] !== this.height);
  }
  getBaseTranslation() {
    const [I, g] = this.parentDimensions, {
      _borderLineWidth: C
    } = F, A = C / I, i = C / g;
    switch (this.rotation) {
      case 90:
        return [-A, i];
      case 180:
        return [A, i];
      case 270:
        return [A, -i];
      default:
        return [-A, -i];
    }
  }
  get _mustFixPosition() {
    return !0;
  }
  fixAndSetPosition(I = this.rotation) {
    const {
      div: {
        style: g
      },
      pageDimensions: [C, A]
    } = this;
    let {
      x: i,
      y: l,
      width: s,
      height: d
    } = this;
    if (s *= C, d *= A, i *= C, l *= A, this._mustFixPosition)
      switch (I) {
        case 0:
          i = eI(i, 0, C - s), l = eI(l, 0, A - d);
          break;
        case 90:
          i = eI(i, 0, C - d), l = eI(l, s, A);
          break;
        case 180:
          i = eI(i, s, C), l = eI(l, d, A);
          break;
        case 270:
          i = eI(i, d, C), l = eI(l, 0, A - s);
          break;
      }
    this.x = i /= C, this.y = l /= A;
    const [c, G] = this.getBaseTranslation();
    i += c, l += G, g.left = `${(100 * i).toFixed(2)}%`, g.top = `${(100 * l).toFixed(2)}%`, this.moveInDOM();
  }
  static #y(I, g, C) {
    switch (C) {
      case 90:
        return [g, -I];
      case 180:
        return [-I, -g];
      case 270:
        return [-g, I];
      default:
        return [I, g];
    }
  }
  screenToPageTranslation(I, g) {
    return F.#y(I, g, this.parentRotation);
  }
  pageTranslationToScreen(I, g) {
    return F.#y(I, g, 360 - this.parentRotation);
  }
  #X(I) {
    switch (I) {
      case 90: {
        const [g, C] = this.pageDimensions;
        return [0, -g / C, C / g, 0];
      }
      case 180:
        return [-1, 0, 0, -1];
      case 270: {
        const [g, C] = this.pageDimensions;
        return [0, g / C, -C / g, 0];
      }
      default:
        return [1, 0, 0, 1];
    }
  }
  get parentScale() {
    return this._uiManager.viewParameters.realScale;
  }
  get parentRotation() {
    return (this._uiManager.viewParameters.rotation + this.pageRotation) % 360;
  }
  get parentDimensions() {
    const {
      parentScale: I,
      pageDimensions: [g, C]
    } = this;
    return [g * I, C * I];
  }
  setDims() {
    const {
      div: {
        style: I
      },
      width: g,
      height: C
    } = this;
    I.width = `${(100 * g).toFixed(2)}%`, I.height = `${(100 * C).toFixed(2)}%`;
  }
  getInitialTranslation() {
    return [0, 0];
  }
  #p() {
    if (this.#c)
      return;
    this.#c = document.createElement("div"), this.#c.classList.add("resizers");
    const I = this._willKeepAspectRatio ? ["topLeft", "topRight", "bottomRight", "bottomLeft"] : ["topLeft", "topMiddle", "topRight", "middleRight", "bottomRight", "bottomMiddle", "bottomLeft", "middleLeft"], g = this._uiManager._signal;
    for (const C of I) {
      const A = document.createElement("div");
      this.#c.append(A), A.classList.add("resizer", C), A.setAttribute("data-resizer-name", C), A.addEventListener("pointerdown", this.#K.bind(this, C), {
        signal: g
      }), A.addEventListener("contextmenu", RI, {
        signal: g
      }), A.tabIndex = -1;
    }
    this.div.prepend(this.#c);
  }
  #K(I, g) {
    g.preventDefault();
    const {
      isMac: C
    } = GI.platform;
    if (g.button !== 0 || g.ctrlKey && C)
      return;
    this.#A?.toggle(!1);
    const A = this._isDraggable;
    this._isDraggable = !1, this.#Z = [g.screenX, g.screenY];
    const i = new AbortController(), l = this._uiManager.combinedSignal(i);
    this.parent.togglePointerEvents(!1), window.addEventListener("pointermove", this.#z.bind(this, I), {
      passive: !0,
      capture: !0,
      signal: l
    }), window.addEventListener("touchmove", II, {
      passive: !1,
      signal: l
    }), window.addEventListener("contextmenu", RI, {
      signal: l
    }), this.#o = {
      savedX: this.x,
      savedY: this.y,
      savedWidth: this.width,
      savedHeight: this.height
    };
    const s = this.parent.div.style.cursor, d = this.div.style.cursor;
    this.div.style.cursor = this.parent.div.style.cursor = window.getComputedStyle(g.target).cursor;
    const c = () => {
      i.abort(), this.parent.togglePointerEvents(!0), this.#A?.toggle(!0), this._isDraggable = A, this.parent.div.style.cursor = s, this.div.style.cursor = d, this.#F();
    };
    window.addEventListener("pointerup", c, {
      signal: l
    }), window.addEventListener("blur", c, {
      signal: l
    });
  }
  #S(I, g, C, A) {
    this.width = C, this.height = A, this.x = I, this.y = g, this.setDims(), this.fixAndSetPosition(), this._onResized();
  }
  _onResized() {
  }
  #F() {
    if (!this.#o)
      return;
    const {
      savedX: I,
      savedY: g,
      savedWidth: C,
      savedHeight: A
    } = this.#o;
    this.#o = null;
    const i = this.x, l = this.y, s = this.width, d = this.height;
    i === I && l === g && s === C && d === A || this.addCommands({
      cmd: this.#S.bind(this, i, l, s, d),
      undo: this.#S.bind(this, I, g, C, A),
      mustExec: !0
    });
  }
  static _round(I) {
    return Math.round(I * 1e4) / 1e4;
  }
  #z(I, g) {
    const [C, A] = this.parentDimensions, i = this.x, l = this.y, s = this.width, d = this.height, c = F.MIN_SIZE / C, G = F.MIN_SIZE / A, b = this.#X(this.rotation), o = (D, z) => [b[0] * D + b[2] * z, b[1] * D + b[3] * z], m = this.#X(360 - this.rotation), e = (D, z) => [m[0] * D + m[2] * z, m[1] * D + m[3] * z];
    let a, h, t = !1, W = !1;
    switch (I) {
      case "topLeft":
        t = !0, a = (D, z) => [0, 0], h = (D, z) => [D, z];
        break;
      case "topMiddle":
        a = (D, z) => [D / 2, 0], h = (D, z) => [D / 2, z];
        break;
      case "topRight":
        t = !0, a = (D, z) => [D, 0], h = (D, z) => [0, z];
        break;
      case "middleRight":
        W = !0, a = (D, z) => [D, z / 2], h = (D, z) => [0, z / 2];
        break;
      case "bottomRight":
        t = !0, a = (D, z) => [D, z], h = (D, z) => [0, 0];
        break;
      case "bottomMiddle":
        a = (D, z) => [D / 2, z], h = (D, z) => [D / 2, 0];
        break;
      case "bottomLeft":
        t = !0, a = (D, z) => [0, z], h = (D, z) => [D, 0];
        break;
      case "middleLeft":
        W = !0, a = (D, z) => [0, z / 2], h = (D, z) => [D, z / 2];
        break;
    }
    const B = a(s, d), w = h(s, d);
    let n = o(...w);
    const V = F._round(i + n[0]), N = F._round(l + n[1]);
    let R = 1, Y = 1, y, X;
    if (g.fromKeyboard)
      ({
        deltaX: y,
        deltaY: X
      } = g);
    else {
      const {
        screenX: D,
        screenY: z
      } = g, [U, mI] = this.#Z;
      [y, X] = this.screenToPageTranslation(D - U, z - mI), this.#Z[0] = D, this.#Z[1] = z;
    }
    if ([y, X] = e(y / C, X / A), t) {
      const D = Math.hypot(s, d);
      R = Y = Math.max(Math.min(Math.hypot(w[0] - B[0] - y, w[1] - B[1] - X) / D, 1 / s, 1 / d), c / s, G / d);
    } else W ? R = eI(Math.abs(w[0] - B[0] - y), c, 1) / s : Y = eI(Math.abs(w[1] - B[1] - X), G, 1) / d;
    const K = F._round(s * R), S = F._round(d * Y);
    n = o(...h(K, S));
    const p = V - n[0], r = N - n[1];
    this.#G ||= [this.x, this.y, this.width, this.height], this.width = K, this.height = S, this.x = p, this.y = r, this.setDims(), this.fixAndSetPosition(), this._onResizing();
  }
  _onResizing() {
  }
  altTextFinish() {
    this.#A?.finish();
  }
  get toolbarButtons() {
    return null;
  }
  async addEditToolbar() {
    if (this._editToolbar || this.#B)
      return this._editToolbar;
    this._editToolbar = new Tg(this), this.div.append(this._editToolbar.render());
    const {
      toolbarButtons: I
    } = this;
    if (I)
      for (const [g, C] of I)
        await this._editToolbar.addButton(g, C);
    return this.hasComment || this._editToolbar.addButton("comment", this.addCommentButton()), this._editToolbar.addButton("delete"), this._editToolbar;
  }
  addCommentButtonInToolbar() {
    this._editToolbar?.addButtonBefore("comment", this.addCommentButton(), ".deleteButton");
  }
  removeCommentButtonFromToolbar() {
    this._editToolbar?.removeButton("comment");
  }
  removeEditToolbar() {
    this._editToolbar?.remove(), this._editToolbar = null, this.#A?.destroy();
  }
  addContainer(I) {
    const g = this._editToolbar?.div;
    g ? g.before(I) : this.div.append(I);
  }
  getClientDimensions() {
    return this.div.getBoundingClientRect();
  }
  createAltText() {
    return this.#A || (zI.initialize(F._l10n), this.#A = new zI(this), this.#I && (this.#A.data = this.#I, this.#I = null)), this.#A;
  }
  get altTextData() {
    return this.#A?.data;
  }
  set altTextData(I) {
    this.#A && (this.#A.data = I);
  }
  get guessedAltText() {
    return this.#A?.guessedText;
  }
  async setGuessedAltText(I) {
    await this.#A?.setGuessedText(I);
  }
  serializeAltText(I) {
    return this.#A?.serialize(I);
  }
  hasAltText() {
    return !!this.#A && !this.#A.isEmpty();
  }
  hasAltTextData() {
    return this.#A?.hasData() ?? !1;
  }
  focusCommentButton() {
    this.#C?.focusButton();
  }
  addCommentButton() {
    return this.#C ||= new sC(this);
  }
  addStandaloneCommentButton() {
    if (this.#i) {
      this._uiManager.isEditingMode() && this.#i.classList.remove("hidden");
      return;
    }
    this.hasComment && (this.#i = this.#C.renderForStandalone(), this.div.append(this.#i));
  }
  removeStandaloneCommentButton() {
    this.#C.removeStandaloneCommentButton(), this.#i = null;
  }
  hideStandaloneCommentButton() {
    this.#i?.classList.add("hidden");
  }
  get comment() {
    const {
      data: {
        richText: I,
        text: g,
        date: C,
        deleted: A
      }
    } = this.#C;
    return {
      text: g,
      richText: I,
      date: C,
      deleted: A,
      color: this.getNonHCMColor(),
      opacity: this.opacity ?? 1
    };
  }
  set comment(I) {
    this.#C ||= new sC(this), this.#C.data = I, this.hasComment ? (this.removeCommentButtonFromToolbar(), this.addStandaloneCommentButton(), this._uiManager.updateComment(this)) : (this.addCommentButtonInToolbar(), this.removeStandaloneCommentButton(), this._uiManager.removeComment(this));
  }
  setCommentData({
    comment: I,
    popupRef: g,
    richText: C
  }) {
    if (!g || (this.#C ||= new sC(this), this.#C.setInitialText(I, C), !this.annotationElementId))
      return;
    const A = this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);
    A && this.updateFromAnnotationLayer(A);
  }
  get hasEditedComment() {
    return this.#C?.hasBeenEdited();
  }
  get hasDeletedComment() {
    return this.#C?.isDeleted();
  }
  get hasComment() {
    return !!this.#C && !this.#C.isEmpty() && !this.#C.isDeleted();
  }
  async editComment(I) {
    this.#C ||= new sC(this), this.#C.edit(I);
  }
  toggleComment(I, g = void 0) {
    this.hasComment && this._uiManager.toggleComment(this, I, g);
  }
  setSelectedCommentButton(I) {
    this.#C.setSelectedButton(I);
  }
  addComment(I) {
    if (this.hasEditedComment) {
      const [, , , A] = I.rect, [i] = this.pageDimensions, [l] = this.pageTranslation, s = l + i + 1, d = A - 100, c = s + 180;
      I.popup = {
        contents: this.comment.text,
        deleted: this.comment.deleted,
        rect: [s, d, c, A]
      };
    }
  }
  updateFromAnnotationLayer({
    popup: {
      contents: I,
      deleted: g
    }
  }) {
    this.#C.data = g ? null : I;
  }
  get parentBoundingClientRect() {
    return this.parent.boundingClientRect;
  }
  render() {
    const I = this.div = document.createElement("div");
    I.setAttribute("data-editor-rotation", (360 - this.rotation) % 360), I.className = this.name, I.setAttribute("id", this.id), I.tabIndex = this.#l ? -1 : 0, I.setAttribute("role", "application"), this.defaultL10nId && I.setAttribute("data-l10n-id", this.defaultL10nId), this._isVisible || I.classList.add("hidden"), this.setInForeground(), this.#j();
    const [g, C] = this.parentDimensions;
    this.parentRotation % 180 !== 0 && (I.style.maxWidth = `${(100 * C / g).toFixed(2)}%`, I.style.maxHeight = `${(100 * g / C).toFixed(2)}%`);
    const [A, i] = this.getInitialTranslation();
    return this.translate(A, i), Zl(this, I, ["keydown", "pointerdown", "dblclick"]), this.isResizable && this._uiManager._supportsPinchToZoom && (this.#R ||= new cl({
      container: I,
      isPinchingDisabled: () => !this.isSelected,
      onPinchStart: this.#x.bind(this),
      onPinching: this.#H.bind(this),
      onPinchEnd: this.#V.bind(this),
      signal: this._uiManager._signal
    })), this.addStandaloneCommentButton(), this._uiManager._editorUndoBar?.hide(), I;
  }
  #x() {
    this.#o = {
      savedX: this.x,
      savedY: this.y,
      savedWidth: this.width,
      savedHeight: this.height
    }, this.#A?.toggle(!1), this.parent.togglePointerEvents(!1);
  }
  #H(I, g, C) {
    let i = 0.7 * (C / g) + 1 - 0.7;
    if (i === 1)
      return;
    const l = this.#X(this.rotation), s = (V, N) => [l[0] * V + l[2] * N, l[1] * V + l[3] * N], [d, c] = this.parentDimensions, G = this.x, b = this.y, o = this.width, m = this.height, e = F.MIN_SIZE / d, a = F.MIN_SIZE / c;
    i = Math.max(Math.min(i, 1 / o, 1 / m), e / o, a / m);
    const h = F._round(o * i), t = F._round(m * i);
    if (h === o && t === m)
      return;
    this.#G ||= [G, b, o, m];
    const W = s(o / 2, m / 2), B = F._round(G + W[0]), w = F._round(b + W[1]), n = s(h / 2, t / 2);
    this.x = B - n[0], this.y = w - n[1], this.width = h, this.height = t, this.setDims(), this.fixAndSetPosition(), this._onResizing();
  }
  #V() {
    this.#A?.toggle(!0), this.parent.togglePointerEvents(!0), this.#F();
  }
  pointerdown(I) {
    const {
      isMac: g
    } = GI.platform;
    if (I.button !== 0 || I.ctrlKey && g) {
      I.preventDefault();
      return;
    }
    if (this.#a = !0, this._isDraggable) {
      this.#r(I);
      return;
    }
    this.#D(I);
  }
  #D(I) {
    const {
      isMac: g
    } = GI.platform;
    I.ctrlKey && !g || I.shiftKey || I.metaKey && g ? this.parent.toggleSelected(this) : this.parent.setSelected(this);
  }
  #r(I) {
    const {
      isSelected: g
    } = this;
    this._uiManager.setUpDragSession();
    let C = !1;
    const A = new AbortController(), i = this._uiManager.combinedSignal(A), l = {
      capture: !0,
      passive: !1,
      signal: i
    }, s = (c) => {
      A.abort(), this.#s = null, this.#a = !1, this._uiManager.endDragSession() || this.#D(c), C && this._onStopDragging();
    };
    g && (this.#N = I.clientX, this.#w = I.clientY, this.#s = I.pointerId, this.#d = I.pointerType, window.addEventListener("pointermove", (c) => {
      C || (C = !0, this._uiManager.toggleComment(this, !0, !1), this._onStartDragging());
      const {
        clientX: G,
        clientY: b,
        pointerId: o
      } = c;
      if (o !== this.#s) {
        II(c);
        return;
      }
      const [m, e] = this.screenToPageTranslation(G - this.#N, b - this.#w);
      this.#N = G, this.#w = b, this._uiManager.dragSelectedEditors(m, e);
    }, l), window.addEventListener("touchmove", II, l), window.addEventListener("pointerdown", (c) => {
      c.pointerType === this.#d && (this.#R || c.isPrimary) && s(c), II(c);
    }, l));
    const d = (c) => {
      if (!this.#s || this.#s === c.pointerId) {
        s(c);
        return;
      }
      II(c);
    };
    window.addEventListener("pointerup", d, {
      signal: i
    }), window.addEventListener("blur", d, {
      signal: i
    });
  }
  _onStartDragging() {
  }
  _onStopDragging() {
  }
  moveInDOM() {
    this.#h && clearTimeout(this.#h), this.#h = setTimeout(() => {
      this.#h = null, this.parent?.moveEditorInDOM(this);
    }, 0);
  }
  _setParentAndPosition(I, g, C) {
    I.changeParent(this), this.x = g, this.y = C, this.fixAndSetPosition(), this._onTranslated();
  }
  getRect(I, g, C = this.rotation) {
    const A = this.parentScale, [i, l] = this.pageDimensions, [s, d] = this.pageTranslation, c = I / A, G = g / A, b = this.x * i, o = this.y * l, m = this.width * i, e = this.height * l;
    switch (C) {
      case 0:
        return [b + c + s, l - o - G - e + d, b + c + m + s, l - o - G + d];
      case 90:
        return [b + G + s, l - o + c + d, b + G + e + s, l - o + c + m + d];
      case 180:
        return [b - c - m + s, l - o + G + d, b - c + s, l - o + G + e + d];
      case 270:
        return [b - G - e + s, l - o - c - m + d, b - G + s, l - o - c + d];
      default:
        throw new Error("Invalid rotation");
    }
  }
  getRectInCurrentCoords(I, g) {
    const [C, A, i, l] = I, s = i - C, d = l - A;
    switch (this.rotation) {
      case 0:
        return [C, g - l, s, d];
      case 90:
        return [C, g - A, d, s];
      case 180:
        return [i, g - A, s, d];
      case 270:
        return [i, g - l, d, s];
      default:
        throw new Error("Invalid rotation");
    }
  }
  getPDFRect() {
    return this.getRect(0, 0);
  }
  getNonHCMColor() {
    return this.color && F._colorManager.convert(this._uiManager.getNonHCMColor(this.color));
  }
  onUpdatedColor() {
    this.#C?.onUpdatedColor();
  }
  getData() {
    const {
      comment: {
        text: I,
        color: g,
        date: C,
        opacity: A,
        deleted: i,
        richText: l
      },
      uid: s,
      pageIndex: d,
      creationDate: c,
      modificationDate: G
    } = this;
    return {
      id: s,
      pageIndex: d,
      rect: this.getPDFRect(),
      richText: l,
      contentsObj: {
        str: I
      },
      creationDate: c,
      modificationDate: C || G,
      popupRef: !i,
      color: g,
      opacity: A
    };
  }
  onceAdded(I) {
  }
  isEmpty() {
    return !1;
  }
  enableEditMode() {
    return this.isInEditMode() ? !1 : (this.parent.setEditingState(!1), this.#B = !0, !0);
  }
  disableEditMode() {
    return this.isInEditMode() ? (this.parent.setEditingState(!0), this.#B = !1, !0) : !1;
  }
  isInEditMode() {
    return this.#B;
  }
  shouldGetKeyboardEvents() {
    return this.#W;
  }
  needsToBeRebuilt() {
    return this.div && !this.isAttachedToDOM;
  }
  get isOnScreen() {
    const {
      top: I,
      left: g,
      bottom: C,
      right: A
    } = this.getClientDimensions(), {
      innerHeight: i,
      innerWidth: l
    } = window;
    return g < l && A > 0 && I < i && C > 0;
  }
  #j() {
    if (this.#m || !this.div)
      return;
    this.#m = new AbortController();
    const I = this._uiManager.combinedSignal(this.#m);
    this.div.addEventListener("focusin", this.focusin.bind(this), {
      signal: I
    }), this.div.addEventListener("focusout", this.focusout.bind(this), {
      signal: I
    });
  }
  rebuild() {
    this.#j();
  }
  rotate(I) {
  }
  resize() {
  }
  serializeDeleted() {
    return {
      id: this.annotationElementId,
      deleted: !0,
      pageIndex: this.pageIndex,
      popupRef: this._initialData?.popupRef || ""
    };
  }
  serialize(I = !1, g = null) {
    return {
      annotationType: this.mode,
      pageIndex: this.pageIndex,
      rect: this.getPDFRect(),
      rotation: this.rotation,
      structTreeParentId: this._structTreeParentId,
      popupRef: this._initialData?.popupRef || ""
    };
  }
  static async deserialize(I, g, C) {
    const A = new this.prototype.constructor({
      parent: g,
      id: g.getNextId(),
      uiManager: C,
      annotationElementId: I.annotationElementId,
      creationDate: I.creationDate,
      modificationDate: I.modificationDate
    });
    A.rotation = I.rotation, A.#I = I.accessibilityData, A._isCopy = I.isCopy || !1;
    const [i, l] = A.pageDimensions, [s, d, c, G] = A.getRectInCurrentCoords(I.rect, l);
    return A.x = s / i, A.y = d / l, A.width = c / i, A.height = G / l, A;
  }
  get hasBeenModified() {
    return !!this.annotationElementId && (this.deleted || this.serialize() !== null);
  }
  remove() {
    if (this.#m?.abort(), this.#m = null, this.isEmpty() || this.commit(), this.parent ? this.parent.remove(this) : this._uiManager.removeEditor(this), this.#h && (clearTimeout(this.#h), this.#h = null), this.#J(), this.removeEditToolbar(), this.#n) {
      for (const I of this.#n.values())
        clearTimeout(I);
      this.#n = null;
    }
    this.parent = null, this.#R?.destroy(), this.#R = null;
  }
  get isResizable() {
    return !1;
  }
  makeResizable() {
    this.isResizable && (this.#p(), this.#c.classList.remove("hidden"));
  }
  get toolbarPosition() {
    return null;
  }
  get commentButtonPosition() {
    return this._uiManager.direction === "ltr" ? [1, 0] : [0, 0];
  }
  get commentButtonPositionInPage() {
    const {
      commentButtonPosition: [I, g]
    } = this, [C, A, i, l] = this.getPDFRect();
    return [F._round(C + (i - C) * I), F._round(A + (l - A) * (1 - g))];
  }
  get commentButtonColor() {
    return this._uiManager.makeCommentColor(this.getNonHCMColor(), this.opacity);
  }
  get commentPopupPosition() {
    return this.#C.commentPopupPositionInLayer;
  }
  set commentPopupPosition(I) {
    this.#C.commentPopupPositionInLayer = I;
  }
  hasDefaultPopupPosition() {
    return this.#C.hasDefaultPopupPosition();
  }
  get commentButtonWidth() {
    return this.#C.commentButtonWidth;
  }
  get elementBeforePopup() {
    return this.div;
  }
  setCommentButtonStates(I) {
    this.#C.setCommentButtonStates(I);
  }
  keydown(I) {
    if (!this.isResizable || I.target !== this.div || I.key !== "Enter")
      return;
    this._uiManager.setSelected(this), this.#o = {
      savedX: this.x,
      savedY: this.y,
      savedWidth: this.width,
      savedHeight: this.height
    };
    const g = this.#c.children;
    if (!this.#g) {
      this.#g = Array.from(g);
      const l = this.#P.bind(this), s = this.#k.bind(this), d = this._uiManager._signal;
      for (const c of this.#g) {
        const G = c.getAttribute("data-resizer-name");
        c.setAttribute("role", "spinbutton"), c.addEventListener("keydown", l, {
          signal: d
        }), c.addEventListener("blur", s, {
          signal: d
        }), c.addEventListener("focus", this.#v.bind(this, G), {
          signal: d
        }), c.setAttribute("data-l10n-id", F._l10nResizer[G]);
      }
    }
    const C = this.#g[0];
    let A = 0;
    for (const l of g) {
      if (l === C)
        break;
      A++;
    }
    const i = (360 - this.rotation + this.parentRotation) % 360 / 90 * (this.#g.length / 4);
    if (i !== A) {
      if (i < A)
        for (let s = 0; s < A - i; s++)
          this.#c.append(this.#c.firstChild);
      else if (i > A)
        for (let s = 0; s < i - A; s++)
          this.#c.firstChild.before(this.#c.lastChild);
      let l = 0;
      for (const s of g) {
        const c = this.#g[l++].getAttribute("data-resizer-name");
        s.setAttribute("data-l10n-id", F._l10nResizer[c]);
      }
    }
    this.#Q(0), this.#W = !0, this.#c.firstChild.focus({
      focusVisible: !0
    }), I.preventDefault(), I.stopImmediatePropagation();
  }
  #P(I) {
    F._resizerKeyboardManager.exec(this, I);
  }
  #k(I) {
    this.#W && I.relatedTarget?.parentNode !== this.#c && this.#J();
  }
  #v(I) {
    this.#t = this.#W ? I : "";
  }
  #Q(I) {
    if (this.#g)
      for (const g of this.#g)
        g.tabIndex = I;
  }
  _resizeWithKeyboard(I, g) {
    this.#W && this.#z(this.#t, {
      deltaX: I,
      deltaY: g,
      fromKeyboard: !0
    });
  }
  #J() {
    this.#W = !1, this.#Q(-1), this.#F();
  }
  _stopResizingWithKeyboard() {
    this.#J(), this.div.focus();
  }
  select() {
    if (this.isSelected && this._editToolbar) {
      this._editToolbar.show();
      return;
    }
    if (this.isSelected = !0, this.makeResizable(), this.div?.classList.add("selectedEditor"), !this._editToolbar) {
      this.addEditToolbar().then(() => {
        this.div?.classList.contains("selectedEditor") && this._editToolbar?.show();
      });
      return;
    }
    this._editToolbar?.show(), this.#A?.toggleAltTextBadge(!1);
  }
  focus() {
    this.div && !this.div.contains(document.activeElement) && setTimeout(() => this.div?.focus({
      preventScroll: !0
    }), 0);
  }
  unselect() {
    this.isSelected && (this.isSelected = !1, this.#c?.classList.add("hidden"), this.div?.classList.remove("selectedEditor"), this.div?.contains(document.activeElement) && this._uiManager.currentLayer.div.focus({
      preventScroll: !0
    }), this._editToolbar?.hide(), this.#A?.toggleAltTextBadge(!0), this.hasComment && this._uiManager.toggleComment(this, !1, !1));
  }
  updateParams(I, g) {
  }
  disableEditing() {
  }
  enableEditing() {
  }
  get canChangeContent() {
    return !1;
  }
  enterInEditMode() {
    this.canChangeContent && (this.enableEditMode(), this.div.focus());
  }
  dblclick(I) {
    I.target.nodeName !== "BUTTON" && (this.enterInEditMode(), this.parent.updateToolbar({
      mode: this.constructor._editorType,
      editId: this.id
    }));
  }
  getElementForAltText() {
    return this.div;
  }
  get contentDiv() {
    return this.div;
  }
  get isEditing() {
    return this.#e;
  }
  set isEditing(I) {
    this.#e = I, this.parent && (I ? (this.parent.setSelected(this), this.parent.setActiveEditor(this)) : this.parent.setActiveEditor(null));
  }
  static get MIN_SIZE() {
    return 16;
  }
  static canCreateNewEmptyEditor() {
    return !0;
  }
  get telemetryInitialData() {
    return {
      action: "added"
    };
  }
  get telemetryFinalData() {
    return null;
  }
  _reportTelemetry(I, g = !1) {
    if (g) {
      this.#n ||= /* @__PURE__ */ new Map();
      const {
        action: C
      } = I;
      let A = this.#n.get(C);
      A && clearTimeout(A), A = setTimeout(() => {
        this._reportTelemetry(I), this.#n.delete(C), this.#n.size === 0 && (this.#n = null);
      }, F._telemetryTimeout), this.#n.set(C, A);
      return;
    }
    I.type ||= this.editorType, this._uiManager._eventBus.dispatch("reporttelemetry", {
      source: this,
      details: {
        type: "editing",
        data: I
      }
    });
  }
  show(I = this._isVisible) {
    this.div.classList.toggle("hidden", !I), this._isVisible = I;
  }
  enable() {
    this.div && (this.div.tabIndex = 0), this.#l = !1;
  }
  disable() {
    this.div && (this.div.tabIndex = -1), this.#l = !0;
  }
  updateFakeAnnotationElement(I) {
    if (!this.#b && !this.deleted) {
      this.#b = I.addFakeAnnotation(this);
      return;
    }
    if (this.deleted) {
      this.#b.remove(), this.#b = null;
      return;
    }
    (this.hasEditedComment || this._hasBeenMoved || this._hasBeenResized) && this.#b.updateEdited({
      rect: this.getPDFRect(),
      popup: this.comment
    });
  }
  renderAnnotationElement(I) {
    if (this.deleted)
      return I.hide(), null;
    let g = I.container.querySelector(".annotationContent");
    if (!g)
      g = document.createElement("div"), g.classList.add("annotationContent", this.editorType), I.container.prepend(g);
    else if (g.nodeName === "CANVAS") {
      const C = g;
      g = document.createElement("div"), g.classList.add("annotationContent", this.editorType), C.before(g);
    }
    return g;
  }
  resetAnnotationElement(I) {
    const {
      firstChild: g
    } = I.container;
    g?.nodeName === "DIV" && g.classList.contains("annotationContent") && g.remove();
  }
}
class Ks extends F {
  constructor(I) {
    super(I), this.annotationElementId = I.annotationElementId, this.deleted = !0;
  }
  serialize() {
    return this.serializeDeleted();
  }
}
const gi = 3285377520, VI = 4294901760, KI = 65535;
class bl {
  constructor(I) {
    this.h1 = I ? I & 4294967295 : gi, this.h2 = I ? I & 4294967295 : gi;
  }
  update(I) {
    let g, C;
    if (typeof I == "string") {
      g = new Uint8Array(I.length * 2), C = 0;
      for (let a = 0, h = I.length; a < h; a++) {
        const t = I.charCodeAt(a);
        t <= 255 ? g[C++] = t : (g[C++] = t >>> 8, g[C++] = t & 255);
      }
    } else if (ArrayBuffer.isView(I))
      g = I.slice(), C = g.byteLength;
    else
      throw new Error("Invalid data format, must be a string or TypedArray.");
    const A = C >> 2, i = C - A * 4, l = new Uint32Array(g.buffer, 0, A);
    let s = 0, d = 0, c = this.h1, G = this.h2;
    const b = 3432918353, o = 461845907, m = b & KI, e = o & KI;
    for (let a = 0; a < A; a++)
      a & 1 ? (s = l[a], s = s * b & VI | s * m & KI, s = s << 15 | s >>> 17, s = s * o & VI | s * e & KI, c ^= s, c = c << 13 | c >>> 19, c = c * 5 + 3864292196) : (d = l[a], d = d * b & VI | d * m & KI, d = d << 15 | d >>> 17, d = d * o & VI | d * e & KI, G ^= d, G = G << 13 | G >>> 19, G = G * 5 + 3864292196);
    switch (s = 0, i) {
      case 3:
        s ^= g[A * 4 + 2] << 16;
      case 2:
        s ^= g[A * 4 + 1] << 8;
      case 1:
        s ^= g[A * 4], s = s * b & VI | s * m & KI, s = s << 15 | s >>> 17, s = s * o & VI | s * e & KI, A & 1 ? c ^= s : G ^= s;
    }
    this.h1 = c, this.h2 = G;
  }
  hexdigest() {
    let I = this.h1, g = this.h2;
    return I ^= g >>> 1, I = I * 3981806797 & VI | I * 36045 & KI, g = g * 4283543511 & VI | ((g << 16 | I >>> 16) * 2950163797 & VI) >>> 16, I ^= g >>> 1, I = I * 444984403 & VI | I * 60499 & KI, g = g * 3301882366 & VI | ((g << 16 | I >>> 16) * 3120437893 & VI) >>> 16, I ^= g >>> 1, (I >>> 0).toString(16).padStart(8, "0") + (g >>> 0).toString(16).padStart(8, "0");
  }
}
const bA = Object.freeze({
  map: null,
  hash: "",
  transfer: void 0
});
class KA {
  #I = !1;
  #g = null;
  #A = null;
  #C = /* @__PURE__ */ new Map();
  constructor() {
    this.onSetModified = null, this.onResetModified = null, this.onAnnotationEditor = null;
  }
  getValue(I, g) {
    const C = this.#C.get(I);
    return C === void 0 ? g : Object.assign(g, C);
  }
  getRawValue(I) {
    return this.#C.get(I);
  }
  remove(I) {
    const g = this.#C.get(I);
    if (g !== void 0 && (g instanceof F && this.#A.delete(g.annotationElementId), this.#C.delete(I), this.#C.size === 0 && this.resetModified(), typeof this.onAnnotationEditor == "function")) {
      for (const C of this.#C.values())
        if (C instanceof F)
          return;
      this.onAnnotationEditor(null);
    }
  }
  setValue(I, g) {
    const C = this.#C.get(I);
    let A = !1;
    if (C !== void 0)
      for (const [i, l] of Object.entries(g))
        C[i] !== l && (A = !0, C[i] = l);
    else
      A = !0, this.#C.set(I, g);
    A && this.#i(), g instanceof F && ((this.#A ||= /* @__PURE__ */ new Map()).set(g.annotationElementId, g), typeof this.onAnnotationEditor == "function" && this.onAnnotationEditor(g.constructor._type));
  }
  has(I) {
    return this.#C.has(I);
  }
  get size() {
    return this.#C.size;
  }
  #i() {
    this.#I || (this.#I = !0, typeof this.onSetModified == "function" && this.onSetModified());
  }
  resetModified() {
    this.#I && (this.#I = !1, typeof this.onResetModified == "function" && this.onResetModified());
  }
  get print() {
    return new ol(this);
  }
  get serializable() {
    if (this.#C.size === 0)
      return bA;
    const I = /* @__PURE__ */ new Map(), g = new bl(), C = [], A = /* @__PURE__ */ Object.create(null);
    let i = !1;
    for (const [l, s] of this.#C) {
      const d = s instanceof F ? s.serialize(!1, A) : s;
      d && (I.set(l, d), g.update(`${l}:${JSON.stringify(d)}`), i ||= !!d.bitmap);
    }
    if (i)
      for (const l of I.values())
        l.bitmap && C.push(l.bitmap);
    return I.size > 0 ? {
      map: I,
      hash: g.hexdigest(),
      transfer: C
    } : bA;
  }
  get editorStats() {
    let I = null;
    const g = /* @__PURE__ */ new Map();
    let C = 0, A = 0;
    for (const i of this.#C.values()) {
      if (!(i instanceof F)) {
        i.popup && (i.popup.deleted ? A += 1 : C += 1);
        continue;
      }
      i.isCommentDeleted ? A += 1 : i.hasEditedComment && (C += 1);
      const l = i.telemetryFinalData;
      if (!l)
        continue;
      const {
        type: s
      } = l;
      g.has(s) || g.set(s, Object.getPrototypeOf(i).constructor), I ||= /* @__PURE__ */ Object.create(null);
      const d = I[s] ||= /* @__PURE__ */ new Map();
      for (const [c, G] of Object.entries(l)) {
        if (c === "type")
          continue;
        let b = d.get(c);
        b || (b = /* @__PURE__ */ new Map(), d.set(c, b));
        const o = b.get(G) ?? 0;
        b.set(G, o + 1);
      }
    }
    if ((A > 0 || C > 0) && (I ||= /* @__PURE__ */ Object.create(null), I.comments = {
      deleted: A,
      edited: C
    }), !I)
      return null;
    for (const [i, l] of g)
      I[i] = l.computeTelemetryFinalData(I[i]);
    return I;
  }
  resetModifiedIds() {
    this.#g = null;
  }
  updateEditor(I, g) {
    const C = this.#A?.get(I);
    return C ? (C.updateFromAnnotationLayer(g), !0) : !1;
  }
  getEditor(I) {
    return this.#A?.get(I) || null;
  }
  get modifiedIds() {
    if (this.#g)
      return this.#g;
    const I = [];
    if (this.#A)
      for (const g of this.#A.values())
        g.serialize() && I.push(g.annotationElementId);
    return this.#g = {
      ids: new Set(I),
      hash: I.join(",")
    };
  }
  [Symbol.iterator]() {
    return this.#C.entries();
  }
}
class ol extends KA {
  #I;
  constructor(I) {
    super();
    const {
      map: g,
      hash: C,
      transfer: A
    } = I.serializable, i = structuredClone(g, A ? {
      transfer: A
    } : null);
    this.#I = {
      map: i,
      hash: C,
      transfer: A
    };
  }
  get print() {
    f("Should not call PrintAnnotationStorage.print");
  }
  get serializable() {
    return this.#I;
  }
  get modifiedIds() {
    return T(this, "modifiedIds", {
      ids: /* @__PURE__ */ new Set(),
      hash: ""
    });
  }
}
class Ss {
  #I = /* @__PURE__ */ new Set();
  constructor({
    ownerDocument: I = globalThis.document,
    styleElement: g = null
  }) {
    this._document = I, this.nativeFontFaces = /* @__PURE__ */ new Set(), this.styleElement = null, this.loadingRequests = [], this.loadTestFontId = 0;
  }
  addNativeFontFace(I) {
    this.nativeFontFaces.add(I), this._document.fonts.add(I);
  }
  removeNativeFontFace(I) {
    this.nativeFontFaces.delete(I), this._document.fonts.delete(I);
  }
  insertRule(I) {
    this.styleElement || (this.styleElement = this._document.createElement("style"), this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));
    const g = this.styleElement.sheet;
    g.insertRule(I, g.cssRules.length);
  }
  clear() {
    for (const I of this.nativeFontFaces)
      this._document.fonts.delete(I);
    this.nativeFontFaces.clear(), this.#I.clear(), this.styleElement && (this.styleElement.remove(), this.styleElement = null);
  }
  async loadSystemFont({
    systemFontInfo: I,
    disableFontFace: g,
    _inspectFont: C
  }) {
    if (!(!I || this.#I.has(I.loadedName))) {
      if (Q(!g, "loadSystemFont shouldn't be called when `disableFontFace` is set."), this.isFontLoadingAPISupported) {
        const {
          loadedName: A,
          src: i,
          style: l
        } = I, s = new FontFace(A, i, l);
        this.addNativeFontFace(s);
        try {
          await s.load(), this.#I.add(A), C?.(I);
        } catch {
          L(`Cannot load system font: ${I.baseFontName}, installing it could help to improve PDF rendering.`), this.removeNativeFontFace(s);
        }
        return;
      }
      f("Not implemented: loadSystemFont without the Font Loading API.");
    }
  }
  async bind(I) {
    if (I.attached || I.missingFile && !I.systemFontInfo)
      return;
    if (I.attached = !0, I.systemFontInfo) {
      await this.loadSystemFont(I);
      return;
    }
    if (this.isFontLoadingAPISupported) {
      const C = I.createNativeFontFace();
      if (C) {
        this.addNativeFontFace(C);
        try {
          await C.loaded;
        } catch (A) {
          throw L(`Failed to load font '${C.family}': '${A}'.`), I.disableFontFace = !0, A;
        }
      }
      return;
    }
    const g = I.createFontFaceRule();
    if (g) {
      if (this.insertRule(g), this.isSyncFontLoadingSupported)
        return;
      await new Promise((C) => {
        const A = this._queueLoadingCallback(C);
        this._prepareFontLoadEvent(I, A);
      });
    }
  }
  get isFontLoadingAPISupported() {
    const I = !!this._document?.fonts;
    return T(this, "isFontLoadingAPISupported", I);
  }
  get isSyncFontLoadingSupported() {
    return T(this, "isSyncFontLoadingSupported", aI || GI.platform.isFirefox);
  }
  _queueLoadingCallback(I) {
    function g() {
      for (Q(!A.done, "completeRequest() cannot be called twice."), A.done = !0; C.length > 0 && C[0].done; ) {
        const i = C.shift();
        setTimeout(i.callback, 0);
      }
    }
    const {
      loadingRequests: C
    } = this, A = {
      done: !1,
      complete: g,
      callback: I
    };
    return C.push(A), A;
  }
  get _loadTestFont() {
    const I = atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");
    return T(this, "_loadTestFont", I);
  }
  _prepareFontLoadEvent(I, g) {
    function C(w, n) {
      return w.charCodeAt(n) << 24 | w.charCodeAt(n + 1) << 16 | w.charCodeAt(n + 2) << 8 | w.charCodeAt(n + 3) & 255;
    }
    function A(w, n, V, N) {
      const R = w.substring(0, n), Y = w.substring(n + V);
      return R + N + Y;
    }
    let i, l;
    const s = this._document.createElement("canvas");
    s.width = 1, s.height = 1;
    const d = s.getContext("2d");
    let c = 0;
    function G(w, n) {
      if (++c > 30) {
        L("Load test font never loaded."), n();
        return;
      }
      if (d.font = "30px " + w, d.fillText(".", 0, 20), d.getImageData(0, 0, 1, 1).data[3] > 0) {
        n();
        return;
      }
      setTimeout(G.bind(null, w, n));
    }
    const b = `lt${Date.now()}${this.loadTestFontId++}`;
    let o = this._loadTestFont;
    o = A(o, 976, b.length, b);
    const e = 16, a = 1482184792;
    let h = C(o, e);
    for (i = 0, l = b.length - 3; i < l; i += 4)
      h = h - a + C(b, i) | 0;
    i < b.length && (h = h - a + C(b + "XXX", i) | 0), o = A(o, e, 4, ms(h));
    const t = `url(data:font/opentype;base64,${btoa(o)});`, W = `@font-face {font-family:"${b}";src:${t}}`;
    this.insertRule(W);
    const B = this._document.createElement("div");
    B.style.visibility = "hidden", B.style.width = B.style.height = "10px", B.style.position = "absolute", B.style.top = B.style.left = "0px";
    for (const w of [I.loadedName, b]) {
      const n = this._document.createElement("span");
      n.textContent = "Hi", n.style.fontFamily = w, B.append(n);
    }
    this._document.body.append(B), G(b, () => {
      B.remove(), g.complete();
    });
  }
}
class ps {
  #I;
  constructor(I, g = null, C, A) {
    this.compiledGlyphs = /* @__PURE__ */ Object.create(null), this.#I = I, this._inspectFont = g, C && Object.assign(this, C), A && (this.charProcOperatorList = A);
  }
  createNativeFontFace() {
    if (!this.data || this.disableFontFace)
      return null;
    let I;
    if (!this.cssFontInfo)
      I = new FontFace(this.loadedName, this.data, {});
    else {
      const g = {
        weight: this.cssFontInfo.fontWeight
      };
      this.cssFontInfo.italicAngle && (g.style = `oblique ${this.cssFontInfo.italicAngle}deg`), I = new FontFace(this.cssFontInfo.fontFamily, this.data, g);
    }
    return this._inspectFont?.(this), I;
  }
  createFontFaceRule() {
    if (!this.data || this.disableFontFace)
      return null;
    const I = `url(data:${this.mimetype};base64,${ll(this.data)});`;
    let g;
    if (!this.cssFontInfo)
      g = `@font-face {font-family:"${this.loadedName}";src:${I}}`;
    else {
      let C = `font-weight: ${this.cssFontInfo.fontWeight};`;
      this.cssFontInfo.italicAngle && (C += `font-style: oblique ${this.cssFontInfo.italicAngle}deg;`), g = `@font-face {font-family:"${this.cssFontInfo.fontFamily}";${C}src:${I}}`;
    }
    return this._inspectFont?.(this, I), g;
  }
  getPathGenerator(I, g) {
    if (this.compiledGlyphs[g] !== void 0)
      return this.compiledGlyphs[g];
    const C = this.loadedName + "_path_" + g;
    let A;
    try {
      A = I.get(C);
    } catch (l) {
      L(`getPathGenerator - ignoring character: "${l}".`);
    }
    const i = new Path2D(A || "");
    return this.fontExtraProperties || I.delete(C), this.compiledGlyphs[g] = i;
  }
  get black() {
    return this.#I.black;
  }
  get bold() {
    return this.#I.bold;
  }
  get disableFontFace() {
    return this.#I.disableFontFace ?? !1;
  }
  get fontExtraProperties() {
    return this.#I.fontExtraProperties ?? !1;
  }
  get isInvalidPDFjsFont() {
    return this.#I.isInvalidPDFjsFont;
  }
  get isType3Font() {
    return this.#I.isType3Font;
  }
  get italic() {
    return this.#I.italic;
  }
  get missingFile() {
    return this.#I.missingFile;
  }
  get remeasure() {
    return this.#I.remeasure;
  }
  get vertical() {
    return this.#I.vertical;
  }
  get ascent() {
    return this.#I.ascent;
  }
  get defaultWidth() {
    return this.#I.defaultWidth;
  }
  get descent() {
    return this.#I.descent;
  }
  get bbox() {
    return this.#I.bbox;
  }
  get fontMatrix() {
    return this.#I.fontMatrix;
  }
  get fallbackName() {
    return this.#I.fallbackName;
  }
  get loadedName() {
    return this.#I.loadedName;
  }
  get mimetype() {
    return this.#I.mimetype;
  }
  get name() {
    return this.#I.name;
  }
  get data() {
    return this.#I.data;
  }
  clearData() {
    this.#I.clearData();
  }
  get cssFontInfo() {
    return this.#I.cssFontInfo;
  }
  get systemFontInfo() {
    return this.#I.systemFontInfo;
  }
  get defaultVMetrics() {
    return this.#I.defaultVMetrics;
  }
}
function Fs(Z) {
  if (Z instanceof URL)
    return Z.href;
  if (typeof Z == "string") {
    if (aI)
      return Z;
    const I = URL.parse(Z, window.location);
    if (I)
      return I.href;
  }
  throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");
}
function zs(Z) {
  if (aI && typeof Buffer < "u" && Z instanceof Buffer)
    throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");
  if (Z instanceof Uint8Array && Z.byteLength === Z.buffer.byteLength)
    return Z;
  if (typeof Z == "string")
    return qg(Z);
  if (Z instanceof ArrayBuffer || ArrayBuffer.isView(Z) || typeof Z == "object" && !isNaN(Z?.length))
    return new Uint8Array(Z);
  throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.");
}
function dC(Z) {
  if (typeof Z != "string")
    return null;
  if (Z.endsWith("/"))
    return Z;
  throw new Error(`Invalid factory url: "${Z}" must include trailing slash.`);
}
const oA = (Z) => typeof Z == "object" && Number.isInteger(Z?.num) && Z.num >= 0 && Number.isInteger(Z?.gen) && Z.gen >= 0, Js = (Z) => typeof Z == "object" && typeof Z?.name == "string", Ls = Bs.bind(null, oA, Js);
class ks {
  #I = /* @__PURE__ */ new Map();
  #g = Promise.resolve();
  postMessage(I, g) {
    const C = {
      data: structuredClone(I, g ? {
        transfer: g
      } : null)
    };
    this.#g.then(() => {
      for (const [A] of this.#I)
        A.call(this, C);
    });
  }
  addEventListener(I, g, C = null) {
    let A = null;
    if (C?.signal instanceof AbortSignal) {
      const {
        signal: i
      } = C;
      if (i.aborted) {
        L("LoopbackPort - cannot use an `aborted` signal.");
        return;
      }
      const l = () => this.removeEventListener(I, g);
      A = () => i.removeEventListener("abort", l), i.addEventListener("abort", l);
    }
    this.#I.set(g, A);
  }
  removeEventListener(I, g) {
    this.#I.get(g)?.(), this.#I.delete(g);
  }
  terminate() {
    for (const [, I] of this.#I)
      I?.();
    this.#I.clear();
  }
}
const ZC = {
  DATA: 1,
  ERROR: 2
}, AI = {
  CANCEL: 1,
  CANCEL_COMPLETE: 2,
  CLOSE: 3,
  ENQUEUE: 4,
  ERROR: 5,
  PULL: 6,
  PULL_COMPLETE: 7,
  START_COMPLETE: 8
};
function Ci() {
}
function BI(Z) {
  if (Z instanceof Ig || Z instanceof lA || Z instanceof EA || Z instanceof uC || Z instanceof xC)
    return Z;
  switch (Z instanceof Error || typeof Z == "object" && Z !== null || f('wrapReason: Expected "reason" to be a (possibly cloned) Error.'), Z.name) {
    case "AbortException":
      return new Ig(Z.message);
    case "InvalidPDFException":
      return new lA(Z.message);
    case "PasswordException":
      return new EA(Z.message, Z.code);
    case "ResponseException":
      return new uC(Z.message, Z.status, Z.missing);
    case "UnknownErrorException":
      return new xC(Z.message, Z.details);
  }
  return new xC(Z.message, Z.toString());
}
class kg {
  #I = new AbortController();
  constructor(I, g, C) {
    this.sourceName = I, this.targetName = g, this.comObj = C, this.callbackId = 1, this.streamId = 1, this.streamSinks = /* @__PURE__ */ Object.create(null), this.streamControllers = /* @__PURE__ */ Object.create(null), this.callbackCapabilities = /* @__PURE__ */ Object.create(null), this.actionHandler = /* @__PURE__ */ Object.create(null), C.addEventListener("message", this.#g.bind(this), {
      signal: this.#I.signal
    });
  }
  #g({
    data: I
  }) {
    if (I.targetName !== this.sourceName)
      return;
    if (I.stream) {
      this.#C(I);
      return;
    }
    if (I.callback) {
      const C = I.callbackId, A = this.callbackCapabilities[C];
      if (!A)
        throw new Error(`Cannot resolve callback ${C}`);
      if (delete this.callbackCapabilities[C], I.callback === ZC.DATA)
        A.resolve(I.data);
      else if (I.callback === ZC.ERROR)
        A.reject(BI(I.reason));
      else
        throw new Error("Unexpected callback case");
      return;
    }
    const g = this.actionHandler[I.action];
    if (!g)
      throw new Error(`Unknown action from worker: ${I.action}`);
    if (I.callbackId) {
      const C = this.sourceName, A = I.sourceName, i = this.comObj;
      Promise.try(g, I.data).then(function(l) {
        i.postMessage({
          sourceName: C,
          targetName: A,
          callback: ZC.DATA,
          callbackId: I.callbackId,
          data: l
        });
      }, function(l) {
        i.postMessage({
          sourceName: C,
          targetName: A,
          callback: ZC.ERROR,
          callbackId: I.callbackId,
          reason: BI(l)
        });
      });
      return;
    }
    if (I.streamId) {
      this.#A(I);
      return;
    }
    g(I.data);
  }
  on(I, g) {
    const C = this.actionHandler;
    if (C[I])
      throw new Error(`There is already an actionName called "${I}"`);
    C[I] = g;
  }
  send(I, g, C) {
    this.comObj.postMessage({
      sourceName: this.sourceName,
      targetName: this.targetName,
      action: I,
      data: g
    }, C);
  }
  sendWithPromise(I, g, C) {
    const A = this.callbackId++, i = Promise.withResolvers();
    this.callbackCapabilities[A] = i;
    try {
      this.comObj.postMessage({
        sourceName: this.sourceName,
        targetName: this.targetName,
        action: I,
        callbackId: A,
        data: g
      }, C);
    } catch (l) {
      i.reject(l);
    }
    return i.promise;
  }
  sendWithStream(I, g, C, A) {
    const i = this.streamId++, l = this.sourceName, s = this.targetName, d = this.comObj;
    return new ReadableStream({
      start: (c) => {
        const G = Promise.withResolvers();
        return this.streamControllers[i] = {
          controller: c,
          startCall: G,
          pullCall: null,
          cancelCall: null,
          isClosed: !1
        }, d.postMessage({
          sourceName: l,
          targetName: s,
          action: I,
          streamId: i,
          data: g,
          desiredSize: c.desiredSize
        }, A), G.promise;
      },
      pull: (c) => {
        const G = Promise.withResolvers();
        return this.streamControllers[i].pullCall = G, d.postMessage({
          sourceName: l,
          targetName: s,
          stream: AI.PULL,
          streamId: i,
          desiredSize: c.desiredSize
        }), G.promise;
      },
      cancel: (c) => {
        Q(c instanceof Error, "cancel must have a valid reason");
        const G = Promise.withResolvers();
        return this.streamControllers[i].cancelCall = G, this.streamControllers[i].isClosed = !0, d.postMessage({
          sourceName: l,
          targetName: s,
          stream: AI.CANCEL,
          streamId: i,
          reason: BI(c)
        }), G.promise;
      }
    }, C);
  }
  #A(I) {
    const g = I.streamId, C = this.sourceName, A = I.sourceName, i = this.comObj, l = this, s = this.actionHandler[I.action], d = {
      enqueue(c, G = 1, b) {
        if (this.isCancelled)
          return;
        const o = this.desiredSize;
        this.desiredSize -= G, o > 0 && this.desiredSize <= 0 && (this.sinkCapability = Promise.withResolvers(), this.ready = this.sinkCapability.promise), i.postMessage({
          sourceName: C,
          targetName: A,
          stream: AI.ENQUEUE,
          streamId: g,
          chunk: c
        }, b);
      },
      close() {
        this.isCancelled || (this.isCancelled = !0, i.postMessage({
          sourceName: C,
          targetName: A,
          stream: AI.CLOSE,
          streamId: g
        }), delete l.streamSinks[g]);
      },
      error(c) {
        Q(c instanceof Error, "error must have a valid reason"), !this.isCancelled && (this.isCancelled = !0, i.postMessage({
          sourceName: C,
          targetName: A,
          stream: AI.ERROR,
          streamId: g,
          reason: BI(c)
        }));
      },
      sinkCapability: Promise.withResolvers(),
      onPull: null,
      onCancel: null,
      isCancelled: !1,
      desiredSize: I.desiredSize,
      ready: null
    };
    d.sinkCapability.resolve(), d.ready = d.sinkCapability.promise, this.streamSinks[g] = d, Promise.try(s, I.data, d).then(function() {
      i.postMessage({
        sourceName: C,
        targetName: A,
        stream: AI.START_COMPLETE,
        streamId: g,
        success: !0
      });
    }, function(c) {
      i.postMessage({
        sourceName: C,
        targetName: A,
        stream: AI.START_COMPLETE,
        streamId: g,
        reason: BI(c)
      });
    });
  }
  #C(I) {
    const g = I.streamId, C = this.sourceName, A = I.sourceName, i = this.comObj, l = this.streamControllers[g], s = this.streamSinks[g];
    switch (I.stream) {
      case AI.START_COMPLETE:
        I.success ? l.startCall.resolve() : l.startCall.reject(BI(I.reason));
        break;
      case AI.PULL_COMPLETE:
        I.success ? l.pullCall.resolve() : l.pullCall.reject(BI(I.reason));
        break;
      case AI.PULL:
        if (!s) {
          i.postMessage({
            sourceName: C,
            targetName: A,
            stream: AI.PULL_COMPLETE,
            streamId: g,
            success: !0
          });
          break;
        }
        s.desiredSize <= 0 && I.desiredSize > 0 && s.sinkCapability.resolve(), s.desiredSize = I.desiredSize, Promise.try(s.onPull || Ci).then(function() {
          i.postMessage({
            sourceName: C,
            targetName: A,
            stream: AI.PULL_COMPLETE,
            streamId: g,
            success: !0
          });
        }, function(c) {
          i.postMessage({
            sourceName: C,
            targetName: A,
            stream: AI.PULL_COMPLETE,
            streamId: g,
            reason: BI(c)
          });
        });
        break;
      case AI.ENQUEUE:
        if (Q(l, "enqueue should have stream controller"), l.isClosed)
          break;
        l.controller.enqueue(I.chunk);
        break;
      case AI.CLOSE:
        if (Q(l, "close should have stream controller"), l.isClosed)
          break;
        l.isClosed = !0, l.controller.close(), this.#i(l, g);
        break;
      case AI.ERROR:
        Q(l, "error should have stream controller"), l.controller.error(BI(I.reason)), this.#i(l, g);
        break;
      case AI.CANCEL_COMPLETE:
        I.success ? l.cancelCall.resolve() : l.cancelCall.reject(BI(I.reason)), this.#i(l, g);
        break;
      case AI.CANCEL:
        if (!s)
          break;
        const d = BI(I.reason);
        Promise.try(s.onCancel || Ci, d).then(function() {
          i.postMessage({
            sourceName: C,
            targetName: A,
            stream: AI.CANCEL_COMPLETE,
            streamId: g,
            success: !0
          });
        }, function(c) {
          i.postMessage({
            sourceName: C,
            targetName: A,
            stream: AI.CANCEL_COMPLETE,
            streamId: g,
            reason: BI(c)
          });
        }), s.sinkCapability.reject(d), s.isCancelled = !0, delete this.streamSinks[g];
        break;
      default:
        throw new Error("Unexpected stream case");
    }
  }
  async #i(I, g) {
    await Promise.allSettled([I.startCall?.promise, I.pullCall?.promise, I.cancelCall?.promise]), delete this.streamControllers[g];
  }
  destroy() {
    this.#I?.abort(), this.#I = null;
  }
}
class ml {
  #I = !1;
  constructor({
    enableHWA: I = !1
  }) {
    this.#I = I;
  }
  create(I, g) {
    if (I <= 0 || g <= 0)
      throw new Error("Invalid canvas size");
    const C = this._createCanvas(I, g);
    return {
      canvas: C,
      context: C.getContext("2d", {
        willReadFrequently: !this.#I
      })
    };
  }
  reset(I, g, C) {
    if (!I.canvas)
      throw new Error("Canvas is not specified");
    if (g <= 0 || C <= 0)
      throw new Error("Invalid canvas size");
    I.canvas.width = g, I.canvas.height = C;
  }
  destroy(I) {
    if (!I.canvas)
      throw new Error("Canvas is not specified");
    I.canvas.width = 0, I.canvas.height = 0, I.canvas = null, I.context = null;
  }
  _createCanvas(I, g) {
    f("Abstract method `_createCanvas` called.");
  }
}
class rs extends ml {
  constructor({
    ownerDocument: I = globalThis.document,
    enableHWA: g = !1
  }) {
    super({
      enableHWA: g
    }), this._document = I;
  }
  _createCanvas(I, g) {
    const C = this._document.createElement("canvas");
    return C.width = I, C.height = g, C;
  }
}
class al {
  constructor({
    baseUrl: I = null,
    isCompressed: g = !0
  }) {
    this.baseUrl = I, this.isCompressed = g;
  }
  async fetch({
    name: I
  }) {
    if (!this.baseUrl)
      throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");
    if (!I)
      throw new Error("CMap name must be specified.");
    const g = this.baseUrl + I + (this.isCompressed ? ".bcmap" : "");
    return this._fetch(g).then((C) => ({
      cMapData: C,
      isCompressed: this.isCompressed
    })).catch((C) => {
      throw new Error(`Unable to load ${this.isCompressed ? "binary " : ""}CMap at: ${g}`);
    });
  }
  async _fetch(I) {
    f("Abstract method `_fetch` called.");
  }
}
class Ai extends al {
  async _fetch(I) {
    const g = await $g(I, this.isCompressed ? "arraybuffer" : "text");
    return g instanceof ArrayBuffer ? new Uint8Array(g) : qg(g);
  }
}
class el {
  addFilter(I) {
    return "none";
  }
  addHCMFilter(I, g) {
    return "none";
  }
  addAlphaFilter(I) {
    return "none";
  }
  addLuminosityFilter(I) {
    return "none";
  }
  addHighlightHCMFilter(I, g, C, A, i) {
    return "none";
  }
  destroy(I = !1) {
  }
}
class Ts extends el {
  #I;
  #g;
  #A;
  #C;
  #i;
  #l;
  #s = 0;
  constructor({
    docId: I,
    ownerDocument: g = globalThis.document
  }) {
    super(), this.#C = I, this.#i = g;
  }
  get #d() {
    return this.#g ||= /* @__PURE__ */ new Map();
  }
  get #c() {
    return this.#l ||= /* @__PURE__ */ new Map();
  }
  get #Z() {
    if (!this.#A) {
      const I = this.#i.createElement("div"), {
        style: g
      } = I;
      g.visibility = "hidden", g.contain = "strict", g.width = g.height = 0, g.position = "absolute", g.top = g.left = 0, g.zIndex = -1;
      const C = this.#i.createElementNS(rI, "svg");
      C.setAttribute("width", 0), C.setAttribute("height", 0), this.#A = this.#i.createElementNS(rI, "defs"), I.append(C), C.append(this.#A), this.#i.body.append(I);
    }
    return this.#A;
  }
  #o(I) {
    if (I.length === 1) {
      const d = I[0], c = new Array(256);
      for (let b = 0; b < 256; b++)
        c[b] = d[b] / 255;
      const G = c.join(",");
      return [G, G, G];
    }
    const [g, C, A] = I, i = new Array(256), l = new Array(256), s = new Array(256);
    for (let d = 0; d < 256; d++)
      i[d] = g[d] / 255, l[d] = C[d] / 255, s[d] = A[d] / 255;
    return [i.join(","), l.join(","), s.join(",")];
  }
  #b(I) {
    if (this.#I === void 0) {
      this.#I = "";
      const g = this.#i.URL;
      g !== this.#i.baseURI && (FC(g) ? L('#createUrl: ignore "data:"-URL for performance reasons.') : this.#I = Cl(g, ""));
    }
    return `url(${this.#I}#${I})`;
  }
  addFilter(I) {
    if (!I)
      return "none";
    let g = this.#d.get(I);
    if (g)
      return g;
    const [C, A, i] = this.#o(I), l = I.length === 1 ? C : `${C}${A}${i}`;
    if (g = this.#d.get(l), g)
      return this.#d.set(I, g), g;
    const s = `g_${this.#C}_transfer_map_${this.#s++}`, d = this.#b(s);
    this.#d.set(I, d), this.#d.set(l, d);
    const c = this.#a(s);
    return this.#e(C, A, i, c), d;
  }
  addHCMFilter(I, g) {
    const C = `${I}-${g}`, A = "base";
    let i = this.#c.get(A);
    if (i?.key === C || (i ? (i.filter?.remove(), i.key = C, i.url = "none", i.filter = null) : (i = {
      key: C,
      url: "none",
      filter: null
    }, this.#c.set(A, i)), !I || !g))
      return i.url;
    const l = this.#W(I);
    I = M.makeHexColor(...l);
    const s = this.#W(g);
    if (g = M.makeHexColor(...s), this.#Z.style.color = "", I === "#000000" && g === "#ffffff" || I === g)
      return i.url;
    const d = new Array(256);
    for (let m = 0; m <= 255; m++) {
      const e = m / 255;
      d[m] = e <= 0.03928 ? e / 12.92 : ((e + 0.055) / 1.055) ** 2.4;
    }
    const c = d.join(","), G = `g_${this.#C}_hcm_filter`, b = i.filter = this.#a(G);
    this.#e(c, c, c, b), this.#t(b);
    const o = (m, e) => {
      const a = l[m] / 255, h = s[m] / 255, t = new Array(e + 1);
      for (let W = 0; W <= e; W++)
        t[W] = a + W / e * (h - a);
      return t.join(",");
    };
    return this.#e(o(0, 5), o(1, 5), o(2, 5), b), i.url = this.#b(G), i.url;
  }
  addAlphaFilter(I) {
    let g = this.#d.get(I);
    if (g)
      return g;
    const [C] = this.#o([I]), A = `alpha_${C}`;
    if (g = this.#d.get(A), g)
      return this.#d.set(I, g), g;
    const i = `g_${this.#C}_alpha_map_${this.#s++}`, l = this.#b(i);
    this.#d.set(I, l), this.#d.set(A, l);
    const s = this.#a(i);
    return this.#B(C, s), l;
  }
  addLuminosityFilter(I) {
    let g = this.#d.get(I || "luminosity");
    if (g)
      return g;
    let C, A;
    if (I ? ([C] = this.#o([I]), A = `luminosity_${C}`) : A = "luminosity", g = this.#d.get(A), g)
      return this.#d.set(I, g), g;
    const i = `g_${this.#C}_luminosity_map_${this.#s++}`, l = this.#b(i);
    this.#d.set(I, l), this.#d.set(A, l);
    const s = this.#a(i);
    return this.#m(s), I && this.#B(C, s), l;
  }
  addHighlightHCMFilter(I, g, C, A, i) {
    const l = `${g}-${C}-${A}-${i}`;
    let s = this.#c.get(I);
    if (s?.key === l || (s ? (s.filter?.remove(), s.key = l, s.url = "none", s.filter = null) : (s = {
      key: l,
      url: "none",
      filter: null
    }, this.#c.set(I, s)), !g || !C))
      return s.url;
    const [d, c] = [g, C].map(this.#W.bind(this));
    let G = Math.round(0.2126 * d[0] + 0.7152 * d[1] + 0.0722 * d[2]), b = Math.round(0.2126 * c[0] + 0.7152 * c[1] + 0.0722 * c[2]), [o, m] = [A, i].map(this.#W.bind(this));
    b < G && ([G, b, o, m] = [b, G, m, o]), this.#Z.style.color = "";
    const e = (t, W, B) => {
      const w = new Array(256), n = (b - G) / B, V = t / 255, N = (W - t) / (255 * B);
      let R = 0;
      for (let Y = 0; Y <= B; Y++) {
        const y = Math.round(G + Y * n), X = V + Y * N;
        for (let K = R; K <= y; K++)
          w[K] = X;
        R = y + 1;
      }
      for (let Y = R; Y < 256; Y++)
        w[Y] = w[R - 1];
      return w.join(",");
    }, a = `g_${this.#C}_hcm_${I}_filter`, h = s.filter = this.#a(a);
    return this.#t(h), this.#e(e(o[0], m[0], 5), e(o[1], m[1], 5), e(o[2], m[2], 5), h), s.url = this.#b(a), s.url;
  }
  destroy(I = !1) {
    I && this.#l?.size || (this.#A?.parentNode.parentNode.remove(), this.#A = null, this.#g?.clear(), this.#g = null, this.#l?.clear(), this.#l = null, this.#s = 0);
  }
  #m(I) {
    const g = this.#i.createElementNS(rI, "feColorMatrix");
    g.setAttribute("type", "matrix"), g.setAttribute("values", "0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"), I.append(g);
  }
  #t(I) {
    const g = this.#i.createElementNS(rI, "feColorMatrix");
    g.setAttribute("type", "matrix"), g.setAttribute("values", "0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"), I.append(g);
  }
  #a(I) {
    const g = this.#i.createElementNS(rI, "filter");
    return g.setAttribute("color-interpolation-filters", "sRGB"), g.setAttribute("id", I), this.#Z.append(g), g;
  }
  #G(I, g, C) {
    const A = this.#i.createElementNS(rI, g);
    A.setAttribute("type", "discrete"), A.setAttribute("tableValues", C), I.append(A);
  }
  #e(I, g, C, A) {
    const i = this.#i.createElementNS(rI, "feComponentTransfer");
    A.append(i), this.#G(i, "feFuncR", I), this.#G(i, "feFuncG", g), this.#G(i, "feFuncB", C);
  }
  #B(I, g) {
    const C = this.#i.createElementNS(rI, "feComponentTransfer");
    g.append(C), this.#G(C, "feFuncA", I);
  }
  #W(I) {
    return this.#Z.style.color = I, gC(getComputedStyle(this.#Z).getPropertyValue("color"));
  }
}
class tl {
  constructor({
    baseUrl: I = null
  }) {
    this.baseUrl = I;
  }
  async fetch({
    filename: I
  }) {
    if (!this.baseUrl)
      throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");
    if (!I)
      throw new Error("Font filename must be specified.");
    const g = `${this.baseUrl}${I}`;
    return this._fetch(g).catch((C) => {
      throw new Error(`Unable to load font data at: ${g}`);
    });
  }
  async _fetch(I) {
    f("Abstract method `_fetch` called.");
  }
}
class ii extends tl {
  async _fetch(I) {
    const g = await $g(I, "arraybuffer");
    return new Uint8Array(g);
  }
}
class hl {
  constructor({
    baseUrl: I = null
  }) {
    this.baseUrl = I;
  }
  async fetch({
    filename: I
  }) {
    if (!this.baseUrl)
      throw new Error("Ensure that the `wasmUrl` API parameter is provided.");
    if (!I)
      throw new Error("Wasm filename must be specified.");
    const g = `${this.baseUrl}${I}`;
    return this._fetch(g).catch((C) => {
      throw new Error(`Unable to load wasm data at: ${g}`);
    });
  }
  async _fetch(I) {
    f("Abstract method `_fetch` called.");
  }
}
class li extends hl {
  async _fetch(I) {
    const g = await $g(I, "arraybuffer");
    return new Uint8Array(g);
  }
}
aI && L("Please use the `legacy` build in Node.js environments.");
async function SA(Z) {
  const g = await process.getBuiltinModule("fs").promises.readFile(Z);
  return new Uint8Array(g);
}
class js extends el {
}
class Qs extends ml {
  _createCanvas(I, g) {
    return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(I, g);
  }
}
class xs extends al {
  async _fetch(I) {
    return SA(I);
  }
}
class Os extends tl {
  async _fetch(I) {
    return SA(I);
  }
}
class Us extends hl {
  async _fetch(I) {
    return SA(I);
  }
}
const ag = "__forcedDependency", {
  floor: si,
  ceil: di
} = Math;
function cC(Z, I, g, C, A, i) {
  Z[I * 4 + 0] = Math.min(Z[I * 4 + 0], g), Z[I * 4 + 1] = Math.min(Z[I * 4 + 1], C), Z[I * 4 + 2] = Math.max(Z[I * 4 + 2], A), Z[I * 4 + 3] = Math.max(Z[I * 4 + 3], i);
}
const mA = new Uint32Array(new Uint8Array([255, 255, 0, 0]).buffer)[0];
class vs {
  #I;
  #g;
  constructor(I, g) {
    this.#I = I, this.#g = g;
  }
  get length() {
    return this.#I.length;
  }
  isEmpty(I) {
    return this.#I[I] === mA;
  }
  minX(I) {
    return this.#g[I * 4 + 0] / 256;
  }
  minY(I) {
    return this.#g[I * 4 + 1] / 256;
  }
  maxX(I) {
    return (this.#g[I * 4 + 2] + 1) / 256;
  }
  maxY(I) {
    return (this.#g[I * 4 + 3] + 1) / 256;
  }
}
const GC = (Z, I) => {
  if (!Z)
    return;
  let g = Z.get(I);
  return g || (g = {
    dependencies: /* @__PURE__ */ new Set(),
    isRenderingOperation: !1
  }, Z.set(I, g)), g;
};
class Es {
  #I = {
    __proto__: null
  };
  #g = {
    __proto__: null,
    transform: [],
    moveText: [],
    sameLineText: [],
    [ag]: []
  };
  #A = /* @__PURE__ */ new Map();
  #C = [];
  #i = [];
  #l = [[1, 0, 0, 1, 0, 0]];
  #s = [-1 / 0, -1 / 0, 1 / 0, 1 / 0];
  #d = new Float64Array([1 / 0, 1 / 0, -1 / 0, -1 / 0]);
  #c = -1;
  #Z = /* @__PURE__ */ new Set();
  #o = /* @__PURE__ */ new Map();
  #b = /* @__PURE__ */ new Map();
  #m;
  #t;
  #a;
  #G;
  #e;
  constructor(I, g, C = !1) {
    this.#m = I.width, this.#t = I.height, this.#B(g), C && (this.#e = /* @__PURE__ */ new Map());
  }
  growOperationsCount(I) {
    I >= this.#G.length && this.#B(I, this.#G);
  }
  #B(I, g) {
    const C = new ArrayBuffer(I * 4);
    this.#a = new Uint8ClampedArray(C), this.#G = new Uint32Array(C), g && g.length > 0 ? (this.#G.set(g), this.#G.fill(mA, g.length)) : this.#G.fill(mA);
  }
  save(I) {
    return this.#I = {
      __proto__: this.#I
    }, this.#g = {
      __proto__: this.#g,
      transform: {
        __proto__: this.#g.transform
      },
      moveText: {
        __proto__: this.#g.moveText
      },
      sameLineText: {
        __proto__: this.#g.sameLineText
      },
      [ag]: {
        __proto__: this.#g[ag]
      }
    }, this.#s = {
      __proto__: this.#s
    }, this.#C.push(I), this;
  }
  restore(I) {
    const g = Object.getPrototypeOf(this.#I);
    if (g === null)
      return this;
    this.#I = g, this.#g = Object.getPrototypeOf(this.#g), this.#s = Object.getPrototypeOf(this.#s);
    const C = this.#C.pop();
    return C !== void 0 && (GC(this.#e, I)?.dependencies.add(C), this.#G[I] = this.#G[C]), this;
  }
  recordOpenMarker(I) {
    return this.#C.push(I), this;
  }
  getOpenMarker() {
    return this.#C.length === 0 ? null : this.#C.at(-1);
  }
  recordCloseMarker(I) {
    const g = this.#C.pop();
    return g !== void 0 && (GC(this.#e, I)?.dependencies.add(g), this.#G[I] = this.#G[g]), this;
  }
  beginMarkedContent(I) {
    return this.#i.push(I), this;
  }
  endMarkedContent(I) {
    const g = this.#i.pop();
    return g !== void 0 && (GC(this.#e, I)?.dependencies.add(g), this.#G[I] = this.#G[g]), this;
  }
  pushBaseTransform(I) {
    return this.#l.push(M.multiplyByDOMMatrix(this.#l.at(-1), I.getTransform())), this;
  }
  popBaseTransform() {
    return this.#l.length > 1 && this.#l.pop(), this;
  }
  recordSimpleData(I, g) {
    return this.#I[I] = g, this;
  }
  recordIncrementalData(I, g) {
    return this.#g[I].push(g), this;
  }
  resetIncrementalData(I, g) {
    return this.#g[I].length = 0, this;
  }
  recordNamedData(I, g) {
    return this.#A.set(I, g), this;
  }
  recordSimpleDataFromNamed(I, g, C) {
    this.#I[I] = this.#A.get(g) ?? C;
  }
  recordFutureForcedDependency(I, g) {
    return this.recordIncrementalData(ag, g), this;
  }
  inheritSimpleDataAsFutureForcedDependencies(I) {
    for (const g of I)
      g in this.#I && this.recordFutureForcedDependency(g, this.#I[g]);
    return this;
  }
  inheritPendingDependenciesAsFutureForcedDependencies() {
    for (const I of this.#Z)
      this.recordFutureForcedDependency(ag, I);
    return this;
  }
  resetBBox(I) {
    return this.#c !== I && (this.#c = I, this.#d[0] = 1 / 0, this.#d[1] = 1 / 0, this.#d[2] = -1 / 0, this.#d[3] = -1 / 0), this;
  }
  recordClipBox(I, g, C, A, i, l) {
    const s = M.multiplyByDOMMatrix(this.#l.at(-1), g.getTransform()), d = [1 / 0, 1 / 0, -1 / 0, -1 / 0];
    M.axialAlignedBoundingBox([C, i, A, l], s, d);
    const c = M.intersect(this.#s, d);
    return c ? (this.#s[0] = c[0], this.#s[1] = c[1], this.#s[2] = c[2], this.#s[3] = c[3]) : (this.#s[0] = this.#s[1] = 1 / 0, this.#s[2] = this.#s[3] = -1 / 0), this;
  }
  recordBBox(I, g, C, A, i, l) {
    const s = this.#s;
    if (s[0] === 1 / 0)
      return this;
    const d = M.multiplyByDOMMatrix(this.#l.at(-1), g.getTransform());
    if (s[0] === -1 / 0)
      return M.axialAlignedBoundingBox([C, i, A, l], d, this.#d), this;
    const c = [1 / 0, 1 / 0, -1 / 0, -1 / 0];
    return M.axialAlignedBoundingBox([C, i, A, l], d, c), this.#d[0] = Math.min(this.#d[0], Math.max(c[0], s[0])), this.#d[1] = Math.min(this.#d[1], Math.max(c[1], s[1])), this.#d[2] = Math.max(this.#d[2], Math.min(c[2], s[2])), this.#d[3] = Math.max(this.#d[3], Math.min(c[3], s[3])), this;
  }
  recordCharacterBBox(I, g, C, A = 1, i = 0, l = 0, s) {
    const d = C.bbox;
    let c, G;
    if (d && (c = d[2] !== d[0] && d[3] !== d[1] && this.#b.get(C), c !== !1 && (G = [0, 0, 0, 0], M.axialAlignedBoundingBox(d, C.fontMatrix, G), (A !== 1 || i !== 0 || l !== 0) && M.scaleMinMax([A, 0, 0, -A, i, l], G), c)))
      return this.recordBBox(I, g, G[0], G[2], G[1], G[3]);
    if (!s)
      return this.recordFullPageBBox(I);
    const b = s();
    return d && G && c === void 0 && (c = G[0] <= i - b.actualBoundingBoxLeft && G[2] >= i + b.actualBoundingBoxRight && G[1] <= l - b.actualBoundingBoxAscent && G[3] >= l + b.actualBoundingBoxDescent, this.#b.set(C, c), c) ? this.recordBBox(I, g, G[0], G[2], G[1], G[3]) : this.recordBBox(I, g, i - b.actualBoundingBoxLeft, i + b.actualBoundingBoxRight, l - b.actualBoundingBoxAscent, l + b.actualBoundingBoxDescent);
  }
  recordFullPageBBox(I) {
    return this.#d[0] = Math.max(0, this.#s[0]), this.#d[1] = Math.max(0, this.#s[1]), this.#d[2] = Math.min(this.#m, this.#s[2]), this.#d[3] = Math.min(this.#t, this.#s[3]), this;
  }
  getSimpleIndex(I) {
    return this.#I[I];
  }
  recordDependencies(I, g) {
    const C = this.#Z, A = this.#I, i = this.#g;
    for (const l of g)
      l in this.#I ? C.add(A[l]) : l in i && i[l].forEach(C.add, C);
    return this;
  }
  recordNamedDependency(I, g) {
    return this.#A.has(g) && this.#Z.add(this.#A.get(g)), this;
  }
  recordOperation(I, g = !1) {
    if (this.recordDependencies(I, [ag]), this.#e) {
      const C = GC(this.#e, I), {
        dependencies: A
      } = C;
      this.#Z.forEach(A.add, A), this.#C.forEach(A.add, A), this.#i.forEach(A.add, A), A.delete(I), C.isRenderingOperation = !0;
    }
    if (this.#c === I) {
      const C = si(this.#d[0] * 256 / this.#m), A = si(this.#d[1] * 256 / this.#t), i = di(this.#d[2] * 256 / this.#m), l = di(this.#d[3] * 256 / this.#t);
      cC(this.#a, I, C, A, i, l);
      for (const s of this.#Z)
        s !== I && cC(this.#a, s, C, A, i, l);
      for (const s of this.#C)
        s !== I && cC(this.#a, s, C, A, i, l);
      for (const s of this.#i)
        s !== I && cC(this.#a, s, C, A, i, l);
      g || (this.#Z.clear(), this.#c = -1);
    }
    return this;
  }
  recordShowTextOperation(I, g = !1) {
    const C = Array.from(this.#Z);
    this.recordOperation(I, g), this.recordIncrementalData("sameLineText", I);
    for (const A of C)
      this.recordIncrementalData("sameLineText", A);
    return this;
  }
  bboxToClipBoxDropOperation(I, g = !1) {
    return this.#c === I && (this.#c = -1, this.#s[0] = Math.max(this.#s[0], this.#d[0]), this.#s[1] = Math.max(this.#s[1], this.#d[1]), this.#s[2] = Math.min(this.#s[2], this.#d[2]), this.#s[3] = Math.min(this.#s[3], this.#d[3]), g || this.#Z.clear()), this;
  }
  _takePendingDependencies() {
    const I = this.#Z;
    return this.#Z = /* @__PURE__ */ new Set(), I;
  }
  _extractOperation(I) {
    const g = this.#o.get(I);
    return this.#o.delete(I), g;
  }
  _pushPendingDependencies(I) {
    for (const g of I)
      this.#Z.add(g);
  }
  take() {
    return this.#b.clear(), new vs(this.#G, this.#a);
  }
  takeDebugMetadata() {
    return this.#e;
  }
}
class RC {
  #I;
  #g;
  #A;
  #C = 0;
  #i = 0;
  constructor(I, g, C) {
    if (I instanceof RC && I.#A === !!C)
      return I;
    this.#I = I, this.#g = g, this.#A = !!C;
  }
  growOperationsCount() {
    throw new Error("Unreachable");
  }
  save(I) {
    return this.#i++, this.#I.save(this.#g), this;
  }
  restore(I) {
    return this.#i > 0 && (this.#I.restore(this.#g), this.#i--), this;
  }
  recordOpenMarker(I) {
    return this.#C++, this;
  }
  getOpenMarker() {
    return this.#C > 0 ? this.#g : this.#I.getOpenMarker();
  }
  recordCloseMarker(I) {
    return this.#C--, this;
  }
  beginMarkedContent(I) {
    return this;
  }
  endMarkedContent(I) {
    return this;
  }
  pushBaseTransform(I) {
    return this.#I.pushBaseTransform(I), this;
  }
  popBaseTransform() {
    return this.#I.popBaseTransform(), this;
  }
  recordSimpleData(I, g) {
    return this.#I.recordSimpleData(I, this.#g), this;
  }
  recordIncrementalData(I, g) {
    return this.#I.recordIncrementalData(I, this.#g), this;
  }
  resetIncrementalData(I, g) {
    return this.#I.resetIncrementalData(I, this.#g), this;
  }
  recordNamedData(I, g) {
    return this;
  }
  recordSimpleDataFromNamed(I, g, C) {
    return this.#I.recordSimpleDataFromNamed(I, g, this.#g), this;
  }
  recordFutureForcedDependency(I, g) {
    return this.#I.recordFutureForcedDependency(I, this.#g), this;
  }
  inheritSimpleDataAsFutureForcedDependencies(I) {
    return this.#I.inheritSimpleDataAsFutureForcedDependencies(I), this;
  }
  inheritPendingDependenciesAsFutureForcedDependencies() {
    return this.#I.inheritPendingDependenciesAsFutureForcedDependencies(), this;
  }
  resetBBox(I) {
    return this.#A || this.#I.resetBBox(this.#g), this;
  }
  recordClipBox(I, g, C, A, i, l) {
    return this.#A || this.#I.recordClipBox(this.#g, g, C, A, i, l), this;
  }
  recordBBox(I, g, C, A, i, l) {
    return this.#A || this.#I.recordBBox(this.#g, g, C, A, i, l), this;
  }
  recordCharacterBBox(I, g, C, A, i, l, s) {
    return this.#A || this.#I.recordCharacterBBox(this.#g, g, C, A, i, l, s), this;
  }
  recordFullPageBBox(I) {
    return this.#A || this.#I.recordFullPageBBox(this.#g), this;
  }
  getSimpleIndex(I) {
    return this.#I.getSimpleIndex(I);
  }
  recordDependencies(I, g) {
    return this.#I.recordDependencies(this.#g, g), this;
  }
  recordNamedDependency(I, g) {
    return this.#I.recordNamedDependency(this.#g, g), this;
  }
  recordOperation(I) {
    return this.#I.recordOperation(this.#g, !0), this;
  }
  recordShowTextOperation(I) {
    return this.#I.recordShowTextOperation(this.#g, !0), this;
  }
  bboxToClipBoxDropOperation(I) {
    return this.#A || this.#I.bboxToClipBoxDropOperation(this.#g, !0), this;
  }
  take() {
    throw new Error("Unreachable");
  }
  takeDebugMetadata() {
    throw new Error("Unreachable");
  }
}
const NI = {
  stroke: ["path", "transform", "filter", "strokeColor", "strokeAlpha", "lineWidth", "lineCap", "lineJoin", "miterLimit", "dash"],
  fill: ["path", "transform", "filter", "fillColor", "fillAlpha", "globalCompositeOperation", "SMask"],
  imageXObject: ["transform", "SMask", "filter", "fillAlpha", "strokeAlpha", "globalCompositeOperation"],
  rawFillPath: ["filter", "fillColor", "fillAlpha"],
  showText: ["transform", "leading", "charSpacing", "wordSpacing", "hScale", "textRise", "moveText", "textMatrix", "font", "fontObj", "filter", "fillColor", "textRenderingMode", "SMask", "fillAlpha", "strokeAlpha", "globalCompositeOperation", "sameLineText"],
  transform: ["transform"],
  transformAndFill: ["transform", "fillColor"]
}, cI = {
  FILL: "Fill",
  STROKE: "Stroke",
  SHADING: "Shading"
};
function aA(Z, I) {
  if (!I)
    return;
  const g = I[2] - I[0], C = I[3] - I[1], A = new Path2D();
  A.rect(I[0], I[1], g, C), Z.clip(A);
}
class pA {
  isModifyingCurrentTransform() {
    return !1;
  }
  getPattern() {
    f("Abstract method `getPattern` called.");
  }
}
class Ps extends pA {
  constructor(I) {
    super(), this._type = I[1], this._bbox = I[2], this._colorStops = I[3], this._p0 = I[4], this._p1 = I[5], this._r0 = I[6], this._r1 = I[7], this.matrix = null;
  }
  _createGradient(I) {
    let g;
    this._type === "axial" ? g = I.createLinearGradient(this._p0[0], this._p0[1], this._p1[0], this._p1[1]) : this._type === "radial" && (g = I.createRadialGradient(this._p0[0], this._p0[1], this._r0, this._p1[0], this._p1[1], this._r1));
    for (const C of this._colorStops)
      g.addColorStop(C[0], C[1]);
    return g;
  }
  getPattern(I, g, C, A) {
    let i;
    if (A === cI.STROKE || A === cI.FILL) {
      const l = g.current.getClippedPathBoundingBox(A, q(I)) || [0, 0, 0, 0], s = Math.ceil(l[2] - l[0]) || 1, d = Math.ceil(l[3] - l[1]) || 1, c = g.cachedCanvases.getCanvas("pattern", s, d), G = c.context;
      G.clearRect(0, 0, G.canvas.width, G.canvas.height), G.beginPath(), G.rect(0, 0, G.canvas.width, G.canvas.height), G.translate(-l[0], -l[1]), C = M.transform(C, [1, 0, 0, 1, l[0], l[1]]), G.transform(...g.baseTransform), this.matrix && G.transform(...this.matrix), aA(G, this._bbox), G.fillStyle = this._createGradient(G), G.fill(), i = I.createPattern(c.canvas, "no-repeat");
      const b = new DOMMatrix(C);
      i.setTransform(b);
    } else
      aA(I, this._bbox), i = this._createGradient(I);
    return i;
  }
}
function vC(Z, I, g, C, A, i, l, s) {
  const d = I.coords, c = I.colors, G = Z.data, b = Z.width * 4;
  let o;
  d[g + 1] > d[C + 1] && (o = g, g = C, C = o, o = i, i = l, l = o), d[C + 1] > d[A + 1] && (o = C, C = A, A = o, o = l, l = s, s = o), d[g + 1] > d[C + 1] && (o = g, g = C, C = o, o = i, i = l, l = o);
  const m = (d[g] + I.offsetX) * I.scaleX, e = (d[g + 1] + I.offsetY) * I.scaleY, a = (d[C] + I.offsetX) * I.scaleX, h = (d[C + 1] + I.offsetY) * I.scaleY, t = (d[A] + I.offsetX) * I.scaleX, W = (d[A + 1] + I.offsetY) * I.scaleY;
  if (e >= W)
    return;
  const B = c[i], w = c[i + 1], n = c[i + 2], V = c[l], N = c[l + 1], R = c[l + 2], Y = c[s], y = c[s + 1], X = c[s + 2], K = Math.round(e), S = Math.round(W);
  let p, r, D, z, U, mI, kI, UI;
  for (let sI = K; sI <= S; sI++) {
    if (sI < h) {
      const CI = sI < e ? 0 : (e - sI) / (e - h);
      p = m - (m - a) * CI, r = B - (B - V) * CI, D = w - (w - N) * CI, z = n - (n - R) * CI;
    } else {
      let CI;
      sI > W ? CI = 1 : h === W ? CI = 0 : CI = (h - sI) / (h - W), p = a - (a - t) * CI, r = V - (V - Y) * CI, D = N - (N - y) * CI, z = R - (R - X) * CI;
    }
    let _;
    sI < e ? _ = 0 : sI > W ? _ = 1 : _ = (e - sI) / (e - W), U = m - (m - t) * _, mI = B - (B - Y) * _, kI = w - (w - y) * _, UI = n - (n - X) * _;
    const Cg = Math.round(Math.min(p, U)), vI = Math.round(Math.max(p, U));
    let EI = b * sI + Cg * 4;
    for (let CI = Cg; CI <= vI; CI++)
      _ = (p - CI) / (p - U), _ < 0 ? _ = 0 : _ > 1 && (_ = 1), G[EI++] = r - (r - mI) * _ | 0, G[EI++] = D - (D - kI) * _ | 0, G[EI++] = z - (z - UI) * _ | 0, G[EI++] = 255;
  }
}
function fs(Z, I, g) {
  const C = I.coords, A = I.colors;
  let i, l;
  switch (I.type) {
    case "lattice":
      const s = I.verticesPerRow, d = Math.floor(C.length / s) - 1, c = s - 1;
      for (i = 0; i < d; i++) {
        let G = i * s;
        for (let b = 0; b < c; b++, G++)
          vC(Z, g, C[G], C[G + 1], C[G + s], A[G], A[G + 1], A[G + s]), vC(Z, g, C[G + s + 1], C[G + 1], C[G + s], A[G + s + 1], A[G + 1], A[G + s]);
      }
      break;
    case "triangles":
      for (i = 0, l = C.length; i < l; i += 3)
        vC(Z, g, C[i], C[i + 1], C[i + 2], A[i], A[i + 1], A[i + 2]);
      break;
    default:
      throw new Error("illegal figure");
  }
}
class _s extends pA {
  constructor(I) {
    super(), this._coords = I[2], this._colors = I[3], this._figures = I[4], this._bounds = I[5], this._bbox = I[6], this._background = I[7], this.matrix = null;
  }
  _createMeshCanvas(I, g, C) {
    const s = Math.floor(this._bounds[0]), d = Math.floor(this._bounds[1]), c = Math.ceil(this._bounds[2]) - s, G = Math.ceil(this._bounds[3]) - d, b = Math.min(Math.ceil(Math.abs(c * I[0] * 1.1)), 3e3), o = Math.min(Math.ceil(Math.abs(G * I[1] * 1.1)), 3e3), m = c / b, e = G / o, a = {
      coords: this._coords,
      colors: this._colors,
      offsetX: -s,
      offsetY: -d,
      scaleX: 1 / m,
      scaleY: 1 / e
    }, h = b + 4, t = o + 4, W = C.getCanvas("mesh", h, t), B = W.context, w = B.createImageData(b, o);
    if (g) {
      const V = w.data;
      for (let N = 0, R = V.length; N < R; N += 4)
        V[N] = g[0], V[N + 1] = g[1], V[N + 2] = g[2], V[N + 3] = 255;
    }
    for (const V of this._figures)
      fs(w, V, a);
    return B.putImageData(w, 2, 2), {
      canvas: W.canvas,
      offsetX: s - 2 * m,
      offsetY: d - 2 * e,
      scaleX: m,
      scaleY: e
    };
  }
  isModifyingCurrentTransform() {
    return !0;
  }
  getPattern(I, g, C, A) {
    aA(I, this._bbox);
    const i = new Float32Array(2);
    if (A === cI.SHADING)
      M.singularValueDecompose2dScale(q(I), i);
    else if (this.matrix) {
      M.singularValueDecompose2dScale(this.matrix, i);
      const [s, d] = i;
      M.singularValueDecompose2dScale(g.baseTransform, i), i[0] *= s, i[1] *= d;
    } else
      M.singularValueDecompose2dScale(g.baseTransform, i);
    const l = this._createMeshCanvas(i, A === cI.SHADING ? null : this._background, g.cachedCanvases);
    return A !== cI.SHADING && (I.setTransform(...g.baseTransform), this.matrix && I.transform(...this.matrix)), I.translate(l.offsetX, l.offsetY), I.scale(l.scaleX, l.scaleY), I.createPattern(l.canvas, "no-repeat");
  }
}
class qs extends pA {
  getPattern() {
    return "hotpink";
  }
}
function $s(Z) {
  switch (Z[0]) {
    case "RadialAxial":
      return new Ps(Z);
    case "Mesh":
      return new _s(Z);
    case "Dummy":
      return new qs();
  }
  throw new Error(`Unknown IR type: ${Z[0]}`);
}
const Zi = {
  COLORED: 1,
  UNCOLORED: 2
};
class FA {
  static MAX_PATTERN_SIZE = 3e3;
  constructor(I, g, C, A) {
    this.color = I[1], this.operatorList = I[2], this.matrix = I[3], this.bbox = I[4], this.xstep = I[5], this.ystep = I[6], this.paintType = I[7], this.tilingType = I[8], this.ctx = g, this.canvasGraphicsFactory = C, this.baseTransform = A;
  }
  createPatternCanvas(I, g) {
    const {
      bbox: C,
      operatorList: A,
      paintType: i,
      tilingType: l,
      color: s,
      canvasGraphicsFactory: d
    } = this;
    let {
      xstep: c,
      ystep: G
    } = this;
    c = Math.abs(c), G = Math.abs(G), pC("TilingType: " + l);
    const b = C[0], o = C[1], m = C[2], e = C[3], a = m - b, h = e - o, t = new Float32Array(2);
    M.singularValueDecompose2dScale(this.matrix, t);
    const [W, B] = t;
    M.singularValueDecompose2dScale(this.baseTransform, t);
    const w = W * t[0], n = B * t[1];
    let V = a, N = h, R = !1, Y = !1;
    const y = Math.ceil(c * w), X = Math.ceil(G * n), K = Math.ceil(a * w), S = Math.ceil(h * n);
    y >= K ? V = c : R = !0, X >= S ? N = G : Y = !0;
    const p = this.getSizeAndScale(V, this.ctx.canvas.width, w), r = this.getSizeAndScale(N, this.ctx.canvas.height, n), D = I.cachedCanvases.getCanvas("pattern", p.size, r.size), z = D.context, U = d.createCanvasGraphics(z, g);
    if (U.groupLevel = I.groupLevel, this.setFillAndStrokeStyleToContext(U, i, s), z.translate(-p.scale * b, -r.scale * o), U.transform(0, p.scale, 0, 0, r.scale, 0, 0), z.save(), U.dependencyTracker?.save(), this.clipBbox(U, b, o, m, e), U.baseTransform = q(U.ctx), U.executeOperatorList(A), U.endDrawing(), U.dependencyTracker?.restore(), z.restore(), R || Y) {
      const mI = D.canvas;
      R && (V = c), Y && (N = G);
      const kI = this.getSizeAndScale(V, this.ctx.canvas.width, w), UI = this.getSizeAndScale(N, this.ctx.canvas.height, n), sI = kI.size, _ = UI.size, Cg = I.cachedCanvases.getCanvas("pattern-workaround", sI, _), vI = Cg.context, EI = R ? Math.floor(a / c) : 0, CI = Y ? Math.floor(h / G) : 0;
      for (let Dg = 0; Dg <= EI; Dg++)
        for (let Kg = 0; Kg <= CI; Kg++)
          vI.drawImage(mI, sI * Dg, _ * Kg, sI, _, 0, 0, sI, _);
      return {
        canvas: Cg.canvas,
        scaleX: kI.scale,
        scaleY: UI.scale,
        offsetX: b,
        offsetY: o
      };
    }
    return {
      canvas: D.canvas,
      scaleX: p.scale,
      scaleY: r.scale,
      offsetX: b,
      offsetY: o
    };
  }
  getSizeAndScale(I, g, C) {
    const A = Math.max(FA.MAX_PATTERN_SIZE, g);
    let i = Math.ceil(I * C);
    return i >= A ? i = A : C = i / I, {
      scale: C,
      size: i
    };
  }
  clipBbox(I, g, C, A, i) {
    const l = A - g, s = i - C;
    I.ctx.rect(g, C, l, s), M.axialAlignedBoundingBox([g, C, A, i], q(I.ctx), I.current.minMax), I.clip(), I.endPath();
  }
  setFillAndStrokeStyleToContext(I, g, C) {
    const A = I.ctx, i = I.current;
    switch (g) {
      case Zi.COLORED:
        const {
          fillStyle: l,
          strokeStyle: s
        } = this.ctx;
        A.fillStyle = i.fillColor = l, A.strokeStyle = i.strokeColor = s;
        break;
      case Zi.UNCOLORED:
        A.fillStyle = A.strokeStyle = C, i.fillColor = i.strokeColor = C;
        break;
      default:
        throw new os(`Unsupported paint type: ${g}`);
    }
  }
  isModifyingCurrentTransform() {
    return !1;
  }
  getPattern(I, g, C, A, i) {
    let l = C;
    A !== cI.SHADING && (l = M.transform(l, g.baseTransform), this.matrix && (l = M.transform(l, this.matrix)));
    const s = this.createPatternCanvas(g, i);
    let d = new DOMMatrix(l);
    d = d.translate(s.offsetX, s.offsetY), d = d.scale(1 / s.scaleX, 1 / s.scaleY);
    const c = I.createPattern(s.canvas, "repeat");
    return c.setTransform(d), c;
  }
}
function Id({
  src: Z,
  srcPos: I = 0,
  dest: g,
  width: C,
  height: A,
  nonBlackColor: i = 4294967295,
  inverseDecode: l = !1
}) {
  const s = GI.isLittleEndian ? 4278190080 : 255, [d, c] = l ? [i, s] : [s, i], G = C >> 3, b = C & 7, o = Z.length;
  g = new Uint32Array(g.buffer);
  let m = 0;
  for (let e = 0; e < A; e++) {
    for (const h = I + G; I < h; I++) {
      const t = I < o ? Z[I] : 255;
      g[m++] = t & 128 ? c : d, g[m++] = t & 64 ? c : d, g[m++] = t & 32 ? c : d, g[m++] = t & 16 ? c : d, g[m++] = t & 8 ? c : d, g[m++] = t & 4 ? c : d, g[m++] = t & 2 ? c : d, g[m++] = t & 1 ? c : d;
    }
    if (b === 0)
      continue;
    const a = I < o ? Z[I++] : 255;
    for (let h = 0; h < b; h++)
      g[m++] = a & 1 << 7 - h ? c : d;
  }
  return {
    srcPos: I,
    destPos: m
  };
}
const ci = 16, Gi = 100, gd = 15, bi = 10, wI = 16, EC = new DOMMatrix(), YI = new Float32Array(2), Wg = new Float32Array([1 / 0, 1 / 0, -1 / 0, -1 / 0]);
function Cd(Z, I) {
  if (Z._removeMirroring)
    throw new Error("Context is already forwarding operations.");
  Z.__originalSave = Z.save, Z.__originalRestore = Z.restore, Z.__originalRotate = Z.rotate, Z.__originalScale = Z.scale, Z.__originalTranslate = Z.translate, Z.__originalTransform = Z.transform, Z.__originalSetTransform = Z.setTransform, Z.__originalResetTransform = Z.resetTransform, Z.__originalClip = Z.clip, Z.__originalMoveTo = Z.moveTo, Z.__originalLineTo = Z.lineTo, Z.__originalBezierCurveTo = Z.bezierCurveTo, Z.__originalRect = Z.rect, Z.__originalClosePath = Z.closePath, Z.__originalBeginPath = Z.beginPath, Z._removeMirroring = () => {
    Z.save = Z.__originalSave, Z.restore = Z.__originalRestore, Z.rotate = Z.__originalRotate, Z.scale = Z.__originalScale, Z.translate = Z.__originalTranslate, Z.transform = Z.__originalTransform, Z.setTransform = Z.__originalSetTransform, Z.resetTransform = Z.__originalResetTransform, Z.clip = Z.__originalClip, Z.moveTo = Z.__originalMoveTo, Z.lineTo = Z.__originalLineTo, Z.bezierCurveTo = Z.__originalBezierCurveTo, Z.rect = Z.__originalRect, Z.closePath = Z.__originalClosePath, Z.beginPath = Z.__originalBeginPath, delete Z._removeMirroring;
  }, Z.save = function() {
    I.save(), this.__originalSave();
  }, Z.restore = function() {
    I.restore(), this.__originalRestore();
  }, Z.translate = function(g, C) {
    I.translate(g, C), this.__originalTranslate(g, C);
  }, Z.scale = function(g, C) {
    I.scale(g, C), this.__originalScale(g, C);
  }, Z.transform = function(g, C, A, i, l, s) {
    I.transform(g, C, A, i, l, s), this.__originalTransform(g, C, A, i, l, s);
  }, Z.setTransform = function(g, C, A, i, l, s) {
    I.setTransform(g, C, A, i, l, s), this.__originalSetTransform(g, C, A, i, l, s);
  }, Z.resetTransform = function() {
    I.resetTransform(), this.__originalResetTransform();
  }, Z.rotate = function(g) {
    I.rotate(g), this.__originalRotate(g);
  }, Z.clip = function(g) {
    I.clip(g), this.__originalClip(g);
  }, Z.moveTo = function(g, C) {
    I.moveTo(g, C), this.__originalMoveTo(g, C);
  }, Z.lineTo = function(g, C) {
    I.lineTo(g, C), this.__originalLineTo(g, C);
  }, Z.bezierCurveTo = function(g, C, A, i, l, s) {
    I.bezierCurveTo(g, C, A, i, l, s), this.__originalBezierCurveTo(g, C, A, i, l, s);
  }, Z.rect = function(g, C, A, i) {
    I.rect(g, C, A, i), this.__originalRect(g, C, A, i);
  }, Z.closePath = function() {
    I.closePath(), this.__originalClosePath();
  }, Z.beginPath = function() {
    I.beginPath(), this.__originalBeginPath();
  };
}
class Ad {
  constructor(I) {
    this.canvasFactory = I, this.cache = /* @__PURE__ */ Object.create(null);
  }
  getCanvas(I, g, C) {
    let A;
    return this.cache[I] !== void 0 ? (A = this.cache[I], this.canvasFactory.reset(A, g, C)) : (A = this.canvasFactory.create(g, C), this.cache[I] = A), A;
  }
  delete(I) {
    delete this.cache[I];
  }
  clear() {
    for (const I in this.cache) {
      const g = this.cache[I];
      this.canvasFactory.destroy(g), delete this.cache[I];
    }
  }
}
function bC(Z, I, g, C, A, i, l, s, d, c) {
  const [G, b, o, m, e, a] = q(Z);
  if (b === 0 && o === 0) {
    const W = l * G + e, B = Math.round(W), w = s * m + a, n = Math.round(w), V = (l + d) * G + e, N = Math.abs(Math.round(V) - B) || 1, R = (s + c) * m + a, Y = Math.abs(Math.round(R) - n) || 1;
    return Z.setTransform(Math.sign(G), 0, 0, Math.sign(m), B, n), Z.drawImage(I, g, C, A, i, 0, 0, N, Y), Z.setTransform(G, b, o, m, e, a), [N, Y];
  }
  if (G === 0 && m === 0) {
    const W = s * o + e, B = Math.round(W), w = l * b + a, n = Math.round(w), V = (s + c) * o + e, N = Math.abs(Math.round(V) - B) || 1, R = (l + d) * b + a, Y = Math.abs(Math.round(R) - n) || 1;
    return Z.setTransform(0, Math.sign(b), Math.sign(o), 0, B, n), Z.drawImage(I, g, C, A, i, 0, 0, Y, N), Z.setTransform(G, b, o, m, e, a), [Y, N];
  }
  Z.drawImage(I, g, C, A, i, l, s, d, c);
  const h = Math.hypot(G, b), t = Math.hypot(o, m);
  return [h * d, t * c];
}
class oi {
  alphaIsShape = !1;
  fontSize = 0;
  fontSizeScale = 1;
  textMatrix = null;
  textMatrixScale = 1;
  fontMatrix = iA;
  leading = 0;
  x = 0;
  y = 0;
  lineX = 0;
  lineY = 0;
  charSpacing = 0;
  wordSpacing = 0;
  textHScale = 1;
  textRenderingMode = ZI.FILL;
  textRise = 0;
  fillColor = "#000000";
  strokeColor = "#000000";
  patternFill = !1;
  patternStroke = !1;
  fillAlpha = 1;
  strokeAlpha = 1;
  lineWidth = 1;
  activeSMask = null;
  transferMaps = "none";
  constructor(I, g, C) {
    C?.(this), this.clipBox = new Float32Array([0, 0, I, g]), this.minMax = Wg.slice();
  }
  clone() {
    const I = Object.create(this);
    return I.clipBox = this.clipBox.slice(), I.minMax = this.minMax.slice(), I;
  }
  getPathBoundingBox(I = cI.FILL, g = null) {
    const C = this.minMax.slice();
    if (I === cI.STROKE) {
      g || f("Stroke bounding box must include transform."), M.singularValueDecompose2dScale(g, YI);
      const A = YI[0] * this.lineWidth / 2, i = YI[1] * this.lineWidth / 2;
      C[0] -= A, C[1] -= i, C[2] += A, C[3] += i;
    }
    return C;
  }
  updateClipFromPath() {
    const I = M.intersect(this.clipBox, this.getPathBoundingBox());
    this.startNewPathAndClipBox(I || [0, 0, 0, 0]);
  }
  isEmptyClip() {
    return this.minMax[0] === 1 / 0;
  }
  startNewPathAndClipBox(I) {
    this.clipBox.set(I, 0), this.minMax.set(Wg, 0);
  }
  getClippedPathBoundingBox(I = cI.FILL, g = null) {
    return M.intersect(this.clipBox, this.getPathBoundingBox(I, g));
  }
}
function mi(Z, I) {
  if (I instanceof ImageData) {
    Z.putImageData(I, 0, 0);
    return;
  }
  const g = I.height, C = I.width, A = g % wI, i = (g - A) / wI, l = A === 0 ? i : i + 1, s = Z.createImageData(C, wI);
  let d = 0, c;
  const G = I.data, b = s.data;
  let o, m, e, a;
  if (I.kind === wC.GRAYSCALE_1BPP) {
    const h = G.byteLength, t = new Uint32Array(b.buffer, 0, b.byteLength >> 2), W = t.length, B = C + 7 >> 3, w = 4294967295, n = GI.isLittleEndian ? 4278190080 : 255;
    for (o = 0; o < l; o++) {
      for (e = o < i ? wI : A, c = 0, m = 0; m < e; m++) {
        const V = h - d;
        let N = 0;
        const R = V > B ? C : V * 8 - 7, Y = R & -8;
        let y = 0, X = 0;
        for (; N < Y; N += 8)
          X = G[d++], t[c++] = X & 128 ? w : n, t[c++] = X & 64 ? w : n, t[c++] = X & 32 ? w : n, t[c++] = X & 16 ? w : n, t[c++] = X & 8 ? w : n, t[c++] = X & 4 ? w : n, t[c++] = X & 2 ? w : n, t[c++] = X & 1 ? w : n;
        for (; N < R; N++)
          y === 0 && (X = G[d++], y = 128), t[c++] = X & y ? w : n, y >>= 1;
      }
      for (; c < W; )
        t[c++] = 0;
      Z.putImageData(s, 0, o * wI);
    }
  } else if (I.kind === wC.RGBA_32BPP) {
    for (m = 0, a = C * wI * 4, o = 0; o < i; o++)
      b.set(G.subarray(d, d + a)), d += a, Z.putImageData(s, 0, m), m += wI;
    o < l && (a = C * A * 4, b.set(G.subarray(d, d + a)), Z.putImageData(s, 0, m));
  } else if (I.kind === wC.RGB_24BPP)
    for (e = wI, a = C * e, o = 0; o < l; o++) {
      for (o >= i && (e = A, a = C * e), c = 0, m = a; m--; )
        b[c++] = G[d++], b[c++] = G[d++], b[c++] = G[d++], b[c++] = 255;
      Z.putImageData(s, 0, o * wI);
    }
  else
    throw new Error(`bad image kind: ${I.kind}`);
}
function ai(Z, I) {
  if (I.bitmap) {
    Z.drawImage(I.bitmap, 0, 0);
    return;
  }
  const g = I.height, C = I.width, A = g % wI, i = (g - A) / wI, l = A === 0 ? i : i + 1, s = Z.createImageData(C, wI);
  let d = 0;
  const c = I.data, G = s.data;
  for (let b = 0; b < l; b++) {
    const o = b < i ? wI : A;
    ({
      srcPos: d
    } = Id({
      src: c,
      srcPos: d,
      dest: G,
      width: C,
      height: o,
      nonBlackColor: 0
    })), Z.putImageData(s, 0, b * wI);
  }
}
function Sg(Z, I) {
  const g = ["strokeStyle", "fillStyle", "fillRule", "globalAlpha", "lineWidth", "lineCap", "lineJoin", "miterLimit", "globalCompositeOperation", "font", "filter"];
  for (const C of g)
    Z[C] !== void 0 && (I[C] = Z[C]);
  Z.setLineDash !== void 0 && (I.setLineDash(Z.getLineDash()), I.lineDashOffset = Z.lineDashOffset);
}
function oC(Z) {
  Z.strokeStyle = Z.fillStyle = "#000000", Z.fillRule = "nonzero", Z.globalAlpha = 1, Z.lineWidth = 1, Z.lineCap = "butt", Z.lineJoin = "miter", Z.miterLimit = 10, Z.globalCompositeOperation = "source-over", Z.font = "10px sans-serif", Z.setLineDash !== void 0 && (Z.setLineDash([]), Z.lineDashOffset = 0);
  const {
    filter: I
  } = Z;
  I !== "none" && I !== "" && (Z.filter = "none");
}
function ei(Z, I) {
  if (I)
    return !0;
  M.singularValueDecompose2dScale(Z, YI);
  const g = Math.fround(Gg.pixelRatio * Hg.PDF_TO_CSS_UNITS);
  return YI[0] <= g && YI[1] <= g;
}
const id = ["butt", "round", "square"], ld = ["miter", "round", "bevel"], sd = {}, ti = {};
class ng {
  constructor(I, g, C, A, i, {
    optionalContentConfig: l,
    markedContentStack: s = null
  }, d, c, G) {
    this.ctx = I, this.current = new oi(this.ctx.canvas.width, this.ctx.canvas.height), this.stateStack = [], this.pendingClip = null, this.pendingEOFill = !1, this.res = null, this.xobjs = null, this.commonObjs = g, this.objs = C, this.canvasFactory = A, this.filterFactory = i, this.groupStack = [], this.baseTransform = null, this.baseTransformStack = [], this.groupLevel = 0, this.smaskStack = [], this.smaskCounter = 0, this.tempSMask = null, this.suspendedCtx = null, this.contentVisible = !0, this.markedContentStack = s || [], this.optionalContentConfig = l, this.cachedCanvases = new Ad(this.canvasFactory), this.cachedPatterns = /* @__PURE__ */ new Map(), this.annotationCanvasMap = d, this.viewportScale = 1, this.outputScaleX = 1, this.outputScaleY = 1, this.pageColors = c, this._cachedScaleForStroking = [-1, 0], this._cachedGetSinglePixelWidth = null, this._cachedBitmapsMap = /* @__PURE__ */ new Map(), this.dependencyTracker = G ?? null;
  }
  getObject(I, g, C = null) {
    return typeof g == "string" ? (this.dependencyTracker?.recordNamedDependency(I, g), g.startsWith("g_") ? this.commonObjs.get(g) : this.objs.get(g)) : C;
  }
  beginDrawing({
    transform: I,
    viewport: g,
    transparency: C = !1,
    background: A = null
  }) {
    const i = this.ctx.canvas.width, l = this.ctx.canvas.height, s = this.ctx.fillStyle;
    if (this.ctx.fillStyle = A || "#ffffff", this.ctx.fillRect(0, 0, i, l), this.ctx.fillStyle = s, C) {
      const d = this.cachedCanvases.getCanvas("transparent", i, l);
      this.compositeCtx = this.ctx, this.transparentCanvas = d.canvas, this.ctx = d.context, this.ctx.save(), this.ctx.transform(...q(this.compositeCtx));
    }
    this.ctx.save(), oC(this.ctx), I && (this.ctx.transform(...I), this.outputScaleX = I[0], this.outputScaleY = I[0]), this.ctx.transform(...g.transform), this.viewportScale = g.scale, this.baseTransform = q(this.ctx);
  }
  executeOperatorList(I, g, C, A, i) {
    const l = I.argsArray, s = I.fnArray;
    let d = g || 0;
    const c = l.length;
    if (c === d)
      return d;
    const G = c - d > bi && typeof C == "function", b = G ? Date.now() + gd : 0;
    let o = 0;
    const m = this.commonObjs, e = this.objs;
    let a, h;
    for (; ; ) {
      if (A !== void 0 && d === A.nextBreakPoint)
        return A.breakIt(d, C), d;
      if (!i || i(d))
        if (a = s[d], h = l[d] ?? null, a !== Ug.dependency)
          h === null ? this[a](d) : this[a](d, ...h);
        else
          for (const t of h) {
            this.dependencyTracker?.recordNamedData(t, d);
            const W = t.startsWith("g_") ? m : e;
            if (!W.has(t))
              return W.get(t, C), d;
          }
      if (d++, d === c)
        return d;
      if (G && ++o > bi) {
        if (Date.now() > b)
          return C(), d;
        o = 0;
      }
    }
  }
  #I() {
    for (; this.stateStack.length || this.inSMaskMode; )
      this.restore();
    this.current.activeSMask = null, this.ctx.restore(), this.transparentCanvas && (this.ctx = this.compositeCtx, this.ctx.save(), this.ctx.setTransform(1, 0, 0, 1, 0, 0), this.ctx.drawImage(this.transparentCanvas, 0, 0), this.ctx.restore(), this.transparentCanvas = null);
  }
  endDrawing() {
    this.#I(), this.cachedCanvases.clear(), this.cachedPatterns.clear();
    for (const I of this._cachedBitmapsMap.values()) {
      for (const g of I.values())
        typeof HTMLCanvasElement < "u" && g instanceof HTMLCanvasElement && (g.width = g.height = 0);
      I.clear();
    }
    this._cachedBitmapsMap.clear(), this.#g();
  }
  #g() {
    if (this.pageColors) {
      const I = this.filterFactory.addHCMFilter(this.pageColors.foreground, this.pageColors.background);
      if (I !== "none") {
        const g = this.ctx.filter;
        this.ctx.filter = I, this.ctx.drawImage(this.ctx.canvas, 0, 0), this.ctx.filter = g;
      }
    }
  }
  _scaleImage(I, g) {
    const C = I.width ?? I.displayWidth, A = I.height ?? I.displayHeight;
    let i = Math.max(Math.hypot(g[0], g[1]), 1), l = Math.max(Math.hypot(g[2], g[3]), 1), s = C, d = A, c = "prescale1", G, b;
    for (; i > 2 && s > 1 || l > 2 && d > 1; ) {
      let o = s, m = d;
      i > 2 && s > 1 && (o = s >= 16384 ? Math.floor(s / 2) - 1 || 1 : Math.ceil(s / 2), i /= s / o), l > 2 && d > 1 && (m = d >= 16384 ? Math.floor(d / 2) - 1 || 1 : Math.ceil(d) / 2, l /= d / m), G = this.cachedCanvases.getCanvas(c, o, m), b = G.context, b.clearRect(0, 0, o, m), b.drawImage(I, 0, 0, s, d, 0, 0, o, m), I = G.canvas, s = o, d = m, c = c === "prescale1" ? "prescale2" : "prescale1";
    }
    return {
      img: I,
      paintWidth: s,
      paintHeight: d
    };
  }
  _createMaskCanvas(I, g) {
    const C = this.ctx, {
      width: A,
      height: i
    } = g, l = this.current.fillColor, s = this.current.patternFill, d = q(C);
    let c, G, b, o;
    if ((g.bitmap || g.data) && g.count > 1) {
      const y = g.bitmap || g.data.buffer;
      G = JSON.stringify(s ? d : [d.slice(0, 4), l]), c = this._cachedBitmapsMap.get(y), c || (c = /* @__PURE__ */ new Map(), this._cachedBitmapsMap.set(y, c));
      const X = c.get(G);
      if (X && !s) {
        const K = Math.round(Math.min(d[0], d[2]) + d[4]), S = Math.round(Math.min(d[1], d[3]) + d[5]);
        return this.dependencyTracker?.recordDependencies(I, NI.transformAndFill), {
          canvas: X,
          offsetX: K,
          offsetY: S
        };
      }
      b = X;
    }
    b || (o = this.cachedCanvases.getCanvas("maskCanvas", A, i), ai(o.context, g));
    let m = M.transform(d, [1 / A, 0, 0, -1 / i, 0, 0]);
    m = M.transform(m, [1, 0, 0, 1, 0, -i]);
    const e = Wg.slice();
    M.axialAlignedBoundingBox([0, 0, A, i], m, e);
    const [a, h, t, W] = e, B = Math.round(t - a) || 1, w = Math.round(W - h) || 1, n = this.cachedCanvases.getCanvas("fillCanvas", B, w), V = n.context, N = a, R = h;
    V.translate(-N, -R), V.transform(...m), b || (b = this._scaleImage(o.canvas, DI(V)), b = b.img, c && s && c.set(G, b)), V.imageSmoothingEnabled = ei(q(V), g.interpolate), bC(V, b, 0, 0, b.width, b.height, 0, 0, A, i), V.globalCompositeOperation = "source-in";
    const Y = M.transform(DI(V), [1, 0, 0, 1, -N, -R]);
    return V.fillStyle = s ? l.getPattern(C, this, Y, cI.FILL, I) : l, V.fillRect(0, 0, A, i), c && !s && (this.cachedCanvases.delete("fillCanvas"), c.set(G, n.canvas)), this.dependencyTracker?.recordDependencies(I, NI.transformAndFill), {
      canvas: n.canvas,
      offsetX: Math.round(N),
      offsetY: Math.round(R)
    };
  }
  setLineWidth(I, g) {
    this.dependencyTracker?.recordSimpleData("lineWidth", I), g !== this.current.lineWidth && (this._cachedScaleForStroking[0] = -1), this.current.lineWidth = g, this.ctx.lineWidth = g;
  }
  setLineCap(I, g) {
    this.dependencyTracker?.recordSimpleData("lineCap", I), this.ctx.lineCap = id[g];
  }
  setLineJoin(I, g) {
    this.dependencyTracker?.recordSimpleData("lineJoin", I), this.ctx.lineJoin = ld[g];
  }
  setMiterLimit(I, g) {
    this.dependencyTracker?.recordSimpleData("miterLimit", I), this.ctx.miterLimit = g;
  }
  setDash(I, g, C) {
    this.dependencyTracker?.recordSimpleData("dash", I);
    const A = this.ctx;
    A.setLineDash !== void 0 && (A.setLineDash(g), A.lineDashOffset = C);
  }
  setRenderingIntent(I, g) {
  }
  setFlatness(I, g) {
  }
  setGState(I, g) {
    for (const [C, A] of g)
      switch (C) {
        case "LW":
          this.setLineWidth(I, A);
          break;
        case "LC":
          this.setLineCap(I, A);
          break;
        case "LJ":
          this.setLineJoin(I, A);
          break;
        case "ML":
          this.setMiterLimit(I, A);
          break;
        case "D":
          this.setDash(I, A[0], A[1]);
          break;
        case "RI":
          this.setRenderingIntent(I, A);
          break;
        case "FL":
          this.setFlatness(I, A);
          break;
        case "Font":
          this.setFont(I, A[0], A[1]);
          break;
        case "CA":
          this.dependencyTracker?.recordSimpleData("strokeAlpha", I), this.current.strokeAlpha = A;
          break;
        case "ca":
          this.dependencyTracker?.recordSimpleData("fillAlpha", I), this.ctx.globalAlpha = this.current.fillAlpha = A;
          break;
        case "BM":
          this.dependencyTracker?.recordSimpleData("globalCompositeOperation", I), this.ctx.globalCompositeOperation = A;
          break;
        case "SMask":
          this.dependencyTracker?.recordSimpleData("SMask", I), this.current.activeSMask = A ? this.tempSMask : null, this.tempSMask = null, this.checkSMaskState();
          break;
        case "TR":
          this.dependencyTracker?.recordSimpleData("filter", I), this.ctx.filter = this.current.transferMaps = this.filterFactory.addFilter(A);
          break;
      }
  }
  get inSMaskMode() {
    return !!this.suspendedCtx;
  }
  checkSMaskState() {
    const I = this.inSMaskMode;
    this.current.activeSMask && !I ? this.beginSMaskMode() : !this.current.activeSMask && I && this.endSMaskMode();
  }
  beginSMaskMode(I) {
    if (this.inSMaskMode)
      throw new Error("beginSMaskMode called while already in smask mode");
    const g = this.ctx.canvas.width, C = this.ctx.canvas.height, A = "smaskGroupAt" + this.groupLevel, i = this.cachedCanvases.getCanvas(A, g, C);
    this.suspendedCtx = this.ctx;
    const l = this.ctx = i.context;
    l.setTransform(this.suspendedCtx.getTransform()), Sg(this.suspendedCtx, l), Cd(l, this.suspendedCtx), this.setGState(I, [["BM", "source-over"]]);
  }
  endSMaskMode() {
    if (!this.inSMaskMode)
      throw new Error("endSMaskMode called while not in smask mode");
    this.ctx._removeMirroring(), Sg(this.ctx, this.suspendedCtx), this.ctx = this.suspendedCtx, this.suspendedCtx = null;
  }
  compose(I) {
    if (!this.current.activeSMask)
      return;
    I ? (I[0] = Math.floor(I[0]), I[1] = Math.floor(I[1]), I[2] = Math.ceil(I[2]), I[3] = Math.ceil(I[3])) : I = [0, 0, this.ctx.canvas.width, this.ctx.canvas.height];
    const g = this.current.activeSMask, C = this.suspendedCtx;
    this.composeSMask(C, g, this.ctx, I), this.ctx.save(), this.ctx.setTransform(1, 0, 0, 1, 0, 0), this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height), this.ctx.restore();
  }
  composeSMask(I, g, C, A) {
    const i = A[0], l = A[1], s = A[2] - i, d = A[3] - l;
    s === 0 || d === 0 || (this.genericComposeSMask(g.context, C, s, d, g.subtype, g.backdrop, g.transferMap, i, l, g.offsetX, g.offsetY), I.save(), I.globalAlpha = 1, I.globalCompositeOperation = "source-over", I.setTransform(1, 0, 0, 1, 0, 0), I.drawImage(C.canvas, 0, 0), I.restore());
  }
  genericComposeSMask(I, g, C, A, i, l, s, d, c, G, b) {
    let o = I.canvas, m = d - G, e = c - b;
    if (l)
      if (m < 0 || e < 0 || m + C > o.width || e + A > o.height) {
        const h = this.cachedCanvases.getCanvas("maskExtension", C, A), t = h.context;
        t.drawImage(o, -m, -e), t.globalCompositeOperation = "destination-atop", t.fillStyle = l, t.fillRect(0, 0, C, A), t.globalCompositeOperation = "source-over", o = h.canvas, m = e = 0;
      } else {
        I.save(), I.globalAlpha = 1, I.setTransform(1, 0, 0, 1, 0, 0);
        const h = new Path2D();
        h.rect(m, e, C, A), I.clip(h), I.globalCompositeOperation = "destination-atop", I.fillStyle = l, I.fillRect(m, e, C, A), I.restore();
      }
    g.save(), g.globalAlpha = 1, g.setTransform(1, 0, 0, 1, 0, 0), i === "Alpha" && s ? g.filter = this.filterFactory.addAlphaFilter(s) : i === "Luminosity" && (g.filter = this.filterFactory.addLuminosityFilter(s));
    const a = new Path2D();
    a.rect(d, c, C, A), g.clip(a), g.globalCompositeOperation = "destination-in", g.drawImage(o, m, e, C, A, d, c, C, A), g.restore();
  }
  save(I) {
    this.inSMaskMode && Sg(this.ctx, this.suspendedCtx), this.ctx.save();
    const g = this.current;
    this.stateStack.push(g), this.current = g.clone(), this.dependencyTracker?.save(I);
  }
  restore(I) {
    if (this.dependencyTracker?.restore(I), this.stateStack.length === 0) {
      this.inSMaskMode && this.endSMaskMode();
      return;
    }
    this.current = this.stateStack.pop(), this.ctx.restore(), this.inSMaskMode && Sg(this.suspendedCtx, this.ctx), this.checkSMaskState(), this.pendingClip = null, this._cachedScaleForStroking[0] = -1, this._cachedGetSinglePixelWidth = null;
  }
  transform(I, g, C, A, i, l, s) {
    this.dependencyTracker?.recordIncrementalData("transform", I), this.ctx.transform(g, C, A, i, l, s), this._cachedScaleForStroking[0] = -1, this._cachedGetSinglePixelWidth = null;
  }
  constructPath(I, g, C, A) {
    let [i] = C;
    if (!A) {
      i ||= C[0] = new Path2D(), this[g](I, i);
      return;
    }
    if (this.dependencyTracker !== null) {
      const l = g === Ug.stroke ? this.current.lineWidth / 2 : 0;
      this.dependencyTracker.resetBBox(I).recordBBox(I, this.ctx, A[0] - l, A[2] + l, A[1] - l, A[3] + l).recordDependencies(I, ["transform"]);
    }
    if (!(i instanceof Path2D)) {
      const l = C[0] = new Path2D();
      for (let s = 0, d = i.length; s < d; )
        switch (i[s++]) {
          case lC.moveTo:
            l.moveTo(i[s++], i[s++]);
            break;
          case lC.lineTo:
            l.lineTo(i[s++], i[s++]);
            break;
          case lC.curveTo:
            l.bezierCurveTo(i[s++], i[s++], i[s++], i[s++], i[s++], i[s++]);
            break;
          case lC.closePath:
            l.closePath();
            break;
          default:
            L(`Unrecognized drawing path operator: ${i[s - 1]}`);
            break;
        }
      i = l;
    }
    M.axialAlignedBoundingBox(A, q(this.ctx), this.current.minMax), this[g](I, i), this._pathStartIdx = I;
  }
  closePath(I) {
    this.ctx.closePath();
  }
  stroke(I, g, C = !0) {
    const A = this.ctx, i = this.current.strokeColor;
    if (A.globalAlpha = this.current.strokeAlpha, this.contentVisible)
      if (typeof i == "object" && i?.getPattern) {
        const l = i.isModifyingCurrentTransform() ? A.getTransform() : null;
        if (A.save(), A.strokeStyle = i.getPattern(A, this, DI(A), cI.STROKE, I), l) {
          const s = new Path2D();
          s.addPath(g, A.getTransform().invertSelf().multiplySelf(l)), g = s;
        }
        this.rescaleAndStroke(g, !1), A.restore();
      } else
        this.rescaleAndStroke(g, !0);
    this.dependencyTracker?.recordDependencies(I, NI.stroke), C && this.consumePath(I, g, this.current.getClippedPathBoundingBox(cI.STROKE, q(this.ctx))), A.globalAlpha = this.current.fillAlpha;
  }
  closeStroke(I, g) {
    this.stroke(I, g);
  }
  fill(I, g, C = !0) {
    const A = this.ctx, i = this.current.fillColor, l = this.current.patternFill;
    let s = !1;
    if (l) {
      const c = i.isModifyingCurrentTransform() ? A.getTransform() : null;
      if (this.dependencyTracker?.save(I), A.save(), A.fillStyle = i.getPattern(A, this, DI(A), cI.FILL, I), c) {
        const G = new Path2D();
        G.addPath(g, A.getTransform().invertSelf().multiplySelf(c)), g = G;
      }
      s = !0;
    }
    const d = this.current.getClippedPathBoundingBox();
    this.contentVisible && d !== null && (this.pendingEOFill ? (A.fill(g, "evenodd"), this.pendingEOFill = !1) : A.fill(g)), this.dependencyTracker?.recordDependencies(I, NI.fill), s && (A.restore(), this.dependencyTracker?.restore(I)), C && this.consumePath(I, g, d);
  }
  eoFill(I, g) {
    this.pendingEOFill = !0, this.fill(I, g);
  }
  fillStroke(I, g) {
    this.fill(I, g, !1), this.stroke(I, g, !1), this.consumePath(I, g);
  }
  eoFillStroke(I, g) {
    this.pendingEOFill = !0, this.fillStroke(I, g);
  }
  closeFillStroke(I, g) {
    this.fillStroke(I, g);
  }
  closeEOFillStroke(I, g) {
    this.pendingEOFill = !0, this.fillStroke(I, g);
  }
  endPath(I, g) {
    this.consumePath(I, g);
  }
  rawFillPath(I, g) {
    this.ctx.fill(g), this.dependencyTracker?.recordDependencies(I, NI.rawFillPath).recordOperation(I);
  }
  clip(I) {
    this.dependencyTracker?.recordFutureForcedDependency("clipMode", I), this.pendingClip = sd;
  }
  eoClip(I) {
    this.dependencyTracker?.recordFutureForcedDependency("clipMode", I), this.pendingClip = ti;
  }
  beginText(I) {
    this.current.textMatrix = null, this.current.textMatrixScale = 1, this.current.x = this.current.lineX = 0, this.current.y = this.current.lineY = 0, this.dependencyTracker?.recordOpenMarker(I).resetIncrementalData("sameLineText").resetIncrementalData("moveText", I);
  }
  endText(I) {
    const g = this.pendingTextPaths, C = this.ctx;
    if (this.dependencyTracker) {
      const {
        dependencyTracker: A
      } = this;
      g !== void 0 && A.recordFutureForcedDependency("textClip", A.getOpenMarker()).recordFutureForcedDependency("textClip", I), A.recordCloseMarker(I);
    }
    if (g !== void 0) {
      const A = new Path2D(), i = C.getTransform().invertSelf();
      for (const {
        transform: l,
        x: s,
        y: d,
        fontSize: c,
        path: G
      } of g)
        G && A.addPath(G, new DOMMatrix(l).preMultiplySelf(i).translate(s, d).scale(c, -c));
      C.clip(A);
    }
    delete this.pendingTextPaths;
  }
  setCharSpacing(I, g) {
    this.dependencyTracker?.recordSimpleData("charSpacing", I), this.current.charSpacing = g;
  }
  setWordSpacing(I, g) {
    this.dependencyTracker?.recordSimpleData("wordSpacing", I), this.current.wordSpacing = g;
  }
  setHScale(I, g) {
    this.dependencyTracker?.recordSimpleData("hScale", I), this.current.textHScale = g / 100;
  }
  setLeading(I, g) {
    this.dependencyTracker?.recordSimpleData("leading", I), this.current.leading = -g;
  }
  setFont(I, g, C) {
    this.dependencyTracker?.recordSimpleData("font", I).recordSimpleDataFromNamed("fontObj", g, I);
    const A = this.commonObjs.get(g), i = this.current;
    if (!A)
      throw new Error(`Can't find font for ${g}`);
    if (i.fontMatrix = A.fontMatrix || iA, (i.fontMatrix[0] === 0 || i.fontMatrix[3] === 0) && L("Invalid font matrix for font " + g), C < 0 ? (C = -C, i.fontDirection = -1) : i.fontDirection = 1, this.current.font = A, this.current.fontSize = C, A.isType3Font)
      return;
    const l = A.loadedName || "sans-serif", s = A.systemFontInfo?.css || `"${l}", ${A.fallbackName}`;
    let d = "normal";
    A.black ? d = "900" : A.bold && (d = "bold");
    const c = A.italic ? "italic" : "normal";
    let G = C;
    C < ci ? G = ci : C > Gi && (G = Gi), this.current.fontSizeScale = C / G, this.ctx.font = `${c} ${d} ${G}px ${s}`;
  }
  setTextRenderingMode(I, g) {
    this.dependencyTracker?.recordSimpleData("textRenderingMode", I), this.current.textRenderingMode = g;
  }
  setTextRise(I, g) {
    this.dependencyTracker?.recordSimpleData("textRise", I), this.current.textRise = g;
  }
  moveText(I, g, C) {
    this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText", I), this.current.x = this.current.lineX += g, this.current.y = this.current.lineY += C;
  }
  setLeadingMoveText(I, g, C) {
    this.setLeading(I, -C), this.moveText(I, g, C);
  }
  setTextMatrix(I, g) {
    this.dependencyTracker?.recordSimpleData("textMatrix", I);
    const {
      current: C
    } = this;
    C.textMatrix = g, C.textMatrixScale = Math.hypot(g[0], g[1]), C.x = C.lineX = 0, C.y = C.lineY = 0;
  }
  nextLine(I) {
    this.moveText(I, 0, this.current.leading), this.dependencyTracker?.recordIncrementalData("moveText", this.dependencyTracker.getSimpleIndex("leading") ?? I);
  }
  #A(I, g, C) {
    const A = new Path2D();
    return A.addPath(I, new DOMMatrix(C).invertSelf().multiplySelf(g)), A;
  }
  paintChar(I, g, C, A, i, l) {
    const s = this.ctx, d = this.current, c = d.font, G = d.textRenderingMode, b = d.fontSize / d.fontSizeScale, o = G & ZI.FILL_STROKE_MASK, m = !!(G & ZI.ADD_TO_PATH_FLAG), e = d.patternFill && !c.missingFile, a = d.patternStroke && !c.missingFile;
    let h;
    if ((c.disableFontFace || m || e || a) && !c.missingFile && (h = c.getPathGenerator(this.commonObjs, g)), h && (c.disableFontFace || e || a)) {
      s.save(), s.translate(C, A), s.scale(b, -b), this.dependencyTracker?.recordCharacterBBox(I, s, c);
      let t;
      if (o === ZI.FILL || o === ZI.FILL_STROKE)
        if (i) {
          t = s.getTransform(), s.setTransform(...i);
          const W = this.#A(h, t, i);
          s.fill(W);
        } else
          s.fill(h);
      if (o === ZI.STROKE || o === ZI.FILL_STROKE)
        if (l) {
          t ||= s.getTransform(), s.setTransform(...l);
          const {
            a: W,
            b: B,
            c: w,
            d: n
          } = t, V = M.inverseTransform(l), N = M.transform([W, B, w, n, 0, 0], V);
          M.singularValueDecompose2dScale(N, YI), s.lineWidth *= Math.max(YI[0], YI[1]) / b, s.stroke(this.#A(h, t, l));
        } else
          s.lineWidth /= b, s.stroke(h);
      s.restore();
    } else
      (o === ZI.FILL || o === ZI.FILL_STROKE) && (s.fillText(g, C, A), this.dependencyTracker?.recordCharacterBBox(I, s, c, b, C, A, () => s.measureText(g))), (o === ZI.STROKE || o === ZI.FILL_STROKE) && (this.dependencyTracker && this.dependencyTracker?.recordCharacterBBox(I, s, c, b, C, A, () => s.measureText(g)).recordDependencies(I, NI.stroke), s.strokeText(g, C, A));
    m && ((this.pendingTextPaths ||= []).push({
      transform: q(s),
      x: C,
      y: A,
      fontSize: b,
      path: h
    }), this.dependencyTracker?.recordCharacterBBox(I, s, c, b, C, A));
  }
  get isFontSubpixelAAEnabled() {
    const {
      context: I
    } = this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled", 10, 10);
    I.scale(1.5, 1), I.fillText("I", 0, 10);
    const g = I.getImageData(0, 0, 10, 10).data;
    let C = !1;
    for (let A = 3; A < g.length; A += 4)
      if (g[A] > 0 && g[A] < 255) {
        C = !0;
        break;
      }
    return T(this, "isFontSubpixelAAEnabled", C);
  }
  showText(I, g) {
    this.dependencyTracker && (this.dependencyTracker.recordDependencies(I, NI.showText).resetBBox(I), this.current.textRenderingMode & ZI.ADD_TO_PATH_FLAG && this.dependencyTracker.recordFutureForcedDependency("textClip", I).inheritPendingDependenciesAsFutureForcedDependencies());
    const C = this.current, A = C.font;
    if (A.isType3Font) {
      this.showType3Text(I, g), this.dependencyTracker?.recordShowTextOperation(I);
      return;
    }
    const i = C.fontSize;
    if (i === 0) {
      this.dependencyTracker?.recordOperation(I);
      return;
    }
    const l = this.ctx, s = C.fontSizeScale, d = C.charSpacing, c = C.wordSpacing, G = C.fontDirection, b = C.textHScale * G, o = g.length, m = A.vertical, e = m ? 1 : -1, a = A.defaultVMetrics, h = i * C.fontMatrix[0], t = C.textRenderingMode === ZI.FILL && !A.disableFontFace && !C.patternFill;
    l.save(), C.textMatrix && l.transform(...C.textMatrix), l.translate(C.x, C.y + C.textRise), G > 0 ? l.scale(b, -1) : l.scale(b, 1);
    let W, B;
    if (C.patternFill) {
      l.save();
      const R = C.fillColor.getPattern(l, this, DI(l), cI.FILL, I);
      W = q(l), l.restore(), l.fillStyle = R;
    }
    if (C.patternStroke) {
      l.save();
      const R = C.strokeColor.getPattern(l, this, DI(l), cI.STROKE, I);
      B = q(l), l.restore(), l.strokeStyle = R;
    }
    let w = C.lineWidth;
    const n = C.textMatrixScale;
    if (n === 0 || w === 0) {
      const R = C.textRenderingMode & ZI.FILL_STROKE_MASK;
      (R === ZI.STROKE || R === ZI.FILL_STROKE) && (w = this.getSinglePixelWidth());
    } else
      w /= n;
    if (s !== 1 && (l.scale(s, s), w /= s), l.lineWidth = w, A.isInvalidPDFjsFont) {
      const R = [];
      let Y = 0;
      for (const X of g)
        R.push(X.unicode), Y += X.width;
      const y = R.join("");
      if (l.fillText(y, 0, 0), this.dependencyTracker !== null) {
        const X = l.measureText(y);
        this.dependencyTracker.recordBBox(I, this.ctx, -X.actualBoundingBoxLeft, X.actualBoundingBoxRight, -X.actualBoundingBoxAscent, X.actualBoundingBoxDescent).recordShowTextOperation(I);
      }
      C.x += Y * h * b, l.restore(), this.compose();
      return;
    }
    let V = 0, N;
    for (N = 0; N < o; ++N) {
      const R = g[N];
      if (typeof R == "number") {
        V += e * R * i / 1e3;
        continue;
      }
      let Y = !1;
      const y = (R.isSpace ? c : 0) + d, X = R.fontChar, K = R.accent;
      let S, p, r = R.width;
      if (m) {
        const U = R.vmetric || a, mI = -(R.vmetric ? U[1] : r * 0.5) * h, kI = U[2] * h;
        r = U ? -U[0] : r, S = mI / s, p = (V + kI) / s;
      } else
        S = V / s, p = 0;
      let D;
      if (A.remeasure && r > 0) {
        D = l.measureText(X);
        const U = D.width * 1e3 / i * s;
        if (r < U && this.isFontSubpixelAAEnabled) {
          const mI = r / U;
          Y = !0, l.save(), l.scale(mI, 1), S /= mI;
        } else r !== U && (S += (r - U) / 2e3 * i / s);
      }
      if (this.contentVisible && (R.isInFont || A.missingFile)) {
        if (t && !K)
          l.fillText(X, S, p), this.dependencyTracker?.recordCharacterBBox(I, l, D ? {
            bbox: null
          } : A, i / s, S, p, () => D ?? l.measureText(X));
        else if (this.paintChar(I, X, S, p, W, B), K) {
          const U = S + i * K.offset.x / s, mI = p - i * K.offset.y / s;
          this.paintChar(I, K.fontChar, U, mI, W, B);
        }
      }
      const z = m ? r * h - y * G : r * h + y * G;
      V += z, Y && l.restore();
    }
    m ? C.y -= V : C.x += V * b, l.restore(), this.compose(), this.dependencyTracker?.recordShowTextOperation(I);
  }
  showType3Text(I, g) {
    const C = this.ctx, A = this.current, i = A.font, l = A.fontSize, s = A.fontDirection, d = i.vertical ? 1 : -1, c = A.charSpacing, G = A.wordSpacing, b = A.textHScale * s, o = A.fontMatrix || iA, m = g.length, e = A.textRenderingMode === ZI.INVISIBLE;
    let a, h, t, W;
    if (e || l === 0)
      return;
    this._cachedScaleForStroking[0] = -1, this._cachedGetSinglePixelWidth = null, C.save(), A.textMatrix && C.transform(...A.textMatrix), C.translate(A.x, A.y + A.textRise), C.scale(b, s);
    const B = this.dependencyTracker;
    for (this.dependencyTracker = B ? new RC(B, I) : null, a = 0; a < m; ++a) {
      if (h = g[a], typeof h == "number") {
        W = d * h * l / 1e3, this.ctx.translate(W, 0), A.x += W * b;
        continue;
      }
      const w = (h.isSpace ? G : 0) + c, n = i.charProcOperatorList[h.operatorListId];
      n ? this.contentVisible && (this.save(), C.scale(l, l), C.transform(...o), this.executeOperatorList(n), this.restore()) : L(`Type3 character "${h.operatorListId}" is not available.`);
      const V = [h.width, 0];
      M.applyTransform(V, o), t = V[0] * l + w, C.translate(t, 0), A.x += t * b;
    }
    C.restore(), B && (this.dependencyTracker = B);
  }
  setCharWidth(I, g, C) {
  }
  setCharWidthAndBounds(I, g, C, A, i, l, s) {
    const d = new Path2D();
    d.rect(A, i, l - A, s - i), this.ctx.clip(d), this.dependencyTracker?.recordBBox(I, this.ctx, A, l, i, s).recordClipBox(I, this.ctx, A, l, i, s), this.endPath(I);
  }
  getColorN_Pattern(I, g) {
    let C;
    if (g[0] === "TilingPattern") {
      const A = this.baseTransform || q(this.ctx), i = {
        createCanvasGraphics: (l, s) => new ng(l, this.commonObjs, this.objs, this.canvasFactory, this.filterFactory, {
          optionalContentConfig: this.optionalContentConfig,
          markedContentStack: this.markedContentStack
        }, void 0, void 0, this.dependencyTracker ? new RC(this.dependencyTracker, s, !0) : null)
      };
      C = new FA(g, this.ctx, i, A);
    } else
      C = this._getPattern(I, g[1], g[2]);
    return C;
  }
  setStrokeColorN(I, ...g) {
    this.dependencyTracker?.recordSimpleData("strokeColor", I), this.current.strokeColor = this.getColorN_Pattern(I, g), this.current.patternStroke = !0;
  }
  setFillColorN(I, ...g) {
    this.dependencyTracker?.recordSimpleData("fillColor", I), this.current.fillColor = this.getColorN_Pattern(I, g), this.current.patternFill = !0;
  }
  setStrokeRGBColor(I, g) {
    this.dependencyTracker?.recordSimpleData("strokeColor", I), this.ctx.strokeStyle = this.current.strokeColor = g, this.current.patternStroke = !1;
  }
  setStrokeTransparent(I) {
    this.dependencyTracker?.recordSimpleData("strokeColor", I), this.ctx.strokeStyle = this.current.strokeColor = "transparent", this.current.patternStroke = !1;
  }
  setFillRGBColor(I, g) {
    this.dependencyTracker?.recordSimpleData("fillColor", I), this.ctx.fillStyle = this.current.fillColor = g, this.current.patternFill = !1;
  }
  setFillTransparent(I) {
    this.dependencyTracker?.recordSimpleData("fillColor", I), this.ctx.fillStyle = this.current.fillColor = "transparent", this.current.patternFill = !1;
  }
  _getPattern(I, g, C = null) {
    let A;
    return this.cachedPatterns.has(g) ? A = this.cachedPatterns.get(g) : (A = $s(this.getObject(I, g)), this.cachedPatterns.set(g, A)), C && (A.matrix = C), A;
  }
  shadingFill(I, g) {
    if (!this.contentVisible)
      return;
    const C = this.ctx;
    this.save(I);
    const A = this._getPattern(I, g);
    C.fillStyle = A.getPattern(C, this, DI(C), cI.SHADING, I);
    const i = DI(C);
    if (i) {
      const {
        width: l,
        height: s
      } = C.canvas, d = Wg.slice();
      M.axialAlignedBoundingBox([0, 0, l, s], i, d);
      const [c, G, b, o] = d;
      this.ctx.fillRect(c, G, b - c, o - G);
    } else
      this.ctx.fillRect(-1e10, -1e10, 2e10, 2e10);
    this.dependencyTracker?.resetBBox(I).recordFullPageBBox(I).recordDependencies(I, NI.transform).recordDependencies(I, NI.fill).recordOperation(I), this.compose(this.current.getClippedPathBoundingBox()), this.restore(I);
  }
  beginInlineImage() {
    f("Should not call beginInlineImage");
  }
  beginImageData() {
    f("Should not call beginImageData");
  }
  paintFormXObjectBegin(I, g, C) {
    if (this.contentVisible && (this.save(I), this.baseTransformStack.push(this.baseTransform), g && this.transform(I, ...g), this.baseTransform = q(this.ctx), C)) {
      M.axialAlignedBoundingBox(C, this.baseTransform, this.current.minMax);
      const [A, i, l, s] = C, d = new Path2D();
      d.rect(A, i, l - A, s - i), this.ctx.clip(d), this.dependencyTracker?.recordClipBox(I, this.ctx, A, l, i, s), this.endPath(I);
    }
  }
  paintFormXObjectEnd(I) {
    this.contentVisible && (this.restore(I), this.baseTransform = this.baseTransformStack.pop());
  }
  beginGroup(I, g) {
    if (!this.contentVisible)
      return;
    this.save(I), this.inSMaskMode && (this.endSMaskMode(), this.current.activeSMask = null);
    const C = this.ctx;
    g.isolated || pC("TODO: Support non-isolated groups."), g.knockout && L("Knockout groups not supported.");
    const A = q(C);
    if (g.matrix && C.transform(...g.matrix), !g.bbox)
      throw new Error("Bounding box is required.");
    let i = Wg.slice();
    M.axialAlignedBoundingBox(g.bbox, q(C), i);
    const l = [0, 0, C.canvas.width, C.canvas.height];
    i = M.intersect(i, l) || [0, 0, 0, 0];
    const s = Math.floor(i[0]), d = Math.floor(i[1]), c = Math.max(Math.ceil(i[2]) - s, 1), G = Math.max(Math.ceil(i[3]) - d, 1);
    this.current.startNewPathAndClipBox([0, 0, c, G]);
    let b = "groupAt" + this.groupLevel;
    g.smask && (b += "_smask_" + this.smaskCounter++ % 2);
    const o = this.cachedCanvases.getCanvas(b, c, G), m = o.context;
    m.translate(-s, -d), m.transform(...A);
    let e = new Path2D();
    const [a, h, t, W] = g.bbox;
    if (e.rect(a, h, t - a, W - h), g.matrix) {
      const B = new Path2D();
      B.addPath(e, new DOMMatrix(g.matrix)), e = B;
    }
    m.clip(e), g.smask && this.smaskStack.push({
      canvas: o.canvas,
      context: m,
      offsetX: s,
      offsetY: d,
      subtype: g.smask.subtype,
      backdrop: g.smask.backdrop,
      transferMap: g.smask.transferMap || null,
      startTransformInverse: null
    }), (!g.smask || this.dependencyTracker) && (C.setTransform(1, 0, 0, 1, 0, 0), C.translate(s, d), C.save()), Sg(C, m), this.ctx = m, this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha", "strokeAlpha", "globalCompositeOperation"]).pushBaseTransform(C), this.setGState(I, [["BM", "source-over"], ["ca", 1], ["CA", 1]]), this.groupStack.push(C), this.groupLevel++;
  }
  endGroup(I, g) {
    if (!this.contentVisible)
      return;
    this.groupLevel--;
    const C = this.ctx, A = this.groupStack.pop();
    if (this.ctx = A, this.ctx.imageSmoothingEnabled = !1, this.dependencyTracker?.popBaseTransform(), g.smask)
      this.tempSMask = this.smaskStack.pop(), this.restore(I), this.dependencyTracker && this.ctx.restore();
    else {
      this.ctx.restore();
      const i = q(this.ctx);
      this.restore(I), this.ctx.save(), this.ctx.setTransform(...i);
      const l = Wg.slice();
      M.axialAlignedBoundingBox([0, 0, C.canvas.width, C.canvas.height], i, l), this.ctx.drawImage(C.canvas, 0, 0), this.ctx.restore(), this.compose(l);
    }
  }
  beginAnnotation(I, g, C, A, i, l) {
    if (this.#I(), oC(this.ctx), this.ctx.save(), this.save(I), this.baseTransform && this.ctx.setTransform(...this.baseTransform), C) {
      const s = C[2] - C[0], d = C[3] - C[1];
      if (l && this.annotationCanvasMap) {
        A = A.slice(), A[4] -= C[0], A[5] -= C[1], C = C.slice(), C[0] = C[1] = 0, C[2] = s, C[3] = d, M.singularValueDecompose2dScale(q(this.ctx), YI);
        const {
          viewportScale: c
        } = this, G = Math.ceil(s * this.outputScaleX * c), b = Math.ceil(d * this.outputScaleY * c);
        this.annotationCanvas = this.canvasFactory.create(G, b);
        const {
          canvas: o,
          context: m
        } = this.annotationCanvas;
        this.annotationCanvasMap.set(g, o), this.annotationCanvas.savedCtx = this.ctx, this.ctx = m, this.ctx.save(), this.ctx.setTransform(YI[0], 0, 0, -YI[1], 0, d * YI[1]), oC(this.ctx);
      } else {
        oC(this.ctx), this.endPath(I);
        const c = new Path2D();
        c.rect(C[0], C[1], s, d), this.ctx.clip(c);
      }
    }
    this.current = new oi(this.ctx.canvas.width, this.ctx.canvas.height), this.transform(I, ...A), this.transform(I, ...i);
  }
  endAnnotation(I) {
    this.annotationCanvas && (this.ctx.restore(), this.#g(), this.ctx = this.annotationCanvas.savedCtx, delete this.annotationCanvas.savedCtx, delete this.annotationCanvas);
  }
  paintImageMaskXObject(I, g) {
    if (!this.contentVisible)
      return;
    const C = g.count;
    g = this.getObject(I, g.data, g), g.count = C;
    const A = this.ctx, i = this._createMaskCanvas(I, g), l = i.canvas;
    A.save(), A.setTransform(1, 0, 0, 1, 0, 0), A.drawImage(l, i.offsetX, i.offsetY), this.dependencyTracker?.resetBBox(I).recordBBox(I, this.ctx, i.offsetX, i.offsetX + l.width, i.offsetY, i.offsetY + l.height).recordOperation(I), A.restore(), this.compose();
  }
  paintImageMaskXObjectRepeat(I, g, C, A = 0, i = 0, l, s) {
    if (!this.contentVisible)
      return;
    g = this.getObject(I, g.data, g);
    const d = this.ctx;
    d.save();
    const c = q(d);
    d.transform(C, A, i, l, 0, 0);
    const G = this._createMaskCanvas(I, g);
    d.setTransform(1, 0, 0, 1, G.offsetX - c[4], G.offsetY - c[5]), this.dependencyTracker?.resetBBox(I);
    for (let b = 0, o = s.length; b < o; b += 2) {
      const m = M.transform(c, [C, A, i, l, s[b], s[b + 1]]);
      d.drawImage(G.canvas, m[4], m[5]), this.dependencyTracker?.recordBBox(I, this.ctx, m[4], m[4] + G.canvas.width, m[5], m[5] + G.canvas.height);
    }
    d.restore(), this.compose(), this.dependencyTracker?.recordOperation(I);
  }
  paintImageMaskXObjectGroup(I, g) {
    if (!this.contentVisible)
      return;
    const C = this.ctx, A = this.current.fillColor, i = this.current.patternFill;
    this.dependencyTracker?.resetBBox(I).recordDependencies(I, NI.transformAndFill);
    for (const l of g) {
      const {
        data: s,
        width: d,
        height: c,
        transform: G
      } = l, b = this.cachedCanvases.getCanvas("maskCanvas", d, c), o = b.context;
      o.save();
      const m = this.getObject(I, s, l);
      ai(o, m), o.globalCompositeOperation = "source-in", o.fillStyle = i ? A.getPattern(o, this, DI(C), cI.FILL, I) : A, o.fillRect(0, 0, d, c), o.restore(), C.save(), C.transform(...G), C.scale(1, -1), bC(C, b.canvas, 0, 0, d, c, 0, -1, 1, 1), this.dependencyTracker?.recordBBox(I, C, 0, d, 0, c), C.restore();
    }
    this.compose(), this.dependencyTracker?.recordOperation(I);
  }
  paintImageXObject(I, g) {
    if (!this.contentVisible)
      return;
    const C = this.getObject(I, g);
    if (!C) {
      L("Dependent image isn't ready yet");
      return;
    }
    this.paintInlineImageXObject(I, C);
  }
  paintImageXObjectRepeat(I, g, C, A, i) {
    if (!this.contentVisible)
      return;
    const l = this.getObject(I, g);
    if (!l) {
      L("Dependent image isn't ready yet");
      return;
    }
    const s = l.width, d = l.height, c = [];
    for (let G = 0, b = i.length; G < b; G += 2)
      c.push({
        transform: [C, 0, 0, A, i[G], i[G + 1]],
        x: 0,
        y: 0,
        w: s,
        h: d
      });
    this.paintInlineImageXObjectGroup(I, l, c);
  }
  applyTransferMapsToCanvas(I) {
    return this.current.transferMaps !== "none" && (I.filter = this.current.transferMaps, I.drawImage(I.canvas, 0, 0), I.filter = "none"), I.canvas;
  }
  applyTransferMapsToBitmap(I) {
    if (this.current.transferMaps === "none")
      return I.bitmap;
    const {
      bitmap: g,
      width: C,
      height: A
    } = I, i = this.cachedCanvases.getCanvas("inlineImage", C, A), l = i.context;
    return l.filter = this.current.transferMaps, l.drawImage(g, 0, 0), l.filter = "none", i.canvas;
  }
  paintInlineImageXObject(I, g) {
    if (!this.contentVisible)
      return;
    const C = g.width, A = g.height, i = this.ctx;
    this.save(I);
    const {
      filter: l
    } = i;
    l !== "none" && l !== "" && (i.filter = "none"), i.scale(1 / C, -1 / A);
    let s;
    if (g.bitmap)
      s = this.applyTransferMapsToBitmap(g);
    else if (typeof HTMLElement == "function" && g instanceof HTMLElement || !g.data)
      s = g;
    else {
      const G = this.cachedCanvases.getCanvas("inlineImage", C, A).context;
      mi(G, g), s = this.applyTransferMapsToCanvas(G);
    }
    const d = this._scaleImage(s, DI(i));
    i.imageSmoothingEnabled = ei(q(i), g.interpolate), this.dependencyTracker?.resetBBox(I).recordBBox(I, i, 0, C, -A, 0).recordDependencies(I, NI.imageXObject).recordOperation(I), bC(i, d.img, 0, 0, d.paintWidth, d.paintHeight, 0, -A, C, A), this.compose(), this.restore(I);
  }
  paintInlineImageXObjectGroup(I, g, C) {
    if (!this.contentVisible)
      return;
    const A = this.ctx;
    let i;
    if (g.bitmap)
      i = g.bitmap;
    else {
      const l = g.width, s = g.height, c = this.cachedCanvases.getCanvas("inlineImage", l, s).context;
      mi(c, g), i = this.applyTransferMapsToCanvas(c);
    }
    this.dependencyTracker?.resetBBox(I);
    for (const l of C)
      A.save(), A.transform(...l.transform), A.scale(1, -1), bC(A, i, l.x, l.y, l.w, l.h, 0, -1, 1, 1), this.dependencyTracker?.recordBBox(I, A, 0, 1, -1, 0), A.restore();
    this.dependencyTracker?.recordOperation(I), this.compose();
  }
  paintSolidColorImageMask(I) {
    this.contentVisible && (this.dependencyTracker?.resetBBox(I).recordBBox(I, this.ctx, 0, 1, 0, 1).recordDependencies(I, NI.fill).recordOperation(I), this.ctx.fillRect(0, 0, 1, 1), this.compose());
  }
  markPoint(I, g) {
  }
  markPointProps(I, g, C) {
  }
  beginMarkedContent(I, g) {
    this.dependencyTracker?.beginMarkedContent(I), this.markedContentStack.push({
      visible: !0
    });
  }
  beginMarkedContentProps(I, g, C) {
    this.dependencyTracker?.beginMarkedContent(I), g === "OC" ? this.markedContentStack.push({
      visible: this.optionalContentConfig.isVisible(C)
    }) : this.markedContentStack.push({
      visible: !0
    }), this.contentVisible = this.isContentVisible();
  }
  endMarkedContent(I) {
    this.dependencyTracker?.endMarkedContent(I), this.markedContentStack.pop(), this.contentVisible = this.isContentVisible();
  }
  beginCompat(I) {
  }
  endCompat(I) {
  }
  consumePath(I, g, C) {
    const A = this.current.isEmptyClip();
    this.pendingClip && this.current.updateClipFromPath(), this.pendingClip || this.compose(C);
    const i = this.ctx;
    this.pendingClip ? (A || (this.pendingClip === ti ? i.clip(g, "evenodd") : i.clip(g)), this.pendingClip = null, this.dependencyTracker?.bboxToClipBoxDropOperation(I).recordFutureForcedDependency("clipPath", I)) : this.dependencyTracker?.recordOperation(I), this.current.startNewPathAndClipBox(this.current.clipBox);
  }
  getSinglePixelWidth() {
    if (!this._cachedGetSinglePixelWidth) {
      const I = q(this.ctx);
      if (I[1] === 0 && I[2] === 0)
        this._cachedGetSinglePixelWidth = 1 / Math.min(Math.abs(I[0]), Math.abs(I[3]));
      else {
        const g = Math.abs(I[0] * I[3] - I[2] * I[1]), C = Math.hypot(I[0], I[2]), A = Math.hypot(I[1], I[3]);
        this._cachedGetSinglePixelWidth = Math.max(C, A) / g;
      }
    }
    return this._cachedGetSinglePixelWidth;
  }
  getScaleForStroking() {
    if (this._cachedScaleForStroking[0] === -1) {
      const {
        lineWidth: I
      } = this.current, {
        a: g,
        b: C,
        c: A,
        d: i
      } = this.ctx.getTransform();
      let l, s;
      if (C === 0 && A === 0) {
        const d = Math.abs(g), c = Math.abs(i);
        if (d === c)
          if (I === 0)
            l = s = 1 / d;
          else {
            const G = d * I;
            l = s = G < 1 ? 1 / G : 1;
          }
        else if (I === 0)
          l = 1 / d, s = 1 / c;
        else {
          const G = d * I, b = c * I;
          l = G < 1 ? 1 / G : 1, s = b < 1 ? 1 / b : 1;
        }
      } else {
        const d = Math.abs(g * i - C * A), c = Math.hypot(g, C), G = Math.hypot(A, i);
        if (I === 0)
          l = G / d, s = c / d;
        else {
          const b = I * d;
          l = G > b ? G / b : 1, s = c > b ? c / b : 1;
        }
      }
      this._cachedScaleForStroking[0] = l, this._cachedScaleForStroking[1] = s;
    }
    return this._cachedScaleForStroking;
  }
  rescaleAndStroke(I, g) {
    const {
      ctx: C,
      current: {
        lineWidth: A
      }
    } = this, [i, l] = this.getScaleForStroking();
    if (i === l) {
      C.lineWidth = (A || 1) * i, C.stroke(I);
      return;
    }
    const s = C.getLineDash();
    g && C.save(), C.scale(i, l), EC.a = 1 / i, EC.d = 1 / l;
    const d = new Path2D();
    if (d.addPath(I, EC), s.length > 0) {
      const c = Math.max(i, l);
      C.setLineDash(s.map((G) => G / c)), C.lineDashOffset /= c;
    }
    C.lineWidth = A || 1, C.stroke(d), g && C.restore();
  }
  isContentVisible() {
    for (let I = this.markedContentStack.length - 1; I >= 0; I--)
      if (!this.markedContentStack[I].visible)
        return !1;
    return !0;
  }
}
for (const Z in Ug)
  ng.prototype[Z] !== void 0 && (ng.prototype[Ug[Z]] = ng.prototype[Z]);
class Yg {
  #I;
  #g;
  #A;
  static strings = ["fontFamily", "fontWeight", "italicAngle"];
  static write(I) {
    const g = new TextEncoder(), C = {};
    let A = 0;
    for (const c of Yg.strings) {
      const G = g.encode(I[c]);
      C[c] = G, A += 4 + G.length;
    }
    const i = new ArrayBuffer(A), l = new Uint8Array(i), s = new DataView(i);
    let d = 0;
    for (const c of Yg.strings) {
      const G = C[c], b = G.length;
      s.setUint32(d, b), l.set(G, d + 4), d += 4 + b;
    }
    return Q(d === i.byteLength, "CssFontInfo.write: Buffer overflow"), i;
  }
  constructor(I) {
    this.#I = I, this.#g = new DataView(this.#I), this.#A = new TextDecoder();
  }
  #C(I) {
    Q(I < Yg.strings.length, "Invalid string index");
    let g = 0;
    for (let A = 0; A < I; A++)
      g += this.#g.getUint32(g) + 4;
    const C = this.#g.getUint32(g);
    return this.#A.decode(new Uint8Array(this.#I, g + 4, C));
  }
  get fontFamily() {
    return this.#C(0);
  }
  get fontWeight() {
    return this.#C(1);
  }
  get italicAngle() {
    return this.#C(2);
  }
}
class Vg {
  #I;
  #g;
  #A;
  static strings = ["css", "loadedName", "baseFontName", "src"];
  static write(I) {
    const g = new TextEncoder(), C = {};
    let A = 0;
    for (const o of Vg.strings) {
      const m = g.encode(I[o]);
      C[o] = m, A += 4 + m.length;
    }
    A += 4;
    let i, l, s = 1 + A;
    I.style && (i = g.encode(I.style.style), l = g.encode(I.style.weight), s += 4 + i.length + 4 + l.length);
    const d = new ArrayBuffer(s), c = new Uint8Array(d), G = new DataView(d);
    let b = 0;
    G.setUint8(b++, I.guessFallback ? 1 : 0), G.setUint32(b, 0), b += 4, A = 0;
    for (const o of Vg.strings) {
      const m = C[o], e = m.length;
      A += 4 + e, G.setUint32(b, e), c.set(m, b + 4), b += 4 + e;
    }
    return G.setUint32(b - A - 4, A), I.style && (G.setUint32(b, i.length), c.set(i, b + 4), b += 4 + i.length, G.setUint32(b, l.length), c.set(l, b + 4), b += 4 + l.length), Q(b <= d.byteLength, "SubstitionInfo.write: Buffer overflow"), d.transferToFixedLength(b);
  }
  constructor(I) {
    this.#I = I, this.#g = new DataView(this.#I), this.#A = new TextDecoder();
  }
  get guessFallback() {
    return this.#g.getUint8(0) !== 0;
  }
  #C(I) {
    Q(I < Vg.strings.length, "Invalid string index");
    let g = 5;
    for (let A = 0; A < I; A++)
      g += this.#g.getUint32(g) + 4;
    const C = this.#g.getUint32(g);
    return this.#A.decode(new Uint8Array(this.#I, g + 4, C));
  }
  get css() {
    return this.#C(0);
  }
  get loadedName() {
    return this.#C(1);
  }
  get baseFontName() {
    return this.#C(2);
  }
  get src() {
    return this.#C(3);
  }
  get style() {
    let I = 1;
    I += 4 + this.#g.getUint32(I);
    const g = this.#g.getUint32(I), C = this.#A.decode(new Uint8Array(this.#I, I + 4, g));
    I += 4 + g;
    const A = this.#g.getUint32(I), i = this.#A.decode(new Uint8Array(this.#I, I + 4, A));
    return {
      style: C,
      weight: i
    };
  }
}
class E {
  static bools = ["black", "bold", "disableFontFace", "fontExtraProperties", "isInvalidPDFjsFont", "isType3Font", "italic", "missingFile", "remeasure", "vertical"];
  static numbers = ["ascent", "defaultWidth", "descent"];
  static strings = ["fallbackName", "loadedName", "mimetype", "name"];
  static #I = Math.ceil(this.bools.length * 2 / 8);
  static #g = this.#I + this.numbers.length * 8;
  static #A = this.#g + 1 + 8;
  static #C = this.#A + 1 + 48;
  static #i = this.#C + 1 + 6;
  #l;
  #s;
  #d;
  constructor({
    data: I,
    extra: g
  }) {
    this.#l = I, this.#s = new TextDecoder(), this.#d = new DataView(this.#l), g && Object.assign(this, g);
  }
  #c(I) {
    Q(I < E.bools.length, "Invalid boolean index");
    const g = Math.floor(I / 4), C = I * 2 % 8, A = this.#d.getUint8(g) >> C & 3;
    return A === 0 ? void 0 : A === 2;
  }
  get black() {
    return this.#c(0);
  }
  get bold() {
    return this.#c(1);
  }
  get disableFontFace() {
    return this.#c(2);
  }
  get fontExtraProperties() {
    return this.#c(3);
  }
  get isInvalidPDFjsFont() {
    return this.#c(4);
  }
  get isType3Font() {
    return this.#c(5);
  }
  get italic() {
    return this.#c(6);
  }
  get missingFile() {
    return this.#c(7);
  }
  get remeasure() {
    return this.#c(8);
  }
  get vertical() {
    return this.#c(9);
  }
  #Z(I) {
    return Q(I < E.numbers.length, "Invalid number index"), this.#d.getFloat64(E.#I + I * 8);
  }
  get ascent() {
    return this.#Z(0);
  }
  get defaultWidth() {
    return this.#Z(1);
  }
  get descent() {
    return this.#Z(2);
  }
  get bbox() {
    let I = E.#g;
    if (this.#d.getUint8(I) === 0)
      return;
    I += 1;
    const C = [];
    for (let A = 0; A < 4; A++)
      C.push(this.#d.getInt16(I, !0)), I += 2;
    return C;
  }
  get fontMatrix() {
    let I = E.#A;
    if (this.#d.getUint8(I) === 0)
      return;
    I += 1;
    const C = [];
    for (let A = 0; A < 6; A++)
      C.push(this.#d.getFloat64(I, !0)), I += 8;
    return C;
  }
  get defaultVMetrics() {
    let I = E.#C;
    if (this.#d.getUint8(I) === 0)
      return;
    I += 1;
    const C = [];
    for (let A = 0; A < 3; A++)
      C.push(this.#d.getInt16(I, !0)), I += 2;
    return C;
  }
  #o(I) {
    Q(I < E.strings.length, "Invalid string index");
    let g = E.#i + 4;
    for (let i = 0; i < I; i++)
      g += this.#d.getUint32(g) + 4;
    const C = this.#d.getUint32(g), A = new Uint8Array(C);
    return A.set(new Uint8Array(this.#l, g + 4, C)), this.#s.decode(A);
  }
  get fallbackName() {
    return this.#o(0);
  }
  get loadedName() {
    return this.#o(1);
  }
  get mimetype() {
    return this.#o(2);
  }
  get name() {
    return this.#o(3);
  }
  get data() {
    let I = E.#i;
    const g = this.#d.getUint32(I);
    I += 4 + g;
    const C = this.#d.getUint32(I);
    I += 4 + C;
    const A = this.#d.getUint32(I);
    I += 4 + A;
    const i = this.#d.getUint32(I);
    if (i !== 0)
      return new Uint8Array(this.#l, I + 4, i);
  }
  clearData() {
    let I = E.#i;
    const g = this.#d.getUint32(I);
    I += 4 + g;
    const C = this.#d.getUint32(I);
    I += 4 + C;
    const A = this.#d.getUint32(I);
    I += 4 + A;
    const i = this.#d.getUint32(I);
    new Uint8Array(this.#l, I + 4, i).fill(0), this.#d.setUint32(I, 0);
  }
  get cssFontInfo() {
    let I = E.#i;
    const g = this.#d.getUint32(I);
    I += 4 + g;
    const C = this.#d.getUint32(I);
    I += 4 + C;
    const A = this.#d.getUint32(I);
    if (A === 0)
      return null;
    const i = new Uint8Array(A);
    return i.set(new Uint8Array(this.#l, I + 4, A)), new Yg(i.buffer);
  }
  get systemFontInfo() {
    let I = E.#i;
    const g = this.#d.getUint32(I);
    I += 4 + g;
    const C = this.#d.getUint32(I);
    if (C === 0)
      return null;
    const A = new Uint8Array(C);
    return A.set(new Uint8Array(this.#l, I + 4, C)), new Vg(A.buffer);
  }
  static write(I) {
    const g = I.systemFontInfo ? Vg.write(I.systemFontInfo) : null, C = I.cssFontInfo ? Yg.write(I.cssFontInfo) : null, A = new TextEncoder(), i = {};
    let l = 0;
    for (const a of E.strings)
      i[a] = A.encode(I[a]), l += 4 + i[a].length;
    const s = E.#i + 4 + l + 4 + (g ? g.byteLength : 0) + 4 + (C ? C.byteLength : 0) + 4 + (I.data ? I.data.length : 0), d = new ArrayBuffer(s), c = new Uint8Array(d), G = new DataView(d);
    let b = 0;
    const o = E.bools.length;
    let m = 0, e = 0;
    for (let a = 0; a < o; a++) {
      const h = I[E.bools[a]];
      m |= (h === void 0 ? 0 : h ? 2 : 1) << e, e += 2, (e === 8 || a === o - 1) && (G.setUint8(b++, m), m = 0, e = 0);
    }
    Q(b === E.#I, "FontInfo.write: Boolean properties offset mismatch");
    for (const a of E.numbers)
      G.setFloat64(b, I[a]), b += 8;
    if (Q(b === E.#g, "FontInfo.write: Number properties offset mismatch"), I.bbox) {
      G.setUint8(b++, 4);
      for (const a of I.bbox)
        G.setInt16(b, a, !0), b += 2;
    } else
      G.setUint8(b++, 0), b += 8;
    if (Q(b === E.#A, "FontInfo.write: BBox properties offset mismatch"), I.fontMatrix) {
      G.setUint8(b++, 6);
      for (const a of I.fontMatrix)
        G.setFloat64(b, a, !0), b += 8;
    } else
      G.setUint8(b++, 0), b += 48;
    if (Q(b === E.#C, "FontInfo.write: FontMatrix properties offset mismatch"), I.defaultVMetrics) {
      G.setUint8(b++, 1);
      for (const a of I.defaultVMetrics)
        G.setInt16(b, a, !0), b += 2;
    } else
      G.setUint8(b++, 0), b += 6;
    Q(b === E.#i, "FontInfo.write: DefaultVMetrics properties offset mismatch"), G.setUint32(E.#i, 0), b += 4;
    for (const a of E.strings) {
      const h = i[a], t = h.length;
      G.setUint32(b, t), c.set(h, b + 4), b += 4 + t;
    }
    if (G.setUint32(E.#i, b - E.#i - 4), !g)
      G.setUint32(b, 0), b += 4;
    else {
      const a = g.byteLength;
      G.setUint32(b, a), Q(b + 4 + a <= d.byteLength, "FontInfo.write: Buffer overflow at systemFontInfo"), c.set(new Uint8Array(g), b + 4), b += 4 + a;
    }
    if (!C)
      G.setUint32(b, 0), b += 4;
    else {
      const a = C.byteLength;
      G.setUint32(b, a), Q(b + 4 + a <= d.byteLength, "FontInfo.write: Buffer overflow at cssFontInfo"), c.set(new Uint8Array(C), b + 4), b += 4 + a;
    }
    return I.data === void 0 ? (G.setUint32(b, 0), b += 4) : (G.setUint32(b, I.data.length), c.set(I.data, b + 4), b += 4 + I.data.length), Q(b <= d.byteLength, "FontInfo.write: Buffer overflow"), d.transferToFixedLength(b);
  }
}
let Ng = class {
  static #I = null;
  static #g = "";
  static get workerPort() {
    return this.#I;
  }
  static set workerPort(I) {
    if (!(typeof Worker < "u" && I instanceof Worker) && I !== null)
      throw new Error("Invalid `workerPort` type.");
    this.#I = I;
  }
  static get workerSrc() {
    return this.#g;
  }
  static set workerSrc(I) {
    if (typeof I != "string")
      throw new Error("Invalid `workerSrc` type.");
    this.#g = I;
  }
};
class dd {
  #I;
  #g;
  constructor({
    parsedData: I,
    rawData: g
  }) {
    this.#I = I, this.#g = g;
  }
  getRaw() {
    return this.#g;
  }
  get(I) {
    return this.#I.get(I) ?? null;
  }
  [Symbol.iterator]() {
    return this.#I.entries();
  }
}
const hg = Symbol("INTERNAL");
class Zd {
  #I = !1;
  #g = !1;
  #A = !1;
  #C = !0;
  constructor(I, {
    name: g,
    intent: C,
    usage: A,
    rbGroups: i
  }) {
    this.#I = !!(I & nI.DISPLAY), this.#g = !!(I & nI.PRINT), this.name = g, this.intent = C, this.usage = A, this.rbGroups = i;
  }
  get visible() {
    if (this.#A)
      return this.#C;
    if (!this.#C)
      return !1;
    const {
      print: I,
      view: g
    } = this.usage;
    return this.#I ? g?.viewState !== "OFF" : this.#g ? I?.printState !== "OFF" : !0;
  }
  _setVisible(I, g, C = !1) {
    I !== hg && f("Internal method `_setVisible` called."), this.#A = C, this.#C = g;
  }
}
class cd {
  #I = null;
  #g = /* @__PURE__ */ new Map();
  #A = null;
  #C = null;
  constructor(I, g = nI.DISPLAY) {
    if (this.renderingIntent = g, this.name = null, this.creator = null, I !== null) {
      this.name = I.name, this.creator = I.creator, this.#C = I.order;
      for (const C of I.groups)
        this.#g.set(C.id, new Zd(g, C));
      if (I.baseState === "OFF")
        for (const C of this.#g.values())
          C._setVisible(hg, !1);
      for (const C of I.on)
        this.#g.get(C)._setVisible(hg, !0);
      for (const C of I.off)
        this.#g.get(C)._setVisible(hg, !1);
      this.#A = this.getHash();
    }
  }
  #i(I) {
    const g = I.length;
    if (g < 2)
      return !0;
    const C = I[0];
    for (let A = 1; A < g; A++) {
      const i = I[A];
      let l;
      if (Array.isArray(i))
        l = this.#i(i);
      else if (this.#g.has(i))
        l = this.#g.get(i).visible;
      else
        return L(`Optional content group not found: ${i}`), !0;
      switch (C) {
        case "And":
          if (!l)
            return !1;
          break;
        case "Or":
          if (l)
            return !0;
          break;
        case "Not":
          return !l;
        default:
          return !0;
      }
    }
    return C === "And";
  }
  isVisible(I) {
    if (this.#g.size === 0)
      return !0;
    if (!I)
      return pC("Optional content group not defined."), !0;
    if (I.type === "OCG")
      return this.#g.has(I.id) ? this.#g.get(I.id).visible : (L(`Optional content group not found: ${I.id}`), !0);
    if (I.type === "OCMD") {
      if (I.expression)
        return this.#i(I.expression);
      if (!I.policy || I.policy === "AnyOn") {
        for (const g of I.ids) {
          if (!this.#g.has(g))
            return L(`Optional content group not found: ${g}`), !0;
          if (this.#g.get(g).visible)
            return !0;
        }
        return !1;
      } else if (I.policy === "AllOn") {
        for (const g of I.ids) {
          if (!this.#g.has(g))
            return L(`Optional content group not found: ${g}`), !0;
          if (!this.#g.get(g).visible)
            return !1;
        }
        return !0;
      } else if (I.policy === "AnyOff") {
        for (const g of I.ids) {
          if (!this.#g.has(g))
            return L(`Optional content group not found: ${g}`), !0;
          if (!this.#g.get(g).visible)
            return !0;
        }
        return !1;
      } else if (I.policy === "AllOff") {
        for (const g of I.ids) {
          if (!this.#g.has(g))
            return L(`Optional content group not found: ${g}`), !0;
          if (this.#g.get(g).visible)
            return !1;
        }
        return !0;
      }
      return L(`Unknown optional content policy ${I.policy}.`), !0;
    }
    return L(`Unknown group type ${I.type}.`), !0;
  }
  setVisibility(I, g = !0, C = !0) {
    const A = this.#g.get(I);
    if (!A) {
      L(`Optional content group not found: ${I}`);
      return;
    }
    if (C && g && A.rbGroups.length)
      for (const i of A.rbGroups)
        for (const l of i)
          l !== I && this.#g.get(l)?._setVisible(hg, !1, !0);
    A._setVisible(hg, !!g, !0), this.#I = null;
  }
  setOCGState({
    state: I,
    preserveRB: g
  }) {
    let C;
    for (const A of I) {
      switch (A) {
        case "ON":
        case "OFF":
        case "Toggle":
          C = A;
          continue;
      }
      const i = this.#g.get(A);
      if (i)
        switch (C) {
          case "ON":
            this.setVisibility(A, !0, g);
            break;
          case "OFF":
            this.setVisibility(A, !1, g);
            break;
          case "Toggle":
            this.setVisibility(A, !i.visible, g);
            break;
        }
    }
    this.#I = null;
  }
  get hasInitialVisibility() {
    return this.#A === null || this.getHash() === this.#A;
  }
  getOrder() {
    return this.#g.size ? this.#C ? this.#C.slice() : [...this.#g.keys()] : null;
  }
  getGroup(I) {
    return this.#g.get(I) || null;
  }
  getHash() {
    if (this.#I !== null)
      return this.#I;
    const I = new bl();
    for (const [g, C] of this.#g)
      I.update(`${g}:${C.visible}`);
    return this.#I = I.hexdigest();
  }
  [Symbol.iterator]() {
    return this.#g.entries();
  }
}
class Gd {
  constructor(I, {
    disableRange: g = !1,
    disableStream: C = !1
  }) {
    Q(I, 'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');
    const {
      length: A,
      initialData: i,
      progressiveDone: l,
      contentDispositionFilename: s
    } = I;
    if (this._queuedChunks = [], this._progressiveDone = l, this._contentDispositionFilename = s, i?.length > 0) {
      const d = i instanceof Uint8Array && i.byteLength === i.buffer.byteLength ? i.buffer : new Uint8Array(i).buffer;
      this._queuedChunks.push(d);
    }
    this._pdfDataRangeTransport = I, this._isStreamingSupported = !C, this._isRangeSupported = !g, this._contentLength = A, this._fullRequestReader = null, this._rangeReaders = [], I.addRangeListener((d, c) => {
      this._onReceiveData({
        begin: d,
        chunk: c
      });
    }), I.addProgressListener((d, c) => {
      this._onProgress({
        loaded: d,
        total: c
      });
    }), I.addProgressiveReadListener((d) => {
      this._onReceiveData({
        chunk: d
      });
    }), I.addProgressiveDoneListener(() => {
      this._onProgressiveDone();
    }), I.transportReady();
  }
  _onReceiveData({
    begin: I,
    chunk: g
  }) {
    const C = g instanceof Uint8Array && g.byteLength === g.buffer.byteLength ? g.buffer : new Uint8Array(g).buffer;
    if (I === void 0)
      this._fullRequestReader ? this._fullRequestReader._enqueue(C) : this._queuedChunks.push(C);
    else {
      const A = this._rangeReaders.some(function(i) {
        return i._begin !== I ? !1 : (i._enqueue(C), !0);
      });
      Q(A, "_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.");
    }
  }
  get _progressiveDataLength() {
    return this._fullRequestReader?._loaded ?? 0;
  }
  _onProgress(I) {
    I.total === void 0 ? this._rangeReaders[0]?.onProgress?.({
      loaded: I.loaded
    }) : this._fullRequestReader?.onProgress?.({
      loaded: I.loaded,
      total: I.total
    });
  }
  _onProgressiveDone() {
    this._fullRequestReader?.progressiveDone(), this._progressiveDone = !0;
  }
  _removeRangeReader(I) {
    const g = this._rangeReaders.indexOf(I);
    g >= 0 && this._rangeReaders.splice(g, 1);
  }
  getFullReader() {
    Q(!this._fullRequestReader, "PDFDataTransportStream.getFullReader can only be called once.");
    const I = this._queuedChunks;
    return this._queuedChunks = null, new bd(this, I, this._progressiveDone, this._contentDispositionFilename);
  }
  getRangeReader(I, g) {
    if (g <= this._progressiveDataLength)
      return null;
    const C = new od(this, I, g);
    return this._pdfDataRangeTransport.requestDataRange(I, g), this._rangeReaders.push(C), C;
  }
  cancelAllRequests(I) {
    this._fullRequestReader?.cancel(I);
    for (const g of this._rangeReaders.slice(0))
      g.cancel(I);
    this._pdfDataRangeTransport.abort();
  }
}
class bd {
  constructor(I, g, C = !1, A = null) {
    this._stream = I, this._done = C || !1, this._filename = HA(A) ? A : null, this._queuedChunks = g || [], this._loaded = 0;
    for (const i of this._queuedChunks)
      this._loaded += i.byteLength;
    this._requests = [], this._headersReady = Promise.resolve(), I._fullRequestReader = this, this.onProgress = null;
  }
  _enqueue(I) {
    this._done || (this._requests.length > 0 ? this._requests.shift().resolve({
      value: I,
      done: !1
    }) : this._queuedChunks.push(I), this._loaded += I.byteLength);
  }
  get headersReady() {
    return this._headersReady;
  }
  get filename() {
    return this._filename;
  }
  get isRangeSupported() {
    return this._stream._isRangeSupported;
  }
  get isStreamingSupported() {
    return this._stream._isStreamingSupported;
  }
  get contentLength() {
    return this._stream._contentLength;
  }
  async read() {
    if (this._queuedChunks.length > 0)
      return {
        value: this._queuedChunks.shift(),
        done: !1
      };
    if (this._done)
      return {
        value: void 0,
        done: !0
      };
    const I = Promise.withResolvers();
    return this._requests.push(I), I.promise;
  }
  cancel(I) {
    this._done = !0;
    for (const g of this._requests)
      g.resolve({
        value: void 0,
        done: !0
      });
    this._requests.length = 0;
  }
  progressiveDone() {
    this._done || (this._done = !0);
  }
}
class od {
  constructor(I, g, C) {
    this._stream = I, this._begin = g, this._end = C, this._queuedChunk = null, this._requests = [], this._done = !1, this.onProgress = null;
  }
  _enqueue(I) {
    if (!this._done) {
      if (this._requests.length === 0)
        this._queuedChunk = I;
      else {
        this._requests.shift().resolve({
          value: I,
          done: !1
        });
        for (const C of this._requests)
          C.resolve({
            value: void 0,
            done: !0
          });
        this._requests.length = 0;
      }
      this._done = !0, this._stream._removeRangeReader(this);
    }
  }
  get isStreamingSupported() {
    return !1;
  }
  async read() {
    if (this._queuedChunk) {
      const g = this._queuedChunk;
      return this._queuedChunk = null, {
        value: g,
        done: !1
      };
    }
    if (this._done)
      return {
        value: void 0,
        done: !0
      };
    const I = Promise.withResolvers();
    return this._requests.push(I), I.promise;
  }
  cancel(I) {
    this._done = !0;
    for (const g of this._requests)
      g.resolve({
        value: void 0,
        done: !0
      });
    this._requests.length = 0, this._stream._removeRangeReader(this);
  }
}
function md(Z) {
  let I = !0, g = C("filename\\*", "i").exec(Z);
  if (g) {
    g = g[1];
    let G = s(g);
    return G = unescape(G), G = d(G), G = c(G), i(G);
  }
  if (g = l(Z), g) {
    const G = c(g);
    return i(G);
  }
  if (g = C("filename", "i").exec(Z), g) {
    g = g[1];
    let G = s(g);
    return G = c(G), i(G);
  }
  function C(G, b) {
    return new RegExp("(?:^|;)\\s*" + G + '\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)', b);
  }
  function A(G, b) {
    if (G) {
      if (!/^[\x00-\xFF]+$/.test(b))
        return b;
      try {
        const o = new TextDecoder(G, {
          fatal: !0
        }), m = qg(b);
        b = o.decode(m), I = !1;
      } catch {
      }
    }
    return b;
  }
  function i(G) {
    return I && /[\x80-\xff]/.test(G) && (G = A("utf-8", G), I && (G = A("iso-8859-1", G))), G;
  }
  function l(G) {
    const b = [];
    let o;
    const m = C("filename\\*((?!0\\d)\\d+)(\\*?)", "ig");
    for (; (o = m.exec(G)) !== null; ) {
      let [, a, h, t] = o;
      if (a = parseInt(a, 10), a in b) {
        if (a === 0)
          break;
        continue;
      }
      b[a] = [h, t];
    }
    const e = [];
    for (let a = 0; a < b.length && a in b; ++a) {
      let [h, t] = b[a];
      t = s(t), h && (t = unescape(t), a === 0 && (t = d(t))), e.push(t);
    }
    return e.join("");
  }
  function s(G) {
    if (G.startsWith('"')) {
      const b = G.slice(1).split('\\"');
      for (let o = 0; o < b.length; ++o) {
        const m = b[o].indexOf('"');
        m !== -1 && (b[o] = b[o].slice(0, m), b.length = o + 1), b[o] = b[o].replaceAll(/\\(.)/g, "$1");
      }
      G = b.join('"');
    }
    return G;
  }
  function d(G) {
    const b = G.indexOf("'");
    if (b === -1)
      return G;
    const o = G.slice(0, b), e = G.slice(b + 1).replace(/^[^']*'/, "");
    return A(o, e);
  }
  function c(G) {
    return !G.startsWith("=?") || /[\x00-\x19\x80-\xff]/.test(G) ? G : G.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g, function(b, o, m, e) {
      if (m === "q" || m === "Q")
        return e = e.replaceAll("_", " "), e = e.replaceAll(/=([0-9a-fA-F]{2})/g, function(a, h) {
          return String.fromCharCode(parseInt(h, 16));
        }), A(o, e);
      try {
        e = atob(e);
      } catch {
      }
      return A(o, e);
    });
  }
  return "";
}
function Bl(Z, I) {
  const g = new Headers();
  if (!Z || !I || typeof I != "object")
    return g;
  for (const C in I) {
    const A = I[C];
    A !== void 0 && g.append(C, A);
  }
  return g;
}
function zC(Z) {
  return URL.parse(Z)?.origin ?? null;
}
function Wl({
  responseHeaders: Z,
  isHttp: I,
  rangeChunkSize: g,
  disableRange: C
}) {
  const A = {
    allowRangeRequests: !1,
    suggestedLength: void 0
  }, i = parseInt(Z.get("Content-Length"), 10);
  return !Number.isInteger(i) || (A.suggestedLength = i, i <= 2 * g) || C || !I || Z.get("Accept-Ranges") !== "bytes" || (Z.get("Content-Encoding") || "identity") !== "identity" || (A.allowRangeRequests = !0), A;
}
function wl(Z) {
  const I = Z.get("Content-Disposition");
  if (I) {
    let g = md(I);
    if (g.includes("%"))
      try {
        g = decodeURIComponent(g);
      } catch {
      }
    if (HA(g))
      return g;
  }
  return null;
}
function AC(Z, I) {
  return new uC(`Unexpected server response (${Z}) while retrieving PDF "${I}".`, Z, Z === 404 || Z === 0 && I.startsWith("file:"));
}
function nl(Z) {
  return Z === 200 || Z === 206;
}
function Yl(Z, I, g) {
  return {
    method: "GET",
    headers: Z,
    signal: g.signal,
    mode: "cors",
    credentials: I ? "include" : "same-origin",
    redirect: "follow"
  };
}
function Vl(Z) {
  return Z instanceof Uint8Array ? Z.buffer : Z instanceof ArrayBuffer ? Z : (L(`getArrayBuffer - unexpected data format: ${Z}`), new Uint8Array(Z).buffer);
}
class ad {
  _responseOrigin = null;
  constructor(I) {
    this.source = I, this.isHttp = /^https?:/i.test(I.url), this.headers = Bl(this.isHttp, I.httpHeaders), this._fullRequestReader = null, this._rangeRequestReaders = [];
  }
  get _progressiveDataLength() {
    return this._fullRequestReader?._loaded ?? 0;
  }
  getFullReader() {
    return Q(!this._fullRequestReader, "PDFFetchStream.getFullReader can only be called once."), this._fullRequestReader = new ed(this), this._fullRequestReader;
  }
  getRangeReader(I, g) {
    if (g <= this._progressiveDataLength)
      return null;
    const C = new td(this, I, g);
    return this._rangeRequestReaders.push(C), C;
  }
  cancelAllRequests(I) {
    this._fullRequestReader?.cancel(I);
    for (const g of this._rangeRequestReaders.slice(0))
      g.cancel(I);
  }
}
class ed {
  constructor(I) {
    this._stream = I, this._reader = null, this._loaded = 0, this._filename = null;
    const g = I.source;
    this._withCredentials = g.withCredentials || !1, this._contentLength = g.length, this._headersCapability = Promise.withResolvers(), this._disableRange = g.disableRange || !1, this._rangeChunkSize = g.rangeChunkSize, !this._rangeChunkSize && !this._disableRange && (this._disableRange = !0), this._abortController = new AbortController(), this._isStreamingSupported = !g.disableStream, this._isRangeSupported = !g.disableRange;
    const C = new Headers(I.headers), A = g.url;
    fetch(A, Yl(C, this._withCredentials, this._abortController)).then((i) => {
      if (I._responseOrigin = zC(i.url), !nl(i.status))
        throw AC(i.status, A);
      this._reader = i.body.getReader(), this._headersCapability.resolve();
      const l = i.headers, {
        allowRangeRequests: s,
        suggestedLength: d
      } = Wl({
        responseHeaders: l,
        isHttp: I.isHttp,
        rangeChunkSize: this._rangeChunkSize,
        disableRange: this._disableRange
      });
      this._isRangeSupported = s, this._contentLength = d || this._contentLength, this._filename = wl(l), !this._isStreamingSupported && this._isRangeSupported && this.cancel(new Ig("Streaming is disabled."));
    }).catch(this._headersCapability.reject), this.onProgress = null;
  }
  get headersReady() {
    return this._headersCapability.promise;
  }
  get filename() {
    return this._filename;
  }
  get contentLength() {
    return this._contentLength;
  }
  get isRangeSupported() {
    return this._isRangeSupported;
  }
  get isStreamingSupported() {
    return this._isStreamingSupported;
  }
  async read() {
    await this._headersCapability.promise;
    const {
      value: I,
      done: g
    } = await this._reader.read();
    return g ? {
      value: I,
      done: g
    } : (this._loaded += I.byteLength, this.onProgress?.({
      loaded: this._loaded,
      total: this._contentLength
    }), {
      value: Vl(I),
      done: !1
    });
  }
  cancel(I) {
    this._reader?.cancel(I), this._abortController.abort();
  }
}
class td {
  constructor(I, g, C) {
    this._stream = I, this._reader = null, this._loaded = 0;
    const A = I.source;
    this._withCredentials = A.withCredentials || !1, this._readCapability = Promise.withResolvers(), this._isStreamingSupported = !A.disableStream, this._abortController = new AbortController();
    const i = new Headers(I.headers);
    i.append("Range", `bytes=${g}-${C - 1}`);
    const l = A.url;
    fetch(l, Yl(i, this._withCredentials, this._abortController)).then((s) => {
      const d = zC(s.url);
      if (d !== I._responseOrigin)
        throw new Error(`Expected range response-origin "${d}" to match "${I._responseOrigin}".`);
      if (!nl(s.status))
        throw AC(s.status, l);
      this._readCapability.resolve(), this._reader = s.body.getReader();
    }).catch(this._readCapability.reject), this.onProgress = null;
  }
  get isStreamingSupported() {
    return this._isStreamingSupported;
  }
  async read() {
    await this._readCapability.promise;
    const {
      value: I,
      done: g
    } = await this._reader.read();
    return g ? {
      value: I,
      done: g
    } : (this._loaded += I.byteLength, this.onProgress?.({
      loaded: this._loaded
    }), {
      value: Vl(I),
      done: !1
    });
  }
  cancel(I) {
    this._reader?.cancel(I), this._abortController.abort();
  }
}
const PC = 200, fC = 206;
function hd(Z) {
  const I = Z.response;
  return typeof I != "string" ? I : qg(I).buffer;
}
class Bd {
  _responseOrigin = null;
  constructor({
    url: I,
    httpHeaders: g,
    withCredentials: C
  }) {
    this.url = I, this.isHttp = /^https?:/i.test(I), this.headers = Bl(this.isHttp, g), this.withCredentials = C || !1, this.currXhrId = 0, this.pendingRequests = /* @__PURE__ */ Object.create(null);
  }
  request(I) {
    const g = new XMLHttpRequest(), C = this.currXhrId++, A = this.pendingRequests[C] = {
      xhr: g
    };
    g.open("GET", this.url), g.withCredentials = this.withCredentials;
    for (const [i, l] of this.headers)
      g.setRequestHeader(i, l);
    return this.isHttp && "begin" in I && "end" in I ? (g.setRequestHeader("Range", `bytes=${I.begin}-${I.end - 1}`), A.expectedStatus = fC) : A.expectedStatus = PC, g.responseType = "arraybuffer", Q(I.onError, "Expected `onError` callback to be provided."), g.onerror = () => {
      I.onError(g.status);
    }, g.onreadystatechange = this.onStateChange.bind(this, C), g.onprogress = this.onProgress.bind(this, C), A.onHeadersReceived = I.onHeadersReceived, A.onDone = I.onDone, A.onError = I.onError, A.onProgress = I.onProgress, g.send(null), C;
  }
  onProgress(I, g) {
    const C = this.pendingRequests[I];
    C && C.onProgress?.(g);
  }
  onStateChange(I, g) {
    const C = this.pendingRequests[I];
    if (!C)
      return;
    const A = C.xhr;
    if (A.readyState >= 2 && C.onHeadersReceived && (C.onHeadersReceived(), delete C.onHeadersReceived), A.readyState !== 4 || !(I in this.pendingRequests))
      return;
    if (delete this.pendingRequests[I], A.status === 0 && this.isHttp) {
      C.onError(A.status);
      return;
    }
    const i = A.status || PC;
    if (!(i === PC && C.expectedStatus === fC) && i !== C.expectedStatus) {
      C.onError(A.status);
      return;
    }
    const s = hd(A);
    if (i === fC) {
      const d = A.getResponseHeader("Content-Range"), c = /bytes (\d+)-(\d+)\/(\d+)/.exec(d);
      c ? C.onDone({
        begin: parseInt(c[1], 10),
        chunk: s
      }) : (L('Missing or invalid "Content-Range" header.'), C.onError(0));
    } else s ? C.onDone({
      begin: 0,
      chunk: s
    }) : C.onError(A.status);
  }
  getRequestXhr(I) {
    return this.pendingRequests[I].xhr;
  }
  isPendingRequest(I) {
    return I in this.pendingRequests;
  }
  abortRequest(I) {
    const g = this.pendingRequests[I].xhr;
    delete this.pendingRequests[I], g.abort();
  }
}
class Wd {
  constructor(I) {
    this._source = I, this._manager = new Bd(I), this._rangeChunkSize = I.rangeChunkSize, this._fullRequestReader = null, this._rangeRequestReaders = [];
  }
  _onRangeRequestReaderClosed(I) {
    const g = this._rangeRequestReaders.indexOf(I);
    g >= 0 && this._rangeRequestReaders.splice(g, 1);
  }
  getFullReader() {
    return Q(!this._fullRequestReader, "PDFNetworkStream.getFullReader can only be called once."), this._fullRequestReader = new wd(this._manager, this._source), this._fullRequestReader;
  }
  getRangeReader(I, g) {
    const C = new nd(this._manager, I, g);
    return C.onClosed = this._onRangeRequestReaderClosed.bind(this), this._rangeRequestReaders.push(C), C;
  }
  cancelAllRequests(I) {
    this._fullRequestReader?.cancel(I);
    for (const g of this._rangeRequestReaders.slice(0))
      g.cancel(I);
  }
}
class wd {
  constructor(I, g) {
    this._manager = I, this._url = g.url, this._fullRequestId = I.request({
      onHeadersReceived: this._onHeadersReceived.bind(this),
      onDone: this._onDone.bind(this),
      onError: this._onError.bind(this),
      onProgress: this._onProgress.bind(this)
    }), this._headersCapability = Promise.withResolvers(), this._disableRange = g.disableRange || !1, this._contentLength = g.length, this._rangeChunkSize = g.rangeChunkSize, !this._rangeChunkSize && !this._disableRange && (this._disableRange = !0), this._isStreamingSupported = !1, this._isRangeSupported = !1, this._cachedChunks = [], this._requests = [], this._done = !1, this._storedError = void 0, this._filename = null, this.onProgress = null;
  }
  _onHeadersReceived() {
    const I = this._fullRequestId, g = this._manager.getRequestXhr(I);
    this._manager._responseOrigin = zC(g.responseURL);
    const C = g.getAllResponseHeaders(), A = new Headers(C ? C.trimStart().replace(/[^\S ]+$/, "").split(/[\r\n]+/).map((s) => {
      const [d, ...c] = s.split(": ");
      return [d, c.join(": ")];
    }) : []), {
      allowRangeRequests: i,
      suggestedLength: l
    } = Wl({
      responseHeaders: A,
      isHttp: this._manager.isHttp,
      rangeChunkSize: this._rangeChunkSize,
      disableRange: this._disableRange
    });
    i && (this._isRangeSupported = !0), this._contentLength = l || this._contentLength, this._filename = wl(A), this._isRangeSupported && this._manager.abortRequest(I), this._headersCapability.resolve();
  }
  _onDone(I) {
    if (I && (this._requests.length > 0 ? this._requests.shift().resolve({
      value: I.chunk,
      done: !1
    }) : this._cachedChunks.push(I.chunk)), this._done = !0, !(this._cachedChunks.length > 0)) {
      for (const g of this._requests)
        g.resolve({
          value: void 0,
          done: !0
        });
      this._requests.length = 0;
    }
  }
  _onError(I) {
    this._storedError = AC(I, this._url), this._headersCapability.reject(this._storedError);
    for (const g of this._requests)
      g.reject(this._storedError);
    this._requests.length = 0, this._cachedChunks.length = 0;
  }
  _onProgress(I) {
    this.onProgress?.({
      loaded: I.loaded,
      total: I.lengthComputable ? I.total : this._contentLength
    });
  }
  get filename() {
    return this._filename;
  }
  get isRangeSupported() {
    return this._isRangeSupported;
  }
  get isStreamingSupported() {
    return this._isStreamingSupported;
  }
  get contentLength() {
    return this._contentLength;
  }
  get headersReady() {
    return this._headersCapability.promise;
  }
  async read() {
    if (await this._headersCapability.promise, this._storedError)
      throw this._storedError;
    if (this._cachedChunks.length > 0)
      return {
        value: this._cachedChunks.shift(),
        done: !1
      };
    if (this._done)
      return {
        value: void 0,
        done: !0
      };
    const I = Promise.withResolvers();
    return this._requests.push(I), I.promise;
  }
  cancel(I) {
    this._done = !0, this._headersCapability.reject(I);
    for (const g of this._requests)
      g.resolve({
        value: void 0,
        done: !0
      });
    this._requests.length = 0, this._manager.isPendingRequest(this._fullRequestId) && this._manager.abortRequest(this._fullRequestId), this._fullRequestReader = null;
  }
}
class nd {
  constructor(I, g, C) {
    this._manager = I, this._url = I.url, this._requestId = I.request({
      begin: g,
      end: C,
      onHeadersReceived: this._onHeadersReceived.bind(this),
      onDone: this._onDone.bind(this),
      onError: this._onError.bind(this),
      onProgress: this._onProgress.bind(this)
    }), this._requests = [], this._queuedChunk = null, this._done = !1, this._storedError = void 0, this.onProgress = null, this.onClosed = null;
  }
  _onHeadersReceived() {
    const I = zC(this._manager.getRequestXhr(this._requestId)?.responseURL);
    I !== this._manager._responseOrigin && (this._storedError = new Error(`Expected range response-origin "${I}" to match "${this._manager._responseOrigin}".`), this._onError(0));
  }
  _close() {
    this.onClosed?.(this);
  }
  _onDone(I) {
    const g = I.chunk;
    this._requests.length > 0 ? this._requests.shift().resolve({
      value: g,
      done: !1
    }) : this._queuedChunk = g, this._done = !0;
    for (const C of this._requests)
      C.resolve({
        value: void 0,
        done: !0
      });
    this._requests.length = 0, this._close();
  }
  _onError(I) {
    this._storedError ??= AC(I, this._url);
    for (const g of this._requests)
      g.reject(this._storedError);
    this._requests.length = 0, this._queuedChunk = null;
  }
  _onProgress(I) {
    this.isStreamingSupported || this.onProgress?.({
      loaded: I.loaded
    });
  }
  get isStreamingSupported() {
    return !1;
  }
  async read() {
    if (this._storedError)
      throw this._storedError;
    if (this._queuedChunk !== null) {
      const g = this._queuedChunk;
      return this._queuedChunk = null, {
        value: g,
        done: !1
      };
    }
    if (this._done)
      return {
        value: void 0,
        done: !0
      };
    const I = Promise.withResolvers();
    return this._requests.push(I), I.promise;
  }
  cancel(I) {
    this._done = !0;
    for (const g of this._requests)
      g.resolve({
        value: void 0,
        done: !0
      });
    this._requests.length = 0, this._manager.isPendingRequest(this._requestId) && this._manager.abortRequest(this._requestId), this._close();
  }
}
const Yd = /^[a-z][a-z0-9\-+.]+:/i;
function Vd(Z) {
  if (Yd.test(Z))
    return new URL(Z);
  const I = process.getBuiltinModule("url");
  return new URL(I.pathToFileURL(Z));
}
class Nd {
  constructor(I) {
    this.source = I, this.url = Vd(I.url), Q(this.url.protocol === "file:", "PDFNodeStream only supports file:// URLs."), this._fullRequestReader = null, this._rangeRequestReaders = [];
  }
  get _progressiveDataLength() {
    return this._fullRequestReader?._loaded ?? 0;
  }
  getFullReader() {
    return Q(!this._fullRequestReader, "PDFNodeStream.getFullReader can only be called once."), this._fullRequestReader = new ud(this), this._fullRequestReader;
  }
  getRangeReader(I, g) {
    if (g <= this._progressiveDataLength)
      return null;
    const C = new Rd(this, I, g);
    return this._rangeRequestReaders.push(C), C;
  }
  cancelAllRequests(I) {
    this._fullRequestReader?.cancel(I);
    for (const g of this._rangeRequestReaders.slice(0))
      g.cancel(I);
  }
}
class ud {
  constructor(I) {
    this._url = I.url, this._done = !1, this._storedError = null, this.onProgress = null;
    const g = I.source;
    this._contentLength = g.length, this._loaded = 0, this._filename = null, this._disableRange = g.disableRange || !1, this._rangeChunkSize = g.rangeChunkSize, !this._rangeChunkSize && !this._disableRange && (this._disableRange = !0), this._isStreamingSupported = !g.disableStream, this._isRangeSupported = !g.disableRange, this._readableStream = null, this._readCapability = Promise.withResolvers(), this._headersCapability = Promise.withResolvers();
    const C = process.getBuiltinModule("fs");
    C.promises.lstat(this._url).then((A) => {
      this._contentLength = A.size, this._setReadableStream(C.createReadStream(this._url)), this._headersCapability.resolve();
    }, (A) => {
      A.code === "ENOENT" && (A = AC(0, this._url.href)), this._storedError = A, this._headersCapability.reject(A);
    });
  }
  get headersReady() {
    return this._headersCapability.promise;
  }
  get filename() {
    return this._filename;
  }
  get contentLength() {
    return this._contentLength;
  }
  get isRangeSupported() {
    return this._isRangeSupported;
  }
  get isStreamingSupported() {
    return this._isStreamingSupported;
  }
  async read() {
    if (await this._readCapability.promise, this._done)
      return {
        value: void 0,
        done: !0
      };
    if (this._storedError)
      throw this._storedError;
    const I = this._readableStream.read();
    return I === null ? (this._readCapability = Promise.withResolvers(), this.read()) : (this._loaded += I.length, this.onProgress?.({
      loaded: this._loaded,
      total: this._contentLength
    }), {
      value: new Uint8Array(I).buffer,
      done: !1
    });
  }
  cancel(I) {
    if (!this._readableStream) {
      this._error(I);
      return;
    }
    this._readableStream.destroy(I);
  }
  _error(I) {
    this._storedError = I, this._readCapability.resolve();
  }
  _setReadableStream(I) {
    this._readableStream = I, I.on("readable", () => {
      this._readCapability.resolve();
    }), I.on("end", () => {
      I.destroy(), this._done = !0, this._readCapability.resolve();
    }), I.on("error", (g) => {
      this._error(g);
    }), !this._isStreamingSupported && this._isRangeSupported && this._error(new Ig("streaming is disabled")), this._storedError && this._readableStream.destroy(this._storedError);
  }
}
class Rd {
  constructor(I, g, C) {
    this._url = I.url, this._done = !1, this._storedError = null, this.onProgress = null, this._loaded = 0, this._readableStream = null, this._readCapability = Promise.withResolvers();
    const A = I.source;
    this._isStreamingSupported = !A.disableStream;
    const i = process.getBuiltinModule("fs");
    this._setReadableStream(i.createReadStream(this._url, {
      start: g,
      end: C - 1
    }));
  }
  get isStreamingSupported() {
    return this._isStreamingSupported;
  }
  async read() {
    if (await this._readCapability.promise, this._done)
      return {
        value: void 0,
        done: !0
      };
    if (this._storedError)
      throw this._storedError;
    const I = this._readableStream.read();
    return I === null ? (this._readCapability = Promise.withResolvers(), this.read()) : (this._loaded += I.length, this.onProgress?.({
      loaded: this._loaded
    }), {
      value: new Uint8Array(I).buffer,
      done: !1
    });
  }
  cancel(I) {
    if (!this._readableStream) {
      this._error(I);
      return;
    }
    this._readableStream.destroy(I);
  }
  _error(I) {
    this._storedError = I, this._readCapability.resolve();
  }
  _setReadableStream(I) {
    this._readableStream = I, I.on("readable", () => {
      this._readCapability.resolve();
    }), I.on("end", () => {
      I.destroy(), this._done = !0, this._readCapability.resolve();
    }), I.on("error", (g) => {
      this._error(g);
    }), this._storedError && this._readableStream.destroy(this._storedError);
  }
}
const pg = Symbol("INITIAL_DATA");
class Nl {
  #I = /* @__PURE__ */ Object.create(null);
  #g(I) {
    return this.#I[I] ||= {
      ...Promise.withResolvers(),
      data: pg
    };
  }
  get(I, g = null) {
    if (g) {
      const A = this.#g(I);
      return A.promise.then(() => g(A.data)), null;
    }
    const C = this.#I[I];
    if (!C || C.data === pg)
      throw new Error(`Requesting object that isn't resolved yet ${I}.`);
    return C.data;
  }
  has(I) {
    const g = this.#I[I];
    return !!g && g.data !== pg;
  }
  delete(I) {
    const g = this.#I[I];
    return !g || g.data === pg ? !1 : (delete this.#I[I], !0);
  }
  resolve(I, g = null) {
    const C = this.#g(I);
    C.data = g, C.resolve();
  }
  clear() {
    for (const I in this.#I) {
      const {
        data: g
      } = this.#I[I];
      g?.bitmap?.close();
    }
    this.#I = /* @__PURE__ */ Object.create(null);
  }
  *[Symbol.iterator]() {
    for (const I in this.#I) {
      const {
        data: g
      } = this.#I[I];
      g !== pg && (yield [I, g]);
    }
  }
}
const yd = 1e5, hi = 30;
let yC = class uI {
  #I = Promise.withResolvers();
  #g = null;
  #A = !1;
  #C = !!globalThis.FontInspector?.enabled;
  #i = null;
  #l = null;
  #s = 0;
  #d = 0;
  #c = null;
  #Z = null;
  #o = 0;
  #b = 0;
  #m = /* @__PURE__ */ Object.create(null);
  #t = [];
  #a = null;
  #G = [];
  #e = /* @__PURE__ */ new WeakMap();
  #B = null;
  static #W = /* @__PURE__ */ new Map();
  static #h = /* @__PURE__ */ new Map();
  static #N = /* @__PURE__ */ new WeakMap();
  static #w = null;
  static #n = /* @__PURE__ */ new Set();
  constructor({
    textContentSource: I,
    container: g,
    viewport: C
  }) {
    if (I instanceof ReadableStream)
      this.#a = I;
    else if (typeof I == "object")
      this.#a = new ReadableStream({
        start(d) {
          d.enqueue(I), d.close();
        }
      });
    else
      throw new Error('No "textContentSource" parameter specified.');
    this.#g = this.#Z = g, this.#b = C.scale * Gg.pixelRatio, this.#o = C.rotation, this.#l = {
      div: null,
      properties: null,
      ctx: null
    };
    const {
      pageWidth: A,
      pageHeight: i,
      pageX: l,
      pageY: s
    } = C.rawDims;
    this.#B = [1, 0, 0, -1, -l, s + i], this.#d = A, this.#s = i, uI.#X(), cg(g, C), this.#I.promise.finally(() => {
      uI.#n.delete(this), this.#l = null, this.#m = null;
    }).catch(() => {
    });
  }
  static get fontFamilyMap() {
    const {
      isWindows: I,
      isFirefox: g
    } = GI.platform;
    return T(this, "fontFamilyMap", /* @__PURE__ */ new Map([["sans-serif", `${I && g ? "Calibri, " : ""}sans-serif`], ["monospace", `${I && g ? "Lucida Console, " : ""}monospace`]]));
  }
  render() {
    const I = () => {
      this.#c.read().then(({
        value: g,
        done: C
      }) => {
        if (C) {
          this.#I.resolve();
          return;
        }
        this.#i ??= g.lang, Object.assign(this.#m, g.styles), this.#R(g.items), I();
      }, this.#I.reject);
    };
    return this.#c = this.#a.getReader(), uI.#n.add(this), I(), this.#I.promise;
  }
  update({
    viewport: I,
    onBefore: g = null
  }) {
    const C = I.scale * Gg.pixelRatio, A = I.rotation;
    if (A !== this.#o && (g?.(), this.#o = A, cg(this.#Z, {
      rotation: A
    })), C !== this.#b) {
      g?.(), this.#b = C;
      const i = {
        div: null,
        properties: null,
        ctx: uI.#M(this.#i)
      };
      for (const l of this.#G)
        i.properties = this.#e.get(l), i.div = l, this.#u(i);
    }
  }
  cancel() {
    const I = new Ig("TextLayer task cancelled.");
    this.#c?.cancel(I).catch(() => {
    }), this.#c = null, this.#I.reject(I);
  }
  get textDivs() {
    return this.#G;
  }
  get textContentItemsStr() {
    return this.#t;
  }
  #R(I) {
    if (this.#A)
      return;
    this.#l.ctx ??= uI.#M(this.#i);
    const g = this.#G, C = this.#t;
    for (const A of I) {
      if (g.length > yd) {
        L("Ignoring additional textDivs for performance reasons."), this.#A = !0;
        return;
      }
      if (A.str === void 0) {
        if (A.type === "beginMarkedContentProps" || A.type === "beginMarkedContent") {
          const i = this.#g;
          this.#g = document.createElement("span"), this.#g.classList.add("markedContent"), A.id && this.#g.setAttribute("id", `${A.id}`), i.append(this.#g);
        } else A.type === "endMarkedContent" && (this.#g = this.#g.parentNode);
        continue;
      }
      C.push(A.str), this.#Y(A);
    }
  }
  #Y(I) {
    const g = document.createElement("span"), C = {
      angle: 0,
      canvasWidth: 0,
      hasText: I.str !== "",
      hasEOL: I.hasEOL,
      fontSize: 0
    };
    this.#G.push(g);
    const A = M.transform(this.#B, I.transform);
    let i = Math.atan2(A[1], A[0]);
    const l = this.#m[I.fontName];
    l.vertical && (i += Math.PI / 2);
    let s = this.#C && l.fontSubstitution || l.fontFamily;
    s = uI.fontFamilyMap.get(s) || s;
    const d = Math.hypot(A[2], A[3]), c = d * uI.#p(s, l, this.#i);
    let G, b;
    i === 0 ? (G = A[4], b = A[5] - c) : (G = A[4] + c * Math.sin(i), b = A[5] - c * Math.cos(i));
    const o = "calc(var(--total-scale-factor) *", m = g.style;
    this.#g === this.#Z ? (m.left = `${(100 * G / this.#d).toFixed(2)}%`, m.top = `${(100 * b / this.#s).toFixed(2)}%`) : (m.left = `${o}${G.toFixed(2)}px)`, m.top = `${o}${b.toFixed(2)}px)`), m.fontSize = `${o}${(uI.#w * d).toFixed(2)}px)`, m.fontFamily = s, C.fontSize = d, g.setAttribute("role", "presentation"), g.textContent = I.str, g.dir = I.dir, this.#C && (g.dataset.fontName = l.fontSubstitutionLoadedName || I.fontName), i !== 0 && (C.angle = i * (180 / Math.PI));
    let e = !1;
    if (I.str.length > 1)
      e = !0;
    else if (I.str !== " " && I.transform[0] !== I.transform[3]) {
      const a = Math.abs(I.transform[0]), h = Math.abs(I.transform[3]);
      a !== h && Math.max(a, h) / Math.min(a, h) > 1.5 && (e = !0);
    }
    if (e && (C.canvasWidth = l.vertical ? I.height : I.width), this.#e.set(g, C), this.#l.div = g, this.#l.properties = C, this.#u(this.#l), C.hasText && this.#g.append(g), C.hasEOL) {
      const a = document.createElement("br");
      a.setAttribute("role", "presentation"), this.#g.append(a);
    }
  }
  #u(I) {
    const {
      div: g,
      properties: C,
      ctx: A
    } = I, {
      style: i
    } = g;
    let l = "";
    if (uI.#w > 1 && (l = `scale(${1 / uI.#w})`), C.canvasWidth !== 0 && C.hasText) {
      const {
        fontFamily: s
      } = i, {
        canvasWidth: d,
        fontSize: c
      } = C;
      uI.#y(A, c * this.#b, s);
      const {
        width: G
      } = A.measureText(g.textContent);
      G > 0 && (l = `scaleX(${d * this.#b / G}) ${l}`);
    }
    C.angle !== 0 && (l = `rotate(${C.angle}deg) ${l}`), l.length > 0 && (i.transform = l);
  }
  static cleanup() {
    if (!(this.#n.size > 0)) {
      this.#W.clear();
      for (const {
        canvas: I
      } of this.#h.values())
        I.remove();
      this.#h.clear();
    }
  }
  static #M(I = null) {
    let g = this.#h.get(I ||= "");
    if (!g) {
      const C = document.createElement("canvas");
      C.className = "hiddenCanvasElement", C.lang = I, document.body.append(C), g = C.getContext("2d", {
        alpha: !1,
        willReadFrequently: !0
      }), this.#h.set(I, g), this.#N.set(g, {
        size: 0,
        family: ""
      });
    }
    return g;
  }
  static #y(I, g, C) {
    const A = this.#N.get(I);
    g === A.size && C === A.family || (I.font = `${g}px ${C}`, A.size = g, A.family = C);
  }
  static #X() {
    if (this.#w !== null)
      return;
    const I = document.createElement("div");
    I.style.opacity = 0, I.style.lineHeight = 1, I.style.fontSize = "1px", I.style.position = "absolute", I.textContent = "X", document.body.append(I), this.#w = I.getBoundingClientRect().height, I.remove();
  }
  static #p(I, g, C) {
    const A = this.#W.get(I);
    if (A)
      return A;
    const i = this.#M(C);
    i.canvas.width = i.canvas.height = hi, this.#y(i, hi, I);
    const l = i.measureText(""), s = l.fontBoundingBoxAscent, d = Math.abs(l.fontBoundingBoxDescent);
    i.canvas.width = i.canvas.height = 0;
    let c = 0.8;
    return s ? c = s / (s + d) : (GI.platform.isFirefox && L("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."), g.ascent ? c = g.ascent : g.descent && (c = 1 + g.descent)), this.#W.set(I, c), c;
  }
};
const Xd = 100;
function ul(Z = {}) {
  typeof Z == "string" || Z instanceof URL ? Z = {
    url: Z
  } : (Z instanceof ArrayBuffer || ArrayBuffer.isView(Z)) && (Z = {
    data: Z
  });
  const I = new zA(), {
    docId: g
  } = I, C = Z.url ? Fs(Z.url) : null, A = Z.data ? zs(Z.data) : null, i = Z.httpHeaders || null, l = Z.withCredentials === !0, s = Z.password ?? null, d = Z.range instanceof Rl ? Z.range : null, c = Number.isInteger(Z.rangeChunkSize) && Z.rangeChunkSize > 0 ? Z.rangeChunkSize : 2 ** 16;
  let G = Z.worker instanceof eA ? Z.worker : null;
  const b = Z.verbosity, o = typeof Z.docBaseUrl == "string" && !FC(Z.docBaseUrl) ? Z.docBaseUrl : null, m = dC(Z.cMapUrl), e = Z.cMapPacked !== !1, a = Z.CMapReaderFactory || (aI ? xs : Ai), h = dC(Z.iccUrl), t = dC(Z.standardFontDataUrl), W = Z.StandardFontDataFactory || (aI ? Os : ii), B = dC(Z.wasmUrl), w = Z.WasmFactory || (aI ? Us : li), n = Z.stopAtErrors !== !0, V = Number.isInteger(Z.maxImageSize) && Z.maxImageSize > -1 ? Z.maxImageSize : -1, N = Z.isEvalSupported !== !1, R = typeof Z.isOffscreenCanvasSupported == "boolean" ? Z.isOffscreenCanvasSupported : !aI, Y = typeof Z.isImageDecoderSupported == "boolean" ? Z.isImageDecoderSupported : !aI && (GI.platform.isFirefox || !globalThis.chrome), y = Number.isInteger(Z.canvasMaxAreaInBytes) ? Z.canvasMaxAreaInBytes : -1, X = typeof Z.disableFontFace == "boolean" ? Z.disableFontFace : aI, K = Z.fontExtraProperties === !0, S = Z.enableXfa === !0, p = Z.ownerDocument || globalThis.document, r = Z.disableRange === !0, D = Z.disableStream === !0, z = Z.disableAutoFetch === !0, U = Z.pdfBug === !0, mI = Z.CanvasFactory || (aI ? Qs : rs), kI = Z.FilterFactory || (aI ? js : Ts), UI = Z.enableHWA === !0, sI = Z.useWasm !== !1, _ = d ? d.length : Z.length ?? NaN, Cg = typeof Z.useSystemFonts == "boolean" ? Z.useSystemFonts : !aI && !X, vI = typeof Z.useWorkerFetch == "boolean" ? Z.useWorkerFetch : !!(a === Ai && W === ii && w === li && m && t && B && Lg(m, document.baseURI) && Lg(t, document.baseURI) && Lg(B, document.baseURI)), EI = null;
  cs(b);
  const CI = {
    canvasFactory: new mI({
      ownerDocument: p,
      enableHWA: UI
    }),
    filterFactory: new kI({
      docId: g,
      ownerDocument: p
    }),
    cMapReaderFactory: vI ? null : new a({
      baseUrl: m,
      isCompressed: e
    }),
    standardFontDataFactory: vI ? null : new W({
      baseUrl: t
    }),
    wasmFactory: vI ? null : new w({
      baseUrl: B
    })
  };
  G || (G = eA.create({
    verbosity: b,
    port: Ng.workerPort
  }), I._worker = G);
  const Dg = {
    docId: g,
    apiVersion: "5.4.296",
    data: A,
    password: s,
    disableAutoFetch: z,
    rangeChunkSize: c,
    length: _,
    docBaseUrl: o,
    enableXfa: S,
    evaluatorOptions: {
      maxImageSize: V,
      disableFontFace: X,
      ignoreErrors: n,
      isEvalSupported: N,
      isOffscreenCanvasSupported: R,
      isImageDecoderSupported: Y,
      canvasMaxAreaInBytes: y,
      fontExtraProperties: K,
      useSystemFonts: Cg,
      useWasm: sI,
      useWorkerFetch: vI,
      cMapUrl: m,
      iccUrl: h,
      standardFontDataUrl: t,
      wasmUrl: B
    }
  }, Kg = {
    ownerDocument: p,
    pdfBug: U,
    styleElement: EI,
    loadingParams: {
      disableAutoFetch: z,
      enableXfa: S
    }
  };
  return G.promise.then(function() {
    if (I.destroyed)
      throw new Error("Loading aborted");
    if (G.destroyed)
      throw new Error("Worker was destroyed");
    const As = G.messageHandler.sendWithPromise("GetDocRequest", Dg, A ? [A.buffer] : null);
    let rC;
    if (d)
      rC = new Gd(d, {
        disableRange: r,
        disableStream: D
      });
    else if (!A) {
      if (!C)
        throw new Error("getDocument - no `url` parameter provided.");
      const TC = Lg(C) ? ad : aI ? Nd : Wd;
      rC = new TC({
        url: C,
        length: _,
        httpHeaders: i,
        withCredentials: l,
        rangeChunkSize: c,
        disableRange: r,
        disableStream: D
      });
    }
    return As.then((TC) => {
      if (I.destroyed)
        throw new Error("Loading aborted");
      if (G.destroyed)
        throw new Error("Worker was destroyed");
      const xA = new kg(g, TC, G.port), is = new Dd(xA, I, rC, Kg, CI, UI);
      I._transport = is, xA.send("Ready", null);
    });
  }).catch(I._capability.reject), I;
}
class zA {
  static #I = 0;
  _capability = Promise.withResolvers();
  _transport = null;
  _worker = null;
  docId = `d${zA.#I++}`;
  destroyed = !1;
  onPassword = null;
  onProgress = null;
  get promise() {
    return this._capability.promise;
  }
  async destroy() {
    this.destroyed = !0;
    try {
      this._worker?.port && (this._worker._pendingDestroy = !0), await this._transport?.destroy();
    } catch (I) {
      throw this._worker?.port && delete this._worker._pendingDestroy, I;
    }
    this._transport = null, this._worker?.destroy(), this._worker = null;
  }
  async getData() {
    return this._transport.getData();
  }
}
let Rl = class {
  #I = Promise.withResolvers();
  #g = [];
  #A = [];
  #C = [];
  #i = [];
  constructor(I, g, C = !1, A = null) {
    this.length = I, this.initialData = g, this.progressiveDone = C, this.contentDispositionFilename = A;
  }
  addRangeListener(I) {
    this.#i.push(I);
  }
  addProgressListener(I) {
    this.#C.push(I);
  }
  addProgressiveReadListener(I) {
    this.#A.push(I);
  }
  addProgressiveDoneListener(I) {
    this.#g.push(I);
  }
  onDataRange(I, g) {
    for (const C of this.#i)
      C(I, g);
  }
  onDataProgress(I, g) {
    this.#I.promise.then(() => {
      for (const C of this.#C)
        C(I, g);
    });
  }
  onDataProgressiveRead(I) {
    this.#I.promise.then(() => {
      for (const g of this.#A)
        g(I);
    });
  }
  onDataProgressiveDone() {
    this.#I.promise.then(() => {
      for (const I of this.#g)
        I();
    });
  }
  transportReady() {
    this.#I.resolve();
  }
  requestDataRange(I, g) {
    f("Abstract method PDFDataRangeTransport.requestDataRange");
  }
  abort() {
  }
};
class Hd {
  constructor(I, g) {
    this._pdfInfo = I, this._transport = g;
  }
  get annotationStorage() {
    return this._transport.annotationStorage;
  }
  get canvasFactory() {
    return this._transport.canvasFactory;
  }
  get filterFactory() {
    return this._transport.filterFactory;
  }
  get numPages() {
    return this._pdfInfo.numPages;
  }
  get fingerprints() {
    return this._pdfInfo.fingerprints;
  }
  get isPureXfa() {
    return T(this, "isPureXfa", !!this._transport._htmlForXfa);
  }
  get allXfaHtml() {
    return this._transport._htmlForXfa;
  }
  getPage(I) {
    return this._transport.getPage(I);
  }
  getPageIndex(I) {
    return this._transport.getPageIndex(I);
  }
  getDestinations() {
    return this._transport.getDestinations();
  }
  getDestination(I) {
    return this._transport.getDestination(I);
  }
  getPageLabels() {
    return this._transport.getPageLabels();
  }
  getPageLayout() {
    return this._transport.getPageLayout();
  }
  getPageMode() {
    return this._transport.getPageMode();
  }
  getViewerPreferences() {
    return this._transport.getViewerPreferences();
  }
  getOpenAction() {
    return this._transport.getOpenAction();
  }
  getAttachments() {
    return this._transport.getAttachments();
  }
  getAnnotationsByType(I, g) {
    return this._transport.getAnnotationsByType(I, g);
  }
  getJSActions() {
    return this._transport.getDocJSActions();
  }
  getOutline() {
    return this._transport.getOutline();
  }
  getOptionalContentConfig({
    intent: I = "display"
  } = {}) {
    const {
      renderingIntent: g
    } = this._transport.getRenderingIntent(I);
    return this._transport.getOptionalContentConfig(g);
  }
  getPermissions() {
    return this._transport.getPermissions();
  }
  getMetadata() {
    return this._transport.getMetadata();
  }
  getMarkInfo() {
    return this._transport.getMarkInfo();
  }
  getData() {
    return this._transport.getData();
  }
  saveDocument() {
    return this._transport.saveDocument();
  }
  getDownloadInfo() {
    return this._transport.downloadInfoCapability.promise;
  }
  cleanup(I = !1) {
    return this._transport.startCleanup(I || this.isPureXfa);
  }
  destroy() {
    return this.loadingTask.destroy();
  }
  cachedPageNumber(I) {
    return this._transport.cachedPageNumber(I);
  }
  get loadingParams() {
    return this._transport.loadingParams;
  }
  get loadingTask() {
    return this._transport.loadingTask;
  }
  getFieldObjects() {
    return this._transport.getFieldObjects();
  }
  hasJSActions() {
    return this._transport.hasJSActions();
  }
  getCalculationOrderIds() {
    return this._transport.getCalculationOrderIds();
  }
}
class Md {
  #I = !1;
  constructor(I, g, C, A = !1) {
    this._pageIndex = I, this._pageInfo = g, this._transport = C, this._stats = A ? new fA() : null, this._pdfBug = A, this.commonObjs = C.commonObjs, this.objs = new Nl(), this._intentStates = /* @__PURE__ */ new Map(), this.destroyed = !1, this.recordedBBoxes = null;
  }
  get pageNumber() {
    return this._pageIndex + 1;
  }
  get rotate() {
    return this._pageInfo.rotate;
  }
  get ref() {
    return this._pageInfo.ref;
  }
  get userUnit() {
    return this._pageInfo.userUnit;
  }
  get view() {
    return this._pageInfo.view;
  }
  getViewport({
    scale: I,
    rotation: g = this.rotate,
    offsetX: C = 0,
    offsetY: A = 0,
    dontFlip: i = !1
  } = {}) {
    return new IC({
      viewBox: this.view,
      userUnit: this.userUnit,
      scale: I,
      rotation: g,
      offsetX: C,
      offsetY: A,
      dontFlip: i
    });
  }
  getAnnotations({
    intent: I = "display"
  } = {}) {
    const {
      renderingIntent: g
    } = this._transport.getRenderingIntent(I);
    return this._transport.getAnnotations(this._pageIndex, g);
  }
  getJSActions() {
    return this._transport.getPageJSActions(this._pageIndex);
  }
  get filterFactory() {
    return this._transport.filterFactory;
  }
  get isPureXfa() {
    return T(this, "isPureXfa", !!this._transport._htmlForXfa);
  }
  async getXfa() {
    return this._transport._htmlForXfa?.children[this._pageIndex] || null;
  }
  render({
    canvasContext: I,
    canvas: g = I.canvas,
    viewport: C,
    intent: A = "display",
    annotationMode: i = _I.ENABLE,
    transform: l = null,
    background: s = null,
    optionalContentConfigPromise: d = null,
    annotationCanvasMap: c = null,
    pageColors: G = null,
    printAnnotationStorage: b = null,
    isEditing: o = !1,
    recordOperations: m = !1,
    operationsFilter: e = null
  }) {
    this._stats?.time("Overall");
    const a = this._transport.getRenderingIntent(A, i, b, o), {
      renderingIntent: h,
      cacheKey: t
    } = a;
    this.#I = !1, d ||= this._transport.getOptionalContentConfig(h);
    let W = this._intentStates.get(t);
    W || (W = /* @__PURE__ */ Object.create(null), this._intentStates.set(t, W)), W.streamReaderCancelTimeout && (clearTimeout(W.streamReaderCancelTimeout), W.streamReaderCancelTimeout = null);
    const B = !!(h & nI.PRINT);
    W.displayReadyCapability || (W.displayReadyCapability = Promise.withResolvers(), W.operatorList = {
      fnArray: [],
      argsArray: [],
      lastChunk: !1,
      separateAnnots: null
    }, this._stats?.time("Page Request"), this._pumpOperatorList(a));
    const w = !!(this._pdfBug && globalThis.StepperManager?.enabled), n = !this.recordedBBoxes && (m || w), V = (Y) => {
      if (W.renderTasks.delete(N), n) {
        const y = N.gfx?.dependencyTracker.take();
        y && (N.stepper && N.stepper.setOperatorBBoxes(y, N.gfx.dependencyTracker.takeDebugMetadata()), m && (this.recordedBBoxes = y));
      }
      B && (this.#I = !0), this.#g(), Y ? (N.capability.reject(Y), this._abortOperatorList({
        intentState: W,
        reason: Y instanceof Error ? Y : new Error(Y)
      })) : N.capability.resolve(), this._stats && (this._stats.timeEnd("Rendering"), this._stats.timeEnd("Overall"), globalThis.Stats?.enabled && globalThis.Stats.add(this.pageNumber, this._stats));
    }, N = new wg({
      callback: V,
      params: {
        canvas: g,
        canvasContext: I,
        dependencyTracker: n ? new Es(g, W.operatorList.length, w) : null,
        viewport: C,
        transform: l,
        background: s
      },
      objs: this.objs,
      commonObjs: this.commonObjs,
      annotationCanvasMap: c,
      operatorList: W.operatorList,
      pageIndex: this._pageIndex,
      canvasFactory: this._transport.canvasFactory,
      filterFactory: this._transport.filterFactory,
      useRequestAnimationFrame: !B,
      pdfBug: this._pdfBug,
      pageColors: G,
      enableHWA: this._transport.enableHWA,
      operationsFilter: e
    });
    (W.renderTasks ||= /* @__PURE__ */ new Set()).add(N);
    const R = N.task;
    return Promise.all([W.displayReadyCapability.promise, d]).then(([Y, y]) => {
      if (this.destroyed) {
        V();
        return;
      }
      if (this._stats?.time("Rendering"), !(y.renderingIntent & h))
        throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");
      N.initializeGraphics({
        transparency: Y,
        optionalContentConfig: y
      }), N.operatorListChanged();
    }).catch(V), R;
  }
  getOperatorList({
    intent: I = "display",
    annotationMode: g = _I.ENABLE,
    printAnnotationStorage: C = null,
    isEditing: A = !1
  } = {}) {
    function i() {
      s.operatorList.lastChunk && (s.opListReadCapability.resolve(s.operatorList), s.renderTasks.delete(d));
    }
    const l = this._transport.getRenderingIntent(I, g, C, A, !0);
    let s = this._intentStates.get(l.cacheKey);
    s || (s = /* @__PURE__ */ Object.create(null), this._intentStates.set(l.cacheKey, s));
    let d;
    return s.opListReadCapability || (d = /* @__PURE__ */ Object.create(null), d.operatorListChanged = i, s.opListReadCapability = Promise.withResolvers(), (s.renderTasks ||= /* @__PURE__ */ new Set()).add(d), s.operatorList = {
      fnArray: [],
      argsArray: [],
      lastChunk: !1,
      separateAnnots: null
    }, this._stats?.time("Page Request"), this._pumpOperatorList(l)), s.opListReadCapability.promise;
  }
  streamTextContent({
    includeMarkedContent: I = !1,
    disableNormalization: g = !1
  } = {}) {
    return this._transport.messageHandler.sendWithStream("GetTextContent", {
      pageIndex: this._pageIndex,
      includeMarkedContent: I === !0,
      disableNormalization: g === !0
    }, {
      highWaterMark: 100,
      size(A) {
        return A.items.length;
      }
    });
  }
  getTextContent(I = {}) {
    if (this._transport._htmlForXfa)
      return this.getXfa().then((C) => vg.textContent(C));
    const g = this.streamTextContent(I);
    return new Promise(function(C, A) {
      function i() {
        l.read().then(function({
          value: d,
          done: c
        }) {
          if (c) {
            C(s);
            return;
          }
          s.lang ??= d.lang, Object.assign(s.styles, d.styles), s.items.push(...d.items), i();
        }, A);
      }
      const l = g.getReader(), s = {
        items: [],
        styles: /* @__PURE__ */ Object.create(null),
        lang: null
      };
      i();
    });
  }
  getStructTree() {
    return this._transport.getStructTree(this._pageIndex);
  }
  _destroy() {
    this.destroyed = !0;
    const I = [];
    for (const g of this._intentStates.values())
      if (this._abortOperatorList({
        intentState: g,
        reason: new Error("Page was destroyed."),
        force: !0
      }), !g.opListReadCapability)
        for (const C of g.renderTasks)
          I.push(C.completed), C.cancel();
    return this.objs.clear(), this.#I = !1, Promise.all(I);
  }
  cleanup(I = !1) {
    this.#I = !0;
    const g = this.#g();
    return I && g && (this._stats &&= new fA()), g;
  }
  #g() {
    if (!this.#I || this.destroyed)
      return !1;
    for (const {
      renderTasks: I,
      operatorList: g
    } of this._intentStates.values())
      if (I.size > 0 || !g.lastChunk)
        return !1;
    return this._intentStates.clear(), this.objs.clear(), this.#I = !1, !0;
  }
  _startRenderPage(I, g) {
    const C = this._intentStates.get(g);
    C && (this._stats?.timeEnd("Page Request"), C.displayReadyCapability?.resolve(I));
  }
  _renderPageChunk(I, g) {
    for (let C = 0, A = I.length; C < A; C++)
      g.operatorList.fnArray.push(I.fnArray[C]), g.operatorList.argsArray.push(I.argsArray[C]);
    g.operatorList.lastChunk = I.lastChunk, g.operatorList.separateAnnots = I.separateAnnots;
    for (const C of g.renderTasks)
      C.operatorListChanged();
    I.lastChunk && this.#g();
  }
  _pumpOperatorList({
    renderingIntent: I,
    cacheKey: g,
    annotationStorageSerializable: C,
    modifiedIds: A
  }) {
    const {
      map: i,
      transfer: l
    } = C, d = this._transport.messageHandler.sendWithStream("GetOperatorList", {
      pageIndex: this._pageIndex,
      intent: I,
      cacheKey: g,
      annotationStorage: i,
      modifiedIds: A
    }, l).getReader(), c = this._intentStates.get(g);
    c.streamReader = d;
    const G = () => {
      d.read().then(({
        value: b,
        done: o
      }) => {
        if (o) {
          c.streamReader = null;
          return;
        }
        this._transport.destroyed || (this._renderPageChunk(b, c), G());
      }, (b) => {
        if (c.streamReader = null, !this._transport.destroyed) {
          if (c.operatorList) {
            c.operatorList.lastChunk = !0;
            for (const o of c.renderTasks)
              o.operatorListChanged();
            this.#g();
          }
          if (c.displayReadyCapability)
            c.displayReadyCapability.reject(b);
          else if (c.opListReadCapability)
            c.opListReadCapability.reject(b);
          else
            throw b;
        }
      });
    };
    G();
  }
  _abortOperatorList({
    intentState: I,
    reason: g,
    force: C = !1
  }) {
    if (I.streamReader) {
      if (I.streamReaderCancelTimeout && (clearTimeout(I.streamReaderCancelTimeout), I.streamReaderCancelTimeout = null), !C) {
        if (I.renderTasks.size > 0)
          return;
        if (g instanceof XA) {
          let A = Xd;
          g.extraDelay > 0 && g.extraDelay < 1e3 && (A += g.extraDelay), I.streamReaderCancelTimeout = setTimeout(() => {
            I.streamReaderCancelTimeout = null, this._abortOperatorList({
              intentState: I,
              reason: g,
              force: !0
            });
          }, A);
          return;
        }
      }
      if (I.streamReader.cancel(new Ig(g.message)).catch(() => {
      }), I.streamReader = null, !this._transport.destroyed) {
        for (const [A, i] of this._intentStates)
          if (i === I) {
            this._intentStates.delete(A);
            break;
          }
        this.cleanup();
      }
    }
  }
  get stats() {
    return this._stats;
  }
}
var qI, HI, jI, sg, P, DC, dg, Zg, tI, nC, yl, Xl, rg, Xg, YC;
let eA = (P = class {
  constructor({
    name: I = null,
    port: g = null,
    verbosity: C = Gs()
  } = {}) {
    yI(this, tI);
    yI(this, qI, Promise.withResolvers());
    yI(this, HI, null);
    yI(this, jI, null);
    yI(this, sg, null);
    if (this.name = I, this.destroyed = !1, this.verbosity = C, g) {
      if (v(P, Zg).has(g))
        throw new Error("Cannot use more than one PDFWorker per port.");
      v(P, Zg).set(g, this), MI(this, tI, yl).call(this, g);
    } else
      MI(this, tI, Xl).call(this);
  }
  get promise() {
    return v(this, qI).promise;
  }
  get port() {
    return v(this, jI);
  }
  get messageHandler() {
    return v(this, HI);
  }
  destroy() {
    this.destroyed = !0, v(this, sg)?.terminate(), hI(this, sg, null), v(P, Zg).delete(v(this, jI)), hI(this, jI, null), v(this, HI)?.destroy(), hI(this, HI, null);
  }
  static create(I) {
    const g = v(this, Zg).get(I?.port);
    if (g) {
      if (g._pendingDestroy)
        throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");
      return g;
    }
    return new P(I);
  }
  static get workerSrc() {
    if (Ng.workerSrc)
      return Ng.workerSrc;
    throw new Error('No "GlobalWorkerOptions.workerSrc" specified.');
  }
  static get _setupFakeWorkerGlobal() {
    return T(this, "_setupFakeWorkerGlobal", (async () => v(this, Xg, YC) ? v(this, Xg, YC) : (await import(
      /*webpackIgnore: true*/
      /*@vite-ignore*/
      this.workerSrc
    )).WorkerMessageHandler)());
  }
}, qI = new WeakMap(), HI = new WeakMap(), jI = new WeakMap(), sg = new WeakMap(), DC = new WeakMap(), dg = new WeakMap(), Zg = new WeakMap(), tI = new WeakSet(), nC = function() {
  v(this, qI).resolve(), v(this, HI).send("configure", {
    verbosity: this.verbosity
  });
}, yl = function(I) {
  hI(this, jI, I), hI(this, HI, new kg("main", "worker", I)), v(this, HI).on("ready", () => {
  }), MI(this, tI, nC).call(this);
}, Xl = function() {
  if (v(P, dg) || v(P, Xg, YC)) {
    MI(this, tI, rg).call(this);
    return;
  }
  let {
    workerSrc: I
  } = P;
  try {
    P._isSameOrigin(window.location, I) || (I = P._createCDNWrapper(new URL(I, window.location).href));
    const g = new Worker(I, {
      type: "module"
    }), C = new kg("main", "worker", g), A = () => {
      i.abort(), C.destroy(), g.terminate(), this.destroyed ? v(this, qI).reject(new Error("Worker was destroyed")) : MI(this, tI, rg).call(this);
    }, i = new AbortController();
    g.addEventListener("error", () => {
      v(this, sg) || A();
    }, {
      signal: i.signal
    }), C.on("test", (s) => {
      if (i.abort(), this.destroyed || !s) {
        A();
        return;
      }
      hI(this, HI, C), hI(this, jI, g), hI(this, sg, g), MI(this, tI, nC).call(this);
    }), C.on("ready", (s) => {
      if (i.abort(), this.destroyed) {
        A();
        return;
      }
      try {
        l();
      } catch {
        MI(this, tI, rg).call(this);
      }
    });
    const l = () => {
      const s = new Uint8Array();
      C.send("test", s, [s.buffer]);
    };
    l();
    return;
  } catch {
    pC("The worker has been disabled.");
  }
  MI(this, tI, rg).call(this);
}, rg = function() {
  v(P, dg) || (L("Setting up fake worker."), hI(P, dg, !0)), P._setupFakeWorkerGlobal.then((I) => {
    if (this.destroyed) {
      v(this, qI).reject(new Error("Worker was destroyed"));
      return;
    }
    const g = new ks();
    hI(this, jI, g);
    const C = `fake${vA(P, DC)._++}`, A = new kg(C + "_worker", C, g);
    I.setup(A, g), hI(this, HI, new kg(C, C + "_worker", g)), MI(this, tI, nC).call(this);
  }).catch((I) => {
    v(this, qI).reject(new Error(`Setting up fake worker failed: "${I.message}".`));
  });
}, Xg = new WeakSet(), YC = function() {
  try {
    return globalThis.pdfjsWorker?.WorkerMessageHandler || null;
  } catch {
    return null;
  }
}, yI(P, Xg), yI(P, DC, 0), yI(P, dg, !1), yI(P, Zg, /* @__PURE__ */ new WeakMap()), aI && (hI(P, dg, !0), Ng.workerSrc ||= "./pdf.worker.mjs"), P._isSameOrigin = (I, g) => {
  const C = URL.parse(I);
  if (!C?.origin || C.origin === "null")
    return !1;
  const A = new URL(g, C);
  return C.origin === A.origin;
}, P._createCDNWrapper = (I) => {
  const g = `await import("${I}");`;
  return URL.createObjectURL(new Blob([g], {
    type: "text/javascript"
  }));
}, P.fromPort = (I) => {
  if (Ys("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."), !I?.port)
    throw new Error("PDFWorker.fromPort - invalid method signature.");
  return P.create(I);
}, P);
class Dd {
  #I = /* @__PURE__ */ new Map();
  #g = /* @__PURE__ */ new Map();
  #A = /* @__PURE__ */ new Map();
  #C = /* @__PURE__ */ new Map();
  #i = null;
  constructor(I, g, C, A, i, l) {
    this.messageHandler = I, this.loadingTask = g, this.commonObjs = new Nl(), this.fontLoader = new Ss({
      ownerDocument: A.ownerDocument,
      styleElement: A.styleElement
    }), this.loadingParams = A.loadingParams, this._params = A, this.canvasFactory = i.canvasFactory, this.filterFactory = i.filterFactory, this.cMapReaderFactory = i.cMapReaderFactory, this.standardFontDataFactory = i.standardFontDataFactory, this.wasmFactory = i.wasmFactory, this.destroyed = !1, this.destroyCapability = null, this._networkStream = C, this._fullReader = null, this._lastProgress = null, this.downloadInfoCapability = Promise.withResolvers(), this.enableHWA = l, this.setupMessageHandler();
  }
  #l(I, g = null) {
    const C = this.#I.get(I);
    if (C)
      return C;
    const A = this.messageHandler.sendWithPromise(I, g);
    return this.#I.set(I, A), A;
  }
  get annotationStorage() {
    return T(this, "annotationStorage", new KA());
  }
  getRenderingIntent(I, g = _I.ENABLE, C = null, A = !1, i = !1) {
    let l = nI.DISPLAY, s = bA;
    switch (I) {
      case "any":
        l = nI.ANY;
        break;
      case "display":
        break;
      case "print":
        l = nI.PRINT;
        break;
      default:
        L(`getRenderingIntent - invalid intent: ${I}`);
    }
    const d = l & nI.PRINT && C instanceof ol ? C : this.annotationStorage;
    switch (g) {
      case _I.DISABLE:
        l += nI.ANNOTATIONS_DISABLE;
        break;
      case _I.ENABLE:
        break;
      case _I.ENABLE_FORMS:
        l += nI.ANNOTATIONS_FORMS;
        break;
      case _I.ENABLE_STORAGE:
        l += nI.ANNOTATIONS_STORAGE, s = d.serializable;
        break;
      default:
        L(`getRenderingIntent - invalid annotationMode: ${g}`);
    }
    A && (l += nI.IS_EDITING), i && (l += nI.OPLIST);
    const {
      ids: c,
      hash: G
    } = d.modifiedIds, b = [l, s.hash, G];
    return {
      renderingIntent: l,
      cacheKey: b.join("_"),
      annotationStorageSerializable: s,
      modifiedIds: c
    };
  }
  destroy() {
    if (this.destroyCapability)
      return this.destroyCapability.promise;
    this.destroyed = !0, this.destroyCapability = Promise.withResolvers(), this.#i?.reject(new Error("Worker was destroyed during onPassword callback"));
    const I = [];
    for (const C of this.#g.values())
      I.push(C._destroy());
    this.#g.clear(), this.#A.clear(), this.#C.clear(), this.hasOwnProperty("annotationStorage") && this.annotationStorage.resetModified();
    const g = this.messageHandler.sendWithPromise("Terminate", null);
    return I.push(g), Promise.all(I).then(() => {
      this.commonObjs.clear(), this.fontLoader.clear(), this.#I.clear(), this.filterFactory.destroy(), yC.cleanup(), this._networkStream?.cancelAllRequests(new Ig("Worker was terminated.")), this.messageHandler?.destroy(), this.messageHandler = null, this.destroyCapability.resolve();
    }, this.destroyCapability.reject), this.destroyCapability.promise;
  }
  setupMessageHandler() {
    const {
      messageHandler: I,
      loadingTask: g
    } = this;
    I.on("GetReader", (C, A) => {
      Q(this._networkStream, "GetReader - no `IPDFStream` instance available."), this._fullReader = this._networkStream.getFullReader(), this._fullReader.onProgress = (i) => {
        this._lastProgress = {
          loaded: i.loaded,
          total: i.total
        };
      }, A.onPull = () => {
        this._fullReader.read().then(function({
          value: i,
          done: l
        }) {
          if (l) {
            A.close();
            return;
          }
          Q(i instanceof ArrayBuffer, "GetReader - expected an ArrayBuffer."), A.enqueue(new Uint8Array(i), 1, [i]);
        }).catch((i) => {
          A.error(i);
        });
      }, A.onCancel = (i) => {
        this._fullReader.cancel(i), A.ready.catch((l) => {
          if (!this.destroyed)
            throw l;
        });
      };
    }), I.on("ReaderHeadersReady", async (C) => {
      await this._fullReader.headersReady;
      const {
        isStreamingSupported: A,
        isRangeSupported: i,
        contentLength: l
      } = this._fullReader;
      return (!A || !i) && (this._lastProgress && g.onProgress?.(this._lastProgress), this._fullReader.onProgress = (s) => {
        g.onProgress?.({
          loaded: s.loaded,
          total: s.total
        });
      }), {
        isStreamingSupported: A,
        isRangeSupported: i,
        contentLength: l
      };
    }), I.on("GetRangeReader", (C, A) => {
      Q(this._networkStream, "GetRangeReader - no `IPDFStream` instance available.");
      const i = this._networkStream.getRangeReader(C.begin, C.end);
      if (!i) {
        A.close();
        return;
      }
      A.onPull = () => {
        i.read().then(function({
          value: l,
          done: s
        }) {
          if (s) {
            A.close();
            return;
          }
          Q(l instanceof ArrayBuffer, "GetRangeReader - expected an ArrayBuffer."), A.enqueue(new Uint8Array(l), 1, [l]);
        }).catch((l) => {
          A.error(l);
        });
      }, A.onCancel = (l) => {
        i.cancel(l), A.ready.catch((s) => {
          if (!this.destroyed)
            throw s;
        });
      };
    }), I.on("GetDoc", ({
      pdfInfo: C
    }) => {
      this._numPages = C.numPages, this._htmlForXfa = C.htmlForXfa, delete C.htmlForXfa, g._capability.resolve(new Hd(C, this));
    }), I.on("DocException", (C) => {
      g._capability.reject(BI(C));
    }), I.on("PasswordRequest", (C) => {
      this.#i = Promise.withResolvers();
      try {
        if (!g.onPassword)
          throw BI(C);
        const A = (i) => {
          i instanceof Error ? this.#i.reject(i) : this.#i.resolve({
            password: i
          });
        };
        g.onPassword(A, C.code);
      } catch (A) {
        this.#i.reject(A);
      }
      return this.#i.promise;
    }), I.on("DataLoaded", (C) => {
      g.onProgress?.({
        loaded: C.length,
        total: C.length
      }), this.downloadInfoCapability.resolve(C);
    }), I.on("StartRenderPage", (C) => {
      if (this.destroyed)
        return;
      this.#g.get(C.pageIndex)._startRenderPage(C.transparency, C.cacheKey);
    }), I.on("commonobj", ([C, A, i]) => {
      if (this.destroyed || this.commonObjs.has(C))
        return null;
      switch (A) {
        case "Font":
          if ("error" in i) {
            const G = i.error;
            L(`Error during font loading: ${G}`), this.commonObjs.resolve(C, G);
            break;
          }
          const l = new E(i), s = this._params.pdfBug && globalThis.FontInspector?.enabled ? (G, b) => globalThis.FontInspector.fontAdded(G, b) : null, d = new ps(l, s, i.extra, i.charProcOperatorList);
          this.fontLoader.bind(d).catch(() => I.sendWithPromise("FontFallback", {
            id: C
          })).finally(() => {
            !d.fontExtraProperties && d.data && d.clearData(), this.commonObjs.resolve(C, d);
          });
          break;
        case "CopyLocalImage":
          const {
            imageRef: c
          } = i;
          Q(c, "The imageRef must be defined.");
          for (const G of this.#g.values())
            for (const [, b] of G.objs)
              if (b?.ref === c)
                return b.dataLen ? (this.commonObjs.resolve(C, structuredClone(b)), b.dataLen) : null;
          break;
        case "FontPath":
        case "Image":
        case "Pattern":
          this.commonObjs.resolve(C, i);
          break;
        default:
          throw new Error(`Got unknown common object type ${A}`);
      }
      return null;
    }), I.on("obj", ([C, A, i, l]) => {
      if (this.destroyed)
        return;
      const s = this.#g.get(A);
      if (!s.objs.has(C)) {
        if (s._intentStates.size === 0) {
          l?.bitmap?.close();
          return;
        }
        switch (i) {
          case "Image":
          case "Pattern":
            s.objs.resolve(C, l);
            break;
          default:
            throw new Error(`Got unknown object type ${i}`);
        }
      }
    }), I.on("DocProgress", (C) => {
      this.destroyed || g.onProgress?.({
        loaded: C.loaded,
        total: C.total
      });
    }), I.on("FetchBinaryData", async (C) => {
      if (this.destroyed)
        throw new Error("Worker was destroyed.");
      const A = this[C.type];
      if (!A)
        throw new Error(`${C.type} not initialized, see the \`useWorkerFetch\` parameter.`);
      return A.fetch(C);
    });
  }
  getData() {
    return this.messageHandler.sendWithPromise("GetData", null);
  }
  saveDocument() {
    this.annotationStorage.size <= 0 && L("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");
    const {
      map: I,
      transfer: g
    } = this.annotationStorage.serializable;
    return this.messageHandler.sendWithPromise("SaveDocument", {
      isPureXfa: !!this._htmlForXfa,
      numPages: this._numPages,
      annotationStorage: I,
      filename: this._fullReader?.filename ?? null
    }, g).finally(() => {
      this.annotationStorage.resetModified();
    });
  }
  getPage(I) {
    if (!Number.isInteger(I) || I <= 0 || I > this._numPages)
      return Promise.reject(new Error("Invalid page request."));
    const g = I - 1, C = this.#A.get(g);
    if (C)
      return C;
    const A = this.messageHandler.sendWithPromise("GetPage", {
      pageIndex: g
    }).then((i) => {
      if (this.destroyed)
        throw new Error("Transport destroyed");
      i.refStr && this.#C.set(i.refStr, I);
      const l = new Md(g, i, this, this._params.pdfBug);
      return this.#g.set(g, l), l;
    });
    return this.#A.set(g, A), A;
  }
  getPageIndex(I) {
    return oA(I) ? this.messageHandler.sendWithPromise("GetPageIndex", {
      num: I.num,
      gen: I.gen
    }) : Promise.reject(new Error("Invalid pageIndex request."));
  }
  getAnnotations(I, g) {
    return this.messageHandler.sendWithPromise("GetAnnotations", {
      pageIndex: I,
      intent: g
    });
  }
  getFieldObjects() {
    return this.#l("GetFieldObjects");
  }
  hasJSActions() {
    return this.#l("HasJSActions");
  }
  getCalculationOrderIds() {
    return this.messageHandler.sendWithPromise("GetCalculationOrderIds", null);
  }
  getDestinations() {
    return this.messageHandler.sendWithPromise("GetDestinations", null);
  }
  getDestination(I) {
    return typeof I != "string" ? Promise.reject(new Error("Invalid destination request.")) : this.messageHandler.sendWithPromise("GetDestination", {
      id: I
    });
  }
  getPageLabels() {
    return this.messageHandler.sendWithPromise("GetPageLabels", null);
  }
  getPageLayout() {
    return this.messageHandler.sendWithPromise("GetPageLayout", null);
  }
  getPageMode() {
    return this.messageHandler.sendWithPromise("GetPageMode", null);
  }
  getViewerPreferences() {
    return this.messageHandler.sendWithPromise("GetViewerPreferences", null);
  }
  getOpenAction() {
    return this.messageHandler.sendWithPromise("GetOpenAction", null);
  }
  getAttachments() {
    return this.messageHandler.sendWithPromise("GetAttachments", null);
  }
  getAnnotationsByType(I, g) {
    return this.messageHandler.sendWithPromise("GetAnnotationsByType", {
      types: I,
      pageIndexesToSkip: g
    });
  }
  getDocJSActions() {
    return this.#l("GetDocJSActions");
  }
  getPageJSActions(I) {
    return this.messageHandler.sendWithPromise("GetPageJSActions", {
      pageIndex: I
    });
  }
  getStructTree(I) {
    return this.messageHandler.sendWithPromise("GetStructTree", {
      pageIndex: I
    });
  }
  getOutline() {
    return this.messageHandler.sendWithPromise("GetOutline", null);
  }
  getOptionalContentConfig(I) {
    return this.#l("GetOptionalContentConfig").then((g) => new cd(g, I));
  }
  getPermissions() {
    return this.messageHandler.sendWithPromise("GetPermissions", null);
  }
  getMetadata() {
    const I = "GetMetadata", g = this.#I.get(I);
    if (g)
      return g;
    const C = this.messageHandler.sendWithPromise(I, null).then((A) => ({
      info: A[0],
      metadata: A[1] ? new dd(A[1]) : null,
      contentDispositionFilename: this._fullReader?.filename ?? null,
      contentLength: this._fullReader?.contentLength ?? null
    }));
    return this.#I.set(I, C), C;
  }
  getMarkInfo() {
    return this.messageHandler.sendWithPromise("GetMarkInfo", null);
  }
  async startCleanup(I = !1) {
    if (!this.destroyed) {
      await this.messageHandler.sendWithPromise("Cleanup", null);
      for (const g of this.#g.values())
        if (!g.cleanup())
          throw new Error(`startCleanup: Page ${g.pageNumber} is currently rendering.`);
      this.commonObjs.clear(), I || this.fontLoader.clear(), this.#I.clear(), this.filterFactory.destroy(!0), yC.cleanup();
    }
  }
  cachedPageNumber(I) {
    if (!oA(I))
      return null;
    const g = I.gen === 0 ? `${I.num}R` : `${I.num}R${I.gen}`;
    return this.#C.get(g) ?? null;
  }
}
class Kd {
  #I = null;
  onContinue = null;
  onError = null;
  constructor(I) {
    this.#I = I;
  }
  get promise() {
    return this.#I.capability.promise;
  }
  cancel(I = 0) {
    this.#I.cancel(null, I);
  }
  get separateAnnots() {
    const {
      separateAnnots: I
    } = this.#I.operatorList;
    if (!I)
      return !1;
    const {
      annotationCanvasMap: g
    } = this.#I;
    return I.form || I.canvas && g?.size > 0;
  }
}
class wg {
  #I = null;
  static #g = /* @__PURE__ */ new WeakSet();
  constructor({
    callback: I,
    params: g,
    objs: C,
    commonObjs: A,
    annotationCanvasMap: i,
    operatorList: l,
    pageIndex: s,
    canvasFactory: d,
    filterFactory: c,
    useRequestAnimationFrame: G = !1,
    pdfBug: b = !1,
    pageColors: o = null,
    enableHWA: m = !1,
    operationsFilter: e = null
  }) {
    this.callback = I, this.params = g, this.objs = C, this.commonObjs = A, this.annotationCanvasMap = i, this.operatorListIdx = null, this.operatorList = l, this._pageIndex = s, this.canvasFactory = d, this.filterFactory = c, this._pdfBug = b, this.pageColors = o, this.running = !1, this.graphicsReadyCallback = null, this.graphicsReady = !1, this._useRequestAnimationFrame = G === !0 && typeof window < "u", this.cancelled = !1, this.capability = Promise.withResolvers(), this.task = new Kd(this), this._cancelBound = this.cancel.bind(this), this._continueBound = this._continue.bind(this), this._scheduleNextBound = this._scheduleNext.bind(this), this._nextBound = this._next.bind(this), this._canvas = g.canvas, this._canvasContext = g.canvas ? null : g.canvasContext, this._enableHWA = m, this._dependencyTracker = g.dependencyTracker, this._operationsFilter = e;
  }
  get completed() {
    return this.capability.promise.catch(function() {
    });
  }
  initializeGraphics({
    transparency: I = !1,
    optionalContentConfig: g
  }) {
    if (this.cancelled)
      return;
    if (this._canvas) {
      if (wg.#g.has(this._canvas))
        throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");
      wg.#g.add(this._canvas);
    }
    this._pdfBug && globalThis.StepperManager?.enabled && (this.stepper = globalThis.StepperManager.create(this._pageIndex), this.stepper.init(this.operatorList), this.stepper.nextBreakPoint = this.stepper.getNextBreakPoint());
    const {
      viewport: C,
      transform: A,
      background: i,
      dependencyTracker: l
    } = this.params, s = this._canvasContext || this._canvas.getContext("2d", {
      alpha: !1,
      willReadFrequently: !this._enableHWA
    });
    this.gfx = new ng(s, this.commonObjs, this.objs, this.canvasFactory, this.filterFactory, {
      optionalContentConfig: g
    }, this.annotationCanvasMap, this.pageColors, l), this.gfx.beginDrawing({
      transform: A,
      viewport: C,
      transparency: I,
      background: i
    }), this.operatorListIdx = 0, this.graphicsReady = !0, this.graphicsReadyCallback?.();
  }
  cancel(I = null, g = 0) {
    this.running = !1, this.cancelled = !0, this.gfx?.endDrawing(), this.#I && (window.cancelAnimationFrame(this.#I), this.#I = null), wg.#g.delete(this._canvas), I ||= new XA(`Rendering cancelled, page ${this._pageIndex + 1}`, g), this.callback(I), this.task.onError?.(I);
  }
  operatorListChanged() {
    if (!this.graphicsReady) {
      this.graphicsReadyCallback ||= this._continueBound;
      return;
    }
    this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length), this.stepper?.updateOperatorList(this.operatorList), !this.running && this._continue();
  }
  _continue() {
    this.running = !0, !this.cancelled && (this.task.onContinue ? this.task.onContinue(this._scheduleNextBound) : this._scheduleNext());
  }
  _scheduleNext() {
    this._useRequestAnimationFrame ? this.#I = window.requestAnimationFrame(() => {
      this.#I = null, this._nextBound().catch(this._cancelBound);
    }) : Promise.resolve().then(this._nextBound).catch(this._cancelBound);
  }
  async _next() {
    this.cancelled || (this.operatorListIdx = this.gfx.executeOperatorList(this.operatorList, this.operatorListIdx, this._continueBound, this.stepper, this._operationsFilter), this.operatorListIdx === this.operatorList.argsArray.length && (this.running = !1, this.operatorList.lastChunk && (this.gfx.endDrawing(), wg.#g.delete(this._canvas), this.callback())));
  }
}
const Sd = "5.4.296", pd = "f56dc8601";
let Hl = class SI {
  #I = null;
  #g = null;
  #A;
  #C = null;
  #i = !1;
  #l = !1;
  #s = null;
  #d;
  #c = null;
  #Z = null;
  static #o = null;
  static get _keyboardManager() {
    return T(this, "_keyboardManager", new CC([[["Escape", "mac+Escape"], SI.prototype._hideDropdownFromKeyboard], [[" ", "mac+ "], SI.prototype._colorSelectFromKeyboard], [["ArrowDown", "ArrowRight", "mac+ArrowDown", "mac+ArrowRight"], SI.prototype._moveToNext], [["ArrowUp", "ArrowLeft", "mac+ArrowUp", "mac+ArrowLeft"], SI.prototype._moveToPrevious], [["Home", "mac+Home"], SI.prototype._moveToBeginning], [["End", "mac+End"], SI.prototype._moveToEnd]]));
  }
  constructor({
    editor: I = null,
    uiManager: g = null
  }) {
    I ? (this.#l = !1, this.#s = I) : this.#l = !0, this.#Z = I?._uiManager || g, this.#d = this.#Z._eventBus, this.#A = I?.color?.toUpperCase() || this.#Z?.highlightColors.values().next().value || "#FFFF98", SI.#o ||= Object.freeze({
      blue: "pdfjs-editor-colorpicker-blue",
      green: "pdfjs-editor-colorpicker-green",
      pink: "pdfjs-editor-colorpicker-pink",
      red: "pdfjs-editor-colorpicker-red",
      yellow: "pdfjs-editor-colorpicker-yellow"
    });
  }
  renderButton() {
    const I = this.#I = document.createElement("button");
    I.className = "colorPicker", I.tabIndex = "0", I.setAttribute("data-l10n-id", "pdfjs-editor-colorpicker-button"), I.ariaHasPopup = "true", this.#s && (I.ariaControls = `${this.#s.id}_colorpicker_dropdown`);
    const g = this.#Z._signal;
    I.addEventListener("click", this.#a.bind(this), {
      signal: g
    }), I.addEventListener("keydown", this.#t.bind(this), {
      signal: g
    });
    const C = this.#g = document.createElement("span");
    return C.className = "swatch", C.ariaHidden = "true", C.style.backgroundColor = this.#A, I.append(C), I;
  }
  renderMainDropdown() {
    const I = this.#C = this.#b();
    return I.ariaOrientation = "horizontal", I.ariaLabelledBy = "highlightColorPickerLabel", I;
  }
  #b() {
    const I = document.createElement("div"), g = this.#Z._signal;
    I.addEventListener("contextmenu", RI, {
      signal: g
    }), I.className = "dropdown", I.role = "listbox", I.ariaMultiSelectable = "false", I.ariaOrientation = "vertical", I.setAttribute("data-l10n-id", "pdfjs-editor-colorpicker-dropdown"), this.#s && (I.id = `${this.#s.id}_colorpicker_dropdown`);
    for (const [C, A] of this.#Z.highlightColors) {
      const i = document.createElement("button");
      i.tabIndex = "0", i.role = "option", i.setAttribute("data-color", A), i.title = C, i.setAttribute("data-l10n-id", SI.#o[C]);
      const l = document.createElement("span");
      i.append(l), l.className = "swatch", l.style.backgroundColor = A, i.ariaSelected = A === this.#A, i.addEventListener("click", this.#m.bind(this, A), {
        signal: g
      }), I.append(i);
    }
    return I.addEventListener("keydown", this.#t.bind(this), {
      signal: g
    }), I;
  }
  #m(I, g) {
    g.stopPropagation(), this.#d.dispatch("switchannotationeditorparams", {
      source: this,
      type: j.HIGHLIGHT_COLOR,
      value: I
    }), this.updateColor(I);
  }
  _colorSelectFromKeyboard(I) {
    if (I.target === this.#I) {
      this.#a(I);
      return;
    }
    const g = I.target.getAttribute("data-color");
    g && this.#m(g, I);
  }
  _moveToNext(I) {
    if (!this.#e) {
      this.#a(I);
      return;
    }
    if (I.target === this.#I) {
      this.#C.firstChild?.focus();
      return;
    }
    I.target.nextSibling?.focus();
  }
  _moveToPrevious(I) {
    if (I.target === this.#C?.firstChild || I.target === this.#I) {
      this.#e && this._hideDropdownFromKeyboard();
      return;
    }
    this.#e || this.#a(I), I.target.previousSibling?.focus();
  }
  _moveToBeginning(I) {
    if (!this.#e) {
      this.#a(I);
      return;
    }
    this.#C.firstChild?.focus();
  }
  _moveToEnd(I) {
    if (!this.#e) {
      this.#a(I);
      return;
    }
    this.#C.lastChild?.focus();
  }
  #t(I) {
    SI._keyboardManager.exec(this, I);
  }
  #a(I) {
    if (this.#e) {
      this.hideDropdown();
      return;
    }
    if (this.#i = I.detail === 0, this.#c || (this.#c = new AbortController(), window.addEventListener("pointerdown", this.#G.bind(this), {
      signal: this.#Z.combinedSignal(this.#c)
    })), this.#I.ariaExpanded = "true", this.#C) {
      this.#C.classList.remove("hidden");
      return;
    }
    const g = this.#C = this.#b();
    this.#I.append(g);
  }
  #G(I) {
    this.#C?.contains(I.target) || this.hideDropdown();
  }
  hideDropdown() {
    this.#C?.classList.add("hidden"), this.#I.ariaExpanded = "false", this.#c?.abort(), this.#c = null;
  }
  get #e() {
    return this.#C && !this.#C.classList.contains("hidden");
  }
  _hideDropdownFromKeyboard() {
    if (!this.#l) {
      if (!this.#e) {
        this.#s?.unselect();
        return;
      }
      this.hideDropdown(), this.#I.focus({
        preventScroll: !0,
        focusVisible: this.#i
      });
    }
  }
  updateColor(I) {
    if (this.#g && (this.#g.style.backgroundColor = I), !this.#C)
      return;
    const g = this.#Z.highlightColors.values();
    for (const C of this.#C.children)
      C.ariaSelected = g.next().value === I.toUpperCase();
  }
  destroy() {
    this.#I?.remove(), this.#I = null, this.#g = null, this.#C?.remove(), this.#C = null;
  }
};
class Pg {
  #I = null;
  #g = null;
  #A = null;
  static #C = null;
  constructor(I) {
    this.#g = I, this.#A = I._uiManager, Pg.#C ||= Object.freeze({
      freetext: "pdfjs-editor-color-picker-free-text-input",
      ink: "pdfjs-editor-color-picker-ink-input"
    });
  }
  renderButton() {
    if (this.#I)
      return this.#I;
    const {
      editorType: I,
      colorType: g,
      colorValue: C
    } = this.#g, A = this.#I = document.createElement("input");
    return A.type = "color", A.value = C || "#000000", A.className = "basicColorPicker", A.tabIndex = 0, A.setAttribute("data-l10n-id", Pg.#C[I]), A.addEventListener("input", () => {
      this.#A.updateParams(g, A.value);
    }, {
      signal: this.#A._signal
    }), A;
  }
  update(I) {
    this.#I && (this.#I.value = I);
  }
  destroy() {
    this.#I?.remove(), this.#I = null;
  }
  hideDropdown() {
  }
}
function Bi(Z) {
  return Math.floor(Math.max(0, Math.min(1, Z)) * 255).toString(16).padStart(2, "0");
}
function Fg(Z) {
  return Math.max(0, Math.min(255, 255 * Z));
}
class Wi {
  static CMYK_G([I, g, C, A]) {
    return ["G", 1 - Math.min(1, 0.3 * I + 0.59 * C + 0.11 * g + A)];
  }
  static G_CMYK([I]) {
    return ["CMYK", 0, 0, 0, 1 - I];
  }
  static G_RGB([I]) {
    return ["RGB", I, I, I];
  }
  static G_rgb([I]) {
    return I = Fg(I), [I, I, I];
  }
  static G_HTML([I]) {
    const g = Bi(I);
    return `#${g}${g}${g}`;
  }
  static RGB_G([I, g, C]) {
    return ["G", 0.3 * I + 0.59 * g + 0.11 * C];
  }
  static RGB_rgb(I) {
    return I.map(Fg);
  }
  static RGB_HTML(I) {
    return `#${I.map(Bi).join("")}`;
  }
  static T_HTML() {
    return "#00000000";
  }
  static T_rgb() {
    return [null];
  }
  static CMYK_RGB([I, g, C, A]) {
    return ["RGB", 1 - Math.min(1, I + A), 1 - Math.min(1, C + A), 1 - Math.min(1, g + A)];
  }
  static CMYK_rgb([I, g, C, A]) {
    return [Fg(1 - Math.min(1, I + A)), Fg(1 - Math.min(1, C + A)), Fg(1 - Math.min(1, g + A))];
  }
  static CMYK_HTML(I) {
    const g = this.CMYK_RGB(I).slice(1);
    return this.RGB_HTML(g);
  }
  static RGB_CMYK([I, g, C]) {
    const A = 1 - I, i = 1 - g, l = 1 - C, s = Math.min(A, i, l);
    return ["CMYK", A, i, l, s];
  }
}
class Fd {
  create(I, g, C = !1) {
    if (I <= 0 || g <= 0)
      throw new Error("Invalid SVG dimensions");
    const A = this._createSVG("svg:svg");
    return A.setAttribute("version", "1.1"), C || (A.setAttribute("width", `${I}px`), A.setAttribute("height", `${g}px`)), A.setAttribute("preserveAspectRatio", "none"), A.setAttribute("viewBox", `0 0 ${I} ${g}`), A;
  }
  createElement(I) {
    if (typeof I != "string")
      throw new Error("Invalid SVG element type");
    return this._createSVG(I);
  }
  _createSVG(I) {
    f("Abstract method `_createSVG` called.");
  }
}
let XC = class extends Fd {
  _createSVG(I) {
    return document.createElementNS(rI, I);
  }
};
const zd = 9, bg = /* @__PURE__ */ new WeakSet(), Jd = (/* @__PURE__ */ new Date()).getTimezoneOffset() * 60 * 1e3;
class wi {
  static create(I) {
    switch (I.data.annotationType) {
      case iI.LINK:
        return new JA(I);
      case iI.TEXT:
        return new kd(I);
      case iI.WIDGET:
        switch (I.data.fieldType) {
          case "Tx":
            return new rd(I);
          case "Btn":
            return I.data.radioButton ? new Ml(I) : I.data.checkBox ? new jd(I) : new Qd(I);
          case "Ch":
            return new xd(I);
          case "Sig":
            return new Td(I);
        }
        return new mg(I);
      case iI.POPUP:
        return new tA(I);
      case iI.FREETEXT:
        return new Dl(I);
      case iI.LINE:
        return new Ud(I);
      case iI.SQUARE:
        return new vd(I);
      case iI.CIRCLE:
        return new Ed(I);
      case iI.POLYLINE:
        return new Kl(I);
      case iI.CARET:
        return new fd(I);
      case iI.INK:
        return new LA(I);
      case iI.POLYGON:
        return new Pd(I);
      case iI.HIGHLIGHT:
        return new Sl(I);
      case iI.UNDERLINE:
        return new _d(I);
      case iI.SQUIGGLY:
        return new qd(I);
      case iI.STRIKEOUT:
        return new $d(I);
      case iI.STAMP:
        return new pl(I);
      case iI.FILEATTACHMENT:
        return new IZ(I);
      default:
        return new $(I);
    }
  }
}
class $ {
  #I = null;
  #g = !1;
  #A = null;
  constructor(I, {
    isRenderable: g = !1,
    ignoreBorder: C = !1,
    createQuadrilaterals: A = !1
  } = {}) {
    this.isRenderable = g, this.data = I.data, this.layer = I.layer, this.linkService = I.linkService, this.downloadManager = I.downloadManager, this.imageResourcesPath = I.imageResourcesPath, this.renderForms = I.renderForms, this.svgFactory = I.svgFactory, this.annotationStorage = I.annotationStorage, this.enableComment = I.enableComment, this.enableScripting = I.enableScripting, this.hasJSActions = I.hasJSActions, this._fieldObjects = I.fieldObjects, this.parent = I.parent, g && (this.container = this._createContainer(C)), A && this._createQuadrilaterals();
  }
  static _hasPopupData({
    contentsObj: I,
    richText: g
  }) {
    return !!(I?.str || g?.str);
  }
  get _isEditable() {
    return this.data.isEditable;
  }
  get hasPopupData() {
    return $._hasPopupData(this.data) || this.enableComment && !!this.commentText;
  }
  get commentData() {
    const {
      data: I
    } = this, g = this.annotationStorage?.getEditor(I.id);
    return g ? g.getData() : I;
  }
  get hasCommentButton() {
    return this.enableComment && this.hasPopupElement;
  }
  get commentButtonPosition() {
    const I = this.annotationStorage?.getEditor(this.data.id);
    if (I)
      return I.commentButtonPositionInPage;
    const {
      quadPoints: g,
      inkLists: C,
      rect: A
    } = this.data;
    let i = -1 / 0, l = -1 / 0;
    if (g?.length >= 8) {
      for (let s = 0; s < g.length; s += 8)
        g[s + 1] > l ? (l = g[s + 1], i = g[s + 2]) : g[s + 1] === l && (i = Math.max(i, g[s + 2]));
      return [i, l];
    }
    if (C?.length >= 1) {
      for (const s of C)
        for (let d = 0, c = s.length; d < c; d += 2)
          s[d + 1] > l ? (l = s[d + 1], i = s[d]) : s[d + 1] === l && (i = Math.max(i, s[d]));
      if (i !== 1 / 0)
        return [i, l];
    }
    return A ? [A[2], A[3]] : null;
  }
  _normalizePoint(I) {
    const {
      page: {
        view: g
      },
      viewport: {
        rawDims: {
          pageWidth: C,
          pageHeight: A,
          pageX: i,
          pageY: l
        }
      }
    } = this.parent;
    return I[1] = g[3] - I[1] + g[1], I[0] = 100 * (I[0] - i) / C, I[1] = 100 * (I[1] - l) / A, I;
  }
  get commentText() {
    const {
      data: I
    } = this;
    return this.annotationStorage.getRawValue(`${Og}${I.id}`)?.popup?.contents || I.contentsObj?.str || "";
  }
  set commentText(I) {
    const {
      data: g
    } = this, C = {
      deleted: !I,
      contents: I || ""
    };
    this.annotationStorage.updateEditor(g.id, {
      popup: C
    }) || this.annotationStorage.setValue(`${Og}${g.id}`, {
      id: g.id,
      annotationType: g.annotationType,
      pageIndex: this.parent.page._pageIndex,
      popup: C,
      popupRef: g.popupRef,
      modificationDate: /* @__PURE__ */ new Date()
    }), I || this.removePopup();
  }
  removePopup() {
    (this.#A?.popup || this.popup)?.remove(), this.#A = this.popup = null;
  }
  updateEdited(I) {
    if (!this.container)
      return;
    I.rect && (this.#I ||= {
      rect: this.data.rect.slice(0)
    });
    const {
      rect: g,
      popup: C
    } = I;
    g && this.#C(g);
    let A = this.#A?.popup || this.popup;
    !A && C?.text && (this._createPopup(C), A = this.#A.popup), A && (A.updateEdited(I), C?.deleted && (A.remove(), this.#A = null, this.popup = null));
  }
  resetEdited() {
    this.#I && (this.#C(this.#I.rect), this.#A?.popup.resetEdited(), this.#I = null);
  }
  #C(I) {
    const {
      container: {
        style: g
      },
      data: {
        rect: C,
        rotation: A
      },
      parent: {
        viewport: {
          rawDims: {
            pageWidth: i,
            pageHeight: l,
            pageX: s,
            pageY: d
          }
        }
      }
    } = this;
    C?.splice(0, 4, ...I), g.left = `${100 * (I[0] - s) / i}%`, g.top = `${100 * (l - I[3] + d) / l}%`, A === 0 ? (g.width = `${100 * (I[2] - I[0]) / i}%`, g.height = `${100 * (I[3] - I[1]) / l}%`) : this.setRotation(A);
  }
  _createContainer(I) {
    const {
      data: g,
      parent: {
        page: C,
        viewport: A
      }
    } = this, i = document.createElement("section");
    i.setAttribute("data-annotation-id", g.id), !(this instanceof mg) && !(this instanceof JA) && (i.tabIndex = 0);
    const {
      style: l
    } = i;
    if (l.zIndex = this.parent.zIndex, this.parent.zIndex += 2, g.alternativeText && (i.title = g.alternativeText), g.noRotate && i.classList.add("norotate"), !g.rect || this instanceof tA) {
      const {
        rotation: a
      } = g;
      return !g.hasOwnCanvas && a !== 0 && this.setRotation(a, i), i;
    }
    const {
      width: s,
      height: d
    } = this;
    if (!I && g.borderStyle.width > 0) {
      l.borderWidth = `${g.borderStyle.width}px`;
      const a = g.borderStyle.horizontalCornerRadius, h = g.borderStyle.verticalCornerRadius;
      if (a > 0 || h > 0) {
        const W = `calc(${a}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;
        l.borderRadius = W;
      } else if (this instanceof Ml) {
        const W = `calc(${s}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;
        l.borderRadius = W;
      }
      switch (g.borderStyle.style) {
        case tg.SOLID:
          l.borderStyle = "solid";
          break;
        case tg.DASHED:
          l.borderStyle = "dashed";
          break;
        case tg.BEVELED:
          L("Unimplemented border style: beveled");
          break;
        case tg.INSET:
          L("Unimplemented border style: inset");
          break;
        case tg.UNDERLINE:
          l.borderBottomStyle = "solid";
          break;
      }
      const t = g.borderColor || null;
      t ? (this.#g = !0, l.borderColor = M.makeHexColor(t[0] | 0, t[1] | 0, t[2] | 0)) : l.borderWidth = 0;
    }
    const c = M.normalizeRect([g.rect[0], C.view[3] - g.rect[1] + C.view[1], g.rect[2], C.view[3] - g.rect[3] + C.view[1]]), {
      pageWidth: G,
      pageHeight: b,
      pageX: o,
      pageY: m
    } = A.rawDims;
    l.left = `${100 * (c[0] - o) / G}%`, l.top = `${100 * (c[1] - m) / b}%`;
    const {
      rotation: e
    } = g;
    return g.hasOwnCanvas || e === 0 ? (l.width = `${100 * s / G}%`, l.height = `${100 * d / b}%`) : this.setRotation(e, i), i;
  }
  setRotation(I, g = this.container) {
    if (!this.data.rect)
      return;
    const {
      pageWidth: C,
      pageHeight: A
    } = this.parent.viewport.rawDims;
    let {
      width: i,
      height: l
    } = this;
    I % 180 !== 0 && ([i, l] = [l, i]), g.style.width = `${100 * i / C}%`, g.style.height = `${100 * l / A}%`, g.setAttribute("data-main-rotation", (360 - I) % 360);
  }
  get _commonActions() {
    const I = (g, C, A) => {
      const i = A.detail[g], l = i[0], s = i.slice(1);
      A.target.style[C] = Wi[`${l}_HTML`](s), this.annotationStorage.setValue(this.data.id, {
        [C]: Wi[`${l}_rgb`](s)
      });
    };
    return T(this, "_commonActions", {
      display: (g) => {
        const {
          display: C
        } = g.detail, A = C % 2 === 1;
        this.container.style.visibility = A ? "hidden" : "visible", this.annotationStorage.setValue(this.data.id, {
          noView: A,
          noPrint: C === 1 || C === 2
        });
      },
      print: (g) => {
        this.annotationStorage.setValue(this.data.id, {
          noPrint: !g.detail.print
        });
      },
      hidden: (g) => {
        const {
          hidden: C
        } = g.detail;
        this.container.style.visibility = C ? "hidden" : "visible", this.annotationStorage.setValue(this.data.id, {
          noPrint: C,
          noView: C
        });
      },
      focus: (g) => {
        setTimeout(() => g.target.focus({
          preventScroll: !1
        }), 0);
      },
      userName: (g) => {
        g.target.title = g.detail.userName;
      },
      readonly: (g) => {
        g.target.disabled = g.detail.readonly;
      },
      required: (g) => {
        this._setRequired(g.target, g.detail.required);
      },
      bgColor: (g) => {
        I("bgColor", "backgroundColor", g);
      },
      fillColor: (g) => {
        I("fillColor", "backgroundColor", g);
      },
      fgColor: (g) => {
        I("fgColor", "color", g);
      },
      textColor: (g) => {
        I("textColor", "color", g);
      },
      borderColor: (g) => {
        I("borderColor", "borderColor", g);
      },
      strokeColor: (g) => {
        I("strokeColor", "borderColor", g);
      },
      rotation: (g) => {
        const C = g.detail.rotation;
        this.setRotation(C), this.annotationStorage.setValue(this.data.id, {
          rotation: C
        });
      }
    });
  }
  _dispatchEventFromSandbox(I, g) {
    const C = this._commonActions;
    for (const A of Object.keys(g.detail))
      (I[A] || C[A])?.(g);
  }
  _setDefaultPropertiesFromJS(I) {
    if (!this.enableScripting)
      return;
    const g = this.annotationStorage.getRawValue(this.data.id);
    if (!g)
      return;
    const C = this._commonActions;
    for (const [A, i] of Object.entries(g)) {
      const l = C[A];
      if (l) {
        const s = {
          detail: {
            [A]: i
          },
          target: I
        };
        l(s), delete g[A];
      }
    }
  }
  _createQuadrilaterals() {
    if (!this.container)
      return;
    const {
      quadPoints: I
    } = this.data;
    if (!I)
      return;
    const [g, C, A, i] = this.data.rect.map((a) => Math.fround(a));
    if (I.length === 8) {
      const [a, h, t, W] = I.subarray(2, 6);
      if (A === a && i === h && g === t && C === W)
        return;
    }
    const {
      style: l
    } = this.container;
    let s;
    if (this.#g) {
      const {
        borderColor: a,
        borderWidth: h
      } = l;
      l.borderWidth = 0, s = ["url('data:image/svg+xml;utf8,", '<svg xmlns="http://www.w3.org/2000/svg"', ' preserveAspectRatio="none" viewBox="0 0 1 1">', `<g fill="transparent" stroke="${a}" stroke-width="${h}">`], this.container.classList.add("hasBorder");
    }
    const d = A - g, c = i - C, {
      svgFactory: G
    } = this, b = G.createElement("svg");
    b.classList.add("quadrilateralsContainer"), b.setAttribute("width", 0), b.setAttribute("height", 0), b.role = "none";
    const o = G.createElement("defs");
    b.append(o);
    const m = G.createElement("clipPath"), e = `clippath_${this.data.id}`;
    m.setAttribute("id", e), m.setAttribute("clipPathUnits", "objectBoundingBox"), o.append(m);
    for (let a = 2, h = I.length; a < h; a += 8) {
      const t = I[a], W = I[a + 1], B = I[a + 2], w = I[a + 3], n = G.createElement("rect"), V = (B - g) / d, N = (i - W) / c, R = (t - B) / d, Y = (W - w) / c;
      n.setAttribute("x", V), n.setAttribute("y", N), n.setAttribute("width", R), n.setAttribute("height", Y), m.append(n), s?.push(`<rect vector-effect="non-scaling-stroke" x="${V}" y="${N}" width="${R}" height="${Y}"/>`);
    }
    this.#g && (s.push("</g></svg>')"), l.backgroundImage = s.join("")), this.container.append(b), this.container.style.clipPath = `url(#${e})`;
  }
  _createPopup(I = null) {
    const {
      data: g
    } = this;
    let C, A;
    I ? (C = {
      str: I.text
    }, A = I.date) : (C = g.contentsObj, A = g.modificationDate);
    const i = this.#A = new tA({
      data: {
        color: g.color,
        titleObj: g.titleObj,
        modificationDate: A,
        contentsObj: C,
        richText: g.richText,
        parentRect: g.rect,
        borderStyle: 0,
        id: `popup_${g.id}`,
        rotation: g.rotation,
        noRotate: !0
      },
      linkService: this.linkService,
      parent: this.parent,
      elements: [this]
    });
    this.parent._commentManager || this.parent.div.append(i.render());
  }
  get hasPopupElement() {
    return !!(this.#A || this.popup || this.data.popupRef);
  }
  get extraPopupElement() {
    return this.#A;
  }
  render() {
    f("Abstract method `AnnotationElement.render` called");
  }
  _getElementsByName(I, g = null) {
    const C = [];
    if (this._fieldObjects) {
      const A = this._fieldObjects[I];
      if (A)
        for (const {
          page: i,
          id: l,
          exportValues: s
        } of A) {
          if (i === -1 || l === g)
            continue;
          const d = typeof s == "string" ? s : null, c = document.querySelector(`[data-element-id="${l}"]`);
          if (c && !bg.has(c)) {
            L(`_getElementsByName - element not allowed: ${l}`);
            continue;
          }
          C.push({
            id: l,
            exportValue: d,
            domElement: c
          });
        }
      return C;
    }
    for (const A of document.getElementsByName(I)) {
      const {
        exportValue: i
      } = A, l = A.getAttribute("data-element-id");
      l !== g && bg.has(A) && C.push({
        id: l,
        exportValue: i,
        domElement: A
      });
    }
    return C;
  }
  show() {
    this.container && (this.container.hidden = !1), this.popup?.maybeShow();
  }
  hide() {
    this.container && (this.container.hidden = !0), this.popup?.forceHide();
  }
  getElementsToTriggerPopup() {
    return this.container;
  }
  addHighlightArea() {
    const I = this.getElementsToTriggerPopup();
    if (Array.isArray(I))
      for (const g of I)
        g.classList.add("highlightArea");
    else
      I.classList.add("highlightArea");
  }
  _editOnDoubleClick() {
    if (!this._isEditable)
      return;
    const {
      annotationEditorType: I,
      data: {
        id: g
      }
    } = this;
    this.container.addEventListener("dblclick", () => {
      this.linkService.eventBus?.dispatch("switchannotationeditormode", {
        source: this,
        mode: I,
        editId: g,
        mustEnterInEditMode: !0
      });
    });
  }
  get width() {
    return this.data.rect[2] - this.data.rect[0];
  }
  get height() {
    return this.data.rect[3] - this.data.rect[1];
  }
}
class Ld extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    }), this.editor = I.editor;
  }
  render() {
    return this.container.className = "editorAnnotation", this.container;
  }
  createOrUpdatePopup() {
    const {
      editor: I
    } = this;
    I.hasComment && (this._createPopup(I.comment), this.extraPopupElement.popup.renderCommentButton());
  }
  get hasCommentButton() {
    return this.enableComment && this.editor.hasComment;
  }
  get commentButtonPosition() {
    return this.editor.commentButtonPositionInPage;
  }
  get commentText() {
    return this.editor.comment.text;
  }
  set commentText(I) {
    this.editor.comment = I, I || this.removePopup();
  }
  get commentData() {
    return this.editor.getData();
  }
  remove() {
    this.container.remove(), this.container = null, this.removePopup();
  }
}
class JA extends $ {
  constructor(I, g = null) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !!g?.ignoreBorder,
      createQuadrilaterals: !0
    }), this.isTooltipOnly = I.data.isTooltipOnly;
  }
  render() {
    const {
      data: I,
      linkService: g
    } = this, C = document.createElement("a");
    C.setAttribute("data-element-id", I.id);
    let A = !1;
    return I.url ? (g.addLinkAttributes(C, I.url, I.newWindow), A = !0) : I.action ? (this._bindNamedAction(C, I.action, I.overlaidText), A = !0) : I.attachment ? (this.#g(C, I.attachment, I.overlaidText, I.attachmentDest), A = !0) : I.setOCGState ? (this.#A(C, I.setOCGState, I.overlaidText), A = !0) : I.dest ? (this._bindLink(C, I.dest, I.overlaidText), A = !0) : (I.actions && (I.actions.Action || I.actions["Mouse Up"] || I.actions["Mouse Down"]) && this.enableScripting && this.hasJSActions && (this._bindJSAction(C, I), A = !0), I.resetForm ? (this._bindResetFormAction(C, I.resetForm), A = !0) : this.isTooltipOnly && !A && (this._bindLink(C, ""), A = !0)), this.container.classList.add("linkAnnotation"), A && this.container.append(C), this.container;
  }
  #I() {
    this.container.setAttribute("data-internal-link", "");
  }
  _bindLink(I, g, C = "") {
    I.href = this.linkService.getDestinationHash(g), I.onclick = () => (g && this.linkService.goToDestination(g), !1), (g || g === "") && this.#I(), C && (I.title = C);
  }
  _bindNamedAction(I, g, C = "") {
    I.href = this.linkService.getAnchorUrl(""), I.onclick = () => (this.linkService.executeNamedAction(g), !1), C && (I.title = C), this.#I();
  }
  #g(I, g, C = "", A = null) {
    I.href = this.linkService.getAnchorUrl(""), g.description ? I.title = g.description : C && (I.title = C), I.onclick = () => (this.downloadManager?.openOrDownloadData(g.content, g.filename, A), !1), this.#I();
  }
  #A(I, g, C = "") {
    I.href = this.linkService.getAnchorUrl(""), I.onclick = () => (this.linkService.executeSetOCGState(g), !1), C && (I.title = C), this.#I();
  }
  _bindJSAction(I, g) {
    I.href = this.linkService.getAnchorUrl("");
    const C = /* @__PURE__ */ new Map([["Action", "onclick"], ["Mouse Up", "onmouseup"], ["Mouse Down", "onmousedown"]]);
    for (const A of Object.keys(g.actions)) {
      const i = C.get(A);
      i && (I[i] = () => (this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
        source: this,
        detail: {
          id: g.id,
          name: A
        }
      }), !1));
    }
    g.overlaidText && (I.title = g.overlaidText), I.onclick || (I.onclick = () => !1), this.#I();
  }
  _bindResetFormAction(I, g) {
    const C = I.onclick;
    if (C || (I.href = this.linkService.getAnchorUrl("")), this.#I(), !this._fieldObjects) {
      L('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'), C || (I.onclick = () => !1);
      return;
    }
    I.onclick = () => {
      C?.();
      const {
        fields: A,
        refs: i,
        include: l
      } = g, s = [];
      if (A.length !== 0 || i.length !== 0) {
        const G = new Set(i);
        for (const b of A) {
          const o = this._fieldObjects[b] || [];
          for (const {
            id: m
          } of o)
            G.add(m);
        }
        for (const b of Object.values(this._fieldObjects))
          for (const o of b)
            G.has(o.id) === l && s.push(o);
      } else
        for (const G of Object.values(this._fieldObjects))
          s.push(...G);
      const d = this.annotationStorage, c = [];
      for (const G of s) {
        const {
          id: b
        } = G;
        switch (c.push(b), G.type) {
          case "text": {
            const m = G.defaultValue || "";
            d.setValue(b, {
              value: m
            });
            break;
          }
          case "checkbox":
          case "radiobutton": {
            const m = G.defaultValue === G.exportValues;
            d.setValue(b, {
              value: m
            });
            break;
          }
          case "combobox":
          case "listbox": {
            const m = G.defaultValue || "";
            d.setValue(b, {
              value: m
            });
            break;
          }
          default:
            continue;
        }
        const o = document.querySelector(`[data-element-id="${b}"]`);
        if (o) {
          if (!bg.has(o)) {
            L(`_bindResetFormAction - element not allowed: ${b}`);
            continue;
          }
        } else continue;
        o.dispatchEvent(new Event("resetform"));
      }
      return this.enableScripting && this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
        source: this,
        detail: {
          id: "app",
          ids: c,
          name: "ResetForm"
        }
      }), !1;
    };
  }
}
class kd extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0
    });
  }
  render() {
    this.container.classList.add("textAnnotation");
    const I = document.createElement("img");
    return I.src = this.imageResourcesPath + "annotation-" + this.data.name.toLowerCase() + ".svg", I.setAttribute("data-l10n-id", "pdfjs-text-annotation-type"), I.setAttribute("data-l10n-args", JSON.stringify({
      type: this.data.name
    })), !this.data.popupRef && this.hasPopupData && this._createPopup(), this.container.append(I), this.container;
  }
}
class mg extends $ {
  render() {
    return this.container;
  }
  showElementAndHideCanvas(I) {
    this.data.hasOwnCanvas && (I.previousSibling?.nodeName === "CANVAS" && (I.previousSibling.hidden = !0), I.hidden = !1);
  }
  _getKeyModifier(I) {
    return GI.platform.isMac ? I.metaKey : I.ctrlKey;
  }
  _setEventListener(I, g, C, A, i) {
    C.includes("mouse") ? I.addEventListener(C, (l) => {
      this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
        source: this,
        detail: {
          id: this.data.id,
          name: A,
          value: i(l),
          shift: l.shiftKey,
          modifier: this._getKeyModifier(l)
        }
      });
    }) : I.addEventListener(C, (l) => {
      if (C === "blur") {
        if (!g.focused || !l.relatedTarget)
          return;
        g.focused = !1;
      } else if (C === "focus") {
        if (g.focused)
          return;
        g.focused = !0;
      }
      i && this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
        source: this,
        detail: {
          id: this.data.id,
          name: A,
          value: i(l)
        }
      });
    });
  }
  _setEventListeners(I, g, C, A) {
    for (const [i, l] of C)
      (l === "Action" || this.data.actions?.[l]) && ((l === "Focus" || l === "Blur") && (g ||= {
        focused: !1
      }), this._setEventListener(I, g, i, l, A), l === "Focus" && !this.data.actions?.Blur ? this._setEventListener(I, g, "blur", "Blur", null) : l === "Blur" && !this.data.actions?.Focus && this._setEventListener(I, g, "focus", "Focus", null));
  }
  _setBackgroundColor(I) {
    const g = this.data.backgroundColor || null;
    I.style.backgroundColor = g === null ? "transparent" : M.makeHexColor(g[0], g[1], g[2]);
  }
  _setTextStyle(I) {
    const g = ["left", "center", "right"], {
      fontColor: C
    } = this.data.defaultAppearanceData, A = this.data.defaultAppearanceData.fontSize || zd, i = I.style;
    let l;
    const s = 2, d = (c) => Math.round(10 * c) / 10;
    if (this.data.multiLine) {
      const c = Math.abs(this.data.rect[3] - this.data.rect[1] - s), G = Math.round(c / (QC * A)) || 1, b = c / G;
      l = Math.min(A, d(b / QC));
    } else {
      const c = Math.abs(this.data.rect[3] - this.data.rect[1] - s);
      l = Math.min(A, d(c / QC));
    }
    i.fontSize = `calc(${l}px * var(--total-scale-factor))`, i.color = M.makeHexColor(C[0], C[1], C[2]), this.data.textAlignment !== null && (i.textAlign = g[this.data.textAlignment]);
  }
  _setRequired(I, g) {
    g ? I.setAttribute("required", !0) : I.removeAttribute("required"), I.setAttribute("aria-required", g);
  }
}
class rd extends mg {
  constructor(I) {
    const g = I.renderForms || I.data.hasOwnCanvas || !I.data.hasAppearance && !!I.data.fieldValue;
    super(I, {
      isRenderable: g
    });
  }
  setPropertyOnSiblings(I, g, C, A) {
    const i = this.annotationStorage;
    for (const l of this._getElementsByName(I.name, I.id))
      l.domElement && (l.domElement[g] = C), i.setValue(l.id, {
        [A]: C
      });
  }
  render() {
    const I = this.annotationStorage, g = this.data.id;
    this.container.classList.add("textWidgetAnnotation");
    let C = null;
    if (this.renderForms) {
      const A = I.getValue(g, {
        value: this.data.fieldValue
      });
      let i = A.value || "";
      const l = I.getValue(g, {
        charLimit: this.data.maxLen
      }).charLimit;
      l && i.length > l && (i = i.slice(0, l));
      let s = A.formattedValue || this.data.textContent?.join(`
`) || null;
      s && this.data.comb && (s = s.replaceAll(/\s+/g, ""));
      const d = {
        userValue: i,
        formattedValue: s,
        lastCommittedValue: null,
        commitKey: 1,
        focused: !1
      };
      this.data.multiLine ? (C = document.createElement("textarea"), C.textContent = s ?? i, this.data.doNotScroll && (C.style.overflowY = "hidden")) : (C = document.createElement("input"), C.type = this.data.password ? "password" : "text", C.setAttribute("value", s ?? i), this.data.doNotScroll && (C.style.overflowX = "hidden")), this.data.hasOwnCanvas && (C.hidden = !0), bg.add(C), C.setAttribute("data-element-id", g), C.disabled = this.data.readOnly, C.name = this.data.fieldName, C.tabIndex = 0;
      const {
        datetimeFormat: c,
        datetimeType: G,
        timeStep: b
      } = this.data, o = !!G && this.enableScripting;
      c && (C.title = c), this._setRequired(C, this.data.required), l && (C.maxLength = l), C.addEventListener("input", (e) => {
        I.setValue(g, {
          value: e.target.value
        }), this.setPropertyOnSiblings(C, "value", e.target.value, "value"), d.formattedValue = null;
      }), C.addEventListener("resetform", (e) => {
        const a = this.data.defaultFieldValue ?? "";
        C.value = d.userValue = a, d.formattedValue = null;
      });
      let m = (e) => {
        const {
          formattedValue: a
        } = d;
        a != null && (e.target.value = a), e.target.scrollLeft = 0;
      };
      if (this.enableScripting && this.hasJSActions) {
        C.addEventListener("focus", (a) => {
          if (d.focused)
            return;
          const {
            target: h
          } = a;
          if (o && (h.type = G, b && (h.step = b)), d.userValue) {
            const t = d.userValue;
            if (o)
              if (G === "time") {
                const W = new Date(t), B = [W.getHours(), W.getMinutes(), W.getSeconds()];
                h.value = B.map((w) => w.toString().padStart(2, "0")).join(":");
              } else
                h.value = new Date(t - Jd).toISOString().split(G === "date" ? "T" : ".", 1)[0];
            else
              h.value = t;
          }
          d.lastCommittedValue = h.value, d.commitKey = 1, this.data.actions?.Focus || (d.focused = !0);
        }), C.addEventListener("updatefromsandbox", (a) => {
          this.showElementAndHideCanvas(a.target);
          const h = {
            value(t) {
              d.userValue = t.detail.value ?? "", o || I.setValue(g, {
                value: d.userValue.toString()
              }), t.target.value = d.userValue;
            },
            formattedValue(t) {
              const {
                formattedValue: W
              } = t.detail;
              d.formattedValue = W, W != null && t.target !== document.activeElement && (t.target.value = W);
              const B = {
                formattedValue: W
              };
              o && (B.value = W), I.setValue(g, B);
            },
            selRange(t) {
              t.target.setSelectionRange(...t.detail.selRange);
            },
            charLimit: (t) => {
              const {
                charLimit: W
              } = t.detail, {
                target: B
              } = t;
              if (W === 0) {
                B.removeAttribute("maxLength");
                return;
              }
              B.setAttribute("maxLength", W);
              let w = d.userValue;
              !w || w.length <= W || (w = w.slice(0, W), B.value = d.userValue = w, I.setValue(g, {
                value: w
              }), this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
                source: this,
                detail: {
                  id: g,
                  name: "Keystroke",
                  value: w,
                  willCommit: !0,
                  commitKey: 1,
                  selStart: B.selectionStart,
                  selEnd: B.selectionEnd
                }
              }));
            }
          };
          this._dispatchEventFromSandbox(h, a);
        }), C.addEventListener("keydown", (a) => {
          d.commitKey = 1;
          let h = -1;
          if (a.key === "Escape" ? h = 0 : a.key === "Enter" && !this.data.multiLine ? h = 2 : a.key === "Tab" && (d.commitKey = 3), h === -1)
            return;
          const {
            value: t
          } = a.target;
          d.lastCommittedValue !== t && (d.lastCommittedValue = t, d.userValue = t, this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
            source: this,
            detail: {
              id: g,
              name: "Keystroke",
              value: t,
              willCommit: !0,
              commitKey: h,
              selStart: a.target.selectionStart,
              selEnd: a.target.selectionEnd
            }
          }));
        });
        const e = m;
        m = null, C.addEventListener("blur", (a) => {
          if (!d.focused || !a.relatedTarget)
            return;
          this.data.actions?.Blur || (d.focused = !1);
          const {
            target: h
          } = a;
          let {
            value: t
          } = h;
          if (o) {
            if (t && G === "time") {
              const W = t.split(":").map((B) => parseInt(B, 10));
              t = new Date(2e3, 0, 1, W[0], W[1], W[2] || 0).valueOf(), h.step = "";
            } else
              t.includes("T") || (t = `${t}T00:00`), t = new Date(t).valueOf();
            h.type = "text";
          }
          d.userValue = t, d.lastCommittedValue !== t && this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
            source: this,
            detail: {
              id: g,
              name: "Keystroke",
              value: t,
              willCommit: !0,
              commitKey: d.commitKey,
              selStart: a.target.selectionStart,
              selEnd: a.target.selectionEnd
            }
          }), e(a);
        }), this.data.actions?.Keystroke && C.addEventListener("beforeinput", (a) => {
          d.lastCommittedValue = null;
          const {
            data: h,
            target: t
          } = a, {
            value: W,
            selectionStart: B,
            selectionEnd: w
          } = t;
          let n = B, V = w;
          switch (a.inputType) {
            case "deleteWordBackward": {
              const N = W.substring(0, B).match(/\w*[^\w]*$/);
              N && (n -= N[0].length);
              break;
            }
            case "deleteWordForward": {
              const N = W.substring(B).match(/^[^\w]*\w*/);
              N && (V += N[0].length);
              break;
            }
            case "deleteContentBackward":
              B === w && (n -= 1);
              break;
            case "deleteContentForward":
              B === w && (V += 1);
              break;
          }
          a.preventDefault(), this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
            source: this,
            detail: {
              id: g,
              name: "Keystroke",
              value: W,
              change: h || "",
              willCommit: !1,
              selStart: n,
              selEnd: V
            }
          });
        }), this._setEventListeners(C, d, [["focus", "Focus"], ["blur", "Blur"], ["mousedown", "Mouse Down"], ["mouseenter", "Mouse Enter"], ["mouseleave", "Mouse Exit"], ["mouseup", "Mouse Up"]], (a) => a.target.value);
      }
      if (m && C.addEventListener("blur", m), this.data.comb) {
        const a = (this.data.rect[2] - this.data.rect[0]) / l;
        C.classList.add("comb"), C.style.letterSpacing = `calc(${a}px * var(--total-scale-factor) - 1ch)`;
      }
    } else
      C = document.createElement("div"), C.textContent = this.data.fieldValue, C.style.verticalAlign = "middle", C.style.display = "table-cell", this.data.hasOwnCanvas && (C.hidden = !0);
    return this._setTextStyle(C), this._setBackgroundColor(C), this._setDefaultPropertiesFromJS(C), this.container.append(C), this.container;
  }
}
class Td extends mg {
  constructor(I) {
    super(I, {
      isRenderable: !!I.data.hasOwnCanvas
    });
  }
}
class jd extends mg {
  constructor(I) {
    super(I, {
      isRenderable: I.renderForms
    });
  }
  render() {
    const I = this.annotationStorage, g = this.data, C = g.id;
    let A = I.getValue(C, {
      value: g.exportValue === g.fieldValue
    }).value;
    typeof A == "string" && (A = A !== "Off", I.setValue(C, {
      value: A
    })), this.container.classList.add("buttonWidgetAnnotation", "checkBox");
    const i = document.createElement("input");
    return bg.add(i), i.setAttribute("data-element-id", C), i.disabled = g.readOnly, this._setRequired(i, this.data.required), i.type = "checkbox", i.name = g.fieldName, A && i.setAttribute("checked", !0), i.setAttribute("exportValue", g.exportValue), i.tabIndex = 0, i.addEventListener("change", (l) => {
      const {
        name: s,
        checked: d
      } = l.target;
      for (const c of this._getElementsByName(s, C)) {
        const G = d && c.exportValue === g.exportValue;
        c.domElement && (c.domElement.checked = G), I.setValue(c.id, {
          value: G
        });
      }
      I.setValue(C, {
        value: d
      });
    }), i.addEventListener("resetform", (l) => {
      const s = g.defaultFieldValue || "Off";
      l.target.checked = s === g.exportValue;
    }), this.enableScripting && this.hasJSActions && (i.addEventListener("updatefromsandbox", (l) => {
      const s = {
        value(d) {
          d.target.checked = d.detail.value !== "Off", I.setValue(C, {
            value: d.target.checked
          });
        }
      };
      this._dispatchEventFromSandbox(s, l);
    }), this._setEventListeners(i, null, [["change", "Validate"], ["change", "Action"], ["focus", "Focus"], ["blur", "Blur"], ["mousedown", "Mouse Down"], ["mouseenter", "Mouse Enter"], ["mouseleave", "Mouse Exit"], ["mouseup", "Mouse Up"]], (l) => l.target.checked)), this._setBackgroundColor(i), this._setDefaultPropertiesFromJS(i), this.container.append(i), this.container;
  }
}
class Ml extends mg {
  constructor(I) {
    super(I, {
      isRenderable: I.renderForms
    });
  }
  render() {
    this.container.classList.add("buttonWidgetAnnotation", "radioButton");
    const I = this.annotationStorage, g = this.data, C = g.id;
    let A = I.getValue(C, {
      value: g.fieldValue === g.buttonValue
    }).value;
    if (typeof A == "string" && (A = A !== g.buttonValue, I.setValue(C, {
      value: A
    })), A)
      for (const l of this._getElementsByName(g.fieldName, C))
        I.setValue(l.id, {
          value: !1
        });
    const i = document.createElement("input");
    if (bg.add(i), i.setAttribute("data-element-id", C), i.disabled = g.readOnly, this._setRequired(i, this.data.required), i.type = "radio", i.name = g.fieldName, A && i.setAttribute("checked", !0), i.tabIndex = 0, i.addEventListener("change", (l) => {
      const {
        name: s,
        checked: d
      } = l.target;
      for (const c of this._getElementsByName(s, C))
        I.setValue(c.id, {
          value: !1
        });
      I.setValue(C, {
        value: d
      });
    }), i.addEventListener("resetform", (l) => {
      const s = g.defaultFieldValue;
      l.target.checked = s != null && s === g.buttonValue;
    }), this.enableScripting && this.hasJSActions) {
      const l = g.buttonValue;
      i.addEventListener("updatefromsandbox", (s) => {
        const d = {
          value: (c) => {
            const G = l === c.detail.value;
            for (const b of this._getElementsByName(c.target.name)) {
              const o = G && b.id === C;
              b.domElement && (b.domElement.checked = o), I.setValue(b.id, {
                value: o
              });
            }
          }
        };
        this._dispatchEventFromSandbox(d, s);
      }), this._setEventListeners(i, null, [["change", "Validate"], ["change", "Action"], ["focus", "Focus"], ["blur", "Blur"], ["mousedown", "Mouse Down"], ["mouseenter", "Mouse Enter"], ["mouseleave", "Mouse Exit"], ["mouseup", "Mouse Up"]], (s) => s.target.checked);
    }
    return this._setBackgroundColor(i), this._setDefaultPropertiesFromJS(i), this.container.append(i), this.container;
  }
}
class Qd extends JA {
  constructor(I) {
    super(I, {
      ignoreBorder: I.data.hasAppearance
    });
  }
  render() {
    const I = super.render();
    I.classList.add("buttonWidgetAnnotation", "pushButton");
    const g = I.lastChild;
    return this.enableScripting && this.hasJSActions && g && (this._setDefaultPropertiesFromJS(g), g.addEventListener("updatefromsandbox", (C) => {
      this._dispatchEventFromSandbox({}, C);
    })), I;
  }
}
class xd extends mg {
  constructor(I) {
    super(I, {
      isRenderable: I.renderForms
    });
  }
  render() {
    this.container.classList.add("choiceWidgetAnnotation");
    const I = this.annotationStorage, g = this.data.id, C = I.getValue(g, {
      value: this.data.fieldValue
    }), A = document.createElement("select");
    bg.add(A), A.setAttribute("data-element-id", g), A.disabled = this.data.readOnly, this._setRequired(A, this.data.required), A.name = this.data.fieldName, A.tabIndex = 0;
    let i = this.data.combo && this.data.options.length > 0;
    this.data.combo || (A.size = this.data.options.length, this.data.multiSelect && (A.multiple = !0)), A.addEventListener("resetform", (G) => {
      const b = this.data.defaultFieldValue;
      for (const o of A.options)
        o.selected = o.value === b;
    });
    for (const G of this.data.options) {
      const b = document.createElement("option");
      b.textContent = G.displayValue, b.value = G.exportValue, C.value.includes(G.exportValue) && (b.setAttribute("selected", !0), i = !1), A.append(b);
    }
    let l = null;
    if (i) {
      const G = document.createElement("option");
      G.value = " ", G.setAttribute("hidden", !0), G.setAttribute("selected", !0), A.prepend(G), l = () => {
        G.remove(), A.removeEventListener("input", l), l = null;
      }, A.addEventListener("input", l);
    }
    const s = (G) => {
      const b = G ? "value" : "textContent", {
        options: o,
        multiple: m
      } = A;
      return m ? Array.prototype.filter.call(o, (e) => e.selected).map((e) => e[b]) : o.selectedIndex === -1 ? null : o[o.selectedIndex][b];
    };
    let d = s(!1);
    const c = (G) => {
      const b = G.target.options;
      return Array.prototype.map.call(b, (o) => ({
        displayValue: o.textContent,
        exportValue: o.value
      }));
    };
    return this.enableScripting && this.hasJSActions ? (A.addEventListener("updatefromsandbox", (G) => {
      const b = {
        value(o) {
          l?.();
          const m = o.detail.value, e = new Set(Array.isArray(m) ? m : [m]);
          for (const a of A.options)
            a.selected = e.has(a.value);
          I.setValue(g, {
            value: s(!0)
          }), d = s(!1);
        },
        multipleSelection(o) {
          A.multiple = !0;
        },
        remove(o) {
          const m = A.options, e = o.detail.remove;
          m[e].selected = !1, A.remove(e), m.length > 0 && Array.prototype.findIndex.call(m, (h) => h.selected) === -1 && (m[0].selected = !0), I.setValue(g, {
            value: s(!0),
            items: c(o)
          }), d = s(!1);
        },
        clear(o) {
          for (; A.length !== 0; )
            A.remove(0);
          I.setValue(g, {
            value: null,
            items: []
          }), d = s(!1);
        },
        insert(o) {
          const {
            index: m,
            displayValue: e,
            exportValue: a
          } = o.detail.insert, h = A.children[m], t = document.createElement("option");
          t.textContent = e, t.value = a, h ? h.before(t) : A.append(t), I.setValue(g, {
            value: s(!0),
            items: c(o)
          }), d = s(!1);
        },
        items(o) {
          const {
            items: m
          } = o.detail;
          for (; A.length !== 0; )
            A.remove(0);
          for (const e of m) {
            const {
              displayValue: a,
              exportValue: h
            } = e, t = document.createElement("option");
            t.textContent = a, t.value = h, A.append(t);
          }
          A.options.length > 0 && (A.options[0].selected = !0), I.setValue(g, {
            value: s(!0),
            items: c(o)
          }), d = s(!1);
        },
        indices(o) {
          const m = new Set(o.detail.indices);
          for (const e of o.target.options)
            e.selected = m.has(e.index);
          I.setValue(g, {
            value: s(!0)
          }), d = s(!1);
        },
        editable(o) {
          o.target.disabled = !o.detail.editable;
        }
      };
      this._dispatchEventFromSandbox(b, G);
    }), A.addEventListener("input", (G) => {
      const b = s(!0), o = s(!1);
      I.setValue(g, {
        value: b
      }), G.preventDefault(), this.linkService.eventBus?.dispatch("dispatcheventinsandbox", {
        source: this,
        detail: {
          id: g,
          name: "Keystroke",
          value: d,
          change: o,
          changeEx: b,
          willCommit: !1,
          commitKey: 1,
          keyDown: !1
        }
      });
    }), this._setEventListeners(A, null, [["focus", "Focus"], ["blur", "Blur"], ["mousedown", "Mouse Down"], ["mouseenter", "Mouse Enter"], ["mouseleave", "Mouse Exit"], ["mouseup", "Mouse Up"], ["input", "Action"], ["input", "Validate"]], (G) => G.target.value)) : A.addEventListener("input", function(G) {
      I.setValue(g, {
        value: s(!0)
      });
    }), this.data.combo && this._setTextStyle(A), this._setBackgroundColor(A), this._setDefaultPropertiesFromJS(A), this.container.append(A), this.container;
  }
}
class tA extends $ {
  constructor(I) {
    const {
      data: g,
      elements: C,
      parent: A
    } = I, i = !!A._commentManager;
    if (super(I, {
      isRenderable: !i && $._hasPopupData(g)
    }), this.elements = C, i && $._hasPopupData(g)) {
      const l = this.popup = this.#I();
      for (const s of C)
        s.popup = l;
    } else
      this.popup = null;
  }
  #I() {
    return new Od({
      container: this.container,
      color: this.data.color,
      titleObj: this.data.titleObj,
      modificationDate: this.data.modificationDate || this.data.creationDate,
      contentsObj: this.data.contentsObj,
      richText: this.data.richText,
      rect: this.data.rect,
      parentRect: this.data.parentRect || null,
      parent: this.parent,
      elements: this.elements,
      open: this.data.open,
      commentManager: this.parent._commentManager
    });
  }
  render() {
    const {
      container: I
    } = this;
    I.classList.add("popupAnnotation"), I.role = "comment";
    const g = this.popup = this.#I(), C = [];
    for (const A of this.elements)
      A.popup = g, A.container.ariaHasPopup = "dialog", C.push(A.data.id), A.addHighlightArea();
    return this.container.setAttribute("aria-controls", C.map((A) => `${yA}${A}`).join(",")), this.container;
  }
}
class Od {
  #I = null;
  #g = this.#x.bind(this);
  #A = this.#r.bind(this);
  #C = this.#D.bind(this);
  #i = this.#V.bind(this);
  #l = null;
  #s = null;
  #d = null;
  #c = null;
  #Z = null;
  #o = null;
  #b = null;
  #m = !1;
  #t = null;
  #a = null;
  #G = null;
  #e = null;
  #B = null;
  #W = null;
  #h = null;
  #N = null;
  #w = null;
  #n = null;
  #R = !1;
  #Y = null;
  #u = null;
  constructor({
    container: I,
    color: g,
    elements: C,
    titleObj: A,
    modificationDate: i,
    contentsObj: l,
    richText: s,
    parent: d,
    rect: c,
    parentRect: G,
    open: b,
    commentManager: o = null
  }) {
    this.#s = I, this.#w = A, this.#d = l, this.#N = s, this.#o = d, this.#l = g, this.#h = c, this.#b = G, this.#Z = C, this.#I = o, this.#Y = C[0], this.#c = sA.toDateObject(i), this.trigger = C.flatMap((m) => m.getElementsToTriggerPopup()), o ? this.renderCommentButton() : (this.#M(), this.#s.hidden = !0, b && this.#V());
  }
  #M() {
    if (this.#a)
      return;
    this.#a = new AbortController();
    const {
      signal: I
    } = this.#a;
    for (const g of this.trigger)
      g.addEventListener("click", this.#i, {
        signal: I
      }), g.addEventListener("pointerenter", this.#C, {
        signal: I
      }), g.addEventListener("pointerleave", this.#A, {
        signal: I
      }), g.classList.add("popupTriggerArea");
    for (const g of this.#Z)
      g.container?.addEventListener("keydown", this.#g, {
        signal: I
      });
  }
  #y() {
    const I = this.#Z.find((g) => g.hasCommentButton);
    I && (this.#B = I._normalizePoint(I.commentButtonPosition));
  }
  renderCommentButton() {
    if (this.#e || (this.#B || this.#y(), !this.#B))
      return;
    const {
      signal: I
    } = this.#a = new AbortController(), g = !!this.#Y.extraPopupElement, C = () => {
      this.#I.toggleCommentPopup(this, !0, void 0, !g);
    }, A = () => {
      this.#I.toggleCommentPopup(this, !1, !0, !g);
    }, i = () => {
      this.#I.toggleCommentPopup(this, !1, !1);
    };
    if (g) {
      this.#e = this.#Y.container;
      for (const l of this.trigger)
        l.ariaHasPopup = "dialog", l.ariaControls = "commentPopup", l.addEventListener("keydown", this.#g, {
          signal: I
        }), l.addEventListener("click", C, {
          signal: I
        }), l.addEventListener("pointerenter", A, {
          signal: I
        }), l.addEventListener("pointerleave", i, {
          signal: I
        }), l.classList.add("popupTriggerArea");
    } else {
      const l = this.#e = document.createElement("button");
      l.className = "annotationCommentButton";
      const s = this.#Y.container;
      l.style.zIndex = s.style.zIndex + 1, l.tabIndex = 0, l.ariaHasPopup = "dialog", l.ariaControls = "commentPopup", l.setAttribute("data-l10n-id", "pdfjs-show-comment-button"), this.#p(), this.#X(), l.addEventListener("keydown", this.#g, {
        signal: I
      }), l.addEventListener("click", C, {
        signal: I
      }), l.addEventListener("pointerenter", A, {
        signal: I
      }), l.addEventListener("pointerleave", i, {
        signal: I
      }), s.after(l);
    }
  }
  #X() {
    if (this.#Y.extraPopupElement && !this.#Y.editor)
      return;
    this.renderCommentButton();
    const [I, g] = this.#B, {
      style: C
    } = this.#e;
    C.left = `calc(${I}%)`, C.top = `calc(${g}% - var(--comment-button-dim))`;
  }
  #p() {
    this.#Y.extraPopupElement || (this.renderCommentButton(), this.#e.style.backgroundColor = this.commentButtonColor || "");
  }
  get commentButtonColor() {
    const {
      color: I,
      opacity: g
    } = this.#Y.commentData;
    return I ? this.#o._commentManager.makeCommentColor(I, g) : null;
  }
  focusCommentButton() {
    setTimeout(() => {
      this.#e?.focus();
    }, 0);
  }
  getData() {
    const {
      richText: I,
      color: g,
      opacity: C,
      creationDate: A,
      modificationDate: i
    } = this.#Y.commentData;
    return {
      contentsObj: {
        str: this.comment
      },
      richText: I,
      color: g,
      opacity: C,
      creationDate: A,
      modificationDate: i
    };
  }
  get elementBeforePopup() {
    return this.#e;
  }
  get comment() {
    return this.#u ||= this.#Y.commentText, this.#u;
  }
  set comment(I) {
    I !== this.comment && (this.#Y.commentText = this.#u = I);
  }
  get parentBoundingClientRect() {
    return this.#Y.layer.getBoundingClientRect();
  }
  setCommentButtonStates({
    selected: I,
    hasPopup: g
  }) {
    this.#e && (this.#e.classList.toggle("selected", I), this.#e.ariaExpanded = g);
  }
  setSelectedCommentButton(I) {
    this.#e.classList.toggle("selected", I);
  }
  get commentPopupPosition() {
    if (this.#W)
      return this.#W;
    const {
      x: I,
      y: g,
      height: C
    } = this.#e.getBoundingClientRect(), {
      x: A,
      y: i,
      width: l,
      height: s
    } = this.#Y.layer.getBoundingClientRect();
    return [(I - A) / l, (g + C - i) / s];
  }
  set commentPopupPosition(I) {
    this.#W = I;
  }
  hasDefaultPopupPosition() {
    return this.#W === null;
  }
  get commentButtonPosition() {
    return this.#B;
  }
  get commentButtonWidth() {
    return this.#e.getBoundingClientRect().width / this.parentBoundingClientRect.width;
  }
  editComment(I) {
    const [g, C] = this.#W || this.commentButtonPosition.map((c) => c / 100), A = this.parentBoundingClientRect, {
      x: i,
      y: l,
      width: s,
      height: d
    } = A;
    this.#I.showDialog(null, this, i + g * s, l + C * d, {
      ...I,
      parentDimensions: A
    });
  }
  render() {
    if (this.#t)
      return;
    const I = this.#t = document.createElement("div");
    if (I.className = "popup", this.#l) {
      const C = I.style.outlineColor = M.makeHexColor(...this.#l);
      I.style.backgroundColor = `color-mix(in srgb, ${C} 30%, white)`;
    }
    const g = document.createElement("span");
    if (g.className = "header", this.#w?.str) {
      const C = document.createElement("span");
      C.className = "title", g.append(C), {
        dir: C.dir,
        str: C.textContent
      } = this.#w;
    }
    if (I.append(g), this.#c) {
      const C = document.createElement("time");
      C.className = "popupDate", C.setAttribute("data-l10n-id", "pdfjs-annotation-date-time-string"), C.setAttribute("data-l10n-args", JSON.stringify({
        dateObj: this.#c.valueOf()
      })), C.dateTime = this.#c.toISOString(), g.append(C);
    }
    dl({
      html: this.#K || this.#d.str,
      dir: this.#d?.dir,
      className: "popupContent"
    }, I), this.#s.append(I);
  }
  get #K() {
    const I = this.#N, g = this.#d;
    return I?.str && (!g?.str || g.str === I.str) && this.#N.html || null;
  }
  get #S() {
    return this.#K?.attributes?.style?.fontSize || 0;
  }
  get #F() {
    return this.#K?.attributes?.style?.color || null;
  }
  #z(I) {
    const g = [], C = {
      str: I,
      html: {
        name: "div",
        attributes: {
          dir: "auto"
        },
        children: [{
          name: "p",
          children: g
        }]
      }
    }, A = {
      style: {
        color: this.#F,
        fontSize: this.#S ? `calc(${this.#S}px * var(--total-scale-factor))` : ""
      }
    };
    for (const i of I.split(`
`))
      g.push({
        name: "span",
        value: i,
        attributes: A
      });
    return C;
  }
  #x(I) {
    I.altKey || I.shiftKey || I.ctrlKey || I.metaKey || (I.key === "Enter" || I.key === "Escape" && this.#m) && this.#V();
  }
  updateEdited({
    rect: I,
    popup: g,
    deleted: C
  }) {
    if (this.#I) {
      C ? (this.remove(), this.#u = null) : g && (g.deleted ? this.remove() : (this.#p(), this.#u = g.text)), I && (this.#B = null, this.#y(), this.#X());
      return;
    }
    if (C || g?.deleted) {
      this.remove();
      return;
    }
    this.#M(), this.#n ||= {
      contentsObj: this.#d,
      richText: this.#N
    }, I && (this.#G = null), g && g.text && (this.#N = this.#z(g.text), this.#c = sA.toDateObject(g.date), this.#d = null), this.#t?.remove(), this.#t = null;
  }
  resetEdited() {
    this.#n && ({
      contentsObj: this.#d,
      richText: this.#N
    } = this.#n, this.#n = null, this.#t?.remove(), this.#t = null, this.#G = null);
  }
  remove() {
    if (this.#a?.abort(), this.#a = null, this.#t?.remove(), this.#t = null, this.#R = !1, this.#m = !1, this.#e?.remove(), this.#e = null, this.trigger)
      for (const I of this.trigger)
        I.classList.remove("popupTriggerArea");
  }
  #H() {
    if (this.#G !== null)
      return;
    const {
      page: {
        view: I
      },
      viewport: {
        rawDims: {
          pageWidth: g,
          pageHeight: C,
          pageX: A,
          pageY: i
        }
      }
    } = this.#o;
    let l = !!this.#b, s = l ? this.#b : this.#h;
    for (const e of this.#Z)
      if (!s || M.intersect(e.data.rect, s) !== null) {
        s = e.data.rect, l = !0;
        break;
      }
    const d = M.normalizeRect([s[0], I[3] - s[1] + I[1], s[2], I[3] - s[3] + I[1]]), G = l ? s[2] - s[0] + 5 : 0, b = d[0] + G, o = d[1];
    this.#G = [100 * (b - A) / g, 100 * (o - i) / C];
    const {
      style: m
    } = this.#s;
    m.left = `${this.#G[0]}%`, m.top = `${this.#G[1]}%`;
  }
  #V() {
    if (this.#I) {
      this.#I.toggleCommentPopup(this, !1);
      return;
    }
    this.#m = !this.#m, this.#m ? (this.#D(), this.#s.addEventListener("click", this.#i), this.#s.addEventListener("keydown", this.#g)) : (this.#r(), this.#s.removeEventListener("click", this.#i), this.#s.removeEventListener("keydown", this.#g));
  }
  #D() {
    this.#t || this.render(), this.isVisible ? this.#m && this.#s.classList.add("focused") : (this.#H(), this.#s.hidden = !1, this.#s.style.zIndex = parseInt(this.#s.style.zIndex) + 1e3);
  }
  #r() {
    this.#s.classList.remove("focused"), !(this.#m || !this.isVisible) && (this.#s.hidden = !0, this.#s.style.zIndex = parseInt(this.#s.style.zIndex) - 1e3);
  }
  forceHide() {
    this.#R = this.isVisible, this.#R && (this.#s.hidden = !0);
  }
  maybeShow() {
    this.#I || (this.#M(), this.#R && (this.#t || this.#D(), this.#R = !1, this.#s.hidden = !1));
  }
  get isVisible() {
    return this.#I ? !1 : this.#s.hidden === !1;
  }
}
class Dl extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    }), this.textContent = I.data.textContent, this.textPosition = I.data.textPosition, this.annotationEditorType = k.FREETEXT;
  }
  render() {
    if (this.container.classList.add("freeTextAnnotation"), this.textContent) {
      const I = document.createElement("div");
      I.classList.add("annotationTextContent"), I.setAttribute("role", "comment");
      for (const g of this.textContent) {
        const C = document.createElement("span");
        C.textContent = g, I.append(C);
      }
      this.container.append(I);
    }
    return !this.data.popupRef && this.hasPopupData && this._createPopup(), this._editOnDoubleClick(), this.container;
  }
}
class Ud extends $ {
  #I = null;
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    });
  }
  render() {
    this.container.classList.add("lineAnnotation");
    const {
      data: I,
      width: g,
      height: C
    } = this, A = this.svgFactory.create(g, C, !0), i = this.#I = this.svgFactory.createElement("svg:line");
    return i.setAttribute("x1", I.rect[2] - I.lineCoordinates[0]), i.setAttribute("y1", I.rect[3] - I.lineCoordinates[1]), i.setAttribute("x2", I.rect[2] - I.lineCoordinates[2]), i.setAttribute("y2", I.rect[3] - I.lineCoordinates[3]), i.setAttribute("stroke-width", I.borderStyle.width || 1), i.setAttribute("stroke", "transparent"), i.setAttribute("fill", "transparent"), A.append(i), this.container.append(A), !I.popupRef && this.hasPopupData && this._createPopup(), this.container;
  }
  getElementsToTriggerPopup() {
    return this.#I;
  }
  addHighlightArea() {
    this.container.classList.add("highlightArea");
  }
}
class vd extends $ {
  #I = null;
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    });
  }
  render() {
    this.container.classList.add("squareAnnotation");
    const {
      data: I,
      width: g,
      height: C
    } = this, A = this.svgFactory.create(g, C, !0), i = I.borderStyle.width, l = this.#I = this.svgFactory.createElement("svg:rect");
    return l.setAttribute("x", i / 2), l.setAttribute("y", i / 2), l.setAttribute("width", g - i), l.setAttribute("height", C - i), l.setAttribute("stroke-width", i || 1), l.setAttribute("stroke", "transparent"), l.setAttribute("fill", "transparent"), A.append(l), this.container.append(A), !I.popupRef && this.hasPopupData && this._createPopup(), this.container;
  }
  getElementsToTriggerPopup() {
    return this.#I;
  }
  addHighlightArea() {
    this.container.classList.add("highlightArea");
  }
}
class Ed extends $ {
  #I = null;
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    });
  }
  render() {
    this.container.classList.add("circleAnnotation");
    const {
      data: I,
      width: g,
      height: C
    } = this, A = this.svgFactory.create(g, C, !0), i = I.borderStyle.width, l = this.#I = this.svgFactory.createElement("svg:ellipse");
    return l.setAttribute("cx", g / 2), l.setAttribute("cy", C / 2), l.setAttribute("rx", g / 2 - i / 2), l.setAttribute("ry", C / 2 - i / 2), l.setAttribute("stroke-width", i || 1), l.setAttribute("stroke", "transparent"), l.setAttribute("fill", "transparent"), A.append(l), this.container.append(A), !I.popupRef && this.hasPopupData && this._createPopup(), this.container;
  }
  getElementsToTriggerPopup() {
    return this.#I;
  }
  addHighlightArea() {
    this.container.classList.add("highlightArea");
  }
}
class Kl extends $ {
  #I = null;
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    }), this.containerClassName = "polylineAnnotation", this.svgElementName = "svg:polyline";
  }
  render() {
    this.container.classList.add(this.containerClassName);
    const {
      data: {
        rect: I,
        vertices: g,
        borderStyle: C,
        popupRef: A
      },
      width: i,
      height: l
    } = this;
    if (!g)
      return this.container;
    const s = this.svgFactory.create(i, l, !0);
    let d = [];
    for (let G = 0, b = g.length; G < b; G += 2) {
      const o = g[G] - I[0], m = I[3] - g[G + 1];
      d.push(`${o},${m}`);
    }
    d = d.join(" ");
    const c = this.#I = this.svgFactory.createElement(this.svgElementName);
    return c.setAttribute("points", d), c.setAttribute("stroke-width", C.width || 1), c.setAttribute("stroke", "transparent"), c.setAttribute("fill", "transparent"), s.append(c), this.container.append(s), !A && this.hasPopupData && this._createPopup(), this.container;
  }
  getElementsToTriggerPopup() {
    return this.#I;
  }
  addHighlightArea() {
    this.container.classList.add("highlightArea");
  }
}
class Pd extends Kl {
  constructor(I) {
    super(I), this.containerClassName = "polygonAnnotation", this.svgElementName = "svg:polygon";
  }
}
class fd extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    });
  }
  render() {
    return this.container.classList.add("caretAnnotation"), !this.data.popupRef && this.hasPopupData && this._createPopup(), this.container;
  }
}
class LA extends $ {
  #I = null;
  #g = [];
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    }), this.containerClassName = "inkAnnotation", this.svgElementName = "svg:polyline", this.annotationEditorType = this.data.it === "InkHighlight" ? k.HIGHLIGHT : k.INK;
  }
  #A(I, g) {
    switch (I) {
      case 90:
        return {
          transform: `rotate(90) translate(${-g[0]},${g[1]}) scale(1,-1)`,
          width: g[3] - g[1],
          height: g[2] - g[0]
        };
      case 180:
        return {
          transform: `rotate(180) translate(${-g[2]},${g[1]}) scale(1,-1)`,
          width: g[2] - g[0],
          height: g[3] - g[1]
        };
      case 270:
        return {
          transform: `rotate(270) translate(${-g[2]},${g[3]}) scale(1,-1)`,
          width: g[3] - g[1],
          height: g[2] - g[0]
        };
      default:
        return {
          transform: `translate(${-g[0]},${g[3]}) scale(1,-1)`,
          width: g[2] - g[0],
          height: g[3] - g[1]
        };
    }
  }
  render() {
    this.container.classList.add(this.containerClassName);
    const {
      data: {
        rect: I,
        rotation: g,
        inkLists: C,
        borderStyle: A,
        popupRef: i
      }
    } = this, {
      transform: l,
      width: s,
      height: d
    } = this.#A(g, I), c = this.svgFactory.create(s, d, !0), G = this.#I = this.svgFactory.createElement("svg:g");
    c.append(G), G.setAttribute("stroke-width", A.width || 1), G.setAttribute("stroke-linecap", "round"), G.setAttribute("stroke-linejoin", "round"), G.setAttribute("stroke-miterlimit", 10), G.setAttribute("stroke", "transparent"), G.setAttribute("fill", "transparent"), G.setAttribute("transform", l);
    for (let b = 0, o = C.length; b < o; b++) {
      const m = this.svgFactory.createElement(this.svgElementName);
      this.#g.push(m), m.setAttribute("points", C[b].join(",")), G.append(m);
    }
    return !i && this.hasPopupData && this._createPopup(), this.container.append(c), this._editOnDoubleClick(), this.container;
  }
  updateEdited(I) {
    super.updateEdited(I);
    const {
      thickness: g,
      points: C,
      rect: A
    } = I, i = this.#I;
    if (g >= 0 && i.setAttribute("stroke-width", g || 1), C)
      for (let l = 0, s = this.#g.length; l < s; l++)
        this.#g[l].setAttribute("points", C[l].join(","));
    if (A) {
      const {
        transform: l,
        width: s,
        height: d
      } = this.#A(this.data.rotation, A);
      i.parentElement.setAttribute("viewBox", `0 0 ${s} ${d}`), i.setAttribute("transform", l);
    }
  }
  getElementsToTriggerPopup() {
    return this.#g;
  }
  addHighlightArea() {
    this.container.classList.add("highlightArea");
  }
}
class Sl extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0,
      createQuadrilaterals: !0
    }), this.annotationEditorType = k.HIGHLIGHT;
  }
  render() {
    const {
      data: {
        overlaidText: I,
        popupRef: g
      }
    } = this;
    if (!g && this.hasPopupData && this._createPopup(), this.container.classList.add("highlightAnnotation"), this._editOnDoubleClick(), I) {
      const C = document.createElement("mark");
      C.classList.add("overlaidText"), C.textContent = I, this.container.append(C);
    }
    return this.container;
  }
}
class _d extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0,
      createQuadrilaterals: !0
    });
  }
  render() {
    const {
      data: {
        overlaidText: I,
        popupRef: g
      }
    } = this;
    if (!g && this.hasPopupData && this._createPopup(), this.container.classList.add("underlineAnnotation"), I) {
      const C = document.createElement("u");
      C.classList.add("overlaidText"), C.textContent = I, this.container.append(C);
    }
    return this.container;
  }
}
class qd extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0,
      createQuadrilaterals: !0
    });
  }
  render() {
    const {
      data: {
        overlaidText: I,
        popupRef: g
      }
    } = this;
    if (!g && this.hasPopupData && this._createPopup(), this.container.classList.add("squigglyAnnotation"), I) {
      const C = document.createElement("u");
      C.classList.add("overlaidText"), C.textContent = I, this.container.append(C);
    }
    return this.container;
  }
}
class $d extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0,
      createQuadrilaterals: !0
    });
  }
  render() {
    const {
      data: {
        overlaidText: I,
        popupRef: g
      }
    } = this;
    if (!g && this.hasPopupData && this._createPopup(), this.container.classList.add("strikeoutAnnotation"), I) {
      const C = document.createElement("s");
      C.classList.add("overlaidText"), C.textContent = I, this.container.append(C);
    }
    return this.container;
  }
}
class pl extends $ {
  constructor(I) {
    super(I, {
      isRenderable: !0,
      ignoreBorder: !0
    }), this.annotationEditorType = k.STAMP;
  }
  render() {
    return this.container.classList.add("stampAnnotation"), this.container.setAttribute("role", "img"), !this.data.popupRef && this.hasPopupData && this._createPopup(), this._editOnDoubleClick(), this.container;
  }
}
class IZ extends $ {
  #I = null;
  constructor(I) {
    super(I, {
      isRenderable: !0
    });
    const {
      file: g
    } = this.data;
    this.filename = g.filename, this.content = g.content, this.linkService.eventBus?.dispatch("fileattachmentannotation", {
      source: this,
      ...g
    });
  }
  render() {
    this.container.classList.add("fileAttachmentAnnotation");
    const {
      container: I,
      data: g
    } = this;
    let C;
    g.hasAppearance || g.fillAlpha === 0 ? C = document.createElement("div") : (C = document.createElement("img"), C.src = `${this.imageResourcesPath}annotation-${/paperclip/i.test(g.name) ? "paperclip" : "pushpin"}.svg`, g.fillAlpha && g.fillAlpha < 1 && (C.style = `filter: opacity(${Math.round(g.fillAlpha * 100)}%);`)), C.addEventListener("dblclick", this.#g.bind(this)), this.#I = C;
    const {
      isMac: A
    } = GI.platform;
    return I.addEventListener("keydown", (i) => {
      i.key === "Enter" && (A ? i.metaKey : i.ctrlKey) && this.#g();
    }), !g.popupRef && this.hasPopupData ? this._createPopup() : C.classList.add("popupTriggerArea"), I.append(C), I;
  }
  getElementsToTriggerPopup() {
    return this.#I;
  }
  addHighlightArea() {
    this.container.classList.add("highlightArea");
  }
  #g() {
    this.downloadManager?.openOrDownloadData(this.content, this.filename);
  }
}
let Fl = class zl {
  #I = null;
  #g = null;
  #A = null;
  #C = /* @__PURE__ */ new Map();
  #i = null;
  #l = null;
  constructor({
    div: I,
    accessibilityManager: g,
    annotationCanvasMap: C,
    annotationEditorUIManager: A,
    page: i,
    viewport: l,
    structTreeLayer: s,
    commentManager: d,
    linkService: c,
    annotationStorage: G
  }) {
    this.div = I, this.#I = g, this.#g = C, this.#i = s || null, this.#l = c || null, this.#A = G || new KA(), this.page = i, this.viewport = l, this.zIndex = 0, this._annotationEditorUIManager = A, this._commentManager = d || null;
  }
  hasEditableAnnotations() {
    return this.#C.size > 0;
  }
  async #s(I, g, C) {
    const A = I.firstChild || I, i = A.id = `${yA}${g}`, l = await this.#i?.getAriaAttributes(i);
    if (l)
      for (const [s, d] of l)
        A.setAttribute(s, d);
    C ? C.at(-1).container.after(I) : (this.div.append(I), this.#I?.moveElementInDOM(this.div, I, A, !1));
  }
  async render(I) {
    const {
      annotations: g
    } = I, C = this.div;
    cg(C, this.viewport);
    const A = /* @__PURE__ */ new Map(), i = {
      data: null,
      layer: C,
      linkService: this.#l,
      downloadManager: I.downloadManager,
      imageResourcesPath: I.imageResourcesPath || "",
      renderForms: I.renderForms !== !1,
      svgFactory: new XC(),
      annotationStorage: this.#A,
      enableComment: I.enableComment === !0,
      enableScripting: I.enableScripting === !0,
      hasJSActions: I.hasJSActions,
      fieldObjects: I.fieldObjects,
      parent: this,
      elements: null
    };
    for (const l of g) {
      if (l.noHTML)
        continue;
      const s = l.annotationType === iI.POPUP;
      if (s) {
        const G = A.get(l.id);
        if (!G)
          continue;
        i.elements = G;
      } else if (l.rect[2] === l.rect[0] || l.rect[3] === l.rect[1])
        continue;
      i.data = l;
      const d = wi.create(i);
      if (!d.isRenderable)
        continue;
      if (!s && l.popupRef) {
        const G = A.get(l.popupRef);
        G ? G.push(d) : A.set(l.popupRef, [d]);
      }
      const c = d.render();
      l.hidden && (c.style.visibility = "hidden"), await this.#s(c, l.id, i.elements), d.extraPopupElement?.popup?.renderCommentButton(), d._isEditable && (this.#C.set(d.data.id, d), this._annotationEditorUIManager?.renderAnnotationElement(d));
    }
    this.#d();
  }
  async addLinkAnnotations(I) {
    const g = {
      data: null,
      layer: this.div,
      linkService: this.#l,
      svgFactory: new XC(),
      parent: this
    };
    for (const C of I) {
      C.borderStyle ||= zl._defaultBorderStyle, g.data = C;
      const A = wi.create(g);
      if (!A.isRenderable)
        continue;
      const i = A.render();
      await this.#s(i, C.id, null);
    }
  }
  update({
    viewport: I
  }) {
    const g = this.div;
    this.viewport = I, cg(g, {
      rotation: I.rotation
    }), this.#d(), g.hidden = !1;
  }
  #d() {
    if (!this.#g)
      return;
    const I = this.div;
    for (const [g, C] of this.#g) {
      const A = I.querySelector(`[data-annotation-id="${g}"]`);
      if (!A)
        continue;
      C.className = "annotationContent";
      const {
        firstChild: i
      } = A;
      i ? i.nodeName === "CANVAS" ? i.replaceWith(C) : i.classList.contains("annotationContent") ? i.after(C) : i.before(C) : A.append(C);
      const l = this.#C.get(g);
      l && (l._hasNoCanvas ? (this._annotationEditorUIManager?.setMissingCanvas(g, A.id, C), l._hasNoCanvas = !1) : l.canvas = C);
    }
    this.#g.clear();
  }
  getEditableAnnotations() {
    return Array.from(this.#C.values());
  }
  getEditableAnnotation(I) {
    return this.#C.get(I);
  }
  addFakeAnnotation(I) {
    const {
      div: g
    } = this, {
      id: C,
      rotation: A
    } = I, i = new Ld({
      data: {
        id: C,
        rect: I.getPDFRect(),
        rotation: A
      },
      editor: I,
      layer: g,
      parent: this,
      enableComment: !!this._commentManager,
      linkService: this.#l,
      annotationStorage: this.#A
    }), l = i.render();
    return g.append(l), this.#I?.moveElementInDOM(g, l, l, !1), i.createOrUpdatePopup(), i;
  }
  static get _defaultBorderStyle() {
    return T(this, "_defaultBorderStyle", Object.freeze({
      width: 1,
      rawWidth: 1,
      style: tg.SOLID,
      dashArray: [3],
      horizontalCornerRadius: 0,
      verticalCornerRadius: 0
    }));
  }
};
const mC = /\r\n?|\n/g;
class dI extends F {
  #I = "";
  #g = `${this.id}-editor`;
  #A = null;
  #C;
  _colorPicker = null;
  static _freeTextDefaultContent = "";
  static _internalPadding = 0;
  static _defaultColor = null;
  static _defaultFontSize = 10;
  static get _keyboardManager() {
    const I = dI.prototype, g = (i) => i.isEmpty(), C = Eg.TRANSLATE_SMALL, A = Eg.TRANSLATE_BIG;
    return T(this, "_keyboardManager", new CC([[["ctrl+s", "mac+meta+s", "ctrl+p", "mac+meta+p"], I.commitOrRemove, {
      bubbles: !0
    }], [["ctrl+Enter", "mac+meta+Enter", "Escape", "mac+Escape"], I.commitOrRemove], [["ArrowLeft", "mac+ArrowLeft"], I._translateEmpty, {
      args: [-C, 0],
      checker: g
    }], [["ctrl+ArrowLeft", "mac+shift+ArrowLeft"], I._translateEmpty, {
      args: [-A, 0],
      checker: g
    }], [["ArrowRight", "mac+ArrowRight"], I._translateEmpty, {
      args: [C, 0],
      checker: g
    }], [["ctrl+ArrowRight", "mac+shift+ArrowRight"], I._translateEmpty, {
      args: [A, 0],
      checker: g
    }], [["ArrowUp", "mac+ArrowUp"], I._translateEmpty, {
      args: [0, -C],
      checker: g
    }], [["ctrl+ArrowUp", "mac+shift+ArrowUp"], I._translateEmpty, {
      args: [0, -A],
      checker: g
    }], [["ArrowDown", "mac+ArrowDown"], I._translateEmpty, {
      args: [0, C],
      checker: g
    }], [["ctrl+ArrowDown", "mac+shift+ArrowDown"], I._translateEmpty, {
      args: [0, A],
      checker: g
    }]]));
  }
  static _type = "freetext";
  static _editorType = k.FREETEXT;
  constructor(I) {
    super({
      ...I,
      name: "freeTextEditor"
    }), this.color = I.color || dI._defaultColor || F._defaultLineColor, this.#C = I.fontSize || dI._defaultFontSize, this.annotationElementId || this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert");
  }
  static initialize(I, g) {
    F.initialize(I, g);
    const C = getComputedStyle(document.documentElement);
    this._internalPadding = parseFloat(C.getPropertyValue("--freetext-padding"));
  }
  static updateDefaultParams(I, g) {
    switch (I) {
      case j.FREETEXT_SIZE:
        dI._defaultFontSize = g;
        break;
      case j.FREETEXT_COLOR:
        dI._defaultColor = g;
        break;
    }
  }
  updateParams(I, g) {
    switch (I) {
      case j.FREETEXT_SIZE:
        this.#i(g);
        break;
      case j.FREETEXT_COLOR:
        this.#l(g);
        break;
    }
  }
  static get defaultPropertiesToUpdate() {
    return [[j.FREETEXT_SIZE, dI._defaultFontSize], [j.FREETEXT_COLOR, dI._defaultColor || F._defaultLineColor]];
  }
  get propertiesToUpdate() {
    return [[j.FREETEXT_SIZE, this.#C], [j.FREETEXT_COLOR, this.color]];
  }
  get toolbarButtons() {
    return this._colorPicker ||= new Pg(this), [["colorPicker", this._colorPicker]];
  }
  get colorType() {
    return j.FREETEXT_COLOR;
  }
  #i(I) {
    const g = (A) => {
      this.editorDiv.style.fontSize = `calc(${A}px * var(--total-scale-factor))`, this.translate(0, -(A - this.#C) * this.parentScale), this.#C = A, this.#d();
    }, C = this.#C;
    this.addCommands({
      cmd: g.bind(this, I),
      undo: g.bind(this, C),
      post: this._uiManager.updateUI.bind(this._uiManager, this),
      mustExec: !0,
      type: j.FREETEXT_SIZE,
      overwriteIfSameType: !0,
      keepUndo: !0
    });
  }
  onUpdatedColor() {
    this.editorDiv.style.color = this.color, this._colorPicker?.update(this.color), super.onUpdatedColor();
  }
  #l(I) {
    const g = (A) => {
      this.color = A, this.onUpdatedColor();
    }, C = this.color;
    this.addCommands({
      cmd: g.bind(this, I),
      undo: g.bind(this, C),
      post: this._uiManager.updateUI.bind(this._uiManager, this),
      mustExec: !0,
      type: j.FREETEXT_COLOR,
      overwriteIfSameType: !0,
      keepUndo: !0
    });
  }
  _translateEmpty(I, g) {
    this._uiManager.translateSelectedEditors(I, g, !0);
  }
  getInitialTranslation() {
    const I = this.parentScale;
    return [-dI._internalPadding * I, -(dI._internalPadding + this.#C) * I];
  }
  rebuild() {
    this.parent && (super.rebuild(), this.div !== null && (this.isAttachedToDOM || this.parent.add(this)));
  }
  enableEditMode() {
    if (!super.enableEditMode())
      return !1;
    this.overlayDiv.classList.remove("enabled"), this.editorDiv.contentEditable = !0, this._isDraggable = !1, this.div.removeAttribute("aria-activedescendant"), this.#A = new AbortController();
    const I = this._uiManager.combinedSignal(this.#A);
    return this.editorDiv.addEventListener("keydown", this.editorDivKeydown.bind(this), {
      signal: I
    }), this.editorDiv.addEventListener("focus", this.editorDivFocus.bind(this), {
      signal: I
    }), this.editorDiv.addEventListener("blur", this.editorDivBlur.bind(this), {
      signal: I
    }), this.editorDiv.addEventListener("input", this.editorDivInput.bind(this), {
      signal: I
    }), this.editorDiv.addEventListener("paste", this.editorDivPaste.bind(this), {
      signal: I
    }), !0;
  }
  disableEditMode() {
    return super.disableEditMode() ? (this.overlayDiv.classList.add("enabled"), this.editorDiv.contentEditable = !1, this.div.setAttribute("aria-activedescendant", this.#g), this._isDraggable = !0, this.#A?.abort(), this.#A = null, this.div.focus({
      preventScroll: !0
    }), this.isEditing = !1, this.parent.div.classList.add("freetextEditing"), !0) : !1;
  }
  focusin(I) {
    this._focusEventsAllowed && (super.focusin(I), I.target !== this.editorDiv && this.editorDiv.focus());
  }
  onceAdded(I) {
    this.width || (this.enableEditMode(), I && this.editorDiv.focus(), this._initialOptions?.isCentered && this.center(), this._initialOptions = null);
  }
  isEmpty() {
    return !this.editorDiv || this.editorDiv.innerText.trim() === "";
  }
  remove() {
    this.isEditing = !1, this.parent && (this.parent.setEditingState(!0), this.parent.div.classList.add("freetextEditing")), super.remove();
  }
  #s() {
    const I = [];
    this.editorDiv.normalize();
    let g = null;
    for (const C of this.editorDiv.childNodes)
      g?.nodeType === Node.TEXT_NODE && C.nodeName === "BR" || (I.push(dI.#c(C)), g = C);
    return I.join(`
`);
  }
  #d() {
    const [I, g] = this.parentDimensions;
    let C;
    if (this.isAttachedToDOM)
      C = this.div.getBoundingClientRect();
    else {
      const {
        currentLayer: A,
        div: i
      } = this, l = i.style.display, s = i.classList.contains("hidden");
      i.classList.remove("hidden"), i.style.display = "hidden", A.div.append(this.div), C = i.getBoundingClientRect(), i.remove(), i.style.display = l, i.classList.toggle("hidden", s);
    }
    this.rotation % 180 === this.parentRotation % 180 ? (this.width = C.width / I, this.height = C.height / g) : (this.width = C.height / I, this.height = C.width / g), this.fixAndSetPosition();
  }
  commit() {
    if (!this.isInEditMode())
      return;
    super.commit(), this.disableEditMode();
    const I = this.#I, g = this.#I = this.#s().trimEnd();
    if (I === g)
      return;
    const C = (A) => {
      if (this.#I = A, !A) {
        this.remove();
        return;
      }
      this.#Z(), this._uiManager.rebuild(this), this.#d();
    };
    this.addCommands({
      cmd: () => {
        C(g);
      },
      undo: () => {
        C(I);
      },
      mustExec: !1
    }), this.#d();
  }
  shouldGetKeyboardEvents() {
    return this.isInEditMode();
  }
  enterInEditMode() {
    this.enableEditMode(), this.editorDiv.focus();
  }
  keydown(I) {
    I.target === this.div && I.key === "Enter" && (this.enterInEditMode(), I.preventDefault());
  }
  editorDivKeydown(I) {
    dI._keyboardManager.exec(this, I);
  }
  editorDivFocus(I) {
    this.isEditing = !0;
  }
  editorDivBlur(I) {
    this.isEditing = !1;
  }
  editorDivInput(I) {
    this.parent.div.classList.toggle("freetextEditing", this.isEmpty());
  }
  disableEditing() {
    this.editorDiv.setAttribute("role", "comment"), this.editorDiv.removeAttribute("aria-multiline");
  }
  enableEditing() {
    this.editorDiv.setAttribute("role", "textbox"), this.editorDiv.setAttribute("aria-multiline", !0);
  }
  get canChangeContent() {
    return !0;
  }
  render() {
    if (this.div)
      return this.div;
    let I, g;
    (this._isCopy || this.annotationElementId) && (I = this.x, g = this.y), super.render(), this.editorDiv = document.createElement("div"), this.editorDiv.className = "internal", this.editorDiv.setAttribute("id", this.#g), this.editorDiv.setAttribute("data-l10n-id", "pdfjs-free-text2"), this.editorDiv.setAttribute("data-l10n-attrs", "default-content"), this.enableEditing(), this.editorDiv.contentEditable = !0;
    const {
      style: C
    } = this.editorDiv;
    if (C.fontSize = `calc(${this.#C}px * var(--total-scale-factor))`, C.color = this.color, this.div.append(this.editorDiv), this.overlayDiv = document.createElement("div"), this.overlayDiv.classList.add("overlay", "enabled"), this.div.append(this.overlayDiv), this._isCopy || this.annotationElementId) {
      const [A, i] = this.parentDimensions;
      if (this.annotationElementId) {
        const {
          position: l
        } = this._initialData;
        let [s, d] = this.getInitialTranslation();
        [s, d] = this.pageTranslationToScreen(s, d);
        const [c, G] = this.pageDimensions, [b, o] = this.pageTranslation;
        let m, e;
        switch (this.rotation) {
          case 0:
            m = I + (l[0] - b) / c, e = g + this.height - (l[1] - o) / G;
            break;
          case 90:
            m = I + (l[0] - b) / c, e = g - (l[1] - o) / G, [s, d] = [d, -s];
            break;
          case 180:
            m = I - this.width + (l[0] - b) / c, e = g - (l[1] - o) / G, [s, d] = [-s, -d];
            break;
          case 270:
            m = I + (l[0] - b - this.height * G) / c, e = g + (l[1] - o - this.width * c) / G, [s, d] = [-d, s];
            break;
        }
        this.setAt(m * A, e * i, s, d);
      } else
        this._moveAfterPaste(I, g);
      this.#Z(), this._isDraggable = !0, this.editorDiv.contentEditable = !1;
    } else
      this._isDraggable = !1, this.editorDiv.contentEditable = !0;
    return this.div;
  }
  static #c(I) {
    return (I.nodeType === Node.TEXT_NODE ? I.nodeValue : I.innerText).replaceAll(mC, "");
  }
  editorDivPaste(I) {
    const g = I.clipboardData || window.clipboardData, {
      types: C
    } = g;
    if (C.length === 1 && C[0] === "text/plain")
      return;
    I.preventDefault();
    const A = dI.#b(g.getData("text") || "").replaceAll(mC, `
`);
    if (!A)
      return;
    const i = window.getSelection();
    if (!i.rangeCount)
      return;
    this.editorDiv.normalize(), i.deleteFromDocument();
    const l = i.getRangeAt(0);
    if (!A.includes(`
`)) {
      l.insertNode(document.createTextNode(A)), this.editorDiv.normalize(), i.collapseToStart();
      return;
    }
    const {
      startContainer: s,
      startOffset: d
    } = l, c = [], G = [];
    if (s.nodeType === Node.TEXT_NODE) {
      const m = s.parentElement;
      if (G.push(s.nodeValue.slice(d).replaceAll(mC, "")), m !== this.editorDiv) {
        let e = c;
        for (const a of this.editorDiv.childNodes) {
          if (a === m) {
            e = G;
            continue;
          }
          e.push(dI.#c(a));
        }
      }
      c.push(s.nodeValue.slice(0, d).replaceAll(mC, ""));
    } else if (s === this.editorDiv) {
      let m = c, e = 0;
      for (const a of this.editorDiv.childNodes)
        e++ === d && (m = G), m.push(dI.#c(a));
    }
    this.#I = `${c.join(`
`)}${A}${G.join(`
`)}`, this.#Z();
    const b = new Range();
    let o = Math.sumPrecise(c.map((m) => m.length));
    for (const {
      firstChild: m
    } of this.editorDiv.childNodes)
      if (m.nodeType === Node.TEXT_NODE) {
        const e = m.nodeValue.length;
        if (o <= e) {
          b.setStart(m, o), b.setEnd(m, o);
          break;
        }
        o -= e;
      }
    i.removeAllRanges(), i.addRange(b);
  }
  #Z() {
    if (this.editorDiv.replaceChildren(), !!this.#I)
      for (const I of this.#I.split(`
`)) {
        const g = document.createElement("div");
        g.append(I ? document.createTextNode(I) : document.createElement("br")), this.editorDiv.append(g);
      }
  }
  #o() {
    return this.#I.replaceAll(" ", " ");
  }
  static #b(I) {
    return I.replaceAll(" ", " ");
  }
  get contentDiv() {
    return this.editorDiv;
  }
  getPDFRect() {
    const I = dI._internalPadding * this.parentScale;
    return this.getRect(I, I);
  }
  static async deserialize(I, g, C) {
    let A = null;
    if (I instanceof Dl) {
      const {
        data: {
          defaultAppearanceData: {
            fontSize: l,
            fontColor: s
          },
          rect: d,
          rotation: c,
          id: G,
          popupRef: b,
          richText: o,
          contentsObj: m,
          creationDate: e,
          modificationDate: a
        },
        textContent: h,
        textPosition: t,
        parent: {
          page: {
            pageNumber: W
          }
        }
      } = I;
      if (!h || h.length === 0)
        return null;
      A = I = {
        annotationType: k.FREETEXT,
        color: Array.from(s),
        fontSize: l,
        value: h.join(`
`),
        position: t,
        pageIndex: W - 1,
        rect: d.slice(0),
        rotation: c,
        annotationElementId: G,
        id: G,
        deleted: !1,
        popupRef: b,
        comment: m?.str || null,
        richText: o,
        creationDate: e,
        modificationDate: a
      };
    }
    const i = await super.deserialize(I, g, C);
    return i.#C = I.fontSize, i.color = M.makeHexColor(...I.color), i.#I = dI.#b(I.value), i._initialData = A, I.comment && i.setCommentData(I), i;
  }
  serialize(I = !1) {
    if (this.isEmpty())
      return null;
    if (this.deleted)
      return this.serializeDeleted();
    const g = F._colorManager.convert(this.isAttachedToDOM ? getComputedStyle(this.editorDiv).color : this.color), C = Object.assign(super.serialize(I), {
      color: g,
      fontSize: this.#C,
      value: this.#o()
    });
    return this.addComment(C), I ? (C.isCopy = !0, C) : this.annotationElementId && !this.#m(C) ? null : (C.id = this.annotationElementId, C);
  }
  #m(I) {
    const {
      value: g,
      fontSize: C,
      color: A,
      pageIndex: i
    } = this._initialData;
    return this.hasEditedComment || this._hasBeenMoved || I.value !== g || I.fontSize !== C || I.color.some((l, s) => l !== A[s]) || I.pageIndex !== i;
  }
  renderAnnotationElement(I) {
    const g = super.renderAnnotationElement(I);
    if (!g)
      return null;
    const {
      style: C
    } = g;
    C.fontSize = `calc(${this.#C}px * var(--total-scale-factor))`, C.color = this.color, g.replaceChildren();
    for (const A of this.#I.split(`
`)) {
      const i = document.createElement("div");
      i.append(A ? document.createTextNode(A) : document.createElement("br")), g.append(i);
    }
    return I.updateEdited({
      rect: this.getPDFRect(),
      popup: this._uiManager.hasCommentManager() || this.hasEditedComment ? this.comment : {
        text: this.#I
      }
    }), g;
  }
  resetAnnotationElement(I) {
    super.resetAnnotationElement(I), I.resetEdited();
  }
}
class H {
  static PRECISION = 1e-4;
  toSVGPath() {
    f("Abstract method `toSVGPath` must be implemented.");
  }
  get box() {
    f("Abstract getter `box` must be implemented.");
  }
  serialize(I, g) {
    f("Abstract method `serialize` must be implemented.");
  }
  static _rescale(I, g, C, A, i, l) {
    l ||= new Float32Array(I.length);
    for (let s = 0, d = I.length; s < d; s += 2)
      l[s] = g + I[s] * A, l[s + 1] = C + I[s + 1] * i;
    return l;
  }
  static _rescaleAndSwap(I, g, C, A, i, l) {
    l ||= new Float32Array(I.length);
    for (let s = 0, d = I.length; s < d; s += 2)
      l[s] = g + I[s + 1] * A, l[s + 1] = C + I[s] * i;
    return l;
  }
  static _translate(I, g, C, A) {
    A ||= new Float32Array(I.length);
    for (let i = 0, l = I.length; i < l; i += 2)
      A[i] = g + I[i], A[i + 1] = C + I[i + 1];
    return A;
  }
  static svgRound(I) {
    return Math.round(I * 1e4);
  }
  static _normalizePoint(I, g, C, A, i) {
    switch (i) {
      case 90:
        return [1 - g / C, I / A];
      case 180:
        return [1 - I / C, 1 - g / A];
      case 270:
        return [g / C, 1 - I / A];
      default:
        return [I / C, g / A];
    }
  }
  static _normalizePagePoint(I, g, C) {
    switch (C) {
      case 90:
        return [1 - g, I];
      case 180:
        return [1 - I, 1 - g];
      case 270:
        return [g, 1 - I];
      default:
        return [I, g];
    }
  }
  static createBezierPoints(I, g, C, A, i, l) {
    return [(I + 5 * C) / 6, (g + 5 * A) / 6, (5 * C + i) / 6, (5 * A + l) / 6, (C + i) / 2, (A + l) / 2];
  }
}
class lg {
  #I;
  #g = [];
  #A;
  #C;
  #i = [];
  #l = new Float32Array(18);
  #s;
  #d;
  #c;
  #Z;
  #o;
  #b;
  #m = [];
  static #t = 8;
  static #a = 2;
  static #G = lg.#t + lg.#a;
  constructor({
    x: I,
    y: g
  }, C, A, i, l, s = 0) {
    this.#I = C, this.#b = i * A, this.#C = l, this.#l.set([NaN, NaN, NaN, NaN, I, g], 6), this.#A = s, this.#Z = lg.#t * A, this.#c = lg.#G * A, this.#o = A, this.#m.push(I, g);
  }
  isEmpty() {
    return isNaN(this.#l[8]);
  }
  #e() {
    const I = this.#l.subarray(4, 6), g = this.#l.subarray(16, 18), [C, A, i, l] = this.#I;
    return [(this.#s + (I[0] - g[0]) / 2 - C) / i, (this.#d + (I[1] - g[1]) / 2 - A) / l, (this.#s + (g[0] - I[0]) / 2 - C) / i, (this.#d + (g[1] - I[1]) / 2 - A) / l];
  }
  add({
    x: I,
    y: g
  }) {
    this.#s = I, this.#d = g;
    const [C, A, i, l] = this.#I;
    let [s, d, c, G] = this.#l.subarray(8, 12);
    const b = I - c, o = g - G, m = Math.hypot(b, o);
    if (m < this.#c)
      return !1;
    const e = m - this.#Z, a = e / m, h = a * b, t = a * o;
    let W = s, B = d;
    s = c, d = G, c += h, G += t, this.#m?.push(I, g);
    const w = -t / e, n = h / e, V = w * this.#b, N = n * this.#b;
    return this.#l.set(this.#l.subarray(2, 8), 0), this.#l.set([c + V, G + N], 4), this.#l.set(this.#l.subarray(14, 18), 12), this.#l.set([c - V, G - N], 16), isNaN(this.#l[6]) ? (this.#i.length === 0 && (this.#l.set([s + V, d + N], 2), this.#i.push(NaN, NaN, NaN, NaN, (s + V - C) / i, (d + N - A) / l), this.#l.set([s - V, d - N], 14), this.#g.push(NaN, NaN, NaN, NaN, (s - V - C) / i, (d - N - A) / l)), this.#l.set([W, B, s, d, c, G], 6), !this.isEmpty()) : (this.#l.set([W, B, s, d, c, G], 6), Math.abs(Math.atan2(B - d, W - s) - Math.atan2(t, h)) < Math.PI / 2 ? ([s, d, c, G] = this.#l.subarray(2, 6), this.#i.push(NaN, NaN, NaN, NaN, ((s + c) / 2 - C) / i, ((d + G) / 2 - A) / l), [s, d, W, B] = this.#l.subarray(14, 18), this.#g.push(NaN, NaN, NaN, NaN, ((W + s) / 2 - C) / i, ((B + d) / 2 - A) / l), !0) : ([W, B, s, d, c, G] = this.#l.subarray(0, 6), this.#i.push(((W + 5 * s) / 6 - C) / i, ((B + 5 * d) / 6 - A) / l, ((5 * s + c) / 6 - C) / i, ((5 * d + G) / 6 - A) / l, ((s + c) / 2 - C) / i, ((d + G) / 2 - A) / l), [c, G, s, d, W, B] = this.#l.subarray(12, 18), this.#g.push(((W + 5 * s) / 6 - C) / i, ((B + 5 * d) / 6 - A) / l, ((5 * s + c) / 6 - C) / i, ((5 * d + G) / 6 - A) / l, ((s + c) / 2 - C) / i, ((d + G) / 2 - A) / l), !0));
  }
  toSVGPath() {
    if (this.isEmpty())
      return "";
    const I = this.#i, g = this.#g;
    if (isNaN(this.#l[6]) && !this.isEmpty())
      return this.#B();
    const C = [];
    C.push(`M${I[4]} ${I[5]}`);
    for (let A = 6; A < I.length; A += 6)
      isNaN(I[A]) ? C.push(`L${I[A + 4]} ${I[A + 5]}`) : C.push(`C${I[A]} ${I[A + 1]} ${I[A + 2]} ${I[A + 3]} ${I[A + 4]} ${I[A + 5]}`);
    this.#h(C);
    for (let A = g.length - 6; A >= 6; A -= 6)
      isNaN(g[A]) ? C.push(`L${g[A + 4]} ${g[A + 5]}`) : C.push(`C${g[A]} ${g[A + 1]} ${g[A + 2]} ${g[A + 3]} ${g[A + 4]} ${g[A + 5]}`);
    return this.#W(C), C.join(" ");
  }
  #B() {
    const [I, g, C, A] = this.#I, [i, l, s, d] = this.#e();
    return `M${(this.#l[2] - I) / C} ${(this.#l[3] - g) / A} L${(this.#l[4] - I) / C} ${(this.#l[5] - g) / A} L${i} ${l} L${s} ${d} L${(this.#l[16] - I) / C} ${(this.#l[17] - g) / A} L${(this.#l[14] - I) / C} ${(this.#l[15] - g) / A} Z`;
  }
  #W(I) {
    const g = this.#g;
    I.push(`L${g[4]} ${g[5]} Z`);
  }
  #h(I) {
    const [g, C, A, i] = this.#I, l = this.#l.subarray(4, 6), s = this.#l.subarray(16, 18), [d, c, G, b] = this.#e();
    I.push(`L${(l[0] - g) / A} ${(l[1] - C) / i} L${d} ${c} L${G} ${b} L${(s[0] - g) / A} ${(s[1] - C) / i}`);
  }
  newFreeDrawOutline(I, g, C, A, i, l) {
    return new Jl(I, g, C, A, i, l);
  }
  getOutlines() {
    const I = this.#i, g = this.#g, C = this.#l, [A, i, l, s] = this.#I, d = new Float32Array((this.#m?.length ?? 0) + 2);
    for (let b = 0, o = d.length - 2; b < o; b += 2)
      d[b] = (this.#m[b] - A) / l, d[b + 1] = (this.#m[b + 1] - i) / s;
    if (d[d.length - 2] = (this.#s - A) / l, d[d.length - 1] = (this.#d - i) / s, isNaN(C[6]) && !this.isEmpty())
      return this.#N(d);
    const c = new Float32Array(this.#i.length + 24 + this.#g.length);
    let G = I.length;
    for (let b = 0; b < G; b += 2) {
      if (isNaN(I[b])) {
        c[b] = c[b + 1] = NaN;
        continue;
      }
      c[b] = I[b], c[b + 1] = I[b + 1];
    }
    G = this.#n(c, G);
    for (let b = g.length - 6; b >= 6; b -= 6)
      for (let o = 0; o < 6; o += 2) {
        if (isNaN(g[b + o])) {
          c[G] = c[G + 1] = NaN, G += 2;
          continue;
        }
        c[G] = g[b + o], c[G + 1] = g[b + o + 1], G += 2;
      }
    return this.#w(c, G), this.newFreeDrawOutline(c, d, this.#I, this.#o, this.#A, this.#C);
  }
  #N(I) {
    const g = this.#l, [C, A, i, l] = this.#I, [s, d, c, G] = this.#e(), b = new Float32Array(36);
    return b.set([NaN, NaN, NaN, NaN, (g[2] - C) / i, (g[3] - A) / l, NaN, NaN, NaN, NaN, (g[4] - C) / i, (g[5] - A) / l, NaN, NaN, NaN, NaN, s, d, NaN, NaN, NaN, NaN, c, G, NaN, NaN, NaN, NaN, (g[16] - C) / i, (g[17] - A) / l, NaN, NaN, NaN, NaN, (g[14] - C) / i, (g[15] - A) / l], 0), this.newFreeDrawOutline(b, I, this.#I, this.#o, this.#A, this.#C);
  }
  #w(I, g) {
    const C = this.#g;
    return I.set([NaN, NaN, NaN, NaN, C[4], C[5]], g), g += 6;
  }
  #n(I, g) {
    const C = this.#l.subarray(4, 6), A = this.#l.subarray(16, 18), [i, l, s, d] = this.#I, [c, G, b, o] = this.#e();
    return I.set([NaN, NaN, NaN, NaN, (C[0] - i) / s, (C[1] - l) / d, NaN, NaN, NaN, NaN, c, G, NaN, NaN, NaN, NaN, b, o, NaN, NaN, NaN, NaN, (A[0] - i) / s, (A[1] - l) / d], g), g += 24;
  }
}
class Jl extends H {
  #I;
  #g = new Float32Array(4);
  #A;
  #C;
  #i;
  #l;
  #s;
  constructor(I, g, C, A, i, l) {
    super(), this.#s = I, this.#i = g, this.#I = C, this.#l = A, this.#A = i, this.#C = l, this.firstPoint = [NaN, NaN], this.lastPoint = [NaN, NaN], this.#d(l);
    const [s, d, c, G] = this.#g;
    for (let b = 0, o = I.length; b < o; b += 2)
      I[b] = (I[b] - s) / c, I[b + 1] = (I[b + 1] - d) / G;
    for (let b = 0, o = g.length; b < o; b += 2)
      g[b] = (g[b] - s) / c, g[b + 1] = (g[b + 1] - d) / G;
  }
  toSVGPath() {
    const I = [`M${this.#s[4]} ${this.#s[5]}`];
    for (let g = 6, C = this.#s.length; g < C; g += 6) {
      if (isNaN(this.#s[g])) {
        I.push(`L${this.#s[g + 4]} ${this.#s[g + 5]}`);
        continue;
      }
      I.push(`C${this.#s[g]} ${this.#s[g + 1]} ${this.#s[g + 2]} ${this.#s[g + 3]} ${this.#s[g + 4]} ${this.#s[g + 5]}`);
    }
    return I.push("Z"), I.join(" ");
  }
  serialize([I, g, C, A], i) {
    const l = C - I, s = A - g;
    let d, c;
    switch (i) {
      case 0:
        d = H._rescale(this.#s, I, A, l, -s), c = H._rescale(this.#i, I, A, l, -s);
        break;
      case 90:
        d = H._rescaleAndSwap(this.#s, I, g, l, s), c = H._rescaleAndSwap(this.#i, I, g, l, s);
        break;
      case 180:
        d = H._rescale(this.#s, C, g, -l, s), c = H._rescale(this.#i, C, g, -l, s);
        break;
      case 270:
        d = H._rescaleAndSwap(this.#s, C, A, -l, -s), c = H._rescaleAndSwap(this.#i, C, A, -l, -s);
        break;
    }
    return {
      outline: Array.from(d),
      points: [Array.from(c)]
    };
  }
  #d(I) {
    const g = this.#s;
    let C = g[4], A = g[5];
    const i = [C, A, C, A];
    let l = C, s = A, d = C, c = A;
    const G = I ? Math.max : Math.min, b = new Float32Array(4);
    for (let m = 6, e = g.length; m < e; m += 6) {
      const a = g[m + 4], h = g[m + 5];
      isNaN(g[m]) ? (M.pointBoundingBox(a, h, i), s > h ? (l = a, s = h) : s === h && (l = G(l, a)), c < h ? (d = a, c = h) : c === h && (d = G(d, a))) : (b[0] = b[1] = 1 / 0, b[2] = b[3] = -1 / 0, M.bezierBoundingBox(C, A, ...g.slice(m, m + 6), b), M.rectBoundingBox(b[0], b[1], b[2], b[3], i), s > b[1] ? (l = b[0], s = b[1]) : s === b[1] && (l = G(l, b[0])), c < b[3] ? (d = b[2], c = b[3]) : c === b[3] && (d = G(d, b[2]))), C = a, A = h;
    }
    const o = this.#g;
    o[0] = i[0] - this.#A, o[1] = i[1] - this.#A, o[2] = i[2] - i[0] + 2 * this.#A, o[3] = i[3] - i[1] + 2 * this.#A, this.firstPoint = [l, s], this.lastPoint = [d, c];
  }
  get box() {
    return this.#g;
  }
  newOutliner(I, g, C, A, i, l = 0) {
    return new lg(I, g, C, A, i, l);
  }
  getNewOutline(I, g) {
    const [C, A, i, l] = this.#g, [s, d, c, G] = this.#I, b = i * c, o = l * G, m = C * c + s, e = A * G + d, a = this.newOutliner({
      x: this.#i[0] * b + m,
      y: this.#i[1] * o + e
    }, this.#I, this.#l, I, this.#C, g ?? this.#A);
    for (let h = 2; h < this.#i.length; h += 2)
      a.add({
        x: this.#i[h] * b + m,
        y: this.#i[h + 1] * o + e
      });
    return a.getOutlines();
  }
}
class hA {
  #I;
  #g;
  #A;
  #C = [];
  #i = [];
  constructor(I, g = 0, C = 0, A = !0) {
    const i = [1 / 0, 1 / 0, -1 / 0, -1 / 0], l = 10 ** -4;
    for (const {
      x: a,
      y: h,
      width: t,
      height: W
    } of I) {
      const B = Math.floor((a - g) / l) * l, w = Math.ceil((a + t + g) / l) * l, n = Math.floor((h - g) / l) * l, V = Math.ceil((h + W + g) / l) * l, N = [B, n, V, !0], R = [w, n, V, !1];
      this.#C.push(N, R), M.rectBoundingBox(B, n, w, V, i);
    }
    const s = i[2] - i[0] + 2 * C, d = i[3] - i[1] + 2 * C, c = i[0] - C, G = i[1] - C;
    let b = A ? -1 / 0 : 1 / 0, o = 1 / 0;
    const m = this.#C.at(A ? -1 : -2), e = [m[0], m[2]];
    for (const a of this.#C) {
      const [h, t, W, B] = a;
      !B && A ? t < o ? (o = t, b = h) : t === o && (b = Math.max(b, h)) : B && !A && (t < o ? (o = t, b = h) : t === o && (b = Math.min(b, h))), a[0] = (h - c) / s, a[1] = (t - G) / d, a[2] = (W - G) / d;
    }
    this.#I = new Float32Array([c, G, s, d]), this.#g = [b, o], this.#A = e;
  }
  getOutlines() {
    this.#C.sort((g, C) => g[0] - C[0] || g[1] - C[1] || g[2] - C[2]);
    const I = [];
    for (const g of this.#C)
      g[3] ? (I.push(...this.#Z(g)), this.#d(g)) : (this.#c(g), I.push(...this.#Z(g)));
    return this.#l(I);
  }
  #l(I) {
    const g = [], C = /* @__PURE__ */ new Set();
    for (const l of I) {
      const [s, d, c] = l;
      g.push([s, d, l], [s, c, l]);
    }
    g.sort((l, s) => l[1] - s[1] || l[0] - s[0]);
    for (let l = 0, s = g.length; l < s; l += 2) {
      const d = g[l][2], c = g[l + 1][2];
      d.push(c), c.push(d), C.add(d), C.add(c);
    }
    const A = [];
    let i;
    for (; C.size > 0; ) {
      const l = C.values().next().value;
      let [s, d, c, G, b] = l;
      C.delete(l);
      let o = s, m = d;
      for (i = [s, c], A.push(i); ; ) {
        let e;
        if (C.has(G))
          e = G;
        else if (C.has(b))
          e = b;
        else
          break;
        C.delete(e), [s, d, c, G, b] = e, o !== s && (i.push(o, m, s, m === d ? d : c), o = s), m = m === d ? c : d;
      }
      i.push(o, m);
    }
    return new gZ(A, this.#I, this.#g, this.#A);
  }
  #s(I) {
    const g = this.#i;
    let C = 0, A = g.length - 1;
    for (; C <= A; ) {
      const i = C + A >> 1, l = g[i][0];
      if (l === I)
        return i;
      l < I ? C = i + 1 : A = i - 1;
    }
    return A + 1;
  }
  #d([, I, g]) {
    const C = this.#s(I);
    this.#i.splice(C, 0, [I, g]);
  }
  #c([, I, g]) {
    const C = this.#s(I);
    for (let A = C; A < this.#i.length; A++) {
      const [i, l] = this.#i[A];
      if (i !== I)
        break;
      if (i === I && l === g) {
        this.#i.splice(A, 1);
        return;
      }
    }
    for (let A = C - 1; A >= 0; A--) {
      const [i, l] = this.#i[A];
      if (i !== I)
        break;
      if (i === I && l === g) {
        this.#i.splice(A, 1);
        return;
      }
    }
  }
  #Z(I) {
    const [g, C, A] = I, i = [[g, C, A]], l = this.#s(A);
    for (let s = 0; s < l; s++) {
      const [d, c] = this.#i[s];
      for (let G = 0, b = i.length; G < b; G++) {
        const [, o, m] = i[G];
        if (!(c <= o || m <= d)) {
          if (o >= d) {
            if (m > c)
              i[G][1] = c;
            else {
              if (b === 1)
                return [];
              i.splice(G, 1), G--, b--;
            }
            continue;
          }
          i[G][2] = d, m > c && i.push([g, c, m]);
        }
      }
    }
    return i;
  }
}
class gZ extends H {
  #I;
  #g;
  constructor(I, g, C, A) {
    super(), this.#g = I, this.#I = g, this.firstPoint = C, this.lastPoint = A;
  }
  toSVGPath() {
    const I = [];
    for (const g of this.#g) {
      let [C, A] = g;
      I.push(`M${C} ${A}`);
      for (let i = 2; i < g.length; i += 2) {
        const l = g[i], s = g[i + 1];
        l === C ? (I.push(`V${s}`), A = s) : s === A && (I.push(`H${l}`), C = l);
      }
      I.push("Z");
    }
    return I.join(" ");
  }
  serialize([I, g, C, A], i) {
    const l = [], s = C - I, d = A - g;
    for (const c of this.#g) {
      const G = new Array(c.length);
      for (let b = 0; b < c.length; b += 2)
        G[b] = I + c[b] * s, G[b + 1] = A - c[b + 1] * d;
      l.push(G);
    }
    return l;
  }
  get box() {
    return this.#I;
  }
  get classNamesForOutlining() {
    return ["highlightOutline"];
  }
}
class BA extends lg {
  newFreeDrawOutline(I, g, C, A, i, l) {
    return new CZ(I, g, C, A, i, l);
  }
}
class CZ extends Jl {
  newOutliner(I, g, C, A, i, l = 0) {
    return new BA(I, g, C, A, i, l);
  }
}
class gI extends F {
  #I = null;
  #g = 0;
  #A;
  #C = null;
  #i = null;
  #l = null;
  #s = null;
  #d = 0;
  #c = null;
  #Z = null;
  #o = null;
  #b = !1;
  #m = null;
  #t = null;
  #a = null;
  #G = "";
  #e;
  #B = "";
  static _defaultColor = null;
  static _defaultOpacity = 1;
  static _defaultThickness = 12;
  static _type = "highlight";
  static _editorType = k.HIGHLIGHT;
  static _freeHighlightId = -1;
  static _freeHighlight = null;
  static _freeHighlightClipId = "";
  static get _keyboardManager() {
    const I = gI.prototype;
    return T(this, "_keyboardManager", new CC([[["ArrowLeft", "mac+ArrowLeft"], I._moveCaret, {
      args: [0]
    }], [["ArrowRight", "mac+ArrowRight"], I._moveCaret, {
      args: [1]
    }], [["ArrowUp", "mac+ArrowUp"], I._moveCaret, {
      args: [2]
    }], [["ArrowDown", "mac+ArrowDown"], I._moveCaret, {
      args: [3]
    }]]));
  }
  constructor(I) {
    super({
      ...I,
      name: "highlightEditor"
    }), this.color = I.color || gI._defaultColor, this.#e = I.thickness || gI._defaultThickness, this.opacity = I.opacity || gI._defaultOpacity, this.#A = I.boxes || null, this.#B = I.methodOfCreation || "", this.#G = I.text || "", this._isDraggable = !1, this.defaultL10nId = "pdfjs-editor-highlight-editor", I.highlightId > -1 ? (this.#b = !0, this.#h(I), this.#Y()) : this.#A && (this.#I = I.anchorNode, this.#g = I.anchorOffset, this.#s = I.focusNode, this.#d = I.focusOffset, this.#W(), this.#Y(), this.rotate(this.rotation)), this.annotationElementId || this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert");
  }
  get telemetryInitialData() {
    return {
      action: "added",
      type: this.#b ? "free_highlight" : "highlight",
      color: this._uiManager.getNonHCMColorName(this.color),
      thickness: this.#e,
      methodOfCreation: this.#B
    };
  }
  get telemetryFinalData() {
    return {
      type: "highlight",
      color: this._uiManager.getNonHCMColorName(this.color)
    };
  }
  static computeTelemetryFinalData(I) {
    return {
      numberOfColors: I.get("color").size
    };
  }
  #W() {
    const I = new hA(this.#A, 1e-3);
    this.#Z = I.getOutlines(), [this.x, this.y, this.width, this.height] = this.#Z.box;
    const g = new hA(this.#A, 25e-4, 1e-3, this._uiManager.direction === "ltr");
    this.#l = g.getOutlines();
    const {
      firstPoint: C
    } = this.#Z;
    this.#m = [(C[0] - this.x) / this.width, (C[1] - this.y) / this.height];
    const {
      lastPoint: A
    } = this.#l;
    this.#t = [(A[0] - this.x) / this.width, (A[1] - this.y) / this.height];
  }
  #h({
    highlightOutlines: I,
    highlightId: g,
    clipPathId: C
  }) {
    this.#Z = I;
    const A = 1.5;
    if (this.#l = I.getNewOutline(this.#e / 2 + A, 25e-4), g >= 0)
      this.#o = g, this.#C = C, this.parent.drawLayer.finalizeDraw(g, {
        bbox: I.box,
        path: {
          d: I.toSVGPath()
        }
      }), this.#a = this.parent.drawLayer.drawOutline({
        rootClass: {
          highlightOutline: !0,
          free: !0
        },
        bbox: this.#l.box,
        path: {
          d: this.#l.toSVGPath()
        }
      }, !0);
    else if (this.parent) {
      const b = this.parent.viewport.rotation;
      this.parent.drawLayer.updateProperties(this.#o, {
        bbox: gI.#u(this.#Z.box, (b - this.rotation + 360) % 360),
        path: {
          d: I.toSVGPath()
        }
      }), this.parent.drawLayer.updateProperties(this.#a, {
        bbox: gI.#u(this.#l.box, b),
        path: {
          d: this.#l.toSVGPath()
        }
      });
    }
    const [i, l, s, d] = I.box;
    switch (this.rotation) {
      case 0:
        this.x = i, this.y = l, this.width = s, this.height = d;
        break;
      case 90: {
        const [b, o] = this.parentDimensions;
        this.x = l, this.y = 1 - i, this.width = s * o / b, this.height = d * b / o;
        break;
      }
      case 180:
        this.x = 1 - i, this.y = 1 - l, this.width = s, this.height = d;
        break;
      case 270: {
        const [b, o] = this.parentDimensions;
        this.x = 1 - l, this.y = i, this.width = s * o / b, this.height = d * b / o;
        break;
      }
    }
    const {
      firstPoint: c
    } = I;
    this.#m = [(c[0] - i) / s, (c[1] - l) / d];
    const {
      lastPoint: G
    } = this.#l;
    this.#t = [(G[0] - i) / s, (G[1] - l) / d];
  }
  static initialize(I, g) {
    F.initialize(I, g), gI._defaultColor ||= g.highlightColors?.values().next().value || "#fff066";
  }
  static updateDefaultParams(I, g) {
    switch (I) {
      case j.HIGHLIGHT_COLOR:
        gI._defaultColor = g;
        break;
      case j.HIGHLIGHT_THICKNESS:
        gI._defaultThickness = g;
        break;
    }
  }
  translateInPage(I, g) {
  }
  get toolbarPosition() {
    return this.#t;
  }
  get commentButtonPosition() {
    return this.#m;
  }
  updateParams(I, g) {
    switch (I) {
      case j.HIGHLIGHT_COLOR:
        this.#N(g);
        break;
      case j.HIGHLIGHT_THICKNESS:
        this.#w(g);
        break;
    }
  }
  static get defaultPropertiesToUpdate() {
    return [[j.HIGHLIGHT_COLOR, gI._defaultColor], [j.HIGHLIGHT_THICKNESS, gI._defaultThickness]];
  }
  get propertiesToUpdate() {
    return [[j.HIGHLIGHT_COLOR, this.color || gI._defaultColor], [j.HIGHLIGHT_THICKNESS, this.#e || gI._defaultThickness], [j.HIGHLIGHT_FREE, this.#b]];
  }
  onUpdatedColor() {
    this.parent?.drawLayer.updateProperties(this.#o, {
      root: {
        fill: this.color,
        "fill-opacity": this.opacity
      }
    }), this.#i?.updateColor(this.color), super.onUpdatedColor();
  }
  #N(I) {
    const g = (i, l) => {
      this.color = i, this.opacity = l, this.onUpdatedColor();
    }, C = this.color, A = this.opacity;
    this.addCommands({
      cmd: g.bind(this, I, gI._defaultOpacity),
      undo: g.bind(this, C, A),
      post: this._uiManager.updateUI.bind(this._uiManager, this),
      mustExec: !0,
      type: j.HIGHLIGHT_COLOR,
      overwriteIfSameType: !0,
      keepUndo: !0
    }), this._reportTelemetry({
      action: "color_changed",
      color: this._uiManager.getNonHCMColorName(I)
    }, !0);
  }
  #w(I) {
    const g = this.#e, C = (A) => {
      this.#e = A, this.#n(A);
    };
    this.addCommands({
      cmd: C.bind(this, I),
      undo: C.bind(this, g),
      post: this._uiManager.updateUI.bind(this._uiManager, this),
      mustExec: !0,
      type: j.INK_THICKNESS,
      overwriteIfSameType: !0,
      keepUndo: !0
    }), this._reportTelemetry({
      action: "thickness_changed",
      thickness: I
    }, !0);
  }
  get toolbarButtons() {
    return this._uiManager.highlightColors ? [["colorPicker", this.#i = new Hl({
      editor: this
    })]] : super.toolbarButtons;
  }
  disableEditing() {
    super.disableEditing(), this.div.classList.toggle("disabled", !0);
  }
  enableEditing() {
    super.enableEditing(), this.div.classList.toggle("disabled", !1);
  }
  fixAndSetPosition() {
    return super.fixAndSetPosition(this.#X());
  }
  getBaseTranslation() {
    return [0, 0];
  }
  getRect(I, g) {
    return super.getRect(I, g, this.#X());
  }
  onceAdded(I) {
    this.annotationElementId || this.parent.addUndoableEditor(this), I && this.div.focus();
  }
  remove() {
    this.#R(), this._reportTelemetry({
      action: "deleted"
    }), super.remove();
  }
  rebuild() {
    this.parent && (super.rebuild(), this.div !== null && (this.#Y(), this.isAttachedToDOM || this.parent.add(this)));
  }
  setParent(I) {
    let g = !1;
    this.parent && !I ? this.#R() : I && (this.#Y(I), g = !this.parent && this.div?.classList.contains("selectedEditor")), super.setParent(I), this.show(this._isVisible), g && this.select();
  }
  #n(I) {
    this.#b && (this.#h({
      highlightOutlines: this.#Z.getNewOutline(I / 2)
    }), this.fixAndSetPosition(), this.setDims(this.width, this.height));
  }
  #R() {
    this.#o === null || !this.parent || (this.parent.drawLayer.remove(this.#o), this.#o = null, this.parent.drawLayer.remove(this.#a), this.#a = null);
  }
  #Y(I = this.parent) {
    this.#o === null && ({
      id: this.#o,
      clipPathId: this.#C
    } = I.drawLayer.draw({
      bbox: this.#Z.box,
      root: {
        viewBox: "0 0 1 1",
        fill: this.color,
        "fill-opacity": this.opacity
      },
      rootClass: {
        highlight: !0,
        free: this.#b
      },
      path: {
        d: this.#Z.toSVGPath()
      }
    }, !1, !0), this.#a = I.drawLayer.drawOutline({
      rootClass: {
        highlightOutline: !0,
        free: this.#b
      },
      bbox: this.#l.box,
      path: {
        d: this.#l.toSVGPath()
      }
    }, this.#b), this.#c && (this.#c.style.clipPath = this.#C));
  }
  static #u([I, g, C, A], i) {
    switch (i) {
      case 90:
        return [1 - g - A, I, A, C];
      case 180:
        return [1 - I - C, 1 - g - A, C, A];
      case 270:
        return [g, 1 - I - C, A, C];
    }
    return [I, g, C, A];
  }
  rotate(I) {
    const {
      drawLayer: g
    } = this.parent;
    let C;
    this.#b ? (I = (I - this.rotation + 360) % 360, C = gI.#u(this.#Z.box, I)) : C = gI.#u([this.x, this.y, this.width, this.height], I), g.updateProperties(this.#o, {
      bbox: C,
      root: {
        "data-main-rotation": I
      }
    }), g.updateProperties(this.#a, {
      bbox: gI.#u(this.#l.box, I),
      root: {
        "data-main-rotation": I
      }
    });
  }
  render() {
    if (this.div)
      return this.div;
    const I = super.render();
    this.#G && (I.setAttribute("aria-label", this.#G), I.setAttribute("role", "mark")), this.#b ? I.classList.add("free") : this.div.addEventListener("keydown", this.#M.bind(this), {
      signal: this._uiManager._signal
    });
    const g = this.#c = document.createElement("div");
    return I.append(g), g.setAttribute("aria-hidden", "true"), g.className = "internal", g.style.clipPath = this.#C, this.setDims(this.width, this.height), Zl(this, this.#c, ["pointerover", "pointerleave"]), this.enableEditing(), I;
  }
  pointerover() {
    this.isSelected || this.parent?.drawLayer.updateProperties(this.#a, {
      rootClass: {
        hovered: !0
      }
    });
  }
  pointerleave() {
    this.isSelected || this.parent?.drawLayer.updateProperties(this.#a, {
      rootClass: {
        hovered: !1
      }
    });
  }
  #M(I) {
    gI._keyboardManager.exec(this, I);
  }
  _moveCaret(I) {
    switch (this.parent.unselect(this), I) {
      case 0:
      case 2:
        this.#y(!0);
        break;
      case 1:
      case 3:
        this.#y(!1);
        break;
    }
  }
  #y(I) {
    if (!this.#I)
      return;
    const g = window.getSelection();
    I ? g.setPosition(this.#I, this.#g) : g.setPosition(this.#s, this.#d);
  }
  select() {
    super.select(), this.#a && this.parent?.drawLayer.updateProperties(this.#a, {
      rootClass: {
        hovered: !1,
        selected: !0
      }
    });
  }
  unselect() {
    super.unselect(), this.#a && (this.parent?.drawLayer.updateProperties(this.#a, {
      rootClass: {
        selected: !1
      }
    }), this.#b || this.#y(!1));
  }
  get _mustFixPosition() {
    return !this.#b;
  }
  show(I = this._isVisible) {
    super.show(I), this.parent && (this.parent.drawLayer.updateProperties(this.#o, {
      rootClass: {
        hidden: !I
      }
    }), this.parent.drawLayer.updateProperties(this.#a, {
      rootClass: {
        hidden: !I
      }
    }));
  }
  #X() {
    return this.#b ? this.rotation : 0;
  }
  #p() {
    if (this.#b)
      return null;
    const [I, g] = this.pageDimensions, [C, A] = this.pageTranslation, i = this.#A, l = new Float32Array(i.length * 8);
    let s = 0;
    for (const {
      x: d,
      y: c,
      width: G,
      height: b
    } of i) {
      const o = d * I + C, m = (1 - c) * g + A;
      l[s] = l[s + 4] = o, l[s + 1] = l[s + 3] = m, l[s + 2] = l[s + 6] = o + G * I, l[s + 5] = l[s + 7] = m - b * g, s += 8;
    }
    return l;
  }
  #K(I) {
    return this.#Z.serialize(I, this.#X());
  }
  static startHighlighting(I, g, {
    target: C,
    x: A,
    y: i
  }) {
    const {
      x: l,
      y: s,
      width: d,
      height: c
    } = C.getBoundingClientRect(), G = new AbortController(), b = I.combinedSignal(G), o = (m) => {
      G.abort(), this.#F(I, m);
    };
    window.addEventListener("blur", o, {
      signal: b
    }), window.addEventListener("pointerup", o, {
      signal: b
    }), window.addEventListener("pointerdown", II, {
      capture: !0,
      passive: !1,
      signal: b
    }), window.addEventListener("contextmenu", RI, {
      signal: b
    }), C.addEventListener("pointermove", this.#S.bind(this, I), {
      signal: b
    }), this._freeHighlight = new BA({
      x: A,
      y: i
    }, [l, s, d, c], I.scale, this._defaultThickness / 2, g, 1e-3), {
      id: this._freeHighlightId,
      clipPathId: this._freeHighlightClipId
    } = I.drawLayer.draw({
      bbox: [0, 0, 1, 1],
      root: {
        viewBox: "0 0 1 1",
        fill: this._defaultColor,
        "fill-opacity": this._defaultOpacity
      },
      rootClass: {
        highlight: !0,
        free: !0
      },
      path: {
        d: this._freeHighlight.toSVGPath()
      }
    }, !0, !0);
  }
  static #S(I, g) {
    this._freeHighlight.add(g) && I.drawLayer.updateProperties(this._freeHighlightId, {
      path: {
        d: this._freeHighlight.toSVGPath()
      }
    });
  }
  static #F(I, g) {
    this._freeHighlight.isEmpty() ? I.drawLayer.remove(this._freeHighlightId) : I.createAndAddNewEditor(g, !1, {
      highlightId: this._freeHighlightId,
      highlightOutlines: this._freeHighlight.getOutlines(),
      clipPathId: this._freeHighlightClipId,
      methodOfCreation: "main_toolbar"
    }), this._freeHighlightId = -1, this._freeHighlight = null, this._freeHighlightClipId = "";
  }
  static async deserialize(I, g, C) {
    let A = null;
    if (I instanceof Sl) {
      const {
        data: {
          quadPoints: e,
          rect: a,
          rotation: h,
          id: t,
          color: W,
          opacity: B,
          popupRef: w,
          richText: n,
          contentsObj: V,
          creationDate: N,
          modificationDate: R
        },
        parent: {
          page: {
            pageNumber: Y
          }
        }
      } = I;
      A = I = {
        annotationType: k.HIGHLIGHT,
        color: Array.from(W),
        opacity: B,
        quadPoints: e,
        boxes: null,
        pageIndex: Y - 1,
        rect: a.slice(0),
        rotation: h,
        annotationElementId: t,
        id: t,
        deleted: !1,
        popupRef: w,
        richText: n,
        comment: V?.str || null,
        creationDate: N,
        modificationDate: R
      };
    } else if (I instanceof LA) {
      const {
        data: {
          inkLists: e,
          rect: a,
          rotation: h,
          id: t,
          color: W,
          borderStyle: {
            rawWidth: B
          },
          popupRef: w,
          richText: n,
          contentsObj: V,
          creationDate: N,
          modificationDate: R
        },
        parent: {
          page: {
            pageNumber: Y
          }
        }
      } = I;
      A = I = {
        annotationType: k.HIGHLIGHT,
        color: Array.from(W),
        thickness: B,
        inkLists: e,
        boxes: null,
        pageIndex: Y - 1,
        rect: a.slice(0),
        rotation: h,
        annotationElementId: t,
        id: t,
        deleted: !1,
        popupRef: w,
        richText: n,
        comment: V?.str || null,
        creationDate: N,
        modificationDate: R
      };
    }
    const {
      color: i,
      quadPoints: l,
      inkLists: s,
      opacity: d
    } = I, c = await super.deserialize(I, g, C);
    c.color = M.makeHexColor(...i), c.opacity = d || 1, s && (c.#e = I.thickness), c._initialData = A, I.comment && c.setCommentData(I);
    const [G, b] = c.pageDimensions, [o, m] = c.pageTranslation;
    if (l) {
      const e = c.#A = [];
      for (let a = 0; a < l.length; a += 8)
        e.push({
          x: (l[a] - o) / G,
          y: 1 - (l[a + 1] - m) / b,
          width: (l[a + 2] - l[a]) / G,
          height: (l[a + 1] - l[a + 5]) / b
        });
      c.#W(), c.#Y(), c.rotate(c.rotation);
    } else if (s) {
      c.#b = !0;
      const e = s[0], a = {
        x: e[0] - o,
        y: b - (e[1] - m)
      }, h = new BA(a, [0, 0, G, b], 1, c.#e / 2, !0, 1e-3);
      for (let B = 0, w = e.length; B < w; B += 2)
        a.x = e[B] - o, a.y = b - (e[B + 1] - m), h.add(a);
      const {
        id: t,
        clipPathId: W
      } = g.drawLayer.draw({
        bbox: [0, 0, 1, 1],
        root: {
          viewBox: "0 0 1 1",
          fill: c.color,
          "fill-opacity": c._defaultOpacity
        },
        rootClass: {
          highlight: !0,
          free: !0
        },
        path: {
          d: h.toSVGPath()
        }
      }, !0, !0);
      c.#h({
        highlightOutlines: h.getOutlines(),
        highlightId: t,
        clipPathId: W
      }), c.#Y(), c.rotate(c.parentRotation);
    }
    return c;
  }
  serialize(I = !1) {
    if (this.isEmpty() || I)
      return null;
    if (this.deleted)
      return this.serializeDeleted();
    const g = F._colorManager.convert(this._uiManager.getNonHCMColor(this.color)), C = super.serialize(I);
    return Object.assign(C, {
      color: g,
      opacity: this.opacity,
      thickness: this.#e,
      quadPoints: this.#p(),
      outlines: this.#K(C.rect)
    }), this.addComment(C), this.annotationElementId && !this.#z(C) ? null : (C.id = this.annotationElementId, C);
  }
  #z(I) {
    const {
      color: g
    } = this._initialData;
    return this.hasEditedComment || I.color.some((C, A) => C !== g[A]);
  }
  renderAnnotationElement(I) {
    return this.deleted ? (I.hide(), null) : (I.updateEdited({
      rect: this.getPDFRect(),
      popup: this.comment
    }), null);
  }
  static canCreateNewEmptyEditor() {
    return !1;
  }
}
class Ll {
  #I = /* @__PURE__ */ Object.create(null);
  updateProperty(I, g) {
    this[I] = g, this.updateSVGProperty(I, g);
  }
  updateProperties(I) {
    if (I)
      for (const [g, C] of Object.entries(I))
        g.startsWith("_") || this.updateProperty(g, C);
  }
  updateSVGProperty(I, g) {
    this.#I[I] = g;
  }
  toSVGProperties() {
    const I = this.#I;
    return this.#I = /* @__PURE__ */ Object.create(null), {
      root: I
    };
  }
  reset() {
    this.#I = /* @__PURE__ */ Object.create(null);
  }
  updateAll(I = this) {
    this.updateProperties(I);
  }
  clone() {
    f("Not implemented");
  }
}
class J extends F {
  #I = null;
  #g;
  _colorPicker = null;
  _drawId = null;
  static _currentDrawId = -1;
  static _currentParent = null;
  static #A = null;
  static #C = null;
  static #i = null;
  static #l = NaN;
  static #s = null;
  static #d = null;
  static #c = NaN;
  static _INNER_MARGIN = 3;
  constructor(I) {
    super(I), this.#g = I.mustBeCommitted || !1, this._addOutlines(I);
  }
  onUpdatedColor() {
    this._colorPicker?.update(this.color), super.onUpdatedColor();
  }
  _addOutlines(I) {
    I.drawOutlines && (this.#Z(I), this.#m());
  }
  #Z({
    drawOutlines: I,
    drawId: g,
    drawingOptions: C
  }) {
    this.#I = I, this._drawingOptions ||= C, this.annotationElementId || this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`), g >= 0 ? (this._drawId = g, this.parent.drawLayer.finalizeDraw(g, I.defaultProperties)) : this._drawId = this.#o(I, this.parent), this.#G(I.box);
  }
  #o(I, g) {
    const {
      id: C
    } = g.drawLayer.draw(J._mergeSVGProperties(this._drawingOptions.toSVGProperties(), I.defaultSVGProperties), !1, !1);
    return C;
  }
  static _mergeSVGProperties(I, g) {
    const C = new Set(Object.keys(I));
    for (const [A, i] of Object.entries(g))
      C.has(A) ? Object.assign(I[A], i) : I[A] = i;
    return I;
  }
  static getDefaultDrawingOptions(I) {
    f("Not implemented");
  }
  static get typesMap() {
    f("Not implemented");
  }
  static get isDrawer() {
    return !0;
  }
  static get supportMultipleDrawings() {
    return !1;
  }
  static updateDefaultParams(I, g) {
    const C = this.typesMap.get(I);
    C && this._defaultDrawingOptions.updateProperty(C, g), this._currentParent && (J.#A.updateProperty(C, g), this._currentParent.drawLayer.updateProperties(this._currentDrawId, this._defaultDrawingOptions.toSVGProperties()));
  }
  updateParams(I, g) {
    const C = this.constructor.typesMap.get(I);
    C && this._updateProperty(I, C, g);
  }
  static get defaultPropertiesToUpdate() {
    const I = [], g = this._defaultDrawingOptions;
    for (const [C, A] of this.typesMap)
      I.push([C, g[A]]);
    return I;
  }
  get propertiesToUpdate() {
    const I = [], {
      _drawingOptions: g
    } = this;
    for (const [C, A] of this.constructor.typesMap)
      I.push([C, g[A]]);
    return I;
  }
  _updateProperty(I, g, C) {
    const A = this._drawingOptions, i = A[g], l = (s) => {
      A.updateProperty(g, s);
      const d = this.#I.updateProperty(g, s);
      d && this.#G(d), this.parent?.drawLayer.updateProperties(this._drawId, A.toSVGProperties()), I === this.colorType && this.onUpdatedColor();
    };
    this.addCommands({
      cmd: l.bind(this, C),
      undo: l.bind(this, i),
      post: this._uiManager.updateUI.bind(this._uiManager, this),
      mustExec: !0,
      type: I,
      overwriteIfSameType: !0,
      keepUndo: !0
    });
  }
  _onResizing() {
    this.parent?.drawLayer.updateProperties(this._drawId, J._mergeSVGProperties(this.#I.getPathResizingSVGProperties(this.#a()), {
      bbox: this.#e()
    }));
  }
  _onResized() {
    this.parent?.drawLayer.updateProperties(this._drawId, J._mergeSVGProperties(this.#I.getPathResizedSVGProperties(this.#a()), {
      bbox: this.#e()
    }));
  }
  _onTranslating(I, g) {
    this.parent?.drawLayer.updateProperties(this._drawId, {
      bbox: this.#e()
    });
  }
  _onTranslated() {
    this.parent?.drawLayer.updateProperties(this._drawId, J._mergeSVGProperties(this.#I.getPathTranslatedSVGProperties(this.#a(), this.parentDimensions), {
      bbox: this.#e()
    }));
  }
  _onStartDragging() {
    this.parent?.drawLayer.updateProperties(this._drawId, {
      rootClass: {
        moving: !0
      }
    });
  }
  _onStopDragging() {
    this.parent?.drawLayer.updateProperties(this._drawId, {
      rootClass: {
        moving: !1
      }
    });
  }
  commit() {
    super.commit(), this.disableEditMode(), this.disableEditing();
  }
  disableEditing() {
    super.disableEditing(), this.div.classList.toggle("disabled", !0);
  }
  enableEditing() {
    super.enableEditing(), this.div.classList.toggle("disabled", !1);
  }
  getBaseTranslation() {
    return [0, 0];
  }
  get isResizable() {
    return !0;
  }
  onceAdded(I) {
    this.annotationElementId || this.parent.addUndoableEditor(this), this._isDraggable = !0, this.#g && (this.#g = !1, this.commit(), this.parent.setSelected(this), I && this.isOnScreen && this.div.focus());
  }
  remove() {
    this.#b(), super.remove();
  }
  rebuild() {
    this.parent && (super.rebuild(), this.div !== null && (this.#m(), this.#G(this.#I.box), this.isAttachedToDOM || this.parent.add(this)));
  }
  setParent(I) {
    let g = !1;
    this.parent && !I ? (this._uiManager.removeShouldRescale(this), this.#b()) : I && (this._uiManager.addShouldRescale(this), this.#m(I), g = !this.parent && this.div?.classList.contains("selectedEditor")), super.setParent(I), g && this.select();
  }
  #b() {
    this._drawId === null || !this.parent || (this.parent.drawLayer.remove(this._drawId), this._drawId = null, this._drawingOptions.reset());
  }
  #m(I = this.parent) {
    if (!(this._drawId !== null && this.parent === I)) {
      if (this._drawId !== null) {
        this.parent.drawLayer.updateParent(this._drawId, I.drawLayer);
        return;
      }
      this._drawingOptions.updateAll(), this._drawId = this.#o(this.#I, I);
    }
  }
  #t([I, g, C, A]) {
    const {
      parentDimensions: [i, l],
      rotation: s
    } = this;
    switch (s) {
      case 90:
        return [g, 1 - I, C * (l / i), A * (i / l)];
      case 180:
        return [1 - I, 1 - g, C, A];
      case 270:
        return [1 - g, I, C * (l / i), A * (i / l)];
      default:
        return [I, g, C, A];
    }
  }
  #a() {
    const {
      x: I,
      y: g,
      width: C,
      height: A,
      parentDimensions: [i, l],
      rotation: s
    } = this;
    switch (s) {
      case 90:
        return [1 - g, I, C * (i / l), A * (l / i)];
      case 180:
        return [1 - I, 1 - g, C, A];
      case 270:
        return [g, 1 - I, C * (i / l), A * (l / i)];
      default:
        return [I, g, C, A];
    }
  }
  #G(I) {
    [this.x, this.y, this.width, this.height] = this.#t(I), this.div && (this.fixAndSetPosition(), this.setDims()), this._onResized();
  }
  #e() {
    const {
      x: I,
      y: g,
      width: C,
      height: A,
      rotation: i,
      parentRotation: l,
      parentDimensions: [s, d]
    } = this;
    switch ((i * 4 + l) / 90) {
      case 1:
        return [1 - g - A, I, A, C];
      case 2:
        return [1 - I - C, 1 - g - A, C, A];
      case 3:
        return [g, 1 - I - C, A, C];
      case 4:
        return [I, g - C * (s / d), A * (d / s), C * (s / d)];
      case 5:
        return [1 - g, I, C * (s / d), A * (d / s)];
      case 6:
        return [1 - I - A * (d / s), 1 - g, A * (d / s), C * (s / d)];
      case 7:
        return [g - C * (s / d), 1 - I - A * (d / s), C * (s / d), A * (d / s)];
      case 8:
        return [I - C, g - A, C, A];
      case 9:
        return [1 - g, I - C, A, C];
      case 10:
        return [1 - I, 1 - g, C, A];
      case 11:
        return [g - A, 1 - I, A, C];
      case 12:
        return [I - A * (d / s), g, A * (d / s), C * (s / d)];
      case 13:
        return [1 - g - C * (s / d), I - A * (d / s), C * (s / d), A * (d / s)];
      case 14:
        return [1 - I, 1 - g - C * (s / d), A * (d / s), C * (s / d)];
      case 15:
        return [g, 1 - I, C * (s / d), A * (d / s)];
      default:
        return [I, g, C, A];
    }
  }
  rotate() {
    this.parent && this.parent.drawLayer.updateProperties(this._drawId, J._mergeSVGProperties({
      bbox: this.#e()
    }, this.#I.updateRotation((this.parentRotation - this.rotation + 360) % 360)));
  }
  onScaleChanging() {
    this.parent && this.#G(this.#I.updateParentDimensions(this.parentDimensions, this.parent.scale));
  }
  static onScaleChangingWhenDrawing() {
  }
  render() {
    if (this.div)
      return this.div;
    let I, g;
    this._isCopy && (I = this.x, g = this.y);
    const C = super.render();
    C.classList.add("draw");
    const A = document.createElement("div");
    return C.append(A), A.setAttribute("aria-hidden", "true"), A.className = "internal", this.setDims(), this._uiManager.addShouldRescale(this), this.disableEditing(), this._isCopy && this._moveAfterPaste(I, g), C;
  }
  static createDrawerInstance(I, g, C, A, i) {
    f("Not implemented");
  }
  static startDrawing(I, g, C, A) {
    const {
      target: i,
      offsetX: l,
      offsetY: s,
      pointerId: d,
      pointerType: c
    } = A;
    if (J.#s && J.#s !== c)
      return;
    const {
      viewport: {
        rotation: G
      }
    } = I, {
      width: b,
      height: o
    } = i.getBoundingClientRect(), m = J.#C = new AbortController(), e = I.combinedSignal(m);
    if (J.#l ||= d, J.#s ??= c, window.addEventListener("pointerup", (a) => {
      J.#l === a.pointerId ? this._endDraw(a) : J.#d?.delete(a.pointerId);
    }, {
      signal: e
    }), window.addEventListener("pointercancel", (a) => {
      J.#l === a.pointerId ? this._currentParent.endDrawingSession() : J.#d?.delete(a.pointerId);
    }, {
      signal: e
    }), window.addEventListener("pointerdown", (a) => {
      J.#s === a.pointerType && ((J.#d ||= /* @__PURE__ */ new Set()).add(a.pointerId), J.#A.isCancellable() && (J.#A.removeLastElement(), J.#A.isEmpty() ? this._currentParent.endDrawingSession(!0) : this._endDraw(null)));
    }, {
      capture: !0,
      passive: !1,
      signal: e
    }), window.addEventListener("contextmenu", RI, {
      signal: e
    }), i.addEventListener("pointermove", this._drawMove.bind(this), {
      signal: e
    }), i.addEventListener("touchmove", (a) => {
      a.timeStamp === J.#c && II(a);
    }, {
      signal: e
    }), I.toggleDrawing(), g._editorUndoBar?.hide(), J.#A) {
      I.drawLayer.updateProperties(this._currentDrawId, J.#A.startNew(l, s, b, o, G));
      return;
    }
    g.updateUIForDefaultProperties(this), J.#A = this.createDrawerInstance(l, s, b, o, G), J.#i = this.getDefaultDrawingOptions(), this._currentParent = I, {
      id: this._currentDrawId
    } = I.drawLayer.draw(this._mergeSVGProperties(J.#i.toSVGProperties(), J.#A.defaultSVGProperties), !0, !1);
  }
  static _drawMove(I) {
    if (J.#c = -1, !J.#A)
      return;
    const {
      offsetX: g,
      offsetY: C,
      pointerId: A
    } = I;
    if (J.#l === A) {
      if (J.#d?.size >= 1) {
        this._endDraw(I);
        return;
      }
      this._currentParent.drawLayer.updateProperties(this._currentDrawId, J.#A.add(g, C)), J.#c = I.timeStamp, II(I);
    }
  }
  static _cleanup(I) {
    I && (this._currentDrawId = -1, this._currentParent = null, J.#A = null, J.#i = null, J.#s = null, J.#c = NaN), J.#C && (J.#C.abort(), J.#C = null, J.#l = NaN, J.#d = null);
  }
  static _endDraw(I) {
    const g = this._currentParent;
    if (g) {
      if (g.toggleDrawing(!0), this._cleanup(!1), I?.target === g.div && g.drawLayer.updateProperties(this._currentDrawId, J.#A.end(I.offsetX, I.offsetY)), this.supportMultipleDrawings) {
        const C = J.#A, A = this._currentDrawId, i = C.getLastElement();
        g.addCommands({
          cmd: () => {
            g.drawLayer.updateProperties(A, C.setLastElement(i));
          },
          undo: () => {
            g.drawLayer.updateProperties(A, C.removeLastElement());
          },
          mustExec: !1,
          type: j.DRAW_STEP
        });
        return;
      }
      this.endDrawing(!1);
    }
  }
  static endDrawing(I) {
    const g = this._currentParent;
    if (!g)
      return null;
    if (g.toggleDrawing(!0), g.cleanUndoStack(j.DRAW_STEP), !J.#A.isEmpty()) {
      const {
        pageDimensions: [C, A],
        scale: i
      } = g, l = g.createAndAddNewEditor({
        offsetX: 0,
        offsetY: 0
      }, !1, {
        drawId: this._currentDrawId,
        drawOutlines: J.#A.getOutlines(C * i, A * i, i, this._INNER_MARGIN),
        drawingOptions: J.#i,
        mustBeCommitted: !I
      });
      return this._cleanup(!0), l;
    }
    return g.drawLayer.remove(this._currentDrawId), this._cleanup(!0), null;
  }
  createDrawingOptions(I) {
  }
  static deserializeDraw(I, g, C, A, i, l) {
    f("Not implemented");
  }
  static async deserialize(I, g, C) {
    const {
      rawDims: {
        pageWidth: A,
        pageHeight: i,
        pageX: l,
        pageY: s
      }
    } = g.viewport, d = this.deserializeDraw(l, s, A, i, this._INNER_MARGIN, I), c = await super.deserialize(I, g, C);
    return c.createDrawingOptions(I), c.#Z({
      drawOutlines: d
    }), c.#m(), c.onScaleChanging(), c.rotate(), c;
  }
  serializeDraw(I) {
    const [g, C] = this.pageTranslation, [A, i] = this.pageDimensions;
    return this.#I.serialize([g, C, A, i], I);
  }
  renderAnnotationElement(I) {
    return I.updateEdited({
      rect: this.getPDFRect()
    }), null;
  }
  static canCreateNewEmptyEditor() {
    return !1;
  }
}
class AZ {
  #I = new Float64Array(6);
  #g;
  #A;
  #C;
  #i;
  #l;
  #s = "";
  #d = 0;
  #c = new iC();
  #Z;
  #o;
  constructor(I, g, C, A, i, l) {
    this.#Z = C, this.#o = A, this.#C = i, this.#i = l, [I, g] = this.#b(I, g);
    const s = this.#g = [NaN, NaN, NaN, NaN, I, g];
    this.#l = [I, g], this.#A = [{
      line: s,
      points: this.#l
    }], this.#I.set(s, 0);
  }
  updateProperty(I, g) {
    I === "stroke-width" && (this.#i = g);
  }
  #b(I, g) {
    return H._normalizePoint(I, g, this.#Z, this.#o, this.#C);
  }
  isEmpty() {
    return !this.#A || this.#A.length === 0;
  }
  isCancellable() {
    return this.#l.length <= 10;
  }
  add(I, g) {
    [I, g] = this.#b(I, g);
    const [C, A, i, l] = this.#I.subarray(2, 6), s = I - i, d = g - l;
    return Math.hypot(this.#Z * s, this.#o * d) <= 2 ? null : (this.#l.push(I, g), isNaN(C) ? (this.#I.set([i, l, I, g], 2), this.#g.push(NaN, NaN, NaN, NaN, I, g), {
      path: {
        d: this.toSVGPath()
      }
    }) : (isNaN(this.#I[0]) && this.#g.splice(6, 6), this.#I.set([C, A, i, l, I, g], 0), this.#g.push(...H.createBezierPoints(C, A, i, l, I, g)), {
      path: {
        d: this.toSVGPath()
      }
    }));
  }
  end(I, g) {
    const C = this.add(I, g);
    return C || (this.#l.length === 2 ? {
      path: {
        d: this.toSVGPath()
      }
    } : null);
  }
  startNew(I, g, C, A, i) {
    this.#Z = C, this.#o = A, this.#C = i, [I, g] = this.#b(I, g);
    const l = this.#g = [NaN, NaN, NaN, NaN, I, g];
    this.#l = [I, g];
    const s = this.#A.at(-1);
    return s && (s.line = new Float32Array(s.line), s.points = new Float32Array(s.points)), this.#A.push({
      line: l,
      points: this.#l
    }), this.#I.set(l, 0), this.#d = 0, this.toSVGPath(), null;
  }
  getLastElement() {
    return this.#A.at(-1);
  }
  setLastElement(I) {
    return this.#A ? (this.#A.push(I), this.#g = I.line, this.#l = I.points, this.#d = 0, {
      path: {
        d: this.toSVGPath()
      }
    }) : this.#c.setLastElement(I);
  }
  removeLastElement() {
    if (!this.#A)
      return this.#c.removeLastElement();
    this.#A.pop(), this.#s = "";
    for (let I = 0, g = this.#A.length; I < g; I++) {
      const {
        line: C,
        points: A
      } = this.#A[I];
      this.#g = C, this.#l = A, this.#d = 0, this.toSVGPath();
    }
    return {
      path: {
        d: this.#s
      }
    };
  }
  toSVGPath() {
    const I = H.svgRound(this.#g[4]), g = H.svgRound(this.#g[5]);
    if (this.#l.length === 2)
      return this.#s = `${this.#s} M ${I} ${g} Z`, this.#s;
    if (this.#l.length <= 6) {
      const A = this.#s.lastIndexOf("M");
      this.#s = `${this.#s.slice(0, A)} M ${I} ${g}`, this.#d = 6;
    }
    if (this.#l.length === 4) {
      const A = H.svgRound(this.#g[10]), i = H.svgRound(this.#g[11]);
      return this.#s = `${this.#s} L ${A} ${i}`, this.#d = 12, this.#s;
    }
    const C = [];
    this.#d === 0 && (C.push(`M ${I} ${g}`), this.#d = 6);
    for (let A = this.#d, i = this.#g.length; A < i; A += 6) {
      const [l, s, d, c, G, b] = this.#g.slice(A, A + 6).map(H.svgRound);
      C.push(`C${l} ${s} ${d} ${c} ${G} ${b}`);
    }
    return this.#s += C.join(" "), this.#d = this.#g.length, this.#s;
  }
  getOutlines(I, g, C, A) {
    const i = this.#A.at(-1);
    return i.line = new Float32Array(i.line), i.points = new Float32Array(i.points), this.#c.build(this.#A, I, g, C, this.#C, this.#i, A), this.#I = null, this.#g = null, this.#A = null, this.#s = null, this.#c;
  }
  get defaultSVGProperties() {
    return {
      root: {
        viewBox: "0 0 10000 10000"
      },
      rootClass: {
        draw: !0
      },
      bbox: [0, 0, 1, 1]
    };
  }
}
class iC extends H {
  #I;
  #g = 0;
  #A;
  #C;
  #i;
  #l;
  #s;
  #d;
  #c;
  build(I, g, C, A, i, l, s) {
    this.#i = g, this.#l = C, this.#s = A, this.#d = i, this.#c = l, this.#A = s ?? 0, this.#C = I, this.#b();
  }
  get thickness() {
    return this.#c;
  }
  setLastElement(I) {
    return this.#C.push(I), {
      path: {
        d: this.toSVGPath()
      }
    };
  }
  removeLastElement() {
    return this.#C.pop(), {
      path: {
        d: this.toSVGPath()
      }
    };
  }
  toSVGPath() {
    const I = [];
    for (const {
      line: g
    } of this.#C) {
      if (I.push(`M${H.svgRound(g[4])} ${H.svgRound(g[5])}`), g.length === 6) {
        I.push("Z");
        continue;
      }
      if (g.length === 12 && isNaN(g[6])) {
        I.push(`L${H.svgRound(g[10])} ${H.svgRound(g[11])}`);
        continue;
      }
      for (let C = 6, A = g.length; C < A; C += 6) {
        const [i, l, s, d, c, G] = g.subarray(C, C + 6).map(H.svgRound);
        I.push(`C${i} ${l} ${s} ${d} ${c} ${G}`);
      }
    }
    return I.join("");
  }
  serialize([I, g, C, A], i) {
    const l = [], s = [], [d, c, G, b] = this.#o();
    let o, m, e, a, h, t, W, B, w;
    switch (this.#d) {
      case 0:
        w = H._rescale, o = I, m = g + A, e = C, a = -A, h = I + d * C, t = g + (1 - c - b) * A, W = I + (d + G) * C, B = g + (1 - c) * A;
        break;
      case 90:
        w = H._rescaleAndSwap, o = I, m = g, e = C, a = A, h = I + c * C, t = g + d * A, W = I + (c + b) * C, B = g + (d + G) * A;
        break;
      case 180:
        w = H._rescale, o = I + C, m = g, e = -C, a = A, h = I + (1 - d - G) * C, t = g + c * A, W = I + (1 - d) * C, B = g + (c + b) * A;
        break;
      case 270:
        w = H._rescaleAndSwap, o = I + C, m = g + A, e = -C, a = -A, h = I + (1 - c - b) * C, t = g + (1 - d - G) * A, W = I + (1 - c) * C, B = g + (1 - d) * A;
        break;
    }
    for (const {
      line: n,
      points: V
    } of this.#C)
      l.push(w(n, o, m, e, a, i ? new Array(n.length) : null)), s.push(w(V, o, m, e, a, i ? new Array(V.length) : null));
    return {
      lines: l,
      points: s,
      rect: [h, t, W, B]
    };
  }
  static deserialize(I, g, C, A, i, {
    paths: {
      lines: l,
      points: s
    },
    rotation: d,
    thickness: c
  }) {
    const G = [];
    let b, o, m, e, a;
    switch (d) {
      case 0:
        a = H._rescale, b = -I / C, o = g / A + 1, m = 1 / C, e = -1 / A;
        break;
      case 90:
        a = H._rescaleAndSwap, b = -g / A, o = -I / C, m = 1 / A, e = 1 / C;
        break;
      case 180:
        a = H._rescale, b = I / C + 1, o = -g / A, m = -1 / C, e = 1 / A;
        break;
      case 270:
        a = H._rescaleAndSwap, b = g / A + 1, o = I / C + 1, m = -1 / A, e = -1 / C;
        break;
    }
    if (!l) {
      l = [];
      for (const t of s) {
        const W = t.length;
        if (W === 2) {
          l.push(new Float32Array([NaN, NaN, NaN, NaN, t[0], t[1]]));
          continue;
        }
        if (W === 4) {
          l.push(new Float32Array([NaN, NaN, NaN, NaN, t[0], t[1], NaN, NaN, NaN, NaN, t[2], t[3]]));
          continue;
        }
        const B = new Float32Array(3 * (W - 2));
        l.push(B);
        let [w, n, V, N] = t.subarray(0, 4);
        B.set([NaN, NaN, NaN, NaN, w, n], 0);
        for (let R = 4; R < W; R += 2) {
          const Y = t[R], y = t[R + 1];
          B.set(H.createBezierPoints(w, n, V, N, Y, y), (R - 2) * 3), [w, n, V, N] = [V, N, Y, y];
        }
      }
    }
    for (let t = 0, W = l.length; t < W; t++)
      G.push({
        line: a(l[t].map((B) => B ?? NaN), b, o, m, e),
        points: a(s[t].map((B) => B ?? NaN), b, o, m, e)
      });
    const h = new this.prototype.constructor();
    return h.build(G, C, A, 1, d, c, i), h;
  }
  #Z(I = this.#c) {
    const g = this.#A + I / 2 * this.#s;
    return this.#d % 180 === 0 ? [g / this.#i, g / this.#l] : [g / this.#l, g / this.#i];
  }
  #o() {
    const [I, g, C, A] = this.#I, [i, l] = this.#Z(0);
    return [I + i, g + l, C - 2 * i, A - 2 * l];
  }
  #b() {
    const I = this.#I = new Float32Array([1 / 0, 1 / 0, -1 / 0, -1 / 0]);
    for (const {
      line: A
    } of this.#C) {
      if (A.length <= 12) {
        for (let s = 4, d = A.length; s < d; s += 6)
          M.pointBoundingBox(A[s], A[s + 1], I);
        continue;
      }
      let i = A[4], l = A[5];
      for (let s = 6, d = A.length; s < d; s += 6) {
        const [c, G, b, o, m, e] = A.subarray(s, s + 6);
        M.bezierBoundingBox(i, l, c, G, b, o, m, e, I), i = m, l = e;
      }
    }
    const [g, C] = this.#Z();
    I[0] = eI(I[0] - g, 0, 1), I[1] = eI(I[1] - C, 0, 1), I[2] = eI(I[2] + g, 0, 1), I[3] = eI(I[3] + C, 0, 1), I[2] -= I[0], I[3] -= I[1];
  }
  get box() {
    return this.#I;
  }
  updateProperty(I, g) {
    return I === "stroke-width" ? this.#m(g) : null;
  }
  #m(I) {
    const [g, C] = this.#Z();
    this.#c = I;
    const [A, i] = this.#Z(), [l, s] = [A - g, i - C], d = this.#I;
    return d[0] -= l, d[1] -= s, d[2] += 2 * l, d[3] += 2 * s, d;
  }
  updateParentDimensions([I, g], C) {
    const [A, i] = this.#Z();
    this.#i = I, this.#l = g, this.#s = C;
    const [l, s] = this.#Z(), d = l - A, c = s - i, G = this.#I;
    return G[0] -= d, G[1] -= c, G[2] += 2 * d, G[3] += 2 * c, G;
  }
  updateRotation(I) {
    return this.#g = I, {
      path: {
        transform: this.rotationTransform
      }
    };
  }
  get viewBox() {
    return this.#I.map(H.svgRound).join(" ");
  }
  get defaultProperties() {
    const [I, g] = this.#I;
    return {
      root: {
        viewBox: this.viewBox
      },
      path: {
        "transform-origin": `${H.svgRound(I)} ${H.svgRound(g)}`
      }
    };
  }
  get rotationTransform() {
    const [, , I, g] = this.#I;
    let C = 0, A = 0, i = 0, l = 0, s = 0, d = 0;
    switch (this.#g) {
      case 90:
        A = g / I, i = -I / g, s = I;
        break;
      case 180:
        C = -1, l = -1, s = I, d = g;
        break;
      case 270:
        A = -g / I, i = I / g, d = g;
        break;
      default:
        return "";
    }
    return `matrix(${C} ${A} ${i} ${l} ${H.svgRound(s)} ${H.svgRound(d)})`;
  }
  getPathResizingSVGProperties([I, g, C, A]) {
    const [i, l] = this.#Z(), [s, d, c, G] = this.#I;
    if (Math.abs(c - i) <= H.PRECISION || Math.abs(G - l) <= H.PRECISION) {
      const a = I + C / 2 - (s + c / 2), h = g + A / 2 - (d + G / 2);
      return {
        path: {
          "transform-origin": `${H.svgRound(I)} ${H.svgRound(g)}`,
          transform: `${this.rotationTransform} translate(${a} ${h})`
        }
      };
    }
    const b = (C - 2 * i) / (c - 2 * i), o = (A - 2 * l) / (G - 2 * l), m = c / C, e = G / A;
    return {
      path: {
        "transform-origin": `${H.svgRound(s)} ${H.svgRound(d)}`,
        transform: `${this.rotationTransform} scale(${m} ${e}) translate(${H.svgRound(i)} ${H.svgRound(l)}) scale(${b} ${o}) translate(${H.svgRound(-i)} ${H.svgRound(-l)})`
      }
    };
  }
  getPathResizedSVGProperties([I, g, C, A]) {
    const [i, l] = this.#Z(), s = this.#I, [d, c, G, b] = s;
    if (s[0] = I, s[1] = g, s[2] = C, s[3] = A, Math.abs(G - i) <= H.PRECISION || Math.abs(b - l) <= H.PRECISION) {
      const h = I + C / 2 - (d + G / 2), t = g + A / 2 - (c + b / 2);
      for (const {
        line: W,
        points: B
      } of this.#C)
        H._translate(W, h, t, W), H._translate(B, h, t, B);
      return {
        root: {
          viewBox: this.viewBox
        },
        path: {
          "transform-origin": `${H.svgRound(I)} ${H.svgRound(g)}`,
          transform: this.rotationTransform || null,
          d: this.toSVGPath()
        }
      };
    }
    const o = (C - 2 * i) / (G - 2 * i), m = (A - 2 * l) / (b - 2 * l), e = -o * (d + i) + I + i, a = -m * (c + l) + g + l;
    if (o !== 1 || m !== 1 || e !== 0 || a !== 0)
      for (const {
        line: h,
        points: t
      } of this.#C)
        H._rescale(h, e, a, o, m, h), H._rescale(t, e, a, o, m, t);
    return {
      root: {
        viewBox: this.viewBox
      },
      path: {
        "transform-origin": `${H.svgRound(I)} ${H.svgRound(g)}`,
        transform: this.rotationTransform || null,
        d: this.toSVGPath()
      }
    };
  }
  getPathTranslatedSVGProperties([I, g], C) {
    const [A, i] = C, l = this.#I, s = I - l[0], d = g - l[1];
    if (this.#i === A && this.#l === i)
      for (const {
        line: c,
        points: G
      } of this.#C)
        H._translate(c, s, d, c), H._translate(G, s, d, G);
    else {
      const c = this.#i / A, G = this.#l / i;
      this.#i = A, this.#l = i;
      for (const {
        line: b,
        points: o
      } of this.#C)
        H._rescale(b, s, d, c, G, b), H._rescale(o, s, d, c, G, o);
      l[2] *= c, l[3] *= G;
    }
    return l[0] = I, l[1] = g, {
      root: {
        viewBox: this.viewBox
      },
      path: {
        d: this.toSVGPath(),
        "transform-origin": `${H.svgRound(I)} ${H.svgRound(g)}`
      }
    };
  }
  get defaultSVGProperties() {
    const I = this.#I;
    return {
      root: {
        viewBox: this.viewBox
      },
      rootClass: {
        draw: !0
      },
      path: {
        d: this.toSVGPath(),
        "transform-origin": `${H.svgRound(I[0])} ${H.svgRound(I[1])}`,
        transform: this.rotationTransform || null
      },
      bbox: I
    };
  }
}
class JC extends Ll {
  constructor(I) {
    super(), this._viewParameters = I, super.updateProperties({
      fill: "none",
      stroke: F._defaultLineColor,
      "stroke-opacity": 1,
      "stroke-width": 1,
      "stroke-linecap": "round",
      "stroke-linejoin": "round",
      "stroke-miterlimit": 10
    });
  }
  updateSVGProperty(I, g) {
    I === "stroke-width" && (g ??= this["stroke-width"], g *= this._viewParameters.realScale), super.updateSVGProperty(I, g);
  }
  clone() {
    const I = new JC(this._viewParameters);
    return I.updateAll(this), I;
  }
}
class kA extends J {
  static _type = "ink";
  static _editorType = k.INK;
  static _defaultDrawingOptions = null;
  constructor(I) {
    super({
      ...I,
      name: "inkEditor"
    }), this._willKeepAspectRatio = !0, this.defaultL10nId = "pdfjs-editor-ink-editor";
  }
  static initialize(I, g) {
    F.initialize(I, g), this._defaultDrawingOptions = new JC(g.viewParameters);
  }
  static getDefaultDrawingOptions(I) {
    const g = this._defaultDrawingOptions.clone();
    return g.updateProperties(I), g;
  }
  static get supportMultipleDrawings() {
    return !0;
  }
  static get typesMap() {
    return T(this, "typesMap", /* @__PURE__ */ new Map([[j.INK_THICKNESS, "stroke-width"], [j.INK_COLOR, "stroke"], [j.INK_OPACITY, "stroke-opacity"]]));
  }
  static createDrawerInstance(I, g, C, A, i) {
    return new AZ(I, g, C, A, i, this._defaultDrawingOptions["stroke-width"]);
  }
  static deserializeDraw(I, g, C, A, i, l) {
    return iC.deserialize(I, g, C, A, i, l);
  }
  static async deserialize(I, g, C) {
    let A = null;
    if (I instanceof LA) {
      const {
        data: {
          inkLists: l,
          rect: s,
          rotation: d,
          id: c,
          color: G,
          opacity: b,
          borderStyle: {
            rawWidth: o
          },
          popupRef: m,
          richText: e,
          contentsObj: a,
          creationDate: h,
          modificationDate: t
        },
        parent: {
          page: {
            pageNumber: W
          }
        }
      } = I;
      A = I = {
        annotationType: k.INK,
        color: Array.from(G),
        thickness: o,
        opacity: b,
        paths: {
          points: l
        },
        boxes: null,
        pageIndex: W - 1,
        rect: s.slice(0),
        rotation: d,
        annotationElementId: c,
        id: c,
        deleted: !1,
        popupRef: m,
        richText: e,
        comment: a?.str || null,
        creationDate: h,
        modificationDate: t
      };
    }
    const i = await super.deserialize(I, g, C);
    return i._initialData = A, I.comment && i.setCommentData(I), i;
  }
  get toolbarButtons() {
    return this._colorPicker ||= new Pg(this), [["colorPicker", this._colorPicker]];
  }
  get colorType() {
    return j.INK_COLOR;
  }
  get color() {
    return this._drawingOptions.stroke;
  }
  get opacity() {
    return this._drawingOptions["stroke-opacity"];
  }
  onScaleChanging() {
    if (!this.parent)
      return;
    super.onScaleChanging();
    const {
      _drawId: I,
      _drawingOptions: g,
      parent: C
    } = this;
    g.updateSVGProperty("stroke-width"), C.drawLayer.updateProperties(I, g.toSVGProperties());
  }
  static onScaleChangingWhenDrawing() {
    const I = this._currentParent;
    I && (super.onScaleChangingWhenDrawing(), this._defaultDrawingOptions.updateSVGProperty("stroke-width"), I.drawLayer.updateProperties(this._currentDrawId, this._defaultDrawingOptions.toSVGProperties()));
  }
  createDrawingOptions({
    color: I,
    thickness: g,
    opacity: C
  }) {
    this._drawingOptions = kA.getDefaultDrawingOptions({
      stroke: M.makeHexColor(...I),
      "stroke-width": g,
      "stroke-opacity": C
    });
  }
  serialize(I = !1) {
    if (this.isEmpty())
      return null;
    if (this.deleted)
      return this.serializeDeleted();
    const {
      lines: g,
      points: C
    } = this.serializeDraw(I), {
      _drawingOptions: {
        stroke: A,
        "stroke-opacity": i,
        "stroke-width": l
      }
    } = this, s = Object.assign(super.serialize(I), {
      color: F._colorManager.convert(A),
      opacity: i,
      thickness: l,
      paths: {
        lines: g,
        points: C
      }
    });
    return this.addComment(s), I ? (s.isCopy = !0, s) : this.annotationElementId && !this.#I(s) ? null : (s.id = this.annotationElementId, s);
  }
  #I(I) {
    const {
      color: g,
      thickness: C,
      opacity: A,
      pageIndex: i
    } = this._initialData;
    return this.hasEditedComment || this._hasBeenMoved || this._hasBeenResized || I.color.some((l, s) => l !== g[s]) || I.thickness !== C || I.opacity !== A || I.pageIndex !== i;
  }
  renderAnnotationElement(I) {
    if (this.deleted)
      return I.hide(), null;
    const {
      points: g,
      rect: C
    } = this.serializeDraw(!1);
    return I.updateEdited({
      rect: C,
      thickness: this._drawingOptions["stroke-width"],
      points: g,
      popup: this.comment
    }), null;
  }
}
class WA extends iC {
  toSVGPath() {
    let I = super.toSVGPath();
    return I.endsWith("Z") || (I += "Z"), I;
  }
}
const aC = 8, zg = 3;
let Bg = class {
  static #I = {
    maxDim: 512,
    sigmaSFactor: 0.02,
    sigmaR: 25,
    kernelSize: 16
  };
  static #g(I, g, C, A) {
    return C -= I, A -= g, C === 0 ? A > 0 ? 0 : 4 : C === 1 ? A + 6 : 2 - A;
  }
  static #A = new Int32Array([0, 1, -1, 1, -1, 0, -1, -1, 0, -1, 1, -1, 1, 0, 1, 1]);
  static #C(I, g, C, A, i, l, s) {
    const d = this.#g(C, A, i, l);
    for (let c = 0; c < 8; c++) {
      const G = (-c + d - s + 16) % 8, b = this.#A[2 * G], o = this.#A[2 * G + 1];
      if (I[(C + b) * g + (A + o)] !== 0)
        return G;
    }
    return -1;
  }
  static #i(I, g, C, A, i, l, s) {
    const d = this.#g(C, A, i, l);
    for (let c = 0; c < 8; c++) {
      const G = (c + d + s + 16) % 8, b = this.#A[2 * G], o = this.#A[2 * G + 1];
      if (I[(C + b) * g + (A + o)] !== 0)
        return G;
    }
    return -1;
  }
  static #l(I, g, C, A) {
    const i = I.length, l = new Int32Array(i);
    for (let G = 0; G < i; G++)
      l[G] = I[G] <= A ? 1 : 0;
    for (let G = 1; G < C - 1; G++)
      l[G * g] = l[G * g + g - 1] = 0;
    for (let G = 0; G < g; G++)
      l[G] = l[g * C - 1 - G] = 0;
    let s = 1, d;
    const c = [];
    for (let G = 1; G < C - 1; G++) {
      d = 1;
      for (let b = 1; b < g - 1; b++) {
        const o = G * g + b, m = l[o];
        if (m === 0)
          continue;
        let e = G, a = b;
        if (m === 1 && l[o - 1] === 0)
          s += 1, a -= 1;
        else if (m >= 1 && l[o + 1] === 0)
          s += 1, a += 1, m > 1 && (d = m);
        else {
          m !== 1 && (d = Math.abs(m));
          continue;
        }
        const h = [b, G], t = a === b + 1, W = {
          isHole: t,
          points: h,
          id: s,
          parent: 0
        };
        c.push(W);
        let B;
        for (const X of c)
          if (X.id === d) {
            B = X;
            break;
          }
        B ? B.isHole ? W.parent = t ? B.parent : d : W.parent = t ? d : B.parent : W.parent = t ? d : 0;
        const w = this.#C(l, g, G, b, e, a, 0);
        if (w === -1) {
          l[o] = -s, l[o] !== 1 && (d = Math.abs(l[o]));
          continue;
        }
        let n = this.#A[2 * w], V = this.#A[2 * w + 1];
        const N = G + n, R = b + V;
        e = N, a = R;
        let Y = G, y = b;
        for (; ; ) {
          const X = this.#i(l, g, Y, y, e, a, 1);
          n = this.#A[2 * X], V = this.#A[2 * X + 1];
          const K = Y + n, S = y + V;
          h.push(S, K);
          const p = Y * g + y;
          if (l[p + 1] === 0 ? l[p] = -s : l[p] === 1 && (l[p] = s), K === G && S === b && Y === N && y === R) {
            l[o] !== 1 && (d = Math.abs(l[o]));
            break;
          } else
            e = Y, a = y, Y = K, y = S;
        }
      }
    }
    return c;
  }
  static #s(I, g, C, A) {
    if (C - g <= 4) {
      for (let N = g; N < C - 2; N += 2)
        A.push(I[N], I[N + 1]);
      return;
    }
    const i = I[g], l = I[g + 1], s = I[C - 4] - i, d = I[C - 3] - l, c = Math.hypot(s, d), G = s / c, b = d / c, o = G * l - b * i, m = d / s, e = 1 / c, a = Math.atan(m), h = Math.cos(a), t = Math.sin(a), W = e * (Math.abs(h) + Math.abs(t)), B = e * (1 - W + W ** 2), w = Math.max(Math.atan(Math.abs(t + h) * B), Math.atan(Math.abs(t - h) * B));
    let n = 0, V = g;
    for (let N = g + 2; N < C - 2; N += 2) {
      const R = Math.abs(o - G * I[N + 1] + b * I[N]);
      R > n && (V = N, n = R);
    }
    n > (c * w) ** 2 ? (this.#s(I, g, V + 2, A), this.#s(I, V, C, A)) : A.push(i, l);
  }
  static #d(I) {
    const g = [], C = I.length;
    return this.#s(I, 0, C, g), g.push(I[C - 2], I[C - 1]), g.length <= 4 ? null : g;
  }
  static #c(I, g, C, A, i, l) {
    const s = new Float32Array(l ** 2), d = -2 * A ** 2, c = l >> 1;
    for (let a = 0; a < l; a++) {
      const h = (a - c) ** 2;
      for (let t = 0; t < l; t++)
        s[a * l + t] = Math.exp((h + (t - c) ** 2) / d);
    }
    const G = new Float32Array(256), b = -2 * i ** 2;
    for (let a = 0; a < 256; a++)
      G[a] = Math.exp(a ** 2 / b);
    const o = I.length, m = new Uint8Array(o), e = new Uint32Array(256);
    for (let a = 0; a < C; a++)
      for (let h = 0; h < g; h++) {
        const t = a * g + h, W = I[t];
        let B = 0, w = 0;
        for (let V = 0; V < l; V++) {
          const N = a + V - c;
          if (!(N < 0 || N >= C))
            for (let R = 0; R < l; R++) {
              const Y = h + R - c;
              if (Y < 0 || Y >= g)
                continue;
              const y = I[N * g + Y], X = s[V * l + R] * G[Math.abs(y - W)];
              B += y * X, w += X;
            }
        }
        const n = m[t] = Math.round(B / w);
        e[n]++;
      }
    return [m, e];
  }
  static #Z(I) {
    const g = new Uint32Array(256);
    for (const C of I)
      g[C]++;
    return g;
  }
  static #o(I) {
    const g = I.length, C = new Uint8ClampedArray(g >> 2);
    let A = -1 / 0, i = 1 / 0;
    for (let s = 0, d = C.length; s < d; s++) {
      const c = C[s] = I[s << 2];
      A = Math.max(A, c), i = Math.min(i, c);
    }
    const l = 255 / (A - i);
    for (let s = 0, d = C.length; s < d; s++)
      C[s] = (C[s] - i) * l;
    return C;
  }
  static #b(I) {
    let g, C = -1 / 0, A = -1 / 0;
    const i = I.findIndex((d) => d !== 0);
    let l = i, s = i;
    for (g = i; g < 256; g++) {
      const d = I[g];
      d > C && (g - l > A && (A = g - l, s = g - 1), C = d, l = g);
    }
    for (g = s - 1; g >= 0 && !(I[g] > I[g + 1]); g--)
      ;
    return g;
  }
  static #m(I) {
    const g = I, {
      width: C,
      height: A
    } = I, {
      maxDim: i
    } = this.#I;
    let l = C, s = A;
    if (C > i || A > i) {
      let o = C, m = A, e = Math.log2(Math.max(C, A) / i);
      const a = Math.floor(e);
      e = e === a ? a - 1 : a;
      for (let t = 0; t < e; t++) {
        l = Math.ceil(o / 2), s = Math.ceil(m / 2);
        const W = new OffscreenCanvas(l, s);
        W.getContext("2d").drawImage(I, 0, 0, o, m, 0, 0, l, s), o = l, m = s, I !== g && I.close(), I = W.transferToImageBitmap();
      }
      const h = Math.min(i / l, i / s);
      l = Math.round(l * h), s = Math.round(s * h);
    }
    const c = new OffscreenCanvas(l, s).getContext("2d", {
      willReadFrequently: !0
    });
    c.fillStyle = "white", c.fillRect(0, 0, l, s), c.filter = "grayscale(1)", c.drawImage(I, 0, 0, I.width, I.height, 0, 0, l, s);
    const G = c.getImageData(0, 0, l, s).data;
    return [this.#o(G), l, s];
  }
  static extractContoursFromText(I, {
    fontFamily: g,
    fontStyle: C,
    fontWeight: A
  }, i, l, s, d) {
    let c = new OffscreenCanvas(1, 1), G = c.getContext("2d", {
      alpha: !1
    });
    const b = 200, o = G.font = `${C} ${A} ${b}px ${g}`, {
      actualBoundingBoxLeft: m,
      actualBoundingBoxRight: e,
      actualBoundingBoxAscent: a,
      actualBoundingBoxDescent: h,
      fontBoundingBoxAscent: t,
      fontBoundingBoxDescent: W,
      width: B
    } = G.measureText(I), w = 1.5, n = Math.ceil(Math.max(Math.abs(m) + Math.abs(e) || 0, B) * w), V = Math.ceil(Math.max(Math.abs(a) + Math.abs(h) || b, Math.abs(t) + Math.abs(W) || b) * w);
    c = new OffscreenCanvas(n, V), G = c.getContext("2d", {
      alpha: !0,
      willReadFrequently: !0
    }), G.font = o, G.filter = "grayscale(1)", G.fillStyle = "white", G.fillRect(0, 0, n, V), G.fillStyle = "black", G.fillText(I, n * (w - 1) / 2, V * (3 - w) / 2);
    const N = this.#o(G.getImageData(0, 0, n, V).data), R = this.#Z(N), Y = this.#b(R), y = this.#l(N, n, V, Y);
    return this.processDrawnLines({
      lines: {
        curves: y,
        width: n,
        height: V
      },
      pageWidth: i,
      pageHeight: l,
      rotation: s,
      innerMargin: d,
      mustSmooth: !0,
      areContours: !0
    });
  }
  static process(I, g, C, A, i) {
    const [l, s, d] = this.#m(I), [c, G] = this.#c(l, s, d, Math.hypot(s, d) * this.#I.sigmaSFactor, this.#I.sigmaR, this.#I.kernelSize), b = this.#b(G), o = this.#l(c, s, d, b);
    return this.processDrawnLines({
      lines: {
        curves: o,
        width: s,
        height: d
      },
      pageWidth: g,
      pageHeight: C,
      rotation: A,
      innerMargin: i,
      mustSmooth: !0,
      areContours: !0
    });
  }
  static processDrawnLines({
    lines: I,
    pageWidth: g,
    pageHeight: C,
    rotation: A,
    innerMargin: i,
    mustSmooth: l,
    areContours: s
  }) {
    A % 180 !== 0 && ([g, C] = [C, g]);
    const {
      curves: d,
      width: c,
      height: G
    } = I, b = I.thickness ?? 0, o = [], m = Math.min(g / c, C / G), e = m / g, a = m / C, h = [];
    for (const {
      points: W
    } of d) {
      const B = l ? this.#d(W) : W;
      if (!B)
        continue;
      h.push(B);
      const w = B.length, n = new Float32Array(w), V = new Float32Array(3 * (w === 2 ? 2 : w - 2));
      if (o.push({
        line: V,
        points: n
      }), w === 2) {
        n[0] = B[0] * e, n[1] = B[1] * a, V.set([NaN, NaN, NaN, NaN, n[0], n[1]], 0);
        continue;
      }
      let [N, R, Y, y] = B;
      N *= e, R *= a, Y *= e, y *= a, n.set([N, R, Y, y], 0), V.set([NaN, NaN, NaN, NaN, N, R], 0);
      for (let X = 4; X < w; X += 2) {
        const K = n[X] = B[X] * e, S = n[X + 1] = B[X + 1] * a;
        V.set(H.createBezierPoints(N, R, Y, y, K, S), (X - 2) * 3), [N, R, Y, y] = [Y, y, K, S];
      }
    }
    if (o.length === 0)
      return null;
    const t = s ? new WA() : new iC();
    return t.build(o, g, C, 1, A, s ? 0 : b, i), {
      outline: t,
      newCurves: h,
      areContours: s,
      thickness: b,
      width: c,
      height: G
    };
  }
  static async compressSignature({
    outlines: I,
    areContours: g,
    thickness: C,
    width: A,
    height: i
  }) {
    let l = 1 / 0, s = -1 / 0, d = 0;
    for (const B of I) {
      d += B.length;
      for (let w = 2, n = B.length; w < n; w++) {
        const V = B[w] - B[w - 2];
        l = Math.min(l, V), s = Math.max(s, V);
      }
    }
    let c;
    l >= -128 && s <= 127 ? c = Int8Array : l >= -32768 && s <= 32767 ? c = Int16Array : c = Int32Array;
    const G = I.length, b = aC + zg * G, o = new Uint32Array(b);
    let m = 0;
    o[m++] = b * Uint32Array.BYTES_PER_ELEMENT + (d - 2 * G) * c.BYTES_PER_ELEMENT, o[m++] = 0, o[m++] = A, o[m++] = i, o[m++] = g ? 0 : 1, o[m++] = Math.max(0, Math.floor(C ?? 0)), o[m++] = G, o[m++] = c.BYTES_PER_ELEMENT;
    for (const B of I)
      o[m++] = B.length - 2, o[m++] = B[0], o[m++] = B[1];
    const e = new CompressionStream("deflate-raw"), a = e.writable.getWriter();
    await a.ready, a.write(o);
    const h = c.prototype.constructor;
    for (const B of I) {
      const w = new h(B.length - 2);
      for (let n = 2, V = B.length; n < V; n++)
        w[n - 2] = B[n] - B[n - 2];
      a.write(w);
    }
    a.close();
    const t = await new Response(e.readable).arrayBuffer(), W = new Uint8Array(t);
    return ll(W);
  }
  static async decompressSignature(I) {
    try {
      const g = Ws(I), {
        readable: C,
        writable: A
      } = new DecompressionStream("deflate-raw"), i = A.getWriter();
      await i.ready, i.write(g).then(async () => {
        await i.ready, await i.close();
      }).catch(() => {
      });
      let l = null, s = 0;
      for await (const B of C)
        l ||= new Uint8Array(new Uint32Array(B.buffer, 0, 4)[0]), l.set(B, s), s += B.length;
      const d = new Uint32Array(l.buffer, 0, l.length >> 2), c = d[1];
      if (c !== 0)
        throw new Error(`Invalid version: ${c}`);
      const G = d[2], b = d[3], o = d[4] === 0, m = d[5], e = d[6], a = d[7], h = [], t = (aC + zg * e) * Uint32Array.BYTES_PER_ELEMENT;
      let W;
      switch (a) {
        case Int8Array.BYTES_PER_ELEMENT:
          W = new Int8Array(l.buffer, t);
          break;
        case Int16Array.BYTES_PER_ELEMENT:
          W = new Int16Array(l.buffer, t);
          break;
        case Int32Array.BYTES_PER_ELEMENT:
          W = new Int32Array(l.buffer, t);
          break;
      }
      s = 0;
      for (let B = 0; B < e; B++) {
        const w = d[zg * B + aC], n = new Float32Array(w + 2);
        h.push(n);
        for (let V = 0; V < zg - 1; V++)
          n[V] = d[zg * B + aC + V + 1];
        for (let V = 0; V < w; V++)
          n[V + 2] = n[V] + W[s++];
      }
      return {
        areContours: o,
        thickness: m,
        outlines: h,
        width: G,
        height: b
      };
    } catch (g) {
      return L(`decompressSignature: ${g}`), null;
    }
  }
};
class rA extends Ll {
  constructor() {
    super(), super.updateProperties({
      fill: F._defaultLineColor,
      "stroke-width": 0
    });
  }
  clone() {
    const I = new rA();
    return I.updateAll(this), I;
  }
}
class TA extends JC {
  constructor(I) {
    super(I), super.updateProperties({
      stroke: F._defaultLineColor,
      "stroke-width": 1
    });
  }
  clone() {
    const I = new TA(this._viewParameters);
    return I.updateAll(this), I;
  }
}
class pI extends J {
  #I = !1;
  #g = null;
  #A = null;
  #C = null;
  static _type = "signature";
  static _editorType = k.SIGNATURE;
  static _defaultDrawingOptions = null;
  constructor(I) {
    super({
      ...I,
      mustBeCommitted: !0,
      name: "signatureEditor"
    }), this._willKeepAspectRatio = !0, this.#A = I.signatureData || null, this.#g = null, this.defaultL10nId = "pdfjs-editor-signature-editor1";
  }
  static initialize(I, g) {
    F.initialize(I, g), this._defaultDrawingOptions = new rA(), this._defaultDrawnSignatureOptions = new TA(g.viewParameters);
  }
  static getDefaultDrawingOptions(I) {
    const g = this._defaultDrawingOptions.clone();
    return g.updateProperties(I), g;
  }
  static get supportMultipleDrawings() {
    return !1;
  }
  static get typesMap() {
    return T(this, "typesMap", /* @__PURE__ */ new Map());
  }
  static get isDrawer() {
    return !1;
  }
  get telemetryFinalData() {
    return {
      type: "signature",
      hasDescription: !!this.#g
    };
  }
  static computeTelemetryFinalData(I) {
    const g = I.get("hasDescription");
    return {
      hasAltText: g.get(!0) ?? 0,
      hasNoAltText: g.get(!1) ?? 0
    };
  }
  get isResizable() {
    return !0;
  }
  onScaleChanging() {
    this._drawId !== null && super.onScaleChanging();
  }
  render() {
    if (this.div)
      return this.div;
    let I, g;
    const {
      _isCopy: C
    } = this;
    if (C && (this._isCopy = !1, I = this.x, g = this.y), super.render(), this._drawId === null)
      if (this.#A) {
        const {
          lines: A,
          mustSmooth: i,
          areContours: l,
          description: s,
          uuid: d,
          heightInPage: c
        } = this.#A, {
          rawDims: {
            pageWidth: G,
            pageHeight: b
          },
          rotation: o
        } = this.parent.viewport, m = Bg.processDrawnLines({
          lines: A,
          pageWidth: G,
          pageHeight: b,
          rotation: o,
          innerMargin: pI._INNER_MARGIN,
          mustSmooth: i,
          areContours: l
        });
        this.addSignature(m, c, s, d);
      } else
        this.div.setAttribute("data-l10n-args", JSON.stringify({
          description: ""
        })), this.div.hidden = !0, this._uiManager.getSignature(this);
    else
      this.div.setAttribute("data-l10n-args", JSON.stringify({
        description: this.#g || ""
      }));
    return C && (this._isCopy = !0, this._moveAfterPaste(I, g)), this.div;
  }
  setUuid(I) {
    this.#C = I, this.addEditToolbar();
  }
  getUuid() {
    return this.#C;
  }
  get description() {
    return this.#g;
  }
  set description(I) {
    this.#g = I, this.div && (this.div.setAttribute("data-l10n-args", JSON.stringify({
      description: I
    })), super.addEditToolbar().then((g) => {
      g?.updateEditSignatureButton(I);
    }));
  }
  getSignaturePreview() {
    const {
      newCurves: I,
      areContours: g,
      thickness: C,
      width: A,
      height: i
    } = this.#A, l = Math.max(A, i), s = Bg.processDrawnLines({
      lines: {
        curves: I.map((d) => ({
          points: d
        })),
        thickness: C,
        width: A,
        height: i
      },
      pageWidth: l,
      pageHeight: l,
      rotation: 0,
      innerMargin: 0,
      mustSmooth: !1,
      areContours: g
    });
    return {
      areContours: g,
      outline: s.outline
    };
  }
  get toolbarButtons() {
    return this._uiManager.signatureManager ? [["editSignature", this._uiManager.signatureManager]] : super.toolbarButtons;
  }
  addSignature(I, g, C, A) {
    const {
      x: i,
      y: l
    } = this, {
      outline: s
    } = this.#A = I;
    this.#I = s instanceof WA, this.description = C;
    let d;
    this.#I ? d = pI.getDefaultDrawingOptions() : (d = pI._defaultDrawnSignatureOptions.clone(), d.updateProperties({
      "stroke-width": s.thickness
    })), this._addOutlines({
      drawOutlines: s,
      drawingOptions: d
    });
    const [, c] = this.pageDimensions;
    let G = g / c;
    G = G >= 1 ? 0.5 : G, this.width *= G / this.height, this.width >= 1 && (G *= 0.9 / this.width, this.width = 0.9), this.height = G, this.setDims(), this.x = i, this.y = l, this.center(), this._onResized(), this.onScaleChanging(), this.rotate(), this._uiManager.addToAnnotationStorage(this), this.setUuid(A), this._reportTelemetry({
      action: "pdfjs.signature.inserted",
      data: {
        hasBeenSaved: !!A,
        hasDescription: !!C
      }
    }), this.div.hidden = !1;
  }
  getFromImage(I) {
    const {
      rawDims: {
        pageWidth: g,
        pageHeight: C
      },
      rotation: A
    } = this.parent.viewport;
    return Bg.process(I, g, C, A, pI._INNER_MARGIN);
  }
  getFromText(I, g) {
    const {
      rawDims: {
        pageWidth: C,
        pageHeight: A
      },
      rotation: i
    } = this.parent.viewport;
    return Bg.extractContoursFromText(I, g, C, A, i, pI._INNER_MARGIN);
  }
  getDrawnSignature(I) {
    const {
      rawDims: {
        pageWidth: g,
        pageHeight: C
      },
      rotation: A
    } = this.parent.viewport;
    return Bg.processDrawnLines({
      lines: I,
      pageWidth: g,
      pageHeight: C,
      rotation: A,
      innerMargin: pI._INNER_MARGIN,
      mustSmooth: !1,
      areContours: !1
    });
  }
  createDrawingOptions({
    areContours: I,
    thickness: g
  }) {
    I ? this._drawingOptions = pI.getDefaultDrawingOptions() : (this._drawingOptions = pI._defaultDrawnSignatureOptions.clone(), this._drawingOptions.updateProperties({
      "stroke-width": g
    }));
  }
  serialize(I = !1) {
    if (this.isEmpty())
      return null;
    const {
      lines: g,
      points: C
    } = this.serializeDraw(I), {
      _drawingOptions: {
        "stroke-width": A
      }
    } = this, i = Object.assign(super.serialize(I), {
      isSignature: !0,
      areContours: this.#I,
      color: [0, 0, 0],
      thickness: this.#I ? 0 : A
    });
    return this.addComment(i), I ? (i.paths = {
      lines: g,
      points: C
    }, i.uuid = this.#C, i.isCopy = !0) : i.lines = g, this.#g && (i.accessibilityData = {
      type: "Figure",
      alt: this.#g
    }), i;
  }
  static deserializeDraw(I, g, C, A, i, l) {
    return l.areContours ? WA.deserialize(I, g, C, A, i, l) : iC.deserialize(I, g, C, A, i, l);
  }
  static async deserialize(I, g, C) {
    const A = await super.deserialize(I, g, C);
    return A.#I = I.areContours, A.description = I.accessibilityData?.alt || "", A.#C = I.uuid, A;
  }
}
class iZ extends F {
  #I = null;
  #g = null;
  #A = null;
  #C = null;
  #i = null;
  #l = "";
  #s = null;
  #d = !1;
  #c = null;
  #Z = !1;
  #o = !1;
  static _type = "stamp";
  static _editorType = k.STAMP;
  constructor(I) {
    super({
      ...I,
      name: "stampEditor"
    }), this.#C = I.bitmapUrl, this.#i = I.bitmapFile, this.defaultL10nId = "pdfjs-editor-stamp-editor";
  }
  static initialize(I, g) {
    F.initialize(I, g);
  }
  static isHandlingMimeForPasting(I) {
    return ZA.includes(I);
  }
  static paste(I, g) {
    g.pasteEditor({
      mode: k.STAMP
    }, {
      bitmapFile: I.getAsFile()
    });
  }
  altTextFinish() {
    this._uiManager.useNewAltTextFlow && (this.div.hidden = !1), super.altTextFinish();
  }
  get telemetryFinalData() {
    return {
      type: "stamp",
      hasAltText: !!this.altTextData?.altText
    };
  }
  static computeTelemetryFinalData(I) {
    const g = I.get("hasAltText");
    return {
      hasAltText: g.get(!0) ?? 0,
      hasNoAltText: g.get(!1) ?? 0
    };
  }
  #b(I, g = !1) {
    if (!I) {
      this.remove();
      return;
    }
    this.#I = I.bitmap, g || (this.#g = I.id, this.#Z = I.isSvg), I.file && (this.#l = I.file.name), this.#a();
  }
  #m() {
    if (this.#A = null, this._uiManager.enableWaiting(!1), !!this.#s) {
      if (this._uiManager.useNewAltTextWhenAddingImage && this._uiManager.useNewAltTextFlow && this.#I) {
        this.addEditToolbar().then(() => {
          this._editToolbar.hide(), this._uiManager.editAltText(this, !0);
        });
        return;
      }
      if (!this._uiManager.useNewAltTextWhenAddingImage && this._uiManager.useNewAltTextFlow && this.#I) {
        this._reportTelemetry({
          action: "pdfjs.image.image_added",
          data: {
            alt_text_modal: !1,
            alt_text_type: "empty"
          }
        });
        try {
          this.mlGuessAltText();
        } catch {
        }
      }
      this.div.focus();
    }
  }
  async mlGuessAltText(I = null, g = !0) {
    if (this.hasAltTextData())
      return null;
    const {
      mlManager: C
    } = this._uiManager;
    if (!C)
      throw new Error("No ML.");
    if (!await C.isEnabledFor("altText"))
      throw new Error("ML isn't enabled for alt text.");
    const {
      data: A,
      width: i,
      height: l
    } = I || this.copyCanvas(null, null, !0).imageData, s = await C.guess({
      name: "altText",
      request: {
        data: A,
        width: i,
        height: l,
        channels: A.length / (i * l)
      }
    });
    if (!s)
      throw new Error("No response from the AI service.");
    if (s.error)
      throw new Error("Error from the AI service.");
    if (s.cancel)
      return null;
    if (!s.output)
      throw new Error("No valid response from the AI service.");
    const d = s.output;
    return await this.setGuessedAltText(d), g && !this.hasAltTextData() && (this.altTextData = {
      alt: d,
      decorative: !1
    }), d;
  }
  #t() {
    if (this.#g) {
      this._uiManager.enableWaiting(!0), this._uiManager.imageManager.getFromId(this.#g).then((C) => this.#b(C, !0)).finally(() => this.#m());
      return;
    }
    if (this.#C) {
      const C = this.#C;
      this.#C = null, this._uiManager.enableWaiting(!0), this.#A = this._uiManager.imageManager.getFromUrl(C).then((A) => this.#b(A)).finally(() => this.#m());
      return;
    }
    if (this.#i) {
      const C = this.#i;
      this.#i = null, this._uiManager.enableWaiting(!0), this.#A = this._uiManager.imageManager.getFromFile(C).then((A) => this.#b(A)).finally(() => this.#m());
      return;
    }
    const I = document.createElement("input");
    I.type = "file", I.accept = ZA.join(",");
    const g = this._uiManager._signal;
    this.#A = new Promise((C) => {
      I.addEventListener("change", async () => {
        if (!I.files || I.files.length === 0)
          this.remove();
        else {
          this._uiManager.enableWaiting(!0);
          const A = await this._uiManager.imageManager.getFromFile(I.files[0]);
          this._reportTelemetry({
            action: "pdfjs.image.image_selected",
            data: {
              alt_text_modal: this._uiManager.useNewAltTextFlow
            }
          }), this.#b(A);
        }
        C();
      }, {
        signal: g
      }), I.addEventListener("cancel", () => {
        this.remove(), C();
      }, {
        signal: g
      });
    }).finally(() => this.#m()), I.click();
  }
  remove() {
    this.#g && (this.#I = null, this._uiManager.imageManager.deleteId(this.#g), this.#s?.remove(), this.#s = null, this.#c && (clearTimeout(this.#c), this.#c = null)), super.remove();
  }
  rebuild() {
    if (!this.parent) {
      this.#g && this.#t();
      return;
    }
    super.rebuild(), this.div !== null && (this.#g && this.#s === null && this.#t(), this.isAttachedToDOM || this.parent.add(this));
  }
  onceAdded(I) {
    this._isDraggable = !0, I && this.div.focus();
  }
  isEmpty() {
    return !(this.#A || this.#I || this.#C || this.#i || this.#g || this.#d);
  }
  get toolbarButtons() {
    return [["altText", this.createAltText()]];
  }
  get isResizable() {
    return !0;
  }
  render() {
    if (this.div)
      return this.div;
    let I, g;
    return this._isCopy && (I = this.x, g = this.y), super.render(), this.div.hidden = !0, this.createAltText(), this.#d || (this.#I ? this.#a() : this.#t()), this._isCopy && this._moveAfterPaste(I, g), this._uiManager.addShouldRescale(this), this.div;
  }
  setCanvas(I, g) {
    const {
      id: C,
      bitmap: A
    } = this._uiManager.imageManager.getFromCanvas(I, g);
    g.remove(), C && this._uiManager.imageManager.isValidId(C) && (this.#g = C, A && (this.#I = A), this.#d = !1, this.#a());
  }
  _onResized() {
    this.onScaleChanging();
  }
  onScaleChanging() {
    if (!this.parent)
      return;
    this.#c !== null && clearTimeout(this.#c);
    const I = 200;
    this.#c = setTimeout(() => {
      this.#c = null, this.#e();
    }, I);
  }
  #a() {
    const {
      div: I
    } = this;
    let {
      width: g,
      height: C
    } = this.#I;
    const [A, i] = this.pageDimensions, l = 0.75;
    if (this.width)
      g = this.width * A, C = this.height * i;
    else if (g > l * A || C > l * i) {
      const d = Math.min(l * A / g, l * i / C);
      g *= d, C *= d;
    }
    this._uiManager.enableWaiting(!1);
    const s = this.#s = document.createElement("canvas");
    s.setAttribute("role", "img"), this.addContainer(s), this.width = g / A, this.height = C / i, this.setDims(), this._initialOptions?.isCentered ? this.center() : this.fixAndSetPosition(), this._initialOptions = null, (!this._uiManager.useNewAltTextWhenAddingImage || !this._uiManager.useNewAltTextFlow || this.annotationElementId) && (I.hidden = !1), this.#e(), this.#o || (this.parent.addUndoableEditor(this), this.#o = !0), this._reportTelemetry({
      action: "inserted_image"
    }), this.#l && this.div.setAttribute("aria-description", this.#l), this.annotationElementId || this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert");
  }
  copyCanvas(I, g, C = !1) {
    I || (I = 224);
    const {
      width: A,
      height: i
    } = this.#I, l = new Gg();
    let s = this.#I, d = A, c = i, G = null;
    if (g) {
      if (A > g || i > g) {
        const V = Math.min(g / A, g / i);
        d = Math.floor(A * V), c = Math.floor(i * V);
      }
      G = document.createElement("canvas");
      const o = G.width = Math.ceil(d * l.sx), m = G.height = Math.ceil(c * l.sy);
      this.#Z || (s = this.#G(o, m));
      const e = G.getContext("2d");
      e.filter = this._uiManager.hcmFilter;
      let a = "white", h = "#cfcfd8";
      this._uiManager.hcmFilter !== "none" ? h = "black" : us.isDarkMode && (a = "#8f8f9d", h = "#42414d");
      const t = 15, W = t * l.sx, B = t * l.sy, w = new OffscreenCanvas(W * 2, B * 2), n = w.getContext("2d");
      n.fillStyle = a, n.fillRect(0, 0, W * 2, B * 2), n.fillStyle = h, n.fillRect(0, 0, W, B), n.fillRect(W, B, W, B), e.fillStyle = e.createPattern(w, "repeat"), e.fillRect(0, 0, o, m), e.drawImage(s, 0, 0, s.width, s.height, 0, 0, o, m);
    }
    let b = null;
    if (C) {
      let o, m;
      if (l.symmetric && s.width < I && s.height < I)
        o = s.width, m = s.height;
      else if (s = this.#I, A > I || i > I) {
        const h = Math.min(I / A, I / i);
        o = Math.floor(A * h), m = Math.floor(i * h), this.#Z || (s = this.#G(o, m));
      }
      const a = new OffscreenCanvas(o, m).getContext("2d", {
        willReadFrequently: !0
      });
      a.drawImage(s, 0, 0, s.width, s.height, 0, 0, o, m), b = {
        width: o,
        height: m,
        data: a.getImageData(0, 0, o, m).data
      };
    }
    return {
      canvas: G,
      width: d,
      height: c,
      imageData: b
    };
  }
  #G(I, g) {
    const {
      width: C,
      height: A
    } = this.#I;
    let i = C, l = A, s = this.#I;
    for (; i > 2 * I || l > 2 * g; ) {
      const d = i, c = l;
      i > 2 * I && (i = i >= 16384 ? Math.floor(i / 2) - 1 : Math.ceil(i / 2)), l > 2 * g && (l = l >= 16384 ? Math.floor(l / 2) - 1 : Math.ceil(l / 2));
      const G = new OffscreenCanvas(i, l);
      G.getContext("2d").drawImage(s, 0, 0, d, c, 0, 0, i, l), s = G.transferToImageBitmap();
    }
    return s;
  }
  #e() {
    const [I, g] = this.parentDimensions, {
      width: C,
      height: A
    } = this, i = new Gg(), l = Math.ceil(C * I * i.sx), s = Math.ceil(A * g * i.sy), d = this.#s;
    if (!d || d.width === l && d.height === s)
      return;
    d.width = l, d.height = s;
    const c = this.#Z ? this.#I : this.#G(l, s), G = d.getContext("2d");
    G.filter = this._uiManager.hcmFilter, G.drawImage(c, 0, 0, c.width, c.height, 0, 0, l, s);
  }
  #B(I) {
    if (I) {
      if (this.#Z) {
        const A = this._uiManager.imageManager.getSvgUrl(this.#g);
        if (A)
          return A;
      }
      const g = document.createElement("canvas");
      return {
        width: g.width,
        height: g.height
      } = this.#I, g.getContext("2d").drawImage(this.#I, 0, 0), g.toDataURL();
    }
    if (this.#Z) {
      const [g, C] = this.pageDimensions, A = Math.round(this.width * g * Hg.PDF_TO_CSS_UNITS), i = Math.round(this.height * C * Hg.PDF_TO_CSS_UNITS), l = new OffscreenCanvas(A, i);
      return l.getContext("2d").drawImage(this.#I, 0, 0, this.#I.width, this.#I.height, 0, 0, A, i), l.transferToImageBitmap();
    }
    return structuredClone(this.#I);
  }
  static async deserialize(I, g, C) {
    let A = null, i = !1;
    if (I instanceof pl) {
      const {
        data: {
          rect: a,
          rotation: h,
          id: t,
          structParent: W,
          popupRef: B,
          richText: w,
          contentsObj: n,
          creationDate: V,
          modificationDate: N
        },
        container: R,
        parent: {
          page: {
            pageNumber: Y
          }
        },
        canvas: y
      } = I;
      let X, K;
      y ? (delete I.canvas, {
        id: X,
        bitmap: K
      } = C.imageManager.getFromCanvas(R.id, y), y.remove()) : (i = !0, I._hasNoCanvas = !0);
      const S = (await g._structTree.getAriaAttributes(`${yA}${t}`))?.get("aria-label") || "";
      A = I = {
        annotationType: k.STAMP,
        bitmapId: X,
        bitmap: K,
        pageIndex: Y - 1,
        rect: a.slice(0),
        rotation: h,
        annotationElementId: t,
        id: t,
        deleted: !1,
        accessibilityData: {
          decorative: !1,
          altText: S
        },
        isSvg: !1,
        structParent: W,
        popupRef: B,
        richText: w,
        comment: n?.str || null,
        creationDate: V,
        modificationDate: N
      };
    }
    const l = await super.deserialize(I, g, C), {
      rect: s,
      bitmap: d,
      bitmapUrl: c,
      bitmapId: G,
      isSvg: b,
      accessibilityData: o
    } = I;
    i ? (C.addMissingCanvas(I.id, l), l.#d = !0) : G && C.imageManager.isValidId(G) ? (l.#g = G, d && (l.#I = d)) : l.#C = c, l.#Z = b;
    const [m, e] = l.pageDimensions;
    return l.width = (s[2] - s[0]) / m, l.height = (s[3] - s[1]) / e, o && (l.altTextData = o), l._initialData = A, I.comment && l.setCommentData(I), l.#o = !!A, l;
  }
  serialize(I = !1, g = null) {
    if (this.isEmpty())
      return null;
    if (this.deleted)
      return this.serializeDeleted();
    const C = Object.assign(super.serialize(I), {
      bitmapId: this.#g,
      isSvg: this.#Z
    });
    if (this.addComment(C), I)
      return C.bitmapUrl = this.#B(!0), C.accessibilityData = this.serializeAltText(!0), C.isCopy = !0, C;
    const {
      decorative: A,
      altText: i
    } = this.serializeAltText(!1);
    if (!A && i && (C.accessibilityData = {
      type: "Figure",
      alt: i
    }), this.annotationElementId) {
      const s = this.#W(C);
      return s.isSame ? null : (s.isSameAltText ? delete C.accessibilityData : C.accessibilityData.structParent = this._initialData.structParent ?? -1, C.id = this.annotationElementId, delete C.bitmapId, C);
    }
    if (g === null)
      return C;
    g.stamps ||= /* @__PURE__ */ new Map();
    const l = this.#Z ? (C.rect[2] - C.rect[0]) * (C.rect[3] - C.rect[1]) : null;
    if (!g.stamps.has(this.#g))
      g.stamps.set(this.#g, {
        area: l,
        serialized: C
      }), C.bitmap = this.#B(!1);
    else if (this.#Z) {
      const s = g.stamps.get(this.#g);
      l > s.area && (s.area = l, s.serialized.bitmap.close(), s.serialized.bitmap = this.#B(!1));
    }
    return C;
  }
  #W(I) {
    const {
      pageIndex: g,
      accessibilityData: {
        altText: C
      }
    } = this._initialData, A = I.pageIndex === g, i = (I.accessibilityData?.alt || "") === C;
    return {
      isSame: !this.hasEditedComment && !this._hasBeenMoved && !this._hasBeenResized && A && i,
      isSameAltText: i
    };
  }
  renderAnnotationElement(I) {
    return this.deleted ? (I.hide(), null) : (I.updateEdited({
      rect: this.getPDFRect(),
      popup: this.comment
    }), null);
  }
}
let lZ = class PI {
  #I;
  #g = !1;
  #A = null;
  #C = null;
  #i = null;
  #l = /* @__PURE__ */ new Map();
  #s = !1;
  #d = !1;
  #c = !1;
  #Z = null;
  #o = null;
  #b = null;
  #m = null;
  #t = null;
  #a = -1;
  #G;
  static _initialized = !1;
  static #e = new Map([dI, kA, iZ, gI, pI].map((I) => [I._editorType, I]));
  constructor({
    uiManager: I,
    pageIndex: g,
    div: C,
    structTreeLayer: A,
    accessibilityManager: i,
    annotationLayer: l,
    drawLayer: s,
    textLayer: d,
    viewport: c,
    l10n: G
  }) {
    const b = [...PI.#e.values()];
    if (!PI._initialized) {
      PI._initialized = !0;
      for (const o of b)
        o.initialize(G, I);
    }
    I.registerEditorTypes(b), this.#G = I, this.pageIndex = g, this.div = C, this.#I = i, this.#A = l, this.viewport = c, this.#b = d, this.drawLayer = s, this._structTree = A, this.#G.addLayer(this);
  }
  get isEmpty() {
    return this.#l.size === 0;
  }
  get isInvisible() {
    return this.isEmpty && this.#G.getMode() === k.NONE;
  }
  updateToolbar(I) {
    this.#G.updateToolbar(I);
  }
  updateMode(I = this.#G.getMode()) {
    switch (this.#n(), I) {
      case k.NONE:
        this.div.classList.toggle("nonEditing", !0), this.disableTextSelection(), this.togglePointerEvents(!1), this.toggleAnnotationLayerPointerEvents(!0), this.disableClick();
        return;
      case k.INK:
        this.disableTextSelection(), this.togglePointerEvents(!0), this.enableClick();
        break;
      case k.HIGHLIGHT:
        this.enableTextSelection(), this.togglePointerEvents(!1), this.disableClick();
        break;
      default:
        this.disableTextSelection(), this.togglePointerEvents(!0), this.enableClick();
    }
    this.toggleAnnotationLayerPointerEvents(!1);
    const {
      classList: g
    } = this.div;
    if (g.toggle("nonEditing", !1), I === k.POPUP)
      g.toggle("commentEditing", !0);
    else {
      g.toggle("commentEditing", !1);
      for (const C of PI.#e.values())
        g.toggle(`${C._type}Editing`, I === C._editorType);
    }
    this.div.hidden = !1;
  }
  hasTextLayer(I) {
    return I === this.#b?.div;
  }
  setEditingState(I) {
    this.#G.setEditingState(I);
  }
  addCommands(I) {
    this.#G.addCommands(I);
  }
  cleanUndoStack(I) {
    this.#G.cleanUndoStack(I);
  }
  toggleDrawing(I = !1) {
    this.div.classList.toggle("drawing", !I);
  }
  togglePointerEvents(I = !1) {
    this.div.classList.toggle("disabled", !I);
  }
  toggleAnnotationLayerPointerEvents(I = !1) {
    this.#A?.div.classList.toggle("disabled", !I);
  }
  get #B() {
    return this.#l.size !== 0 ? this.#l.values() : this.#G.getEditors(this.pageIndex);
  }
  async enable() {
    this.#c = !0, this.div.tabIndex = 0, this.togglePointerEvents(!0), this.div.classList.toggle("nonEditing", !1), this.#t?.abort(), this.#t = null;
    const I = /* @__PURE__ */ new Set();
    for (const C of this.#B)
      C.enableEditing(), C.show(!0), C.annotationElementId && (this.#G.removeChangedExistingAnnotation(C), I.add(C.annotationElementId));
    const g = this.#A;
    if (g)
      for (const C of g.getEditableAnnotations()) {
        if (C.hide(), this.#G.isDeletedAnnotationElement(C.data.id) || I.has(C.data.id))
          continue;
        const A = await this.deserialize(C);
        A && (this.addOrRebuild(A), A.enableEditing());
      }
    this.#c = !1, this.#G._eventBus.dispatch("editorsrendered", {
      source: this,
      pageNumber: this.pageIndex + 1
    });
  }
  disable() {
    if (this.#d = !0, this.div.tabIndex = -1, this.togglePointerEvents(!1), this.div.classList.toggle("nonEditing", !0), this.#b && !this.#t) {
      this.#t = new AbortController();
      const C = this.#G.combinedSignal(this.#t);
      this.#b.div.addEventListener("pointerdown", (A) => {
        const {
          clientX: l,
          clientY: s,
          timeStamp: d
        } = A, c = this.#a;
        if (d - c > 500) {
          this.#a = d;
          return;
        }
        this.#a = -1;
        const {
          classList: G
        } = this.div;
        G.toggle("getElements", !0);
        const b = document.elementsFromPoint(l, s);
        if (G.toggle("getElements", !1), !this.div.contains(b[0]))
          return;
        let o;
        const m = new RegExp(`^${Og}[0-9]+$`);
        for (const a of b)
          if (m.test(a.id)) {
            o = a.id;
            break;
          }
        if (!o)
          return;
        const e = this.#l.get(o);
        e?.annotationElementId === null && (A.stopPropagation(), A.preventDefault(), e.dblclick(A));
      }, {
        signal: C,
        capture: !0
      });
    }
    const I = this.#A;
    if (I) {
      const C = /* @__PURE__ */ new Map(), A = /* @__PURE__ */ new Map();
      for (const l of this.#B) {
        if (l.disableEditing(), !l.annotationElementId) {
          l.updateFakeAnnotationElement(I);
          continue;
        }
        if (l.serialize() !== null) {
          C.set(l.annotationElementId, l);
          continue;
        } else
          A.set(l.annotationElementId, l);
        this.getEditableAnnotation(l.annotationElementId)?.show(), l.remove();
      }
      const i = I.getEditableAnnotations();
      for (const l of i) {
        const {
          id: s
        } = l.data;
        if (this.#G.isDeletedAnnotationElement(s)) {
          l.updateEdited({
            deleted: !0
          });
          continue;
        }
        let d = A.get(s);
        if (d) {
          d.resetAnnotationElement(l), d.show(!1), l.show();
          continue;
        }
        d = C.get(s), d && (this.#G.addChangedExistingAnnotation(d), d.renderAnnotationElement(l) && d.show(!1)), l.show();
      }
    }
    this.#n(), this.isEmpty && (this.div.hidden = !0);
    const {
      classList: g
    } = this.div;
    for (const C of PI.#e.values())
      g.remove(`${C._type}Editing`);
    this.disableTextSelection(), this.toggleAnnotationLayerPointerEvents(!0), this.#d = !1;
  }
  getEditableAnnotation(I) {
    return this.#A?.getEditableAnnotation(I) || null;
  }
  setActiveEditor(I) {
    this.#G.getActive() !== I && this.#G.setActiveEditor(I);
  }
  enableTextSelection() {
    if (this.div.tabIndex = -1, this.#b?.div && !this.#m) {
      this.#m = new AbortController();
      const I = this.#G.combinedSignal(this.#m);
      this.#b.div.addEventListener("pointerdown", this.#W.bind(this), {
        signal: I
      }), this.#b.div.classList.add("highlighting");
    }
  }
  disableTextSelection() {
    this.div.tabIndex = 0, this.#b?.div && this.#m && (this.#m.abort(), this.#m = null, this.#b.div.classList.remove("highlighting"));
  }
  #W(I) {
    this.#G.unselectAll();
    const {
      target: g
    } = I;
    if (g === this.#b.div || (g.getAttribute("role") === "img" || g.classList.contains("endOfContent")) && this.#b.div.contains(g)) {
      const {
        isMac: C
      } = GI.platform;
      if (I.button !== 0 || I.ctrlKey && C)
        return;
      this.#G.showAllEditors("highlight", !0, !0), this.#b.div.classList.add("free"), this.toggleDrawing(), gI.startHighlighting(this, this.#G.direction === "ltr", {
        target: this.#b.div,
        x: I.x,
        y: I.y
      }), this.#b.div.addEventListener("pointerup", () => {
        this.#b.div.classList.remove("free"), this.toggleDrawing(!0);
      }, {
        once: !0,
        signal: this.#G._signal
      }), I.preventDefault();
    }
  }
  enableClick() {
    if (this.#C)
      return;
    this.#C = new AbortController();
    const I = this.#G.combinedSignal(this.#C);
    this.div.addEventListener("pointerdown", this.pointerdown.bind(this), {
      signal: I
    });
    const g = this.pointerup.bind(this);
    this.div.addEventListener("pointerup", g, {
      signal: I
    }), this.div.addEventListener("pointercancel", g, {
      signal: I
    });
  }
  disableClick() {
    this.#C?.abort(), this.#C = null;
  }
  attach(I) {
    this.#l.set(I.id, I);
    const {
      annotationElementId: g
    } = I;
    g && this.#G.isDeletedAnnotationElement(g) && this.#G.removeDeletedAnnotationElement(I);
  }
  detach(I) {
    this.#l.delete(I.id), this.#I?.removePointerInTextLayer(I.contentDiv), !this.#d && I.annotationElementId && this.#G.addDeletedAnnotationElement(I);
  }
  remove(I) {
    this.detach(I), this.#G.removeEditor(I), I.div.remove(), I.isAttachedToDOM = !1;
  }
  changeParent(I) {
    I.parent !== this && (I.parent && I.annotationElementId && (this.#G.addDeletedAnnotationElement(I.annotationElementId), F.deleteAnnotationElement(I), I.annotationElementId = null), this.attach(I), I.parent?.detach(I), I.setParent(this), I.div && I.isAttachedToDOM && (I.div.remove(), this.div.append(I.div)));
  }
  add(I) {
    if (!(I.parent === this && I.isAttachedToDOM)) {
      if (this.changeParent(I), this.#G.addEditor(I), this.attach(I), !I.isAttachedToDOM) {
        const g = I.render();
        this.div.append(g), I.isAttachedToDOM = !0;
      }
      I.fixAndSetPosition(), I.onceAdded(!this.#c), this.#G.addToAnnotationStorage(I), I._reportTelemetry(I.telemetryInitialData);
    }
  }
  moveEditorInDOM(I) {
    if (!I.isAttachedToDOM)
      return;
    const {
      activeElement: g
    } = document;
    I.div.contains(g) && !this.#i && (I._focusEventsAllowed = !1, this.#i = setTimeout(() => {
      this.#i = null, I.div.contains(document.activeElement) ? I._focusEventsAllowed = !0 : (I.div.addEventListener("focusin", () => {
        I._focusEventsAllowed = !0;
      }, {
        once: !0,
        signal: this.#G._signal
      }), g.focus());
    }, 0)), I._structTreeParentId = this.#I?.moveElementInDOM(this.div, I.div, I.contentDiv, !0);
  }
  addOrRebuild(I) {
    I.needsToBeRebuilt() ? (I.parent ||= this, I.rebuild(), I.show()) : this.add(I);
  }
  addUndoableEditor(I) {
    const g = () => I._uiManager.rebuild(I), C = () => {
      I.remove();
    };
    this.addCommands({
      cmd: g,
      undo: C,
      mustExec: !1
    });
  }
  getEditorByUID(I) {
    for (const g of this.#l.values())
      if (g.uid === I)
        return g;
    return null;
  }
  getNextId() {
    return this.#G.getId();
  }
  get #h() {
    return PI.#e.get(this.#G.getMode());
  }
  combinedSignal(I) {
    return this.#G.combinedSignal(I);
  }
  #N(I) {
    const g = this.#h;
    return g ? new g.prototype.constructor(I) : null;
  }
  canCreateNewEmptyEditor() {
    return this.#h?.canCreateNewEmptyEditor();
  }
  async pasteEditor(I, g) {
    this.updateToolbar(I), await this.#G.updateMode(I.mode);
    const {
      offsetX: C,
      offsetY: A
    } = this.#w(), i = this.getNextId(), l = this.#N({
      parent: this,
      id: i,
      x: C,
      y: A,
      uiManager: this.#G,
      isCentered: !0,
      ...g
    });
    l && this.add(l);
  }
  async deserialize(I) {
    return await PI.#e.get(I.annotationType ?? I.annotationEditorType)?.deserialize(I, this, this.#G) || null;
  }
  createAndAddNewEditor(I, g, C = {}) {
    const A = this.getNextId(), i = this.#N({
      parent: this,
      id: A,
      x: I.offsetX,
      y: I.offsetY,
      uiManager: this.#G,
      isCentered: g,
      ...C
    });
    return i && this.add(i), i;
  }
  get boundingClientRect() {
    return this.div.getBoundingClientRect();
  }
  #w() {
    const {
      x: I,
      y: g,
      width: C,
      height: A
    } = this.boundingClientRect, i = Math.max(0, I), l = Math.max(0, g), s = Math.min(window.innerWidth, I + C), d = Math.min(window.innerHeight, g + A), c = (i + s) / 2 - I, G = (l + d) / 2 - g, [b, o] = this.viewport.rotation % 180 === 0 ? [c, G] : [G, c];
    return {
      offsetX: b,
      offsetY: o
    };
  }
  addNewEditor(I = {}) {
    this.createAndAddNewEditor(this.#w(), !0, I);
  }
  setSelected(I) {
    this.#G.setSelected(I);
  }
  toggleSelected(I) {
    this.#G.toggleSelected(I);
  }
  unselect(I) {
    this.#G.unselect(I);
  }
  pointerup(I) {
    const {
      isMac: g
    } = GI.platform;
    if (I.button !== 0 || I.ctrlKey && g || I.target !== this.div || !this.#s || (this.#s = !1, this.#h?.isDrawer && this.#h.supportMultipleDrawings))
      return;
    if (!this.#g) {
      this.#g = !0;
      return;
    }
    const C = this.#G.getMode();
    if (C === k.STAMP || C === k.SIGNATURE) {
      this.#G.unselectAll();
      return;
    }
    this.createAndAddNewEditor(I, !1);
  }
  pointerdown(I) {
    if (this.#G.getMode() === k.HIGHLIGHT && this.enableTextSelection(), this.#s) {
      this.#s = !1;
      return;
    }
    const {
      isMac: g
    } = GI.platform;
    if (I.button !== 0 || I.ctrlKey && g || I.target !== this.div)
      return;
    if (this.#s = !0, this.#h?.isDrawer) {
      this.startDrawingSession(I);
      return;
    }
    const C = this.#G.getActive();
    this.#g = !C || C.isEmpty();
  }
  startDrawingSession(I) {
    if (this.div.focus({
      preventScroll: !0
    }), this.#Z) {
      this.#h.startDrawing(this, this.#G, !1, I);
      return;
    }
    this.#G.setCurrentDrawingSession(this), this.#Z = new AbortController();
    const g = this.#G.combinedSignal(this.#Z);
    this.div.addEventListener("blur", ({
      relatedTarget: C
    }) => {
      C && !this.div.contains(C) && (this.#o = null, this.commitOrRemove());
    }, {
      signal: g
    }), this.#h.startDrawing(this, this.#G, !1, I);
  }
  pause(I) {
    if (I) {
      const {
        activeElement: g
      } = document;
      this.div.contains(g) && (this.#o = g);
      return;
    }
    this.#o && setTimeout(() => {
      this.#o?.focus(), this.#o = null;
    }, 0);
  }
  endDrawingSession(I = !1) {
    return this.#Z ? (this.#G.setCurrentDrawingSession(null), this.#Z.abort(), this.#Z = null, this.#o = null, this.#h.endDrawing(I)) : null;
  }
  findNewParent(I, g, C) {
    const A = this.#G.findParent(g, C);
    return A === null || A === this ? !1 : (A.changeParent(I), !0);
  }
  commitOrRemove() {
    return this.#Z ? (this.endDrawingSession(), !0) : !1;
  }
  onScaleChanging() {
    this.#Z && this.#h.onScaleChangingWhenDrawing(this);
  }
  destroy() {
    this.commitOrRemove(), this.#G.getActive()?.parent === this && (this.#G.commitOrRemove(), this.#G.setActiveEditor(null)), this.#i && (clearTimeout(this.#i), this.#i = null);
    for (const I of this.#l.values())
      this.#I?.removePointerInTextLayer(I.contentDiv), I.setParent(null), I.isAttachedToDOM = !1, I.div.remove();
    this.div = null, this.#l.clear(), this.#G.removeLayer(this);
  }
  #n() {
    for (const I of this.#l.values())
      I.isEmpty() && I.remove();
  }
  render({
    viewport: I
  }) {
    this.viewport = I, cg(this.div, I);
    for (const g of this.#G.getEditors(this.pageIndex))
      this.add(g), g.rebuild();
    this.updateMode();
  }
  update({
    viewport: I
  }) {
    this.#G.commitOrRemove(), this.#n();
    const g = this.viewport.rotation, C = I.rotation;
    if (this.viewport = I, cg(this.div, {
      rotation: C
    }), g !== C)
      for (const A of this.#l.values())
        A.rotate(C);
  }
  get pageDimensions() {
    const {
      pageWidth: I,
      pageHeight: g
    } = this.viewport.rawDims;
    return [I, g];
  }
  get scale() {
    return this.#G.viewParameters.realScale;
  }
}, sZ = class bI {
  #I = null;
  #g = /* @__PURE__ */ new Map();
  #A = /* @__PURE__ */ new Map();
  static #C = 0;
  constructor({
    pageIndex: I
  }) {
    this.pageIndex = I;
  }
  setParent(I) {
    if (!this.#I) {
      this.#I = I;
      return;
    }
    if (this.#I !== I) {
      if (this.#g.size > 0)
        for (const g of this.#g.values())
          g.remove(), I.append(g);
      this.#I = I;
    }
  }
  static get _svgFactory() {
    return T(this, "_svgFactory", new XC());
  }
  static #i(I, [g, C, A, i]) {
    const {
      style: l
    } = I;
    l.top = `${100 * C}%`, l.left = `${100 * g}%`, l.width = `${100 * A}%`, l.height = `${100 * i}%`;
  }
  #l() {
    const I = bI._svgFactory.create(1, 1, !0);
    return this.#I.append(I), I.setAttribute("aria-hidden", !0), I;
  }
  #s(I, g) {
    const C = bI._svgFactory.createElement("clipPath");
    I.append(C);
    const A = `clip_${g}`;
    C.setAttribute("id", A), C.setAttribute("clipPathUnits", "objectBoundingBox");
    const i = bI._svgFactory.createElement("use");
    return C.append(i), i.setAttribute("href", `#${g}`), i.classList.add("clip"), A;
  }
  #d(I, g) {
    for (const [C, A] of Object.entries(g))
      A === null ? I.removeAttribute(C) : I.setAttribute(C, A);
  }
  draw(I, g = !1, C = !1) {
    const A = bI.#C++, i = this.#l(), l = bI._svgFactory.createElement("defs");
    i.append(l);
    const s = bI._svgFactory.createElement("path");
    l.append(s);
    const d = `path_p${this.pageIndex}_${A}`;
    s.setAttribute("id", d), s.setAttribute("vector-effect", "non-scaling-stroke"), g && this.#A.set(A, s);
    const c = C ? this.#s(l, d) : null, G = bI._svgFactory.createElement("use");
    return i.append(G), G.setAttribute("href", `#${d}`), this.updateProperties(i, I), this.#g.set(A, i), {
      id: A,
      clipPathId: `url(#${c})`
    };
  }
  drawOutline(I, g) {
    const C = bI.#C++, A = this.#l(), i = bI._svgFactory.createElement("defs");
    A.append(i);
    const l = bI._svgFactory.createElement("path");
    i.append(l);
    const s = `path_p${this.pageIndex}_${C}`;
    l.setAttribute("id", s), l.setAttribute("vector-effect", "non-scaling-stroke");
    let d;
    if (g) {
      const b = bI._svgFactory.createElement("mask");
      i.append(b), d = `mask_p${this.pageIndex}_${C}`, b.setAttribute("id", d), b.setAttribute("maskUnits", "objectBoundingBox");
      const o = bI._svgFactory.createElement("rect");
      b.append(o), o.setAttribute("width", "1"), o.setAttribute("height", "1"), o.setAttribute("fill", "white");
      const m = bI._svgFactory.createElement("use");
      b.append(m), m.setAttribute("href", `#${s}`), m.setAttribute("stroke", "none"), m.setAttribute("fill", "black"), m.setAttribute("fill-rule", "nonzero"), m.classList.add("mask");
    }
    const c = bI._svgFactory.createElement("use");
    A.append(c), c.setAttribute("href", `#${s}`), d && c.setAttribute("mask", `url(#${d})`);
    const G = c.cloneNode();
    return A.append(G), c.classList.add("mainOutline"), G.classList.add("secondaryOutline"), this.updateProperties(A, I), this.#g.set(C, A), C;
  }
  finalizeDraw(I, g) {
    this.#A.delete(I), this.updateProperties(I, g);
  }
  updateProperties(I, g) {
    if (!g)
      return;
    const {
      root: C,
      bbox: A,
      rootClass: i,
      path: l
    } = g, s = typeof I == "number" ? this.#g.get(I) : I;
    if (s) {
      if (C && this.#d(s, C), A && bI.#i(s, A), i) {
        const {
          classList: d
        } = s;
        for (const [c, G] of Object.entries(i))
          d.toggle(c, G);
      }
      if (l) {
        const c = s.firstChild.firstChild;
        this.#d(c, l);
      }
    }
  }
  updateParent(I, g) {
    if (g === this)
      return;
    const C = this.#g.get(I);
    C && (g.#I.append(C), this.#g.delete(I), g.#g.set(I, C));
  }
  remove(I) {
    this.#A.delete(I), this.#I !== null && (this.#g.get(I).remove(), this.#g.delete(I));
  }
  destroy() {
    this.#I = null;
    for (const I of this.#g.values())
      I.remove();
    this.#g.clear(), this.#A.clear();
  }
};
globalThis._pdfjsTestingUtils = {
  HighlightOutliner: hA
};
globalThis.pdfjsLib = {
  AbortException: Ig,
  AnnotationEditorLayer: lZ,
  AnnotationEditorParamsType: j,
  AnnotationEditorType: k,
  AnnotationEditorUIManager: Eg,
  AnnotationLayer: Fl,
  AnnotationMode: _I,
  AnnotationType: iI,
  applyOpacity: ys,
  build: pd,
  ColorPicker: Hl,
  createValidAbsoluteUrl: gl,
  CSSConstants: Rs,
  DOMSVGFactory: XC,
  DrawLayer: sZ,
  FeatureTest: GI,
  fetchData: $g,
  findContrastColor: Xs,
  getDocument: ul,
  getFilenameFromUrl: ws,
  getPdfFilenameFromUrl: ns,
  getRGB: gC,
  getUuid: il,
  getXfaPageViewport: Vs,
  GlobalWorkerOptions: Ng,
  ImageKind: wC,
  InvalidPDFException: lA,
  isDataScheme: FC,
  isPdfFile: HA,
  isValidExplicitDest: Ls,
  MathClamp: eI,
  noContextMenu: RI,
  normalizeUnicode: hs,
  OPS: Ug,
  OutputScale: Gg,
  PasswordResponses: Zs,
  PDFDataRangeTransport: Rl,
  PDFDateString: sA,
  PDFWorker: eA,
  PermissionFlag: ds,
  PixelsPerInch: Hg,
  RenderingCancelledException: XA,
  renderRichText: dl,
  ResponseException: uC,
  setLayerDimensions: cg,
  shadow: T,
  SignatureExtractor: Bg,
  stopEvent: II,
  SupportedImageMimeTypes: ZA,
  TextLayer: yC,
  TouchManager: cl,
  updateUrlHash: Cl,
  Util: M,
  VerbosityLevel: KC,
  version: Sd,
  XfaLayer: sl
};
const dZ = "data:text/javascript;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDI0IE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCi8qKgogKiBwZGZqc1ZlcnNpb24gPSA1LjQuMjk2CiAqIHBkZmpzQnVpbGQgPSBmNTZkYzg2MDEKICovCi8qKioqKiovIC8vIFRoZSByZXF1aXJlIHNjb3BlCi8qKioqKiovIHZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307Ci8qKioqKiovIAovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMgKi8KLyoqKioqKi8gKCgpID0+IHsKLyoqKioqKi8gCS8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHMKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7Ci8qKioqKiovIAkJZm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikgewovKioqKioqLyAJCQlpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHsKLyoqKioqKi8gCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7Ci8qKioqKiovIAkJCX0KLyoqKioqKi8gCQl9Ci8qKioqKiovIAl9OwovKioqKioqLyB9KSgpOwovKioqKioqLyAKLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCAqLwovKioqKioqLyAoKCkgPT4gewovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKQovKioqKioqLyB9KSgpOwovKioqKioqLyAKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KdmFyIF9fd2VicGFja19leHBvcnRzX18gPSB7fTsKCjsvLyAuL3NyYy9zaGFyZWQvdXRpbC5qcwpjb25zdCBpc05vZGVKUyA9IHR5cGVvZiBwcm9jZXNzID09PSAib2JqZWN0IiAmJiBwcm9jZXNzICsgIiIgPT09ICJbb2JqZWN0IHByb2Nlc3NdIiAmJiAhcHJvY2Vzcy52ZXJzaW9ucy5udyAmJiAhKHByb2Nlc3MudmVyc2lvbnMuZWxlY3Ryb24gJiYgcHJvY2Vzcy50eXBlICYmIHByb2Nlc3MudHlwZSAhPT0gImJyb3dzZXIiKTsKY29uc3QgRk9OVF9JREVOVElUWV9NQVRSSVggPSBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXTsKY29uc3QgTElORV9GQUNUT1IgPSAxLjM1Owpjb25zdCBMSU5FX0RFU0NFTlRfRkFDVE9SID0gMC4zNTsKY29uc3QgQkFTRUxJTkVfRkFDVE9SID0gTElORV9ERVNDRU5UX0ZBQ1RPUiAvIExJTkVfRkFDVE9SOwpjb25zdCBSZW5kZXJpbmdJbnRlbnRGbGFnID0gewogIEFOWTogMHgwMSwKICBESVNQTEFZOiAweDAyLAogIFBSSU5UOiAweDA0LAogIFNBVkU6IDB4MDgsCiAgQU5OT1RBVElPTlNfRk9STVM6IDB4MTAsCiAgQU5OT1RBVElPTlNfU1RPUkFHRTogMHgyMCwKICBBTk5PVEFUSU9OU19ESVNBQkxFOiAweDQwLAogIElTX0VESVRJTkc6IDB4ODAsCiAgT1BMSVNUOiAweDEwMAp9Owpjb25zdCBBbm5vdGF0aW9uTW9kZSA9IHsKICBESVNBQkxFOiAwLAogIEVOQUJMRTogMSwKICBFTkFCTEVfRk9STVM6IDIsCiAgRU5BQkxFX1NUT1JBR0U6IDMKfTsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclByZWZpeCA9ICJwZGZqc19pbnRlcm5hbF9lZGl0b3JfIjsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclR5cGUgPSB7CiAgRElTQUJMRTogLTEsCiAgTk9ORTogMCwKICBGUkVFVEVYVDogMywKICBISUdITElHSFQ6IDksCiAgU1RBTVA6IDEzLAogIElOSzogMTUsCiAgUE9QVVA6IDE2LAogIFNJR05BVFVSRTogMTAxLAogIENPTU1FTlQ6IDEwMgp9Owpjb25zdCBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZSA9IHsKICBSRVNJWkU6IDEsCiAgQ1JFQVRFOiAyLAogIEZSRUVURVhUX1NJWkU6IDExLAogIEZSRUVURVhUX0NPTE9SOiAxMiwKICBGUkVFVEVYVF9PUEFDSVRZOiAxMywKICBJTktfQ09MT1I6IDIxLAogIElOS19USElDS05FU1M6IDIyLAogIElOS19PUEFDSVRZOiAyMywKICBISUdITElHSFRfQ09MT1I6IDMxLAogIEhJR0hMSUdIVF9USElDS05FU1M6IDMyLAogIEhJR0hMSUdIVF9GUkVFOiAzMywKICBISUdITElHSFRfU0hPV19BTEw6IDM0LAogIERSQVdfU1RFUDogNDEKfTsKY29uc3QgUGVybWlzc2lvbkZsYWcgPSB7CiAgUFJJTlQ6IDB4MDQsCiAgTU9ESUZZX0NPTlRFTlRTOiAweDA4LAogIENPUFk6IDB4MTAsCiAgTU9ESUZZX0FOTk9UQVRJT05TOiAweDIwLAogIEZJTExfSU5URVJBQ1RJVkVfRk9STVM6IDB4MTAwLAogIENPUFlfRk9SX0FDQ0VTU0lCSUxJVFk6IDB4MjAwLAogIEFTU0VNQkxFOiAweDQwMCwKICBQUklOVF9ISUdIX1FVQUxJVFk6IDB4ODAwCn07CmNvbnN0IFRleHRSZW5kZXJpbmdNb2RlID0gewogIEZJTEw6IDAsCiAgU1RST0tFOiAxLAogIEZJTExfU1RST0tFOiAyLAogIElOVklTSUJMRTogMywKICBGSUxMX0FERF9UT19QQVRIOiA0LAogIFNUUk9LRV9BRERfVE9fUEFUSDogNSwKICBGSUxMX1NUUk9LRV9BRERfVE9fUEFUSDogNiwKICBBRERfVE9fUEFUSDogNywKICBGSUxMX1NUUk9LRV9NQVNLOiAzLAogIEFERF9UT19QQVRIX0ZMQUc6IDQKfTsKY29uc3QgSW1hZ2VLaW5kID0gewogIEdSQVlTQ0FMRV8xQlBQOiAxLAogIFJHQl8yNEJQUDogMiwKICBSR0JBXzMyQlBQOiAzCn07CmNvbnN0IEFubm90YXRpb25UeXBlID0gewogIFRFWFQ6IDEsCiAgTElOSzogMiwKICBGUkVFVEVYVDogMywKICBMSU5FOiA0LAogIFNRVUFSRTogNSwKICBDSVJDTEU6IDYsCiAgUE9MWUdPTjogNywKICBQT0xZTElORTogOCwKICBISUdITElHSFQ6IDksCiAgVU5ERVJMSU5FOiAxMCwKICBTUVVJR0dMWTogMTEsCiAgU1RSSUtFT1VUOiAxMiwKICBTVEFNUDogMTMsCiAgQ0FSRVQ6IDE0LAogIElOSzogMTUsCiAgUE9QVVA6IDE2LAogIEZJTEVBVFRBQ0hNRU5UOiAxNywKICBTT1VORDogMTgsCiAgTU9WSUU6IDE5LAogIFdJREdFVDogMjAsCiAgU0NSRUVOOiAyMSwKICBQUklOVEVSTUFSSzogMjIsCiAgVFJBUE5FVDogMjMsCiAgV0FURVJNQVJLOiAyNCwKICBUSFJFRUQ6IDI1LAogIFJFREFDVDogMjYKfTsKY29uc3QgQW5ub3RhdGlvblJlcGx5VHlwZSA9IHsKICBHUk9VUDogIkdyb3VwIiwKICBSRVBMWTogIlIiCn07CmNvbnN0IEFubm90YXRpb25GbGFnID0gewogIElOVklTSUJMRTogMHgwMSwKICBISURERU46IDB4MDIsCiAgUFJJTlQ6IDB4MDQsCiAgTk9aT09NOiAweDA4LAogIE5PUk9UQVRFOiAweDEwLAogIE5PVklFVzogMHgyMCwKICBSRUFET05MWTogMHg0MCwKICBMT0NLRUQ6IDB4ODAsCiAgVE9HR0xFTk9WSUVXOiAweDEwMCwKICBMT0NLRURDT05URU5UUzogMHgyMDAKfTsKY29uc3QgQW5ub3RhdGlvbkZpZWxkRmxhZyA9IHsKICBSRUFET05MWTogMHgwMDAwMDAxLAogIFJFUVVJUkVEOiAweDAwMDAwMDIsCiAgTk9FWFBPUlQ6IDB4MDAwMDAwNCwKICBNVUxUSUxJTkU6IDB4MDAwMTAwMCwKICBQQVNTV09SRDogMHgwMDAyMDAwLAogIE5PVE9HR0xFVE9PRkY6IDB4MDAwNDAwMCwKICBSQURJTzogMHgwMDA4MDAwLAogIFBVU0hCVVRUT046IDB4MDAxMDAwMCwKICBDT01CTzogMHgwMDIwMDAwLAogIEVESVQ6IDB4MDA0MDAwMCwKICBTT1JUOiAweDAwODAwMDAsCiAgRklMRVNFTEVDVDogMHgwMTAwMDAwLAogIE1VTFRJU0VMRUNUOiAweDAyMDAwMDAsCiAgRE9OT1RTUEVMTENIRUNLOiAweDA0MDAwMDAsCiAgRE9OT1RTQ1JPTEw6IDB4MDgwMDAwMCwKICBDT01COiAweDEwMDAwMDAsCiAgUklDSFRFWFQ6IDB4MjAwMDAwMCwKICBSQURJT1NJTlVOSVNPTjogMHgyMDAwMDAwLAogIENPTU1JVE9OU0VMQ0hBTkdFOiAweDQwMDAwMDAKfTsKY29uc3QgQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZSA9IHsKICBTT0xJRDogMSwKICBEQVNIRUQ6IDIsCiAgQkVWRUxFRDogMywKICBJTlNFVDogNCwKICBVTkRFUkxJTkU6IDUKfTsKY29uc3QgQW5ub3RhdGlvbkFjdGlvbkV2ZW50VHlwZSA9IHsKICBFOiAiTW91c2UgRW50ZXIiLAogIFg6ICJNb3VzZSBFeGl0IiwKICBEOiAiTW91c2UgRG93biIsCiAgVTogIk1vdXNlIFVwIiwKICBGbzogIkZvY3VzIiwKICBCbDogIkJsdXIiLAogIFBPOiAiUGFnZU9wZW4iLAogIFBDOiAiUGFnZUNsb3NlIiwKICBQVjogIlBhZ2VWaXNpYmxlIiwKICBQSTogIlBhZ2VJbnZpc2libGUiLAogIEs6ICJLZXlzdHJva2UiLAogIEY6ICJGb3JtYXQiLAogIFY6ICJWYWxpZGF0ZSIsCiAgQzogIkNhbGN1bGF0ZSIKfTsKY29uc3QgRG9jdW1lbnRBY3Rpb25FdmVudFR5cGUgPSB7CiAgV0M6ICJXaWxsQ2xvc2UiLAogIFdTOiAiV2lsbFNhdmUiLAogIERTOiAiRGlkU2F2ZSIsCiAgV1A6ICJXaWxsUHJpbnQiLAogIERQOiAiRGlkUHJpbnQiCn07CmNvbnN0IFBhZ2VBY3Rpb25FdmVudFR5cGUgPSB7CiAgTzogIlBhZ2VPcGVuIiwKICBDOiAiUGFnZUNsb3NlIgp9Owpjb25zdCBWZXJib3NpdHlMZXZlbCA9IHsKICBFUlJPUlM6IDAsCiAgV0FSTklOR1M6IDEsCiAgSU5GT1M6IDUKfTsKY29uc3QgT1BTID0gewogIGRlcGVuZGVuY3k6IDEsCiAgc2V0TGluZVdpZHRoOiAyLAogIHNldExpbmVDYXA6IDMsCiAgc2V0TGluZUpvaW46IDQsCiAgc2V0TWl0ZXJMaW1pdDogNSwKICBzZXREYXNoOiA2LAogIHNldFJlbmRlcmluZ0ludGVudDogNywKICBzZXRGbGF0bmVzczogOCwKICBzZXRHU3RhdGU6IDksCiAgc2F2ZTogMTAsCiAgcmVzdG9yZTogMTEsCiAgdHJhbnNmb3JtOiAxMiwKICBtb3ZlVG86IDEzLAogIGxpbmVUbzogMTQsCiAgY3VydmVUbzogMTUsCiAgY3VydmVUbzI6IDE2LAogIGN1cnZlVG8zOiAxNywKICBjbG9zZVBhdGg6IDE4LAogIHJlY3RhbmdsZTogMTksCiAgc3Ryb2tlOiAyMCwKICBjbG9zZVN0cm9rZTogMjEsCiAgZmlsbDogMjIsCiAgZW9GaWxsOiAyMywKICBmaWxsU3Ryb2tlOiAyNCwKICBlb0ZpbGxTdHJva2U6IDI1LAogIGNsb3NlRmlsbFN0cm9rZTogMjYsCiAgY2xvc2VFT0ZpbGxTdHJva2U6IDI3LAogIGVuZFBhdGg6IDI4LAogIGNsaXA6IDI5LAogIGVvQ2xpcDogMzAsCiAgYmVnaW5UZXh0OiAzMSwKICBlbmRUZXh0OiAzMiwKICBzZXRDaGFyU3BhY2luZzogMzMsCiAgc2V0V29yZFNwYWNpbmc6IDM0LAogIHNldEhTY2FsZTogMzUsCiAgc2V0TGVhZGluZzogMzYsCiAgc2V0Rm9udDogMzcsCiAgc2V0VGV4dFJlbmRlcmluZ01vZGU6IDM4LAogIHNldFRleHRSaXNlOiAzOSwKICBtb3ZlVGV4dDogNDAsCiAgc2V0TGVhZGluZ01vdmVUZXh0OiA0MSwKICBzZXRUZXh0TWF0cml4OiA0MiwKICBuZXh0TGluZTogNDMsCiAgc2hvd1RleHQ6IDQ0LAogIHNob3dTcGFjZWRUZXh0OiA0NSwKICBuZXh0TGluZVNob3dUZXh0OiA0NiwKICBuZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDogNDcsCiAgc2V0Q2hhcldpZHRoOiA0OCwKICBzZXRDaGFyV2lkdGhBbmRCb3VuZHM6IDQ5LAogIHNldFN0cm9rZUNvbG9yU3BhY2U6IDUwLAogIHNldEZpbGxDb2xvclNwYWNlOiA1MSwKICBzZXRTdHJva2VDb2xvcjogNTIsCiAgc2V0U3Ryb2tlQ29sb3JOOiA1MywKICBzZXRGaWxsQ29sb3I6IDU0LAogIHNldEZpbGxDb2xvck46IDU1LAogIHNldFN0cm9rZUdyYXk6IDU2LAogIHNldEZpbGxHcmF5OiA1NywKICBzZXRTdHJva2VSR0JDb2xvcjogNTgsCiAgc2V0RmlsbFJHQkNvbG9yOiA1OSwKICBzZXRTdHJva2VDTVlLQ29sb3I6IDYwLAogIHNldEZpbGxDTVlLQ29sb3I6IDYxLAogIHNoYWRpbmdGaWxsOiA2MiwKICBiZWdpbklubGluZUltYWdlOiA2MywKICBiZWdpbkltYWdlRGF0YTogNjQsCiAgZW5kSW5saW5lSW1hZ2U6IDY1LAogIHBhaW50WE9iamVjdDogNjYsCiAgbWFya1BvaW50OiA2NywKICBtYXJrUG9pbnRQcm9wczogNjgsCiAgYmVnaW5NYXJrZWRDb250ZW50OiA2OSwKICBiZWdpbk1hcmtlZENvbnRlbnRQcm9wczogNzAsCiAgZW5kTWFya2VkQ29udGVudDogNzEsCiAgYmVnaW5Db21wYXQ6IDcyLAogIGVuZENvbXBhdDogNzMsCiAgcGFpbnRGb3JtWE9iamVjdEJlZ2luOiA3NCwKICBwYWludEZvcm1YT2JqZWN0RW5kOiA3NSwKICBiZWdpbkdyb3VwOiA3NiwKICBlbmRHcm91cDogNzcsCiAgYmVnaW5Bbm5vdGF0aW9uOiA4MCwKICBlbmRBbm5vdGF0aW9uOiA4MSwKICBwYWludEltYWdlTWFza1hPYmplY3Q6IDgzLAogIHBhaW50SW1hZ2VNYXNrWE9iamVjdEdyb3VwOiA4NCwKICBwYWludEltYWdlWE9iamVjdDogODUsCiAgcGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q6IDg2LAogIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXA6IDg3LAogIHBhaW50SW1hZ2VYT2JqZWN0UmVwZWF0OiA4OCwKICBwYWludEltYWdlTWFza1hPYmplY3RSZXBlYXQ6IDg5LAogIHBhaW50U29saWRDb2xvckltYWdlTWFzazogOTAsCiAgY29uc3RydWN0UGF0aDogOTEsCiAgc2V0U3Ryb2tlVHJhbnNwYXJlbnQ6IDkyLAogIHNldEZpbGxUcmFuc3BhcmVudDogOTMsCiAgcmF3RmlsbFBhdGg6IDk0Cn07CmNvbnN0IERyYXdPUFMgPSB7CiAgbW92ZVRvOiAwLAogIGxpbmVUbzogMSwKICBjdXJ2ZVRvOiAyLAogIGNsb3NlUGF0aDogMwp9Owpjb25zdCBQYXNzd29yZFJlc3BvbnNlcyA9IHsKICBORUVEX1BBU1NXT1JEOiAxLAogIElOQ09SUkVDVF9QQVNTV09SRDogMgp9OwpsZXQgdmVyYm9zaXR5ID0gVmVyYm9zaXR5TGV2ZWwuV0FSTklOR1M7CmZ1bmN0aW9uIHNldFZlcmJvc2l0eUxldmVsKGxldmVsKSB7CiAgaWYgKE51bWJlci5pc0ludGVnZXIobGV2ZWwpKSB7CiAgICB2ZXJib3NpdHkgPSBsZXZlbDsKICB9Cn0KZnVuY3Rpb24gZ2V0VmVyYm9zaXR5TGV2ZWwoKSB7CiAgcmV0dXJuIHZlcmJvc2l0eTsKfQpmdW5jdGlvbiBpbmZvKG1zZykgewogIGlmICh2ZXJib3NpdHkgPj0gVmVyYm9zaXR5TGV2ZWwuSU5GT1MpIHsKICAgIGNvbnNvbGUuaW5mbyhgSW5mbzogJHttc2d9YCk7CiAgfQp9CmZ1bmN0aW9uIHdhcm4obXNnKSB7CiAgaWYgKHZlcmJvc2l0eSA+PSBWZXJib3NpdHlMZXZlbC5XQVJOSU5HUykgewogICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiAke21zZ31gKTsKICB9Cn0KZnVuY3Rpb24gdW5yZWFjaGFibGUobXNnKSB7CiAgdGhyb3cgbmV3IEVycm9yKG1zZyk7Cn0KZnVuY3Rpb24gYXNzZXJ0KGNvbmQsIG1zZykgewogIGlmICghY29uZCkgewogICAgdW5yZWFjaGFibGUobXNnKTsKICB9Cn0KZnVuY3Rpb24gX2lzVmFsaWRQcm90b2NvbCh1cmwpIHsKICBzd2l0Y2ggKHVybD8ucHJvdG9jb2wpIHsKICAgIGNhc2UgImh0dHA6IjoKICAgIGNhc2UgImh0dHBzOiI6CiAgICBjYXNlICJmdHA6IjoKICAgIGNhc2UgIm1haWx0bzoiOgogICAgY2FzZSAidGVsOiI6CiAgICAgIHJldHVybiB0cnVlOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KfQpmdW5jdGlvbiBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCwgYmFzZVVybCA9IG51bGwsIG9wdGlvbnMgPSBudWxsKSB7CiAgaWYgKCF1cmwpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBpZiAob3B0aW9ucyAmJiB0eXBlb2YgdXJsID09PSAic3RyaW5nIikgewogICAgaWYgKG9wdGlvbnMuYWRkRGVmYXVsdFByb3RvY29sICYmIHVybC5zdGFydHNXaXRoKCJ3d3cuIikpIHsKICAgICAgY29uc3QgZG90cyA9IHVybC5tYXRjaCgvXC4vZyk7CiAgICAgIGlmIChkb3RzPy5sZW5ndGggPj0gMikgewogICAgICAgIHVybCA9IGBodHRwOi8vJHt1cmx9YDsKICAgICAgfQogICAgfQogICAgaWYgKG9wdGlvbnMudHJ5Q29udmVydEVuY29kaW5nKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdXJsID0gc3RyaW5nVG9VVEY4U3RyaW5nKHVybCk7CiAgICAgIH0gY2F0Y2gge30KICAgIH0KICB9CiAgY29uc3QgYWJzb2x1dGVVcmwgPSBiYXNlVXJsID8gVVJMLnBhcnNlKHVybCwgYmFzZVVybCkgOiBVUkwucGFyc2UodXJsKTsKICByZXR1cm4gX2lzVmFsaWRQcm90b2NvbChhYnNvbHV0ZVVybCkgPyBhYnNvbHV0ZVVybCA6IG51bGw7Cn0KZnVuY3Rpb24gdXBkYXRlVXJsSGFzaCh1cmwsIGhhc2gsIGFsbG93UmVsID0gZmFsc2UpIHsKICBjb25zdCByZXMgPSBVUkwucGFyc2UodXJsKTsKICBpZiAocmVzKSB7CiAgICByZXMuaGFzaCA9IGhhc2g7CiAgICByZXR1cm4gcmVzLmhyZWY7CiAgfQogIGlmIChhbGxvd1JlbCAmJiBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCwgImh0dHA6Ly9leGFtcGxlLmNvbSIpKSB7CiAgICByZXR1cm4gdXJsLnNwbGl0KCIjIiwgMSlbMF0gKyBgJHtoYXNoID8gYCMke2hhc2h9YCA6ICIifWA7CiAgfQogIHJldHVybiAiIjsKfQpmdW5jdGlvbiBzaGFkb3cob2JqLCBwcm9wLCB2YWx1ZSwgbm9uU2VyaWFsaXphYmxlID0gZmFsc2UpIHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wLCB7CiAgICB2YWx1ZSwKICAgIGVudW1lcmFibGU6ICFub25TZXJpYWxpemFibGUsCiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICB3cml0YWJsZTogZmFsc2UKICB9KTsKICByZXR1cm4gdmFsdWU7Cn0KY29uc3QgQmFzZUV4Y2VwdGlvbiA9IGZ1bmN0aW9uIEJhc2VFeGNlcHRpb25DbG9zdXJlKCkgewogIGZ1bmN0aW9uIEJhc2VFeGNlcHRpb24obWVzc2FnZSwgbmFtZSkgewogICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgfQogIEJhc2VFeGNlcHRpb24ucHJvdG90eXBlID0gbmV3IEVycm9yKCk7CiAgQmFzZUV4Y2VwdGlvbi5jb25zdHJ1Y3RvciA9IEJhc2VFeGNlcHRpb247CiAgcmV0dXJuIEJhc2VFeGNlcHRpb247Cn0oKTsKY2xhc3MgUGFzc3dvcmRFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2csIGNvZGUpIHsKICAgIHN1cGVyKG1zZywgIlBhc3N3b3JkRXhjZXB0aW9uIik7CiAgICB0aGlzLmNvZGUgPSBjb2RlOwogIH0KfQpjbGFzcyBVbmtub3duRXJyb3JFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2csIGRldGFpbHMpIHsKICAgIHN1cGVyKG1zZywgIlVua25vd25FcnJvckV4Y2VwdGlvbiIpOwogICAgdGhpcy5kZXRhaWxzID0gZGV0YWlsczsKICB9Cn0KY2xhc3MgSW52YWxpZFBERkV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSW52YWxpZFBERkV4Y2VwdGlvbiIpOwogIH0KfQpjbGFzcyBSZXNwb25zZUV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZywgc3RhdHVzLCBtaXNzaW5nKSB7CiAgICBzdXBlcihtc2csICJSZXNwb25zZUV4Y2VwdGlvbiIpOwogICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICB0aGlzLm1pc3NpbmcgPSBtaXNzaW5nOwogIH0KfQpjbGFzcyBGb3JtYXRFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiRm9ybWF0RXJyb3IiKTsKICB9Cn0KY2xhc3MgQWJvcnRFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIkFib3J0RXhjZXB0aW9uIik7CiAgfQp9CmZ1bmN0aW9uIGJ5dGVzVG9TdHJpbmcoYnl0ZXMpIHsKICBpZiAodHlwZW9mIGJ5dGVzICE9PSAib2JqZWN0IiB8fCBieXRlcz8ubGVuZ3RoID09PSB1bmRlZmluZWQpIHsKICAgIHVucmVhY2hhYmxlKCJJbnZhbGlkIGFyZ3VtZW50IGZvciBieXRlc1RvU3RyaW5nIik7CiAgfQogIGNvbnN0IGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKICBjb25zdCBNQVhfQVJHVU1FTlRfQ09VTlQgPSA4MTkyOwogIGlmIChsZW5ndGggPCBNQVhfQVJHVU1FTlRfQ09VTlQpIHsKICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJ5dGVzKTsKICB9CiAgY29uc3Qgc3RyQnVmID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gTUFYX0FSR1VNRU5UX0NPVU5UKSB7CiAgICBjb25zdCBjaHVua0VuZCA9IE1hdGgubWluKGkgKyBNQVhfQVJHVU1FTlRfQ09VTlQsIGxlbmd0aCk7CiAgICBjb25zdCBjaHVuayA9IGJ5dGVzLnN1YmFycmF5KGksIGNodW5rRW5kKTsKICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgY2h1bmspKTsKICB9CiAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKfQpmdW5jdGlvbiBzdHJpbmdUb0J5dGVzKHN0cikgewogIGlmICh0eXBlb2Ygc3RyICE9PSAic3RyaW5nIikgewogICAgdW5yZWFjaGFibGUoIkludmFsaWQgYXJndW1lbnQgZm9yIHN0cmluZ1RvQnl0ZXMiKTsKICB9CiAgY29uc3QgbGVuZ3RoID0gc3RyLmxlbmd0aDsKICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgYnl0ZXNbaV0gPSBzdHIuY2hhckNvZGVBdChpKSAmIDB4ZmY7CiAgfQogIHJldHVybiBieXRlczsKfQpmdW5jdGlvbiBzdHJpbmczMih2YWx1ZSkgewogIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKfQpmdW5jdGlvbiBvYmplY3RTaXplKG9iaikgewogIHJldHVybiBPYmplY3Qua2V5cyhvYmopLmxlbmd0aDsKfQpmdW5jdGlvbiBpc0xpdHRsZUVuZGlhbigpIHsKICBjb25zdCBidWZmZXI4ID0gbmV3IFVpbnQ4QXJyYXkoNCk7CiAgYnVmZmVyOFswXSA9IDE7CiAgY29uc3QgdmlldzMyID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlcjguYnVmZmVyLCAwLCAxKTsKICByZXR1cm4gdmlldzMyWzBdID09PSAxOwp9CmZ1bmN0aW9uIGlzRXZhbFN1cHBvcnRlZCgpIHsKICB0cnkgewogICAgbmV3IEZ1bmN0aW9uKCIiKTsKICAgIHJldHVybiB0cnVlOwogIH0gY2F0Y2ggewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBGZWF0dXJlVGVzdCB7CiAgc3RhdGljIGdldCBpc0xpdHRsZUVuZGlhbigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzTGl0dGxlRW5kaWFuIiwgaXNMaXR0bGVFbmRpYW4oKSk7CiAgfQogIHN0YXRpYyBnZXQgaXNFdmFsU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNFdmFsU3VwcG9ydGVkIiwgaXNFdmFsU3VwcG9ydGVkKCkpOwogIH0KICBzdGF0aWMgZ2V0IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQiLCB0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzICE9PSAidW5kZWZpbmVkIik7CiAgfQogIHN0YXRpYyBnZXQgaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCIsIHR5cGVvZiBJbWFnZURlY29kZXIgIT09ICJ1bmRlZmluZWQiKTsKICB9CiAgc3RhdGljIGdldCBwbGF0Zm9ybSgpIHsKICAgIGNvbnN0IHsKICAgICAgcGxhdGZvcm0sCiAgICAgIHVzZXJBZ2VudAogICAgfSA9IG5hdmlnYXRvcjsKICAgIHJldHVybiBzaGFkb3codGhpcywgInBsYXRmb3JtIiwgewogICAgICBpc0FuZHJvaWQ6IHVzZXJBZ2VudC5pbmNsdWRlcygiQW5kcm9pZCIpLAogICAgICBpc0xpbnV4OiBwbGF0Zm9ybS5pbmNsdWRlcygiTGludXgiKSwKICAgICAgaXNNYWM6IHBsYXRmb3JtLmluY2x1ZGVzKCJNYWMiKSwKICAgICAgaXNXaW5kb3dzOiBwbGF0Zm9ybS5pbmNsdWRlcygiV2luIiksCiAgICAgIGlzRmlyZWZveDogdXNlckFnZW50LmluY2x1ZGVzKCJGaXJlZm94IikKICAgIH0pOwogIH0KICBzdGF0aWMgZ2V0IGlzQ1NTUm91bmRTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0NTU1JvdW5kU3VwcG9ydGVkIiwgZ2xvYmFsVGhpcy5DU1M/LnN1cHBvcnRzPy4oIndpZHRoOiByb3VuZCgxLjVweCwgMXB4KSIpKTsKICB9Cn0KY29uc3QgaGV4TnVtYmVycyA9IEFycmF5LmZyb20oQXJyYXkoMjU2KS5rZXlzKCksIG4gPT4gbi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSk7CmNsYXNzIFV0aWwgewogIHN0YXRpYyBtYWtlSGV4Q29sb3IociwgZywgYikgewogICAgcmV0dXJuIGAjJHtoZXhOdW1iZXJzW3JdfSR7aGV4TnVtYmVyc1tnXX0ke2hleE51bWJlcnNbYl19YDsKICB9CiAgc3RhdGljIGRvbU1hdHJpeFRvVHJhbnNmb3JtKGRtKSB7CiAgICByZXR1cm4gW2RtLmEsIGRtLmIsIGRtLmMsIGRtLmQsIGRtLmUsIGRtLmZdOwogIH0KICBzdGF0aWMgc2NhbGVNaW5NYXgodHJhbnNmb3JtLCBtaW5NYXgpIHsKICAgIGxldCB0ZW1wOwogICAgaWYgKHRyYW5zZm9ybVswXSkgewogICAgICBpZiAodHJhbnNmb3JtWzBdIDwgMCkgewogICAgICAgIHRlbXAgPSBtaW5NYXhbMF07CiAgICAgICAgbWluTWF4WzBdID0gbWluTWF4WzJdOwogICAgICAgIG1pbk1heFsyXSA9IHRlbXA7CiAgICAgIH0KICAgICAgbWluTWF4WzBdICo9IHRyYW5zZm9ybVswXTsKICAgICAgbWluTWF4WzJdICo9IHRyYW5zZm9ybVswXTsKICAgICAgaWYgKHRyYW5zZm9ybVszXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzFdOwogICAgICAgIG1pbk1heFsxXSA9IG1pbk1heFszXTsKICAgICAgICBtaW5NYXhbM10gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFsxXSAqPSB0cmFuc2Zvcm1bM107CiAgICAgIG1pbk1heFszXSAqPSB0cmFuc2Zvcm1bM107CiAgICB9IGVsc2UgewogICAgICB0ZW1wID0gbWluTWF4WzBdOwogICAgICBtaW5NYXhbMF0gPSBtaW5NYXhbMV07CiAgICAgIG1pbk1heFsxXSA9IHRlbXA7CiAgICAgIHRlbXAgPSBtaW5NYXhbMl07CiAgICAgIG1pbk1heFsyXSA9IG1pbk1heFszXTsKICAgICAgbWluTWF4WzNdID0gdGVtcDsKICAgICAgaWYgKHRyYW5zZm9ybVsxXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzFdOwogICAgICAgIG1pbk1heFsxXSA9IG1pbk1heFszXTsKICAgICAgICBtaW5NYXhbM10gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFsxXSAqPSB0cmFuc2Zvcm1bMV07CiAgICAgIG1pbk1heFszXSAqPSB0cmFuc2Zvcm1bMV07CiAgICAgIGlmICh0cmFuc2Zvcm1bMl0gPCAwKSB7CiAgICAgICAgdGVtcCA9IG1pbk1heFswXTsKICAgICAgICBtaW5NYXhbMF0gPSBtaW5NYXhbMl07CiAgICAgICAgbWluTWF4WzJdID0gdGVtcDsKICAgICAgfQogICAgICBtaW5NYXhbMF0gKj0gdHJhbnNmb3JtWzJdOwogICAgICBtaW5NYXhbMl0gKj0gdHJhbnNmb3JtWzJdOwogICAgfQogICAgbWluTWF4WzBdICs9IHRyYW5zZm9ybVs0XTsKICAgIG1pbk1heFsxXSArPSB0cmFuc2Zvcm1bNV07CiAgICBtaW5NYXhbMl0gKz0gdHJhbnNmb3JtWzRdOwogICAgbWluTWF4WzNdICs9IHRyYW5zZm9ybVs1XTsKICB9CiAgc3RhdGljIHRyYW5zZm9ybShtMSwgbTIpIHsKICAgIHJldHVybiBbbTFbMF0gKiBtMlswXSArIG0xWzJdICogbTJbMV0sIG0xWzFdICogbTJbMF0gKyBtMVszXSAqIG0yWzFdLCBtMVswXSAqIG0yWzJdICsgbTFbMl0gKiBtMlszXSwgbTFbMV0gKiBtMlsyXSArIG0xWzNdICogbTJbM10sIG0xWzBdICogbTJbNF0gKyBtMVsyXSAqIG0yWzVdICsgbTFbNF0sIG0xWzFdICogbTJbNF0gKyBtMVszXSAqIG0yWzVdICsgbTFbNV1dOwogIH0KICBzdGF0aWMgbXVsdGlwbHlCeURPTU1hdHJpeChtLCBtZCkgewogICAgcmV0dXJuIFttWzBdICogbWQuYSArIG1bMl0gKiBtZC5iLCBtWzFdICogbWQuYSArIG1bM10gKiBtZC5iLCBtWzBdICogbWQuYyArIG1bMl0gKiBtZC5kLCBtWzFdICogbWQuYyArIG1bM10gKiBtZC5kLCBtWzBdICogbWQuZSArIG1bMl0gKiBtZC5mICsgbVs0XSwgbVsxXSAqIG1kLmUgKyBtWzNdICogbWQuZiArIG1bNV1dOwogIH0KICBzdGF0aWMgYXBwbHlUcmFuc2Zvcm0ocCwgbSwgcG9zID0gMCkgewogICAgY29uc3QgcDAgPSBwW3Bvc107CiAgICBjb25zdCBwMSA9IHBbcG9zICsgMV07CiAgICBwW3Bvc10gPSBwMCAqIG1bMF0gKyBwMSAqIG1bMl0gKyBtWzRdOwogICAgcFtwb3MgKyAxXSA9IHAwICogbVsxXSArIHAxICogbVszXSArIG1bNV07CiAgfQogIHN0YXRpYyBhcHBseVRyYW5zZm9ybVRvQmV6aWVyKHAsIHRyYW5zZm9ybSwgcG9zID0gMCkgewogICAgY29uc3QgbTAgPSB0cmFuc2Zvcm1bMF07CiAgICBjb25zdCBtMSA9IHRyYW5zZm9ybVsxXTsKICAgIGNvbnN0IG0yID0gdHJhbnNmb3JtWzJdOwogICAgY29uc3QgbTMgPSB0cmFuc2Zvcm1bM107CiAgICBjb25zdCBtNCA9IHRyYW5zZm9ybVs0XTsKICAgIGNvbnN0IG01ID0gdHJhbnNmb3JtWzVdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpICs9IDIpIHsKICAgICAgY29uc3QgcEkgPSBwW3BvcyArIGldOwogICAgICBjb25zdCBwSTEgPSBwW3BvcyArIGkgKyAxXTsKICAgICAgcFtwb3MgKyBpXSA9IHBJICogbTAgKyBwSTEgKiBtMiArIG00OwogICAgICBwW3BvcyArIGkgKyAxXSA9IHBJICogbTEgKyBwSTEgKiBtMyArIG01OwogICAgfQogIH0KICBzdGF0aWMgYXBwbHlJbnZlcnNlVHJhbnNmb3JtKHAsIG0pIHsKICAgIGNvbnN0IHAwID0gcFswXTsKICAgIGNvbnN0IHAxID0gcFsxXTsKICAgIGNvbnN0IGQgPSBtWzBdICogbVszXSAtIG1bMV0gKiBtWzJdOwogICAgcFswXSA9IChwMCAqIG1bM10gLSBwMSAqIG1bMl0gKyBtWzJdICogbVs1XSAtIG1bNF0gKiBtWzNdKSAvIGQ7CiAgICBwWzFdID0gKC1wMCAqIG1bMV0gKyBwMSAqIG1bMF0gKyBtWzRdICogbVsxXSAtIG1bNV0gKiBtWzBdKSAvIGQ7CiAgfQogIHN0YXRpYyBheGlhbEFsaWduZWRCb3VuZGluZ0JveChyZWN0LCB0cmFuc2Zvcm0sIG91dHB1dCkgewogICAgY29uc3QgbTAgPSB0cmFuc2Zvcm1bMF07CiAgICBjb25zdCBtMSA9IHRyYW5zZm9ybVsxXTsKICAgIGNvbnN0IG0yID0gdHJhbnNmb3JtWzJdOwogICAgY29uc3QgbTMgPSB0cmFuc2Zvcm1bM107CiAgICBjb25zdCBtNCA9IHRyYW5zZm9ybVs0XTsKICAgIGNvbnN0IG01ID0gdHJhbnNmb3JtWzVdOwogICAgY29uc3QgcjAgPSByZWN0WzBdOwogICAgY29uc3QgcjEgPSByZWN0WzFdOwogICAgY29uc3QgcjIgPSByZWN0WzJdOwogICAgY29uc3QgcjMgPSByZWN0WzNdOwogICAgbGV0IGEwID0gbTAgKiByMCArIG00OwogICAgbGV0IGEyID0gYTA7CiAgICBsZXQgYTEgPSBtMCAqIHIyICsgbTQ7CiAgICBsZXQgYTMgPSBhMTsKICAgIGxldCBiMCA9IG0zICogcjEgKyBtNTsKICAgIGxldCBiMiA9IGIwOwogICAgbGV0IGIxID0gbTMgKiByMyArIG01OwogICAgbGV0IGIzID0gYjE7CiAgICBpZiAobTEgIT09IDAgfHwgbTIgIT09IDApIHsKICAgICAgY29uc3QgbTFyMCA9IG0xICogcjA7CiAgICAgIGNvbnN0IG0xcjIgPSBtMSAqIHIyOwogICAgICBjb25zdCBtMnIxID0gbTIgKiByMTsKICAgICAgY29uc3QgbTJyMyA9IG0yICogcjM7CiAgICAgIGEwICs9IG0ycjE7CiAgICAgIGEzICs9IG0ycjE7CiAgICAgIGExICs9IG0ycjM7CiAgICAgIGEyICs9IG0ycjM7CiAgICAgIGIwICs9IG0xcjA7CiAgICAgIGIzICs9IG0xcjA7CiAgICAgIGIxICs9IG0xcjI7CiAgICAgIGIyICs9IG0xcjI7CiAgICB9CiAgICBvdXRwdXRbMF0gPSBNYXRoLm1pbihvdXRwdXRbMF0sIGEwLCBhMSwgYTIsIGEzKTsKICAgIG91dHB1dFsxXSA9IE1hdGgubWluKG91dHB1dFsxXSwgYjAsIGIxLCBiMiwgYjMpOwogICAgb3V0cHV0WzJdID0gTWF0aC5tYXgob3V0cHV0WzJdLCBhMCwgYTEsIGEyLCBhMyk7CiAgICBvdXRwdXRbM10gPSBNYXRoLm1heChvdXRwdXRbM10sIGIwLCBiMSwgYjIsIGIzKTsKICB9CiAgc3RhdGljIGludmVyc2VUcmFuc2Zvcm0obSkgewogICAgY29uc3QgZCA9IG1bMF0gKiBtWzNdIC0gbVsxXSAqIG1bMl07CiAgICByZXR1cm4gW21bM10gLyBkLCAtbVsxXSAvIGQsIC1tWzJdIC8gZCwgbVswXSAvIGQsIChtWzJdICogbVs1XSAtIG1bNF0gKiBtWzNdKSAvIGQsIChtWzRdICogbVsxXSAtIG1bNV0gKiBtWzBdKSAvIGRdOwogIH0KICBzdGF0aWMgc2luZ3VsYXJWYWx1ZURlY29tcG9zZTJkU2NhbGUobWF0cml4LCBvdXRwdXQpIHsKICAgIGNvbnN0IG0wID0gbWF0cml4WzBdOwogICAgY29uc3QgbTEgPSBtYXRyaXhbMV07CiAgICBjb25zdCBtMiA9IG1hdHJpeFsyXTsKICAgIGNvbnN0IG0zID0gbWF0cml4WzNdOwogICAgY29uc3QgYSA9IG0wICoqIDIgKyBtMSAqKiAyOwogICAgY29uc3QgYiA9IG0wICogbTIgKyBtMSAqIG0zOwogICAgY29uc3QgYyA9IG0yICoqIDIgKyBtMyAqKiAyOwogICAgY29uc3QgZmlyc3QgPSAoYSArIGMpIC8gMjsKICAgIGNvbnN0IHNlY29uZCA9IE1hdGguc3FydChmaXJzdCAqKiAyIC0gKGEgKiBjIC0gYiAqKiAyKSk7CiAgICBvdXRwdXRbMF0gPSBNYXRoLnNxcnQoZmlyc3QgKyBzZWNvbmQgfHwgMSk7CiAgICBvdXRwdXRbMV0gPSBNYXRoLnNxcnQoZmlyc3QgLSBzZWNvbmQgfHwgMSk7CiAgfQogIHN0YXRpYyBub3JtYWxpemVSZWN0KHJlY3QpIHsKICAgIGNvbnN0IHIgPSByZWN0LnNsaWNlKDApOwogICAgaWYgKHJlY3RbMF0gPiByZWN0WzJdKSB7CiAgICAgIHJbMF0gPSByZWN0WzJdOwogICAgICByWzJdID0gcmVjdFswXTsKICAgIH0KICAgIGlmIChyZWN0WzFdID4gcmVjdFszXSkgewogICAgICByWzFdID0gcmVjdFszXTsKICAgICAgclszXSA9IHJlY3RbMV07CiAgICB9CiAgICByZXR1cm4gcjsKICB9CiAgc3RhdGljIGludGVyc2VjdChyZWN0MSwgcmVjdDIpIHsKICAgIGNvbnN0IHhMb3cgPSBNYXRoLm1heChNYXRoLm1pbihyZWN0MVswXSwgcmVjdDFbMl0pLCBNYXRoLm1pbihyZWN0MlswXSwgcmVjdDJbMl0pKTsKICAgIGNvbnN0IHhIaWdoID0gTWF0aC5taW4oTWF0aC5tYXgocmVjdDFbMF0sIHJlY3QxWzJdKSwgTWF0aC5tYXgocmVjdDJbMF0sIHJlY3QyWzJdKSk7CiAgICBpZiAoeExvdyA+IHhIaWdoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgeUxvdyA9IE1hdGgubWF4KE1hdGgubWluKHJlY3QxWzFdLCByZWN0MVszXSksIE1hdGgubWluKHJlY3QyWzFdLCByZWN0MlszXSkpOwogICAgY29uc3QgeUhpZ2ggPSBNYXRoLm1pbihNYXRoLm1heChyZWN0MVsxXSwgcmVjdDFbM10pLCBNYXRoLm1heChyZWN0MlsxXSwgcmVjdDJbM10pKTsKICAgIGlmICh5TG93ID4geUhpZ2gpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gW3hMb3csIHlMb3csIHhIaWdoLCB5SGlnaF07CiAgfQogIHN0YXRpYyBwb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCkgewogICAgbWluTWF4WzBdID0gTWF0aC5taW4obWluTWF4WzBdLCB4KTsKICAgIG1pbk1heFsxXSA9IE1hdGgubWluKG1pbk1heFsxXSwgeSk7CiAgICBtaW5NYXhbMl0gPSBNYXRoLm1heChtaW5NYXhbMl0sIHgpOwogICAgbWluTWF4WzNdID0gTWF0aC5tYXgobWluTWF4WzNdLCB5KTsKICB9CiAgc3RhdGljIHJlY3RCb3VuZGluZ0JveCh4MCwgeTAsIHgxLCB5MSwgbWluTWF4KSB7CiAgICBtaW5NYXhbMF0gPSBNYXRoLm1pbihtaW5NYXhbMF0sIHgwLCB4MSk7CiAgICBtaW5NYXhbMV0gPSBNYXRoLm1pbihtaW5NYXhbMV0sIHkwLCB5MSk7CiAgICBtaW5NYXhbMl0gPSBNYXRoLm1heChtaW5NYXhbMl0sIHgwLCB4MSk7CiAgICBtaW5NYXhbM10gPSBNYXRoLm1heChtaW5NYXhbM10sIHkwLCB5MSk7CiAgfQogIHN0YXRpYyAjZ2V0RXh0cmVtdW1PbkN1cnZlKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgdCwgbWluTWF4KSB7CiAgICBpZiAodCA8PSAwIHx8IHQgPj0gMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBtdCA9IDEgLSB0OwogICAgY29uc3QgdHQgPSB0ICogdDsKICAgIGNvbnN0IHR0dCA9IHR0ICogdDsKICAgIGNvbnN0IHggPSBtdCAqIChtdCAqIChtdCAqIHgwICsgMyAqIHQgKiB4MSkgKyAzICogdHQgKiB4MikgKyB0dHQgKiB4MzsKICAgIGNvbnN0IHkgPSBtdCAqIChtdCAqIChtdCAqIHkwICsgMyAqIHQgKiB5MSkgKyAzICogdHQgKiB5MikgKyB0dHQgKiB5MzsKICAgIG1pbk1heFswXSA9IE1hdGgubWluKG1pbk1heFswXSwgeCk7CiAgICBtaW5NYXhbMV0gPSBNYXRoLm1pbihtaW5NYXhbMV0sIHkpOwogICAgbWluTWF4WzJdID0gTWF0aC5tYXgobWluTWF4WzJdLCB4KTsKICAgIG1pbk1heFszXSA9IE1hdGgubWF4KG1pbk1heFszXSwgeSk7CiAgfQogIHN0YXRpYyAjZ2V0RXh0cmVtdW0oeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCBhLCBiLCBjLCBtaW5NYXgpIHsKICAgIGlmIChNYXRoLmFicyhhKSA8IDFlLTEyKSB7CiAgICAgIGlmIChNYXRoLmFicyhiKSA+PSAxZS0xMikgewogICAgICAgIHRoaXMuI2dldEV4dHJlbXVtT25DdXJ2ZSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsIC1jIC8gYiwgbWluTWF4KTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBkZWx0YSA9IGIgKiogMiAtIDQgKiBjICogYTsKICAgIGlmIChkZWx0YSA8IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3FydERlbHRhID0gTWF0aC5zcXJ0KGRlbHRhKTsKICAgIGNvbnN0IGEyID0gMiAqIGE7CiAgICB0aGlzLiNnZXRFeHRyZW11bU9uQ3VydmUoeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAoLWIgKyBzcXJ0RGVsdGEpIC8gYTIsIG1pbk1heCk7CiAgICB0aGlzLiNnZXRFeHRyZW11bU9uQ3VydmUoeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAoLWIgLSBzcXJ0RGVsdGEpIC8gYTIsIG1pbk1heCk7CiAgfQogIHN0YXRpYyBiZXppZXJCb3VuZGluZ0JveCh4MCwgeTAsIHgxLCB5MSwgeDIsIHkyLCB4MywgeTMsIG1pbk1heCkgewogICAgbWluTWF4WzBdID0gTWF0aC5taW4obWluTWF4WzBdLCB4MCwgeDMpOwogICAgbWluTWF4WzFdID0gTWF0aC5taW4obWluTWF4WzFdLCB5MCwgeTMpOwogICAgbWluTWF4WzJdID0gTWF0aC5tYXgobWluTWF4WzJdLCB4MCwgeDMpOwogICAgbWluTWF4WzNdID0gTWF0aC5tYXgobWluTWF4WzNdLCB5MCwgeTMpOwogICAgdGhpcy4jZ2V0RXh0cmVtdW0oeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAzICogKC14MCArIDMgKiAoeDEgLSB4MikgKyB4MyksIDYgKiAoeDAgLSAyICogeDEgKyB4MiksIDMgKiAoeDEgLSB4MCksIG1pbk1heCk7CiAgICB0aGlzLiNnZXRFeHRyZW11bSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsIDMgKiAoLXkwICsgMyAqICh5MSAtIHkyKSArIHkzKSwgNiAqICh5MCAtIDIgKiB5MSArIHkyKSwgMyAqICh5MSAtIHkwKSwgbWluTWF4KTsKICB9Cn0KY29uc3QgUERGU3RyaW5nVHJhbnNsYXRlVGFibGUgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMHgyZDgsIDB4MmM3LCAweDJjNiwgMHgyZDksIDB4MmRkLCAweDJkYiwgMHgyZGEsIDB4MmRjLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAweDIwMjIsIDB4MjAyMCwgMHgyMDIxLCAweDIwMjYsIDB4MjAxNCwgMHgyMDEzLCAweDE5MiwgMHgyMDQ0LCAweDIwMzksIDB4MjAzYSwgMHgyMjEyLCAweDIwMzAsIDB4MjAxZSwgMHgyMDFjLCAweDIwMWQsIDB4MjAxOCwgMHgyMDE5LCAweDIwMWEsIDB4MjEyMiwgMHhmYjAxLCAweGZiMDIsIDB4MTQxLCAweDE1MiwgMHgxNjAsIDB4MTc4LCAweDE3ZCwgMHgxMzEsIDB4MTQyLCAweDE1MywgMHgxNjEsIDB4MTdlLCAwLCAweDIwYWNdOwpmdW5jdGlvbiBzdHJpbmdUb1BERlN0cmluZyhzdHIsIGtlZXBFc2NhcGVTZXF1ZW5jZSA9IGZhbHNlKSB7CiAgaWYgKHN0clswXSA+PSAiXHhFRiIpIHsKICAgIGxldCBlbmNvZGluZzsKICAgIGlmIChzdHJbMF0gPT09ICJceEZFIiAmJiBzdHJbMV0gPT09ICJceEZGIikgewogICAgICBlbmNvZGluZyA9ICJ1dGYtMTZiZSI7CiAgICAgIGlmIChzdHIubGVuZ3RoICUgMiA9PT0gMSkgewogICAgICAgIHN0ciA9IHN0ci5zbGljZSgwLCAtMSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoc3RyWzBdID09PSAiXHhGRiIgJiYgc3RyWzFdID09PSAiXHhGRSIpIHsKICAgICAgZW5jb2RpbmcgPSAidXRmLTE2bGUiOwogICAgICBpZiAoc3RyLmxlbmd0aCAlIDIgPT09IDEpIHsKICAgICAgICBzdHIgPSBzdHIuc2xpY2UoMCwgLTEpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHN0clswXSA9PT0gIlx4RUYiICYmIHN0clsxXSA9PT0gIlx4QkIiICYmIHN0clsyXSA9PT0gIlx4QkYiKSB7CiAgICAgIGVuY29kaW5nID0gInV0Zi04IjsKICAgIH0KICAgIGlmIChlbmNvZGluZykgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmcsIHsKICAgICAgICAgIGZhdGFsOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgYnVmZmVyID0gc3RyaW5nVG9CeXRlcyhzdHIpOwogICAgICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVyLmRlY29kZShidWZmZXIpOwogICAgICAgIGlmIChrZWVwRXNjYXBlU2VxdWVuY2UgfHwgIWRlY29kZWQuaW5jbHVkZXMoIlx4MWIiKSkgewogICAgICAgICAgcmV0dXJuIGRlY29kZWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZWNvZGVkLnJlcGxhY2VBbGwoL1x4MWJbXlx4MWJdKig/Olx4MWJ8JCkvZywgIiIpOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHdhcm4oYHN0cmluZ1RvUERGU3RyaW5nOiAiJHtleH0iLmApOwogICAgICB9CiAgICB9CiAgfQogIGNvbnN0IHN0ckJ1ZiA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyQ29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgaWYgKCFrZWVwRXNjYXBlU2VxdWVuY2UgJiYgY2hhckNvZGUgPT09IDB4MWIpIHsKICAgICAgd2hpbGUgKCsraSA8IGlpICYmIHN0ci5jaGFyQ29kZUF0KGkpICE9PSAweDFiKSB7fQogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGNvZGUgPSBQREZTdHJpbmdUcmFuc2xhdGVUYWJsZVtjaGFyQ29kZV07CiAgICBzdHJCdWYucHVzaChjb2RlID8gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSA6IHN0ci5jaGFyQXQoaSkpOwogIH0KICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvVVRGOFN0cmluZyhzdHIpIHsKICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShzdHIpKTsKfQpmdW5jdGlvbiB1dGY4U3RyaW5nVG9TdHJpbmcoc3RyKSB7CiAgcmV0dXJuIHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzdHIpKTsKfQpmdW5jdGlvbiBpc0FycmF5RXF1YWwoYXJyMSwgYXJyMikgewogIGlmIChhcnIxLmxlbmd0aCAhPT0gYXJyMi5sZW5ndGgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gYXJyMS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBpZiAoYXJyMVtpXSAhPT0gYXJyMltpXSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGdldE1vZGlmaWNhdGlvbkRhdGUoZGF0ZSA9IG5ldyBEYXRlKCkpIHsKICBpZiAoIShkYXRlIGluc3RhbmNlb2YgRGF0ZSkpIHsKICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTsKICB9CiAgY29uc3QgYnVmZmVyID0gW2RhdGUuZ2V0VVRDRnVsbFllYXIoKS50b1N0cmluZygpLCAoZGF0ZS5nZXRVVENNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpLCBkYXRlLmdldFVUQ0RhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDSG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDTWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKSwgZGF0ZS5nZXRVVENTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpXTsKICByZXR1cm4gYnVmZmVyLmpvaW4oIiIpOwp9CmxldCBOb3JtYWxpemVSZWdleCA9IG51bGw7CmxldCBOb3JtYWxpemF0aW9uTWFwID0gbnVsbDsKZnVuY3Rpb24gbm9ybWFsaXplVW5pY29kZShzdHIpIHsKICBpZiAoIU5vcm1hbGl6ZVJlZ2V4KSB7CiAgICBOb3JtYWxpemVSZWdleCA9IC8oW1x1MDBhMFx1MDBiNVx1MDM3ZVx1MGViM1x1MjAwMC1cdTIwMGFcdTIwMmZcdTIxMjZcdWZiMDAtXHVmYjA0XHVmYjA2XHVmYjIwLVx1ZmIzNlx1ZmIzOC1cdWZiM2NcdWZiM2VcdWZiNDAtXHVmYjQxXHVmYjQzLVx1ZmI0NFx1ZmI0Ni1cdWZiYTFcdWZiYTQtXHVmYmE5XHVmYmFlLVx1ZmJiMVx1ZmJkMy1cdWZiZGNcdWZiZGUtXHVmYmU3XHVmYmVhLVx1ZmJmOFx1ZmJmYy1cdWZiZmRcdWZjMDAtXHVmYzVkXHVmYzY0LVx1ZmNmMVx1ZmNmNS1cdWZkM2RcdWZkODhcdWZkZjRcdWZkZmEtXHVmZGZiXHVmZTcxXHVmZTc3XHVmZTc5XHVmZTdiXHVmZTdkXSspfChcdWZiMDUrKS9ndTsKICAgIE5vcm1hbGl6YXRpb25NYXAgPSBuZXcgTWFwKFtbIu+shSIsICLFv3QiXV0pOwogIH0KICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoTm9ybWFsaXplUmVnZXgsIChfLCBwMSwgcDIpID0+IHAxID8gcDEubm9ybWFsaXplKCJORktDIikgOiBOb3JtYWxpemF0aW9uTWFwLmdldChwMikpOwp9CmZ1bmN0aW9uIGdldFV1aWQoKSB7CiAgaWYgKHR5cGVvZiBjcnlwdG8ucmFuZG9tVVVJRCA9PT0gImZ1bmN0aW9uIikgewogICAgcmV0dXJuIGNyeXB0by5yYW5kb21VVUlEKCk7CiAgfQogIGNvbnN0IGJ1ZiA9IG5ldyBVaW50OEFycmF5KDMyKTsKICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGJ1Zik7CiAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoYnVmKTsKfQpjb25zdCBBbm5vdGF0aW9uUHJlZml4ID0gInBkZmpzX2ludGVybmFsX2lkXyI7CmZ1bmN0aW9uIF9pc1ZhbGlkRXhwbGljaXREZXN0KHZhbGlkUmVmLCB2YWxpZE5hbWUsIGRlc3QpIHsKICBpZiAoIUFycmF5LmlzQXJyYXkoZGVzdCkgfHwgZGVzdC5sZW5ndGggPCAyKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbnN0IFtwYWdlLCB6b29tLCAuLi5hcmdzXSA9IGRlc3Q7CiAgaWYgKCF2YWxpZFJlZihwYWdlKSAmJiAhTnVtYmVyLmlzSW50ZWdlcihwYWdlKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoIXZhbGlkTmFtZSh6b29tKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBhcmdzTGVuID0gYXJncy5sZW5ndGg7CiAgbGV0IGFsbG93TnVsbCA9IHRydWU7CiAgc3dpdGNoICh6b29tLm5hbWUpIHsKICAgIGNhc2UgIlhZWiI6CiAgICAgIGlmIChhcmdzTGVuIDwgMiB8fCBhcmdzTGVuID4gMykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIkZpdCI6CiAgICBjYXNlICJGaXRCIjoKICAgICAgcmV0dXJuIGFyZ3NMZW4gPT09IDA7CiAgICBjYXNlICJGaXRIIjoKICAgIGNhc2UgIkZpdEJIIjoKICAgIGNhc2UgIkZpdFYiOgogICAgY2FzZSAiRml0QlYiOgogICAgICBpZiAoYXJnc0xlbiA+IDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJGaXRSIjoKICAgICAgaWYgKGFyZ3NMZW4gIT09IDQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgYWxsb3dOdWxsID0gZmFsc2U7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KICBmb3IgKGNvbnN0IGFyZyBvZiBhcmdzKSB7CiAgICBpZiAodHlwZW9mIGFyZyA9PT0gIm51bWJlciIgfHwgYWxsb3dOdWxsICYmIGFyZyA9PT0gbnVsbCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gTWF0aENsYW1wKHYsIG1pbiwgbWF4KSB7CiAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHYsIG1pbiksIG1heCk7Cn0KZnVuY3Rpb24gdG9IZXhVdGlsKGFycikgewogIGlmIChVaW50OEFycmF5LnByb3RvdHlwZS50b0hleCkgewogICAgcmV0dXJuIGFyci50b0hleCgpOwogIH0KICByZXR1cm4gQXJyYXkuZnJvbShhcnIsIG51bSA9PiBoZXhOdW1iZXJzW251bV0pLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHRvQmFzZTY0VXRpbChhcnIpIHsKICBpZiAoVWludDhBcnJheS5wcm90b3R5cGUudG9CYXNlNjQpIHsKICAgIHJldHVybiBhcnIudG9CYXNlNjQoKTsKICB9CiAgcmV0dXJuIGJ0b2EoYnl0ZXNUb1N0cmluZyhhcnIpKTsKfQpmdW5jdGlvbiBmcm9tQmFzZTY0VXRpbChzdHIpIHsKICBpZiAoVWludDhBcnJheS5mcm9tQmFzZTY0KSB7CiAgICByZXR1cm4gVWludDhBcnJheS5mcm9tQmFzZTY0KHN0cik7CiAgfQogIHJldHVybiBzdHJpbmdUb0J5dGVzKGF0b2Ioc3RyKSk7Cn0KaWYgKHR5cGVvZiBQcm9taXNlLnRyeSAhPT0gImZ1bmN0aW9uIikgewogIFByb21pc2UudHJ5ID0gZnVuY3Rpb24gKGZuLCAuLi5hcmdzKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgIHJlc29sdmUoZm4oLi4uYXJncykpOwogICAgfSk7CiAgfTsKfQppZiAodHlwZW9mIE1hdGguc3VtUHJlY2lzZSAhPT0gImZ1bmN0aW9uIikgewogIE1hdGguc3VtUHJlY2lzZSA9IGZ1bmN0aW9uIChudW1iZXJzKSB7CiAgICByZXR1cm4gbnVtYmVycy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTsKICB9Owp9Cgo7Ly8gLi9zcmMvY29yZS9wcmltaXRpdmVzLmpzCgpjb25zdCBDSVJDVUxBUl9SRUYgPSBTeW1ib2woIkNJUkNVTEFSX1JFRiIpOwpjb25zdCBFT0YgPSBTeW1ib2woIkVPRiIpOwpsZXQgQ21kQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwpsZXQgTmFtZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKbGV0IFJlZkNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKZnVuY3Rpb24gY2xlYXJQcmltaXRpdmVDYWNoZXMoKSB7CiAgQ21kQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIE5hbWVDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgUmVmQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwp9CmNsYXNzIE5hbWUgewogIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgfQogIHN0YXRpYyBnZXQobmFtZSkgewogICAgcmV0dXJuIE5hbWVDYWNoZVtuYW1lXSB8fD0gbmV3IE5hbWUobmFtZSk7CiAgfQp9CmNsYXNzIENtZCB7CiAgY29uc3RydWN0b3IoY21kKSB7CiAgICB0aGlzLmNtZCA9IGNtZDsKICB9CiAgc3RhdGljIGdldChjbWQpIHsKICAgIHJldHVybiBDbWRDYWNoZVtjbWRdIHx8PSBuZXcgQ21kKGNtZCk7CiAgfQp9CmNvbnN0IG5vblNlcmlhbGl6YWJsZSA9IGZ1bmN0aW9uIG5vblNlcmlhbGl6YWJsZUNsb3N1cmUoKSB7CiAgcmV0dXJuIG5vblNlcmlhbGl6YWJsZTsKfTsKY2xhc3MgRGljdCB7CiAgY29uc3RydWN0b3IoeHJlZiA9IG51bGwpIHsKICAgIHRoaXMuX21hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLm9iaklkID0gbnVsbDsKICAgIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2U7CiAgICB0aGlzLl9fbm9uU2VyaWFsaXphYmxlX18gPSBub25TZXJpYWxpemFibGU7CiAgfQogIGFzc2lnblhyZWYobmV3WHJlZikgewogICAgdGhpcy54cmVmID0gbmV3WHJlZjsKICB9CiAgZ2V0IHNpemUoKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLnNpemU7CiAgfQogIGdldChrZXkxLCBrZXkyLCBrZXkzKSB7CiAgICBsZXQgdmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleTEpOwogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkyKTsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleTMpOwogICAgICB9CiAgICB9CiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYgJiYgdGhpcy54cmVmKSB7CiAgICAgIHJldHVybiB0aGlzLnhyZWYuZmV0Y2godmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9CiAgYXN5bmMgZ2V0QXN5bmMoa2V5MSwga2V5Miwga2V5MykgewogICAgbGV0IHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkxKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5Mik7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkzKTsKICAgICAgfQogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZikgewogICAgICByZXR1cm4gdGhpcy54cmVmLmZldGNoQXN5bmModmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9CiAgZ2V0QXJyYXkoa2V5MSwga2V5Miwga2V5MykgewogICAgbGV0IHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkxKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5Mik7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkzKTsKICAgICAgfQogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZikgewogICAgICB2YWx1ZSA9IHRoaXMueHJlZi5mZXRjaCh2YWx1ZSwgdGhpcy5zdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdmFsdWUubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGlmICh2YWx1ZVtpXSBpbnN0YW5jZW9mIFJlZiAmJiB0aGlzLnhyZWYpIHsKICAgICAgICAgIHZhbHVlW2ldID0gdGhpcy54cmVmLmZldGNoKHZhbHVlW2ldLCB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIGdldFJhdyhrZXkpIHsKICAgIHJldHVybiB0aGlzLl9tYXAuZ2V0KGtleSk7CiAgfQogIGdldEtleXMoKSB7CiAgICByZXR1cm4gWy4uLnRoaXMuX21hcC5rZXlzKCldOwogIH0KICBnZXRSYXdWYWx1ZXMoKSB7CiAgICByZXR1cm4gWy4uLnRoaXMuX21hcC52YWx1ZXMoKV07CiAgfQogIHNldChrZXksIHZhbHVlKSB7CiAgICB0aGlzLl9tYXAuc2V0KGtleSwgdmFsdWUpOwogIH0KICBzZXRJZk5vdEV4aXN0cyhrZXksIHZhbHVlKSB7CiAgICBpZiAoIXRoaXMuaGFzKGtleSkpIHsKICAgICAgdGhpcy5zZXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQogIHNldElmTnVtYmVyKGtleSwgdmFsdWUpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICAgIHRoaXMuc2V0KGtleSwgdmFsdWUpOwogICAgfQogIH0KICBzZXRJZkFycmF5KGtleSwgdmFsdWUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBBcnJheUJ1ZmZlci5pc1ZpZXcodmFsdWUpKSB7CiAgICAgIHRoaXMuc2V0KGtleSwgdmFsdWUpOwogICAgfQogIH0KICBzZXRJZkRlZmluZWQoa2V5LCB2YWx1ZSkgewogICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwpIHsKICAgICAgdGhpcy5zZXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQogIHNldElmTmFtZShrZXksIHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICB0aGlzLnNldChrZXksIE5hbWUuZ2V0KHZhbHVlKSk7CiAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICB0aGlzLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9CiAgaGFzKGtleSkgewogICAgcmV0dXJuIHRoaXMuX21hcC5oYXMoa2V5KTsKICB9CiAgKltTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7CiAgICAgIHlpZWxkIFtrZXksIHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZiA/IHRoaXMueHJlZi5mZXRjaCh2YWx1ZSwgdGhpcy5zdXBwcmVzc0VuY3J5cHRpb24pIDogdmFsdWVdOwogICAgfQogIH0KICBzdGF0aWMgZ2V0IGVtcHR5KCkgewogICAgY29uc3QgZW1wdHlEaWN0ID0gbmV3IERpY3QobnVsbCk7CiAgICBlbXB0eURpY3Quc2V0ID0gKGtleSwgdmFsdWUpID0+IHsKICAgICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBgc2V0YCBvbiB0aGUgZW1wdHkgZGljdGlvbmFyeS4iKTsKICAgIH07CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJlbXB0eSIsIGVtcHR5RGljdCk7CiAgfQogIHN0YXRpYyBtZXJnZSh7CiAgICB4cmVmLAogICAgZGljdEFycmF5LAogICAgbWVyZ2VTdWJEaWN0cyA9IGZhbHNlCiAgfSkgewogICAgY29uc3QgbWVyZ2VkRGljdCA9IG5ldyBEaWN0KHhyZWYpLAogICAgICBwcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBkaWN0IG9mIGRpY3RBcnJheSkgewogICAgICBpZiAoIShkaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBkaWN0Ll9tYXApIHsKICAgICAgICBsZXQgcHJvcGVydHkgPSBwcm9wZXJ0aWVzLmdldChrZXkpOwogICAgICAgIGlmIChwcm9wZXJ0eSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBwcm9wZXJ0eSA9IFtdOwogICAgICAgICAgcHJvcGVydGllcy5zZXQoa2V5LCBwcm9wZXJ0eSk7CiAgICAgICAgfSBlbHNlIGlmICghbWVyZ2VTdWJEaWN0cyB8fCAhKHZhbHVlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBwcm9wZXJ0eS5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVzXSBvZiBwcm9wZXJ0aWVzKSB7CiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAxIHx8ICEodmFsdWVzWzBdIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBtZXJnZWREaWN0Ll9tYXAuc2V0KG5hbWUsIHZhbHVlc1swXSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgdmFsdWVzKSB7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZGljdC5fbWFwKSB7CiAgICAgICAgICBpZiAoIXN1YkRpY3QuX21hcC5oYXMoa2V5KSkgewogICAgICAgICAgICBzdWJEaWN0Ll9tYXAuc2V0KGtleSwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3ViRGljdC5zaXplID4gMCkgewogICAgICAgIG1lcmdlZERpY3QuX21hcC5zZXQobmFtZSwgc3ViRGljdCk7CiAgICAgIH0KICAgIH0KICAgIHByb3BlcnRpZXMuY2xlYXIoKTsKICAgIHJldHVybiBtZXJnZWREaWN0LnNpemUgPiAwID8gbWVyZ2VkRGljdCA6IERpY3QuZW1wdHk7CiAgfQogIGNsb25lKCkgewogICAgY29uc3QgZGljdCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBmb3IgKGNvbnN0IGtleSBvZiB0aGlzLmdldEtleXMoKSkgewogICAgICBkaWN0LnNldChrZXksIHRoaXMuZ2V0UmF3KGtleSkpOwogICAgfQogICAgcmV0dXJuIGRpY3Q7CiAgfQogIGRlbGV0ZShrZXkpIHsKICAgIHRoaXMuX21hcC5kZWxldGUoa2V5KTsKICB9Cn0KY2xhc3MgUmVmIHsKICBjb25zdHJ1Y3RvcihudW0sIGdlbikgewogICAgdGhpcy5udW0gPSBudW07CiAgICB0aGlzLmdlbiA9IGdlbjsKICB9CiAgdG9TdHJpbmcoKSB7CiAgICBpZiAodGhpcy5nZW4gPT09IDApIHsKICAgICAgcmV0dXJuIGAke3RoaXMubnVtfVJgOwogICAgfQogICAgcmV0dXJuIGAke3RoaXMubnVtfVIke3RoaXMuZ2VufWA7CiAgfQogIHN0YXRpYyBmcm9tU3RyaW5nKHN0cikgewogICAgY29uc3QgcmVmID0gUmVmQ2FjaGVbc3RyXTsKICAgIGlmIChyZWYpIHsKICAgICAgcmV0dXJuIHJlZjsKICAgIH0KICAgIGNvbnN0IG0gPSAvXihcZCspUihcZCopJC8uZXhlYyhzdHIpOwogICAgaWYgKCFtIHx8IG1bMV0gPT09ICIwIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiBSZWZDYWNoZVtzdHJdID0gbmV3IFJlZihwYXJzZUludChtWzFdKSwgIW1bMl0gPyAwIDogcGFyc2VJbnQobVsyXSkpOwogIH0KICBzdGF0aWMgZ2V0KG51bSwgZ2VuKSB7CiAgICBjb25zdCBrZXkgPSBnZW4gPT09IDAgPyBgJHtudW19UmAgOiBgJHtudW19UiR7Z2VufWA7CiAgICByZXR1cm4gUmVmQ2FjaGVba2V5XSB8fD0gbmV3IFJlZihudW0sIGdlbik7CiAgfQp9CmNsYXNzIFJlZlNldCB7CiAgY29uc3RydWN0b3IocGFyZW50ID0gbnVsbCkgewogICAgdGhpcy5fc2V0ID0gbmV3IFNldChwYXJlbnQ/Ll9zZXQpOwogIH0KICBoYXMocmVmKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LmhhcyhyZWYudG9TdHJpbmcoKSk7CiAgfQogIHB1dChyZWYpIHsKICAgIHRoaXMuX3NldC5hZGQocmVmLnRvU3RyaW5nKCkpOwogIH0KICByZW1vdmUocmVmKSB7CiAgICB0aGlzLl9zZXQuZGVsZXRlKHJlZi50b1N0cmluZygpKTsKICB9CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LnZhbHVlcygpOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXMuX3NldC5jbGVhcigpOwogIH0KfQpjbGFzcyBSZWZTZXRDYWNoZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLl9tYXAgPSBuZXcgTWFwKCk7CiAgfQogIGdldCBzaXplKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5zaXplOwogIH0KICBnZXQocmVmKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmdldChyZWYudG9TdHJpbmcoKSk7CiAgfQogIGhhcyhyZWYpIHsKICAgIHJldHVybiB0aGlzLl9tYXAuaGFzKHJlZi50b1N0cmluZygpKTsKICB9CiAgcHV0KHJlZiwgb2JqKSB7CiAgICB0aGlzLl9tYXAuc2V0KHJlZi50b1N0cmluZygpLCBvYmopOwogIH0KICBwdXRBbGlhcyhyZWYsIGFsaWFzUmVmKSB7CiAgICB0aGlzLl9tYXAuc2V0KHJlZi50b1N0cmluZygpLCB0aGlzLmdldChhbGlhc1JlZikpOwogIH0KICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIHJldHVybiB0aGlzLl9tYXAudmFsdWVzKCk7CiAgfQogIGNsZWFyKCkgewogICAgdGhpcy5fbWFwLmNsZWFyKCk7CiAgfQogICp2YWx1ZXMoKSB7CiAgICB5aWVsZCogdGhpcy5fbWFwLnZhbHVlcygpOwogIH0KICAqaXRlbXMoKSB7CiAgICBmb3IgKGNvbnN0IFtyZWYsIHZhbHVlXSBvZiB0aGlzLl9tYXApIHsKICAgICAgeWllbGQgW1JlZi5mcm9tU3RyaW5nKHJlZiksIHZhbHVlXTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gaXNOYW1lKHYsIG5hbWUpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIE5hbWUgJiYgKG5hbWUgPT09IHVuZGVmaW5lZCB8fCB2Lm5hbWUgPT09IG5hbWUpOwp9CmZ1bmN0aW9uIGlzQ21kKHYsIGNtZCkgewogIHJldHVybiB2IGluc3RhbmNlb2YgQ21kICYmIChjbWQgPT09IHVuZGVmaW5lZCB8fCB2LmNtZCA9PT0gY21kKTsKfQpmdW5jdGlvbiBpc0RpY3QodiwgdHlwZSkgewogIHJldHVybiB2IGluc3RhbmNlb2YgRGljdCAmJiAodHlwZSA9PT0gdW5kZWZpbmVkIHx8IGlzTmFtZSh2LmdldCgiVHlwZSIpLCB0eXBlKSk7Cn0KZnVuY3Rpb24gaXNSZWZzRXF1YWwodjEsIHYyKSB7CiAgcmV0dXJuIHYxLm51bSA9PT0gdjIubnVtICYmIHYxLmdlbiA9PT0gdjIuZ2VuOwp9Cgo7Ly8gLi9zcmMvY29yZS9iYXNlX3N0cmVhbS5qcwoKY2xhc3MgQmFzZVN0cmVhbSB7CiAgZ2V0IGxlbmd0aCgpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBnZXR0ZXIgYGxlbmd0aGAgYWNjZXNzZWQiKTsKICB9CiAgZ2V0IGlzRW1wdHkoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgZ2V0dGVyIGBpc0VtcHR5YCBhY2Nlc3NlZCIpOwogIH0KICBnZXQgaXNEYXRhTG9hZGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNEYXRhTG9hZGVkIiwgdHJ1ZSk7CiAgfQogIGdldEJ5dGUoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRCeXRlYCBjYWxsZWQiKTsKICB9CiAgZ2V0Qnl0ZXMobGVuZ3RoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRCeXRlc2AgY2FsbGVkIik7CiAgfQogIGFzeW5jIGdldEltYWdlRGF0YShsZW5ndGgsIGRlY29kZXJPcHRpb25zKSB7CiAgICByZXR1cm4gdGhpcy5nZXRCeXRlcyhsZW5ndGgsIGRlY29kZXJPcHRpb25zKTsKICB9CiAgYXN5bmMgYXN5bmNHZXRCeXRlcygpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYGFzeW5jR2V0Qnl0ZXNgIGNhbGxlZCIpOwogIH0KICBnZXQgaXNBc3luYygpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGlzQXN5bmNEZWNvZGVyKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBnZXQgY2FuQXN5bmNEZWNvZGVJbWFnZUZyb21CdWZmZXIoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGFzeW5jIGdldFRyYW5zZmVyYWJsZUltYWdlKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHBlZWtCeXRlKCkgewogICAgY29uc3QgcGVla2VkQnl0ZSA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgaWYgKHBlZWtlZEJ5dGUgIT09IC0xKSB7CiAgICAgIHRoaXMucG9zLS07CiAgICB9CiAgICByZXR1cm4gcGVla2VkQnl0ZTsKICB9CiAgcGVla0J5dGVzKGxlbmd0aCkgewogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmdldEJ5dGVzKGxlbmd0aCk7CiAgICB0aGlzLnBvcyAtPSBieXRlcy5sZW5ndGg7CiAgICByZXR1cm4gYnl0ZXM7CiAgfQogIGdldFVpbnQxNigpIHsKICAgIGNvbnN0IGIwID0gdGhpcy5nZXRCeXRlKCk7CiAgICBjb25zdCBiMSA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgaWYgKGIwID09PSAtMSB8fCBiMSA9PT0gLTEpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgcmV0dXJuIChiMCA8PCA4KSArIGIxOwogIH0KICBnZXRJbnQzMigpIHsKICAgIGNvbnN0IGIwID0gdGhpcy5nZXRCeXRlKCk7CiAgICBjb25zdCBiMSA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgY29uc3QgYjIgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGNvbnN0IGIzID0gdGhpcy5nZXRCeXRlKCk7CiAgICByZXR1cm4gKGIwIDw8IDI0KSArIChiMSA8PCAxNikgKyAoYjIgPDwgOCkgKyBiMzsKICB9CiAgZ2V0Qnl0ZVJhbmdlKGJlZ2luLCBlbmQpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYGdldEJ5dGVSYW5nZWAgY2FsbGVkIik7CiAgfQogIGdldFN0cmluZyhsZW5ndGgpIHsKICAgIHJldHVybiBieXRlc1RvU3RyaW5nKHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoKSk7CiAgfQogIHNraXAobikgewogICAgdGhpcy5wb3MgKz0gbiB8fCAxOwogIH0KICByZXNldCgpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYHJlc2V0YCBjYWxsZWQiKTsKICB9CiAgbW92ZVN0YXJ0KCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgbW92ZVN0YXJ0YCBjYWxsZWQiKTsKICB9CiAgbWFrZVN1YlN0cmVhbShzdGFydCwgbGVuZ3RoLCBkaWN0ID0gbnVsbCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgbWFrZVN1YlN0cmVhbWAgY2FsbGVkIik7CiAgfQogIGdldEJhc2VTdHJlYW1zKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9jb3JlX3V0aWxzLmpzCgoKCmNvbnN0IFBERl9WRVJTSU9OX1JFR0VYUCA9IC9eWzEtOV1cLlxkJC87CmNvbnN0IE1BWF9JTlRfMzIgPSAyICoqIDMxIC0gMTsKY29uc3QgTUlOX0lOVF8zMiA9IC0oMiAqKiAzMSk7CmNvbnN0IElERU5USVRZX01BVFJJWCA9IFsxLCAwLCAwLCAxLCAwLCAwXTsKY29uc3QgUkVTT1VSQ0VTX0tFWVNfT1BFUkFUT1JfTElTVCA9IFsiQ29sb3JTcGFjZSIsICJFeHRHU3RhdGUiLCAiRm9udCIsICJQYXR0ZXJuIiwgIlByb3BlcnRpZXMiLCAiU2hhZGluZyIsICJYT2JqZWN0Il07CmNvbnN0IFJFU09VUkNFU19LRVlTX1RFWFRfQ09OVEVOVCA9IFsiRXh0R1N0YXRlIiwgIkZvbnQiLCAiUHJvcGVydGllcyIsICJYT2JqZWN0Il07CmZ1bmN0aW9uIGdldExvb2t1cFRhYmxlRmFjdG9yeShpbml0aWFsaXplcikgewogIGxldCBsb29rdXA7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIGlmIChpbml0aWFsaXplcikgewogICAgICBsb29rdXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBpbml0aWFsaXplcihsb29rdXApOwogICAgICBpbml0aWFsaXplciA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gbG9va3VwOwogIH07Cn0KY2xhc3MgTWlzc2luZ0RhdGFFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3RvcihiZWdpbiwgZW5kKSB7CiAgICBzdXBlcihgTWlzc2luZyBkYXRhIFske2JlZ2lufSwgJHtlbmR9KWAsICJNaXNzaW5nRGF0YUV4Y2VwdGlvbiIpOwogICAgdGhpcy5iZWdpbiA9IGJlZ2luOwogICAgdGhpcy5lbmQgPSBlbmQ7CiAgfQp9CmNsYXNzIFBhcnNlckVPRkV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiUGFyc2VyRU9GRXhjZXB0aW9uIik7CiAgfQp9CmNsYXNzIFhSZWZFbnRyeUV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiWFJlZkVudHJ5RXhjZXB0aW9uIik7CiAgfQp9CmNsYXNzIFhSZWZQYXJzZUV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiWFJlZlBhcnNlRXhjZXB0aW9uIik7CiAgfQp9CmZ1bmN0aW9uIGFycmF5QnVmZmVyc1RvQnl0ZXMoYXJyKSB7CiAgY29uc3QgbGVuZ3RoID0gYXJyLmxlbmd0aDsKICBpZiAobGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgfQogIGlmIChsZW5ndGggPT09IDEpIHsKICAgIHJldHVybiBuZXcgVWludDhBcnJheShhcnJbMF0pOwogIH0KICBsZXQgZGF0YUxlbmd0aCA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgZGF0YUxlbmd0aCArPSBhcnJbaV0uYnl0ZUxlbmd0aDsKICB9CiAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGRhdGFMZW5ndGgpOwogIGxldCBwb3MgPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGl0ZW0gPSBuZXcgVWludDhBcnJheShhcnJbaV0pOwogICAgZGF0YS5zZXQoaXRlbSwgcG9zKTsKICAgIHBvcyArPSBpdGVtLmJ5dGVMZW5ndGg7CiAgfQogIHJldHVybiBkYXRhOwp9CmFzeW5jIGZ1bmN0aW9uIGZldGNoQmluYXJ5RGF0YSh1cmwpIHsKICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7CiAgaWYgKCFyZXNwb25zZS5vaykgewogICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggZmlsZSAiJHt1cmx9IiB3aXRoICIke3Jlc3BvbnNlLnN0YXR1c1RleHR9Ii5gKTsKICB9CiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGF3YWl0IHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpOwp9CmZ1bmN0aW9uIGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogIGRpY3QsCiAga2V5LAogIGdldEFycmF5ID0gZmFsc2UsCiAgc3RvcFdoZW5Gb3VuZCA9IHRydWUKfSkgewogIGxldCB2YWx1ZXM7CiAgY29uc3QgdmlzaXRlZCA9IG5ldyBSZWZTZXQoKTsKICB3aGlsZSAoZGljdCBpbnN0YW5jZW9mIERpY3QgJiYgIShkaWN0Lm9iaklkICYmIHZpc2l0ZWQuaGFzKGRpY3Qub2JqSWQpKSkgewogICAgaWYgKGRpY3Qub2JqSWQpIHsKICAgICAgdmlzaXRlZC5wdXQoZGljdC5vYmpJZCk7CiAgICB9CiAgICBjb25zdCB2YWx1ZSA9IGdldEFycmF5ID8gZGljdC5nZXRBcnJheShrZXkpIDogZGljdC5nZXQoa2V5KTsKICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmIChzdG9wV2hlbkZvdW5kKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CiAgICAgICh2YWx1ZXMgfHw9IFtdKS5wdXNoKHZhbHVlKTsKICAgIH0KICAgIGRpY3QgPSBkaWN0LmdldCgiUGFyZW50Iik7CiAgfQogIHJldHVybiB2YWx1ZXM7Cn0KZnVuY3Rpb24gZ2V0UGFyZW50VG9VcGRhdGUoZGljdCwgcmVmLCB4cmVmKSB7CiAgY29uc3QgdmlzaXRlZCA9IG5ldyBSZWZTZXQoKTsKICBjb25zdCBmaXJzdERpY3QgPSBkaWN0OwogIGNvbnN0IHJlc3VsdCA9IHsKICAgIGRpY3Q6IG51bGwsCiAgICByZWY6IG51bGwKICB9OwogIHdoaWxlIChkaWN0IGluc3RhbmNlb2YgRGljdCAmJiAhdmlzaXRlZC5oYXMocmVmKSkgewogICAgdmlzaXRlZC5wdXQocmVmKTsKICAgIGlmIChkaWN0LmhhcygiVCIpKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgcmVmID0gZGljdC5nZXRSYXcoIlBhcmVudCIpOwogICAgaWYgKCEocmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgZGljdCA9IHhyZWYuZmV0Y2gocmVmKTsKICB9CiAgaWYgKGRpY3QgaW5zdGFuY2VvZiBEaWN0ICYmIGRpY3QgIT09IGZpcnN0RGljdCkgewogICAgcmVzdWx0LmRpY3QgPSBkaWN0OwogICAgcmVzdWx0LnJlZiA9IHJlZjsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfQpjb25zdCBST01BTl9OVU1CRVJfTUFQID0gWyIiLCAiQyIsICJDQyIsICJDQ0MiLCAiQ0QiLCAiRCIsICJEQyIsICJEQ0MiLCAiRENDQyIsICJDTSIsICIiLCAiWCIsICJYWCIsICJYWFgiLCAiWEwiLCAiTCIsICJMWCIsICJMWFgiLCAiTFhYWCIsICJYQyIsICIiLCAiSSIsICJJSSIsICJJSUkiLCAiSVYiLCAiViIsICJWSSIsICJWSUkiLCAiVklJSSIsICJJWCJdOwpmdW5jdGlvbiB0b1JvbWFuTnVtZXJhbHMobnVtYmVyLCBsb3dlckNhc2UgPSBmYWxzZSkgewogIGFzc2VydChOdW1iZXIuaXNJbnRlZ2VyKG51bWJlcikgJiYgbnVtYmVyID4gMCwgIlRoZSBudW1iZXIgc2hvdWxkIGJlIGEgcG9zaXRpdmUgaW50ZWdlci4iKTsKICBjb25zdCByb21hbiA9ICJNIi5yZXBlYXQobnVtYmVyIC8gMTAwMCB8IDApICsgUk9NQU5fTlVNQkVSX01BUFtudW1iZXIgJSAxMDAwIC8gMTAwIHwgMF0gKyBST01BTl9OVU1CRVJfTUFQWzEwICsgKG51bWJlciAlIDEwMCAvIDEwIHwgMCldICsgUk9NQU5fTlVNQkVSX01BUFsyMCArIG51bWJlciAlIDEwXTsKICByZXR1cm4gbG93ZXJDYXNlID8gcm9tYW4udG9Mb3dlckNhc2UoKSA6IHJvbWFuOwp9CmZ1bmN0aW9uIGxvZzIoeCkgewogIHJldHVybiB4ID4gMCA/IE1hdGguY2VpbChNYXRoLmxvZzIoeCkpIDogMDsKfQpmdW5jdGlvbiByZWFkSW50OChkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gZGF0YVtvZmZzZXRdIDw8IDI0ID4+IDI0Owp9CmZ1bmN0aW9uIHJlYWRJbnQxNihkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gKGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYpID4+IDE2Owp9CmZ1bmN0aW9uIHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCA4IHwgZGF0YVtvZmZzZXQgKyAxXTsKfQpmdW5jdGlvbiByZWFkVWludDMyKGRhdGEsIG9mZnNldCkgewogIHJldHVybiAoZGF0YVtvZmZzZXRdIDw8IDI0IHwgZGF0YVtvZmZzZXQgKyAxXSA8PCAxNiB8IGRhdGFbb2Zmc2V0ICsgMl0gPDwgOCB8IGRhdGFbb2Zmc2V0ICsgM10pID4+PiAwOwp9CmZ1bmN0aW9uIGlzV2hpdGVTcGFjZShjaCkgewogIHJldHVybiBjaCA9PT0gMHgyMCB8fCBjaCA9PT0gMHgwOSB8fCBjaCA9PT0gMHgwZCB8fCBjaCA9PT0gMHgwYTsKfQpmdW5jdGlvbiBpc0Jvb2xlYW5BcnJheShhcnIsIGxlbikgewogIHJldHVybiBBcnJheS5pc0FycmF5KGFycikgJiYgKGxlbiA9PT0gbnVsbCB8fCBhcnIubGVuZ3RoID09PSBsZW4pICYmIGFyci5ldmVyeSh4ID0+IHR5cGVvZiB4ID09PSAiYm9vbGVhbiIpOwp9CmZ1bmN0aW9uIGlzTnVtYmVyQXJyYXkoYXJyLCBsZW4pIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICByZXR1cm4gKGxlbiA9PT0gbnVsbCB8fCBhcnIubGVuZ3RoID09PSBsZW4pICYmIGFyci5ldmVyeSh4ID0+IHR5cGVvZiB4ID09PSAibnVtYmVyIik7CiAgfQogIHJldHVybiBBcnJheUJ1ZmZlci5pc1ZpZXcoYXJyKSAmJiAhKGFyciBpbnN0YW5jZW9mIEJpZ0ludDY0QXJyYXkgfHwgYXJyIGluc3RhbmNlb2YgQmlnVWludDY0QXJyYXkpICYmIChsZW4gPT09IG51bGwgfHwgYXJyLmxlbmd0aCA9PT0gbGVuKTsKfQpmdW5jdGlvbiBsb29rdXBNYXRyaXgoYXJyLCBmYWxsYmFjaykgewogIHJldHVybiBpc051bWJlckFycmF5KGFyciwgNikgPyBhcnIgOiBmYWxsYmFjazsKfQpmdW5jdGlvbiBsb29rdXBSZWN0KGFyciwgZmFsbGJhY2spIHsKICByZXR1cm4gaXNOdW1iZXJBcnJheShhcnIsIDQpID8gYXJyIDogZmFsbGJhY2s7Cn0KZnVuY3Rpb24gbG9va3VwTm9ybWFsUmVjdChhcnIsIGZhbGxiYWNrKSB7CiAgcmV0dXJuIGlzTnVtYmVyQXJyYXkoYXJyLCA0KSA/IFV0aWwubm9ybWFsaXplUmVjdChhcnIpIDogZmFsbGJhY2s7Cn0KZnVuY3Rpb24gcGFyc2VYRkFQYXRoKHBhdGgpIHsKICBjb25zdCBwb3NpdGlvblBhdHRlcm4gPSAvKC4rKVxbKFxkKylcXSQvOwogIHJldHVybiBwYXRoLnNwbGl0KCIuIikubWFwKGNvbXBvbmVudCA9PiB7CiAgICBjb25zdCBtID0gY29tcG9uZW50Lm1hdGNoKHBvc2l0aW9uUGF0dGVybik7CiAgICBpZiAobSkgewogICAgICByZXR1cm4gewogICAgICAgIG5hbWU6IG1bMV0sCiAgICAgICAgcG9zOiBwYXJzZUludChtWzJdLCAxMCkKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGNvbXBvbmVudCwKICAgICAgcG9zOiAwCiAgICB9OwogIH0pOwp9CmZ1bmN0aW9uIGVzY2FwZVBERk5hbWUoc3RyKSB7CiAgY29uc3QgYnVmZmVyID0gW107CiAgbGV0IHN0YXJ0ID0gMDsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgaWYgKGNoYXIgPCAweDIxIHx8IGNoYXIgPiAweDdlIHx8IGNoYXIgPT09IDB4MjMgfHwgY2hhciA9PT0gMHgyOCB8fCBjaGFyID09PSAweDI5IHx8IGNoYXIgPT09IDB4M2MgfHwgY2hhciA9PT0gMHgzZSB8fCBjaGFyID09PSAweDViIHx8IGNoYXIgPT09IDB4NWQgfHwgY2hhciA9PT0gMHg3YiB8fCBjaGFyID09PSAweDdkIHx8IGNoYXIgPT09IDB4MmYgfHwgY2hhciA9PT0gMHgyNSkgewogICAgICBpZiAoc3RhcnQgPCBpKSB7CiAgICAgICAgYnVmZmVyLnB1c2goc3RyLnN1YnN0cmluZyhzdGFydCwgaSkpOwogICAgICB9CiAgICAgIGJ1ZmZlci5wdXNoKGAjJHtjaGFyLnRvU3RyaW5nKDE2KX1gKTsKICAgICAgc3RhcnQgPSBpICsgMTsKICAgIH0KICB9CiAgaWYgKGJ1ZmZlci5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBzdHI7CiAgfQogIGlmIChzdGFydCA8IHN0ci5sZW5ndGgpIHsKICAgIGJ1ZmZlci5wdXNoKHN0ci5zdWJzdHJpbmcoc3RhcnQsIHN0ci5sZW5ndGgpKTsKICB9CiAgcmV0dXJuIGJ1ZmZlci5qb2luKCIiKTsKfQpmdW5jdGlvbiBlc2NhcGVTdHJpbmcoc3RyKSB7CiAgcmV0dXJuIHN0ci5yZXBsYWNlQWxsKC8oWygpXFxcblxyXSkvZywgbWF0Y2ggPT4gewogICAgaWYgKG1hdGNoID09PSAiXG4iKSB7CiAgICAgIHJldHVybiAiXFxuIjsKICAgIH0gZWxzZSBpZiAobWF0Y2ggPT09ICJcciIpIHsKICAgICAgcmV0dXJuICJcXHIiOwogICAgfQogICAgcmV0dXJuIGBcXCR7bWF0Y2h9YDsKICB9KTsKfQpmdW5jdGlvbiBfY29sbGVjdEpTKGVudHJ5LCB4cmVmLCBsaXN0LCBwYXJlbnRzKSB7CiAgaWYgKCFlbnRyeSkgewogICAgcmV0dXJuOwogIH0KICBsZXQgcGFyZW50ID0gbnVsbDsKICBpZiAoZW50cnkgaW5zdGFuY2VvZiBSZWYpIHsKICAgIGlmIChwYXJlbnRzLmhhcyhlbnRyeSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgcGFyZW50ID0gZW50cnk7CiAgICBwYXJlbnRzLnB1dChwYXJlbnQpOwogICAgZW50cnkgPSB4cmVmLmZldGNoKGVudHJ5KTsKICB9CiAgaWYgKEFycmF5LmlzQXJyYXkoZW50cnkpKSB7CiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZW50cnkpIHsKICAgICAgX2NvbGxlY3RKUyhlbGVtZW50LCB4cmVmLCBsaXN0LCBwYXJlbnRzKTsKICAgIH0KICB9IGVsc2UgaWYgKGVudHJ5IGluc3RhbmNlb2YgRGljdCkgewogICAgaWYgKGlzTmFtZShlbnRyeS5nZXQoIlMiKSwgIkphdmFTY3JpcHQiKSkgewogICAgICBjb25zdCBqcyA9IGVudHJ5LmdldCgiSlMiKTsKICAgICAgbGV0IGNvZGU7CiAgICAgIGlmIChqcyBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBjb2RlID0ganMuZ2V0U3RyaW5nKCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGpzID09PSAic3RyaW5nIikgewogICAgICAgIGNvZGUgPSBqczsKICAgICAgfQogICAgICBjb2RlICYmPSBzdHJpbmdUb1BERlN0cmluZyhjb2RlLCB0cnVlKS5yZXBsYWNlQWxsKCJceDAwIiwgIiIpOwogICAgICBpZiAoY29kZSkgewogICAgICAgIGxpc3QucHVzaChjb2RlLnRyaW0oKSk7CiAgICAgIH0KICAgIH0KICAgIF9jb2xsZWN0SlMoZW50cnkuZ2V0UmF3KCJOZXh0IiksIHhyZWYsIGxpc3QsIHBhcmVudHMpOwogIH0KICBpZiAocGFyZW50KSB7CiAgICBwYXJlbnRzLnJlbW92ZShwYXJlbnQpOwogIH0KfQpmdW5jdGlvbiBjb2xsZWN0QWN0aW9ucyh4cmVmLCBkaWN0LCBldmVudFR5cGUpIHsKICBjb25zdCBhY3Rpb25zID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBjb25zdCBhZGRpdGlvbmFsQWN0aW9uc0RpY3RzID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICBkaWN0LAogICAga2V5OiAiQUEiLAogICAgc3RvcFdoZW5Gb3VuZDogZmFsc2UKICB9KTsKICBpZiAoYWRkaXRpb25hbEFjdGlvbnNEaWN0cykgewogICAgZm9yIChsZXQgaSA9IGFkZGl0aW9uYWxBY3Rpb25zRGljdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgY29uc3QgYWRkaXRpb25hbEFjdGlvbnMgPSBhZGRpdGlvbmFsQWN0aW9uc0RpY3RzW2ldOwogICAgICBpZiAoIShhZGRpdGlvbmFsQWN0aW9ucyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBrZXkgb2YgYWRkaXRpb25hbEFjdGlvbnMuZ2V0S2V5cygpKSB7CiAgICAgICAgY29uc3QgYWN0aW9uID0gZXZlbnRUeXBlW2tleV07CiAgICAgICAgaWYgKCFhY3Rpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBhY3Rpb25EaWN0ID0gYWRkaXRpb25hbEFjdGlvbnMuZ2V0UmF3KGtleSk7CiAgICAgICAgY29uc3QgcGFyZW50cyA9IG5ldyBSZWZTZXQoKTsKICAgICAgICBjb25zdCBsaXN0ID0gW107CiAgICAgICAgX2NvbGxlY3RKUyhhY3Rpb25EaWN0LCB4cmVmLCBsaXN0LCBwYXJlbnRzKTsKICAgICAgICBpZiAobGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICBhY3Rpb25zW2FjdGlvbl0gPSBsaXN0OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBpZiAoZGljdC5oYXMoIkEiKSkgewogICAgY29uc3QgYWN0aW9uRGljdCA9IGRpY3QuZ2V0KCJBIik7CiAgICBjb25zdCBwYXJlbnRzID0gbmV3IFJlZlNldCgpOwogICAgY29uc3QgbGlzdCA9IFtdOwogICAgX2NvbGxlY3RKUyhhY3Rpb25EaWN0LCB4cmVmLCBsaXN0LCBwYXJlbnRzKTsKICAgIGlmIChsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgYWN0aW9ucy5BY3Rpb24gPSBsaXN0OwogICAgfQogIH0KICByZXR1cm4gb2JqZWN0U2l6ZShhY3Rpb25zKSA+IDAgPyBhY3Rpb25zIDogbnVsbDsKfQpjb25zdCBYTUxFbnRpdGllcyA9IHsKICAweDNjOiAiJmx0OyIsCiAgMHgzZTogIiZndDsiLAogIDB4MjY6ICImYW1wOyIsCiAgMHgyMjogIiZxdW90OyIsCiAgMHgyNzogIiZhcG9zOyIKfTsKZnVuY3Rpb24qIGNvZGVQb2ludEl0ZXIoc3RyKSB7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3RyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IGNoYXIgPSBzdHIuY29kZVBvaW50QXQoaSk7CiAgICBpZiAoY2hhciA+IDB4ZDdmZiAmJiAoY2hhciA8IDB4ZTAwMCB8fCBjaGFyID4gMHhmZmZkKSkgewogICAgICBpKys7CiAgICB9CiAgICB5aWVsZCBjaGFyOwogIH0KfQpmdW5jdGlvbiBlbmNvZGVUb1htbFN0cmluZyhzdHIpIHsKICBjb25zdCBidWZmZXIgPSBbXTsKICBsZXQgc3RhcnQgPSAwOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyID0gc3RyLmNvZGVQb2ludEF0KGkpOwogICAgaWYgKDB4MjAgPD0gY2hhciAmJiBjaGFyIDw9IDB4N2UpIHsKICAgICAgY29uc3QgZW50aXR5ID0gWE1MRW50aXRpZXNbY2hhcl07CiAgICAgIGlmIChlbnRpdHkpIHsKICAgICAgICBpZiAoc3RhcnQgPCBpKSB7CiAgICAgICAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBpKSk7CiAgICAgICAgfQogICAgICAgIGJ1ZmZlci5wdXNoKGVudGl0eSk7CiAgICAgICAgc3RhcnQgPSBpICsgMTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKHN0YXJ0IDwgaSkgewogICAgICAgIGJ1ZmZlci5wdXNoKHN0ci5zdWJzdHJpbmcoc3RhcnQsIGkpKTsKICAgICAgfQogICAgICBidWZmZXIucHVzaChgJiN4JHtjaGFyLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpfTtgKTsKICAgICAgaWYgKGNoYXIgPiAweGQ3ZmYgJiYgKGNoYXIgPCAweGUwMDAgfHwgY2hhciA+IDB4ZmZmZCkpIHsKICAgICAgICBpKys7CiAgICAgIH0KICAgICAgc3RhcnQgPSBpICsgMTsKICAgIH0KICB9CiAgaWYgKGJ1ZmZlci5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBzdHI7CiAgfQogIGlmIChzdGFydCA8IHN0ci5sZW5ndGgpIHsKICAgIGJ1ZmZlci5wdXNoKHN0ci5zdWJzdHJpbmcoc3RhcnQsIHN0ci5sZW5ndGgpKTsKICB9CiAgcmV0dXJuIGJ1ZmZlci5qb2luKCIiKTsKfQpmdW5jdGlvbiB2YWxpZGF0ZUZvbnROYW1lKGZvbnRGYW1pbHksIG11c3RXYXJuID0gZmFsc2UpIHsKICBjb25zdCBtID0gL14oInwnKS4qKCJ8JykkLy5leGVjKGZvbnRGYW1pbHkpOwogIGlmIChtICYmIG1bMV0gPT09IG1bMl0pIHsKICAgIGNvbnN0IHJlID0gbmV3IFJlZ0V4cChgW15cXFxcXSR7bVsxXX1gKTsKICAgIGlmIChyZS50ZXN0KGZvbnRGYW1pbHkuc2xpY2UoMSwgLTEpKSkgewogICAgICBpZiAobXVzdFdhcm4pIHsKICAgICAgICB3YXJuKGBGb250RmFtaWx5IGNvbnRhaW5zIHVuZXNjYXBlZCAke21bMV19OiAke2ZvbnRGYW1pbHl9LmApOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9IGVsc2UgewogICAgZm9yIChjb25zdCBpZGVudCBvZiBmb250RmFtaWx5LnNwbGl0KC9bIFx0XSsvKSkgewogICAgICBpZiAoL14oXGR8KC0oXGR8LSkpKS8udGVzdChpZGVudCkgfHwgIS9eW1x3LVxcXSskLy50ZXN0KGlkZW50KSkgewogICAgICAgIGlmIChtdXN0V2FybikgewogICAgICAgICAgd2FybihgRm9udEZhbWlseSBjb250YWlucyBpbnZhbGlkIDxjdXN0b20taWRlbnQ+OiAke2ZvbnRGYW1pbHl9LmApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gdmFsaWRhdGVDU1NGb250KGNzc0ZvbnRJbmZvKSB7CiAgY29uc3QgREVGQVVMVF9DU1NfRk9OVF9PQkxJUVVFID0gIjE0IjsKICBjb25zdCBERUZBVUxUX0NTU19GT05UX1dFSUdIVCA9ICI0MDAiOwogIGNvbnN0IENTU19GT05UX1dFSUdIVF9WQUxVRVMgPSBuZXcgU2V0KFsiMTAwIiwgIjIwMCIsICIzMDAiLCAiNDAwIiwgIjUwMCIsICI2MDAiLCAiNzAwIiwgIjgwMCIsICI5MDAiLCAiMTAwMCIsICJub3JtYWwiLCAiYm9sZCIsICJib2xkZXIiLCAibGlnaHRlciJdKTsKICBjb25zdCB7CiAgICBmb250RmFtaWx5LAogICAgZm9udFdlaWdodCwKICAgIGl0YWxpY0FuZ2xlCiAgfSA9IGNzc0ZvbnRJbmZvOwogIGlmICghdmFsaWRhdGVGb250TmFtZShmb250RmFtaWx5LCB0cnVlKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCB3ZWlnaHQgPSBmb250V2VpZ2h0ID8gZm9udFdlaWdodC50b1N0cmluZygpIDogIiI7CiAgY3NzRm9udEluZm8uZm9udFdlaWdodCA9IENTU19GT05UX1dFSUdIVF9WQUxVRVMuaGFzKHdlaWdodCkgPyB3ZWlnaHQgOiBERUZBVUxUX0NTU19GT05UX1dFSUdIVDsKICBjb25zdCBhbmdsZSA9IHBhcnNlRmxvYXQoaXRhbGljQW5nbGUpOwogIGNzc0ZvbnRJbmZvLml0YWxpY0FuZ2xlID0gaXNOYU4oYW5nbGUpIHx8IGFuZ2xlIDwgLTkwIHx8IGFuZ2xlID4gOTAgPyBERUZBVUxUX0NTU19GT05UX09CTElRVUUgOiBpdGFsaWNBbmdsZS50b1N0cmluZygpOwogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIHJlY292ZXJKc1VSTChzdHIpIHsKICBjb25zdCBVUkxfT1BFTl9NRVRIT0RTID0gWyJhcHAubGF1bmNoVVJMIiwgIndpbmRvdy5vcGVuIiwgInhmYS5ob3N0LmdvdG9VUkwiXTsKICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoIl5cXHMqKCIgKyBVUkxfT1BFTl9NRVRIT0RTLmpvaW4oInwiKS5yZXBsYWNlQWxsKCIuIiwgIlxcLiIpICsgIilcXCgoPzonfFwiKShbXidcIl0qKSg/Oid8XCIpKD86LFxccyooXFx3KylcXCl8XFwpKSIsICJpIik7CiAgY29uc3QganNVcmwgPSByZWdleC5leGVjKHN0cik7CiAgaWYgKGpzVXJsPy5bMl0pIHsKICAgIHJldHVybiB7CiAgICAgIHVybDoganNVcmxbMl0sCiAgICAgIG5ld1dpbmRvdzoganNVcmxbMV0gPT09ICJhcHAubGF1bmNoVVJMIiAmJiBqc1VybFszXSA9PT0gInRydWUiCiAgICB9OwogIH0KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiBudW1iZXJUb1N0cmluZyh2YWx1ZSkgewogIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSkgewogICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7CiAgfQogIGNvbnN0IHJvdW5kZWRWYWx1ZSA9IE1hdGgucm91bmQodmFsdWUgKiAxMDApOwogIGlmIChyb3VuZGVkVmFsdWUgJSAxMDAgPT09IDApIHsKICAgIHJldHVybiAocm91bmRlZFZhbHVlIC8gMTAwKS50b1N0cmluZygpOwogIH0KICBpZiAocm91bmRlZFZhbHVlICUgMTAgPT09IDApIHsKICAgIHJldHVybiB2YWx1ZS50b0ZpeGVkKDEpOwogIH0KICByZXR1cm4gdmFsdWUudG9GaXhlZCgyKTsKfQpmdW5jdGlvbiBnZXROZXdBbm5vdGF0aW9uc01hcChhbm5vdGF0aW9uU3RvcmFnZSkgewogIGlmICghYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBuZXdBbm5vdGF0aW9uc0J5UGFnZSA9IG5ldyBNYXAoKTsKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgaWYgKCFrZXkuc3RhcnRzV2l0aChBbm5vdGF0aW9uRWRpdG9yUHJlZml4KSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGxldCBhbm5vdGF0aW9ucyA9IG5ld0Fubm90YXRpb25zQnlQYWdlLmdldCh2YWx1ZS5wYWdlSW5kZXgpOwogICAgaWYgKCFhbm5vdGF0aW9ucykgewogICAgICBhbm5vdGF0aW9ucyA9IFtdOwogICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZS5zZXQodmFsdWUucGFnZUluZGV4LCBhbm5vdGF0aW9ucyk7CiAgICB9CiAgICBhbm5vdGF0aW9ucy5wdXNoKHZhbHVlKTsKICB9CiAgcmV0dXJuIG5ld0Fubm90YXRpb25zQnlQYWdlLnNpemUgPiAwID8gbmV3QW5ub3RhdGlvbnNCeVBhZ2UgOiBudWxsOwp9CmZ1bmN0aW9uIHN0cmluZ1RvQXNjaWlPclVURjE2QkUoc3RyKSB7CiAgaWYgKHN0ciA9PT0gbnVsbCB8fCBzdHIgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIHN0cjsKICB9CiAgcmV0dXJuIGlzQXNjaWkoc3RyKSA/IHN0ciA6IHN0cmluZ1RvVVRGMTZTdHJpbmcoc3RyLCB0cnVlKTsKfQpmdW5jdGlvbiBpc0FzY2lpKHN0cikgewogIGlmICh0eXBlb2Ygc3RyICE9PSAic3RyaW5nIikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICByZXR1cm4gIXN0ciB8fCAvXltceDAwLVx4N0ZdKiQvLnRlc3Qoc3RyKTsKfQpmdW5jdGlvbiBzdHJpbmdUb1VURjE2SGV4U3RyaW5nKHN0cikgewogIGNvbnN0IGJ1ZiA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICBidWYucHVzaChoZXhOdW1iZXJzW2NoYXIgPj4gOCAmIDB4ZmZdLCBoZXhOdW1iZXJzW2NoYXIgJiAweGZmXSk7CiAgfQogIHJldHVybiBidWYuam9pbigiIik7Cn0KZnVuY3Rpb24gc3RyaW5nVG9VVEYxNlN0cmluZyhzdHIsIGJpZ0VuZGlhbiA9IGZhbHNlKSB7CiAgY29uc3QgYnVmID0gW107CiAgaWYgKGJpZ0VuZGlhbikgewogICAgYnVmLnB1c2goIlx4RkVceEZGIik7CiAgfQogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICBidWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXIgPj4gOCAmIDB4ZmYpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXIgJiAweGZmKSk7CiAgfQogIHJldHVybiBidWYuam9pbigiIik7Cn0KZnVuY3Rpb24gZ2V0Um90YXRpb25NYXRyaXgocm90YXRpb24sIHdpZHRoLCBoZWlnaHQpIHsKICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICBjYXNlIDkwOgogICAgICByZXR1cm4gWzAsIDEsIC0xLCAwLCB3aWR0aCwgMF07CiAgICBjYXNlIDE4MDoKICAgICAgcmV0dXJuIFstMSwgMCwgMCwgLTEsIHdpZHRoLCBoZWlnaHRdOwogICAgY2FzZSAyNzA6CiAgICAgIHJldHVybiBbMCwgLTEsIDEsIDAsIDAsIGhlaWdodF07CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcm90YXRpb24iKTsKICB9Cn0KZnVuY3Rpb24gZ2V0U2l6ZUluQnl0ZXMoeCkgewogIHJldHVybiBNYXRoLmNlaWwoTWF0aC5jZWlsKE1hdGgubG9nMigxICsgeCkpIC8gOCk7Cn0KCjsvLyAuL2V4dGVybmFsL3FjbXMvcWNtc191dGlscy5qcwpjbGFzcyBRQ01TIHsKICBzdGF0aWMgI21lbW9yeUFycmF5ID0gbnVsbDsKICBzdGF0aWMgX21lbW9yeSA9IG51bGw7CiAgc3RhdGljIF9tdXN0QWRkQWxwaGEgPSBmYWxzZTsKICBzdGF0aWMgX2Rlc3RCdWZmZXIgPSBudWxsOwogIHN0YXRpYyBfZGVzdE9mZnNldCA9IDA7CiAgc3RhdGljIF9kZXN0TGVuZ3RoID0gMDsKICBzdGF0aWMgX2Nzc0NvbG9yID0gIiI7CiAgc3RhdGljIF9tYWtlSGV4Q29sb3IgPSBudWxsOwogIHN0YXRpYyBnZXQgX21lbW9yeUFycmF5KCkgewogICAgY29uc3QgYXJyYXkgPSB0aGlzLiNtZW1vcnlBcnJheTsKICAgIGlmIChhcnJheT8uYnl0ZUxlbmd0aCkgewogICAgICByZXR1cm4gYXJyYXk7CiAgICB9CiAgICByZXR1cm4gdGhpcy4jbWVtb3J5QXJyYXkgPSBuZXcgVWludDhBcnJheSh0aGlzLl9tZW1vcnkuYnVmZmVyKTsKICB9Cn0KZnVuY3Rpb24gY29weV9yZXN1bHQocHRyLCBsZW4pIHsKICBjb25zdCB7CiAgICBfbXVzdEFkZEFscGhhLAogICAgX2Rlc3RCdWZmZXIsCiAgICBfZGVzdE9mZnNldCwKICAgIF9kZXN0TGVuZ3RoLAogICAgX21lbW9yeUFycmF5CiAgfSA9IFFDTVM7CiAgaWYgKGxlbiA9PT0gX2Rlc3RMZW5ndGgpIHsKICAgIF9kZXN0QnVmZmVyLnNldChfbWVtb3J5QXJyYXkuc3ViYXJyYXkocHRyLCBwdHIgKyBsZW4pLCBfZGVzdE9mZnNldCk7CiAgICByZXR1cm47CiAgfQogIGlmIChfbXVzdEFkZEFscGhhKSB7CiAgICBmb3IgKGxldCBpID0gcHRyLCBpaSA9IHB0ciArIGxlbiwgaiA9IF9kZXN0T2Zmc2V0OyBpIDwgaWk7IGkgKz0gMywgaiArPSA0KSB7CiAgICAgIF9kZXN0QnVmZmVyW2pdID0gX21lbW9yeUFycmF5W2ldOwogICAgICBfZGVzdEJ1ZmZlcltqICsgMV0gPSBfbWVtb3J5QXJyYXlbaSArIDFdOwogICAgICBfZGVzdEJ1ZmZlcltqICsgMl0gPSBfbWVtb3J5QXJyYXlbaSArIDJdOwogICAgICBfZGVzdEJ1ZmZlcltqICsgM10gPSAyNTU7CiAgICB9CiAgfSBlbHNlIHsKICAgIGZvciAobGV0IGkgPSBwdHIsIGlpID0gcHRyICsgbGVuLCBqID0gX2Rlc3RPZmZzZXQ7IGkgPCBpaTsgaSArPSAzLCBqICs9IDQpIHsKICAgICAgX2Rlc3RCdWZmZXJbal0gPSBfbWVtb3J5QXJyYXlbaV07CiAgICAgIF9kZXN0QnVmZmVyW2ogKyAxXSA9IF9tZW1vcnlBcnJheVtpICsgMV07CiAgICAgIF9kZXN0QnVmZmVyW2ogKyAyXSA9IF9tZW1vcnlBcnJheVtpICsgMl07CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGNvcHlfcmdiKHB0cikgewogIGNvbnN0IHsKICAgIF9kZXN0QnVmZmVyLAogICAgX2Rlc3RPZmZzZXQsCiAgICBfbWVtb3J5QXJyYXkKICB9ID0gUUNNUzsKICBfZGVzdEJ1ZmZlcltfZGVzdE9mZnNldF0gPSBfbWVtb3J5QXJyYXlbcHRyXTsKICBfZGVzdEJ1ZmZlcltfZGVzdE9mZnNldCArIDFdID0gX21lbW9yeUFycmF5W3B0ciArIDFdOwogIF9kZXN0QnVmZmVyW19kZXN0T2Zmc2V0ICsgMl0gPSBfbWVtb3J5QXJyYXlbcHRyICsgMl07Cn0KZnVuY3Rpb24gbWFrZV9jc3NSR0IocHRyKSB7CiAgY29uc3QgewogICAgX21lbW9yeUFycmF5CiAgfSA9IFFDTVM7CiAgUUNNUy5fY3NzQ29sb3IgPSBRQ01TLl9tYWtlSGV4Q29sb3IoX21lbW9yeUFycmF5W3B0cl0sIF9tZW1vcnlBcnJheVtwdHIgKyAxXSwgX21lbW9yeUFycmF5W3B0ciArIDJdKTsKfQoKOy8vIC4vZXh0ZXJuYWwvcWNtcy9xY21zLmpzCgpsZXQgd2FzbTsKY29uc3QgY2FjaGVkVGV4dERlY29kZXIgPSB0eXBlb2YgVGV4dERlY29kZXIgIT09ICd1bmRlZmluZWQnID8gbmV3IFRleHREZWNvZGVyKCd1dGYtOCcsIHsKICBpZ25vcmVCT006IHRydWUsCiAgZmF0YWw6IHRydWUKfSkgOiB7CiAgZGVjb2RlOiAoKSA9PiB7CiAgICB0aHJvdyBFcnJvcignVGV4dERlY29kZXIgbm90IGF2YWlsYWJsZScpOwogIH0KfTsKaWYgKHR5cGVvZiBUZXh0RGVjb2RlciAhPT0gJ3VuZGVmaW5lZCcpIHsKICBjYWNoZWRUZXh0RGVjb2Rlci5kZWNvZGUoKTsKfQo7CmxldCBjYWNoZWRVaW50OEFycmF5TWVtb3J5MCA9IG51bGw7CmZ1bmN0aW9uIGdldFVpbnQ4QXJyYXlNZW1vcnkwKCkgewogIGlmIChjYWNoZWRVaW50OEFycmF5TWVtb3J5MCA9PT0gbnVsbCB8fCBjYWNoZWRVaW50OEFycmF5TWVtb3J5MC5ieXRlTGVuZ3RoID09PSAwKSB7CiAgICBjYWNoZWRVaW50OEFycmF5TWVtb3J5MCA9IG5ldyBVaW50OEFycmF5KHdhc20ubWVtb3J5LmJ1ZmZlcik7CiAgfQogIHJldHVybiBjYWNoZWRVaW50OEFycmF5TWVtb3J5MDsKfQpmdW5jdGlvbiBnZXRTdHJpbmdGcm9tV2FzbTAocHRyLCBsZW4pIHsKICBwdHIgPSBwdHIgPj4+IDA7CiAgcmV0dXJuIGNhY2hlZFRleHREZWNvZGVyLmRlY29kZShnZXRVaW50OEFycmF5TWVtb3J5MCgpLnN1YmFycmF5KHB0ciwgcHRyICsgbGVuKSk7Cn0KbGV0IFdBU01fVkVDVE9SX0xFTiA9IDA7CmZ1bmN0aW9uIHBhc3NBcnJheThUb1dhc20wKGFyZywgbWFsbG9jKSB7CiAgY29uc3QgcHRyID0gbWFsbG9jKGFyZy5sZW5ndGggKiAxLCAxKSA+Pj4gMDsKICBnZXRVaW50OEFycmF5TWVtb3J5MCgpLnNldChhcmcsIHB0ciAvIDEpOwogIFdBU01fVkVDVE9SX0xFTiA9IGFyZy5sZW5ndGg7CiAgcmV0dXJuIHB0cjsKfQpmdW5jdGlvbiBxY21zX2NvbnZlcnRfYXJyYXkodHJhbnNmb3JtZXIsIHNyYykgewogIGNvbnN0IHB0cjAgPSBwYXNzQXJyYXk4VG9XYXNtMChzcmMsIHdhc20uX193YmluZGdlbl9tYWxsb2MpOwogIGNvbnN0IGxlbjAgPSBXQVNNX1ZFQ1RPUl9MRU47CiAgd2FzbS5xY21zX2NvbnZlcnRfYXJyYXkodHJhbnNmb3JtZXIsIHB0cjAsIGxlbjApOwp9CmZ1bmN0aW9uIHFjbXNfY29udmVydF9vbmUodHJhbnNmb3JtZXIsIHNyYywgY3NzKSB7CiAgd2FzbS5xY21zX2NvbnZlcnRfb25lKHRyYW5zZm9ybWVyLCBzcmMsIGNzcyk7Cn0KZnVuY3Rpb24gcWNtc19jb252ZXJ0X3RocmVlKHRyYW5zZm9ybWVyLCBzcmMxLCBzcmMyLCBzcmMzLCBjc3MpIHsKICB3YXNtLnFjbXNfY29udmVydF90aHJlZSh0cmFuc2Zvcm1lciwgc3JjMSwgc3JjMiwgc3JjMywgY3NzKTsKfQpmdW5jdGlvbiBxY21zX2NvbnZlcnRfZm91cih0cmFuc2Zvcm1lciwgc3JjMSwgc3JjMiwgc3JjMywgc3JjNCwgY3NzKSB7CiAgd2FzbS5xY21zX2NvbnZlcnRfZm91cih0cmFuc2Zvcm1lciwgc3JjMSwgc3JjMiwgc3JjMywgc3JjNCwgY3NzKTsKfQpmdW5jdGlvbiBxY21zX3RyYW5zZm9ybWVyX2Zyb21fbWVtb3J5KG1lbSwgaW5fdHlwZSwgaW50ZW50KSB7CiAgY29uc3QgcHRyMCA9IHBhc3NBcnJheThUb1dhc20wKG1lbSwgd2FzbS5fX3diaW5kZ2VuX21hbGxvYyk7CiAgY29uc3QgbGVuMCA9IFdBU01fVkVDVE9SX0xFTjsKICBjb25zdCByZXQgPSB3YXNtLnFjbXNfdHJhbnNmb3JtZXJfZnJvbV9tZW1vcnkocHRyMCwgbGVuMCwgaW5fdHlwZSwgaW50ZW50KTsKICByZXR1cm4gcmV0ID4+PiAwOwp9CmZ1bmN0aW9uIHFjbXNfZHJvcF90cmFuc2Zvcm1lcih0cmFuc2Zvcm1lcikgewogIHdhc20ucWNtc19kcm9wX3RyYW5zZm9ybWVyKHRyYW5zZm9ybWVyKTsKfQpjb25zdCBEYXRhVHlwZSA9IE9iamVjdC5mcmVlemUoewogIFJHQjg6IDAsCiAgIjAiOiAiUkdCOCIsCiAgUkdCQTg6IDEsCiAgIjEiOiAiUkdCQTgiLAogIEJHUkE4OiAyLAogICIyIjogIkJHUkE4IiwKICBHcmF5ODogMywKICAiMyI6ICJHcmF5OCIsCiAgR3JheUE4OiA0LAogICI0IjogIkdyYXlBOCIsCiAgQ01ZSzogNSwKICAiNSI6ICJDTVlLIgp9KTsKY29uc3QgSW50ZW50ID0gT2JqZWN0LmZyZWV6ZSh7CiAgUGVyY2VwdHVhbDogMCwKICAiMCI6ICJQZXJjZXB0dWFsIiwKICBSZWxhdGl2ZUNvbG9yaW1ldHJpYzogMSwKICAiMSI6ICJSZWxhdGl2ZUNvbG9yaW1ldHJpYyIsCiAgU2F0dXJhdGlvbjogMiwKICAiMiI6ICJTYXR1cmF0aW9uIiwKICBBYnNvbHV0ZUNvbG9yaW1ldHJpYzogMywKICAiMyI6ICJBYnNvbHV0ZUNvbG9yaW1ldHJpYyIKfSk7CmFzeW5jIGZ1bmN0aW9uIF9fd2JnX2xvYWQobW9kdWxlLCBpbXBvcnRzKSB7CiAgaWYgKHR5cGVvZiBSZXNwb25zZSA9PT0gJ2Z1bmN0aW9uJyAmJiBtb2R1bGUgaW5zdGFuY2VvZiBSZXNwb25zZSkgewogICAgaWYgKHR5cGVvZiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyhtb2R1bGUsIGltcG9ydHMpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKG1vZHVsZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykgIT0gJ2FwcGxpY2F0aW9uL3dhc20nKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oImBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZ2AgZmFpbGVkIGJlY2F1c2UgeW91ciBzZXJ2ZXIgZG9lcyBub3Qgc2VydmUgV2FzbSB3aXRoIGBhcHBsaWNhdGlvbi93YXNtYCBNSU1FIHR5cGUuIEZhbGxpbmcgYmFjayB0byBgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVgIHdoaWNoIGlzIHNsb3dlci4gT3JpZ2luYWwgZXJyb3I6XG4iLCBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGJ5dGVzID0gYXdhaXQgbW9kdWxlLmFycmF5QnVmZmVyKCk7CiAgICByZXR1cm4gYXdhaXQgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoYnl0ZXMsIGltcG9ydHMpOwogIH0gZWxzZSB7CiAgICBjb25zdCBpbnN0YW5jZSA9IGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKG1vZHVsZSwgaW1wb3J0cyk7CiAgICBpZiAoaW5zdGFuY2UgaW5zdGFuY2VvZiBXZWJBc3NlbWJseS5JbnN0YW5jZSkgewogICAgICByZXR1cm4gewogICAgICAgIGluc3RhbmNlLAogICAgICAgIG1vZHVsZQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGluc3RhbmNlOwogICAgfQogIH0KfQpmdW5jdGlvbiBfX3diZ19nZXRfaW1wb3J0cygpIHsKICBjb25zdCBpbXBvcnRzID0ge307CiAgaW1wb3J0cy53YmcgPSB7fTsKICBpbXBvcnRzLndiZy5fX3diZ19jb3B5cmVzdWx0X2IwOGVlN2QyNzNmMjk1ZGQgPSBmdW5jdGlvbiAoYXJnMCwgYXJnMSkgewogICAgY29weV9yZXN1bHQoYXJnMCA+Pj4gMCwgYXJnMSA+Pj4gMCk7CiAgfTsKICBpbXBvcnRzLndiZy5fX3diZ19jb3B5cmdiX2Q2MGNlMTdiYjA1ZDliNjcgPSBmdW5jdGlvbiAoYXJnMCkgewogICAgY29weV9yZ2IoYXJnMCA+Pj4gMCk7CiAgfTsKICBpbXBvcnRzLndiZy5fX3diZ19tYWtlY3NzUkdCXzg5M2JmMGNkOWZkYjMwMmQgPSBmdW5jdGlvbiAoYXJnMCkgewogICAgbWFrZV9jc3NSR0IoYXJnMCA+Pj4gMCk7CiAgfTsKICBpbXBvcnRzLndiZy5fX3diaW5kZ2VuX2luaXRfZXh0ZXJucmVmX3RhYmxlID0gZnVuY3Rpb24gKCkgewogICAgY29uc3QgdGFibGUgPSB3YXNtLl9fd2JpbmRnZW5fZXhwb3J0XzA7CiAgICBjb25zdCBvZmZzZXQgPSB0YWJsZS5ncm93KDQpOwogICAgdGFibGUuc2V0KDAsIHVuZGVmaW5lZCk7CiAgICB0YWJsZS5zZXQob2Zmc2V0ICsgMCwgdW5kZWZpbmVkKTsKICAgIHRhYmxlLnNldChvZmZzZXQgKyAxLCBudWxsKTsKICAgIHRhYmxlLnNldChvZmZzZXQgKyAyLCB0cnVlKTsKICAgIHRhYmxlLnNldChvZmZzZXQgKyAzLCBmYWxzZSk7CiAgfTsKICBpbXBvcnRzLndiZy5fX3diaW5kZ2VuX3Rocm93ID0gZnVuY3Rpb24gKGFyZzAsIGFyZzEpIHsKICAgIHRocm93IG5ldyBFcnJvcihnZXRTdHJpbmdGcm9tV2FzbTAoYXJnMCwgYXJnMSkpOwogIH07CiAgcmV0dXJuIGltcG9ydHM7Cn0KZnVuY3Rpb24gX193YmdfaW5pdF9tZW1vcnkoaW1wb3J0cywgbWVtb3J5KSB7fQpmdW5jdGlvbiBfX3diZ19maW5hbGl6ZV9pbml0KGluc3RhbmNlLCBtb2R1bGUpIHsKICB3YXNtID0gaW5zdGFuY2UuZXhwb3J0czsKICBfX3diZ19pbml0Ll9fd2JpbmRnZW5fd2FzbV9tb2R1bGUgPSBtb2R1bGU7CiAgY2FjaGVkVWludDhBcnJheU1lbW9yeTAgPSBudWxsOwogIHdhc20uX193YmluZGdlbl9zdGFydCgpOwogIHJldHVybiB3YXNtOwp9CmZ1bmN0aW9uIGluaXRTeW5jKG1vZHVsZSkgewogIGlmICh3YXNtICE9PSB1bmRlZmluZWQpIHJldHVybiB3YXNtOwogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZihtb2R1bGUpID09PSBPYmplY3QucHJvdG90eXBlKSB7CiAgICAgICh7CiAgICAgICAgbW9kdWxlCiAgICAgIH0gPSBtb2R1bGUpOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS53YXJuKCd1c2luZyBkZXByZWNhdGVkIHBhcmFtZXRlcnMgZm9yIGBpbml0U3luYygpYDsgcGFzcyBhIHNpbmdsZSBvYmplY3QgaW5zdGVhZCcpOwogICAgfQogIH0KICBjb25zdCBpbXBvcnRzID0gX193YmdfZ2V0X2ltcG9ydHMoKTsKICBfX3diZ19pbml0X21lbW9yeShpbXBvcnRzKTsKICBpZiAoIShtb2R1bGUgaW5zdGFuY2VvZiBXZWJBc3NlbWJseS5Nb2R1bGUpKSB7CiAgICBtb2R1bGUgPSBuZXcgV2ViQXNzZW1ibHkuTW9kdWxlKG1vZHVsZSk7CiAgfQogIGNvbnN0IGluc3RhbmNlID0gbmV3IFdlYkFzc2VtYmx5Lkluc3RhbmNlKG1vZHVsZSwgaW1wb3J0cyk7CiAgcmV0dXJuIF9fd2JnX2ZpbmFsaXplX2luaXQoaW5zdGFuY2UsIG1vZHVsZSk7Cn0KYXN5bmMgZnVuY3Rpb24gX193YmdfaW5pdChtb2R1bGVfb3JfcGF0aCkgewogIGlmICh3YXNtICE9PSB1bmRlZmluZWQpIHJldHVybiB3YXNtOwogIGlmICh0eXBlb2YgbW9kdWxlX29yX3BhdGggIT09ICd1bmRlZmluZWQnKSB7CiAgICBpZiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKG1vZHVsZV9vcl9wYXRoKSA9PT0gT2JqZWN0LnByb3RvdHlwZSkgewogICAgICAoewogICAgICAgIG1vZHVsZV9vcl9wYXRoCiAgICAgIH0gPSBtb2R1bGVfb3JfcGF0aCk7CiAgICB9IGVsc2UgewogICAgICBjb25zb2xlLndhcm4oJ3VzaW5nIGRlcHJlY2F0ZWQgcGFyYW1ldGVycyBmb3IgdGhlIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uOyBwYXNzIGEgc2luZ2xlIG9iamVjdCBpbnN0ZWFkJyk7CiAgICB9CiAgfQogIGNvbnN0IGltcG9ydHMgPSBfX3diZ19nZXRfaW1wb3J0cygpOwogIGlmICh0eXBlb2YgbW9kdWxlX29yX3BhdGggPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBSZXF1ZXN0ID09PSAnZnVuY3Rpb24nICYmIG1vZHVsZV9vcl9wYXRoIGluc3RhbmNlb2YgUmVxdWVzdCB8fCB0eXBlb2YgVVJMID09PSAnZnVuY3Rpb24nICYmIG1vZHVsZV9vcl9wYXRoIGluc3RhbmNlb2YgVVJMKSB7CiAgICBtb2R1bGVfb3JfcGF0aCA9IGZldGNoKG1vZHVsZV9vcl9wYXRoKTsKICB9CiAgX193YmdfaW5pdF9tZW1vcnkoaW1wb3J0cyk7CiAgY29uc3QgewogICAgaW5zdGFuY2UsCiAgICBtb2R1bGUKICB9ID0gYXdhaXQgX193YmdfbG9hZChhd2FpdCBtb2R1bGVfb3JfcGF0aCwgaW1wb3J0cyk7CiAgcmV0dXJuIF9fd2JnX2ZpbmFsaXplX2luaXQoaW5zdGFuY2UsIG1vZHVsZSk7Cn0KCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gY29uc3QgcWNtcyA9ICgoLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqLyBudWxsICYmIChfX3diZ19pbml0KSkpOwo7Ly8gLi9zcmMvY29yZS9jb2xvcnNwYWNlLmpzCgoKZnVuY3Rpb24gcmVzaXplUmdiSW1hZ2Uoc3JjLCBkZXN0LCB3MSwgaDEsIHcyLCBoMiwgYWxwaGEwMSkgewogIGNvbnN0IENPTVBPTkVOVFMgPSAzOwogIGFscGhhMDEgPSBhbHBoYTAxICE9PSAxID8gMCA6IGFscGhhMDE7CiAgY29uc3QgeFJhdGlvID0gdzEgLyB3MjsKICBjb25zdCB5UmF0aW8gPSBoMSAvIGgyOwogIGxldCBuZXdJbmRleCA9IDAsCiAgICBvbGRJbmRleDsKICBjb25zdCB4U2NhbGVkID0gbmV3IFVpbnQxNkFycmF5KHcyKTsKICBjb25zdCB3MVNjYW5saW5lID0gdzEgKiBDT01QT05FTlRTOwogIGZvciAobGV0IGkgPSAwOyBpIDwgdzI7IGkrKykgewogICAgeFNjYWxlZFtpXSA9IE1hdGguZmxvb3IoaSAqIHhSYXRpbykgKiBDT01QT05FTlRTOwogIH0KICBmb3IgKGxldCBpID0gMDsgaSA8IGgyOyBpKyspIHsKICAgIGNvbnN0IHB5ID0gTWF0aC5mbG9vcihpICogeVJhdGlvKSAqIHcxU2NhbmxpbmU7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHcyOyBqKyspIHsKICAgICAgb2xkSW5kZXggPSBweSArIHhTY2FsZWRbal07CiAgICAgIGRlc3RbbmV3SW5kZXgrK10gPSBzcmNbb2xkSW5kZXgrK107CiAgICAgIGRlc3RbbmV3SW5kZXgrK10gPSBzcmNbb2xkSW5kZXgrK107CiAgICAgIGRlc3RbbmV3SW5kZXgrK10gPSBzcmNbb2xkSW5kZXgrK107CiAgICAgIG5ld0luZGV4ICs9IGFscGhhMDE7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIHJlc2l6ZVJnYmFJbWFnZShzcmMsIGRlc3QsIHcxLCBoMSwgdzIsIGgyLCBhbHBoYTAxKSB7CiAgY29uc3QgeFJhdGlvID0gdzEgLyB3MjsKICBjb25zdCB5UmF0aW8gPSBoMSAvIGgyOwogIGxldCBuZXdJbmRleCA9IDA7CiAgY29uc3QgeFNjYWxlZCA9IG5ldyBVaW50MTZBcnJheSh3Mik7CiAgaWYgKGFscGhhMDEgPT09IDEpIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdzI7IGkrKykgewogICAgICB4U2NhbGVkW2ldID0gTWF0aC5mbG9vcihpICogeFJhdGlvKTsKICAgIH0KICAgIGNvbnN0IHNyYzMyID0gbmV3IFVpbnQzMkFycmF5KHNyYy5idWZmZXIpOwogICAgY29uc3QgZGVzdDMyID0gbmV3IFVpbnQzMkFycmF5KGRlc3QuYnVmZmVyKTsKICAgIGNvbnN0IHJnYk1hc2sgPSBGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4MDBmZmZmZmYgOiAweGZmZmZmZjAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoMjsgaSsrKSB7CiAgICAgIGNvbnN0IGJ1ZiA9IHNyYzMyLnN1YmFycmF5KE1hdGguZmxvb3IoaSAqIHlSYXRpbykgKiB3MSk7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdzI7IGorKykgewogICAgICAgIGRlc3QzMltuZXdJbmRleCsrXSB8PSBidWZbeFNjYWxlZFtqXV0gJiByZ2JNYXNrOwogICAgICB9CiAgICB9CiAgfSBlbHNlIHsKICAgIGNvbnN0IENPTVBPTkVOVFMgPSA0OwogICAgY29uc3QgdzFTY2FubGluZSA9IHcxICogQ09NUE9ORU5UUzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdzI7IGkrKykgewogICAgICB4U2NhbGVkW2ldID0gTWF0aC5mbG9vcihpICogeFJhdGlvKSAqIENPTVBPTkVOVFM7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGgyOyBpKyspIHsKICAgICAgY29uc3QgYnVmID0gc3JjLnN1YmFycmF5KE1hdGguZmxvb3IoaSAqIHlSYXRpbykgKiB3MVNjYW5saW5lKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgICAgY29uc3Qgb2xkSW5kZXggPSB4U2NhbGVkW2pdOwogICAgICAgIGRlc3RbbmV3SW5kZXgrK10gPSBidWZbb2xkSW5kZXhdOwogICAgICAgIGRlc3RbbmV3SW5kZXgrK10gPSBidWZbb2xkSW5kZXggKyAxXTsKICAgICAgICBkZXN0W25ld0luZGV4KytdID0gYnVmW29sZEluZGV4ICsgMl07CiAgICAgIH0KICAgIH0KICB9Cn0KZnVuY3Rpb24gY29weVJnYmFJbWFnZShzcmMsIGRlc3QsIGFscGhhMDEpIHsKICBpZiAoYWxwaGEwMSA9PT0gMSkgewogICAgY29uc3Qgc3JjMzIgPSBuZXcgVWludDMyQXJyYXkoc3JjLmJ1ZmZlcik7CiAgICBjb25zdCBkZXN0MzIgPSBuZXcgVWludDMyQXJyYXkoZGVzdC5idWZmZXIpOwogICAgY29uc3QgcmdiTWFzayA9IEZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuID8gMHgwMGZmZmZmZiA6IDB4ZmZmZmZmMDA7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMzMi5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGRlc3QzMltpXSB8PSBzcmMzMltpXSAmIHJnYk1hc2s7CiAgICB9CiAgfSBlbHNlIHsKICAgIGxldCBqID0gMDsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHNyYy5sZW5ndGg7IGkgPCBpaTsgaSArPSA0KSB7CiAgICAgIGRlc3RbaisrXSA9IHNyY1tpXTsKICAgICAgZGVzdFtqKytdID0gc3JjW2kgKyAxXTsKICAgICAgZGVzdFtqKytdID0gc3JjW2kgKyAyXTsKICAgIH0KICB9Cn0KY2xhc3MgQ29sb3JTcGFjZSB7CiAgc3RhdGljICNyZ2JCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyk7CiAgY29uc3RydWN0b3IobmFtZSwgbnVtQ29tcHMpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLm51bUNvbXBzID0gbnVtQ29tcHM7CiAgfQogIGdldFJnYihzcmMsIHNyY09mZnNldCwgb3V0cHV0ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpKSB7CiAgICB0aGlzLmdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIG91dHB1dCwgMCk7CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBnZXRSZ2JIZXgoc3JjLCBzcmNPZmZzZXQpIHsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZ2V0UmdiKHNyYywgc3JjT2Zmc2V0LCBDb2xvclNwYWNlLiNyZ2JCdWYpOwogICAgcmV0dXJuIFV0aWwubWFrZUhleENvbG9yKGJ1ZmZlclswXSwgYnVmZmVyWzFdLCBidWZmZXJbMl0pOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB1bnJlYWNoYWJsZSgiU2hvdWxkIG5vdCBjYWxsIENvbG9yU3BhY2UuZ2V0UmdiSXRlbSIpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICB1bnJlYWNoYWJsZSgiU2hvdWxkIG5vdCBjYWxsIENvbG9yU3BhY2UuZ2V0UmdiQnVmZmVyIik7CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBDb2xvclNwYWNlLmdldE91dHB1dExlbmd0aCIpOwogIH0KICBpc1Bhc3N0aHJvdWdoKGJpdHMpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgYnBjKSB7CiAgICByZXR1cm4gQ29sb3JTcGFjZS5pc0RlZmF1bHREZWNvZGUoZGVjb2RlTWFwLCB0aGlzLm51bUNvbXBzKTsKICB9CiAgZmlsbFJnYihkZXN0LCBvcmlnaW5hbFdpZHRoLCBvcmlnaW5hbEhlaWdodCwgd2lkdGgsIGhlaWdodCwgYWN0dWFsSGVpZ2h0LCBicGMsIGNvbXBzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBjb3VudCA9IG9yaWdpbmFsV2lkdGggKiBvcmlnaW5hbEhlaWdodDsKICAgIGxldCByZ2JCdWYgPSBudWxsOwogICAgY29uc3QgbnVtQ29tcG9uZW50Q29sb3JzID0gMSA8PCBicGM7CiAgICBjb25zdCBuZWVkc1Jlc2l6aW5nID0gb3JpZ2luYWxIZWlnaHQgIT09IGhlaWdodCB8fCBvcmlnaW5hbFdpZHRoICE9PSB3aWR0aDsKICAgIGlmICh0aGlzLmlzUGFzc3Rocm91Z2goYnBjKSkgewogICAgICByZ2JCdWYgPSBjb21wczsKICAgIH0gZWxzZSBpZiAodGhpcy5udW1Db21wcyA9PT0gMSAmJiBjb3VudCA+IG51bUNvbXBvbmVudENvbG9ycyAmJiB0aGlzLm5hbWUgIT09ICJEZXZpY2VHcmF5IiAmJiB0aGlzLm5hbWUgIT09ICJEZXZpY2VSR0IiKSB7CiAgICAgIGNvbnN0IGFsbENvbG9ycyA9IGJwYyA8PSA4ID8gbmV3IFVpbnQ4QXJyYXkobnVtQ29tcG9uZW50Q29sb3JzKSA6IG5ldyBVaW50MTZBcnJheShudW1Db21wb25lbnRDb2xvcnMpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvbXBvbmVudENvbG9yczsgaSsrKSB7CiAgICAgICAgYWxsQ29sb3JzW2ldID0gaTsKICAgICAgfQogICAgICBjb25zdCBjb2xvck1hcCA9IG5ldyBVaW50OENsYW1wZWRBcnJheShudW1Db21wb25lbnRDb2xvcnMgKiAzKTsKICAgICAgdGhpcy5nZXRSZ2JCdWZmZXIoYWxsQ29sb3JzLCAwLCBudW1Db21wb25lbnRDb2xvcnMsIGNvbG9yTWFwLCAwLCBicGMsIDApOwogICAgICBpZiAoIW5lZWRzUmVzaXppbmcpIHsKICAgICAgICBsZXQgZGVzdFBvcyA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgICAgICBjb25zdCBrZXkgPSBjb21wc1tpXSAqIDM7CiAgICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSBjb2xvck1hcFtrZXldOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5ICsgMV07CiAgICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSBjb2xvck1hcFtrZXkgKyAyXTsKICAgICAgICAgIGRlc3RQb3MgKz0gYWxwaGEwMTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmdiQnVmID0gbmV3IFVpbnQ4QXJyYXkoY291bnQgKiAzKTsKICAgICAgICBsZXQgcmdiUG9zID0gMDsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgICAgIGNvbnN0IGtleSA9IGNvbXBzW2ldICogMzsKICAgICAgICAgIHJnYkJ1ZltyZ2JQb3MrK10gPSBjb2xvck1hcFtrZXldOwogICAgICAgICAgcmdiQnVmW3JnYlBvcysrXSA9IGNvbG9yTWFwW2tleSArIDFdOwogICAgICAgICAgcmdiQnVmW3JnYlBvcysrXSA9IGNvbG9yTWFwW2tleSArIDJdOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICghbmVlZHNSZXNpemluZykgewogICAgICB0aGlzLmdldFJnYkJ1ZmZlcihjb21wcywgMCwgd2lkdGggKiBhY3R1YWxIZWlnaHQsIGRlc3QsIDAsIGJwYywgYWxwaGEwMSk7CiAgICB9IGVsc2UgewogICAgICByZ2JCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoY291bnQgKiAzKTsKICAgICAgdGhpcy5nZXRSZ2JCdWZmZXIoY29tcHMsIDAsIGNvdW50LCByZ2JCdWYsIDAsIGJwYywgMCk7CiAgICB9CiAgICBpZiAocmdiQnVmKSB7CiAgICAgIGlmIChuZWVkc1Jlc2l6aW5nKSB7CiAgICAgICAgcmVzaXplUmdiSW1hZ2UocmdiQnVmLCBkZXN0LCBvcmlnaW5hbFdpZHRoLCBvcmlnaW5hbEhlaWdodCwgd2lkdGgsIGhlaWdodCwgYWxwaGEwMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IGRlc3RQb3MgPSAwLAogICAgICAgICAgcmdiUG9zID0gMDsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB3aWR0aCAqIGFjdHVhbEhlaWdodDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHJnYkJ1ZltyZ2JQb3MrK107CiAgICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSByZ2JCdWZbcmdiUG9zKytdOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gcmdiQnVmW3JnYlBvcysrXTsKICAgICAgICAgIGRlc3RQb3MgKz0gYWxwaGEwMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0IHVzZXNaZXJvVG9PbmVSYW5nZSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInVzZXNaZXJvVG9PbmVSYW5nZSIsIHRydWUpOwogIH0KICBzdGF0aWMgaXNEZWZhdWx0RGVjb2RlKGRlY29kZSwgbnVtQ29tcHMpIHsKICAgIGlmICghQXJyYXkuaXNBcnJheShkZWNvZGUpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKG51bUNvbXBzICogMiAhPT0gZGVjb2RlLmxlbmd0aCkgewogICAgICB3YXJuKCJUaGUgZGVjb2RlIG1hcCBpcyBub3QgdGhlIGNvcnJlY3QgbGVuZ3RoIik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGVjb2RlLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgaWYgKGRlY29kZVtpXSAhPT0gMCB8fCBkZWNvZGVbaSArIDFdICE9PSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgQWx0ZXJuYXRlQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcihudW1Db21wcywgYmFzZSwgdGludEZuKSB7CiAgICBzdXBlcigiQWx0ZXJuYXRlIiwgbnVtQ29tcHMpOwogICAgdGhpcy5iYXNlID0gYmFzZTsKICAgIHRoaXMudGludEZuID0gdGludEZuOwogICAgdGhpcy50bXBCdWYgPSBuZXcgRmxvYXQzMkFycmF5KGJhc2UubnVtQ29tcHMpOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBjb25zdCB0bXBCdWYgPSB0aGlzLnRtcEJ1ZjsKICAgIHRoaXMudGludEZuKHNyYywgc3JjT2Zmc2V0LCB0bXBCdWYsIDApOwogICAgdGhpcy5iYXNlLmdldFJnYkl0ZW0odG1wQnVmLCAwLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3QgdGludEZuID0gdGhpcy50aW50Rm47CiAgICBjb25zdCBiYXNlID0gdGhpcy5iYXNlOwogICAgY29uc3Qgc2NhbGUgPSAxIC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBjb25zdCBiYXNlTnVtQ29tcHMgPSBiYXNlLm51bUNvbXBzOwogICAgY29uc3QgdXNlc1plcm9Ub09uZVJhbmdlID0gYmFzZS51c2VzWmVyb1RvT25lUmFuZ2U7CiAgICBjb25zdCBpc1Bhc3N0aHJvdWdoID0gKGJhc2UuaXNQYXNzdGhyb3VnaCg4KSB8fCAhdXNlc1plcm9Ub09uZVJhbmdlKSAmJiBhbHBoYTAxID09PSAwOwogICAgbGV0IHBvcyA9IGlzUGFzc3Rocm91Z2ggPyBkZXN0T2Zmc2V0IDogMDsKICAgIGNvbnN0IGJhc2VCdWYgPSBpc1Bhc3N0aHJvdWdoID8gZGVzdCA6IG5ldyBVaW50OENsYW1wZWRBcnJheShiYXNlTnVtQ29tcHMgKiBjb3VudCk7CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBzY2FsZWQgPSBuZXcgRmxvYXQzMkFycmF5KG51bUNvbXBzKTsKICAgIGNvbnN0IHRpbnRlZCA9IG5ldyBGbG9hdDMyQXJyYXkoYmFzZU51bUNvbXBzKTsKICAgIGxldCBpLCBqOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgZm9yIChqID0gMDsgaiA8IG51bUNvbXBzOyBqKyspIHsKICAgICAgICBzY2FsZWRbal0gPSBzcmNbc3JjT2Zmc2V0KytdICogc2NhbGU7CiAgICAgIH0KICAgICAgdGludEZuKHNjYWxlZCwgMCwgdGludGVkLCAwKTsKICAgICAgaWYgKHVzZXNaZXJvVG9PbmVSYW5nZSkgewogICAgICAgIGZvciAoaiA9IDA7IGogPCBiYXNlTnVtQ29tcHM7IGorKykgewogICAgICAgICAgYmFzZUJ1Zltwb3MrK10gPSB0aW50ZWRbal0gKiAyNTU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGJhc2UuZ2V0UmdiSXRlbSh0aW50ZWQsIDAsIGJhc2VCdWYsIHBvcyk7CiAgICAgICAgcG9zICs9IGJhc2VOdW1Db21wczsKICAgICAgfQogICAgfQogICAgaWYgKCFpc1Bhc3N0aHJvdWdoKSB7CiAgICAgIGJhc2UuZ2V0UmdiQnVmZmVyKGJhc2VCdWYsIDAsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCA4LCBhbHBoYTAxKTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlLmdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCAqIHRoaXMuYmFzZS5udW1Db21wcyAvIHRoaXMubnVtQ29tcHMsIGFscGhhMDEpOwogIH0KfQpjbGFzcyBQYXR0ZXJuQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcihiYXNlQ1MpIHsKICAgIHN1cGVyKCJQYXR0ZXJuIiwgbnVsbCk7CiAgICB0aGlzLmJhc2UgPSBiYXNlQ1M7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBQYXR0ZXJuQ1MuaXNEZWZhdWx0RGVjb2RlIik7CiAgfQp9CmNsYXNzIEluZGV4ZWRDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKGJhc2UsIGhpZ2hWYWwsIGxvb2t1cCkgewogICAgc3VwZXIoIkluZGV4ZWQiLCAxKTsKICAgIHRoaXMuYmFzZSA9IGJhc2U7CiAgICB0aGlzLmhpZ2hWYWwgPSBoaWdoVmFsOwogICAgY29uc3QgbGVuZ3RoID0gYmFzZS5udW1Db21wcyAqIChoaWdoVmFsICsgMSk7CiAgICB0aGlzLmxvb2t1cCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICBpZiAobG9va3VwIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICBjb25zdCBieXRlcyA9IGxvb2t1cC5nZXRCeXRlcyhsZW5ndGgpOwogICAgICB0aGlzLmxvb2t1cC5zZXQoYnl0ZXMpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgbG9va3VwID09PSAic3RyaW5nIikgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgdGhpcy5sb29rdXBbaV0gPSBsb29rdXAuY2hhckNvZGVBdChpKSAmIDB4ZmY7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW5kZXhlZENTIC0gdW5yZWNvZ25pemVkIGxvb2t1cCB0YWJsZTogJHtsb29rdXB9YCk7CiAgICB9CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGNvbnN0IHsKICAgICAgYmFzZSwKICAgICAgaGlnaFZhbCwKICAgICAgbG9va3VwCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHN0YXJ0ID0gTWF0aENsYW1wKE1hdGgucm91bmQoc3JjW3NyY09mZnNldF0pLCAwLCBoaWdoVmFsKSAqIGJhc2UubnVtQ29tcHM7CiAgICBiYXNlLmdldFJnYkJ1ZmZlcihsb29rdXAsIHN0YXJ0LCAxLCBkZXN0LCBkZXN0T2Zmc2V0LCA4LCAwKTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3QgewogICAgICBiYXNlLAogICAgICBoaWdoVmFsLAogICAgICBsb29rdXAKICAgIH0gPSB0aGlzOwogICAgY29uc3QgewogICAgICBudW1Db21wcwogICAgfSA9IGJhc2U7CiAgICBjb25zdCBvdXRwdXREZWx0YSA9IGJhc2UuZ2V0T3V0cHV0TGVuZ3RoKG51bUNvbXBzLCBhbHBoYTAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICBjb25zdCBsb29rdXBQb3MgPSBNYXRoQ2xhbXAoTWF0aC5yb3VuZChzcmNbc3JjT2Zmc2V0KytdKSwgMCwgaGlnaFZhbCkgKiBudW1Db21wczsKICAgICAgYmFzZS5nZXRSZ2JCdWZmZXIobG9va3VwLCBsb29rdXBQb3MsIDEsIGRlc3QsIGRlc3RPZmZzZXQsIDgsIGFscGhhMDEpOwogICAgICBkZXN0T2Zmc2V0ICs9IG91dHB1dERlbHRhOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiB0aGlzLmJhc2UuZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoICogdGhpcy5iYXNlLm51bUNvbXBzLCBhbHBoYTAxKTsKICB9CiAgaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgYnBjKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGVjb2RlTWFwKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChkZWNvZGVNYXAubGVuZ3RoICE9PSAyKSB7CiAgICAgIHdhcm4oIkRlY29kZSBtYXAgbGVuZ3RoIGlzIG5vdCBjb3JyZWN0Iik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGJwYykgfHwgYnBjIDwgMSkgewogICAgICB3YXJuKCJCaXRzIHBlciBjb21wb25lbnQgaXMgbm90IGNvcnJlY3QiKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZGVjb2RlTWFwWzBdID09PSAwICYmIGRlY29kZU1hcFsxXSA9PT0gKDEgPDwgYnBjKSAtIDE7CiAgfQp9CmNsYXNzIERldmljZUdyYXlDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoIkRldmljZUdyYXkiLCAxKTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgY29uc3QgYyA9IHNyY1tzcmNPZmZzZXRdICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0XSA9IGRlc3RbZGVzdE9mZnNldCArIDFdID0gZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSBjOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBzY2FsZSA9IDI1NSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgbGV0IGogPSBzcmNPZmZzZXQsCiAgICAgIHEgPSBkZXN0T2Zmc2V0OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgIGNvbnN0IGMgPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICBkZXN0W3ErK10gPSBjOwogICAgICBkZXN0W3ErK10gPSBjOwogICAgICBkZXN0W3ErK10gPSBjOwogICAgICBxICs9IGFscGhhMDE7CiAgICB9CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIGlucHV0TGVuZ3RoICogKDMgKyBhbHBoYTAxKTsKICB9Cn0KY2xhc3MgRGV2aWNlUmdiQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCJEZXZpY2VSR0IiLCAzKTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgZGVzdFtkZXN0T2Zmc2V0XSA9IHNyY1tzcmNPZmZzZXRdICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSBzcmNbc3JjT2Zmc2V0ICsgMV0gKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IHNyY1tzcmNPZmZzZXQgKyAyXSAqIDI1NTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgaWYgKGJpdHMgPT09IDggJiYgYWxwaGEwMSA9PT0gMCkgewogICAgICBkZXN0LnNldChzcmMuc3ViYXJyYXkoc3JjT2Zmc2V0LCBzcmNPZmZzZXQgKyBjb3VudCAqIDMpLCBkZXN0T2Zmc2V0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc2NhbGUgPSAyNTUgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgIGxldCBqID0gc3JjT2Zmc2V0LAogICAgICBxID0gZGVzdE9mZnNldDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICBkZXN0W3ErK10gPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICBkZXN0W3ErK10gPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICBkZXN0W3ErK10gPSBzY2FsZSAqIHNyY1tqKytdOwogICAgICBxICs9IGFscGhhMDE7CiAgICB9CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIGlucHV0TGVuZ3RoICogKDMgKyBhbHBoYTAxKSAvIDMgfCAwOwogIH0KICBpc1Bhc3N0aHJvdWdoKGJpdHMpIHsKICAgIHJldHVybiBiaXRzID09PSA4OwogIH0KfQpjbGFzcyBEZXZpY2VSZ2JhQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCJEZXZpY2VSR0JBIiwgNCk7CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgX2FscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqIDQ7CiAgfQogIGlzUGFzc3Rocm91Z2goYml0cykgewogICAgcmV0dXJuIGJpdHMgPT09IDg7CiAgfQogIGZpbGxSZ2IoZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFjdHVhbEhlaWdodCwgYnBjLCBjb21wcywgYWxwaGEwMSkgewogICAgaWYgKG9yaWdpbmFsSGVpZ2h0ICE9PSBoZWlnaHQgfHwgb3JpZ2luYWxXaWR0aCAhPT0gd2lkdGgpIHsKICAgICAgcmVzaXplUmdiYUltYWdlKGNvbXBzLCBkZXN0LCBvcmlnaW5hbFdpZHRoLCBvcmlnaW5hbEhlaWdodCwgd2lkdGgsIGhlaWdodCwgYWxwaGEwMSk7CiAgICB9IGVsc2UgewogICAgICBjb3B5UmdiYUltYWdlKGNvbXBzLCBkZXN0LCBhbHBoYTAxKTsKICAgIH0KICB9Cn0KY2xhc3MgRGV2aWNlQ215a0NTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigiRGV2aWNlQ01ZSyIsIDQpOwogIH0KICAjdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIHNyY1NjYWxlLCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBjb25zdCBjID0gc3JjW3NyY09mZnNldF0gKiBzcmNTY2FsZTsKICAgIGNvbnN0IG0gPSBzcmNbc3JjT2Zmc2V0ICsgMV0gKiBzcmNTY2FsZTsKICAgIGNvbnN0IHkgPSBzcmNbc3JjT2Zmc2V0ICsgMl0gKiBzcmNTY2FsZTsKICAgIGNvbnN0IGsgPSBzcmNbc3JjT2Zmc2V0ICsgM10gKiBzcmNTY2FsZTsKICAgIGRlc3RbZGVzdE9mZnNldF0gPSAyNTUgKyBjICogKC00LjM4NzMzMjM4NDYwOTk4OCAqIGMgKyA1NC40ODYxNTE5NDE4OTE3NiAqIG0gKyAxOC44MjI5MDUwMjE2NTMwMiAqIHkgKyAyMTIuMjU2NjI0NTE2Mzk1ODUgKiBrICsgLTI4NS4yMzMxMDI2MTM3MDA0KSArIG0gKiAoMS43MTQ5NzYzNDc3MzYyMTM0ICogbSAtIDUuNjA5NjczNjkwNDA0NzMxNSAqIHkgKyAtMTcuODczODcwODYxNDE1NDQ0ICogayAtIDUuNDk3MDA2NDI3MTk2MzY2KSArIHkgKiAoLTIuNTIxNzM0MDEzMTY4MzAzMyAqIHkgLSAyMS4yNDg5MjMzMzczNTMwNzMgKiBrICsgMTcuNTExOTI3MDg0MTgxMykgKyBrICogKC0yMS44NjEyMjE0NzQ2MzYwNSAqIGsgLSAxODkuNDgxODA4MzU5MjI3NDcpOwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSAyNTUgKyBjICogKDguODQxMDQxNDIyMDM2MTQ5ICogYyArIDYwLjExODAyNzA0NTU5NzM2NiAqIG0gKyA2Ljg3MTQyNTU5MjA0OTAwNyAqIHkgKyAzMS4xNTkxMDAxMzAwNTU5MjIgKiBrICsgLTc5LjI5NzA4NDQ4MTY1NDgpICsgbSAqICgtMTUuMzEwMzYxMzA2OTY3ODE3ICogbSArIDE3LjU3NTI1MTI2MTEwOTQ4MiAqIHkgKyAxMzEuMzUyNTA5MTI0OTM5NzYgKiBrIC0gMTkwLjk0NTMzMDI1ODg5NTEpICsgeSAqICg0LjQ0NDMzOTEwMjg1MjczOSAqIHkgKyA5Ljg2MzI4NjE0OTM0MDUgKiBrIC0gMjQuODY3NDE1ODI1NTU4NzgpICsgayAqICgtMjAuNzM3MzI1NDcxMTgxMDM0ICogayAtIDE4Ny44MDQ1MzcwOTcxOTU3OCk7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IDI1NSArIGMgKiAoMC44ODQyNTIyNDMwMDAzMjk2ICogYyArIDguMDc4Njc3NTAzMTEyOTI4ICogbSArIDMwLjg5OTc4MzA5NzAzNzI5ICogeSAtIDAuMjM4ODMyMzg2ODkxNzg5MzQgKiBrICsgLTE0LjE4MzU3Njc5OTY3MzI4NikgKyBtICogKDEwLjQ5NTkzMjczNDMyMDcyICogbSArIDYzLjAyMzc4NDk0NzU0MDUyICogeSArIDUwLjYwNjk1NzY1NjM2MDczNCAqIGsgLSAxMTIuMjM4ODQyNTM3MTkyNDgpICsgeSAqICgwLjAzMjk2MDQxMTE0ODczMjE3ICogeSArIDExNS42MDM4NDQ0OTY0NjY0MSAqIGsgKyAtMTkzLjU4MjA5MzU2ODYxNTA1KSArIGsgKiAoLTIyLjMzODE2ODA3MzA5ODg2ICogayAtIDE4MC4xMjYxMzk3NDcwODM2Nyk7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCAxLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3Qgc2NhbGUgPSAxIC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIHNjYWxlLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgICAgc3JjT2Zmc2V0ICs9IDQ7CiAgICAgIGRlc3RPZmZzZXQgKz0gMyArIGFscGhhMDE7CiAgICB9CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIGlucHV0TGVuZ3RoIC8gNCAqICgzICsgYWxwaGEwMSkgfCAwOwogIH0KfQpjbGFzcyBDYWxHcmF5Q1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3Rvcih3aGl0ZVBvaW50LCBibGFja1BvaW50LCBnYW1tYSkgewogICAgc3VwZXIoIkNhbEdyYXkiLCAxKTsKICAgIGlmICghd2hpdGVQb2ludCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIldoaXRlUG9pbnQgbWlzc2luZyAtIHJlcXVpcmVkIGZvciBjb2xvciBzcGFjZSBDYWxHcmF5Iik7CiAgICB9CiAgICBbdGhpcy5YVywgdGhpcy5ZVywgdGhpcy5aV10gPSB3aGl0ZVBvaW50OwogICAgW3RoaXMuWEIsIHRoaXMuWUIsIHRoaXMuWkJdID0gYmxhY2tQb2ludCB8fCBbMCwgMCwgMF07CiAgICB0aGlzLkcgPSBnYW1tYSB8fCAxOwogICAgaWYgKHRoaXMuWFcgPCAwIHx8IHRoaXMuWlcgPCAwIHx8IHRoaXMuWVcgIT09IDEpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIFdoaXRlUG9pbnQgY29tcG9uZW50cyBmb3IgJHt0aGlzLm5hbWV9LCBubyBmYWxsYmFjayBhdmFpbGFibGVgKTsKICAgIH0KICAgIGlmICh0aGlzLlhCIDwgMCB8fCB0aGlzLllCIDwgMCB8fCB0aGlzLlpCIDwgMCkgewogICAgICBpbmZvKGBJbnZhbGlkIEJsYWNrUG9pbnQgZm9yICR7dGhpcy5uYW1lfSwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuYCk7CiAgICAgIHRoaXMuWEIgPSB0aGlzLllCID0gdGhpcy5aQiA9IDA7CiAgICB9CiAgICBpZiAodGhpcy5YQiAhPT0gMCB8fCB0aGlzLllCICE9PSAwIHx8IHRoaXMuWkIgIT09IDApIHsKICAgICAgd2FybihgJHt0aGlzLm5hbWV9LCBCbGFja1BvaW50OiBYQjogJHt0aGlzLlhCfSwgWUI6ICR7dGhpcy5ZQn0sIGAgKyBgWkI6ICR7dGhpcy5aQn0sIG9ubHkgZGVmYXVsdCB2YWx1ZXMgYXJlIHN1cHBvcnRlZC5gKTsKICAgIH0KICAgIGlmICh0aGlzLkcgPCAxKSB7CiAgICAgIGluZm8oYEludmFsaWQgR2FtbWE6ICR7dGhpcy5HfSBmb3IgJHt0aGlzLm5hbWV9LCBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdC5gKTsKICAgICAgdGhpcy5HID0gMTsKICAgIH0KICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0LCBzY2FsZSkgewogICAgY29uc3QgQSA9IHNyY1tzcmNPZmZzZXRdICogc2NhbGU7CiAgICBjb25zdCBBRyA9IEEgKiogdGhpcy5HOwogICAgY29uc3QgTCA9IHRoaXMuWVcgKiBBRzsKICAgIGNvbnN0IHZhbCA9IE1hdGgubWF4KDI5NS44ICogTCAqKiAwLjMzMzMzMzMzMzMzMzMzMzMgLSA0MC44LCAwKTsKICAgIGRlc3RbZGVzdE9mZnNldF0gPSB2YWw7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IHZhbDsKICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gdmFsOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgMSk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHNjYWxlID0gMSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0LCBzY2FsZSk7CiAgICAgIHNyY09mZnNldCArPSAxOwogICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSk7CiAgfQp9CmNsYXNzIENhbFJHQkNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgc3RhdGljICNCUkFERk9SRF9TQ0FMRV9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFswLjg5NTEsIDAuMjY2NCwgLTAuMTYxNCwgLTAuNzUwMiwgMS43MTM1LCAwLjAzNjcsIDAuMDM4OSwgLTAuMDY4NSwgMS4wMjk2XSk7CiAgc3RhdGljICNCUkFERk9SRF9TQ0FMRV9JTlZFUlNFX01BVFJJWCA9IG5ldyBGbG9hdDMyQXJyYXkoWzAuOTg2OTkyOSwgLTAuMTQ3MDU0MywgMC4xNTk5NjI3LCAwLjQzMjMwNTMsIDAuNTE4MzYwMywgMC4wNDkyOTEyLCAtMC4wMDg1Mjg3LCAwLjA0MDA0MjgsIDAuOTY4NDg2N10pOwogIHN0YXRpYyAjU1JHQl9ENjVfWFlaX1RPX1JHQl9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFszLjI0MDQ1NDIsIC0xLjUzNzEzODUsIC0wLjQ5ODUzMTQsIC0wLjk2OTI2NjAsIDEuODc2MDEwOCwgMC4wNDE1NTYwLCAwLjA1NTY0MzQsIC0wLjIwNDAyNTksIDEuMDU3MjI1Ml0pOwogIHN0YXRpYyAjRkxBVF9XSElURVBPSU5UX01BVFJJWCA9IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDEsIDFdKTsKICBzdGF0aWMgI3RlbXBOb3JtYWxpemVNYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogIHN0YXRpYyAjdGVtcENvbnZlcnRNYXRyaXgxID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICBzdGF0aWMgI3RlbXBDb252ZXJ0TWF0cml4MiA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgc3RhdGljICNERUNPREVfTF9DT05TVEFOVCA9ICgoOCArIDE2KSAvIDExNikgKiogMyAvIDguMDsKICBjb25zdHJ1Y3Rvcih3aGl0ZVBvaW50LCBibGFja1BvaW50LCBnYW1tYSwgbWF0cml4KSB7CiAgICBzdXBlcigiQ2FsUkdCIiwgMyk7CiAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgQ2FsUkdCIik7CiAgICB9CiAgICBjb25zdCBbWFcsIFlXLCBaV10gPSB0aGlzLndoaXRlUG9pbnQgPSB3aGl0ZVBvaW50OwogICAgY29uc3QgW1hCLCBZQiwgWkJdID0gdGhpcy5ibGFja1BvaW50ID0gYmxhY2tQb2ludCB8fCBuZXcgRmxvYXQzMkFycmF5KDMpOwogICAgW3RoaXMuR1IsIHRoaXMuR0csIHRoaXMuR0JdID0gZ2FtbWEgfHwgbmV3IEZsb2F0MzJBcnJheShbMSwgMSwgMV0pOwogICAgW3RoaXMuTVhBLCB0aGlzLk1ZQSwgdGhpcy5NWkEsIHRoaXMuTVhCLCB0aGlzLk1ZQiwgdGhpcy5NWkIsIHRoaXMuTVhDLCB0aGlzLk1ZQywgdGhpcy5NWkNdID0gbWF0cml4IHx8IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDFdKTsKICAgIGlmIChYVyA8IDAgfHwgWlcgPCAwIHx8IFlXICE9PSAxKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBXaGl0ZVBvaW50IGNvbXBvbmVudHMgZm9yICR7dGhpcy5uYW1lfSwgbm8gZmFsbGJhY2sgYXZhaWxhYmxlYCk7CiAgICB9CiAgICBpZiAoWEIgPCAwIHx8IFlCIDwgMCB8fCBaQiA8IDApIHsKICAgICAgaW5mbyhgSW52YWxpZCBCbGFja1BvaW50IGZvciAke3RoaXMubmFtZX0gWyR7WEJ9LCAke1lCfSwgJHtaQn1dLCBgICsgImZhbGxpbmcgYmFjayB0byBkZWZhdWx0LiIpOwogICAgICB0aGlzLmJsYWNrUG9pbnQgPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogICAgfQogICAgaWYgKHRoaXMuR1IgPCAwIHx8IHRoaXMuR0cgPCAwIHx8IHRoaXMuR0IgPCAwKSB7CiAgICAgIGluZm8oYEludmFsaWQgR2FtbWEgWyR7dGhpcy5HUn0sICR7dGhpcy5HR30sICR7dGhpcy5HQn1dIGZvciBgICsgYCR7dGhpcy5uYW1lfSwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuYCk7CiAgICAgIHRoaXMuR1IgPSB0aGlzLkdHID0gdGhpcy5HQiA9IDE7CiAgICB9CiAgfQogICNtYXRyaXhQcm9kdWN0KGEsIGIsIHJlc3VsdCkgewogICAgcmVzdWx0WzBdID0gYVswXSAqIGJbMF0gKyBhWzFdICogYlsxXSArIGFbMl0gKiBiWzJdOwogICAgcmVzdWx0WzFdID0gYVszXSAqIGJbMF0gKyBhWzRdICogYlsxXSArIGFbNV0gKiBiWzJdOwogICAgcmVzdWx0WzJdID0gYVs2XSAqIGJbMF0gKyBhWzddICogYlsxXSArIGFbOF0gKiBiWzJdOwogIH0KICAjdG9GbGF0KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgcmVzdWx0KSB7CiAgICByZXN1bHRbMF0gPSBMTVNbMF0gKiAxIC8gc291cmNlV2hpdGVQb2ludFswXTsKICAgIHJlc3VsdFsxXSA9IExNU1sxXSAqIDEgLyBzb3VyY2VXaGl0ZVBvaW50WzFdOwogICAgcmVzdWx0WzJdID0gTE1TWzJdICogMSAvIHNvdXJjZVdoaXRlUG9pbnRbMl07CiAgfQogICN0b0Q2NShzb3VyY2VXaGl0ZVBvaW50LCBMTVMsIHJlc3VsdCkgewogICAgY29uc3QgRDY1WCA9IDAuOTUwNDc7CiAgICBjb25zdCBENjVZID0gMTsKICAgIGNvbnN0IEQ2NVogPSAxLjA4ODgzOwogICAgcmVzdWx0WzBdID0gTE1TWzBdICogRDY1WCAvIHNvdXJjZVdoaXRlUG9pbnRbMF07CiAgICByZXN1bHRbMV0gPSBMTVNbMV0gKiBENjVZIC8gc291cmNlV2hpdGVQb2ludFsxXTsKICAgIHJlc3VsdFsyXSA9IExNU1syXSAqIEQ2NVogLyBzb3VyY2VXaGl0ZVBvaW50WzJdOwogIH0KICAjc1JHQlRyYW5zZmVyRnVuY3Rpb24oY29sb3IpIHsKICAgIGlmIChjb2xvciA8PSAwLjAwMzEzMDgpIHsKICAgICAgcmV0dXJuIE1hdGhDbGFtcCgxMi45MiAqIGNvbG9yLCAwLCAxKTsKICAgIH0KICAgIGlmIChjb2xvciA+PSAwLjk5NTU0NTI1KSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgcmV0dXJuIE1hdGhDbGFtcCgoMSArIDAuMDU1KSAqIGNvbG9yICoqICgxIC8gMi40KSAtIDAuMDU1LCAwLCAxKTsKICB9CiAgI2RlY29kZUwoTCkgewogICAgaWYgKEwgPCAwKSB7CiAgICAgIHJldHVybiAtdGhpcy4jZGVjb2RlTCgtTCk7CiAgICB9CiAgICBpZiAoTCA+IDguMCkgewogICAgICByZXR1cm4gKChMICsgMTYpIC8gMTE2KSAqKiAzOwogICAgfQogICAgcmV0dXJuIEwgKiBDYWxSR0JDUy4jREVDT0RFX0xfQ09OU1RBTlQ7CiAgfQogICNjb21wZW5zYXRlQmxhY2tQb2ludChzb3VyY2VCbGFja1BvaW50LCBYWVpfRmxhdCwgcmVzdWx0KSB7CiAgICBpZiAoc291cmNlQmxhY2tQb2ludFswXSA9PT0gMCAmJiBzb3VyY2VCbGFja1BvaW50WzFdID09PSAwICYmIHNvdXJjZUJsYWNrUG9pbnRbMl0gPT09IDApIHsKICAgICAgcmVzdWx0WzBdID0gWFlaX0ZsYXRbMF07CiAgICAgIHJlc3VsdFsxXSA9IFhZWl9GbGF0WzFdOwogICAgICByZXN1bHRbMl0gPSBYWVpfRmxhdFsyXTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgemVyb0RlY29kZUwgPSB0aGlzLiNkZWNvZGVMKDApOwogICAgY29uc3QgWF9EU1QgPSB6ZXJvRGVjb2RlTDsKICAgIGNvbnN0IFhfU1JDID0gdGhpcy4jZGVjb2RlTChzb3VyY2VCbGFja1BvaW50WzBdKTsKICAgIGNvbnN0IFlfRFNUID0gemVyb0RlY29kZUw7CiAgICBjb25zdCBZX1NSQyA9IHRoaXMuI2RlY29kZUwoc291cmNlQmxhY2tQb2ludFsxXSk7CiAgICBjb25zdCBaX0RTVCA9IHplcm9EZWNvZGVMOwogICAgY29uc3QgWl9TUkMgPSB0aGlzLiNkZWNvZGVMKHNvdXJjZUJsYWNrUG9pbnRbMl0pOwogICAgY29uc3QgWF9TY2FsZSA9ICgxIC0gWF9EU1QpIC8gKDEgLSBYX1NSQyk7CiAgICBjb25zdCBYX09mZnNldCA9IDEgLSBYX1NjYWxlOwogICAgY29uc3QgWV9TY2FsZSA9ICgxIC0gWV9EU1QpIC8gKDEgLSBZX1NSQyk7CiAgICBjb25zdCBZX09mZnNldCA9IDEgLSBZX1NjYWxlOwogICAgY29uc3QgWl9TY2FsZSA9ICgxIC0gWl9EU1QpIC8gKDEgLSBaX1NSQyk7CiAgICBjb25zdCBaX09mZnNldCA9IDEgLSBaX1NjYWxlOwogICAgcmVzdWx0WzBdID0gWFlaX0ZsYXRbMF0gKiBYX1NjYWxlICsgWF9PZmZzZXQ7CiAgICByZXN1bHRbMV0gPSBYWVpfRmxhdFsxXSAqIFlfU2NhbGUgKyBZX09mZnNldDsKICAgIHJlc3VsdFsyXSA9IFhZWl9GbGF0WzJdICogWl9TY2FsZSArIFpfT2Zmc2V0OwogIH0KICAjbm9ybWFsaXplV2hpdGVQb2ludFRvRmxhdChzb3VyY2VXaGl0ZVBvaW50LCBYWVpfSW4sIHJlc3VsdCkgewogICAgaWYgKHNvdXJjZVdoaXRlUG9pbnRbMF0gPT09IDEgJiYgc291cmNlV2hpdGVQb2ludFsyXSA9PT0gMSkgewogICAgICByZXN1bHRbMF0gPSBYWVpfSW5bMF07CiAgICAgIHJlc3VsdFsxXSA9IFhZWl9JblsxXTsKICAgICAgcmVzdWx0WzJdID0gWFlaX0luWzJdOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBMTVMgPSByZXN1bHQ7CiAgICB0aGlzLiNtYXRyaXhQcm9kdWN0KENhbFJHQkNTLiNCUkFERk9SRF9TQ0FMRV9NQVRSSVgsIFhZWl9JbiwgTE1TKTsKICAgIGNvbnN0IExNU19GbGF0ID0gQ2FsUkdCQ1MuI3RlbXBOb3JtYWxpemVNYXRyaXg7CiAgICB0aGlzLiN0b0ZsYXQoc291cmNlV2hpdGVQb2ludCwgTE1TLCBMTVNfRmxhdCk7CiAgICB0aGlzLiNtYXRyaXhQcm9kdWN0KENhbFJHQkNTLiNCUkFERk9SRF9TQ0FMRV9JTlZFUlNFX01BVFJJWCwgTE1TX0ZsYXQsIHJlc3VsdCk7CiAgfQogICNub3JtYWxpemVXaGl0ZVBvaW50VG9ENjUoc291cmNlV2hpdGVQb2ludCwgWFlaX0luLCByZXN1bHQpIHsKICAgIGNvbnN0IExNUyA9IHJlc3VsdDsKICAgIHRoaXMuI21hdHJpeFByb2R1Y3QoQ2FsUkdCQ1MuI0JSQURGT1JEX1NDQUxFX01BVFJJWCwgWFlaX0luLCBMTVMpOwogICAgY29uc3QgTE1TX0Q2NSA9IENhbFJHQkNTLiN0ZW1wTm9ybWFsaXplTWF0cml4OwogICAgdGhpcy4jdG9ENjUoc291cmNlV2hpdGVQb2ludCwgTE1TLCBMTVNfRDY1KTsKICAgIHRoaXMuI21hdHJpeFByb2R1Y3QoQ2FsUkdCQ1MuI0JSQURGT1JEX1NDQUxFX0lOVkVSU0VfTUFUUklYLCBMTVNfRDY1LCByZXN1bHQpOwogIH0KICAjdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIHNjYWxlKSB7CiAgICBjb25zdCBBID0gTWF0aENsYW1wKHNyY1tzcmNPZmZzZXRdICogc2NhbGUsIDAsIDEpOwogICAgY29uc3QgQiA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0ICsgMV0gKiBzY2FsZSwgMCwgMSk7CiAgICBjb25zdCBDID0gTWF0aENsYW1wKHNyY1tzcmNPZmZzZXQgKyAyXSAqIHNjYWxlLCAwLCAxKTsKICAgIGNvbnN0IEFHUiA9IEEgPT09IDEgPyAxIDogQSAqKiB0aGlzLkdSOwogICAgY29uc3QgQkdHID0gQiA9PT0gMSA/IDEgOiBCICoqIHRoaXMuR0c7CiAgICBjb25zdCBDR0IgPSBDID09PSAxID8gMSA6IEMgKiogdGhpcy5HQjsKICAgIGNvbnN0IFggPSB0aGlzLk1YQSAqIEFHUiArIHRoaXMuTVhCICogQkdHICsgdGhpcy5NWEMgKiBDR0I7CiAgICBjb25zdCBZID0gdGhpcy5NWUEgKiBBR1IgKyB0aGlzLk1ZQiAqIEJHRyArIHRoaXMuTVlDICogQ0dCOwogICAgY29uc3QgWiA9IHRoaXMuTVpBICogQUdSICsgdGhpcy5NWkIgKiBCR0cgKyB0aGlzLk1aQyAqIENHQjsKICAgIGNvbnN0IFhZWiA9IENhbFJHQkNTLiN0ZW1wQ29udmVydE1hdHJpeDE7CiAgICBYWVpbMF0gPSBYOwogICAgWFlaWzFdID0gWTsKICAgIFhZWlsyXSA9IFo7CiAgICBjb25zdCBYWVpfRmxhdCA9IENhbFJHQkNTLiN0ZW1wQ29udmVydE1hdHJpeDI7CiAgICB0aGlzLiNub3JtYWxpemVXaGl0ZVBvaW50VG9GbGF0KHRoaXMud2hpdGVQb2ludCwgWFlaLCBYWVpfRmxhdCk7CiAgICBjb25zdCBYWVpfQmxhY2sgPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgxOwogICAgdGhpcy4jY29tcGVuc2F0ZUJsYWNrUG9pbnQodGhpcy5ibGFja1BvaW50LCBYWVpfRmxhdCwgWFlaX0JsYWNrKTsKICAgIGNvbnN0IFhZWl9ENjUgPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgyOwogICAgdGhpcy4jbm9ybWFsaXplV2hpdGVQb2ludFRvRDY1KENhbFJHQkNTLiNGTEFUX1dISVRFUE9JTlRfTUFUUklYLCBYWVpfQmxhY2ssIFhZWl9ENjUpOwogICAgY29uc3QgU1JHQiA9IENhbFJHQkNTLiN0ZW1wQ29udmVydE1hdHJpeDE7CiAgICB0aGlzLiNtYXRyaXhQcm9kdWN0KENhbFJHQkNTLiNTUkdCX0Q2NV9YWVpfVE9fUkdCX01BVFJJWCwgWFlaX0Q2NSwgU1JHQik7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gdGhpcy4jc1JHQlRyYW5zZmVyRnVuY3Rpb24oU1JHQlswXSkgKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IHRoaXMuI3NSR0JUcmFuc2ZlckZ1bmN0aW9uKFNSR0JbMV0pICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSB0aGlzLiNzUkdCVHJhbnNmZXJGdW5jdGlvbihTUkdCWzJdKSAqIDI1NTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIDEpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBzY2FsZSA9IDEgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpOwogICAgICBzcmNPZmZzZXQgKz0gMzsKICAgICAgZGVzdE9mZnNldCArPSAzICsgYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpIC8gMyB8IDA7CiAgfQp9CmNsYXNzIExhYkNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3Iod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgcmFuZ2UpIHsKICAgIHN1cGVyKCJMYWIiLCAzKTsKICAgIGlmICghd2hpdGVQb2ludCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIldoaXRlUG9pbnQgbWlzc2luZyAtIHJlcXVpcmVkIGZvciBjb2xvciBzcGFjZSBMYWIiKTsKICAgIH0KICAgIFt0aGlzLlhXLCB0aGlzLllXLCB0aGlzLlpXXSA9IHdoaXRlUG9pbnQ7CiAgICBbdGhpcy5hbWluLCB0aGlzLmFtYXgsIHRoaXMuYm1pbiwgdGhpcy5ibWF4XSA9IHJhbmdlIHx8IFstMTAwLCAxMDAsIC0xMDAsIDEwMF07CiAgICBbdGhpcy5YQiwgdGhpcy5ZQiwgdGhpcy5aQl0gPSBibGFja1BvaW50IHx8IFswLCAwLCAwXTsKICAgIGlmICh0aGlzLlhXIDwgMCB8fCB0aGlzLlpXIDwgMCB8fCB0aGlzLllXICE9PSAxKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBXaGl0ZVBvaW50IGNvbXBvbmVudHMsIG5vIGZhbGxiYWNrIGF2YWlsYWJsZSIpOwogICAgfQogICAgaWYgKHRoaXMuWEIgPCAwIHx8IHRoaXMuWUIgPCAwIHx8IHRoaXMuWkIgPCAwKSB7CiAgICAgIGluZm8oIkludmFsaWQgQmxhY2tQb2ludCwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQiKTsKICAgICAgdGhpcy5YQiA9IHRoaXMuWUIgPSB0aGlzLlpCID0gMDsKICAgIH0KICAgIGlmICh0aGlzLmFtaW4gPiB0aGlzLmFtYXggfHwgdGhpcy5ibWluID4gdGhpcy5ibWF4KSB7CiAgICAgIGluZm8oIkludmFsaWQgUmFuZ2UsIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0cyIpOwogICAgICB0aGlzLmFtaW4gPSAtMTAwOwogICAgICB0aGlzLmFtYXggPSAxMDA7CiAgICAgIHRoaXMuYm1pbiA9IC0xMDA7CiAgICAgIHRoaXMuYm1heCA9IDEwMDsKICAgIH0KICB9CiAgI2ZuX2coeCkgewogICAgcmV0dXJuIHggPj0gNiAvIDI5ID8geCAqKiAzIDogMTA4IC8gODQxICogKHggLSA0IC8gMjkpOwogIH0KICAjZGVjb2RlKHZhbHVlLCBoaWdoMSwgbG93MiwgaGlnaDIpIHsKICAgIHJldHVybiBsb3cyICsgdmFsdWUgKiAoaGlnaDIgLSBsb3cyKSAvIGhpZ2gxOwogIH0KICAjdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIG1heFZhbCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgbGV0IExzID0gc3JjW3NyY09mZnNldF07CiAgICBsZXQgYXMgPSBzcmNbc3JjT2Zmc2V0ICsgMV07CiAgICBsZXQgYnMgPSBzcmNbc3JjT2Zmc2V0ICsgMl07CiAgICBpZiAobWF4VmFsICE9PSBmYWxzZSkgewogICAgICBMcyA9IHRoaXMuI2RlY29kZShMcywgbWF4VmFsLCAwLCAxMDApOwogICAgICBhcyA9IHRoaXMuI2RlY29kZShhcywgbWF4VmFsLCB0aGlzLmFtaW4sIHRoaXMuYW1heCk7CiAgICAgIGJzID0gdGhpcy4jZGVjb2RlKGJzLCBtYXhWYWwsIHRoaXMuYm1pbiwgdGhpcy5ibWF4KTsKICAgIH0KICAgIGlmIChhcyA+IHRoaXMuYW1heCkgewogICAgICBhcyA9IHRoaXMuYW1heDsKICAgIH0gZWxzZSBpZiAoYXMgPCB0aGlzLmFtaW4pIHsKICAgICAgYXMgPSB0aGlzLmFtaW47CiAgICB9CiAgICBpZiAoYnMgPiB0aGlzLmJtYXgpIHsKICAgICAgYnMgPSB0aGlzLmJtYXg7CiAgICB9IGVsc2UgaWYgKGJzIDwgdGhpcy5ibWluKSB7CiAgICAgIGJzID0gdGhpcy5ibWluOwogICAgfQogICAgY29uc3QgTSA9IChMcyArIDE2KSAvIDExNjsKICAgIGNvbnN0IEwgPSBNICsgYXMgLyA1MDA7CiAgICBjb25zdCBOID0gTSAtIGJzIC8gMjAwOwogICAgY29uc3QgWCA9IHRoaXMuWFcgKiB0aGlzLiNmbl9nKEwpOwogICAgY29uc3QgWSA9IHRoaXMuWVcgKiB0aGlzLiNmbl9nKE0pOwogICAgY29uc3QgWiA9IHRoaXMuWlcgKiB0aGlzLiNmbl9nKE4pOwogICAgbGV0IHIsIGcsIGI7CiAgICBpZiAodGhpcy5aVyA8IDEpIHsKICAgICAgciA9IFggKiAzLjEzMzkgKyBZICogLTEuNjE3ICsgWiAqIC0wLjQ5MDY7CiAgICAgIGcgPSBYICogLTAuOTc4NSArIFkgKiAxLjkxNiArIFogKiAwLjAzMzM7CiAgICAgIGIgPSBYICogMC4wNzIgKyBZICogLTAuMjI5ICsgWiAqIDEuNDA1NzsKICAgIH0gZWxzZSB7CiAgICAgIHIgPSBYICogMy4yNDA2ICsgWSAqIC0xLjUzNzIgKyBaICogLTAuNDk4NjsKICAgICAgZyA9IFggKiAtMC45Njg5ICsgWSAqIDEuODc1OCArIFogKiAwLjA0MTU7CiAgICAgIGIgPSBYICogMC4wNTU3ICsgWSAqIC0wLjIwNCArIFogKiAxLjA1NzsKICAgIH0KICAgIGRlc3RbZGVzdE9mZnNldF0gPSBNYXRoLnNxcnQocikgKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IE1hdGguc3FydChnKSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gTWF0aC5zcXJ0KGIpICogMjU1OwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZmFsc2UsIGRlc3QsIGRlc3RPZmZzZXQpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBtYXhWYWwgPSAoMSA8PCBiaXRzKSAtIDE7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIG1heFZhbCwgZGVzdCwgZGVzdE9mZnNldCk7CiAgICAgIHNyY09mZnNldCArPSAzOwogICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSkgLyAzIHwgMDsKICB9CiAgaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgYnBjKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZ2V0IHVzZXNaZXJvVG9PbmVSYW5nZSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInVzZXNaZXJvVG9PbmVSYW5nZSIsIGZhbHNlKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ljY19jb2xvcnNwYWNlLmpzCgoKCgpmdW5jdGlvbiBmZXRjaFN5bmModXJsKSB7CiAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgeGhyLm9wZW4oIkdFVCIsIHVybCwgZmFsc2UpOwogIHhoci5yZXNwb25zZVR5cGUgPSAiYXJyYXlidWZmZXIiOwogIHhoci5zZW5kKG51bGwpOwogIHJldHVybiB4aHIucmVzcG9uc2U7Cn0KY2xhc3MgSWNjQ29sb3JTcGFjZSBleHRlbmRzIENvbG9yU3BhY2UgewogICN0cmFuc2Zvcm1lcjsKICAjY29udmVydFBpeGVsOwogIHN0YXRpYyAjdXNlV2FzbSA9IHRydWU7CiAgc3RhdGljICN3YXNtVXJsID0gbnVsbDsKICBzdGF0aWMgI2ZpbmFsaXplciA9IG51bGw7CiAgY29uc3RydWN0b3IoaWNjUHJvZmlsZSwgbmFtZSwgbnVtQ29tcHMpIHsKICAgIGlmICghSWNjQ29sb3JTcGFjZS5pc1VzYWJsZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIElDQyBjb2xvciBzcGFjZSBzdXBwb3J0Iik7CiAgICB9CiAgICBzdXBlcihuYW1lLCBudW1Db21wcyk7CiAgICBsZXQgaW5UeXBlOwogICAgc3dpdGNoIChudW1Db21wcykgewogICAgICBjYXNlIDE6CiAgICAgICAgaW5UeXBlID0gRGF0YVR5cGUuR3JheTg7CiAgICAgICAgdGhpcy4jY29udmVydFBpeGVsID0gKHNyYywgc3JjT2Zmc2V0LCBjc3MpID0+IHFjbXNfY29udmVydF9vbmUodGhpcy4jdHJhbnNmb3JtZXIsIHNyY1tzcmNPZmZzZXRdICogMjU1LCBjc3MpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM6CiAgICAgICAgaW5UeXBlID0gRGF0YVR5cGUuUkdCODsKICAgICAgICB0aGlzLiNjb252ZXJ0UGl4ZWwgPSAoc3JjLCBzcmNPZmZzZXQsIGNzcykgPT4gcWNtc19jb252ZXJ0X3RocmVlKHRoaXMuI3RyYW5zZm9ybWVyLCBzcmNbc3JjT2Zmc2V0XSAqIDI1NSwgc3JjW3NyY09mZnNldCArIDFdICogMjU1LCBzcmNbc3JjT2Zmc2V0ICsgMl0gKiAyNTUsIGNzcyk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNDoKICAgICAgICBpblR5cGUgPSBEYXRhVHlwZS5DTVlLOwogICAgICAgIHRoaXMuI2NvbnZlcnRQaXhlbCA9IChzcmMsIHNyY09mZnNldCwgY3NzKSA9PiBxY21zX2NvbnZlcnRfZm91cih0aGlzLiN0cmFuc2Zvcm1lciwgc3JjW3NyY09mZnNldF0gKiAyNTUsIHNyY1tzcmNPZmZzZXQgKyAxXSAqIDI1NSwgc3JjW3NyY09mZnNldCArIDJdICogMjU1LCBzcmNbc3JjT2Zmc2V0ICsgM10gKiAyNTUsIGNzcyk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBudW1iZXIgb2YgY29tcG9uZW50czogJHtudW1Db21wc31gKTsKICAgIH0KICAgIHRoaXMuI3RyYW5zZm9ybWVyID0gcWNtc190cmFuc2Zvcm1lcl9mcm9tX21lbW9yeShpY2NQcm9maWxlLCBpblR5cGUsIEludGVudC5QZXJjZXB0dWFsKTsKICAgIGlmICghdGhpcy4jdHJhbnNmb3JtZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJGYWlsZWQgdG8gY3JlYXRlIElDQyBjb2xvciBzcGFjZSIpOwogICAgfQogICAgSWNjQ29sb3JTcGFjZS4jZmluYWxpemVyIHx8PSBuZXcgRmluYWxpemF0aW9uUmVnaXN0cnkodHJhbnNmb3JtZXIgPT4gewogICAgICBxY21zX2Ryb3BfdHJhbnNmb3JtZXIodHJhbnNmb3JtZXIpOwogICAgfSk7CiAgICBJY2NDb2xvclNwYWNlLiNmaW5hbGl6ZXIucmVnaXN0ZXIodGhpcywgdGhpcy4jdHJhbnNmb3JtZXIpOwogIH0KICBnZXRSZ2JIZXgoc3JjLCBzcmNPZmZzZXQpIHsKICAgIHRoaXMuI2NvbnZlcnRQaXhlbChzcmMsIHNyY09mZnNldCwgdHJ1ZSk7CiAgICByZXR1cm4gUUNNUy5fY3NzQ29sb3I7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIFFDTVMuX2Rlc3RCdWZmZXIgPSBkZXN0OwogICAgUUNNUy5fZGVzdE9mZnNldCA9IGRlc3RPZmZzZXQ7CiAgICBRQ01TLl9kZXN0TGVuZ3RoID0gMzsKICAgIHRoaXMuI2NvbnZlcnRQaXhlbChzcmMsIHNyY09mZnNldCwgZmFsc2UpOwogICAgUUNNUy5fZGVzdEJ1ZmZlciA9IG51bGw7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIHNyYyA9IHNyYy5zdWJhcnJheShzcmNPZmZzZXQsIHNyY09mZnNldCArIGNvdW50ICogdGhpcy5udW1Db21wcyk7CiAgICBpZiAoYml0cyAhPT0gOCkgewogICAgICBjb25zdCBzY2FsZSA9IDI1NSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIHNyY1tpXSAqPSBzY2FsZTsKICAgICAgfQogICAgfQogICAgUUNNUy5fbXVzdEFkZEFscGhhID0gYWxwaGEwMSAmJiBkZXN0LmJ1ZmZlciA9PT0gc3JjLmJ1ZmZlcjsKICAgIFFDTVMuX2Rlc3RCdWZmZXIgPSBkZXN0OwogICAgUUNNUy5fZGVzdE9mZnNldCA9IGRlc3RPZmZzZXQ7CiAgICBRQ01TLl9kZXN0TGVuZ3RoID0gY291bnQgKiAoMyArIGFscGhhMDEpOwogICAgcWNtc19jb252ZXJ0X2FycmF5KHRoaXMuI3RyYW5zZm9ybWVyLCBzcmMpOwogICAgUUNNUy5fbXVzdEFkZEFscGhhID0gZmFsc2U7CiAgICBRQ01TLl9kZXN0QnVmZmVyID0gbnVsbDsKICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggLyB0aGlzLm51bUNvbXBzICogKDMgKyBhbHBoYTAxKSB8IDA7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIHVzZVdhc20sCiAgICB1c2VXb3JrZXJGZXRjaCwKICAgIHdhc21VcmwKICB9KSB7CiAgICBpZiAoIXVzZVdvcmtlckZldGNoKSB7CiAgICAgIHRoaXMuI3VzZVdhc20gPSBmYWxzZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdXNlV2FzbSA9IHVzZVdhc207CiAgICB0aGlzLiN3YXNtVXJsID0gd2FzbVVybDsKICB9CiAgc3RhdGljIGdldCBpc1VzYWJsZSgpIHsKICAgIGxldCBpc1VzYWJsZSA9IGZhbHNlOwogICAgaWYgKHRoaXMuI3VzZVdhc20pIHsKICAgICAgaWYgKHRoaXMuI3dhc21VcmwpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy5fbW9kdWxlID0gaW5pdFN5bmMoewogICAgICAgICAgICBtb2R1bGU6IGZldGNoU3luYyhgJHt0aGlzLiN3YXNtVXJsfXFjbXNfYmcud2FzbWApCiAgICAgICAgICB9KTsKICAgICAgICAgIGlzVXNhYmxlID0gISF0aGlzLl9tb2R1bGU7CiAgICAgICAgICBRQ01TLl9tZW1vcnkgPSB0aGlzLl9tb2R1bGUubWVtb3J5OwogICAgICAgICAgUUNNUy5fbWFrZUhleENvbG9yID0gVXRpbC5tYWtlSGV4Q29sb3I7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgd2FybihgSUNDQmFzZWQgY29sb3Igc3BhY2U6ICIke2V9Ii5gKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiTm8gSUNDIGNvbG9yIHNwYWNlIHN1cHBvcnQgZHVlIHRvIG1pc3NpbmcgYHdhc21VcmxgIEFQSSBvcHRpb24iKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNVc2FibGUiLCBpc1VzYWJsZSk7CiAgfQp9CmNsYXNzIENteWtJQ0NCYXNlZENTIGV4dGVuZHMgSWNjQ29sb3JTcGFjZSB7CiAgc3RhdGljICNpY2NVcmw7CiAgY29uc3RydWN0b3IoKSB7CiAgICBjb25zdCBpY2NQcm9maWxlID0gbmV3IFVpbnQ4QXJyYXkoZmV0Y2hTeW5jKGAke0NteWtJQ0NCYXNlZENTLiNpY2NVcmx9Q0dBVFMwMDFDb21wYXQtdjItbWljcm8uaWNjYCkpOwogICAgc3VwZXIoaWNjUHJvZmlsZSwgIkRldmljZUNNWUsiLCA0KTsKICB9CiAgc3RhdGljIHNldE9wdGlvbnMoewogICAgaWNjVXJsCiAgfSkgewogICAgdGhpcy4jaWNjVXJsID0gaWNjVXJsOwogIH0KICBzdGF0aWMgZ2V0IGlzVXNhYmxlKCkgewogICAgbGV0IGlzVXNhYmxlID0gZmFsc2U7CiAgICBpZiAoSWNjQ29sb3JTcGFjZS5pc1VzYWJsZSkgewogICAgICBpZiAodGhpcy4jaWNjVXJsKSB7CiAgICAgICAgaXNVc2FibGUgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oIk5vIENNWUsgSUNDIHByb2ZpbGUgc3VwcG9ydCBkdWUgdG8gbWlzc2luZyBgaWNjVXJsYCBBUEkgb3B0aW9uIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImlzVXNhYmxlIiwgaXNVc2FibGUpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvc3RyZWFtLmpzCgoKY2xhc3MgU3RyZWFtIGV4dGVuZHMgQmFzZVN0cmVhbSB7CiAgY29uc3RydWN0b3IoYXJyYXlCdWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLmJ5dGVzID0gYXJyYXlCdWZmZXIgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gYXJyYXlCdWZmZXIgOiBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7CiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQgfHwgMDsKICAgIHRoaXMucG9zID0gdGhpcy5zdGFydDsKICAgIHRoaXMuZW5kID0gc3RhcnQgKyBsZW5ndGggfHwgdGhpcy5ieXRlcy5sZW5ndGg7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuZW5kIC0gdGhpcy5zdGFydDsKICB9CiAgZ2V0IGlzRW1wdHkoKSB7CiAgICByZXR1cm4gdGhpcy5sZW5ndGggPT09IDA7CiAgfQogIGdldEJ5dGUoKSB7CiAgICBpZiAodGhpcy5wb3MgPj0gdGhpcy5lbmQpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnl0ZXNbdGhpcy5wb3MrK107CiAgfQogIGdldEJ5dGVzKGxlbmd0aCkgewogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICBjb25zdCBzdHJFbmQgPSB0aGlzLmVuZDsKICAgIGlmICghbGVuZ3RoKSB7CiAgICAgIHJldHVybiBieXRlcy5zdWJhcnJheShwb3MsIHN0ckVuZCk7CiAgICB9CiAgICBsZXQgZW5kID0gcG9zICsgbGVuZ3RoOwogICAgaWYgKGVuZCA+IHN0ckVuZCkgewogICAgICBlbmQgPSBzdHJFbmQ7CiAgICB9CiAgICB0aGlzLnBvcyA9IGVuZDsKICAgIHJldHVybiBieXRlcy5zdWJhcnJheShwb3MsIGVuZCk7CiAgfQogIGdldEJ5dGVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICBpZiAoYmVnaW4gPCAwKSB7CiAgICAgIGJlZ2luID0gMDsKICAgIH0KICAgIGlmIChlbmQgPiB0aGlzLmVuZCkgewogICAgICBlbmQgPSB0aGlzLmVuZDsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ5dGVzLnN1YmFycmF5KGJlZ2luLCBlbmQpOwogIH0KICByZXNldCgpIHsKICAgIHRoaXMucG9zID0gdGhpcy5zdGFydDsKICB9CiAgbW92ZVN0YXJ0KCkgewogICAgdGhpcy5zdGFydCA9IHRoaXMucG9zOwogIH0KICBtYWtlU3ViU3RyZWFtKHN0YXJ0LCBsZW5ndGgsIGRpY3QgPSBudWxsKSB7CiAgICByZXR1cm4gbmV3IFN0cmVhbSh0aGlzLmJ5dGVzLmJ1ZmZlciwgc3RhcnQsIGxlbmd0aCwgZGljdCk7CiAgfQp9CmNsYXNzIFN0cmluZ1N0cmVhbSBleHRlbmRzIFN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyKSB7CiAgICBzdXBlcihzdHJpbmdUb0J5dGVzKHN0cikpOwogIH0KfQpjbGFzcyBOdWxsU3RyZWFtIGV4dGVuZHMgU3RyZWFtIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKG5ldyBVaW50OEFycmF5KDApKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NodW5rZWRfc3RyZWFtLmpzCgoKCmNsYXNzIENodW5rZWRTdHJlYW0gZXh0ZW5kcyBTdHJlYW0gewogIGNvbnN0cnVjdG9yKGxlbmd0aCwgY2h1bmtTaXplLCBtYW5hZ2VyKSB7CiAgICBzdXBlcihuZXcgVWludDhBcnJheShsZW5ndGgpLCAwLCBsZW5ndGgsIG51bGwpOwogICAgdGhpcy5jaHVua1NpemUgPSBjaHVua1NpemU7CiAgICB0aGlzLl9sb2FkZWRDaHVua3MgPSBuZXcgU2V0KCk7CiAgICB0aGlzLm51bUNodW5rcyA9IE1hdGguY2VpbChsZW5ndGggLyBjaHVua1NpemUpOwogICAgdGhpcy5tYW5hZ2VyID0gbWFuYWdlcjsKICAgIHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoID0gMDsKICAgIHRoaXMubGFzdFN1Y2Nlc3NmdWxFbnN1cmVCeXRlQ2h1bmsgPSAtMTsKICB9CiAgZ2V0TWlzc2luZ0NodW5rcygpIHsKICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgZm9yIChsZXQgY2h1bmsgPSAwLCBuID0gdGhpcy5udW1DaHVua3M7IGNodW5rIDwgbjsgKytjaHVuaykgewogICAgICBpZiAoIXRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspKSB7CiAgICAgICAgY2h1bmtzLnB1c2goY2h1bmspOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY2h1bmtzOwogIH0KICBnZXQgbnVtQ2h1bmtzTG9hZGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2xvYWRlZENodW5rcy5zaXplOwogIH0KICBnZXQgaXNEYXRhTG9hZGVkKCkgewogICAgcmV0dXJuIHRoaXMubnVtQ2h1bmtzTG9hZGVkID09PSB0aGlzLm51bUNodW5rczsKICB9CiAgb25SZWNlaXZlRGF0YShiZWdpbiwgY2h1bmspIHsKICAgIGNvbnN0IGNodW5rU2l6ZSA9IHRoaXMuY2h1bmtTaXplOwogICAgaWYgKGJlZ2luICUgY2h1bmtTaXplICE9PSAwKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIGJlZ2luIG9mZnNldDogJHtiZWdpbn1gKTsKICAgIH0KICAgIGNvbnN0IGVuZCA9IGJlZ2luICsgY2h1bmsuYnl0ZUxlbmd0aDsKICAgIGlmIChlbmQgJSBjaHVua1NpemUgIT09IDAgJiYgZW5kICE9PSB0aGlzLmJ5dGVzLmxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBlbmQgb2Zmc2V0OiAke2VuZH1gKTsKICAgIH0KICAgIHRoaXMuYnl0ZXMuc2V0KG5ldyBVaW50OEFycmF5KGNodW5rKSwgYmVnaW4pOwogICAgY29uc3QgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IoYmVnaW4gLyBjaHVua1NpemUpOwogICAgY29uc3QgZW5kQ2h1bmsgPSBNYXRoLmZsb29yKChlbmQgLSAxKSAvIGNodW5rU2l6ZSkgKyAxOwogICAgZm9yIChsZXQgY3VyQ2h1bmsgPSBiZWdpbkNodW5rOyBjdXJDaHVuayA8IGVuZENodW5rOyArK2N1ckNodW5rKSB7CiAgICAgIHRoaXMuX2xvYWRlZENodW5rcy5hZGQoY3VyQ2h1bmspOwogICAgfQogIH0KICBvblJlY2VpdmVQcm9ncmVzc2l2ZURhdGEoZGF0YSkgewogICAgbGV0IHBvc2l0aW9uID0gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGg7CiAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcihwb3NpdGlvbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIHRoaXMuYnl0ZXMuc2V0KG5ldyBVaW50OEFycmF5KGRhdGEpLCBwb3NpdGlvbik7CiAgICBwb3NpdGlvbiArPSBkYXRhLmJ5dGVMZW5ndGg7CiAgICB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA9IHBvc2l0aW9uOwogICAgY29uc3QgZW5kQ2h1bmsgPSBwb3NpdGlvbiA+PSB0aGlzLmVuZCA/IHRoaXMubnVtQ2h1bmtzIDogTWF0aC5mbG9vcihwb3NpdGlvbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGZvciAobGV0IGN1ckNodW5rID0gYmVnaW5DaHVuazsgY3VyQ2h1bmsgPCBlbmRDaHVuazsgKytjdXJDaHVuaykgewogICAgICB0aGlzLl9sb2FkZWRDaHVua3MuYWRkKGN1ckNodW5rKTsKICAgIH0KICB9CiAgZW5zdXJlQnl0ZShwb3MpIHsKICAgIGlmIChwb3MgPCB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjaHVuayA9IE1hdGguZmxvb3IocG9zIC8gdGhpcy5jaHVua1NpemUpOwogICAgaWYgKGNodW5rID4gdGhpcy5udW1DaHVua3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGNodW5rID09PSB0aGlzLmxhc3RTdWNjZXNzZnVsRW5zdXJlQnl0ZUNodW5rKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgdGhyb3cgbmV3IE1pc3NpbmdEYXRhRXhjZXB0aW9uKHBvcywgcG9zICsgMSk7CiAgICB9CiAgICB0aGlzLmxhc3RTdWNjZXNzZnVsRW5zdXJlQnl0ZUNodW5rID0gY2h1bms7CiAgfQogIGVuc3VyZVJhbmdlKGJlZ2luLCBlbmQpIHsKICAgIGlmIChiZWdpbiA+PSBlbmQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGVuZCA8PSB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcihiZWdpbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGlmIChiZWdpbkNodW5rID4gdGhpcy5udW1DaHVua3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZW5kQ2h1bmsgPSBNYXRoLm1pbihNYXRoLmZsb29yKChlbmQgLSAxKSAvIHRoaXMuY2h1bmtTaXplKSArIDEsIHRoaXMubnVtQ2h1bmtzKTsKICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICBpZiAoIXRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspKSB7CiAgICAgICAgdGhyb3cgbmV3IE1pc3NpbmdEYXRhRXhjZXB0aW9uKGJlZ2luLCBlbmQpOwogICAgICB9CiAgICB9CiAgfQogIG5leHRFbXB0eUNodW5rKGJlZ2luQ2h1bmspIHsKICAgIGNvbnN0IG51bUNodW5rcyA9IHRoaXMubnVtQ2h1bmtzOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1DaHVua3M7ICsraSkgewogICAgICBjb25zdCBjaHVuayA9IChiZWdpbkNodW5rICsgaSkgJSBudW1DaHVua3M7CiAgICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgICByZXR1cm4gY2h1bms7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBoYXNDaHVuayhjaHVuaykgewogICAgcmV0dXJuIHRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspOwogIH0KICBnZXRCeXRlKCkgewogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICBpZiAocG9zID49IHRoaXMuZW5kKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIGlmIChwb3MgPj0gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVCeXRlKHBvcyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5ieXRlc1t0aGlzLnBvcysrXTsKICB9CiAgZ2V0Qnl0ZXMobGVuZ3RoKSB7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBwb3MgPSB0aGlzLnBvczsKICAgIGNvbnN0IHN0ckVuZCA9IHRoaXMuZW5kOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgaWYgKHN0ckVuZCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgdGhpcy5lbnN1cmVSYW5nZShwb3MsIHN0ckVuZCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ5dGVzLnN1YmFycmF5KHBvcywgc3RyRW5kKTsKICAgIH0KICAgIGxldCBlbmQgPSBwb3MgKyBsZW5ndGg7CiAgICBpZiAoZW5kID4gc3RyRW5kKSB7CiAgICAgIGVuZCA9IHN0ckVuZDsKICAgIH0KICAgIGlmIChlbmQgPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZVJhbmdlKHBvcywgZW5kKTsKICAgIH0KICAgIHRoaXMucG9zID0gZW5kOwogICAgcmV0dXJuIGJ5dGVzLnN1YmFycmF5KHBvcywgZW5kKTsKICB9CiAgZ2V0Qnl0ZVJhbmdlKGJlZ2luLCBlbmQpIHsKICAgIGlmIChiZWdpbiA8IDApIHsKICAgICAgYmVnaW4gPSAwOwogICAgfQogICAgaWYgKGVuZCA+IHRoaXMuZW5kKSB7CiAgICAgIGVuZCA9IHRoaXMuZW5kOwogICAgfQogICAgaWYgKGVuZCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHRoaXMuZW5zdXJlUmFuZ2UoYmVnaW4sIGVuZCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5ieXRlcy5zdWJhcnJheShiZWdpbiwgZW5kKTsKICB9CiAgbWFrZVN1YlN0cmVhbShzdGFydCwgbGVuZ3RoLCBkaWN0ID0gbnVsbCkgewogICAgaWYgKGxlbmd0aCkgewogICAgICBpZiAoc3RhcnQgKyBsZW5ndGggPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICAgIHRoaXMuZW5zdXJlUmFuZ2Uoc3RhcnQsIHN0YXJ0ICsgbGVuZ3RoKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChzdGFydCA+PSB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZUJ5dGUoc3RhcnQpOwogICAgfQogICAgZnVuY3Rpb24gQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbSgpIHt9CiAgICBDaHVua2VkU3RyZWFtU3Vic3RyZWFtLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBDaHVua2VkU3RyZWFtU3Vic3RyZWFtLnByb3RvdHlwZS5nZXRNaXNzaW5nQ2h1bmtzID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zdCBjaHVua1NpemUgPSB0aGlzLmNodW5rU2l6ZTsKICAgICAgY29uc3QgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IodGhpcy5zdGFydCAvIGNodW5rU2l6ZSk7CiAgICAgIGNvbnN0IGVuZENodW5rID0gTWF0aC5mbG9vcigodGhpcy5lbmQgLSAxKSAvIGNodW5rU2l6ZSkgKyAxOwogICAgICBjb25zdCBtaXNzaW5nQ2h1bmtzID0gW107CiAgICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgICAgIG1pc3NpbmdDaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBtaXNzaW5nQ2h1bmtzOwogICAgfTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaHVua2VkU3RyZWFtU3Vic3RyZWFtLnByb3RvdHlwZSwgImlzRGF0YUxvYWRlZCIsIHsKICAgICAgZ2V0KCkgewogICAgICAgIGlmICh0aGlzLm51bUNodW5rc0xvYWRlZCA9PT0gdGhpcy5udW1DaHVua3MpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5nZXRNaXNzaW5nQ2h1bmtzKCkubGVuZ3RoID09PSAwOwogICAgICB9LAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0pOwogICAgY29uc3Qgc3ViU3RyZWFtID0gbmV3IENodW5rZWRTdHJlYW1TdWJzdHJlYW0oKTsKICAgIHN1YlN0cmVhbS5wb3MgPSBzdWJTdHJlYW0uc3RhcnQgPSBzdGFydDsKICAgIHN1YlN0cmVhbS5lbmQgPSBzdGFydCArIGxlbmd0aCB8fCB0aGlzLmVuZDsKICAgIHN1YlN0cmVhbS5kaWN0ID0gZGljdDsKICAgIHJldHVybiBzdWJTdHJlYW07CiAgfQogIGdldEJhc2VTdHJlYW1zKCkgewogICAgcmV0dXJuIFt0aGlzXTsKICB9Cn0KY2xhc3MgQ2h1bmtlZFN0cmVhbU1hbmFnZXIgewogIGNvbnN0cnVjdG9yKHBkZk5ldHdvcmtTdHJlYW0sIGFyZ3MpIHsKICAgIHRoaXMubGVuZ3RoID0gYXJncy5sZW5ndGg7CiAgICB0aGlzLmNodW5rU2l6ZSA9IGFyZ3MucmFuZ2VDaHVua1NpemU7CiAgICB0aGlzLnN0cmVhbSA9IG5ldyBDaHVua2VkU3RyZWFtKHRoaXMubGVuZ3RoLCB0aGlzLmNodW5rU2l6ZSwgdGhpcyk7CiAgICB0aGlzLnBkZk5ldHdvcmtTdHJlYW0gPSBwZGZOZXR3b3JrU3RyZWFtOwogICAgdGhpcy5kaXNhYmxlQXV0b0ZldGNoID0gYXJncy5kaXNhYmxlQXV0b0ZldGNoOwogICAgdGhpcy5tc2dIYW5kbGVyID0gYXJncy5tc2dIYW5kbGVyOwogICAgdGhpcy5jdXJyUmVxdWVzdElkID0gMDsKICAgIHRoaXMuX2NodW5rc05lZWRlZEJ5UmVxdWVzdCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3JlcXVlc3RzQnlDaHVuayA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3Byb21pc2VzQnlSZXF1ZXN0ID0gbmV3IE1hcCgpOwogICAgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggPSAwOwogICAgdGhpcy5hYm9ydGVkID0gZmFsc2U7CiAgICB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgfQogIHNlbmRSZXF1ZXN0KGJlZ2luLCBlbmQpIHsKICAgIGNvbnN0IHJhbmdlUmVhZGVyID0gdGhpcy5wZGZOZXR3b3JrU3RyZWFtLmdldFJhbmdlUmVhZGVyKGJlZ2luLCBlbmQpOwogICAgaWYgKCFyYW5nZVJlYWRlci5pc1N0cmVhbWluZ1N1cHBvcnRlZCkgewogICAgICByYW5nZVJlYWRlci5vblByb2dyZXNzID0gdGhpcy5vblByb2dyZXNzLmJpbmQodGhpcyk7CiAgICB9CiAgICBsZXQgY2h1bmtzID0gW10sCiAgICAgIGxvYWRlZCA9IDA7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCByZWFkQ2h1bmsgPSAoewogICAgICAgIHZhbHVlLAogICAgICAgIGRvbmUKICAgICAgfSkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICBjb25zdCBjaHVua0RhdGEgPSBhcnJheUJ1ZmZlcnNUb0J5dGVzKGNodW5rcyk7CiAgICAgICAgICAgIGNodW5rcyA9IG51bGw7CiAgICAgICAgICAgIHJlc29sdmUoY2h1bmtEYXRhKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAgICAgICBpZiAocmFuZ2VSZWFkZXIuaXNTdHJlYW1pbmdTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgdGhpcy5vblByb2dyZXNzKHsKICAgICAgICAgICAgICBsb2FkZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBjaHVua3MucHVzaCh2YWx1ZSk7CiAgICAgICAgICByYW5nZVJlYWRlci5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmFuZ2VSZWFkZXIucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgfSkudGhlbihkYXRhID0+IHsKICAgICAgaWYgKHRoaXMuYWJvcnRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLm9uUmVjZWl2ZURhdGEoewogICAgICAgIGNodW5rOiBkYXRhLAogICAgICAgIGJlZ2luCiAgICAgIH0pOwogICAgfSk7CiAgfQogIHJlcXVlc3RBbGxDaHVua3Mobm9GZXRjaCA9IGZhbHNlKSB7CiAgICBpZiAoIW5vRmV0Y2gpIHsKICAgICAgY29uc3QgbWlzc2luZ0NodW5rcyA9IHRoaXMuc3RyZWFtLmdldE1pc3NpbmdDaHVua3MoKTsKICAgICAgdGhpcy5fcmVxdWVzdENodW5rcyhtaXNzaW5nQ2h1bmtzKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5LnByb21pc2U7CiAgfQogIF9yZXF1ZXN0Q2h1bmtzKGNodW5rcykgewogICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5jdXJyUmVxdWVzdElkKys7CiAgICBjb25zdCBjaHVua3NOZWVkZWQgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl9jaHVua3NOZWVkZWRCeVJlcXVlc3Quc2V0KHJlcXVlc3RJZCwgY2h1bmtzTmVlZGVkKTsKICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7CiAgICAgIGlmICghdGhpcy5zdHJlYW0uaGFzQ2h1bmsoY2h1bmspKSB7CiAgICAgICAgY2h1bmtzTmVlZGVkLmFkZChjaHVuayk7CiAgICAgIH0KICAgIH0KICAgIGlmIChjaHVua3NOZWVkZWQuc2l6ZSA9PT0gMCkgewogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB9CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdC5zZXQocmVxdWVzdElkLCBjYXBhYmlsaXR5KTsKICAgIGNvbnN0IGNodW5rc1RvUmVxdWVzdCA9IFtdOwogICAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3NOZWVkZWQpIHsKICAgICAgbGV0IHJlcXVlc3RJZHMgPSB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuZ2V0KGNodW5rKTsKICAgICAgaWYgKCFyZXF1ZXN0SWRzKSB7CiAgICAgICAgcmVxdWVzdElkcyA9IFtdOwogICAgICAgIHRoaXMuX3JlcXVlc3RzQnlDaHVuay5zZXQoY2h1bmssIHJlcXVlc3RJZHMpOwogICAgICAgIGNodW5rc1RvUmVxdWVzdC5wdXNoKGNodW5rKTsKICAgICAgfQogICAgICByZXF1ZXN0SWRzLnB1c2gocmVxdWVzdElkKTsKICAgIH0KICAgIGlmIChjaHVua3NUb1JlcXVlc3QubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBncm91cGVkQ2h1bmtzVG9SZXF1ZXN0ID0gdGhpcy5ncm91cENodW5rcyhjaHVua3NUb1JlcXVlc3QpOwogICAgICBmb3IgKGNvbnN0IGdyb3VwZWRDaHVuayBvZiBncm91cGVkQ2h1bmtzVG9SZXF1ZXN0KSB7CiAgICAgICAgY29uc3QgYmVnaW4gPSBncm91cGVkQ2h1bmsuYmVnaW5DaHVuayAqIHRoaXMuY2h1bmtTaXplOwogICAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGdyb3VwZWRDaHVuay5lbmRDaHVuayAqIHRoaXMuY2h1bmtTaXplLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChiZWdpbiwgZW5kKS5jYXRjaChjYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2UuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHRoaXMuYWJvcnRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aHJvdyByZWFzb247CiAgICB9KTsKICB9CiAgZ2V0U3RyZWFtKCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtOwogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgZW5kID0gTWF0aC5taW4oZW5kLCB0aGlzLmxlbmd0aCk7CiAgICBjb25zdCBiZWdpbkNodW5rID0gdGhpcy5nZXRCZWdpbkNodW5rKGJlZ2luKTsKICAgIGNvbnN0IGVuZENodW5rID0gdGhpcy5nZXRFbmRDaHVuayhlbmQpOwogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBmb3IgKGxldCBjaHVuayA9IGJlZ2luQ2h1bms7IGNodW5rIDwgZW5kQ2h1bms7ICsrY2h1bmspIHsKICAgICAgY2h1bmtzLnB1c2goY2h1bmspOwogICAgfQogICAgcmV0dXJuIHRoaXMuX3JlcXVlc3RDaHVua3MoY2h1bmtzKTsKICB9CiAgcmVxdWVzdFJhbmdlcyhyYW5nZXMgPSBbXSkgewogICAgY29uc3QgY2h1bmtzVG9SZXF1ZXN0ID0gW107CiAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHJhbmdlcykgewogICAgICBjb25zdCBiZWdpbkNodW5rID0gdGhpcy5nZXRCZWdpbkNodW5rKHJhbmdlLmJlZ2luKTsKICAgICAgY29uc3QgZW5kQ2h1bmsgPSB0aGlzLmdldEVuZENodW5rKHJhbmdlLmVuZCk7CiAgICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICAgIGlmICghY2h1bmtzVG9SZXF1ZXN0LmluY2x1ZGVzKGNodW5rKSkgewogICAgICAgICAgY2h1bmtzVG9SZXF1ZXN0LnB1c2goY2h1bmspOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY2h1bmtzVG9SZXF1ZXN0LnNvcnQoKGEsIGIpID0+IGEgLSBiKTsKICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0Q2h1bmtzKGNodW5rc1RvUmVxdWVzdCk7CiAgfQogIGdyb3VwQ2h1bmtzKGNodW5rcykgewogICAgY29uc3QgZ3JvdXBlZENodW5rcyA9IFtdOwogICAgbGV0IGJlZ2luQ2h1bmsgPSAtMTsKICAgIGxldCBwcmV2Q2h1bmsgPSAtMTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNodW5rcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IGNodW5rID0gY2h1bmtzW2ldOwogICAgICBpZiAoYmVnaW5DaHVuayA8IDApIHsKICAgICAgICBiZWdpbkNodW5rID0gY2h1bms7CiAgICAgIH0KICAgICAgaWYgKHByZXZDaHVuayA+PSAwICYmIHByZXZDaHVuayArIDEgIT09IGNodW5rKSB7CiAgICAgICAgZ3JvdXBlZENodW5rcy5wdXNoKHsKICAgICAgICAgIGJlZ2luQ2h1bmssCiAgICAgICAgICBlbmRDaHVuazogcHJldkNodW5rICsgMQogICAgICAgIH0pOwogICAgICAgIGJlZ2luQ2h1bmsgPSBjaHVuazsKICAgICAgfQogICAgICBpZiAoaSArIDEgPT09IGNodW5rcy5sZW5ndGgpIHsKICAgICAgICBncm91cGVkQ2h1bmtzLnB1c2goewogICAgICAgICAgYmVnaW5DaHVuaywKICAgICAgICAgIGVuZENodW5rOiBjaHVuayArIDEKICAgICAgICB9KTsKICAgICAgfQogICAgICBwcmV2Q2h1bmsgPSBjaHVuazsKICAgIH0KICAgIHJldHVybiBncm91cGVkQ2h1bmtzOwogIH0KICBvblByb2dyZXNzKGFyZ3MpIHsKICAgIHRoaXMubXNnSGFuZGxlci5zZW5kKCJEb2NQcm9ncmVzcyIsIHsKICAgICAgbG9hZGVkOiB0aGlzLnN0cmVhbS5udW1DaHVua3NMb2FkZWQgKiB0aGlzLmNodW5rU2l6ZSArIGFyZ3MubG9hZGVkLAogICAgICB0b3RhbDogdGhpcy5sZW5ndGgKICAgIH0pOwogIH0KICBvblJlY2VpdmVEYXRhKGFyZ3MpIHsKICAgIGNvbnN0IGNodW5rID0gYXJncy5jaHVuazsKICAgIGNvbnN0IGlzUHJvZ3Jlc3NpdmUgPSBhcmdzLmJlZ2luID09PSB1bmRlZmluZWQ7CiAgICBjb25zdCBiZWdpbiA9IGlzUHJvZ3Jlc3NpdmUgPyB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA6IGFyZ3MuYmVnaW47CiAgICBjb25zdCBlbmQgPSBiZWdpbiArIGNodW5rLmJ5dGVMZW5ndGg7CiAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcihiZWdpbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGNvbnN0IGVuZENodW5rID0gZW5kIDwgdGhpcy5sZW5ndGggPyBNYXRoLmZsb29yKGVuZCAvIHRoaXMuY2h1bmtTaXplKSA6IE1hdGguY2VpbChlbmQgLyB0aGlzLmNodW5rU2l6ZSk7CiAgICBpZiAoaXNQcm9ncmVzc2l2ZSkgewogICAgICB0aGlzLnN0cmVhbS5vblJlY2VpdmVQcm9ncmVzc2l2ZURhdGEoY2h1bmspOwogICAgICB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA9IGVuZDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc3RyZWFtLm9uUmVjZWl2ZURhdGEoYmVnaW4sIGNodW5rKTsKICAgIH0KICAgIGlmICh0aGlzLnN0cmVhbS5pc0RhdGFMb2FkZWQpIHsKICAgICAgdGhpcy5fbG9hZGVkU3RyZWFtQ2FwYWJpbGl0eS5yZXNvbHZlKHRoaXMuc3RyZWFtKTsKICAgIH0KICAgIGNvbnN0IGxvYWRlZFJlcXVlc3RzID0gW107CiAgICBmb3IgKGxldCBjdXJDaHVuayA9IGJlZ2luQ2h1bms7IGN1ckNodW5rIDwgZW5kQ2h1bms7ICsrY3VyQ2h1bmspIHsKICAgICAgY29uc3QgcmVxdWVzdElkcyA9IHRoaXMuX3JlcXVlc3RzQnlDaHVuay5nZXQoY3VyQ2h1bmspOwogICAgICBpZiAoIXJlcXVlc3RJZHMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuZGVsZXRlKGN1ckNodW5rKTsKICAgICAgZm9yIChjb25zdCByZXF1ZXN0SWQgb2YgcmVxdWVzdElkcykgewogICAgICAgIGNvbnN0IGNodW5rc05lZWRlZCA9IHRoaXMuX2NodW5rc05lZWRlZEJ5UmVxdWVzdC5nZXQocmVxdWVzdElkKTsKICAgICAgICBpZiAoY2h1bmtzTmVlZGVkLmhhcyhjdXJDaHVuaykpIHsKICAgICAgICAgIGNodW5rc05lZWRlZC5kZWxldGUoY3VyQ2h1bmspOwogICAgICAgIH0KICAgICAgICBpZiAoY2h1bmtzTmVlZGVkLnNpemUgPiAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbG9hZGVkUmVxdWVzdHMucHVzaChyZXF1ZXN0SWQpOwogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuZGlzYWJsZUF1dG9GZXRjaCAmJiB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuc2l6ZSA9PT0gMCkgewogICAgICBsZXQgbmV4dEVtcHR5Q2h1bms7CiAgICAgIGlmICh0aGlzLnN0cmVhbS5udW1DaHVua3NMb2FkZWQgPT09IDEpIHsKICAgICAgICBjb25zdCBsYXN0Q2h1bmsgPSB0aGlzLnN0cmVhbS5udW1DaHVua3MgLSAxOwogICAgICAgIGlmICghdGhpcy5zdHJlYW0uaGFzQ2h1bmsobGFzdENodW5rKSkgewogICAgICAgICAgbmV4dEVtcHR5Q2h1bmsgPSBsYXN0Q2h1bms7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG5leHRFbXB0eUNodW5rID0gdGhpcy5zdHJlYW0ubmV4dEVtcHR5Q2h1bmsoZW5kQ2h1bmspOwogICAgICB9CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG5leHRFbXB0eUNodW5rKSkgewogICAgICAgIHRoaXMuX3JlcXVlc3RDaHVua3MoW25leHRFbXB0eUNodW5rXSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgcmVxdWVzdElkIG9mIGxvYWRlZFJlcXVlc3RzKSB7CiAgICAgIGNvbnN0IGNhcGFiaWxpdHkgPSB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdC5nZXQocmVxdWVzdElkKTsKICAgICAgdGhpcy5fcHJvbWlzZXNCeVJlcXVlc3QuZGVsZXRlKHJlcXVlc3RJZCk7CiAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgfQogICAgdGhpcy5tc2dIYW5kbGVyLnNlbmQoIkRvY1Byb2dyZXNzIiwgewogICAgICBsb2FkZWQ6IHRoaXMuc3RyZWFtLm51bUNodW5rc0xvYWRlZCAqIHRoaXMuY2h1bmtTaXplLAogICAgICB0b3RhbDogdGhpcy5sZW5ndGgKICAgIH0pOwogIH0KICBvbkVycm9yKGVycikgewogICAgdGhpcy5fbG9hZGVkU3RyZWFtQ2FwYWJpbGl0eS5yZWplY3QoZXJyKTsKICB9CiAgZ2V0QmVnaW5DaHVuayhiZWdpbikgewogICAgcmV0dXJuIE1hdGguZmxvb3IoYmVnaW4gLyB0aGlzLmNodW5rU2l6ZSk7CiAgfQogIGdldEVuZENodW5rKGVuZCkgewogICAgcmV0dXJuIE1hdGguZmxvb3IoKGVuZCAtIDEpIC8gdGhpcy5jaHVua1NpemUpICsgMTsKICB9CiAgYWJvcnQocmVhc29uKSB7CiAgICB0aGlzLmFib3J0ZWQgPSB0cnVlOwogICAgdGhpcy5wZGZOZXR3b3JrU3RyZWFtPy5jYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pOwogICAgZm9yIChjb25zdCBjYXBhYmlsaXR5IG9mIHRoaXMuX3Byb21pc2VzQnlSZXF1ZXN0LnZhbHVlcygpKSB7CiAgICAgIGNhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvc2hhcmVkL2ltYWdlX3V0aWxzLmpzCgpmdW5jdGlvbiBjb252ZXJ0VG9SR0JBKHBhcmFtcykgewogIHN3aXRjaCAocGFyYW1zLmtpbmQpIHsKICAgIGNhc2UgSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQOgogICAgICByZXR1cm4gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEocGFyYW1zKTsKICAgIGNhc2UgSW1hZ2VLaW5kLlJHQl8yNEJQUDoKICAgICAgcmV0dXJuIGNvbnZlcnRSR0JUb1JHQkEocGFyYW1zKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEoewogIHNyYywKICBzcmNQb3MgPSAwLAogIGRlc3QsCiAgd2lkdGgsCiAgaGVpZ2h0LAogIG5vbkJsYWNrQ29sb3IgPSAweGZmZmZmZmZmLAogIGludmVyc2VEZWNvZGUgPSBmYWxzZQp9KSB7CiAgY29uc3QgYmxhY2sgPSBGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4ZmYwMDAwMDAgOiAweDAwMDAwMGZmOwogIGNvbnN0IFt6ZXJvTWFwcGluZywgb25lTWFwcGluZ10gPSBpbnZlcnNlRGVjb2RlID8gW25vbkJsYWNrQ29sb3IsIGJsYWNrXSA6IFtibGFjaywgbm9uQmxhY2tDb2xvcl07CiAgY29uc3Qgd2lkdGhJblNvdXJjZSA9IHdpZHRoID4+IDM7CiAgY29uc3Qgd2lkdGhSZW1haW5kZXIgPSB3aWR0aCAmIDc7CiAgY29uc3Qgc3JjTGVuZ3RoID0gc3JjLmxlbmd0aDsKICBkZXN0ID0gbmV3IFVpbnQzMkFycmF5KGRlc3QuYnVmZmVyKTsKICBsZXQgZGVzdFBvcyA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgZm9yIChjb25zdCBtYXggPSBzcmNQb3MgKyB3aWR0aEluU291cmNlOyBzcmNQb3MgPCBtYXg7IHNyY1BvcysrKSB7CiAgICAgIGNvbnN0IGVsZW0gPSBzcmNQb3MgPCBzcmNMZW5ndGggPyBzcmNbc3JjUG9zXSA6IDI1NTsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICB9CiAgICBpZiAod2lkdGhSZW1haW5kZXIgPT09IDApIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBlbGVtID0gc3JjUG9zIDwgc3JjTGVuZ3RoID8gc3JjW3NyY1BvcysrXSA6IDI1NTsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgd2lkdGhSZW1haW5kZXI7IGorKykgewogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMSA8PCA3IC0gaiA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgIH0KICB9CiAgcmV0dXJuIHsKICAgIHNyY1BvcywKICAgIGRlc3RQb3MKICB9Owp9CmZ1bmN0aW9uIGNvbnZlcnRSR0JUb1JHQkEoewogIHNyYywKICBzcmNQb3MgPSAwLAogIGRlc3QsCiAgZGVzdFBvcyA9IDAsCiAgd2lkdGgsCiAgaGVpZ2h0Cn0pIHsKICBsZXQgaSA9IDA7CiAgY29uc3QgbGVuID0gd2lkdGggKiBoZWlnaHQgKiAzOwogIGNvbnN0IGxlbjMyID0gbGVuID4+IDI7CiAgY29uc3Qgc3JjMzIgPSBuZXcgVWludDMyQXJyYXkoc3JjLmJ1ZmZlciwgc3JjUG9zLCBsZW4zMik7CiAgaWYgKEZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuKSB7CiAgICBmb3IgKDsgaSA8IGxlbjMyIC0gMjsgaSArPSAzLCBkZXN0UG9zICs9IDQpIHsKICAgICAgY29uc3QgczEgPSBzcmMzMltpXTsKICAgICAgY29uc3QgczIgPSBzcmMzMltpICsgMV07CiAgICAgIGNvbnN0IHMzID0gc3JjMzJbaSArIDJdOwogICAgICBkZXN0W2Rlc3RQb3NdID0gczEgfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAxXSA9IHMxID4+PiAyNCB8IHMyIDw8IDggfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAyXSA9IHMyID4+PiAxNiB8IHMzIDw8IDE2IHwgMHhmZjAwMDAwMDsKICAgICAgZGVzdFtkZXN0UG9zICsgM10gPSBzMyA+Pj4gOCB8IDB4ZmYwMDAwMDA7CiAgICB9CiAgICBmb3IgKGxldCBqID0gaSAqIDQsIGpqID0gc3JjUG9zICsgbGVuOyBqIDwgamo7IGogKz0gMykgewogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBzcmNbal0gfCBzcmNbaiArIDFdIDw8IDggfCBzcmNbaiArIDJdIDw8IDE2IHwgMHhmZjAwMDAwMDsKICAgIH0KICB9IGVsc2UgewogICAgZm9yICg7IGkgPCBsZW4zMiAtIDI7IGkgKz0gMywgZGVzdFBvcyArPSA0KSB7CiAgICAgIGNvbnN0IHMxID0gc3JjMzJbaV07CiAgICAgIGNvbnN0IHMyID0gc3JjMzJbaSArIDFdOwogICAgICBjb25zdCBzMyA9IHNyYzMyW2kgKyAyXTsKICAgICAgZGVzdFtkZXN0UG9zXSA9IHMxIHwgMHhmZjsKICAgICAgZGVzdFtkZXN0UG9zICsgMV0gPSBzMSA8PCAyNCB8IHMyID4+PiA4IHwgMHhmZjsKICAgICAgZGVzdFtkZXN0UG9zICsgMl0gPSBzMiA8PCAxNiB8IHMzID4+PiAxNiB8IDB4ZmY7CiAgICAgIGRlc3RbZGVzdFBvcyArIDNdID0gczMgPDwgOCB8IDB4ZmY7CiAgICB9CiAgICBmb3IgKGxldCBqID0gaSAqIDQsIGpqID0gc3JjUG9zICsgbGVuOyBqIDwgamo7IGogKz0gMykgewogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBzcmNbal0gPDwgMjQgfCBzcmNbaiArIDFdIDw8IDE2IHwgc3JjW2ogKyAyXSA8PCA4IHwgMHhmZjsKICAgIH0KICB9CiAgcmV0dXJuIHsKICAgIHNyY1Bvczogc3JjUG9zICsgbGVuLAogICAgZGVzdFBvcwogIH07Cn0KZnVuY3Rpb24gZ3JheVRvUkdCQShzcmMsIGRlc3QpIHsKICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHNyYy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGRlc3RbaV0gPSBzcmNbaV0gKiAweDEwMTAxIHwgMHhmZjAwMDAwMDsKICAgIH0KICB9IGVsc2UgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgZGVzdFtpXSA9IHNyY1tpXSAqIDB4MTAxMDEwMCB8IDB4MDAwMDAwZmY7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9pbWFnZV9yZXNpemVyLmpzCgoKCmNvbnN0IE1JTl9JTUFHRV9ESU0gPSAyMDQ4Owpjb25zdCBNQVhfSU1BR0VfRElNID0gNjU1Mzc7CmNvbnN0IE1BWF9FUlJPUiA9IDEyODsKY2xhc3MgSW1hZ2VSZXNpemVyIHsKICBzdGF0aWMgI2dvb2RTcXVhcmVMZW5ndGggPSBNSU5fSU1BR0VfRElNOwogIHN0YXRpYyAjaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQgPSBGZWF0dXJlVGVzdC5pc0ltYWdlRGVjb2RlclN1cHBvcnRlZDsKICBjb25zdHJ1Y3RvcihpbWdEYXRhLCBpc01hc2spIHsKICAgIHRoaXMuX2ltZ0RhdGEgPSBpbWdEYXRhOwogICAgdGhpcy5faXNNYXNrID0gaXNNYXNrOwogIH0KICBzdGF0aWMgZ2V0IGNhblVzZUltYWdlRGVjb2RlcigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImNhblVzZUltYWdlRGVjb2RlciIsIHRoaXMuI2lzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID8gSW1hZ2VEZWNvZGVyLmlzVHlwZVN1cHBvcnRlZCgiaW1hZ2UvYm1wIikgOiBQcm9taXNlLnJlc29sdmUoZmFsc2UpKTsKICB9CiAgc3RhdGljIG5lZWRzVG9CZVJlc2l6ZWQod2lkdGgsIGhlaWdodCkgewogICAgaWYgKHdpZHRoIDw9IHRoaXMuI2dvb2RTcXVhcmVMZW5ndGggJiYgaGVpZ2h0IDw9IHRoaXMuI2dvb2RTcXVhcmVMZW5ndGgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgewogICAgICBNQVhfRElNCiAgICB9ID0gdGhpczsKICAgIGlmICh3aWR0aCA+IE1BWF9ESU0gfHwgaGVpZ2h0ID4gTUFYX0RJTSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IGFyZWEgPSB3aWR0aCAqIGhlaWdodDsKICAgIGlmICh0aGlzLl9oYXNNYXhBcmVhKSB7CiAgICAgIHJldHVybiBhcmVhID4gdGhpcy5NQVhfQVJFQTsKICAgIH0KICAgIGlmIChhcmVhIDwgdGhpcy4jZ29vZFNxdWFyZUxlbmd0aCAqKiAyKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLl9hcmVHb29kRGltcyh3aWR0aCwgaGVpZ2h0KSkgewogICAgICB0aGlzLiNnb29kU3F1YXJlTGVuZ3RoID0gTWF0aC5tYXgodGhpcy4jZ29vZFNxdWFyZUxlbmd0aCwgTWF0aC5mbG9vcihNYXRoLnNxcnQod2lkdGggKiBoZWlnaHQpKSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuI2dvb2RTcXVhcmVMZW5ndGggPSB0aGlzLl9ndWVzc01heCh0aGlzLiNnb29kU3F1YXJlTGVuZ3RoLCBNQVhfRElNLCBNQVhfRVJST1IsIDApOwogICAgY29uc3QgbWF4QXJlYSA9IHRoaXMuTUFYX0FSRUEgPSB0aGlzLiNnb29kU3F1YXJlTGVuZ3RoICoqIDI7CiAgICByZXR1cm4gYXJlYSA+IG1heEFyZWE7CiAgfQogIHN0YXRpYyBnZXRSZWR1Y2VQb3dlckZvckpQWCh3aWR0aCwgaGVpZ2h0LCBjb21wb25lbnRzQ291bnQpIHsKICAgIGNvbnN0IGFyZWEgPSB3aWR0aCAqIGhlaWdodDsKICAgIGNvbnN0IG1heEpQWEFyZWEgPSAyICoqIDMwIC8gKGNvbXBvbmVudHNDb3VudCAqIDQpOwogICAgaWYgKCF0aGlzLm5lZWRzVG9CZVJlc2l6ZWQod2lkdGgsIGhlaWdodCkpIHsKICAgICAgaWYgKGFyZWEgPiBtYXhKUFhBcmVhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguY2VpbChNYXRoLmxvZzIoYXJlYSAvIG1heEpQWEFyZWEpKTsKICAgICAgfQogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgTUFYX0RJTSwKICAgICAgTUFYX0FSRUEKICAgIH0gPSB0aGlzOwogICAgY29uc3QgbWluRmFjdG9yID0gTWF0aC5tYXgod2lkdGggLyBNQVhfRElNLCBoZWlnaHQgLyBNQVhfRElNLCBNYXRoLnNxcnQoYXJlYSAvIE1hdGgubWluKG1heEpQWEFyZWEsIE1BWF9BUkVBKSkpOwogICAgcmV0dXJuIE1hdGguY2VpbChNYXRoLmxvZzIobWluRmFjdG9yKSk7CiAgfQogIHN0YXRpYyBnZXQgTUFYX0RJTSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIk1BWF9ESU0iLCB0aGlzLl9ndWVzc01heChNSU5fSU1BR0VfRElNLCBNQVhfSU1BR0VfRElNLCAwLCAxKSk7CiAgfQogIHN0YXRpYyBnZXQgTUFYX0FSRUEoKSB7CiAgICB0aGlzLl9oYXNNYXhBcmVhID0gdHJ1ZTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIk1BWF9BUkVBIiwgdGhpcy5fZ3Vlc3NNYXgodGhpcy4jZ29vZFNxdWFyZUxlbmd0aCwgdGhpcy5NQVhfRElNLCBNQVhfRVJST1IsIDApICoqIDIpOwogIH0KICBzdGF0aWMgc2V0IE1BWF9BUkVBKGFyZWEpIHsKICAgIGlmIChhcmVhID49IDApIHsKICAgICAgdGhpcy5faGFzTWF4QXJlYSA9IHRydWU7CiAgICAgIHNoYWRvdyh0aGlzLCAiTUFYX0FSRUEiLCBhcmVhKTsKICAgIH0KICB9CiAgc3RhdGljIHNldE9wdGlvbnMoewogICAgY2FudmFzTWF4QXJlYUluQnl0ZXMgPSAtMSwKICAgIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID0gZmFsc2UKICB9KSB7CiAgICBpZiAoIXRoaXMuX2hhc01heEFyZWEpIHsKICAgICAgdGhpcy5NQVhfQVJFQSA9IGNhbnZhc01heEFyZWFJbkJ5dGVzID4+IDI7CiAgICB9CiAgICB0aGlzLiNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIH0KICBzdGF0aWMgX2FyZUdvb2REaW1zKHdpZHRoLCBoZWlnaHQpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICBjdHguZmlsbFJlY3QoMCwgMCwgMSwgMSk7CiAgICAgIGNvbnN0IG9wYWNpdHkgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIDEsIDEpLmRhdGFbM107CiAgICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhcy5oZWlnaHQgPSAxOwogICAgICByZXR1cm4gb3BhY2l0eSAhPT0gMDsKICAgIH0gY2F0Y2ggewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHN0YXRpYyBfZ3Vlc3NNYXgoc3RhcnQsIGVuZCwgdG9sZXJhbmNlLCBkZWZhdWx0SGVpZ2h0KSB7CiAgICB3aGlsZSAoc3RhcnQgKyB0b2xlcmFuY2UgKyAxIDwgZW5kKSB7CiAgICAgIGNvbnN0IG1pZGRsZSA9IE1hdGguZmxvb3IoKHN0YXJ0ICsgZW5kKSAvIDIpOwogICAgICBjb25zdCBoZWlnaHQgPSBkZWZhdWx0SGVpZ2h0IHx8IG1pZGRsZTsKICAgICAgaWYgKHRoaXMuX2FyZUdvb2REaW1zKG1pZGRsZSwgaGVpZ2h0KSkgewogICAgICAgIHN0YXJ0ID0gbWlkZGxlOwogICAgICB9IGVsc2UgewogICAgICAgIGVuZCA9IG1pZGRsZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHN0YXJ0OwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlSW1hZ2UoaW1nRGF0YSwgaXNNYXNrID0gZmFsc2UpIHsKICAgIHJldHVybiBuZXcgSW1hZ2VSZXNpemVyKGltZ0RhdGEsIGlzTWFzaykuX2NyZWF0ZUltYWdlKCk7CiAgfQogIGFzeW5jIF9jcmVhdGVJbWFnZSgpIHsKICAgIGNvbnN0IHsKICAgICAgX2ltZ0RhdGE6IGltZ0RhdGEKICAgIH0gPSB0aGlzOwogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gaW1nRGF0YTsKICAgIGlmICh3aWR0aCAqIGhlaWdodCAqIDQgPiBNQVhfSU5UXzMyKSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuI3Jlc2NhbGVJbWFnZURhdGEoKTsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9lbmNvZGVCTVAoKTsKICAgIGxldCBkZWNvZGVyLCBpbWFnZVByb21pc2U7CiAgICBpZiAoYXdhaXQgSW1hZ2VSZXNpemVyLmNhblVzZUltYWdlRGVjb2RlcikgewogICAgICBkZWNvZGVyID0gbmV3IEltYWdlRGVjb2Rlcih7CiAgICAgICAgZGF0YSwKICAgICAgICB0eXBlOiAiaW1hZ2UvYm1wIiwKICAgICAgICBwcmVmZXJBbmltYXRpb246IGZhbHNlLAogICAgICAgIHRyYW5zZmVyOiBbZGF0YS5idWZmZXJdCiAgICAgIH0pOwogICAgICBpbWFnZVByb21pc2UgPSBkZWNvZGVyLmRlY29kZSgpLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgICAgd2FybihgQk1QIGltYWdlIGRlY29kaW5nIGZhaWxlZDogJHtyZWFzb259YCk7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUltYWdlQml0bWFwKG5ldyBCbG9iKFt0aGlzLl9lbmNvZGVCTVAoKS5idWZmZXJdLCB7CiAgICAgICAgICB0eXBlOiAiaW1hZ2UvYm1wIgogICAgICAgIH0pKTsKICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgZGVjb2Rlci5jbG9zZSgpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGltYWdlUHJvbWlzZSA9IGNyZWF0ZUltYWdlQml0bWFwKG5ldyBCbG9iKFtkYXRhLmJ1ZmZlcl0sIHsKICAgICAgICB0eXBlOiAiaW1hZ2UvYm1wIgogICAgICB9KSk7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIE1BWF9BUkVBLAogICAgICBNQVhfRElNCiAgICB9ID0gSW1hZ2VSZXNpemVyOwogICAgY29uc3QgbWluRmFjdG9yID0gTWF0aC5tYXgod2lkdGggLyBNQVhfRElNLCBoZWlnaHQgLyBNQVhfRElNLCBNYXRoLnNxcnQod2lkdGggKiBoZWlnaHQgLyBNQVhfQVJFQSkpOwogICAgY29uc3QgZmlyc3RGYWN0b3IgPSBNYXRoLm1heChtaW5GYWN0b3IsIDIpOwogICAgY29uc3QgZmFjdG9yID0gTWF0aC5yb3VuZCgxMCAqIChtaW5GYWN0b3IgKyAxLjI1KSkgLyAxMCAvIGZpcnN0RmFjdG9yOwogICAgY29uc3QgTiA9IE1hdGguZmxvb3IoTWF0aC5sb2cyKGZhY3RvcikpOwogICAgY29uc3Qgc3RlcHMgPSBuZXcgQXJyYXkoTiArIDIpLmZpbGwoMik7CiAgICBzdGVwc1swXSA9IGZpcnN0RmFjdG9yOwogICAgc3RlcHMuc3BsaWNlKC0xLCAxLCBmYWN0b3IgLyAoMSA8PCBOKSk7CiAgICBsZXQgbmV3V2lkdGggPSB3aWR0aDsKICAgIGxldCBuZXdIZWlnaHQgPSBoZWlnaHQ7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbWFnZVByb21pc2U7CiAgICBsZXQgYml0bWFwID0gcmVzdWx0LmltYWdlIHx8IHJlc3VsdDsKICAgIGZvciAoY29uc3Qgc3RlcCBvZiBzdGVwcykgewogICAgICBjb25zdCBwcmV2V2lkdGggPSBuZXdXaWR0aDsKICAgICAgY29uc3QgcHJldkhlaWdodCA9IG5ld0hlaWdodDsKICAgICAgbmV3V2lkdGggPSBNYXRoLmZsb29yKG5ld1dpZHRoIC8gc3RlcCkgLSAxOwogICAgICBuZXdIZWlnaHQgPSBNYXRoLmZsb29yKG5ld0hlaWdodCAvIHN0ZXApIC0gMTsKICAgICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwLCBwcmV2V2lkdGgsIHByZXZIZWlnaHQsIDAsIDAsIG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICBiaXRtYXAuY2xvc2UoKTsKICAgICAgYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgfQogICAgaW1nRGF0YS5kYXRhID0gbnVsbDsKICAgIGltZ0RhdGEuYml0bWFwID0gYml0bWFwOwogICAgaW1nRGF0YS53aWR0aCA9IG5ld1dpZHRoOwogICAgaW1nRGF0YS5oZWlnaHQgPSBuZXdIZWlnaHQ7CiAgICByZXR1cm4gaW1nRGF0YTsKICB9CiAgI3Jlc2NhbGVJbWFnZURhdGEoKSB7CiAgICBjb25zdCB7CiAgICAgIF9pbWdEYXRhOiBpbWdEYXRhCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgZGF0YSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAga2luZAogICAgfSA9IGltZ0RhdGE7CiAgICBjb25zdCByZ2JhU2l6ZSA9IHdpZHRoICogaGVpZ2h0ICogNDsKICAgIGNvbnN0IEsgPSBNYXRoLmNlaWwoTWF0aC5sb2cyKHJnYmFTaXplIC8gTUFYX0lOVF8zMikpOwogICAgY29uc3QgbmV3V2lkdGggPSB3aWR0aCA+PiBLOwogICAgY29uc3QgbmV3SGVpZ2h0ID0gaGVpZ2h0ID4+IEs7CiAgICBsZXQgcmdiYURhdGE7CiAgICBsZXQgbWF4SGVpZ2h0ID0gaGVpZ2h0OwogICAgdHJ5IHsKICAgICAgcmdiYURhdGEgPSBuZXcgVWludDhBcnJheShyZ2JhU2l6ZSk7CiAgICB9IGNhdGNoIHsKICAgICAgbGV0IG4gPSBNYXRoLmZsb29yKE1hdGgubG9nMihyZ2JhU2l6ZSArIDEpKTsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmdiYURhdGEgPSBuZXcgVWludDhBcnJheSgyICoqIG4gLSAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgbiAtPSAxOwogICAgICAgIH0KICAgICAgfQogICAgICBtYXhIZWlnaHQgPSBNYXRoLmZsb29yKCgyICoqIG4gLSAxKSAvICh3aWR0aCAqIDQpKTsKICAgICAgY29uc3QgbmV3U2l6ZSA9IHdpZHRoICogbWF4SGVpZ2h0ICogNDsKICAgICAgaWYgKG5ld1NpemUgPCByZ2JhRGF0YS5sZW5ndGgpIHsKICAgICAgICByZ2JhRGF0YSA9IG5ldyBVaW50OEFycmF5KG5ld1NpemUpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzcmMzMiA9IG5ldyBVaW50MzJBcnJheShyZ2JhRGF0YS5idWZmZXIpOwogICAgY29uc3QgZGVzdDMyID0gbmV3IFVpbnQzMkFycmF5KG5ld1dpZHRoICogbmV3SGVpZ2h0KTsKICAgIGxldCBzcmNQb3MgPSAwOwogICAgbGV0IG5ld0luZGV4ID0gMDsKICAgIGNvbnN0IHN0ZXAgPSBNYXRoLmNlaWwoaGVpZ2h0IC8gbWF4SGVpZ2h0KTsKICAgIGNvbnN0IHJlbWFpbmRlciA9IGhlaWdodCAlIG1heEhlaWdodCA9PT0gMCA/IGhlaWdodCA6IGhlaWdodCAlIG1heEhlaWdodDsKICAgIGZvciAobGV0IGsgPSAwOyBrIDwgc3RlcDsgaysrKSB7CiAgICAgIGNvbnN0IGggPSBrIDwgc3RlcCAtIDEgPyBtYXhIZWlnaHQgOiByZW1haW5kZXI7CiAgICAgICh7CiAgICAgICAgc3JjUG9zCiAgICAgIH0gPSBjb252ZXJ0VG9SR0JBKHsKICAgICAgICBraW5kLAogICAgICAgIHNyYzogZGF0YSwKICAgICAgICBkZXN0OiBzcmMzMiwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQ6IGgsCiAgICAgICAgaW52ZXJzZURlY29kZTogdGhpcy5faXNNYXNrLAogICAgICAgIHNyY1BvcwogICAgICB9KSk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGggPj4gSzsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBidWYgPSBzcmMzMi5zdWJhcnJheSgoaSA8PCBLKSAqIHdpZHRoKTsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG5ld1dpZHRoOyBqKyspIHsKICAgICAgICAgIGRlc3QzMltuZXdJbmRleCsrXSA9IGJ1ZltqIDw8IEtdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKEltYWdlUmVzaXplci5uZWVkc1RvQmVSZXNpemVkKG5ld1dpZHRoLCBuZXdIZWlnaHQpKSB7CiAgICAgIGltZ0RhdGEuZGF0YSA9IGRlc3QzMjsKICAgICAgaW1nRGF0YS53aWR0aCA9IG5ld1dpZHRoOwogICAgICBpbWdEYXRhLmhlaWdodCA9IG5ld0hlaWdodDsKICAgICAgaW1nRGF0YS5raW5kID0gSW1hZ2VLaW5kLlJHQkFfMzJCUFA7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIsIHsKICAgICAgd2lsbFJlYWRGcmVxdWVudGx5OiB0cnVlCiAgICB9KTsKICAgIGN0eC5wdXRJbWFnZURhdGEobmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoZGVzdDMyLmJ1ZmZlciksIG5ld1dpZHRoLCBuZXdIZWlnaHQpLCAwLCAwKTsKICAgIGltZ0RhdGEuZGF0YSA9IG51bGw7CiAgICBpbWdEYXRhLmJpdG1hcCA9IGNhbnZhcy50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKTsKICAgIGltZ0RhdGEud2lkdGggPSBuZXdXaWR0aDsKICAgIGltZ0RhdGEuaGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgcmV0dXJuIGltZ0RhdGE7CiAgfQogIF9lbmNvZGVCTVAoKSB7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQsCiAgICAgIGtpbmQKICAgIH0gPSB0aGlzLl9pbWdEYXRhOwogICAgbGV0IGRhdGEgPSB0aGlzLl9pbWdEYXRhLmRhdGE7CiAgICBsZXQgYml0UGVyUGl4ZWw7CiAgICBsZXQgY29sb3JUYWJsZSA9IG5ldyBVaW50OEFycmF5KDApOwogICAgbGV0IG1hc2tUYWJsZSA9IGNvbG9yVGFibGU7CiAgICBsZXQgY29tcHJlc3Npb24gPSAwOwogICAgc3dpdGNoIChraW5kKSB7CiAgICAgIGNhc2UgSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQOgogICAgICAgIHsKICAgICAgICAgIGJpdFBlclBpeGVsID0gMTsKICAgICAgICAgIGNvbG9yVGFibGUgPSBuZXcgVWludDhBcnJheSh0aGlzLl9pc01hc2sgPyBbMjU1LCAyNTUsIDI1NSwgMjU1LCAwLCAwLCAwLCAwXSA6IFswLCAwLCAwLCAwLCAyNTUsIDI1NSwgMjU1LCAyNTVdKTsKICAgICAgICAgIGNvbnN0IHJvd0xlbiA9IHdpZHRoICsgNyA+PiAzOwogICAgICAgICAgY29uc3Qgcm93U2l6ZSA9IHJvd0xlbiArIDMgJiAtNDsKICAgICAgICAgIGlmIChyb3dMZW4gIT09IHJvd1NpemUpIHsKICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IG5ldyBVaW50OEFycmF5KHJvd1NpemUgKiBoZWlnaHQpOwogICAgICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGhlaWdodCAqIHJvd0xlbjsgaSA8IGlpOyBpICs9IHJvd0xlbiwgayArPSByb3dTaXplKSB7CiAgICAgICAgICAgICAgbmV3RGF0YS5zZXQoZGF0YS5zdWJhcnJheShpLCBpICsgcm93TGVuKSwgayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YSA9IG5ld0RhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgSW1hZ2VLaW5kLlJHQl8yNEJQUDoKICAgICAgICB7CiAgICAgICAgICBiaXRQZXJQaXhlbCA9IDI0OwogICAgICAgICAgaWYgKHdpZHRoICYgMykgewogICAgICAgICAgICBjb25zdCByb3dMZW4gPSAzICogd2lkdGg7CiAgICAgICAgICAgIGNvbnN0IHJvd1NpemUgPSByb3dMZW4gKyAzICYgLTQ7CiAgICAgICAgICAgIGNvbnN0IGV4dHJhTGVuID0gcm93U2l6ZSAtIHJvd0xlbjsKICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IG5ldyBVaW50OEFycmF5KHJvd1NpemUgKiBoZWlnaHQpOwogICAgICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGhlaWdodCAqIHJvd0xlbjsgaSA8IGlpOyBpICs9IHJvd0xlbikgewogICAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRhdGEuc3ViYXJyYXkoaSwgaSArIHJvd0xlbik7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCByb3dMZW47IGogKz0gMykgewogICAgICAgICAgICAgICAgbmV3RGF0YVtrKytdID0gcm93W2ogKyAyXTsKICAgICAgICAgICAgICAgIG5ld0RhdGFbaysrXSA9IHJvd1tqICsgMV07CiAgICAgICAgICAgICAgICBuZXdEYXRhW2srK10gPSByb3dbal07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGsgKz0gZXh0cmFMZW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YSA9IG5ld0RhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyBpICs9IDMpIHsKICAgICAgICAgICAgICBjb25zdCB0bXAgPSBkYXRhW2ldOwogICAgICAgICAgICAgIGRhdGFbaV0gPSBkYXRhW2kgKyAyXTsKICAgICAgICAgICAgICBkYXRhW2kgKyAyXSA9IHRtcDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIEltYWdlS2luZC5SR0JBXzMyQlBQOgogICAgICAgIGJpdFBlclBpeGVsID0gMzI7CiAgICAgICAgY29tcHJlc3Npb24gPSAzOwogICAgICAgIG1hc2tUYWJsZSA9IG5ldyBVaW50OEFycmF5KDQgKyA0ICsgNCArIDQgKyA1Mik7CiAgICAgICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhtYXNrVGFibGUuYnVmZmVyKTsKICAgICAgICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDAsIDB4MDAwMDAwZmYsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoNCwgMHgwMDAwZmYwMCwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMig4LCAweDAwZmYwMDAwLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDEyLCAweGZmMDAwMDAwLCB0cnVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmlldy5zZXRVaW50MzIoMCwgMHhmZjAwMDAwMCwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMig0LCAweDAwZmYwMDAwLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDgsIDB4MDAwMGZmMDAsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoMTIsIDB4MDAwMDAwZmYsIHRydWUpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgZm9ybWF0Iik7CiAgICB9CiAgICBsZXQgaSA9IDA7CiAgICBjb25zdCBoZWFkZXJMZW5ndGggPSA0MCArIG1hc2tUYWJsZS5sZW5ndGg7CiAgICBjb25zdCBmaWxlTGVuZ3RoID0gMTQgKyBoZWFkZXJMZW5ndGggKyBjb2xvclRhYmxlLmxlbmd0aCArIGRhdGEubGVuZ3RoOwogICAgY29uc3QgYm1wRGF0YSA9IG5ldyBVaW50OEFycmF5KGZpbGVMZW5ndGgpOwogICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhibXBEYXRhLmJ1ZmZlcik7CiAgICB2aWV3LnNldFVpbnQxNihpLCAweDRkNDIsIHRydWUpOwogICAgaSArPSAyOwogICAgdmlldy5zZXRVaW50MzIoaSwgZmlsZUxlbmd0aCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIDE0ICsgaGVhZGVyTGVuZ3RoICsgY29sb3JUYWJsZS5sZW5ndGgsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgaGVhZGVyTGVuZ3RoLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0SW50MzIoaSwgd2lkdGgsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRJbnQzMihpLCAtaGVpZ2h0LCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDE2KGksIDEsIHRydWUpOwogICAgaSArPSAyOwogICAgdmlldy5zZXRVaW50MTYoaSwgYml0UGVyUGl4ZWwsIHRydWUpOwogICAgaSArPSAyOwogICAgdmlldy5zZXRVaW50MzIoaSwgY29tcHJlc3Npb24sIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgMCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldEludDMyKGksIDAsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRJbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIGNvbG9yVGFibGUubGVuZ3RoIC8gNCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIGJtcERhdGEuc2V0KG1hc2tUYWJsZSwgaSk7CiAgICBpICs9IG1hc2tUYWJsZS5sZW5ndGg7CiAgICBibXBEYXRhLnNldChjb2xvclRhYmxlLCBpKTsKICAgIGkgKz0gY29sb3JUYWJsZS5sZW5ndGg7CiAgICBibXBEYXRhLnNldChkYXRhLCBpKTsKICAgIHJldHVybiBibXBEYXRhOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZGVjb2RlX3N0cmVhbS5qcwoKCmNvbnN0IGVtcHR5QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMCk7CmNsYXNzIERlY29kZVN0cmVhbSBleHRlbmRzIEJhc2VTdHJlYW0gewogIGNvbnN0cnVjdG9yKG1heWJlTWluQnVmZmVyTGVuZ3RoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fcmF3TWluQnVmZmVyTGVuZ3RoID0gbWF5YmVNaW5CdWZmZXJMZW5ndGggfHwgMDsKICAgIHRoaXMucG9zID0gMDsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gMDsKICAgIHRoaXMuZW9mID0gZmFsc2U7CiAgICB0aGlzLmJ1ZmZlciA9IGVtcHR5QnVmZmVyOwogICAgdGhpcy5taW5CdWZmZXJMZW5ndGggPSA1MTI7CiAgICBpZiAobWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgICAgd2hpbGUgKHRoaXMubWluQnVmZmVyTGVuZ3RoIDwgbWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgICAgICB0aGlzLm1pbkJ1ZmZlckxlbmd0aCAqPSAyOwogICAgICB9CiAgICB9CiAgfQogIGdldCBpc0VtcHR5KCkgewogICAgd2hpbGUgKCF0aGlzLmVvZiAmJiB0aGlzLmJ1ZmZlckxlbmd0aCA9PT0gMCkgewogICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnVmZmVyTGVuZ3RoID09PSAwOwogIH0KICBlbnN1cmVCdWZmZXIocmVxdWVzdGVkKSB7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGlmIChyZXF1ZXN0ZWQgPD0gYnVmZmVyLmJ5dGVMZW5ndGgpIHsKICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgIH0KICAgIGxldCBzaXplID0gdGhpcy5taW5CdWZmZXJMZW5ndGg7CiAgICB3aGlsZSAoc2l6ZSA8IHJlcXVlc3RlZCkgewogICAgICBzaXplICo9IDI7CiAgICB9CiAgICBjb25zdCBidWZmZXIyID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7CiAgICBidWZmZXIyLnNldChidWZmZXIpOwogICAgcmV0dXJuIHRoaXMuYnVmZmVyID0gYnVmZmVyMjsKICB9CiAgZ2V0Qnl0ZSgpIHsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgd2hpbGUgKHRoaXMuYnVmZmVyTGVuZ3RoIDw9IHBvcykgewogICAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1ZmZlclt0aGlzLnBvcysrXTsKICB9CiAgZ2V0Qnl0ZXMobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucyA9IG51bGwpIHsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgbGV0IGVuZDsKICAgIGlmIChsZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVCdWZmZXIocG9zICsgbGVuZ3RoKTsKICAgICAgZW5kID0gcG9zICsgbGVuZ3RoOwogICAgICB3aGlsZSAoIXRoaXMuZW9mICYmIHRoaXMuYnVmZmVyTGVuZ3RoIDwgZW5kKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soZGVjb2Rlck9wdGlvbnMpOwogICAgICB9CiAgICAgIGNvbnN0IGJ1ZkVuZCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgICBpZiAoZW5kID4gYnVmRW5kKSB7CiAgICAgICAgZW5kID0gYnVmRW5kOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soZGVjb2Rlck9wdGlvbnMpOwogICAgICB9CiAgICAgIGVuZCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgfQogICAgdGhpcy5wb3MgPSBlbmQ7CiAgICByZXR1cm4gdGhpcy5idWZmZXIuc3ViYXJyYXkocG9zLCBlbmQpOwogIH0KICBhc3luYyBnZXRJbWFnZURhdGEobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucykgewogICAgaWYgKCF0aGlzLmNhbkFzeW5jRGVjb2RlSW1hZ2VGcm9tQnVmZmVyKSB7CiAgICAgIGlmICh0aGlzLmlzQXN5bmNEZWNvZGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlSW1hZ2UobnVsbCwgZGVjb2Rlck9wdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmdldEJ5dGVzKGxlbmd0aCwgZGVjb2Rlck9wdGlvbnMpOwogICAgfQogICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuc3RyZWFtLmFzeW5jR2V0Qnl0ZXMoKTsKICAgIHJldHVybiB0aGlzLmRlY29kZUltYWdlKGRhdGEsIGRlY29kZXJPcHRpb25zKTsKICB9CiAgcmVzZXQoKSB7CiAgICB0aGlzLnBvcyA9IDA7CiAgfQogIG1ha2VTdWJTdHJlYW0oc3RhcnQsIGxlbmd0aCwgZGljdCA9IG51bGwpIHsKICAgIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZW5kID0gc3RhcnQgKyBsZW5ndGg7CiAgICAgIHdoaWxlICh0aGlzLmJ1ZmZlckxlbmd0aCA8PSBlbmQgJiYgIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5ldyBTdHJlYW0odGhpcy5idWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpOwogIH0KICBnZXRCYXNlU3RyZWFtcygpIHsKICAgIHJldHVybiB0aGlzLnN0ciA/IHRoaXMuc3RyLmdldEJhc2VTdHJlYW1zKCkgOiBudWxsOwogIH0KfQpjbGFzcyBTdHJlYW1zU2VxdWVuY2VTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0cmVhbXMsIG9uRXJyb3IgPSBudWxsKSB7CiAgICBzdHJlYW1zID0gc3RyZWFtcy5maWx0ZXIocyA9PiBzIGluc3RhbmNlb2YgQmFzZVN0cmVhbSk7CiAgICBsZXQgbWF5YmVMZW5ndGggPSAwOwogICAgZm9yIChjb25zdCBzdHJlYW0gb2Ygc3RyZWFtcykgewogICAgICBtYXliZUxlbmd0aCArPSBzdHJlYW0gaW5zdGFuY2VvZiBEZWNvZGVTdHJlYW0gPyBzdHJlYW0uX3Jhd01pbkJ1ZmZlckxlbmd0aCA6IHN0cmVhbS5sZW5ndGg7CiAgICB9CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgdGhpcy5fb25FcnJvciA9IG9uRXJyb3I7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLnN0cmVhbXM7CiAgICBpZiAoc3RyZWFtcy5sZW5ndGggPT09IDApIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzdHJlYW0gPSBzdHJlYW1zLnNoaWZ0KCk7CiAgICBsZXQgY2h1bms7CiAgICB0cnkgewogICAgICBjaHVuayA9IHN0cmVhbS5nZXRCeXRlcygpOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIGlmICh0aGlzLl9vbkVycm9yKSB7CiAgICAgICAgdGhpcy5fb25FcnJvcihyZWFzb24sIHN0cmVhbS5kaWN0Py5vYmpJZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgY29uc3QgbmV3TGVuZ3RoID0gYnVmZmVyTGVuZ3RoICsgY2h1bmsubGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIobmV3TGVuZ3RoKTsKICAgIGJ1ZmZlci5zZXQoY2h1bmssIGJ1ZmZlckxlbmd0aCk7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IG5ld0xlbmd0aDsKICB9CiAgZ2V0QmFzZVN0cmVhbXMoKSB7CiAgICBjb25zdCBiYXNlU3RyZWFtc0J1ZiA9IFtdOwogICAgZm9yIChjb25zdCBzdHJlYW0gb2YgdGhpcy5zdHJlYW1zKSB7CiAgICAgIGNvbnN0IGJhc2VTdHJlYW1zID0gc3RyZWFtLmdldEJhc2VTdHJlYW1zKCk7CiAgICAgIGlmIChiYXNlU3RyZWFtcykgewogICAgICAgIGJhc2VTdHJlYW1zQnVmLnB1c2goLi4uYmFzZVN0cmVhbXMpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYmFzZVN0cmVhbXNCdWYubGVuZ3RoID4gMCA/IGJhc2VTdHJlYW1zQnVmIDogbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NvbG9yc3BhY2VfdXRpbHMuanMKCgoKCgpjbGFzcyBDb2xvclNwYWNlVXRpbHMgewogIHN0YXRpYyBwYXJzZSh7CiAgICBjcywKICAgIHhyZWYsCiAgICByZXNvdXJjZXMgPSBudWxsLAogICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBhc3luY0lmTm90Q2FjaGVkID0gZmFsc2UKICB9KSB7CiAgICBjb25zdCBvcHRpb25zID0gewogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgfTsKICAgIGxldCBjc05hbWUsIGNzUmVmLCBwYXJzZWRDUzsKICAgIGlmIChjcyBpbnN0YW5jZW9mIFJlZikgewogICAgICBjc1JlZiA9IGNzOwogICAgICBjb25zdCBjYWNoZWRDUyA9IGdsb2JhbENvbG9yU3BhY2VDYWNoZS5nZXRCeVJlZihjc1JlZikgfHwgbG9jYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NSZWYpOwogICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgIH0KICAgICAgY3MgPSB4cmVmLmZldGNoKGNzKTsKICAgIH0KICAgIGlmIChjcyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgY3NOYW1lID0gY3MubmFtZTsKICAgICAgY29uc3QgY2FjaGVkQ1MgPSBsb2NhbENvbG9yU3BhY2VDYWNoZS5nZXRCeU5hbWUoY3NOYW1lKTsKICAgICAgaWYgKGNhY2hlZENTKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlZENTOwogICAgICB9CiAgICB9CiAgICB0cnkgewogICAgICBwYXJzZWRDUyA9IHRoaXMuI3BhcnNlKGNzLCBvcHRpb25zKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChhc3luY0lmTm90Q2FjaGVkICYmICEoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXgpOwogICAgICB9CiAgICAgIHRocm93IGV4OwogICAgfQogICAgaWYgKGNzTmFtZSB8fCBjc1JlZikgewogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZS5zZXQoY3NOYW1lLCBjc1JlZiwgcGFyc2VkQ1MpOwogICAgICBpZiAoY3NSZWYpIHsKICAgICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuc2V0KG51bGwsIGNzUmVmLCBwYXJzZWRDUyk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhc3luY0lmTm90Q2FjaGVkID8gUHJvbWlzZS5yZXNvbHZlKHBhcnNlZENTKSA6IHBhcnNlZENTOwogIH0KICBzdGF0aWMgI3N1YlBhcnNlKGNzLCBvcHRpb25zKSB7CiAgICBjb25zdCB7CiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZQogICAgfSA9IG9wdGlvbnM7CiAgICBsZXQgY3NSZWY7CiAgICBpZiAoY3MgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgY3NSZWYgPSBjczsKICAgICAgY29uc3QgY2FjaGVkQ1MgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NSZWYpOwogICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHBhcnNlZENTID0gdGhpcy4jcGFyc2UoY3MsIG9wdGlvbnMpOwogICAgaWYgKGNzUmVmKSB7CiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZS5zZXQobnVsbCwgY3NSZWYsIHBhcnNlZENTKTsKICAgIH0KICAgIHJldHVybiBwYXJzZWRDUzsKICB9CiAgc3RhdGljICNwYXJzZShjcywgb3B0aW9ucykgewogICAgY29uc3QgewogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlCiAgICB9ID0gb3B0aW9uczsKICAgIGNzID0geHJlZi5mZXRjaElmUmVmKGNzKTsKICAgIGlmIChjcyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgc3dpdGNoIChjcy5uYW1lKSB7CiAgICAgICAgY2FzZSAiRyI6CiAgICAgICAgY2FzZSAiRGV2aWNlR3JheSI6CiAgICAgICAgICByZXR1cm4gdGhpcy5ncmF5OwogICAgICAgIGNhc2UgIlJHQiI6CiAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgIHJldHVybiB0aGlzLnJnYjsKICAgICAgICBjYXNlICJEZXZpY2VSR0JBIjoKICAgICAgICAgIHJldHVybiB0aGlzLnJnYmE7CiAgICAgICAgY2FzZSAiQ01ZSyI6CiAgICAgICAgY2FzZSAiRGV2aWNlQ01ZSyI6CiAgICAgICAgICByZXR1cm4gdGhpcy5jbXlrOwogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgcmV0dXJuIG5ldyBQYXR0ZXJuQ1MobnVsbCk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yU3BhY2VzID0gcmVzb3VyY2VzLmdldCgiQ29sb3JTcGFjZSIpOwogICAgICAgICAgICBpZiAoY29sb3JTcGFjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgICAgY29uc3QgcmVzb3VyY2VzQ1MgPSBjb2xvclNwYWNlcy5nZXQoY3MubmFtZSk7CiAgICAgICAgICAgICAgaWYgKHJlc291cmNlc0NTKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VzQ1MgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNwYXJzZShyZXNvdXJjZXNDUywgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjcyA9IHJlc291cmNlc0NTOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB3YXJuKGBVbnJlY29nbml6ZWQgQ29sb3JTcGFjZTogJHtjcy5uYW1lfWApOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ3JheTsKICAgICAgfQogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkoY3MpKSB7CiAgICAgIGNvbnN0IG1vZGUgPSB4cmVmLmZldGNoSWZSZWYoY3NbMF0pLm5hbWU7CiAgICAgIGxldCBwYXJhbXMsIG51bUNvbXBzLCBiYXNlQ1MsIHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hOwogICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICBjYXNlICJHIjoKICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgIHJldHVybiB0aGlzLmdyYXk7CiAgICAgICAgY2FzZSAiUkdCIjoKICAgICAgICBjYXNlICJEZXZpY2VSR0IiOgogICAgICAgICAgcmV0dXJuIHRoaXMucmdiOwogICAgICAgIGNhc2UgIkNNWUsiOgogICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgcmV0dXJuIHRoaXMuY215azsKICAgICAgICBjYXNlICJDYWxHcmF5IjoKICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICBnYW1tYSA9IHBhcmFtcy5nZXQoIkdhbW1hIik7CiAgICAgICAgICByZXR1cm4gbmV3IENhbEdyYXlDUyh3aGl0ZVBvaW50LCBibGFja1BvaW50LCBnYW1tYSk7CiAgICAgICAgY2FzZSAiQ2FsUkdCIjoKICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICBnYW1tYSA9IHBhcmFtcy5nZXRBcnJheSgiR2FtbWEiKTsKICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IHBhcmFtcy5nZXRBcnJheSgiTWF0cml4Iik7CiAgICAgICAgICByZXR1cm4gbmV3IENhbFJHQkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hLCBtYXRyaXgpOwogICAgICAgIGNhc2UgIklDQ0Jhc2VkIjoKICAgICAgICAgIGNvbnN0IGlzUmVmID0gY3NbMV0gaW5zdGFuY2VvZiBSZWY7CiAgICAgICAgICBpZiAoaXNSZWYpIHsKICAgICAgICAgICAgY29uc3QgY2FjaGVkQ1MgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NbMV0pOwogICAgICAgICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0cmVhbSA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICBjb25zdCBkaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICAgICAgICBudW1Db21wcyA9IGRpY3QuZ2V0KCJOIik7CiAgICAgICAgICBpZiAoSWNjQ29sb3JTcGFjZS5pc1VzYWJsZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGNvbnN0IGljY0NTID0gbmV3IEljY0NvbG9yU3BhY2Uoc3RyZWFtLmdldEJ5dGVzKCksICJJQ0NCYXNlZCIsIG51bUNvbXBzKTsKICAgICAgICAgICAgICBpZiAoaXNSZWYpIHsKICAgICAgICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZS5zZXQobnVsbCwgY3NbMV0sIGljY0NTKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGljY0NTOwogICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgd2FybihgSUNDQmFzZWQgY29sb3Igc3BhY2UgKCR7Y3NbMV19KTogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc3QgYWx0UmF3ID0gZGljdC5nZXRSYXcoIkFsdGVybmF0ZSIpOwogICAgICAgICAgaWYgKGFsdFJhdykgewogICAgICAgICAgICBjb25zdCBhbHRDUyA9IHRoaXMuI3N1YlBhcnNlKGFsdFJhdywgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChhbHRDUy5udW1Db21wcyA9PT0gbnVtQ29tcHMpIHsKICAgICAgICAgICAgICByZXR1cm4gYWx0Q1M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2FybigiSUNDQmFzZWQgY29sb3Igc3BhY2U6IElnbm9yaW5nIGluY29ycmVjdCAvQWx0ZXJuYXRlIGVudHJ5LiIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG51bUNvbXBzID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdyYXk7CiAgICAgICAgICB9IGVsc2UgaWYgKG51bUNvbXBzID09PSAzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJnYjsKICAgICAgICAgIH0gZWxzZSBpZiAobnVtQ29tcHMgPT09IDQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY215azsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgYmFzZUNTID0gY3NbMV0gfHwgbnVsbDsKICAgICAgICAgIGlmIChiYXNlQ1MpIHsKICAgICAgICAgICAgYmFzZUNTID0gdGhpcy4jc3ViUGFyc2UoYmFzZUNTLCBvcHRpb25zKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgUGF0dGVybkNTKGJhc2VDUyk7CiAgICAgICAgY2FzZSAiSSI6CiAgICAgICAgY2FzZSAiSW5kZXhlZCI6CiAgICAgICAgICBiYXNlQ1MgPSB0aGlzLiNzdWJQYXJzZShjc1sxXSwgb3B0aW9ucyk7CiAgICAgICAgICBjb25zdCBoaVZhbCA9IE1hdGhDbGFtcCh4cmVmLmZldGNoSWZSZWYoY3NbMl0pLCAwLCAyNTUpOwogICAgICAgICAgY29uc3QgbG9va3VwID0geHJlZi5mZXRjaElmUmVmKGNzWzNdKTsKICAgICAgICAgIHJldHVybiBuZXcgSW5kZXhlZENTKGJhc2VDUywgaGlWYWwsIGxvb2t1cCk7CiAgICAgICAgY2FzZSAiU2VwYXJhdGlvbiI6CiAgICAgICAgY2FzZSAiRGV2aWNlTiI6CiAgICAgICAgICBjb25zdCBuYW1lID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIG51bUNvbXBzID0gQXJyYXkuaXNBcnJheShuYW1lKSA/IG5hbWUubGVuZ3RoIDogMTsKICAgICAgICAgIGJhc2VDUyA9IHRoaXMuI3N1YlBhcnNlKGNzWzJdLCBvcHRpb25zKTsKICAgICAgICAgIGNvbnN0IHRpbnRGbiA9IHBkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUoY3NbM10pOwogICAgICAgICAgcmV0dXJuIG5ldyBBbHRlcm5hdGVDUyhudW1Db21wcywgYmFzZUNTLCB0aW50Rm4pOwogICAgICAgIGNhc2UgIkxhYiI6CiAgICAgICAgICBwYXJhbXMgPSB4cmVmLmZldGNoSWZSZWYoY3NbMV0pOwogICAgICAgICAgd2hpdGVQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiV2hpdGVQb2ludCIpOwogICAgICAgICAgYmxhY2tQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiQmxhY2tQb2ludCIpOwogICAgICAgICAgY29uc3QgcmFuZ2UgPSBwYXJhbXMuZ2V0QXJyYXkoIlJhbmdlIik7CiAgICAgICAgICByZXR1cm4gbmV3IExhYkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIHJhbmdlKTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgd2FybihgVW5pbXBsZW1lbnRlZCBDb2xvclNwYWNlIG9iamVjdDogJHttb2RlfWApOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ3JheTsKICAgICAgfQogICAgfQogICAgd2FybihgVW5yZWNvZ25pemVkIENvbG9yU3BhY2Ugb2JqZWN0OiAke2NzfWApOwogICAgcmV0dXJuIHRoaXMuZ3JheTsKICB9CiAgc3RhdGljIGdldCBncmF5KCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZ3JheSIsIG5ldyBEZXZpY2VHcmF5Q1MoKSk7CiAgfQogIHN0YXRpYyBnZXQgcmdiKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicmdiIiwgbmV3IERldmljZVJnYkNTKCkpOwogIH0KICBzdGF0aWMgZ2V0IHJnYmEoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJyZ2JhIiwgbmV3IERldmljZVJnYmFDUygpKTsKICB9CiAgc3RhdGljIGdldCBjbXlrKCkgewogICAgaWYgKENteWtJQ0NCYXNlZENTLmlzVXNhYmxlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY215ayIsIG5ldyBDbXlrSUNDQmFzZWRDUygpKTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgd2FybigiQ01ZSyBmYWxsYmFjazogRGV2aWNlQ01ZSyIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjbXlrIiwgbmV3IERldmljZUNteWtDUygpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2pwZy5qcwoKCgoKCmNsYXNzIEpwZWdFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSnBlZ0Vycm9yIik7CiAgfQp9CmNsYXNzIEROTE1hcmtlckVycm9yIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobWVzc2FnZSwgc2NhbkxpbmVzKSB7CiAgICBzdXBlcihtZXNzYWdlLCAiRE5MTWFya2VyRXJyb3IiKTsKICAgIHRoaXMuc2NhbkxpbmVzID0gc2NhbkxpbmVzOwogIH0KfQpjbGFzcyBFT0lNYXJrZXJFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiRU9JTWFya2VyRXJyb3IiKTsKICB9Cn0KY29uc3QgZGN0WmlnWmFnID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDEsIDgsIDE2LCA5LCAyLCAzLCAxMCwgMTcsIDI0LCAzMiwgMjUsIDE4LCAxMSwgNCwgNSwgMTIsIDE5LCAyNiwgMzMsIDQwLCA0OCwgNDEsIDM0LCAyNywgMjAsIDEzLCA2LCA3LCAxNCwgMjEsIDI4LCAzNSwgNDIsIDQ5LCA1NiwgNTcsIDUwLCA0MywgMzYsIDI5LCAyMiwgMTUsIDIzLCAzMCwgMzcsIDQ0LCA1MSwgNTgsIDU5LCA1MiwgNDUsIDM4LCAzMSwgMzksIDQ2LCA1MywgNjAsIDYxLCA1NCwgNDcsIDU1LCA2MiwgNjNdKTsKY29uc3QgZGN0Q29zMSA9IDQwMTc7CmNvbnN0IGRjdFNpbjEgPSA3OTk7CmNvbnN0IGRjdENvczMgPSAzNDA2Owpjb25zdCBkY3RTaW4zID0gMjI3NjsKY29uc3QgZGN0Q29zNiA9IDE1Njc7CmNvbnN0IGRjdFNpbjYgPSAzNzg0Owpjb25zdCBkY3RTcXJ0MiA9IDU3OTM7CmNvbnN0IGRjdFNxcnQxZDIgPSAyODk2OwpmdW5jdGlvbiBidWlsZEh1ZmZtYW5UYWJsZShjb2RlTGVuZ3RocywgdmFsdWVzKSB7CiAgbGV0IGsgPSAwLAogICAgaSwKICAgIGosCiAgICBsZW5ndGggPSAxNjsKICB3aGlsZSAobGVuZ3RoID4gMCAmJiAhY29kZUxlbmd0aHNbbGVuZ3RoIC0gMV0pIHsKICAgIGxlbmd0aC0tOwogIH0KICBjb25zdCBjb2RlID0gW3sKICAgIGNoaWxkcmVuOiBbXSwKICAgIGluZGV4OiAwCiAgfV07CiAgbGV0IHAgPSBjb2RlWzBdLAogICAgcTsKICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGZvciAoaiA9IDA7IGogPCBjb2RlTGVuZ3Roc1tpXTsgaisrKSB7CiAgICAgIHAgPSBjb2RlLnBvcCgpOwogICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gdmFsdWVzW2tdOwogICAgICB3aGlsZSAocC5pbmRleCA+IDApIHsKICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgfQogICAgICBwLmluZGV4Kys7CiAgICAgIGNvZGUucHVzaChwKTsKICAgICAgd2hpbGUgKGNvZGUubGVuZ3RoIDw9IGkpIHsKICAgICAgICBjb2RlLnB1c2gocSA9IHsKICAgICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICAgIGluZGV4OiAwCiAgICAgICAgfSk7CiAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgcCA9IHE7CiAgICAgIH0KICAgICAgaysrOwogICAgfQogICAgaWYgKGkgKyAxIDwgbGVuZ3RoKSB7CiAgICAgIGNvZGUucHVzaChxID0gewogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBpbmRleDogMAogICAgICB9KTsKICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgIHAgPSBxOwogICAgfQogIH0KICByZXR1cm4gY29kZVswXS5jaGlsZHJlbjsKfQpmdW5jdGlvbiBnZXRCbG9ja0J1ZmZlck9mZnNldChjb21wb25lbnQsIHJvdywgY29sKSB7CiAgcmV0dXJuIDY0ICogKChjb21wb25lbnQuYmxvY2tzUGVyTGluZSArIDEpICogcm93ICsgY29sKTsKfQpmdW5jdGlvbiBkZWNvZGVTY2FuKGRhdGEsIG9mZnNldCwgZnJhbWUsIGNvbXBvbmVudHMsIHJlc2V0SW50ZXJ2YWwsIHNwZWN0cmFsU3RhcnQsIHNwZWN0cmFsRW5kLCBzdWNjZXNzaXZlUHJldiwgc3VjY2Vzc2l2ZSwgcGFyc2VETkxNYXJrZXIgPSBmYWxzZSkgewogIGNvbnN0IG1jdXNQZXJMaW5lID0gZnJhbWUubWN1c1BlckxpbmU7CiAgY29uc3QgcHJvZ3Jlc3NpdmUgPSBmcmFtZS5wcm9ncmVzc2l2ZTsKICBjb25zdCBzdGFydE9mZnNldCA9IG9mZnNldDsKICBsZXQgYml0c0RhdGEgPSAwLAogICAgYml0c0NvdW50ID0gMDsKICBmdW5jdGlvbiByZWFkQml0KCkgewogICAgaWYgKGJpdHNDb3VudCA+IDApIHsKICAgICAgYml0c0NvdW50LS07CiAgICAgIHJldHVybiBiaXRzRGF0YSA+PiBiaXRzQ291bnQgJiAxOwogICAgfQogICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKICAgIGlmIChiaXRzRGF0YSA9PT0gMHhmZikgewogICAgICBjb25zdCBuZXh0Qnl0ZSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICBpZiAobmV4dEJ5dGUgPT09IDB4ZGMgJiYgcGFyc2VETkxNYXJrZXIpIHsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29uc3Qgc2NhbkxpbmVzID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBpZiAoc2NhbkxpbmVzID4gMCAmJiBzY2FuTGluZXMgIT09IGZyYW1lLnNjYW5MaW5lcykgewogICAgICAgICAgICB0aHJvdyBuZXcgRE5MTWFya2VyRXJyb3IoIkZvdW5kIEROTCBtYXJrZXIgKDB4RkZEQykgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiLCBzY2FuTGluZXMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAobmV4dEJ5dGUgPT09IDB4ZDkpIHsKICAgICAgICAgIGlmIChwYXJzZUROTE1hcmtlcikgewogICAgICAgICAgICBjb25zdCBtYXliZVNjYW5MaW5lcyA9IGJsb2NrUm93ICogKGZyYW1lLnByZWNpc2lvbiA9PT0gOCA/IDggOiAwKTsKICAgICAgICAgICAgaWYgKG1heWJlU2NhbkxpbmVzID4gMCAmJiBNYXRoLnJvdW5kKGZyYW1lLnNjYW5MaW5lcyAvIG1heWJlU2NhbkxpbmVzKSA+PSA1KSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEROTE1hcmtlckVycm9yKCJGb3VuZCBFT0kgbWFya2VyICgweEZGRDkpIHdoaWxlIHBhcnNpbmcgc2NhbiBkYXRhLCAiICsgInBvc3NpYmx5IGNhdXNlZCBieSBpbmNvcnJlY3QgYHNjYW5MaW5lc2AgcGFyYW1ldGVyIiwgbWF5YmVTY2FuTGluZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRU9JTWFya2VyRXJyb3IoIkZvdW5kIEVPSSBtYXJrZXIgKDB4RkZEOSkgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcihgdW5leHBlY3RlZCBtYXJrZXIgJHsoYml0c0RhdGEgPDwgOCB8IG5leHRCeXRlKS50b1N0cmluZygxNil9YCk7CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDc7CiAgICByZXR1cm4gYml0c0RhdGEgPj4+IDc7CiAgfQogIGZ1bmN0aW9uIGRlY29kZUh1ZmZtYW4odHJlZSkgewogICAgbGV0IG5vZGUgPSB0cmVlOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbm9kZSA9IG5vZGVbcmVhZEJpdCgpXTsKICAgICAgc3dpdGNoICh0eXBlb2Ygbm9kZSkgewogICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBodWZmbWFuIHNlcXVlbmNlIik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHJlY2VpdmUobGVuZ3RoKSB7CiAgICBsZXQgbiA9IDA7CiAgICB3aGlsZSAobGVuZ3RoID4gMCkgewogICAgICBuID0gbiA8PCAxIHwgcmVhZEJpdCgpOwogICAgICBsZW5ndGgtLTsKICAgIH0KICAgIHJldHVybiBuOwogIH0KICBmdW5jdGlvbiByZWNlaXZlQW5kRXh0ZW5kKGxlbmd0aCkgewogICAgaWYgKGxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm4gcmVhZEJpdCgpID09PSAxID8gMSA6IC0xOwogICAgfQogICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgIGlmIChuID49IDEgPDwgbGVuZ3RoIC0gMSkgewogICAgICByZXR1cm4gbjsKICAgIH0KICAgIHJldHVybiBuICsgKC0xIDw8IGxlbmd0aCkgKyAxOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCYXNlbGluZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb25zdCB0ID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlREMpOwogICAgY29uc3QgZGlmZiA9IHQgPT09IDAgPyAwIDogcmVjZWl2ZUFuZEV4dGVuZCh0KTsKICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbYmxvY2tPZmZzZXRdID0gY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgIGxldCBrID0gMTsKICAgIHdoaWxlIChrIDwgNjQpIHsKICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgIGNvbnN0IHMgPSBycyAmIDE1LAogICAgICAgIHIgPSBycyA+PiA0OwogICAgICBpZiAocyA9PT0gMCkgewogICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgaysrOwogICAgfQogIH0KICBmdW5jdGlvbiBkZWNvZGVEQ0ZpcnN0KGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICBjb25zdCBkaWZmID0gdCA9PT0gMCA/IDAgOiByZWNlaXZlQW5kRXh0ZW5kKHQpIDw8IHN1Y2Nlc3NpdmU7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSA9IGNvbXBvbmVudC5wcmVkICs9IGRpZmY7CiAgfQogIGZ1bmN0aW9uIGRlY29kZURDU3VjY2Vzc2l2ZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSB8PSByZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZTsKICB9CiAgbGV0IGVvYnJ1biA9IDA7CiAgZnVuY3Rpb24gZGVjb2RlQUNGaXJzdChjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBpZiAoZW9icnVuID4gMCkgewogICAgICBlb2JydW4tLTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGsgPSBzcGVjdHJhbFN0YXJ0OwogICAgY29uc3QgZSA9IHNwZWN0cmFsRW5kOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBycyA9IGRlY29kZUh1ZmZtYW4oY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDKTsKICAgICAgY29uc3QgcyA9IHJzICYgMTUsCiAgICAgICAgciA9IHJzID4+IDQ7CiAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgaWYgKHIgPCAxNSkgewogICAgICAgICAgZW9icnVuID0gcmVjZWl2ZShyKSArICgxIDw8IHIpIC0gMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKSAqICgxIDw8IHN1Y2Nlc3NpdmUpOwogICAgICBrKys7CiAgICB9CiAgfQogIGxldCBzdWNjZXNzaXZlQUNTdGF0ZSA9IDAsCiAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CiAgZnVuY3Rpb24gZGVjb2RlQUNTdWNjZXNzaXZlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGxldCBrID0gc3BlY3RyYWxTdGFydDsKICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgIGxldCByID0gMDsKICAgIGxldCBzOwogICAgbGV0IHJzOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBvZmZzZXRaID0gYmxvY2tPZmZzZXQgKyBkY3RaaWdaYWdba107CiAgICAgIGNvbnN0IHNpZ24gPSBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdIDwgMCA/IC0xIDogMTsKICAgICAgc3dpdGNoIChzdWNjZXNzaXZlQUNTdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgICAgcyA9IHJzICYgMTU7CiAgICAgICAgICByID0gcnMgPj4gNDsKICAgICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzICE9PSAxKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBBQ24gZW5jb2RpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHIgPyAyIDogMzsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNhc2UgMToKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAoY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSkgewogICAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdICs9IHNpZ24gKiAocmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgci0tOwogICAgICAgICAgICBpZiAociA9PT0gMCkgewogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0gPSBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPDwgc3VjY2Vzc2l2ZTsKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSAwOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGsrKzsKICAgIH0KICAgIGlmIChzdWNjZXNzaXZlQUNTdGF0ZSA9PT0gNCkgewogICAgICBlb2JydW4tLTsKICAgICAgaWYgKGVvYnJ1biA9PT0gMCkgewogICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgfQogICAgfQogIH0KICBsZXQgYmxvY2tSb3cgPSAwOwogIGZ1bmN0aW9uIGRlY29kZU1jdShjb21wb25lbnQsIGRlY29kZSwgbWN1LCByb3csIGNvbCkgewogICAgY29uc3QgbWN1Um93ID0gbWN1IC8gbWN1c1BlckxpbmUgfCAwOwogICAgY29uc3QgbWN1Q29sID0gbWN1ICUgbWN1c1BlckxpbmU7CiAgICBibG9ja1JvdyA9IG1jdVJvdyAqIGNvbXBvbmVudC52ICsgcm93OwogICAgY29uc3QgYmxvY2tDb2wgPSBtY3VDb2wgKiBjb21wb25lbnQuaCArIGNvbDsKICAgIGNvbnN0IGJsb2NrT2Zmc2V0ID0gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCBibG9ja1JvdywgYmxvY2tDb2wpOwogICAgZGVjb2RlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZSwgbWN1KSB7CiAgICBibG9ja1JvdyA9IG1jdSAvIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lIHwgMDsKICAgIGNvbnN0IGJsb2NrQ29sID0gbWN1ICUgY29tcG9uZW50LmJsb2Nrc1BlckxpbmU7CiAgICBjb25zdCBibG9ja09mZnNldCA9IGdldEJsb2NrQnVmZmVyT2Zmc2V0KGNvbXBvbmVudCwgYmxvY2tSb3csIGJsb2NrQ29sKTsKICAgIGRlY29kZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KTsKICB9CiAgY29uc3QgY29tcG9uZW50c0xlbmd0aCA9IGNvbXBvbmVudHMubGVuZ3RoOwogIGxldCBjb21wb25lbnQsIGksIGosIGssIG47CiAgbGV0IGRlY29kZUZuOwogIGlmIChwcm9ncmVzc2l2ZSkgewogICAgaWYgKHNwZWN0cmFsU3RhcnQgPT09IDApIHsKICAgICAgZGVjb2RlRm4gPSBzdWNjZXNzaXZlUHJldiA9PT0gMCA/IGRlY29kZURDRmlyc3QgOiBkZWNvZGVEQ1N1Y2Nlc3NpdmU7CiAgICB9IGVsc2UgewogICAgICBkZWNvZGVGbiA9IHN1Y2Nlc3NpdmVQcmV2ID09PSAwID8gZGVjb2RlQUNGaXJzdCA6IGRlY29kZUFDU3VjY2Vzc2l2ZTsKICAgIH0KICB9IGVsc2UgewogICAgZGVjb2RlRm4gPSBkZWNvZGVCYXNlbGluZTsKICB9CiAgbGV0IG1jdSA9IDAsCiAgICBmaWxlTWFya2VyOwogIGNvbnN0IG1jdUV4cGVjdGVkID0gY29tcG9uZW50c0xlbmd0aCA9PT0gMSA/IGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyTGluZSAqIGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyQ29sdW1uIDogbWN1c1BlckxpbmUgKiBmcmFtZS5tY3VzUGVyQ29sdW1uOwogIGxldCBoLCB2OwogIHdoaWxlIChtY3UgPD0gbWN1RXhwZWN0ZWQpIHsKICAgIGNvbnN0IG1jdVRvUmVhZCA9IHJlc2V0SW50ZXJ2YWwgPyBNYXRoLm1pbihtY3VFeHBlY3RlZCAtIG1jdSwgcmVzZXRJbnRlcnZhbCkgOiBtY3VFeHBlY3RlZDsKICAgIGlmIChtY3VUb1JlYWQgPiAwKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb21wb25lbnRzW2ldLnByZWQgPSAwOwogICAgICB9CiAgICAgIGVvYnJ1biA9IDA7CiAgICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1swXTsKICAgICAgICBmb3IgKG4gPSAwOyBuIDwgbWN1VG9SZWFkOyBuKyspIHsKICAgICAgICAgIGRlY29kZUJsb2NrKGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSk7CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChuID0gMDsgbiA8IG1jdVRvUmVhZDsgbisrKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcG9uZW50c0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbaV07CiAgICAgICAgICAgIGggPSBjb21wb25lbnQuaDsKICAgICAgICAgICAgdiA9IGNvbXBvbmVudC52OwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgdjsgaisrKSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGg7IGsrKykgewogICAgICAgICAgICAgICAgZGVjb2RlTWN1KGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSwgaiwgayk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDA7CiAgICBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIG9mZnNldCk7CiAgICBpZiAoIWZpbGVNYXJrZXIpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoZmlsZU1hcmtlci5pbnZhbGlkKSB7CiAgICAgIGNvbnN0IHBhcnRpYWxNc2cgPSBtY3VUb1JlYWQgPiAwID8gInVuZXhwZWN0ZWQiIDogImV4Y2Vzc2l2ZSI7CiAgICAgIHdhcm4oYGRlY29kZVNjYW4gLSAke3BhcnRpYWxNc2d9IE1DVSBkYXRhLCBjdXJyZW50IG1hcmtlciBpczogJHtmaWxlTWFya2VyLmludmFsaWR9YCk7CiAgICAgIG9mZnNldCA9IGZpbGVNYXJrZXIub2Zmc2V0OwogICAgfQogICAgaWYgKGZpbGVNYXJrZXIubWFya2VyID49IDB4ZmZkMCAmJiBmaWxlTWFya2VyLm1hcmtlciA8PSAweGZmZDcpIHsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CiAgcmV0dXJuIG9mZnNldCAtIHN0YXJ0T2Zmc2V0Owp9CmZ1bmN0aW9uIHF1YW50aXplQW5kSW52ZXJzZShjb21wb25lbnQsIGJsb2NrQnVmZmVyT2Zmc2V0LCBwKSB7CiAgY29uc3QgcXQgPSBjb21wb25lbnQucXVhbnRpemF0aW9uVGFibGUsCiAgICBibG9ja0RhdGEgPSBjb21wb25lbnQuYmxvY2tEYXRhOwogIGxldCB2MCwgdjEsIHYyLCB2MywgdjQsIHY1LCB2Niwgdjc7CiAgbGV0IHAwLCBwMSwgcDIsIHAzLCBwNCwgcDUsIHA2LCBwNzsKICBsZXQgdDsKICBpZiAoIXF0KSB7CiAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJtaXNzaW5nIHJlcXVpcmVkIFF1YW50aXphdGlvbiBUYWJsZS4iKTsKICB9CiAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgNjQ7IHJvdyArPSA4KSB7CiAgICBwMCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvd107CiAgICBwMSA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDFdOwogICAgcDIgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyAyXTsKICAgIHAzID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgM107CiAgICBwNCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDRdOwogICAgcDUgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyA1XTsKICAgIHA2ID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgNl07CiAgICBwNyA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDddOwogICAgcDAgKj0gcXRbcm93XTsKICAgIGlmICgocDEgfCBwMiB8IHAzIHwgcDQgfCBwNSB8IHA2IHwgcDcpID09PSAwKSB7CiAgICAgIHQgPSBkY3RTcXJ0MiAqIHAwICsgNTEyID4+IDEwOwogICAgICBwW3Jvd10gPSB0OwogICAgICBwW3JvdyArIDFdID0gdDsKICAgICAgcFtyb3cgKyAyXSA9IHQ7CiAgICAgIHBbcm93ICsgM10gPSB0OwogICAgICBwW3JvdyArIDRdID0gdDsKICAgICAgcFtyb3cgKyA1XSA9IHQ7CiAgICAgIHBbcm93ICsgNl0gPSB0OwogICAgICBwW3JvdyArIDddID0gdDsKICAgICAgY29udGludWU7CiAgICB9CiAgICBwMSAqPSBxdFtyb3cgKyAxXTsKICAgIHAyICo9IHF0W3JvdyArIDJdOwogICAgcDMgKj0gcXRbcm93ICsgM107CiAgICBwNCAqPSBxdFtyb3cgKyA0XTsKICAgIHA1ICo9IHF0W3JvdyArIDVdOwogICAgcDYgKj0gcXRbcm93ICsgNl07CiAgICBwNyAqPSBxdFtyb3cgKyA3XTsKICAgIHYwID0gZGN0U3FydDIgKiBwMCArIDEyOCA+PiA4OwogICAgdjEgPSBkY3RTcXJ0MiAqIHA0ICsgMTI4ID4+IDg7CiAgICB2MiA9IHAyOwogICAgdjMgPSBwNjsKICAgIHY0ID0gZGN0U3FydDFkMiAqIChwMSAtIHA3KSArIDEyOCA+PiA4OwogICAgdjcgPSBkY3RTcXJ0MWQyICogKHAxICsgcDcpICsgMTI4ID4+IDg7CiAgICB2NSA9IHAzIDw8IDQ7CiAgICB2NiA9IHA1IDw8IDQ7CiAgICB2MCA9IHYwICsgdjEgKyAxID4+IDE7CiAgICB2MSA9IHYwIC0gdjE7CiAgICB0ID0gdjIgKiBkY3RTaW42ICsgdjMgKiBkY3RDb3M2ICsgMTI4ID4+IDg7CiAgICB2MiA9IHYyICogZGN0Q29zNiAtIHYzICogZGN0U2luNiArIDEyOCA+PiA4OwogICAgdjMgPSB0OwogICAgdjQgPSB2NCArIHY2ICsgMSA+PiAxOwogICAgdjYgPSB2NCAtIHY2OwogICAgdjcgPSB2NyArIHY1ICsgMSA+PiAxOwogICAgdjUgPSB2NyAtIHY1OwogICAgdjAgPSB2MCArIHYzICsgMSA+PiAxOwogICAgdjMgPSB2MCAtIHYzOwogICAgdjEgPSB2MSArIHYyICsgMSA+PiAxOwogICAgdjIgPSB2MSAtIHYyOwogICAgdCA9IHY0ICogZGN0U2luMyArIHY3ICogZGN0Q29zMyArIDIwNDggPj4gMTI7CiAgICB2NCA9IHY0ICogZGN0Q29zMyAtIHY3ICogZGN0U2luMyArIDIwNDggPj4gMTI7CiAgICB2NyA9IHQ7CiAgICB0ID0gdjUgKiBkY3RTaW4xICsgdjYgKiBkY3RDb3MxICsgMjA0OCA+PiAxMjsKICAgIHY1ID0gdjUgKiBkY3RDb3MxIC0gdjYgKiBkY3RTaW4xICsgMjA0OCA+PiAxMjsKICAgIHY2ID0gdDsKICAgIHBbcm93XSA9IHYwICsgdjc7CiAgICBwW3JvdyArIDddID0gdjAgLSB2NzsKICAgIHBbcm93ICsgMV0gPSB2MSArIHY2OwogICAgcFtyb3cgKyA2XSA9IHYxIC0gdjY7CiAgICBwW3JvdyArIDJdID0gdjIgKyB2NTsKICAgIHBbcm93ICsgNV0gPSB2MiAtIHY1OwogICAgcFtyb3cgKyAzXSA9IHYzICsgdjQ7CiAgICBwW3JvdyArIDRdID0gdjMgLSB2NDsKICB9CiAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgODsgKytjb2wpIHsKICAgIHAwID0gcFtjb2xdOwogICAgcDEgPSBwW2NvbCArIDhdOwogICAgcDIgPSBwW2NvbCArIDE2XTsKICAgIHAzID0gcFtjb2wgKyAyNF07CiAgICBwNCA9IHBbY29sICsgMzJdOwogICAgcDUgPSBwW2NvbCArIDQwXTsKICAgIHA2ID0gcFtjb2wgKyA0OF07CiAgICBwNyA9IHBbY29sICsgNTZdOwogICAgaWYgKChwMSB8IHAyIHwgcDMgfCBwNCB8IHA1IHwgcDYgfCBwNykgPT09IDApIHsKICAgICAgdCA9IGRjdFNxcnQyICogcDAgKyA4MTkyID4+IDE0OwogICAgICBpZiAodCA8IC0yMDQwKSB7CiAgICAgICAgdCA9IDA7CiAgICAgIH0gZWxzZSBpZiAodCA+PSAyMDI0KSB7CiAgICAgICAgdCA9IDI1NTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ID0gdCArIDIwNTYgPj4gNDsKICAgICAgfQogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2xdID0gdDsKICAgICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgOF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAxNl0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAyNF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAzMl0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0MF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0OF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA1Nl0gPSB0OwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHYwID0gZGN0U3FydDIgKiBwMCArIDIwNDggPj4gMTI7CiAgICB2MSA9IGRjdFNxcnQyICogcDQgKyAyMDQ4ID4+IDEyOwogICAgdjIgPSBwMjsKICAgIHYzID0gcDY7CiAgICB2NCA9IGRjdFNxcnQxZDIgKiAocDEgLSBwNykgKyAyMDQ4ID4+IDEyOwogICAgdjcgPSBkY3RTcXJ0MWQyICogKHAxICsgcDcpICsgMjA0OCA+PiAxMjsKICAgIHY1ID0gcDM7CiAgICB2NiA9IHA1OwogICAgdjAgPSAodjAgKyB2MSArIDEgPj4gMSkgKyA0MTEyOwogICAgdjEgPSB2MCAtIHYxOwogICAgdCA9IHYyICogZGN0U2luNiArIHYzICogZGN0Q29zNiArIDIwNDggPj4gMTI7CiAgICB2MiA9IHYyICogZGN0Q29zNiAtIHYzICogZGN0U2luNiArIDIwNDggPj4gMTI7CiAgICB2MyA9IHQ7CiAgICB2NCA9IHY0ICsgdjYgKyAxID4+IDE7CiAgICB2NiA9IHY0IC0gdjY7CiAgICB2NyA9IHY3ICsgdjUgKyAxID4+IDE7CiAgICB2NSA9IHY3IC0gdjU7CiAgICB2MCA9IHYwICsgdjMgKyAxID4+IDE7CiAgICB2MyA9IHYwIC0gdjM7CiAgICB2MSA9IHYxICsgdjIgKyAxID4+IDE7CiAgICB2MiA9IHYxIC0gdjI7CiAgICB0ID0gdjQgKiBkY3RTaW4zICsgdjcgKiBkY3RDb3MzICsgMjA0OCA+PiAxMjsKICAgIHY0ID0gdjQgKiBkY3RDb3MzIC0gdjcgKiBkY3RTaW4zICsgMjA0OCA+PiAxMjsKICAgIHY3ID0gdDsKICAgIHQgPSB2NSAqIGRjdFNpbjEgKyB2NiAqIGRjdENvczEgKyAyMDQ4ID4+IDEyOwogICAgdjUgPSB2NSAqIGRjdENvczEgLSB2NiAqIGRjdFNpbjEgKyAyMDQ4ID4+IDEyOwogICAgdjYgPSB0OwogICAgcDAgPSB2MCArIHY3OwogICAgcDcgPSB2MCAtIHY3OwogICAgcDEgPSB2MSArIHY2OwogICAgcDYgPSB2MSAtIHY2OwogICAgcDIgPSB2MiArIHY1OwogICAgcDUgPSB2MiAtIHY1OwogICAgcDMgPSB2MyArIHY0OwogICAgcDQgPSB2MyAtIHY0OwogICAgaWYgKHAwIDwgMTYpIHsKICAgICAgcDAgPSAwOwogICAgfSBlbHNlIGlmIChwMCA+PSA0MDgwKSB7CiAgICAgIHAwID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDAgPj49IDQ7CiAgICB9CiAgICBpZiAocDEgPCAxNikgewogICAgICBwMSA9IDA7CiAgICB9IGVsc2UgaWYgKHAxID49IDQwODApIHsKICAgICAgcDEgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwMSA+Pj0gNDsKICAgIH0KICAgIGlmIChwMiA8IDE2KSB7CiAgICAgIHAyID0gMDsKICAgIH0gZWxzZSBpZiAocDIgPj0gNDA4MCkgewogICAgICBwMiA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHAyID4+PSA0OwogICAgfQogICAgaWYgKHAzIDwgMTYpIHsKICAgICAgcDMgPSAwOwogICAgfSBlbHNlIGlmIChwMyA+PSA0MDgwKSB7CiAgICAgIHAzID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDMgPj49IDQ7CiAgICB9CiAgICBpZiAocDQgPCAxNikgewogICAgICBwNCA9IDA7CiAgICB9IGVsc2UgaWYgKHA0ID49IDQwODApIHsKICAgICAgcDQgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwNCA+Pj0gNDsKICAgIH0KICAgIGlmIChwNSA8IDE2KSB7CiAgICAgIHA1ID0gMDsKICAgIH0gZWxzZSBpZiAocDUgPj0gNDA4MCkgewogICAgICBwNSA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHA1ID4+PSA0OwogICAgfQogICAgaWYgKHA2IDwgMTYpIHsKICAgICAgcDYgPSAwOwogICAgfSBlbHNlIGlmIChwNiA+PSA0MDgwKSB7CiAgICAgIHA2ID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDYgPj49IDQ7CiAgICB9CiAgICBpZiAocDcgPCAxNikgewogICAgICBwNyA9IDA7CiAgICB9IGVsc2UgaWYgKHA3ID49IDQwODApIHsKICAgICAgcDcgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwNyA+Pj0gNDsKICAgIH0KICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbF0gPSBwMDsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDhdID0gcDE7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAxNl0gPSBwMjsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDI0XSA9IHAzOwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgMzJdID0gcDQ7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0MF0gPSBwNTsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDQ4XSA9IHA2OwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgNTZdID0gcDc7CiAgfQp9CmZ1bmN0aW9uIGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSB7CiAgY29uc3QgYmxvY2tzUGVyTGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lOwogIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IGNvbXBvbmVudC5ibG9ja3NQZXJDb2x1bW47CiAgY29uc3QgY29tcHV0YXRpb25CdWZmZXIgPSBuZXcgSW50MTZBcnJheSg2NCk7CiAgZm9yIChsZXQgYmxvY2tSb3cgPSAwOyBibG9ja1JvdyA8IGJsb2Nrc1BlckNvbHVtbjsgYmxvY2tSb3crKykgewogICAgZm9yIChsZXQgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCBibG9ja1JvdywgYmxvY2tDb2wpOwogICAgICBxdWFudGl6ZUFuZEludmVyc2UoY29tcG9uZW50LCBvZmZzZXQsIGNvbXB1dGF0aW9uQnVmZmVyKTsKICAgIH0KICB9CiAgcmV0dXJuIGNvbXBvbmVudC5ibG9ja0RhdGE7Cn0KZnVuY3Rpb24gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGN1cnJlbnRQb3MsIHN0YXJ0UG9zID0gY3VycmVudFBvcykgewogIGNvbnN0IG1heFBvcyA9IGRhdGEubGVuZ3RoIC0gMTsKICBsZXQgbmV3UG9zID0gc3RhcnRQb3MgPCBjdXJyZW50UG9zID8gc3RhcnRQb3MgOiBjdXJyZW50UG9zOwogIGlmIChjdXJyZW50UG9zID49IG1heFBvcykgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGN1cnJlbnRNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIGN1cnJlbnRQb3MpOwogIGlmIChjdXJyZW50TWFya2VyID49IDB4ZmZjMCAmJiBjdXJyZW50TWFya2VyIDw9IDB4ZmZmZSkgewogICAgcmV0dXJuIHsKICAgICAgaW52YWxpZDogbnVsbCwKICAgICAgbWFya2VyOiBjdXJyZW50TWFya2VyLAogICAgICBvZmZzZXQ6IGN1cnJlbnRQb3MKICAgIH07CiAgfQogIGxldCBuZXdNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIG5ld1Bvcyk7CiAgd2hpbGUgKCEobmV3TWFya2VyID49IDB4ZmZjMCAmJiBuZXdNYXJrZXIgPD0gMHhmZmZlKSkgewogICAgaWYgKCsrbmV3UG9zID49IG1heFBvcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIG5ld01hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgbmV3UG9zKTsKICB9CiAgcmV0dXJuIHsKICAgIGludmFsaWQ6IGN1cnJlbnRNYXJrZXIudG9TdHJpbmcoMTYpLAogICAgbWFya2VyOiBuZXdNYXJrZXIsCiAgICBvZmZzZXQ6IG5ld1BvcwogIH07Cn0KZnVuY3Rpb24gcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpIHsKICBjb25zdCBtY3VzUGVyTGluZSA9IE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDggLyBmcmFtZS5tYXhIKTsKICBjb25zdCBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBmcmFtZS5tYXhWKTsKICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICBjb25zdCBibG9ja3NQZXJMaW5lID0gTWF0aC5jZWlsKE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDgpICogY29tcG9uZW50LmggLyBmcmFtZS5tYXhIKTsKICAgIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2NhbkxpbmVzIC8gOCkgKiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYpOwogICAgY29uc3QgYmxvY2tzUGVyTGluZUZvck1jdSA9IG1jdXNQZXJMaW5lICogY29tcG9uZW50Lmg7CiAgICBjb25zdCBibG9ja3NQZXJDb2x1bW5Gb3JNY3UgPSBtY3VzUGVyQ29sdW1uICogY29tcG9uZW50LnY7CiAgICBjb25zdCBibG9ja3NCdWZmZXJTaXplID0gNjQgKiBibG9ja3NQZXJDb2x1bW5Gb3JNY3UgKiAoYmxvY2tzUGVyTGluZUZvck1jdSArIDEpOwogICAgY29tcG9uZW50LmJsb2NrRGF0YSA9IG5ldyBJbnQxNkFycmF5KGJsb2Nrc0J1ZmZlclNpemUpOwogICAgY29tcG9uZW50LmJsb2Nrc1BlckxpbmUgPSBibG9ja3NQZXJMaW5lOwogICAgY29tcG9uZW50LmJsb2Nrc1BlckNvbHVtbiA9IGJsb2Nrc1BlckNvbHVtbjsKICB9CiAgZnJhbWUubWN1c1BlckxpbmUgPSBtY3VzUGVyTGluZTsKICBmcmFtZS5tY3VzUGVyQ29sdW1uID0gbWN1c1BlckNvbHVtbjsKfQpmdW5jdGlvbiByZWFkRGF0YUJsb2NrKGRhdGEsIG9mZnNldCkgewogIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICBvZmZzZXQgKz0gMjsKICBsZXQgZW5kT2Zmc2V0ID0gb2Zmc2V0ICsgbGVuZ3RoIC0gMjsKICBjb25zdCBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGVuZE9mZnNldCwgb2Zmc2V0KTsKICBpZiAoZmlsZU1hcmtlcj8uaW52YWxpZCkgewogICAgd2FybigicmVhZERhdGFCbG9jayAtIGluY29ycmVjdCBsZW5ndGgsIGN1cnJlbnQgbWFya2VyIGlzOiAiICsgZmlsZU1hcmtlci5pbnZhbGlkKTsKICAgIGVuZE9mZnNldCA9IGZpbGVNYXJrZXIub2Zmc2V0OwogIH0KICBjb25zdCBhcnJheSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBlbmRPZmZzZXQpOwogIHJldHVybiB7CiAgICBhcHBEYXRhOiBhcnJheSwKICAgIG9sZE9mZnNldDogb2Zmc2V0LAogICAgbmV3T2Zmc2V0OiBvZmZzZXQgKyBhcnJheS5sZW5ndGgKICB9Owp9CmZ1bmN0aW9uIHNraXBEYXRhKGRhdGEsIG9mZnNldCkgewogIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICBvZmZzZXQgKz0gMjsKICBjb25zdCBlbmRPZmZzZXQgPSBvZmZzZXQgKyBsZW5ndGggLSAyOwogIGNvbnN0IGZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgZW5kT2Zmc2V0LCBvZmZzZXQpOwogIGlmIChmaWxlTWFya2VyPy5pbnZhbGlkKSB7CiAgICByZXR1cm4gZmlsZU1hcmtlci5vZmZzZXQ7CiAgfQogIHJldHVybiBlbmRPZmZzZXQ7Cn0KY2xhc3MgSnBlZ0ltYWdlIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBkZWNvZGVUcmFuc2Zvcm0gPSBudWxsLAogICAgY29sb3JUcmFuc2Zvcm0gPSAtMQogIH0gPSB7fSkgewogICAgdGhpcy5fZGVjb2RlVHJhbnNmb3JtID0gZGVjb2RlVHJhbnNmb3JtOwogICAgdGhpcy5fY29sb3JUcmFuc2Zvcm0gPSBjb2xvclRyYW5zZm9ybTsKICB9CiAgc3RhdGljIGNhblVzZUltYWdlRGVjb2RlcihkYXRhLCBjb2xvclRyYW5zZm9ybSA9IC0xKSB7CiAgICBsZXQgZXhpZk9mZnNldHMgPSBudWxsOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBsZXQgbnVtQ29tcG9uZW50cyA9IG51bGw7CiAgICBsZXQgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSAyOwogICAgaWYgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOCkgewogICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJTT0kgbm90IGZvdW5kIik7CiAgICB9CiAgICBmaWxlTWFya2VyID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDI7CiAgICBtYXJrZXJMb29wOiB3aGlsZSAoZmlsZU1hcmtlciAhPT0gMHhmZmQ5KSB7CiAgICAgIHN3aXRjaCAoZmlsZU1hcmtlcikgewogICAgICAgIGNhc2UgMHhmZmUxOgogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBhcHBEYXRhLAogICAgICAgICAgICBvbGRPZmZzZXQsCiAgICAgICAgICAgIG5ld09mZnNldAogICAgICAgICAgfSA9IHJlYWREYXRhQmxvY2soZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCA9IG5ld09mZnNldDsKICAgICAgICAgIGlmIChhcHBEYXRhWzBdID09PSAweDQ1ICYmIGFwcERhdGFbMV0gPT09IDB4NzggJiYgYXBwRGF0YVsyXSA9PT0gMHg2OSAmJiBhcHBEYXRhWzNdID09PSAweDY2ICYmIGFwcERhdGFbNF0gPT09IDAgJiYgYXBwRGF0YVs1XSA9PT0gMCkgewogICAgICAgICAgICBpZiAoZXhpZk9mZnNldHMpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJEdXBsaWNhdGUgRVhJRi1ibG9ja3MgZm91bmQuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXhpZk9mZnNldHMgPSB7CiAgICAgICAgICAgICAgZXhpZlN0YXJ0OiBvbGRPZmZzZXQgKyA2LAogICAgICAgICAgICAgIGV4aWZFbmQ6IG5ld09mZnNldAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgY2FzZSAweGZmYzA6CiAgICAgICAgY2FzZSAweGZmYzE6CiAgICAgICAgY2FzZSAweGZmYzI6CiAgICAgICAgICBudW1Db21wb25lbnRzID0gZGF0YVtvZmZzZXQgKyAoMiArIDEgKyAyICsgMildOwogICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICBjYXNlIDB4ZmZmZjoKICAgICAgICAgIGlmIChkYXRhW29mZnNldF0gIT09IDB4ZmYpIHsKICAgICAgICAgICAgb2Zmc2V0LS07CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBvZmZzZXQgPSBza2lwRGF0YShkYXRhLCBvZmZzZXQpOwogICAgICBmaWxlTWFya2VyID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICBvZmZzZXQgKz0gMjsKICAgIH0KICAgIGlmIChudW1Db21wb25lbnRzID09PSA0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKG51bUNvbXBvbmVudHMgPT09IDMgJiYgY29sb3JUcmFuc2Zvcm0gPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gZXhpZk9mZnNldHMgfHwge307CiAgfQogIHBhcnNlKGRhdGEsIHsKICAgIGRubFNjYW5MaW5lcyA9IG51bGwKICB9ID0ge30pIHsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgbGV0IGpmaWYgPSBudWxsOwogICAgbGV0IGFkb2JlID0gbnVsbDsKICAgIGxldCBmcmFtZSwgcmVzZXRJbnRlcnZhbDsKICAgIGxldCBudW1TT1NNYXJrZXJzID0gMDsKICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlcyA9IFtdOwogICAgY29uc3QgaHVmZm1hblRhYmxlc0FDID0gW10sCiAgICAgIGh1ZmZtYW5UYWJsZXNEQyA9IFtdOwogICAgbGV0IGZpbGVNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCk7CiAgICBvZmZzZXQgKz0gMjsKICAgIGlmIChmaWxlTWFya2VyICE9PSAweGZmZDgpIHsKICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiU09JIG5vdCBmb3VuZCIpOwogICAgfQogICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSAyOwogICAgbWFya2VyTG9vcDogd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOSkgewogICAgICBsZXQgaSwgaiwgbDsKICAgICAgc3dpdGNoIChmaWxlTWFya2VyKSB7CiAgICAgICAgY2FzZSAweGZmZTA6CiAgICAgICAgY2FzZSAweGZmZTE6CiAgICAgICAgY2FzZSAweGZmZTI6CiAgICAgICAgY2FzZSAweGZmZTM6CiAgICAgICAgY2FzZSAweGZmZTQ6CiAgICAgICAgY2FzZSAweGZmZTU6CiAgICAgICAgY2FzZSAweGZmZTY6CiAgICAgICAgY2FzZSAweGZmZTc6CiAgICAgICAgY2FzZSAweGZmZTg6CiAgICAgICAgY2FzZSAweGZmZTk6CiAgICAgICAgY2FzZSAweGZmZWE6CiAgICAgICAgY2FzZSAweGZmZWI6CiAgICAgICAgY2FzZSAweGZmZWM6CiAgICAgICAgY2FzZSAweGZmZWQ6CiAgICAgICAgY2FzZSAweGZmZWU6CiAgICAgICAgY2FzZSAweGZmZWY6CiAgICAgICAgY2FzZSAweGZmZmU6CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGFwcERhdGEsCiAgICAgICAgICAgIG5ld09mZnNldAogICAgICAgICAgfSA9IHJlYWREYXRhQmxvY2soZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCA9IG5ld09mZnNldDsKICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweGZmZTApIHsKICAgICAgICAgICAgaWYgKGFwcERhdGFbMF0gPT09IDB4NGEgJiYgYXBwRGF0YVsxXSA9PT0gMHg0NiAmJiBhcHBEYXRhWzJdID09PSAweDQ5ICYmIGFwcERhdGFbM10gPT09IDB4NDYgJiYgYXBwRGF0YVs0XSA9PT0gMCkgewogICAgICAgICAgICAgIGpmaWYgPSB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgIG1ham9yOiBhcHBEYXRhWzVdLAogICAgICAgICAgICAgICAgICBtaW5vcjogYXBwRGF0YVs2XQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlbnNpdHlVbml0czogYXBwRGF0YVs3XSwKICAgICAgICAgICAgICAgIHhEZW5zaXR5OiBhcHBEYXRhWzhdIDw8IDggfCBhcHBEYXRhWzldLAogICAgICAgICAgICAgICAgeURlbnNpdHk6IGFwcERhdGFbMTBdIDw8IDggfCBhcHBEYXRhWzExXSwKICAgICAgICAgICAgICAgIHRodW1iV2lkdGg6IGFwcERhdGFbMTJdLAogICAgICAgICAgICAgICAgdGh1bWJIZWlnaHQ6IGFwcERhdGFbMTNdLAogICAgICAgICAgICAgICAgdGh1bWJEYXRhOiBhcHBEYXRhLnN1YmFycmF5KDE0LCAxNCArIDMgKiBhcHBEYXRhWzEyXSAqIGFwcERhdGFbMTNdKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweGZmZWUpIHsKICAgICAgICAgICAgaWYgKGFwcERhdGFbMF0gPT09IDB4NDEgJiYgYXBwRGF0YVsxXSA9PT0gMHg2NCAmJiBhcHBEYXRhWzJdID09PSAweDZmICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSkgewogICAgICAgICAgICAgIGFkb2JlID0gewogICAgICAgICAgICAgICAgdmVyc2lvbjogYXBwRGF0YVs1XSA8PCA4IHwgYXBwRGF0YVs2XSwKICAgICAgICAgICAgICAgIGZsYWdzMDogYXBwRGF0YVs3XSA8PCA4IHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgIGZsYWdzMTogYXBwRGF0YVs5XSA8PCA4IHwgYXBwRGF0YVsxMF0sCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db2RlOiBhcHBEYXRhWzExXQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRiOgogICAgICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBjb25zdCBxdWFudGl6YXRpb25UYWJsZXNFbmQgPSBxdWFudGl6YXRpb25UYWJsZXNMZW5ndGggKyBvZmZzZXQgLSAyOwogICAgICAgICAgbGV0IHo7CiAgICAgICAgICB3aGlsZSAob2Zmc2V0IDwgcXVhbnRpemF0aW9uVGFibGVzRW5kKSB7CiAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCB0YWJsZURhdGEgPSBuZXcgVWludDE2QXJyYXkoNjQpOwogICAgICAgICAgICBpZiAocXVhbnRpemF0aW9uVGFibGVTcGVjID4+IDQgPT09IDApIHsKICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgIHRhYmxlRGF0YVt6XSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChxdWFudGl6YXRpb25UYWJsZVNwZWMgPj4gNCA9PT0gMSkgewogICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA2NDsgaisrKSB7CiAgICAgICAgICAgICAgICB6ID0gZGN0WmlnWmFnW2pdOwogICAgICAgICAgICAgICAgdGFibGVEYXRhW3pdID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkRRVCAtIGludmFsaWQgdGFibGUgc3BlYyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHF1YW50aXphdGlvblRhYmxlc1txdWFudGl6YXRpb25UYWJsZVNwZWMgJiAxNV0gPSB0YWJsZURhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZjMDoKICAgICAgICBjYXNlIDB4ZmZjMToKICAgICAgICBjYXNlIDB4ZmZjMjoKICAgICAgICAgIGlmIChmcmFtZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJPbmx5IHNpbmdsZSBmcmFtZSBKUEVHcyBzdXBwb3J0ZWQiKTsKICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUgPSB7fTsKICAgICAgICAgIGZyYW1lLmV4dGVuZGVkID0gZmlsZU1hcmtlciA9PT0gMHhmZmMxOwogICAgICAgICAgZnJhbWUucHJvZ3Jlc3NpdmUgPSBmaWxlTWFya2VyID09PSAweGZmYzI7CiAgICAgICAgICBmcmFtZS5wcmVjaXNpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIGNvbnN0IHNvZlNjYW5MaW5lcyA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUuc2NhbkxpbmVzID0gZG5sU2NhbkxpbmVzIHx8IHNvZlNjYW5MaW5lczsKICAgICAgICAgIGZyYW1lLnNhbXBsZXNQZXJMaW5lID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmcmFtZS5jb21wb25lbnRzID0gW107CiAgICAgICAgICBmcmFtZS5jb21wb25lbnRJZHMgPSB7fTsKICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgbGV0IG1heEggPSAwLAogICAgICAgICAgICBtYXhWID0gMDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBjb21wb25lbnRJZCA9IGRhdGFbb2Zmc2V0XTsKICAgICAgICAgICAgY29uc3QgaCA9IGRhdGFbb2Zmc2V0ICsgMV0gPj4gNDsKICAgICAgICAgICAgY29uc3QgdiA9IGRhdGFbb2Zmc2V0ICsgMV0gJiAxNTsKICAgICAgICAgICAgaWYgKG1heEggPCBoKSB7CiAgICAgICAgICAgICAgbWF4SCA9IGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heFYgPCB2KSB7CiAgICAgICAgICAgICAgbWF4ViA9IHY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcUlkID0gZGF0YVtvZmZzZXQgKyAyXTsKICAgICAgICAgICAgbCA9IGZyYW1lLmNvbXBvbmVudHMucHVzaCh7CiAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgIHF1YW50aXphdGlvbklkOiBxSWQsCiAgICAgICAgICAgICAgcXVhbnRpemF0aW9uVGFibGU6IG51bGwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGZyYW1lLmNvbXBvbmVudElkc1tjb21wb25lbnRJZF0gPSBsIC0gMTsKICAgICAgICAgICAgb2Zmc2V0ICs9IDM7CiAgICAgICAgICB9CiAgICAgICAgICBmcmFtZS5tYXhIID0gbWF4SDsKICAgICAgICAgIGZyYW1lLm1heFYgPSBtYXhWOwogICAgICAgICAgcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmYzQ6CiAgICAgICAgICBjb25zdCBodWZmbWFuTGVuZ3RoID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgaHVmZm1hbkxlbmd0aDspIHsKICAgICAgICAgICAgY29uc3QgaHVmZm1hblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgbGV0IGNvZGVMZW5ndGhTdW0gPSAwOwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMTY7IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGh1ZmZtYW5WYWx1ZXMgPSBuZXcgVWludDhBcnJheShjb2RlTGVuZ3RoU3VtKTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvZGVMZW5ndGhTdW07IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMTcgKyBjb2RlTGVuZ3RoU3VtOwogICAgICAgICAgICAoaHVmZm1hblRhYmxlU3BlYyA+PiA0ID09PSAwID8gaHVmZm1hblRhYmxlc0RDIDogaHVmZm1hblRhYmxlc0FDKVtodWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMsIGh1ZmZtYW5WYWx1ZXMpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmZGQ6CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIHJlc2V0SW50ZXJ2YWwgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCk7CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRhOgogICAgICAgICAgY29uc3QgcGFyc2VETkxNYXJrZXIgPSArK251bVNPU01hcmtlcnMgPT09IDEgJiYgIWRubFNjYW5MaW5lczsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29uc3Qgc2VsZWN0b3JzQ291bnQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlbGVjdG9yc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50SW5kZXggPSBmcmFtZS5jb21wb25lbnRJZHNbaW5kZXhdOwogICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudEluZGV4XTsKICAgICAgICAgICAgY29tcG9uZW50LmluZGV4ID0gaW5kZXg7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlREMgPSBodWZmbWFuVGFibGVzRENbdGFibGVTcGVjID4+IDRdOwogICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlQUMgPSBodWZmbWFuVGFibGVzQUNbdGFibGVTcGVjICYgMTVdOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHNwZWN0cmFsU3RhcnQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgc3BlY3RyYWxFbmQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZCA9IGRlY29kZVNjYW4oZGF0YSwgb2Zmc2V0LCBmcmFtZSwgY29tcG9uZW50cywgcmVzZXRJbnRlcnZhbCwgc3BlY3RyYWxTdGFydCwgc3BlY3RyYWxFbmQsIHN1Y2Nlc3NpdmVBcHByb3hpbWF0aW9uID4+IDQsIHN1Y2Nlc3NpdmVBcHByb3hpbWF0aW9uICYgMTUsIHBhcnNlRE5MTWFya2VyKTsKICAgICAgICAgICAgb2Zmc2V0ICs9IHByb2Nlc3NlZDsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIEROTE1hcmtlckVycm9yKSB7CiAgICAgICAgICAgICAgd2FybihgJHtleC5tZXNzYWdlfSAtLSBhdHRlbXB0aW5nIHRvIHJlLXBhcnNlIHRoZSBKUEVHIGltYWdlLmApOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlKGRhdGEsIHsKICAgICAgICAgICAgICAgIGRubFNjYW5MaW5lczogZXguc2NhbkxpbmVzCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXggaW5zdGFuY2VvZiBFT0lNYXJrZXJFcnJvcikgewogICAgICAgICAgICAgIHdhcm4oYCR7ZXgubWVzc2FnZX0gLS0gaWdub3JpbmcgdGhlIHJlc3Qgb2YgdGhlIGltYWdlIGRhdGEuYCk7CiAgICAgICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRjOgogICAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZmZjoKICAgICAgICAgIGlmIChkYXRhW29mZnNldF0gIT09IDB4ZmYpIHsKICAgICAgICAgICAgb2Zmc2V0LS07CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY29uc3QgbmV4dEZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgb2Zmc2V0IC0gMiwgb2Zmc2V0IC0gMyk7CiAgICAgICAgICBpZiAobmV4dEZpbGVNYXJrZXI/LmludmFsaWQpIHsKICAgICAgICAgICAgd2FybigiSnBlZ0ltYWdlLnBhcnNlIC0gdW5leHBlY3RlZCBkYXRhLCBjdXJyZW50IG1hcmtlciBpczogIiArIG5leHRGaWxlTWFya2VyLmludmFsaWQpOwogICAgICAgICAgICBvZmZzZXQgPSBuZXh0RmlsZU1hcmtlci5vZmZzZXQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFuZXh0RmlsZU1hcmtlciB8fCBvZmZzZXQgPj0gZGF0YS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHdhcm4oIkpwZWdJbWFnZS5wYXJzZSAtIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgaW1hZ2UgZGF0YSAiICsgIndpdGhvdXQgZmluZGluZyBhbiBFT0kgbWFya2VyICgweEZGRDkpLiIpOwogICAgICAgICAgICBicmVhayBtYXJrZXJMb29wOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiSnBlZ0ltYWdlLnBhcnNlIC0gdW5rbm93biBtYXJrZXI6ICIgKyBmaWxlTWFya2VyLnRvU3RyaW5nKDE2KSk7CiAgICAgIH0KICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9CiAgICBpZiAoIWZyYW1lKSB7CiAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkpwZWdJbWFnZS5wYXJzZSAtIG5vIGZyYW1lIGRhdGEgZm91bmQuIik7CiAgICB9CiAgICB0aGlzLndpZHRoID0gZnJhbWUuc2FtcGxlc1BlckxpbmU7CiAgICB0aGlzLmhlaWdodCA9IGZyYW1lLnNjYW5MaW5lczsKICAgIHRoaXMuamZpZiA9IGpmaWY7CiAgICB0aGlzLmFkb2JlID0gYWRvYmU7CiAgICB0aGlzLmNvbXBvbmVudHMgPSBbXTsKICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIGZyYW1lLmNvbXBvbmVudHMpIHsKICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGUgPSBxdWFudGl6YXRpb25UYWJsZXNbY29tcG9uZW50LnF1YW50aXphdGlvbklkXTsKICAgICAgaWYgKHF1YW50aXphdGlvblRhYmxlKSB7CiAgICAgICAgY29tcG9uZW50LnF1YW50aXphdGlvblRhYmxlID0gcXVhbnRpemF0aW9uVGFibGU7CiAgICAgIH0KICAgICAgdGhpcy5jb21wb25lbnRzLnB1c2goewogICAgICAgIGluZGV4OiBjb21wb25lbnQuaW5kZXgsCiAgICAgICAgb3V0cHV0OiBidWlsZENvbXBvbmVudERhdGEoZnJhbWUsIGNvbXBvbmVudCksCiAgICAgICAgc2NhbGVYOiBjb21wb25lbnQuaCAvIGZyYW1lLm1heEgsCiAgICAgICAgc2NhbGVZOiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYsCiAgICAgICAgYmxvY2tzUGVyTGluZTogY29tcG9uZW50LmJsb2Nrc1BlckxpbmUsCiAgICAgICAgYmxvY2tzUGVyQ29sdW1uOiBjb21wb25lbnQuYmxvY2tzUGVyQ29sdW1uCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5udW1Db21wb25lbnRzID0gdGhpcy5jb21wb25lbnRzLmxlbmd0aDsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIF9nZXRMaW5lYXJpemVkQmxvY2tEYXRhKHdpZHRoLCBoZWlnaHQsIGlzU291cmNlUERGID0gZmFsc2UpIHsKICAgIGNvbnN0IHNjYWxlWCA9IHRoaXMud2lkdGggLyB3aWR0aCwKICAgICAgc2NhbGVZID0gdGhpcy5oZWlnaHQgLyBoZWlnaHQ7CiAgICBsZXQgY29tcG9uZW50LCBjb21wb25lbnRTY2FsZVgsIGNvbXBvbmVudFNjYWxlWSwgYmxvY2tzUGVyU2NhbmxpbmU7CiAgICBsZXQgeCwgeSwgaSwgaiwgazsKICAgIGxldCBpbmRleDsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgbGV0IG91dHB1dDsKICAgIGNvbnN0IG51bUNvbXBvbmVudHMgPSB0aGlzLmNvbXBvbmVudHMubGVuZ3RoOwogICAgY29uc3QgZGF0YUxlbmd0aCA9IHdpZHRoICogaGVpZ2h0ICogbnVtQ29tcG9uZW50czsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YUxlbmd0aCk7CiAgICBjb25zdCB4U2NhbGVCbG9ja09mZnNldCA9IG5ldyBVaW50MzJBcnJheSh3aWR0aCk7CiAgICBjb25zdCBtYXNrM0xTQiA9IDB4ZmZmZmZmZjg7CiAgICBsZXQgbGFzdENvbXBvbmVudFNjYWxlWDsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1Db21wb25lbnRzOyBpKyspIHsKICAgICAgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRzW2ldOwogICAgICBjb21wb25lbnRTY2FsZVggPSBjb21wb25lbnQuc2NhbGVYICogc2NhbGVYOwogICAgICBjb21wb25lbnRTY2FsZVkgPSBjb21wb25lbnQuc2NhbGVZICogc2NhbGVZOwogICAgICBvZmZzZXQgPSBpOwogICAgICBvdXRwdXQgPSBjb21wb25lbnQub3V0cHV0OwogICAgICBibG9ja3NQZXJTY2FubGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lICsgMSA8PCAzOwogICAgICBpZiAoY29tcG9uZW50U2NhbGVYICE9PSBsYXN0Q29tcG9uZW50U2NhbGVYKSB7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGogPSAwIHwgeCAqIGNvbXBvbmVudFNjYWxlWDsKICAgICAgICAgIHhTY2FsZUJsb2NrT2Zmc2V0W3hdID0gKGogJiBtYXNrM0xTQikgPDwgMyB8IGogJiA3OwogICAgICAgIH0KICAgICAgICBsYXN0Q29tcG9uZW50U2NhbGVYID0gY29tcG9uZW50U2NhbGVYOwogICAgICB9CiAgICAgIGZvciAoeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykgewogICAgICAgIGogPSAwIHwgeSAqIGNvbXBvbmVudFNjYWxlWTsKICAgICAgICBpbmRleCA9IGJsb2Nrc1BlclNjYW5saW5lICogKGogJiBtYXNrM0xTQikgfCAoaiAmIDcpIDw8IDM7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IG91dHB1dFtpbmRleCArIHhTY2FsZUJsb2NrT2Zmc2V0W3hdXTsKICAgICAgICAgIG9mZnNldCArPSBudW1Db21wb25lbnRzOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHRyYW5zZm9ybSA9IHRoaXMuX2RlY29kZVRyYW5zZm9ybTsKICAgIGlmICghaXNTb3VyY2VQREYgJiYgbnVtQ29tcG9uZW50cyA9PT0gNCAmJiAhdHJhbnNmb3JtKSB7CiAgICAgIHRyYW5zZm9ybSA9IG5ldyBJbnQzMkFycmF5KFstMjU2LCAyNTUsIC0yNTYsIDI1NSwgLTI1NiwgMjU1LCAtMjU2LCAyNTVdKTsKICAgIH0KICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGFMZW5ndGg7KSB7CiAgICAgICAgZm9yIChqID0gMCwgayA9IDA7IGogPCBudW1Db21wb25lbnRzOyBqKyssIGkrKywgayArPSAyKSB7CiAgICAgICAgICBkYXRhW2ldID0gKGRhdGFbaV0gKiB0cmFuc2Zvcm1ba10gPj4gOCkgKyB0cmFuc2Zvcm1bayArIDFdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCBfaXNDb2xvckNvbnZlcnNpb25OZWVkZWQoKSB7CiAgICBpZiAodGhpcy5hZG9iZSkgewogICAgICByZXR1cm4gISF0aGlzLmFkb2JlLnRyYW5zZm9ybUNvZGU7CiAgICB9CiAgICBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSAzKSB7CiAgICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbXBvbmVudHNbMF0uaW5kZXggPT09IDB4NTIgJiYgdGhpcy5jb21wb25lbnRzWzFdLmluZGV4ID09PSAweDQ3ICYmIHRoaXMuY29tcG9uZW50c1syXS5pbmRleCA9PT0gMHg0MikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYihkYXRhKSB7CiAgICBsZXQgWSwgQ2IsIENyOwogICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMpIHsKICAgICAgWSA9IGRhdGFbaV07CiAgICAgIENiID0gZGF0YVtpICsgMV07CiAgICAgIENyID0gZGF0YVtpICsgMl07CiAgICAgIGRhdGFbaV0gPSBZIC0gMTc5LjQ1NiArIDEuNDAyICogQ3I7CiAgICAgIGRhdGFbaSArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgZGF0YVtpICsgMl0gPSBZIC0gMjI2LjgxNiArIDEuNzcyICogQ2I7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYmEoZGF0YSwgb3V0KSB7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMsIGogKz0gNCkgewogICAgICBjb25zdCBZID0gZGF0YVtpXTsKICAgICAgY29uc3QgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgY29uc3QgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgb3V0W2pdID0gWSAtIDE3OS40NTYgKyAxLjQwMiAqIENyOwogICAgICBvdXRbaiArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgb3V0W2ogKyAyXSA9IFkgLSAyMjYuODE2ICsgMS43NzIgKiBDYjsKICAgICAgb3V0W2ogKyAzXSA9IDI1NTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiKGRhdGEpIHsKICAgIHRoaXMuX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpOwogICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRDbXlrVG9SZ2IoZGF0YSk7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiYShkYXRhKSB7CiAgICB0aGlzLl9jb252ZXJ0WWNja1RvQ215ayhkYXRhKTsKICAgIHJldHVybiB0aGlzLl9jb252ZXJ0Q215a1RvUmdiYShkYXRhKTsKICB9CiAgX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpIHsKICAgIGxldCBZLCBDYiwgQ3I7CiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICBZID0gZGF0YVtpXTsKICAgICAgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgZGF0YVtpXSA9IDQzNC40NTYgLSBZIC0gMS40MDIgKiBDcjsKICAgICAgZGF0YVtpICsgMV0gPSAxMTkuNTQxIC0gWSArIDAuMzQ0ICogQ2IgKyAwLjcxNCAqIENyOwogICAgICBkYXRhW2kgKyAyXSA9IDQ4MS44MTYgLSBZIC0gMS43NzIgKiBDYjsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBfY29udmVydENteWtUb1JnYihkYXRhKSB7CiAgICBjb25zdCBjb3VudCA9IGRhdGEubGVuZ3RoIC8gNDsKICAgIENvbG9yU3BhY2VVdGlscy5jbXlrLmdldFJnYkJ1ZmZlcihkYXRhLCAwLCBjb3VudCwgZGF0YSwgMCwgOCwgMCk7CiAgICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBjb3VudCAqIDMpOwogIH0KICBfY29udmVydENteWtUb1JnYmEoZGF0YSkgewogICAgQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiQnVmZmVyKGRhdGEsIDAsIGRhdGEubGVuZ3RoIC8gNCwgZGF0YSwgMCwgOCwgMSk7CiAgICBpZiAoQ29sb3JTcGFjZVV0aWxzLmNteWsgaW5zdGFuY2VvZiBEZXZpY2VDbXlrQ1MpIHsKICAgICAgZm9yIChsZXQgaSA9IDMsIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSArPSA0KSB7CiAgICAgICAgZGF0YVtpXSA9IDI1NTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldERhdGEoewogICAgd2lkdGgsCiAgICBoZWlnaHQsCiAgICBmb3JjZVJHQkEgPSBmYWxzZSwKICAgIGZvcmNlUkdCID0gZmFsc2UsCiAgICBpc1NvdXJjZVBERiA9IGZhbHNlCiAgfSkgewogICAgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA+IDQpIHsKICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiVW5zdXBwb3J0ZWQgY29sb3IgbW9kZSIpOwogICAgfQogICAgY29uc3QgZGF0YSA9IHRoaXMuX2dldExpbmVhcml6ZWRCbG9ja0RhdGEod2lkdGgsIGhlaWdodCwgaXNTb3VyY2VQREYpOwogICAgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gMSAmJiAoZm9yY2VSR0JBIHx8IGZvcmNlUkdCKSkgewogICAgICBjb25zdCBsZW4gPSBkYXRhLmxlbmd0aCAqIChmb3JjZVJHQkEgPyA0IDogMyk7CiAgICAgIGNvbnN0IHJnYmFEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGxlbik7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgZ3JheVRvUkdCQShkYXRhLCBuZXcgVWludDMyQXJyYXkocmdiYURhdGEuYnVmZmVyKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBncmF5Q29sb3Igb2YgZGF0YSkgewogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmdiYURhdGE7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gMyAmJiB0aGlzLl9pc0NvbG9yQ29udmVyc2lvbk5lZWRlZCkgewogICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgY29uc3QgcmdiYURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YS5sZW5ndGggLyAzICogNCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NUb1JnYmEoZGF0YSwgcmdiYURhdGEpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0WWNjVG9SZ2IoZGF0YSk7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gNCkgewogICAgICBpZiAodGhpcy5faXNDb2xvckNvbnZlcnNpb25OZWVkZWQpIHsKICAgICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydFljY2tUb1JnYmEoZGF0YSk7CiAgICAgICAgfQogICAgICAgIGlmIChmb3JjZVJHQikgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NrVG9SZ2IoZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0WWNja1RvQ215ayhkYXRhKTsKICAgICAgfSBlbHNlIGlmIChmb3JjZVJHQkEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydENteWtUb1JnYmEoZGF0YSk7CiAgICAgIH0gZWxzZSBpZiAoZm9yY2VSR0IpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydENteWtUb1JnYihkYXRhKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9qcGVnX3N0cmVhbS5qcwoKCgoKY2xhc3MgSnBlZ1N0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgc3RhdGljICNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IEZlYXR1cmVUZXN0LmlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIGNvbnN0cnVjdG9yKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmRpY3QgPSBzdHJlYW0uZGljdDsKICAgIHRoaXMubWF5YmVMZW5ndGggPSBtYXliZUxlbmd0aDsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zOwogIH0KICBzdGF0aWMgZ2V0IGNhblVzZUltYWdlRGVjb2RlcigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImNhblVzZUltYWdlRGVjb2RlciIsIHRoaXMuI2lzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID8gSW1hZ2VEZWNvZGVyLmlzVHlwZVN1cHBvcnRlZCgiaW1hZ2UvanBlZyIpIDogUHJvbWlzZS5yZXNvbHZlKGZhbHNlKSk7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID0gZmFsc2UKICB9KSB7CiAgICB0aGlzLiNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIH0KICBnZXQgYnl0ZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJieXRlcyIsIHRoaXMuc3RyZWFtLmdldEJ5dGVzKHRoaXMubWF5YmVMZW5ndGgpKTsKICB9CiAgZW5zdXJlQnVmZmVyKHJlcXVlc3RlZCkge30KICByZWFkQmxvY2soKSB7CiAgICB0aGlzLmRlY29kZUltYWdlKCk7CiAgfQogIGdldCBqcGVnT3B0aW9ucygpIHsKICAgIGNvbnN0IGpwZWdPcHRpb25zID0gewogICAgICBkZWNvZGVUcmFuc2Zvcm06IHVuZGVmaW5lZCwKICAgICAgY29sb3JUcmFuc2Zvcm06IHVuZGVmaW5lZAogICAgfTsKICAgIGNvbnN0IGRlY29kZUFyciA9IHRoaXMuZGljdC5nZXRBcnJheSgiRCIsICJEZWNvZGUiKTsKICAgIGlmICgodGhpcy5mb3JjZVJHQkEgfHwgdGhpcy5mb3JjZVJHQikgJiYgQXJyYXkuaXNBcnJheShkZWNvZGVBcnIpKSB7CiAgICAgIGNvbnN0IGJpdHNQZXJDb21wb25lbnQgPSB0aGlzLmRpY3QuZ2V0KCJCUEMiLCAiQml0c1BlckNvbXBvbmVudCIpIHx8IDg7CiAgICAgIGNvbnN0IGRlY29kZUFyckxlbmd0aCA9IGRlY29kZUFyci5sZW5ndGg7CiAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IG5ldyBJbnQzMkFycmF5KGRlY29kZUFyckxlbmd0aCk7CiAgICAgIGxldCB0cmFuc2Zvcm1OZWVkZWQgPSBmYWxzZTsKICAgICAgY29uc3QgbWF4VmFsdWUgPSAoMSA8PCBiaXRzUGVyQ29tcG9uZW50KSAtIDE7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVjb2RlQXJyTGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICB0cmFuc2Zvcm1baV0gPSAoZGVjb2RlQXJyW2kgKyAxXSAtIGRlY29kZUFycltpXSkgKiAyNTYgfCAwOwogICAgICAgIHRyYW5zZm9ybVtpICsgMV0gPSBkZWNvZGVBcnJbaV0gKiBtYXhWYWx1ZSB8IDA7CiAgICAgICAgaWYgKHRyYW5zZm9ybVtpXSAhPT0gMjU2IHx8IHRyYW5zZm9ybVtpICsgMV0gIT09IDApIHsKICAgICAgICAgIHRyYW5zZm9ybU5lZWRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0cmFuc2Zvcm1OZWVkZWQpIHsKICAgICAgICBqcGVnT3B0aW9ucy5kZWNvZGVUcmFuc2Zvcm0gPSB0cmFuc2Zvcm07CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLnBhcmFtcyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgY29sb3JUcmFuc2Zvcm0gPSB0aGlzLnBhcmFtcy5nZXQoIkNvbG9yVHJhbnNmb3JtIik7CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvbG9yVHJhbnNmb3JtKSkgewogICAgICAgIGpwZWdPcHRpb25zLmNvbG9yVHJhbnNmb3JtID0gY29sb3JUcmFuc2Zvcm07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImpwZWdPcHRpb25zIiwganBlZ09wdGlvbnMpOwogIH0KICAjc2tpcFVzZWxlc3NCeXRlcyhkYXRhKSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aCAtIDE7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGlmIChkYXRhW2ldID09PSAweGZmICYmIGRhdGFbaSArIDFdID09PSAweGQ4KSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShpKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBkZWNvZGVJbWFnZShieXRlcykgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgIH0KICAgIGJ5dGVzID0gdGhpcy4jc2tpcFVzZWxlc3NCeXRlcyhieXRlcyB8fCB0aGlzLmJ5dGVzKTsKICAgIGNvbnN0IGpwZWdJbWFnZSA9IG5ldyBKcGVnSW1hZ2UodGhpcy5qcGVnT3B0aW9ucyk7CiAgICBqcGVnSW1hZ2UucGFyc2UoYnl0ZXMpOwogICAgY29uc3QgZGF0YSA9IGpwZWdJbWFnZS5nZXREYXRhKHsKICAgICAgd2lkdGg6IHRoaXMuZHJhd1dpZHRoLAogICAgICBoZWlnaHQ6IHRoaXMuZHJhd0hlaWdodCwKICAgICAgZm9yY2VSR0JBOiB0aGlzLmZvcmNlUkdCQSwKICAgICAgZm9yY2VSR0I6IHRoaXMuZm9yY2VSR0IsCiAgICAgIGlzU291cmNlUERGOiB0cnVlCiAgICB9KTsKICAgIHRoaXMuYnVmZmVyID0gZGF0YTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICB0aGlzLmVvZiA9IHRydWU7CiAgICByZXR1cm4gdGhpcy5idWZmZXI7CiAgfQogIGdldCBjYW5Bc3luY0RlY29kZUltYWdlRnJvbUJ1ZmZlcigpIHsKICAgIHJldHVybiB0aGlzLnN0cmVhbS5pc0FzeW5jOwogIH0KICBhc3luYyBnZXRUcmFuc2ZlcmFibGVJbWFnZSgpIHsKICAgIGlmICghKGF3YWl0IEpwZWdTdHJlYW0uY2FuVXNlSW1hZ2VEZWNvZGVyKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGpwZWdPcHRpb25zID0gdGhpcy5qcGVnT3B0aW9uczsKICAgIGlmIChqcGVnT3B0aW9ucy5kZWNvZGVUcmFuc2Zvcm0pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgZGVjb2RlcjsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5jYW5Bc3luY0RlY29kZUltYWdlRnJvbUJ1ZmZlciAmJiAoYXdhaXQgdGhpcy5zdHJlYW0uYXN5bmNHZXRCeXRlcygpKSB8fCB0aGlzLmJ5dGVzOwogICAgICBpZiAoIWJ5dGVzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgbGV0IGRhdGEgPSB0aGlzLiNza2lwVXNlbGVzc0J5dGVzKGJ5dGVzKTsKICAgICAgY29uc3QgdXNlSW1hZ2VEZWNvZGVyID0gSnBlZ0ltYWdlLmNhblVzZUltYWdlRGVjb2RlcihkYXRhLCBqcGVnT3B0aW9ucy5jb2xvclRyYW5zZm9ybSk7CiAgICAgIGlmICghdXNlSW1hZ2VEZWNvZGVyKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHVzZUltYWdlRGVjb2Rlci5leGlmU3RhcnQpIHsKICAgICAgICBkYXRhID0gZGF0YS5zbGljZSgpOwogICAgICAgIGRhdGEuZmlsbCgweDAwLCB1c2VJbWFnZURlY29kZXIuZXhpZlN0YXJ0LCB1c2VJbWFnZURlY29kZXIuZXhpZkVuZCk7CiAgICAgIH0KICAgICAgZGVjb2RlciA9IG5ldyBJbWFnZURlY29kZXIoewogICAgICAgIGRhdGEsCiAgICAgICAgdHlwZTogImltYWdlL2pwZWciLAogICAgICAgIHByZWZlckFuaW1hdGlvbjogZmFsc2UKICAgICAgfSk7CiAgICAgIHJldHVybiAoYXdhaXQgZGVjb2Rlci5kZWNvZGUoKSkuaW1hZ2U7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgZ2V0VHJhbnNmZXJhYmxlSW1hZ2UgLSBmYWlsZWQ6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZmluYWxseSB7CiAgICAgIGRlY29kZXI/LmNsb3NlKCk7CiAgICB9CiAgfQp9Cgo7Ly8gLi9leHRlcm5hbC9vcGVuanBlZy9vcGVuanBlZy5qcwphc3luYyBmdW5jdGlvbiBPcGVuSlBFRyhtb2R1bGVBcmcgPSB7fSkgewogIHZhciBtb2R1bGVSdG47CiAgdmFyIE1vZHVsZSA9IG1vZHVsZUFyZzsKICB2YXIgRU5WSVJPTk1FTlRfSVNfV0VCID0gdHJ1ZTsKICB2YXIgRU5WSVJPTk1FTlRfSVNfV09SS0VSID0gZmFsc2U7CiAgdmFyIGFyZ3VtZW50c18gPSBbXTsKICB2YXIgdGhpc1Byb2dyYW0gPSAiLi90aGlzLnByb2dyYW0iOwogIHZhciBxdWl0XyA9IChzdGF0dXMsIHRvVGhyb3cpID0+IHsKICAgIHRocm93IHRvVGhyb3c7CiAgfTsKICB2YXIgX3NjcmlwdE5hbWUgPSBpbXBvcnQubWV0YS51cmw7CiAgdmFyIHNjcmlwdERpcmVjdG9yeSA9ICIiOwogIHZhciByZWFkQXN5bmMsIHJlYWRCaW5hcnk7CiAgaWYgKEVOVklST05NRU5UX0lTX1dFQiB8fCBFTlZJUk9OTUVOVF9JU19XT1JLRVIpIHsKICAgIHRyeSB7CiAgICAgIHNjcmlwdERpcmVjdG9yeSA9IG5ldyBVUkwoIi4iLCBfc2NyaXB0TmFtZSkuaHJlZjsKICAgIH0gY2F0Y2gge30KICAgIHJlYWRBc3luYyA9IGFzeW5jIHVybCA9PiB7CiAgICAgIHZhciByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgewogICAgICAgIGNyZWRlbnRpYWxzOiAic2FtZS1vcmlnaW4iCiAgICAgIH0pOwogICAgICBpZiAocmVzcG9uc2Uub2spIHsKICAgICAgICByZXR1cm4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzICsgIiA6ICIgKyByZXNwb25zZS51cmwpOwogICAgfTsKICB9IGVsc2Uge30KICB2YXIgb3V0ID0gY29uc29sZS5sb2cuYmluZChjb25zb2xlKTsKICB2YXIgZXJyID0gY29uc29sZS5lcnJvci5iaW5kKGNvbnNvbGUpOwogIHZhciB3YXNtQmluYXJ5OwogIHZhciBBQk9SVCA9IGZhbHNlOwogIHZhciBFWElUU1RBVFVTOwogIHZhciByZWFkeVByb21pc2VSZXNvbHZlLCByZWFkeVByb21pc2VSZWplY3Q7CiAgdmFyIHdhc21NZW1vcnk7CiAgdmFyIEhFQVA4LCBIRUFQVTgsIEhFQVAxNiwgSEVBUFUxNiwgSEVBUDMyLCBIRUFQVTMyLCBIRUFQRjMyLCBIRUFQRjY0OwogIHZhciBIRUFQNjQsIEhFQVBVNjQ7CiAgdmFyIHJ1bnRpbWVJbml0aWFsaXplZCA9IGZhbHNlOwogIGZ1bmN0aW9uIHVwZGF0ZU1lbW9yeVZpZXdzKCkgewogICAgdmFyIGIgPSB3YXNtTWVtb3J5LmJ1ZmZlcjsKICAgIEhFQVA4ID0gbmV3IEludDhBcnJheShiKTsKICAgIEhFQVAxNiA9IG5ldyBJbnQxNkFycmF5KGIpOwogICAgSEVBUFU4ID0gbmV3IFVpbnQ4QXJyYXkoYik7CiAgICBIRUFQVTE2ID0gbmV3IFVpbnQxNkFycmF5KGIpOwogICAgSEVBUDMyID0gbmV3IEludDMyQXJyYXkoYik7CiAgICBIRUFQVTMyID0gbmV3IFVpbnQzMkFycmF5KGIpOwogICAgSEVBUEYzMiA9IG5ldyBGbG9hdDMyQXJyYXkoYik7CiAgICBIRUFQRjY0ID0gbmV3IEZsb2F0NjRBcnJheShiKTsKICAgIEhFQVA2NCA9IG5ldyBCaWdJbnQ2NEFycmF5KGIpOwogICAgSEVBUFU2NCA9IG5ldyBCaWdVaW50NjRBcnJheShiKTsKICB9CiAgZnVuY3Rpb24gcHJlUnVuKCkgewogICAgaWYgKE1vZHVsZVsicHJlUnVuIl0pIHsKICAgICAgaWYgKHR5cGVvZiBNb2R1bGVbInByZVJ1biJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicHJlUnVuIl0gPSBbTW9kdWxlWyJwcmVSdW4iXV07CiAgICAgIHdoaWxlIChNb2R1bGVbInByZVJ1biJdLmxlbmd0aCkgewogICAgICAgIGFkZE9uUHJlUnVuKE1vZHVsZVsicHJlUnVuIl0uc2hpZnQoKSk7CiAgICAgIH0KICAgIH0KICAgIGNhbGxSdW50aW1lQ2FsbGJhY2tzKG9uUHJlUnVucyk7CiAgfQogIGZ1bmN0aW9uIGluaXRSdW50aW1lKCkgewogICAgcnVudGltZUluaXRpYWxpemVkID0gdHJ1ZTsKICAgIHdhc21FeHBvcnRzWyJzIl0oKTsKICB9CiAgZnVuY3Rpb24gcG9zdFJ1bigpIHsKICAgIGlmIChNb2R1bGVbInBvc3RSdW4iXSkgewogICAgICBpZiAodHlwZW9mIE1vZHVsZVsicG9zdFJ1biJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicG9zdFJ1biJdID0gW01vZHVsZVsicG9zdFJ1biJdXTsKICAgICAgd2hpbGUgKE1vZHVsZVsicG9zdFJ1biJdLmxlbmd0aCkgewogICAgICAgIGFkZE9uUG9zdFJ1bihNb2R1bGVbInBvc3RSdW4iXS5zaGlmdCgpKTsKICAgICAgfQogICAgfQogICAgY2FsbFJ1bnRpbWVDYWxsYmFja3Mob25Qb3N0UnVucyk7CiAgfQogIGZ1bmN0aW9uIGFib3J0KHdoYXQpIHsKICAgIE1vZHVsZVsib25BYm9ydCJdPy4od2hhdCk7CiAgICB3aGF0ID0gIkFib3J0ZWQoIiArIHdoYXQgKyAiKSI7CiAgICBlcnIod2hhdCk7CiAgICBBQk9SVCA9IHRydWU7CiAgICB3aGF0ICs9ICIuIEJ1aWxkIHdpdGggLXNBU1NFUlRJT05TIGZvciBtb3JlIGluZm8uIjsKICAgIHZhciBlID0gbmV3IFdlYkFzc2VtYmx5LlJ1bnRpbWVFcnJvcih3aGF0KTsKICAgIHJlYWR5UHJvbWlzZVJlamVjdD8uKGUpOwogICAgdGhyb3cgZTsKICB9CiAgdmFyIHdhc21CaW5hcnlGaWxlOwogIGZ1bmN0aW9uIGdldFdhc21JbXBvcnRzKCkgewogICAgcmV0dXJuIHsKICAgICAgYTogd2FzbUltcG9ydHMKICAgIH07CiAgfQogIGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVdhc20oKSB7CiAgICBmdW5jdGlvbiByZWNlaXZlSW5zdGFuY2UoaW5zdGFuY2UsIG1vZHVsZSkgewogICAgICB3YXNtRXhwb3J0cyA9IGluc3RhbmNlLmV4cG9ydHM7CiAgICAgIHdhc21NZW1vcnkgPSB3YXNtRXhwb3J0c1siciJdOwogICAgICB1cGRhdGVNZW1vcnlWaWV3cygpOwogICAgICBhc3NpZ25XYXNtRXhwb3J0cyh3YXNtRXhwb3J0cyk7CiAgICAgIHJldHVybiB3YXNtRXhwb3J0czsKICAgIH0KICAgIHZhciBpbmZvID0gZ2V0V2FzbUltcG9ydHMoKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIE1vZHVsZVsiaW5zdGFudGlhdGVXYXNtIl0oaW5mbywgKG1vZCwgaW5zdCkgPT4gewogICAgICAgIHJlc29sdmUocmVjZWl2ZUluc3RhbmNlKG1vZCwgaW5zdCkpOwogICAgICB9KTsKICAgIH0pOwogIH0KICBjbGFzcyBFeGl0U3RhdHVzIHsKICAgIG5hbWUgPSAiRXhpdFN0YXR1cyI7CiAgICBjb25zdHJ1Y3RvcihzdGF0dXMpIHsKICAgICAgdGhpcy5tZXNzYWdlID0gYFByb2dyYW0gdGVybWluYXRlZCB3aXRoIGV4aXQoJHtzdGF0dXN9KWA7CiAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzOwogICAgfQogIH0KICB2YXIgY2FsbFJ1bnRpbWVDYWxsYmFja3MgPSBjYWxsYmFja3MgPT4gewogICAgd2hpbGUgKGNhbGxiYWNrcy5sZW5ndGggPiAwKSB7CiAgICAgIGNhbGxiYWNrcy5zaGlmdCgpKE1vZHVsZSk7CiAgICB9CiAgfTsKICB2YXIgb25Qb3N0UnVucyA9IFtdOwogIHZhciBhZGRPblBvc3RSdW4gPSBjYiA9PiBvblBvc3RSdW5zLnB1c2goY2IpOwogIHZhciBvblByZVJ1bnMgPSBbXTsKICB2YXIgYWRkT25QcmVSdW4gPSBjYiA9PiBvblByZVJ1bnMucHVzaChjYik7CiAgdmFyIG5vRXhpdFJ1bnRpbWUgPSB0cnVlOwogIHZhciBfX2Fib3J0X2pzID0gKCkgPT4gYWJvcnQoIiIpOwogIHZhciBydW50aW1lS2VlcGFsaXZlQ291bnRlciA9IDA7CiAgdmFyIF9fZW1zY3JpcHRlbl9ydW50aW1lX2tlZXBhbGl2ZV9jbGVhciA9ICgpID0+IHsKICAgIG5vRXhpdFJ1bnRpbWUgPSBmYWxzZTsKICAgIHJ1bnRpbWVLZWVwYWxpdmVDb3VudGVyID0gMDsKICB9OwogIHZhciB0aW1lcnMgPSB7fTsKICB2YXIgaGFuZGxlRXhjZXB0aW9uID0gZSA9PiB7CiAgICBpZiAoZSBpbnN0YW5jZW9mIEV4aXRTdGF0dXMgfHwgZSA9PSAidW53aW5kIikgewogICAgICByZXR1cm4gRVhJVFNUQVRVUzsKICAgIH0KICAgIHF1aXRfKDEsIGUpOwogIH07CiAgdmFyIGtlZXBSdW50aW1lQWxpdmUgPSAoKSA9PiBub0V4aXRSdW50aW1lIHx8IHJ1bnRpbWVLZWVwYWxpdmVDb3VudGVyID4gMDsKICB2YXIgX3Byb2NfZXhpdCA9IGNvZGUgPT4gewogICAgRVhJVFNUQVRVUyA9IGNvZGU7CiAgICBpZiAoIWtlZXBSdW50aW1lQWxpdmUoKSkgewogICAgICBNb2R1bGVbIm9uRXhpdCJdPy4oY29kZSk7CiAgICAgIEFCT1JUID0gdHJ1ZTsKICAgIH0KICAgIHF1aXRfKGNvZGUsIG5ldyBFeGl0U3RhdHVzKGNvZGUpKTsKICB9OwogIHZhciBleGl0SlMgPSAoc3RhdHVzLCBpbXBsaWNpdCkgPT4gewogICAgRVhJVFNUQVRVUyA9IHN0YXR1czsKICAgIF9wcm9jX2V4aXQoc3RhdHVzKTsKICB9OwogIHZhciBfZXhpdCA9IGV4aXRKUzsKICB2YXIgbWF5YmVFeGl0ID0gKCkgPT4gewogICAgaWYgKCFrZWVwUnVudGltZUFsaXZlKCkpIHsKICAgICAgdHJ5IHsKICAgICAgICBfZXhpdChFWElUU1RBVFVTKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGhhbmRsZUV4Y2VwdGlvbihlKTsKICAgICAgfQogICAgfQogIH07CiAgdmFyIGNhbGxVc2VyQ2FsbGJhY2sgPSBmdW5jID0+IHsKICAgIGlmIChBQk9SVCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICBmdW5jKCk7CiAgICAgIG1heWJlRXhpdCgpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVFeGNlcHRpb24oZSk7CiAgICB9CiAgfTsKICB2YXIgX2Vtc2NyaXB0ZW5fZ2V0X25vdyA9ICgpID0+IHBlcmZvcm1hbmNlLm5vdygpOwogIHZhciBfX3NldGl0aW1lcl9qcyA9ICh3aGljaCwgdGltZW91dF9tcykgPT4gewogICAgaWYgKHRpbWVyc1t3aGljaF0pIHsKICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyc1t3aGljaF0uaWQpOwogICAgICBkZWxldGUgdGltZXJzW3doaWNoXTsKICAgIH0KICAgIGlmICghdGltZW91dF9tcykgcmV0dXJuIDA7CiAgICB2YXIgaWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgZGVsZXRlIHRpbWVyc1t3aGljaF07CiAgICAgIGNhbGxVc2VyQ2FsbGJhY2soKCkgPT4gX19lbXNjcmlwdGVuX3RpbWVvdXQod2hpY2gsIF9lbXNjcmlwdGVuX2dldF9ub3coKSkpOwogICAgfSwgdGltZW91dF9tcyk7CiAgICB0aW1lcnNbd2hpY2hdID0gewogICAgICBpZCwKICAgICAgdGltZW91dF9tcwogICAgfTsKICAgIHJldHVybiAwOwogIH07CiAgZnVuY3Rpb24gX2NvcHlfcGl4ZWxzXzEoY29tcEdfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzKTsKICAgIGNvbnN0IGNvbXBHID0gSEVBUDMyLnN1YmFycmF5KGNvbXBHX3B0ciwgY29tcEdfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGltYWdlRGF0YS5zZXQoY29tcEcpOwogIH0KICBmdW5jdGlvbiBfY29weV9waXhlbHNfMyhjb21wUl9wdHIsIGNvbXBHX3B0ciwgY29tcEJfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBSX3B0ciA+Pj0gMjsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbXBCX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzICogMyk7CiAgICBjb25zdCBjb21wUiA9IEhFQVAzMi5zdWJhcnJheShjb21wUl9wdHIsIGNvbXBSX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQiA9IEhFQVAzMi5zdWJhcnJheShjb21wQl9wdHIsIGNvbXBCX3B0ciArIG5iX3BpeGVscyk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iX3BpeGVsczsgaSsrKSB7CiAgICAgIGltYWdlRGF0YVszICogaV0gPSBjb21wUltpXTsKICAgICAgaW1hZ2VEYXRhWzMgKiBpICsgMV0gPSBjb21wR1tpXTsKICAgICAgaW1hZ2VEYXRhWzMgKiBpICsgMl0gPSBjb21wQltpXTsKICAgIH0KICB9CiAgZnVuY3Rpb24gX2NvcHlfcGl4ZWxzXzQoY29tcFJfcHRyLCBjb21wR19wdHIsIGNvbXBCX3B0ciwgY29tcEFfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBSX3B0ciA+Pj0gMjsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbXBCX3B0ciA+Pj0gMjsKICAgIGNvbXBBX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzICogNCk7CiAgICBjb25zdCBjb21wUiA9IEhFQVAzMi5zdWJhcnJheShjb21wUl9wdHIsIGNvbXBSX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQiA9IEhFQVAzMi5zdWJhcnJheShjb21wQl9wdHIsIGNvbXBCX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQSA9IEhFQVAzMi5zdWJhcnJheShjb21wQV9wdHIsIGNvbXBBX3B0ciArIG5iX3BpeGVscyk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iX3BpeGVsczsgaSsrKSB7CiAgICAgIGltYWdlRGF0YVs0ICogaV0gPSBjb21wUltpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgMV0gPSBjb21wR1tpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgMl0gPSBjb21wQltpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgM10gPSBjb21wQVtpXTsKICAgIH0KICB9CiAgdmFyIGdldEhlYXBNYXggPSAoKSA9PiAyMTQ3NDgzNjQ4OwogIHZhciBhbGlnbk1lbW9yeSA9IChzaXplLCBhbGlnbm1lbnQpID0+IE1hdGguY2VpbChzaXplIC8gYWxpZ25tZW50KSAqIGFsaWdubWVudDsKICB2YXIgZ3Jvd01lbW9yeSA9IHNpemUgPT4gewogICAgdmFyIG9sZEhlYXBTaXplID0gd2FzbU1lbW9yeS5idWZmZXIuYnl0ZUxlbmd0aDsKICAgIHZhciBwYWdlcyA9IChzaXplIC0gb2xkSGVhcFNpemUgKyA2NTUzNSkgLyA2NTUzNiB8IDA7CiAgICB0cnkgewogICAgICB3YXNtTWVtb3J5Lmdyb3cocGFnZXMpOwogICAgICB1cGRhdGVNZW1vcnlWaWV3cygpOwogICAgICByZXR1cm4gMTsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfTsKICB2YXIgX2Vtc2NyaXB0ZW5fcmVzaXplX2hlYXAgPSByZXF1ZXN0ZWRTaXplID0+IHsKICAgIHZhciBvbGRTaXplID0gSEVBUFU4Lmxlbmd0aDsKICAgIHJlcXVlc3RlZFNpemUgPj4+PSAwOwogICAgdmFyIG1heEhlYXBTaXplID0gZ2V0SGVhcE1heCgpOwogICAgaWYgKHJlcXVlc3RlZFNpemUgPiBtYXhIZWFwU2l6ZSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmb3IgKHZhciBjdXREb3duID0gMTsgY3V0RG93biA8PSA0OyBjdXREb3duICo9IDIpIHsKICAgICAgdmFyIG92ZXJHcm93bkhlYXBTaXplID0gb2xkU2l6ZSAqICgxICsgLjIgLyBjdXREb3duKTsKICAgICAgb3Zlckdyb3duSGVhcFNpemUgPSBNYXRoLm1pbihvdmVyR3Jvd25IZWFwU2l6ZSwgcmVxdWVzdGVkU2l6ZSArIDEwMDY2MzI5Nik7CiAgICAgIHZhciBuZXdTaXplID0gTWF0aC5taW4obWF4SGVhcFNpemUsIGFsaWduTWVtb3J5KE1hdGgubWF4KHJlcXVlc3RlZFNpemUsIG92ZXJHcm93bkhlYXBTaXplKSwgNjU1MzYpKTsKICAgICAgdmFyIHJlcGxhY2VtZW50ID0gZ3Jvd01lbW9yeShuZXdTaXplKTsKICAgICAgaWYgKHJlcGxhY2VtZW50KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwogIHZhciBFTlYgPSB7fTsKICB2YXIgZ2V0RXhlY3V0YWJsZU5hbWUgPSAoKSA9PiB0aGlzUHJvZ3JhbSB8fCAiLi90aGlzLnByb2dyYW0iOwogIHZhciBnZXRFbnZTdHJpbmdzID0gKCkgPT4gewogICAgaWYgKCFnZXRFbnZTdHJpbmdzLnN0cmluZ3MpIHsKICAgICAgdmFyIGxhbmcgPSAodHlwZW9mIG5hdmlnYXRvciA9PSAib2JqZWN0IiAmJiBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgIkMiKS5yZXBsYWNlKCItIiwgIl8iKSArICIuVVRGLTgiOwogICAgICB2YXIgZW52ID0gewogICAgICAgIFVTRVI6ICJ3ZWJfdXNlciIsCiAgICAgICAgTE9HTkFNRTogIndlYl91c2VyIiwKICAgICAgICBQQVRIOiAiLyIsCiAgICAgICAgUFdEOiAiLyIsCiAgICAgICAgSE9NRTogIi9ob21lL3dlYl91c2VyIiwKICAgICAgICBMQU5HOiBsYW5nLAogICAgICAgIF86IGdldEV4ZWN1dGFibGVOYW1lKCkKICAgICAgfTsKICAgICAgZm9yICh2YXIgeCBpbiBFTlYpIHsKICAgICAgICBpZiAoRU5WW3hdID09PSB1bmRlZmluZWQpIGRlbGV0ZSBlbnZbeF07ZWxzZSBlbnZbeF0gPSBFTlZbeF07CiAgICAgIH0KICAgICAgdmFyIHN0cmluZ3MgPSBbXTsKICAgICAgZm9yICh2YXIgeCBpbiBlbnYpIHsKICAgICAgICBzdHJpbmdzLnB1c2goYCR7eH09JHtlbnZbeF19YCk7CiAgICAgIH0KICAgICAgZ2V0RW52U3RyaW5ncy5zdHJpbmdzID0gc3RyaW5nczsKICAgIH0KICAgIHJldHVybiBnZXRFbnZTdHJpbmdzLnN0cmluZ3M7CiAgfTsKICB2YXIgc3RyaW5nVG9VVEY4QXJyYXkgPSAoc3RyLCBoZWFwLCBvdXRJZHgsIG1heEJ5dGVzVG9Xcml0ZSkgPT4gewogICAgaWYgKCEobWF4Qnl0ZXNUb1dyaXRlID4gMCkpIHJldHVybiAwOwogICAgdmFyIHN0YXJ0SWR4ID0gb3V0SWR4OwogICAgdmFyIGVuZElkeCA9IG91dElkeCArIG1heEJ5dGVzVG9Xcml0ZSAtIDE7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgICB2YXIgdSA9IHN0ci5jb2RlUG9pbnRBdChpKTsKICAgICAgaWYgKHUgPD0gMTI3KSB7CiAgICAgICAgaWYgKG91dElkeCA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gdTsKICAgICAgfSBlbHNlIGlmICh1IDw9IDIwNDcpIHsKICAgICAgICBpZiAob3V0SWR4ICsgMSA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTkyIHwgdSA+PiA2OwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSAmIDYzOwogICAgICB9IGVsc2UgaWYgKHUgPD0gNjU1MzUpIHsKICAgICAgICBpZiAob3V0SWR4ICsgMiA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMjI0IHwgdSA+PiAxMjsKICAgICAgICBoZWFwW291dElkeCsrXSA9IDEyOCB8IHUgPj4gNiAmIDYzOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSAmIDYzOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChvdXRJZHggKyAzID49IGVuZElkeCkgYnJlYWs7CiAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAyNDAgfCB1ID4+IDE4OwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSA+PiAxMiAmIDYzOwogICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSA+PiA2ICYgNjM7CiAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAxMjggfCB1ICYgNjM7CiAgICAgICAgaSsrOwogICAgICB9CiAgICB9CiAgICBoZWFwW291dElkeF0gPSAwOwogICAgcmV0dXJuIG91dElkeCAtIHN0YXJ0SWR4OwogIH07CiAgdmFyIHN0cmluZ1RvVVRGOCA9IChzdHIsIG91dFB0ciwgbWF4Qnl0ZXNUb1dyaXRlKSA9PiBzdHJpbmdUb1VURjhBcnJheShzdHIsIEhFQVBVOCwgb3V0UHRyLCBtYXhCeXRlc1RvV3JpdGUpOwogIHZhciBfZW52aXJvbl9nZXQgPSAoX19lbnZpcm9uLCBlbnZpcm9uX2J1ZikgPT4gewogICAgdmFyIGJ1ZlNpemUgPSAwOwogICAgdmFyIGVudnAgPSAwOwogICAgZm9yICh2YXIgc3RyaW5nIG9mIGdldEVudlN0cmluZ3MoKSkgewogICAgICB2YXIgcHRyID0gZW52aXJvbl9idWYgKyBidWZTaXplOwogICAgICBIRUFQVTMyW19fZW52aXJvbiArIGVudnAgPj4gMl0gPSBwdHI7CiAgICAgIGJ1ZlNpemUgKz0gc3RyaW5nVG9VVEY4KHN0cmluZywgcHRyLCBJbmZpbml0eSkgKyAxOwogICAgICBlbnZwICs9IDQ7CiAgICB9CiAgICByZXR1cm4gMDsKICB9OwogIHZhciBsZW5ndGhCeXRlc1VURjggPSBzdHIgPT4gewogICAgdmFyIGxlbiA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgICB2YXIgYyA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICBpZiAoYyA8PSAxMjcpIHsKICAgICAgICBsZW4rKzsKICAgICAgfSBlbHNlIGlmIChjIDw9IDIwNDcpIHsKICAgICAgICBsZW4gKz0gMjsKICAgICAgfSBlbHNlIGlmIChjID49IDU1Mjk2ICYmIGMgPD0gNTczNDMpIHsKICAgICAgICBsZW4gKz0gNDsKICAgICAgICArK2k7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGVuICs9IDM7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBsZW47CiAgfTsKICB2YXIgX2Vudmlyb25fc2l6ZXNfZ2V0ID0gKHBlbnZpcm9uX2NvdW50LCBwZW52aXJvbl9idWZfc2l6ZSkgPT4gewogICAgdmFyIHN0cmluZ3MgPSBnZXRFbnZTdHJpbmdzKCk7CiAgICBIRUFQVTMyW3BlbnZpcm9uX2NvdW50ID4+IDJdID0gc3RyaW5ncy5sZW5ndGg7CiAgICB2YXIgYnVmU2l6ZSA9IDA7CiAgICBmb3IgKHZhciBzdHJpbmcgb2Ygc3RyaW5ncykgewogICAgICBidWZTaXplICs9IGxlbmd0aEJ5dGVzVVRGOChzdHJpbmcpICsgMTsKICAgIH0KICAgIEhFQVBVMzJbcGVudmlyb25fYnVmX3NpemUgPj4gMl0gPSBidWZTaXplOwogICAgcmV0dXJuIDA7CiAgfTsKICB2YXIgSU5UNTNfTUFYID0gOTAwNzE5OTI1NDc0MDk5MjsKICB2YXIgSU5UNTNfTUlOID0gLTkwMDcxOTkyNTQ3NDA5OTI7CiAgdmFyIGJpZ2ludFRvSTUzQ2hlY2tlZCA9IG51bSA9PiBudW0gPCBJTlQ1M19NSU4gfHwgbnVtID4gSU5UNTNfTUFYID8gTmFOIDogTnVtYmVyKG51bSk7CiAgZnVuY3Rpb24gX2ZkX3NlZWsoZmQsIG9mZnNldCwgd2hlbmNlLCBuZXdPZmZzZXQpIHsKICAgIG9mZnNldCA9IGJpZ2ludFRvSTUzQ2hlY2tlZChvZmZzZXQpOwogICAgcmV0dXJuIDcwOwogIH0KICB2YXIgcHJpbnRDaGFyQnVmZmVycyA9IFtudWxsLCBbXSwgW11dOwogIHZhciBVVEY4RGVjb2RlciA9IHR5cGVvZiBUZXh0RGVjb2RlciAhPSAidW5kZWZpbmVkIiA/IG5ldyBUZXh0RGVjb2RlcigpIDogdW5kZWZpbmVkOwogIHZhciBmaW5kU3RyaW5nRW5kID0gKGhlYXBPckFycmF5LCBpZHgsIG1heEJ5dGVzVG9SZWFkLCBpZ25vcmVOdWwpID0+IHsKICAgIHZhciBtYXhJZHggPSBpZHggKyBtYXhCeXRlc1RvUmVhZDsKICAgIGlmIChpZ25vcmVOdWwpIHJldHVybiBtYXhJZHg7CiAgICB3aGlsZSAoaGVhcE9yQXJyYXlbaWR4XSAmJiAhKGlkeCA+PSBtYXhJZHgpKSArK2lkeDsKICAgIHJldHVybiBpZHg7CiAgfTsKICB2YXIgVVRGOEFycmF5VG9TdHJpbmcgPSAoaGVhcE9yQXJyYXksIGlkeCA9IDAsIG1heEJ5dGVzVG9SZWFkLCBpZ25vcmVOdWwpID0+IHsKICAgIHZhciBlbmRQdHIgPSBmaW5kU3RyaW5nRW5kKGhlYXBPckFycmF5LCBpZHgsIG1heEJ5dGVzVG9SZWFkLCBpZ25vcmVOdWwpOwogICAgaWYgKGVuZFB0ciAtIGlkeCA+IDE2ICYmIGhlYXBPckFycmF5LmJ1ZmZlciAmJiBVVEY4RGVjb2RlcikgewogICAgICByZXR1cm4gVVRGOERlY29kZXIuZGVjb2RlKGhlYXBPckFycmF5LnN1YmFycmF5KGlkeCwgZW5kUHRyKSk7CiAgICB9CiAgICB2YXIgc3RyID0gIiI7CiAgICB3aGlsZSAoaWR4IDwgZW5kUHRyKSB7CiAgICAgIHZhciB1MCA9IGhlYXBPckFycmF5W2lkeCsrXTsKICAgICAgaWYgKCEodTAgJiAxMjgpKSB7CiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodTApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHZhciB1MSA9IGhlYXBPckFycmF5W2lkeCsrXSAmIDYzOwogICAgICBpZiAoKHUwICYgMjI0KSA9PSAxOTIpIHsKICAgICAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgodTAgJiAzMSkgPDwgNiB8IHUxKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB2YXIgdTIgPSBoZWFwT3JBcnJheVtpZHgrK10gJiA2MzsKICAgICAgaWYgKCh1MCAmIDI0MCkgPT0gMjI0KSB7CiAgICAgICAgdTAgPSAodTAgJiAxNSkgPDwgMTIgfCB1MSA8PCA2IHwgdTI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdTAgPSAodTAgJiA3KSA8PCAxOCB8IHUxIDw8IDEyIHwgdTIgPDwgNiB8IGhlYXBPckFycmF5W2lkeCsrXSAmIDYzOwogICAgICB9CiAgICAgIGlmICh1MCA8IDY1NTM2KSB7CiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodTApOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBjaCA9IHUwIC0gNjU1MzY7CiAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTYgfCBjaCA+PiAxMCwgNTYzMjAgfCBjaCAmIDEwMjMpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RyOwogIH07CiAgdmFyIHByaW50Q2hhciA9IChzdHJlYW0sIGN1cnIpID0+IHsKICAgIHZhciBidWZmZXIgPSBwcmludENoYXJCdWZmZXJzW3N0cmVhbV07CiAgICBpZiAoY3VyciA9PT0gMCB8fCBjdXJyID09PSAxMCkgewogICAgICAoc3RyZWFtID09PSAxID8gb3V0IDogZXJyKShVVEY4QXJyYXlUb1N0cmluZyhidWZmZXIpKTsKICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIucHVzaChjdXJyKTsKICAgIH0KICB9OwogIHZhciBVVEY4VG9TdHJpbmcgPSAocHRyLCBtYXhCeXRlc1RvUmVhZCwgaWdub3JlTnVsKSA9PiBwdHIgPyBVVEY4QXJyYXlUb1N0cmluZyhIRUFQVTgsIHB0ciwgbWF4Qnl0ZXNUb1JlYWQsIGlnbm9yZU51bCkgOiAiIjsKICB2YXIgX2ZkX3dyaXRlID0gKGZkLCBpb3YsIGlvdmNudCwgcG51bSkgPT4gewogICAgdmFyIG51bSA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlvdmNudDsgaSsrKSB7CiAgICAgIHZhciBwdHIgPSBIRUFQVTMyW2lvdiA+PiAyXTsKICAgICAgdmFyIGxlbiA9IEhFQVBVMzJbaW92ICsgNCA+PiAyXTsKICAgICAgaW92ICs9IDg7CiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICBwcmludENoYXIoZmQsIEhFQVBVOFtwdHIgKyBqXSk7CiAgICAgIH0KICAgICAgbnVtICs9IGxlbjsKICAgIH0KICAgIEhFQVBVMzJbcG51bSA+PiAyXSA9IG51bTsKICAgIHJldHVybiAwOwogIH07CiAgZnVuY3Rpb24gX2dyYXlfdG9fcmdiYShjb21wR19wdHIsIG5iX3BpeGVscykgewogICAgY29tcEdfcHRyID4+PSAyOwogICAgY29uc3QgaW1hZ2VEYXRhID0gTW9kdWxlLmltYWdlRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShuYl9waXhlbHMgKiA0KTsKICAgIGNvbnN0IGNvbXBHID0gSEVBUDMyLnN1YmFycmF5KGNvbXBHX3B0ciwgY29tcEdfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmJfcGl4ZWxzOyBpKyspIHsKICAgICAgaW1hZ2VEYXRhWzQgKiBpXSA9IGltYWdlRGF0YVs0ICogaSArIDFdID0gaW1hZ2VEYXRhWzQgKiBpICsgMl0gPSBjb21wR1tpXTsKICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgM10gPSAyNTU7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9ncmF5YV90b19yZ2JhKGNvbXBHX3B0ciwgY29tcEFfcHRyLCBuYl9waXhlbHMpIHsKICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgIGNvbXBBX3B0ciA+Pj0gMjsKICAgIGNvbnN0IGltYWdlRGF0YSA9IE1vZHVsZS5pbWFnZURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobmJfcGl4ZWxzICogNCk7CiAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICBjb25zdCBjb21wQSA9IEhFQVAzMi5zdWJhcnJheShjb21wQV9wdHIsIGNvbXBBX3B0ciArIG5iX3BpeGVscyk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iX3BpeGVsczsgaSsrKSB7CiAgICAgIGltYWdlRGF0YVs0ICogaV0gPSBpbWFnZURhdGFbNCAqIGkgKyAxXSA9IGltYWdlRGF0YVs0ICogaSArIDJdID0gY29tcEdbaV07CiAgICAgIGltYWdlRGF0YVs0ICogaSArIDNdID0gY29tcEFbaV07CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9qc1ByaW50V2FybmluZyhtZXNzYWdlX3B0cikgewogICAgY29uc3QgbWVzc2FnZSA9IFVURjhUb1N0cmluZyhtZXNzYWdlX3B0cik7CiAgICAoTW9kdWxlLndhcm4gfHwgY29uc29sZS53YXJuKShgT3BlbkpQRUc6ICR7bWVzc2FnZX1gKTsKICB9CiAgZnVuY3Rpb24gX3JnYl90b19yZ2JhKGNvbXBSX3B0ciwgY29tcEdfcHRyLCBjb21wQl9wdHIsIG5iX3BpeGVscykgewogICAgY29tcFJfcHRyID4+PSAyOwogICAgY29tcEdfcHRyID4+PSAyOwogICAgY29tcEJfcHRyID4+PSAyOwogICAgY29uc3QgaW1hZ2VEYXRhID0gTW9kdWxlLmltYWdlRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShuYl9waXhlbHMgKiA0KTsKICAgIGNvbnN0IGNvbXBSID0gSEVBUDMyLnN1YmFycmF5KGNvbXBSX3B0ciwgY29tcFJfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGNvbnN0IGNvbXBHID0gSEVBUDMyLnN1YmFycmF5KGNvbXBHX3B0ciwgY29tcEdfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGNvbnN0IGNvbXBCID0gSEVBUDMyLnN1YmFycmF5KGNvbXBCX3B0ciwgY29tcEJfcHRyICsgbmJfcGl4ZWxzKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmJfcGl4ZWxzOyBpKyspIHsKICAgICAgaW1hZ2VEYXRhWzQgKiBpXSA9IGNvbXBSW2ldOwogICAgICBpbWFnZURhdGFbNCAqIGkgKyAxXSA9IGNvbXBHW2ldOwogICAgICBpbWFnZURhdGFbNCAqIGkgKyAyXSA9IGNvbXBCW2ldOwogICAgICBpbWFnZURhdGFbNCAqIGkgKyAzXSA9IDI1NTsKICAgIH0KICB9CiAgZnVuY3Rpb24gX3N0b3JlRXJyb3JNZXNzYWdlKG1lc3NhZ2VfcHRyKSB7CiAgICBjb25zdCBtZXNzYWdlID0gVVRGOFRvU3RyaW5nKG1lc3NhZ2VfcHRyKTsKICAgIGlmICghTW9kdWxlLmVycm9yTWVzc2FnZXMpIHsKICAgICAgTW9kdWxlLmVycm9yTWVzc2FnZXMgPSBtZXNzYWdlOwogICAgfSBlbHNlIHsKICAgICAgTW9kdWxlLmVycm9yTWVzc2FnZXMgKz0gIlxuIiArIG1lc3NhZ2U7CiAgICB9CiAgfQogIHZhciB3cml0ZUFycmF5VG9NZW1vcnkgPSAoYXJyYXksIGJ1ZmZlcikgPT4gewogICAgSEVBUDguc2V0KGFycmF5LCBidWZmZXIpOwogIH07CiAgaWYgKE1vZHVsZVsibm9FeGl0UnVudGltZSJdKSBub0V4aXRSdW50aW1lID0gTW9kdWxlWyJub0V4aXRSdW50aW1lIl07CiAgaWYgKE1vZHVsZVsicHJpbnQiXSkgb3V0ID0gTW9kdWxlWyJwcmludCJdOwogIGlmIChNb2R1bGVbInByaW50RXJyIl0pIGVyciA9IE1vZHVsZVsicHJpbnRFcnIiXTsKICBpZiAoTW9kdWxlWyJ3YXNtQmluYXJ5Il0pIHdhc21CaW5hcnkgPSBNb2R1bGVbIndhc21CaW5hcnkiXTsKICBpZiAoTW9kdWxlWyJhcmd1bWVudHMiXSkgYXJndW1lbnRzXyA9IE1vZHVsZVsiYXJndW1lbnRzIl07CiAgaWYgKE1vZHVsZVsidGhpc1Byb2dyYW0iXSkgdGhpc1Byb2dyYW0gPSBNb2R1bGVbInRoaXNQcm9ncmFtIl07CiAgaWYgKE1vZHVsZVsicHJlSW5pdCJdKSB7CiAgICBpZiAodHlwZW9mIE1vZHVsZVsicHJlSW5pdCJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicHJlSW5pdCJdID0gW01vZHVsZVsicHJlSW5pdCJdXTsKICAgIHdoaWxlIChNb2R1bGVbInByZUluaXQiXS5sZW5ndGggPiAwKSB7CiAgICAgIE1vZHVsZVsicHJlSW5pdCJdLnNoaWZ0KCkoKTsKICAgIH0KICB9CiAgTW9kdWxlWyJ3cml0ZUFycmF5VG9NZW1vcnkiXSA9IHdyaXRlQXJyYXlUb01lbW9yeTsKICB2YXIgX21hbGxvYywgX2ZyZWUsIF9qcDJfZGVjb2RlLCBfX2Vtc2NyaXB0ZW5fdGltZW91dDsKICBmdW5jdGlvbiBhc3NpZ25XYXNtRXhwb3J0cyh3YXNtRXhwb3J0cykgewogICAgTW9kdWxlWyJfbWFsbG9jIl0gPSBfbWFsbG9jID0gd2FzbUV4cG9ydHNbInQiXTsKICAgIE1vZHVsZVsiX2ZyZWUiXSA9IF9mcmVlID0gd2FzbUV4cG9ydHNbInUiXTsKICAgIE1vZHVsZVsiX2pwMl9kZWNvZGUiXSA9IF9qcDJfZGVjb2RlID0gd2FzbUV4cG9ydHNbInYiXTsKICAgIF9fZW1zY3JpcHRlbl90aW1lb3V0ID0gd2FzbUV4cG9ydHNbInciXTsKICB9CiAgdmFyIHdhc21JbXBvcnRzID0gewogICAgazogX19hYm9ydF9qcywKICAgIGo6IF9fZW1zY3JpcHRlbl9ydW50aW1lX2tlZXBhbGl2ZV9jbGVhciwKICAgIGw6IF9fc2V0aXRpbWVyX2pzLAogICAgZjogX2NvcHlfcGl4ZWxzXzEsCiAgICBlOiBfY29weV9waXhlbHNfMywKICAgIGQ6IF9jb3B5X3BpeGVsc180LAogICAgbTogX2Vtc2NyaXB0ZW5fcmVzaXplX2hlYXAsCiAgICBvOiBfZW52aXJvbl9nZXQsCiAgICBwOiBfZW52aXJvbl9zaXplc19nZXQsCiAgICBuOiBfZmRfc2VlaywKICAgIGI6IF9mZF93cml0ZSwKICAgIHE6IF9ncmF5X3RvX3JnYmEsCiAgICBoOiBfZ3JheWFfdG9fcmdiYSwKICAgIGM6IF9qc1ByaW50V2FybmluZywKICAgIGk6IF9wcm9jX2V4aXQsCiAgICBnOiBfcmdiX3RvX3JnYmEsCiAgICBhOiBfc3RvcmVFcnJvck1lc3NhZ2UKICB9OwogIGZ1bmN0aW9uIHJ1bigpIHsKICAgIHByZVJ1bigpOwogICAgZnVuY3Rpb24gZG9SdW4oKSB7CiAgICAgIE1vZHVsZVsiY2FsbGVkUnVuIl0gPSB0cnVlOwogICAgICBpZiAoQUJPUlQpIHJldHVybjsKICAgICAgaW5pdFJ1bnRpbWUoKTsKICAgICAgcmVhZHlQcm9taXNlUmVzb2x2ZT8uKE1vZHVsZSk7CiAgICAgIE1vZHVsZVsib25SdW50aW1lSW5pdGlhbGl6ZWQiXT8uKCk7CiAgICAgIHBvc3RSdW4oKTsKICAgIH0KICAgIGlmIChNb2R1bGVbInNldFN0YXR1cyJdKSB7CiAgICAgIE1vZHVsZVsic2V0U3RhdHVzIl0oIlJ1bm5pbmcuLi4iKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBNb2R1bGVbInNldFN0YXR1cyJdKCIiKSwgMSk7CiAgICAgICAgZG9SdW4oKTsKICAgICAgfSwgMSk7CiAgICB9IGVsc2UgewogICAgICBkb1J1bigpOwogICAgfQogIH0KICB2YXIgd2FzbUV4cG9ydHM7CiAgd2FzbUV4cG9ydHMgPSBhd2FpdCBjcmVhdGVXYXNtKCk7CiAgcnVuKCk7CiAgaWYgKHJ1bnRpbWVJbml0aWFsaXplZCkgewogICAgbW9kdWxlUnRuID0gTW9kdWxlOwogIH0gZWxzZSB7CiAgICBtb2R1bGVSdG4gPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHJlYWR5UHJvbWlzZVJlc29sdmUgPSByZXNvbHZlOwogICAgICByZWFkeVByb21pc2VSZWplY3QgPSByZWplY3Q7CiAgICB9KTsKICB9CiAgcmV0dXJuIG1vZHVsZVJ0bjsKfQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IG9wZW5qcGVnID0gKE9wZW5KUEVHKTsKOy8vIC4vc3JjL2NvcmUvanB4LmpzCgoKCgpjbGFzcyBKcHhFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSnB4RXJyb3IiKTsKICB9Cn0KY2xhc3MgSnB4SW1hZ2UgewogIHN0YXRpYyAjYnVmZmVyID0gbnVsbDsKICBzdGF0aWMgI2hhbmRsZXIgPSBudWxsOwogIHN0YXRpYyAjbW9kdWxlUHJvbWlzZSA9IG51bGw7CiAgc3RhdGljICN1c2VXYXNtID0gdHJ1ZTsKICBzdGF0aWMgI3VzZVdvcmtlckZldGNoID0gdHJ1ZTsKICBzdGF0aWMgI3dhc21VcmwgPSBudWxsOwogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGhhbmRsZXIsCiAgICB1c2VXYXNtLAogICAgdXNlV29ya2VyRmV0Y2gsCiAgICB3YXNtVXJsCiAgfSkgewogICAgdGhpcy4jdXNlV2FzbSA9IHVzZVdhc207CiAgICB0aGlzLiN1c2VXb3JrZXJGZXRjaCA9IHVzZVdvcmtlckZldGNoOwogICAgdGhpcy4jd2FzbVVybCA9IHdhc21Vcmw7CiAgICBpZiAoIXVzZVdvcmtlckZldGNoKSB7CiAgICAgIHRoaXMuI2hhbmRsZXIgPSBoYW5kbGVyOwogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgI2dldEpzTW9kdWxlKGZhbGxiYWNrQ2FsbGJhY2spIHsKICAgIGNvbnN0IHBhdGggPSBgJHt0aGlzLiN3YXNtVXJsfW9wZW5qcGVnX25vd2FzbV9mYWxsYmFjay5qc2A7CiAgICBsZXQgaW5zdGFuY2UgPSBudWxsOwogICAgdHJ5IHsKICAgICAgY29uc3QgbW9kID0gYXdhaXQgaW1wb3J0KAogICAgICAvKndlYnBhY2tJZ25vcmU6IHRydWUqLwogICAgICAvKkB2aXRlLWlnbm9yZSovCiAgICAgIHBhdGgpOwogICAgICBpbnN0YW5jZSA9IG1vZC5kZWZhdWx0KCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHdhcm4oYEpweEltYWdlI2dldEpzTW9kdWxlOiAke2V9YCk7CiAgICB9CiAgICBmYWxsYmFja0NhbGxiYWNrKGluc3RhbmNlKTsKICB9CiAgc3RhdGljIGFzeW5jICNpbnN0YW50aWF0ZVdhc20oZmFsbGJhY2tDYWxsYmFjaywgaW1wb3J0cywgc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICBjb25zdCBmaWxlbmFtZSA9ICJvcGVuanBlZy53YXNtIjsKICAgIHRyeSB7CiAgICAgIGlmICghdGhpcy4jYnVmZmVyKSB7CiAgICAgICAgaWYgKHRoaXMuI3VzZVdvcmtlckZldGNoKSB7CiAgICAgICAgICB0aGlzLiNidWZmZXIgPSBhd2FpdCBmZXRjaEJpbmFyeURhdGEoYCR7dGhpcy4jd2FzbVVybH0ke2ZpbGVuYW1lfWApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiNidWZmZXIgPSBhd2FpdCB0aGlzLiNoYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiRmV0Y2hCaW5hcnlEYXRhIiwgewogICAgICAgICAgICB0eXBlOiAid2FzbUZhY3RvcnkiLAogICAgICAgICAgICBmaWxlbmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZSh0aGlzLiNidWZmZXIsIGltcG9ydHMpOwogICAgICByZXR1cm4gc3VjY2Vzc0NhbGxiYWNrKHJlc3VsdHMuaW5zdGFuY2UpOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIHdhcm4oYEpweEltYWdlI2luc3RhbnRpYXRlV2FzbTogJHtyZWFzb259YCk7CiAgICAgIHRoaXMuI2dldEpzTW9kdWxlKGZhbGxiYWNrQ2FsbGJhY2spOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZmluYWxseSB7CiAgICAgIHRoaXMuI2hhbmRsZXIgPSBudWxsOwogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgZGVjb2RlKGJ5dGVzLCB7CiAgICBudW1Db21wb25lbnRzID0gNCwKICAgIGlzSW5kZXhlZENvbG9ybWFwID0gZmFsc2UsCiAgICBzbWFza0luRGF0YSA9IGZhbHNlLAogICAgcmVkdWNlUG93ZXIgPSAwCiAgfSA9IHt9KSB7CiAgICBpZiAoIXRoaXMuI21vZHVsZVByb21pc2UpIHsKICAgICAgY29uc3QgewogICAgICAgIHByb21pc2UsCiAgICAgICAgcmVzb2x2ZQogICAgICB9ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgIGNvbnN0IHByb21pc2VzID0gW3Byb21pc2VdOwogICAgICBpZiAoIXRoaXMuI3VzZVdhc20pIHsKICAgICAgICB0aGlzLiNnZXRKc01vZHVsZShyZXNvbHZlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9taXNlcy5wdXNoKG9wZW5qcGVnKHsKICAgICAgICAgIHdhcm46IHdhcm4sCiAgICAgICAgICBpbnN0YW50aWF0ZVdhc206IHRoaXMuI2luc3RhbnRpYXRlV2FzbS5iaW5kKHRoaXMsIHJlc29sdmUpCiAgICAgICAgfSkpOwogICAgICB9CiAgICAgIHRoaXMuI21vZHVsZVByb21pc2UgPSBQcm9taXNlLnJhY2UocHJvbWlzZXMpOwogICAgfQogICAgY29uc3QgbW9kdWxlID0gYXdhaXQgdGhpcy4jbW9kdWxlUHJvbWlzZTsKICAgIGlmICghbW9kdWxlKSB7CiAgICAgIHRocm93IG5ldyBKcHhFcnJvcigiT3BlbkpQRUcgZmFpbGVkIHRvIGluaXRpYWxpemUiKTsKICAgIH0KICAgIGxldCBwdHI7CiAgICB0cnkgewogICAgICBjb25zdCBzaXplID0gYnl0ZXMubGVuZ3RoOwogICAgICBwdHIgPSBtb2R1bGUuX21hbGxvYyhzaXplKTsKICAgICAgbW9kdWxlLndyaXRlQXJyYXlUb01lbW9yeShieXRlcywgcHRyKTsKICAgICAgY29uc3QgcmV0ID0gbW9kdWxlLl9qcDJfZGVjb2RlKHB0ciwgc2l6ZSwgbnVtQ29tcG9uZW50cyA+IDAgPyBudW1Db21wb25lbnRzIDogMCwgISFpc0luZGV4ZWRDb2xvcm1hcCwgISFzbWFza0luRGF0YSwgcmVkdWNlUG93ZXIpOwogICAgICBpZiAocmV0KSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZXJyb3JNZXNzYWdlcwogICAgICAgIH0gPSBtb2R1bGU7CiAgICAgICAgaWYgKGVycm9yTWVzc2FnZXMpIHsKICAgICAgICAgIGRlbGV0ZSBtb2R1bGUuZXJyb3JNZXNzYWdlczsKICAgICAgICAgIHRocm93IG5ldyBKcHhFcnJvcihlcnJvck1lc3NhZ2VzKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJVbmtub3duIGVycm9yIik7CiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIGltYWdlRGF0YQogICAgICB9ID0gbW9kdWxlOwogICAgICBtb2R1bGUuaW1hZ2VEYXRhID0gbnVsbDsKICAgICAgcmV0dXJuIGltYWdlRGF0YTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChwdHIpIHsKICAgICAgICBtb2R1bGUuX2ZyZWUocHRyKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgY2xlYW51cCgpIHsKICAgIHRoaXMuI21vZHVsZVByb21pc2UgPSBudWxsOwogIH0KICBzdGF0aWMgcGFyc2VJbWFnZVByb3BlcnRpZXMoc3RyZWFtKSB7CiAgICBsZXQgbmV3Qnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICB3aGlsZSAobmV3Qnl0ZSA+PSAwKSB7CiAgICAgIGNvbnN0IG9sZEJ5dGUgPSBuZXdCeXRlOwogICAgICBuZXdCeXRlID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgY29uc3QgY29kZSA9IG9sZEJ5dGUgPDwgOCB8IG5ld0J5dGU7CiAgICAgIGlmIChjb2RlID09PSAweGZmNTEpIHsKICAgICAgICBzdHJlYW0uc2tpcCg0KTsKICAgICAgICBjb25zdCBYc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgY29uc3QgWXNpeiA9IHN0cmVhbS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIGNvbnN0IFhPc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgY29uc3QgWU9zaXogPSBzdHJlYW0uZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICBzdHJlYW0uc2tpcCgxNik7CiAgICAgICAgY29uc3QgQ3NpeiA9IHN0cmVhbS5nZXRVaW50MTYoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgd2lkdGg6IFhzaXogLSBYT3NpeiwKICAgICAgICAgIGhlaWdodDogWXNpeiAtIFlPc2l6LAogICAgICAgICAgYml0c1BlckNvbXBvbmVudDogOCwKICAgICAgICAgIGNvbXBvbmVudHNDb3VudDogQ3NpegogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBKcHhFcnJvcigiTm8gc2l6ZSBtYXJrZXIgZm91bmQgaW4gSlBYIHN0cmVhbSIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvb3BlcmF0b3JfbGlzdC5qcwoKZnVuY3Rpb24gYWRkU3RhdGUocGFyZW50U3RhdGUsIHBhdHRlcm4sIGNoZWNrRm4sIGl0ZXJhdGVGbiwgcHJvY2Vzc0ZuKSB7CiAgbGV0IHN0YXRlID0gcGFyZW50U3RhdGU7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcGF0dGVybi5sZW5ndGggLSAxOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgaXRlbSA9IHBhdHRlcm5baV07CiAgICBzdGF0ZSA9IHN0YXRlW2l0ZW1dIHx8PSBbXTsKICB9CiAgc3RhdGVbcGF0dGVybi5hdCgtMSldID0gewogICAgY2hlY2tGbiwKICAgIGl0ZXJhdGVGbiwKICAgIHByb2Nlc3NGbgogIH07Cn0KY29uc3QgSW5pdGlhbFN0YXRlID0gW107CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW09QUy5zYXZlLCBPUFMudHJhbnNmb3JtLCBPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QsIE9QUy5yZXN0b3JlXSwgbnVsbCwgZnVuY3Rpb24gaXRlcmF0ZUlubGluZUltYWdlR3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXk7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSAzOwogIGNvbnN0IHBvcyA9IChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogIHN3aXRjaCAocG9zKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuc2F2ZTsKICAgIGNhc2UgMToKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy50cmFuc2Zvcm07CiAgICBjYXNlIDI6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q7CiAgICBjYXNlIDM6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMucmVzdG9yZTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKGBpdGVyYXRlSW5saW5lSW1hZ2VHcm91cCAtIGludmFsaWQgcG9zOiAke3Bvc31gKTsKfSwgZnVuY3Rpb24gZm91bmRJbmxpbmVJbWFnZUdyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBNSU5fSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0sgPSAxMDsKICBjb25zdCBNQVhfSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0sgPSAyMDA7CiAgY29uc3QgTUFYX1dJRFRIID0gMTAwMDsKICBjb25zdCBJTUFHRV9QQURESU5HID0gMTsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFBJSVhPID0gY3VyciAtIDE7CiAgY29uc3QgY291bnQgPSBNYXRoLm1pbihNYXRoLmZsb29yKChpIC0gaUZpcnN0U2F2ZSkgLyA0KSwgTUFYX0lNQUdFU19JTl9JTkxJTkVfSU1BR0VTX0JMT0NLKTsKICBpZiAoY291bnQgPCBNSU5fSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0spIHsKICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgfQogIGxldCBtYXhYID0gMDsKICBjb25zdCBtYXAgPSBbXTsKICBsZXQgbWF4TGluZUhlaWdodCA9IDA7CiAgbGV0IGN1cnJlbnRYID0gSU1BR0VfUEFERElORywKICAgIGN1cnJlbnRZID0gSU1BR0VfUEFERElORzsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyspIHsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm0gKyAocSA8PCAyKV07CiAgICBjb25zdCBpbWcgPSBhcmdzQXJyYXlbaUZpcnN0UElJWE8gKyAocSA8PCAyKV1bMF07CiAgICBpZiAoY3VycmVudFggKyBpbWcud2lkdGggPiBNQVhfV0lEVEgpIHsKICAgICAgbWF4WCA9IE1hdGgubWF4KG1heFgsIGN1cnJlbnRYKTsKICAgICAgY3VycmVudFkgKz0gbWF4TGluZUhlaWdodCArIDIgKiBJTUFHRV9QQURESU5HOwogICAgICBjdXJyZW50WCA9IDA7CiAgICAgIG1heExpbmVIZWlnaHQgPSAwOwogICAgfQogICAgbWFwLnB1c2goewogICAgICB0cmFuc2Zvcm0sCiAgICAgIHg6IGN1cnJlbnRYLAogICAgICB5OiBjdXJyZW50WSwKICAgICAgdzogaW1nLndpZHRoLAogICAgICBoOiBpbWcuaGVpZ2h0CiAgICB9KTsKICAgIGN1cnJlbnRYICs9IGltZy53aWR0aCArIDIgKiBJTUFHRV9QQURESU5HOwogICAgbWF4TGluZUhlaWdodCA9IE1hdGgubWF4KG1heExpbmVIZWlnaHQsIGltZy5oZWlnaHQpOwogIH0KICBjb25zdCBpbWdXaWR0aCA9IE1hdGgubWF4KG1heFgsIGN1cnJlbnRYKSArIElNQUdFX1BBRERJTkc7CiAgY29uc3QgaW1nSGVpZ2h0ID0gY3VycmVudFkgKyBtYXhMaW5lSGVpZ2h0ICsgSU1BR0VfUEFERElORzsKICBjb25zdCBpbWdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW1nV2lkdGggKiBpbWdIZWlnaHQgKiA0KTsKICBjb25zdCBpbWdSb3dTaXplID0gaW1nV2lkdGggPDwgMjsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyspIHsKICAgIGNvbnN0IGRhdGEgPSBhcmdzQXJyYXlbaUZpcnN0UElJWE8gKyAocSA8PCAyKV1bMF0uZGF0YTsKICAgIGNvbnN0IHJvd1NpemUgPSBtYXBbcV0udyA8PCAyOwogICAgbGV0IGRhdGFPZmZzZXQgPSAwOwogICAgbGV0IG9mZnNldCA9IG1hcFtxXS54ICsgbWFwW3FdLnkgKiBpbWdXaWR0aCA8PCAyOwogICAgaW1nRGF0YS5zZXQoZGF0YS5zdWJhcnJheSgwLCByb3dTaXplKSwgb2Zmc2V0IC0gaW1nUm93U2l6ZSk7CiAgICBmb3IgKGxldCBrID0gMCwga2sgPSBtYXBbcV0uaDsgayA8IGtrOyBrKyspIHsKICAgICAgaW1nRGF0YS5zZXQoZGF0YS5zdWJhcnJheShkYXRhT2Zmc2V0LCBkYXRhT2Zmc2V0ICsgcm93U2l6ZSksIG9mZnNldCk7CiAgICAgIGRhdGFPZmZzZXQgKz0gcm93U2l6ZTsKICAgICAgb2Zmc2V0ICs9IGltZ1Jvd1NpemU7CiAgICB9CiAgICBpbWdEYXRhLnNldChkYXRhLnN1YmFycmF5KGRhdGFPZmZzZXQgLSByb3dTaXplLCBkYXRhT2Zmc2V0KSwgb2Zmc2V0KTsKICAgIHdoaWxlIChvZmZzZXQgPj0gMCkgewogICAgICBkYXRhW29mZnNldCAtIDRdID0gZGF0YVtvZmZzZXRdOwogICAgICBkYXRhW29mZnNldCAtIDNdID0gZGF0YVtvZmZzZXQgKyAxXTsKICAgICAgZGF0YVtvZmZzZXQgLSAyXSA9IGRhdGFbb2Zmc2V0ICsgMl07CiAgICAgIGRhdGFbb2Zmc2V0IC0gMV0gPSBkYXRhW29mZnNldCArIDNdOwogICAgICBkYXRhW29mZnNldCArIHJvd1NpemVdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gNF07CiAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSArIDFdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gM107CiAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSArIDJdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gMl07CiAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSArIDNdID0gZGF0YVtvZmZzZXQgKyByb3dTaXplIC0gMV07CiAgICAgIG9mZnNldCAtPSBpbWdSb3dTaXplOwogICAgfQogIH0KICBjb25zdCBpbWcgPSB7CiAgICB3aWR0aDogaW1nV2lkdGgsCiAgICBoZWlnaHQ6IGltZ0hlaWdodAogIH07CiAgaWYgKGNvbnRleHQuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgIGNvbnN0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMoaW1nV2lkdGgsIGltZ0hlaWdodCk7CiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIGN0eC5wdXRJbWFnZURhdGEobmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoaW1nRGF0YS5idWZmZXIpLCBpbWdXaWR0aCwgaW1nSGVpZ2h0KSwgMCwgMCk7CiAgICBpbWcuYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgaW1nLmRhdGEgPSBudWxsOwogIH0gZWxzZSB7CiAgICBpbWcua2luZCA9IEltYWdlS2luZC5SR0JBXzMyQlBQOwogICAgaW1nLmRhdGEgPSBpbWdEYXRhOwogIH0KICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIE9QUy5wYWludElubGluZUltYWdlWE9iamVjdEdyb3VwKTsKICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW2ltZywgbWFwXSk7CiAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwp9KTsKYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbT1BTLnNhdmUsIE9QUy50cmFuc2Zvcm0sIE9QUy5wYWludEltYWdlTWFza1hPYmplY3QsIE9QUy5yZXN0b3JlXSwgbnVsbCwgZnVuY3Rpb24gaXRlcmF0ZUltYWdlTWFza0dyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5OwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjb250ZXh0LmlDdXJyIC0gMzsKICBjb25zdCBwb3MgPSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICBzd2l0Y2ggKHBvcykgewogICAgY2FzZSAwOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnNhdmU7CiAgICBjYXNlIDE6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMudHJhbnNmb3JtOwogICAgY2FzZSAyOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdDsKICAgIGNhc2UgMzoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5yZXN0b3JlOwogIH0KICB0aHJvdyBuZXcgRXJyb3IoYGl0ZXJhdGVJbWFnZU1hc2tHcm91cCAtIGludmFsaWQgcG9zOiAke3Bvc31gKTsKfSwgZnVuY3Rpb24gZm91bmRJbWFnZU1hc2tHcm91cChjb250ZXh0LCBpKSB7CiAgY29uc3QgTUlOX0lNQUdFU19JTl9NQVNLU19CTE9DSyA9IDEwOwogIGNvbnN0IE1BWF9JTUFHRVNfSU5fTUFTS1NfQkxPQ0sgPSAxMDA7CiAgY29uc3QgTUFYX1NBTUVfSU1BR0VTX0lOX01BU0tTX0JMT0NLID0gMTAwMDsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFBJTVhPID0gY3VyciAtIDE7CiAgbGV0IGNvdW50ID0gTWF0aC5mbG9vcigoaSAtIGlGaXJzdFNhdmUpIC8gNCk7CiAgaWYgKGNvdW50IDwgTUlOX0lNQUdFU19JTl9NQVNLU19CTE9DSykgewogICAgcmV0dXJuIGkgLSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICB9CiAgbGV0IGlzU2FtZUltYWdlID0gZmFsc2U7CiAgbGV0IGlUcmFuc2Zvcm0sIHRyYW5zZm9ybUFyZ3M7CiAgY29uc3QgZmlyc3RQSU1YT0FyZzAgPSBhcmdzQXJyYXlbaUZpcnN0UElNWE9dWzBdOwogIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzBdLAogICAgZmlyc3RUcmFuc2Zvcm1BcmcxID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMV0sCiAgICBmaXJzdFRyYW5zZm9ybUFyZzIgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVsyXSwKICAgIGZpcnN0VHJhbnNmb3JtQXJnMyA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzNdOwogIGlmIChmaXJzdFRyYW5zZm9ybUFyZzEgPT09IGZpcnN0VHJhbnNmb3JtQXJnMikgewogICAgaXNTYW1lSW1hZ2UgPSB0cnVlOwogICAgaVRyYW5zZm9ybSA9IGlGaXJzdFRyYW5zZm9ybSArIDQ7CiAgICBsZXQgaVBJTVhPID0gaUZpcnN0UElNWE8gKyA0OwogICAgZm9yIChsZXQgcSA9IDE7IHEgPCBjb3VudDsgcSsrLCBpVHJhbnNmb3JtICs9IDQsIGlQSU1YTyArPSA0KSB7CiAgICAgIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaVRyYW5zZm9ybV07CiAgICAgIGlmIChhcmdzQXJyYXlbaVBJTVhPXVswXSAhPT0gZmlyc3RQSU1YT0FyZzAgfHwgdHJhbnNmb3JtQXJnc1swXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmcwIHx8IHRyYW5zZm9ybUFyZ3NbMV0gIT09IGZpcnN0VHJhbnNmb3JtQXJnMSB8fCB0cmFuc2Zvcm1BcmdzWzJdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzIgfHwgdHJhbnNmb3JtQXJnc1szXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmczKSB7CiAgICAgICAgaWYgKHEgPCBNSU5fSU1BR0VTX0lOX01BU0tTX0JMT0NLKSB7CiAgICAgICAgICBpc1NhbWVJbWFnZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb3VudCA9IHE7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIGlmIChpc1NhbWVJbWFnZSkgewogICAgY291bnQgPSBNYXRoLm1pbihjb3VudCwgTUFYX1NBTUVfSU1BR0VTX0lOX01BU0tTX0JMT0NLKTsKICAgIGNvbnN0IHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoY291bnQgKiAyKTsKICAgIGlUcmFuc2Zvcm0gPSBpRmlyc3RUcmFuc2Zvcm07CiAgICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyssIGlUcmFuc2Zvcm0gKz0gNCkgewogICAgICB0cmFuc2Zvcm1BcmdzID0gYXJnc0FycmF5W2lUcmFuc2Zvcm1dOwogICAgICBwb3NpdGlvbnNbcSA8PCAxXSA9IHRyYW5zZm9ybUFyZ3NbNF07CiAgICAgIHBvc2l0aW9uc1socSA8PCAxKSArIDFdID0gdHJhbnNmb3JtQXJnc1s1XTsKICAgIH0KICAgIGZuQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdFJlcGVhdCk7CiAgICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW2ZpcnN0UElNWE9BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMSwgZmlyc3RUcmFuc2Zvcm1BcmcyLCBmaXJzdFRyYW5zZm9ybUFyZzMsIHBvc2l0aW9uc10pOwogIH0gZWxzZSB7CiAgICBjb3VudCA9IE1hdGgubWluKGNvdW50LCBNQVhfSU1BR0VTX0lOX01BU0tTX0JMT0NLKTsKICAgIGNvbnN0IGltYWdlcyA9IFtdOwogICAgZm9yIChsZXQgcSA9IDA7IHEgPCBjb3VudDsgcSsrKSB7CiAgICAgIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtICsgKHEgPDwgMildOwogICAgICBjb25zdCBtYXNrUGFyYW1zID0gYXJnc0FycmF5W2lGaXJzdFBJTVhPICsgKHEgPDwgMildWzBdOwogICAgICBpbWFnZXMucHVzaCh7CiAgICAgICAgZGF0YTogbWFza1BhcmFtcy5kYXRhLAogICAgICAgIHdpZHRoOiBtYXNrUGFyYW1zLndpZHRoLAogICAgICAgIGhlaWdodDogbWFza1BhcmFtcy5oZWlnaHQsCiAgICAgICAgaW50ZXJwb2xhdGU6IG1hc2tQYXJhbXMuaW50ZXJwb2xhdGUsCiAgICAgICAgY291bnQ6IG1hc2tQYXJhbXMuY291bnQsCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm1BcmdzCiAgICAgIH0pOwogICAgfQogICAgZm5BcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0R3JvdXApOwogICAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIFtpbWFnZXNdKTsKICB9CiAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwp9KTsKYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbT1BTLnNhdmUsIE9QUy50cmFuc2Zvcm0sIE9QUy5wYWludEltYWdlWE9iamVjdCwgT1BTLnJlc3RvcmVdLCBmdW5jdGlvbiAoY29udGV4dCkgewogIGNvbnN0IGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGNvbnRleHQuaUN1cnIgLSAyOwogIHJldHVybiBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVsxXSA9PT0gMCAmJiBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVsyXSA9PT0gMDsKfSwgZnVuY3Rpb24gaXRlcmF0ZUltYWdlR3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBpRmlyc3RTYXZlID0gY29udGV4dC5pQ3VyciAtIDM7CiAgY29uc3QgcG9zID0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgc3dpdGNoIChwb3MpIHsKICAgIGNhc2UgMDoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5zYXZlOwogICAgY2FzZSAxOgogICAgICBpZiAoZm5BcnJheVtpXSAhPT0gT1BTLnRyYW5zZm9ybSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjb250ZXh0LmlDdXJyIC0gMjsKICAgICAgY29uc3QgZmlyc3RUcmFuc2Zvcm1BcmcwID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMF07CiAgICAgIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMyA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzNdOwogICAgICBpZiAoYXJnc0FycmF5W2ldWzBdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzAgfHwgYXJnc0FycmF5W2ldWzFdICE9PSAwIHx8IGFyZ3NBcnJheVtpXVsyXSAhPT0gMCB8fCBhcmdzQXJyYXlbaV1bM10gIT09IGZpcnN0VHJhbnNmb3JtQXJnMykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGNhc2UgMjoKICAgICAgaWYgKGZuQXJyYXlbaV0gIT09IE9QUy5wYWludEltYWdlWE9iamVjdCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBpRmlyc3RQSVhPID0gY29udGV4dC5pQ3VyciAtIDE7CiAgICAgIGNvbnN0IGZpcnN0UElYT0FyZzAgPSBhcmdzQXJyYXlbaUZpcnN0UElYT11bMF07CiAgICAgIGlmIChhcmdzQXJyYXlbaV1bMF0gIT09IGZpcnN0UElYT0FyZzApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICBjYXNlIDM6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMucmVzdG9yZTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKGBpdGVyYXRlSW1hZ2VHcm91cCAtIGludmFsaWQgcG9zOiAke3Bvc31gKTsKfSwgZnVuY3Rpb24gKGNvbnRleHQsIGkpIHsKICBjb25zdCBNSU5fSU1BR0VTX0lOX0JMT0NLID0gMzsKICBjb25zdCBNQVhfSU1BR0VTX0lOX0JMT0NLID0gMTAwMDsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFBJWE8gPSBjdXJyIC0gMTsKICBjb25zdCBmaXJzdFBJWE9BcmcwID0gYXJnc0FycmF5W2lGaXJzdFBJWE9dWzBdOwogIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzBdOwogIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMyA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzNdOwogIGNvbnN0IGNvdW50ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoaSAtIGlGaXJzdFNhdmUpIC8gNCksIE1BWF9JTUFHRVNfSU5fQkxPQ0spOwogIGlmIChjb3VudCA8IE1JTl9JTUFHRVNfSU5fQkxPQ0spIHsKICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgfQogIGNvbnN0IHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoY291bnQgKiAyKTsKICBsZXQgaVRyYW5zZm9ybSA9IGlGaXJzdFRyYW5zZm9ybTsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyssIGlUcmFuc2Zvcm0gKz0gNCkgewogICAgY29uc3QgdHJhbnNmb3JtQXJncyA9IGFyZ3NBcnJheVtpVHJhbnNmb3JtXTsKICAgIHBvc2l0aW9uc1txIDw8IDFdID0gdHJhbnNmb3JtQXJnc1s0XTsKICAgIHBvc2l0aW9uc1socSA8PCAxKSArIDFdID0gdHJhbnNmb3JtQXJnc1s1XTsKICB9CiAgY29uc3QgYXJncyA9IFtmaXJzdFBJWE9BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMywgcG9zaXRpb25zXTsKICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIE9QUy5wYWludEltYWdlWE9iamVjdFJlcGVhdCk7CiAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIGFyZ3MpOwogIHJldHVybiBpRmlyc3RTYXZlICsgMTsKfSk7CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW09QUy5iZWdpblRleHQsIE9QUy5zZXRGb250LCBPUFMuc2V0VGV4dE1hdHJpeCwgT1BTLnNob3dUZXh0LCBPUFMuZW5kVGV4dF0sIG51bGwsIGZ1bmN0aW9uIGl0ZXJhdGVTaG93VGV4dEdyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSA0OwogIGNvbnN0IHBvcyA9IChpIC0gaUZpcnN0U2F2ZSkgJSA1OwogIHN3aXRjaCAocG9zKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuYmVnaW5UZXh0OwogICAgY2FzZSAxOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnNldEZvbnQ7CiAgICBjYXNlIDI6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuc2V0VGV4dE1hdHJpeDsKICAgIGNhc2UgMzoKICAgICAgaWYgKGZuQXJyYXlbaV0gIT09IE9QUy5zaG93VGV4dCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBpRmlyc3RTZXRGb250ID0gY29udGV4dC5pQ3VyciAtIDM7CiAgICAgIGNvbnN0IGZpcnN0U2V0Rm9udEFyZzAgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMF07CiAgICAgIGNvbnN0IGZpcnN0U2V0Rm9udEFyZzEgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMV07CiAgICAgIGlmIChhcmdzQXJyYXlbaV1bMF0gIT09IGZpcnN0U2V0Rm9udEFyZzAgfHwgYXJnc0FycmF5W2ldWzFdICE9PSBmaXJzdFNldEZvbnRBcmcxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgY2FzZSA0OgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLmVuZFRleHQ7CiAgfQogIHRocm93IG5ldyBFcnJvcihgaXRlcmF0ZVNob3dUZXh0R3JvdXAgLSBpbnZhbGlkIHBvczogJHtwb3N9YCk7Cn0sIGZ1bmN0aW9uIChjb250ZXh0LCBpKSB7CiAgY29uc3QgTUlOX0NIQVJTX0lOX0JMT0NLID0gMzsKICBjb25zdCBNQVhfQ0hBUlNfSU5fQkxPQ0sgPSAxMDAwOwogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBjdXJyID0gY29udGV4dC5pQ3VycjsKICBjb25zdCBpRmlyc3RCZWdpblRleHQgPSBjdXJyIC0gNDsKICBjb25zdCBpRmlyc3RTZXRGb250ID0gY3VyciAtIDM7CiAgY29uc3QgaUZpcnN0U2V0VGV4dE1hdHJpeCA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdFNob3dUZXh0ID0gY3VyciAtIDE7CiAgY29uc3QgaUZpcnN0RW5kVGV4dCA9IGN1cnI7CiAgY29uc3QgZmlyc3RTZXRGb250QXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RTZXRGb250XVswXTsKICBjb25zdCBmaXJzdFNldEZvbnRBcmcxID0gYXJnc0FycmF5W2lGaXJzdFNldEZvbnRdWzFdOwogIGxldCBjb3VudCA9IE1hdGgubWluKE1hdGguZmxvb3IoKGkgLSBpRmlyc3RCZWdpblRleHQpIC8gNSksIE1BWF9DSEFSU19JTl9CTE9DSyk7CiAgaWYgKGNvdW50IDwgTUlOX0NIQVJTX0lOX0JMT0NLKSB7CiAgICByZXR1cm4gaSAtIChpIC0gaUZpcnN0QmVnaW5UZXh0KSAlIDU7CiAgfQogIGxldCBpRmlyc3QgPSBpRmlyc3RCZWdpblRleHQ7CiAgaWYgKGlGaXJzdEJlZ2luVGV4dCA+PSA0ICYmIGZuQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gNF0gPT09IGZuQXJyYXlbaUZpcnN0U2V0Rm9udF0gJiYgZm5BcnJheVtpRmlyc3RCZWdpblRleHQgLSAzXSA9PT0gZm5BcnJheVtpRmlyc3RTZXRUZXh0TWF0cml4XSAmJiBmbkFycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDJdID09PSBmbkFycmF5W2lGaXJzdFNob3dUZXh0XSAmJiBmbkFycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDFdID09PSBmbkFycmF5W2lGaXJzdEVuZFRleHRdICYmIGFyZ3NBcnJheVtpRmlyc3RCZWdpblRleHQgLSA0XVswXSA9PT0gZmlyc3RTZXRGb250QXJnMCAmJiBhcmdzQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gNF1bMV0gPT09IGZpcnN0U2V0Rm9udEFyZzEpIHsKICAgIGNvdW50Kys7CiAgICBpRmlyc3QgLT0gNTsKICB9CiAgbGV0IGlFbmRUZXh0ID0gaUZpcnN0ICsgNDsKICBmb3IgKGxldCBxID0gMTsgcSA8IGNvdW50OyBxKyspIHsKICAgIGZuQXJyYXkuc3BsaWNlKGlFbmRUZXh0LCAzKTsKICAgIGFyZ3NBcnJheS5zcGxpY2UoaUVuZFRleHQsIDMpOwogICAgaUVuZFRleHQgKz0gMjsKICB9CiAgcmV0dXJuIGlFbmRUZXh0ICsgMTsKfSk7CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW09QUy5zYXZlLCBPUFMudHJhbnNmb3JtLCBPUFMuY29uc3RydWN0UGF0aCwgT1BTLnJlc3RvcmVdLCBjb250ZXh0ID0+IHsKICBjb25zdCBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBpRmlyc3RDb25zdHJ1Y3RQYXRoID0gY29udGV4dC5pQ3VyciAtIDE7CiAgY29uc3Qgb3AgPSBhcmdzQXJyYXlbaUZpcnN0Q29uc3RydWN0UGF0aF1bMF07CiAgaWYgKG9wICE9PSBPUFMuc3Ryb2tlICYmIG9wICE9PSBPUFMuY2xvc2VTdHJva2UgJiYgb3AgIT09IE9QUy5maWxsU3Ryb2tlICYmIG9wICE9PSBPUFMuZW9GaWxsU3Ryb2tlICYmIG9wICE9PSBPUFMuY2xvc2VGaWxsU3Ryb2tlICYmIG9wICE9PSBPUFMuY2xvc2VFT0ZpbGxTdHJva2UpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjb250ZXh0LmlDdXJyIC0gMjsKICBjb25zdCB0cmFuc2Zvcm0gPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXTsKICByZXR1cm4gdHJhbnNmb3JtWzBdID09PSAxICYmIHRyYW5zZm9ybVsxXSA9PT0gMCAmJiB0cmFuc2Zvcm1bMl0gPT09IDAgJiYgdHJhbnNmb3JtWzNdID09PSAxOwp9LCAoKSA9PiBmYWxzZSwgKGNvbnRleHQsIGkpID0+IHsKICBjb25zdCB7CiAgICBmbkFycmF5LAogICAgYXJnc0FycmF5CiAgfSA9IGNvbnRleHQ7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGN1cnIgLSAyOwogIGNvbnN0IGlGaXJzdENvbnN0cnVjdFBhdGggPSBjdXJyIC0gMTsKICBjb25zdCBhcmdzID0gYXJnc0FycmF5W2lGaXJzdENvbnN0cnVjdFBhdGhdOwogIGNvbnN0IHRyYW5zZm9ybSA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dOwogIGNvbnN0IFssIFtidWZmZXJdLCBtaW5NYXhdID0gYXJnczsKICBpZiAobWluTWF4KSB7CiAgICBVdGlsLnNjYWxlTWluTWF4KHRyYW5zZm9ybSwgbWluTWF4KTsKICAgIGZvciAobGV0IGsgPSAwLCBrayA9IGJ1ZmZlci5sZW5ndGg7IGsgPCBrazspIHsKICAgICAgc3dpdGNoIChidWZmZXJbaysrXSkgewogICAgICAgIGNhc2UgRHJhd09QUy5tb3ZlVG86CiAgICAgICAgY2FzZSBEcmF3T1BTLmxpbmVUbzoKICAgICAgICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm0oYnVmZmVyLCB0cmFuc2Zvcm0sIGspOwogICAgICAgICAgayArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBEcmF3T1BTLmN1cnZlVG86CiAgICAgICAgICBVdGlsLmFwcGx5VHJhbnNmb3JtVG9CZXppZXIoYnVmZmVyLCB0cmFuc2Zvcm0sIGspOwogICAgICAgICAgayArPSA2OwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgZm5BcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgNCwgT1BTLmNvbnN0cnVjdFBhdGgpOwogIGFyZ3NBcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgNCwgYXJncyk7CiAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwp9KTsKY2xhc3MgTnVsbE9wdGltaXplciB7CiAgY29uc3RydWN0b3IocXVldWUpIHsKICAgIHRoaXMucXVldWUgPSBxdWV1ZTsKICB9CiAgX29wdGltaXplKCkge30KICBwdXNoKGZuLCBhcmdzKSB7CiAgICB0aGlzLnF1ZXVlLmZuQXJyYXkucHVzaChmbik7CiAgICB0aGlzLnF1ZXVlLmFyZ3NBcnJheS5wdXNoKGFyZ3MpOwogICAgdGhpcy5fb3B0aW1pemUoKTsKICB9CiAgZmx1c2goKSB7fQogIHJlc2V0KCkge30KfQpjbGFzcyBRdWV1ZU9wdGltaXplciBleHRlbmRzIE51bGxPcHRpbWl6ZXIgewogIGNvbnN0cnVjdG9yKHF1ZXVlKSB7CiAgICBzdXBlcihxdWV1ZSk7CiAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgIHRoaXMuY29udGV4dCA9IHsKICAgICAgaUN1cnI6IDAsCiAgICAgIGZuQXJyYXk6IHF1ZXVlLmZuQXJyYXksCiAgICAgIGFyZ3NBcnJheTogcXVldWUuYXJnc0FycmF5LAogICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZDogT3BlcmF0b3JMaXN0LmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkCiAgICB9OwogICAgdGhpcy5tYXRjaCA9IG51bGw7CiAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSAwOwogIH0KICBfb3B0aW1pemUoKSB7CiAgICBjb25zdCBmbkFycmF5ID0gdGhpcy5xdWV1ZS5mbkFycmF5OwogICAgbGV0IGkgPSB0aGlzLmxhc3RQcm9jZXNzZWQsCiAgICAgIGlpID0gZm5BcnJheS5sZW5ndGg7CiAgICBsZXQgc3RhdGUgPSB0aGlzLnN0YXRlOwogICAgbGV0IG1hdGNoID0gdGhpcy5tYXRjaDsKICAgIGlmICghc3RhdGUgJiYgIW1hdGNoICYmIGkgKyAxID09PSBpaSAmJiAhSW5pdGlhbFN0YXRlW2ZuQXJyYXlbaV1dKSB7CiAgICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9IGlpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5jb250ZXh0OwogICAgd2hpbGUgKGkgPCBpaSkgewogICAgICBpZiAobWF0Y2gpIHsKICAgICAgICBjb25zdCBpdGVyYXRlID0gKDAsIG1hdGNoLml0ZXJhdGVGbikoY29udGV4dCwgaSk7CiAgICAgICAgaWYgKGl0ZXJhdGUpIHsKICAgICAgICAgIGkrKzsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpID0gKDAsIG1hdGNoLnByb2Nlc3NGbikoY29udGV4dCwgaSArIDEpOwogICAgICAgIGlpID0gZm5BcnJheS5sZW5ndGg7CiAgICAgICAgbWF0Y2ggPSBudWxsOwogICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICBpZiAoaSA+PSBpaSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0YXRlID0gKHN0YXRlIHx8IEluaXRpYWxTdGF0ZSlbZm5BcnJheVtpXV07CiAgICAgIGlmICghc3RhdGUgfHwgQXJyYXkuaXNBcnJheShzdGF0ZSkpIHsKICAgICAgICBpKys7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29udGV4dC5pQ3VyciA9IGk7CiAgICAgIGkrKzsKICAgICAgaWYgKHN0YXRlLmNoZWNrRm4gJiYgISgwLCBzdGF0ZS5jaGVja0ZuKShjb250ZXh0KSkgewogICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBtYXRjaCA9IHN0YXRlOwogICAgICBzdGF0ZSA9IG51bGw7CiAgICB9CiAgICB0aGlzLnN0YXRlID0gc3RhdGU7CiAgICB0aGlzLm1hdGNoID0gbWF0Y2g7CiAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSBpOwogIH0KICBmbHVzaCgpIHsKICAgIHdoaWxlICh0aGlzLm1hdGNoKSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMucXVldWUuZm5BcnJheS5sZW5ndGg7CiAgICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9ICgwLCB0aGlzLm1hdGNoLnByb2Nlc3NGbikodGhpcy5jb250ZXh0LCBsZW5ndGgpOwogICAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgICAgdGhpcy5zdGF0ZSA9IG51bGw7CiAgICAgIHRoaXMuX29wdGltaXplKCk7CiAgICB9CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5zdGF0ZSA9IG51bGw7CiAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9IDA7CiAgfQp9CmNsYXNzIE9wZXJhdG9yTGlzdCB7CiAgc3RhdGljIENIVU5LX1NJWkUgPSAxMDAwOwogIHN0YXRpYyBDSFVOS19TSVpFX0FCT1VUID0gdGhpcy5DSFVOS19TSVpFIC0gNTsKICBzdGF0aWMgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPSBmYWxzZTsKICBjb25zdHJ1Y3RvcihpbnRlbnQgPSAwLCBzdHJlYW1TaW5rKSB7CiAgICB0aGlzLl9zdHJlYW1TaW5rID0gc3RyZWFtU2luazsKICAgIHRoaXMuZm5BcnJheSA9IFtdOwogICAgdGhpcy5hcmdzQXJyYXkgPSBbXTsKICAgIHRoaXMub3B0aW1pemVyID0gc3RyZWFtU2luayAmJiAhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuT1BMSVNUKSA/IG5ldyBRdWV1ZU9wdGltaXplcih0aGlzKSA6IG5ldyBOdWxsT3B0aW1pemVyKHRoaXMpOwogICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl90b3RhbExlbmd0aCA9IDA7CiAgICB0aGlzLndlaWdodCA9IDA7CiAgICB0aGlzLl9yZXNvbHZlZCA9IHN0cmVhbVNpbmsgPyBudWxsIDogUHJvbWlzZS5yZXNvbHZlKCk7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkCiAgfSkgewogICAgdGhpcy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuYXJnc0FycmF5Lmxlbmd0aDsKICB9CiAgZ2V0IHJlYWR5KCkgewogICAgcmV0dXJuIHRoaXMuX3Jlc29sdmVkIHx8IHRoaXMuX3N0cmVhbVNpbmsucmVhZHk7CiAgfQogIGdldCB0b3RhbExlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLl90b3RhbExlbmd0aCArIHRoaXMubGVuZ3RoOwogIH0KICBhZGRPcChmbiwgYXJncykgewogICAgdGhpcy5vcHRpbWl6ZXIucHVzaChmbiwgYXJncyk7CiAgICB0aGlzLndlaWdodCsrOwogICAgaWYgKHRoaXMuX3N0cmVhbVNpbmspIHsKICAgICAgaWYgKHRoaXMud2VpZ2h0ID49IE9wZXJhdG9yTGlzdC5DSFVOS19TSVpFKSB7CiAgICAgICAgdGhpcy5mbHVzaCgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMud2VpZ2h0ID49IE9wZXJhdG9yTGlzdC5DSFVOS19TSVpFX0FCT1VUICYmIChmbiA9PT0gT1BTLnJlc3RvcmUgfHwgZm4gPT09IE9QUy5lbmRUZXh0KSkgewogICAgICAgIHRoaXMuZmx1c2goKTsKICAgICAgfQogICAgfQogIH0KICBhZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrID0gZmFsc2UpIHsKICAgIGlmIChoYXNNYXNrKSB7CiAgICAgIHRoaXMuYWRkT3AoT1BTLnNhdmUpOwogICAgICB0aGlzLmFkZE9wKE9QUy5zZXRHU3RhdGUsIFtbWyJTTWFzayIsIGZhbHNlXV1dKTsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmFkZE9wKE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG9wdGlvbmFsQ29udGVudF0pOwogICAgfQogICAgdGhpcy5hZGRPcChmbiwgYXJncyk7CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5hZGRPcChPUFMuZW5kTWFya2VkQ29udGVudCwgW10pOwogICAgfQogICAgaWYgKGhhc01hc2spIHsKICAgICAgdGhpcy5hZGRPcChPUFMucmVzdG9yZSk7CiAgICB9CiAgfQogIGFkZERlcGVuZGVuY3koZGVwZW5kZW5jeSkgewogICAgaWYgKHRoaXMuZGVwZW5kZW5jaWVzLmhhcyhkZXBlbmRlbmN5KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmRlcGVuZGVuY2llcy5hZGQoZGVwZW5kZW5jeSk7CiAgICB0aGlzLmFkZE9wKE9QUy5kZXBlbmRlbmN5LCBbZGVwZW5kZW5jeV0pOwogIH0KICBhZGREZXBlbmRlbmNpZXMoZGVwZW5kZW5jaWVzKSB7CiAgICBmb3IgKGNvbnN0IGRlcGVuZGVuY3kgb2YgZGVwZW5kZW5jaWVzKSB7CiAgICAgIHRoaXMuYWRkRGVwZW5kZW5jeShkZXBlbmRlbmN5KTsKICAgIH0KICB9CiAgYWRkT3BMaXN0KG9wTGlzdCkgewogICAgaWYgKCEob3BMaXN0IGluc3RhbmNlb2YgT3BlcmF0b3JMaXN0KSkgewogICAgICB3YXJuKCdhZGRPcExpc3QgLSBpZ25vcmluZyBpbnZhbGlkICJvcExpc3QiIHBhcmFtZXRlci4nKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBkZXBlbmRlbmN5IG9mIG9wTGlzdC5kZXBlbmRlbmNpZXMpIHsKICAgICAgdGhpcy5kZXBlbmRlbmNpZXMuYWRkKGRlcGVuZGVuY3kpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb3BMaXN0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgdGhpcy5hZGRPcChvcExpc3QuZm5BcnJheVtpXSwgb3BMaXN0LmFyZ3NBcnJheVtpXSk7CiAgICB9CiAgfQogIGdldElSKCkgewogICAgcmV0dXJuIHsKICAgICAgZm5BcnJheTogdGhpcy5mbkFycmF5LAogICAgICBhcmdzQXJyYXk6IHRoaXMuYXJnc0FycmF5LAogICAgICBsZW5ndGg6IHRoaXMubGVuZ3RoCiAgICB9OwogIH0KICBnZXQgX3RyYW5zZmVycygpIHsKICAgIGNvbnN0IHRyYW5zZmVycyA9IFtdOwogICAgY29uc3QgewogICAgICBmbkFycmF5LAogICAgICBhcmdzQXJyYXksCiAgICAgIGxlbmd0aAogICAgfSA9IHRoaXM7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHN3aXRjaCAoZm5BcnJheVtpXSkgewogICAgICAgIGNhc2UgT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0OgogICAgICAgIGNhc2UgT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXA6CiAgICAgICAgY2FzZSBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0OgogICAgICAgICAgewogICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgYml0bWFwLAogICAgICAgICAgICAgIGRhdGEKICAgICAgICAgICAgfSA9IGFyZ3NBcnJheVtpXVswXTsKICAgICAgICAgICAgaWYgKGJpdG1hcCB8fCBkYXRhPy5idWZmZXIpIHsKICAgICAgICAgICAgICB0cmFuc2ZlcnMucHVzaChiaXRtYXAgfHwgZGF0YS5idWZmZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIGNhc2UgT1BTLmNvbnN0cnVjdFBhdGg6CiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IFssIFtkYXRhXSwgbWluTWF4XSA9IGFyZ3NBcnJheVtpXTsKICAgICAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgICB0cmFuc2ZlcnMucHVzaChkYXRhLmJ1ZmZlciwgbWluTWF4LmJ1ZmZlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgY2FzZSBPUFMucGFpbnRGb3JtWE9iamVjdEJlZ2luOgogICAgICAgICAgY29uc3QgW21hdHJpeCwgYmJveF0gPSBhcmdzQXJyYXlbaV07CiAgICAgICAgICBpZiAobWF0cml4KSB7CiAgICAgICAgICAgIHRyYW5zZmVycy5wdXNoKG1hdHJpeC5idWZmZXIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGJib3gpIHsKICAgICAgICAgICAgdHJhbnNmZXJzLnB1c2goYmJveC5idWZmZXIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBPUFMuc2V0VGV4dE1hdHJpeDoKICAgICAgICAgIHRyYW5zZmVycy5wdXNoKGFyZ3NBcnJheVtpXVswXS5idWZmZXIpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cmFuc2ZlcnM7CiAgfQogIGZsdXNoKGxhc3RDaHVuayA9IGZhbHNlLCBzZXBhcmF0ZUFubm90cyA9IG51bGwpIHsKICAgIHRoaXMub3B0aW1pemVyLmZsdXNoKCk7CiAgICBjb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgIHRoaXMuX3RvdGFsTGVuZ3RoICs9IGxlbmd0aDsKICAgIHRoaXMuX3N0cmVhbVNpbmsuZW5xdWV1ZSh7CiAgICAgIGZuQXJyYXk6IHRoaXMuZm5BcnJheSwKICAgICAgYXJnc0FycmF5OiB0aGlzLmFyZ3NBcnJheSwKICAgICAgbGFzdENodW5rLAogICAgICBzZXBhcmF0ZUFubm90cywKICAgICAgbGVuZ3RoCiAgICB9LCAxLCB0aGlzLl90cmFuc2ZlcnMpOwogICAgdGhpcy5kZXBlbmRlbmNpZXMuY2xlYXIoKTsKICAgIHRoaXMuZm5BcnJheS5sZW5ndGggPSAwOwogICAgdGhpcy5hcmdzQXJyYXkubGVuZ3RoID0gMDsKICAgIHRoaXMud2VpZ2h0ID0gMDsKICAgIHRoaXMub3B0aW1pemVyLnJlc2V0KCk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9iaW5hcnlfY21hcC5qcwoKZnVuY3Rpb24gaGV4VG9JbnQoYSwgc2l6ZSkgewogIGxldCBuID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgIG4gPSBuIDw8IDggfCBhW2ldOwogIH0KICByZXR1cm4gbiA+Pj4gMDsKfQpmdW5jdGlvbiBoZXhUb1N0cihhLCBzaXplKSB7CiAgaWYgKHNpemUgPT09IDEpIHsKICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGFbMF0sIGFbMV0pOwogIH0KICBpZiAoc2l6ZSA9PT0gMykgewogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYVswXSwgYVsxXSwgYVsyXSwgYVszXSk7CiAgfQogIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmEuc3ViYXJyYXkoMCwgc2l6ZSArIDEpKTsKfQpmdW5jdGlvbiBhZGRIZXgoYSwgYiwgc2l6ZSkgewogIGxldCBjID0gMDsKICBmb3IgKGxldCBpID0gc2l6ZTsgaSA+PSAwOyBpLS0pIHsKICAgIGMgKz0gYVtpXSArIGJbaV07CiAgICBhW2ldID0gYyAmIDI1NTsKICAgIGMgPj49IDg7CiAgfQp9CmZ1bmN0aW9uIGluY0hleChhLCBzaXplKSB7CiAgbGV0IGMgPSAxOwogIGZvciAobGV0IGkgPSBzaXplOyBpID49IDAgJiYgYyA+IDA7IGktLSkgewogICAgYyArPSBhW2ldOwogICAgYVtpXSA9IGMgJiAyNTU7CiAgICBjID4+PSA4OwogIH0KfQpjb25zdCBNQVhfTlVNX1NJWkUgPSAxNjsKY29uc3QgTUFYX0VOQ09ERURfTlVNX1NJWkUgPSAxOTsKY2xhc3MgQmluYXJ5Q01hcFN0cmVhbSB7CiAgY29uc3RydWN0b3IoZGF0YSkgewogICAgdGhpcy5idWZmZXIgPSBkYXRhOwogICAgdGhpcy5wb3MgPSAwOwogICAgdGhpcy5lbmQgPSBkYXRhLmxlbmd0aDsKICAgIHRoaXMudG1wQnVmID0gbmV3IFVpbnQ4QXJyYXkoTUFYX0VOQ09ERURfTlVNX1NJWkUpOwogIH0KICByZWFkQnl0ZSgpIHsKICAgIGlmICh0aGlzLnBvcyA+PSB0aGlzLmVuZCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICByZXR1cm4gdGhpcy5idWZmZXJbdGhpcy5wb3MrK107CiAgfQogIHJlYWROdW1iZXIoKSB7CiAgICBsZXQgbiA9IDA7CiAgICBsZXQgbGFzdDsKICAgIGRvIHsKICAgICAgY29uc3QgYiA9IHRoaXMucmVhZEJ5dGUoKTsKICAgICAgaWYgKGIgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJ1bmV4cGVjdGVkIEVPRiBpbiBiY21hcCIpOwogICAgICB9CiAgICAgIGxhc3QgPSAhKGIgJiAweDgwKTsKICAgICAgbiA9IG4gPDwgNyB8IGIgJiAweDdmOwogICAgfSB3aGlsZSAoIWxhc3QpOwogICAgcmV0dXJuIG47CiAgfQogIHJlYWRTaWduZWQoKSB7CiAgICBjb25zdCBuID0gdGhpcy5yZWFkTnVtYmVyKCk7CiAgICByZXR1cm4gbiAmIDEgPyB+KG4gPj4+IDEpIDogbiA+Pj4gMTsKICB9CiAgcmVhZEhleChudW0sIHNpemUpIHsKICAgIG51bS5zZXQodGhpcy5idWZmZXIuc3ViYXJyYXkodGhpcy5wb3MsIHRoaXMucG9zICsgc2l6ZSArIDEpKTsKICAgIHRoaXMucG9zICs9IHNpemUgKyAxOwogIH0KICByZWFkSGV4TnVtYmVyKG51bSwgc2l6ZSkgewogICAgbGV0IGxhc3Q7CiAgICBjb25zdCBzdGFjayA9IHRoaXMudG1wQnVmOwogICAgbGV0IHNwID0gMDsKICAgIGRvIHsKICAgICAgY29uc3QgYiA9IHRoaXMucmVhZEJ5dGUoKTsKICAgICAgaWYgKGIgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJ1bmV4cGVjdGVkIEVPRiBpbiBiY21hcCIpOwogICAgICB9CiAgICAgIGxhc3QgPSAhKGIgJiAweDgwKTsKICAgICAgc3RhY2tbc3ArK10gPSBiICYgMHg3ZjsKICAgIH0gd2hpbGUgKCFsYXN0KTsKICAgIGxldCBpID0gc2l6ZSwKICAgICAgYnVmZmVyID0gMCwKICAgICAgYnVmZmVyU2l6ZSA9IDA7CiAgICB3aGlsZSAoaSA+PSAwKSB7CiAgICAgIHdoaWxlIChidWZmZXJTaXplIDwgOCAmJiBzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgYnVmZmVyIHw9IHN0YWNrWy0tc3BdIDw8IGJ1ZmZlclNpemU7CiAgICAgICAgYnVmZmVyU2l6ZSArPSA3OwogICAgICB9CiAgICAgIG51bVtpXSA9IGJ1ZmZlciAmIDI1NTsKICAgICAgaS0tOwogICAgICBidWZmZXIgPj49IDg7CiAgICAgIGJ1ZmZlclNpemUgLT0gODsKICAgIH0KICB9CiAgcmVhZEhleFNpZ25lZChudW0sIHNpemUpIHsKICAgIHRoaXMucmVhZEhleE51bWJlcihudW0sIHNpemUpOwogICAgY29uc3Qgc2lnbiA9IG51bVtzaXplXSAmIDEgPyAyNTUgOiAwOwogICAgbGV0IGMgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc2l6ZTsgaSsrKSB7CiAgICAgIGMgPSAoYyAmIDEpIDw8IDggfCBudW1baV07CiAgICAgIG51bVtpXSA9IGMgPj4gMSBeIHNpZ247CiAgICB9CiAgfQogIHJlYWRTdHJpbmcoKSB7CiAgICBjb25zdCBsZW4gPSB0aGlzLnJlYWROdW1iZXIoKSwKICAgICAgYnVmID0gbmV3IEFycmF5KGxlbik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGJ1ZltpXSA9IHRoaXMucmVhZE51bWJlcigpOwogICAgfQogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnVmKTsKICB9Cn0KY2xhc3MgQmluYXJ5Q01hcFJlYWRlciB7CiAgYXN5bmMgcHJvY2VzcyhkYXRhLCBjTWFwLCBleHRlbmQpIHsKICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBCaW5hcnlDTWFwU3RyZWFtKGRhdGEpOwogICAgY29uc3QgaGVhZGVyID0gc3RyZWFtLnJlYWRCeXRlKCk7CiAgICBjTWFwLnZlcnRpY2FsID0gISEoaGVhZGVyICYgMSk7CiAgICBsZXQgdXNlQ01hcCA9IG51bGw7CiAgICBjb25zdCBzdGFydCA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCBlbmQgPSBuZXcgVWludDhBcnJheShNQVhfTlVNX1NJWkUpOwogICAgY29uc3QgY2hhciA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCBjaGFyQ29kZSA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCB0bXAgPSBuZXcgVWludDhBcnJheShNQVhfTlVNX1NJWkUpOwogICAgbGV0IGNvZGU7CiAgICBsZXQgYjsKICAgIHdoaWxlICgoYiA9IHN0cmVhbS5yZWFkQnl0ZSgpKSA+PSAwKSB7CiAgICAgIGNvbnN0IHR5cGUgPSBiID4+IDU7CiAgICAgIGlmICh0eXBlID09PSA3KSB7CiAgICAgICAgc3dpdGNoIChiICYgMHgxZikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBzdHJlYW0ucmVhZFN0cmluZygpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdXNlQ01hcCA9IHN0cmVhbS5yZWFkU3RyaW5nKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBzZXF1ZW5jZSA9ICEhKGIgJiAweDEwKTsKICAgICAgY29uc3QgZGF0YVNpemUgPSBiICYgMTU7CiAgICAgIGlmIChkYXRhU2l6ZSArIDEgPiBNQVhfTlVNX1NJWkUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkJpbmFyeUNNYXBSZWFkZXIucHJvY2VzczogSW52YWxpZCBkYXRhU2l6ZS4iKTsKICAgICAgfQogICAgICBjb25zdCB1Y3MyRGF0YVNpemUgPSAxOwogICAgICBjb25zdCBzdWJpdGVtc0NvdW50ID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIGNNYXAuYWRkQ29kZXNwYWNlUmFuZ2UoZGF0YVNpemUgKyAxLCBoZXhUb0ludChzdGFydCwgZGF0YVNpemUpLCBoZXhUb0ludChlbmQsIGRhdGFTaXplKSk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChzdGFydCwgZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICBjTWFwLmFkZENvZGVzcGFjZVJhbmdlKGRhdGFTaXplICsgMSwgaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChzdGFydCwgZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICBzdHJlYW0ucmVhZE51bWJlcigpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhciwgZGF0YVNpemUpOwogICAgICAgICAgY29kZSA9IHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChjaGFyLCBkYXRhU2l6ZSksIGNvZGUpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGNoYXIsIGRhdGFTaXplKTsKICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICAgIGFkZEhleChjaGFyLCB0bXAsIGRhdGFTaXplKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWRTaWduZWQoKSArIChjb2RlICsgMSk7CiAgICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIGRhdGFTaXplKSwgY29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgY29kZSA9IHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICBjTWFwLm1hcENpZFJhbmdlKGhleFRvSW50KHN0YXJ0LCBkYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgZGF0YVNpemUpLCBjb2RlKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdGFydC5zZXQoZW5kKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgY29kZSA9IHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICAgIGNNYXAubWFwQ2lkUmFuZ2UoaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSksIGNvZGUpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhciwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChjaGFyLCB1Y3MyRGF0YVNpemUpLCBoZXhUb1N0cihjaGFyQ29kZSwgZGF0YVNpemUpKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChjaGFyLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIodG1wLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICAgIGFkZEhleChjaGFyLCB0bXAsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5jSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4U2lnbmVkKHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoY2hhckNvZGUsIHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICBjTWFwLm1hcE9uZShoZXhUb0ludChjaGFyLCB1Y3MyRGF0YVNpemUpLCBoZXhUb1N0cihjaGFyQ29kZSwgZGF0YVNpemUpKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNToKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KHN0YXJ0LCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyQ29kZSwgZGF0YVNpemUpOwogICAgICAgICAgY01hcC5tYXBCZlJhbmdlKGhleFRvSW50KHN0YXJ0LCB1Y3MyRGF0YVNpemUpLCBoZXhUb0ludChlbmQsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGVuZCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgaWYgKCFzZXF1ZW5jZSkgewogICAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKHN0YXJ0LCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICAgIGFkZEhleChzdGFydCwgZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXJ0LnNldChlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KGVuZCwgc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGNNYXAubWFwQmZSYW5nZShoZXhUb0ludChzdGFydCwgdWNzMkRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCB1Y3MyRGF0YVNpemUpLCBoZXhUb1N0cihjaGFyQ29kZSwgZGF0YVNpemUpKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJpbmFyeUNNYXBSZWFkZXIucHJvY2VzcyAtIHVua25vd24gdHlwZTogJHt0eXBlfWApOwogICAgICB9CiAgICB9CiAgICBpZiAodXNlQ01hcCkgewogICAgICByZXR1cm4gZXh0ZW5kKHVzZUNNYXApOwogICAgfQogICAgcmV0dXJuIGNNYXA7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9hc2NpaV84NV9zdHJlYW0uanMKCgpjbGFzcyBBc2NpaTg1U3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBpZiAobWF5YmVMZW5ndGgpIHsKICAgICAgbWF5YmVMZW5ndGggKj0gMC44OwogICAgfQogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIHRoaXMuaW5wdXQgPSBuZXcgVWludDhBcnJheSg1KTsKICB9CiAgcmVhZEJsb2NrKCkgewogICAgY29uc3QgVElMREFfQ0hBUiA9IDB4N2U7CiAgICBjb25zdCBaX0xPV0VSX0NIQVIgPSAweDdhOwogICAgY29uc3QgRU9GID0gLTE7CiAgICBjb25zdCBzdHIgPSB0aGlzLnN0cjsKICAgIGxldCBjID0gc3RyLmdldEJ5dGUoKTsKICAgIHdoaWxlIChpc1doaXRlU3BhY2UoYykpIHsKICAgICAgYyA9IHN0ci5nZXRCeXRlKCk7CiAgICB9CiAgICBpZiAoYyA9PT0gRU9GIHx8IGMgPT09IFRJTERBX0NIQVIpIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBidWZmZXIsIGk7CiAgICBpZiAoYyA9PT0gWl9MT1dFUl9DSEFSKSB7CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIDQpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgNDsgKytpKSB7CiAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCArIGldID0gMDsKICAgICAgfQogICAgICB0aGlzLmJ1ZmZlckxlbmd0aCArPSA0OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgaW5wdXQgPSB0aGlzLmlucHV0OwogICAgICBpbnB1dFswXSA9IGM7CiAgICAgIGZvciAoaSA9IDE7IGkgPCA1OyArK2kpIHsKICAgICAgICBjID0gc3RyLmdldEJ5dGUoKTsKICAgICAgICB3aGlsZSAoaXNXaGl0ZVNwYWNlKGMpKSB7CiAgICAgICAgICBjID0gc3RyLmdldEJ5dGUoKTsKICAgICAgICB9CiAgICAgICAgaW5wdXRbaV0gPSBjOwogICAgICAgIGlmIChjID09PSBFT0YgfHwgYyA9PT0gVElMREFfQ0hBUikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIGkgLSAxKTsKICAgICAgdGhpcy5idWZmZXJMZW5ndGggKz0gaSAtIDE7CiAgICAgIGlmIChpIDwgNSkgewogICAgICAgIGZvciAoOyBpIDwgNTsgKytpKSB7CiAgICAgICAgICBpbnB1dFtpXSA9IDB4MjEgKyA4NDsKICAgICAgICB9CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICB9CiAgICAgIGxldCB0ID0gMDsKICAgICAgZm9yIChpID0gMDsgaSA8IDU7ICsraSkgewogICAgICAgIHQgPSB0ICogODUgKyAoaW5wdXRbaV0gLSAweDIxKTsKICAgICAgfQogICAgICBmb3IgKGkgPSAzOyBpID49IDA7IC0taSkgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGggKyBpXSA9IHQgJiAweGZmOwogICAgICAgIHQgPj49IDg7CiAgICAgIH0KICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2FzY2lpX2hleF9zdHJlYW0uanMKCmNsYXNzIEFzY2lpSGV4U3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBpZiAobWF5YmVMZW5ndGgpIHsKICAgICAgbWF5YmVMZW5ndGggKj0gMC41OwogICAgfQogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIHRoaXMuZmlyc3REaWdpdCA9IC0xOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCBVUFNUUkVBTV9CTE9DS19TSVpFID0gODAwMDsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5zdHIuZ2V0Qnl0ZXMoVVBTVFJFQU1fQkxPQ0tfU0laRSk7CiAgICBpZiAoIWJ5dGVzLmxlbmd0aCkgewogICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1heERlY29kZUxlbmd0aCA9IGJ5dGVzLmxlbmd0aCArIDEgPj4gMTsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgbWF4RGVjb2RlTGVuZ3RoKTsKICAgIGxldCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBmaXJzdERpZ2l0ID0gdGhpcy5maXJzdERpZ2l0OwogICAgZm9yIChjb25zdCBjaCBvZiBieXRlcykgewogICAgICBsZXQgZGlnaXQ7CiAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkpIHsKICAgICAgICBkaWdpdCA9IGNoICYgMHgwZjsKICAgICAgfSBlbHNlIGlmIChjaCA+PSAweDQxICYmIGNoIDw9IDB4NDYgfHwgY2ggPj0gMHg2MSAmJiBjaCA8PSAweDY2KSB7CiAgICAgICAgZGlnaXQgPSAoY2ggJiAweDBmKSArIDk7CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGZpcnN0RGlnaXQgPCAwKSB7CiAgICAgICAgZmlyc3REaWdpdCA9IGRpZ2l0OwogICAgICB9IGVsc2UgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGgrK10gPSBmaXJzdERpZ2l0IDw8IDQgfCBkaWdpdDsKICAgICAgICBmaXJzdERpZ2l0ID0gLTE7CiAgICAgIH0KICAgIH0KICAgIGlmIChmaXJzdERpZ2l0ID49IDAgJiYgdGhpcy5lb2YpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCsrXSA9IGZpcnN0RGlnaXQgPDwgNDsKICAgICAgZmlyc3REaWdpdCA9IC0xOwogICAgfQogICAgdGhpcy5maXJzdERpZ2l0ID0gZmlyc3REaWdpdDsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2NpdHQuanMKCmNvbnN0IGNjaXR0RU9MID0gLTI7CmNvbnN0IGNjaXR0RU9GID0gLTE7CmNvbnN0IHR3b0RpbVBhc3MgPSAwOwpjb25zdCB0d29EaW1Ib3JpeiA9IDE7CmNvbnN0IHR3b0RpbVZlcnQwID0gMjsKY29uc3QgdHdvRGltVmVydFIxID0gMzsKY29uc3QgdHdvRGltVmVydEwxID0gNDsKY29uc3QgdHdvRGltVmVydFIyID0gNTsKY29uc3QgdHdvRGltVmVydEwyID0gNjsKY29uc3QgdHdvRGltVmVydFIzID0gNzsKY29uc3QgdHdvRGltVmVydEwzID0gODsKY29uc3QgdHdvRGltVGFibGUgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbNywgdHdvRGltVmVydEwzXSwgWzcsIHR3b0RpbVZlcnRSM10sIFs2LCB0d29EaW1WZXJ0TDJdLCBbNiwgdHdvRGltVmVydEwyXSwgWzYsIHR3b0RpbVZlcnRSMl0sIFs2LCB0d29EaW1WZXJ0UjJdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdXTsKY29uc3Qgd2hpdGVUYWJsZTEgPSBbWy0xLCAtMV0sIFsxMiwgY2NpdHRFT0xdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMiwgMTk4NF0sIFsxMiwgMjA0OF0sIFsxMiwgMjExMl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjI0MF0sIFsxMiwgMjMwNF0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMiwgMjM2OF0sIFsxMiwgMjQzMl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjU2MF1dOwpjb25zdCB3aGl0ZVRhYmxlMiA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWzgsIDI5XSwgWzgsIDI5XSwgWzgsIDMwXSwgWzgsIDMwXSwgWzgsIDQ1XSwgWzgsIDQ1XSwgWzgsIDQ2XSwgWzgsIDQ2XSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzgsIDQ3XSwgWzgsIDQ3XSwgWzgsIDQ4XSwgWzgsIDQ4XSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzgsIDMzXSwgWzgsIDMzXSwgWzgsIDM0XSwgWzgsIDM0XSwgWzgsIDM1XSwgWzgsIDM1XSwgWzgsIDM2XSwgWzgsIDM2XSwgWzgsIDM3XSwgWzgsIDM3XSwgWzgsIDM4XSwgWzgsIDM4XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzgsIDMxXSwgWzgsIDMxXSwgWzgsIDMyXSwgWzgsIDMyXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs4LCA1M10sIFs4LCA1M10sIFs4LCA1NF0sIFs4LCA1NF0sIFs3LCAyNl0sIFs3LCAyNl0sIFs3LCAyNl0sIFs3LCAyNl0sIFs4LCAzOV0sIFs4LCAzOV0sIFs4LCA0MF0sIFs4LCA0MF0sIFs4LCA0MV0sIFs4LCA0MV0sIFs4LCA0Ml0sIFs4LCA0Ml0sIFs4LCA0M10sIFs4LCA0M10sIFs4LCA0NF0sIFs4LCA0NF0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyOF0sIFs3LCAyOF0sIFs3LCAyOF0sIFs3LCAyOF0sIFs4LCA2MV0sIFs4LCA2MV0sIFs4LCA2Ml0sIFs4LCA2Ml0sIFs4LCA2M10sIFs4LCA2M10sIFs4LCAwXSwgWzgsIDBdLCBbOCwgMzIwXSwgWzgsIDMyMF0sIFs4LCAzODRdLCBbOCwgMzg0XSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzcsIDI3XSwgWzcsIDI3XSwgWzcsIDI3XSwgWzcsIDI3XSwgWzgsIDU5XSwgWzgsIDU5XSwgWzgsIDYwXSwgWzgsIDYwXSwgWzksIDE0NzJdLCBbOSwgMTUzNl0sIFs5LCAxNjAwXSwgWzksIDE3MjhdLCBbNywgMThdLCBbNywgMThdLCBbNywgMThdLCBbNywgMThdLCBbNywgMjRdLCBbNywgMjRdLCBbNywgMjRdLCBbNywgMjRdLCBbOCwgNDldLCBbOCwgNDldLCBbOCwgNTBdLCBbOCwgNTBdLCBbOCwgNTFdLCBbOCwgNTFdLCBbOCwgNTJdLCBbOCwgNTJdLCBbNywgMjVdLCBbNywgMjVdLCBbNywgMjVdLCBbNywgMjVdLCBbOCwgNTVdLCBbOCwgNTVdLCBbOCwgNTZdLCBbOCwgNTZdLCBbOCwgNTddLCBbOCwgNTddLCBbOCwgNThdLCBbOCwgNThdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbOCwgNDQ4XSwgWzgsIDQ0OF0sIFs4LCA1MTJdLCBbOCwgNTEyXSwgWzksIDcwNF0sIFs5LCA3NjhdLCBbOCwgNjQwXSwgWzgsIDY0MF0sIFs4LCA1NzZdLCBbOCwgNTc2XSwgWzksIDgzMl0sIFs5LCA4OTZdLCBbOSwgOTYwXSwgWzksIDEwMjRdLCBbOSwgMTA4OF0sIFs5LCAxMTUyXSwgWzksIDEyMTZdLCBbOSwgMTI4MF0sIFs5LCAxMzQ0XSwgWzksIDE0MDhdLCBbNywgMjU2XSwgWzcsIDI1Nl0sIFs3LCAyNTZdLCBbNywgMjU2XSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddXTsKY29uc3QgYmxhY2tUYWJsZTEgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbMTIsIGNjaXR0RU9MXSwgWzEyLCBjY2l0dEVPTF0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTIsIDE5ODRdLCBbMTIsIDE5ODRdLCBbMTIsIDIwNDhdLCBbMTIsIDIwNDhdLCBbMTIsIDIxMTJdLCBbMTIsIDIxMTJdLCBbMTIsIDIxNzZdLCBbMTIsIDIxNzZdLCBbMTIsIDIyNDBdLCBbMTIsIDIyNDBdLCBbMTIsIDIzMDRdLCBbMTIsIDIzMDRdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTIsIDIzNjhdLCBbMTIsIDIzNjhdLCBbMTIsIDI0MzJdLCBbMTIsIDI0MzJdLCBbMTIsIDI0OTZdLCBbMTIsIDI0OTZdLCBbMTIsIDI1NjBdLCBbMTIsIDI1NjBdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMiwgNTJdLCBbMTIsIDUyXSwgWzEzLCA2NDBdLCBbMTMsIDcwNF0sIFsxMywgNzY4XSwgWzEzLCA4MzJdLCBbMTIsIDU1XSwgWzEyLCA1NV0sIFsxMiwgNTZdLCBbMTIsIDU2XSwgWzEzLCAxMjgwXSwgWzEzLCAxMzQ0XSwgWzEzLCAxNDA4XSwgWzEzLCAxNDcyXSwgWzEyLCA1OV0sIFsxMiwgNTldLCBbMTIsIDYwXSwgWzEyLCA2MF0sIFsxMywgMTUzNl0sIFsxMywgMTYwMF0sIFsxMSwgMjRdLCBbMTEsIDI0XSwgWzExLCAyNF0sIFsxMSwgMjRdLCBbMTEsIDI1XSwgWzExLCAyNV0sIFsxMSwgMjVdLCBbMTEsIDI1XSwgWzEzLCAxNjY0XSwgWzEzLCAxNzI4XSwgWzEyLCAzMjBdLCBbMTIsIDMyMF0sIFsxMiwgMzg0XSwgWzEyLCAzODRdLCBbMTIsIDQ0OF0sIFsxMiwgNDQ4XSwgWzEzLCA1MTJdLCBbMTMsIDU3Nl0sIFsxMiwgNTNdLCBbMTIsIDUzXSwgWzEyLCA1NF0sIFsxMiwgNTRdLCBbMTMsIDg5Nl0sIFsxMywgOTYwXSwgWzEzLCAxMDI0XSwgWzEzLCAxMDg4XSwgWzEzLCAxMTUyXSwgWzEzLCAxMjE2XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdXTsKY29uc3QgYmxhY2tUYWJsZTIgPSBbWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzExLCAyM10sIFsxMSwgMjNdLCBbMTIsIDUwXSwgWzEyLCA1MV0sIFsxMiwgNDRdLCBbMTIsIDQ1XSwgWzEyLCA0Nl0sIFsxMiwgNDddLCBbMTIsIDU3XSwgWzEyLCA1OF0sIFsxMiwgNjFdLCBbMTIsIDI1Nl0sIFsxMCwgMTZdLCBbMTAsIDE2XSwgWzEwLCAxNl0sIFsxMCwgMTZdLCBbMTAsIDE3XSwgWzEwLCAxN10sIFsxMCwgMTddLCBbMTAsIDE3XSwgWzEyLCA0OF0sIFsxMiwgNDldLCBbMTIsIDYyXSwgWzEyLCA2M10sIFsxMiwgMzBdLCBbMTIsIDMxXSwgWzEyLCAzMl0sIFsxMiwgMzNdLCBbMTIsIDQwXSwgWzEyLCA0MV0sIFsxMSwgMjJdLCBbMTEsIDIyXSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzEyLCAxMjhdLCBbMTIsIDE5Ml0sIFsxMiwgMjZdLCBbMTIsIDI3XSwgWzEyLCAyOF0sIFsxMiwgMjldLCBbMTEsIDE5XSwgWzExLCAxOV0sIFsxMSwgMjBdLCBbMTEsIDIwXSwgWzEyLCAzNF0sIFsxMiwgMzVdLCBbMTIsIDM2XSwgWzEyLCAzN10sIFsxMiwgMzhdLCBbMTIsIDM5XSwgWzExLCAyMV0sIFsxMSwgMjFdLCBbMTIsIDQyXSwgWzEyLCA0M10sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl1dOwpjb25zdCBibGFja1RhYmxlMyA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWzYsIDldLCBbNiwgOF0sIFs1LCA3XSwgWzUsIDddLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXV07CmNsYXNzIENDSVRURmF4RGVjb2RlciB7CiAgY29uc3RydWN0b3Ioc291cmNlLCBvcHRpb25zID0ge30pIHsKICAgIGlmICh0eXBlb2Ygc291cmNlPy5uZXh0ICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ0NJVFRGYXhEZWNvZGVyIC0gaW52YWxpZCAic291cmNlIiBwYXJhbWV0ZXIuJyk7CiAgICB9CiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsKICAgIHRoaXMuZW9mID0gZmFsc2U7CiAgICB0aGlzLmVuY29kaW5nID0gb3B0aW9ucy5LIHx8IDA7CiAgICB0aGlzLmVvbGluZSA9IG9wdGlvbnMuRW5kT2ZMaW5lIHx8IGZhbHNlOwogICAgdGhpcy5ieXRlQWxpZ24gPSBvcHRpb25zLkVuY29kZWRCeXRlQWxpZ24gfHwgZmFsc2U7CiAgICB0aGlzLmNvbHVtbnMgPSBvcHRpb25zLkNvbHVtbnMgfHwgMTcyODsKICAgIHRoaXMucm93cyA9IG9wdGlvbnMuUm93cyB8fCAwOwogICAgdGhpcy5lb2Jsb2NrID0gb3B0aW9ucy5FbmRPZkJsb2NrID8/IHRydWU7CiAgICB0aGlzLmJsYWNrID0gb3B0aW9ucy5CbGFja0lzMSB8fCBmYWxzZTsKICAgIHRoaXMuY29kaW5nTGluZSA9IG5ldyBVaW50MzJBcnJheSh0aGlzLmNvbHVtbnMgKyAxKTsKICAgIHRoaXMucmVmTGluZSA9IG5ldyBVaW50MzJBcnJheSh0aGlzLmNvbHVtbnMgKyAyKTsKICAgIHRoaXMuY29kaW5nTGluZVswXSA9IHRoaXMuY29sdW1uczsKICAgIHRoaXMuY29kaW5nUG9zID0gMDsKICAgIHRoaXMucm93ID0gMDsKICAgIHRoaXMubmV4dExpbmUyRCA9IHRoaXMuZW5jb2RpbmcgPCAwOwogICAgdGhpcy5pbnB1dEJpdHMgPSAwOwogICAgdGhpcy5pbnB1dEJ1ZiA9IDA7CiAgICB0aGlzLm91dHB1dEJpdHMgPSAwOwogICAgdGhpcy5yb3dzRG9uZSA9IGZhbHNlOwogICAgbGV0IGNvZGUxOwogICAgd2hpbGUgKChjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKSkgPT09IDApIHsKICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgIH0KICAgIGlmIChjb2RlMSA9PT0gMSkgewogICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgIH0KICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICB0aGlzLm5leHRMaW5lMkQgPSAhdGhpcy5fbG9va0JpdHMoMSk7CiAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICB9CiAgfQogIHJlYWROZXh0Q2hhcigpIHsKICAgIGlmICh0aGlzLmVvZikgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBjb25zdCByZWZMaW5lID0gdGhpcy5yZWZMaW5lOwogICAgY29uc3QgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbHVtbnM7CiAgICBsZXQgcmVmUG9zLCBibGFja1BpeGVscywgYml0cywgaTsKICAgIGlmICh0aGlzLm91dHB1dEJpdHMgPT09IDApIHsKICAgICAgaWYgKHRoaXMucm93c0RvbmUpIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHRoaXMuZXJyID0gZmFsc2U7CiAgICAgIGxldCBjb2RlMSwgY29kZTIsIGNvZGUzOwogICAgICBpZiAodGhpcy5uZXh0TGluZTJEKSB7CiAgICAgICAgZm9yIChpID0gMDsgY29kaW5nTGluZVtpXSA8IGNvbHVtbnM7ICsraSkgewogICAgICAgICAgcmVmTGluZVtpXSA9IGNvZGluZ0xpbmVbaV07CiAgICAgICAgfQogICAgICAgIHJlZkxpbmVbaSsrXSA9IGNvbHVtbnM7CiAgICAgICAgcmVmTGluZVtpXSA9IGNvbHVtbnM7CiAgICAgICAgY29kaW5nTGluZVswXSA9IDA7CiAgICAgICAgdGhpcy5jb2RpbmdQb3MgPSAwOwogICAgICAgIHJlZlBvcyA9IDA7CiAgICAgICAgYmxhY2tQaXhlbHMgPSAwOwogICAgICAgIHdoaWxlIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgIGNvZGUxID0gdGhpcy5fZ2V0VHdvRGltQ29kZSgpOwogICAgICAgICAgc3dpdGNoIChjb2RlMSkgewogICAgICAgICAgICBjYXNlIHR3b0RpbVBhc3M6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zICsgMV0sIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBpZiAocmVmTGluZVtyZWZQb3MgKyAxXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1Ib3JpejoKICAgICAgICAgICAgICBjb2RlMSA9IGNvZGUyID0gMDsKICAgICAgICAgICAgICBpZiAoYmxhY2tQaXhlbHMpIHsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRCbGFja0NvZGUoKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgY29kZTIgKz0gY29kZTMgPSB0aGlzLl9nZXRXaGl0ZUNvZGUoKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldFdoaXRlQ29kZSgpOwogICAgICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBjb2RlMiArPSBjb2RlMyA9IHRoaXMuX2dldEJsYWNrQ29kZSgpOwogICAgICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gKyBjb2RlMSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSArIGNvZGUyLCBibGFja1BpeGVscyBeIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0UjM6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSArIDMsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0UjI6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSArIDIsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0UjE6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSArIDEsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0MDoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3NdLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydEwzOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVsc05lZyhyZWZMaW5lW3JlZlBvc10gLSAzLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICBpZiAocmVmUG9zID4gMCkgewogICAgICAgICAgICAgICAgICAtLXJlZlBvczsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0TDI6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzTmVnKHJlZkxpbmVbcmVmUG9zXSAtIDIsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIGlmIChyZWZQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgIC0tcmVmUG9zOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRMMToKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHNOZWcocmVmTGluZVtyZWZQb3NdIC0gMSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgaWYgKHJlZlBvcyA+IDApIHsKICAgICAgICAgICAgICAgICAgLS1yZWZQb3M7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgY2NpdHRFT0Y6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvbHVtbnMsIDApOwogICAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpbmZvKCJiYWQgMmQgY29kZSIpOwogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhjb2x1bW5zLCAwKTsKICAgICAgICAgICAgICB0aGlzLmVyciA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvZGluZ0xpbmVbMF0gPSAwOwogICAgICAgIHRoaXMuY29kaW5nUG9zID0gMDsKICAgICAgICBibGFja1BpeGVscyA9IDA7CiAgICAgICAgd2hpbGUgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgY29kZTEgPSAwOwogICAgICAgICAgaWYgKGJsYWNrUGl4ZWxzKSB7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldEJsYWNrQ29kZSgpOwogICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRXaGl0ZUNvZGUoKTsKICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICsgY29kZTEsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBnb3RFT0wgPSBmYWxzZTsKICAgICAgaWYgKHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgdGhpcy5pbnB1dEJpdHMgJj0gfjc7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVvYmxvY2sgJiYgdGhpcy5yb3cgPT09IHRoaXMucm93cyAtIDEpIHsKICAgICAgICB0aGlzLnJvd3NEb25lID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICBpZiAodGhpcy5lb2xpbmUpIHsKICAgICAgICAgIHdoaWxlIChjb2RlMSAhPT0gY2NpdHRFT0YgJiYgY29kZTEgIT09IDEpIHsKICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdoaWxlIChjb2RlMSA9PT0gMCkgewogICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNvZGUxID09PSAxKSB7CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgIGdvdEVPTCA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChjb2RlMSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVvZiAmJiB0aGlzLmVuY29kaW5nID4gMCAmJiAhdGhpcy5yb3dzRG9uZSkgewogICAgICAgIHRoaXMubmV4dExpbmUyRCA9ICF0aGlzLl9sb29rQml0cygxKTsKICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmVvYmxvY2sgJiYgZ290RU9MICYmIHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgaWYgKGNvZGUxID09PSAxKSB7CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICAgICAgICB0aGlzLl9sb29rQml0cygxKTsKICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID49IDApIHsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDQ7ICsraSkgewogICAgICAgICAgICAgIGNvZGUxID0gdGhpcy5fbG9va0JpdHMoMTIpOwogICAgICAgICAgICAgIGlmIChjb2RlMSAhPT0gMSkgewogICAgICAgICAgICAgICAgaW5mbygiYmFkIHJ0YyBjb2RlOiAiICsgY29kZTEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgICAgICBpZiAodGhpcy5lbmNvZGluZyA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2xvb2tCaXRzKDEpOwogICAgICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5lcnIgJiYgdGhpcy5lb2xpbmUpIHsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMyk7CiAgICAgICAgICBpZiAoY29kZTEgPT09IGNjaXR0RU9GKSB7CiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvZGUxID4+IDEgPT09IDEpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICBpZiAodGhpcy5lbmNvZGluZyA+IDApIHsKICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgICB0aGlzLm5leHRMaW5lMkQgPSAhKGNvZGUxICYgMSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3V0cHV0Qml0cyA9IGNvZGluZ0xpbmVbMF0gPiAwID8gY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyA9IDBdIDogY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyA9IDFdOwogICAgICB0aGlzLnJvdysrOwogICAgfQogICAgbGV0IGM7CiAgICBpZiAodGhpcy5vdXRwdXRCaXRzID49IDgpIHsKICAgICAgYyA9IHRoaXMuY29kaW5nUG9zICYgMSA/IDAgOiAweGZmOwogICAgICB0aGlzLm91dHB1dEJpdHMgLT0gODsKICAgICAgaWYgKHRoaXMub3V0cHV0Qml0cyA9PT0gMCAmJiBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICB0aGlzLmNvZGluZ1BvcysrOwogICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIC0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyAtIDFdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBiaXRzID0gODsKICAgICAgYyA9IDA7CiAgICAgIGRvIHsKICAgICAgICBpZiAodHlwZW9mIHRoaXMub3V0cHV0Qml0cyAhPT0gIm51bWJlciIpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignSW52YWxpZCAvQ0NJVFRGYXhEZWNvZGUgZGF0YSwgIm91dHB1dEJpdHMiIG11c3QgYmUgYSBudW1iZXIuJyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLm91dHB1dEJpdHMgPiBiaXRzKSB7CiAgICAgICAgICBjIDw8PSBiaXRzOwogICAgICAgICAgaWYgKCEodGhpcy5jb2RpbmdQb3MgJiAxKSkgewogICAgICAgICAgICBjIHw9IDB4ZmYgPj4gOCAtIGJpdHM7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgLT0gYml0czsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjIDw8PSB0aGlzLm91dHB1dEJpdHM7CiAgICAgICAgICBpZiAoISh0aGlzLmNvZGluZ1BvcyAmIDEpKSB7CiAgICAgICAgICAgIGMgfD0gMHhmZiA+PiA4IC0gdGhpcy5vdXRwdXRCaXRzOwogICAgICAgICAgfQogICAgICAgICAgYml0cyAtPSB0aGlzLm91dHB1dEJpdHM7CiAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgPSAwOwogICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICB0aGlzLmNvZGluZ1BvcysrOwogICAgICAgICAgICB0aGlzLm91dHB1dEJpdHMgPSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAtIGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3MgLSAxXTsKICAgICAgICAgIH0gZWxzZSBpZiAoYml0cyA+IDApIHsKICAgICAgICAgICAgYyA8PD0gYml0czsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlIChiaXRzKTsKICAgIH0KICAgIGlmICh0aGlzLmJsYWNrKSB7CiAgICAgIGMgXj0gMHhmZjsKICAgIH0KICAgIHJldHVybiBjOwogIH0KICBfYWRkUGl4ZWxzKGExLCBibGFja1BpeGVscykgewogICAgY29uc3QgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgIGxldCBjb2RpbmdQb3MgPSB0aGlzLmNvZGluZ1BvczsKICAgIGlmIChhMSA+IGNvZGluZ0xpbmVbY29kaW5nUG9zXSkgewogICAgICBpZiAoYTEgPiB0aGlzLmNvbHVtbnMpIHsKICAgICAgICBpbmZvKCJyb3cgaXMgd3JvbmcgbGVuZ3RoIik7CiAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgIGExID0gdGhpcy5jb2x1bW5zOwogICAgICB9CiAgICAgIGlmIChjb2RpbmdQb3MgJiAxIF4gYmxhY2tQaXhlbHMpIHsKICAgICAgICArK2NvZGluZ1BvczsKICAgICAgfQogICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgIH0KICAgIHRoaXMuY29kaW5nUG9zID0gY29kaW5nUG9zOwogIH0KICBfYWRkUGl4ZWxzTmVnKGExLCBibGFja1BpeGVscykgewogICAgY29uc3QgY29kaW5nTGluZSA9IHRoaXMuY29kaW5nTGluZTsKICAgIGxldCBjb2RpbmdQb3MgPSB0aGlzLmNvZGluZ1BvczsKICAgIGlmIChhMSA+IGNvZGluZ0xpbmVbY29kaW5nUG9zXSkgewogICAgICBpZiAoYTEgPiB0aGlzLmNvbHVtbnMpIHsKICAgICAgICBpbmZvKCJyb3cgaXMgd3JvbmcgbGVuZ3RoIik7CiAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgIGExID0gdGhpcy5jb2x1bW5zOwogICAgICB9CiAgICAgIGlmIChjb2RpbmdQb3MgJiAxIF4gYmxhY2tQaXhlbHMpIHsKICAgICAgICArK2NvZGluZ1BvczsKICAgICAgfQogICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgIH0gZWxzZSBpZiAoYTEgPCBjb2RpbmdMaW5lW2NvZGluZ1Bvc10pIHsKICAgICAgaWYgKGExIDwgMCkgewogICAgICAgIGluZm8oImludmFsaWQgY29kZSIpOwogICAgICAgIHRoaXMuZXJyID0gdHJ1ZTsKICAgICAgICBhMSA9IDA7CiAgICAgIH0KICAgICAgd2hpbGUgKGNvZGluZ1BvcyA+IDAgJiYgYTEgPCBjb2RpbmdMaW5lW2NvZGluZ1BvcyAtIDFdKSB7CiAgICAgICAgLS1jb2RpbmdQb3M7CiAgICAgIH0KICAgICAgY29kaW5nTGluZVtjb2RpbmdQb3NdID0gYTE7CiAgICB9CiAgICB0aGlzLmNvZGluZ1BvcyA9IGNvZGluZ1BvczsKICB9CiAgX2ZpbmRUYWJsZUNvZGUoc3RhcnQsIGVuZCwgdGFibGUsIGxpbWl0KSB7CiAgICBjb25zdCBsaW1pdFZhbHVlID0gbGltaXQgfHwgMDsKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQ7ICsraSkgewogICAgICBsZXQgY29kZSA9IHRoaXMuX2xvb2tCaXRzKGkpOwogICAgICBpZiAoY29kZSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICByZXR1cm4gW3RydWUsIDEsIGZhbHNlXTsKICAgICAgfQogICAgICBpZiAoaSA8IGVuZCkgewogICAgICAgIGNvZGUgPDw9IGVuZCAtIGk7CiAgICAgIH0KICAgICAgaWYgKCFsaW1pdFZhbHVlIHx8IGNvZGUgPj0gbGltaXRWYWx1ZSkgewogICAgICAgIGNvbnN0IHAgPSB0YWJsZVtjb2RlIC0gbGltaXRWYWx1ZV07CiAgICAgICAgaWYgKHBbMF0gPT09IGkpIHsKICAgICAgICAgIHRoaXMuX2VhdEJpdHMoaSk7CiAgICAgICAgICByZXR1cm4gW3RydWUsIHBbMV0sIHRydWVdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIFtmYWxzZSwgMCwgZmFsc2VdOwogIH0KICBfZ2V0VHdvRGltQ29kZSgpIHsKICAgIGxldCBjb2RlID0gMDsKICAgIGxldCBwOwogICAgaWYgKHRoaXMuZW9ibG9jaykgewogICAgICBjb2RlID0gdGhpcy5fbG9va0JpdHMoNyk7CiAgICAgIHAgPSB0d29EaW1UYWJsZVtjb2RlXTsKICAgICAgaWYgKHA/LlswXSA+IDApIHsKICAgICAgICB0aGlzLl9lYXRCaXRzKHBbMF0pOwogICAgICAgIHJldHVybiBwWzFdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEsIDcsIHR3b0RpbVRhYmxlKTsKICAgICAgaWYgKHJlc3VsdFswXSAmJiByZXN1bHRbMl0pIHsKICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICB9CiAgICB9CiAgICBpbmZvKCJCYWQgdHdvIGRpbSBjb2RlIik7CiAgICByZXR1cm4gY2NpdHRFT0Y7CiAgfQogIF9nZXRXaGl0ZUNvZGUoKSB7CiAgICBsZXQgY29kZSA9IDA7CiAgICBsZXQgcDsKICAgIGlmICh0aGlzLmVvYmxvY2spIHsKICAgICAgY29kZSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgaWYgKGNvZGUgPT09IGNjaXR0RU9GKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KICAgICAgcCA9IGNvZGUgPj4gNSA9PT0gMCA/IHdoaXRlVGFibGUxW2NvZGVdIDogd2hpdGVUYWJsZTJbY29kZSA+PiAzXTsKICAgICAgaWYgKHBbMF0gPiAwKSB7CiAgICAgICAgdGhpcy5fZWF0Qml0cyhwWzBdKTsKICAgICAgICByZXR1cm4gcFsxXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMSwgOSwgd2hpdGVUYWJsZTIpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDExLCAxMiwgd2hpdGVUYWJsZTEpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgfQogICAgaW5mbygiYmFkIHdoaXRlIGNvZGUiKTsKICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICByZXR1cm4gMTsKICB9CiAgX2dldEJsYWNrQ29kZSgpIHsKICAgIGxldCBjb2RlLCBwOwogICAgaWYgKHRoaXMuZW9ibG9jaykgewogICAgICBjb2RlID0gdGhpcy5fbG9va0JpdHMoMTMpOwogICAgICBpZiAoY29kZSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgICBpZiAoY29kZSA+PiA3ID09PSAwKSB7CiAgICAgICAgcCA9IGJsYWNrVGFibGUxW2NvZGVdOwogICAgICB9IGVsc2UgaWYgKGNvZGUgPj4gOSA9PT0gMCAmJiBjb2RlID4+IDcgIT09IDApIHsKICAgICAgICBwID0gYmxhY2tUYWJsZTJbKGNvZGUgPj4gMSkgLSA2NF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcCA9IGJsYWNrVGFibGUzW2NvZGUgPj4gN107CiAgICAgIH0KICAgICAgaWYgKHBbMF0gPiAwKSB7CiAgICAgICAgdGhpcy5fZWF0Qml0cyhwWzBdKTsKICAgICAgICByZXR1cm4gcFsxXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMiwgNiwgYmxhY2tUYWJsZTMpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDcsIDEyLCBibGFja1RhYmxlMiwgNjQpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEwLCAxMywgYmxhY2tUYWJsZTEpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgfQogICAgaW5mbygiYmFkIGJsYWNrIGNvZGUiKTsKICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICByZXR1cm4gMTsKICB9CiAgX2xvb2tCaXRzKG4pIHsKICAgIGxldCBjOwogICAgd2hpbGUgKHRoaXMuaW5wdXRCaXRzIDwgbikgewogICAgICBpZiAoKGMgPSB0aGlzLnNvdXJjZS5uZXh0KCkpID09PSAtMSkgewogICAgICAgIGlmICh0aGlzLmlucHV0Qml0cyA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIGNjaXR0RU9GOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5pbnB1dEJ1ZiA8PCBuIC0gdGhpcy5pbnB1dEJpdHMgJiAweGZmZmYgPj4gMTYgLSBuOwogICAgICB9CiAgICAgIHRoaXMuaW5wdXRCdWYgPSB0aGlzLmlucHV0QnVmIDw8IDggfCBjOwogICAgICB0aGlzLmlucHV0Qml0cyArPSA4OwogICAgfQogICAgcmV0dXJuIHRoaXMuaW5wdXRCdWYgPj4gdGhpcy5pbnB1dEJpdHMgLSBuICYgMHhmZmZmID4+IDE2IC0gbjsKICB9CiAgX2VhdEJpdHMobikgewogICAgaWYgKCh0aGlzLmlucHV0Qml0cyAtPSBuKSA8IDApIHsKICAgICAgdGhpcy5pbnB1dEJpdHMgPSAwOwogICAgfQogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2NpdHRfc3RyZWFtLmpzCgoKCmNsYXNzIENDSVRURmF4U3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICBpZiAoIShwYXJhbXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICBwYXJhbXMgPSBEaWN0LmVtcHR5OwogICAgfQogICAgY29uc3Qgc291cmNlID0gewogICAgICBuZXh0KCkgewogICAgICAgIHJldHVybiBzdHIuZ2V0Qnl0ZSgpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5jY2l0dEZheERlY29kZXIgPSBuZXcgQ0NJVFRGYXhEZWNvZGVyKHNvdXJjZSwgewogICAgICBLOiBwYXJhbXMuZ2V0KCJLIiksCiAgICAgIEVuZE9mTGluZTogcGFyYW1zLmdldCgiRW5kT2ZMaW5lIiksCiAgICAgIEVuY29kZWRCeXRlQWxpZ246IHBhcmFtcy5nZXQoIkVuY29kZWRCeXRlQWxpZ24iKSwKICAgICAgQ29sdW1uczogcGFyYW1zLmdldCgiQ29sdW1ucyIpLAogICAgICBSb3dzOiBwYXJhbXMuZ2V0KCJSb3dzIiksCiAgICAgIEVuZE9mQmxvY2s6IHBhcmFtcy5nZXQoIkVuZE9mQmxvY2siKSwKICAgICAgQmxhY2tJczE6IHBhcmFtcy5nZXQoIkJsYWNrSXMxIikKICAgIH0pOwogIH0KICByZWFkQmxvY2soKSB7CiAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgIGNvbnN0IGMgPSB0aGlzLmNjaXR0RmF4RGVjb2Rlci5yZWFkTmV4dENoYXIoKTsKICAgICAgaWYgKGMgPT09IC0xKSB7CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIDEpOwogICAgICB0aGlzLmJ1ZmZlclt0aGlzLmJ1ZmZlckxlbmd0aCsrXSA9IGM7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9mbGF0ZV9zdHJlYW0uanMKCgoKY29uc3QgY29kZUxlbkNvZGVNYXAgPSBuZXcgSW50MzJBcnJheShbMTYsIDE3LCAxOCwgMCwgOCwgNywgOSwgNiwgMTAsIDUsIDExLCA0LCAxMiwgMywgMTMsIDIsIDE0LCAxLCAxNV0pOwpjb25zdCBsZW5ndGhEZWNvZGUgPSBuZXcgSW50MzJBcnJheShbMHgwMDAwMywgMHgwMDAwNCwgMHgwMDAwNSwgMHgwMDAwNiwgMHgwMDAwNywgMHgwMDAwOCwgMHgwMDAwOSwgMHgwMDAwYSwgMHgxMDAwYiwgMHgxMDAwZCwgMHgxMDAwZiwgMHgxMDAxMSwgMHgyMDAxMywgMHgyMDAxNywgMHgyMDAxYiwgMHgyMDAxZiwgMHgzMDAyMywgMHgzMDAyYiwgMHgzMDAzMywgMHgzMDAzYiwgMHg0MDA0MywgMHg0MDA1MywgMHg0MDA2MywgMHg0MDA3MywgMHg1MDA4MywgMHg1MDBhMywgMHg1MDBjMywgMHg1MDBlMywgMHgwMDEwMiwgMHgwMDEwMiwgMHgwMDEwMl0pOwpjb25zdCBkaXN0RGVjb2RlID0gbmV3IEludDMyQXJyYXkoWzB4MDAwMDEsIDB4MDAwMDIsIDB4MDAwMDMsIDB4MDAwMDQsIDB4MTAwMDUsIDB4MTAwMDcsIDB4MjAwMDksIDB4MjAwMGQsIDB4MzAwMTEsIDB4MzAwMTksIDB4NDAwMjEsIDB4NDAwMzEsIDB4NTAwNDEsIDB4NTAwNjEsIDB4NjAwODEsIDB4NjAwYzEsIDB4NzAxMDEsIDB4NzAxODEsIDB4ODAyMDEsIDB4ODAzMDEsIDB4OTA0MDEsIDB4OTA2MDEsIDB4YTA4MDEsIDB4YTBjMDEsIDB4YjEwMDEsIDB4YjE4MDEsIDB4YzIwMDEsIDB4YzMwMDEsIDB4ZDQwMDEsIDB4ZDYwMDFdKTsKY29uc3QgZml4ZWRMaXRDb2RlVGFiID0gW25ldyBJbnQzMkFycmF5KFsweDcwMTAwLCAweDgwMDUwLCAweDgwMDEwLCAweDgwMTE4LCAweDcwMTEwLCAweDgwMDcwLCAweDgwMDMwLCAweDkwMGMwLCAweDcwMTA4LCAweDgwMDYwLCAweDgwMDIwLCAweDkwMGEwLCAweDgwMDAwLCAweDgwMDgwLCAweDgwMDQwLCAweDkwMGUwLCAweDcwMTA0LCAweDgwMDU4LCAweDgwMDE4LCAweDkwMDkwLCAweDcwMTE0LCAweDgwMDc4LCAweDgwMDM4LCAweDkwMGQwLCAweDcwMTBjLCAweDgwMDY4LCAweDgwMDI4LCAweDkwMGIwLCAweDgwMDA4LCAweDgwMDg4LCAweDgwMDQ4LCAweDkwMGYwLCAweDcwMTAyLCAweDgwMDU0LCAweDgwMDE0LCAweDgwMTFjLCAweDcwMTEyLCAweDgwMDc0LCAweDgwMDM0LCAweDkwMGM4LCAweDcwMTBhLCAweDgwMDY0LCAweDgwMDI0LCAweDkwMGE4LCAweDgwMDA0LCAweDgwMDg0LCAweDgwMDQ0LCAweDkwMGU4LCAweDcwMTA2LCAweDgwMDVjLCAweDgwMDFjLCAweDkwMDk4LCAweDcwMTE2LCAweDgwMDdjLCAweDgwMDNjLCAweDkwMGQ4LCAweDcwMTBlLCAweDgwMDZjLCAweDgwMDJjLCAweDkwMGI4LCAweDgwMDBjLCAweDgwMDhjLCAweDgwMDRjLCAweDkwMGY4LCAweDcwMTAxLCAweDgwMDUyLCAweDgwMDEyLCAweDgwMTFhLCAweDcwMTExLCAweDgwMDcyLCAweDgwMDMyLCAweDkwMGM0LCAweDcwMTA5LCAweDgwMDYyLCAweDgwMDIyLCAweDkwMGE0LCAweDgwMDAyLCAweDgwMDgyLCAweDgwMDQyLCAweDkwMGU0LCAweDcwMTA1LCAweDgwMDVhLCAweDgwMDFhLCAweDkwMDk0LCAweDcwMTE1LCAweDgwMDdhLCAweDgwMDNhLCAweDkwMGQ0LCAweDcwMTBkLCAweDgwMDZhLCAweDgwMDJhLCAweDkwMGI0LCAweDgwMDBhLCAweDgwMDhhLCAweDgwMDRhLCAweDkwMGY0LCAweDcwMTAzLCAweDgwMDU2LCAweDgwMDE2LCAweDgwMTFlLCAweDcwMTEzLCAweDgwMDc2LCAweDgwMDM2LCAweDkwMGNjLCAweDcwMTBiLCAweDgwMDY2LCAweDgwMDI2LCAweDkwMGFjLCAweDgwMDA2LCAweDgwMDg2LCAweDgwMDQ2LCAweDkwMGVjLCAweDcwMTA3LCAweDgwMDVlLCAweDgwMDFlLCAweDkwMDljLCAweDcwMTE3LCAweDgwMDdlLCAweDgwMDNlLCAweDkwMGRjLCAweDcwMTBmLCAweDgwMDZlLCAweDgwMDJlLCAweDkwMGJjLCAweDgwMDBlLCAweDgwMDhlLCAweDgwMDRlLCAweDkwMGZjLCAweDcwMTAwLCAweDgwMDUxLCAweDgwMDExLCAweDgwMTE5LCAweDcwMTEwLCAweDgwMDcxLCAweDgwMDMxLCAweDkwMGMyLCAweDcwMTA4LCAweDgwMDYxLCAweDgwMDIxLCAweDkwMGEyLCAweDgwMDAxLCAweDgwMDgxLCAweDgwMDQxLCAweDkwMGUyLCAweDcwMTA0LCAweDgwMDU5LCAweDgwMDE5LCAweDkwMDkyLCAweDcwMTE0LCAweDgwMDc5LCAweDgwMDM5LCAweDkwMGQyLCAweDcwMTBjLCAweDgwMDY5LCAweDgwMDI5LCAweDkwMGIyLCAweDgwMDA5LCAweDgwMDg5LCAweDgwMDQ5LCAweDkwMGYyLCAweDcwMTAyLCAweDgwMDU1LCAweDgwMDE1LCAweDgwMTFkLCAweDcwMTEyLCAweDgwMDc1LCAweDgwMDM1LCAweDkwMGNhLCAweDcwMTBhLCAweDgwMDY1LCAweDgwMDI1LCAweDkwMGFhLCAweDgwMDA1LCAweDgwMDg1LCAweDgwMDQ1LCAweDkwMGVhLCAweDcwMTA2LCAweDgwMDVkLCAweDgwMDFkLCAweDkwMDlhLCAweDcwMTE2LCAweDgwMDdkLCAweDgwMDNkLCAweDkwMGRhLCAweDcwMTBlLCAweDgwMDZkLCAweDgwMDJkLCAweDkwMGJhLCAweDgwMDBkLCAweDgwMDhkLCAweDgwMDRkLCAweDkwMGZhLCAweDcwMTAxLCAweDgwMDUzLCAweDgwMDEzLCAweDgwMTFiLCAweDcwMTExLCAweDgwMDczLCAweDgwMDMzLCAweDkwMGM2LCAweDcwMTA5LCAweDgwMDYzLCAweDgwMDIzLCAweDkwMGE2LCAweDgwMDAzLCAweDgwMDgzLCAweDgwMDQzLCAweDkwMGU2LCAweDcwMTA1LCAweDgwMDViLCAweDgwMDFiLCAweDkwMDk2LCAweDcwMTE1LCAweDgwMDdiLCAweDgwMDNiLCAweDkwMGQ2LCAweDcwMTBkLCAweDgwMDZiLCAweDgwMDJiLCAweDkwMGI2LCAweDgwMDBiLCAweDgwMDhiLCAweDgwMDRiLCAweDkwMGY2LCAweDcwMTAzLCAweDgwMDU3LCAweDgwMDE3LCAweDgwMTFmLCAweDcwMTEzLCAweDgwMDc3LCAweDgwMDM3LCAweDkwMGNlLCAweDcwMTBiLCAweDgwMDY3LCAweDgwMDI3LCAweDkwMGFlLCAweDgwMDA3LCAweDgwMDg3LCAweDgwMDQ3LCAweDkwMGVlLCAweDcwMTA3LCAweDgwMDVmLCAweDgwMDFmLCAweDkwMDllLCAweDcwMTE3LCAweDgwMDdmLCAweDgwMDNmLCAweDkwMGRlLCAweDcwMTBmLCAweDgwMDZmLCAweDgwMDJmLCAweDkwMGJlLCAweDgwMDBmLCAweDgwMDhmLCAweDgwMDRmLCAweDkwMGZlLCAweDcwMTAwLCAweDgwMDUwLCAweDgwMDEwLCAweDgwMTE4LCAweDcwMTEwLCAweDgwMDcwLCAweDgwMDMwLCAweDkwMGMxLCAweDcwMTA4LCAweDgwMDYwLCAweDgwMDIwLCAweDkwMGExLCAweDgwMDAwLCAweDgwMDgwLCAweDgwMDQwLCAweDkwMGUxLCAweDcwMTA0LCAweDgwMDU4LCAweDgwMDE4LCAweDkwMDkxLCAweDcwMTE0LCAweDgwMDc4LCAweDgwMDM4LCAweDkwMGQxLCAweDcwMTBjLCAweDgwMDY4LCAweDgwMDI4LCAweDkwMGIxLCAweDgwMDA4LCAweDgwMDg4LCAweDgwMDQ4LCAweDkwMGYxLCAweDcwMTAyLCAweDgwMDU0LCAweDgwMDE0LCAweDgwMTFjLCAweDcwMTEyLCAweDgwMDc0LCAweDgwMDM0LCAweDkwMGM5LCAweDcwMTBhLCAweDgwMDY0LCAweDgwMDI0LCAweDkwMGE5LCAweDgwMDA0LCAweDgwMDg0LCAweDgwMDQ0LCAweDkwMGU5LCAweDcwMTA2LCAweDgwMDVjLCAweDgwMDFjLCAweDkwMDk5LCAweDcwMTE2LCAweDgwMDdjLCAweDgwMDNjLCAweDkwMGQ5LCAweDcwMTBlLCAweDgwMDZjLCAweDgwMDJjLCAweDkwMGI5LCAweDgwMDBjLCAweDgwMDhjLCAweDgwMDRjLCAweDkwMGY5LCAweDcwMTAxLCAweDgwMDUyLCAweDgwMDEyLCAweDgwMTFhLCAweDcwMTExLCAweDgwMDcyLCAweDgwMDMyLCAweDkwMGM1LCAweDcwMTA5LCAweDgwMDYyLCAweDgwMDIyLCAweDkwMGE1LCAweDgwMDAyLCAweDgwMDgyLCAweDgwMDQyLCAweDkwMGU1LCAweDcwMTA1LCAweDgwMDVhLCAweDgwMDFhLCAweDkwMDk1LCAweDcwMTE1LCAweDgwMDdhLCAweDgwMDNhLCAweDkwMGQ1LCAweDcwMTBkLCAweDgwMDZhLCAweDgwMDJhLCAweDkwMGI1LCAweDgwMDBhLCAweDgwMDhhLCAweDgwMDRhLCAweDkwMGY1LCAweDcwMTAzLCAweDgwMDU2LCAweDgwMDE2LCAweDgwMTFlLCAweDcwMTEzLCAweDgwMDc2LCAweDgwMDM2LCAweDkwMGNkLCAweDcwMTBiLCAweDgwMDY2LCAweDgwMDI2LCAweDkwMGFkLCAweDgwMDA2LCAweDgwMDg2LCAweDgwMDQ2LCAweDkwMGVkLCAweDcwMTA3LCAweDgwMDVlLCAweDgwMDFlLCAweDkwMDlkLCAweDcwMTE3LCAweDgwMDdlLCAweDgwMDNlLCAweDkwMGRkLCAweDcwMTBmLCAweDgwMDZlLCAweDgwMDJlLCAweDkwMGJkLCAweDgwMDBlLCAweDgwMDhlLCAweDgwMDRlLCAweDkwMGZkLCAweDcwMTAwLCAweDgwMDUxLCAweDgwMDExLCAweDgwMTE5LCAweDcwMTEwLCAweDgwMDcxLCAweDgwMDMxLCAweDkwMGMzLCAweDcwMTA4LCAweDgwMDYxLCAweDgwMDIxLCAweDkwMGEzLCAweDgwMDAxLCAweDgwMDgxLCAweDgwMDQxLCAweDkwMGUzLCAweDcwMTA0LCAweDgwMDU5LCAweDgwMDE5LCAweDkwMDkzLCAweDcwMTE0LCAweDgwMDc5LCAweDgwMDM5LCAweDkwMGQzLCAweDcwMTBjLCAweDgwMDY5LCAweDgwMDI5LCAweDkwMGIzLCAweDgwMDA5LCAweDgwMDg5LCAweDgwMDQ5LCAweDkwMGYzLCAweDcwMTAyLCAweDgwMDU1LCAweDgwMDE1LCAweDgwMTFkLCAweDcwMTEyLCAweDgwMDc1LCAweDgwMDM1LCAweDkwMGNiLCAweDcwMTBhLCAweDgwMDY1LCAweDgwMDI1LCAweDkwMGFiLCAweDgwMDA1LCAweDgwMDg1LCAweDgwMDQ1LCAweDkwMGViLCAweDcwMTA2LCAweDgwMDVkLCAweDgwMDFkLCAweDkwMDliLCAweDcwMTE2LCAweDgwMDdkLCAweDgwMDNkLCAweDkwMGRiLCAweDcwMTBlLCAweDgwMDZkLCAweDgwMDJkLCAweDkwMGJiLCAweDgwMDBkLCAweDgwMDhkLCAweDgwMDRkLCAweDkwMGZiLCAweDcwMTAxLCAweDgwMDUzLCAweDgwMDEzLCAweDgwMTFiLCAweDcwMTExLCAweDgwMDczLCAweDgwMDMzLCAweDkwMGM3LCAweDcwMTA5LCAweDgwMDYzLCAweDgwMDIzLCAweDkwMGE3LCAweDgwMDAzLCAweDgwMDgzLCAweDgwMDQzLCAweDkwMGU3LCAweDcwMTA1LCAweDgwMDViLCAweDgwMDFiLCAweDkwMDk3LCAweDcwMTE1LCAweDgwMDdiLCAweDgwMDNiLCAweDkwMGQ3LCAweDcwMTBkLCAweDgwMDZiLCAweDgwMDJiLCAweDkwMGI3LCAweDgwMDBiLCAweDgwMDhiLCAweDgwMDRiLCAweDkwMGY3LCAweDcwMTAzLCAweDgwMDU3LCAweDgwMDE3LCAweDgwMTFmLCAweDcwMTEzLCAweDgwMDc3LCAweDgwMDM3LCAweDkwMGNmLCAweDcwMTBiLCAweDgwMDY3LCAweDgwMDI3LCAweDkwMGFmLCAweDgwMDA3LCAweDgwMDg3LCAweDgwMDQ3LCAweDkwMGVmLCAweDcwMTA3LCAweDgwMDVmLCAweDgwMDFmLCAweDkwMDlmLCAweDcwMTE3LCAweDgwMDdmLCAweDgwMDNmLCAweDkwMGRmLCAweDcwMTBmLCAweDgwMDZmLCAweDgwMDJmLCAweDkwMGJmLCAweDgwMDBmLCAweDgwMDhmLCAweDgwMDRmLCAweDkwMGZmXSksIDldOwpjb25zdCBmaXhlZERpc3RDb2RlVGFiID0gW25ldyBJbnQzMkFycmF5KFsweDUwMDAwLCAweDUwMDEwLCAweDUwMDA4LCAweDUwMDE4LCAweDUwMDA0LCAweDUwMDE0LCAweDUwMDBjLCAweDUwMDFjLCAweDUwMDAyLCAweDUwMDEyLCAweDUwMDBhLCAweDUwMDFhLCAweDUwMDA2LCAweDUwMDE2LCAweDUwMDBlLCAweDAwMDAwLCAweDUwMDAxLCAweDUwMDExLCAweDUwMDA5LCAweDUwMDE5LCAweDUwMDA1LCAweDUwMDE1LCAweDUwMDBkLCAweDUwMDFkLCAweDUwMDAzLCAweDUwMDEzLCAweDUwMDBiLCAweDUwMDFiLCAweDUwMDA3LCAweDUwMDE3LCAweDUwMDBmLCAweDAwMDAwXSksIDVdOwpjbGFzcyBGbGF0ZVN0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCkgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIGNvbnN0IGNtZiA9IHN0ci5nZXRCeXRlKCk7CiAgICBjb25zdCBmbGcgPSBzdHIuZ2V0Qnl0ZSgpOwogICAgaWYgKGNtZiA9PT0gLTEgfHwgZmxnID09PSAtMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgaGVhZGVyIGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIGlmICgoY21mICYgMHgwZikgIT09IDB4MDgpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCBpbiBmbGF0ZSBzdHJlYW06ICR7Y21mfSwgJHtmbGd9YCk7CiAgICB9CiAgICBpZiAoKChjbWYgPDwgOCkgKyBmbGcpICUgMzEgIT09IDApIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBCYWQgRkNIRUNLIGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIGlmIChmbGcgJiAweDIwKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgRkRJQ1QgYml0IHNldCBpbiBmbGF0ZSBzdHJlYW06ICR7Y21mfSwgJHtmbGd9YCk7CiAgICB9CiAgICB0aGlzLmNvZGVTaXplID0gMDsKICAgIHRoaXMuY29kZUJ1ZiA9IDA7CiAgfQogIGFzeW5jIGdldEltYWdlRGF0YShsZW5ndGgsIF9kZWNvZGVyT3B0aW9ucykgewogICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuYXN5bmNHZXRCeXRlcygpOwogICAgaWYgKCFkYXRhKSB7CiAgICAgIHJldHVybiB0aGlzLmdldEJ5dGVzKGxlbmd0aCk7CiAgICB9CiAgICBpZiAoZGF0YS5sZW5ndGggPD0gbGVuZ3RoKSB7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgcmV0dXJuIGRhdGEuc3ViYXJyYXkoMCwgbGVuZ3RoKTsKICB9CiAgYXN5bmMgYXN5bmNHZXRCeXRlcygpIHsKICAgIHRoaXMuc3RyLnJlc2V0KCk7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuc3RyLmdldEJ5dGVzKCk7CiAgICB0cnkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVhZGFibGUsCiAgICAgICAgd3JpdGFibGUKICAgICAgfSA9IG5ldyBEZWNvbXByZXNzaW9uU3RyZWFtKCJkZWZsYXRlIik7CiAgICAgIGNvbnN0IHdyaXRlciA9IHdyaXRhYmxlLmdldFdyaXRlcigpOwogICAgICBhd2FpdCB3cml0ZXIucmVhZHk7CiAgICAgIHdyaXRlci53cml0ZShieXRlcykudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgYXdhaXQgd3JpdGVyLnJlYWR5OwogICAgICAgIGF3YWl0IHdyaXRlci5jbG9zZSgpOwogICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgICBsZXQgdG90YWxMZW5ndGggPSAwOwogICAgICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHJlYWRhYmxlKSB7CiAgICAgICAgY2h1bmtzLnB1c2goY2h1bmspOwogICAgICAgIHRvdGFsTGVuZ3RoICs9IGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgIH0KICAgICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KHRvdGFsTGVuZ3RoKTsKICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7CiAgICAgICAgZGF0YS5zZXQoY2h1bmssIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0ICs9IGNodW5rLmJ5dGVMZW5ndGg7CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGE7CiAgICB9IGNhdGNoIHsKICAgICAgdGhpcy5zdHIgPSBuZXcgU3RyZWFtKGJ5dGVzLCAyLCBieXRlcy5sZW5ndGgsIHRoaXMuc3RyLmRpY3QpOwogICAgICB0aGlzLnJlc2V0KCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICBnZXQgaXNBc3luYygpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBnZXRCaXRzKGJpdHMpIHsKICAgIGNvbnN0IHN0ciA9IHRoaXMuc3RyOwogICAgbGV0IGNvZGVTaXplID0gdGhpcy5jb2RlU2l6ZTsKICAgIGxldCBjb2RlQnVmID0gdGhpcy5jb2RlQnVmOwogICAgbGV0IGI7CiAgICB3aGlsZSAoY29kZVNpemUgPCBiaXRzKSB7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQmFkIGVuY29kaW5nIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICB9CiAgICAgIGNvZGVCdWYgfD0gYiA8PCBjb2RlU2l6ZTsKICAgICAgY29kZVNpemUgKz0gODsKICAgIH0KICAgIGIgPSBjb2RlQnVmICYgKDEgPDwgYml0cykgLSAxOwogICAgdGhpcy5jb2RlQnVmID0gY29kZUJ1ZiA+PiBiaXRzOwogICAgdGhpcy5jb2RlU2l6ZSA9IGNvZGVTaXplIC09IGJpdHM7CiAgICByZXR1cm4gYjsKICB9CiAgZ2V0Q29kZSh0YWJsZSkgewogICAgY29uc3Qgc3RyID0gdGhpcy5zdHI7CiAgICBjb25zdCBjb2RlcyA9IHRhYmxlWzBdOwogICAgY29uc3QgbWF4TGVuID0gdGFibGVbMV07CiAgICBsZXQgY29kZVNpemUgPSB0aGlzLmNvZGVTaXplOwogICAgbGV0IGNvZGVCdWYgPSB0aGlzLmNvZGVCdWY7CiAgICBsZXQgYjsKICAgIHdoaWxlIChjb2RlU2l6ZSA8IG1heExlbikgewogICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb2RlQnVmIHw9IGIgPDwgY29kZVNpemU7CiAgICAgIGNvZGVTaXplICs9IDg7CiAgICB9CiAgICBjb25zdCBjb2RlID0gY29kZXNbY29kZUJ1ZiAmICgxIDw8IG1heExlbikgLSAxXTsKICAgIGNvbnN0IGNvZGVMZW4gPSBjb2RlID4+IDE2OwogICAgY29uc3QgY29kZVZhbCA9IGNvZGUgJiAweGZmZmY7CiAgICBpZiAoY29kZUxlbiA8IDEgfHwgY29kZVNpemUgPCBjb2RlTGVuKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQmFkIGVuY29kaW5nIGluIGZsYXRlIHN0cmVhbSIpOwogICAgfQogICAgdGhpcy5jb2RlQnVmID0gY29kZUJ1ZiA+PiBjb2RlTGVuOwogICAgdGhpcy5jb2RlU2l6ZSA9IGNvZGVTaXplIC0gY29kZUxlbjsKICAgIHJldHVybiBjb2RlVmFsOwogIH0KICBnZW5lcmF0ZUh1ZmZtYW5UYWJsZShsZW5ndGhzKSB7CiAgICBjb25zdCBuID0gbGVuZ3Rocy5sZW5ndGg7CiAgICBsZXQgbWF4TGVuID0gMDsKICAgIGxldCBpOwogICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICBpZiAobGVuZ3Roc1tpXSA+IG1heExlbikgewogICAgICAgIG1heExlbiA9IGxlbmd0aHNbaV07CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHNpemUgPSAxIDw8IG1heExlbjsKICAgIGNvbnN0IGNvZGVzID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CiAgICBmb3IgKGxldCBsZW4gPSAxLCBjb2RlID0gMCwgc2tpcCA9IDI7IGxlbiA8PSBtYXhMZW47ICsrbGVuLCBjb2RlIDw8PSAxLCBza2lwIDw8PSAxKSB7CiAgICAgIGZvciAobGV0IHZhbCA9IDA7IHZhbCA8IG47ICsrdmFsKSB7CiAgICAgICAgaWYgKGxlbmd0aHNbdmFsXSA9PT0gbGVuKSB7CiAgICAgICAgICBsZXQgY29kZTIgPSAwOwogICAgICAgICAgbGV0IHQgPSBjb2RlOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvZGUyID0gY29kZTIgPDwgMSB8IHQgJiAxOwogICAgICAgICAgICB0ID4+PSAxOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChpID0gY29kZTI7IGkgPCBzaXplOyBpICs9IHNraXApIHsKICAgICAgICAgICAgY29kZXNbaV0gPSBsZW4gPDwgMTYgfCB2YWw7CiAgICAgICAgICB9CiAgICAgICAgICArK2NvZGU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gW2NvZGVzLCBtYXhMZW5dOwogIH0KICAjZW5kc1N0cmVhbU9uRXJyb3IoZXJyKSB7CiAgICBpbmZvKGVycik7CiAgICB0aGlzLmVvZiA9IHRydWU7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGxldCBidWZmZXIsIGhkciwgbGVuOwogICAgY29uc3Qgc3RyID0gdGhpcy5zdHI7CiAgICB0cnkgewogICAgICBoZHIgPSB0aGlzLmdldEJpdHMoMyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICB0aGlzLiNlbmRzU3RyZWFtT25FcnJvcihleC5tZXNzYWdlKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGhkciAmIDEpIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgfQogICAgaGRyID4+PSAxOwogICAgaWYgKGhkciA9PT0gMCkgewogICAgICBsZXQgYjsKICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgdGhpcy4jZW5kc1N0cmVhbU9uRXJyb3IoIkJhZCBibG9jayBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCBibG9ja0xlbiA9IGI7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRoaXMuI2VuZHNTdHJlYW1PbkVycm9yKCJCYWQgYmxvY2sgaGVhZGVyIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBibG9ja0xlbiB8PSBiIDw8IDg7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRoaXMuI2VuZHNTdHJlYW1PbkVycm9yKCJCYWQgYmxvY2sgaGVhZGVyIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgY2hlY2sgPSBiOwogICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICB0aGlzLiNlbmRzU3RyZWFtT25FcnJvcigiQmFkIGJsb2NrIGhlYWRlciBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY2hlY2sgfD0gYiA8PCA4OwogICAgICBpZiAoY2hlY2sgIT09ICh+YmxvY2tMZW4gJiAweGZmZmYpICYmIChibG9ja0xlbiAhPT0gMCB8fCBjaGVjayAhPT0gMCkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkJhZCB1bmNvbXByZXNzZWQgYmxvY2sgbGVuZ3RoIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICB9CiAgICAgIHRoaXMuY29kZUJ1ZiA9IDA7CiAgICAgIHRoaXMuY29kZVNpemUgPSAwOwogICAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aCwKICAgICAgICBlbmQgPSBidWZmZXJMZW5ndGggKyBibG9ja0xlbjsKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoZW5kKTsKICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBlbmQ7CiAgICAgIGlmIChibG9ja0xlbiA9PT0gMCkgewogICAgICAgIGlmIChzdHIucGVla0J5dGUoKSA9PT0gLTEpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYmxvY2sgPSBzdHIuZ2V0Qnl0ZXMoYmxvY2tMZW4pOwogICAgICAgIGJ1ZmZlci5zZXQoYmxvY2ssIGJ1ZmZlckxlbmd0aCk7CiAgICAgICAgaWYgKGJsb2NrLmxlbmd0aCA8IGJsb2NrTGVuKSB7CiAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBsaXRDb2RlVGFibGU7CiAgICBsZXQgZGlzdENvZGVUYWJsZTsKICAgIGlmIChoZHIgPT09IDEpIHsKICAgICAgbGl0Q29kZVRhYmxlID0gZml4ZWRMaXRDb2RlVGFiOwogICAgICBkaXN0Q29kZVRhYmxlID0gZml4ZWREaXN0Q29kZVRhYjsKICAgIH0gZWxzZSBpZiAoaGRyID09PSAyKSB7CiAgICAgIGNvbnN0IG51bUxpdENvZGVzID0gdGhpcy5nZXRCaXRzKDUpICsgMjU3OwogICAgICBjb25zdCBudW1EaXN0Q29kZXMgPSB0aGlzLmdldEJpdHMoNSkgKyAxOwogICAgICBjb25zdCBudW1Db2RlTGVuQ29kZXMgPSB0aGlzLmdldEJpdHMoNCkgKyA0OwogICAgICBjb25zdCBjb2RlTGVuQ29kZUxlbmd0aHMgPSBuZXcgVWludDhBcnJheShjb2RlTGVuQ29kZU1hcC5sZW5ndGgpOwogICAgICBsZXQgaTsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUNvZGVMZW5Db2RlczsgKytpKSB7CiAgICAgICAgY29kZUxlbkNvZGVMZW5ndGhzW2NvZGVMZW5Db2RlTWFwW2ldXSA9IHRoaXMuZ2V0Qml0cygzKTsKICAgICAgfQogICAgICBjb25zdCBjb2RlTGVuQ29kZVRhYiA9IHRoaXMuZ2VuZXJhdGVIdWZmbWFuVGFibGUoY29kZUxlbkNvZGVMZW5ndGhzKTsKICAgICAgbGVuID0gMDsKICAgICAgaSA9IDA7CiAgICAgIGNvbnN0IGNvZGVzID0gbnVtTGl0Q29kZXMgKyBudW1EaXN0Q29kZXM7CiAgICAgIGNvbnN0IGNvZGVMZW5ndGhzID0gbmV3IFVpbnQ4QXJyYXkoY29kZXMpOwogICAgICBsZXQgYml0c0xlbmd0aCwgYml0c09mZnNldCwgd2hhdDsKICAgICAgd2hpbGUgKGkgPCBjb2RlcykgewogICAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLmdldENvZGUoY29kZUxlbkNvZGVUYWIpOwogICAgICAgIGlmIChjb2RlID09PSAxNikgewogICAgICAgICAgYml0c0xlbmd0aCA9IDI7CiAgICAgICAgICBiaXRzT2Zmc2V0ID0gMzsKICAgICAgICAgIHdoYXQgPSBsZW47CiAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAxNykgewogICAgICAgICAgYml0c0xlbmd0aCA9IDM7CiAgICAgICAgICBiaXRzT2Zmc2V0ID0gMzsKICAgICAgICAgIHdoYXQgPSBsZW4gPSAwOwogICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMTgpIHsKICAgICAgICAgIGJpdHNMZW5ndGggPSA3OwogICAgICAgICAgYml0c09mZnNldCA9IDExOwogICAgICAgICAgd2hhdCA9IGxlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvZGVMZW5ndGhzW2krK10gPSBsZW4gPSBjb2RlOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCByZXBlYXRMZW5ndGggPSB0aGlzLmdldEJpdHMoYml0c0xlbmd0aCkgKyBiaXRzT2Zmc2V0OwogICAgICAgIHdoaWxlIChyZXBlYXRMZW5ndGgtLSA+IDApIHsKICAgICAgICAgIGNvZGVMZW5ndGhzW2krK10gPSB3aGF0OwogICAgICAgIH0KICAgICAgfQogICAgICBsaXRDb2RlVGFibGUgPSB0aGlzLmdlbmVyYXRlSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLnN1YmFycmF5KDAsIG51bUxpdENvZGVzKSk7CiAgICAgIGRpc3RDb2RlVGFibGUgPSB0aGlzLmdlbmVyYXRlSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLnN1YmFycmF5KG51bUxpdENvZGVzLCBjb2RlcykpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbmtub3duIGJsb2NrIHR5cGUgaW4gZmxhdGUgc3RyZWFtIik7CiAgICB9CiAgICBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGxldCBsaW1pdCA9IGJ1ZmZlciA/IGJ1ZmZlci5sZW5ndGggOiAwOwogICAgbGV0IHBvcyA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbGV0IGNvZGUxID0gdGhpcy5nZXRDb2RlKGxpdENvZGVUYWJsZSk7CiAgICAgIGlmIChjb2RlMSA8IDI1NikgewogICAgICAgIGlmIChwb3MgKyAxID49IGxpbWl0KSB7CiAgICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihwb3MgKyAxKTsKICAgICAgICAgIGxpbWl0ID0gYnVmZmVyLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IGNvZGUxOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjb2RlMSA9PT0gMjU2KSB7CiAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBwb3M7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvZGUxIC09IDI1NzsKICAgICAgY29kZTEgPSBsZW5ndGhEZWNvZGVbY29kZTFdOwogICAgICBsZXQgY29kZTIgPSBjb2RlMSA+PiAxNjsKICAgICAgaWYgKGNvZGUyID4gMCkgewogICAgICAgIGNvZGUyID0gdGhpcy5nZXRCaXRzKGNvZGUyKTsKICAgICAgfQogICAgICBsZW4gPSAoY29kZTEgJiAweGZmZmYpICsgY29kZTI7CiAgICAgIGNvZGUxID0gdGhpcy5nZXRDb2RlKGRpc3RDb2RlVGFibGUpOwogICAgICBjb2RlMSA9IGRpc3REZWNvZGVbY29kZTFdOwogICAgICBjb2RlMiA9IGNvZGUxID4+IDE2OwogICAgICBpZiAoY29kZTIgPiAwKSB7CiAgICAgICAgY29kZTIgPSB0aGlzLmdldEJpdHMoY29kZTIpOwogICAgICB9CiAgICAgIGNvbnN0IGRpc3QgPSAoY29kZTEgJiAweGZmZmYpICsgY29kZTI7CiAgICAgIGlmIChwb3MgKyBsZW4gPj0gbGltaXQpIHsKICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihwb3MgKyBsZW4pOwogICAgICAgIGxpbWl0ID0gYnVmZmVyLmxlbmd0aDsKICAgICAgfQogICAgICBmb3IgKGxldCBrID0gMDsgayA8IGxlbjsgKytrLCArK3BvcykgewogICAgICAgIGJ1ZmZlcltwb3NdID0gYnVmZmVyW3BvcyAtIGRpc3RdOwogICAgICB9CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9hcml0aG1ldGljX2RlY29kZXIuanMKY29uc3QgUWVUYWJsZSA9IFt7CiAgcWU6IDB4NTYwMSwKICBubXBzOiAxLAogIG5scHM6IDEsCiAgc3dpdGNoRmxhZzogMQp9LCB7CiAgcWU6IDB4MzQwMSwKICBubXBzOiAyLAogIG5scHM6IDYsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTgwMSwKICBubXBzOiAzLAogIG5scHM6IDksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MGFjMSwKICBubXBzOiA0LAogIG5scHM6IDEyLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDA1MjEsCiAgbm1wczogNSwKICBubHBzOiAyOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMjIxLAogIG5tcHM6IDM4LAogIG5scHM6IDMzLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDU2MDEsCiAgbm1wczogNywKICBubHBzOiA2LAogIHN3aXRjaEZsYWc6IDEKfSwgewogIHFlOiAweDU0MDEsCiAgbm1wczogOCwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg0ODAxLAogIG5tcHM6IDksCiAgbmxwczogMTQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MzgwMSwKICBubXBzOiAxMCwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgzMDAxLAogIG5tcHM6IDExLAogIG5scHM6IDE3LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDI0MDEsCiAgbm1wczogMTIsCiAgbmxwczogMTgsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MWMwMSwKICBubXBzOiAxMywKICBubHBzOiAyMCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxNjAxLAogIG5tcHM6IDI5LAogIG5scHM6IDIxLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDU2MDEsCiAgbm1wczogMTUsCiAgbmxwczogMTQsCiAgc3dpdGNoRmxhZzogMQp9LCB7CiAgcWU6IDB4NTQwMSwKICBubXBzOiAxNiwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg1MTAxLAogIG5tcHM6IDE3LAogIG5scHM6IDE1LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDQ4MDEsCiAgbm1wczogMTgsCiAgbmxwczogMTYsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MzgwMSwKICBubXBzOiAxOSwKICBubHBzOiAxNywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgzNDAxLAogIG5tcHM6IDIwLAogIG5scHM6IDE4LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDMwMDEsCiAgbm1wczogMjEsCiAgbmxwczogMTksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MjgwMSwKICBubXBzOiAyMiwKICBubHBzOiAxOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgyNDAxLAogIG5tcHM6IDIzLAogIG5scHM6IDIwLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDIyMDEsCiAgbm1wczogMjQsCiAgbmxwczogMjEsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MWMwMSwKICBubXBzOiAyNSwKICBubHBzOiAyMiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxODAxLAogIG5tcHM6IDI2LAogIG5scHM6IDIzLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDE2MDEsCiAgbm1wczogMjcsCiAgbmxwczogMjQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTQwMSwKICBubXBzOiAyOCwKICBubHBzOiAyNSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxMjAxLAogIG5tcHM6IDI5LAogIG5scHM6IDI2LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDExMDEsCiAgbm1wczogMzAsCiAgbmxwczogMjcsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MGFjMSwKICBubXBzOiAzMSwKICBubHBzOiAyOCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwOWMxLAogIG5tcHM6IDMyLAogIG5scHM6IDI5LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDA4YTEsCiAgbm1wczogMzMsCiAgbmxwczogMzAsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDUyMSwKICBubXBzOiAzNCwKICBubHBzOiAzMSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwNDQxLAogIG5tcHM6IDM1LAogIG5scHM6IDMyLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAyYTEsCiAgbm1wczogMzYsCiAgbmxwczogMzMsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDIyMSwKICBubXBzOiAzNywKICBubHBzOiAzNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMTQxLAogIG5tcHM6IDM4LAogIG5scHM6IDM1LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAxMTEsCiAgbm1wczogMzksCiAgbmxwczogMzYsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDA4NSwKICBubXBzOiA0MCwKICBubHBzOiAzNywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDQ5LAogIG5tcHM6IDQxLAogIG5scHM6IDM4LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwMjUsCiAgbm1wczogNDIsCiAgbmxwczogMzksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDAxNSwKICBubXBzOiA0MywKICBubHBzOiA0MCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDA5LAogIG5tcHM6IDQ0LAogIG5scHM6IDQxLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwMDUsCiAgbm1wczogNDUsCiAgbmxwczogNDIsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDAwMSwKICBubXBzOiA0NSwKICBubHBzOiA0MywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg1NjAxLAogIG5tcHM6IDQ2LAogIG5scHM6IDQ2LAogIHN3aXRjaEZsYWc6IDAKfV07CmNsYXNzIEFyaXRobWV0aWNEZWNvZGVyIHsKICBjb25zdHJ1Y3RvcihkYXRhLCBzdGFydCwgZW5kKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5icCA9IHN0YXJ0OwogICAgdGhpcy5kYXRhRW5kID0gZW5kOwogICAgdGhpcy5jaGlnaCA9IGRhdGFbc3RhcnRdOwogICAgdGhpcy5jbG93ID0gMDsKICAgIHRoaXMuYnl0ZUluKCk7CiAgICB0aGlzLmNoaWdoID0gdGhpcy5jaGlnaCA8PCA3ICYgMHhmZmZmIHwgdGhpcy5jbG93ID4+IDkgJiAweDdmOwogICAgdGhpcy5jbG93ID0gdGhpcy5jbG93IDw8IDcgJiAweGZmZmY7CiAgICB0aGlzLmN0IC09IDc7CiAgICB0aGlzLmEgPSAweDgwMDA7CiAgfQogIGJ5dGVJbigpIHsKICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICBsZXQgYnAgPSB0aGlzLmJwOwogICAgaWYgKGRhdGFbYnBdID09PSAweGZmKSB7CiAgICAgIGlmIChkYXRhW2JwICsgMV0gPiAweDhmKSB7CiAgICAgICAgdGhpcy5jbG93ICs9IDB4ZmYwMDsKICAgICAgICB0aGlzLmN0ID0gODsKICAgICAgfSBlbHNlIHsKICAgICAgICBicCsrOwogICAgICAgIHRoaXMuY2xvdyArPSBkYXRhW2JwXSA8PCA5OwogICAgICAgIHRoaXMuY3QgPSA3OwogICAgICAgIHRoaXMuYnAgPSBicDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYnArKzsKICAgICAgdGhpcy5jbG93ICs9IGJwIDwgdGhpcy5kYXRhRW5kID8gZGF0YVticF0gPDwgOCA6IDB4ZmYwMDsKICAgICAgdGhpcy5jdCA9IDg7CiAgICAgIHRoaXMuYnAgPSBicDsKICAgIH0KICAgIGlmICh0aGlzLmNsb3cgPiAweGZmZmYpIHsKICAgICAgdGhpcy5jaGlnaCArPSB0aGlzLmNsb3cgPj4gMTY7CiAgICAgIHRoaXMuY2xvdyAmPSAweGZmZmY7CiAgICB9CiAgfQogIHJlYWRCaXQoY29udGV4dHMsIHBvcykgewogICAgbGV0IGN4X2luZGV4ID0gY29udGV4dHNbcG9zXSA+PiAxLAogICAgICBjeF9tcHMgPSBjb250ZXh0c1twb3NdICYgMTsKICAgIGNvbnN0IHFlVGFibGVJY3ggPSBRZVRhYmxlW2N4X2luZGV4XTsKICAgIGNvbnN0IHFlSWN4ID0gcWVUYWJsZUljeC5xZTsKICAgIGxldCBkOwogICAgbGV0IGEgPSB0aGlzLmEgLSBxZUljeDsKICAgIGlmICh0aGlzLmNoaWdoIDwgcWVJY3gpIHsKICAgICAgaWYgKGEgPCBxZUljeCkgewogICAgICAgIGEgPSBxZUljeDsKICAgICAgICBkID0gY3hfbXBzOwogICAgICAgIGN4X2luZGV4ID0gcWVUYWJsZUljeC5ubXBzOwogICAgICB9IGVsc2UgewogICAgICAgIGEgPSBxZUljeDsKICAgICAgICBkID0gMSBeIGN4X21wczsKICAgICAgICBpZiAocWVUYWJsZUljeC5zd2l0Y2hGbGFnID09PSAxKSB7CiAgICAgICAgICBjeF9tcHMgPSBkOwogICAgICAgIH0KICAgICAgICBjeF9pbmRleCA9IHFlVGFibGVJY3gubmxwczsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jaGlnaCAtPSBxZUljeDsKICAgICAgaWYgKChhICYgMHg4MDAwKSAhPT0gMCkgewogICAgICAgIHRoaXMuYSA9IGE7CiAgICAgICAgcmV0dXJuIGN4X21wczsKICAgICAgfQogICAgICBpZiAoYSA8IHFlSWN4KSB7CiAgICAgICAgZCA9IDEgXiBjeF9tcHM7CiAgICAgICAgaWYgKHFlVGFibGVJY3guc3dpdGNoRmxhZyA9PT0gMSkgewogICAgICAgICAgY3hfbXBzID0gZDsKICAgICAgICB9CiAgICAgICAgY3hfaW5kZXggPSBxZVRhYmxlSWN4Lm5scHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZCA9IGN4X21wczsKICAgICAgICBjeF9pbmRleCA9IHFlVGFibGVJY3gubm1wczsKICAgICAgfQogICAgfQogICAgZG8gewogICAgICBpZiAodGhpcy5jdCA9PT0gMCkgewogICAgICAgIHRoaXMuYnl0ZUluKCk7CiAgICAgIH0KICAgICAgYSA8PD0gMTsKICAgICAgdGhpcy5jaGlnaCA9IHRoaXMuY2hpZ2ggPDwgMSAmIDB4ZmZmZiB8IHRoaXMuY2xvdyA+PiAxNSAmIDE7CiAgICAgIHRoaXMuY2xvdyA9IHRoaXMuY2xvdyA8PCAxICYgMHhmZmZmOwogICAgICB0aGlzLmN0LS07CiAgICB9IHdoaWxlICgoYSAmIDB4ODAwMCkgPT09IDApOwogICAgdGhpcy5hID0gYTsKICAgIGNvbnRleHRzW3Bvc10gPSBjeF9pbmRleCA8PCAxIHwgY3hfbXBzOwogICAgcmV0dXJuIGQ7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9qYmlnMi5qcwoKCgoKY2xhc3MgSmJpZzJFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSmJpZzJFcnJvciIpOwogIH0KfQpjbGFzcyBDb250ZXh0Q2FjaGUgewogIGdldENvbnRleHRzKGlkKSB7CiAgICBpZiAoaWQgaW4gdGhpcykgewogICAgICByZXR1cm4gdGhpc1tpZF07CiAgICB9CiAgICByZXR1cm4gdGhpc1tpZF0gPSBuZXcgSW50OEFycmF5KDEgPDwgMTYpOwogIH0KfQpjbGFzcyBEZWNvZGluZ0NvbnRleHQgewogIGNvbnN0cnVjdG9yKGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICB0aGlzLmVuZCA9IGVuZDsKICB9CiAgZ2V0IGRlY29kZXIoKSB7CiAgICBjb25zdCBkZWNvZGVyID0gbmV3IEFyaXRobWV0aWNEZWNvZGVyKHRoaXMuZGF0YSwgdGhpcy5zdGFydCwgdGhpcy5lbmQpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZGVjb2RlciIsIGRlY29kZXIpOwogIH0KICBnZXQgY29udGV4dENhY2hlKCkgewogICAgY29uc3QgY2FjaGUgPSBuZXcgQ29udGV4dENhY2hlKCk7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjb250ZXh0Q2FjaGUiLCBjYWNoZSk7CiAgfQp9CmZ1bmN0aW9uIGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCBwcm9jZWR1cmUsIGRlY29kZXIpIHsKICBjb25zdCBjb250ZXh0cyA9IGNvbnRleHRDYWNoZS5nZXRDb250ZXh0cyhwcm9jZWR1cmUpOwogIGxldCBwcmV2ID0gMTsKICBmdW5jdGlvbiByZWFkQml0cyhsZW5ndGgpIHsKICAgIGxldCB2ID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYml0ID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBwcmV2KTsKICAgICAgcHJldiA9IHByZXYgPCAyNTYgPyBwcmV2IDw8IDEgfCBiaXQgOiAocHJldiA8PCAxIHwgYml0KSAmIDUxMSB8IDI1NjsKICAgICAgdiA9IHYgPDwgMSB8IGJpdDsKICAgIH0KICAgIHJldHVybiB2ID4+PiAwOwogIH0KICBjb25zdCBzaWduID0gcmVhZEJpdHMoMSk7CiAgY29uc3QgdmFsdWUgPSByZWFkQml0cygxKSA/IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMSkgPyByZWFkQml0cygxKSA/IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMzIpICsgNDQzNiA6IHJlYWRCaXRzKDEyKSArIDM0MCA6IHJlYWRCaXRzKDgpICsgODQgOiByZWFkQml0cyg2KSArIDIwIDogcmVhZEJpdHMoNCkgKyA0IDogcmVhZEJpdHMoMik7CiAgbGV0IHNpZ25lZFZhbHVlOwogIGlmIChzaWduID09PSAwKSB7CiAgICBzaWduZWRWYWx1ZSA9IHZhbHVlOwogIH0gZWxzZSBpZiAodmFsdWUgPiAwKSB7CiAgICBzaWduZWRWYWx1ZSA9IC12YWx1ZTsKICB9CiAgaWYgKHNpZ25lZFZhbHVlID49IE1JTl9JTlRfMzIgJiYgc2lnbmVkVmFsdWUgPD0gTUFYX0lOVF8zMikgewogICAgcmV0dXJuIHNpZ25lZFZhbHVlOwogIH0KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiBkZWNvZGVJQUlEKGNvbnRleHRDYWNoZSwgZGVjb2RlciwgY29kZUxlbmd0aCkgewogIGNvbnN0IGNvbnRleHRzID0gY29udGV4dENhY2hlLmdldENvbnRleHRzKCJJQUlEIik7CiAgbGV0IHByZXYgPSAxOwogIGZvciAobGV0IGkgPSAwOyBpIDwgY29kZUxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBiaXQgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIHByZXYpOwogICAgcHJldiA9IHByZXYgPDwgMSB8IGJpdDsKICB9CiAgaWYgKGNvZGVMZW5ndGggPCAzMSkgewogICAgcmV0dXJuIHByZXYgJiAoMSA8PCBjb2RlTGVuZ3RoKSAtIDE7CiAgfQogIHJldHVybiBwcmV2ICYgMHg3ZmZmZmZmZjsKfQpjb25zdCBTZWdtZW50VHlwZXMgPSBbIlN5bWJvbERpY3Rpb25hcnkiLCBudWxsLCBudWxsLCBudWxsLCAiSW50ZXJtZWRpYXRlVGV4dFJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVUZXh0UmVnaW9uIiwgIkltbWVkaWF0ZUxvc3NsZXNzVGV4dFJlZ2lvbiIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJQYXR0ZXJuRGljdGlvbmFyeSIsIG51bGwsIG51bGwsIG51bGwsICJJbnRlcm1lZGlhdGVIYWxmdG9uZVJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVIYWxmdG9uZVJlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0hhbGZ0b25lUmVnaW9uIiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgIkludGVybWVkaWF0ZUdlbmVyaWNSZWdpb24iLCBudWxsLCAiSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0dlbmVyaWNSZWdpb24iLCAiSW50ZXJtZWRpYXRlR2VuZXJpY1JlZmluZW1lbnRSZWdpb24iLCBudWxsLCAiSW1tZWRpYXRlR2VuZXJpY1JlZmluZW1lbnRSZWdpb24iLCAiSW1tZWRpYXRlTG9zc2xlc3NHZW5lcmljUmVmaW5lbWVudFJlZ2lvbiIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJQYWdlSW5mb3JtYXRpb24iLCAiRW5kT2ZQYWdlIiwgIkVuZE9mU3RyaXBlIiwgIkVuZE9mRmlsZSIsICJQcm9maWxlcyIsICJUYWJsZXMiLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCAiRXh0ZW5zaW9uIl07CmNvbnN0IENvZGluZ1RlbXBsYXRlcyA9IFtbewogIHg6IC0xLAogIHk6IC0yCn0sIHsKICB4OiAwLAogIHk6IC0yCn0sIHsKICB4OiAxLAogIHk6IC0yCn0sIHsKICB4OiAtMiwKICB5OiAtMQp9LCB7CiAgeDogLTEsCiAgeTogLTEKfSwgewogIHg6IDAsCiAgeTogLTEKfSwgewogIHg6IDEsCiAgeTogLTEKfSwgewogIHg6IDIsCiAgeTogLTEKfSwgewogIHg6IC00LAogIHk6IDAKfSwgewogIHg6IC0zLAogIHk6IDAKfSwgewogIHg6IC0yLAogIHk6IDAKfSwgewogIHg6IC0xLAogIHk6IDAKfV0sIFt7CiAgeDogLTEsCiAgeTogLTIKfSwgewogIHg6IDAsCiAgeTogLTIKfSwgewogIHg6IDEsCiAgeTogLTIKfSwgewogIHg6IDIsCiAgeTogLTIKfSwgewogIHg6IC0yLAogIHk6IC0xCn0sIHsKICB4OiAtMSwKICB5OiAtMQp9LCB7CiAgeDogMCwKICB5OiAtMQp9LCB7CiAgeDogMSwKICB5OiAtMQp9LCB7CiAgeDogMiwKICB5OiAtMQp9LCB7CiAgeDogLTMsCiAgeTogMAp9LCB7CiAgeDogLTIsCiAgeTogMAp9LCB7CiAgeDogLTEsCiAgeTogMAp9XSwgW3sKICB4OiAtMSwKICB5OiAtMgp9LCB7CiAgeDogMCwKICB5OiAtMgp9LCB7CiAgeDogMSwKICB5OiAtMgp9LCB7CiAgeDogLTIsCiAgeTogLTEKfSwgewogIHg6IC0xLAogIHk6IC0xCn0sIHsKICB4OiAwLAogIHk6IC0xCn0sIHsKICB4OiAxLAogIHk6IC0xCn0sIHsKICB4OiAtMiwKICB5OiAwCn0sIHsKICB4OiAtMSwKICB5OiAwCn1dLCBbewogIHg6IC0zLAogIHk6IC0xCn0sIHsKICB4OiAtMiwKICB5OiAtMQp9LCB7CiAgeDogLTEsCiAgeTogLTEKfSwgewogIHg6IDAsCiAgeTogLTEKfSwgewogIHg6IDEsCiAgeTogLTEKfSwgewogIHg6IC00LAogIHk6IDAKfSwgewogIHg6IC0zLAogIHk6IDAKfSwgewogIHg6IC0yLAogIHk6IDAKfSwgewogIHg6IC0xLAogIHk6IDAKfV1dOwpjb25zdCBSZWZpbmVtZW50VGVtcGxhdGVzID0gW3sKICBjb2Rpbmc6IFt7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAxLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9XSwKICByZWZlcmVuY2U6IFt7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAxLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAwLAogICAgeTogMAogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAwCiAgfSwgewogICAgeDogLTEsCiAgICB5OiAxCiAgfSwgewogICAgeDogMCwKICAgIHk6IDEKICB9LCB7CiAgICB4OiAxLAogICAgeTogMQogIH1dCn0sIHsKICBjb2Rpbmc6IFt7CiAgICB4OiAtMSwKICAgIHk6IC0xCiAgfSwgewogICAgeDogMCwKICAgIHk6IC0xCiAgfSwgewogICAgeDogMSwKICAgIHk6IC0xCiAgfSwgewogICAgeDogLTEsCiAgICB5OiAwCiAgfV0sCiAgcmVmZXJlbmNlOiBbewogICAgeDogMCwKICAgIHk6IC0xCiAgfSwgewogICAgeDogLTEsCiAgICB5OiAwCiAgfSwgewogICAgeDogMCwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAxLAogICAgeTogMAogIH0sIHsKICAgIHg6IDAsCiAgICB5OiAxCiAgfSwgewogICAgeDogMSwKICAgIHk6IDEKICB9XQp9XTsKY29uc3QgUmV1c2VkQ29udGV4dHMgPSBbMHg5YjI1LCAweDA3OTUsIDB4MDBlNSwgMHgwMTk1XTsKY29uc3QgUmVmaW5lbWVudFJldXNlZENvbnRleHRzID0gWzB4MDAyMCwgMHgwMDA4XTsKZnVuY3Rpb24gZGVjb2RlQml0bWFwVGVtcGxhdGUwKHdpZHRoLCBoZWlnaHQsIGRlY29kaW5nQ29udGV4dCkgewogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0cyA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIkdCIik7CiAgY29uc3QgYml0bWFwID0gW107CiAgbGV0IGNvbnRleHRMYWJlbCwgaSwgaiwgcGl4ZWwsIHJvdywgcm93MSwgcm93MjsKICBjb25zdCBPTERfUElYRUxfTUFTSyA9IDB4N2JmNzsKICBmb3IgKGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgIHJvdyA9IGJpdG1hcFtpXSA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIHJvdzEgPSBpIDwgMSA/IHJvdyA6IGJpdG1hcFtpIC0gMV07CiAgICByb3cyID0gaSA8IDIgPyByb3cgOiBiaXRtYXBbaSAtIDJdOwogICAgY29udGV4dExhYmVsID0gcm93MlswXSA8PCAxMyB8IHJvdzJbMV0gPDwgMTIgfCByb3cyWzJdIDw8IDExIHwgcm93MVswXSA8PCA3IHwgcm93MVsxXSA8PCA2IHwgcm93MVsyXSA8PCA1IHwgcm93MVszXSA8PCA0OwogICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgcm93W2pdID0gcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgIGNvbnRleHRMYWJlbCA9IChjb250ZXh0TGFiZWwgJiBPTERfUElYRUxfTUFTSykgPDwgMSB8IChqICsgMyA8IHdpZHRoID8gcm93MltqICsgM10gPDwgMTEgOiAwKSB8IChqICsgNCA8IHdpZHRoID8gcm93MVtqICsgNF0gPDwgNCA6IDApIHwgcGl4ZWw7CiAgICB9CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KZnVuY3Rpb24gZGVjb2RlQml0bWFwKG1tciwgd2lkdGgsIGhlaWdodCwgdGVtcGxhdGVJbmRleCwgcHJlZGljdGlvbiwgc2tpcCwgYXQsIGRlY29kaW5nQ29udGV4dCkgewogIGlmIChtbXIpIHsKICAgIGNvbnN0IGlucHV0ID0gbmV3IFJlYWRlcihkZWNvZGluZ0NvbnRleHQuZGF0YSwgZGVjb2RpbmdDb250ZXh0LnN0YXJ0LCBkZWNvZGluZ0NvbnRleHQuZW5kKTsKICAgIHJldHVybiBkZWNvZGVNTVJCaXRtYXAoaW5wdXQsIHdpZHRoLCBoZWlnaHQsIGZhbHNlKTsKICB9CiAgaWYgKHRlbXBsYXRlSW5kZXggPT09IDAgJiYgIXNraXAgJiYgIXByZWRpY3Rpb24gJiYgYXQubGVuZ3RoID09PSA0ICYmIGF0WzBdLnggPT09IDMgJiYgYXRbMF0ueSA9PT0gLTEgJiYgYXRbMV0ueCA9PT0gLTMgJiYgYXRbMV0ueSA9PT0gLTEgJiYgYXRbMl0ueCA9PT0gMiAmJiBhdFsyXS55ID09PSAtMiAmJiBhdFszXS54ID09PSAtMiAmJiBhdFszXS55ID09PSAtMikgewogICAgcmV0dXJuIGRlY29kZUJpdG1hcFRlbXBsYXRlMCh3aWR0aCwgaGVpZ2h0LCBkZWNvZGluZ0NvbnRleHQpOwogIH0KICBjb25zdCB1c2Vza2lwID0gISFza2lwOwogIGNvbnN0IHRlbXBsYXRlID0gQ29kaW5nVGVtcGxhdGVzW3RlbXBsYXRlSW5kZXhdLmNvbmNhdChhdCk7CiAgdGVtcGxhdGUuc29ydCgoYSwgYikgPT4gYS55IC0gYi55IHx8IGEueCAtIGIueCk7CiAgY29uc3QgdGVtcGxhdGVMZW5ndGggPSB0ZW1wbGF0ZS5sZW5ndGg7CiAgY29uc3QgdGVtcGxhdGVYID0gbmV3IEludDhBcnJheSh0ZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgdGVtcGxhdGVZID0gbmV3IEludDhBcnJheSh0ZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXMgPSBbXTsKICBsZXQgcmV1c2VNYXNrID0gMCwKICAgIG1pblggPSAwLAogICAgbWF4WCA9IDAsCiAgICBtaW5ZID0gMDsKICBsZXQgYywgazsKICBmb3IgKGsgPSAwOyBrIDwgdGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgdGVtcGxhdGVYW2tdID0gdGVtcGxhdGVba10ueDsKICAgIHRlbXBsYXRlWVtrXSA9IHRlbXBsYXRlW2tdLnk7CiAgICBtaW5YID0gTWF0aC5taW4obWluWCwgdGVtcGxhdGVba10ueCk7CiAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgdGVtcGxhdGVba10ueCk7CiAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgdGVtcGxhdGVba10ueSk7CiAgICBpZiAoayA8IHRlbXBsYXRlTGVuZ3RoIC0gMSAmJiB0ZW1wbGF0ZVtrXS55ID09PSB0ZW1wbGF0ZVtrICsgMV0ueSAmJiB0ZW1wbGF0ZVtrXS54ID09PSB0ZW1wbGF0ZVtrICsgMV0ueCAtIDEpIHsKICAgICAgcmV1c2VNYXNrIHw9IDEgPDwgdGVtcGxhdGVMZW5ndGggLSAxIC0gazsKICAgIH0gZWxzZSB7CiAgICAgIGNoYW5naW5nVGVtcGxhdGVFbnRyaWVzLnB1c2goayk7CiAgICB9CiAgfQogIGNvbnN0IGNoYW5naW5nRW50cmllc0xlbmd0aCA9IGNoYW5naW5nVGVtcGxhdGVFbnRyaWVzLmxlbmd0aDsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlWCA9IG5ldyBJbnQ4QXJyYXkoY2hhbmdpbmdFbnRyaWVzTGVuZ3RoKTsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlWSA9IG5ldyBJbnQ4QXJyYXkoY2hhbmdpbmdFbnRyaWVzTGVuZ3RoKTsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlQml0ID0gbmV3IFVpbnQxNkFycmF5KGNoYW5naW5nRW50cmllc0xlbmd0aCk7CiAgZm9yIChjID0gMDsgYyA8IGNoYW5naW5nRW50cmllc0xlbmd0aDsgYysrKSB7CiAgICBrID0gY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXNbY107CiAgICBjaGFuZ2luZ1RlbXBsYXRlWFtjXSA9IHRlbXBsYXRlW2tdLng7CiAgICBjaGFuZ2luZ1RlbXBsYXRlWVtjXSA9IHRlbXBsYXRlW2tdLnk7CiAgICBjaGFuZ2luZ1RlbXBsYXRlQml0W2NdID0gMSA8PCB0ZW1wbGF0ZUxlbmd0aCAtIDEgLSBrOwogIH0KICBjb25zdCBzYmJfbGVmdCA9IC1taW5YOwogIGNvbnN0IHNiYl90b3AgPSAtbWluWTsKICBjb25zdCBzYmJfcmlnaHQgPSB3aWR0aCAtIG1heFg7CiAgY29uc3QgcHNldWRvUGl4ZWxDb250ZXh0ID0gUmV1c2VkQ29udGV4dHNbdGVtcGxhdGVJbmRleF07CiAgbGV0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBjb25zdCBkZWNvZGVyID0gZGVjb2RpbmdDb250ZXh0LmRlY29kZXI7CiAgY29uc3QgY29udGV4dHMgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlLmdldENvbnRleHRzKCJHQiIpOwogIGxldCBsdHAgPSAwLAogICAgaiwKICAgIGkwLAogICAgajAsCiAgICBjb250ZXh0TGFiZWwgPSAwLAogICAgYml0LAogICAgc2hpZnQ7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgaWYgKHByZWRpY3Rpb24pIHsKICAgICAgY29uc3Qgc2x0cCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHNldWRvUGl4ZWxDb250ZXh0KTsKICAgICAgbHRwIF49IHNsdHA7CiAgICAgIGlmIChsdHApIHsKICAgICAgICBiaXRtYXAucHVzaChyb3cpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICB9CiAgICByb3cgPSBuZXcgVWludDhBcnJheShyb3cpOwogICAgYml0bWFwLnB1c2gocm93KTsKICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgIGlmICh1c2Vza2lwICYmIHNraXBbaV1bal0pIHsKICAgICAgICByb3dbal0gPSAwOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChqID49IHNiYl9sZWZ0ICYmIGogPCBzYmJfcmlnaHQgJiYgaSA+PSBzYmJfdG9wKSB7CiAgICAgICAgY29udGV4dExhYmVsID0gY29udGV4dExhYmVsIDw8IDEgJiByZXVzZU1hc2s7CiAgICAgICAgZm9yIChrID0gMDsgayA8IGNoYW5naW5nRW50cmllc0xlbmd0aDsgaysrKSB7CiAgICAgICAgICBpMCA9IGkgKyBjaGFuZ2luZ1RlbXBsYXRlWVtrXTsKICAgICAgICAgIGowID0gaiArIGNoYW5naW5nVGVtcGxhdGVYW2tdOwogICAgICAgICAgYml0ID0gYml0bWFwW2kwXVtqMF07CiAgICAgICAgICBpZiAoYml0KSB7CiAgICAgICAgICAgIGJpdCA9IGNoYW5naW5nVGVtcGxhdGVCaXRba107CiAgICAgICAgICAgIGNvbnRleHRMYWJlbCB8PSBiaXQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnRleHRMYWJlbCA9IDA7CiAgICAgICAgc2hpZnQgPSB0ZW1wbGF0ZUxlbmd0aCAtIDE7CiAgICAgICAgZm9yIChrID0gMDsgayA8IHRlbXBsYXRlTGVuZ3RoOyBrKyssIHNoaWZ0LS0pIHsKICAgICAgICAgIGowID0gaiArIHRlbXBsYXRlWFtrXTsKICAgICAgICAgIGlmIChqMCA+PSAwICYmIGowIDwgd2lkdGgpIHsKICAgICAgICAgICAgaTAgPSBpICsgdGVtcGxhdGVZW2tdOwogICAgICAgICAgICBpZiAoaTAgPj0gMCkgewogICAgICAgICAgICAgIGJpdCA9IGJpdG1hcFtpMF1bajBdOwogICAgICAgICAgICAgIGlmIChiaXQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHRMYWJlbCB8PSBiaXQgPDwgc2hpZnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHBpeGVsID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBjb250ZXh0TGFiZWwpOwogICAgICByb3dbal0gPSBwaXhlbDsKICAgIH0KICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVSZWZpbmVtZW50KHdpZHRoLCBoZWlnaHQsIHRlbXBsYXRlSW5kZXgsIHJlZmVyZW5jZUJpdG1hcCwgb2Zmc2V0WCwgb2Zmc2V0WSwgcHJlZGljdGlvbiwgYXQsIGRlY29kaW5nQ29udGV4dCkgewogIGxldCBjb2RpbmdUZW1wbGF0ZSA9IFJlZmluZW1lbnRUZW1wbGF0ZXNbdGVtcGxhdGVJbmRleF0uY29kaW5nOwogIGlmICh0ZW1wbGF0ZUluZGV4ID09PSAwKSB7CiAgICBjb2RpbmdUZW1wbGF0ZSA9IGNvZGluZ1RlbXBsYXRlLmNvbmNhdChbYXRbMF1dKTsKICB9CiAgY29uc3QgY29kaW5nVGVtcGxhdGVMZW5ndGggPSBjb2RpbmdUZW1wbGF0ZS5sZW5ndGg7CiAgY29uc3QgY29kaW5nVGVtcGxhdGVYID0gbmV3IEludDMyQXJyYXkoY29kaW5nVGVtcGxhdGVMZW5ndGgpOwogIGNvbnN0IGNvZGluZ1RlbXBsYXRlWSA9IG5ldyBJbnQzMkFycmF5KGNvZGluZ1RlbXBsYXRlTGVuZ3RoKTsKICBsZXQgazsKICBmb3IgKGsgPSAwOyBrIDwgY29kaW5nVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgY29kaW5nVGVtcGxhdGVYW2tdID0gY29kaW5nVGVtcGxhdGVba10ueDsKICAgIGNvZGluZ1RlbXBsYXRlWVtrXSA9IGNvZGluZ1RlbXBsYXRlW2tdLnk7CiAgfQogIGxldCByZWZlcmVuY2VUZW1wbGF0ZSA9IFJlZmluZW1lbnRUZW1wbGF0ZXNbdGVtcGxhdGVJbmRleF0ucmVmZXJlbmNlOwogIGlmICh0ZW1wbGF0ZUluZGV4ID09PSAwKSB7CiAgICByZWZlcmVuY2VUZW1wbGF0ZSA9IHJlZmVyZW5jZVRlbXBsYXRlLmNvbmNhdChbYXRbMV1dKTsKICB9CiAgY29uc3QgcmVmZXJlbmNlVGVtcGxhdGVMZW5ndGggPSByZWZlcmVuY2VUZW1wbGF0ZS5sZW5ndGg7CiAgY29uc3QgcmVmZXJlbmNlVGVtcGxhdGVYID0gbmV3IEludDMyQXJyYXkocmVmZXJlbmNlVGVtcGxhdGVMZW5ndGgpOwogIGNvbnN0IHJlZmVyZW5jZVRlbXBsYXRlWSA9IG5ldyBJbnQzMkFycmF5KHJlZmVyZW5jZVRlbXBsYXRlTGVuZ3RoKTsKICBmb3IgKGsgPSAwOyBrIDwgcmVmZXJlbmNlVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgcmVmZXJlbmNlVGVtcGxhdGVYW2tdID0gcmVmZXJlbmNlVGVtcGxhdGVba10ueDsKICAgIHJlZmVyZW5jZVRlbXBsYXRlWVtrXSA9IHJlZmVyZW5jZVRlbXBsYXRlW2tdLnk7CiAgfQogIGNvbnN0IHJlZmVyZW5jZVdpZHRoID0gcmVmZXJlbmNlQml0bWFwWzBdLmxlbmd0aDsKICBjb25zdCByZWZlcmVuY2VIZWlnaHQgPSByZWZlcmVuY2VCaXRtYXAubGVuZ3RoOwogIGNvbnN0IHBzZXVkb1BpeGVsQ29udGV4dCA9IFJlZmluZW1lbnRSZXVzZWRDb250ZXh0c1t0ZW1wbGF0ZUluZGV4XTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBjb25zdCBkZWNvZGVyID0gZGVjb2RpbmdDb250ZXh0LmRlY29kZXI7CiAgY29uc3QgY29udGV4dHMgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlLmdldENvbnRleHRzKCJHUiIpOwogIGxldCBsdHAgPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgIGlmIChwcmVkaWN0aW9uKSB7CiAgICAgIGNvbnN0IHNsdHAgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIHBzZXVkb1BpeGVsQ29udGV4dCk7CiAgICAgIGx0cCBePSBzbHRwOwogICAgICBpZiAobHRwKSB7CiAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInByZWRpY3Rpb24gaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICB9CiAgICB9CiAgICBjb25zdCByb3cgPSBuZXcgVWludDhBcnJheSh3aWR0aCk7CiAgICBiaXRtYXAucHVzaChyb3cpOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgIGxldCBpMCwgajA7CiAgICAgIGxldCBjb250ZXh0TGFiZWwgPSAwOwogICAgICBmb3IgKGsgPSAwOyBrIDwgY29kaW5nVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgICAgIGkwID0gaSArIGNvZGluZ1RlbXBsYXRlWVtrXTsKICAgICAgICBqMCA9IGogKyBjb2RpbmdUZW1wbGF0ZVhba107CiAgICAgICAgaWYgKGkwIDwgMCB8fCBqMCA8IDAgfHwgajAgPj0gd2lkdGgpIHsKICAgICAgICAgIGNvbnRleHRMYWJlbCA8PD0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGV4dExhYmVsID0gY29udGV4dExhYmVsIDw8IDEgfCBiaXRtYXBbaTBdW2owXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChrID0gMDsgayA8IHJlZmVyZW5jZVRlbXBsYXRlTGVuZ3RoOyBrKyspIHsKICAgICAgICBpMCA9IGkgKyByZWZlcmVuY2VUZW1wbGF0ZVlba10gLSBvZmZzZXRZOwogICAgICAgIGowID0gaiArIHJlZmVyZW5jZVRlbXBsYXRlWFtrXSAtIG9mZnNldFg7CiAgICAgICAgaWYgKGkwIDwgMCB8fCBpMCA+PSByZWZlcmVuY2VIZWlnaHQgfHwgajAgPCAwIHx8IGowID49IHJlZmVyZW5jZVdpZHRoKSB7CiAgICAgICAgICBjb250ZXh0TGFiZWwgPDw9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRleHRMYWJlbCA9IGNvbnRleHRMYWJlbCA8PCAxIHwgcmVmZXJlbmNlQml0bWFwW2kwXVtqMF07CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHBpeGVsID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBjb250ZXh0TGFiZWwpOwogICAgICByb3dbal0gPSBwaXhlbDsKICAgIH0KICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVTeW1ib2xEaWN0aW9uYXJ5KGh1ZmZtYW4sIHJlZmluZW1lbnQsIHN5bWJvbHMsIG51bWJlck9mTmV3U3ltYm9scywgbnVtYmVyT2ZFeHBvcnRlZFN5bWJvbHMsIGh1ZmZtYW5UYWJsZXMsIHRlbXBsYXRlSW5kZXgsIGF0LCByZWZpbmVtZW50VGVtcGxhdGVJbmRleCwgcmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIGh1ZmZtYW5JbnB1dCkgewogIGlmIChodWZmbWFuICYmIHJlZmluZW1lbnQpIHsKICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJzeW1ib2wgcmVmaW5lbWVudCB3aXRoIEh1ZmZtYW4gaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICBjb25zdCBuZXdTeW1ib2xzID0gW107CiAgbGV0IGN1cnJlbnRIZWlnaHQgPSAwOwogIGxldCBzeW1ib2xDb2RlTGVuZ3RoID0gbG9nMihzeW1ib2xzLmxlbmd0aCArIG51bWJlck9mTmV3U3ltYm9scyk7CiAgY29uc3QgZGVjb2RlciA9IGRlY29kaW5nQ29udGV4dC5kZWNvZGVyOwogIGNvbnN0IGNvbnRleHRDYWNoZSA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGU7CiAgbGV0IHRhYmxlQjEsIHN5bWJvbFdpZHRoczsKICBpZiAoaHVmZm1hbikgewogICAgdGFibGVCMSA9IGdldFN0YW5kYXJkVGFibGUoMSk7CiAgICBzeW1ib2xXaWR0aHMgPSBbXTsKICAgIHN5bWJvbENvZGVMZW5ndGggPSBNYXRoLm1heChzeW1ib2xDb2RlTGVuZ3RoLCAxKTsKICB9CiAgd2hpbGUgKG5ld1N5bWJvbHMubGVuZ3RoIDwgbnVtYmVyT2ZOZXdTeW1ib2xzKSB7CiAgICBjb25zdCBkZWx0YUhlaWdodCA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRGVsdGFIZWlnaHQuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBREgiLCBkZWNvZGVyKTsKICAgIGN1cnJlbnRIZWlnaHQgKz0gZGVsdGFIZWlnaHQ7CiAgICBsZXQgY3VycmVudFdpZHRoID0gMCwKICAgICAgdG90YWxXaWR0aCA9IDA7CiAgICBjb25zdCBmaXJzdFN5bWJvbCA9IGh1ZmZtYW4gPyBzeW1ib2xXaWR0aHMubGVuZ3RoIDogMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IGRlbHRhV2lkdGggPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy50YWJsZURlbHRhV2lkdGguZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFciLCBkZWNvZGVyKTsKICAgICAgaWYgKGRlbHRhV2lkdGggPT09IG51bGwpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjdXJyZW50V2lkdGggKz0gZGVsdGFXaWR0aDsKICAgICAgdG90YWxXaWR0aCArPSBjdXJyZW50V2lkdGg7CiAgICAgIGxldCBiaXRtYXA7CiAgICAgIGlmIChyZWZpbmVtZW50KSB7CiAgICAgICAgY29uc3QgbnVtYmVyT2ZJbnN0YW5jZXMgPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBQUkiLCBkZWNvZGVyKTsKICAgICAgICBpZiAobnVtYmVyT2ZJbnN0YW5jZXMgPiAxKSB7CiAgICAgICAgICBiaXRtYXAgPSBkZWNvZGVUZXh0UmVnaW9uKGh1ZmZtYW4sIHJlZmluZW1lbnQsIGN1cnJlbnRXaWR0aCwgY3VycmVudEhlaWdodCwgMCwgbnVtYmVyT2ZJbnN0YW5jZXMsIDEsIHN5bWJvbHMuY29uY2F0KG5ld1N5bWJvbHMpLCBzeW1ib2xDb2RlTGVuZ3RoLCAwLCAwLCAxLCAwLCBodWZmbWFuVGFibGVzLCByZWZpbmVtZW50VGVtcGxhdGVJbmRleCwgcmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIDAsIGh1ZmZtYW5JbnB1dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHN5bWJvbElkID0gZGVjb2RlSUFJRChjb250ZXh0Q2FjaGUsIGRlY29kZXIsIHN5bWJvbENvZGVMZW5ndGgpOwogICAgICAgICAgY29uc3QgcmR4ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWCIsIGRlY29kZXIpOwogICAgICAgICAgY29uc3QgcmR5ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWSIsIGRlY29kZXIpOwogICAgICAgICAgY29uc3Qgc3ltYm9sID0gc3ltYm9sSWQgPCBzeW1ib2xzLmxlbmd0aCA/IHN5bWJvbHNbc3ltYm9sSWRdIDogbmV3U3ltYm9sc1tzeW1ib2xJZCAtIHN5bWJvbHMubGVuZ3RoXTsKICAgICAgICAgIGJpdG1hcCA9IGRlY29kZVJlZmluZW1lbnQoY3VycmVudFdpZHRoLCBjdXJyZW50SGVpZ2h0LCByZWZpbmVtZW50VGVtcGxhdGVJbmRleCwgc3ltYm9sLCByZHgsIHJkeSwgZmFsc2UsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgbmV3U3ltYm9scy5wdXNoKGJpdG1hcCk7CiAgICAgIH0gZWxzZSBpZiAoaHVmZm1hbikgewogICAgICAgIHN5bWJvbFdpZHRocy5wdXNoKGN1cnJlbnRXaWR0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYml0bWFwID0gZGVjb2RlQml0bWFwKGZhbHNlLCBjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQsIHRlbXBsYXRlSW5kZXgsIGZhbHNlLCBudWxsLCBhdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgICBuZXdTeW1ib2xzLnB1c2goYml0bWFwKTsKICAgICAgfQogICAgfQogICAgaWYgKGh1ZmZtYW4gJiYgIXJlZmluZW1lbnQpIHsKICAgICAgY29uc3QgYml0bWFwU2l6ZSA9IGh1ZmZtYW5UYWJsZXMudGFibGVCaXRtYXBTaXplLmRlY29kZShodWZmbWFuSW5wdXQpOwogICAgICBodWZmbWFuSW5wdXQuYnl0ZUFsaWduKCk7CiAgICAgIGxldCBjb2xsZWN0aXZlQml0bWFwOwogICAgICBpZiAoYml0bWFwU2l6ZSA9PT0gMCkgewogICAgICAgIGNvbGxlY3RpdmVCaXRtYXAgPSByZWFkVW5jb21wcmVzc2VkQml0bWFwKGh1ZmZtYW5JbnB1dCwgdG90YWxXaWR0aCwgY3VycmVudEhlaWdodCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3Qgb3JpZ2luYWxFbmQgPSBodWZmbWFuSW5wdXQuZW5kOwogICAgICAgIGNvbnN0IGJpdG1hcEVuZCA9IGh1ZmZtYW5JbnB1dC5wb3NpdGlvbiArIGJpdG1hcFNpemU7CiAgICAgICAgaHVmZm1hbklucHV0LmVuZCA9IGJpdG1hcEVuZDsKICAgICAgICBjb2xsZWN0aXZlQml0bWFwID0gZGVjb2RlTU1SQml0bWFwKGh1ZmZtYW5JbnB1dCwgdG90YWxXaWR0aCwgY3VycmVudEhlaWdodCwgZmFsc2UpOwogICAgICAgIGh1ZmZtYW5JbnB1dC5lbmQgPSBvcmlnaW5hbEVuZDsKICAgICAgICBodWZmbWFuSW5wdXQucG9zaXRpb24gPSBiaXRtYXBFbmQ7CiAgICAgIH0KICAgICAgY29uc3QgbnVtYmVyT2ZTeW1ib2xzRGVjb2RlZCA9IHN5bWJvbFdpZHRocy5sZW5ndGg7CiAgICAgIGlmIChmaXJzdFN5bWJvbCA9PT0gbnVtYmVyT2ZTeW1ib2xzRGVjb2RlZCAtIDEpIHsKICAgICAgICBuZXdTeW1ib2xzLnB1c2goY29sbGVjdGl2ZUJpdG1hcCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IGksCiAgICAgICAgICB5LAogICAgICAgICAgeE1pbiA9IDAsCiAgICAgICAgICB4TWF4LAogICAgICAgICAgYml0bWFwV2lkdGgsCiAgICAgICAgICBzeW1ib2xCaXRtYXA7CiAgICAgICAgZm9yIChpID0gZmlyc3RTeW1ib2w7IGkgPCBudW1iZXJPZlN5bWJvbHNEZWNvZGVkOyBpKyspIHsKICAgICAgICAgIGJpdG1hcFdpZHRoID0gc3ltYm9sV2lkdGhzW2ldOwogICAgICAgICAgeE1heCA9IHhNaW4gKyBiaXRtYXBXaWR0aDsKICAgICAgICAgIHN5bWJvbEJpdG1hcCA9IFtdOwogICAgICAgICAgZm9yICh5ID0gMDsgeSA8IGN1cnJlbnRIZWlnaHQ7IHkrKykgewogICAgICAgICAgICBzeW1ib2xCaXRtYXAucHVzaChjb2xsZWN0aXZlQml0bWFwW3ldLnN1YmFycmF5KHhNaW4sIHhNYXgpKTsKICAgICAgICAgIH0KICAgICAgICAgIG5ld1N5bWJvbHMucHVzaChzeW1ib2xCaXRtYXApOwogICAgICAgICAgeE1pbiA9IHhNYXg7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGNvbnN0IGV4cG9ydGVkU3ltYm9scyA9IFtdLAogICAgZmxhZ3MgPSBbXTsKICBsZXQgY3VycmVudEZsYWcgPSBmYWxzZSwKICAgIGksCiAgICBpaTsKICBjb25zdCB0b3RhbFN5bWJvbHNMZW5ndGggPSBzeW1ib2xzLmxlbmd0aCArIG51bWJlck9mTmV3U3ltYm9sczsKICB3aGlsZSAoZmxhZ3MubGVuZ3RoIDwgdG90YWxTeW1ib2xzTGVuZ3RoKSB7CiAgICBsZXQgcnVuTGVuZ3RoID0gaHVmZm1hbiA/IHRhYmxlQjEuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRVgiLCBkZWNvZGVyKTsKICAgIHdoaWxlIChydW5MZW5ndGgtLSkgewogICAgICBmbGFncy5wdXNoKGN1cnJlbnRGbGFnKTsKICAgIH0KICAgIGN1cnJlbnRGbGFnID0gIWN1cnJlbnRGbGFnOwogIH0KICBmb3IgKGkgPSAwLCBpaSA9IHN5bWJvbHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgaWYgKGZsYWdzW2ldKSB7CiAgICAgIGV4cG9ydGVkU3ltYm9scy5wdXNoKHN5bWJvbHNbaV0pOwogICAgfQogIH0KICBmb3IgKGxldCBqID0gMDsgaiA8IG51bWJlck9mTmV3U3ltYm9sczsgaSsrLCBqKyspIHsKICAgIGlmIChmbGFnc1tpXSkgewogICAgICBleHBvcnRlZFN5bWJvbHMucHVzaChuZXdTeW1ib2xzW2pdKTsKICAgIH0KICB9CiAgcmV0dXJuIGV4cG9ydGVkU3ltYm9sczsKfQpmdW5jdGlvbiBkZWNvZGVUZXh0UmVnaW9uKGh1ZmZtYW4sIHJlZmluZW1lbnQsIHdpZHRoLCBoZWlnaHQsIGRlZmF1bHRQaXhlbFZhbHVlLCBudW1iZXJPZlN5bWJvbEluc3RhbmNlcywgc3RyaXBTaXplLCBpbnB1dFN5bWJvbHMsIHN5bWJvbENvZGVMZW5ndGgsIHRyYW5zcG9zZWQsIGRzT2Zmc2V0LCByZWZlcmVuY2VDb3JuZXIsIGNvbWJpbmF0aW9uT3BlcmF0b3IsIGh1ZmZtYW5UYWJsZXMsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgbG9nU3RyaXBTaXplLCBodWZmbWFuSW5wdXQpIHsKICBpZiAoaHVmZm1hbiAmJiByZWZpbmVtZW50KSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigicmVmaW5lbWVudCB3aXRoIEh1ZmZtYW4gaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICBjb25zdCBiaXRtYXAgPSBbXTsKICBsZXQgaSwgcm93OwogIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogICAgaWYgKGRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgIHJvdy5maWxsKGRlZmF1bHRQaXhlbFZhbHVlKTsKICAgIH0KICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgfQogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0Q2FjaGUgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlOwogIGxldCBzdHJpcFQgPSBodWZmbWFuID8gLWh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVQuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiAtZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQURUIiwgZGVjb2Rlcik7CiAgbGV0IGZpcnN0UyA9IDA7CiAgaSA9IDA7CiAgd2hpbGUgKGkgPCBudW1iZXJPZlN5bWJvbEluc3RhbmNlcykgewogICAgY29uc3QgZGVsdGFUID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVQuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFQiLCBkZWNvZGVyKTsKICAgIHN0cmlwVCArPSBkZWx0YVQ7CiAgICBjb25zdCBkZWx0YUZpcnN0UyA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRmlyc3RTLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQUZTIiwgZGVjb2Rlcik7CiAgICBmaXJzdFMgKz0gZGVsdGFGaXJzdFM7CiAgICBsZXQgY3VycmVudFMgPSBmaXJzdFM7CiAgICBkbyB7CiAgICAgIGxldCBjdXJyZW50VCA9IDA7CiAgICAgIGlmIChzdHJpcFNpemUgPiAxKSB7CiAgICAgICAgY3VycmVudFQgPSBodWZmbWFuID8gaHVmZm1hbklucHV0LnJlYWRCaXRzKGxvZ1N0cmlwU2l6ZSkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBSVQiLCBkZWNvZGVyKTsKICAgICAgfQogICAgICBjb25zdCB0ID0gc3RyaXBTaXplICogc3RyaXBUICsgY3VycmVudFQ7CiAgICAgIGNvbnN0IHN5bWJvbElkID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMuc3ltYm9sSURUYWJsZS5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUlBSUQoY29udGV4dENhY2hlLCBkZWNvZGVyLCBzeW1ib2xDb2RlTGVuZ3RoKTsKICAgICAgY29uc3QgYXBwbHlSZWZpbmVtZW50ID0gcmVmaW5lbWVudCAmJiAoaHVmZm1hbiA/IGh1ZmZtYW5JbnB1dC5yZWFkQml0KCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkkiLCBkZWNvZGVyKSk7CiAgICAgIGxldCBzeW1ib2xCaXRtYXAgPSBpbnB1dFN5bWJvbHNbc3ltYm9sSWRdOwogICAgICBsZXQgc3ltYm9sV2lkdGggPSBzeW1ib2xCaXRtYXBbMF0ubGVuZ3RoOwogICAgICBsZXQgc3ltYm9sSGVpZ2h0ID0gc3ltYm9sQml0bWFwLmxlbmd0aDsKICAgICAgaWYgKGFwcGx5UmVmaW5lbWVudCkgewogICAgICAgIGNvbnN0IHJkdyA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFciLCBkZWNvZGVyKTsKICAgICAgICBjb25zdCByZGggPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkRIIiwgZGVjb2Rlcik7CiAgICAgICAgY29uc3QgcmR4ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWCIsIGRlY29kZXIpOwogICAgICAgIGNvbnN0IHJkeSA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFkiLCBkZWNvZGVyKTsKICAgICAgICBzeW1ib2xXaWR0aCArPSByZHc7CiAgICAgICAgc3ltYm9sSGVpZ2h0ICs9IHJkaDsKICAgICAgICBzeW1ib2xCaXRtYXAgPSBkZWNvZGVSZWZpbmVtZW50KHN5bWJvbFdpZHRoLCBzeW1ib2xIZWlnaHQsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCBzeW1ib2xCaXRtYXAsIChyZHcgPj4gMSkgKyByZHgsIChyZGggPj4gMSkgKyByZHksIGZhbHNlLCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCk7CiAgICAgIH0KICAgICAgbGV0IGluY3JlbWVudCA9IDA7CiAgICAgIGlmICghdHJhbnNwb3NlZCkgewogICAgICAgIGlmIChyZWZlcmVuY2VDb3JuZXIgPiAxKSB7CiAgICAgICAgICBjdXJyZW50UyArPSBzeW1ib2xXaWR0aCAtIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluY3JlbWVudCA9IHN5bWJvbFdpZHRoIC0gMTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoIShyZWZlcmVuY2VDb3JuZXIgJiAxKSkgewogICAgICAgIGN1cnJlbnRTICs9IHN5bWJvbEhlaWdodCAtIDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW5jcmVtZW50ID0gc3ltYm9sSGVpZ2h0IC0gMTsKICAgICAgfQogICAgICBjb25zdCBvZmZzZXRUID0gdCAtIChyZWZlcmVuY2VDb3JuZXIgJiAxID8gMCA6IHN5bWJvbEhlaWdodCAtIDEpOwogICAgICBjb25zdCBvZmZzZXRTID0gY3VycmVudFMgLSAocmVmZXJlbmNlQ29ybmVyICYgMiA/IHN5bWJvbFdpZHRoIC0gMSA6IDApOwogICAgICBsZXQgczIsIHQyLCBzeW1ib2xSb3c7CiAgICAgIGlmICh0cmFuc3Bvc2VkKSB7CiAgICAgICAgZm9yIChzMiA9IDA7IHMyIDwgc3ltYm9sSGVpZ2h0OyBzMisrKSB7CiAgICAgICAgICByb3cgPSBiaXRtYXBbb2Zmc2V0UyArIHMyXTsKICAgICAgICAgIGlmICghcm93KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc3ltYm9sUm93ID0gc3ltYm9sQml0bWFwW3MyXTsKICAgICAgICAgIGNvbnN0IG1heFdpZHRoID0gTWF0aC5taW4od2lkdGggLSBvZmZzZXRULCBzeW1ib2xXaWR0aCk7CiAgICAgICAgICBzd2l0Y2ggKGNvbWJpbmF0aW9uT3BlcmF0b3IpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZvciAodDIgPSAwOyB0MiA8IG1heFdpZHRoOyB0MisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0VCArIHQyXSB8PSBzeW1ib2xSb3dbdDJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGZvciAodDIgPSAwOyB0MiA8IG1heFdpZHRoOyB0MisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0VCArIHQyXSBePSBzeW1ib2xSb3dbdDJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgJHtjb21iaW5hdGlvbk9wZXJhdG9yfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodDIgPSAwOyB0MiA8IHN5bWJvbEhlaWdodDsgdDIrKykgewogICAgICAgICAgcm93ID0gYml0bWFwW29mZnNldFQgKyB0Ml07CiAgICAgICAgICBpZiAoIXJvdykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHN5bWJvbFJvdyA9IHN5bWJvbEJpdG1hcFt0Ml07CiAgICAgICAgICBzd2l0Y2ggKGNvbWJpbmF0aW9uT3BlcmF0b3IpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZvciAoczIgPSAwOyBzMiA8IHN5bWJvbFdpZHRoOyBzMisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0UyArIHMyXSB8PSBzeW1ib2xSb3dbczJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGZvciAoczIgPSAwOyBzMiA8IHN5bWJvbFdpZHRoOyBzMisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0UyArIHMyXSBePSBzeW1ib2xSb3dbczJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgJHtjb21iaW5hdGlvbk9wZXJhdG9yfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGkrKzsKICAgICAgY29uc3QgZGVsdGFTID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVMuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFMiLCBkZWNvZGVyKTsKICAgICAgaWYgKGRlbHRhUyA9PT0gbnVsbCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGN1cnJlbnRTICs9IGluY3JlbWVudCArIGRlbHRhUyArIGRzT2Zmc2V0OwogICAgfSB3aGlsZSAodHJ1ZSk7CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KZnVuY3Rpb24gZGVjb2RlUGF0dGVybkRpY3Rpb25hcnkobW1yLCBwYXR0ZXJuV2lkdGgsIHBhdHRlcm5IZWlnaHQsIG1heFBhdHRlcm5JbmRleCwgdGVtcGxhdGUsIGRlY29kaW5nQ29udGV4dCkgewogIGNvbnN0IGF0ID0gW107CiAgaWYgKCFtbXIpIHsKICAgIGF0LnB1c2goewogICAgICB4OiAtcGF0dGVybldpZHRoLAogICAgICB5OiAwCiAgICB9KTsKICAgIGlmICh0ZW1wbGF0ZSA9PT0gMCkgewogICAgICBhdC5wdXNoKHsKICAgICAgICB4OiAtMywKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogMiwKICAgICAgICB5OiAtMgogICAgICB9LCB7CiAgICAgICAgeDogLTIsCiAgICAgICAgeTogLTIKICAgICAgfSk7CiAgICB9CiAgfQogIGNvbnN0IGNvbGxlY3RpdmVXaWR0aCA9IChtYXhQYXR0ZXJuSW5kZXggKyAxKSAqIHBhdHRlcm5XaWR0aDsKICBjb25zdCBjb2xsZWN0aXZlQml0bWFwID0gZGVjb2RlQml0bWFwKG1tciwgY29sbGVjdGl2ZVdpZHRoLCBwYXR0ZXJuSGVpZ2h0LCB0ZW1wbGF0ZSwgZmFsc2UsIG51bGwsIGF0LCBkZWNvZGluZ0NvbnRleHQpOwogIGNvbnN0IHBhdHRlcm5zID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbWF4UGF0dGVybkluZGV4OyBpKyspIHsKICAgIGNvbnN0IHBhdHRlcm5CaXRtYXAgPSBbXTsKICAgIGNvbnN0IHhNaW4gPSBwYXR0ZXJuV2lkdGggKiBpOwogICAgY29uc3QgeE1heCA9IHhNaW4gKyBwYXR0ZXJuV2lkdGg7CiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHBhdHRlcm5IZWlnaHQ7IHkrKykgewogICAgICBwYXR0ZXJuQml0bWFwLnB1c2goY29sbGVjdGl2ZUJpdG1hcFt5XS5zdWJhcnJheSh4TWluLCB4TWF4KSk7CiAgICB9CiAgICBwYXR0ZXJucy5wdXNoKHBhdHRlcm5CaXRtYXApOwogIH0KICByZXR1cm4gcGF0dGVybnM7Cn0KZnVuY3Rpb24gZGVjb2RlSGFsZnRvbmVSZWdpb24obW1yLCBwYXR0ZXJucywgdGVtcGxhdGUsIHJlZ2lvbldpZHRoLCByZWdpb25IZWlnaHQsIGRlZmF1bHRQaXhlbFZhbHVlLCBlbmFibGVTa2lwLCBjb21iaW5hdGlvbk9wZXJhdG9yLCBncmlkV2lkdGgsIGdyaWRIZWlnaHQsIGdyaWRPZmZzZXRYLCBncmlkT2Zmc2V0WSwgZ3JpZFZlY3RvclgsIGdyaWRWZWN0b3JZLCBkZWNvZGluZ0NvbnRleHQpIHsKICBjb25zdCBza2lwID0gbnVsbDsKICBpZiAoZW5hYmxlU2tpcCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInNraXAgaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICBpZiAoY29tYmluYXRpb25PcGVyYXRvciAhPT0gMCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoYG9wZXJhdG9yICIke2NvbWJpbmF0aW9uT3BlcmF0b3J9IiBpcyBub3Qgc3VwcG9ydGVkIGluIGhhbGZ0b25lIHJlZ2lvbmApOwogIH0KICBjb25zdCByZWdpb25CaXRtYXAgPSBbXTsKICBsZXQgaSwgaiwgcm93OwogIGZvciAoaSA9IDA7IGkgPCByZWdpb25IZWlnaHQ7IGkrKykgewogICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkocmVnaW9uV2lkdGgpOwogICAgaWYgKGRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgIHJvdy5maWxsKGRlZmF1bHRQaXhlbFZhbHVlKTsKICAgIH0KICAgIHJlZ2lvbkJpdG1hcC5wdXNoKHJvdyk7CiAgfQogIGNvbnN0IG51bWJlck9mUGF0dGVybnMgPSBwYXR0ZXJucy5sZW5ndGg7CiAgY29uc3QgcGF0dGVybjAgPSBwYXR0ZXJuc1swXTsKICBjb25zdCBwYXR0ZXJuV2lkdGggPSBwYXR0ZXJuMFswXS5sZW5ndGgsCiAgICBwYXR0ZXJuSGVpZ2h0ID0gcGF0dGVybjAubGVuZ3RoOwogIGNvbnN0IGJpdHNQZXJWYWx1ZSA9IGxvZzIobnVtYmVyT2ZQYXR0ZXJucyk7CiAgY29uc3QgYXQgPSBbXTsKICBpZiAoIW1tcikgewogICAgYXQucHVzaCh7CiAgICAgIHg6IHRlbXBsYXRlIDw9IDEgPyAzIDogMiwKICAgICAgeTogLTEKICAgIH0pOwogICAgaWYgKHRlbXBsYXRlID09PSAwKSB7CiAgICAgIGF0LnB1c2goewogICAgICAgIHg6IC0zLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAyLAogICAgICAgIHk6IC0yCiAgICAgIH0sIHsKICAgICAgICB4OiAtMiwKICAgICAgICB5OiAtMgogICAgICB9KTsKICAgIH0KICB9CiAgY29uc3QgZ3JheVNjYWxlQml0UGxhbmVzID0gW107CiAgbGV0IG1tcklucHV0LCBiaXRtYXA7CiAgaWYgKG1tcikgewogICAgbW1ySW5wdXQgPSBuZXcgUmVhZGVyKGRlY29kaW5nQ29udGV4dC5kYXRhLCBkZWNvZGluZ0NvbnRleHQuc3RhcnQsIGRlY29kaW5nQ29udGV4dC5lbmQpOwogIH0KICBmb3IgKGkgPSBiaXRzUGVyVmFsdWUgLSAxOyBpID49IDA7IGktLSkgewogICAgaWYgKG1tcikgewogICAgICBiaXRtYXAgPSBkZWNvZGVNTVJCaXRtYXAobW1ySW5wdXQsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgdHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICBiaXRtYXAgPSBkZWNvZGVCaXRtYXAoZmFsc2UsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgdGVtcGxhdGUsIGZhbHNlLCBza2lwLCBhdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgIH0KICAgIGdyYXlTY2FsZUJpdFBsYW5lc1tpXSA9IGJpdG1hcDsKICB9CiAgbGV0IG1nLCBuZywgYml0LCBwYXR0ZXJuSW5kZXgsIHBhdHRlcm5CaXRtYXAsIHgsIHksIHBhdHRlcm5Sb3csIHJlZ2lvblJvdzsKICBmb3IgKG1nID0gMDsgbWcgPCBncmlkSGVpZ2h0OyBtZysrKSB7CiAgICBmb3IgKG5nID0gMDsgbmcgPCBncmlkV2lkdGg7IG5nKyspIHsKICAgICAgYml0ID0gMDsKICAgICAgcGF0dGVybkluZGV4ID0gMDsKICAgICAgZm9yIChqID0gYml0c1BlclZhbHVlIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICBiaXQgXj0gZ3JheVNjYWxlQml0UGxhbmVzW2pdW21nXVtuZ107CiAgICAgICAgcGF0dGVybkluZGV4IHw9IGJpdCA8PCBqOwogICAgICB9CiAgICAgIHBhdHRlcm5CaXRtYXAgPSBwYXR0ZXJuc1twYXR0ZXJuSW5kZXhdOwogICAgICB4ID0gZ3JpZE9mZnNldFggKyBtZyAqIGdyaWRWZWN0b3JZICsgbmcgKiBncmlkVmVjdG9yWCA+PiA4OwogICAgICB5ID0gZ3JpZE9mZnNldFkgKyBtZyAqIGdyaWRWZWN0b3JYIC0gbmcgKiBncmlkVmVjdG9yWSA+PiA4OwogICAgICBpZiAoeCA+PSAwICYmIHggKyBwYXR0ZXJuV2lkdGggPD0gcmVnaW9uV2lkdGggJiYgeSA+PSAwICYmIHkgKyBwYXR0ZXJuSGVpZ2h0IDw9IHJlZ2lvbkhlaWdodCkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJuSGVpZ2h0OyBpKyspIHsKICAgICAgICAgIHJlZ2lvblJvdyA9IHJlZ2lvbkJpdG1hcFt5ICsgaV07CiAgICAgICAgICBwYXR0ZXJuUm93ID0gcGF0dGVybkJpdG1hcFtpXTsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBwYXR0ZXJuV2lkdGg7IGorKykgewogICAgICAgICAgICByZWdpb25Sb3dbeCArIGpdIHw9IHBhdHRlcm5Sb3dbal07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGxldCByZWdpb25YLCByZWdpb25ZOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJuSGVpZ2h0OyBpKyspIHsKICAgICAgICAgIHJlZ2lvblkgPSB5ICsgaTsKICAgICAgICAgIGlmIChyZWdpb25ZIDwgMCB8fCByZWdpb25ZID49IHJlZ2lvbkhlaWdodCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJlZ2lvblJvdyA9IHJlZ2lvbkJpdG1hcFtyZWdpb25ZXTsKICAgICAgICAgIHBhdHRlcm5Sb3cgPSBwYXR0ZXJuQml0bWFwW2ldOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHBhdHRlcm5XaWR0aDsgaisrKSB7CiAgICAgICAgICAgIHJlZ2lvblggPSB4ICsgajsKICAgICAgICAgICAgaWYgKHJlZ2lvblggPj0gMCAmJiByZWdpb25YIDwgcmVnaW9uV2lkdGgpIHsKICAgICAgICAgICAgICByZWdpb25Sb3dbcmVnaW9uWF0gfD0gcGF0dGVyblJvd1tqXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICByZXR1cm4gcmVnaW9uQml0bWFwOwp9CmZ1bmN0aW9uIHJlYWRTZWdtZW50SGVhZGVyKGRhdGEsIHN0YXJ0KSB7CiAgY29uc3Qgc2VnbWVudEhlYWRlciA9IHt9OwogIHNlZ21lbnRIZWFkZXIubnVtYmVyID0gcmVhZFVpbnQzMihkYXRhLCBzdGFydCk7CiAgY29uc3QgZmxhZ3MgPSBkYXRhW3N0YXJ0ICsgNF07CiAgY29uc3Qgc2VnbWVudFR5cGUgPSBmbGFncyAmIDB4M2Y7CiAgaWYgKCFTZWdtZW50VHlwZXNbc2VnbWVudFR5cGVdKSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBzZWdtZW50IHR5cGU6ICIgKyBzZWdtZW50VHlwZSk7CiAgfQogIHNlZ21lbnRIZWFkZXIudHlwZSA9IHNlZ21lbnRUeXBlOwogIHNlZ21lbnRIZWFkZXIudHlwZU5hbWUgPSBTZWdtZW50VHlwZXNbc2VnbWVudFR5cGVdOwogIHNlZ21lbnRIZWFkZXIuZGVmZXJyZWROb25SZXRhaW4gPSAhIShmbGFncyAmIDB4ODApOwogIGNvbnN0IHBhZ2VBc3NvY2lhdGlvbkZpZWxkU2l6ZSA9ICEhKGZsYWdzICYgMHg0MCk7CiAgY29uc3QgcmVmZXJyZWRGbGFncyA9IGRhdGFbc3RhcnQgKyA1XTsKICBsZXQgcmVmZXJyZWRUb0NvdW50ID0gcmVmZXJyZWRGbGFncyA+PiA1ICYgNzsKICBjb25zdCByZXRhaW5CaXRzID0gW3JlZmVycmVkRmxhZ3MgJiAzMV07CiAgbGV0IHBvc2l0aW9uID0gc3RhcnQgKyA2OwogIGlmIChyZWZlcnJlZEZsYWdzID09PSA3KSB7CiAgICByZWZlcnJlZFRvQ291bnQgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uIC0gMSkgJiAweDFmZmZmZmZmOwogICAgcG9zaXRpb24gKz0gMzsKICAgIGxldCBieXRlcyA9IHJlZmVycmVkVG9Db3VudCArIDcgPj4gMzsKICAgIHJldGFpbkJpdHNbMF0gPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgd2hpbGUgKC0tYnl0ZXMgPiAwKSB7CiAgICAgIHJldGFpbkJpdHMucHVzaChkYXRhW3Bvc2l0aW9uKytdKTsKICAgIH0KICB9IGVsc2UgaWYgKHJlZmVycmVkRmxhZ3MgPT09IDUgfHwgcmVmZXJyZWRGbGFncyA9PT0gNikgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgcmVmZXJyZWQtdG8gZmxhZ3MiKTsKICB9CiAgc2VnbWVudEhlYWRlci5yZXRhaW5CaXRzID0gcmV0YWluQml0czsKICBsZXQgcmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID0gNDsKICBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gMjU2KSB7CiAgICByZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPSAxOwogIH0gZWxzZSBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gNjU1MzYpIHsKICAgIHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9IDI7CiAgfQogIGNvbnN0IHJlZmVycmVkVG8gPSBbXTsKICBsZXQgaSwgaWk7CiAgZm9yIChpID0gMDsgaSA8IHJlZmVycmVkVG9Db3VudDsgaSsrKSB7CiAgICBsZXQgbnVtYmVyOwogICAgaWYgKHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9PT0gMSkgewogICAgICBudW1iZXIgPSBkYXRhW3Bvc2l0aW9uXTsKICAgIH0gZWxzZSBpZiAocmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID09PSAyKSB7CiAgICAgIG51bWJlciA9IHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24pOwogICAgfSBlbHNlIHsKICAgICAgbnVtYmVyID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbik7CiAgICB9CiAgICByZWZlcnJlZFRvLnB1c2gobnVtYmVyKTsKICAgIHBvc2l0aW9uICs9IHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZTsKICB9CiAgc2VnbWVudEhlYWRlci5yZWZlcnJlZFRvID0gcmVmZXJyZWRUbzsKICBpZiAoIXBhZ2VBc3NvY2lhdGlvbkZpZWxkU2l6ZSkgewogICAgc2VnbWVudEhlYWRlci5wYWdlQXNzb2NpYXRpb24gPSBkYXRhW3Bvc2l0aW9uKytdOwogIH0gZWxzZSB7CiAgICBzZWdtZW50SGVhZGVyLnBhZ2VBc3NvY2lhdGlvbiA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgcG9zaXRpb24gKz0gNDsKICB9CiAgc2VnbWVudEhlYWRlci5sZW5ndGggPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICBwb3NpdGlvbiArPSA0OwogIGlmIChzZWdtZW50SGVhZGVyLmxlbmd0aCA9PT0gMHhmZmZmZmZmZikgewogICAgaWYgKHNlZ21lbnRUeXBlID09PSAzOCkgewogICAgICBjb25zdCBnZW5lcmljUmVnaW9uSW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBjb25zdCBnZW5lcmljUmVnaW9uU2VnbWVudEZsYWdzID0gZGF0YVtwb3NpdGlvbiArIFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoXTsKICAgICAgY29uc3QgZ2VuZXJpY1JlZ2lvbk1tciA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgY29uc3Qgc2VhcmNoUGF0dGVybkxlbmd0aCA9IDY7CiAgICAgIGNvbnN0IHNlYXJjaFBhdHRlcm4gPSBuZXcgVWludDhBcnJheShzZWFyY2hQYXR0ZXJuTGVuZ3RoKTsKICAgICAgaWYgKCFnZW5lcmljUmVnaW9uTW1yKSB7CiAgICAgICAgc2VhcmNoUGF0dGVyblswXSA9IDB4ZmY7CiAgICAgICAgc2VhcmNoUGF0dGVyblsxXSA9IDB4YWM7CiAgICAgIH0KICAgICAgc2VhcmNoUGF0dGVyblsyXSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCA+Pj4gMjQgJiAweGZmOwogICAgICBzZWFyY2hQYXR0ZXJuWzNdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ID4+IDE2ICYgMHhmZjsKICAgICAgc2VhcmNoUGF0dGVybls0XSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCA+PiA4ICYgMHhmZjsKICAgICAgc2VhcmNoUGF0dGVybls1XSA9IGdlbmVyaWNSZWdpb25JbmZvLmhlaWdodCAmIDB4ZmY7CiAgICAgIGZvciAoaSA9IHBvc2l0aW9uLCBpaSA9IGRhdGEubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGxldCBqID0gMDsKICAgICAgICB3aGlsZSAoaiA8IHNlYXJjaFBhdHRlcm5MZW5ndGggJiYgc2VhcmNoUGF0dGVybltqXSA9PT0gZGF0YVtpICsgal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgaWYgKGogPT09IHNlYXJjaFBhdHRlcm5MZW5ndGgpIHsKICAgICAgICAgIHNlZ21lbnRIZWFkZXIubGVuZ3RoID0gaSArIHNlYXJjaFBhdHRlcm5MZW5ndGg7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHNlZ21lbnRIZWFkZXIubGVuZ3RoID09PSAweGZmZmZmZmZmKSB7CiAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInNlZ21lbnQgZW5kIHdhcyBub3QgZm91bmQiKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgdW5rbm93biBzZWdtZW50IGxlbmd0aCIpOwogICAgfQogIH0KICBzZWdtZW50SGVhZGVyLmhlYWRlckVuZCA9IHBvc2l0aW9uOwogIHJldHVybiBzZWdtZW50SGVhZGVyOwp9CmZ1bmN0aW9uIHJlYWRTZWdtZW50cyhoZWFkZXIsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICBjb25zdCBzZWdtZW50cyA9IFtdOwogIGxldCBwb3NpdGlvbiA9IHN0YXJ0OwogIHdoaWxlIChwb3NpdGlvbiA8IGVuZCkgewogICAgY29uc3Qgc2VnbWVudEhlYWRlciA9IHJlYWRTZWdtZW50SGVhZGVyKGRhdGEsIHBvc2l0aW9uKTsKICAgIHBvc2l0aW9uID0gc2VnbWVudEhlYWRlci5oZWFkZXJFbmQ7CiAgICBjb25zdCBzZWdtZW50ID0gewogICAgICBoZWFkZXI6IHNlZ21lbnRIZWFkZXIsCiAgICAgIGRhdGEKICAgIH07CiAgICBpZiAoIWhlYWRlci5yYW5kb21BY2Nlc3MpIHsKICAgICAgc2VnbWVudC5zdGFydCA9IHBvc2l0aW9uOwogICAgICBwb3NpdGlvbiArPSBzZWdtZW50SGVhZGVyLmxlbmd0aDsKICAgICAgc2VnbWVudC5lbmQgPSBwb3NpdGlvbjsKICAgIH0KICAgIHNlZ21lbnRzLnB1c2goc2VnbWVudCk7CiAgICBpZiAoc2VnbWVudEhlYWRlci50eXBlID09PSA1MSkgewogICAgICBicmVhazsKICAgIH0KICB9CiAgaWYgKGhlYWRlci5yYW5kb21BY2Nlc3MpIHsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHNlZ21lbnRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgc2VnbWVudHNbaV0uc3RhcnQgPSBwb3NpdGlvbjsKICAgICAgcG9zaXRpb24gKz0gc2VnbWVudHNbaV0uaGVhZGVyLmxlbmd0aDsKICAgICAgc2VnbWVudHNbaV0uZW5kID0gcG9zaXRpb247CiAgICB9CiAgfQogIHJldHVybiBzZWdtZW50czsKfQpmdW5jdGlvbiByZWFkUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uKGRhdGEsIHN0YXJ0KSB7CiAgcmV0dXJuIHsKICAgIHdpZHRoOiByZWFkVWludDMyKGRhdGEsIHN0YXJ0KSwKICAgIGhlaWdodDogcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDQpLAogICAgeDogcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDgpLAogICAgeTogcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDEyKSwKICAgIGNvbWJpbmF0aW9uT3BlcmF0b3I6IGRhdGFbc3RhcnQgKyAxNl0gJiA3CiAgfTsKfQpjb25zdCBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aCA9IDE3OwpmdW5jdGlvbiBwcm9jZXNzU2VnbWVudChzZWdtZW50LCB2aXNpdG9yKSB7CiAgY29uc3QgaGVhZGVyID0gc2VnbWVudC5oZWFkZXI7CiAgY29uc3QgZGF0YSA9IHNlZ21lbnQuZGF0YSwKICAgIGVuZCA9IHNlZ21lbnQuZW5kOwogIGxldCBwb3NpdGlvbiA9IHNlZ21lbnQuc3RhcnQ7CiAgbGV0IGFyZ3MsIGF0LCBpLCBhdExlbmd0aDsKICBzd2l0Y2ggKGhlYWRlci50eXBlKSB7CiAgICBjYXNlIDA6CiAgICAgIGNvbnN0IGRpY3Rpb25hcnkgPSB7fTsKICAgICAgY29uc3QgZGljdGlvbmFyeUZsYWdzID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgIGRpY3Rpb25hcnkuaHVmZm1hbiA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDEpOwogICAgICBkaWN0aW9uYXJ5LnJlZmluZW1lbnQgPSAhIShkaWN0aW9uYXJ5RmxhZ3MgJiAyKTsKICAgICAgZGljdGlvbmFyeS5odWZmbWFuREhTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiAyICYgMzsKICAgICAgZGljdGlvbmFyeS5odWZmbWFuRFdTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA0ICYgMzsKICAgICAgZGljdGlvbmFyeS5iaXRtYXBTaXplU2VsZWN0b3IgPSBkaWN0aW9uYXJ5RmxhZ3MgPj4gNiAmIDE7CiAgICAgIGRpY3Rpb25hcnkuYWdncmVnYXRpb25JbnN0YW5jZXNTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA3ICYgMTsKICAgICAgZGljdGlvbmFyeS5iaXRtYXBDb2RpbmdDb250ZXh0VXNlZCA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDI1Nik7CiAgICAgIGRpY3Rpb25hcnkuYml0bWFwQ29kaW5nQ29udGV4dFJldGFpbmVkID0gISEoZGljdGlvbmFyeUZsYWdzICYgNTEyKTsKICAgICAgZGljdGlvbmFyeS50ZW1wbGF0ZSA9IGRpY3Rpb25hcnlGbGFncyA+PiAxMCAmIDM7CiAgICAgIGRpY3Rpb25hcnkucmVmaW5lbWVudFRlbXBsYXRlID0gZGljdGlvbmFyeUZsYWdzID4+IDEyICYgMTsKICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgaWYgKCFkaWN0aW9uYXJ5Lmh1ZmZtYW4pIHsKICAgICAgICBhdExlbmd0aCA9IGRpY3Rpb25hcnkudGVtcGxhdGUgPT09IDAgPyA0IDogMTsKICAgICAgICBhdCA9IFtdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhdExlbmd0aDsgaSsrKSB7CiAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgeDogcmVhZEludDgoZGF0YSwgcG9zaXRpb24pLAogICAgICAgICAgICB5OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiArIDEpCiAgICAgICAgICB9KTsKICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgfQogICAgICAgIGRpY3Rpb25hcnkuYXQgPSBhdDsKICAgICAgfQogICAgICBpZiAoZGljdGlvbmFyeS5yZWZpbmVtZW50ICYmICFkaWN0aW9uYXJ5LnJlZmluZW1lbnRUZW1wbGF0ZSkgewogICAgICAgIGF0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgIHg6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uKSwKICAgICAgICAgICAgeTogcmVhZEludDgoZGF0YSwgcG9zaXRpb24gKyAxKQogICAgICAgICAgfSk7CiAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIH0KICAgICAgICBkaWN0aW9uYXJ5LnJlZmluZW1lbnRBdCA9IGF0OwogICAgICB9CiAgICAgIGRpY3Rpb25hcnkubnVtYmVyT2ZFeHBvcnRlZFN5bWJvbHMgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgZGljdGlvbmFyeS5udW1iZXJPZk5ld1N5bWJvbHMgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgYXJncyA9IFtkaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBoZWFkZXIucmVmZXJyZWRUbywgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSA2OgogICAgY2FzZSA3OgogICAgICBjb25zdCB0ZXh0UmVnaW9uID0ge307CiAgICAgIHRleHRSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgY29uc3QgdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA9IHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSAyOwogICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW4gPSAhISh0ZXh0UmVnaW9uU2VnbWVudEZsYWdzICYgMSk7CiAgICAgIHRleHRSZWdpb24ucmVmaW5lbWVudCA9ICEhKHRleHRSZWdpb25TZWdtZW50RmxhZ3MgJiAyKTsKICAgICAgdGV4dFJlZ2lvbi5sb2dTdHJpcFNpemUgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDIgJiAzOwogICAgICB0ZXh0UmVnaW9uLnN0cmlwU2l6ZSA9IDEgPDwgdGV4dFJlZ2lvbi5sb2dTdHJpcFNpemU7CiAgICAgIHRleHRSZWdpb24ucmVmZXJlbmNlQ29ybmVyID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiA0ICYgMzsKICAgICAgdGV4dFJlZ2lvbi50cmFuc3Bvc2VkID0gISEodGV4dFJlZ2lvblNlZ21lbnRGbGFncyAmIDY0KTsKICAgICAgdGV4dFJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiA3ICYgMzsKICAgICAgdGV4dFJlZ2lvbi5kZWZhdWx0UGl4ZWxWYWx1ZSA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPj4gOSAmIDE7CiAgICAgIHRleHRSZWdpb24uZHNPZmZzZXQgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzIDw8IDE3ID4+IDI3OwogICAgICB0ZXh0UmVnaW9uLnJlZmluZW1lbnRUZW1wbGF0ZSA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPj4gMTUgJiAxOwogICAgICBpZiAodGV4dFJlZ2lvbi5odWZmbWFuKSB7CiAgICAgICAgY29uc3QgdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA9IHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24pOwogICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuRlMgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5EUyA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gMiAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuRFQgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDQgJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hblJlZmluZW1lbnREVyA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gNiAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuUmVmaW5lbWVudERIID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiA4ICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50RFggPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDEwICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50RFkgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDEyICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50U2l6ZVNlbGVjdG9yID0gISEodGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyAmIDB4NDAwMCk7CiAgICAgIH0KICAgICAgaWYgKHRleHRSZWdpb24ucmVmaW5lbWVudCAmJiAhdGV4dFJlZ2lvbi5yZWZpbmVtZW50VGVtcGxhdGUpIHsKICAgICAgICBhdCA9IFtdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgIHk6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgIH0pOwogICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICB9CiAgICAgICAgdGV4dFJlZ2lvbi5yZWZpbmVtZW50QXQgPSBhdDsKICAgICAgfQogICAgICB0ZXh0UmVnaW9uLm51bWJlck9mU3ltYm9sSW5zdGFuY2VzID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgIGFyZ3MgPSBbdGV4dFJlZ2lvbiwgaGVhZGVyLnJlZmVycmVkVG8sIGRhdGEsIHBvc2l0aW9uLCBlbmRdOwogICAgICBicmVhazsKICAgIGNhc2UgMTY6CiAgICAgIGNvbnN0IHBhdHRlcm5EaWN0aW9uYXJ5ID0ge307CiAgICAgIGNvbnN0IHBhdHRlcm5EaWN0aW9uYXJ5RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICBwYXR0ZXJuRGljdGlvbmFyeS5tbXIgPSAhIShwYXR0ZXJuRGljdGlvbmFyeUZsYWdzICYgMSk7CiAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5LnRlbXBsYXRlID0gcGF0dGVybkRpY3Rpb25hcnlGbGFncyA+PiAxICYgMzsKICAgICAgcGF0dGVybkRpY3Rpb25hcnkucGF0dGVybldpZHRoID0gZGF0YVtwb3NpdGlvbisrXTsKICAgICAgcGF0dGVybkRpY3Rpb25hcnkucGF0dGVybkhlaWdodCA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5Lm1heFBhdHRlcm5JbmRleCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBhcmdzID0gW3BhdHRlcm5EaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDIyOgogICAgY2FzZSAyMzoKICAgICAgY29uc3QgaGFsZnRvbmVSZWdpb24gPSB7fTsKICAgICAgaGFsZnRvbmVSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgY29uc3QgaGFsZnRvbmVSZWdpb25GbGFncyA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIGhhbGZ0b25lUmVnaW9uLm1tciA9ICEhKGhhbGZ0b25lUmVnaW9uRmxhZ3MgJiAxKTsKICAgICAgaGFsZnRvbmVSZWdpb24udGVtcGxhdGUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDEgJiAzOwogICAgICBoYWxmdG9uZVJlZ2lvbi5lbmFibGVTa2lwID0gISEoaGFsZnRvbmVSZWdpb25GbGFncyAmIDgpOwogICAgICBoYWxmdG9uZVJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yID0gaGFsZnRvbmVSZWdpb25GbGFncyA+PiA0ICYgNzsKICAgICAgaGFsZnRvbmVSZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDcgJiAxOwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkV2lkdGggPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZEhlaWdodCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkT2Zmc2V0WCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pICYgMHhmZmZmZmZmZjsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZE9mZnNldFkgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKSAmIDB4ZmZmZmZmZmY7CiAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmdyaWRWZWN0b3JYID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmdyaWRWZWN0b3JZID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgIGFyZ3MgPSBbaGFsZnRvbmVSZWdpb24sIGhlYWRlci5yZWZlcnJlZFRvLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM4OgogICAgY2FzZSAzOToKICAgICAgY29uc3QgZ2VuZXJpY1JlZ2lvbiA9IHt9OwogICAgICBnZW5lcmljUmVnaW9uLmluZm8gPSByZWFkUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uRmllbGRMZW5ndGg7CiAgICAgIGNvbnN0IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICBnZW5lcmljUmVnaW9uLm1tciA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgZ2VuZXJpY1JlZ2lvbi50ZW1wbGF0ZSA9IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPj4gMSAmIDM7CiAgICAgIGdlbmVyaWNSZWdpb24ucHJlZGljdGlvbiA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiA4KTsKICAgICAgaWYgKCFnZW5lcmljUmVnaW9uLm1tcikgewogICAgICAgIGF0TGVuZ3RoID0gZ2VuZXJpY1JlZ2lvbi50ZW1wbGF0ZSA9PT0gMCA/IDQgOiAxOwogICAgICAgIGF0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGF0TGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgIHk6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgIH0pOwogICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICB9CiAgICAgICAgZ2VuZXJpY1JlZ2lvbi5hdCA9IGF0OwogICAgICB9CiAgICAgIGFyZ3MgPSBbZ2VuZXJpY1JlZ2lvbiwgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSA0ODoKICAgICAgY29uc3QgcGFnZUluZm8gPSB7CiAgICAgICAgd2lkdGg6IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pLAogICAgICAgIGhlaWdodDogcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbiArIDQpLAogICAgICAgIHJlc29sdXRpb25YOiByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uICsgOCksCiAgICAgICAgcmVzb2x1dGlvblk6IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24gKyAxMikKICAgICAgfTsKICAgICAgaWYgKHBhZ2VJbmZvLmhlaWdodCA9PT0gMHhmZmZmZmZmZikgewogICAgICAgIGRlbGV0ZSBwYWdlSW5mby5oZWlnaHQ7CiAgICAgIH0KICAgICAgY29uc3QgcGFnZVNlZ21lbnRGbGFncyA9IGRhdGFbcG9zaXRpb24gKyAxNl07CiAgICAgIHJlYWRVaW50MTYoZGF0YSwgcG9zaXRpb24gKyAxNyk7CiAgICAgIHBhZ2VJbmZvLmxvc3NsZXNzID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDEpOwogICAgICBwYWdlSW5mby5yZWZpbmVtZW50ID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDIpOwogICAgICBwYWdlSW5mby5kZWZhdWx0UGl4ZWxWYWx1ZSA9IHBhZ2VTZWdtZW50RmxhZ3MgPj4gMiAmIDE7CiAgICAgIHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3IgPSBwYWdlU2VnbWVudEZsYWdzID4+IDMgJiAzOwogICAgICBwYWdlSW5mby5yZXF1aXJlc0J1ZmZlciA9ICEhKHBhZ2VTZWdtZW50RmxhZ3MgJiAzMik7CiAgICAgIHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3JPdmVycmlkZSA9ICEhKHBhZ2VTZWdtZW50RmxhZ3MgJiA2NCk7CiAgICAgIGFyZ3MgPSBbcGFnZUluZm9dOwogICAgICBicmVhazsKICAgIGNhc2UgNDk6CiAgICAgIGJyZWFrOwogICAgY2FzZSA1MDoKICAgICAgYnJlYWs7CiAgICBjYXNlIDUxOgogICAgICBicmVhazsKICAgIGNhc2UgNTM6CiAgICAgIGFyZ3MgPSBbaGVhZGVyLm51bWJlciwgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSA2MjoKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgc2VnbWVudCB0eXBlICR7aGVhZGVyLnR5cGVOYW1lfSgke2hlYWRlci50eXBlfSkgaXMgbm90IGltcGxlbWVudGVkYCk7CiAgfQogIGNvbnN0IGNhbGxiYWNrTmFtZSA9ICJvbiIgKyBoZWFkZXIudHlwZU5hbWU7CiAgaWYgKGNhbGxiYWNrTmFtZSBpbiB2aXNpdG9yKSB7CiAgICB2aXNpdG9yW2NhbGxiYWNrTmFtZV0uYXBwbHkodmlzaXRvciwgYXJncyk7CiAgfQp9CmZ1bmN0aW9uIHByb2Nlc3NTZWdtZW50cyhzZWdtZW50cywgdmlzaXRvcikgewogIGZvciAobGV0IGkgPSAwLCBpaSA9IHNlZ21lbnRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIHByb2Nlc3NTZWdtZW50KHNlZ21lbnRzW2ldLCB2aXNpdG9yKTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VKYmlnMkNodW5rcyhjaHVua3MpIHsKICBjb25zdCB2aXNpdG9yID0gbmV3IFNpbXBsZVNlZ21lbnRWaXNpdG9yKCk7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2h1bmtzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IGNodW5rID0gY2h1bmtzW2ldOwogICAgY29uc3Qgc2VnbWVudHMgPSByZWFkU2VnbWVudHMoe30sIGNodW5rLmRhdGEsIGNodW5rLnN0YXJ0LCBjaHVuay5lbmQpOwogICAgcHJvY2Vzc1NlZ21lbnRzKHNlZ21lbnRzLCB2aXNpdG9yKTsKICB9CiAgcmV0dXJuIHZpc2l0b3IuYnVmZmVyOwp9CmNsYXNzIFNpbXBsZVNlZ21lbnRWaXNpdG9yIHsKICBvblBhZ2VJbmZvcm1hdGlvbihpbmZvKSB7CiAgICB0aGlzLmN1cnJlbnRQYWdlSW5mbyA9IGluZm87CiAgICBjb25zdCByb3dTaXplID0gaW5mby53aWR0aCArIDcgPj4gMzsKICAgIGNvbnN0IGJ1ZmZlciA9IG5ldyBVaW50OENsYW1wZWRBcnJheShyb3dTaXplICogaW5mby5oZWlnaHQpOwogICAgaWYgKGluZm8uZGVmYXVsdFBpeGVsVmFsdWUpIHsKICAgICAgYnVmZmVyLmZpbGwoMHhmZik7CiAgICB9CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKICB9CiAgZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApIHsKICAgIGNvbnN0IHBhZ2VJbmZvID0gdGhpcy5jdXJyZW50UGFnZUluZm87CiAgICBjb25zdCB3aWR0aCA9IHJlZ2lvbkluZm8ud2lkdGgsCiAgICAgIGhlaWdodCA9IHJlZ2lvbkluZm8uaGVpZ2h0OwogICAgY29uc3Qgcm93U2l6ZSA9IHBhZ2VJbmZvLndpZHRoICsgNyA+PiAzOwogICAgY29uc3QgY29tYmluYXRpb25PcGVyYXRvciA9IHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3JPdmVycmlkZSA/IHJlZ2lvbkluZm8uY29tYmluYXRpb25PcGVyYXRvciA6IHBhZ2VJbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3I7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGNvbnN0IG1hc2swID0gMTI4ID4+IChyZWdpb25JbmZvLnggJiA3KTsKICAgIGxldCBvZmZzZXQwID0gcmVnaW9uSW5mby55ICogcm93U2l6ZSArIChyZWdpb25JbmZvLnggPj4gMyk7CiAgICBsZXQgaSwgaiwgbWFzaywgb2Zmc2V0OwogICAgc3dpdGNoIChjb21iaW5hdGlvbk9wZXJhdG9yKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgIG1hc2sgPSBtYXNrMDsKICAgICAgICAgIG9mZnNldCA9IG9mZnNldDA7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICAgICAgICBpZiAoYml0bWFwW2ldW2pdKSB7CiAgICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gfD0gbWFzazsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXNrID4+PSAxOwogICAgICAgICAgICBpZiAoIW1hc2spIHsKICAgICAgICAgICAgICBtYXNrID0gMTI4OwogICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBvZmZzZXQwICs9IHJvd1NpemU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICBtYXNrID0gbWFzazA7CiAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQwOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgaWYgKGJpdG1hcFtpXVtqXSkgewogICAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXRdIF49IG1hc2s7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFzayA+Pj0gMTsKICAgICAgICAgICAgaWYgKCFtYXNrKSB7CiAgICAgICAgICAgICAgbWFzayA9IDEyODsKICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgb2Zmc2V0MCArPSByb3dTaXplOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgJHtjb21iaW5hdGlvbk9wZXJhdG9yfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICB9CiAgfQogIG9uSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbihyZWdpb24sIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIGNvbnN0IHJlZ2lvbkluZm8gPSByZWdpb24uaW5mbzsKICAgIGNvbnN0IGRlY29kaW5nQ29udGV4dCA9IG5ldyBEZWNvZGluZ0NvbnRleHQoZGF0YSwgc3RhcnQsIGVuZCk7CiAgICBjb25zdCBiaXRtYXAgPSBkZWNvZGVCaXRtYXAocmVnaW9uLm1tciwgcmVnaW9uSW5mby53aWR0aCwgcmVnaW9uSW5mby5oZWlnaHQsIHJlZ2lvbi50ZW1wbGF0ZSwgcmVnaW9uLnByZWRpY3Rpb24sIG51bGwsIHJlZ2lvbi5hdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgIHRoaXMuZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApOwogIH0KICBvbkltbWVkaWF0ZUxvc3NsZXNzR2VuZXJpY1JlZ2lvbigpIHsKICAgIHRoaXMub25JbW1lZGlhdGVHZW5lcmljUmVnaW9uKC4uLmFyZ3VtZW50cyk7CiAgfQogIG9uU3ltYm9sRGljdGlvbmFyeShkaWN0aW9uYXJ5LCBjdXJyZW50U2VnbWVudCwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgbGV0IGh1ZmZtYW5UYWJsZXMsIGh1ZmZtYW5JbnB1dDsKICAgIGlmIChkaWN0aW9uYXJ5Lmh1ZmZtYW4pIHsKICAgICAgaHVmZm1hblRhYmxlcyA9IGdldFN5bWJvbERpY3Rpb25hcnlIdWZmbWFuVGFibGVzKGRpY3Rpb25hcnksIHJlZmVycmVkU2VnbWVudHMsIHRoaXMuY3VzdG9tVGFibGVzKTsKICAgICAgaHVmZm1hbklucHV0ID0gbmV3IFJlYWRlcihkYXRhLCBzdGFydCwgZW5kKTsKICAgIH0KICAgIGxldCBzeW1ib2xzID0gdGhpcy5zeW1ib2xzOwogICAgaWYgKCFzeW1ib2xzKSB7CiAgICAgIHRoaXMuc3ltYm9scyA9IHN5bWJvbHMgPSB7fTsKICAgIH0KICAgIGNvbnN0IGlucHV0U3ltYm9scyA9IFtdOwogICAgZm9yIChjb25zdCByZWZlcnJlZFNlZ21lbnQgb2YgcmVmZXJyZWRTZWdtZW50cykgewogICAgICBjb25zdCByZWZlcnJlZFN5bWJvbHMgPSBzeW1ib2xzW3JlZmVycmVkU2VnbWVudF07CiAgICAgIGlmIChyZWZlcnJlZFN5bWJvbHMpIHsKICAgICAgICBpbnB1dFN5bWJvbHMucHVzaCguLi5yZWZlcnJlZFN5bWJvbHMpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgc3ltYm9sc1tjdXJyZW50U2VnbWVudF0gPSBkZWNvZGVTeW1ib2xEaWN0aW9uYXJ5KGRpY3Rpb25hcnkuaHVmZm1hbiwgZGljdGlvbmFyeS5yZWZpbmVtZW50LCBpbnB1dFN5bWJvbHMsIGRpY3Rpb25hcnkubnVtYmVyT2ZOZXdTeW1ib2xzLCBkaWN0aW9uYXJ5Lm51bWJlck9mRXhwb3J0ZWRTeW1ib2xzLCBodWZmbWFuVGFibGVzLCBkaWN0aW9uYXJ5LnRlbXBsYXRlLCBkaWN0aW9uYXJ5LmF0LCBkaWN0aW9uYXJ5LnJlZmluZW1lbnRUZW1wbGF0ZSwgZGljdGlvbmFyeS5yZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgaHVmZm1hbklucHV0KTsKICB9CiAgb25JbW1lZGlhdGVUZXh0UmVnaW9uKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgY29uc3QgcmVnaW9uSW5mbyA9IHJlZ2lvbi5pbmZvOwogICAgbGV0IGh1ZmZtYW5UYWJsZXMsIGh1ZmZtYW5JbnB1dDsKICAgIGNvbnN0IHN5bWJvbHMgPSB0aGlzLnN5bWJvbHM7CiAgICBjb25zdCBpbnB1dFN5bWJvbHMgPSBbXTsKICAgIGZvciAoY29uc3QgcmVmZXJyZWRTZWdtZW50IG9mIHJlZmVycmVkU2VnbWVudHMpIHsKICAgICAgY29uc3QgcmVmZXJyZWRTeW1ib2xzID0gc3ltYm9sc1tyZWZlcnJlZFNlZ21lbnRdOwogICAgICBpZiAocmVmZXJyZWRTeW1ib2xzKSB7CiAgICAgICAgaW5wdXRTeW1ib2xzLnB1c2goLi4ucmVmZXJyZWRTeW1ib2xzKTsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3ltYm9sQ29kZUxlbmd0aCA9IGxvZzIoaW5wdXRTeW1ib2xzLmxlbmd0aCk7CiAgICBpZiAocmVnaW9uLmh1ZmZtYW4pIHsKICAgICAgaHVmZm1hbklucHV0ID0gbmV3IFJlYWRlcihkYXRhLCBzdGFydCwgZW5kKTsKICAgICAgaHVmZm1hblRhYmxlcyA9IGdldFRleHRSZWdpb25IdWZmbWFuVGFibGVzKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgdGhpcy5jdXN0b21UYWJsZXMsIGlucHV0U3ltYm9scy5sZW5ndGgsIGh1ZmZtYW5JbnB1dCk7CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgY29uc3QgYml0bWFwID0gZGVjb2RlVGV4dFJlZ2lvbihyZWdpb24uaHVmZm1hbiwgcmVnaW9uLnJlZmluZW1lbnQsIHJlZ2lvbkluZm8ud2lkdGgsIHJlZ2lvbkluZm8uaGVpZ2h0LCByZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUsIHJlZ2lvbi5udW1iZXJPZlN5bWJvbEluc3RhbmNlcywgcmVnaW9uLnN0cmlwU2l6ZSwgaW5wdXRTeW1ib2xzLCBzeW1ib2xDb2RlTGVuZ3RoLCByZWdpb24udHJhbnNwb3NlZCwgcmVnaW9uLmRzT2Zmc2V0LCByZWdpb24ucmVmZXJlbmNlQ29ybmVyLCByZWdpb24uY29tYmluYXRpb25PcGVyYXRvciwgaHVmZm1hblRhYmxlcywgcmVnaW9uLnJlZmluZW1lbnRUZW1wbGF0ZSwgcmVnaW9uLnJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0LCByZWdpb24ubG9nU3RyaXBTaXplLCBodWZmbWFuSW5wdXQpOwogICAgdGhpcy5kcmF3Qml0bWFwKHJlZ2lvbkluZm8sIGJpdG1hcCk7CiAgfQogIG9uSW1tZWRpYXRlTG9zc2xlc3NUZXh0UmVnaW9uKCkgewogICAgdGhpcy5vbkltbWVkaWF0ZVRleHRSZWdpb24oLi4uYXJndW1lbnRzKTsKICB9CiAgb25QYXR0ZXJuRGljdGlvbmFyeShkaWN0aW9uYXJ5LCBjdXJyZW50U2VnbWVudCwgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgbGV0IHBhdHRlcm5zID0gdGhpcy5wYXR0ZXJuczsKICAgIGlmICghcGF0dGVybnMpIHsKICAgICAgdGhpcy5wYXR0ZXJucyA9IHBhdHRlcm5zID0ge307CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgcGF0dGVybnNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlUGF0dGVybkRpY3Rpb25hcnkoZGljdGlvbmFyeS5tbXIsIGRpY3Rpb25hcnkucGF0dGVybldpZHRoLCBkaWN0aW9uYXJ5LnBhdHRlcm5IZWlnaHQsIGRpY3Rpb25hcnkubWF4UGF0dGVybkluZGV4LCBkaWN0aW9uYXJ5LnRlbXBsYXRlLCBkZWNvZGluZ0NvbnRleHQpOwogIH0KICBvbkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgY29uc3QgcGF0dGVybnMgPSB0aGlzLnBhdHRlcm5zW3JlZmVycmVkU2VnbWVudHNbMF1dOwogICAgY29uc3QgcmVnaW9uSW5mbyA9IHJlZ2lvbi5pbmZvOwogICAgY29uc3QgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgIGNvbnN0IGJpdG1hcCA9IGRlY29kZUhhbGZ0b25lUmVnaW9uKHJlZ2lvbi5tbXIsIHBhdHRlcm5zLCByZWdpb24udGVtcGxhdGUsIHJlZ2lvbkluZm8ud2lkdGgsIHJlZ2lvbkluZm8uaGVpZ2h0LCByZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUsIHJlZ2lvbi5lbmFibGVTa2lwLCByZWdpb24uY29tYmluYXRpb25PcGVyYXRvciwgcmVnaW9uLmdyaWRXaWR0aCwgcmVnaW9uLmdyaWRIZWlnaHQsIHJlZ2lvbi5ncmlkT2Zmc2V0WCwgcmVnaW9uLmdyaWRPZmZzZXRZLCByZWdpb24uZ3JpZFZlY3RvclgsIHJlZ2lvbi5ncmlkVmVjdG9yWSwgZGVjb2RpbmdDb250ZXh0KTsKICAgIHRoaXMuZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApOwogIH0KICBvbkltbWVkaWF0ZUxvc3NsZXNzSGFsZnRvbmVSZWdpb24oKSB7CiAgICB0aGlzLm9uSW1tZWRpYXRlSGFsZnRvbmVSZWdpb24oLi4uYXJndW1lbnRzKTsKICB9CiAgb25UYWJsZXMoY3VycmVudFNlZ21lbnQsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIGxldCBjdXN0b21UYWJsZXMgPSB0aGlzLmN1c3RvbVRhYmxlczsKICAgIGlmICghY3VzdG9tVGFibGVzKSB7CiAgICAgIHRoaXMuY3VzdG9tVGFibGVzID0gY3VzdG9tVGFibGVzID0ge307CiAgICB9CiAgICBjdXN0b21UYWJsZXNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlVGFibGVzU2VnbWVudChkYXRhLCBzdGFydCwgZW5kKTsKICB9Cn0KY2xhc3MgSHVmZm1hbkxpbmUgewogIGNvbnN0cnVjdG9yKGxpbmVEYXRhKSB7CiAgICBpZiAobGluZURhdGEubGVuZ3RoID09PSAyKSB7CiAgICAgIHRoaXMuaXNPT0IgPSB0cnVlOwogICAgICB0aGlzLnJhbmdlTG93ID0gMDsKICAgICAgdGhpcy5wcmVmaXhMZW5ndGggPSBsaW5lRGF0YVswXTsKICAgICAgdGhpcy5yYW5nZUxlbmd0aCA9IDA7CiAgICAgIHRoaXMucHJlZml4Q29kZSA9IGxpbmVEYXRhWzFdOwogICAgICB0aGlzLmlzTG93ZXJSYW5nZSA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5pc09PQiA9IGZhbHNlOwogICAgICB0aGlzLnJhbmdlTG93ID0gbGluZURhdGFbMF07CiAgICAgIHRoaXMucHJlZml4TGVuZ3RoID0gbGluZURhdGFbMV07CiAgICAgIHRoaXMucmFuZ2VMZW5ndGggPSBsaW5lRGF0YVsyXTsKICAgICAgdGhpcy5wcmVmaXhDb2RlID0gbGluZURhdGFbM107CiAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gbGluZURhdGFbNF0gPT09ICJsb3dlciI7CiAgICB9CiAgfQp9CmNsYXNzIEh1ZmZtYW5UcmVlTm9kZSB7CiAgY29uc3RydWN0b3IobGluZSkgewogICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgaWYgKGxpbmUpIHsKICAgICAgdGhpcy5pc0xlYWYgPSB0cnVlOwogICAgICB0aGlzLnJhbmdlTGVuZ3RoID0gbGluZS5yYW5nZUxlbmd0aDsKICAgICAgdGhpcy5yYW5nZUxvdyA9IGxpbmUucmFuZ2VMb3c7CiAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gbGluZS5pc0xvd2VyUmFuZ2U7CiAgICAgIHRoaXMuaXNPT0IgPSBsaW5lLmlzT09COwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5pc0xlYWYgPSBmYWxzZTsKICAgIH0KICB9CiAgYnVpbGRUcmVlKGxpbmUsIHNoaWZ0KSB7CiAgICBjb25zdCBiaXQgPSBsaW5lLnByZWZpeENvZGUgPj4gc2hpZnQgJiAxOwogICAgaWYgKHNoaWZ0IDw9IDApIHsKICAgICAgdGhpcy5jaGlsZHJlbltiaXRdID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShsaW5lKTsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBub2RlID0gdGhpcy5jaGlsZHJlbltiaXRdOwogICAgICBpZiAoIW5vZGUpIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2JpdF0gPSBub2RlID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShudWxsKTsKICAgICAgfQogICAgICBub2RlLmJ1aWxkVHJlZShsaW5lLCBzaGlmdCAtIDEpOwogICAgfQogIH0KICBkZWNvZGVOb2RlKHJlYWRlcikgewogICAgaWYgKHRoaXMuaXNMZWFmKSB7CiAgICAgIGlmICh0aGlzLmlzT09CKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgaHRPZmZzZXQgPSByZWFkZXIucmVhZEJpdHModGhpcy5yYW5nZUxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzLnJhbmdlTG93ICsgKHRoaXMuaXNMb3dlclJhbmdlID8gLWh0T2Zmc2V0IDogaHRPZmZzZXQpOwogICAgfQogICAgY29uc3Qgbm9kZSA9IHRoaXMuY2hpbGRyZW5bcmVhZGVyLnJlYWRCaXQoKV07CiAgICBpZiAoIW5vZGUpIHsKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBkYXRhIik7CiAgICB9CiAgICByZXR1cm4gbm9kZS5kZWNvZGVOb2RlKHJlYWRlcik7CiAgfQp9CmNsYXNzIEh1ZmZtYW5UYWJsZSB7CiAgY29uc3RydWN0b3IobGluZXMsIHByZWZpeENvZGVzRG9uZSkgewogICAgaWYgKCFwcmVmaXhDb2Rlc0RvbmUpIHsKICAgICAgdGhpcy5hc3NpZ25QcmVmaXhDb2RlcyhsaW5lcyk7CiAgICB9CiAgICB0aGlzLnJvb3ROb2RlID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShudWxsKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldOwogICAgICBpZiAobGluZS5wcmVmaXhMZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5yb290Tm9kZS5idWlsZFRyZWUobGluZSwgbGluZS5wcmVmaXhMZW5ndGggLSAxKTsKICAgICAgfQogICAgfQogIH0KICBkZWNvZGUocmVhZGVyKSB7CiAgICByZXR1cm4gdGhpcy5yb290Tm9kZS5kZWNvZGVOb2RlKHJlYWRlcik7CiAgfQogIGFzc2lnblByZWZpeENvZGVzKGxpbmVzKSB7CiAgICBjb25zdCBsaW5lc0xlbmd0aCA9IGxpbmVzLmxlbmd0aDsKICAgIGxldCBwcmVmaXhMZW5ndGhNYXggPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lc0xlbmd0aDsgaSsrKSB7CiAgICAgIHByZWZpeExlbmd0aE1heCA9IE1hdGgubWF4KHByZWZpeExlbmd0aE1heCwgbGluZXNbaV0ucHJlZml4TGVuZ3RoKTsKICAgIH0KICAgIGNvbnN0IGhpc3RvZ3JhbSA9IG5ldyBVaW50MzJBcnJheShwcmVmaXhMZW5ndGhNYXggKyAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXNMZW5ndGg7IGkrKykgewogICAgICBoaXN0b2dyYW1bbGluZXNbaV0ucHJlZml4TGVuZ3RoXSsrOwogICAgfQogICAgbGV0IGN1cnJlbnRMZW5ndGggPSAxLAogICAgICBmaXJzdENvZGUgPSAwLAogICAgICBjdXJyZW50Q29kZSwKICAgICAgY3VycmVudFRlbXAsCiAgICAgIGxpbmU7CiAgICBoaXN0b2dyYW1bMF0gPSAwOwogICAgd2hpbGUgKGN1cnJlbnRMZW5ndGggPD0gcHJlZml4TGVuZ3RoTWF4KSB7CiAgICAgIGZpcnN0Q29kZSA9IGZpcnN0Q29kZSArIGhpc3RvZ3JhbVtjdXJyZW50TGVuZ3RoIC0gMV0gPDwgMTsKICAgICAgY3VycmVudENvZGUgPSBmaXJzdENvZGU7CiAgICAgIGN1cnJlbnRUZW1wID0gMDsKICAgICAgd2hpbGUgKGN1cnJlbnRUZW1wIDwgbGluZXNMZW5ndGgpIHsKICAgICAgICBsaW5lID0gbGluZXNbY3VycmVudFRlbXBdOwogICAgICAgIGlmIChsaW5lLnByZWZpeExlbmd0aCA9PT0gY3VycmVudExlbmd0aCkgewogICAgICAgICAgbGluZS5wcmVmaXhDb2RlID0gY3VycmVudENvZGU7CiAgICAgICAgICBjdXJyZW50Q29kZSsrOwogICAgICAgIH0KICAgICAgICBjdXJyZW50VGVtcCsrOwogICAgICB9CiAgICAgIGN1cnJlbnRMZW5ndGgrKzsKICAgIH0KICB9Cn0KZnVuY3Rpb24gZGVjb2RlVGFibGVzU2VnbWVudChkYXRhLCBzdGFydCwgZW5kKSB7CiAgY29uc3QgZmxhZ3MgPSBkYXRhW3N0YXJ0XTsKICBjb25zdCBsb3dlc3RWYWx1ZSA9IHJlYWRVaW50MzIoZGF0YSwgc3RhcnQgKyAxKSAmIDB4ZmZmZmZmZmY7CiAgY29uc3QgaGlnaGVzdFZhbHVlID0gcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDUpICYgMHhmZmZmZmZmZjsKICBjb25zdCByZWFkZXIgPSBuZXcgUmVhZGVyKGRhdGEsIHN0YXJ0ICsgOSwgZW5kKTsKICBjb25zdCBwcmVmaXhTaXplQml0cyA9IChmbGFncyA+PiAxICYgNykgKyAxOwogIGNvbnN0IHJhbmdlU2l6ZUJpdHMgPSAoZmxhZ3MgPj4gNCAmIDcpICsgMTsKICBjb25zdCBsaW5lcyA9IFtdOwogIGxldCBwcmVmaXhMZW5ndGgsCiAgICByYW5nZUxlbmd0aCwKICAgIGN1cnJlbnRSYW5nZUxvdyA9IGxvd2VzdFZhbHVlOwogIGRvIHsKICAgIHByZWZpeExlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhwcmVmaXhTaXplQml0cyk7CiAgICByYW5nZUxlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhyYW5nZVNpemVCaXRzKTsKICAgIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtjdXJyZW50UmFuZ2VMb3csIHByZWZpeExlbmd0aCwgcmFuZ2VMZW5ndGgsIDBdKSk7CiAgICBjdXJyZW50UmFuZ2VMb3cgKz0gMSA8PCByYW5nZUxlbmd0aDsKICB9IHdoaWxlIChjdXJyZW50UmFuZ2VMb3cgPCBoaWdoZXN0VmFsdWUpOwogIHByZWZpeExlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhwcmVmaXhTaXplQml0cyk7CiAgbGluZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2xvd2VzdFZhbHVlIC0gMSwgcHJlZml4TGVuZ3RoLCAzMiwgMCwgImxvd2VyIl0pKTsKICBwcmVmaXhMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocHJlZml4U2l6ZUJpdHMpOwogIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtoaWdoZXN0VmFsdWUsIHByZWZpeExlbmd0aCwgMzIsIDBdKSk7CiAgaWYgKGZsYWdzICYgMSkgewogICAgcHJlZml4TGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHByZWZpeFNpemVCaXRzKTsKICAgIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtwcmVmaXhMZW5ndGgsIDBdKSk7CiAgfQogIHJldHVybiBuZXcgSHVmZm1hblRhYmxlKGxpbmVzLCBmYWxzZSk7Cn0KY29uc3Qgc3RhbmRhcmRUYWJsZXNDYWNoZSA9IHt9OwpmdW5jdGlvbiBnZXRTdGFuZGFyZFRhYmxlKG51bWJlcikgewogIGxldCB0YWJsZSA9IHN0YW5kYXJkVGFibGVzQ2FjaGVbbnVtYmVyXTsKICBpZiAodGFibGUpIHsKICAgIHJldHVybiB0YWJsZTsKICB9CiAgbGV0IGxpbmVzOwogIHN3aXRjaCAobnVtYmVyKSB7CiAgICBjYXNlIDE6CiAgICAgIGxpbmVzID0gW1swLCAxLCA0LCAweDBdLCBbMTYsIDIsIDgsIDB4Ml0sIFsyNzIsIDMsIDE2LCAweDZdLCBbNjU4MDgsIDMsIDMyLCAweDddXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDI6CiAgICAgIGxpbmVzID0gW1swLCAxLCAwLCAweDBdLCBbMSwgMiwgMCwgMHgyXSwgWzIsIDMsIDAsIDB4Nl0sIFszLCA0LCAzLCAweGVdLCBbMTEsIDUsIDYsIDB4MWVdLCBbNzUsIDYsIDMyLCAweDNlXSwgWzYsIDB4M2ZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIGxpbmVzID0gW1stMjU2LCA4LCA4LCAweGZlXSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAyLCAwLCAweDJdLCBbMiwgMywgMCwgMHg2XSwgWzMsIDQsIDMsIDB4ZV0sIFsxMSwgNSwgNiwgMHgxZV0sIFstMjU3LCA4LCAzMiwgMHhmZiwgImxvd2VyIl0sIFs3NSwgNywgMzIsIDB4N2VdLCBbNiwgMHgzZV1dOwogICAgICBicmVhazsKICAgIGNhc2UgNDoKICAgICAgbGluZXMgPSBbWzEsIDEsIDAsIDB4MF0sIFsyLCAyLCAwLCAweDJdLCBbMywgMywgMCwgMHg2XSwgWzQsIDQsIDMsIDB4ZV0sIFsxMiwgNSwgNiwgMHgxZV0sIFs3NiwgNSwgMzIsIDB4MWZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDU6CiAgICAgIGxpbmVzID0gW1stMjU1LCA3LCA4LCAweDdlXSwgWzEsIDEsIDAsIDB4MF0sIFsyLCAyLCAwLCAweDJdLCBbMywgMywgMCwgMHg2XSwgWzQsIDQsIDMsIDB4ZV0sIFsxMiwgNSwgNiwgMHgxZV0sIFstMjU2LCA3LCAzMiwgMHg3ZiwgImxvd2VyIl0sIFs3NiwgNiwgMzIsIDB4M2VdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDY6CiAgICAgIGxpbmVzID0gW1stMjA0OCwgNSwgMTAsIDB4MWNdLCBbLTEwMjQsIDQsIDksIDB4OF0sIFstNTEyLCA0LCA4LCAweDldLCBbLTI1NiwgNCwgNywgMHhhXSwgWy0xMjgsIDUsIDYsIDB4MWRdLCBbLTY0LCA1LCA1LCAweDFlXSwgWy0zMiwgNCwgNSwgMHhiXSwgWzAsIDIsIDcsIDB4MF0sIFsxMjgsIDMsIDcsIDB4Ml0sIFsyNTYsIDMsIDgsIDB4M10sIFs1MTIsIDQsIDksIDB4Y10sIFsxMDI0LCA0LCAxMCwgMHhkXSwgWy0yMDQ5LCA2LCAzMiwgMHgzZSwgImxvd2VyIl0sIFsyMDQ4LCA2LCAzMiwgMHgzZl1dOwogICAgICBicmVhazsKICAgIGNhc2UgNzoKICAgICAgbGluZXMgPSBbWy0xMDI0LCA0LCA5LCAweDhdLCBbLTUxMiwgMywgOCwgMHgwXSwgWy0yNTYsIDQsIDcsIDB4OV0sIFstMTI4LCA1LCA2LCAweDFhXSwgWy02NCwgNSwgNSwgMHgxYl0sIFstMzIsIDQsIDUsIDB4YV0sIFswLCA0LCA1LCAweGJdLCBbMzIsIDUsIDUsIDB4MWNdLCBbNjQsIDUsIDYsIDB4MWRdLCBbMTI4LCA0LCA3LCAweGNdLCBbMjU2LCAzLCA4LCAweDFdLCBbNTEyLCAzLCA5LCAweDJdLCBbMTAyNCwgMywgMTAsIDB4M10sIFstMTAyNSwgNSwgMzIsIDB4MWUsICJsb3dlciJdLCBbMjA0OCwgNSwgMzIsIDB4MWZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDg6CiAgICAgIGxpbmVzID0gW1stMTUsIDgsIDMsIDB4ZmNdLCBbLTcsIDksIDEsIDB4MWZjXSwgWy01LCA4LCAxLCAweGZkXSwgWy0zLCA5LCAwLCAweDFmZF0sIFstMiwgNywgMCwgMHg3Y10sIFstMSwgNCwgMCwgMHhhXSwgWzAsIDIsIDEsIDB4MF0sIFsyLCA1LCAwLCAweDFhXSwgWzMsIDYsIDAsIDB4M2FdLCBbNCwgMywgNCwgMHg0XSwgWzIwLCA2LCAxLCAweDNiXSwgWzIyLCA0LCA0LCAweGJdLCBbMzgsIDQsIDUsIDB4Y10sIFs3MCwgNSwgNiwgMHgxYl0sIFsxMzQsIDUsIDcsIDB4MWNdLCBbMjYyLCA2LCA3LCAweDNjXSwgWzM5MCwgNywgOCwgMHg3ZF0sIFs2NDYsIDYsIDEwLCAweDNkXSwgWy0xNiwgOSwgMzIsIDB4MWZlLCAibG93ZXIiXSwgWzE2NzAsIDksIDMyLCAweDFmZl0sIFsyLCAweDFdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDk6CiAgICAgIGxpbmVzID0gW1stMzEsIDgsIDQsIDB4ZmNdLCBbLTE1LCA5LCAyLCAweDFmY10sIFstMTEsIDgsIDIsIDB4ZmRdLCBbLTcsIDksIDEsIDB4MWZkXSwgWy01LCA3LCAxLCAweDdjXSwgWy0zLCA0LCAxLCAweGFdLCBbLTEsIDMsIDEsIDB4Ml0sIFsxLCAzLCAxLCAweDNdLCBbMywgNSwgMSwgMHgxYV0sIFs1LCA2LCAxLCAweDNhXSwgWzcsIDMsIDUsIDB4NF0sIFszOSwgNiwgMiwgMHgzYl0sIFs0MywgNCwgNSwgMHhiXSwgWzc1LCA0LCA2LCAweGNdLCBbMTM5LCA1LCA3LCAweDFiXSwgWzI2NywgNSwgOCwgMHgxY10sIFs1MjMsIDYsIDgsIDB4M2NdLCBbNzc5LCA3LCA5LCAweDdkXSwgWzEyOTEsIDYsIDExLCAweDNkXSwgWy0zMiwgOSwgMzIsIDB4MWZlLCAibG93ZXIiXSwgWzMzMzksIDksIDMyLCAweDFmZl0sIFsyLCAweDBdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDEwOgogICAgICBsaW5lcyA9IFtbLTIxLCA3LCA0LCAweDdhXSwgWy01LCA4LCAwLCAweGZjXSwgWy00LCA3LCAwLCAweDdiXSwgWy0zLCA1LCAwLCAweDE4XSwgWy0yLCAyLCAyLCAweDBdLCBbMiwgNSwgMCwgMHgxOV0sIFszLCA2LCAwLCAweDM2XSwgWzQsIDcsIDAsIDB4N2NdLCBbNSwgOCwgMCwgMHhmZF0sIFs2LCAyLCA2LCAweDFdLCBbNzAsIDUsIDUsIDB4MWFdLCBbMTAyLCA2LCA1LCAweDM3XSwgWzEzNCwgNiwgNiwgMHgzOF0sIFsxOTgsIDYsIDcsIDB4MzldLCBbMzI2LCA2LCA4LCAweDNhXSwgWzU4MiwgNiwgOSwgMHgzYl0sIFsxMDk0LCA2LCAxMCwgMHgzY10sIFsyMTE4LCA3LCAxMSwgMHg3ZF0sIFstMjIsIDgsIDMyLCAweGZlLCAibG93ZXIiXSwgWzQxNjYsIDgsIDMyLCAweGZmXSwgWzIsIDB4Ml1dOwogICAgICBicmVhazsKICAgIGNhc2UgMTE6CiAgICAgIGxpbmVzID0gW1sxLCAxLCAwLCAweDBdLCBbMiwgMiwgMSwgMHgyXSwgWzQsIDQsIDAsIDB4Y10sIFs1LCA0LCAxLCAweGRdLCBbNywgNSwgMSwgMHgxY10sIFs5LCA1LCAyLCAweDFkXSwgWzEzLCA2LCAyLCAweDNjXSwgWzE3LCA3LCAyLCAweDdhXSwgWzIxLCA3LCAzLCAweDdiXSwgWzI5LCA3LCA0LCAweDdjXSwgWzQ1LCA3LCA1LCAweDdkXSwgWzc3LCA3LCA2LCAweDdlXSwgWzE0MSwgNywgMzIsIDB4N2ZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDEyOgogICAgICBsaW5lcyA9IFtbMSwgMSwgMCwgMHgwXSwgWzIsIDIsIDAsIDB4Ml0sIFszLCAzLCAxLCAweDZdLCBbNSwgNSwgMCwgMHgxY10sIFs2LCA1LCAxLCAweDFkXSwgWzgsIDYsIDEsIDB4M2NdLCBbMTAsIDcsIDAsIDB4N2FdLCBbMTEsIDcsIDEsIDB4N2JdLCBbMTMsIDcsIDIsIDB4N2NdLCBbMTcsIDcsIDMsIDB4N2RdLCBbMjUsIDcsIDQsIDB4N2VdLCBbNDEsIDgsIDUsIDB4ZmVdLCBbNzMsIDgsIDMyLCAweGZmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxMzoKICAgICAgbGluZXMgPSBbWzEsIDEsIDAsIDB4MF0sIFsyLCAzLCAwLCAweDRdLCBbMywgNCwgMCwgMHhjXSwgWzQsIDUsIDAsIDB4MWNdLCBbNSwgNCwgMSwgMHhkXSwgWzcsIDMsIDMsIDB4NV0sIFsxNSwgNiwgMSwgMHgzYV0sIFsxNywgNiwgMiwgMHgzYl0sIFsyMSwgNiwgMywgMHgzY10sIFsyOSwgNiwgNCwgMHgzZF0sIFs0NSwgNiwgNSwgMHgzZV0sIFs3NywgNywgNiwgMHg3ZV0sIFsxNDEsIDcsIDMyLCAweDdmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxNDoKICAgICAgbGluZXMgPSBbWy0yLCAzLCAwLCAweDRdLCBbLTEsIDMsIDAsIDB4NV0sIFswLCAxLCAwLCAweDBdLCBbMSwgMywgMCwgMHg2XSwgWzIsIDMsIDAsIDB4N11dOwogICAgICBicmVhazsKICAgIGNhc2UgMTU6CiAgICAgIGxpbmVzID0gW1stMjQsIDcsIDQsIDB4N2NdLCBbLTgsIDYsIDIsIDB4M2NdLCBbLTQsIDUsIDEsIDB4MWNdLCBbLTIsIDQsIDAsIDB4Y10sIFstMSwgMywgMCwgMHg0XSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAzLCAwLCAweDVdLCBbMiwgNCwgMCwgMHhkXSwgWzMsIDUsIDEsIDB4MWRdLCBbNSwgNiwgMiwgMHgzZF0sIFs5LCA3LCA0LCAweDdkXSwgWy0yNSwgNywgMzIsIDB4N2UsICJsb3dlciJdLCBbMjUsIDcsIDMyLCAweDdmXV07CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoYHN0YW5kYXJkIHRhYmxlIEIuJHtudW1iZXJ9IGRvZXMgbm90IGV4aXN0YCk7CiAgfQogIGZvciAobGV0IGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGxpbmVzW2ldID0gbmV3IEh1ZmZtYW5MaW5lKGxpbmVzW2ldKTsKICB9CiAgdGFibGUgPSBuZXcgSHVmZm1hblRhYmxlKGxpbmVzLCB0cnVlKTsKICBzdGFuZGFyZFRhYmxlc0NhY2hlW251bWJlcl0gPSB0YWJsZTsKICByZXR1cm4gdGFibGU7Cn0KY2xhc3MgUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihkYXRhLCBzdGFydCwgZW5kKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5zdGFydCA9IHN0YXJ0OwogICAgdGhpcy5lbmQgPSBlbmQ7CiAgICB0aGlzLnBvc2l0aW9uID0gc3RhcnQ7CiAgICB0aGlzLnNoaWZ0ID0gLTE7CiAgICB0aGlzLmN1cnJlbnRCeXRlID0gMDsKICB9CiAgcmVhZEJpdCgpIHsKICAgIGlmICh0aGlzLnNoaWZ0IDwgMCkgewogICAgICBpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmVuZCkgewogICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJlbmQgb2YgZGF0YSB3aGlsZSByZWFkaW5nIGJpdCIpOwogICAgICB9CiAgICAgIHRoaXMuY3VycmVudEJ5dGUgPSB0aGlzLmRhdGFbdGhpcy5wb3NpdGlvbisrXTsKICAgICAgdGhpcy5zaGlmdCA9IDc7CiAgICB9CiAgICBjb25zdCBiaXQgPSB0aGlzLmN1cnJlbnRCeXRlID4+IHRoaXMuc2hpZnQgJiAxOwogICAgdGhpcy5zaGlmdC0tOwogICAgcmV0dXJuIGJpdDsKICB9CiAgcmVhZEJpdHMobnVtQml0cykgewogICAgbGV0IHJlc3VsdCA9IDAsCiAgICAgIGk7CiAgICBmb3IgKGkgPSBudW1CaXRzIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgcmVzdWx0IHw9IHRoaXMucmVhZEJpdCgpIDw8IGk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBieXRlQWxpZ24oKSB7CiAgICB0aGlzLnNoaWZ0ID0gLTE7CiAgfQogIG5leHQoKSB7CiAgICBpZiAodGhpcy5wb3NpdGlvbiA+PSB0aGlzLmVuZCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICByZXR1cm4gdGhpcy5kYXRhW3RoaXMucG9zaXRpb24rK107CiAgfQp9CmZ1bmN0aW9uIGdldEN1c3RvbUh1ZmZtYW5UYWJsZShpbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKSB7CiAgbGV0IGN1cnJlbnRJbmRleCA9IDA7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcmVmZXJyZWRUby5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCB0YWJsZSA9IGN1c3RvbVRhYmxlc1tyZWZlcnJlZFRvW2ldXTsKICAgIGlmICh0YWJsZSkgewogICAgICBpZiAoaW5kZXggPT09IGN1cnJlbnRJbmRleCkgewogICAgICAgIHJldHVybiB0YWJsZTsKICAgICAgfQogICAgICBjdXJyZW50SW5kZXgrKzsKICAgIH0KICB9CiAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImNhbid0IGZpbmQgY3VzdG9tIEh1ZmZtYW4gdGFibGUiKTsKfQpmdW5jdGlvbiBnZXRUZXh0UmVnaW9uSHVmZm1hblRhYmxlcyh0ZXh0UmVnaW9uLCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMsIG51bWJlck9mU3ltYm9scywgcmVhZGVyKSB7CiAgY29uc3QgY29kZXMgPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8PSAzNDsgaSsrKSB7CiAgICBjb25zdCBjb2RlTGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKDQpOwogICAgY29kZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2ksIGNvZGVMZW5ndGgsIDAsIDBdKSk7CiAgfQogIGNvbnN0IHJ1bkNvZGVzVGFibGUgPSBuZXcgSHVmZm1hblRhYmxlKGNvZGVzLCBmYWxzZSk7CiAgY29kZXMubGVuZ3RoID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mU3ltYm9sczspIHsKICAgIGNvbnN0IGNvZGVMZW5ndGggPSBydW5Db2Rlc1RhYmxlLmRlY29kZShyZWFkZXIpOwogICAgaWYgKGNvZGVMZW5ndGggPj0gMzIpIHsKICAgICAgbGV0IHJlcGVhdGVkTGVuZ3RoLCBudW1iZXJPZlJlcGVhdHMsIGo7CiAgICAgIHN3aXRjaCAoY29kZUxlbmd0aCkgewogICAgICAgIGNhc2UgMzI6CiAgICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigibm8gcHJldmlvdXMgdmFsdWUgaW4gc3ltYm9sIElEIHRhYmxlIik7CiAgICAgICAgICB9CiAgICAgICAgICBudW1iZXJPZlJlcGVhdHMgPSByZWFkZXIucmVhZEJpdHMoMikgKyAzOwogICAgICAgICAgcmVwZWF0ZWRMZW5ndGggPSBjb2Rlc1tpIC0gMV0ucHJlZml4TGVuZ3RoOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzMzoKICAgICAgICAgIG51bWJlck9mUmVwZWF0cyA9IHJlYWRlci5yZWFkQml0cygzKSArIDM7CiAgICAgICAgICByZXBlYXRlZExlbmd0aCA9IDA7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM0OgogICAgICAgICAgbnVtYmVyT2ZSZXBlYXRzID0gcmVhZGVyLnJlYWRCaXRzKDcpICsgMTE7CiAgICAgICAgICByZXBlYXRlZExlbmd0aCA9IDA7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgY29kZSBsZW5ndGggaW4gc3ltYm9sIElEIHRhYmxlIik7CiAgICAgIH0KICAgICAgZm9yIChqID0gMDsgaiA8IG51bWJlck9mUmVwZWF0czsgaisrKSB7CiAgICAgICAgY29kZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2ksIHJlcGVhdGVkTGVuZ3RoLCAwLCAwXSkpOwogICAgICAgIGkrKzsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29kZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2ksIGNvZGVMZW5ndGgsIDAsIDBdKSk7CiAgICAgIGkrKzsKICAgIH0KICB9CiAgcmVhZGVyLmJ5dGVBbGlnbigpOwogIGNvbnN0IHN5bWJvbElEVGFibGUgPSBuZXcgSHVmZm1hblRhYmxlKGNvZGVzLCBmYWxzZSk7CiAgbGV0IGN1c3RvbUluZGV4ID0gMCwKICAgIHRhYmxlRmlyc3RTLAogICAgdGFibGVEZWx0YVMsCiAgICB0YWJsZURlbHRhVDsKICBzd2l0Y2ggKHRleHRSZWdpb24uaHVmZm1hbkZTKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICAgIHRhYmxlRmlyc3RTID0gZ2V0U3RhbmRhcmRUYWJsZSh0ZXh0UmVnaW9uLmh1ZmZtYW5GUyArIDYpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVGaXJzdFMgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBGUyBzZWxlY3RvciIpOwogIH0KICBzd2l0Y2ggKHRleHRSZWdpb24uaHVmZm1hbkRTKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICBjYXNlIDI6CiAgICAgIHRhYmxlRGVsdGFTID0gZ2V0U3RhbmRhcmRUYWJsZSh0ZXh0UmVnaW9uLmh1ZmZtYW5EUyArIDgpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVEZWx0YVMgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBEUyBzZWxlY3RvciIpOwogIH0KICBzd2l0Y2ggKHRleHRSZWdpb24uaHVmZm1hbkRUKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICBjYXNlIDI6CiAgICAgIHRhYmxlRGVsdGFUID0gZ2V0U3RhbmRhcmRUYWJsZSh0ZXh0UmVnaW9uLmh1ZmZtYW5EVCArIDExKTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIHRhYmxlRGVsdGFUID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRFQgc2VsZWN0b3IiKTsKICB9CiAgaWYgKHRleHRSZWdpb24ucmVmaW5lbWVudCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInJlZmluZW1lbnQgd2l0aCBIdWZmbWFuIGlzIG5vdCBzdXBwb3J0ZWQiKTsKICB9CiAgcmV0dXJuIHsKICAgIHN5bWJvbElEVGFibGUsCiAgICB0YWJsZUZpcnN0UywKICAgIHRhYmxlRGVsdGFTLAogICAgdGFibGVEZWx0YVQKICB9Owp9CmZ1bmN0aW9uIGdldFN5bWJvbERpY3Rpb25hcnlIdWZmbWFuVGFibGVzKGRpY3Rpb25hcnksIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcykgewogIGxldCBjdXN0b21JbmRleCA9IDAsCiAgICB0YWJsZURlbHRhSGVpZ2h0LAogICAgdGFibGVEZWx0YVdpZHRoOwogIHN3aXRjaCAoZGljdGlvbmFyeS5odWZmbWFuREhTZWxlY3RvcikgewogICAgY2FzZSAwOgogICAgY2FzZSAxOgogICAgICB0YWJsZURlbHRhSGVpZ2h0ID0gZ2V0U3RhbmRhcmRUYWJsZShkaWN0aW9uYXJ5Lmh1ZmZtYW5ESFNlbGVjdG9yICsgNCk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICB0YWJsZURlbHRhSGVpZ2h0ID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gREggc2VsZWN0b3IiKTsKICB9CiAgc3dpdGNoIChkaWN0aW9uYXJ5Lmh1ZmZtYW5EV1NlbGVjdG9yKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICAgIHRhYmxlRGVsdGFXaWR0aCA9IGdldFN0YW5kYXJkVGFibGUoZGljdGlvbmFyeS5odWZmbWFuRFdTZWxlY3RvciArIDIpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVEZWx0YVdpZHRoID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRFcgc2VsZWN0b3IiKTsKICB9CiAgbGV0IHRhYmxlQml0bWFwU2l6ZSwgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXM7CiAgaWYgKGRpY3Rpb25hcnkuYml0bWFwU2l6ZVNlbGVjdG9yKSB7CiAgICB0YWJsZUJpdG1hcFNpemUgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICBjdXN0b21JbmRleCsrOwogIH0gZWxzZSB7CiAgICB0YWJsZUJpdG1hcFNpemUgPSBnZXRTdGFuZGFyZFRhYmxlKDEpOwogIH0KICBpZiAoZGljdGlvbmFyeS5hZ2dyZWdhdGlvbkluc3RhbmNlc1NlbGVjdG9yKSB7CiAgICB0YWJsZUFnZ3JlZ2F0ZUluc3RhbmNlcyA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICB9IGVsc2UgewogICAgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXMgPSBnZXRTdGFuZGFyZFRhYmxlKDEpOwogIH0KICByZXR1cm4gewogICAgdGFibGVEZWx0YUhlaWdodCwKICAgIHRhYmxlRGVsdGFXaWR0aCwKICAgIHRhYmxlQml0bWFwU2l6ZSwKICAgIHRhYmxlQWdncmVnYXRlSW5zdGFuY2VzCiAgfTsKfQpmdW5jdGlvbiByZWFkVW5jb21wcmVzc2VkQml0bWFwKHJlYWRlciwgd2lkdGgsIGhlaWdodCkgewogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKICAgIGNvbnN0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgcm93W3hdID0gcmVhZGVyLnJlYWRCaXQoKTsKICAgIH0KICAgIHJlYWRlci5ieXRlQWxpZ24oKTsKICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVNTVJCaXRtYXAoaW5wdXQsIHdpZHRoLCBoZWlnaHQsIGVuZE9mQmxvY2spIHsKICBjb25zdCBwYXJhbXMgPSB7CiAgICBLOiAtMSwKICAgIENvbHVtbnM6IHdpZHRoLAogICAgUm93czogaGVpZ2h0LAogICAgQmxhY2tJczE6IHRydWUsCiAgICBFbmRPZkJsb2NrOiBlbmRPZkJsb2NrCiAgfTsKICBjb25zdCBkZWNvZGVyID0gbmV3IENDSVRURmF4RGVjb2RlcihpbnB1dCwgcGFyYW1zKTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBsZXQgY3VycmVudEJ5dGUsCiAgICBlb2YgPSBmYWxzZTsKICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CiAgICBjb25zdCByb3cgPSBuZXcgVWludDhBcnJheSh3aWR0aCk7CiAgICBiaXRtYXAucHVzaChyb3cpOwogICAgbGV0IHNoaWZ0ID0gLTE7CiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgaWYgKHNoaWZ0IDwgMCkgewogICAgICAgIGN1cnJlbnRCeXRlID0gZGVjb2Rlci5yZWFkTmV4dENoYXIoKTsKICAgICAgICBpZiAoY3VycmVudEJ5dGUgPT09IC0xKSB7CiAgICAgICAgICBjdXJyZW50Qnl0ZSA9IDA7CiAgICAgICAgICBlb2YgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBzaGlmdCA9IDc7CiAgICAgIH0KICAgICAgcm93W3hdID0gY3VycmVudEJ5dGUgPj4gc2hpZnQgJiAxOwogICAgICBzaGlmdC0tOwogICAgfQogIH0KICBpZiAoZW5kT2ZCbG9jayAmJiAhZW9mKSB7CiAgICBjb25zdCBsb29rRm9yRU9GTGltaXQgPSA1OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb29rRm9yRU9GTGltaXQ7IGkrKykgewogICAgICBpZiAoZGVjb2Rlci5yZWFkTmV4dENoYXIoKSA9PT0gLTEpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gYml0bWFwOwp9CmNsYXNzIEpiaWcySW1hZ2UgewogIHBhcnNlQ2h1bmtzKGNodW5rcykgewogICAgcmV0dXJuIHBhcnNlSmJpZzJDaHVua3MoY2h1bmtzKTsKICB9CiAgcGFyc2UoZGF0YSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgaW1wbGVtZW50ZWQ6IEpiaWcySW1hZ2UucGFyc2UiKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2piaWcyX3N0cmVhbS5qcwoKCgoKCmNsYXNzIEpiaWcyU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5kaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICB0aGlzLm1heWJlTGVuZ3RoID0gbWF5YmVMZW5ndGg7CiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtczsKICB9CiAgZ2V0IGJ5dGVzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYnl0ZXMiLCB0aGlzLnN0cmVhbS5nZXRCeXRlcyh0aGlzLm1heWJlTGVuZ3RoKSk7CiAgfQogIGVuc3VyZUJ1ZmZlcihyZXF1ZXN0ZWQpIHt9CiAgcmVhZEJsb2NrKCkgewogICAgdGhpcy5kZWNvZGVJbWFnZSgpOwogIH0KICBkZWNvZGVJbWFnZShieXRlcykgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgIH0KICAgIGJ5dGVzIHx8PSB0aGlzLmJ5dGVzOwogICAgY29uc3QgamJpZzJJbWFnZSA9IG5ldyBKYmlnMkltYWdlKCk7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGlmICh0aGlzLnBhcmFtcyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgZ2xvYmFsc1N0cmVhbSA9IHRoaXMucGFyYW1zLmdldCgiSkJJRzJHbG9iYWxzIik7CiAgICAgIGlmIChnbG9iYWxzU3RyZWFtIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnN0IGdsb2JhbHMgPSBnbG9iYWxzU3RyZWFtLmdldEJ5dGVzKCk7CiAgICAgICAgY2h1bmtzLnB1c2goewogICAgICAgICAgZGF0YTogZ2xvYmFscywKICAgICAgICAgIHN0YXJ0OiAwLAogICAgICAgICAgZW5kOiBnbG9iYWxzLmxlbmd0aAogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBjaHVua3MucHVzaCh7CiAgICAgIGRhdGE6IGJ5dGVzLAogICAgICBzdGFydDogMCwKICAgICAgZW5kOiBieXRlcy5sZW5ndGgKICAgIH0pOwogICAgY29uc3QgZGF0YSA9IGpiaWcySW1hZ2UucGFyc2VDaHVua3MoY2h1bmtzKTsKICAgIGNvbnN0IGRhdGFMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgaSsrKSB7CiAgICAgIGRhdGFbaV0gXj0gMHhmZjsKICAgIH0KICAgIHRoaXMuYnVmZmVyID0gZGF0YTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YUxlbmd0aDsKICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICB9CiAgZ2V0IGNhbkFzeW5jRGVjb2RlSW1hZ2VGcm9tQnVmZmVyKCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtLmlzQXN5bmM7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9qcHhfc3RyZWFtLmpzCgoKCmNsYXNzIEpweFN0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMuZGljdCA9IHN0cmVhbS5kaWN0OwogICAgdGhpcy5tYXliZUxlbmd0aCA9IG1heWJlTGVuZ3RoOwogICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7CiAgfQogIGdldCBieXRlcygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImJ5dGVzIiwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZXModGhpcy5tYXliZUxlbmd0aCkpOwogIH0KICBlbnN1cmVCdWZmZXIocmVxdWVzdGVkKSB7fQogIHJlYWRCbG9jayhkZWNvZGVyT3B0aW9ucykgewogICAgdW5yZWFjaGFibGUoIkpweFN0cmVhbS5yZWFkQmxvY2siKTsKICB9CiAgZ2V0IGlzQXN5bmNEZWNvZGVyKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGFzeW5jIGRlY29kZUltYWdlKGJ5dGVzLCBkZWNvZGVyT3B0aW9ucykgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgIH0KICAgIGJ5dGVzIHx8PSB0aGlzLmJ5dGVzOwogICAgdGhpcy5idWZmZXIgPSBhd2FpdCBKcHhJbWFnZS5kZWNvZGUoYnl0ZXMsIGRlY29kZXJPcHRpb25zKTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXIubGVuZ3RoOwogICAgdGhpcy5lb2YgPSB0cnVlOwogICAgcmV0dXJuIHRoaXMuYnVmZmVyOwogIH0KICBnZXQgY2FuQXN5bmNEZWNvZGVJbWFnZUZyb21CdWZmZXIoKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW0uaXNBc3luYzsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2x6d19zdHJlYW0uanMKCmNsYXNzIExaV1N0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCwgZWFybHlDaGFuZ2UpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICB0aGlzLmNhY2hlZERhdGEgPSAwOwogICAgdGhpcy5iaXRzQ2FjaGVkID0gMDsKICAgIGNvbnN0IG1heEx6d0RpY3Rpb25hcnlTaXplID0gNDA5NjsKICAgIGNvbnN0IGx6d1N0YXRlID0gewogICAgICBlYXJseUNoYW5nZSwKICAgICAgY29kZUxlbmd0aDogOSwKICAgICAgbmV4dENvZGU6IDI1OCwKICAgICAgZGljdGlvbmFyeVZhbHVlczogbmV3IFVpbnQ4QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICBkaWN0aW9uYXJ5TGVuZ3RoczogbmV3IFVpbnQxNkFycmF5KG1heEx6d0RpY3Rpb25hcnlTaXplKSwKICAgICAgZGljdGlvbmFyeVByZXZDb2RlczogbmV3IFVpbnQxNkFycmF5KG1heEx6d0RpY3Rpb25hcnlTaXplKSwKICAgICAgY3VycmVudFNlcXVlbmNlOiBuZXcgVWludDhBcnJheShtYXhMendEaWN0aW9uYXJ5U2l6ZSksCiAgICAgIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aDogMAogICAgfTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKICAgICAgbHp3U3RhdGUuZGljdGlvbmFyeVZhbHVlc1tpXSA9IGk7CiAgICAgIGx6d1N0YXRlLmRpY3Rpb25hcnlMZW5ndGhzW2ldID0gMTsKICAgIH0KICAgIHRoaXMubHp3U3RhdGUgPSBsendTdGF0ZTsKICB9CiAgcmVhZEJpdHMobikgewogICAgbGV0IGJpdHNDYWNoZWQgPSB0aGlzLmJpdHNDYWNoZWQ7CiAgICBsZXQgY2FjaGVkRGF0YSA9IHRoaXMuY2FjaGVkRGF0YTsKICAgIHdoaWxlIChiaXRzQ2FjaGVkIDwgbikgewogICAgICBjb25zdCBjID0gdGhpcy5zdHIuZ2V0Qnl0ZSgpOwogICAgICBpZiAoYyA9PT0gLTEpIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY2FjaGVkRGF0YSA9IGNhY2hlZERhdGEgPDwgOCB8IGM7CiAgICAgIGJpdHNDYWNoZWQgKz0gODsKICAgIH0KICAgIHRoaXMuYml0c0NhY2hlZCA9IGJpdHNDYWNoZWQgLT0gbjsKICAgIHRoaXMuY2FjaGVkRGF0YSA9IGNhY2hlZERhdGE7CiAgICB0aGlzLmxhc3RDb2RlID0gbnVsbDsKICAgIHJldHVybiBjYWNoZWREYXRhID4+PiBiaXRzQ2FjaGVkICYgKDEgPDwgbikgLSAxOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCBibG9ja1NpemUgPSA1MTIsCiAgICAgIGRlY29kZWRTaXplRGVsdGEgPSBibG9ja1NpemU7CiAgICBsZXQgZXN0aW1hdGVkRGVjb2RlZFNpemUgPSBibG9ja1NpemUgKiAyOwogICAgbGV0IGksIGosIHE7CiAgICBjb25zdCBsendTdGF0ZSA9IHRoaXMubHp3U3RhdGU7CiAgICBpZiAoIWx6d1N0YXRlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGVhcmx5Q2hhbmdlID0gbHp3U3RhdGUuZWFybHlDaGFuZ2U7CiAgICBsZXQgbmV4dENvZGUgPSBsendTdGF0ZS5uZXh0Q29kZTsKICAgIGNvbnN0IGRpY3Rpb25hcnlWYWx1ZXMgPSBsendTdGF0ZS5kaWN0aW9uYXJ5VmFsdWVzOwogICAgY29uc3QgZGljdGlvbmFyeUxlbmd0aHMgPSBsendTdGF0ZS5kaWN0aW9uYXJ5TGVuZ3RoczsKICAgIGNvbnN0IGRpY3Rpb25hcnlQcmV2Q29kZXMgPSBsendTdGF0ZS5kaWN0aW9uYXJ5UHJldkNvZGVzOwogICAgbGV0IGNvZGVMZW5ndGggPSBsendTdGF0ZS5jb2RlTGVuZ3RoOwogICAgbGV0IHByZXZDb2RlID0gbHp3U3RhdGUucHJldkNvZGU7CiAgICBjb25zdCBjdXJyZW50U2VxdWVuY2UgPSBsendTdGF0ZS5jdXJyZW50U2VxdWVuY2U7CiAgICBsZXQgY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gbHp3U3RhdGUuY3VycmVudFNlcXVlbmNlTGVuZ3RoOwogICAgbGV0IGRlY29kZWRMZW5ndGggPSAwOwogICAgbGV0IGN1cnJlbnRCdWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIGVzdGltYXRlZERlY29kZWRTaXplKTsKICAgIGZvciAoaSA9IDA7IGkgPCBibG9ja1NpemU7IGkrKykgewogICAgICBjb25zdCBjb2RlID0gdGhpcy5yZWFkQml0cyhjb2RlTGVuZ3RoKTsKICAgICAgY29uc3QgaGFzUHJldiA9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA+IDA7CiAgICAgIGlmIChjb2RlIDwgMjU2KSB7CiAgICAgICAgY3VycmVudFNlcXVlbmNlWzBdID0gY29kZTsKICAgICAgICBjdXJyZW50U2VxdWVuY2VMZW5ndGggPSAxOwogICAgICB9IGVsc2UgaWYgKGNvZGUgPj0gMjU4KSB7CiAgICAgICAgaWYgKGNvZGUgPCBuZXh0Q29kZSkgewogICAgICAgICAgY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gZGljdGlvbmFyeUxlbmd0aHNbY29kZV07CiAgICAgICAgICBmb3IgKGogPSBjdXJyZW50U2VxdWVuY2VMZW5ndGggLSAxLCBxID0gY29kZTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgICAgY3VycmVudFNlcXVlbmNlW2pdID0gZGljdGlvbmFyeVZhbHVlc1txXTsKICAgICAgICAgICAgcSA9IGRpY3Rpb25hcnlQcmV2Q29kZXNbcV07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRTZXF1ZW5jZVtjdXJyZW50U2VxdWVuY2VMZW5ndGgrK10gPSBjdXJyZW50U2VxdWVuY2VbMF07CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDI1NikgewogICAgICAgIGNvZGVMZW5ndGggPSA5OwogICAgICAgIG5leHRDb2RlID0gMjU4OwogICAgICAgIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIGRlbGV0ZSB0aGlzLmx6d1N0YXRlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChoYXNQcmV2KSB7CiAgICAgICAgZGljdGlvbmFyeVByZXZDb2Rlc1tuZXh0Q29kZV0gPSBwcmV2Q29kZTsKICAgICAgICBkaWN0aW9uYXJ5TGVuZ3Roc1tuZXh0Q29kZV0gPSBkaWN0aW9uYXJ5TGVuZ3Roc1twcmV2Q29kZV0gKyAxOwogICAgICAgIGRpY3Rpb25hcnlWYWx1ZXNbbmV4dENvZGVdID0gY3VycmVudFNlcXVlbmNlWzBdOwogICAgICAgIG5leHRDb2RlKys7CiAgICAgICAgY29kZUxlbmd0aCA9IG5leHRDb2RlICsgZWFybHlDaGFuZ2UgJiBuZXh0Q29kZSArIGVhcmx5Q2hhbmdlIC0gMSA/IGNvZGVMZW5ndGggOiBNYXRoLm1pbihNYXRoLmxvZyhuZXh0Q29kZSArIGVhcmx5Q2hhbmdlKSAvIDAuNjkzMTQ3MTgwNTU5OTQ1MyArIDEsIDEyKSB8IDA7CiAgICAgIH0KICAgICAgcHJldkNvZGUgPSBjb2RlOwogICAgICBkZWNvZGVkTGVuZ3RoICs9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aDsKICAgICAgaWYgKGVzdGltYXRlZERlY29kZWRTaXplIDwgZGVjb2RlZExlbmd0aCkgewogICAgICAgIGRvIHsKICAgICAgICAgIGVzdGltYXRlZERlY29kZWRTaXplICs9IGRlY29kZWRTaXplRGVsdGE7CiAgICAgICAgfSB3aGlsZSAoZXN0aW1hdGVkRGVjb2RlZFNpemUgPCBkZWNvZGVkTGVuZ3RoKTsKICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIGVzdGltYXRlZERlY29kZWRTaXplKTsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgY3VycmVudFNlcXVlbmNlTGVuZ3RoOyBqKyspIHsKICAgICAgICBidWZmZXJbY3VycmVudEJ1ZmZlckxlbmd0aCsrXSA9IGN1cnJlbnRTZXF1ZW5jZVtqXTsKICAgICAgfQogICAgfQogICAgbHp3U3RhdGUubmV4dENvZGUgPSBuZXh0Q29kZTsKICAgIGx6d1N0YXRlLmNvZGVMZW5ndGggPSBjb2RlTGVuZ3RoOwogICAgbHp3U3RhdGUucHJldkNvZGUgPSBwcmV2Q29kZTsKICAgIGx6d1N0YXRlLmN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aDsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gY3VycmVudEJ1ZmZlckxlbmd0aDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3ByZWRpY3Rvcl9zdHJlYW0uanMKCgoKY2xhc3MgUHJlZGljdG9yU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIGlmICghKHBhcmFtcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBzdHI7CiAgICB9CiAgICBjb25zdCBwcmVkaWN0b3IgPSB0aGlzLnByZWRpY3RvciA9IHBhcmFtcy5nZXQoIlByZWRpY3RvciIpIHx8IDE7CiAgICBpZiAocHJlZGljdG9yIDw9IDEpIHsKICAgICAgcmV0dXJuIHN0cjsKICAgIH0KICAgIGlmIChwcmVkaWN0b3IgIT09IDIgJiYgKHByZWRpY3RvciA8IDEwIHx8IHByZWRpY3RvciA+IDE1KSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFVuc3VwcG9ydGVkIHByZWRpY3RvcjogJHtwcmVkaWN0b3J9YCk7CiAgICB9CiAgICB0aGlzLnJlYWRCbG9jayA9IHByZWRpY3RvciA9PT0gMiA/IHRoaXMucmVhZEJsb2NrVGlmZiA6IHRoaXMucmVhZEJsb2NrUG5nOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzID0gcGFyYW1zLmdldCgiQ29sb3JzIikgfHwgMTsKICAgIGNvbnN0IGJpdHMgPSB0aGlzLmJpdHMgPSBwYXJhbXMuZ2V0KCJCUEMiLCAiQml0c1BlckNvbXBvbmVudCIpIHx8IDg7CiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5jb2x1bW5zID0gcGFyYW1zLmdldCgiQ29sdW1ucyIpIHx8IDE7CiAgICB0aGlzLnBpeEJ5dGVzID0gY29sb3JzICogYml0cyArIDcgPj4gMzsKICAgIHRoaXMucm93Qnl0ZXMgPSBjb2x1bW5zICogY29sb3JzICogYml0cyArIDcgPj4gMzsKICAgIHJldHVybiB0aGlzOwogIH0KICByZWFkQmxvY2tUaWZmKCkgewogICAgY29uc3Qgcm93Qnl0ZXMgPSB0aGlzLnJvd0J5dGVzOwogICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyByb3dCeXRlcyk7CiAgICBjb25zdCBiaXRzID0gdGhpcy5iaXRzOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCByYXdCeXRlcyA9IHRoaXMuc3RyLmdldEJ5dGVzKHJvd0J5dGVzKTsKICAgIHRoaXMuZW9mID0gIXJhd0J5dGVzLmxlbmd0aDsKICAgIGlmICh0aGlzLmVvZikgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgaW5idWYgPSAwLAogICAgICBvdXRidWYgPSAwOwogICAgbGV0IGluYml0cyA9IDAsCiAgICAgIG91dGJpdHMgPSAwOwogICAgbGV0IHBvcyA9IGJ1ZmZlckxlbmd0aDsKICAgIGxldCBpOwogICAgaWYgKGJpdHMgPT09IDEgJiYgY29sb3JzID09PSAxKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgbGV0IGMgPSByYXdCeXRlc1tpXSBeIGluYnVmOwogICAgICAgIGMgXj0gYyA+PiAxOwogICAgICAgIGMgXj0gYyA+PiAyOwogICAgICAgIGMgXj0gYyA+PiA0OwogICAgICAgIGluYnVmID0gKGMgJiAxKSA8PCA3OwogICAgICAgIGJ1ZmZlcltwb3MrK10gPSBjOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGJpdHMgPT09IDgpIHsKICAgICAgZm9yIChpID0gMDsgaSA8IGNvbG9yczsgKytpKSB7CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IHJhd0J5dGVzW2ldOwogICAgICB9CiAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgIGJ1ZmZlcltwb3NdID0gYnVmZmVyW3BvcyAtIGNvbG9yc10gKyByYXdCeXRlc1tpXTsKICAgICAgICBwb3MrKzsKICAgICAgfQogICAgfSBlbHNlIGlmIChiaXRzID09PSAxNikgewogICAgICBjb25zdCBieXRlc1BlclBpeGVsID0gY29sb3JzICogMjsKICAgICAgZm9yIChpID0gMDsgaSA8IGJ5dGVzUGVyUGl4ZWw7ICsraSkgewogICAgICAgIGJ1ZmZlcltwb3MrK10gPSByYXdCeXRlc1tpXTsKICAgICAgfQogICAgICBmb3IgKDsgaSA8IHJvd0J5dGVzOyBpICs9IDIpIHsKICAgICAgICBjb25zdCBzdW0gPSAoKHJhd0J5dGVzW2ldICYgMHhmZikgPDwgOCkgKyAocmF3Qnl0ZXNbaSArIDFdICYgMHhmZikgKyAoKGJ1ZmZlcltwb3MgLSBieXRlc1BlclBpeGVsXSAmIDB4ZmYpIDw8IDgpICsgKGJ1ZmZlcltwb3MgLSBieXRlc1BlclBpeGVsICsgMV0gJiAweGZmKTsKICAgICAgICBidWZmZXJbcG9zKytdID0gc3VtID4+IDggJiAweGZmOwogICAgICAgIGJ1ZmZlcltwb3MrK10gPSBzdW0gJiAweGZmOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjb21wQXJyYXkgPSBuZXcgVWludDhBcnJheShjb2xvcnMgKyAxKTsKICAgICAgY29uc3QgYml0TWFzayA9ICgxIDw8IGJpdHMpIC0gMTsKICAgICAgbGV0IGogPSAwLAogICAgICAgIGsgPSBidWZmZXJMZW5ndGg7CiAgICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbHVtbnM7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb2x1bW5zOyArK2kpIHsKICAgICAgICBmb3IgKGxldCBrayA9IDA7IGtrIDwgY29sb3JzOyArK2trKSB7CiAgICAgICAgICBpZiAoaW5iaXRzIDwgYml0cykgewogICAgICAgICAgICBpbmJ1ZiA9IGluYnVmIDw8IDggfCByYXdCeXRlc1tqKytdICYgMHhmZjsKICAgICAgICAgICAgaW5iaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICBjb21wQXJyYXlba2tdID0gY29tcEFycmF5W2trXSArIChpbmJ1ZiA+PiBpbmJpdHMgLSBiaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICBpbmJpdHMgLT0gYml0czsKICAgICAgICAgIG91dGJ1ZiA9IG91dGJ1ZiA8PCBiaXRzIHwgY29tcEFycmF5W2trXTsKICAgICAgICAgIG91dGJpdHMgKz0gYml0czsKICAgICAgICAgIGlmIChvdXRiaXRzID49IDgpIHsKICAgICAgICAgICAgYnVmZmVyW2srK10gPSBvdXRidWYgPj4gb3V0Yml0cyAtIDggJiAweGZmOwogICAgICAgICAgICBvdXRiaXRzIC09IDg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChvdXRiaXRzID4gMCkgewogICAgICAgIGJ1ZmZlcltrKytdID0gKG91dGJ1ZiA8PCA4IC0gb3V0Yml0cykgKyAoaW5idWYgJiAoMSA8PCA4IC0gb3V0Yml0cykgLSAxKTsKICAgICAgfQogICAgfQogICAgdGhpcy5idWZmZXJMZW5ndGggKz0gcm93Qnl0ZXM7CiAgfQogIHJlYWRCbG9ja1BuZygpIHsKICAgIGNvbnN0IHJvd0J5dGVzID0gdGhpcy5yb3dCeXRlczsKICAgIGNvbnN0IHBpeEJ5dGVzID0gdGhpcy5waXhCeXRlczsKICAgIGNvbnN0IHByZWRpY3RvciA9IHRoaXMuc3RyLmdldEJ5dGUoKTsKICAgIGNvbnN0IHJhd0J5dGVzID0gdGhpcy5zdHIuZ2V0Qnl0ZXMocm93Qnl0ZXMpOwogICAgdGhpcy5lb2YgPSAhcmF3Qnl0ZXMubGVuZ3RoOwogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgcm93Qnl0ZXMpOwogICAgbGV0IHByZXZSb3cgPSBidWZmZXIuc3ViYXJyYXkoYnVmZmVyTGVuZ3RoIC0gcm93Qnl0ZXMsIGJ1ZmZlckxlbmd0aCk7CiAgICBpZiAocHJldlJvdy5sZW5ndGggPT09IDApIHsKICAgICAgcHJldlJvdyA9IG5ldyBVaW50OEFycmF5KHJvd0J5dGVzKTsKICAgIH0KICAgIGxldCBpLAogICAgICBqID0gYnVmZmVyTGVuZ3RoLAogICAgICB1cCwKICAgICAgYzsKICAgIHN3aXRjaCAocHJlZGljdG9yKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2orK10gPSByYXdCeXRlc1tpXTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGl4Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2orK10gPSByYXdCeXRlc1tpXTsKICAgICAgICB9CiAgICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbal0gPSBidWZmZXJbaiAtIHBpeEJ5dGVzXSArIHJhd0J5dGVzW2ldICYgMHhmZjsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2orK10gPSBwcmV2Um93W2ldICsgcmF3Qnl0ZXNbaV0gJiAweGZmOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwaXhCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaisrXSA9IChwcmV2Um93W2ldID4+IDEpICsgcmF3Qnl0ZXNbaV07CiAgICAgICAgfQogICAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2pdID0gKHByZXZSb3dbaV0gKyBidWZmZXJbaiAtIHBpeEJ5dGVzXSA+PiAxKSArIHJhd0J5dGVzW2ldICYgMHhmZjsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgNDoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGl4Qnl0ZXM7ICsraSkgewogICAgICAgICAgdXAgPSBwcmV2Um93W2ldOwogICAgICAgICAgYyA9IHJhd0J5dGVzW2ldOwogICAgICAgICAgYnVmZmVyW2orK10gPSB1cCArIGM7CiAgICAgICAgfQogICAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgdXAgPSBwcmV2Um93W2ldOwogICAgICAgICAgY29uc3QgdXBMZWZ0ID0gcHJldlJvd1tpIC0gcGl4Qnl0ZXNdOwogICAgICAgICAgY29uc3QgbGVmdCA9IGJ1ZmZlcltqIC0gcGl4Qnl0ZXNdOwogICAgICAgICAgY29uc3QgcCA9IGxlZnQgKyB1cCAtIHVwTGVmdDsKICAgICAgICAgIGxldCBwYSA9IHAgLSBsZWZ0OwogICAgICAgICAgaWYgKHBhIDwgMCkgewogICAgICAgICAgICBwYSA9IC1wYTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBwYiA9IHAgLSB1cDsKICAgICAgICAgIGlmIChwYiA8IDApIHsKICAgICAgICAgICAgcGIgPSAtcGI7CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgcGMgPSBwIC0gdXBMZWZ0OwogICAgICAgICAgaWYgKHBjIDwgMCkgewogICAgICAgICAgICBwYyA9IC1wYzsKICAgICAgICAgIH0KICAgICAgICAgIGMgPSByYXdCeXRlc1tpXTsKICAgICAgICAgIGlmIChwYSA8PSBwYiAmJiBwYSA8PSBwYykgewogICAgICAgICAgICBidWZmZXJbaisrXSA9IGxlZnQgKyBjOwogICAgICAgICAgfSBlbHNlIGlmIChwYiA8PSBwYykgewogICAgICAgICAgICBidWZmZXJbaisrXSA9IHVwICsgYzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gdXBMZWZ0ICsgYzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbnN1cHBvcnRlZCBwcmVkaWN0b3I6ICR7cHJlZGljdG9yfWApOwogICAgfQogICAgdGhpcy5idWZmZXJMZW5ndGggKz0gcm93Qnl0ZXM7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9ydW5fbGVuZ3RoX3N0cmVhbS5qcwoKY2xhc3MgUnVuTGVuZ3RoU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0ciA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCByZXBlYXRIZWFkZXIgPSB0aGlzLnN0ci5nZXRCeXRlcygyKTsKICAgIGlmICghcmVwZWF0SGVhZGVyIHx8IHJlcGVhdEhlYWRlci5sZW5ndGggPCAyIHx8IHJlcGVhdEhlYWRlclswXSA9PT0gMTI4KSB7CiAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGJ1ZmZlcjsKICAgIGxldCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGxldCBuID0gcmVwZWF0SGVhZGVyWzBdOwogICAgaWYgKG4gPCAxMjgpIHsKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgbiArIDEpOwogICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoKytdID0gcmVwZWF0SGVhZGVyWzFdOwogICAgICBpZiAobiA+IDApIHsKICAgICAgICBjb25zdCBzb3VyY2UgPSB0aGlzLnN0ci5nZXRCeXRlcyhuKTsKICAgICAgICBidWZmZXIuc2V0KHNvdXJjZSwgYnVmZmVyTGVuZ3RoKTsKICAgICAgICBidWZmZXJMZW5ndGggKz0gbjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbiA9IDI1NyAtIG47CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIG4gKyAxKTsKICAgICAgYnVmZmVyLmZpbGwocmVwZWF0SGVhZGVyWzFdLCBidWZmZXJMZW5ndGgsIGJ1ZmZlckxlbmd0aCArIG4pOwogICAgICBidWZmZXJMZW5ndGggKz0gbjsKICAgIH0KICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvcGFyc2VyLmpzCgoKCgoKCgoKCgoKCgoKY29uc3QgTUFYX0xFTkdUSF9UT19DQUNIRSA9IDEwMDA7CmZ1bmN0aW9uIGdldElubGluZUltYWdlQ2FjaGVLZXkoYnl0ZXMpIHsKICBjb25zdCBzdHJCdWYgPSBbXSwKICAgIGlpID0gYnl0ZXMubGVuZ3RoOwogIGxldCBpID0gMDsKICB3aGlsZSAoaSA8IGlpIC0gMSkgewogICAgc3RyQnVmLnB1c2goYnl0ZXNbaSsrXSA8PCA4IHwgYnl0ZXNbaSsrXSk7CiAgfQogIGlmIChpIDwgaWkpIHsKICAgIHN0ckJ1Zi5wdXNoKGJ5dGVzW2ldKTsKICB9CiAgcmV0dXJuIGlpICsgIl8iICsgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBzdHJCdWYpOwp9CmNsYXNzIFBhcnNlciB7CiAgY29uc3RydWN0b3IoewogICAgbGV4ZXIsCiAgICB4cmVmLAogICAgYWxsb3dTdHJlYW1zID0gZmFsc2UsCiAgICByZWNvdmVyeU1vZGUgPSBmYWxzZQogIH0pIHsKICAgIHRoaXMubGV4ZXIgPSBsZXhlcjsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLmFsbG93U3RyZWFtcyA9IGFsbG93U3RyZWFtczsKICAgIHRoaXMucmVjb3ZlcnlNb2RlID0gcmVjb3ZlcnlNb2RlOwogICAgdGhpcy5pbWFnZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuX2ltYWdlSWQgPSAwOwogICAgdGhpcy5yZWZpbGwoKTsKICB9CiAgcmVmaWxsKCkgewogICAgdGhpcy5idWYxID0gdGhpcy5sZXhlci5nZXRPYmooKTsKICAgIHRoaXMuYnVmMiA9IHRoaXMubGV4ZXIuZ2V0T2JqKCk7CiAgfQogIHNoaWZ0KCkgewogICAgaWYgKHRoaXMuYnVmMiBpbnN0YW5jZW9mIENtZCAmJiB0aGlzLmJ1ZjIuY21kID09PSAiSUQiKSB7CiAgICAgIHRoaXMuYnVmMSA9IHRoaXMuYnVmMjsKICAgICAgdGhpcy5idWYyID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYnVmMSA9IHRoaXMuYnVmMjsKICAgICAgdGhpcy5idWYyID0gdGhpcy5sZXhlci5nZXRPYmooKTsKICAgIH0KICB9CiAgdHJ5U2hpZnQoKSB7CiAgICB0cnkgewogICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAoZSBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIGdldE9iaihjaXBoZXJUcmFuc2Zvcm0gPSBudWxsKSB7CiAgICBjb25zdCBidWYxID0gdGhpcy5idWYxOwogICAgdGhpcy5zaGlmdCgpOwogICAgaWYgKGJ1ZjEgaW5zdGFuY2VvZiBDbWQpIHsKICAgICAgc3dpdGNoIChidWYxLmNtZCkgewogICAgICAgIGNhc2UgIkJJIjoKICAgICAgICAgIHJldHVybiB0aGlzLm1ha2VJbmxpbmVJbWFnZShjaXBoZXJUcmFuc2Zvcm0pOwogICAgICAgIGNhc2UgIlsiOgogICAgICAgICAgY29uc3QgYXJyYXkgPSBbXTsKICAgICAgICAgIHdoaWxlICghaXNDbWQodGhpcy5idWYxLCAiXSIpICYmIHRoaXMuYnVmMSAhPT0gRU9GKSB7CiAgICAgICAgICAgIGFycmF5LnB1c2godGhpcy5nZXRPYmooY2lwaGVyVHJhbnNmb3JtKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5idWYxID09PSBFT0YpIHsKICAgICAgICAgICAgaWYgKHRoaXMucmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBQYXJzZXJFT0ZFeGNlcHRpb24oIkVuZCBvZiBmaWxlIGluc2lkZSBhcnJheS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgIHJldHVybiBhcnJheTsKICAgICAgICBjYXNlICI8PCI6CiAgICAgICAgICBjb25zdCBkaWN0ID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgICAgICAgIHdoaWxlICghaXNDbWQodGhpcy5idWYxLCAiPj4iKSAmJiB0aGlzLmJ1ZjEgIT09IEVPRikgewogICAgICAgICAgICBpZiAoISh0aGlzLmJ1ZjEgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICAgICAgICAgIGluZm8oIk1hbGZvcm1lZCBkaWN0aW9uYXJ5OiBrZXkgbXVzdCBiZSBhIG5hbWUgb2JqZWN0Iik7CiAgICAgICAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGtleSA9IHRoaXMuYnVmMS5uYW1lOwogICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZjEgPT09IEVPRikgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRpY3Quc2V0KGtleSwgdGhpcy5nZXRPYmooY2lwaGVyVHJhbnNmb3JtKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5idWYxID09PSBFT0YpIHsKICAgICAgICAgICAgaWYgKHRoaXMucmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRpY3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IFBhcnNlckVPRkV4Y2VwdGlvbigiRW5kIG9mIGZpbGUgaW5zaWRlIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNDbWQodGhpcy5idWYyLCAic3RyZWFtIikpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWxsb3dTdHJlYW1zID8gdGhpcy5tYWtlU3RyZWFtKGRpY3QsIGNpcGhlclRyYW5zZm9ybSkgOiBkaWN0OwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgICAgcmV0dXJuIGRpY3Q7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBidWYxOwogICAgICB9CiAgICB9CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihidWYxKSkgewogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcih0aGlzLmJ1ZjEpICYmIGlzQ21kKHRoaXMuYnVmMiwgIlIiKSkgewogICAgICAgIGNvbnN0IHJlZiA9IFJlZi5nZXQoYnVmMSwgdGhpcy5idWYxKTsKICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgIHJldHVybiByZWY7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjE7CiAgICB9CiAgICBpZiAodHlwZW9mIGJ1ZjEgPT09ICJzdHJpbmciKSB7CiAgICAgIGlmIChjaXBoZXJUcmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gY2lwaGVyVHJhbnNmb3JtLmRlY3J5cHRTdHJpbmcoYnVmMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjE7CiAgICB9CiAgICByZXR1cm4gYnVmMTsKICB9CiAgZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBFID0gMHg0NSwKICAgICAgSSA9IDB4NDksCiAgICAgIFNQQUNFID0gMHgyMCwKICAgICAgTEYgPSAweGEsCiAgICAgIENSID0gMHhkLAogICAgICBOVUwgPSAweDA7CiAgICBjb25zdCB7CiAgICAgICAga25vd25Db21tYW5kcwogICAgICB9ID0gdGhpcy5sZXhlciwKICAgICAgc3RhcnRQb3MgPSBzdHJlYW0ucG9zLAogICAgICBuID0gMTU7CiAgICBsZXQgc3RhdGUgPSAwLAogICAgICBjaCwKICAgICAgbWF5YmVFSVBvczsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKHN0YXRlID09PSAwKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gRSA/IDEgOiAwOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAxKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gSSA/IDIgOiAwOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChjaCA9PT0gU1BBQ0UgfHwgY2ggPT09IExGIHx8IGNoID09PSBDUikgewogICAgICAgICAgbWF5YmVFSVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgICBjb25zdCBmb2xsb3dpbmdCeXRlcyA9IHN0cmVhbS5wZWVrQnl0ZXMobik7CiAgICAgICAgICBjb25zdCBpaSA9IGZvbGxvd2luZ0J5dGVzLmxlbmd0aDsKICAgICAgICAgIGlmIChpaSA9PT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBjaCA9IGZvbGxvd2luZ0J5dGVzW2ldOwogICAgICAgICAgICBpZiAoY2ggPT09IE5VTCAmJiBmb2xsb3dpbmdCeXRlc1tpICsgMV0gIT09IE5VTCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaCAhPT0gTEYgJiYgY2ggIT09IENSICYmIChjaCA8IFNQQUNFIHx8IGNoID4gMHg3ZikpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IDA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZSAhPT0gMikgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgha25vd25Db21tYW5kcykgewogICAgICAgICAgICB3YXJuKCJmaW5kRGVmYXVsdElubGluZVN0cmVhbUVuZCAtIGBsZXhlci5rbm93bkNvbW1hbmRzYCBpcyB1bmRlZmluZWQuIik7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgdG1wTGV4ZXIgPSBuZXcgTGV4ZXIobmV3IFN0cmVhbShzdHJlYW0ucGVla0J5dGVzKDUgKiBuKSksIGtub3duQ29tbWFuZHMpOwogICAgICAgICAgdG1wTGV4ZXIuX2hleFN0cmluZ1dhcm4gPSAoKSA9PiB7fTsKICAgICAgICAgIGxldCBudW1BcmdzID0gMDsKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGNvbnN0IG5leHRPYmogPSB0bXBMZXhlci5nZXRPYmooKTsKICAgICAgICAgICAgaWYgKG5leHRPYmogPT09IEVPRikgewogICAgICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV4dE9iaiBpbnN0YW5jZW9mIENtZCkgewogICAgICAgICAgICAgIGNvbnN0IGtub3duQ29tbWFuZCA9IGtub3duQ29tbWFuZHNbbmV4dE9iai5jbWRdOwogICAgICAgICAgICAgIGlmICgha25vd25Db21tYW5kKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IDA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtub3duQ29tbWFuZC52YXJpYWJsZUFyZ3MgPyBudW1BcmdzIDw9IGtub3duQ29tbWFuZC5udW1BcmdzIDogbnVtQXJncyA9PT0ga25vd25Db21tYW5kLm51bUFyZ3MpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBudW1BcmdzID0gMDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBudW1BcmdzKys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChjaCA9PT0gLTEpIHsKICAgICAgd2FybigiZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQ6ICIgKyAiUmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBzdHJlYW0gd2l0aG91dCBmaW5kaW5nIGEgdmFsaWQgRUkgbWFya2VyIik7CiAgICAgIGlmIChtYXliZUVJUG9zKSB7CiAgICAgICAgd2FybignLi4uIHRyeWluZyB0byByZWNvdmVyIGJ5IHVzaW5nIHRoZSBsYXN0ICJFSSIgb2NjdXJyZW5jZS4nKTsKICAgICAgICBzdHJlYW0uc2tpcCgtKHN0cmVhbS5wb3MgLSBtYXliZUVJUG9zKSk7CiAgICAgIH0KICAgIH0KICAgIGxldCBlbmRPZmZzZXQgPSA0OwogICAgc3RyZWFtLnNraXAoLWVuZE9mZnNldCk7CiAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgc3RyZWFtLnNraXAoZW5kT2Zmc2V0KTsKICAgIGlmICghaXNXaGl0ZVNwYWNlKGNoKSkgewogICAgICBlbmRPZmZzZXQtLTsKICAgIH0KICAgIHJldHVybiBzdHJlYW0ucG9zIC0gZW5kT2Zmc2V0IC0gc3RhcnRQb3M7CiAgfQogIGZpbmREQ1REZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgZm91bmRFT0kgPSBmYWxzZSwKICAgICAgYiwKICAgICAgbWFya2VyTGVuZ3RoOwogICAgd2hpbGUgKChiID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChiICE9PSAweGZmKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChzdHJlYW0uZ2V0Qnl0ZSgpKSB7CiAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmOgogICAgICAgICAgc3RyZWFtLnNraXAoLTEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGQ5OgogICAgICAgICAgZm91bmRFT0kgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGMwOgogICAgICAgIGNhc2UgMHhjMToKICAgICAgICBjYXNlIDB4YzI6CiAgICAgICAgY2FzZSAweGMzOgogICAgICAgIGNhc2UgMHhjNToKICAgICAgICBjYXNlIDB4YzY6CiAgICAgICAgY2FzZSAweGM3OgogICAgICAgIGNhc2UgMHhjOToKICAgICAgICBjYXNlIDB4Y2E6CiAgICAgICAgY2FzZSAweGNiOgogICAgICAgIGNhc2UgMHhjZDoKICAgICAgICBjYXNlIDB4Y2U6CiAgICAgICAgY2FzZSAweGNmOgogICAgICAgIGNhc2UgMHhjNDoKICAgICAgICBjYXNlIDB4Y2M6CiAgICAgICAgY2FzZSAweGRhOgogICAgICAgIGNhc2UgMHhkYjoKICAgICAgICBjYXNlIDB4ZGM6CiAgICAgICAgY2FzZSAweGRkOgogICAgICAgIGNhc2UgMHhkZToKICAgICAgICBjYXNlIDB4ZGY6CiAgICAgICAgY2FzZSAweGUwOgogICAgICAgIGNhc2UgMHhlMToKICAgICAgICBjYXNlIDB4ZTI6CiAgICAgICAgY2FzZSAweGUzOgogICAgICAgIGNhc2UgMHhlNDoKICAgICAgICBjYXNlIDB4ZTU6CiAgICAgICAgY2FzZSAweGU2OgogICAgICAgIGNhc2UgMHhlNzoKICAgICAgICBjYXNlIDB4ZTg6CiAgICAgICAgY2FzZSAweGU5OgogICAgICAgIGNhc2UgMHhlYToKICAgICAgICBjYXNlIDB4ZWI6CiAgICAgICAgY2FzZSAweGVjOgogICAgICAgIGNhc2UgMHhlZDoKICAgICAgICBjYXNlIDB4ZWU6CiAgICAgICAgY2FzZSAweGVmOgogICAgICAgIGNhc2UgMHhmZToKICAgICAgICAgIG1hcmtlckxlbmd0aCA9IHN0cmVhbS5nZXRVaW50MTYoKTsKICAgICAgICAgIGlmIChtYXJrZXJMZW5ndGggPiAyKSB7CiAgICAgICAgICAgIHN0cmVhbS5za2lwKG1hcmtlckxlbmd0aCAtIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RyZWFtLnNraXAoLTIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGZvdW5kRU9JKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGxlbmd0aCA9IHN0cmVhbS5wb3MgLSBzdGFydFBvczsKICAgIGlmIChiID09PSAtMSkgewogICAgICB3YXJuKCJJbmxpbmUgRENURGVjb2RlIGltYWdlIHN0cmVhbTogIiArICJFT0kgbWFya2VyIG5vdCBmb3VuZCwgc2VhcmNoaW5nIGZvciAvRUkvIGluc3RlYWQuIik7CiAgICAgIHN0cmVhbS5za2lwKC1sZW5ndGgpOwogICAgICByZXR1cm4gdGhpcy5maW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgfQogICAgdGhpcy5pbmxpbmVTdHJlYW1Ta2lwRUkoc3RyZWFtKTsKICAgIHJldHVybiBsZW5ndGg7CiAgfQogIGZpbmRBU0NJSTg1RGVjb2RlSW5saW5lU3RyZWFtRW5kKHN0cmVhbSkgewogICAgY29uc3QgVElMREUgPSAweDdlLAogICAgICBHVCA9IDB4M2U7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChjaCA9PT0gVElMREUpIHsKICAgICAgICBjb25zdCB0aWxkZVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgY2ggPSBzdHJlYW0ucGVla0J5dGUoKTsKICAgICAgICB3aGlsZSAoaXNXaGl0ZVNwYWNlKGNoKSkgewogICAgICAgICAgc3RyZWFtLnNraXAoKTsKICAgICAgICAgIGNoID0gc3RyZWFtLnBlZWtCeXRlKCk7CiAgICAgICAgfQogICAgICAgIGlmIChjaCA9PT0gR1QpIHsKICAgICAgICAgIHN0cmVhbS5za2lwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbS5wb3MgPiB0aWxkZVBvcykgewogICAgICAgICAgY29uc3QgbWF5YmVFSSA9IHN0cmVhbS5wZWVrQnl0ZXMoMik7CiAgICAgICAgICBpZiAobWF5YmVFSVswXSA9PT0gMHg0NSAmJiBtYXliZUVJWzFdID09PSAweDQ5KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgbGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgaWYgKGNoID09PSAtMSkgewogICAgICB3YXJuKCJJbmxpbmUgQVNDSUk4NURlY29kZSBpbWFnZSBzdHJlYW06ICIgKyAiRU9EIG1hcmtlciBub3QgZm91bmQsIHNlYXJjaGluZyBmb3IgL0VJLyBpbnN0ZWFkLiIpOwogICAgICBzdHJlYW0uc2tpcCgtbGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgIH0KICAgIHRoaXMuaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSk7CiAgICByZXR1cm4gbGVuZ3RoOwogIH0KICBmaW5kQVNDSUlIZXhEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBHVCA9IDB4M2U7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChjaCA9PT0gR1QpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgY29uc3QgbGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgaWYgKGNoID09PSAtMSkgewogICAgICB3YXJuKCJJbmxpbmUgQVNDSUlIZXhEZWNvZGUgaW1hZ2Ugc3RyZWFtOiAiICsgIkVPRCBtYXJrZXIgbm90IGZvdW5kLCBzZWFyY2hpbmcgZm9yIC9FSS8gaW5zdGVhZC4iKTsKICAgICAgc3RyZWFtLnNraXAoLWxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzLmZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICB9CiAgICB0aGlzLmlubGluZVN0cmVhbVNraXBFSShzdHJlYW0pOwogICAgcmV0dXJuIGxlbmd0aDsKICB9CiAgaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSkgewogICAgY29uc3QgRSA9IDB4NDUsCiAgICAgIEkgPSAweDQ5OwogICAgbGV0IHN0YXRlID0gMCwKICAgICAgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChzdGF0ZSA9PT0gMCkgewogICAgICAgIHN0YXRlID0gY2ggPT09IEUgPyAxIDogMDsKICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gMSkgewogICAgICAgIHN0YXRlID0gY2ggPT09IEkgPyAyIDogMDsKICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gMikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIG1ha2VJbmxpbmVJbWFnZShjaXBoZXJUcmFuc2Zvcm0pIHsKICAgIGNvbnN0IGxleGVyID0gdGhpcy5sZXhlcjsKICAgIGNvbnN0IHN0cmVhbSA9IGxleGVyLnN0cmVhbTsKICAgIGNvbnN0IGRpY3RNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbGV0IGRpY3RMZW5ndGg7CiAgICB3aGlsZSAoIWlzQ21kKHRoaXMuYnVmMSwgIklEIikgJiYgdGhpcy5idWYxICE9PSBFT0YpIHsKICAgICAgaWYgKCEodGhpcy5idWYxIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkRpY3Rpb25hcnkga2V5IG11c3QgYmUgYSBuYW1lIG9iamVjdCIpOwogICAgICB9CiAgICAgIGNvbnN0IGtleSA9IHRoaXMuYnVmMS5uYW1lOwogICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgIGlmICh0aGlzLmJ1ZjEgPT09IEVPRikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGRpY3RNYXBba2V5XSA9IHRoaXMuZ2V0T2JqKGNpcGhlclRyYW5zZm9ybSk7CiAgICB9CiAgICBpZiAobGV4ZXIuYmVnaW5JbmxpbmVJbWFnZVBvcyAhPT0gLTEpIHsKICAgICAgZGljdExlbmd0aCA9IHN0cmVhbS5wb3MgLSBsZXhlci5iZWdpbklubGluZUltYWdlUG9zOwogICAgfQogICAgY29uc3QgZmlsdGVyID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZGljdE1hcC5GIHx8IGRpY3RNYXAuRmlsdGVyKTsKICAgIGxldCBmaWx0ZXJOYW1lOwogICAgaWYgKGZpbHRlciBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlci5uYW1lOwogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHsKICAgICAgY29uc3QgZmlsdGVyWmVybyA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZpbHRlclswXSk7CiAgICAgIGlmIChmaWx0ZXJaZXJvIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGZpbHRlck5hbWUgPSBmaWx0ZXJaZXJvLm5hbWU7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICAgIGxldCBsZW5ndGg7CiAgICBzd2l0Y2ggKGZpbHRlck5hbWUpIHsKICAgICAgY2FzZSAiRENUIjoKICAgICAgY2FzZSAiRENURGVjb2RlIjoKICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmREQ1REZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiQTg1IjoKICAgICAgY2FzZSAiQVNDSUk4NURlY29kZSI6CiAgICAgICAgbGVuZ3RoID0gdGhpcy5maW5kQVNDSUk4NURlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJBSHgiOgogICAgICBjYXNlICJBU0NJSUhleERlY29kZSI6CiAgICAgICAgbGVuZ3RoID0gdGhpcy5maW5kQVNDSUlIZXhEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICB9CiAgICBsZXQgY2FjaGVLZXk7CiAgICBpZiAobGVuZ3RoIDwgTUFYX0xFTkdUSF9UT19DQUNIRSAmJiBkaWN0TGVuZ3RoID4gMCkgewogICAgICBjb25zdCBpbml0aWFsU3RyZWFtUG9zID0gc3RyZWFtLnBvczsKICAgICAgc3RyZWFtLnBvcyA9IGxleGVyLmJlZ2luSW5saW5lSW1hZ2VQb3M7CiAgICAgIGNhY2hlS2V5ID0gZ2V0SW5saW5lSW1hZ2VDYWNoZUtleShzdHJlYW0uZ2V0Qnl0ZXMoZGljdExlbmd0aCArIGxlbmd0aCkpOwogICAgICBzdHJlYW0ucG9zID0gaW5pdGlhbFN0cmVhbVBvczsKICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IHRoaXMuaW1hZ2VDYWNoZVtjYWNoZUtleV07CiAgICAgIGlmIChjYWNoZUVudHJ5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLmJ1ZjIgPSBDbWQuZ2V0KCJFSSIpOwogICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICBjYWNoZUVudHJ5LnJlc2V0KCk7CiAgICAgICAgcmV0dXJuIGNhY2hlRW50cnk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgZm9yIChjb25zdCBrZXkgaW4gZGljdE1hcCkgewogICAgICBkaWN0LnNldChrZXksIGRpY3RNYXBba2V5XSk7CiAgICB9CiAgICBsZXQgaW1hZ2VTdHJlYW0gPSBzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydFBvcywgbGVuZ3RoLCBkaWN0KTsKICAgIGlmIChjaXBoZXJUcmFuc2Zvcm0pIHsKICAgICAgaW1hZ2VTdHJlYW0gPSBjaXBoZXJUcmFuc2Zvcm0uY3JlYXRlU3RyZWFtKGltYWdlU3RyZWFtLCBsZW5ndGgpOwogICAgfQogICAgaW1hZ2VTdHJlYW0gPSB0aGlzLmZpbHRlcihpbWFnZVN0cmVhbSwgZGljdCwgbGVuZ3RoKTsKICAgIGltYWdlU3RyZWFtLmRpY3QgPSBkaWN0OwogICAgaWYgKGNhY2hlS2V5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaW1hZ2VTdHJlYW0uY2FjaGVLZXkgPSBgaW5saW5lX2ltZ18keysrdGhpcy5faW1hZ2VJZH1gOwogICAgICB0aGlzLmltYWdlQ2FjaGVbY2FjaGVLZXldID0gaW1hZ2VTdHJlYW07CiAgICB9CiAgICB0aGlzLmJ1ZjIgPSBDbWQuZ2V0KCJFSSIpOwogICAgdGhpcy5zaGlmdCgpOwogICAgcmV0dXJuIGltYWdlU3RyZWFtOwogIH0KICAjZmluZFN0cmVhbUxlbmd0aChzdGFydFBvcykgewogICAgY29uc3QgewogICAgICBzdHJlYW0KICAgIH0gPSB0aGlzLmxleGVyOwogICAgc3RyZWFtLnBvcyA9IHN0YXJ0UG9zOwogICAgY29uc3QgU0NBTl9CTE9DS19MRU5HVEggPSAyMDQ4OwogICAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gImVuZHN0cmVhbSIubGVuZ3RoOwogICAgY29uc3QgRU5EX1NJR05BVFVSRSA9IG5ldyBVaW50OEFycmF5KFsweDY1LCAweDZlLCAweDY0XSk7CiAgICBjb25zdCBlbmRMZW5ndGggPSBFTkRfU0lHTkFUVVJFLmxlbmd0aDsKICAgIGNvbnN0IFBBUlRJQUxfU0lHTkFUVVJFID0gW25ldyBVaW50OEFycmF5KFsweDczLCAweDc0LCAweDcyLCAweDY1LCAweDYxLCAweDZkXSksIG5ldyBVaW50OEFycmF5KFsweDczLCAweDc0LCAweDY1LCAweDYxLCAweDZkXSksIG5ldyBVaW50OEFycmF5KFsweDczLCAweDc0LCAweDcyLCAweDY1LCAweDYxXSldOwogICAgY29uc3Qgbm9ybWFsTGVuZ3RoID0gc2lnbmF0dXJlTGVuZ3RoIC0gZW5kTGVuZ3RoOwogICAgd2hpbGUgKHN0cmVhbS5wb3MgPCBzdHJlYW0uZW5kKSB7CiAgICAgIGNvbnN0IHNjYW5CeXRlcyA9IHN0cmVhbS5wZWVrQnl0ZXMoU0NBTl9CTE9DS19MRU5HVEgpOwogICAgICBjb25zdCBzY2FuTGVuZ3RoID0gc2NhbkJ5dGVzLmxlbmd0aCAtIHNpZ25hdHVyZUxlbmd0aDsKICAgICAgaWYgKHNjYW5MZW5ndGggPD0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGxldCBwb3MgPSAwOwogICAgICB3aGlsZSAocG9zIDwgc2Nhbkxlbmd0aCkgewogICAgICAgIGxldCBqID0gMDsKICAgICAgICB3aGlsZSAoaiA8IGVuZExlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zICsgal0gPT09IEVORF9TSUdOQVRVUkVbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgaWYgKGogPj0gZW5kTGVuZ3RoKSB7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBQQVJUSUFMX1NJR05BVFVSRSkgewogICAgICAgICAgICBjb25zdCBwYXJ0TGVuID0gcGFydC5sZW5ndGg7CiAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgd2hpbGUgKGsgPCBwYXJ0TGVuICYmIHNjYW5CeXRlc1twb3MgKyBqICsga10gPT09IHBhcnRba10pIHsKICAgICAgICAgICAgICBrKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGsgPj0gbm9ybWFsTGVuZ3RoKSB7CiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChrID49IHBhcnRMZW4pIHsKICAgICAgICAgICAgICBjb25zdCBsYXN0Qnl0ZSA9IHNjYW5CeXRlc1twb3MgKyBqICsga107CiAgICAgICAgICAgICAgaWYgKGlzV2hpdGVTcGFjZShsYXN0Qnl0ZSkpIHsKICAgICAgICAgICAgICAgIGluZm8oYEZvdW5kICIke2J5dGVzVG9TdHJpbmcoWy4uLkVORF9TSUdOQVRVUkUsIC4uLnBhcnRdKX0iIHdoZW4gYCArICJzZWFyY2hpbmcgZm9yIGVuZHN0cmVhbSBjb21tYW5kLiIpOwogICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGZvdW5kKSB7CiAgICAgICAgICAgIHN0cmVhbS5wb3MgKz0gcG9zOwogICAgICAgICAgICByZXR1cm4gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwb3MrKzsKICAgICAgfQogICAgICBzdHJlYW0ucG9zICs9IHNjYW5MZW5ndGg7CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIG1ha2VTdHJlYW0oZGljdCwgY2lwaGVyVHJhbnNmb3JtKSB7CiAgICBjb25zdCBsZXhlciA9IHRoaXMubGV4ZXI7CiAgICBsZXQgc3RyZWFtID0gbGV4ZXIuc3RyZWFtOwogICAgbGV4ZXIuc2tpcFRvTmV4dExpbmUoKTsKICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvcyAtIDE7CiAgICBsZXQgbGVuZ3RoID0gZGljdC5nZXQoIkxlbmd0aCIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGxlbmd0aCkpIHsKICAgICAgaW5mbyhgQmFkIGxlbmd0aCAiJHtsZW5ndGggJiYgbGVuZ3RoLnRvU3RyaW5nKCl9IiBpbiBzdHJlYW0uYCk7CiAgICAgIGxlbmd0aCA9IDA7CiAgICB9CiAgICBzdHJlYW0ucG9zID0gc3RhcnRQb3MgKyBsZW5ndGg7CiAgICBsZXhlci5uZXh0Q2hhcigpOwogICAgaWYgKHRoaXMudHJ5U2hpZnQoKSAmJiBpc0NtZCh0aGlzLmJ1ZjIsICJlbmRzdHJlYW0iKSkgewogICAgICB0aGlzLnNoaWZ0KCk7CiAgICB9IGVsc2UgewogICAgICBsZW5ndGggPSB0aGlzLiNmaW5kU3RyZWFtTGVuZ3RoKHN0YXJ0UG9zKTsKICAgICAgaWYgKGxlbmd0aCA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk1pc3NpbmcgZW5kc3RyZWFtIGNvbW1hbmQuIik7CiAgICAgIH0KICAgICAgbGV4ZXIubmV4dENoYXIoKTsKICAgICAgdGhpcy5zaGlmdCgpOwogICAgICB0aGlzLnNoaWZ0KCk7CiAgICB9CiAgICB0aGlzLnNoaWZ0KCk7CiAgICBzdHJlYW0gPSBzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydFBvcywgbGVuZ3RoLCBkaWN0KTsKICAgIGlmIChjaXBoZXJUcmFuc2Zvcm0pIHsKICAgICAgc3RyZWFtID0gY2lwaGVyVHJhbnNmb3JtLmNyZWF0ZVN0cmVhbShzdHJlYW0sIGxlbmd0aCk7CiAgICB9CiAgICBzdHJlYW0gPSB0aGlzLmZpbHRlcihzdHJlYW0sIGRpY3QsIGxlbmd0aCk7CiAgICBzdHJlYW0uZGljdCA9IGRpY3Q7CiAgICByZXR1cm4gc3RyZWFtOwogIH0KICBmaWx0ZXIoc3RyZWFtLCBkaWN0LCBsZW5ndGgpIHsKICAgIGxldCBmaWx0ZXIgPSBkaWN0LmdldCgiRiIsICJGaWx0ZXIiKTsKICAgIGxldCBwYXJhbXMgPSBkaWN0LmdldCgiRFAiLCAiRGVjb2RlUGFybXMiKTsKICAgIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtcykpIHsKICAgICAgICB3YXJuKCIvRGVjb2RlUGFybXMgc2hvdWxkIG5vdCBiZSBhbiBBcnJheSwgd2hlbiAvRmlsdGVyIGlzIGEgTmFtZS4iKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5tYWtlRmlsdGVyKHN0cmVhbSwgZmlsdGVyLm5hbWUsIGxlbmd0aCwgcGFyYW1zKTsKICAgIH0KICAgIGxldCBtYXliZUxlbmd0aCA9IGxlbmd0aDsKICAgIGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHsKICAgICAgY29uc3QgZmlsdGVyQXJyYXkgPSBmaWx0ZXI7CiAgICAgIGNvbnN0IHBhcmFtc0FycmF5ID0gcGFyYW1zOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmaWx0ZXJBcnJheS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgZmlsdGVyID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZmlsdGVyQXJyYXlbaV0pOwogICAgICAgIGlmICghKGZpbHRlciBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEJhZCBmaWx0ZXIgbmFtZSAiJHtmaWx0ZXJ9ImApOwogICAgICAgIH0KICAgICAgICBwYXJhbXMgPSBudWxsOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtc0FycmF5KSAmJiBpIGluIHBhcmFtc0FycmF5KSB7CiAgICAgICAgICBwYXJhbXMgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihwYXJhbXNBcnJheVtpXSk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbSA9IHRoaXMubWFrZUZpbHRlcihzdHJlYW0sIGZpbHRlci5uYW1lLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICBtYXliZUxlbmd0aCA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdHJlYW07CiAgfQogIG1ha2VGaWx0ZXIoc3RyZWFtLCBuYW1lLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICBpZiAobWF5YmVMZW5ndGggPT09IDApIHsKICAgICAgd2FybihgRW1wdHkgIiR7bmFtZX0iIHN0cmVhbS5gKTsKICAgICAgcmV0dXJuIG5ldyBOdWxsU3RyZWFtKCk7CiAgICB9CiAgICB0cnkgewogICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICBjYXNlICJGbCI6CiAgICAgICAgY2FzZSAiRmxhdGVEZWNvZGUiOgogICAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgICByZXR1cm4gbmV3IFByZWRpY3RvclN0cmVhbShuZXcgRmxhdGVTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCksIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBGbGF0ZVN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICBjYXNlICJMWlciOgogICAgICAgIGNhc2UgIkxaV0RlY29kZSI6CiAgICAgICAgICBsZXQgZWFybHlDaGFuZ2UgPSAxOwogICAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhcygiRWFybHlDaGFuZ2UiKSkgewogICAgICAgICAgICAgIGVhcmx5Q2hhbmdlID0gcGFyYW1zLmdldCgiRWFybHlDaGFuZ2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFByZWRpY3RvclN0cmVhbShuZXcgTFpXU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIGVhcmx5Q2hhbmdlKSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IExaV1N0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBlYXJseUNoYW5nZSk7CiAgICAgICAgY2FzZSAiRENUIjoKICAgICAgICBjYXNlICJEQ1REZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBKcGVnU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgY2FzZSAiSlBYIjoKICAgICAgICBjYXNlICJKUFhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBKcHhTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICBjYXNlICJBODUiOgogICAgICAgIGNhc2UgIkFTQ0lJODVEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBBc2NpaTg1U3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkFIeCI6CiAgICAgICAgY2FzZSAiQVNDSUlIZXhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBBc2NpaUhleFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICBjYXNlICJDQ0YiOgogICAgICAgIGNhc2UgIkNDSVRURmF4RGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgQ0NJVFRGYXhTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICBjYXNlICJSTCI6CiAgICAgICAgY2FzZSAiUnVuTGVuZ3RoRGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgUnVuTGVuZ3RoU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkpCSUcyRGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgSmJpZzJTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgfQogICAgICB3YXJuKGBGaWx0ZXIgIiR7bmFtZX0iIGlzIG5vdCBzdXBwb3J0ZWQuYCk7CiAgICAgIHJldHVybiBzdHJlYW07CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYEludmFsaWQgc3RyZWFtOiAiJHtleH0iYCk7CiAgICAgIHJldHVybiBuZXcgTnVsbFN0cmVhbSgpOwogICAgfQogIH0KfQpjb25zdCBzcGVjaWFsQ2hhcnMgPSBbMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMSwgMCwgMSwgMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMiwgMCwgMCwgMiwgMiwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07CmZ1bmN0aW9uIHRvSGV4RGlnaXQoY2gpIHsKICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5KSB7CiAgICByZXR1cm4gY2ggJiAweDBmOwogIH0KICBpZiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDQ2IHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg2NikgewogICAgcmV0dXJuIChjaCAmIDB4MGYpICsgOTsKICB9CiAgcmV0dXJuIC0xOwp9CmNsYXNzIExleGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGtub3duQ29tbWFuZHMgPSBudWxsKSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMubmV4dENoYXIoKTsKICAgIHRoaXMuc3RyQnVmID0gW107CiAgICB0aGlzLmtub3duQ29tbWFuZHMgPSBrbm93bkNvbW1hbmRzOwogICAgdGhpcy5faGV4U3RyaW5nTnVtV2FybiA9IDA7CiAgICB0aGlzLmJlZ2luSW5saW5lSW1hZ2VQb3MgPSAtMTsKICB9CiAgbmV4dENoYXIoKSB7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICB9CiAgcGVla0NoYXIoKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW0ucGVla0J5dGUoKTsKICB9CiAgZ2V0TnVtYmVyKCkgewogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIGxldCBlTm90YXRpb24gPSBmYWxzZTsKICAgIGxldCBkaXZpZGVCeSA9IDA7CiAgICBsZXQgc2lnbiA9IDE7CiAgICBpZiAoY2ggPT09IDB4MmQpIHsKICAgICAgc2lnbiA9IC0xOwogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgaWYgKGNoID09PSAweDJkKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MmIpIHsKICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgZG8gewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICB9IHdoaWxlIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCk7CiAgICB9CiAgICBpZiAoY2ggPT09IDB4MmUpIHsKICAgICAgZGl2aWRlQnkgPSAxMDsKICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBpZiAoY2ggPCAweDMwIHx8IGNoID4gMHgzOSkgewogICAgICBjb25zdCBtc2cgPSBgSW52YWxpZCBudW1iZXI6ICR7U3RyaW5nLmZyb21DaGFyQ29kZShjaCl9IChjaGFyQ29kZSAke2NofSlgOwogICAgICBpZiAoaXNXaGl0ZVNwYWNlKGNoKSB8fCBjaCA9PT0gMHgyOCB8fCBjaCA9PT0gMHgzYyB8fCBjaCA9PT0gLTEpIHsKICAgICAgICBpbmZvKGBMZXhlci5nZXROdW1iZXIgLSAiJHttc2d9Ii5gKTsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IobXNnKTsKICAgIH0KICAgIGxldCBiYXNlVmFsdWUgPSBjaCAtIDB4MzA7CiAgICBsZXQgcG93ZXJWYWx1ZSA9IDA7CiAgICBsZXQgcG93ZXJWYWx1ZVNpZ24gPSAxOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCkgewogICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5KSB7CiAgICAgICAgY29uc3QgY3VycmVudERpZ2l0ID0gY2ggLSAweDMwOwogICAgICAgIGlmIChlTm90YXRpb24pIHsKICAgICAgICAgIHBvd2VyVmFsdWUgPSBwb3dlclZhbHVlICogMTAgKyBjdXJyZW50RGlnaXQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChkaXZpZGVCeSAhPT0gMCkgewogICAgICAgICAgICBkaXZpZGVCeSAqPSAxMDsKICAgICAgICAgIH0KICAgICAgICAgIGJhc2VWYWx1ZSA9IGJhc2VWYWx1ZSAqIDEwICsgY3VycmVudERpZ2l0OwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyZSkgewogICAgICAgIGlmIChkaXZpZGVCeSA9PT0gMCkgewogICAgICAgICAgZGl2aWRlQnkgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MmQpIHsKICAgICAgICB3YXJuKCJCYWRseSBmb3JtYXR0ZWQgbnVtYmVyOiBtaW51cyBzaWduIGluIHRoZSBtaWRkbGUiKTsKICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHg0NSB8fCBjaCA9PT0gMHg2NSkgewogICAgICAgIGNoID0gdGhpcy5wZWVrQ2hhcigpOwogICAgICAgIGlmIChjaCA9PT0gMHgyYiB8fCBjaCA9PT0gMHgyZCkgewogICAgICAgICAgcG93ZXJWYWx1ZVNpZ24gPSBjaCA9PT0gMHgyZCA/IC0xIDogMTsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICB9IGVsc2UgaWYgKGNoIDwgMHgzMCB8fCBjaCA+IDB4MzkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBlTm90YXRpb24gPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAoZGl2aWRlQnkgIT09IDApIHsKICAgICAgYmFzZVZhbHVlIC89IGRpdmlkZUJ5OwogICAgfQogICAgaWYgKGVOb3RhdGlvbikgewogICAgICBiYXNlVmFsdWUgKj0gMTAgKiogKHBvd2VyVmFsdWVTaWduICogcG93ZXJWYWx1ZSk7CiAgICB9CiAgICByZXR1cm4gc2lnbiAqIGJhc2VWYWx1ZTsKICB9CiAgZ2V0U3RyaW5nKCkgewogICAgbGV0IG51bVBhcmVuID0gMTsKICAgIGxldCBkb25lID0gZmFsc2U7CiAgICBjb25zdCBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgbGV0IGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbGV0IGNoYXJCdWZmZXJlZCA9IGZhbHNlOwogICAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICAgIGNhc2UgLTE6CiAgICAgICAgICB3YXJuKCJVbnRlcm1pbmF0ZWQgc3RyaW5nIik7CiAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgyODoKICAgICAgICAgICsrbnVtUGFyZW47CiAgICAgICAgICBzdHJCdWYucHVzaCgiKCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDI5OgogICAgICAgICAgaWYgKC0tbnVtUGFyZW4gPT09IDApIHsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIpIik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4NWM6CiAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIHN3aXRjaCAoY2gpIHsKICAgICAgICAgICAgY2FzZSAtMToKICAgICAgICAgICAgICB3YXJuKCJVbnRlcm1pbmF0ZWQgc3RyaW5nIik7CiAgICAgICAgICAgICAgZG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg2ZToKICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiXG4iKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDcyOgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcciIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NzQ6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIlx0Iik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg2MjoKICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiXGIiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDY2OgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcZiIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NWM6CiAgICAgICAgICAgIGNhc2UgMHgyODoKICAgICAgICAgICAgY2FzZSAweDI5OgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDMwOgogICAgICAgICAgICBjYXNlIDB4MzE6CiAgICAgICAgICAgIGNhc2UgMHgzMjoKICAgICAgICAgICAgY2FzZSAweDMzOgogICAgICAgICAgICBjYXNlIDB4MzQ6CiAgICAgICAgICAgIGNhc2UgMHgzNToKICAgICAgICAgICAgY2FzZSAweDM2OgogICAgICAgICAgICBjYXNlIDB4Mzc6CiAgICAgICAgICAgICAgbGV0IHggPSBjaCAmIDB4MGY7CiAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgY2hhckJ1ZmZlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM3KSB7CiAgICAgICAgICAgICAgICB4ID0gKHggPDwgMykgKyAoY2ggJiAweDBmKTsKICAgICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzNykgewogICAgICAgICAgICAgICAgICBjaGFyQnVmZmVyZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgeCA9ICh4IDw8IDMpICsgKGNoICYgMHgwZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoeCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MGQ6CiAgICAgICAgICAgICAgaWYgKHRoaXMucGVla0NoYXIoKSA9PT0gMHgwYSkgewogICAgICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDBhOgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoZG9uZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmICghY2hhckJ1ZmZlcmVkKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdHJCdWYuam9pbigiIik7CiAgfQogIGdldE5hbWUoKSB7CiAgICBsZXQgY2gsIHByZXZpb3VzQ2g7CiAgICBjb25zdCBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCAmJiAhc3BlY2lhbENoYXJzW2NoXSkgewogICAgICBpZiAoY2ggPT09IDB4MjMpIHsKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICBpZiAoc3BlY2lhbENoYXJzW2NoXSkgewogICAgICAgICAgd2FybigiTGV4ZXJfZ2V0TmFtZTogIiArICJOVU1CRVIgU0lHTiAoIykgc2hvdWxkIGJlIGZvbGxvd2VkIGJ5IGEgaGV4YWRlY2ltYWwgbnVtYmVyLiIpOwogICAgICAgICAgc3RyQnVmLnB1c2goIiMiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb25zdCB4ID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgaWYgKHggIT09IC0xKSB7CiAgICAgICAgICBwcmV2aW91c0NoID0gY2g7CiAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIGNvbnN0IHgyID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgICBpZiAoeDIgPT09IC0xKSB7CiAgICAgICAgICAgIHdhcm4oYExleGVyX2dldE5hbWU6IElsbGVnYWwgZGlnaXQgKCR7U3RyaW5nLmZyb21DaGFyQ29kZShjaCl9KSBgICsgImluIGhleGFkZWNpbWFsIG51bWJlci4iKTsKICAgICAgICAgICAgc3RyQnVmLnB1c2goIiMiLCBTdHJpbmcuZnJvbUNoYXJDb2RlKHByZXZpb3VzQ2gpKTsKICAgICAgICAgICAgaWYgKHNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSh4IDw8IDQgfCB4MikpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJCdWYucHVzaCgiIyIsIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICB9CiAgICB9CiAgICBpZiAoc3RyQnVmLmxlbmd0aCA+IDEyNykgewogICAgICB3YXJuKGBOYW1lIHRva2VuIGlzIGxvbmdlciB0aGFuIGFsbG93ZWQgYnkgdGhlIHNwZWM6ICR7c3RyQnVmLmxlbmd0aH1gKTsKICAgIH0KICAgIHJldHVybiBOYW1lLmdldChzdHJCdWYuam9pbigiIikpOwogIH0KICBfaGV4U3RyaW5nV2FybihjaCkgewogICAgY29uc3QgTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4gPSA1OwogICAgaWYgKHRoaXMuX2hleFN0cmluZ051bVdhcm4rKyA9PT0gTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4pIHsKICAgICAgd2FybigiZ2V0SGV4U3RyaW5nIC0gaWdub3JpbmcgYWRkaXRpb25hbCBpbnZhbGlkIGNoYXJhY3RlcnMuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9oZXhTdHJpbmdOdW1XYXJuID4gTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgd2FybihgZ2V0SGV4U3RyaW5nIC0gaWdub3JpbmcgaW52YWxpZCBjaGFyYWN0ZXI6ICR7Y2h9YCk7CiAgfQogIGdldEhleFN0cmluZygpIHsKICAgIGNvbnN0IHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgbGV0IGZpcnN0RGlnaXQgPSAtMSwKICAgICAgZGlnaXQgPSAtMTsKICAgIHRoaXMuX2hleFN0cmluZ051bVdhcm4gPSAwOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKGNoIDwgMCkgewogICAgICAgIHdhcm4oIlVudGVybWluYXRlZCBoZXggc3RyaW5nIik7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoc3BlY2lhbENoYXJzW2NoXSA9PT0gMSkgewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGRpZ2l0ID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgaWYgKGRpZ2l0ID09PSAtMSkgewogICAgICAgICAgdGhpcy5faGV4U3RyaW5nV2FybihjaCk7CiAgICAgICAgfSBlbHNlIGlmIChmaXJzdERpZ2l0ID09PSAtMSkgewogICAgICAgICAgZmlyc3REaWdpdCA9IGRpZ2l0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGZpcnN0RGlnaXQgPDwgNCB8IGRpZ2l0KSk7CiAgICAgICAgICBmaXJzdERpZ2l0ID0gLTE7CiAgICAgICAgfQogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICB9CiAgICB9CiAgICBpZiAoZmlyc3REaWdpdCAhPT0gLTEpIHsKICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShmaXJzdERpZ2l0IDw8IDQpKTsKICAgIH0KICAgIHJldHVybiBzdHJCdWYuam9pbigiIik7CiAgfQogIGdldE9iaigpIHsKICAgIGxldCBjb21tZW50ID0gZmFsc2U7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKGNoIDwgMCkgewogICAgICAgIHJldHVybiBFT0Y7CiAgICAgIH0KICAgICAgaWYgKGNvbW1lbnQpIHsKICAgICAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgICAgIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjUpIHsKICAgICAgICBjb21tZW50ID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChzcGVjaWFsQ2hhcnNbY2hdICE9PSAxKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICBjYXNlIDB4MzA6CiAgICAgIGNhc2UgMHgzMToKICAgICAgY2FzZSAweDMyOgogICAgICBjYXNlIDB4MzM6CiAgICAgIGNhc2UgMHgzNDoKICAgICAgY2FzZSAweDM1OgogICAgICBjYXNlIDB4MzY6CiAgICAgIGNhc2UgMHgzNzoKICAgICAgY2FzZSAweDM4OgogICAgICBjYXNlIDB4Mzk6CiAgICAgIGNhc2UgMHgyYjoKICAgICAgY2FzZSAweDJkOgogICAgICBjYXNlIDB4MmU6CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TnVtYmVyKCk7CiAgICAgIGNhc2UgMHgyODoKICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHJpbmcoKTsKICAgICAgY2FzZSAweDJmOgogICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKTsKICAgICAgY2FzZSAweDViOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gQ21kLmdldCgiWyIpOwogICAgICBjYXNlIDB4NWQ6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBDbWQuZ2V0KCJdIik7CiAgICAgIGNhc2UgMHgzYzoKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICBpZiAoY2ggPT09IDB4M2MpIHsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIHJldHVybiBDbWQuZ2V0KCI8PCIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5nZXRIZXhTdHJpbmcoKTsKICAgICAgY2FzZSAweDNlOgogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGlmIChjaCA9PT0gMHgzZSkgewogICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgcmV0dXJuIENtZC5nZXQoIj4+Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBDbWQuZ2V0KCI+Iik7CiAgICAgIGNhc2UgMHg3YjoKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgcmV0dXJuIENtZC5nZXQoInsiKTsKICAgICAgY2FzZSAweDdkOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gQ21kLmdldCgifSIpOwogICAgICBjYXNlIDB4Mjk6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSWxsZWdhbCBjaGFyYWN0ZXI6ICR7Y2h9YCk7CiAgICB9CiAgICBsZXQgc3RyID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICBpZiAoY2ggPCAweDIwIHx8IGNoID4gMHg3ZikgewogICAgICBjb25zdCBuZXh0Q2ggPSB0aGlzLnBlZWtDaGFyKCk7CiAgICAgIGlmIChuZXh0Q2ggPj0gMHgyMCAmJiBuZXh0Q2ggPD0gMHg3ZikgewogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gQ21kLmdldChzdHIpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBrbm93bkNvbW1hbmRzID0gdGhpcy5rbm93bkNvbW1hbmRzOwogICAgbGV0IGtub3duQ29tbWFuZEZvdW5kID0ga25vd25Db21tYW5kcz8uW3N0cl0gIT09IHVuZGVmaW5lZDsKICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDAgJiYgIXNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgY29uc3QgcG9zc2libGVDb21tYW5kID0gc3RyICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICAgIGlmIChrbm93bkNvbW1hbmRGb3VuZCAmJiBrbm93bkNvbW1hbmRzW3Bvc3NpYmxlQ29tbWFuZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChzdHIubGVuZ3RoID09PSAxMjgpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYENvbW1hbmQgdG9rZW4gdG9vIGxvbmc6ICR7c3RyLmxlbmd0aH1gKTsKICAgICAgfQogICAgICBzdHIgPSBwb3NzaWJsZUNvbW1hbmQ7CiAgICAgIGtub3duQ29tbWFuZEZvdW5kID0ga25vd25Db21tYW5kcz8uW3N0cl0gIT09IHVuZGVmaW5lZDsKICAgIH0KICAgIGlmIChzdHIgPT09ICJ0cnVlIikgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChzdHIgPT09ICJmYWxzZSIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHN0ciA9PT0gIm51bGwiKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHN0ciA9PT0gIkJJIikgewogICAgICB0aGlzLmJlZ2luSW5saW5lSW1hZ2VQb3MgPSB0aGlzLnN0cmVhbS5wb3M7CiAgICB9CiAgICByZXR1cm4gQ21kLmdldChzdHIpOwogIH0KICBza2lwVG9OZXh0TGluZSgpIHsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAoY2ggPj0gMCkgewogICAgICBpZiAoY2ggPT09IDB4MGQpIHsKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICBpZiAoY2ggPT09IDB4MGEpIHsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MGEpIHsKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgfQp9CmNsYXNzIExpbmVhcml6YXRpb24gewogIHN0YXRpYyBjcmVhdGUoc3RyZWFtKSB7CiAgICBmdW5jdGlvbiBnZXRJbnQobGluRGljdCwgbmFtZSwgYWxsb3daZXJvVmFsdWUgPSBmYWxzZSkgewogICAgICBjb25zdCBvYmogPSBsaW5EaWN0LmdldChuYW1lKTsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSAmJiAoYWxsb3daZXJvVmFsdWUgPyBvYmogPj0gMCA6IG9iaiA+IDApKSB7CiAgICAgICAgcmV0dXJuIG9iajsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAiJHtuYW1lfSIgcGFyYW1ldGVyIGluIHRoZSBsaW5lYXJpemF0aW9uIGAgKyAiZGljdGlvbmFyeSBpcyBpbnZhbGlkLiIpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0SGludHMobGluRGljdCkgewogICAgICBjb25zdCBoaW50cyA9IGxpbkRpY3QuZ2V0KCJIIik7CiAgICAgIGxldCBoaW50c0xlbmd0aDsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaGludHMpICYmICgoaGludHNMZW5ndGggPSBoaW50cy5sZW5ndGgpID09PSAyIHx8IGhpbnRzTGVuZ3RoID09PSA0KSkgewogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBoaW50c0xlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgY29uc3QgaGludCA9IGhpbnRzW2luZGV4XTsKICAgICAgICAgIGlmICghKE51bWJlci5pc0ludGVnZXIoaGludCkgJiYgaGludCA+IDApKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSGludCAoJHtpbmRleH0pIGluIHRoZSBsaW5lYXJpemF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC5gKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhpbnRzOwogICAgICB9CiAgICAgIHRocm93IG5ldyBFcnJvcigiSGludCBhcnJheSBpbiB0aGUgbGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGlzIGludmFsaWQuIik7CiAgICB9CiAgICBjb25zdCBwYXJzZXIgPSBuZXcgUGFyc2VyKHsKICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0pLAogICAgICB4cmVmOiBudWxsCiAgICB9KTsKICAgIGNvbnN0IG9iajEgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBjb25zdCBvYmoyID0gcGFyc2VyLmdldE9iaigpOwogICAgY29uc3Qgb2JqMyA9IHBhcnNlci5nZXRPYmooKTsKICAgIGNvbnN0IGxpbkRpY3QgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBsZXQgb2JqLCBsZW5ndGg7CiAgICBpZiAoIShOdW1iZXIuaXNJbnRlZ2VyKG9iajEpICYmIE51bWJlci5pc0ludGVnZXIob2JqMikgJiYgaXNDbWQob2JqMywgIm9iaiIpICYmIGxpbkRpY3QgaW5zdGFuY2VvZiBEaWN0ICYmIHR5cGVvZiAob2JqID0gbGluRGljdC5nZXQoIkxpbmVhcml6ZWQiKSkgPT09ICJudW1iZXIiICYmIG9iaiA+IDApKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSBlbHNlIGlmICgobGVuZ3RoID0gZ2V0SW50KGxpbkRpY3QsICJMIikpICE9PSBzdHJlYW0ubGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlICJMIiBwYXJhbWV0ZXIgaW4gdGhlIGxpbmVhcml6YXRpb24gZGljdGlvbmFyeSAnICsgImRvZXMgbm90IGVxdWFsIHRoZSBzdHJlYW0gbGVuZ3RoLiIpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgbGVuZ3RoLAogICAgICBoaW50czogZ2V0SGludHMobGluRGljdCksCiAgICAgIG9iamVjdE51bWJlckZpcnN0OiBnZXRJbnQobGluRGljdCwgIk8iKSwKICAgICAgZW5kRmlyc3Q6IGdldEludChsaW5EaWN0LCAiRSIpLAogICAgICBudW1QYWdlczogZ2V0SW50KGxpbkRpY3QsICJOIiksCiAgICAgIG1haW5YUmVmRW50cmllc09mZnNldDogZ2V0SW50KGxpbkRpY3QsICJUIiksCiAgICAgIHBhZ2VGaXJzdDogbGluRGljdC5oYXMoIlAiKSA/IGdldEludChsaW5EaWN0LCAiUCIsIHRydWUpIDogMAogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NtYXAuanMKCgoKCgoKCmNvbnN0IEJVSUxUX0lOX0NNQVBTID0gWyJBZG9iZS1HQjEtVUNTMiIsICJBZG9iZS1DTlMxLVVDUzIiLCAiQWRvYmUtSmFwYW4xLVVDUzIiLCAiQWRvYmUtS29yZWExLVVDUzIiLCAiNzgtRVVDLUgiLCAiNzgtRVVDLVYiLCAiNzgtSCIsICI3OC1SS1NKLUgiLCAiNzgtUktTSi1WIiwgIjc4LVYiLCAiNzhtcy1SS1NKLUgiLCAiNzhtcy1SS1NKLVYiLCAiODNwdi1SS1NKLUgiLCAiOTBtcy1SS1NKLUgiLCAiOTBtcy1SS1NKLVYiLCAiOTBtc3AtUktTSi1IIiwgIjkwbXNwLVJLU0otViIsICI5MHB2LVJLU0otSCIsICI5MHB2LVJLU0otViIsICJBZGQtSCIsICJBZGQtUktTSi1IIiwgIkFkZC1SS1NKLVYiLCAiQWRkLVYiLCAiQWRvYmUtQ05TMS0wIiwgIkFkb2JlLUNOUzEtMSIsICJBZG9iZS1DTlMxLTIiLCAiQWRvYmUtQ05TMS0zIiwgIkFkb2JlLUNOUzEtNCIsICJBZG9iZS1DTlMxLTUiLCAiQWRvYmUtQ05TMS02IiwgIkFkb2JlLUdCMS0wIiwgIkFkb2JlLUdCMS0xIiwgIkFkb2JlLUdCMS0yIiwgIkFkb2JlLUdCMS0zIiwgIkFkb2JlLUdCMS00IiwgIkFkb2JlLUdCMS01IiwgIkFkb2JlLUphcGFuMS0wIiwgIkFkb2JlLUphcGFuMS0xIiwgIkFkb2JlLUphcGFuMS0yIiwgIkFkb2JlLUphcGFuMS0zIiwgIkFkb2JlLUphcGFuMS00IiwgIkFkb2JlLUphcGFuMS01IiwgIkFkb2JlLUphcGFuMS02IiwgIkFkb2JlLUtvcmVhMS0wIiwgIkFkb2JlLUtvcmVhMS0xIiwgIkFkb2JlLUtvcmVhMS0yIiwgIkI1LUgiLCAiQjUtViIsICJCNXBjLUgiLCAiQjVwYy1WIiwgIkNOUy1FVUMtSCIsICJDTlMtRVVDLVYiLCAiQ05TMS1IIiwgIkNOUzEtViIsICJDTlMyLUgiLCAiQ05TMi1WIiwgIkVUSEstQjUtSCIsICJFVEhLLUI1LVYiLCAiRVRlbi1CNS1IIiwgIkVUZW4tQjUtViIsICJFVGVubXMtQjUtSCIsICJFVGVubXMtQjUtViIsICJFVUMtSCIsICJFVUMtViIsICJFeHQtSCIsICJFeHQtUktTSi1IIiwgIkV4dC1SS1NKLVYiLCAiRXh0LVYiLCAiR0ItRVVDLUgiLCAiR0ItRVVDLVYiLCAiR0ItSCIsICJHQi1WIiwgIkdCSy1FVUMtSCIsICJHQkstRVVDLVYiLCAiR0JLMkstSCIsICJHQksySy1WIiwgIkdCS3AtRVVDLUgiLCAiR0JLcC1FVUMtViIsICJHQlQtRVVDLUgiLCAiR0JULUVVQy1WIiwgIkdCVC1IIiwgIkdCVC1WIiwgIkdCVHBjLUVVQy1IIiwgIkdCVHBjLUVVQy1WIiwgIkdCcGMtRVVDLUgiLCAiR0JwYy1FVUMtViIsICJIIiwgIkhLZGxhLUI1LUgiLCAiSEtkbGEtQjUtViIsICJIS2RsYi1CNS1IIiwgIkhLZGxiLUI1LVYiLCAiSEtnY2NzLUI1LUgiLCAiSEtnY2NzLUI1LVYiLCAiSEttMzE0LUI1LUgiLCAiSEttMzE0LUI1LVYiLCAiSEttNDcxLUI1LUgiLCAiSEttNDcxLUI1LVYiLCAiSEtzY3MtQjUtSCIsICJIS3Njcy1CNS1WIiwgIkhhbmtha3UiLCAiSGlyYWdhbmEiLCAiS1NDLUVVQy1IIiwgIktTQy1FVUMtViIsICJLU0MtSCIsICJLU0MtSm9oYWItSCIsICJLU0MtSm9oYWItViIsICJLU0MtViIsICJLU0Ntcy1VSEMtSCIsICJLU0Ntcy1VSEMtSFctSCIsICJLU0Ntcy1VSEMtSFctViIsICJLU0Ntcy1VSEMtViIsICJLU0NwYy1FVUMtSCIsICJLU0NwYy1FVUMtViIsICJLYXRha2FuYSIsICJOV1AtSCIsICJOV1AtViIsICJSS1NKLUgiLCAiUktTSi1WIiwgIlJvbWFuIiwgIlVuaUNOUy1VQ1MyLUgiLCAiVW5pQ05TLVVDUzItViIsICJVbmlDTlMtVVRGMTYtSCIsICJVbmlDTlMtVVRGMTYtViIsICJVbmlDTlMtVVRGMzItSCIsICJVbmlDTlMtVVRGMzItViIsICJVbmlDTlMtVVRGOC1IIiwgIlVuaUNOUy1VVEY4LVYiLCAiVW5pR0ItVUNTMi1IIiwgIlVuaUdCLVVDUzItViIsICJVbmlHQi1VVEYxNi1IIiwgIlVuaUdCLVVURjE2LVYiLCAiVW5pR0ItVVRGMzItSCIsICJVbmlHQi1VVEYzMi1WIiwgIlVuaUdCLVVURjgtSCIsICJVbmlHQi1VVEY4LVYiLCAiVW5pSklTLVVDUzItSCIsICJVbmlKSVMtVUNTMi1IVy1IIiwgIlVuaUpJUy1VQ1MyLUhXLVYiLCAiVW5pSklTLVVDUzItViIsICJVbmlKSVMtVVRGMTYtSCIsICJVbmlKSVMtVVRGMTYtViIsICJVbmlKSVMtVVRGMzItSCIsICJVbmlKSVMtVVRGMzItViIsICJVbmlKSVMtVVRGOC1IIiwgIlVuaUpJUy1VVEY4LVYiLCAiVW5pSklTMjAwNC1VVEYxNi1IIiwgIlVuaUpJUzIwMDQtVVRGMTYtViIsICJVbmlKSVMyMDA0LVVURjMyLUgiLCAiVW5pSklTMjAwNC1VVEYzMi1WIiwgIlVuaUpJUzIwMDQtVVRGOC1IIiwgIlVuaUpJUzIwMDQtVVRGOC1WIiwgIlVuaUpJU1Byby1VQ1MyLUhXLVYiLCAiVW5pSklTUHJvLVVDUzItViIsICJVbmlKSVNQcm8tVVRGOC1WIiwgIlVuaUpJU1gwMjEzLVVURjMyLUgiLCAiVW5pSklTWDAyMTMtVVRGMzItViIsICJVbmlKSVNYMDIxMzIwMDQtVVRGMzItSCIsICJVbmlKSVNYMDIxMzIwMDQtVVRGMzItViIsICJVbmlLUy1VQ1MyLUgiLCAiVW5pS1MtVUNTMi1WIiwgIlVuaUtTLVVURjE2LUgiLCAiVW5pS1MtVVRGMTYtViIsICJVbmlLUy1VVEYzMi1IIiwgIlVuaUtTLVVURjMyLVYiLCAiVW5pS1MtVVRGOC1IIiwgIlVuaUtTLVVURjgtViIsICJWIiwgIldQLVN5bWJvbCJdOwpjb25zdCBNQVhfTUFQX1JBTkdFID0gMiAqKiAyNCAtIDE7CmNsYXNzIENNYXAgewogIGNvbnN0cnVjdG9yKGJ1aWx0SW5DTWFwID0gZmFsc2UpIHsKICAgIHRoaXMuY29kZXNwYWNlUmFuZ2VzID0gW1tdLCBbXSwgW10sIFtdXTsKICAgIHRoaXMubnVtQ29kZXNwYWNlUmFuZ2VzID0gMDsKICAgIHRoaXMuX21hcCA9IFtdOwogICAgdGhpcy5uYW1lID0gIiI7CiAgICB0aGlzLnZlcnRpY2FsID0gZmFsc2U7CiAgICB0aGlzLnVzZUNNYXAgPSBudWxsOwogICAgdGhpcy5idWlsdEluQ01hcCA9IGJ1aWx0SW5DTWFwOwogIH0KICBhZGRDb2Rlc3BhY2VSYW5nZShuLCBsb3csIGhpZ2gpIHsKICAgIHRoaXMuY29kZXNwYWNlUmFuZ2VzW24gLSAxXS5wdXNoKGxvdywgaGlnaCk7CiAgICB0aGlzLm51bUNvZGVzcGFjZVJhbmdlcysrOwogIH0KICBtYXBDaWRSYW5nZShsb3csIGhpZ2gsIGRzdExvdykgewogICAgaWYgKGhpZ2ggLSBsb3cgPiBNQVhfTUFQX1JBTkdFKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigibWFwQ2lkUmFuZ2UgLSBpZ25vcmluZyBkYXRhIGFib3ZlIE1BWF9NQVBfUkFOR0UuIik7CiAgICB9CiAgICB3aGlsZSAobG93IDw9IGhpZ2gpIHsKICAgICAgdGhpcy5fbWFwW2xvdysrXSA9IGRzdExvdysrOwogICAgfQogIH0KICBtYXBCZlJhbmdlKGxvdywgaGlnaCwgZHN0TG93KSB7CiAgICBpZiAoaGlnaCAtIGxvdyA+IE1BWF9NQVBfUkFOR0UpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBCZlJhbmdlIC0gaWdub3JpbmcgZGF0YSBhYm92ZSBNQVhfTUFQX1JBTkdFLiIpOwogICAgfQogICAgY29uc3QgbGFzdEJ5dGUgPSBkc3RMb3cubGVuZ3RoIC0gMTsKICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgewogICAgICB0aGlzLl9tYXBbbG93KytdID0gZHN0TG93OwogICAgICBjb25zdCBuZXh0Q2hhckNvZGUgPSBkc3RMb3cuY2hhckNvZGVBdChsYXN0Qnl0ZSkgKyAxOwogICAgICBpZiAobmV4dENoYXJDb2RlID4gMHhmZikgewogICAgICAgIGRzdExvdyA9IGRzdExvdy5zdWJzdHJpbmcoMCwgbGFzdEJ5dGUgLSAxKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoZHN0TG93LmNoYXJDb2RlQXQobGFzdEJ5dGUgLSAxKSArIDEpICsgIlx4MDAiOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGRzdExvdyA9IGRzdExvdy5zdWJzdHJpbmcoMCwgbGFzdEJ5dGUpICsgU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhckNvZGUpOwogICAgfQogIH0KICBtYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KSB7CiAgICBpZiAoaGlnaCAtIGxvdyA+IE1BWF9NQVBfUkFOR0UpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBCZlJhbmdlVG9BcnJheSAtIGlnbm9yaW5nIGRhdGEgYWJvdmUgTUFYX01BUF9SQU5HRS4iKTsKICAgIH0KICAgIGNvbnN0IGlpID0gYXJyYXkubGVuZ3RoOwogICAgbGV0IGkgPSAwOwogICAgd2hpbGUgKGxvdyA8PSBoaWdoICYmIGkgPCBpaSkgewogICAgICB0aGlzLl9tYXBbbG93XSA9IGFycmF5W2krK107CiAgICAgICsrbG93OwogICAgfQogIH0KICBtYXBPbmUoc3JjLCBkc3QpIHsKICAgIHRoaXMuX21hcFtzcmNdID0gZHN0OwogIH0KICBsb29rdXAoY29kZSkgewogICAgcmV0dXJuIHRoaXMuX21hcFtjb2RlXTsKICB9CiAgY29udGFpbnMoY29kZSkgewogICAgcmV0dXJuIHRoaXMuX21hcFtjb2RlXSAhPT0gdW5kZWZpbmVkOwogIH0KICBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBjb25zdCBsZW5ndGggPSBtYXAubGVuZ3RoOwogICAgaWYgKGxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobWFwW2ldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNhbGxiYWNrKGksIG1hcFtpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGkgaW4gbWFwKSB7CiAgICAgICAgY2FsbGJhY2soaSwgbWFwW2ldKTsKICAgICAgfQogICAgfQogIH0KICBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBpZiAobWFwLmxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIHJldHVybiBtYXAuaW5kZXhPZih2YWx1ZSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICBpZiAobWFwW2NoYXJDb2RlXSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gY2hhckNvZGUgfCAwOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIGdldE1hcCgpIHsKICAgIHJldHVybiB0aGlzLl9tYXA7CiAgfQogIHJlYWRDaGFyQ29kZShzdHIsIG9mZnNldCwgb3V0KSB7CiAgICBsZXQgYyA9IDA7CiAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZXMgPSB0aGlzLmNvZGVzcGFjZVJhbmdlczsKICAgIGZvciAobGV0IG4gPSAwLCBubiA9IGNvZGVzcGFjZVJhbmdlcy5sZW5ndGg7IG4gPCBubjsgbisrKSB7CiAgICAgIGMgPSAoYyA8PCA4IHwgc3RyLmNoYXJDb2RlQXQob2Zmc2V0ICsgbikpID4+PiAwOwogICAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZSA9IGNvZGVzcGFjZVJhbmdlc1tuXTsKICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gY29kZXNwYWNlUmFuZ2UubGVuZ3RoOyBrIDwga2s7KSB7CiAgICAgICAgY29uc3QgbG93ID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBjb25zdCBoaWdoID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBpZiAoYyA+PSBsb3cgJiYgYyA8PSBoaWdoKSB7CiAgICAgICAgICBvdXQuY2hhcmNvZGUgPSBjOwogICAgICAgICAgb3V0Lmxlbmd0aCA9IG4gKyAxOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgb3V0LmNoYXJjb2RlID0gMDsKICAgIG91dC5sZW5ndGggPSAxOwogIH0KICBnZXRDaGFyQ29kZUxlbmd0aChjaGFyQ29kZSkgewogICAgY29uc3QgY29kZXNwYWNlUmFuZ2VzID0gdGhpcy5jb2Rlc3BhY2VSYW5nZXM7CiAgICBmb3IgKGxldCBuID0gMCwgbm4gPSBjb2Rlc3BhY2VSYW5nZXMubGVuZ3RoOyBuIDwgbm47IG4rKykgewogICAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZSA9IGNvZGVzcGFjZVJhbmdlc1tuXTsKICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gY29kZXNwYWNlUmFuZ2UubGVuZ3RoOyBrIDwga2s7KSB7CiAgICAgICAgY29uc3QgbG93ID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBjb25zdCBoaWdoID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBpZiAoY2hhckNvZGUgPj0gbG93ICYmIGNoYXJDb2RlIDw9IGhpZ2gpIHsKICAgICAgICAgIHJldHVybiBuICsgMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAxOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5sZW5ndGg7CiAgfQogIGdldCBpc0lkZW50aXR5Q01hcCgpIHsKICAgIGlmICghKHRoaXMubmFtZSA9PT0gIklkZW50aXR5LUgiIHx8IHRoaXMubmFtZSA9PT0gIklkZW50aXR5LVYiKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5fbWFwLmxlbmd0aCAhPT0gMHgxMDAwMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDB4MTAwMDA7IGkrKykgewogICAgICBpZiAodGhpcy5fbWFwW2ldICE9PSBpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgSWRlbnRpdHlDTWFwIGV4dGVuZHMgQ01hcCB7CiAgY29uc3RydWN0b3IodmVydGljYWwsIG4pIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnZlcnRpY2FsID0gdmVydGljYWw7CiAgICB0aGlzLmFkZENvZGVzcGFjZVJhbmdlKG4sIDAsIDB4ZmZmZik7CiAgfQogIG1hcENpZFJhbmdlKGxvdywgaGlnaCwgZHN0TG93KSB7CiAgICB1bnJlYWNoYWJsZSgic2hvdWxkIG5vdCBjYWxsIG1hcENpZFJhbmdlIik7CiAgfQogIG1hcEJmUmFuZ2UobG93LCBoaWdoLCBkc3RMb3cpIHsKICAgIHVucmVhY2hhYmxlKCJzaG91bGQgbm90IGNhbGwgbWFwQmZSYW5nZSIpOwogIH0KICBtYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KSB7CiAgICB1bnJlYWNoYWJsZSgic2hvdWxkIG5vdCBjYWxsIG1hcEJmUmFuZ2VUb0FycmF5Iik7CiAgfQogIG1hcE9uZShzcmMsIGRzdCkgewogICAgdW5yZWFjaGFibGUoInNob3VsZCBub3QgY2FsbCBtYXBDaWRPbmUiKTsKICB9CiAgbG9va3VwKGNvZGUpIHsKICAgIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpICYmIGNvZGUgPD0gMHhmZmZmID8gY29kZSA6IHVuZGVmaW5lZDsKICB9CiAgY29udGFpbnMoY29kZSkgewogICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIoY29kZSkgJiYgY29kZSA8PSAweGZmZmY7CiAgfQogIGZvckVhY2goY2FsbGJhY2spIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDB4ZmZmZjsgaSsrKSB7CiAgICAgIGNhbGxiYWNrKGksIGkpOwogICAgfQogIH0KICBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkgJiYgdmFsdWUgPD0gMHhmZmZmID8gdmFsdWUgOiAtMTsKICB9CiAgZ2V0TWFwKCkgewogICAgY29uc3QgbWFwID0gbmV3IEFycmF5KDB4MTAwMDApOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gMHhmZmZmOyBpKyspIHsKICAgICAgbWFwW2ldID0gaTsKICAgIH0KICAgIHJldHVybiBtYXA7CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICByZXR1cm4gMHgxMDAwMDsKICB9CiAgZ2V0IGlzSWRlbnRpdHlDTWFwKCkgewogICAgdW5yZWFjaGFibGUoInNob3VsZCBub3QgYWNjZXNzIC5pc0lkZW50aXR5Q01hcCIpOwogIH0KfQpmdW5jdGlvbiBzdHJUb0ludChzdHIpIHsKICBsZXQgYSA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHsKICAgIGEgPSBhIDw8IDggfCBzdHIuY2hhckNvZGVBdChpKTsKICB9CiAgcmV0dXJuIGEgPj4+IDA7Cn0KZnVuY3Rpb24gZXhwZWN0U3RyaW5nKG9iaikgewogIGlmICh0eXBlb2Ygb2JqICE9PSAic3RyaW5nIikgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNYWxmb3JtZWQgQ01hcDogZXhwZWN0ZWQgc3RyaW5nLiIpOwogIH0KfQpmdW5jdGlvbiBleHBlY3RJbnQob2JqKSB7CiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTWFsZm9ybWVkIENNYXA6IGV4cGVjdGVkIGludC4iKTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VCZkNoYXIoY01hcCwgbGV4ZXIpIHsKICB3aGlsZSAodHJ1ZSkgewogICAgbGV0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKG9iaiA9PT0gRU9GKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKGlzQ21kKG9iaiwgImVuZGJmY2hhciIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3Qgc3JjID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBkc3QgPSBvYmo7CiAgICBjTWFwLm1hcE9uZShzcmMsIGRzdCk7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlQmZSYW5nZShjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoaXNDbWQob2JqLCAiZW5kYmZyYW5nZSIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgbG93ID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBoaWdoID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSB8fCB0eXBlb2Ygb2JqID09PSAic3RyaW5nIikgewogICAgICBjb25zdCBkc3RMb3cgPSBOdW1iZXIuaXNJbnRlZ2VyKG9iaikgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKG9iaikgOiBvYmo7CiAgICAgIGNNYXAubWFwQmZSYW5nZShsb3csIGhpZ2gsIGRzdExvdyk7CiAgICB9IGVsc2UgaWYgKGlzQ21kKG9iaiwgIlsiKSkgewogICAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgICAgY29uc3QgYXJyYXkgPSBbXTsKICAgICAgd2hpbGUgKCFpc0NtZChvYmosICJdIikgJiYgb2JqICE9PSBFT0YpIHsKICAgICAgICBhcnJheS5wdXNoKG9iaik7CiAgICAgICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICAgIH0KICAgICAgY01hcC5tYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KTsKICAgIH0gZWxzZSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgYmYgcmFuZ2UuIik7Cn0KZnVuY3Rpb24gcGFyc2VDaWRDaGFyKGNNYXAsIGxleGVyKSB7CiAgd2hpbGUgKHRydWUpIHsKICAgIGxldCBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGlmIChvYmogPT09IEVPRikgewogICAgICBicmVhazsKICAgIH0KICAgIGlmIChpc0NtZChvYmosICJlbmRjaWRjaGFyIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBzcmMgPSBzdHJUb0ludChvYmopOwogICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBleHBlY3RJbnQob2JqKTsKICAgIGNvbnN0IGRzdCA9IG9iajsKICAgIGNNYXAubWFwT25lKHNyYywgZHN0KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VDaWRSYW5nZShjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoaXNDbWQob2JqLCAiZW5kY2lkcmFuZ2UiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgIGNvbnN0IGxvdyA9IHN0clRvSW50KG9iaik7CiAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgaGlnaCA9IHN0clRvSW50KG9iaik7CiAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGV4cGVjdEludChvYmopOwogICAgY29uc3QgZHN0TG93ID0gb2JqOwogICAgY01hcC5tYXBDaWRSYW5nZShsb3csIGhpZ2gsIGRzdExvdyk7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlQ29kZXNwYWNlUmFuZ2UoY01hcCwgbGV4ZXIpIHsKICB3aGlsZSAodHJ1ZSkgewogICAgbGV0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKG9iaiA9PT0gRU9GKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKGlzQ21kKG9iaiwgImVuZGNvZGVzcGFjZXJhbmdlIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHR5cGVvZiBvYmogIT09ICJzdHJpbmciKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgbG93ID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKHR5cGVvZiBvYmogIT09ICJzdHJpbmciKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgaGlnaCA9IHN0clRvSW50KG9iaik7CiAgICBjTWFwLmFkZENvZGVzcGFjZVJhbmdlKG9iai5sZW5ndGgsIGxvdywgaGlnaCk7CiAgfQogIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBjb2Rlc3BhY2UgcmFuZ2UuIik7Cn0KZnVuY3Rpb24gcGFyc2VXTW9kZShjTWFwLCBsZXhlcikgewogIGNvbnN0IG9iaiA9IGxleGVyLmdldE9iaigpOwogIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgIGNNYXAudmVydGljYWwgPSAhIW9iajsKICB9Cn0KZnVuY3Rpb24gcGFyc2VDTWFwTmFtZShjTWFwLCBsZXhlcikgewogIGNvbnN0IG9iaiA9IGxleGVyLmdldE9iaigpOwogIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICBjTWFwLm5hbWUgPSBvYmoubmFtZTsKICB9Cn0KYXN5bmMgZnVuY3Rpb24gcGFyc2VDTWFwKGNNYXAsIGxleGVyLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKSB7CiAgbGV0IHByZXZpb3VzLCBlbWJlZGRlZFVzZUNNYXA7CiAgb2JqTG9vcDogd2hpbGUgKHRydWUpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgICBicmVhazsKICAgICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgaWYgKG9iai5uYW1lID09PSAiV01vZGUiKSB7CiAgICAgICAgICBwYXJzZVdNb2RlKGNNYXAsIGxleGVyKTsKICAgICAgICB9IGVsc2UgaWYgKG9iai5uYW1lID09PSAiQ01hcE5hbWUiKSB7CiAgICAgICAgICBwYXJzZUNNYXBOYW1lKGNNYXAsIGxleGVyKTsKICAgICAgICB9CiAgICAgICAgcHJldmlvdXMgPSBvYmo7CiAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgQ21kKSB7CiAgICAgICAgc3dpdGNoIChvYmouY21kKSB7CiAgICAgICAgICBjYXNlICJlbmRjbWFwIjoKICAgICAgICAgICAgYnJlYWsgb2JqTG9vcDsKICAgICAgICAgIGNhc2UgInVzZWNtYXAiOgogICAgICAgICAgICBpZiAocHJldmlvdXMgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgZW1iZWRkZWRVc2VDTWFwID0gcHJldmlvdXMubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJlZ2luY29kZXNwYWNlcmFuZ2UiOgogICAgICAgICAgICBwYXJzZUNvZGVzcGFjZVJhbmdlKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJiZWdpbmJmY2hhciI6CiAgICAgICAgICAgIHBhcnNlQmZDaGFyKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJiZWdpbmNpZGNoYXIiOgogICAgICAgICAgICBwYXJzZUNpZENoYXIoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJlZ2luYmZyYW5nZSI6CiAgICAgICAgICAgIHBhcnNlQmZSYW5nZShjTWFwLCBsZXhlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYmVnaW5jaWRyYW5nZSI6CiAgICAgICAgICAgIHBhcnNlQ2lkUmFuZ2UoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybigiSW52YWxpZCBjTWFwIGRhdGE6ICIgKyBleCk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogIH0KICBpZiAoIXVzZUNNYXAgJiYgZW1iZWRkZWRVc2VDTWFwKSB7CiAgICB1c2VDTWFwID0gZW1iZWRkZWRVc2VDTWFwOwogIH0KICBpZiAodXNlQ01hcCkgewogICAgcmV0dXJuIGV4dGVuZENNYXAoY01hcCwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCk7CiAgfQogIHJldHVybiBjTWFwOwp9CmFzeW5jIGZ1bmN0aW9uIGV4dGVuZENNYXAoY01hcCwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCkgewogIGNNYXAudXNlQ01hcCA9IGF3YWl0IGNyZWF0ZUJ1aWx0SW5DTWFwKHVzZUNNYXAsIGZldGNoQnVpbHRJbkNNYXApOwogIGlmIChjTWFwLm51bUNvZGVzcGFjZVJhbmdlcyA9PT0gMCkgewogICAgY29uc3QgdXNlQ29kZXNwYWNlUmFuZ2VzID0gY01hcC51c2VDTWFwLmNvZGVzcGFjZVJhbmdlczsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlQ29kZXNwYWNlUmFuZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNNYXAuY29kZXNwYWNlUmFuZ2VzW2ldID0gdXNlQ29kZXNwYWNlUmFuZ2VzW2ldLnNsaWNlKCk7CiAgICB9CiAgICBjTWFwLm51bUNvZGVzcGFjZVJhbmdlcyA9IGNNYXAudXNlQ01hcC5udW1Db2Rlc3BhY2VSYW5nZXM7CiAgfQogIGNNYXAudXNlQ01hcC5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICBpZiAoIWNNYXAuY29udGFpbnMoa2V5KSkgewogICAgICBjTWFwLm1hcE9uZShrZXksIHZhbHVlKTsKICAgIH0KICB9KTsKICByZXR1cm4gY01hcDsKfQphc3luYyBmdW5jdGlvbiBjcmVhdGVCdWlsdEluQ01hcChuYW1lLCBmZXRjaEJ1aWx0SW5DTWFwKSB7CiAgaWYgKG5hbWUgPT09ICJJZGVudGl0eS1IIikgewogICAgcmV0dXJuIG5ldyBJZGVudGl0eUNNYXAoZmFsc2UsIDIpOwogIH0gZWxzZSBpZiAobmFtZSA9PT0gIklkZW50aXR5LVYiKSB7CiAgICByZXR1cm4gbmV3IElkZW50aXR5Q01hcCh0cnVlLCAyKTsKICB9CiAgaWYgKCFCVUlMVF9JTl9DTUFQUy5pbmNsdWRlcyhuYW1lKSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIENNYXAgbmFtZTogIiArIG5hbWUpOwogIH0KICBpZiAoIWZldGNoQnVpbHRJbkNNYXApIHsKICAgIHRocm93IG5ldyBFcnJvcigiQnVpbHQtaW4gQ01hcCBwYXJhbWV0ZXJzIGFyZSBub3QgcHJvdmlkZWQuIik7CiAgfQogIGNvbnN0IHsKICAgIGNNYXBEYXRhLAogICAgaXNDb21wcmVzc2VkCiAgfSA9IGF3YWl0IGZldGNoQnVpbHRJbkNNYXAobmFtZSk7CiAgY29uc3QgY01hcCA9IG5ldyBDTWFwKHRydWUpOwogIGlmIChpc0NvbXByZXNzZWQpIHsKICAgIHJldHVybiBuZXcgQmluYXJ5Q01hcFJlYWRlcigpLnByb2Nlc3MoY01hcERhdGEsIGNNYXAsIHVzZUNNYXAgPT4gZXh0ZW5kQ01hcChjTWFwLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKSk7CiAgfQogIGNvbnN0IGxleGVyID0gbmV3IExleGVyKG5ldyBTdHJlYW0oY01hcERhdGEpKTsKICByZXR1cm4gcGFyc2VDTWFwKGNNYXAsIGxleGVyLCBmZXRjaEJ1aWx0SW5DTWFwLCBudWxsKTsKfQpjbGFzcyBDTWFwRmFjdG9yeSB7CiAgc3RhdGljIGFzeW5jIGNyZWF0ZSh7CiAgICBlbmNvZGluZywKICAgIGZldGNoQnVpbHRJbkNNYXAsCiAgICB1c2VDTWFwCiAgfSkgewogICAgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgTmFtZSkgewogICAgICByZXR1cm4gY3JlYXRlQnVpbHRJbkNNYXAoZW5jb2RpbmcubmFtZSwgZmV0Y2hCdWlsdEluQ01hcCk7CiAgICB9IGVsc2UgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICBjb25zdCBwYXJzZWRDTWFwID0gYXdhaXQgcGFyc2VDTWFwKG5ldyBDTWFwKCksIG5ldyBMZXhlcihlbmNvZGluZyksIGZldGNoQnVpbHRJbkNNYXAsIHVzZUNNYXApOwogICAgICBpZiAocGFyc2VkQ01hcC5pc0lkZW50aXR5Q01hcCkgewogICAgICAgIHJldHVybiBjcmVhdGVCdWlsdEluQ01hcChwYXJzZWRDTWFwLm5hbWUsIGZldGNoQnVpbHRJbkNNYXApOwogICAgICB9CiAgICAgIHJldHVybiBwYXJzZWRDTWFwOwogICAgfQogICAgdGhyb3cgbmV3IEVycm9yKCJFbmNvZGluZyByZXF1aXJlZC4iKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2VuY29kaW5ncy5qcwpjb25zdCBFeHBlcnRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICIiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAiYW1wZXJzYW5kc21hbGwiLCAiQWN1dGVzbWFsbCIsICJwYXJlbmxlZnRzdXBlcmlvciIsICJwYXJlbnJpZ2h0c3VwZXJpb3IiLCAidHdvZG90ZW5sZWFkZXIiLCAib25lZG90ZW5sZWFkZXIiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJmcmFjdGlvbiIsICJ6ZXJvb2xkc3R5bGUiLCAib25lb2xkc3R5bGUiLCAidHdvb2xkc3R5bGUiLCAidGhyZWVvbGRzdHlsZSIsICJmb3Vyb2xkc3R5bGUiLCAiZml2ZW9sZHN0eWxlIiwgInNpeG9sZHN0eWxlIiwgInNldmVub2xkc3R5bGUiLCAiZWlnaHRvbGRzdHlsZSIsICJuaW5lb2xkc3R5bGUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImNvbW1hc3VwZXJpb3IiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICJwZXJpb2RzdXBlcmlvciIsICJxdWVzdGlvbnNtYWxsIiwgIiIsICJhc3VwZXJpb3IiLCAiYnN1cGVyaW9yIiwgImNlbnRzdXBlcmlvciIsICJkc3VwZXJpb3IiLCAiZXN1cGVyaW9yIiwgIiIsICIiLCAiIiwgImlzdXBlcmlvciIsICIiLCAiIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICIiLCAiIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgIiIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgIiIsICJwYXJlbnJpZ2h0aW5mZXJpb3IiLCAiQ2lyY3VtZmxleHNtYWxsIiwgImh5cGhlbnN1cGVyaW9yIiwgIkdyYXZlc21hbGwiLCAiQXNtYWxsIiwgIkJzbWFsbCIsICJDc21hbGwiLCAiRHNtYWxsIiwgIkVzbWFsbCIsICJGc21hbGwiLCAiR3NtYWxsIiwgIkhzbWFsbCIsICJJc21hbGwiLCAiSnNtYWxsIiwgIktzbWFsbCIsICJMc21hbGwiLCAiTXNtYWxsIiwgIk5zbWFsbCIsICJPc21hbGwiLCAiUHNtYWxsIiwgIlFzbWFsbCIsICJSc21hbGwiLCAiU3NtYWxsIiwgIlRzbWFsbCIsICJVc21hbGwiLCAiVnNtYWxsIiwgIldzbWFsbCIsICJYc21hbGwiLCAiWXNtYWxsIiwgIlpzbWFsbCIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiVGlsZGVzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICIiLCAiIiwgIlNjYXJvbnNtYWxsIiwgIlpjYXJvbnNtYWxsIiwgIkRpZXJlc2lzc21hbGwiLCAiQnJldmVzbWFsbCIsICJDYXJvbnNtYWxsIiwgIiIsICJEb3RhY2NlbnRzbWFsbCIsICIiLCAiIiwgIk1hY3JvbnNtYWxsIiwgIiIsICIiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICIiLCAiIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAiIiwgIiIsICIiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgIiIsICIiLCAiemVyb3N1cGVyaW9yIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIl07CmNvbnN0IE1hY0V4cGVydEVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbXNtYWxsIiwgIkh1bmdhcnVtbGF1dHNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiIiwgInRocmVlcXVhcnRlcnNlbWRhc2giLCAiIiwgInF1ZXN0aW9uc21hbGwiLCAiIiwgIiIsICIiLCAiIiwgIkV0aHNtYWxsIiwgIiIsICIiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAiIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJDaXJjdW1mbGV4c21hbGwiLCAiaHlwaGVuaW5mZXJpb3IiLCAiR3JhdmVzbWFsbCIsICJBc21hbGwiLCAiQnNtYWxsIiwgIkNzbWFsbCIsICJEc21hbGwiLCAiRXNtYWxsIiwgIkZzbWFsbCIsICJHc21hbGwiLCAiSHNtYWxsIiwgIklzbWFsbCIsICJKc21hbGwiLCAiS3NtYWxsIiwgIkxzbWFsbCIsICJNc21hbGwiLCAiTnNtYWxsIiwgIk9zbWFsbCIsICJQc21hbGwiLCAiUXNtYWxsIiwgIlJzbWFsbCIsICJTc21hbGwiLCAiVHNtYWxsIiwgIlVzbWFsbCIsICJWc21hbGwiLCAiV3NtYWxsIiwgIlhzbWFsbCIsICJZc21hbGwiLCAiWnNtYWxsIiwgImNvbG9ubW9uZXRhcnkiLCAib25lZml0dGVkIiwgInJ1cGlhaCIsICJUaWxkZXNtYWxsIiwgIiIsICIiLCAiYXN1cGVyaW9yIiwgImNlbnRzdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiQWFjdXRlc21hbGwiLCAiQWdyYXZlc21hbGwiLCAiQWNpcmN1bWZsZXhzbWFsbCIsICJBZGllcmVzaXNzbWFsbCIsICJBdGlsZGVzbWFsbCIsICJBcmluZ3NtYWxsIiwgIkNjZWRpbGxhc21hbGwiLCAiRWFjdXRlc21hbGwiLCAiRWdyYXZlc21hbGwiLCAiRWNpcmN1bWZsZXhzbWFsbCIsICJFZGllcmVzaXNzbWFsbCIsICJJYWN1dGVzbWFsbCIsICJJZ3JhdmVzbWFsbCIsICJJY2lyY3VtZmxleHNtYWxsIiwgIklkaWVyZXNpc3NtYWxsIiwgIk50aWxkZXNtYWxsIiwgIk9hY3V0ZXNtYWxsIiwgIk9ncmF2ZXNtYWxsIiwgIk9jaXJjdW1mbGV4c21hbGwiLCAiT2RpZXJlc2lzc21hbGwiLCAiT3RpbGRlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICIiLCAiZWlnaHRzdXBlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJzaXhpbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiU2Nhcm9uc21hbGwiLCAiIiwgImNlbnRpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICIiLCAiRGllcmVzaXNzbWFsbCIsICIiLCAiQ2Fyb25zbWFsbCIsICJvc3VwZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgIiIsICJjb21tYWluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgIllhY3V0ZXNtYWxsIiwgIiIsICJkb2xsYXJpbmZlcmlvciIsICIiLCAiIiwgIlRob3Juc21hbGwiLCAiIiwgIm5pbmVpbmZlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAiWmNhcm9uc21hbGwiLCAiQUVzbWFsbCIsICJPc2xhc2hzbWFsbCIsICJxdWVzdGlvbmRvd25zbWFsbCIsICJvbmVpbmZlcmlvciIsICJMc2xhc2hzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJDZWRpbGxhc21hbGwiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJPRXNtYWxsIiwgImZpZ3VyZWRhc2giLCAiaHlwaGVuc3VwZXJpb3IiLCAiIiwgIiIsICIiLCAiIiwgImV4Y2xhbWRvd25zbWFsbCIsICIiLCAiWWRpZXJlc2lzc21hbGwiLCAiIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvc3VwZXJpb3IiLCAiIiwgImVzdXBlcmlvciIsICJyc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgIiIsICIiLCAiaXN1cGVyaW9yIiwgInNzdXBlcmlvciIsICJkc3VwZXJpb3IiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJsc3VwZXJpb3IiLCAiT2dvbmVrc21hbGwiLCAiQnJldmVzbWFsbCIsICJNYWNyb25zbWFsbCIsICJic3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJjb21tYXN1cGVyaW9yIiwgInBlcmlvZHN1cGVyaW9yIiwgIkRvdGFjY2VudHNtYWxsIiwgIlJpbmdzbWFsbCIsICIiLCAiIiwgIiIsICIiXTsKY29uc3QgTWFjUm9tYW5FbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAicXVvdGVkYmwiLCAibnVtYmVyc2lnbiIsICJkb2xsYXIiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAicXVvdGVzaW5nbGUiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgImdyYXZlIiwgImEiLCAiYiIsICJjIiwgImQiLCAiZSIsICJmIiwgImciLCAiaCIsICJpIiwgImoiLCAiayIsICJsIiwgIm0iLCAibiIsICJvIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ1IiwgInYiLCAidyIsICJ4IiwgInkiLCAieiIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAiYXNjaWl0aWxkZSIsICIiLCAiQWRpZXJlc2lzIiwgIkFyaW5nIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJOdGlsZGUiLCAiT2RpZXJlc2lzIiwgIlVkaWVyZXNpcyIsICJhYWN1dGUiLCAiYWdyYXZlIiwgImFjaXJjdW1mbGV4IiwgImFkaWVyZXNpcyIsICJhdGlsZGUiLCAiYXJpbmciLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVncmF2ZSIsICJlY2lyY3VtZmxleCIsICJlZGllcmVzaXMiLCAiaWFjdXRlIiwgImlncmF2ZSIsICJpY2lyY3VtZmxleCIsICJpZGllcmVzaXMiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvZ3JhdmUiLCAib2NpcmN1bWZsZXgiLCAib2RpZXJlc2lzIiwgIm90aWxkZSIsICJ1YWN1dGUiLCAidWdyYXZlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJkYWdnZXIiLCAiZGVncmVlIiwgImNlbnQiLCAic3RlcmxpbmciLCAic2VjdGlvbiIsICJidWxsZXQiLCAicGFyYWdyYXBoIiwgImdlcm1hbmRibHMiLCAicmVnaXN0ZXJlZCIsICJjb3B5cmlnaHQiLCAidHJhZGVtYXJrIiwgImFjdXRlIiwgImRpZXJlc2lzIiwgIm5vdGVxdWFsIiwgIkFFIiwgIk9zbGFzaCIsICJpbmZpbml0eSIsICJwbHVzbWludXMiLCAibGVzc2VxdWFsIiwgImdyZWF0ZXJlcXVhbCIsICJ5ZW4iLCAibXUiLCAicGFydGlhbGRpZmYiLCAic3VtbWF0aW9uIiwgInByb2R1Y3QiLCAicGkiLCAiaW50ZWdyYWwiLCAib3JkZmVtaW5pbmUiLCAib3JkbWFzY3VsaW5lIiwgIk9tZWdhIiwgImFlIiwgIm9zbGFzaCIsICJxdWVzdGlvbmRvd24iLCAiZXhjbGFtZG93biIsICJsb2dpY2Fsbm90IiwgInJhZGljYWwiLCAiZmxvcmluIiwgImFwcHJveGVxdWFsIiwgIkRlbHRhIiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAic3BhY2UiLCAiQWdyYXZlIiwgIkF0aWxkZSIsICJPdGlsZGUiLCAiT0UiLCAib2UiLCAiZW5kYXNoIiwgImVtZGFzaCIsICJxdW90ZWRibGxlZnQiLCAicXVvdGVkYmxyaWdodCIsICJxdW90ZWxlZnQiLCAicXVvdGVyaWdodCIsICJkaXZpZGUiLCAibG96ZW5nZSIsICJ5ZGllcmVzaXMiLCAiWWRpZXJlc2lzIiwgImZyYWN0aW9uIiwgImN1cnJlbmN5IiwgImd1aWxzaW5nbGxlZnQiLCAiZ3VpbHNpbmdscmlnaHQiLCAiZmkiLCAiZmwiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJwZXJ0aG91c2FuZCIsICJBY2lyY3VtZmxleCIsICJFY2lyY3VtZmxleCIsICJBYWN1dGUiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiYXBwbGUiLCAiT2dyYXZlIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZ3JhdmUiLCAiZG90bGVzc2kiLCAiY2lyY3VtZmxleCIsICJ0aWxkZSIsICJtYWNyb24iLCAiYnJldmUiLCAiZG90YWNjZW50IiwgInJpbmciLCAiY2VkaWxsYSIsICJodW5nYXJ1bWxhdXQiLCAib2dvbmVrIiwgImNhcm9uIl07CmNvbnN0IFN0YW5kYXJkRW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3RlcmlnaHQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgInF1b3RlbGVmdCIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJmcmFjdGlvbiIsICJ5ZW4iLCAiZmxvcmluIiwgInNlY3Rpb24iLCAiY3VycmVuY3kiLCAicXVvdGVzaW5nbGUiLCAicXVvdGVkYmxsZWZ0IiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICIiLCAiZW5kYXNoIiwgImRhZ2dlciIsICJkYWdnZXJkYmwiLCAicGVyaW9kY2VudGVyZWQiLCAiIiwgInBhcmFncmFwaCIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInF1b3RlZGJscmlnaHQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAicGVydGhvdXNhbmQiLCAiIiwgInF1ZXN0aW9uZG93biIsICIiLCAiZ3JhdmUiLCAiYWN1dGUiLCAiY2lyY3VtZmxleCIsICJ0aWxkZSIsICJtYWNyb24iLCAiYnJldmUiLCAiZG90YWNjZW50IiwgImRpZXJlc2lzIiwgIiIsICJyaW5nIiwgImNlZGlsbGEiLCAiIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiZW1kYXNoIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJBRSIsICIiLCAib3JkZmVtaW5pbmUiLCAiIiwgIiIsICIiLCAiIiwgIkxzbGFzaCIsICJPc2xhc2giLCAiT0UiLCAib3JkbWFzY3VsaW5lIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiYWUiLCAiIiwgIiIsICIiLCAiZG90bGVzc2kiLCAiIiwgIiIsICJsc2xhc2giLCAib3NsYXNoIiwgIm9lIiwgImdlcm1hbmRibHMiLCAiIiwgIiIsICIiLCAiIl07CmNvbnN0IFdpbkFuc2lFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAicXVvdGVkYmwiLCAibnVtYmVyc2lnbiIsICJkb2xsYXIiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAicXVvdGVzaW5nbGUiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgImdyYXZlIiwgImEiLCAiYiIsICJjIiwgImQiLCAiZSIsICJmIiwgImciLCAiaCIsICJpIiwgImoiLCAiayIsICJsIiwgIm0iLCAibiIsICJvIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ1IiwgInYiLCAidyIsICJ4IiwgInkiLCAieiIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAiYXNjaWl0aWxkZSIsICJidWxsZXQiLCAiRXVybyIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAiZmxvcmluIiwgInF1b3RlZGJsYmFzZSIsICJlbGxpcHNpcyIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgImNpcmN1bWZsZXgiLCAicGVydGhvdXNhbmQiLCAiU2Nhcm9uIiwgImd1aWxzaW5nbGxlZnQiLCAiT0UiLCAiYnVsbGV0IiwgIlpjYXJvbiIsICJidWxsZXQiLCAiYnVsbGV0IiwgInF1b3RlbGVmdCIsICJxdW90ZXJpZ2h0IiwgInF1b3RlZGJsbGVmdCIsICJxdW90ZWRibHJpZ2h0IiwgImJ1bGxldCIsICJlbmRhc2giLCAiZW1kYXNoIiwgInRpbGRlIiwgInRyYWRlbWFyayIsICJzY2Fyb24iLCAiZ3VpbHNpbmdscmlnaHQiLCAib2UiLCAiYnVsbGV0IiwgInpjYXJvbiIsICJZZGllcmVzaXMiLCAic3BhY2UiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImN1cnJlbmN5IiwgInllbiIsICJicm9rZW5iYXIiLCAic2VjdGlvbiIsICJkaWVyZXNpcyIsICJjb3B5cmlnaHQiLCAib3JkZmVtaW5pbmUiLCAiZ3VpbGxlbW90bGVmdCIsICJsb2dpY2Fsbm90IiwgImh5cGhlbiIsICJyZWdpc3RlcmVkIiwgIm1hY3JvbiIsICJkZWdyZWUiLCAicGx1c21pbnVzIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiYWN1dGUiLCAibXUiLCAicGFyYWdyYXBoIiwgInBlcmlvZGNlbnRlcmVkIiwgImNlZGlsbGEiLCAib25lc3VwZXJpb3IiLCAib3JkbWFzY3VsaW5lIiwgImd1aWxsZW1vdHJpZ2h0IiwgIm9uZXF1YXJ0ZXIiLCAib25laGFsZiIsICJ0aHJlZXF1YXJ0ZXJzIiwgInF1ZXN0aW9uZG93biIsICJBZ3JhdmUiLCAiQWFjdXRlIiwgIkFjaXJjdW1mbGV4IiwgIkF0aWxkZSIsICJBZGllcmVzaXMiLCAiQXJpbmciLCAiQUUiLCAiQ2NlZGlsbGEiLCAiRWdyYXZlIiwgIkVhY3V0ZSIsICJFY2lyY3VtZmxleCIsICJFZGllcmVzaXMiLCAiSWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiRXRoIiwgIk50aWxkZSIsICJPZ3JhdmUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgIk90aWxkZSIsICJPZGllcmVzaXMiLCAibXVsdGlwbHkiLCAiT3NsYXNoIiwgIlVncmF2ZSIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWRpZXJlc2lzIiwgIllhY3V0ZSIsICJUaG9ybiIsICJnZXJtYW5kYmxzIiwgImFncmF2ZSIsICJhYWN1dGUiLCAiYWNpcmN1bWZsZXgiLCAiYXRpbGRlIiwgImFkaWVyZXNpcyIsICJhcmluZyIsICJhZSIsICJjY2VkaWxsYSIsICJlZ3JhdmUiLCAiZWFjdXRlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJpZ3JhdmUiLCAiaWFjdXRlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJldGgiLCAibnRpbGRlIiwgIm9ncmF2ZSIsICJvYWN1dGUiLCAib2NpcmN1bWZsZXgiLCAib3RpbGRlIiwgIm9kaWVyZXNpcyIsICJkaXZpZGUiLCAib3NsYXNoIiwgInVncmF2ZSIsICJ1YWN1dGUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgInlhY3V0ZSIsICJ0aG9ybiIsICJ5ZGllcmVzaXMiXTsKY29uc3QgU3ltYm9sU2V0RW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtIiwgInVuaXZlcnNhbCIsICJudW1iZXJzaWduIiwgImV4aXN0ZW50aWFsIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInN1Y2h0aGF0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrbWF0aCIsICJwbHVzIiwgImNvbW1hIiwgIm1pbnVzIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiY29uZ3J1ZW50IiwgIkFscGhhIiwgIkJldGEiLCAiQ2hpIiwgIkRlbHRhIiwgIkVwc2lsb24iLCAiUGhpIiwgIkdhbW1hIiwgIkV0YSIsICJJb3RhIiwgInRoZXRhMSIsICJLYXBwYSIsICJMYW1iZGEiLCAiTXUiLCAiTnUiLCAiT21pY3JvbiIsICJQaSIsICJUaGV0YSIsICJSaG8iLCAiU2lnbWEiLCAiVGF1IiwgIlVwc2lsb24iLCAic2lnbWExIiwgIk9tZWdhIiwgIlhpIiwgIlBzaSIsICJaZXRhIiwgImJyYWNrZXRsZWZ0IiwgInRoZXJlZm9yZSIsICJicmFja2V0cmlnaHQiLCAicGVycGVuZGljdWxhciIsICJ1bmRlcnNjb3JlIiwgInJhZGljYWxleCIsICJhbHBoYSIsICJiZXRhIiwgImNoaSIsICJkZWx0YSIsICJlcHNpbG9uIiwgInBoaSIsICJnYW1tYSIsICJldGEiLCAiaW90YSIsICJwaGkxIiwgImthcHBhIiwgImxhbWJkYSIsICJtdSIsICJudSIsICJvbWljcm9uIiwgInBpIiwgInRoZXRhIiwgInJobyIsICJzaWdtYSIsICJ0YXUiLCAidXBzaWxvbiIsICJvbWVnYTEiLCAib21lZ2EiLCAieGkiLCAicHNpIiwgInpldGEiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgInNpbWlsYXIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiRXVybyIsICJVcHNpbG9uMSIsICJtaW51dGUiLCAibGVzc2VxdWFsIiwgImZyYWN0aW9uIiwgImluZmluaXR5IiwgImZsb3JpbiIsICJjbHViIiwgImRpYW1vbmQiLCAiaGVhcnQiLCAic3BhZGUiLCAiYXJyb3dib3RoIiwgImFycm93bGVmdCIsICJhcnJvd3VwIiwgImFycm93cmlnaHQiLCAiYXJyb3dkb3duIiwgImRlZ3JlZSIsICJwbHVzbWludXMiLCAic2Vjb25kIiwgImdyZWF0ZXJlcXVhbCIsICJtdWx0aXBseSIsICJwcm9wb3J0aW9uYWwiLCAicGFydGlhbGRpZmYiLCAiYnVsbGV0IiwgImRpdmlkZSIsICJub3RlcXVhbCIsICJlcXVpdmFsZW5jZSIsICJhcHByb3hlcXVhbCIsICJlbGxpcHNpcyIsICJhcnJvd3ZlcnRleCIsICJhcnJvd2hvcml6ZXgiLCAiY2FycmlhZ2VyZXR1cm4iLCAiYWxlcGgiLCAiSWZyYWt0dXIiLCAiUmZyYWt0dXIiLCAid2VpZXJzdHJhc3MiLCAiY2lyY2xlbXVsdGlwbHkiLCAiY2lyY2xlcGx1cyIsICJlbXB0eXNldCIsICJpbnRlcnNlY3Rpb24iLCAidW5pb24iLCAicHJvcGVyc3VwZXJzZXQiLCAicmVmbGV4c3VwZXJzZXQiLCAibm90c3Vic2V0IiwgInByb3BlcnN1YnNldCIsICJyZWZsZXhzdWJzZXQiLCAiZWxlbWVudCIsICJub3RlbGVtZW50IiwgImFuZ2xlIiwgImdyYWRpZW50IiwgInJlZ2lzdGVyc2VyaWYiLCAiY29weXJpZ2h0c2VyaWYiLCAidHJhZGVtYXJrc2VyaWYiLCAicHJvZHVjdCIsICJyYWRpY2FsIiwgImRvdG1hdGgiLCAibG9naWNhbG5vdCIsICJsb2dpY2FsYW5kIiwgImxvZ2ljYWxvciIsICJhcnJvd2RibGJvdGgiLCAiYXJyb3dkYmxsZWZ0IiwgImFycm93ZGJsdXAiLCAiYXJyb3dkYmxyaWdodCIsICJhcnJvd2RibGRvd24iLCAibG96ZW5nZSIsICJhbmdsZWxlZnQiLCAicmVnaXN0ZXJzYW5zIiwgImNvcHlyaWdodHNhbnMiLCAidHJhZGVtYXJrc2FucyIsICJzdW1tYXRpb24iLCAicGFyZW5sZWZ0dHAiLCAicGFyZW5sZWZ0ZXgiLCAicGFyZW5sZWZ0YnQiLCAiYnJhY2tldGxlZnR0cCIsICJicmFja2V0bGVmdGV4IiwgImJyYWNrZXRsZWZ0YnQiLCAiYnJhY2VsZWZ0dHAiLCAiYnJhY2VsZWZ0bWlkIiwgImJyYWNlbGVmdGJ0IiwgImJyYWNlZXgiLCAiIiwgImFuZ2xlcmlnaHQiLCAiaW50ZWdyYWwiLCAiaW50ZWdyYWx0cCIsICJpbnRlZ3JhbGV4IiwgImludGVncmFsYnQiLCAicGFyZW5yaWdodHRwIiwgInBhcmVucmlnaHRleCIsICJwYXJlbnJpZ2h0YnQiLCAiYnJhY2tldHJpZ2h0dHAiLCAiYnJhY2tldHJpZ2h0ZXgiLCAiYnJhY2tldHJpZ2h0YnQiLCAiYnJhY2VyaWdodHRwIiwgImJyYWNlcmlnaHRtaWQiLCAiYnJhY2VyaWdodGJ0IiwgIiJdOwpjb25zdCBaYXBmRGluZ2JhdHNFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJhMSIsICJhMiIsICJhMjAyIiwgImEzIiwgImE0IiwgImE1IiwgImExMTkiLCAiYTExOCIsICJhMTE3IiwgImExMSIsICJhMTIiLCAiYTEzIiwgImExNCIsICJhMTUiLCAiYTE2IiwgImExMDUiLCAiYTE3IiwgImExOCIsICJhMTkiLCAiYTIwIiwgImEyMSIsICJhMjIiLCAiYTIzIiwgImEyNCIsICJhMjUiLCAiYTI2IiwgImEyNyIsICJhMjgiLCAiYTYiLCAiYTciLCAiYTgiLCAiYTkiLCAiYTEwIiwgImEyOSIsICJhMzAiLCAiYTMxIiwgImEzMiIsICJhMzMiLCAiYTM0IiwgImEzNSIsICJhMzYiLCAiYTM3IiwgImEzOCIsICJhMzkiLCAiYTQwIiwgImE0MSIsICJhNDIiLCAiYTQzIiwgImE0NCIsICJhNDUiLCAiYTQ2IiwgImE0NyIsICJhNDgiLCAiYTQ5IiwgImE1MCIsICJhNTEiLCAiYTUyIiwgImE1MyIsICJhNTQiLCAiYTU1IiwgImE1NiIsICJhNTciLCAiYTU4IiwgImE1OSIsICJhNjAiLCAiYTYxIiwgImE2MiIsICJhNjMiLCAiYTY0IiwgImE2NSIsICJhNjYiLCAiYTY3IiwgImE2OCIsICJhNjkiLCAiYTcwIiwgImE3MSIsICJhNzIiLCAiYTczIiwgImE3NCIsICJhMjAzIiwgImE3NSIsICJhMjA0IiwgImE3NiIsICJhNzciLCAiYTc4IiwgImE3OSIsICJhODEiLCAiYTgyIiwgImE4MyIsICJhODQiLCAiYTk3IiwgImE5OCIsICJhOTkiLCAiYTEwMCIsICIiLCAiYTg5IiwgImE5MCIsICJhOTMiLCAiYTk0IiwgImE5MSIsICJhOTIiLCAiYTIwNSIsICJhODUiLCAiYTIwNiIsICJhODYiLCAiYTg3IiwgImE4OCIsICJhOTUiLCAiYTk2IiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJhMTAxIiwgImExMDIiLCAiYTEwMyIsICJhMTA0IiwgImExMDYiLCAiYTEwNyIsICJhMTA4IiwgImExMTIiLCAiYTExMSIsICJhMTEwIiwgImExMDkiLCAiYTEyMCIsICJhMTIxIiwgImExMjIiLCAiYTEyMyIsICJhMTI0IiwgImExMjUiLCAiYTEyNiIsICJhMTI3IiwgImExMjgiLCAiYTEyOSIsICJhMTMwIiwgImExMzEiLCAiYTEzMiIsICJhMTMzIiwgImExMzQiLCAiYTEzNSIsICJhMTM2IiwgImExMzciLCAiYTEzOCIsICJhMTM5IiwgImExNDAiLCAiYTE0MSIsICJhMTQyIiwgImExNDMiLCAiYTE0NCIsICJhMTQ1IiwgImExNDYiLCAiYTE0NyIsICJhMTQ4IiwgImExNDkiLCAiYTE1MCIsICJhMTUxIiwgImExNTIiLCAiYTE1MyIsICJhMTU0IiwgImExNTUiLCAiYTE1NiIsICJhMTU3IiwgImExNTgiLCAiYTE1OSIsICJhMTYwIiwgImExNjEiLCAiYTE2MyIsICJhMTY0IiwgImExOTYiLCAiYTE2NSIsICJhMTkyIiwgImExNjYiLCAiYTE2NyIsICJhMTY4IiwgImExNjkiLCAiYTE3MCIsICJhMTcxIiwgImExNzIiLCAiYTE3MyIsICJhMTYyIiwgImExNzQiLCAiYTE3NSIsICJhMTc2IiwgImExNzciLCAiYTE3OCIsICJhMTc5IiwgImExOTMiLCAiYTE4MCIsICJhMTk5IiwgImExODEiLCAiYTIwMCIsICJhMTgyIiwgIiIsICJhMjAxIiwgImExODMiLCAiYTE4NCIsICJhMTk3IiwgImExODUiLCAiYTE5NCIsICJhMTk4IiwgImExODYiLCAiYTE5NSIsICJhMTg3IiwgImExODgiLCAiYTE4OSIsICJhMTkwIiwgImExOTEiLCAiIl07CmZ1bmN0aW9uIGdldEVuY29kaW5nKGVuY29kaW5nTmFtZSkgewogIHN3aXRjaCAoZW5jb2RpbmdOYW1lKSB7CiAgICBjYXNlICJXaW5BbnNpRW5jb2RpbmciOgogICAgICByZXR1cm4gV2luQW5zaUVuY29kaW5nOwogICAgY2FzZSAiU3RhbmRhcmRFbmNvZGluZyI6CiAgICAgIHJldHVybiBTdGFuZGFyZEVuY29kaW5nOwogICAgY2FzZSAiTWFjUm9tYW5FbmNvZGluZyI6CiAgICAgIHJldHVybiBNYWNSb21hbkVuY29kaW5nOwogICAgY2FzZSAiU3ltYm9sU2V0RW5jb2RpbmciOgogICAgICByZXR1cm4gU3ltYm9sU2V0RW5jb2Rpbmc7CiAgICBjYXNlICJaYXBmRGluZ2JhdHNFbmNvZGluZyI6CiAgICAgIHJldHVybiBaYXBmRGluZ2JhdHNFbmNvZGluZzsKICAgIGNhc2UgIkV4cGVydEVuY29kaW5nIjoKICAgICAgcmV0dXJuIEV4cGVydEVuY29kaW5nOwogICAgY2FzZSAiTWFjRXhwZXJ0RW5jb2RpbmciOgogICAgICByZXR1cm4gTWFjRXhwZXJ0RW5jb2Rpbmc7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2dseXBobGlzdC5qcwoKY29uc3QgZ2V0R2x5cGhzVW5pY29kZSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuQSA9IDB4MDA0MTsKICB0LkFFID0gMHgwMGM2OwogIHQuQUVhY3V0ZSA9IDB4MDFmYzsKICB0LkFFbWFjcm9uID0gMHgwMWUyOwogIHQuQUVzbWFsbCA9IDB4ZjdlNjsKICB0LkFhY3V0ZSA9IDB4MDBjMTsKICB0LkFhY3V0ZXNtYWxsID0gMHhmN2UxOwogIHQuQWJyZXZlID0gMHgwMTAyOwogIHQuQWJyZXZlYWN1dGUgPSAweDFlYWU7CiAgdC5BYnJldmVjeXJpbGxpYyA9IDB4MDRkMDsKICB0LkFicmV2ZWRvdGJlbG93ID0gMHgxZWI2OwogIHQuQWJyZXZlZ3JhdmUgPSAweDFlYjA7CiAgdC5BYnJldmVob29rYWJvdmUgPSAweDFlYjI7CiAgdC5BYnJldmV0aWxkZSA9IDB4MWViNDsKICB0LkFjYXJvbiA9IDB4MDFjZDsKICB0LkFjaXJjbGUgPSAweDI0YjY7CiAgdC5BY2lyY3VtZmxleCA9IDB4MDBjMjsKICB0LkFjaXJjdW1mbGV4YWN1dGUgPSAweDFlYTQ7CiAgdC5BY2lyY3VtZmxleGRvdGJlbG93ID0gMHgxZWFjOwogIHQuQWNpcmN1bWZsZXhncmF2ZSA9IDB4MWVhNjsKICB0LkFjaXJjdW1mbGV4aG9va2Fib3ZlID0gMHgxZWE4OwogIHQuQWNpcmN1bWZsZXhzbWFsbCA9IDB4ZjdlMjsKICB0LkFjaXJjdW1mbGV4dGlsZGUgPSAweDFlYWE7CiAgdC5BY3V0ZSA9IDB4ZjZjOTsKICB0LkFjdXRlc21hbGwgPSAweGY3YjQ7CiAgdC5BY3lyaWxsaWMgPSAweDA0MTA7CiAgdC5BZGJsZ3JhdmUgPSAweDAyMDA7CiAgdC5BZGllcmVzaXMgPSAweDAwYzQ7CiAgdC5BZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkMjsKICB0LkFkaWVyZXNpc21hY3JvbiA9IDB4MDFkZTsKICB0LkFkaWVyZXNpc3NtYWxsID0gMHhmN2U0OwogIHQuQWRvdGJlbG93ID0gMHgxZWEwOwogIHQuQWRvdG1hY3JvbiA9IDB4MDFlMDsKICB0LkFncmF2ZSA9IDB4MDBjMDsKICB0LkFncmF2ZXNtYWxsID0gMHhmN2UwOwogIHQuQWhvb2thYm92ZSA9IDB4MWVhMjsKICB0LkFpZWN5cmlsbGljID0gMHgwNGQ0OwogIHQuQWludmVydGVkYnJldmUgPSAweDAyMDI7CiAgdC5BbHBoYSA9IDB4MDM5MTsKICB0LkFscGhhdG9ub3MgPSAweDAzODY7CiAgdC5BbWFjcm9uID0gMHgwMTAwOwogIHQuQW1vbm9zcGFjZSA9IDB4ZmYyMTsKICB0LkFvZ29uZWsgPSAweDAxMDQ7CiAgdC5BcmluZyA9IDB4MDBjNTsKICB0LkFyaW5nYWN1dGUgPSAweDAxZmE7CiAgdC5BcmluZ2JlbG93ID0gMHgxZTAwOwogIHQuQXJpbmdzbWFsbCA9IDB4ZjdlNTsKICB0LkFzbWFsbCA9IDB4Zjc2MTsKICB0LkF0aWxkZSA9IDB4MDBjMzsKICB0LkF0aWxkZXNtYWxsID0gMHhmN2UzOwogIHQuQXliYXJtZW5pYW4gPSAweDA1MzE7CiAgdC5CID0gMHgwMDQyOwogIHQuQmNpcmNsZSA9IDB4MjRiNzsKICB0LkJkb3RhY2NlbnQgPSAweDFlMDI7CiAgdC5CZG90YmVsb3cgPSAweDFlMDQ7CiAgdC5CZWN5cmlsbGljID0gMHgwNDExOwogIHQuQmVuYXJtZW5pYW4gPSAweDA1MzI7CiAgdC5CZXRhID0gMHgwMzkyOwogIHQuQmhvb2sgPSAweDAxODE7CiAgdC5CbGluZWJlbG93ID0gMHgxZTA2OwogIHQuQm1vbm9zcGFjZSA9IDB4ZmYyMjsKICB0LkJyZXZlc21hbGwgPSAweGY2ZjQ7CiAgdC5Cc21hbGwgPSAweGY3NjI7CiAgdC5CdG9wYmFyID0gMHgwMTgyOwogIHQuQyA9IDB4MDA0MzsKICB0LkNhYXJtZW5pYW4gPSAweDA1M2U7CiAgdC5DYWN1dGUgPSAweDAxMDY7CiAgdC5DYXJvbiA9IDB4ZjZjYTsKICB0LkNhcm9uc21hbGwgPSAweGY2ZjU7CiAgdC5DY2Fyb24gPSAweDAxMGM7CiAgdC5DY2VkaWxsYSA9IDB4MDBjNzsKICB0LkNjZWRpbGxhYWN1dGUgPSAweDFlMDg7CiAgdC5DY2VkaWxsYXNtYWxsID0gMHhmN2U3OwogIHQuQ2NpcmNsZSA9IDB4MjRiODsKICB0LkNjaXJjdW1mbGV4ID0gMHgwMTA4OwogIHQuQ2RvdCA9IDB4MDEwYTsKICB0LkNkb3RhY2NlbnQgPSAweDAxMGE7CiAgdC5DZWRpbGxhc21hbGwgPSAweGY3Yjg7CiAgdC5DaGFhcm1lbmlhbiA9IDB4MDU0OTsKICB0LkNoZWFia2hhc2lhbmN5cmlsbGljID0gMHgwNGJjOwogIHQuQ2hlY3lyaWxsaWMgPSAweDA0Mjc7CiAgdC5DaGVkZXNjZW5kZXJhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRiZTsKICB0LkNoZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGI2OwogIHQuQ2hlZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRmNDsKICB0LkNoZWhhcm1lbmlhbiA9IDB4MDU0MzsKICB0LkNoZWtoYWthc3NpYW5jeXJpbGxpYyA9IDB4MDRjYjsKICB0LkNoZXZlcnRpY2Fsc3Ryb2tlY3lyaWxsaWMgPSAweDA0Yjg7CiAgdC5DaGkgPSAweDAzYTc7CiAgdC5DaG9vayA9IDB4MDE4NzsKICB0LkNpcmN1bWZsZXhzbWFsbCA9IDB4ZjZmNjsKICB0LkNtb25vc3BhY2UgPSAweGZmMjM7CiAgdC5Db2FybWVuaWFuID0gMHgwNTUxOwogIHQuQ3NtYWxsID0gMHhmNzYzOwogIHQuRCA9IDB4MDA0NDsKICB0LkRaID0gMHgwMWYxOwogIHQuRFpjYXJvbiA9IDB4MDFjNDsKICB0LkRhYXJtZW5pYW4gPSAweDA1MzQ7CiAgdC5EYWZyaWNhbiA9IDB4MDE4OTsKICB0LkRjYXJvbiA9IDB4MDEwZTsKICB0LkRjZWRpbGxhID0gMHgxZTEwOwogIHQuRGNpcmNsZSA9IDB4MjRiOTsKICB0LkRjaXJjdW1mbGV4YmVsb3cgPSAweDFlMTI7CiAgdC5EY3JvYXQgPSAweDAxMTA7CiAgdC5EZG90YWNjZW50ID0gMHgxZTBhOwogIHQuRGRvdGJlbG93ID0gMHgxZTBjOwogIHQuRGVjeXJpbGxpYyA9IDB4MDQxNDsKICB0LkRlaWNvcHRpYyA9IDB4MDNlZTsKICB0LkRlbHRhID0gMHgyMjA2OwogIHQuRGVsdGFncmVlayA9IDB4MDM5NDsKICB0LkRob29rID0gMHgwMThhOwogIHQuRGllcmVzaXMgPSAweGY2Y2I7CiAgdC5EaWVyZXNpc0FjdXRlID0gMHhmNmNjOwogIHQuRGllcmVzaXNHcmF2ZSA9IDB4ZjZjZDsKICB0LkRpZXJlc2lzc21hbGwgPSAweGY3YTg7CiAgdC5EaWdhbW1hZ3JlZWsgPSAweDAzZGM7CiAgdC5EamVjeXJpbGxpYyA9IDB4MDQwMjsKICB0LkRsaW5lYmVsb3cgPSAweDFlMGU7CiAgdC5EbW9ub3NwYWNlID0gMHhmZjI0OwogIHQuRG90YWNjZW50c21hbGwgPSAweGY2Zjc7CiAgdC5Ec2xhc2ggPSAweDAxMTA7CiAgdC5Ec21hbGwgPSAweGY3NjQ7CiAgdC5EdG9wYmFyID0gMHgwMThiOwogIHQuRHogPSAweDAxZjI7CiAgdC5EemNhcm9uID0gMHgwMWM1OwogIHQuRHplYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0ZTA7CiAgdC5EemVjeXJpbGxpYyA9IDB4MDQwNTsKICB0LkR6aGVjeXJpbGxpYyA9IDB4MDQwZjsKICB0LkUgPSAweDAwNDU7CiAgdC5FYWN1dGUgPSAweDAwYzk7CiAgdC5FYWN1dGVzbWFsbCA9IDB4ZjdlOTsKICB0LkVicmV2ZSA9IDB4MDExNDsKICB0LkVjYXJvbiA9IDB4MDExYTsKICB0LkVjZWRpbGxhYnJldmUgPSAweDFlMWM7CiAgdC5FY2hhcm1lbmlhbiA9IDB4MDUzNTsKICB0LkVjaXJjbGUgPSAweDI0YmE7CiAgdC5FY2lyY3VtZmxleCA9IDB4MDBjYTsKICB0LkVjaXJjdW1mbGV4YWN1dGUgPSAweDFlYmU7CiAgdC5FY2lyY3VtZmxleGJlbG93ID0gMHgxZTE4OwogIHQuRWNpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVjNjsKICB0LkVjaXJjdW1mbGV4Z3JhdmUgPSAweDFlYzA7CiAgdC5FY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVjMjsKICB0LkVjaXJjdW1mbGV4c21hbGwgPSAweGY3ZWE7CiAgdC5FY2lyY3VtZmxleHRpbGRlID0gMHgxZWM0OwogIHQuRWN5cmlsbGljID0gMHgwNDA0OwogIHQuRWRibGdyYXZlID0gMHgwMjA0OwogIHQuRWRpZXJlc2lzID0gMHgwMGNiOwogIHQuRWRpZXJlc2lzc21hbGwgPSAweGY3ZWI7CiAgdC5FZG90ID0gMHgwMTE2OwogIHQuRWRvdGFjY2VudCA9IDB4MDExNjsKICB0LkVkb3RiZWxvdyA9IDB4MWViODsKICB0LkVmY3lyaWxsaWMgPSAweDA0MjQ7CiAgdC5FZ3JhdmUgPSAweDAwYzg7CiAgdC5FZ3JhdmVzbWFsbCA9IDB4ZjdlODsKICB0LkVoYXJtZW5pYW4gPSAweDA1Mzc7CiAgdC5FaG9va2Fib3ZlID0gMHgxZWJhOwogIHQuRWlnaHRyb21hbiA9IDB4MjE2NzsKICB0LkVpbnZlcnRlZGJyZXZlID0gMHgwMjA2OwogIHQuRWlvdGlmaWVkY3lyaWxsaWMgPSAweDA0NjQ7CiAgdC5FbGN5cmlsbGljID0gMHgwNDFiOwogIHQuRWxldmVucm9tYW4gPSAweDIxNmE7CiAgdC5FbWFjcm9uID0gMHgwMTEyOwogIHQuRW1hY3JvbmFjdXRlID0gMHgxZTE2OwogIHQuRW1hY3JvbmdyYXZlID0gMHgxZTE0OwogIHQuRW1jeXJpbGxpYyA9IDB4MDQxYzsKICB0LkVtb25vc3BhY2UgPSAweGZmMjU7CiAgdC5FbmN5cmlsbGljID0gMHgwNDFkOwogIHQuRW5kZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhMjsKICB0LkVuZyA9IDB4MDE0YTsKICB0LkVuZ2hlY3lyaWxsaWMgPSAweDA0YTQ7CiAgdC5Fbmhvb2tjeXJpbGxpYyA9IDB4MDRjNzsKICB0LkVvZ29uZWsgPSAweDAxMTg7CiAgdC5Fb3BlbiA9IDB4MDE5MDsKICB0LkVwc2lsb24gPSAweDAzOTU7CiAgdC5FcHNpbG9udG9ub3MgPSAweDAzODg7CiAgdC5FcmN5cmlsbGljID0gMHgwNDIwOwogIHQuRXJldmVyc2VkID0gMHgwMThlOwogIHQuRXJldmVyc2VkY3lyaWxsaWMgPSAweDA0MmQ7CiAgdC5Fc2N5cmlsbGljID0gMHgwNDIxOwogIHQuRXNkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhYTsKICB0LkVzaCA9IDB4MDFhOTsKICB0LkVzbWFsbCA9IDB4Zjc2NTsKICB0LkV0YSA9IDB4MDM5NzsKICB0LkV0YXJtZW5pYW4gPSAweDA1Mzg7CiAgdC5FdGF0b25vcyA9IDB4MDM4OTsKICB0LkV0aCA9IDB4MDBkMDsKICB0LkV0aHNtYWxsID0gMHhmN2YwOwogIHQuRXRpbGRlID0gMHgxZWJjOwogIHQuRXRpbGRlYmVsb3cgPSAweDFlMWE7CiAgdC5FdXJvID0gMHgyMGFjOwogIHQuRXpoID0gMHgwMWI3OwogIHQuRXpoY2Fyb24gPSAweDAxZWU7CiAgdC5FemhyZXZlcnNlZCA9IDB4MDFiODsKICB0LkYgPSAweDAwNDY7CiAgdC5GY2lyY2xlID0gMHgyNGJiOwogIHQuRmRvdGFjY2VudCA9IDB4MWUxZTsKICB0LkZlaGFybWVuaWFuID0gMHgwNTU2OwogIHQuRmVpY29wdGljID0gMHgwM2U0OwogIHQuRmhvb2sgPSAweDAxOTE7CiAgdC5GaXRhY3lyaWxsaWMgPSAweDA0NzI7CiAgdC5GaXZlcm9tYW4gPSAweDIxNjQ7CiAgdC5GbW9ub3NwYWNlID0gMHhmZjI2OwogIHQuRm91cnJvbWFuID0gMHgyMTYzOwogIHQuRnNtYWxsID0gMHhmNzY2OwogIHQuRyA9IDB4MDA0NzsKICB0LkdCc3F1YXJlID0gMHgzMzg3OwogIHQuR2FjdXRlID0gMHgwMWY0OwogIHQuR2FtbWEgPSAweDAzOTM7CiAgdC5HYW1tYWFmcmljYW4gPSAweDAxOTQ7CiAgdC5HYW5naWFjb3B0aWMgPSAweDAzZWE7CiAgdC5HYnJldmUgPSAweDAxMWU7CiAgdC5HY2Fyb24gPSAweDAxZTY7CiAgdC5HY2VkaWxsYSA9IDB4MDEyMjsKICB0LkdjaXJjbGUgPSAweDI0YmM7CiAgdC5HY2lyY3VtZmxleCA9IDB4MDExYzsKICB0Lkdjb21tYWFjY2VudCA9IDB4MDEyMjsKICB0Lkdkb3QgPSAweDAxMjA7CiAgdC5HZG90YWNjZW50ID0gMHgwMTIwOwogIHQuR2VjeXJpbGxpYyA9IDB4MDQxMzsKICB0LkdoYWRhcm1lbmlhbiA9IDB4MDU0MjsKICB0LkdoZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDQ5NDsKICB0LkdoZXN0cm9rZWN5cmlsbGljID0gMHgwNDkyOwogIHQuR2hldXB0dXJuY3lyaWxsaWMgPSAweDA0OTA7CiAgdC5HaG9vayA9IDB4MDE5MzsKICB0LkdpbWFybWVuaWFuID0gMHgwNTMzOwogIHQuR2plY3lyaWxsaWMgPSAweDA0MDM7CiAgdC5HbWFjcm9uID0gMHgxZTIwOwogIHQuR21vbm9zcGFjZSA9IDB4ZmYyNzsKICB0LkdyYXZlID0gMHhmNmNlOwogIHQuR3JhdmVzbWFsbCA9IDB4Zjc2MDsKICB0LkdzbWFsbCA9IDB4Zjc2NzsKICB0LkdzbWFsbGhvb2sgPSAweDAyOWI7CiAgdC5Hc3Ryb2tlID0gMHgwMWU0OwogIHQuSCA9IDB4MDA0ODsKICB0LkgxODUzMyA9IDB4MjVjZjsKICB0LkgxODU0MyA9IDB4MjVhYTsKICB0LkgxODU1MSA9IDB4MjVhYjsKICB0LkgyMjA3MyA9IDB4MjVhMTsKICB0LkhQc3F1YXJlID0gMHgzM2NiOwogIHQuSGFhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRhODsKICB0LkhhZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0YjI7CiAgdC5IYXJkc2lnbmN5cmlsbGljID0gMHgwNDJhOwogIHQuSGJhciA9IDB4MDEyNjsKICB0LkhicmV2ZWJlbG93ID0gMHgxZTJhOwogIHQuSGNlZGlsbGEgPSAweDFlMjg7CiAgdC5IY2lyY2xlID0gMHgyNGJkOwogIHQuSGNpcmN1bWZsZXggPSAweDAxMjQ7CiAgdC5IZGllcmVzaXMgPSAweDFlMjY7CiAgdC5IZG90YWNjZW50ID0gMHgxZTIyOwogIHQuSGRvdGJlbG93ID0gMHgxZTI0OwogIHQuSG1vbm9zcGFjZSA9IDB4ZmYyODsKICB0LkhvYXJtZW5pYW4gPSAweDA1NDA7CiAgdC5Ib3JpY29wdGljID0gMHgwM2U4OwogIHQuSHNtYWxsID0gMHhmNzY4OwogIHQuSHVuZ2FydW1sYXV0ID0gMHhmNmNmOwogIHQuSHVuZ2FydW1sYXV0c21hbGwgPSAweGY2Zjg7CiAgdC5IenNxdWFyZSA9IDB4MzM5MDsKICB0LkkgPSAweDAwNDk7CiAgdC5JQWN5cmlsbGljID0gMHgwNDJmOwogIHQuSUogPSAweDAxMzI7CiAgdC5JVWN5cmlsbGljID0gMHgwNDJlOwogIHQuSWFjdXRlID0gMHgwMGNkOwogIHQuSWFjdXRlc21hbGwgPSAweGY3ZWQ7CiAgdC5JYnJldmUgPSAweDAxMmM7CiAgdC5JY2Fyb24gPSAweDAxY2Y7CiAgdC5JY2lyY2xlID0gMHgyNGJlOwogIHQuSWNpcmN1bWZsZXggPSAweDAwY2U7CiAgdC5JY2lyY3VtZmxleHNtYWxsID0gMHhmN2VlOwogIHQuSWN5cmlsbGljID0gMHgwNDA2OwogIHQuSWRibGdyYXZlID0gMHgwMjA4OwogIHQuSWRpZXJlc2lzID0gMHgwMGNmOwogIHQuSWRpZXJlc2lzYWN1dGUgPSAweDFlMmU7CiAgdC5JZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNDsKICB0LklkaWVyZXNpc3NtYWxsID0gMHhmN2VmOwogIHQuSWRvdCA9IDB4MDEzMDsKICB0Lklkb3RhY2NlbnQgPSAweDAxMzA7CiAgdC5JZG90YmVsb3cgPSAweDFlY2E7CiAgdC5JZWJyZXZlY3lyaWxsaWMgPSAweDA0ZDY7CiAgdC5JZWN5cmlsbGljID0gMHgwNDE1OwogIHQuSWZyYWt0dXIgPSAweDIxMTE7CiAgdC5JZ3JhdmUgPSAweDAwY2M7CiAgdC5JZ3JhdmVzbWFsbCA9IDB4ZjdlYzsKICB0Lklob29rYWJvdmUgPSAweDFlYzg7CiAgdC5JaWN5cmlsbGljID0gMHgwNDE4OwogIHQuSWludmVydGVkYnJldmUgPSAweDAyMGE7CiAgdC5JaXNob3J0Y3lyaWxsaWMgPSAweDA0MTk7CiAgdC5JbWFjcm9uID0gMHgwMTJhOwogIHQuSW1hY3JvbmN5cmlsbGljID0gMHgwNGUyOwogIHQuSW1vbm9zcGFjZSA9IDB4ZmYyOTsKICB0LkluaWFybWVuaWFuID0gMHgwNTNiOwogIHQuSW9jeXJpbGxpYyA9IDB4MDQwMTsKICB0LklvZ29uZWsgPSAweDAxMmU7CiAgdC5Jb3RhID0gMHgwMzk5OwogIHQuSW90YWFmcmljYW4gPSAweDAxOTY7CiAgdC5Jb3RhZGllcmVzaXMgPSAweDAzYWE7CiAgdC5Jb3RhdG9ub3MgPSAweDAzOGE7CiAgdC5Jc21hbGwgPSAweGY3Njk7CiAgdC5Jc3Ryb2tlID0gMHgwMTk3OwogIHQuSXRpbGRlID0gMHgwMTI4OwogIHQuSXRpbGRlYmVsb3cgPSAweDFlMmM7CiAgdC5JemhpdHNhY3lyaWxsaWMgPSAweDA0NzQ7CiAgdC5JemhpdHNhZGJsZ3JhdmVjeXJpbGxpYyA9IDB4MDQ3NjsKICB0LkogPSAweDAwNGE7CiAgdC5KYWFybWVuaWFuID0gMHgwNTQxOwogIHQuSmNpcmNsZSA9IDB4MjRiZjsKICB0LkpjaXJjdW1mbGV4ID0gMHgwMTM0OwogIHQuSmVjeXJpbGxpYyA9IDB4MDQwODsKICB0LkpoZWhhcm1lbmlhbiA9IDB4MDU0YjsKICB0Lkptb25vc3BhY2UgPSAweGZmMmE7CiAgdC5Kc21hbGwgPSAweGY3NmE7CiAgdC5LID0gMHgwMDRiOwogIHQuS0JzcXVhcmUgPSAweDMzODU7CiAgdC5LS3NxdWFyZSA9IDB4MzNjZDsKICB0LkthYmFzaGtpcmN5cmlsbGljID0gMHgwNGEwOwogIHQuS2FjdXRlID0gMHgxZTMwOwogIHQuS2FjeXJpbGxpYyA9IDB4MDQxYTsKICB0LkthZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OWE7CiAgdC5LYWhvb2tjeXJpbGxpYyA9IDB4MDRjMzsKICB0LkthcHBhID0gMHgwMzlhOwogIHQuS2FzdHJva2VjeXJpbGxpYyA9IDB4MDQ5ZTsKICB0LkthdmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDQ5YzsKICB0LktjYXJvbiA9IDB4MDFlODsKICB0LktjZWRpbGxhID0gMHgwMTM2OwogIHQuS2NpcmNsZSA9IDB4MjRjMDsKICB0Lktjb21tYWFjY2VudCA9IDB4MDEzNjsKICB0Lktkb3RiZWxvdyA9IDB4MWUzMjsKICB0LktlaGFybWVuaWFuID0gMHgwNTU0OwogIHQuS2VuYXJtZW5pYW4gPSAweDA1M2Y7CiAgdC5LaGFjeXJpbGxpYyA9IDB4MDQyNTsKICB0LktoZWljb3B0aWMgPSAweDAzZTY7CiAgdC5LaG9vayA9IDB4MDE5ODsKICB0LktqZWN5cmlsbGljID0gMHgwNDBjOwogIHQuS2xpbmViZWxvdyA9IDB4MWUzNDsKICB0Lkttb25vc3BhY2UgPSAweGZmMmI7CiAgdC5Lb3BwYWN5cmlsbGljID0gMHgwNDgwOwogIHQuS29wcGFncmVlayA9IDB4MDNkZTsKICB0LktzaWN5cmlsbGljID0gMHgwNDZlOwogIHQuS3NtYWxsID0gMHhmNzZiOwogIHQuTCA9IDB4MDA0YzsKICB0LkxKID0gMHgwMWM3OwogIHQuTEwgPSAweGY2YmY7CiAgdC5MYWN1dGUgPSAweDAxMzk7CiAgdC5MYW1iZGEgPSAweDAzOWI7CiAgdC5MY2Fyb24gPSAweDAxM2Q7CiAgdC5MY2VkaWxsYSA9IDB4MDEzYjsKICB0LkxjaXJjbGUgPSAweDI0YzE7CiAgdC5MY2lyY3VtZmxleGJlbG93ID0gMHgxZTNjOwogIHQuTGNvbW1hYWNjZW50ID0gMHgwMTNiOwogIHQuTGRvdCA9IDB4MDEzZjsKICB0Lkxkb3RhY2NlbnQgPSAweDAxM2Y7CiAgdC5MZG90YmVsb3cgPSAweDFlMzY7CiAgdC5MZG90YmVsb3dtYWNyb24gPSAweDFlMzg7CiAgdC5MaXduYXJtZW5pYW4gPSAweDA1M2M7CiAgdC5MaiA9IDB4MDFjODsKICB0LkxqZWN5cmlsbGljID0gMHgwNDA5OwogIHQuTGxpbmViZWxvdyA9IDB4MWUzYTsKICB0Lkxtb25vc3BhY2UgPSAweGZmMmM7CiAgdC5Mc2xhc2ggPSAweDAxNDE7CiAgdC5Mc2xhc2hzbWFsbCA9IDB4ZjZmOTsKICB0LkxzbWFsbCA9IDB4Zjc2YzsKICB0Lk0gPSAweDAwNGQ7CiAgdC5NQnNxdWFyZSA9IDB4MzM4NjsKICB0Lk1hY3JvbiA9IDB4ZjZkMDsKICB0Lk1hY3JvbnNtYWxsID0gMHhmN2FmOwogIHQuTWFjdXRlID0gMHgxZTNlOwogIHQuTWNpcmNsZSA9IDB4MjRjMjsKICB0Lk1kb3RhY2NlbnQgPSAweDFlNDA7CiAgdC5NZG90YmVsb3cgPSAweDFlNDI7CiAgdC5NZW5hcm1lbmlhbiA9IDB4MDU0NDsKICB0Lk1tb25vc3BhY2UgPSAweGZmMmQ7CiAgdC5Nc21hbGwgPSAweGY3NmQ7CiAgdC5NdHVybmVkID0gMHgwMTljOwogIHQuTXUgPSAweDAzOWM7CiAgdC5OID0gMHgwMDRlOwogIHQuTkogPSAweDAxY2E7CiAgdC5OYWN1dGUgPSAweDAxNDM7CiAgdC5OY2Fyb24gPSAweDAxNDc7CiAgdC5OY2VkaWxsYSA9IDB4MDE0NTsKICB0Lk5jaXJjbGUgPSAweDI0YzM7CiAgdC5OY2lyY3VtZmxleGJlbG93ID0gMHgxZTRhOwogIHQuTmNvbW1hYWNjZW50ID0gMHgwMTQ1OwogIHQuTmRvdGFjY2VudCA9IDB4MWU0NDsKICB0Lk5kb3RiZWxvdyA9IDB4MWU0NjsKICB0Lk5ob29rbGVmdCA9IDB4MDE5ZDsKICB0Lk5pbmVyb21hbiA9IDB4MjE2ODsKICB0Lk5qID0gMHgwMWNiOwogIHQuTmplY3lyaWxsaWMgPSAweDA0MGE7CiAgdC5ObGluZWJlbG93ID0gMHgxZTQ4OwogIHQuTm1vbm9zcGFjZSA9IDB4ZmYyZTsKICB0Lk5vd2FybWVuaWFuID0gMHgwNTQ2OwogIHQuTnNtYWxsID0gMHhmNzZlOwogIHQuTnRpbGRlID0gMHgwMGQxOwogIHQuTnRpbGRlc21hbGwgPSAweGY3ZjE7CiAgdC5OdSA9IDB4MDM5ZDsKICB0Lk8gPSAweDAwNGY7CiAgdC5PRSA9IDB4MDE1MjsKICB0Lk9Fc21hbGwgPSAweGY2ZmE7CiAgdC5PYWN1dGUgPSAweDAwZDM7CiAgdC5PYWN1dGVzbWFsbCA9IDB4ZjdmMzsKICB0Lk9iYXJyZWRjeXJpbGxpYyA9IDB4MDRlODsKICB0Lk9iYXJyZWRkaWVyZXNpc2N5cmlsbGljID0gMHgwNGVhOwogIHQuT2JyZXZlID0gMHgwMTRlOwogIHQuT2Nhcm9uID0gMHgwMWQxOwogIHQuT2NlbnRlcmVkdGlsZGUgPSAweDAxOWY7CiAgdC5PY2lyY2xlID0gMHgyNGM0OwogIHQuT2NpcmN1bWZsZXggPSAweDAwZDQ7CiAgdC5PY2lyY3VtZmxleGFjdXRlID0gMHgxZWQwOwogIHQuT2NpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVkODsKICB0Lk9jaXJjdW1mbGV4Z3JhdmUgPSAweDFlZDI7CiAgdC5PY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVkNDsKICB0Lk9jaXJjdW1mbGV4c21hbGwgPSAweGY3ZjQ7CiAgdC5PY2lyY3VtZmxleHRpbGRlID0gMHgxZWQ2OwogIHQuT2N5cmlsbGljID0gMHgwNDFlOwogIHQuT2RibGFjdXRlID0gMHgwMTUwOwogIHQuT2RibGdyYXZlID0gMHgwMjBjOwogIHQuT2RpZXJlc2lzID0gMHgwMGQ2OwogIHQuT2RpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZTY7CiAgdC5PZGllcmVzaXNzbWFsbCA9IDB4ZjdmNjsKICB0Lk9kb3RiZWxvdyA9IDB4MWVjYzsKICB0Lk9nb25la3NtYWxsID0gMHhmNmZiOwogIHQuT2dyYXZlID0gMHgwMGQyOwogIHQuT2dyYXZlc21hbGwgPSAweGY3ZjI7CiAgdC5PaGFybWVuaWFuID0gMHgwNTU1OwogIHQuT2htID0gMHgyMTI2OwogIHQuT2hvb2thYm92ZSA9IDB4MWVjZTsKICB0Lk9ob3JuID0gMHgwMWEwOwogIHQuT2hvcm5hY3V0ZSA9IDB4MWVkYTsKICB0Lk9ob3JuZG90YmVsb3cgPSAweDFlZTI7CiAgdC5PaG9ybmdyYXZlID0gMHgxZWRjOwogIHQuT2hvcm5ob29rYWJvdmUgPSAweDFlZGU7CiAgdC5PaG9ybnRpbGRlID0gMHgxZWUwOwogIHQuT2h1bmdhcnVtbGF1dCA9IDB4MDE1MDsKICB0Lk9pID0gMHgwMWEyOwogIHQuT2ludmVydGVkYnJldmUgPSAweDAyMGU7CiAgdC5PbWFjcm9uID0gMHgwMTRjOwogIHQuT21hY3JvbmFjdXRlID0gMHgxZTUyOwogIHQuT21hY3JvbmdyYXZlID0gMHgxZTUwOwogIHQuT21lZ2EgPSAweDIxMjY7CiAgdC5PbWVnYWN5cmlsbGljID0gMHgwNDYwOwogIHQuT21lZ2FncmVlayA9IDB4MDNhOTsKICB0Lk9tZWdhcm91bmRjeXJpbGxpYyA9IDB4MDQ3YTsKICB0Lk9tZWdhdGl0bG9jeXJpbGxpYyA9IDB4MDQ3YzsKICB0Lk9tZWdhdG9ub3MgPSAweDAzOGY7CiAgdC5PbWljcm9uID0gMHgwMzlmOwogIHQuT21pY3JvbnRvbm9zID0gMHgwMzhjOwogIHQuT21vbm9zcGFjZSA9IDB4ZmYyZjsKICB0Lk9uZXJvbWFuID0gMHgyMTYwOwogIHQuT29nb25layA9IDB4MDFlYTsKICB0Lk9vZ29uZWttYWNyb24gPSAweDAxZWM7CiAgdC5Pb3BlbiA9IDB4MDE4NjsKICB0Lk9zbGFzaCA9IDB4MDBkODsKICB0Lk9zbGFzaGFjdXRlID0gMHgwMWZlOwogIHQuT3NsYXNoc21hbGwgPSAweGY3Zjg7CiAgdC5Pc21hbGwgPSAweGY3NmY7CiAgdC5Pc3Ryb2tlYWN1dGUgPSAweDAxZmU7CiAgdC5PdGN5cmlsbGljID0gMHgwNDdlOwogIHQuT3RpbGRlID0gMHgwMGQ1OwogIHQuT3RpbGRlYWN1dGUgPSAweDFlNGM7CiAgdC5PdGlsZGVkaWVyZXNpcyA9IDB4MWU0ZTsKICB0Lk90aWxkZXNtYWxsID0gMHhmN2Y1OwogIHQuUCA9IDB4MDA1MDsKICB0LlBhY3V0ZSA9IDB4MWU1NDsKICB0LlBjaXJjbGUgPSAweDI0YzU7CiAgdC5QZG90YWNjZW50ID0gMHgxZTU2OwogIHQuUGVjeXJpbGxpYyA9IDB4MDQxZjsKICB0LlBlaGFybWVuaWFuID0gMHgwNTRhOwogIHQuUGVtaWRkbGVob29rY3lyaWxsaWMgPSAweDA0YTY7CiAgdC5QaGkgPSAweDAzYTY7CiAgdC5QaG9vayA9IDB4MDFhNDsKICB0LlBpID0gMHgwM2EwOwogIHQuUGl3cmFybWVuaWFuID0gMHgwNTUzOwogIHQuUG1vbm9zcGFjZSA9IDB4ZmYzMDsKICB0LlBzaSA9IDB4MDNhODsKICB0LlBzaWN5cmlsbGljID0gMHgwNDcwOwogIHQuUHNtYWxsID0gMHhmNzcwOwogIHQuUSA9IDB4MDA1MTsKICB0LlFjaXJjbGUgPSAweDI0YzY7CiAgdC5RbW9ub3NwYWNlID0gMHhmZjMxOwogIHQuUXNtYWxsID0gMHhmNzcxOwogIHQuUiA9IDB4MDA1MjsKICB0LlJhYXJtZW5pYW4gPSAweDA1NGM7CiAgdC5SYWN1dGUgPSAweDAxNTQ7CiAgdC5SY2Fyb24gPSAweDAxNTg7CiAgdC5SY2VkaWxsYSA9IDB4MDE1NjsKICB0LlJjaXJjbGUgPSAweDI0Yzc7CiAgdC5SY29tbWFhY2NlbnQgPSAweDAxNTY7CiAgdC5SZGJsZ3JhdmUgPSAweDAyMTA7CiAgdC5SZG90YWNjZW50ID0gMHgxZTU4OwogIHQuUmRvdGJlbG93ID0gMHgxZTVhOwogIHQuUmRvdGJlbG93bWFjcm9uID0gMHgxZTVjOwogIHQuUmVoYXJtZW5pYW4gPSAweDA1NTA7CiAgdC5SZnJha3R1ciA9IDB4MjExYzsKICB0LlJobyA9IDB4MDNhMTsKICB0LlJpbmdzbWFsbCA9IDB4ZjZmYzsKICB0LlJpbnZlcnRlZGJyZXZlID0gMHgwMjEyOwogIHQuUmxpbmViZWxvdyA9IDB4MWU1ZTsKICB0LlJtb25vc3BhY2UgPSAweGZmMzI7CiAgdC5Sc21hbGwgPSAweGY3NzI7CiAgdC5Sc21hbGxpbnZlcnRlZCA9IDB4MDI4MTsKICB0LlJzbWFsbGludmVydGVkc3VwZXJpb3IgPSAweDAyYjY7CiAgdC5TID0gMHgwMDUzOwogIHQuU0YwMTAwMDAgPSAweDI1MGM7CiAgdC5TRjAyMDAwMCA9IDB4MjUxNDsKICB0LlNGMDMwMDAwID0gMHgyNTEwOwogIHQuU0YwNDAwMDAgPSAweDI1MTg7CiAgdC5TRjA1MDAwMCA9IDB4MjUzYzsKICB0LlNGMDYwMDAwID0gMHgyNTJjOwogIHQuU0YwNzAwMDAgPSAweDI1MzQ7CiAgdC5TRjA4MDAwMCA9IDB4MjUxYzsKICB0LlNGMDkwMDAwID0gMHgyNTI0OwogIHQuU0YxMDAwMDAgPSAweDI1MDA7CiAgdC5TRjExMDAwMCA9IDB4MjUwMjsKICB0LlNGMTkwMDAwID0gMHgyNTYxOwogIHQuU0YyMDAwMDAgPSAweDI1NjI7CiAgdC5TRjIxMDAwMCA9IDB4MjU1NjsKICB0LlNGMjIwMDAwID0gMHgyNTU1OwogIHQuU0YyMzAwMDAgPSAweDI1NjM7CiAgdC5TRjI0MDAwMCA9IDB4MjU1MTsKICB0LlNGMjUwMDAwID0gMHgyNTU3OwogIHQuU0YyNjAwMDAgPSAweDI1NWQ7CiAgdC5TRjI3MDAwMCA9IDB4MjU1YzsKICB0LlNGMjgwMDAwID0gMHgyNTViOwogIHQuU0YzNjAwMDAgPSAweDI1NWU7CiAgdC5TRjM3MDAwMCA9IDB4MjU1ZjsKICB0LlNGMzgwMDAwID0gMHgyNTVhOwogIHQuU0YzOTAwMDAgPSAweDI1NTQ7CiAgdC5TRjQwMDAwMCA9IDB4MjU2OTsKICB0LlNGNDEwMDAwID0gMHgyNTY2OwogIHQuU0Y0MjAwMDAgPSAweDI1NjA7CiAgdC5TRjQzMDAwMCA9IDB4MjU1MDsKICB0LlNGNDQwMDAwID0gMHgyNTZjOwogIHQuU0Y0NTAwMDAgPSAweDI1Njc7CiAgdC5TRjQ2MDAwMCA9IDB4MjU2ODsKICB0LlNGNDcwMDAwID0gMHgyNTY0OwogIHQuU0Y0ODAwMDAgPSAweDI1NjU7CiAgdC5TRjQ5MDAwMCA9IDB4MjU1OTsKICB0LlNGNTAwMDAwID0gMHgyNTU4OwogIHQuU0Y1MTAwMDAgPSAweDI1NTI7CiAgdC5TRjUyMDAwMCA9IDB4MjU1MzsKICB0LlNGNTMwMDAwID0gMHgyNTZiOwogIHQuU0Y1NDAwMDAgPSAweDI1NmE7CiAgdC5TYWN1dGUgPSAweDAxNWE7CiAgdC5TYWN1dGVkb3RhY2NlbnQgPSAweDFlNjQ7CiAgdC5TYW1waWdyZWVrID0gMHgwM2UwOwogIHQuU2Nhcm9uID0gMHgwMTYwOwogIHQuU2Nhcm9uZG90YWNjZW50ID0gMHgxZTY2OwogIHQuU2Nhcm9uc21hbGwgPSAweGY2ZmQ7CiAgdC5TY2VkaWxsYSA9IDB4MDE1ZTsKICB0LlNjaHdhID0gMHgwMThmOwogIHQuU2Nod2FjeXJpbGxpYyA9IDB4MDRkODsKICB0LlNjaHdhZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkYTsKICB0LlNjaXJjbGUgPSAweDI0Yzg7CiAgdC5TY2lyY3VtZmxleCA9IDB4MDE1YzsKICB0LlNjb21tYWFjY2VudCA9IDB4MDIxODsKICB0LlNkb3RhY2NlbnQgPSAweDFlNjA7CiAgdC5TZG90YmVsb3cgPSAweDFlNjI7CiAgdC5TZG90YmVsb3dkb3RhY2NlbnQgPSAweDFlNjg7CiAgdC5TZWhhcm1lbmlhbiA9IDB4MDU0ZDsKICB0LlNldmVucm9tYW4gPSAweDIxNjY7CiAgdC5TaGFhcm1lbmlhbiA9IDB4MDU0NzsKICB0LlNoYWN5cmlsbGljID0gMHgwNDI4OwogIHQuU2hjaGFjeXJpbGxpYyA9IDB4MDQyOTsKICB0LlNoZWljb3B0aWMgPSAweDAzZTI7CiAgdC5TaGhhY3lyaWxsaWMgPSAweDA0YmE7CiAgdC5TaGltYWNvcHRpYyA9IDB4MDNlYzsKICB0LlNpZ21hID0gMHgwM2EzOwogIHQuU2l4cm9tYW4gPSAweDIxNjU7CiAgdC5TbW9ub3NwYWNlID0gMHhmZjMzOwogIHQuU29mdHNpZ25jeXJpbGxpYyA9IDB4MDQyYzsKICB0LlNzbWFsbCA9IDB4Zjc3MzsKICB0LlN0aWdtYWdyZWVrID0gMHgwM2RhOwogIHQuVCA9IDB4MDA1NDsKICB0LlRhdSA9IDB4MDNhNDsKICB0LlRiYXIgPSAweDAxNjY7CiAgdC5UY2Fyb24gPSAweDAxNjQ7CiAgdC5UY2VkaWxsYSA9IDB4MDE2MjsKICB0LlRjaXJjbGUgPSAweDI0Yzk7CiAgdC5UY2lyY3VtZmxleGJlbG93ID0gMHgxZTcwOwogIHQuVGNvbW1hYWNjZW50ID0gMHgwMTYyOwogIHQuVGRvdGFjY2VudCA9IDB4MWU2YTsKICB0LlRkb3RiZWxvdyA9IDB4MWU2YzsKICB0LlRlY3lyaWxsaWMgPSAweDA0MjI7CiAgdC5UZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFjOwogIHQuVGVucm9tYW4gPSAweDIxNjk7CiAgdC5UZXRzZWN5cmlsbGljID0gMHgwNGI0OwogIHQuVGhldGEgPSAweDAzOTg7CiAgdC5UaG9vayA9IDB4MDFhYzsKICB0LlRob3JuID0gMHgwMGRlOwogIHQuVGhvcm5zbWFsbCA9IDB4ZjdmZTsKICB0LlRocmVlcm9tYW4gPSAweDIxNjI7CiAgdC5UaWxkZXNtYWxsID0gMHhmNmZlOwogIHQuVGl3bmFybWVuaWFuID0gMHgwNTRmOwogIHQuVGxpbmViZWxvdyA9IDB4MWU2ZTsKICB0LlRtb25vc3BhY2UgPSAweGZmMzQ7CiAgdC5Ub2FybWVuaWFuID0gMHgwNTM5OwogIHQuVG9uZWZpdmUgPSAweDAxYmM7CiAgdC5Ub25lc2l4ID0gMHgwMTg0OwogIHQuVG9uZXR3byA9IDB4MDFhNzsKICB0LlRyZXRyb2ZsZXhob29rID0gMHgwMWFlOwogIHQuVHNlY3lyaWxsaWMgPSAweDA0MjY7CiAgdC5Uc2hlY3lyaWxsaWMgPSAweDA0MGI7CiAgdC5Uc21hbGwgPSAweGY3NzQ7CiAgdC5Ud2VsdmVyb21hbiA9IDB4MjE2YjsKICB0LlR3b3JvbWFuID0gMHgyMTYxOwogIHQuVSA9IDB4MDA1NTsKICB0LlVhY3V0ZSA9IDB4MDBkYTsKICB0LlVhY3V0ZXNtYWxsID0gMHhmN2ZhOwogIHQuVWJyZXZlID0gMHgwMTZjOwogIHQuVWNhcm9uID0gMHgwMWQzOwogIHQuVWNpcmNsZSA9IDB4MjRjYTsKICB0LlVjaXJjdW1mbGV4ID0gMHgwMGRiOwogIHQuVWNpcmN1bWZsZXhiZWxvdyA9IDB4MWU3NjsKICB0LlVjaXJjdW1mbGV4c21hbGwgPSAweGY3ZmI7CiAgdC5VY3lyaWxsaWMgPSAweDA0MjM7CiAgdC5VZGJsYWN1dGUgPSAweDAxNzA7CiAgdC5VZGJsZ3JhdmUgPSAweDAyMTQ7CiAgdC5VZGllcmVzaXMgPSAweDAwZGM7CiAgdC5VZGllcmVzaXNhY3V0ZSA9IDB4MDFkNzsKICB0LlVkaWVyZXNpc2JlbG93ID0gMHgxZTcyOwogIHQuVWRpZXJlc2lzY2Fyb24gPSAweDAxZDk7CiAgdC5VZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRmMDsKICB0LlVkaWVyZXNpc2dyYXZlID0gMHgwMWRiOwogIHQuVWRpZXJlc2lzbWFjcm9uID0gMHgwMWQ1OwogIHQuVWRpZXJlc2lzc21hbGwgPSAweGY3ZmM7CiAgdC5VZG90YmVsb3cgPSAweDFlZTQ7CiAgdC5VZ3JhdmUgPSAweDAwZDk7CiAgdC5VZ3JhdmVzbWFsbCA9IDB4ZjdmOTsKICB0LlVob29rYWJvdmUgPSAweDFlZTY7CiAgdC5VaG9ybiA9IDB4MDFhZjsKICB0LlVob3JuYWN1dGUgPSAweDFlZTg7CiAgdC5VaG9ybmRvdGJlbG93ID0gMHgxZWYwOwogIHQuVWhvcm5ncmF2ZSA9IDB4MWVlYTsKICB0LlVob3JuaG9va2Fib3ZlID0gMHgxZWVjOwogIHQuVWhvcm50aWxkZSA9IDB4MWVlZTsKICB0LlVodW5nYXJ1bWxhdXQgPSAweDAxNzA7CiAgdC5VaHVuZ2FydW1sYXV0Y3lyaWxsaWMgPSAweDA0ZjI7CiAgdC5VaW52ZXJ0ZWRicmV2ZSA9IDB4MDIxNjsKICB0LlVrY3lyaWxsaWMgPSAweDA0Nzg7CiAgdC5VbWFjcm9uID0gMHgwMTZhOwogIHQuVW1hY3JvbmN5cmlsbGljID0gMHgwNGVlOwogIHQuVW1hY3JvbmRpZXJlc2lzID0gMHgxZTdhOwogIHQuVW1vbm9zcGFjZSA9IDB4ZmYzNTsKICB0LlVvZ29uZWsgPSAweDAxNzI7CiAgdC5VcHNpbG9uID0gMHgwM2E1OwogIHQuVXBzaWxvbjEgPSAweDAzZDI7CiAgdC5VcHNpbG9uYWN1dGVob29rc3ltYm9sZ3JlZWsgPSAweDAzZDM7CiAgdC5VcHNpbG9uYWZyaWNhbiA9IDB4MDFiMTsKICB0LlVwc2lsb25kaWVyZXNpcyA9IDB4MDNhYjsKICB0LlVwc2lsb25kaWVyZXNpc2hvb2tzeW1ib2xncmVlayA9IDB4MDNkNDsKICB0LlVwc2lsb25ob29rc3ltYm9sID0gMHgwM2QyOwogIHQuVXBzaWxvbnRvbm9zID0gMHgwMzhlOwogIHQuVXJpbmcgPSAweDAxNmU7CiAgdC5Vc2hvcnRjeXJpbGxpYyA9IDB4MDQwZTsKICB0LlVzbWFsbCA9IDB4Zjc3NTsKICB0LlVzdHJhaWdodGN5cmlsbGljID0gMHgwNGFlOwogIHQuVXN0cmFpZ2h0c3Ryb2tlY3lyaWxsaWMgPSAweDA0YjA7CiAgdC5VdGlsZGUgPSAweDAxNjg7CiAgdC5VdGlsZGVhY3V0ZSA9IDB4MWU3ODsKICB0LlV0aWxkZWJlbG93ID0gMHgxZTc0OwogIHQuViA9IDB4MDA1NjsKICB0LlZjaXJjbGUgPSAweDI0Y2I7CiAgdC5WZG90YmVsb3cgPSAweDFlN2U7CiAgdC5WZWN5cmlsbGljID0gMHgwNDEyOwogIHQuVmV3YXJtZW5pYW4gPSAweDA1NGU7CiAgdC5WaG9vayA9IDB4MDFiMjsKICB0LlZtb25vc3BhY2UgPSAweGZmMzY7CiAgdC5Wb2FybWVuaWFuID0gMHgwNTQ4OwogIHQuVnNtYWxsID0gMHhmNzc2OwogIHQuVnRpbGRlID0gMHgxZTdjOwogIHQuVyA9IDB4MDA1NzsKICB0LldhY3V0ZSA9IDB4MWU4MjsKICB0LldjaXJjbGUgPSAweDI0Y2M7CiAgdC5XY2lyY3VtZmxleCA9IDB4MDE3NDsKICB0LldkaWVyZXNpcyA9IDB4MWU4NDsKICB0Lldkb3RhY2NlbnQgPSAweDFlODY7CiAgdC5XZG90YmVsb3cgPSAweDFlODg7CiAgdC5XZ3JhdmUgPSAweDFlODA7CiAgdC5XbW9ub3NwYWNlID0gMHhmZjM3OwogIHQuV3NtYWxsID0gMHhmNzc3OwogIHQuWCA9IDB4MDA1ODsKICB0LlhjaXJjbGUgPSAweDI0Y2Q7CiAgdC5YZGllcmVzaXMgPSAweDFlOGM7CiAgdC5YZG90YWNjZW50ID0gMHgxZThhOwogIHQuWGVoYXJtZW5pYW4gPSAweDA1M2Q7CiAgdC5YaSA9IDB4MDM5ZTsKICB0Llhtb25vc3BhY2UgPSAweGZmMzg7CiAgdC5Yc21hbGwgPSAweGY3Nzg7CiAgdC5ZID0gMHgwMDU5OwogIHQuWWFjdXRlID0gMHgwMGRkOwogIHQuWWFjdXRlc21hbGwgPSAweGY3ZmQ7CiAgdC5ZYXRjeXJpbGxpYyA9IDB4MDQ2MjsKICB0LlljaXJjbGUgPSAweDI0Y2U7CiAgdC5ZY2lyY3VtZmxleCA9IDB4MDE3NjsKICB0LllkaWVyZXNpcyA9IDB4MDE3ODsKICB0LllkaWVyZXNpc3NtYWxsID0gMHhmN2ZmOwogIHQuWWRvdGFjY2VudCA9IDB4MWU4ZTsKICB0Lllkb3RiZWxvdyA9IDB4MWVmNDsKICB0LlllcmljeXJpbGxpYyA9IDB4MDQyYjsKICB0LlllcnVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY4OwogIHQuWWdyYXZlID0gMHgxZWYyOwogIHQuWWhvb2sgPSAweDAxYjM7CiAgdC5ZaG9va2Fib3ZlID0gMHgxZWY2OwogIHQuWWlhcm1lbmlhbiA9IDB4MDU0NTsKICB0LllpY3lyaWxsaWMgPSAweDA0MDc7CiAgdC5ZaXduYXJtZW5pYW4gPSAweDA1NTI7CiAgdC5ZbW9ub3NwYWNlID0gMHhmZjM5OwogIHQuWXNtYWxsID0gMHhmNzc5OwogIHQuWXRpbGRlID0gMHgxZWY4OwogIHQuWXVzYmlnY3lyaWxsaWMgPSAweDA0NmE7CiAgdC5ZdXNiaWdpb3RpZmllZGN5cmlsbGljID0gMHgwNDZjOwogIHQuWXVzbGl0dGxlY3lyaWxsaWMgPSAweDA0NjY7CiAgdC5ZdXNsaXR0bGVpb3RpZmllZGN5cmlsbGljID0gMHgwNDY4OwogIHQuWiA9IDB4MDA1YTsKICB0LlphYXJtZW5pYW4gPSAweDA1MzY7CiAgdC5aYWN1dGUgPSAweDAxNzk7CiAgdC5aY2Fyb24gPSAweDAxN2Q7CiAgdC5aY2Fyb25zbWFsbCA9IDB4ZjZmZjsKICB0LlpjaXJjbGUgPSAweDI0Y2Y7CiAgdC5aY2lyY3VtZmxleCA9IDB4MWU5MDsKICB0Llpkb3QgPSAweDAxN2I7CiAgdC5aZG90YWNjZW50ID0gMHgwMTdiOwogIHQuWmRvdGJlbG93ID0gMHgxZTkyOwogIHQuWmVjeXJpbGxpYyA9IDB4MDQxNzsKICB0LlplZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OTg7CiAgdC5aZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGU7CiAgdC5aZXRhID0gMHgwMzk2OwogIHQuWmhlYXJtZW5pYW4gPSAweDA1M2E7CiAgdC5aaGVicmV2ZWN5cmlsbGljID0gMHgwNGMxOwogIHQuWmhlY3lyaWxsaWMgPSAweDA0MTY7CiAgdC5aaGVkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDQ5NjsKICB0LlpoZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGM7CiAgdC5abGluZWJlbG93ID0gMHgxZTk0OwogIHQuWm1vbm9zcGFjZSA9IDB4ZmYzYTsKICB0LlpzbWFsbCA9IDB4Zjc3YTsKICB0LlpzdHJva2UgPSAweDAxYjU7CiAgdC5hID0gMHgwMDYxOwogIHQuYWFiZW5nYWxpID0gMHgwOTg2OwogIHQuYWFjdXRlID0gMHgwMGUxOwogIHQuYWFkZXZhID0gMHgwOTA2OwogIHQuYWFndWphcmF0aSA9IDB4MGE4NjsKICB0LmFhZ3VybXVraGkgPSAweDBhMDY7CiAgdC5hYW1hdHJhZ3VybXVraGkgPSAweDBhM2U7CiAgdC5hYXJ1c3F1YXJlID0gMHgzMzAzOwogIHQuYWF2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWJlOwogIHQuYWF2b3dlbHNpZ25kZXZhID0gMHgwOTNlOwogIHQuYWF2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFiZTsKICB0LmFiYnJldmlhdGlvbm1hcmthcm1lbmlhbiA9IDB4MDU1ZjsKICB0LmFiYnJldmlhdGlvbnNpZ25kZXZhID0gMHgwOTcwOwogIHQuYWJlbmdhbGkgPSAweDA5ODU7CiAgdC5hYm9wb21vZm8gPSAweDMxMWE7CiAgdC5hYnJldmUgPSAweDAxMDM7CiAgdC5hYnJldmVhY3V0ZSA9IDB4MWVhZjsKICB0LmFicmV2ZWN5cmlsbGljID0gMHgwNGQxOwogIHQuYWJyZXZlZG90YmVsb3cgPSAweDFlYjc7CiAgdC5hYnJldmVncmF2ZSA9IDB4MWViMTsKICB0LmFicmV2ZWhvb2thYm92ZSA9IDB4MWViMzsKICB0LmFicmV2ZXRpbGRlID0gMHgxZWI1OwogIHQuYWNhcm9uID0gMHgwMWNlOwogIHQuYWNpcmNsZSA9IDB4MjRkMDsKICB0LmFjaXJjdW1mbGV4ID0gMHgwMGUyOwogIHQuYWNpcmN1bWZsZXhhY3V0ZSA9IDB4MWVhNTsKICB0LmFjaXJjdW1mbGV4ZG90YmVsb3cgPSAweDFlYWQ7CiAgdC5hY2lyY3VtZmxleGdyYXZlID0gMHgxZWE3OwogIHQuYWNpcmN1bWZsZXhob29rYWJvdmUgPSAweDFlYTk7CiAgdC5hY2lyY3VtZmxleHRpbGRlID0gMHgxZWFiOwogIHQuYWN1dGUgPSAweDAwYjQ7CiAgdC5hY3V0ZWJlbG93Y21iID0gMHgwMzE3OwogIHQuYWN1dGVjbWIgPSAweDAzMDE7CiAgdC5hY3V0ZWNvbWIgPSAweDAzMDE7CiAgdC5hY3V0ZWRldmEgPSAweDA5NTQ7CiAgdC5hY3V0ZWxvd21vZCA9IDB4MDJjZjsKICB0LmFjdXRldG9uZWNtYiA9IDB4MDM0MTsKICB0LmFjeXJpbGxpYyA9IDB4MDQzMDsKICB0LmFkYmxncmF2ZSA9IDB4MDIwMTsKICB0LmFkZGFrZ3VybXVraGkgPSAweDBhNzE7CiAgdC5hZGV2YSA9IDB4MDkwNTsKICB0LmFkaWVyZXNpcyA9IDB4MDBlNDsKICB0LmFkaWVyZXNpc2N5cmlsbGljID0gMHgwNGQzOwogIHQuYWRpZXJlc2lzbWFjcm9uID0gMHgwMWRmOwogIHQuYWRvdGJlbG93ID0gMHgxZWExOwogIHQuYWRvdG1hY3JvbiA9IDB4MDFlMTsKICB0LmFlID0gMHgwMGU2OwogIHQuYWVhY3V0ZSA9IDB4MDFmZDsKICB0LmFla29yZWFuID0gMHgzMTUwOwogIHQuYWVtYWNyb24gPSAweDAxZTM7CiAgdC5hZmlpMDAyMDggPSAweDIwMTU7CiAgdC5hZmlpMDg5NDEgPSAweDIwYTQ7CiAgdC5hZmlpMTAwMTcgPSAweDA0MTA7CiAgdC5hZmlpMTAwMTggPSAweDA0MTE7CiAgdC5hZmlpMTAwMTkgPSAweDA0MTI7CiAgdC5hZmlpMTAwMjAgPSAweDA0MTM7CiAgdC5hZmlpMTAwMjEgPSAweDA0MTQ7CiAgdC5hZmlpMTAwMjIgPSAweDA0MTU7CiAgdC5hZmlpMTAwMjMgPSAweDA0MDE7CiAgdC5hZmlpMTAwMjQgPSAweDA0MTY7CiAgdC5hZmlpMTAwMjUgPSAweDA0MTc7CiAgdC5hZmlpMTAwMjYgPSAweDA0MTg7CiAgdC5hZmlpMTAwMjcgPSAweDA0MTk7CiAgdC5hZmlpMTAwMjggPSAweDA0MWE7CiAgdC5hZmlpMTAwMjkgPSAweDA0MWI7CiAgdC5hZmlpMTAwMzAgPSAweDA0MWM7CiAgdC5hZmlpMTAwMzEgPSAweDA0MWQ7CiAgdC5hZmlpMTAwMzIgPSAweDA0MWU7CiAgdC5hZmlpMTAwMzMgPSAweDA0MWY7CiAgdC5hZmlpMTAwMzQgPSAweDA0MjA7CiAgdC5hZmlpMTAwMzUgPSAweDA0MjE7CiAgdC5hZmlpMTAwMzYgPSAweDA0MjI7CiAgdC5hZmlpMTAwMzcgPSAweDA0MjM7CiAgdC5hZmlpMTAwMzggPSAweDA0MjQ7CiAgdC5hZmlpMTAwMzkgPSAweDA0MjU7CiAgdC5hZmlpMTAwNDAgPSAweDA0MjY7CiAgdC5hZmlpMTAwNDEgPSAweDA0Mjc7CiAgdC5hZmlpMTAwNDIgPSAweDA0Mjg7CiAgdC5hZmlpMTAwNDMgPSAweDA0Mjk7CiAgdC5hZmlpMTAwNDQgPSAweDA0MmE7CiAgdC5hZmlpMTAwNDUgPSAweDA0MmI7CiAgdC5hZmlpMTAwNDYgPSAweDA0MmM7CiAgdC5hZmlpMTAwNDcgPSAweDA0MmQ7CiAgdC5hZmlpMTAwNDggPSAweDA0MmU7CiAgdC5hZmlpMTAwNDkgPSAweDA0MmY7CiAgdC5hZmlpMTAwNTAgPSAweDA0OTA7CiAgdC5hZmlpMTAwNTEgPSAweDA0MDI7CiAgdC5hZmlpMTAwNTIgPSAweDA0MDM7CiAgdC5hZmlpMTAwNTMgPSAweDA0MDQ7CiAgdC5hZmlpMTAwNTQgPSAweDA0MDU7CiAgdC5hZmlpMTAwNTUgPSAweDA0MDY7CiAgdC5hZmlpMTAwNTYgPSAweDA0MDc7CiAgdC5hZmlpMTAwNTcgPSAweDA0MDg7CiAgdC5hZmlpMTAwNTggPSAweDA0MDk7CiAgdC5hZmlpMTAwNTkgPSAweDA0MGE7CiAgdC5hZmlpMTAwNjAgPSAweDA0MGI7CiAgdC5hZmlpMTAwNjEgPSAweDA0MGM7CiAgdC5hZmlpMTAwNjIgPSAweDA0MGU7CiAgdC5hZmlpMTAwNjMgPSAweGY2YzQ7CiAgdC5hZmlpMTAwNjQgPSAweGY2YzU7CiAgdC5hZmlpMTAwNjUgPSAweDA0MzA7CiAgdC5hZmlpMTAwNjYgPSAweDA0MzE7CiAgdC5hZmlpMTAwNjcgPSAweDA0MzI7CiAgdC5hZmlpMTAwNjggPSAweDA0MzM7CiAgdC5hZmlpMTAwNjkgPSAweDA0MzQ7CiAgdC5hZmlpMTAwNzAgPSAweDA0MzU7CiAgdC5hZmlpMTAwNzEgPSAweDA0NTE7CiAgdC5hZmlpMTAwNzIgPSAweDA0MzY7CiAgdC5hZmlpMTAwNzMgPSAweDA0Mzc7CiAgdC5hZmlpMTAwNzQgPSAweDA0Mzg7CiAgdC5hZmlpMTAwNzUgPSAweDA0Mzk7CiAgdC5hZmlpMTAwNzYgPSAweDA0M2E7CiAgdC5hZmlpMTAwNzcgPSAweDA0M2I7CiAgdC5hZmlpMTAwNzggPSAweDA0M2M7CiAgdC5hZmlpMTAwNzkgPSAweDA0M2Q7CiAgdC5hZmlpMTAwODAgPSAweDA0M2U7CiAgdC5hZmlpMTAwODEgPSAweDA0M2Y7CiAgdC5hZmlpMTAwODIgPSAweDA0NDA7CiAgdC5hZmlpMTAwODMgPSAweDA0NDE7CiAgdC5hZmlpMTAwODQgPSAweDA0NDI7CiAgdC5hZmlpMTAwODUgPSAweDA0NDM7CiAgdC5hZmlpMTAwODYgPSAweDA0NDQ7CiAgdC5hZmlpMTAwODcgPSAweDA0NDU7CiAgdC5hZmlpMTAwODggPSAweDA0NDY7CiAgdC5hZmlpMTAwODkgPSAweDA0NDc7CiAgdC5hZmlpMTAwOTAgPSAweDA0NDg7CiAgdC5hZmlpMTAwOTEgPSAweDA0NDk7CiAgdC5hZmlpMTAwOTIgPSAweDA0NGE7CiAgdC5hZmlpMTAwOTMgPSAweDA0NGI7CiAgdC5hZmlpMTAwOTQgPSAweDA0NGM7CiAgdC5hZmlpMTAwOTUgPSAweDA0NGQ7CiAgdC5hZmlpMTAwOTYgPSAweDA0NGU7CiAgdC5hZmlpMTAwOTcgPSAweDA0NGY7CiAgdC5hZmlpMTAwOTggPSAweDA0OTE7CiAgdC5hZmlpMTAwOTkgPSAweDA0NTI7CiAgdC5hZmlpMTAxMDAgPSAweDA0NTM7CiAgdC5hZmlpMTAxMDEgPSAweDA0NTQ7CiAgdC5hZmlpMTAxMDIgPSAweDA0NTU7CiAgdC5hZmlpMTAxMDMgPSAweDA0NTY7CiAgdC5hZmlpMTAxMDQgPSAweDA0NTc7CiAgdC5hZmlpMTAxMDUgPSAweDA0NTg7CiAgdC5hZmlpMTAxMDYgPSAweDA0NTk7CiAgdC5hZmlpMTAxMDcgPSAweDA0NWE7CiAgdC5hZmlpMTAxMDggPSAweDA0NWI7CiAgdC5hZmlpMTAxMDkgPSAweDA0NWM7CiAgdC5hZmlpMTAxMTAgPSAweDA0NWU7CiAgdC5hZmlpMTAxNDUgPSAweDA0MGY7CiAgdC5hZmlpMTAxNDYgPSAweDA0NjI7CiAgdC5hZmlpMTAxNDcgPSAweDA0NzI7CiAgdC5hZmlpMTAxNDggPSAweDA0NzQ7CiAgdC5hZmlpMTAxOTIgPSAweGY2YzY7CiAgdC5hZmlpMTAxOTMgPSAweDA0NWY7CiAgdC5hZmlpMTAxOTQgPSAweDA0NjM7CiAgdC5hZmlpMTAxOTUgPSAweDA0NzM7CiAgdC5hZmlpMTAxOTYgPSAweDA0NzU7CiAgdC5hZmlpMTA4MzEgPSAweGY2Yzc7CiAgdC5hZmlpMTA4MzIgPSAweGY2Yzg7CiAgdC5hZmlpMTA4NDYgPSAweDA0ZDk7CiAgdC5hZmlpMjk5ID0gMHgyMDBlOwogIHQuYWZpaTMwMCA9IDB4MjAwZjsKICB0LmFmaWkzMDEgPSAweDIwMGQ7CiAgdC5hZmlpNTczODEgPSAweDA2NmE7CiAgdC5hZmlpNTczODggPSAweDA2MGM7CiAgdC5hZmlpNTczOTIgPSAweDA2NjA7CiAgdC5hZmlpNTczOTMgPSAweDA2NjE7CiAgdC5hZmlpNTczOTQgPSAweDA2NjI7CiAgdC5hZmlpNTczOTUgPSAweDA2NjM7CiAgdC5hZmlpNTczOTYgPSAweDA2NjQ7CiAgdC5hZmlpNTczOTcgPSAweDA2NjU7CiAgdC5hZmlpNTczOTggPSAweDA2NjY7CiAgdC5hZmlpNTczOTkgPSAweDA2Njc7CiAgdC5hZmlpNTc0MDAgPSAweDA2Njg7CiAgdC5hZmlpNTc0MDEgPSAweDA2Njk7CiAgdC5hZmlpNTc0MDMgPSAweDA2MWI7CiAgdC5hZmlpNTc0MDcgPSAweDA2MWY7CiAgdC5hZmlpNTc0MDkgPSAweDA2MjE7CiAgdC5hZmlpNTc0MTAgPSAweDA2MjI7CiAgdC5hZmlpNTc0MTEgPSAweDA2MjM7CiAgdC5hZmlpNTc0MTIgPSAweDA2MjQ7CiAgdC5hZmlpNTc0MTMgPSAweDA2MjU7CiAgdC5hZmlpNTc0MTQgPSAweDA2MjY7CiAgdC5hZmlpNTc0MTUgPSAweDA2Mjc7CiAgdC5hZmlpNTc0MTYgPSAweDA2Mjg7CiAgdC5hZmlpNTc0MTcgPSAweDA2Mjk7CiAgdC5hZmlpNTc0MTggPSAweDA2MmE7CiAgdC5hZmlpNTc0MTkgPSAweDA2MmI7CiAgdC5hZmlpNTc0MjAgPSAweDA2MmM7CiAgdC5hZmlpNTc0MjEgPSAweDA2MmQ7CiAgdC5hZmlpNTc0MjIgPSAweDA2MmU7CiAgdC5hZmlpNTc0MjMgPSAweDA2MmY7CiAgdC5hZmlpNTc0MjQgPSAweDA2MzA7CiAgdC5hZmlpNTc0MjUgPSAweDA2MzE7CiAgdC5hZmlpNTc0MjYgPSAweDA2MzI7CiAgdC5hZmlpNTc0MjcgPSAweDA2MzM7CiAgdC5hZmlpNTc0MjggPSAweDA2MzQ7CiAgdC5hZmlpNTc0MjkgPSAweDA2MzU7CiAgdC5hZmlpNTc0MzAgPSAweDA2MzY7CiAgdC5hZmlpNTc0MzEgPSAweDA2Mzc7CiAgdC5hZmlpNTc0MzIgPSAweDA2Mzg7CiAgdC5hZmlpNTc0MzMgPSAweDA2Mzk7CiAgdC5hZmlpNTc0MzQgPSAweDA2M2E7CiAgdC5hZmlpNTc0NDAgPSAweDA2NDA7CiAgdC5hZmlpNTc0NDEgPSAweDA2NDE7CiAgdC5hZmlpNTc0NDIgPSAweDA2NDI7CiAgdC5hZmlpNTc0NDMgPSAweDA2NDM7CiAgdC5hZmlpNTc0NDQgPSAweDA2NDQ7CiAgdC5hZmlpNTc0NDUgPSAweDA2NDU7CiAgdC5hZmlpNTc0NDYgPSAweDA2NDY7CiAgdC5hZmlpNTc0NDggPSAweDA2NDg7CiAgdC5hZmlpNTc0NDkgPSAweDA2NDk7CiAgdC5hZmlpNTc0NTAgPSAweDA2NGE7CiAgdC5hZmlpNTc0NTEgPSAweDA2NGI7CiAgdC5hZmlpNTc0NTIgPSAweDA2NGM7CiAgdC5hZmlpNTc0NTMgPSAweDA2NGQ7CiAgdC5hZmlpNTc0NTQgPSAweDA2NGU7CiAgdC5hZmlpNTc0NTUgPSAweDA2NGY7CiAgdC5hZmlpNTc0NTYgPSAweDA2NTA7CiAgdC5hZmlpNTc0NTcgPSAweDA2NTE7CiAgdC5hZmlpNTc0NTggPSAweDA2NTI7CiAgdC5hZmlpNTc0NzAgPSAweDA2NDc7CiAgdC5hZmlpNTc1MDUgPSAweDA2YTQ7CiAgdC5hZmlpNTc1MDYgPSAweDA2N2U7CiAgdC5hZmlpNTc1MDcgPSAweDA2ODY7CiAgdC5hZmlpNTc1MDggPSAweDA2OTg7CiAgdC5hZmlpNTc1MDkgPSAweDA2YWY7CiAgdC5hZmlpNTc1MTEgPSAweDA2Nzk7CiAgdC5hZmlpNTc1MTIgPSAweDA2ODg7CiAgdC5hZmlpNTc1MTMgPSAweDA2OTE7CiAgdC5hZmlpNTc1MTQgPSAweDA2YmE7CiAgdC5hZmlpNTc1MTkgPSAweDA2ZDI7CiAgdC5hZmlpNTc1MzQgPSAweDA2ZDU7CiAgdC5hZmlpNTc2MzYgPSAweDIwYWE7CiAgdC5hZmlpNTc2NDUgPSAweDA1YmU7CiAgdC5hZmlpNTc2NTggPSAweDA1YzM7CiAgdC5hZmlpNTc2NjQgPSAweDA1ZDA7CiAgdC5hZmlpNTc2NjUgPSAweDA1ZDE7CiAgdC5hZmlpNTc2NjYgPSAweDA1ZDI7CiAgdC5hZmlpNTc2NjcgPSAweDA1ZDM7CiAgdC5hZmlpNTc2NjggPSAweDA1ZDQ7CiAgdC5hZmlpNTc2NjkgPSAweDA1ZDU7CiAgdC5hZmlpNTc2NzAgPSAweDA1ZDY7CiAgdC5hZmlpNTc2NzEgPSAweDA1ZDc7CiAgdC5hZmlpNTc2NzIgPSAweDA1ZDg7CiAgdC5hZmlpNTc2NzMgPSAweDA1ZDk7CiAgdC5hZmlpNTc2NzQgPSAweDA1ZGE7CiAgdC5hZmlpNTc2NzUgPSAweDA1ZGI7CiAgdC5hZmlpNTc2NzYgPSAweDA1ZGM7CiAgdC5hZmlpNTc2NzcgPSAweDA1ZGQ7CiAgdC5hZmlpNTc2NzggPSAweDA1ZGU7CiAgdC5hZmlpNTc2NzkgPSAweDA1ZGY7CiAgdC5hZmlpNTc2ODAgPSAweDA1ZTA7CiAgdC5hZmlpNTc2ODEgPSAweDA1ZTE7CiAgdC5hZmlpNTc2ODIgPSAweDA1ZTI7CiAgdC5hZmlpNTc2ODMgPSAweDA1ZTM7CiAgdC5hZmlpNTc2ODQgPSAweDA1ZTQ7CiAgdC5hZmlpNTc2ODUgPSAweDA1ZTU7CiAgdC5hZmlpNTc2ODYgPSAweDA1ZTY7CiAgdC5hZmlpNTc2ODcgPSAweDA1ZTc7CiAgdC5hZmlpNTc2ODggPSAweDA1ZTg7CiAgdC5hZmlpNTc2ODkgPSAweDA1ZTk7CiAgdC5hZmlpNTc2OTAgPSAweDA1ZWE7CiAgdC5hZmlpNTc2OTQgPSAweGZiMmE7CiAgdC5hZmlpNTc2OTUgPSAweGZiMmI7CiAgdC5hZmlpNTc3MDAgPSAweGZiNGI7CiAgdC5hZmlpNTc3MDUgPSAweGZiMWY7CiAgdC5hZmlpNTc3MTYgPSAweDA1ZjA7CiAgdC5hZmlpNTc3MTcgPSAweDA1ZjE7CiAgdC5hZmlpNTc3MTggPSAweDA1ZjI7CiAgdC5hZmlpNTc3MjMgPSAweGZiMzU7CiAgdC5hZmlpNTc3OTMgPSAweDA1YjQ7CiAgdC5hZmlpNTc3OTQgPSAweDA1YjU7CiAgdC5hZmlpNTc3OTUgPSAweDA1YjY7CiAgdC5hZmlpNTc3OTYgPSAweDA1YmI7CiAgdC5hZmlpNTc3OTcgPSAweDA1Yjg7CiAgdC5hZmlpNTc3OTggPSAweDA1Yjc7CiAgdC5hZmlpNTc3OTkgPSAweDA1YjA7CiAgdC5hZmlpNTc4MDAgPSAweDA1YjI7CiAgdC5hZmlpNTc4MDEgPSAweDA1YjE7CiAgdC5hZmlpNTc4MDIgPSAweDA1YjM7CiAgdC5hZmlpNTc4MDMgPSAweDA1YzI7CiAgdC5hZmlpNTc4MDQgPSAweDA1YzE7CiAgdC5hZmlpNTc4MDYgPSAweDA1Yjk7CiAgdC5hZmlpNTc4MDcgPSAweDA1YmM7CiAgdC5hZmlpNTc4MzkgPSAweDA1YmQ7CiAgdC5hZmlpNTc4NDEgPSAweDA1YmY7CiAgdC5hZmlpNTc4NDIgPSAweDA1YzA7CiAgdC5hZmlpNTc5MjkgPSAweDAyYmM7CiAgdC5hZmlpNjEyNDggPSAweDIxMDU7CiAgdC5hZmlpNjEyODkgPSAweDIxMTM7CiAgdC5hZmlpNjEzNTIgPSAweDIxMTY7CiAgdC5hZmlpNjE1NzMgPSAweDIwMmM7CiAgdC5hZmlpNjE1NzQgPSAweDIwMmQ7CiAgdC5hZmlpNjE1NzUgPSAweDIwMmU7CiAgdC5hZmlpNjE2NjQgPSAweDIwMGM7CiAgdC5hZmlpNjMxNjcgPSAweDA2NmQ7CiAgdC5hZmlpNjQ5MzcgPSAweDAyYmQ7CiAgdC5hZ3JhdmUgPSAweDAwZTA7CiAgdC5hZ3VqYXJhdGkgPSAweDBhODU7CiAgdC5hZ3VybXVraGkgPSAweDBhMDU7CiAgdC5haGlyYWdhbmEgPSAweDMwNDI7CiAgdC5haG9va2Fib3ZlID0gMHgxZWEzOwogIHQuYWliZW5nYWxpID0gMHgwOTkwOwogIHQuYWlib3BvbW9mbyA9IDB4MzExZTsKICB0LmFpZGV2YSA9IDB4MDkxMDsKICB0LmFpZWN5cmlsbGljID0gMHgwNGQ1OwogIHQuYWlndWphcmF0aSA9IDB4MGE5MDsKICB0LmFpZ3VybXVraGkgPSAweDBhMTA7CiAgdC5haW1hdHJhZ3VybXVraGkgPSAweDBhNDg7CiAgdC5haW5hcmFiaWMgPSAweDA2Mzk7CiAgdC5haW5maW5hbGFyYWJpYyA9IDB4ZmVjYTsKICB0LmFpbmluaXRpYWxhcmFiaWMgPSAweGZlY2I7CiAgdC5haW5tZWRpYWxhcmFiaWMgPSAweGZlY2M7CiAgdC5haW52ZXJ0ZWRicmV2ZSA9IDB4MDIwMzsKICB0LmFpdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljODsKICB0LmFpdm93ZWxzaWduZGV2YSA9IDB4MDk0ODsKICB0LmFpdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzg7CiAgdC5ha2F0YWthbmEgPSAweDMwYTI7CiAgdC5ha2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzE7CiAgdC5ha29yZWFuID0gMHgzMTRmOwogIHQuYWxlZiA9IDB4MDVkMDsKICB0LmFsZWZhcmFiaWMgPSAweDA2Mjc7CiAgdC5hbGVmZGFnZXNoaGVicmV3ID0gMHhmYjMwOwogIHQuYWxlZmZpbmFsYXJhYmljID0gMHhmZThlOwogIHQuYWxlZmhhbXphYWJvdmVhcmFiaWMgPSAweDA2MjM7CiAgdC5hbGVmaGFtemFhYm92ZWZpbmFsYXJhYmljID0gMHhmZTg0OwogIHQuYWxlZmhhbXphYmVsb3dhcmFiaWMgPSAweDA2MjU7CiAgdC5hbGVmaGFtemFiZWxvd2ZpbmFsYXJhYmljID0gMHhmZTg4OwogIHQuYWxlZmhlYnJldyA9IDB4MDVkMDsKICB0LmFsZWZsYW1lZGhlYnJldyA9IDB4ZmI0ZjsKICB0LmFsZWZtYWRkYWFib3ZlYXJhYmljID0gMHgwNjIyOwogIHQuYWxlZm1hZGRhYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmU4MjsKICB0LmFsZWZtYWtzdXJhYXJhYmljID0gMHgwNjQ5OwogIHQuYWxlZm1ha3N1cmFmaW5hbGFyYWJpYyA9IDB4ZmVmMDsKICB0LmFsZWZtYWtzdXJhaW5pdGlhbGFyYWJpYyA9IDB4ZmVmMzsKICB0LmFsZWZtYWtzdXJhbWVkaWFsYXJhYmljID0gMHhmZWY0OwogIHQuYWxlZnBhdGFoaGVicmV3ID0gMHhmYjJlOwogIHQuYWxlZnFhbWF0c2hlYnJldyA9IDB4ZmIyZjsKICB0LmFsZXBoID0gMHgyMTM1OwogIHQuYWxsZXF1YWwgPSAweDIyNGM7CiAgdC5hbHBoYSA9IDB4MDNiMTsKICB0LmFscGhhdG9ub3MgPSAweDAzYWM7CiAgdC5hbWFjcm9uID0gMHgwMTAxOwogIHQuYW1vbm9zcGFjZSA9IDB4ZmY0MTsKICB0LmFtcGVyc2FuZCA9IDB4MDAyNjsKICB0LmFtcGVyc2FuZG1vbm9zcGFjZSA9IDB4ZmYwNjsKICB0LmFtcGVyc2FuZHNtYWxsID0gMHhmNzI2OwogIHQuYW1zcXVhcmUgPSAweDMzYzI7CiAgdC5hbmJvcG9tb2ZvID0gMHgzMTIyOwogIHQuYW5nYm9wb21vZm8gPSAweDMxMjQ7CiAgdC5hbmdicmFja2V0bGVmdCA9IDB4MzAwODsKICB0LmFuZ2JyYWNrZXRyaWdodCA9IDB4MzAwOTsKICB0LmFuZ2toYW5raHV0aGFpID0gMHgwZTVhOwogIHQuYW5nbGUgPSAweDIyMjA7CiAgdC5hbmdsZWJyYWNrZXRsZWZ0ID0gMHgzMDA4OwogIHQuYW5nbGVicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTNmOwogIHQuYW5nbGVicmFja2V0cmlnaHQgPSAweDMwMDk7CiAgdC5hbmdsZWJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTQwOwogIHQuYW5nbGVsZWZ0ID0gMHgyMzI5OwogIHQuYW5nbGVyaWdodCA9IDB4MjMyYTsKICB0LmFuZ3N0cm9tID0gMHgyMTJiOwogIHQuYW5vdGVsZWlhID0gMHgwMzg3OwogIHQuYW51ZGF0dGFkZXZhID0gMHgwOTUyOwogIHQuYW51c3ZhcmFiZW5nYWxpID0gMHgwOTgyOwogIHQuYW51c3ZhcmFkZXZhID0gMHgwOTAyOwogIHQuYW51c3ZhcmFndWphcmF0aSA9IDB4MGE4MjsKICB0LmFvZ29uZWsgPSAweDAxMDU7CiAgdC5hcGFhdG9zcXVhcmUgPSAweDMzMDA7CiAgdC5hcGFyZW4gPSAweDI0OWM7CiAgdC5hcG9zdHJvcGhlYXJtZW5pYW4gPSAweDA1NWE7CiAgdC5hcG9zdHJvcGhlbW9kID0gMHgwMmJjOwogIHQuYXBwbGUgPSAweGY4ZmY7CiAgdC5hcHByb2FjaGVzID0gMHgyMjUwOwogIHQuYXBwcm94ZXF1YWwgPSAweDIyNDg7CiAgdC5hcHByb3hlcXVhbG9yaW1hZ2UgPSAweDIyNTI7CiAgdC5hcHByb3hpbWF0ZWx5ZXF1YWwgPSAweDIyNDU7CiAgdC5hcmFlYWVrb3JlYW4gPSAweDMxOGU7CiAgdC5hcmFlYWtvcmVhbiA9IDB4MzE4ZDsKICB0LmFyYyA9IDB4MjMxMjsKICB0LmFyaWdodGhhbGZyaW5nID0gMHgxZTlhOwogIHQuYXJpbmcgPSAweDAwZTU7CiAgdC5hcmluZ2FjdXRlID0gMHgwMWZiOwogIHQuYXJpbmdiZWxvdyA9IDB4MWUwMTsKICB0LmFycm93Ym90aCA9IDB4MjE5NDsKICB0LmFycm93ZGFzaGRvd24gPSAweDIxZTM7CiAgdC5hcnJvd2Rhc2hsZWZ0ID0gMHgyMWUwOwogIHQuYXJyb3dkYXNocmlnaHQgPSAweDIxZTI7CiAgdC5hcnJvd2Rhc2h1cCA9IDB4MjFlMTsKICB0LmFycm93ZGJsYm90aCA9IDB4MjFkNDsKICB0LmFycm93ZGJsZG93biA9IDB4MjFkMzsKICB0LmFycm93ZGJsbGVmdCA9IDB4MjFkMDsKICB0LmFycm93ZGJscmlnaHQgPSAweDIxZDI7CiAgdC5hcnJvd2RibHVwID0gMHgyMWQxOwogIHQuYXJyb3dkb3duID0gMHgyMTkzOwogIHQuYXJyb3dkb3dubGVmdCA9IDB4MjE5OTsKICB0LmFycm93ZG93bnJpZ2h0ID0gMHgyMTk4OwogIHQuYXJyb3dkb3dud2hpdGUgPSAweDIxZTk7CiAgdC5hcnJvd2hlYWRkb3dubW9kID0gMHgwMmM1OwogIHQuYXJyb3doZWFkbGVmdG1vZCA9IDB4MDJjMjsKICB0LmFycm93aGVhZHJpZ2h0bW9kID0gMHgwMmMzOwogIHQuYXJyb3doZWFkdXBtb2QgPSAweDAyYzQ7CiAgdC5hcnJvd2hvcml6ZXggPSAweGY4ZTc7CiAgdC5hcnJvd2xlZnQgPSAweDIxOTA7CiAgdC5hcnJvd2xlZnRkYmwgPSAweDIxZDA7CiAgdC5hcnJvd2xlZnRkYmxzdHJva2UgPSAweDIxY2Q7CiAgdC5hcnJvd2xlZnRvdmVycmlnaHQgPSAweDIxYzY7CiAgdC5hcnJvd2xlZnR3aGl0ZSA9IDB4MjFlNjsKICB0LmFycm93cmlnaHQgPSAweDIxOTI7CiAgdC5hcnJvd3JpZ2h0ZGJsc3Ryb2tlID0gMHgyMWNmOwogIHQuYXJyb3dyaWdodGhlYXZ5ID0gMHgyNzllOwogIHQuYXJyb3dyaWdodG92ZXJsZWZ0ID0gMHgyMWM0OwogIHQuYXJyb3dyaWdodHdoaXRlID0gMHgyMWU4OwogIHQuYXJyb3d0YWJsZWZ0ID0gMHgyMWU0OwogIHQuYXJyb3d0YWJyaWdodCA9IDB4MjFlNTsKICB0LmFycm93dXAgPSAweDIxOTE7CiAgdC5hcnJvd3VwZG4gPSAweDIxOTU7CiAgdC5hcnJvd3VwZG5ic2UgPSAweDIxYTg7CiAgdC5hcnJvd3VwZG93bmJhc2UgPSAweDIxYTg7CiAgdC5hcnJvd3VwbGVmdCA9IDB4MjE5NjsKICB0LmFycm93dXBsZWZ0b2Zkb3duID0gMHgyMWM1OwogIHQuYXJyb3d1cHJpZ2h0ID0gMHgyMTk3OwogIHQuYXJyb3d1cHdoaXRlID0gMHgyMWU3OwogIHQuYXJyb3d2ZXJ0ZXggPSAweGY4ZTY7CiAgdC5hc2NpaWNpcmN1bSA9IDB4MDA1ZTsKICB0LmFzY2lpY2lyY3VtbW9ub3NwYWNlID0gMHhmZjNlOwogIHQuYXNjaWl0aWxkZSA9IDB4MDA3ZTsKICB0LmFzY2lpdGlsZGVtb25vc3BhY2UgPSAweGZmNWU7CiAgdC5hc2NyaXB0ID0gMHgwMjUxOwogIHQuYXNjcmlwdHR1cm5lZCA9IDB4MDI1MjsKICB0LmFzbWFsbGhpcmFnYW5hID0gMHgzMDQxOwogIHQuYXNtYWxsa2F0YWthbmEgPSAweDMwYTE7CiAgdC5hc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2NzsKICB0LmFzdGVyaXNrID0gMHgwMDJhOwogIHQuYXN0ZXJpc2thbHRvbmVhcmFiaWMgPSAweDA2NmQ7CiAgdC5hc3Rlcmlza2FyYWJpYyA9IDB4MDY2ZDsKICB0LmFzdGVyaXNrbWF0aCA9IDB4MjIxNzsKICB0LmFzdGVyaXNrbW9ub3NwYWNlID0gMHhmZjBhOwogIHQuYXN0ZXJpc2tzbWFsbCA9IDB4ZmU2MTsKICB0LmFzdGVyaXNtID0gMHgyMDQyOwogIHQuYXN1cGVyaW9yID0gMHhmNmU5OwogIHQuYXN5bXB0b3RpY2FsbHllcXVhbCA9IDB4MjI0MzsKICB0LmF0ID0gMHgwMDQwOwogIHQuYXRpbGRlID0gMHgwMGUzOwogIHQuYXRtb25vc3BhY2UgPSAweGZmMjA7CiAgdC5hdHNtYWxsID0gMHhmZTZiOwogIHQuYXR1cm5lZCA9IDB4MDI1MDsKICB0LmF1YmVuZ2FsaSA9IDB4MDk5NDsKICB0LmF1Ym9wb21vZm8gPSAweDMxMjA7CiAgdC5hdWRldmEgPSAweDA5MTQ7CiAgdC5hdWd1amFyYXRpID0gMHgwYTk0OwogIHQuYXVndXJtdWtoaSA9IDB4MGExNDsKICB0LmF1bGVuZ3RobWFya2JlbmdhbGkgPSAweDA5ZDc7CiAgdC5hdW1hdHJhZ3VybXVraGkgPSAweDBhNGM7CiAgdC5hdXZvd2Vsc2lnbmJlbmdhbGkgPSAweDA5Y2M7CiAgdC5hdXZvd2Vsc2lnbmRldmEgPSAweDA5NGM7CiAgdC5hdXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWNjOwogIHQuYXZhZ3JhaGFkZXZhID0gMHgwOTNkOwogIHQuYXliYXJtZW5pYW4gPSAweDA1NjE7CiAgdC5heWluID0gMHgwNWUyOwogIHQuYXlpbmFsdG9uZWhlYnJldyA9IDB4ZmIyMDsKICB0LmF5aW5oZWJyZXcgPSAweDA1ZTI7CiAgdC5iID0gMHgwMDYyOwogIHQuYmFiZW5nYWxpID0gMHgwOWFjOwogIHQuYmFja3NsYXNoID0gMHgwMDVjOwogIHQuYmFja3NsYXNobW9ub3NwYWNlID0gMHhmZjNjOwogIHQuYmFkZXZhID0gMHgwOTJjOwogIHQuYmFndWphcmF0aSA9IDB4MGFhYzsKICB0LmJhZ3VybXVraGkgPSAweDBhMmM7CiAgdC5iYWhpcmFnYW5hID0gMHgzMDcwOwogIHQuYmFodHRoYWkgPSAweDBlM2Y7CiAgdC5iYWthdGFrYW5hID0gMHgzMGQwOwogIHQuYmFyID0gMHgwMDdjOwogIHQuYmFybW9ub3NwYWNlID0gMHhmZjVjOwogIHQuYmJvcG9tb2ZvID0gMHgzMTA1OwogIHQuYmNpcmNsZSA9IDB4MjRkMTsKICB0LmJkb3RhY2NlbnQgPSAweDFlMDM7CiAgdC5iZG90YmVsb3cgPSAweDFlMDU7CiAgdC5iZWFtZWRzaXh0ZWVudGhub3RlcyA9IDB4MjY2YzsKICB0LmJlY2F1c2UgPSAweDIyMzU7CiAgdC5iZWN5cmlsbGljID0gMHgwNDMxOwogIHQuYmVoYXJhYmljID0gMHgwNjI4OwogIHQuYmVoZmluYWxhcmFiaWMgPSAweGZlOTA7CiAgdC5iZWhpbml0aWFsYXJhYmljID0gMHhmZTkxOwogIHQuYmVoaXJhZ2FuYSA9IDB4MzA3OTsKICB0LmJlaG1lZGlhbGFyYWJpYyA9IDB4ZmU5MjsKICB0LmJlaG1lZW1pbml0aWFsYXJhYmljID0gMHhmYzlmOwogIHQuYmVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzA4OwogIHQuYmVobm9vbmZpbmFsYXJhYmljID0gMHhmYzZkOwogIHQuYmVrYXRha2FuYSA9IDB4MzBkOTsKICB0LmJlbmFybWVuaWFuID0gMHgwNTYyOwogIHQuYmV0ID0gMHgwNWQxOwogIHQuYmV0YSA9IDB4MDNiMjsKICB0LmJldGFzeW1ib2xncmVlayA9IDB4MDNkMDsKICB0LmJldGRhZ2VzaCA9IDB4ZmIzMTsKICB0LmJldGRhZ2VzaGhlYnJldyA9IDB4ZmIzMTsKICB0LmJldGhlYnJldyA9IDB4MDVkMTsKICB0LmJldHJhZmVoZWJyZXcgPSAweGZiNGM7CiAgdC5iaGFiZW5nYWxpID0gMHgwOWFkOwogIHQuYmhhZGV2YSA9IDB4MDkyZDsKICB0LmJoYWd1amFyYXRpID0gMHgwYWFkOwogIHQuYmhhZ3VybXVraGkgPSAweDBhMmQ7CiAgdC5iaG9vayA9IDB4MDI1MzsKICB0LmJpaGlyYWdhbmEgPSAweDMwNzM7CiAgdC5iaWthdGFrYW5hID0gMHgzMGQzOwogIHQuYmlsYWJpYWxjbGljayA9IDB4MDI5ODsKICB0LmJpbmRpZ3VybXVraGkgPSAweDBhMDI7CiAgdC5iaXJ1c3F1YXJlID0gMHgzMzMxOwogIHQuYmxhY2tjaXJjbGUgPSAweDI1Y2Y7CiAgdC5ibGFja2RpYW1vbmQgPSAweDI1YzY7CiAgdC5ibGFja2Rvd25wb2ludGluZ3RyaWFuZ2xlID0gMHgyNWJjOwogIHQuYmxhY2tsZWZ0cG9pbnRpbmdwb2ludGVyID0gMHgyNWM0OwogIHQuYmxhY2tsZWZ0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjVjMDsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRsZWZ0ID0gMHgzMDEwOwogIHQuYmxhY2tsZW50aWN1bGFyYnJhY2tldGxlZnR2ZXJ0aWNhbCA9IDB4ZmUzYjsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRyaWdodCA9IDB4MzAxMTsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTNjOwogIHQuYmxhY2tsb3dlcmxlZnR0cmlhbmdsZSA9IDB4MjVlMzsKICB0LmJsYWNrbG93ZXJyaWdodHRyaWFuZ2xlID0gMHgyNWUyOwogIHQuYmxhY2tyZWN0YW5nbGUgPSAweDI1YWM7CiAgdC5ibGFja3JpZ2h0cG9pbnRpbmdwb2ludGVyID0gMHgyNWJhOwogIHQuYmxhY2tyaWdodHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YjY7CiAgdC5ibGFja3NtYWxsc3F1YXJlID0gMHgyNWFhOwogIHQuYmxhY2tzbWlsaW5nZmFjZSA9IDB4MjYzYjsKICB0LmJsYWNrc3F1YXJlID0gMHgyNWEwOwogIHQuYmxhY2tzdGFyID0gMHgyNjA1OwogIHQuYmxhY2t1cHBlcmxlZnR0cmlhbmdsZSA9IDB4MjVlNDsKICB0LmJsYWNrdXBwZXJyaWdodHRyaWFuZ2xlID0gMHgyNWU1OwogIHQuYmxhY2t1cHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjViNDsKICB0LmJsYWNrdXBwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWIyOwogIHQuYmxhbmsgPSAweDI0MjM7CiAgdC5ibGluZWJlbG93ID0gMHgxZTA3OwogIHQuYmxvY2sgPSAweDI1ODg7CiAgdC5ibW9ub3NwYWNlID0gMHhmZjQyOwogIHQuYm9iYWltYWl0aGFpID0gMHgwZTFhOwogIHQuYm9oaXJhZ2FuYSA9IDB4MzA3YzsKICB0LmJva2F0YWthbmEgPSAweDMwZGM7CiAgdC5icGFyZW4gPSAweDI0OWQ7CiAgdC5icXNxdWFyZSA9IDB4MzNjMzsKICB0LmJyYWNlZXggPSAweGY4ZjQ7CiAgdC5icmFjZWxlZnQgPSAweDAwN2I7CiAgdC5icmFjZWxlZnRidCA9IDB4ZjhmMzsKICB0LmJyYWNlbGVmdG1pZCA9IDB4ZjhmMjsKICB0LmJyYWNlbGVmdG1vbm9zcGFjZSA9IDB4ZmY1YjsKICB0LmJyYWNlbGVmdHNtYWxsID0gMHhmZTViOwogIHQuYnJhY2VsZWZ0dHAgPSAweGY4ZjE7CiAgdC5icmFjZWxlZnR2ZXJ0aWNhbCA9IDB4ZmUzNzsKICB0LmJyYWNlcmlnaHQgPSAweDAwN2Q7CiAgdC5icmFjZXJpZ2h0YnQgPSAweGY4ZmU7CiAgdC5icmFjZXJpZ2h0bWlkID0gMHhmOGZkOwogIHQuYnJhY2VyaWdodG1vbm9zcGFjZSA9IDB4ZmY1ZDsKICB0LmJyYWNlcmlnaHRzbWFsbCA9IDB4ZmU1YzsKICB0LmJyYWNlcmlnaHR0cCA9IDB4ZjhmYzsKICB0LmJyYWNlcmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzODsKICB0LmJyYWNrZXRsZWZ0ID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRidCA9IDB4ZjhmMDsKICB0LmJyYWNrZXRsZWZ0ZXggPSAweGY4ZWY7CiAgdC5icmFja2V0bGVmdG1vbm9zcGFjZSA9IDB4ZmYzYjsKICB0LmJyYWNrZXRsZWZ0dHAgPSAweGY4ZWU7CiAgdC5icmFja2V0cmlnaHQgPSAweDAwNWQ7CiAgdC5icmFja2V0cmlnaHRidCA9IDB4ZjhmYjsKICB0LmJyYWNrZXRyaWdodGV4ID0gMHhmOGZhOwogIHQuYnJhY2tldHJpZ2h0bW9ub3NwYWNlID0gMHhmZjNkOwogIHQuYnJhY2tldHJpZ2h0dHAgPSAweGY4Zjk7CiAgdC5icmV2ZSA9IDB4MDJkODsKICB0LmJyZXZlYmVsb3djbWIgPSAweDAzMmU7CiAgdC5icmV2ZWNtYiA9IDB4MDMwNjsKICB0LmJyZXZlaW52ZXJ0ZWRiZWxvd2NtYiA9IDB4MDMyZjsKICB0LmJyZXZlaW52ZXJ0ZWRjbWIgPSAweDAzMTE7CiAgdC5icmV2ZWludmVydGVkZG91YmxlY21iID0gMHgwMzYxOwogIHQuYnJpZGdlYmVsb3djbWIgPSAweDAzMmE7CiAgdC5icmlkZ2VpbnZlcnRlZGJlbG93Y21iID0gMHgwMzNhOwogIHQuYnJva2VuYmFyID0gMHgwMGE2OwogIHQuYnN0cm9rZSA9IDB4MDE4MDsKICB0LmJzdXBlcmlvciA9IDB4ZjZlYTsKICB0LmJ0b3BiYXIgPSAweDAxODM7CiAgdC5idWhpcmFnYW5hID0gMHgzMDc2OwogIHQuYnVrYXRha2FuYSA9IDB4MzBkNjsKICB0LmJ1bGxldCA9IDB4MjAyMjsKICB0LmJ1bGxldGludmVyc2UgPSAweDI1ZDg7CiAgdC5idWxsZXRvcGVyYXRvciA9IDB4MjIxOTsKICB0LmJ1bGxzZXllID0gMHgyNWNlOwogIHQuYyA9IDB4MDA2MzsKICB0LmNhYXJtZW5pYW4gPSAweDA1NmU7CiAgdC5jYWJlbmdhbGkgPSAweDA5OWE7CiAgdC5jYWN1dGUgPSAweDAxMDc7CiAgdC5jYWRldmEgPSAweDA5MWE7CiAgdC5jYWd1amFyYXRpID0gMHgwYTlhOwogIHQuY2FndXJtdWtoaSA9IDB4MGExYTsKICB0LmNhbHNxdWFyZSA9IDB4MzM4ODsKICB0LmNhbmRyYWJpbmR1YmVuZ2FsaSA9IDB4MDk4MTsKICB0LmNhbmRyYWJpbmR1Y21iID0gMHgwMzEwOwogIHQuY2FuZHJhYmluZHVkZXZhID0gMHgwOTAxOwogIHQuY2FuZHJhYmluZHVndWphcmF0aSA9IDB4MGE4MTsKICB0LmNhcHNsb2NrID0gMHgyMWVhOwogIHQuY2FyZW9mID0gMHgyMTA1OwogIHQuY2Fyb24gPSAweDAyYzc7CiAgdC5jYXJvbmJlbG93Y21iID0gMHgwMzJjOwogIHQuY2Fyb25jbWIgPSAweDAzMGM7CiAgdC5jYXJyaWFnZXJldHVybiA9IDB4MjFiNTsKICB0LmNib3BvbW9mbyA9IDB4MzExODsKICB0LmNjYXJvbiA9IDB4MDEwZDsKICB0LmNjZWRpbGxhID0gMHgwMGU3OwogIHQuY2NlZGlsbGFhY3V0ZSA9IDB4MWUwOTsKICB0LmNjaXJjbGUgPSAweDI0ZDI7CiAgdC5jY2lyY3VtZmxleCA9IDB4MDEwOTsKICB0LmNjdXJsID0gMHgwMjU1OwogIHQuY2RvdCA9IDB4MDEwYjsKICB0LmNkb3RhY2NlbnQgPSAweDAxMGI7CiAgdC5jZHNxdWFyZSA9IDB4MzNjNTsKICB0LmNlZGlsbGEgPSAweDAwYjg7CiAgdC5jZWRpbGxhY21iID0gMHgwMzI3OwogIHQuY2VudCA9IDB4MDBhMjsKICB0LmNlbnRpZ3JhZGUgPSAweDIxMDM7CiAgdC5jZW50aW5mZXJpb3IgPSAweGY2ZGY7CiAgdC5jZW50bW9ub3NwYWNlID0gMHhmZmUwOwogIHQuY2VudG9sZHN0eWxlID0gMHhmN2EyOwogIHQuY2VudHN1cGVyaW9yID0gMHhmNmUwOwogIHQuY2hhYXJtZW5pYW4gPSAweDA1Nzk7CiAgdC5jaGFiZW5nYWxpID0gMHgwOTliOwogIHQuY2hhZGV2YSA9IDB4MDkxYjsKICB0LmNoYWd1amFyYXRpID0gMHgwYTliOwogIHQuY2hhZ3VybXVraGkgPSAweDBhMWI7CiAgdC5jaGJvcG9tb2ZvID0gMHgzMTE0OwogIHQuY2hlYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0YmQ7CiAgdC5jaGVja21hcmsgPSAweDI3MTM7CiAgdC5jaGVjeXJpbGxpYyA9IDB4MDQ0NzsKICB0LmNoZWRlc2NlbmRlcmFia2hhc2lhbmN5cmlsbGljID0gMHgwNGJmOwogIHQuY2hlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0Yjc7CiAgdC5jaGVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY1OwogIHQuY2hlaGFybWVuaWFuID0gMHgwNTczOwogIHQuY2hla2hha2Fzc2lhbmN5cmlsbGljID0gMHgwNGNjOwogIHQuY2hldmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDRiOTsKICB0LmNoaSA9IDB4MDNjNzsKICB0LmNoaWV1Y2hhY2lyY2xla29yZWFuID0gMHgzMjc3OwogIHQuY2hpZXVjaGFwYXJlbmtvcmVhbiA9IDB4MzIxNzsKICB0LmNoaWV1Y2hjaXJjbGVrb3JlYW4gPSAweDMyNjk7CiAgdC5jaGlldWNoa29yZWFuID0gMHgzMTRhOwogIHQuY2hpZXVjaHBhcmVua29yZWFuID0gMHgzMjA5OwogIHQuY2hvY2hhbmd0aGFpID0gMHgwZTBhOwogIHQuY2hvY2hhbnRoYWkgPSAweDBlMDg7CiAgdC5jaG9jaGluZ3RoYWkgPSAweDBlMDk7CiAgdC5jaG9jaG9ldGhhaSA9IDB4MGUwYzsKICB0LmNob29rID0gMHgwMTg4OwogIHQuY2lldWNhY2lyY2xla29yZWFuID0gMHgzMjc2OwogIHQuY2lldWNhcGFyZW5rb3JlYW4gPSAweDMyMTY7CiAgdC5jaWV1Y2NpcmNsZWtvcmVhbiA9IDB4MzI2ODsKICB0LmNpZXVja29yZWFuID0gMHgzMTQ4OwogIHQuY2lldWNwYXJlbmtvcmVhbiA9IDB4MzIwODsKICB0LmNpZXVjdXBhcmVua29yZWFuID0gMHgzMjFjOwogIHQuY2lyY2xlID0gMHgyNWNiOwogIHQuY2lyY2xlY29weXJ0ID0gMHgwMGE5OwogIHQuY2lyY2xlbXVsdGlwbHkgPSAweDIyOTc7CiAgdC5jaXJjbGVvdCA9IDB4MjI5OTsKICB0LmNpcmNsZXBsdXMgPSAweDIyOTU7CiAgdC5jaXJjbGVwb3N0YWxtYXJrID0gMHgzMDM2OwogIHQuY2lyY2xld2l0aGxlZnRoYWxmYmxhY2sgPSAweDI1ZDA7CiAgdC5jaXJjbGV3aXRocmlnaHRoYWxmYmxhY2sgPSAweDI1ZDE7CiAgdC5jaXJjdW1mbGV4ID0gMHgwMmM2OwogIHQuY2lyY3VtZmxleGJlbG93Y21iID0gMHgwMzJkOwogIHQuY2lyY3VtZmxleGNtYiA9IDB4MDMwMjsKICB0LmNsZWFyID0gMHgyMzI3OwogIHQuY2xpY2thbHZlb2xhciA9IDB4MDFjMjsKICB0LmNsaWNrZGVudGFsID0gMHgwMWMwOwogIHQuY2xpY2tsYXRlcmFsID0gMHgwMWMxOwogIHQuY2xpY2tyZXRyb2ZsZXggPSAweDAxYzM7CiAgdC5jbHViID0gMHgyNjYzOwogIHQuY2x1YnN1aXRibGFjayA9IDB4MjY2MzsKICB0LmNsdWJzdWl0d2hpdGUgPSAweDI2Njc7CiAgdC5jbWN1YmVkc3F1YXJlID0gMHgzM2E0OwogIHQuY21vbm9zcGFjZSA9IDB4ZmY0MzsKICB0LmNtc3F1YXJlZHNxdWFyZSA9IDB4MzNhMDsKICB0LmNvYXJtZW5pYW4gPSAweDA1ODE7CiAgdC5jb2xvbiA9IDB4MDAzYTsKICB0LmNvbG9ubW9uZXRhcnkgPSAweDIwYTE7CiAgdC5jb2xvbm1vbm9zcGFjZSA9IDB4ZmYxYTsKICB0LmNvbG9uc2lnbiA9IDB4MjBhMTsKICB0LmNvbG9uc21hbGwgPSAweGZlNTU7CiAgdC5jb2xvbnRyaWFuZ3VsYXJoYWxmbW9kID0gMHgwMmQxOwogIHQuY29sb250cmlhbmd1bGFybW9kID0gMHgwMmQwOwogIHQuY29tbWEgPSAweDAwMmM7CiAgdC5jb21tYWFib3ZlY21iID0gMHgwMzEzOwogIHQuY29tbWFhYm92ZXJpZ2h0Y21iID0gMHgwMzE1OwogIHQuY29tbWFhY2NlbnQgPSAweGY2YzM7CiAgdC5jb21tYWFyYWJpYyA9IDB4MDYwYzsKICB0LmNvbW1hYXJtZW5pYW4gPSAweDA1NWQ7CiAgdC5jb21tYWluZmVyaW9yID0gMHhmNmUxOwogIHQuY29tbWFtb25vc3BhY2UgPSAweGZmMGM7CiAgdC5jb21tYXJldmVyc2VkYWJvdmVjbWIgPSAweDAzMTQ7CiAgdC5jb21tYXJldmVyc2VkbW9kID0gMHgwMmJkOwogIHQuY29tbWFzbWFsbCA9IDB4ZmU1MDsKICB0LmNvbW1hc3VwZXJpb3IgPSAweGY2ZTI7CiAgdC5jb21tYXR1cm5lZGFib3ZlY21iID0gMHgwMzEyOwogIHQuY29tbWF0dXJuZWRtb2QgPSAweDAyYmI7CiAgdC5jb21wYXNzID0gMHgyNjNjOwogIHQuY29uZ3J1ZW50ID0gMHgyMjQ1OwogIHQuY29udG91cmludGVncmFsID0gMHgyMjJlOwogIHQuY29udHJvbCA9IDB4MjMwMzsKICB0LmNvbnRyb2xBQ0sgPSAweDAwMDY7CiAgdC5jb250cm9sQkVMID0gMHgwMDA3OwogIHQuY29udHJvbEJTID0gMHgwMDA4OwogIHQuY29udHJvbENBTiA9IDB4MDAxODsKICB0LmNvbnRyb2xDUiA9IDB4MDAwZDsKICB0LmNvbnRyb2xEQzEgPSAweDAwMTE7CiAgdC5jb250cm9sREMyID0gMHgwMDEyOwogIHQuY29udHJvbERDMyA9IDB4MDAxMzsKICB0LmNvbnRyb2xEQzQgPSAweDAwMTQ7CiAgdC5jb250cm9sREVMID0gMHgwMDdmOwogIHQuY29udHJvbERMRSA9IDB4MDAxMDsKICB0LmNvbnRyb2xFTSA9IDB4MDAxOTsKICB0LmNvbnRyb2xFTlEgPSAweDAwMDU7CiAgdC5jb250cm9sRU9UID0gMHgwMDA0OwogIHQuY29udHJvbEVTQyA9IDB4MDAxYjsKICB0LmNvbnRyb2xFVEIgPSAweDAwMTc7CiAgdC5jb250cm9sRVRYID0gMHgwMDAzOwogIHQuY29udHJvbEZGID0gMHgwMDBjOwogIHQuY29udHJvbEZTID0gMHgwMDFjOwogIHQuY29udHJvbEdTID0gMHgwMDFkOwogIHQuY29udHJvbEhUID0gMHgwMDA5OwogIHQuY29udHJvbExGID0gMHgwMDBhOwogIHQuY29udHJvbE5BSyA9IDB4MDAxNTsKICB0LmNvbnRyb2xOVUxMID0gMHgwMDAwOwogIHQuY29udHJvbFJTID0gMHgwMDFlOwogIHQuY29udHJvbFNJID0gMHgwMDBmOwogIHQuY29udHJvbFNPID0gMHgwMDBlOwogIHQuY29udHJvbFNPVCA9IDB4MDAwMjsKICB0LmNvbnRyb2xTVFggPSAweDAwMDE7CiAgdC5jb250cm9sU1VCID0gMHgwMDFhOwogIHQuY29udHJvbFNZTiA9IDB4MDAxNjsKICB0LmNvbnRyb2xVUyA9IDB4MDAxZjsKICB0LmNvbnRyb2xWVCA9IDB4MDAwYjsKICB0LmNvcHlyaWdodCA9IDB4MDBhOTsKICB0LmNvcHlyaWdodHNhbnMgPSAweGY4ZTk7CiAgdC5jb3B5cmlnaHRzZXJpZiA9IDB4ZjZkOTsKICB0LmNvcm5lcmJyYWNrZXRsZWZ0ID0gMHgzMDBjOwogIHQuY29ybmVyYnJhY2tldGxlZnRoYWxmd2lkdGggPSAweGZmNjI7CiAgdC5jb3JuZXJicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTQxOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0ID0gMHgzMDBkOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0aGFsZndpZHRoID0gMHhmZjYzOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0dmVydGljYWwgPSAweGZlNDI7CiAgdC5jb3Jwb3JhdGlvbnNxdWFyZSA9IDB4MzM3ZjsKICB0LmNvc3F1YXJlID0gMHgzM2M3OwogIHQuY292ZXJrZ3NxdWFyZSA9IDB4MzNjNjsKICB0LmNwYXJlbiA9IDB4MjQ5ZTsKICB0LmNydXplaXJvID0gMHgyMGEyOwogIHQuY3N0cmV0Y2hlZCA9IDB4MDI5NzsKICB0LmN1cmx5YW5kID0gMHgyMmNmOwogIHQuY3VybHlvciA9IDB4MjJjZTsKICB0LmN1cnJlbmN5ID0gMHgwMGE0OwogIHQuY3lyQnJldmUgPSAweGY2ZDE7CiAgdC5jeXJGbGV4ID0gMHhmNmQyOwogIHQuY3lyYnJldmUgPSAweGY2ZDQ7CiAgdC5jeXJmbGV4ID0gMHhmNmQ1OwogIHQuZCA9IDB4MDA2NDsKICB0LmRhYXJtZW5pYW4gPSAweDA1NjQ7CiAgdC5kYWJlbmdhbGkgPSAweDA5YTY7CiAgdC5kYWRhcmFiaWMgPSAweDA2MzY7CiAgdC5kYWRldmEgPSAweDA5MjY7CiAgdC5kYWRmaW5hbGFyYWJpYyA9IDB4ZmViZTsKICB0LmRhZGluaXRpYWxhcmFiaWMgPSAweGZlYmY7CiAgdC5kYWRtZWRpYWxhcmFiaWMgPSAweGZlYzA7CiAgdC5kYWdlc2ggPSAweDA1YmM7CiAgdC5kYWdlc2hoZWJyZXcgPSAweDA1YmM7CiAgdC5kYWdnZXIgPSAweDIwMjA7CiAgdC5kYWdnZXJkYmwgPSAweDIwMjE7CiAgdC5kYWd1amFyYXRpID0gMHgwYWE2OwogIHQuZGFndXJtdWtoaSA9IDB4MGEyNjsKICB0LmRhaGlyYWdhbmEgPSAweDMwNjA7CiAgdC5kYWthdGFrYW5hID0gMHgzMGMwOwogIHQuZGFsYXJhYmljID0gMHgwNjJmOwogIHQuZGFsZXQgPSAweDA1ZDM7CiAgdC5kYWxldGRhZ2VzaCA9IDB4ZmIzMzsKICB0LmRhbGV0ZGFnZXNoaGVicmV3ID0gMHhmYjMzOwogIHQuZGFsZXRoZWJyZXcgPSAweDA1ZDM7CiAgdC5kYWxmaW5hbGFyYWJpYyA9IDB4ZmVhYTsKICB0LmRhbW1hYXJhYmljID0gMHgwNjRmOwogIHQuZGFtbWFsb3dhcmFiaWMgPSAweDA2NGY7CiAgdC5kYW1tYXRhbmFsdG9uZWFyYWJpYyA9IDB4MDY0YzsKICB0LmRhbW1hdGFuYXJhYmljID0gMHgwNjRjOwogIHQuZGFuZGEgPSAweDA5NjQ7CiAgdC5kYXJnYWhlYnJldyA9IDB4MDVhNzsKICB0LmRhcmdhbGVmdGhlYnJldyA9IDB4MDVhNzsKICB0LmRhc2lhcG5ldW1hdGFjeXJpbGxpY2NtYiA9IDB4MDQ4NTsKICB0LmRibEdyYXZlID0gMHhmNmQzOwogIHQuZGJsYW5nbGVicmFja2V0bGVmdCA9IDB4MzAwYTsKICB0LmRibGFuZ2xlYnJhY2tldGxlZnR2ZXJ0aWNhbCA9IDB4ZmUzZDsKICB0LmRibGFuZ2xlYnJhY2tldHJpZ2h0ID0gMHgzMDBiOwogIHQuZGJsYW5nbGVicmFja2V0cmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzZTsKICB0LmRibGFyY2hpbnZlcnRlZGJlbG93Y21iID0gMHgwMzJiOwogIHQuZGJsYXJyb3dsZWZ0ID0gMHgyMWQ0OwogIHQuZGJsYXJyb3dyaWdodCA9IDB4MjFkMjsKICB0LmRibGRhbmRhID0gMHgwOTY1OwogIHQuZGJsZ3JhdmUgPSAweGY2ZDY7CiAgdC5kYmxncmF2ZWNtYiA9IDB4MDMwZjsKICB0LmRibGludGVncmFsID0gMHgyMjJjOwogIHQuZGJsbG93bGluZSA9IDB4MjAxNzsKICB0LmRibGxvd2xpbmVjbWIgPSAweDAzMzM7CiAgdC5kYmxvdmVybGluZWNtYiA9IDB4MDMzZjsKICB0LmRibHByaW1lbW9kID0gMHgwMmJhOwogIHQuZGJsdmVydGljYWxiYXIgPSAweDIwMTY7CiAgdC5kYmx2ZXJ0aWNhbGxpbmVhYm92ZWNtYiA9IDB4MDMwZTsKICB0LmRib3BvbW9mbyA9IDB4MzEwOTsKICB0LmRic3F1YXJlID0gMHgzM2M4OwogIHQuZGNhcm9uID0gMHgwMTBmOwogIHQuZGNlZGlsbGEgPSAweDFlMTE7CiAgdC5kY2lyY2xlID0gMHgyNGQzOwogIHQuZGNpcmN1bWZsZXhiZWxvdyA9IDB4MWUxMzsKICB0LmRjcm9hdCA9IDB4MDExMTsKICB0LmRkYWJlbmdhbGkgPSAweDA5YTE7CiAgdC5kZGFkZXZhID0gMHgwOTIxOwogIHQuZGRhZ3VqYXJhdGkgPSAweDBhYTE7CiAgdC5kZGFndXJtdWtoaSA9IDB4MGEyMTsKICB0LmRkYWxhcmFiaWMgPSAweDA2ODg7CiAgdC5kZGFsZmluYWxhcmFiaWMgPSAweGZiODk7CiAgdC5kZGRoYWRldmEgPSAweDA5NWM7CiAgdC5kZGhhYmVuZ2FsaSA9IDB4MDlhMjsKICB0LmRkaGFkZXZhID0gMHgwOTIyOwogIHQuZGRoYWd1amFyYXRpID0gMHgwYWEyOwogIHQuZGRoYWd1cm11a2hpID0gMHgwYTIyOwogIHQuZGRvdGFjY2VudCA9IDB4MWUwYjsKICB0LmRkb3RiZWxvdyA9IDB4MWUwZDsKICB0LmRlY2ltYWxzZXBhcmF0b3JhcmFiaWMgPSAweDA2NmI7CiAgdC5kZWNpbWFsc2VwYXJhdG9ycGVyc2lhbiA9IDB4MDY2YjsKICB0LmRlY3lyaWxsaWMgPSAweDA0MzQ7CiAgdC5kZWdyZWUgPSAweDAwYjA7CiAgdC5kZWhpaGVicmV3ID0gMHgwNWFkOwogIHQuZGVoaXJhZ2FuYSA9IDB4MzA2NzsKICB0LmRlaWNvcHRpYyA9IDB4MDNlZjsKICB0LmRla2F0YWthbmEgPSAweDMwYzc7CiAgdC5kZWxldGVsZWZ0ID0gMHgyMzJiOwogIHQuZGVsZXRlcmlnaHQgPSAweDIzMjY7CiAgdC5kZWx0YSA9IDB4MDNiNDsKICB0LmRlbHRhdHVybmVkID0gMHgwMThkOwogIHQuZGVub21pbmF0b3JtaW51c29uZW51bWVyYXRvcmJlbmdhbGkgPSAweDA5Zjg7CiAgdC5kZXpoID0gMHgwMmE0OwogIHQuZGhhYmVuZ2FsaSA9IDB4MDlhNzsKICB0LmRoYWRldmEgPSAweDA5Mjc7CiAgdC5kaGFndWphcmF0aSA9IDB4MGFhNzsKICB0LmRoYWd1cm11a2hpID0gMHgwYTI3OwogIHQuZGhvb2sgPSAweDAyNTc7CiAgdC5kaWFseXRpa2F0b25vcyA9IDB4MDM4NTsKICB0LmRpYWx5dGlrYXRvbm9zY21iID0gMHgwMzQ0OwogIHQuZGlhbW9uZCA9IDB4MjY2NjsKICB0LmRpYW1vbmRzdWl0d2hpdGUgPSAweDI2NjI7CiAgdC5kaWVyZXNpcyA9IDB4MDBhODsKICB0LmRpZXJlc2lzYWN1dGUgPSAweGY2ZDc7CiAgdC5kaWVyZXNpc2JlbG93Y21iID0gMHgwMzI0OwogIHQuZGllcmVzaXNjbWIgPSAweDAzMDg7CiAgdC5kaWVyZXNpc2dyYXZlID0gMHhmNmQ4OwogIHQuZGllcmVzaXN0b25vcyA9IDB4MDM4NTsKICB0LmRpaGlyYWdhbmEgPSAweDMwNjI7CiAgdC5kaWthdGFrYW5hID0gMHgzMGMyOwogIHQuZGl0dG9tYXJrID0gMHgzMDAzOwogIHQuZGl2aWRlID0gMHgwMGY3OwogIHQuZGl2aWRlcyA9IDB4MjIyMzsKICB0LmRpdmlzaW9uc2xhc2ggPSAweDIyMTU7CiAgdC5kamVjeXJpbGxpYyA9IDB4MDQ1MjsKICB0LmRrc2hhZGUgPSAweDI1OTM7CiAgdC5kbGluZWJlbG93ID0gMHgxZTBmOwogIHQuZGxzcXVhcmUgPSAweDMzOTc7CiAgdC5kbWFjcm9uID0gMHgwMTExOwogIHQuZG1vbm9zcGFjZSA9IDB4ZmY0NDsKICB0LmRuYmxvY2sgPSAweDI1ODQ7CiAgdC5kb2NoYWRhdGhhaSA9IDB4MGUwZTsKICB0LmRvZGVrdGhhaSA9IDB4MGUxNDsKICB0LmRvaGlyYWdhbmEgPSAweDMwNjk7CiAgdC5kb2thdGFrYW5hID0gMHgzMGM5OwogIHQuZG9sbGFyID0gMHgwMDI0OwogIHQuZG9sbGFyaW5mZXJpb3IgPSAweGY2ZTM7CiAgdC5kb2xsYXJtb25vc3BhY2UgPSAweGZmMDQ7CiAgdC5kb2xsYXJvbGRzdHlsZSA9IDB4ZjcyNDsKICB0LmRvbGxhcnNtYWxsID0gMHhmZTY5OwogIHQuZG9sbGFyc3VwZXJpb3IgPSAweGY2ZTQ7CiAgdC5kb25nID0gMHgyMGFiOwogIHQuZG9ydXNxdWFyZSA9IDB4MzMyNjsKICB0LmRvdGFjY2VudCA9IDB4MDJkOTsKICB0LmRvdGFjY2VudGNtYiA9IDB4MDMwNzsKICB0LmRvdGJlbG93Y21iID0gMHgwMzIzOwogIHQuZG90YmVsb3djb21iID0gMHgwMzIzOwogIHQuZG90a2F0YWthbmEgPSAweDMwZmI7CiAgdC5kb3RsZXNzaSA9IDB4MDEzMTsKICB0LmRvdGxlc3NqID0gMHhmNmJlOwogIHQuZG90bGVzc2pzdHJva2Vob29rID0gMHgwMjg0OwogIHQuZG90bWF0aCA9IDB4MjJjNTsKICB0LmRvdHRlZGNpcmNsZSA9IDB4MjVjYzsKICB0LmRvdWJsZXlvZHBhdGFoID0gMHhmYjFmOwogIHQuZG91YmxleW9kcGF0YWhoZWJyZXcgPSAweGZiMWY7CiAgdC5kb3dudGFja2JlbG93Y21iID0gMHgwMzFlOwogIHQuZG93bnRhY2ttb2QgPSAweDAyZDU7CiAgdC5kcGFyZW4gPSAweDI0OWY7CiAgdC5kc3VwZXJpb3IgPSAweGY2ZWI7CiAgdC5kdGFpbCA9IDB4MDI1NjsKICB0LmR0b3BiYXIgPSAweDAxOGM7CiAgdC5kdWhpcmFnYW5hID0gMHgzMDY1OwogIHQuZHVrYXRha2FuYSA9IDB4MzBjNTsKICB0LmR6ID0gMHgwMWYzOwogIHQuZHphbHRvbmUgPSAweDAyYTM7CiAgdC5kemNhcm9uID0gMHgwMWM2OwogIHQuZHpjdXJsID0gMHgwMmE1OwogIHQuZHplYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0ZTE7CiAgdC5kemVjeXJpbGxpYyA9IDB4MDQ1NTsKICB0LmR6aGVjeXJpbGxpYyA9IDB4MDQ1ZjsKICB0LmUgPSAweDAwNjU7CiAgdC5lYWN1dGUgPSAweDAwZTk7CiAgdC5lYXJ0aCA9IDB4MjY0MTsKICB0LmViZW5nYWxpID0gMHgwOThmOwogIHQuZWJvcG9tb2ZvID0gMHgzMTFjOwogIHQuZWJyZXZlID0gMHgwMTE1OwogIHQuZWNhbmRyYWRldmEgPSAweDA5MGQ7CiAgdC5lY2FuZHJhZ3VqYXJhdGkgPSAweDBhOGQ7CiAgdC5lY2FuZHJhdm93ZWxzaWduZGV2YSA9IDB4MDk0NTsKICB0LmVjYW5kcmF2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjNTsKICB0LmVjYXJvbiA9IDB4MDExYjsKICB0LmVjZWRpbGxhYnJldmUgPSAweDFlMWQ7CiAgdC5lY2hhcm1lbmlhbiA9IDB4MDU2NTsKICB0LmVjaHlpd25hcm1lbmlhbiA9IDB4MDU4NzsKICB0LmVjaXJjbGUgPSAweDI0ZDQ7CiAgdC5lY2lyY3VtZmxleCA9IDB4MDBlYTsKICB0LmVjaXJjdW1mbGV4YWN1dGUgPSAweDFlYmY7CiAgdC5lY2lyY3VtZmxleGJlbG93ID0gMHgxZTE5OwogIHQuZWNpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVjNzsKICB0LmVjaXJjdW1mbGV4Z3JhdmUgPSAweDFlYzE7CiAgdC5lY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVjMzsKICB0LmVjaXJjdW1mbGV4dGlsZGUgPSAweDFlYzU7CiAgdC5lY3lyaWxsaWMgPSAweDA0NTQ7CiAgdC5lZGJsZ3JhdmUgPSAweDAyMDU7CiAgdC5lZGV2YSA9IDB4MDkwZjsKICB0LmVkaWVyZXNpcyA9IDB4MDBlYjsKICB0LmVkb3QgPSAweDAxMTc7CiAgdC5lZG90YWNjZW50ID0gMHgwMTE3OwogIHQuZWRvdGJlbG93ID0gMHgxZWI5OwogIHQuZWVndXJtdWtoaSA9IDB4MGEwZjsKICB0LmVlbWF0cmFndXJtdWtoaSA9IDB4MGE0NzsKICB0LmVmY3lyaWxsaWMgPSAweDA0NDQ7CiAgdC5lZ3JhdmUgPSAweDAwZTg7CiAgdC5lZ3VqYXJhdGkgPSAweDBhOGY7CiAgdC5laGFybWVuaWFuID0gMHgwNTY3OwogIHQuZWhib3BvbW9mbyA9IDB4MzExZDsKICB0LmVoaXJhZ2FuYSA9IDB4MzA0ODsKICB0LmVob29rYWJvdmUgPSAweDFlYmI7CiAgdC5laWJvcG9tb2ZvID0gMHgzMTFmOwogIHQuZWlnaHQgPSAweDAwMzg7CiAgdC5laWdodGFyYWJpYyA9IDB4MDY2ODsKICB0LmVpZ2h0YmVuZ2FsaSA9IDB4MDllZTsKICB0LmVpZ2h0Y2lyY2xlID0gMHgyNDY3OwogIHQuZWlnaHRjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzkxOwogIHQuZWlnaHRkZXZhID0gMHgwOTZlOwogIHQuZWlnaHRlZW5jaXJjbGUgPSAweDI0NzE7CiAgdC5laWdodGVlbnBhcmVuID0gMHgyNDg1OwogIHQuZWlnaHRlZW5wZXJpb2QgPSAweDI0OTk7CiAgdC5laWdodGd1amFyYXRpID0gMHgwYWVlOwogIHQuZWlnaHRndXJtdWtoaSA9IDB4MGE2ZTsKICB0LmVpZ2h0aGFja2FyYWJpYyA9IDB4MDY2ODsKICB0LmVpZ2h0aGFuZ3pob3UgPSAweDMwMjg7CiAgdC5laWdodGhub3RlYmVhbWVkID0gMHgyNjZiOwogIHQuZWlnaHRpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI3OwogIHQuZWlnaHRpbmZlcmlvciA9IDB4MjA4ODsKICB0LmVpZ2h0bW9ub3NwYWNlID0gMHhmZjE4OwogIHQuZWlnaHRvbGRzdHlsZSA9IDB4ZjczODsKICB0LmVpZ2h0cGFyZW4gPSAweDI0N2I7CiAgdC5laWdodHBlcmlvZCA9IDB4MjQ4ZjsKICB0LmVpZ2h0cGVyc2lhbiA9IDB4MDZmODsKICB0LmVpZ2h0cm9tYW4gPSAweDIxNzc7CiAgdC5laWdodHN1cGVyaW9yID0gMHgyMDc4OwogIHQuZWlnaHR0aGFpID0gMHgwZTU4OwogIHQuZWludmVydGVkYnJldmUgPSAweDAyMDc7CiAgdC5laW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2NTsKICB0LmVrYXRha2FuYSA9IDB4MzBhODsKICB0LmVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3NDsKICB0LmVrb25rYXJndXJtdWtoaSA9IDB4MGE3NDsKICB0LmVrb3JlYW4gPSAweDMxNTQ7CiAgdC5lbGN5cmlsbGljID0gMHgwNDNiOwogIHQuZWxlbWVudCA9IDB4MjIwODsKICB0LmVsZXZlbmNpcmNsZSA9IDB4MjQ2YTsKICB0LmVsZXZlbnBhcmVuID0gMHgyNDdlOwogIHQuZWxldmVucGVyaW9kID0gMHgyNDkyOwogIHQuZWxldmVucm9tYW4gPSAweDIxN2E7CiAgdC5lbGxpcHNpcyA9IDB4MjAyNjsKICB0LmVsbGlwc2lzdmVydGljYWwgPSAweDIyZWU7CiAgdC5lbWFjcm9uID0gMHgwMTEzOwogIHQuZW1hY3JvbmFjdXRlID0gMHgxZTE3OwogIHQuZW1hY3JvbmdyYXZlID0gMHgxZTE1OwogIHQuZW1jeXJpbGxpYyA9IDB4MDQzYzsKICB0LmVtZGFzaCA9IDB4MjAxNDsKICB0LmVtZGFzaHZlcnRpY2FsID0gMHhmZTMxOwogIHQuZW1vbm9zcGFjZSA9IDB4ZmY0NTsKICB0LmVtcGhhc2lzbWFya2FybWVuaWFuID0gMHgwNTViOwogIHQuZW1wdHlzZXQgPSAweDIyMDU7CiAgdC5lbmJvcG9tb2ZvID0gMHgzMTIzOwogIHQuZW5jeXJpbGxpYyA9IDB4MDQzZDsKICB0LmVuZGFzaCA9IDB4MjAxMzsKICB0LmVuZGFzaHZlcnRpY2FsID0gMHhmZTMyOwogIHQuZW5kZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhMzsKICB0LmVuZyA9IDB4MDE0YjsKICB0LmVuZ2JvcG9tb2ZvID0gMHgzMTI1OwogIHQuZW5naGVjeXJpbGxpYyA9IDB4MDRhNTsKICB0LmVuaG9va2N5cmlsbGljID0gMHgwNGM4OwogIHQuZW5zcGFjZSA9IDB4MjAwMjsKICB0LmVvZ29uZWsgPSAweDAxMTk7CiAgdC5lb2tvcmVhbiA9IDB4MzE1MzsKICB0LmVvcGVuID0gMHgwMjViOwogIHQuZW9wZW5jbG9zZWQgPSAweDAyOWE7CiAgdC5lb3BlbnJldmVyc2VkID0gMHgwMjVjOwogIHQuZW9wZW5yZXZlcnNlZGNsb3NlZCA9IDB4MDI1ZTsKICB0LmVvcGVucmV2ZXJzZWRob29rID0gMHgwMjVkOwogIHQuZXBhcmVuID0gMHgyNGEwOwogIHQuZXBzaWxvbiA9IDB4MDNiNTsKICB0LmVwc2lsb250b25vcyA9IDB4MDNhZDsKICB0LmVxdWFsID0gMHgwMDNkOwogIHQuZXF1YWxtb25vc3BhY2UgPSAweGZmMWQ7CiAgdC5lcXVhbHNtYWxsID0gMHhmZTY2OwogIHQuZXF1YWxzdXBlcmlvciA9IDB4MjA3YzsKICB0LmVxdWl2YWxlbmNlID0gMHgyMjYxOwogIHQuZXJib3BvbW9mbyA9IDB4MzEyNjsKICB0LmVyY3lyaWxsaWMgPSAweDA0NDA7CiAgdC5lcmV2ZXJzZWQgPSAweDAyNTg7CiAgdC5lcmV2ZXJzZWRjeXJpbGxpYyA9IDB4MDQ0ZDsKICB0LmVzY3lyaWxsaWMgPSAweDA0NDE7CiAgdC5lc2Rlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFiOwogIHQuZXNoID0gMHgwMjgzOwogIHQuZXNoY3VybCA9IDB4MDI4NjsKICB0LmVzaG9ydGRldmEgPSAweDA5MGU7CiAgdC5lc2hvcnR2b3dlbHNpZ25kZXZhID0gMHgwOTQ2OwogIHQuZXNocmV2ZXJzZWRsb29wID0gMHgwMWFhOwogIHQuZXNoc3F1YXRyZXZlcnNlZCA9IDB4MDI4NTsKICB0LmVzbWFsbGhpcmFnYW5hID0gMHgzMDQ3OwogIHQuZXNtYWxsa2F0YWthbmEgPSAweDMwYTc7CiAgdC5lc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YTsKICB0LmVzdGltYXRlZCA9IDB4MjEyZTsKICB0LmVzdXBlcmlvciA9IDB4ZjZlYzsKICB0LmV0YSA9IDB4MDNiNzsKICB0LmV0YXJtZW5pYW4gPSAweDA1Njg7CiAgdC5ldGF0b25vcyA9IDB4MDNhZTsKICB0LmV0aCA9IDB4MDBmMDsKICB0LmV0aWxkZSA9IDB4MWViZDsKICB0LmV0aWxkZWJlbG93ID0gMHgxZTFiOwogIHQuZXRuYWh0YWZvdWtoaGVicmV3ID0gMHgwNTkxOwogIHQuZXRuYWh0YWZvdWtobGVmdGhlYnJldyA9IDB4MDU5MTsKICB0LmV0bmFodGFoZWJyZXcgPSAweDA1OTE7CiAgdC5ldG5haHRhbGVmdGhlYnJldyA9IDB4MDU5MTsKICB0LmV0dXJuZWQgPSAweDAxZGQ7CiAgdC5ldWtvcmVhbiA9IDB4MzE2MTsKICB0LmV1cm8gPSAweDIwYWM7CiAgdC5ldm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljNzsKICB0LmV2b3dlbHNpZ25kZXZhID0gMHgwOTQ3OwogIHQuZXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM3OwogIHQuZXhjbGFtID0gMHgwMDIxOwogIHQuZXhjbGFtYXJtZW5pYW4gPSAweDA1NWM7CiAgdC5leGNsYW1kYmwgPSAweDIwM2M7CiAgdC5leGNsYW1kb3duID0gMHgwMGExOwogIHQuZXhjbGFtZG93bnNtYWxsID0gMHhmN2ExOwogIHQuZXhjbGFtbW9ub3NwYWNlID0gMHhmZjAxOwogIHQuZXhjbGFtc21hbGwgPSAweGY3MjE7CiAgdC5leGlzdGVudGlhbCA9IDB4MjIwMzsKICB0LmV6aCA9IDB4MDI5MjsKICB0LmV6aGNhcm9uID0gMHgwMWVmOwogIHQuZXpoY3VybCA9IDB4MDI5MzsKICB0LmV6aHJldmVyc2VkID0gMHgwMWI5OwogIHQuZXpodGFpbCA9IDB4MDFiYTsKICB0LmYgPSAweDAwNjY7CiAgdC5mYWRldmEgPSAweDA5NWU7CiAgdC5mYWd1cm11a2hpID0gMHgwYTVlOwogIHQuZmFocmVuaGVpdCA9IDB4MjEwOTsKICB0LmZhdGhhYXJhYmljID0gMHgwNjRlOwogIHQuZmF0aGFsb3dhcmFiaWMgPSAweDA2NGU7CiAgdC5mYXRoYXRhbmFyYWJpYyA9IDB4MDY0YjsKICB0LmZib3BvbW9mbyA9IDB4MzEwODsKICB0LmZjaXJjbGUgPSAweDI0ZDU7CiAgdC5mZG90YWNjZW50ID0gMHgxZTFmOwogIHQuZmVoYXJhYmljID0gMHgwNjQxOwogIHQuZmVoYXJtZW5pYW4gPSAweDA1ODY7CiAgdC5mZWhmaW5hbGFyYWJpYyA9IDB4ZmVkMjsKICB0LmZlaGluaXRpYWxhcmFiaWMgPSAweGZlZDM7CiAgdC5mZWhtZWRpYWxhcmFiaWMgPSAweGZlZDQ7CiAgdC5mZWljb3B0aWMgPSAweDAzZTU7CiAgdC5mZW1hbGUgPSAweDI2NDA7CiAgdC5mZiA9IDB4ZmIwMDsKICB0LmZfZiA9IDB4ZmIwMDsKICB0LmZmaSA9IDB4ZmIwMzsKICB0LmZfZl9pID0gMHhmYjAzOwogIHQuZmZsID0gMHhmYjA0OwogIHQuZl9mX2wgPSAweGZiMDQ7CiAgdC5maSA9IDB4ZmIwMTsKICB0LmZfaSA9IDB4ZmIwMTsKICB0LmZpZnRlZW5jaXJjbGUgPSAweDI0NmU7CiAgdC5maWZ0ZWVucGFyZW4gPSAweDI0ODI7CiAgdC5maWZ0ZWVucGVyaW9kID0gMHgyNDk2OwogIHQuZmlndXJlZGFzaCA9IDB4MjAxMjsKICB0LmZpbGxlZGJveCA9IDB4MjVhMDsKICB0LmZpbGxlZHJlY3QgPSAweDI1YWM7CiAgdC5maW5hbGthZiA9IDB4MDVkYTsKICB0LmZpbmFsa2FmZGFnZXNoID0gMHhmYjNhOwogIHQuZmluYWxrYWZkYWdlc2hoZWJyZXcgPSAweGZiM2E7CiAgdC5maW5hbGthZmhlYnJldyA9IDB4MDVkYTsKICB0LmZpbmFsbWVtID0gMHgwNWRkOwogIHQuZmluYWxtZW1oZWJyZXcgPSAweDA1ZGQ7CiAgdC5maW5hbG51biA9IDB4MDVkZjsKICB0LmZpbmFsbnVuaGVicmV3ID0gMHgwNWRmOwogIHQuZmluYWxwZSA9IDB4MDVlMzsKICB0LmZpbmFscGVoZWJyZXcgPSAweDA1ZTM7CiAgdC5maW5hbHRzYWRpID0gMHgwNWU1OwogIHQuZmluYWx0c2FkaWhlYnJldyA9IDB4MDVlNTsKICB0LmZpcnN0dG9uZWNoaW5lc2UgPSAweDAyYzk7CiAgdC5maXNoZXllID0gMHgyNWM5OwogIHQuZml0YWN5cmlsbGljID0gMHgwNDczOwogIHQuZml2ZSA9IDB4MDAzNTsKICB0LmZpdmVhcmFiaWMgPSAweDA2NjU7CiAgdC5maXZlYmVuZ2FsaSA9IDB4MDllYjsKICB0LmZpdmVjaXJjbGUgPSAweDI0NjQ7CiAgdC5maXZlY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4ZTsKICB0LmZpdmVkZXZhID0gMHgwOTZiOwogIHQuZml2ZWVpZ2h0aHMgPSAweDIxNWQ7CiAgdC5maXZlZ3VqYXJhdGkgPSAweDBhZWI7CiAgdC5maXZlZ3VybXVraGkgPSAweDBhNmI7CiAgdC5maXZlaGFja2FyYWJpYyA9IDB4MDY2NTsKICB0LmZpdmVoYW5nemhvdSA9IDB4MzAyNTsKICB0LmZpdmVpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI0OwogIHQuZml2ZWluZmVyaW9yID0gMHgyMDg1OwogIHQuZml2ZW1vbm9zcGFjZSA9IDB4ZmYxNTsKICB0LmZpdmVvbGRzdHlsZSA9IDB4ZjczNTsKICB0LmZpdmVwYXJlbiA9IDB4MjQ3ODsKICB0LmZpdmVwZXJpb2QgPSAweDI0OGM7CiAgdC5maXZlcGVyc2lhbiA9IDB4MDZmNTsKICB0LmZpdmVyb21hbiA9IDB4MjE3NDsKICB0LmZpdmVzdXBlcmlvciA9IDB4MjA3NTsKICB0LmZpdmV0aGFpID0gMHgwZTU1OwogIHQuZmwgPSAweGZiMDI7CiAgdC5mX2wgPSAweGZiMDI7CiAgdC5mbG9yaW4gPSAweDAxOTI7CiAgdC5mbW9ub3NwYWNlID0gMHhmZjQ2OwogIHQuZm1zcXVhcmUgPSAweDMzOTk7CiAgdC5mb2ZhbnRoYWkgPSAweDBlMWY7CiAgdC5mb2ZhdGhhaSA9IDB4MGUxZDsKICB0LmZvbmdtYW50aGFpID0gMHgwZTRmOwogIHQuZm9yYWxsID0gMHgyMjAwOwogIHQuZm91ciA9IDB4MDAzNDsKICB0LmZvdXJhcmFiaWMgPSAweDA2NjQ7CiAgdC5mb3VyYmVuZ2FsaSA9IDB4MDllYTsKICB0LmZvdXJjaXJjbGUgPSAweDI0NjM7CiAgdC5mb3VyY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4ZDsKICB0LmZvdXJkZXZhID0gMHgwOTZhOwogIHQuZm91cmd1amFyYXRpID0gMHgwYWVhOwogIHQuZm91cmd1cm11a2hpID0gMHgwYTZhOwogIHQuZm91cmhhY2thcmFiaWMgPSAweDA2NjQ7CiAgdC5mb3VyaGFuZ3pob3UgPSAweDMwMjQ7CiAgdC5mb3VyaWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyMzsKICB0LmZvdXJpbmZlcmlvciA9IDB4MjA4NDsKICB0LmZvdXJtb25vc3BhY2UgPSAweGZmMTQ7CiAgdC5mb3VybnVtZXJhdG9yYmVuZ2FsaSA9IDB4MDlmNzsKICB0LmZvdXJvbGRzdHlsZSA9IDB4ZjczNDsKICB0LmZvdXJwYXJlbiA9IDB4MjQ3NzsKICB0LmZvdXJwZXJpb2QgPSAweDI0OGI7CiAgdC5mb3VycGVyc2lhbiA9IDB4MDZmNDsKICB0LmZvdXJyb21hbiA9IDB4MjE3MzsKICB0LmZvdXJzdXBlcmlvciA9IDB4MjA3NDsKICB0LmZvdXJ0ZWVuY2lyY2xlID0gMHgyNDZkOwogIHQuZm91cnRlZW5wYXJlbiA9IDB4MjQ4MTsKICB0LmZvdXJ0ZWVucGVyaW9kID0gMHgyNDk1OwogIHQuZm91cnRoYWkgPSAweDBlNTQ7CiAgdC5mb3VydGh0b25lY2hpbmVzZSA9IDB4MDJjYjsKICB0LmZwYXJlbiA9IDB4MjRhMTsKICB0LmZyYWN0aW9uID0gMHgyMDQ0OwogIHQuZnJhbmMgPSAweDIwYTM7CiAgdC5nID0gMHgwMDY3OwogIHQuZ2FiZW5nYWxpID0gMHgwOTk3OwogIHQuZ2FjdXRlID0gMHgwMWY1OwogIHQuZ2FkZXZhID0gMHgwOTE3OwogIHQuZ2FmYXJhYmljID0gMHgwNmFmOwogIHQuZ2FmZmluYWxhcmFiaWMgPSAweGZiOTM7CiAgdC5nYWZpbml0aWFsYXJhYmljID0gMHhmYjk0OwogIHQuZ2FmbWVkaWFsYXJhYmljID0gMHhmYjk1OwogIHQuZ2FndWphcmF0aSA9IDB4MGE5NzsKICB0LmdhZ3VybXVraGkgPSAweDBhMTc7CiAgdC5nYWhpcmFnYW5hID0gMHgzMDRjOwogIHQuZ2FrYXRha2FuYSA9IDB4MzBhYzsKICB0LmdhbW1hID0gMHgwM2IzOwogIHQuZ2FtbWFsYXRpbnNtYWxsID0gMHgwMjYzOwogIHQuZ2FtbWFzdXBlcmlvciA9IDB4MDJlMDsKICB0LmdhbmdpYWNvcHRpYyA9IDB4MDNlYjsKICB0Lmdib3BvbW9mbyA9IDB4MzEwZDsKICB0LmdicmV2ZSA9IDB4MDExZjsKICB0LmdjYXJvbiA9IDB4MDFlNzsKICB0LmdjZWRpbGxhID0gMHgwMTIzOwogIHQuZ2NpcmNsZSA9IDB4MjRkNjsKICB0LmdjaXJjdW1mbGV4ID0gMHgwMTFkOwogIHQuZ2NvbW1hYWNjZW50ID0gMHgwMTIzOwogIHQuZ2RvdCA9IDB4MDEyMTsKICB0Lmdkb3RhY2NlbnQgPSAweDAxMjE7CiAgdC5nZWN5cmlsbGljID0gMHgwNDMzOwogIHQuZ2VoaXJhZ2FuYSA9IDB4MzA1MjsKICB0Lmdla2F0YWthbmEgPSAweDMwYjI7CiAgdC5nZW9tZXRyaWNhbGx5ZXF1YWwgPSAweDIyNTE7CiAgdC5nZXJlc2hhY2NlbnRoZWJyZXcgPSAweDA1OWM7CiAgdC5nZXJlc2hoZWJyZXcgPSAweDA1ZjM7CiAgdC5nZXJlc2htdXFkYW1oZWJyZXcgPSAweDA1OWQ7CiAgdC5nZXJtYW5kYmxzID0gMHgwMGRmOwogIHQuZ2Vyc2hheWltYWNjZW50aGVicmV3ID0gMHgwNTllOwogIHQuZ2Vyc2hheWltaGVicmV3ID0gMHgwNWY0OwogIHQuZ2V0YW1hcmsgPSAweDMwMTM7CiAgdC5naGFiZW5nYWxpID0gMHgwOTk4OwogIHQuZ2hhZGFybWVuaWFuID0gMHgwNTcyOwogIHQuZ2hhZGV2YSA9IDB4MDkxODsKICB0LmdoYWd1amFyYXRpID0gMHgwYTk4OwogIHQuZ2hhZ3VybXVraGkgPSAweDBhMTg7CiAgdC5naGFpbmFyYWJpYyA9IDB4MDYzYTsKICB0LmdoYWluZmluYWxhcmFiaWMgPSAweGZlY2U7CiAgdC5naGFpbmluaXRpYWxhcmFiaWMgPSAweGZlY2Y7CiAgdC5naGFpbm1lZGlhbGFyYWJpYyA9IDB4ZmVkMDsKICB0LmdoZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDQ5NTsKICB0LmdoZXN0cm9rZWN5cmlsbGljID0gMHgwNDkzOwogIHQuZ2hldXB0dXJuY3lyaWxsaWMgPSAweDA0OTE7CiAgdC5naGhhZGV2YSA9IDB4MDk1YTsKICB0LmdoaGFndXJtdWtoaSA9IDB4MGE1YTsKICB0Lmdob29rID0gMHgwMjYwOwogIHQuZ2h6c3F1YXJlID0gMHgzMzkzOwogIHQuZ2loaXJhZ2FuYSA9IDB4MzA0ZTsKICB0Lmdpa2F0YWthbmEgPSAweDMwYWU7CiAgdC5naW1hcm1lbmlhbiA9IDB4MDU2MzsKICB0LmdpbWVsID0gMHgwNWQyOwogIHQuZ2ltZWxkYWdlc2ggPSAweGZiMzI7CiAgdC5naW1lbGRhZ2VzaGhlYnJldyA9IDB4ZmIzMjsKICB0LmdpbWVsaGVicmV3ID0gMHgwNWQyOwogIHQuZ2plY3lyaWxsaWMgPSAweDA0NTM7CiAgdC5nbG90dGFsaW52ZXJ0ZWRzdHJva2UgPSAweDAxYmU7CiAgdC5nbG90dGFsc3RvcCA9IDB4MDI5NDsKICB0Lmdsb3R0YWxzdG9waW52ZXJ0ZWQgPSAweDAyOTY7CiAgdC5nbG90dGFsc3RvcG1vZCA9IDB4MDJjMDsKICB0Lmdsb3R0YWxzdG9wcmV2ZXJzZWQgPSAweDAyOTU7CiAgdC5nbG90dGFsc3RvcHJldmVyc2VkbW9kID0gMHgwMmMxOwogIHQuZ2xvdHRhbHN0b3ByZXZlcnNlZHN1cGVyaW9yID0gMHgwMmU0OwogIHQuZ2xvdHRhbHN0b3BzdHJva2UgPSAweDAyYTE7CiAgdC5nbG90dGFsc3RvcHN0cm9rZXJldmVyc2VkID0gMHgwMmEyOwogIHQuZ21hY3JvbiA9IDB4MWUyMTsKICB0Lmdtb25vc3BhY2UgPSAweGZmNDc7CiAgdC5nb2hpcmFnYW5hID0gMHgzMDU0OwogIHQuZ29rYXRha2FuYSA9IDB4MzBiNDsKICB0LmdwYXJlbiA9IDB4MjRhMjsKICB0LmdwYXNxdWFyZSA9IDB4MzNhYzsKICB0LmdyYWRpZW50ID0gMHgyMjA3OwogIHQuZ3JhdmUgPSAweDAwNjA7CiAgdC5ncmF2ZWJlbG93Y21iID0gMHgwMzE2OwogIHQuZ3JhdmVjbWIgPSAweDAzMDA7CiAgdC5ncmF2ZWNvbWIgPSAweDAzMDA7CiAgdC5ncmF2ZWRldmEgPSAweDA5NTM7CiAgdC5ncmF2ZWxvd21vZCA9IDB4MDJjZTsKICB0LmdyYXZlbW9ub3NwYWNlID0gMHhmZjQwOwogIHQuZ3JhdmV0b25lY21iID0gMHgwMzQwOwogIHQuZ3JlYXRlciA9IDB4MDAzZTsKICB0LmdyZWF0ZXJlcXVhbCA9IDB4MjI2NTsKICB0LmdyZWF0ZXJlcXVhbG9ybGVzcyA9IDB4MjJkYjsKICB0LmdyZWF0ZXJtb25vc3BhY2UgPSAweGZmMWU7CiAgdC5ncmVhdGVyb3JlcXVpdmFsZW50ID0gMHgyMjczOwogIHQuZ3JlYXRlcm9ybGVzcyA9IDB4MjI3NzsKICB0LmdyZWF0ZXJvdmVyZXF1YWwgPSAweDIyNjc7CiAgdC5ncmVhdGVyc21hbGwgPSAweGZlNjU7CiAgdC5nc2NyaXB0ID0gMHgwMjYxOwogIHQuZ3N0cm9rZSA9IDB4MDFlNTsKICB0Lmd1aGlyYWdhbmEgPSAweDMwNTA7CiAgdC5ndWlsbGVtb3RsZWZ0ID0gMHgwMGFiOwogIHQuZ3VpbGxlbW90cmlnaHQgPSAweDAwYmI7CiAgdC5ndWlsc2luZ2xsZWZ0ID0gMHgyMDM5OwogIHQuZ3VpbHNpbmdscmlnaHQgPSAweDIwM2E7CiAgdC5ndWthdGFrYW5hID0gMHgzMGIwOwogIHQuZ3VyYW11c3F1YXJlID0gMHgzMzE4OwogIHQuZ3lzcXVhcmUgPSAweDMzYzk7CiAgdC5oID0gMHgwMDY4OwogIHQuaGFhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRhOTsKICB0LmhhYWx0b25lYXJhYmljID0gMHgwNmMxOwogIHQuaGFiZW5nYWxpID0gMHgwOWI5OwogIHQuaGFkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRiMzsKICB0LmhhZGV2YSA9IDB4MDkzOTsKICB0LmhhZ3VqYXJhdGkgPSAweDBhYjk7CiAgdC5oYWd1cm11a2hpID0gMHgwYTM5OwogIHQuaGFoYXJhYmljID0gMHgwNjJkOwogIHQuaGFoZmluYWxhcmFiaWMgPSAweGZlYTI7CiAgdC5oYWhpbml0aWFsYXJhYmljID0gMHhmZWEzOwogIHQuaGFoaXJhZ2FuYSA9IDB4MzA2ZjsKICB0LmhhaG1lZGlhbGFyYWJpYyA9IDB4ZmVhNDsKICB0LmhhaXR1c3F1YXJlID0gMHgzMzJhOwogIHQuaGFrYXRha2FuYSA9IDB4MzBjZjsKICB0Lmhha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOGE7CiAgdC5oYWxhbnRndXJtdWtoaSA9IDB4MGE0ZDsKICB0LmhhbXphYXJhYmljID0gMHgwNjIxOwogIHQuaGFtemFsb3dhcmFiaWMgPSAweDA2MjE7CiAgdC5oYW5ndWxmaWxsZXIgPSAweDMxNjQ7CiAgdC5oYXJkc2lnbmN5cmlsbGljID0gMHgwNDRhOwogIHQuaGFycG9vbmxlZnRiYXJidXAgPSAweDIxYmM7CiAgdC5oYXJwb29ucmlnaHRiYXJidXAgPSAweDIxYzA7CiAgdC5oYXNxdWFyZSA9IDB4MzNjYTsKICB0LmhhdGFmcGF0YWggPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMTYgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMjMgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMmYgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoaGVicmV3ID0gMHgwNWIyOwogIHQuaGF0YWZwYXRhaG5hcnJvd2hlYnJldyA9IDB4MDViMjsKICB0LmhhdGFmcGF0YWhxdWFydGVyaGVicmV3ID0gMHgwNWIyOwogIHQuaGF0YWZwYXRhaHdpZGVoZWJyZXcgPSAweDA1YjI7CiAgdC5oYXRhZnFhbWF0cyA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzMWIgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0czI4ID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHMzNCA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzaGVicmV3ID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHNuYXJyb3doZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0c3F1YXJ0ZXJoZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0c3dpZGVoZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnNlZ29sID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDE3ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDI0ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDMwID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbGhlYnJldyA9IDB4MDViMTsKICB0LmhhdGFmc2Vnb2xuYXJyb3doZWJyZXcgPSAweDA1YjE7CiAgdC5oYXRhZnNlZ29scXVhcnRlcmhlYnJldyA9IDB4MDViMTsKICB0LmhhdGFmc2Vnb2x3aWRlaGVicmV3ID0gMHgwNWIxOwogIHQuaGJhciA9IDB4MDEyNzsKICB0Lmhib3BvbW9mbyA9IDB4MzEwZjsKICB0LmhicmV2ZWJlbG93ID0gMHgxZTJiOwogIHQuaGNlZGlsbGEgPSAweDFlMjk7CiAgdC5oY2lyY2xlID0gMHgyNGQ3OwogIHQuaGNpcmN1bWZsZXggPSAweDAxMjU7CiAgdC5oZGllcmVzaXMgPSAweDFlMjc7CiAgdC5oZG90YWNjZW50ID0gMHgxZTIzOwogIHQuaGRvdGJlbG93ID0gMHgxZTI1OwogIHQuaGUgPSAweDA1ZDQ7CiAgdC5oZWFydCA9IDB4MjY2NTsKICB0LmhlYXJ0c3VpdGJsYWNrID0gMHgyNjY1OwogIHQuaGVhcnRzdWl0d2hpdGUgPSAweDI2NjE7CiAgdC5oZWRhZ2VzaCA9IDB4ZmIzNDsKICB0LmhlZGFnZXNoaGVicmV3ID0gMHhmYjM0OwogIHQuaGVoYWx0b25lYXJhYmljID0gMHgwNmMxOwogIHQuaGVoYXJhYmljID0gMHgwNjQ3OwogIHQuaGVoZWJyZXcgPSAweDA1ZDQ7CiAgdC5oZWhmaW5hbGFsdG9uZWFyYWJpYyA9IDB4ZmJhNzsKICB0LmhlaGZpbmFsYWx0dHdvYXJhYmljID0gMHhmZWVhOwogIHQuaGVoZmluYWxhcmFiaWMgPSAweGZlZWE7CiAgdC5oZWhoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZiYTU7CiAgdC5oZWhoYW16YWFib3ZlaXNvbGF0ZWRhcmFiaWMgPSAweGZiYTQ7CiAgdC5oZWhpbml0aWFsYWx0b25lYXJhYmljID0gMHhmYmE4OwogIHQuaGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmVlYjsKICB0LmhlaGlyYWdhbmEgPSAweDMwNzg7CiAgdC5oZWhtZWRpYWxhbHRvbmVhcmFiaWMgPSAweGZiYTk7CiAgdC5oZWhtZWRpYWxhcmFiaWMgPSAweGZlZWM7CiAgdC5oZWlzZWllcmFzcXVhcmUgPSAweDMzN2I7CiAgdC5oZWthdGFrYW5hID0gMHgzMGQ4OwogIHQuaGVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4ZDsKICB0Lmhla3V0YWFydXNxdWFyZSA9IDB4MzMzNjsKICB0Lmhlbmdob29rID0gMHgwMjY3OwogIHQuaGVydXR1c3F1YXJlID0gMHgzMzM5OwogIHQuaGV0ID0gMHgwNWQ3OwogIHQuaGV0aGVicmV3ID0gMHgwNWQ3OwogIHQuaGhvb2sgPSAweDAyNjY7CiAgdC5oaG9va3N1cGVyaW9yID0gMHgwMmIxOwogIHQuaGlldWhhY2lyY2xla29yZWFuID0gMHgzMjdiOwogIHQuaGlldWhhcGFyZW5rb3JlYW4gPSAweDMyMWI7CiAgdC5oaWV1aGNpcmNsZWtvcmVhbiA9IDB4MzI2ZDsKICB0LmhpZXVoa29yZWFuID0gMHgzMTRlOwogIHQuaGlldWhwYXJlbmtvcmVhbiA9IDB4MzIwZDsKICB0LmhpaGlyYWdhbmEgPSAweDMwNzI7CiAgdC5oaWthdGFrYW5hID0gMHgzMGQyOwogIHQuaGlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4YjsKICB0LmhpcmlxID0gMHgwNWI0OwogIHQuaGlyaXExNCA9IDB4MDViNDsKICB0LmhpcmlxMjEgPSAweDA1YjQ7CiAgdC5oaXJpcTJkID0gMHgwNWI0OwogIHQuaGlyaXFoZWJyZXcgPSAweDA1YjQ7CiAgdC5oaXJpcW5hcnJvd2hlYnJldyA9IDB4MDViNDsKICB0LmhpcmlxcXVhcnRlcmhlYnJldyA9IDB4MDViNDsKICB0Lmhpcmlxd2lkZWhlYnJldyA9IDB4MDViNDsKICB0LmhsaW5lYmVsb3cgPSAweDFlOTY7CiAgdC5obW9ub3NwYWNlID0gMHhmZjQ4OwogIHQuaG9hcm1lbmlhbiA9IDB4MDU3MDsKICB0LmhvaGlwdGhhaSA9IDB4MGUyYjsKICB0LmhvaGlyYWdhbmEgPSAweDMwN2I7CiAgdC5ob2thdGFrYW5hID0gMHgzMGRiOwogIHQuaG9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4ZTsKICB0LmhvbGFtID0gMHgwNWI5OwogIHQuaG9sYW0xOSA9IDB4MDViOTsKICB0LmhvbGFtMjYgPSAweDA1Yjk7CiAgdC5ob2xhbTMyID0gMHgwNWI5OwogIHQuaG9sYW1oZWJyZXcgPSAweDA1Yjk7CiAgdC5ob2xhbW5hcnJvd2hlYnJldyA9IDB4MDViOTsKICB0LmhvbGFtcXVhcnRlcmhlYnJldyA9IDB4MDViOTsKICB0LmhvbGFtd2lkZWhlYnJldyA9IDB4MDViOTsKICB0Lmhvbm9raHVrdGhhaSA9IDB4MGUyZTsKICB0Lmhvb2thYm92ZWNvbWIgPSAweDAzMDk7CiAgdC5ob29rY21iID0gMHgwMzA5OwogIHQuaG9va3BhbGF0YWxpemVkYmVsb3djbWIgPSAweDAzMjE7CiAgdC5ob29rcmV0cm9mbGV4YmVsb3djbWIgPSAweDAzMjI7CiAgdC5ob29uc3F1YXJlID0gMHgzMzQyOwogIHQuaG9yaWNvcHRpYyA9IDB4MDNlOTsKICB0Lmhvcml6b250YWxiYXIgPSAweDIwMTU7CiAgdC5ob3JuY21iID0gMHgwMzFiOwogIHQuaG90c3ByaW5ncyA9IDB4MjY2ODsKICB0LmhvdXNlID0gMHgyMzAyOwogIHQuaHBhcmVuID0gMHgyNGEzOwogIHQuaHN1cGVyaW9yID0gMHgwMmIwOwogIHQuaHR1cm5lZCA9IDB4MDI2NTsKICB0Lmh1aGlyYWdhbmEgPSAweDMwNzU7CiAgdC5odWlpdG9zcXVhcmUgPSAweDMzMzM7CiAgdC5odWthdGFrYW5hID0gMHgzMGQ1OwogIHQuaHVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4YzsKICB0Lmh1bmdhcnVtbGF1dCA9IDB4MDJkZDsKICB0Lmh1bmdhcnVtbGF1dGNtYiA9IDB4MDMwYjsKICB0Lmh2ID0gMHgwMTk1OwogIHQuaHlwaGVuID0gMHgwMDJkOwogIHQuaHlwaGVuaW5mZXJpb3IgPSAweGY2ZTU7CiAgdC5oeXBoZW5tb25vc3BhY2UgPSAweGZmMGQ7CiAgdC5oeXBoZW5zbWFsbCA9IDB4ZmU2MzsKICB0Lmh5cGhlbnN1cGVyaW9yID0gMHhmNmU2OwogIHQuaHlwaGVudHdvID0gMHgyMDEwOwogIHQuaSA9IDB4MDA2OTsKICB0LmlhY3V0ZSA9IDB4MDBlZDsKICB0LmlhY3lyaWxsaWMgPSAweDA0NGY7CiAgdC5pYmVuZ2FsaSA9IDB4MDk4NzsKICB0Lmlib3BvbW9mbyA9IDB4MzEyNzsKICB0LmlicmV2ZSA9IDB4MDEyZDsKICB0LmljYXJvbiA9IDB4MDFkMDsKICB0LmljaXJjbGUgPSAweDI0ZDg7CiAgdC5pY2lyY3VtZmxleCA9IDB4MDBlZTsKICB0LmljeXJpbGxpYyA9IDB4MDQ1NjsKICB0LmlkYmxncmF2ZSA9IDB4MDIwOTsKICB0LmlkZW9ncmFwaGVhcnRoY2lyY2xlID0gMHgzMjhmOwogIHQuaWRlb2dyYXBoZmlyZWNpcmNsZSA9IDB4MzI4YjsKICB0LmlkZW9ncmFwaGljYWxsaWFuY2VwYXJlbiA9IDB4MzIzZjsKICB0LmlkZW9ncmFwaGljY2FsbHBhcmVuID0gMHgzMjNhOwogIHQuaWRlb2dyYXBoaWNjZW50cmVjaXJjbGUgPSAweDMyYTU7CiAgdC5pZGVvZ3JhcGhpY2Nsb3NlID0gMHgzMDA2OwogIHQuaWRlb2dyYXBoaWNjb21tYSA9IDB4MzAwMTsKICB0LmlkZW9ncmFwaGljY29tbWFsZWZ0ID0gMHhmZjY0OwogIHQuaWRlb2dyYXBoaWNjb25ncmF0dWxhdGlvbnBhcmVuID0gMHgzMjM3OwogIHQuaWRlb2dyYXBoaWNjb3JyZWN0Y2lyY2xlID0gMHgzMmEzOwogIHQuaWRlb2dyYXBoaWNlYXJ0aHBhcmVuID0gMHgzMjJmOwogIHQuaWRlb2dyYXBoaWNlbnRlcnByaXNlcGFyZW4gPSAweDMyM2Q7CiAgdC5pZGVvZ3JhcGhpY2V4Y2VsbGVudGNpcmNsZSA9IDB4MzI5ZDsKICB0LmlkZW9ncmFwaGljZmVzdGl2YWxwYXJlbiA9IDB4MzI0MDsKICB0LmlkZW9ncmFwaGljZmluYW5jaWFsY2lyY2xlID0gMHgzMjk2OwogIHQuaWRlb2dyYXBoaWNmaW5hbmNpYWxwYXJlbiA9IDB4MzIzNjsKICB0LmlkZW9ncmFwaGljZmlyZXBhcmVuID0gMHgzMjJiOwogIHQuaWRlb2dyYXBoaWNoYXZlcGFyZW4gPSAweDMyMzI7CiAgdC5pZGVvZ3JhcGhpY2hpZ2hjaXJjbGUgPSAweDMyYTQ7CiAgdC5pZGVvZ3JhcGhpY2l0ZXJhdGlvbm1hcmsgPSAweDMwMDU7CiAgdC5pZGVvZ3JhcGhpY2xhYm9yY2lyY2xlID0gMHgzMjk4OwogIHQuaWRlb2dyYXBoaWNsYWJvcnBhcmVuID0gMHgzMjM4OwogIHQuaWRlb2dyYXBoaWNsZWZ0Y2lyY2xlID0gMHgzMmE3OwogIHQuaWRlb2dyYXBoaWNsb3djaXJjbGUgPSAweDMyYTY7CiAgdC5pZGVvZ3JhcGhpY21lZGljaW5lY2lyY2xlID0gMHgzMmE5OwogIHQuaWRlb2dyYXBoaWNtZXRhbHBhcmVuID0gMHgzMjJlOwogIHQuaWRlb2dyYXBoaWNtb29ucGFyZW4gPSAweDMyMmE7CiAgdC5pZGVvZ3JhcGhpY25hbWVwYXJlbiA9IDB4MzIzNDsKICB0LmlkZW9ncmFwaGljcGVyaW9kID0gMHgzMDAyOwogIHQuaWRlb2dyYXBoaWNwcmludGNpcmNsZSA9IDB4MzI5ZTsKICB0LmlkZW9ncmFwaGljcmVhY2hwYXJlbiA9IDB4MzI0MzsKICB0LmlkZW9ncmFwaGljcmVwcmVzZW50cGFyZW4gPSAweDMyMzk7CiAgdC5pZGVvZ3JhcGhpY3Jlc291cmNlcGFyZW4gPSAweDMyM2U7CiAgdC5pZGVvZ3JhcGhpY3JpZ2h0Y2lyY2xlID0gMHgzMmE4OwogIHQuaWRlb2dyYXBoaWNzZWNyZXRjaXJjbGUgPSAweDMyOTk7CiAgdC5pZGVvZ3JhcGhpY3NlbGZwYXJlbiA9IDB4MzI0MjsKICB0LmlkZW9ncmFwaGljc29jaWV0eXBhcmVuID0gMHgzMjMzOwogIHQuaWRlb2dyYXBoaWNzcGFjZSA9IDB4MzAwMDsKICB0LmlkZW9ncmFwaGljc3BlY2lhbHBhcmVuID0gMHgzMjM1OwogIHQuaWRlb2dyYXBoaWNzdG9ja3BhcmVuID0gMHgzMjMxOwogIHQuaWRlb2dyYXBoaWNzdHVkeXBhcmVuID0gMHgzMjNiOwogIHQuaWRlb2dyYXBoaWNzdW5wYXJlbiA9IDB4MzIzMDsKICB0LmlkZW9ncmFwaGljc3VwZXJ2aXNlcGFyZW4gPSAweDMyM2M7CiAgdC5pZGVvZ3JhcGhpY3dhdGVycGFyZW4gPSAweDMyMmM7CiAgdC5pZGVvZ3JhcGhpY3dvb2RwYXJlbiA9IDB4MzIyZDsKICB0LmlkZW9ncmFwaGljemVybyA9IDB4MzAwNzsKICB0LmlkZW9ncmFwaG1ldGFsY2lyY2xlID0gMHgzMjhlOwogIHQuaWRlb2dyYXBobW9vbmNpcmNsZSA9IDB4MzI4YTsKICB0LmlkZW9ncmFwaG5hbWVjaXJjbGUgPSAweDMyOTQ7CiAgdC5pZGVvZ3JhcGhzdW5jaXJjbGUgPSAweDMyOTA7CiAgdC5pZGVvZ3JhcGh3YXRlcmNpcmNsZSA9IDB4MzI4YzsKICB0LmlkZW9ncmFwaHdvb2RjaXJjbGUgPSAweDMyOGQ7CiAgdC5pZGV2YSA9IDB4MDkwNzsKICB0LmlkaWVyZXNpcyA9IDB4MDBlZjsKICB0LmlkaWVyZXNpc2FjdXRlID0gMHgxZTJmOwogIHQuaWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZTU7CiAgdC5pZG90YmVsb3cgPSAweDFlY2I7CiAgdC5pZWJyZXZlY3lyaWxsaWMgPSAweDA0ZDc7CiAgdC5pZWN5cmlsbGljID0gMHgwNDM1OwogIHQuaWV1bmdhY2lyY2xla29yZWFuID0gMHgzMjc1OwogIHQuaWV1bmdhcGFyZW5rb3JlYW4gPSAweDMyMTU7CiAgdC5pZXVuZ2NpcmNsZWtvcmVhbiA9IDB4MzI2NzsKICB0LmlldW5na29yZWFuID0gMHgzMTQ3OwogIHQuaWV1bmdwYXJlbmtvcmVhbiA9IDB4MzIwNzsKICB0LmlncmF2ZSA9IDB4MDBlYzsKICB0LmlndWphcmF0aSA9IDB4MGE4NzsKICB0LmlndXJtdWtoaSA9IDB4MGEwNzsKICB0LmloaXJhZ2FuYSA9IDB4MzA0NDsKICB0Lmlob29rYWJvdmUgPSAweDFlYzk7CiAgdC5paWJlbmdhbGkgPSAweDA5ODg7CiAgdC5paWN5cmlsbGljID0gMHgwNDM4OwogIHQuaWlkZXZhID0gMHgwOTA4OwogIHQuaWlndWphcmF0aSA9IDB4MGE4ODsKICB0LmlpZ3VybXVraGkgPSAweDBhMDg7CiAgdC5paW1hdHJhZ3VybXVraGkgPSAweDBhNDA7CiAgdC5paW52ZXJ0ZWRicmV2ZSA9IDB4MDIwYjsKICB0Lmlpc2hvcnRjeXJpbGxpYyA9IDB4MDQzOTsKICB0Lmlpdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljMDsKICB0Lmlpdm93ZWxzaWduZGV2YSA9IDB4MDk0MDsKICB0Lmlpdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzA7CiAgdC5paiA9IDB4MDEzMzsKICB0LmlrYXRha2FuYSA9IDB4MzBhNDsKICB0LmlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3MjsKICB0Lmlrb3JlYW4gPSAweDMxNjM7CiAgdC5pbGRlID0gMHgwMmRjOwogIHQuaWx1eWhlYnJldyA9IDB4MDVhYzsKICB0LmltYWNyb24gPSAweDAxMmI7CiAgdC5pbWFjcm9uY3lyaWxsaWMgPSAweDA0ZTM7CiAgdC5pbWFnZW9yYXBwcm94aW1hdGVseWVxdWFsID0gMHgyMjUzOwogIHQuaW1hdHJhZ3VybXVraGkgPSAweDBhM2Y7CiAgdC5pbW9ub3NwYWNlID0gMHhmZjQ5OwogIHQuaW5jcmVtZW50ID0gMHgyMjA2OwogIHQuaW5maW5pdHkgPSAweDIyMWU7CiAgdC5pbmlhcm1lbmlhbiA9IDB4MDU2YjsKICB0LmludGVncmFsID0gMHgyMjJiOwogIHQuaW50ZWdyYWxib3R0b20gPSAweDIzMjE7CiAgdC5pbnRlZ3JhbGJ0ID0gMHgyMzIxOwogIHQuaW50ZWdyYWxleCA9IDB4ZjhmNTsKICB0LmludGVncmFsdG9wID0gMHgyMzIwOwogIHQuaW50ZWdyYWx0cCA9IDB4MjMyMDsKICB0LmludGVyc2VjdGlvbiA9IDB4MjIyOTsKICB0LmludGlzcXVhcmUgPSAweDMzMDU7CiAgdC5pbnZidWxsZXQgPSAweDI1ZDg7CiAgdC5pbnZjaXJjbGUgPSAweDI1ZDk7CiAgdC5pbnZzbWlsZWZhY2UgPSAweDI2M2I7CiAgdC5pb2N5cmlsbGljID0gMHgwNDUxOwogIHQuaW9nb25layA9IDB4MDEyZjsKICB0LmlvdGEgPSAweDAzYjk7CiAgdC5pb3RhZGllcmVzaXMgPSAweDAzY2E7CiAgdC5pb3RhZGllcmVzaXN0b25vcyA9IDB4MDM5MDsKICB0LmlvdGFsYXRpbiA9IDB4MDI2OTsKICB0LmlvdGF0b25vcyA9IDB4MDNhZjsKICB0LmlwYXJlbiA9IDB4MjRhNDsKICB0LmlyaWd1cm11a2hpID0gMHgwYTcyOwogIHQuaXNtYWxsaGlyYWdhbmEgPSAweDMwNDM7CiAgdC5pc21hbGxrYXRha2FuYSA9IDB4MzBhMzsKICB0LmlzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjY4OwogIHQuaXNzaGFyYmVuZ2FsaSA9IDB4MDlmYTsKICB0LmlzdHJva2UgPSAweDAyNjg7CiAgdC5pc3VwZXJpb3IgPSAweGY2ZWQ7CiAgdC5pdGVyYXRpb25oaXJhZ2FuYSA9IDB4MzA5ZDsKICB0Lml0ZXJhdGlvbmthdGFrYW5hID0gMHgzMGZkOwogIHQuaXRpbGRlID0gMHgwMTI5OwogIHQuaXRpbGRlYmVsb3cgPSAweDFlMmQ7CiAgdC5pdWJvcG9tb2ZvID0gMHgzMTI5OwogIHQuaXVjeXJpbGxpYyA9IDB4MDQ0ZTsKICB0Lml2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWJmOwogIHQuaXZvd2Vsc2lnbmRldmEgPSAweDA5M2Y7CiAgdC5pdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYmY7CiAgdC5pemhpdHNhY3lyaWxsaWMgPSAweDA0NzU7CiAgdC5pemhpdHNhZGJsZ3JhdmVjeXJpbGxpYyA9IDB4MDQ3NzsKICB0LmogPSAweDAwNmE7CiAgdC5qYWFybWVuaWFuID0gMHgwNTcxOwogIHQuamFiZW5nYWxpID0gMHgwOTljOwogIHQuamFkZXZhID0gMHgwOTFjOwogIHQuamFndWphcmF0aSA9IDB4MGE5YzsKICB0LmphZ3VybXVraGkgPSAweDBhMWM7CiAgdC5qYm9wb21vZm8gPSAweDMxMTA7CiAgdC5qY2Fyb24gPSAweDAxZjA7CiAgdC5qY2lyY2xlID0gMHgyNGQ5OwogIHQuamNpcmN1bWZsZXggPSAweDAxMzU7CiAgdC5qY3Jvc3NlZHRhaWwgPSAweDAyOWQ7CiAgdC5qZG90bGVzc3N0cm9rZSA9IDB4MDI1ZjsKICB0LmplY3lyaWxsaWMgPSAweDA0NTg7CiAgdC5qZWVtYXJhYmljID0gMHgwNjJjOwogIHQuamVlbWZpbmFsYXJhYmljID0gMHhmZTllOwogIHQuamVlbWluaXRpYWxhcmFiaWMgPSAweGZlOWY7CiAgdC5qZWVtbWVkaWFsYXJhYmljID0gMHhmZWEwOwogIHQuamVoYXJhYmljID0gMHgwNjk4OwogIHQuamVoZmluYWxhcmFiaWMgPSAweGZiOGI7CiAgdC5qaGFiZW5nYWxpID0gMHgwOTlkOwogIHQuamhhZGV2YSA9IDB4MDkxZDsKICB0LmpoYWd1amFyYXRpID0gMHgwYTlkOwogIHQuamhhZ3VybXVraGkgPSAweDBhMWQ7CiAgdC5qaGVoYXJtZW5pYW4gPSAweDA1N2I7CiAgdC5qaXMgPSAweDMwMDQ7CiAgdC5qbW9ub3NwYWNlID0gMHhmZjRhOwogIHQuanBhcmVuID0gMHgyNGE1OwogIHQuanN1cGVyaW9yID0gMHgwMmIyOwogIHQuayA9IDB4MDA2YjsKICB0LmthYmFzaGtpcmN5cmlsbGljID0gMHgwNGExOwogIHQua2FiZW5nYWxpID0gMHgwOTk1OwogIHQua2FjdXRlID0gMHgxZTMxOwogIHQua2FjeXJpbGxpYyA9IDB4MDQzYTsKICB0LmthZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OWI7CiAgdC5rYWRldmEgPSAweDA5MTU7CiAgdC5rYWYgPSAweDA1ZGI7CiAgdC5rYWZhcmFiaWMgPSAweDA2NDM7CiAgdC5rYWZkYWdlc2ggPSAweGZiM2I7CiAgdC5rYWZkYWdlc2hoZWJyZXcgPSAweGZiM2I7CiAgdC5rYWZmaW5hbGFyYWJpYyA9IDB4ZmVkYTsKICB0LmthZmhlYnJldyA9IDB4MDVkYjsKICB0LmthZmluaXRpYWxhcmFiaWMgPSAweGZlZGI7CiAgdC5rYWZtZWRpYWxhcmFiaWMgPSAweGZlZGM7CiAgdC5rYWZyYWZlaGVicmV3ID0gMHhmYjRkOwogIHQua2FndWphcmF0aSA9IDB4MGE5NTsKICB0LmthZ3VybXVraGkgPSAweDBhMTU7CiAgdC5rYWhpcmFnYW5hID0gMHgzMDRiOwogIHQua2Fob29rY3lyaWxsaWMgPSAweDA0YzQ7CiAgdC5rYWthdGFrYW5hID0gMHgzMGFiOwogIHQua2FrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3NjsKICB0LmthcHBhID0gMHgwM2JhOwogIHQua2FwcGFzeW1ib2xncmVlayA9IDB4MDNmMDsKICB0LmthcHllb3VubWlldW1rb3JlYW4gPSAweDMxNzE7CiAgdC5rYXB5ZW91bnBoaWV1cGhrb3JlYW4gPSAweDMxODQ7CiAgdC5rYXB5ZW91bnBpZXVwa29yZWFuID0gMHgzMTc4OwogIHQua2FweWVvdW5zc2FuZ3BpZXVwa29yZWFuID0gMHgzMTc5OwogIHQua2Fyb3JpaXNxdWFyZSA9IDB4MzMwZDsKICB0Lmthc2hpZGFhdXRvYXJhYmljID0gMHgwNjQwOwogIHQua2FzaGlkYWF1dG9ub3NpZGViZWFyaW5nYXJhYmljID0gMHgwNjQwOwogIHQua2FzbWFsbGthdGFrYW5hID0gMHgzMGY1OwogIHQua2FzcXVhcmUgPSAweDMzODQ7CiAgdC5rYXNyYWFyYWJpYyA9IDB4MDY1MDsKICB0Lmthc3JhdGFuYXJhYmljID0gMHgwNjRkOwogIHQua2FzdHJva2VjeXJpbGxpYyA9IDB4MDQ5ZjsKICB0LmthdGFoaXJhcHJvbG9uZ21hcmtoYWxmd2lkdGggPSAweGZmNzA7CiAgdC5rYXZlcnRpY2Fsc3Ryb2tlY3lyaWxsaWMgPSAweDA0OWQ7CiAgdC5rYm9wb21vZm8gPSAweDMxMGU7CiAgdC5rY2Fsc3F1YXJlID0gMHgzMzg5OwogIHQua2Nhcm9uID0gMHgwMWU5OwogIHQua2NlZGlsbGEgPSAweDAxMzc7CiAgdC5rY2lyY2xlID0gMHgyNGRhOwogIHQua2NvbW1hYWNjZW50ID0gMHgwMTM3OwogIHQua2RvdGJlbG93ID0gMHgxZTMzOwogIHQua2VoYXJtZW5pYW4gPSAweDA1ODQ7CiAgdC5rZWhpcmFnYW5hID0gMHgzMDUxOwogIHQua2VrYXRha2FuYSA9IDB4MzBiMTsKICB0Lmtla2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzk7CiAgdC5rZW5hcm1lbmlhbiA9IDB4MDU2ZjsKICB0Lmtlc21hbGxrYXRha2FuYSA9IDB4MzBmNjsKICB0LmtncmVlbmxhbmRpYyA9IDB4MDEzODsKICB0LmtoYWJlbmdhbGkgPSAweDA5OTY7CiAgdC5raGFjeXJpbGxpYyA9IDB4MDQ0NTsKICB0LmtoYWRldmEgPSAweDA5MTY7CiAgdC5raGFndWphcmF0aSA9IDB4MGE5NjsKICB0LmtoYWd1cm11a2hpID0gMHgwYTE2OwogIHQua2hhaGFyYWJpYyA9IDB4MDYyZTsKICB0LmtoYWhmaW5hbGFyYWJpYyA9IDB4ZmVhNjsKICB0LmtoYWhpbml0aWFsYXJhYmljID0gMHhmZWE3OwogIHQua2hhaG1lZGlhbGFyYWJpYyA9IDB4ZmVhODsKICB0LmtoZWljb3B0aWMgPSAweDAzZTc7CiAgdC5raGhhZGV2YSA9IDB4MDk1OTsKICB0LmtoaGFndXJtdWtoaSA9IDB4MGE1OTsKICB0LmtoaWV1a2hhY2lyY2xla29yZWFuID0gMHgzMjc4OwogIHQua2hpZXVraGFwYXJlbmtvcmVhbiA9IDB4MzIxODsKICB0LmtoaWV1a2hjaXJjbGVrb3JlYW4gPSAweDMyNmE7CiAgdC5raGlldWtoa29yZWFuID0gMHgzMTRiOwogIHQua2hpZXVraHBhcmVua29yZWFuID0gMHgzMjBhOwogIHQua2hva2hhaXRoYWkgPSAweDBlMDI7CiAgdC5raG9raG9udGhhaSA9IDB4MGUwNTsKICB0Lmtob2todWF0dGhhaSA9IDB4MGUwMzsKICB0Lmtob2tod2FpdGhhaSA9IDB4MGUwNDsKICB0Lmtob211dHRoYWkgPSAweDBlNWI7CiAgdC5raG9vayA9IDB4MDE5OTsKICB0Lmtob3Jha2hhbmd0aGFpID0gMHgwZTA2OwogIHQua2h6c3F1YXJlID0gMHgzMzkxOwogIHQua2loaXJhZ2FuYSA9IDB4MzA0ZDsKICB0Lmtpa2F0YWthbmEgPSAweDMwYWQ7CiAgdC5raWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc3OwogIHQua2lyb2d1cmFtdXNxdWFyZSA9IDB4MzMxNTsKICB0Lmtpcm9tZWV0b3J1c3F1YXJlID0gMHgzMzE2OwogIHQua2lyb3NxdWFyZSA9IDB4MzMxNDsKICB0LmtpeWVva2FjaXJjbGVrb3JlYW4gPSAweDMyNmU7CiAgdC5raXllb2thcGFyZW5rb3JlYW4gPSAweDMyMGU7CiAgdC5raXllb2tjaXJjbGVrb3JlYW4gPSAweDMyNjA7CiAgdC5raXllb2trb3JlYW4gPSAweDMxMzE7CiAgdC5raXllb2twYXJlbmtvcmVhbiA9IDB4MzIwMDsKICB0LmtpeWVva3Npb3Nrb3JlYW4gPSAweDMxMzM7CiAgdC5ramVjeXJpbGxpYyA9IDB4MDQ1YzsKICB0LmtsaW5lYmVsb3cgPSAweDFlMzU7CiAgdC5rbHNxdWFyZSA9IDB4MzM5ODsKICB0LmttY3ViZWRzcXVhcmUgPSAweDMzYTY7CiAgdC5rbW9ub3NwYWNlID0gMHhmZjRiOwogIHQua21zcXVhcmVkc3F1YXJlID0gMHgzM2EyOwogIHQua29oaXJhZ2FuYSA9IDB4MzA1MzsKICB0LmtvaG1zcXVhcmUgPSAweDMzYzA7CiAgdC5rb2thaXRoYWkgPSAweDBlMDE7CiAgdC5rb2thdGFrYW5hID0gMHgzMGIzOwogIHQua29rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3YTsKICB0Lmtvb3Bvc3F1YXJlID0gMHgzMzFlOwogIHQua29wcGFjeXJpbGxpYyA9IDB4MDQ4MTsKICB0LmtvcmVhbnN0YW5kYXJkc3ltYm9sID0gMHgzMjdmOwogIHQua29yb25pc2NtYiA9IDB4MDM0MzsKICB0LmtwYXJlbiA9IDB4MjRhNjsKICB0LmtwYXNxdWFyZSA9IDB4MzNhYTsKICB0LmtzaWN5cmlsbGljID0gMHgwNDZmOwogIHQua3RzcXVhcmUgPSAweDMzY2Y7CiAgdC5rdHVybmVkID0gMHgwMjllOwogIHQua3VoaXJhZ2FuYSA9IDB4MzA0ZjsKICB0Lmt1a2F0YWthbmEgPSAweDMwYWY7CiAgdC5rdWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc4OwogIHQua3ZzcXVhcmUgPSAweDMzYjg7CiAgdC5rd3NxdWFyZSA9IDB4MzNiZTsKICB0LmwgPSAweDAwNmM7CiAgdC5sYWJlbmdhbGkgPSAweDA5YjI7CiAgdC5sYWN1dGUgPSAweDAxM2E7CiAgdC5sYWRldmEgPSAweDA5MzI7CiAgdC5sYWd1amFyYXRpID0gMHgwYWIyOwogIHQubGFndXJtdWtoaSA9IDB4MGEzMjsKICB0Lmxha2toYW5neWFvdGhhaSA9IDB4MGU0NTsKICB0LmxhbWFsZWZmaW5hbGFyYWJpYyA9IDB4ZmVmYzsKICB0LmxhbWFsZWZoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZlZjg7CiAgdC5sYW1hbGVmaGFtemFhYm92ZWlzb2xhdGVkYXJhYmljID0gMHhmZWY3OwogIHQubGFtYWxlZmhhbXphYmVsb3dmaW5hbGFyYWJpYyA9IDB4ZmVmYTsKICB0LmxhbWFsZWZoYW16YWJlbG93aXNvbGF0ZWRhcmFiaWMgPSAweGZlZjk7CiAgdC5sYW1hbGVmaXNvbGF0ZWRhcmFiaWMgPSAweGZlZmI7CiAgdC5sYW1hbGVmbWFkZGFhYm92ZWZpbmFsYXJhYmljID0gMHhmZWY2OwogIHQubGFtYWxlZm1hZGRhYWJvdmVpc29sYXRlZGFyYWJpYyA9IDB4ZmVmNTsKICB0LmxhbWFyYWJpYyA9IDB4MDY0NDsKICB0LmxhbWJkYSA9IDB4MDNiYjsKICB0LmxhbWJkYXN0cm9rZSA9IDB4MDE5YjsKICB0LmxhbWVkID0gMHgwNWRjOwogIHQubGFtZWRkYWdlc2ggPSAweGZiM2M7CiAgdC5sYW1lZGRhZ2VzaGhlYnJldyA9IDB4ZmIzYzsKICB0LmxhbWVkaGVicmV3ID0gMHgwNWRjOwogIHQubGFtZmluYWxhcmFiaWMgPSAweGZlZGU7CiAgdC5sYW1oYWhpbml0aWFsYXJhYmljID0gMHhmY2NhOwogIHQubGFtaW5pdGlhbGFyYWJpYyA9IDB4ZmVkZjsKICB0LmxhbWplZW1pbml0aWFsYXJhYmljID0gMHhmY2M5OwogIHQubGFta2hhaGluaXRpYWxhcmFiaWMgPSAweGZjY2I7CiAgdC5sYW1sYW1oZWhpc29sYXRlZGFyYWJpYyA9IDB4ZmRmMjsKICB0LmxhbW1lZGlhbGFyYWJpYyA9IDB4ZmVlMDsKICB0LmxhbW1lZW1oYWhpbml0aWFsYXJhYmljID0gMHhmZDg4OwogIHQubGFtbWVlbWluaXRpYWxhcmFiaWMgPSAweGZjY2M7CiAgdC5sYXJnZWNpcmNsZSA9IDB4MjVlZjsKICB0LmxiYXIgPSAweDAxOWE7CiAgdC5sYmVsdCA9IDB4MDI2YzsKICB0Lmxib3BvbW9mbyA9IDB4MzEwYzsKICB0LmxjYXJvbiA9IDB4MDEzZTsKICB0LmxjZWRpbGxhID0gMHgwMTNjOwogIHQubGNpcmNsZSA9IDB4MjRkYjsKICB0LmxjaXJjdW1mbGV4YmVsb3cgPSAweDFlM2Q7CiAgdC5sY29tbWFhY2NlbnQgPSAweDAxM2M7CiAgdC5sZG90ID0gMHgwMTQwOwogIHQubGRvdGFjY2VudCA9IDB4MDE0MDsKICB0Lmxkb3RiZWxvdyA9IDB4MWUzNzsKICB0Lmxkb3RiZWxvd21hY3JvbiA9IDB4MWUzOTsKICB0LmxlZnRhbmdsZWFib3ZlY21iID0gMHgwMzFhOwogIHQubGVmdHRhY2tiZWxvd2NtYiA9IDB4MDMxODsKICB0Lmxlc3MgPSAweDAwM2M7CiAgdC5sZXNzZXF1YWwgPSAweDIyNjQ7CiAgdC5sZXNzZXF1YWxvcmdyZWF0ZXIgPSAweDIyZGE7CiAgdC5sZXNzbW9ub3NwYWNlID0gMHhmZjFjOwogIHQubGVzc29yZXF1aXZhbGVudCA9IDB4MjI3MjsKICB0Lmxlc3NvcmdyZWF0ZXIgPSAweDIyNzY7CiAgdC5sZXNzb3ZlcmVxdWFsID0gMHgyMjY2OwogIHQubGVzc3NtYWxsID0gMHhmZTY0OwogIHQubGV6aCA9IDB4MDI2ZTsKICB0LmxmYmxvY2sgPSAweDI1OGM7CiAgdC5saG9va3JldHJvZmxleCA9IDB4MDI2ZDsKICB0LmxpcmEgPSAweDIwYTQ7CiAgdC5saXduYXJtZW5pYW4gPSAweDA1NmM7CiAgdC5saiA9IDB4MDFjOTsKICB0LmxqZWN5cmlsbGljID0gMHgwNDU5OwogIHQubGwgPSAweGY2YzA7CiAgdC5sbGFkZXZhID0gMHgwOTMzOwogIHQubGxhZ3VqYXJhdGkgPSAweDBhYjM7CiAgdC5sbGluZWJlbG93ID0gMHgxZTNiOwogIHQubGxsYWRldmEgPSAweDA5MzQ7CiAgdC5sbHZvY2FsaWNiZW5nYWxpID0gMHgwOWUxOwogIHQubGx2b2NhbGljZGV2YSA9IDB4MDk2MTsKICB0Lmxsdm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5ZTM7CiAgdC5sbHZvY2FsaWN2b3dlbHNpZ25kZXZhID0gMHgwOTYzOwogIHQubG1pZGRsZXRpbGRlID0gMHgwMjZiOwogIHQubG1vbm9zcGFjZSA9IDB4ZmY0YzsKICB0Lmxtc3F1YXJlID0gMHgzM2QwOwogIHQubG9jaHVsYXRoYWkgPSAweDBlMmM7CiAgdC5sb2dpY2FsYW5kID0gMHgyMjI3OwogIHQubG9naWNhbG5vdCA9IDB4MDBhYzsKICB0LmxvZ2ljYWxub3RyZXZlcnNlZCA9IDB4MjMxMDsKICB0LmxvZ2ljYWxvciA9IDB4MjIyODsKICB0LmxvbGluZ3RoYWkgPSAweDBlMjU7CiAgdC5sb25ncyA9IDB4MDE3ZjsKICB0Lmxvd2xpbmVjZW50ZXJsaW5lID0gMHhmZTRlOwogIHQubG93bGluZWNtYiA9IDB4MDMzMjsKICB0Lmxvd2xpbmVkYXNoZWQgPSAweGZlNGQ7CiAgdC5sb3plbmdlID0gMHgyNWNhOwogIHQubHBhcmVuID0gMHgyNGE3OwogIHQubHNsYXNoID0gMHgwMTQyOwogIHQubHNxdWFyZSA9IDB4MjExMzsKICB0LmxzdXBlcmlvciA9IDB4ZjZlZTsKICB0Lmx0c2hhZGUgPSAweDI1OTE7CiAgdC5sdXRoYWkgPSAweDBlMjY7CiAgdC5sdm9jYWxpY2JlbmdhbGkgPSAweDA5OGM7CiAgdC5sdm9jYWxpY2RldmEgPSAweDA5MGM7CiAgdC5sdm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5ZTI7CiAgdC5sdm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NjI7CiAgdC5seHNxdWFyZSA9IDB4MzNkMzsKICB0Lm0gPSAweDAwNmQ7CiAgdC5tYWJlbmdhbGkgPSAweDA5YWU7CiAgdC5tYWNyb24gPSAweDAwYWY7CiAgdC5tYWNyb25iZWxvd2NtYiA9IDB4MDMzMTsKICB0Lm1hY3JvbmNtYiA9IDB4MDMwNDsKICB0Lm1hY3Jvbmxvd21vZCA9IDB4MDJjZDsKICB0Lm1hY3Jvbm1vbm9zcGFjZSA9IDB4ZmZlMzsKICB0Lm1hY3V0ZSA9IDB4MWUzZjsKICB0Lm1hZGV2YSA9IDB4MDkyZTsKICB0Lm1hZ3VqYXJhdGkgPSAweDBhYWU7CiAgdC5tYWd1cm11a2hpID0gMHgwYTJlOwogIHQubWFoYXBha2hoZWJyZXcgPSAweDA1YTQ7CiAgdC5tYWhhcGFraGxlZnRoZWJyZXcgPSAweDA1YTQ7CiAgdC5tYWhpcmFnYW5hID0gMHgzMDdlOwogIHQubWFpY2hhdHRhd2Fsb3dsZWZ0dGhhaSA9IDB4Zjg5NTsKICB0Lm1haWNoYXR0YXdhbG93cmlnaHR0aGFpID0gMHhmODk0OwogIHQubWFpY2hhdHRhd2F0aGFpID0gMHgwZTRiOwogIHQubWFpY2hhdHRhd2F1cHBlcmxlZnR0aGFpID0gMHhmODkzOwogIHQubWFpZWtsb3dsZWZ0dGhhaSA9IDB4Zjg4YzsKICB0Lm1haWVrbG93cmlnaHR0aGFpID0gMHhmODhiOwogIHQubWFpZWt0aGFpID0gMHgwZTQ4OwogIHQubWFpZWt1cHBlcmxlZnR0aGFpID0gMHhmODhhOwogIHQubWFpaGFuYWthdGxlZnR0aGFpID0gMHhmODg0OwogIHQubWFpaGFuYWthdHRoYWkgPSAweDBlMzE7CiAgdC5tYWl0YWlraHVsZWZ0dGhhaSA9IDB4Zjg4OTsKICB0Lm1haXRhaWtodXRoYWkgPSAweDBlNDc7CiAgdC5tYWl0aG9sb3dsZWZ0dGhhaSA9IDB4Zjg4ZjsKICB0Lm1haXRob2xvd3JpZ2h0dGhhaSA9IDB4Zjg4ZTsKICB0Lm1haXRob3RoYWkgPSAweDBlNDk7CiAgdC5tYWl0aG91cHBlcmxlZnR0aGFpID0gMHhmODhkOwogIHQubWFpdHJpbG93bGVmdHRoYWkgPSAweGY4OTI7CiAgdC5tYWl0cmlsb3dyaWdodHRoYWkgPSAweGY4OTE7CiAgdC5tYWl0cml0aGFpID0gMHgwZTRhOwogIHQubWFpdHJpdXBwZXJsZWZ0dGhhaSA9IDB4Zjg5MDsKICB0Lm1haXlhbW9rdGhhaSA9IDB4MGU0NjsKICB0Lm1ha2F0YWthbmEgPSAweDMwZGU7CiAgdC5tYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjhmOwogIHQubWFsZSA9IDB4MjY0MjsKICB0Lm1hbnN5b25zcXVhcmUgPSAweDMzNDc7CiAgdC5tYXFhZmhlYnJldyA9IDB4MDViZTsKICB0Lm1hcnMgPSAweDI2NDI7CiAgdC5tYXNvcmFjaXJjbGVoZWJyZXcgPSAweDA1YWY7CiAgdC5tYXNxdWFyZSA9IDB4MzM4MzsKICB0Lm1ib3BvbW9mbyA9IDB4MzEwNzsKICB0Lm1ic3F1YXJlID0gMHgzM2Q0OwogIHQubWNpcmNsZSA9IDB4MjRkYzsKICB0Lm1jdWJlZHNxdWFyZSA9IDB4MzNhNTsKICB0Lm1kb3RhY2NlbnQgPSAweDFlNDE7CiAgdC5tZG90YmVsb3cgPSAweDFlNDM7CiAgdC5tZWVtYXJhYmljID0gMHgwNjQ1OwogIHQubWVlbWZpbmFsYXJhYmljID0gMHhmZWUyOwogIHQubWVlbWluaXRpYWxhcmFiaWMgPSAweGZlZTM7CiAgdC5tZWVtbWVkaWFsYXJhYmljID0gMHhmZWU0OwogIHQubWVlbW1lZW1pbml0aWFsYXJhYmljID0gMHhmY2QxOwogIHQubWVlbW1lZW1pc29sYXRlZGFyYWJpYyA9IDB4ZmM0ODsKICB0Lm1lZXRvcnVzcXVhcmUgPSAweDMzNGQ7CiAgdC5tZWhpcmFnYW5hID0gMHgzMDgxOwogIHQubWVpemllcmFzcXVhcmUgPSAweDMzN2U7CiAgdC5tZWthdGFrYW5hID0gMHgzMGUxOwogIHQubWVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5MjsKICB0Lm1lbSA9IDB4MDVkZTsKICB0Lm1lbWRhZ2VzaCA9IDB4ZmIzZTsKICB0Lm1lbWRhZ2VzaGhlYnJldyA9IDB4ZmIzZTsKICB0Lm1lbWhlYnJldyA9IDB4MDVkZTsKICB0Lm1lbmFybWVuaWFuID0gMHgwNTc0OwogIHQubWVya2hhaGVicmV3ID0gMHgwNWE1OwogIHQubWVya2hha2VmdWxhaGVicmV3ID0gMHgwNWE2OwogIHQubWVya2hha2VmdWxhbGVmdGhlYnJldyA9IDB4MDVhNjsKICB0Lm1lcmtoYWxlZnRoZWJyZXcgPSAweDA1YTU7CiAgdC5taG9vayA9IDB4MDI3MTsKICB0Lm1oenNxdWFyZSA9IDB4MzM5MjsKICB0Lm1pZGRsZWRvdGthdGFrYW5haGFsZndpZHRoID0gMHhmZjY1OwogIHQubWlkZG90ID0gMHgwMGI3OwogIHQubWlldW1hY2lyY2xla29yZWFuID0gMHgzMjcyOwogIHQubWlldW1hcGFyZW5rb3JlYW4gPSAweDMyMTI7CiAgdC5taWV1bWNpcmNsZWtvcmVhbiA9IDB4MzI2NDsKICB0Lm1pZXVta29yZWFuID0gMHgzMTQxOwogIHQubWlldW1wYW5zaW9za29yZWFuID0gMHgzMTcwOwogIHQubWlldW1wYXJlbmtvcmVhbiA9IDB4MzIwNDsKICB0Lm1pZXVtcGlldXBrb3JlYW4gPSAweDMxNmU7CiAgdC5taWV1bXNpb3Nrb3JlYW4gPSAweDMxNmY7CiAgdC5taWhpcmFnYW5hID0gMHgzMDdmOwogIHQubWlrYXRha2FuYSA9IDB4MzBkZjsKICB0Lm1pa2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTA7CiAgdC5taW51cyA9IDB4MjIxMjsKICB0Lm1pbnVzYmVsb3djbWIgPSAweDAzMjA7CiAgdC5taW51c2NpcmNsZSA9IDB4MjI5NjsKICB0Lm1pbnVzbW9kID0gMHgwMmQ3OwogIHQubWludXNwbHVzID0gMHgyMjEzOwogIHQubWludXRlID0gMHgyMDMyOwogIHQubWlyaWJhYXJ1c3F1YXJlID0gMHgzMzRhOwogIHQubWlyaXNxdWFyZSA9IDB4MzM0OTsKICB0Lm1sb25nbGVndHVybmVkID0gMHgwMjcwOwogIHQubWxzcXVhcmUgPSAweDMzOTY7CiAgdC5tbWN1YmVkc3F1YXJlID0gMHgzM2EzOwogIHQubW1vbm9zcGFjZSA9IDB4ZmY0ZDsKICB0Lm1tc3F1YXJlZHNxdWFyZSA9IDB4MzM5ZjsKICB0Lm1vaGlyYWdhbmEgPSAweDMwODI7CiAgdC5tb2htc3F1YXJlID0gMHgzM2MxOwogIHQubW9rYXRha2FuYSA9IDB4MzBlMjsKICB0Lm1va2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTM7CiAgdC5tb2xzcXVhcmUgPSAweDMzZDY7CiAgdC5tb21hdGhhaSA9IDB4MGUyMTsKICB0Lm1vdmVyc3NxdWFyZSA9IDB4MzNhNzsKICB0Lm1vdmVyc3NxdWFyZWRzcXVhcmUgPSAweDMzYTg7CiAgdC5tcGFyZW4gPSAweDI0YTg7CiAgdC5tcGFzcXVhcmUgPSAweDMzYWI7CiAgdC5tc3NxdWFyZSA9IDB4MzNiMzsKICB0Lm1zdXBlcmlvciA9IDB4ZjZlZjsKICB0Lm10dXJuZWQgPSAweDAyNmY7CiAgdC5tdSA9IDB4MDBiNTsKICB0Lm11MSA9IDB4MDBiNTsKICB0Lm11YXNxdWFyZSA9IDB4MzM4MjsKICB0Lm11Y2hncmVhdGVyID0gMHgyMjZiOwogIHQubXVjaGxlc3MgPSAweDIyNmE7CiAgdC5tdWZzcXVhcmUgPSAweDMzOGM7CiAgdC5tdWdyZWVrID0gMHgwM2JjOwogIHQubXVnc3F1YXJlID0gMHgzMzhkOwogIHQubXVoaXJhZ2FuYSA9IDB4MzA4MDsKICB0Lm11a2F0YWthbmEgPSAweDMwZTA7CiAgdC5tdWthdGFrYW5haGFsZndpZHRoID0gMHhmZjkxOwogIHQubXVsc3F1YXJlID0gMHgzMzk1OwogIHQubXVsdGlwbHkgPSAweDAwZDc7CiAgdC5tdW1zcXVhcmUgPSAweDMzOWI7CiAgdC5tdW5haGhlYnJldyA9IDB4MDVhMzsKICB0Lm11bmFobGVmdGhlYnJldyA9IDB4MDVhMzsKICB0Lm11c2ljYWxub3RlID0gMHgyNjZhOwogIHQubXVzaWNhbG5vdGVkYmwgPSAweDI2NmI7CiAgdC5tdXNpY2ZsYXRzaWduID0gMHgyNjZkOwogIHQubXVzaWNzaGFycHNpZ24gPSAweDI2NmY7CiAgdC5tdXNzcXVhcmUgPSAweDMzYjI7CiAgdC5tdXZzcXVhcmUgPSAweDMzYjY7CiAgdC5tdXdzcXVhcmUgPSAweDMzYmM7CiAgdC5tdm1lZ2FzcXVhcmUgPSAweDMzYjk7CiAgdC5tdnNxdWFyZSA9IDB4MzNiNzsKICB0Lm13bWVnYXNxdWFyZSA9IDB4MzNiZjsKICB0Lm13c3F1YXJlID0gMHgzM2JkOwogIHQubiA9IDB4MDA2ZTsKICB0Lm5hYmVuZ2FsaSA9IDB4MDlhODsKICB0Lm5hYmxhID0gMHgyMjA3OwogIHQubmFjdXRlID0gMHgwMTQ0OwogIHQubmFkZXZhID0gMHgwOTI4OwogIHQubmFndWphcmF0aSA9IDB4MGFhODsKICB0Lm5hZ3VybXVraGkgPSAweDBhMjg7CiAgdC5uYWhpcmFnYW5hID0gMHgzMDZhOwogIHQubmFrYXRha2FuYSA9IDB4MzBjYTsKICB0Lm5ha2F0YWthbmFoYWxmd2lkdGggPSAweGZmODU7CiAgdC5uYXBvc3Ryb3BoZSA9IDB4MDE0OTsKICB0Lm5hc3F1YXJlID0gMHgzMzgxOwogIHQubmJvcG9tb2ZvID0gMHgzMTBiOwogIHQubmJzcGFjZSA9IDB4MDBhMDsKICB0Lm5jYXJvbiA9IDB4MDE0ODsKICB0Lm5jZWRpbGxhID0gMHgwMTQ2OwogIHQubmNpcmNsZSA9IDB4MjRkZDsKICB0Lm5jaXJjdW1mbGV4YmVsb3cgPSAweDFlNGI7CiAgdC5uY29tbWFhY2NlbnQgPSAweDAxNDY7CiAgdC5uZG90YWNjZW50ID0gMHgxZTQ1OwogIHQubmRvdGJlbG93ID0gMHgxZTQ3OwogIHQubmVoaXJhZ2FuYSA9IDB4MzA2ZDsKICB0Lm5la2F0YWthbmEgPSAweDMwY2Q7CiAgdC5uZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjg4OwogIHQubmV3c2hlcWVsc2lnbiA9IDB4MjBhYTsKICB0Lm5mc3F1YXJlID0gMHgzMzhiOwogIHQubmdhYmVuZ2FsaSA9IDB4MDk5OTsKICB0Lm5nYWRldmEgPSAweDA5MTk7CiAgdC5uZ2FndWphcmF0aSA9IDB4MGE5OTsKICB0Lm5nYWd1cm11a2hpID0gMHgwYTE5OwogIHQubmdvbmd1dGhhaSA9IDB4MGUwNzsKICB0Lm5oaXJhZ2FuYSA9IDB4MzA5MzsKICB0Lm5ob29rbGVmdCA9IDB4MDI3MjsKICB0Lm5ob29rcmV0cm9mbGV4ID0gMHgwMjczOwogIHQubmlldW5hY2lyY2xla29yZWFuID0gMHgzMjZmOwogIHQubmlldW5hcGFyZW5rb3JlYW4gPSAweDMyMGY7CiAgdC5uaWV1bmNpZXVja29yZWFuID0gMHgzMTM1OwogIHQubmlldW5jaXJjbGVrb3JlYW4gPSAweDMyNjE7CiAgdC5uaWV1bmhpZXVoa29yZWFuID0gMHgzMTM2OwogIHQubmlldW5rb3JlYW4gPSAweDMxMzQ7CiAgdC5uaWV1bnBhbnNpb3Nrb3JlYW4gPSAweDMxNjg7CiAgdC5uaWV1bnBhcmVua29yZWFuID0gMHgzMjAxOwogIHQubmlldW5zaW9za29yZWFuID0gMHgzMTY3OwogIHQubmlldW50aWtldXRrb3JlYW4gPSAweDMxNjY7CiAgdC5uaWhpcmFnYW5hID0gMHgzMDZiOwogIHQubmlrYXRha2FuYSA9IDB4MzBjYjsKICB0Lm5pa2F0YWthbmFoYWxmd2lkdGggPSAweGZmODY7CiAgdC5uaWtoYWhpdGxlZnR0aGFpID0gMHhmODk5OwogIHQubmlraGFoaXR0aGFpID0gMHgwZTRkOwogIHQubmluZSA9IDB4MDAzOTsKICB0Lm5pbmVhcmFiaWMgPSAweDA2Njk7CiAgdC5uaW5lYmVuZ2FsaSA9IDB4MDllZjsKICB0Lm5pbmVjaXJjbGUgPSAweDI0Njg7CiAgdC5uaW5lY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc5MjsKICB0Lm5pbmVkZXZhID0gMHgwOTZmOwogIHQubmluZWd1amFyYXRpID0gMHgwYWVmOwogIHQubmluZWd1cm11a2hpID0gMHgwYTZmOwogIHQubmluZWhhY2thcmFiaWMgPSAweDA2Njk7CiAgdC5uaW5laGFuZ3pob3UgPSAweDMwMjk7CiAgdC5uaW5laWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyODsKICB0Lm5pbmVpbmZlcmlvciA9IDB4MjA4OTsKICB0Lm5pbmVtb25vc3BhY2UgPSAweGZmMTk7CiAgdC5uaW5lb2xkc3R5bGUgPSAweGY3Mzk7CiAgdC5uaW5lcGFyZW4gPSAweDI0N2M7CiAgdC5uaW5lcGVyaW9kID0gMHgyNDkwOwogIHQubmluZXBlcnNpYW4gPSAweDA2Zjk7CiAgdC5uaW5lcm9tYW4gPSAweDIxNzg7CiAgdC5uaW5lc3VwZXJpb3IgPSAweDIwNzk7CiAgdC5uaW5ldGVlbmNpcmNsZSA9IDB4MjQ3MjsKICB0Lm5pbmV0ZWVucGFyZW4gPSAweDI0ODY7CiAgdC5uaW5ldGVlbnBlcmlvZCA9IDB4MjQ5YTsKICB0Lm5pbmV0aGFpID0gMHgwZTU5OwogIHQubmogPSAweDAxY2M7CiAgdC5uamVjeXJpbGxpYyA9IDB4MDQ1YTsKICB0Lm5rYXRha2FuYSA9IDB4MzBmMzsKICB0Lm5rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5ZDsKICB0Lm5sZWdyaWdodGxvbmcgPSAweDAxOWU7CiAgdC5ubGluZWJlbG93ID0gMHgxZTQ5OwogIHQubm1vbm9zcGFjZSA9IDB4ZmY0ZTsKICB0Lm5tc3F1YXJlID0gMHgzMzlhOwogIHQubm5hYmVuZ2FsaSA9IDB4MDlhMzsKICB0Lm5uYWRldmEgPSAweDA5MjM7CiAgdC5ubmFndWphcmF0aSA9IDB4MGFhMzsKICB0Lm5uYWd1cm11a2hpID0gMHgwYTIzOwogIHQubm5uYWRldmEgPSAweDA5Mjk7CiAgdC5ub2hpcmFnYW5hID0gMHgzMDZlOwogIHQubm9rYXRha2FuYSA9IDB4MzBjZTsKICB0Lm5va2F0YWthbmFoYWxmd2lkdGggPSAweGZmODk7CiAgdC5ub25icmVha2luZ3NwYWNlID0gMHgwMGEwOwogIHQubm9uZW50aGFpID0gMHgwZTEzOwogIHQubm9udXRoYWkgPSAweDBlMTk7CiAgdC5ub29uYXJhYmljID0gMHgwNjQ2OwogIHQubm9vbmZpbmFsYXJhYmljID0gMHhmZWU2OwogIHQubm9vbmdodW5uYWFyYWJpYyA9IDB4MDZiYTsKICB0Lm5vb25naHVubmFmaW5hbGFyYWJpYyA9IDB4ZmI5ZjsKICB0Lm5vb25pbml0aWFsYXJhYmljID0gMHhmZWU3OwogIHQubm9vbmplZW1pbml0aWFsYXJhYmljID0gMHhmY2QyOwogIHQubm9vbmplZW1pc29sYXRlZGFyYWJpYyA9IDB4ZmM0YjsKICB0Lm5vb25tZWRpYWxhcmFiaWMgPSAweGZlZTg7CiAgdC5ub29ubWVlbWluaXRpYWxhcmFiaWMgPSAweGZjZDU7CiAgdC5ub29ubWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzRlOwogIHQubm9vbm5vb25maW5hbGFyYWJpYyA9IDB4ZmM4ZDsKICB0Lm5vdGNvbnRhaW5zID0gMHgyMjBjOwogIHQubm90ZWxlbWVudCA9IDB4MjIwOTsKICB0Lm5vdGVsZW1lbnRvZiA9IDB4MjIwOTsKICB0Lm5vdGVxdWFsID0gMHgyMjYwOwogIHQubm90Z3JlYXRlciA9IDB4MjI2ZjsKICB0Lm5vdGdyZWF0ZXJub3JlcXVhbCA9IDB4MjI3MTsKICB0Lm5vdGdyZWF0ZXJub3JsZXNzID0gMHgyMjc5OwogIHQubm90aWRlbnRpY2FsID0gMHgyMjYyOwogIHQubm90bGVzcyA9IDB4MjI2ZTsKICB0Lm5vdGxlc3Nub3JlcXVhbCA9IDB4MjI3MDsKICB0Lm5vdHBhcmFsbGVsID0gMHgyMjI2OwogIHQubm90cHJlY2VkZXMgPSAweDIyODA7CiAgdC5ub3RzdWJzZXQgPSAweDIyODQ7CiAgdC5ub3RzdWNjZWVkcyA9IDB4MjI4MTsKICB0Lm5vdHN1cGVyc2V0ID0gMHgyMjg1OwogIHQubm93YXJtZW5pYW4gPSAweDA1NzY7CiAgdC5ucGFyZW4gPSAweDI0YTk7CiAgdC5uc3NxdWFyZSA9IDB4MzNiMTsKICB0Lm5zdXBlcmlvciA9IDB4MjA3ZjsKICB0Lm50aWxkZSA9IDB4MDBmMTsKICB0Lm51ID0gMHgwM2JkOwogIHQubnVoaXJhZ2FuYSA9IDB4MzA2YzsKICB0Lm51a2F0YWthbmEgPSAweDMwY2M7CiAgdC5udWthdGFrYW5haGFsZndpZHRoID0gMHhmZjg3OwogIHQubnVrdGFiZW5nYWxpID0gMHgwOWJjOwogIHQubnVrdGFkZXZhID0gMHgwOTNjOwogIHQubnVrdGFndWphcmF0aSA9IDB4MGFiYzsKICB0Lm51a3RhZ3VybXVraGkgPSAweDBhM2M7CiAgdC5udW1iZXJzaWduID0gMHgwMDIzOwogIHQubnVtYmVyc2lnbm1vbm9zcGFjZSA9IDB4ZmYwMzsKICB0Lm51bWJlcnNpZ25zbWFsbCA9IDB4ZmU1ZjsKICB0Lm51bWVyYWxzaWduZ3JlZWsgPSAweDAzNzQ7CiAgdC5udW1lcmFsc2lnbmxvd2VyZ3JlZWsgPSAweDAzNzU7CiAgdC5udW1lcm8gPSAweDIxMTY7CiAgdC5udW4gPSAweDA1ZTA7CiAgdC5udW5kYWdlc2ggPSAweGZiNDA7CiAgdC5udW5kYWdlc2hoZWJyZXcgPSAweGZiNDA7CiAgdC5udW5oZWJyZXcgPSAweDA1ZTA7CiAgdC5udnNxdWFyZSA9IDB4MzNiNTsKICB0Lm53c3F1YXJlID0gMHgzM2JiOwogIHQubnlhYmVuZ2FsaSA9IDB4MDk5ZTsKICB0Lm55YWRldmEgPSAweDA5MWU7CiAgdC5ueWFndWphcmF0aSA9IDB4MGE5ZTsKICB0Lm55YWd1cm11a2hpID0gMHgwYTFlOwogIHQubyA9IDB4MDA2ZjsKICB0Lm9hY3V0ZSA9IDB4MDBmMzsKICB0Lm9hbmd0aGFpID0gMHgwZTJkOwogIHQub2JhcnJlZCA9IDB4MDI3NTsKICB0Lm9iYXJyZWRjeXJpbGxpYyA9IDB4MDRlOTsKICB0Lm9iYXJyZWRkaWVyZXNpc2N5cmlsbGljID0gMHgwNGViOwogIHQub2JlbmdhbGkgPSAweDA5OTM7CiAgdC5vYm9wb21vZm8gPSAweDMxMWI7CiAgdC5vYnJldmUgPSAweDAxNGY7CiAgdC5vY2FuZHJhZGV2YSA9IDB4MDkxMTsKICB0Lm9jYW5kcmFndWphcmF0aSA9IDB4MGE5MTsKICB0Lm9jYW5kcmF2b3dlbHNpZ25kZXZhID0gMHgwOTQ5OwogIHQub2NhbmRyYXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM5OwogIHQub2Nhcm9uID0gMHgwMWQyOwogIHQub2NpcmNsZSA9IDB4MjRkZTsKICB0Lm9jaXJjdW1mbGV4ID0gMHgwMGY0OwogIHQub2NpcmN1bWZsZXhhY3V0ZSA9IDB4MWVkMTsKICB0Lm9jaXJjdW1mbGV4ZG90YmVsb3cgPSAweDFlZDk7CiAgdC5vY2lyY3VtZmxleGdyYXZlID0gMHgxZWQzOwogIHQub2NpcmN1bWZsZXhob29rYWJvdmUgPSAweDFlZDU7CiAgdC5vY2lyY3VtZmxleHRpbGRlID0gMHgxZWQ3OwogIHQub2N5cmlsbGljID0gMHgwNDNlOwogIHQub2RibGFjdXRlID0gMHgwMTUxOwogIHQub2RibGdyYXZlID0gMHgwMjBkOwogIHQub2RldmEgPSAweDA5MTM7CiAgdC5vZGllcmVzaXMgPSAweDAwZjY7CiAgdC5vZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNzsKICB0Lm9kb3RiZWxvdyA9IDB4MWVjZDsKICB0Lm9lID0gMHgwMTUzOwogIHQub2Vrb3JlYW4gPSAweDMxNWE7CiAgdC5vZ29uZWsgPSAweDAyZGI7CiAgdC5vZ29uZWtjbWIgPSAweDAzMjg7CiAgdC5vZ3JhdmUgPSAweDAwZjI7CiAgdC5vZ3VqYXJhdGkgPSAweDBhOTM7CiAgdC5vaGFybWVuaWFuID0gMHgwNTg1OwogIHQub2hpcmFnYW5hID0gMHgzMDRhOwogIHQub2hvb2thYm92ZSA9IDB4MWVjZjsKICB0Lm9ob3JuID0gMHgwMWExOwogIHQub2hvcm5hY3V0ZSA9IDB4MWVkYjsKICB0Lm9ob3JuZG90YmVsb3cgPSAweDFlZTM7CiAgdC5vaG9ybmdyYXZlID0gMHgxZWRkOwogIHQub2hvcm5ob29rYWJvdmUgPSAweDFlZGY7CiAgdC5vaG9ybnRpbGRlID0gMHgxZWUxOwogIHQub2h1bmdhcnVtbGF1dCA9IDB4MDE1MTsKICB0Lm9pID0gMHgwMWEzOwogIHQub2ludmVydGVkYnJldmUgPSAweDAyMGY7CiAgdC5va2F0YWthbmEgPSAweDMwYWE7CiAgdC5va2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzU7CiAgdC5va29yZWFuID0gMHgzMTU3OwogIHQub2xlaGVicmV3ID0gMHgwNWFiOwogIHQub21hY3JvbiA9IDB4MDE0ZDsKICB0Lm9tYWNyb25hY3V0ZSA9IDB4MWU1MzsKICB0Lm9tYWNyb25ncmF2ZSA9IDB4MWU1MTsKICB0Lm9tZGV2YSA9IDB4MDk1MDsKICB0Lm9tZWdhID0gMHgwM2M5OwogIHQub21lZ2ExID0gMHgwM2Q2OwogIHQub21lZ2FjeXJpbGxpYyA9IDB4MDQ2MTsKICB0Lm9tZWdhbGF0aW5jbG9zZWQgPSAweDAyNzc7CiAgdC5vbWVnYXJvdW5kY3lyaWxsaWMgPSAweDA0N2I7CiAgdC5vbWVnYXRpdGxvY3lyaWxsaWMgPSAweDA0N2Q7CiAgdC5vbWVnYXRvbm9zID0gMHgwM2NlOwogIHQub21ndWphcmF0aSA9IDB4MGFkMDsKICB0Lm9taWNyb24gPSAweDAzYmY7CiAgdC5vbWljcm9udG9ub3MgPSAweDAzY2M7CiAgdC5vbW9ub3NwYWNlID0gMHhmZjRmOwogIHQub25lID0gMHgwMDMxOwogIHQub25lYXJhYmljID0gMHgwNjYxOwogIHQub25lYmVuZ2FsaSA9IDB4MDllNzsKICB0Lm9uZWNpcmNsZSA9IDB4MjQ2MDsKICB0Lm9uZWNpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGE7CiAgdC5vbmVkZXZhID0gMHgwOTY3OwogIHQub25lZG90ZW5sZWFkZXIgPSAweDIwMjQ7CiAgdC5vbmVlaWdodGggPSAweDIxNWI7CiAgdC5vbmVmaXR0ZWQgPSAweGY2ZGM7CiAgdC5vbmVndWphcmF0aSA9IDB4MGFlNzsKICB0Lm9uZWd1cm11a2hpID0gMHgwYTY3OwogIHQub25laGFja2FyYWJpYyA9IDB4MDY2MTsKICB0Lm9uZWhhbGYgPSAweDAwYmQ7CiAgdC5vbmVoYW5nemhvdSA9IDB4MzAyMTsKICB0Lm9uZWlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjA7CiAgdC5vbmVpbmZlcmlvciA9IDB4MjA4MTsKICB0Lm9uZW1vbm9zcGFjZSA9IDB4ZmYxMTsKICB0Lm9uZW51bWVyYXRvcmJlbmdhbGkgPSAweDA5ZjQ7CiAgdC5vbmVvbGRzdHlsZSA9IDB4ZjczMTsKICB0Lm9uZXBhcmVuID0gMHgyNDc0OwogIHQub25lcGVyaW9kID0gMHgyNDg4OwogIHQub25lcGVyc2lhbiA9IDB4MDZmMTsKICB0Lm9uZXF1YXJ0ZXIgPSAweDAwYmM7CiAgdC5vbmVyb21hbiA9IDB4MjE3MDsKICB0Lm9uZXN1cGVyaW9yID0gMHgwMGI5OwogIHQub25ldGhhaSA9IDB4MGU1MTsKICB0Lm9uZXRoaXJkID0gMHgyMTUzOwogIHQub29nb25layA9IDB4MDFlYjsKICB0Lm9vZ29uZWttYWNyb24gPSAweDAxZWQ7CiAgdC5vb2d1cm11a2hpID0gMHgwYTEzOwogIHQub29tYXRyYWd1cm11a2hpID0gMHgwYTRiOwogIHQub29wZW4gPSAweDAyNTQ7CiAgdC5vcGFyZW4gPSAweDI0YWE7CiAgdC5vcGVuYnVsbGV0ID0gMHgyNWU2OwogIHQub3B0aW9uID0gMHgyMzI1OwogIHQub3JkZmVtaW5pbmUgPSAweDAwYWE7CiAgdC5vcmRtYXNjdWxpbmUgPSAweDAwYmE7CiAgdC5vcnRob2dvbmFsID0gMHgyMjFmOwogIHQub3Nob3J0ZGV2YSA9IDB4MDkxMjsKICB0Lm9zaG9ydHZvd2Vsc2lnbmRldmEgPSAweDA5NGE7CiAgdC5vc2xhc2ggPSAweDAwZjg7CiAgdC5vc2xhc2hhY3V0ZSA9IDB4MDFmZjsKICB0Lm9zbWFsbGhpcmFnYW5hID0gMHgzMDQ5OwogIHQub3NtYWxsa2F0YWthbmEgPSAweDMwYTk7CiAgdC5vc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YjsKICB0Lm9zdHJva2VhY3V0ZSA9IDB4MDFmZjsKICB0Lm9zdXBlcmlvciA9IDB4ZjZmMDsKICB0Lm90Y3lyaWxsaWMgPSAweDA0N2Y7CiAgdC5vdGlsZGUgPSAweDAwZjU7CiAgdC5vdGlsZGVhY3V0ZSA9IDB4MWU0ZDsKICB0Lm90aWxkZWRpZXJlc2lzID0gMHgxZTRmOwogIHQub3Vib3BvbW9mbyA9IDB4MzEyMTsKICB0Lm92ZXJsaW5lID0gMHgyMDNlOwogIHQub3ZlcmxpbmVjZW50ZXJsaW5lID0gMHhmZTRhOwogIHQub3ZlcmxpbmVjbWIgPSAweDAzMDU7CiAgdC5vdmVybGluZWRhc2hlZCA9IDB4ZmU0OTsKICB0Lm92ZXJsaW5lZGJsd2F2eSA9IDB4ZmU0YzsKICB0Lm92ZXJsaW5ld2F2eSA9IDB4ZmU0YjsKICB0Lm92ZXJzY29yZSA9IDB4MDBhZjsKICB0Lm92b3dlbHNpZ25iZW5nYWxpID0gMHgwOWNiOwogIHQub3Zvd2Vsc2lnbmRldmEgPSAweDA5NGI7CiAgdC5vdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhY2I7CiAgdC5wID0gMHgwMDcwOwogIHQucGFhbXBzc3F1YXJlID0gMHgzMzgwOwogIHQucGFhc2VudG9zcXVhcmUgPSAweDMzMmI7CiAgdC5wYWJlbmdhbGkgPSAweDA5YWE7CiAgdC5wYWN1dGUgPSAweDFlNTU7CiAgdC5wYWRldmEgPSAweDA5MmE7CiAgdC5wYWdlZG93biA9IDB4MjFkZjsKICB0LnBhZ2V1cCA9IDB4MjFkZTsKICB0LnBhZ3VqYXJhdGkgPSAweDBhYWE7CiAgdC5wYWd1cm11a2hpID0gMHgwYTJhOwogIHQucGFoaXJhZ2FuYSA9IDB4MzA3MTsKICB0LnBhaXlhbm5vaXRoYWkgPSAweDBlMmY7CiAgdC5wYWthdGFrYW5hID0gMHgzMGQxOwogIHQucGFsYXRhbGl6YXRpb25jeXJpbGxpY2NtYiA9IDB4MDQ4NDsKICB0LnBhbG9jaGthY3lyaWxsaWMgPSAweDA0YzA7CiAgdC5wYW5zaW9za29yZWFuID0gMHgzMTdmOwogIHQucGFyYWdyYXBoID0gMHgwMGI2OwogIHQucGFyYWxsZWwgPSAweDIyMjU7CiAgdC5wYXJlbmxlZnQgPSAweDAwMjg7CiAgdC5wYXJlbmxlZnRhbHRvbmVhcmFiaWMgPSAweGZkM2U7CiAgdC5wYXJlbmxlZnRidCA9IDB4ZjhlZDsKICB0LnBhcmVubGVmdGV4ID0gMHhmOGVjOwogIHQucGFyZW5sZWZ0aW5mZXJpb3IgPSAweDIwOGQ7CiAgdC5wYXJlbmxlZnRtb25vc3BhY2UgPSAweGZmMDg7CiAgdC5wYXJlbmxlZnRzbWFsbCA9IDB4ZmU1OTsKICB0LnBhcmVubGVmdHN1cGVyaW9yID0gMHgyMDdkOwogIHQucGFyZW5sZWZ0dHAgPSAweGY4ZWI7CiAgdC5wYXJlbmxlZnR2ZXJ0aWNhbCA9IDB4ZmUzNTsKICB0LnBhcmVucmlnaHQgPSAweDAwMjk7CiAgdC5wYXJlbnJpZ2h0YWx0b25lYXJhYmljID0gMHhmZDNmOwogIHQucGFyZW5yaWdodGJ0ID0gMHhmOGY4OwogIHQucGFyZW5yaWdodGV4ID0gMHhmOGY3OwogIHQucGFyZW5yaWdodGluZmVyaW9yID0gMHgyMDhlOwogIHQucGFyZW5yaWdodG1vbm9zcGFjZSA9IDB4ZmYwOTsKICB0LnBhcmVucmlnaHRzbWFsbCA9IDB4ZmU1YTsKICB0LnBhcmVucmlnaHRzdXBlcmlvciA9IDB4MjA3ZTsKICB0LnBhcmVucmlnaHR0cCA9IDB4ZjhmNjsKICB0LnBhcmVucmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzNjsKICB0LnBhcnRpYWxkaWZmID0gMHgyMjAyOwogIHQucGFzZXFoZWJyZXcgPSAweDA1YzA7CiAgdC5wYXNodGFoZWJyZXcgPSAweDA1OTk7CiAgdC5wYXNxdWFyZSA9IDB4MzNhOTsKICB0LnBhdGFoID0gMHgwNWI3OwogIHQucGF0YWgxMSA9IDB4MDViNzsKICB0LnBhdGFoMWQgPSAweDA1Yjc7CiAgdC5wYXRhaDJhID0gMHgwNWI3OwogIHQucGF0YWhoZWJyZXcgPSAweDA1Yjc7CiAgdC5wYXRhaG5hcnJvd2hlYnJldyA9IDB4MDViNzsKICB0LnBhdGFocXVhcnRlcmhlYnJldyA9IDB4MDViNzsKICB0LnBhdGFod2lkZWhlYnJldyA9IDB4MDViNzsKICB0LnBhemVyaGVicmV3ID0gMHgwNWExOwogIHQucGJvcG9tb2ZvID0gMHgzMTA2OwogIHQucGNpcmNsZSA9IDB4MjRkZjsKICB0LnBkb3RhY2NlbnQgPSAweDFlNTc7CiAgdC5wZSA9IDB4MDVlNDsKICB0LnBlY3lyaWxsaWMgPSAweDA0M2Y7CiAgdC5wZWRhZ2VzaCA9IDB4ZmI0NDsKICB0LnBlZGFnZXNoaGVicmV3ID0gMHhmYjQ0OwogIHQucGVlemlzcXVhcmUgPSAweDMzM2I7CiAgdC5wZWZpbmFsZGFnZXNoaGVicmV3ID0gMHhmYjQzOwogIHQucGVoYXJhYmljID0gMHgwNjdlOwogIHQucGVoYXJtZW5pYW4gPSAweDA1N2E7CiAgdC5wZWhlYnJldyA9IDB4MDVlNDsKICB0LnBlaGZpbmFsYXJhYmljID0gMHhmYjU3OwogIHQucGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI1ODsKICB0LnBlaGlyYWdhbmEgPSAweDMwN2E7CiAgdC5wZWhtZWRpYWxhcmFiaWMgPSAweGZiNTk7CiAgdC5wZWthdGFrYW5hID0gMHgzMGRhOwogIHQucGVtaWRkbGVob29rY3lyaWxsaWMgPSAweDA0YTc7CiAgdC5wZXJhZmVoZWJyZXcgPSAweGZiNGU7CiAgdC5wZXJjZW50ID0gMHgwMDI1OwogIHQucGVyY2VudGFyYWJpYyA9IDB4MDY2YTsKICB0LnBlcmNlbnRtb25vc3BhY2UgPSAweGZmMDU7CiAgdC5wZXJjZW50c21hbGwgPSAweGZlNmE7CiAgdC5wZXJpb2QgPSAweDAwMmU7CiAgdC5wZXJpb2Rhcm1lbmlhbiA9IDB4MDU4OTsKICB0LnBlcmlvZGNlbnRlcmVkID0gMHgwMGI3OwogIHQucGVyaW9kaGFsZndpZHRoID0gMHhmZjYxOwogIHQucGVyaW9kaW5mZXJpb3IgPSAweGY2ZTc7CiAgdC5wZXJpb2Rtb25vc3BhY2UgPSAweGZmMGU7CiAgdC5wZXJpb2RzbWFsbCA9IDB4ZmU1MjsKICB0LnBlcmlvZHN1cGVyaW9yID0gMHhmNmU4OwogIHQucGVyaXNwb21lbmlncmVla2NtYiA9IDB4MDM0MjsKICB0LnBlcnBlbmRpY3VsYXIgPSAweDIyYTU7CiAgdC5wZXJ0aG91c2FuZCA9IDB4MjAzMDsKICB0LnBlc2V0YSA9IDB4MjBhNzsKICB0LnBmc3F1YXJlID0gMHgzMzhhOwogIHQucGhhYmVuZ2FsaSA9IDB4MDlhYjsKICB0LnBoYWRldmEgPSAweDA5MmI7CiAgdC5waGFndWphcmF0aSA9IDB4MGFhYjsKICB0LnBoYWd1cm11a2hpID0gMHgwYTJiOwogIHQucGhpID0gMHgwM2M2OwogIHQucGhpMSA9IDB4MDNkNTsKICB0LnBoaWV1cGhhY2lyY2xla29yZWFuID0gMHgzMjdhOwogIHQucGhpZXVwaGFwYXJlbmtvcmVhbiA9IDB4MzIxYTsKICB0LnBoaWV1cGhjaXJjbGVrb3JlYW4gPSAweDMyNmM7CiAgdC5waGlldXBoa29yZWFuID0gMHgzMTRkOwogIHQucGhpZXVwaHBhcmVua29yZWFuID0gMHgzMjBjOwogIHQucGhpbGF0aW4gPSAweDAyNzg7CiAgdC5waGludGh1dGhhaSA9IDB4MGUzYTsKICB0LnBoaXN5bWJvbGdyZWVrID0gMHgwM2Q1OwogIHQucGhvb2sgPSAweDAxYTU7CiAgdC5waG9waGFudGhhaSA9IDB4MGUxZTsKICB0LnBob3BodW5ndGhhaSA9IDB4MGUxYzsKICB0LnBob3NhbXBoYW90aGFpID0gMHgwZTIwOwogIHQucGkgPSAweDAzYzA7CiAgdC5waWV1cGFjaXJjbGVrb3JlYW4gPSAweDMyNzM7CiAgdC5waWV1cGFwYXJlbmtvcmVhbiA9IDB4MzIxMzsKICB0LnBpZXVwY2lldWNrb3JlYW4gPSAweDMxNzY7CiAgdC5waWV1cGNpcmNsZWtvcmVhbiA9IDB4MzI2NTsKICB0LnBpZXVwa2l5ZW9ra29yZWFuID0gMHgzMTcyOwogIHQucGlldXBrb3JlYW4gPSAweDMxNDI7CiAgdC5waWV1cHBhcmVua29yZWFuID0gMHgzMjA1OwogIHQucGlldXBzaW9za2l5ZW9ra29yZWFuID0gMHgzMTc0OwogIHQucGlldXBzaW9za29yZWFuID0gMHgzMTQ0OwogIHQucGlldXBzaW9zdGlrZXV0a29yZWFuID0gMHgzMTc1OwogIHQucGlldXB0aGlldXRoa29yZWFuID0gMHgzMTc3OwogIHQucGlldXB0aWtldXRrb3JlYW4gPSAweDMxNzM7CiAgdC5waWhpcmFnYW5hID0gMHgzMDc0OwogIHQucGlrYXRha2FuYSA9IDB4MzBkNDsKICB0LnBpc3ltYm9sZ3JlZWsgPSAweDAzZDY7CiAgdC5waXdyYXJtZW5pYW4gPSAweDA1ODM7CiAgdC5wbGFuY2tvdmVyMnBpID0gMHgyMTBmOwogIHQucGxhbmNrb3ZlcjJwaTEgPSAweDIxMGY7CiAgdC5wbHVzID0gMHgwMDJiOwogIHQucGx1c2JlbG93Y21iID0gMHgwMzFmOwogIHQucGx1c2NpcmNsZSA9IDB4MjI5NTsKICB0LnBsdXNtaW51cyA9IDB4MDBiMTsKICB0LnBsdXNtb2QgPSAweDAyZDY7CiAgdC5wbHVzbW9ub3NwYWNlID0gMHhmZjBiOwogIHQucGx1c3NtYWxsID0gMHhmZTYyOwogIHQucGx1c3N1cGVyaW9yID0gMHgyMDdhOwogIHQucG1vbm9zcGFjZSA9IDB4ZmY1MDsKICB0LnBtc3F1YXJlID0gMHgzM2Q4OwogIHQucG9oaXJhZ2FuYSA9IDB4MzA3ZDsKICB0LnBvaW50aW5naW5kZXhkb3dud2hpdGUgPSAweDI2MWY7CiAgdC5wb2ludGluZ2luZGV4bGVmdHdoaXRlID0gMHgyNjFjOwogIHQucG9pbnRpbmdpbmRleHJpZ2h0d2hpdGUgPSAweDI2MWU7CiAgdC5wb2ludGluZ2luZGV4dXB3aGl0ZSA9IDB4MjYxZDsKICB0LnBva2F0YWthbmEgPSAweDMwZGQ7CiAgdC5wb3BsYXRoYWkgPSAweDBlMWI7CiAgdC5wb3N0YWxtYXJrID0gMHgzMDEyOwogIHQucG9zdGFsbWFya2ZhY2UgPSAweDMwMjA7CiAgdC5wcGFyZW4gPSAweDI0YWI7CiAgdC5wcmVjZWRlcyA9IDB4MjI3YTsKICB0LnByZXNjcmlwdGlvbiA9IDB4MjExZTsKICB0LnByaW1lbW9kID0gMHgwMmI5OwogIHQucHJpbWVyZXZlcnNlZCA9IDB4MjAzNTsKICB0LnByb2R1Y3QgPSAweDIyMGY7CiAgdC5wcm9qZWN0aXZlID0gMHgyMzA1OwogIHQucHJvbG9uZ2Vka2FuYSA9IDB4MzBmYzsKICB0LnByb3BlbGxvciA9IDB4MjMxODsKICB0LnByb3BlcnN1YnNldCA9IDB4MjI4MjsKICB0LnByb3BlcnN1cGVyc2V0ID0gMHgyMjgzOwogIHQucHJvcG9ydGlvbiA9IDB4MjIzNzsKICB0LnByb3BvcnRpb25hbCA9IDB4MjIxZDsKICB0LnBzaSA9IDB4MDNjODsKICB0LnBzaWN5cmlsbGljID0gMHgwNDcxOwogIHQucHNpbGlwbmV1bWF0YWN5cmlsbGljY21iID0gMHgwNDg2OwogIHQucHNzcXVhcmUgPSAweDMzYjA7CiAgdC5wdWhpcmFnYW5hID0gMHgzMDc3OwogIHQucHVrYXRha2FuYSA9IDB4MzBkNzsKICB0LnB2c3F1YXJlID0gMHgzM2I0OwogIHQucHdzcXVhcmUgPSAweDMzYmE7CiAgdC5xID0gMHgwMDcxOwogIHQucWFkZXZhID0gMHgwOTU4OwogIHQucWFkbWFoZWJyZXcgPSAweDA1YTg7CiAgdC5xYWZhcmFiaWMgPSAweDA2NDI7CiAgdC5xYWZmaW5hbGFyYWJpYyA9IDB4ZmVkNjsKICB0LnFhZmluaXRpYWxhcmFiaWMgPSAweGZlZDc7CiAgdC5xYWZtZWRpYWxhcmFiaWMgPSAweGZlZDg7CiAgdC5xYW1hdHMgPSAweDA1Yjg7CiAgdC5xYW1hdHMxMCA9IDB4MDViODsKICB0LnFhbWF0czFhID0gMHgwNWI4OwogIHQucWFtYXRzMWMgPSAweDA1Yjg7CiAgdC5xYW1hdHMyNyA9IDB4MDViODsKICB0LnFhbWF0czI5ID0gMHgwNWI4OwogIHQucWFtYXRzMzMgPSAweDA1Yjg7CiAgdC5xYW1hdHNkZSA9IDB4MDViODsKICB0LnFhbWF0c2hlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c25hcnJvd2hlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c3FhdGFuaGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzcWF0YW5uYXJyb3doZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxYXRhbnF1YXJ0ZXJoZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxYXRhbndpZGVoZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxdWFydGVyaGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzd2lkZWhlYnJldyA9IDB4MDViODsKICB0LnFhcm5leXBhcmFoZWJyZXcgPSAweDA1OWY7CiAgdC5xYm9wb21vZm8gPSAweDMxMTE7CiAgdC5xY2lyY2xlID0gMHgyNGUwOwogIHQucWhvb2sgPSAweDAyYTA7CiAgdC5xbW9ub3NwYWNlID0gMHhmZjUxOwogIHQucW9mID0gMHgwNWU3OwogIHQucW9mZGFnZXNoID0gMHhmYjQ3OwogIHQucW9mZGFnZXNoaGVicmV3ID0gMHhmYjQ3OwogIHQucW9maGVicmV3ID0gMHgwNWU3OwogIHQucXBhcmVuID0gMHgyNGFjOwogIHQucXVhcnRlcm5vdGUgPSAweDI2Njk7CiAgdC5xdWJ1dHMgPSAweDA1YmI7CiAgdC5xdWJ1dHMxOCA9IDB4MDViYjsKICB0LnF1YnV0czI1ID0gMHgwNWJiOwogIHQucXVidXRzMzEgPSAweDA1YmI7CiAgdC5xdWJ1dHNoZWJyZXcgPSAweDA1YmI7CiAgdC5xdWJ1dHNuYXJyb3doZWJyZXcgPSAweDA1YmI7CiAgdC5xdWJ1dHNxdWFydGVyaGVicmV3ID0gMHgwNWJiOwogIHQucXVidXRzd2lkZWhlYnJldyA9IDB4MDViYjsKICB0LnF1ZXN0aW9uID0gMHgwMDNmOwogIHQucXVlc3Rpb25hcmFiaWMgPSAweDA2MWY7CiAgdC5xdWVzdGlvbmFybWVuaWFuID0gMHgwNTVlOwogIHQucXVlc3Rpb25kb3duID0gMHgwMGJmOwogIHQucXVlc3Rpb25kb3duc21hbGwgPSAweGY3YmY7CiAgdC5xdWVzdGlvbmdyZWVrID0gMHgwMzdlOwogIHQucXVlc3Rpb25tb25vc3BhY2UgPSAweGZmMWY7CiAgdC5xdWVzdGlvbnNtYWxsID0gMHhmNzNmOwogIHQucXVvdGVkYmwgPSAweDAwMjI7CiAgdC5xdW90ZWRibGJhc2UgPSAweDIwMWU7CiAgdC5xdW90ZWRibGxlZnQgPSAweDIwMWM7CiAgdC5xdW90ZWRibG1vbm9zcGFjZSA9IDB4ZmYwMjsKICB0LnF1b3RlZGJscHJpbWUgPSAweDMwMWU7CiAgdC5xdW90ZWRibHByaW1lcmV2ZXJzZWQgPSAweDMwMWQ7CiAgdC5xdW90ZWRibHJpZ2h0ID0gMHgyMDFkOwogIHQucXVvdGVsZWZ0ID0gMHgyMDE4OwogIHQucXVvdGVsZWZ0cmV2ZXJzZWQgPSAweDIwMWI7CiAgdC5xdW90ZXJldmVyc2VkID0gMHgyMDFiOwogIHQucXVvdGVyaWdodCA9IDB4MjAxOTsKICB0LnF1b3RlcmlnaHRuID0gMHgwMTQ5OwogIHQucXVvdGVzaW5nbGJhc2UgPSAweDIwMWE7CiAgdC5xdW90ZXNpbmdsZSA9IDB4MDAyNzsKICB0LnF1b3Rlc2luZ2xlbW9ub3NwYWNlID0gMHhmZjA3OwogIHQuciA9IDB4MDA3MjsKICB0LnJhYXJtZW5pYW4gPSAweDA1N2M7CiAgdC5yYWJlbmdhbGkgPSAweDA5YjA7CiAgdC5yYWN1dGUgPSAweDAxNTU7CiAgdC5yYWRldmEgPSAweDA5MzA7CiAgdC5yYWRpY2FsID0gMHgyMjFhOwogIHQucmFkaWNhbGV4ID0gMHhmOGU1OwogIHQucmFkb3ZlcnNzcXVhcmUgPSAweDMzYWU7CiAgdC5yYWRvdmVyc3NxdWFyZWRzcXVhcmUgPSAweDMzYWY7CiAgdC5yYWRzcXVhcmUgPSAweDMzYWQ7CiAgdC5yYWZlID0gMHgwNWJmOwogIHQucmFmZWhlYnJldyA9IDB4MDViZjsKICB0LnJhZ3VqYXJhdGkgPSAweDBhYjA7CiAgdC5yYWd1cm11a2hpID0gMHgwYTMwOwogIHQucmFoaXJhZ2FuYSA9IDB4MzA4OTsKICB0LnJha2F0YWthbmEgPSAweDMwZTk7CiAgdC5yYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk3OwogIHQucmFsb3dlcmRpYWdvbmFsYmVuZ2FsaSA9IDB4MDlmMTsKICB0LnJhbWlkZGxlZGlhZ29uYWxiZW5nYWxpID0gMHgwOWYwOwogIHQucmFtc2hvcm4gPSAweDAyNjQ7CiAgdC5yYXRpbyA9IDB4MjIzNjsKICB0LnJib3BvbW9mbyA9IDB4MzExNjsKICB0LnJjYXJvbiA9IDB4MDE1OTsKICB0LnJjZWRpbGxhID0gMHgwMTU3OwogIHQucmNpcmNsZSA9IDB4MjRlMTsKICB0LnJjb21tYWFjY2VudCA9IDB4MDE1NzsKICB0LnJkYmxncmF2ZSA9IDB4MDIxMTsKICB0LnJkb3RhY2NlbnQgPSAweDFlNTk7CiAgdC5yZG90YmVsb3cgPSAweDFlNWI7CiAgdC5yZG90YmVsb3dtYWNyb24gPSAweDFlNWQ7CiAgdC5yZWZlcmVuY2VtYXJrID0gMHgyMDNiOwogIHQucmVmbGV4c3Vic2V0ID0gMHgyMjg2OwogIHQucmVmbGV4c3VwZXJzZXQgPSAweDIyODc7CiAgdC5yZWdpc3RlcmVkID0gMHgwMGFlOwogIHQucmVnaXN0ZXJzYW5zID0gMHhmOGU4OwogIHQucmVnaXN0ZXJzZXJpZiA9IDB4ZjZkYTsKICB0LnJlaGFyYWJpYyA9IDB4MDYzMTsKICB0LnJlaGFybWVuaWFuID0gMHgwNTgwOwogIHQucmVoZmluYWxhcmFiaWMgPSAweGZlYWU7CiAgdC5yZWhpcmFnYW5hID0gMHgzMDhjOwogIHQucmVrYXRha2FuYSA9IDB4MzBlYzsKICB0LnJla2F0YWthbmFoYWxmd2lkdGggPSAweGZmOWE7CiAgdC5yZXNoID0gMHgwNWU4OwogIHQucmVzaGRhZ2VzaGhlYnJldyA9IDB4ZmI0ODsKICB0LnJlc2hoZWJyZXcgPSAweDA1ZTg7CiAgdC5yZXZlcnNlZHRpbGRlID0gMHgyMjNkOwogIHQucmV2aWFoZWJyZXcgPSAweDA1OTc7CiAgdC5yZXZpYW11Z3Jhc2hoZWJyZXcgPSAweDA1OTc7CiAgdC5yZXZsb2dpY2Fsbm90ID0gMHgyMzEwOwogIHQucmZpc2hob29rID0gMHgwMjdlOwogIHQucmZpc2hob29rcmV2ZXJzZWQgPSAweDAyN2Y7CiAgdC5yaGFiZW5nYWxpID0gMHgwOWRkOwogIHQucmhhZGV2YSA9IDB4MDk1ZDsKICB0LnJobyA9IDB4MDNjMTsKICB0LnJob29rID0gMHgwMjdkOwogIHQucmhvb2t0dXJuZWQgPSAweDAyN2I7CiAgdC5yaG9va3R1cm5lZHN1cGVyaW9yID0gMHgwMmI1OwogIHQucmhvc3ltYm9sZ3JlZWsgPSAweDAzZjE7CiAgdC5yaG90aWNob29rbW9kID0gMHgwMmRlOwogIHQucmlldWxhY2lyY2xla29yZWFuID0gMHgzMjcxOwogIHQucmlldWxhcGFyZW5rb3JlYW4gPSAweDMyMTE7CiAgdC5yaWV1bGNpcmNsZWtvcmVhbiA9IDB4MzI2MzsKICB0LnJpZXVsaGlldWhrb3JlYW4gPSAweDMxNDA7CiAgdC5yaWV1bGtpeWVva2tvcmVhbiA9IDB4MzEzYTsKICB0LnJpZXVsa2l5ZW9rc2lvc2tvcmVhbiA9IDB4MzE2OTsKICB0LnJpZXVsa29yZWFuID0gMHgzMTM5OwogIHQucmlldWxtaWV1bWtvcmVhbiA9IDB4MzEzYjsKICB0LnJpZXVscGFuc2lvc2tvcmVhbiA9IDB4MzE2YzsKICB0LnJpZXVscGFyZW5rb3JlYW4gPSAweDMyMDM7CiAgdC5yaWV1bHBoaWV1cGhrb3JlYW4gPSAweDMxM2Y7CiAgdC5yaWV1bHBpZXVwa29yZWFuID0gMHgzMTNjOwogIHQucmlldWxwaWV1cHNpb3Nrb3JlYW4gPSAweDMxNmI7CiAgdC5yaWV1bHNpb3Nrb3JlYW4gPSAweDMxM2Q7CiAgdC5yaWV1bHRoaWV1dGhrb3JlYW4gPSAweDMxM2U7CiAgdC5yaWV1bHRpa2V1dGtvcmVhbiA9IDB4MzE2YTsKICB0LnJpZXVseWVvcmluaGlldWhrb3JlYW4gPSAweDMxNmQ7CiAgdC5yaWdodGFuZ2xlID0gMHgyMjFmOwogIHQucmlnaHR0YWNrYmVsb3djbWIgPSAweDAzMTk7CiAgdC5yaWdodHRyaWFuZ2xlID0gMHgyMmJmOwogIHQucmloaXJhZ2FuYSA9IDB4MzA4YTsKICB0LnJpa2F0YWthbmEgPSAweDMwZWE7CiAgdC5yaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk4OwogIHQucmluZyA9IDB4MDJkYTsKICB0LnJpbmdiZWxvd2NtYiA9IDB4MDMyNTsKICB0LnJpbmdjbWIgPSAweDAzMGE7CiAgdC5yaW5naGFsZmxlZnQgPSAweDAyYmY7CiAgdC5yaW5naGFsZmxlZnRhcm1lbmlhbiA9IDB4MDU1OTsKICB0LnJpbmdoYWxmbGVmdGJlbG93Y21iID0gMHgwMzFjOwogIHQucmluZ2hhbGZsZWZ0Y2VudGVyZWQgPSAweDAyZDM7CiAgdC5yaW5naGFsZnJpZ2h0ID0gMHgwMmJlOwogIHQucmluZ2hhbGZyaWdodGJlbG93Y21iID0gMHgwMzM5OwogIHQucmluZ2hhbGZyaWdodGNlbnRlcmVkID0gMHgwMmQyOwogIHQucmludmVydGVkYnJldmUgPSAweDAyMTM7CiAgdC5yaXR0b3J1c3F1YXJlID0gMHgzMzUxOwogIHQucmxpbmViZWxvdyA9IDB4MWU1ZjsKICB0LnJsb25nbGVnID0gMHgwMjdjOwogIHQucmxvbmdsZWd0dXJuZWQgPSAweDAyN2E7CiAgdC5ybW9ub3NwYWNlID0gMHhmZjUyOwogIHQucm9oaXJhZ2FuYSA9IDB4MzA4ZDsKICB0LnJva2F0YWthbmEgPSAweDMwZWQ7CiAgdC5yb2thdGFrYW5haGFsZndpZHRoID0gMHhmZjliOwogIHQucm9ydWF0aGFpID0gMHgwZTIzOwogIHQucnBhcmVuID0gMHgyNGFkOwogIHQucnJhYmVuZ2FsaSA9IDB4MDlkYzsKICB0LnJyYWRldmEgPSAweDA5MzE7CiAgdC5ycmFndXJtdWtoaSA9IDB4MGE1YzsKICB0LnJyZWhhcmFiaWMgPSAweDA2OTE7CiAgdC5ycmVoZmluYWxhcmFiaWMgPSAweGZiOGQ7CiAgdC5ycnZvY2FsaWNiZW5nYWxpID0gMHgwOWUwOwogIHQucnJ2b2NhbGljZGV2YSA9IDB4MDk2MDsKICB0LnJydm9jYWxpY2d1amFyYXRpID0gMHgwYWUwOwogIHQucnJ2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljNDsKICB0LnJydm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NDQ7CiAgdC5ycnZvY2FsaWN2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjNDsKICB0LnJzdXBlcmlvciA9IDB4ZjZmMTsKICB0LnJ0YmxvY2sgPSAweDI1OTA7CiAgdC5ydHVybmVkID0gMHgwMjc5OwogIHQucnR1cm5lZHN1cGVyaW9yID0gMHgwMmI0OwogIHQucnVoaXJhZ2FuYSA9IDB4MzA4YjsKICB0LnJ1a2F0YWthbmEgPSAweDMwZWI7CiAgdC5ydWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk5OwogIHQucnVwZWVtYXJrYmVuZ2FsaSA9IDB4MDlmMjsKICB0LnJ1cGVlc2lnbmJlbmdhbGkgPSAweDA5ZjM7CiAgdC5ydXBpYWggPSAweGY2ZGQ7CiAgdC5ydXRoYWkgPSAweDBlMjQ7CiAgdC5ydm9jYWxpY2JlbmdhbGkgPSAweDA5OGI7CiAgdC5ydm9jYWxpY2RldmEgPSAweDA5MGI7CiAgdC5ydm9jYWxpY2d1amFyYXRpID0gMHgwYThiOwogIHQucnZvY2FsaWN2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMzOwogIHQucnZvY2FsaWN2b3dlbHNpZ25kZXZhID0gMHgwOTQzOwogIHQucnZvY2FsaWN2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMzsKICB0LnMgPSAweDAwNzM7CiAgdC5zYWJlbmdhbGkgPSAweDA5Yjg7CiAgdC5zYWN1dGUgPSAweDAxNWI7CiAgdC5zYWN1dGVkb3RhY2NlbnQgPSAweDFlNjU7CiAgdC5zYWRhcmFiaWMgPSAweDA2MzU7CiAgdC5zYWRldmEgPSAweDA5Mzg7CiAgdC5zYWRmaW5hbGFyYWJpYyA9IDB4ZmViYTsKICB0LnNhZGluaXRpYWxhcmFiaWMgPSAweGZlYmI7CiAgdC5zYWRtZWRpYWxhcmFiaWMgPSAweGZlYmM7CiAgdC5zYWd1amFyYXRpID0gMHgwYWI4OwogIHQuc2FndXJtdWtoaSA9IDB4MGEzODsKICB0LnNhaGlyYWdhbmEgPSAweDMwNTU7CiAgdC5zYWthdGFrYW5hID0gMHgzMGI1OwogIHQuc2FrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3YjsKICB0LnNhbGxhbGxhaG91YWxheWhld2FzYWxsYW1hcmFiaWMgPSAweGZkZmE7CiAgdC5zYW1la2ggPSAweDA1ZTE7CiAgdC5zYW1la2hkYWdlc2ggPSAweGZiNDE7CiAgdC5zYW1la2hkYWdlc2hoZWJyZXcgPSAweGZiNDE7CiAgdC5zYW1la2hoZWJyZXcgPSAweDA1ZTE7CiAgdC5zYXJhYWF0aGFpID0gMHgwZTMyOwogIHQuc2FyYWFldGhhaSA9IDB4MGU0MTsKICB0LnNhcmFhaW1haW1hbGFpdGhhaSA9IDB4MGU0NDsKICB0LnNhcmFhaW1haW11YW50aGFpID0gMHgwZTQzOwogIHQuc2FyYWFtdGhhaSA9IDB4MGUzMzsKICB0LnNhcmFhdGhhaSA9IDB4MGUzMDsKICB0LnNhcmFldGhhaSA9IDB4MGU0MDsKICB0LnNhcmFpaWxlZnR0aGFpID0gMHhmODg2OwogIHQuc2FyYWlpdGhhaSA9IDB4MGUzNTsKICB0LnNhcmFpbGVmdHRoYWkgPSAweGY4ODU7CiAgdC5zYXJhaXRoYWkgPSAweDBlMzQ7CiAgdC5zYXJhb3RoYWkgPSAweDBlNDI7CiAgdC5zYXJhdWVlbGVmdHRoYWkgPSAweGY4ODg7CiAgdC5zYXJhdWVldGhhaSA9IDB4MGUzNzsKICB0LnNhcmF1ZWxlZnR0aGFpID0gMHhmODg3OwogIHQuc2FyYXVldGhhaSA9IDB4MGUzNjsKICB0LnNhcmF1dGhhaSA9IDB4MGUzODsKICB0LnNhcmF1dXRoYWkgPSAweDBlMzk7CiAgdC5zYm9wb21vZm8gPSAweDMxMTk7CiAgdC5zY2Fyb24gPSAweDAxNjE7CiAgdC5zY2Fyb25kb3RhY2NlbnQgPSAweDFlNjc7CiAgdC5zY2VkaWxsYSA9IDB4MDE1ZjsKICB0LnNjaHdhID0gMHgwMjU5OwogIHQuc2Nod2FjeXJpbGxpYyA9IDB4MDRkOTsKICB0LnNjaHdhZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkYjsKICB0LnNjaHdhaG9vayA9IDB4MDI1YTsKICB0LnNjaXJjbGUgPSAweDI0ZTI7CiAgdC5zY2lyY3VtZmxleCA9IDB4MDE1ZDsKICB0LnNjb21tYWFjY2VudCA9IDB4MDIxOTsKICB0LnNkb3RhY2NlbnQgPSAweDFlNjE7CiAgdC5zZG90YmVsb3cgPSAweDFlNjM7CiAgdC5zZG90YmVsb3dkb3RhY2NlbnQgPSAweDFlNjk7CiAgdC5zZWFndWxsYmVsb3djbWIgPSAweDAzM2M7CiAgdC5zZWNvbmQgPSAweDIwMzM7CiAgdC5zZWNvbmR0b25lY2hpbmVzZSA9IDB4MDJjYTsKICB0LnNlY3Rpb24gPSAweDAwYTc7CiAgdC5zZWVuYXJhYmljID0gMHgwNjMzOwogIHQuc2VlbmZpbmFsYXJhYmljID0gMHhmZWIyOwogIHQuc2VlbmluaXRpYWxhcmFiaWMgPSAweGZlYjM7CiAgdC5zZWVubWVkaWFsYXJhYmljID0gMHhmZWI0OwogIHQuc2Vnb2wgPSAweDA1YjY7CiAgdC5zZWdvbDEzID0gMHgwNWI2OwogIHQuc2Vnb2wxZiA9IDB4MDViNjsKICB0LnNlZ29sMmMgPSAweDA1YjY7CiAgdC5zZWdvbGhlYnJldyA9IDB4MDViNjsKICB0LnNlZ29sbmFycm93aGVicmV3ID0gMHgwNWI2OwogIHQuc2Vnb2xxdWFydGVyaGVicmV3ID0gMHgwNWI2OwogIHQuc2Vnb2x0YWhlYnJldyA9IDB4MDU5MjsKICB0LnNlZ29sd2lkZWhlYnJldyA9IDB4MDViNjsKICB0LnNlaGFybWVuaWFuID0gMHgwNTdkOwogIHQuc2VoaXJhZ2FuYSA9IDB4MzA1YjsKICB0LnNla2F0YWthbmEgPSAweDMwYmI7CiAgdC5zZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjdlOwogIHQuc2VtaWNvbG9uID0gMHgwMDNiOwogIHQuc2VtaWNvbG9uYXJhYmljID0gMHgwNjFiOwogIHQuc2VtaWNvbG9ubW9ub3NwYWNlID0gMHhmZjFiOwogIHQuc2VtaWNvbG9uc21hbGwgPSAweGZlNTQ7CiAgdC5zZW1pdm9pY2VkbWFya2thbmEgPSAweDMwOWM7CiAgdC5zZW1pdm9pY2VkbWFya2thbmFoYWxmd2lkdGggPSAweGZmOWY7CiAgdC5zZW50aXNxdWFyZSA9IDB4MzMyMjsKICB0LnNlbnRvc3F1YXJlID0gMHgzMzIzOwogIHQuc2V2ZW4gPSAweDAwMzc7CiAgdC5zZXZlbmFyYWJpYyA9IDB4MDY2NzsKICB0LnNldmVuYmVuZ2FsaSA9IDB4MDllZDsKICB0LnNldmVuY2lyY2xlID0gMHgyNDY2OwogIHQuc2V2ZW5jaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzkwOwogIHQuc2V2ZW5kZXZhID0gMHgwOTZkOwogIHQuc2V2ZW5laWdodGhzID0gMHgyMTVlOwogIHQuc2V2ZW5ndWphcmF0aSA9IDB4MGFlZDsKICB0LnNldmVuZ3VybXVraGkgPSAweDBhNmQ7CiAgdC5zZXZlbmhhY2thcmFiaWMgPSAweDA2Njc7CiAgdC5zZXZlbmhhbmd6aG91ID0gMHgzMDI3OwogIHQuc2V2ZW5pZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI2OwogIHQuc2V2ZW5pbmZlcmlvciA9IDB4MjA4NzsKICB0LnNldmVubW9ub3NwYWNlID0gMHhmZjE3OwogIHQuc2V2ZW5vbGRzdHlsZSA9IDB4ZjczNzsKICB0LnNldmVucGFyZW4gPSAweDI0N2E7CiAgdC5zZXZlbnBlcmlvZCA9IDB4MjQ4ZTsKICB0LnNldmVucGVyc2lhbiA9IDB4MDZmNzsKICB0LnNldmVucm9tYW4gPSAweDIxNzY7CiAgdC5zZXZlbnN1cGVyaW9yID0gMHgyMDc3OwogIHQuc2V2ZW50ZWVuY2lyY2xlID0gMHgyNDcwOwogIHQuc2V2ZW50ZWVucGFyZW4gPSAweDI0ODQ7CiAgdC5zZXZlbnRlZW5wZXJpb2QgPSAweDI0OTg7CiAgdC5zZXZlbnRoYWkgPSAweDBlNTc7CiAgdC5zZnRoeXBoZW4gPSAweDAwYWQ7CiAgdC5zaGFhcm1lbmlhbiA9IDB4MDU3NzsKICB0LnNoYWJlbmdhbGkgPSAweDA5YjY7CiAgdC5zaGFjeXJpbGxpYyA9IDB4MDQ0ODsKICB0LnNoYWRkYWFyYWJpYyA9IDB4MDY1MTsKICB0LnNoYWRkYWRhbW1hYXJhYmljID0gMHhmYzYxOwogIHQuc2hhZGRhZGFtbWF0YW5hcmFiaWMgPSAweGZjNWU7CiAgdC5zaGFkZGFmYXRoYWFyYWJpYyA9IDB4ZmM2MDsKICB0LnNoYWRkYWthc3JhYXJhYmljID0gMHhmYzYyOwogIHQuc2hhZGRha2FzcmF0YW5hcmFiaWMgPSAweGZjNWY7CiAgdC5zaGFkZSA9IDB4MjU5MjsKICB0LnNoYWRlZGFyayA9IDB4MjU5MzsKICB0LnNoYWRlbGlnaHQgPSAweDI1OTE7CiAgdC5zaGFkZW1lZGl1bSA9IDB4MjU5MjsKICB0LnNoYWRldmEgPSAweDA5MzY7CiAgdC5zaGFndWphcmF0aSA9IDB4MGFiNjsKICB0LnNoYWd1cm11a2hpID0gMHgwYTM2OwogIHQuc2hhbHNoZWxldGhlYnJldyA9IDB4MDU5MzsKICB0LnNoYm9wb21vZm8gPSAweDMxMTU7CiAgdC5zaGNoYWN5cmlsbGljID0gMHgwNDQ5OwogIHQuc2hlZW5hcmFiaWMgPSAweDA2MzQ7CiAgdC5zaGVlbmZpbmFsYXJhYmljID0gMHhmZWI2OwogIHQuc2hlZW5pbml0aWFsYXJhYmljID0gMHhmZWI3OwogIHQuc2hlZW5tZWRpYWxhcmFiaWMgPSAweGZlYjg7CiAgdC5zaGVpY29wdGljID0gMHgwM2UzOwogIHQuc2hlcWVsID0gMHgyMGFhOwogIHQuc2hlcWVsaGVicmV3ID0gMHgyMGFhOwogIHQuc2hldmEgPSAweDA1YjA7CiAgdC5zaGV2YTExNSA9IDB4MDViMDsKICB0LnNoZXZhMTUgPSAweDA1YjA7CiAgdC5zaGV2YTIyID0gMHgwNWIwOwogIHQuc2hldmEyZSA9IDB4MDViMDsKICB0LnNoZXZhaGVicmV3ID0gMHgwNWIwOwogIHQuc2hldmFuYXJyb3doZWJyZXcgPSAweDA1YjA7CiAgdC5zaGV2YXF1YXJ0ZXJoZWJyZXcgPSAweDA1YjA7CiAgdC5zaGV2YXdpZGVoZWJyZXcgPSAweDA1YjA7CiAgdC5zaGhhY3lyaWxsaWMgPSAweDA0YmI7CiAgdC5zaGltYWNvcHRpYyA9IDB4MDNlZDsKICB0LnNoaW4gPSAweDA1ZTk7CiAgdC5zaGluZGFnZXNoID0gMHhmYjQ5OwogIHQuc2hpbmRhZ2VzaGhlYnJldyA9IDB4ZmI0OTsKICB0LnNoaW5kYWdlc2hzaGluZG90ID0gMHhmYjJjOwogIHQuc2hpbmRhZ2VzaHNoaW5kb3RoZWJyZXcgPSAweGZiMmM7CiAgdC5zaGluZGFnZXNoc2luZG90ID0gMHhmYjJkOwogIHQuc2hpbmRhZ2VzaHNpbmRvdGhlYnJldyA9IDB4ZmIyZDsKICB0LnNoaW5kb3RoZWJyZXcgPSAweDA1YzE7CiAgdC5zaGluaGVicmV3ID0gMHgwNWU5OwogIHQuc2hpbnNoaW5kb3QgPSAweGZiMmE7CiAgdC5zaGluc2hpbmRvdGhlYnJldyA9IDB4ZmIyYTsKICB0LnNoaW5zaW5kb3QgPSAweGZiMmI7CiAgdC5zaGluc2luZG90aGVicmV3ID0gMHhmYjJiOwogIHQuc2hvb2sgPSAweDAyODI7CiAgdC5zaWdtYSA9IDB4MDNjMzsKICB0LnNpZ21hMSA9IDB4MDNjMjsKICB0LnNpZ21hZmluYWwgPSAweDAzYzI7CiAgdC5zaWdtYWx1bmF0ZXN5bWJvbGdyZWVrID0gMHgwM2YyOwogIHQuc2loaXJhZ2FuYSA9IDB4MzA1NzsKICB0LnNpa2F0YWthbmEgPSAweDMwYjc7CiAgdC5zaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjdjOwogIHQuc2lsdXFoZWJyZXcgPSAweDA1YmQ7CiAgdC5zaWx1cWxlZnRoZWJyZXcgPSAweDA1YmQ7CiAgdC5zaW1pbGFyID0gMHgyMjNjOwogIHQuc2luZG90aGVicmV3ID0gMHgwNWMyOwogIHQuc2lvc2FjaXJjbGVrb3JlYW4gPSAweDMyNzQ7CiAgdC5zaW9zYXBhcmVua29yZWFuID0gMHgzMjE0OwogIHQuc2lvc2NpZXVja29yZWFuID0gMHgzMTdlOwogIHQuc2lvc2NpcmNsZWtvcmVhbiA9IDB4MzI2NjsKICB0LnNpb3NraXllb2trb3JlYW4gPSAweDMxN2E7CiAgdC5zaW9za29yZWFuID0gMHgzMTQ1OwogIHQuc2lvc25pZXVua29yZWFuID0gMHgzMTdiOwogIHQuc2lvc3BhcmVua29yZWFuID0gMHgzMjA2OwogIHQuc2lvc3BpZXVwa29yZWFuID0gMHgzMTdkOwogIHQuc2lvc3Rpa2V1dGtvcmVhbiA9IDB4MzE3YzsKICB0LnNpeCA9IDB4MDAzNjsKICB0LnNpeGFyYWJpYyA9IDB4MDY2NjsKICB0LnNpeGJlbmdhbGkgPSAweDA5ZWM7CiAgdC5zaXhjaXJjbGUgPSAweDI0NjU7CiAgdC5zaXhjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhmOwogIHQuc2l4ZGV2YSA9IDB4MDk2YzsKICB0LnNpeGd1amFyYXRpID0gMHgwYWVjOwogIHQuc2l4Z3VybXVraGkgPSAweDBhNmM7CiAgdC5zaXhoYWNrYXJhYmljID0gMHgwNjY2OwogIHQuc2l4aGFuZ3pob3UgPSAweDMwMjY7CiAgdC5zaXhpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI1OwogIHQuc2l4aW5mZXJpb3IgPSAweDIwODY7CiAgdC5zaXhtb25vc3BhY2UgPSAweGZmMTY7CiAgdC5zaXhvbGRzdHlsZSA9IDB4ZjczNjsKICB0LnNpeHBhcmVuID0gMHgyNDc5OwogIHQuc2l4cGVyaW9kID0gMHgyNDhkOwogIHQuc2l4cGVyc2lhbiA9IDB4MDZmNjsKICB0LnNpeHJvbWFuID0gMHgyMTc1OwogIHQuc2l4c3VwZXJpb3IgPSAweDIwNzY7CiAgdC5zaXh0ZWVuY2lyY2xlID0gMHgyNDZmOwogIHQuc2l4dGVlbmN1cnJlbmN5ZGVub21pbmF0b3JiZW5nYWxpID0gMHgwOWY5OwogIHQuc2l4dGVlbnBhcmVuID0gMHgyNDgzOwogIHQuc2l4dGVlbnBlcmlvZCA9IDB4MjQ5NzsKICB0LnNpeHRoYWkgPSAweDBlNTY7CiAgdC5zbGFzaCA9IDB4MDAyZjsKICB0LnNsYXNobW9ub3NwYWNlID0gMHhmZjBmOwogIHQuc2xvbmcgPSAweDAxN2Y7CiAgdC5zbG9uZ2RvdGFjY2VudCA9IDB4MWU5YjsKICB0LnNtaWxlZmFjZSA9IDB4MjYzYTsKICB0LnNtb25vc3BhY2UgPSAweGZmNTM7CiAgdC5zb2ZwYXN1cWhlYnJldyA9IDB4MDVjMzsKICB0LnNvZnRoeXBoZW4gPSAweDAwYWQ7CiAgdC5zb2Z0c2lnbmN5cmlsbGljID0gMHgwNDRjOwogIHQuc29oaXJhZ2FuYSA9IDB4MzA1ZDsKICB0LnNva2F0YWthbmEgPSAweDMwYmQ7CiAgdC5zb2thdGFrYW5haGFsZndpZHRoID0gMHhmZjdmOwogIHQuc29saWR1c2xvbmdvdmVybGF5Y21iID0gMHgwMzM4OwogIHQuc29saWR1c3Nob3J0b3ZlcmxheWNtYiA9IDB4MDMzNzsKICB0LnNvcnVzaXRoYWkgPSAweDBlMjk7CiAgdC5zb3NhbGF0aGFpID0gMHgwZTI4OwogIHQuc29zb3RoYWkgPSAweDBlMGI7CiAgdC5zb3N1YXRoYWkgPSAweDBlMmE7CiAgdC5zcGFjZSA9IDB4MDAyMDsKICB0LnNwYWNlaGFja2FyYWJpYyA9IDB4MDAyMDsKICB0LnNwYWRlID0gMHgyNjYwOwogIHQuc3BhZGVzdWl0YmxhY2sgPSAweDI2NjA7CiAgdC5zcGFkZXN1aXR3aGl0ZSA9IDB4MjY2NDsKICB0LnNwYXJlbiA9IDB4MjRhZTsKICB0LnNxdWFyZWJlbG93Y21iID0gMHgwMzNiOwogIHQuc3F1YXJlY2MgPSAweDMzYzQ7CiAgdC5zcXVhcmVjbSA9IDB4MzM5ZDsKICB0LnNxdWFyZWRpYWdvbmFsY3Jvc3NoYXRjaGZpbGwgPSAweDI1YTk7CiAgdC5zcXVhcmVob3Jpem9udGFsZmlsbCA9IDB4MjVhNDsKICB0LnNxdWFyZWtnID0gMHgzMzhmOwogIHQuc3F1YXJla20gPSAweDMzOWU7CiAgdC5zcXVhcmVrbWNhcGl0YWwgPSAweDMzY2U7CiAgdC5zcXVhcmVsbiA9IDB4MzNkMTsKICB0LnNxdWFyZWxvZyA9IDB4MzNkMjsKICB0LnNxdWFyZW1nID0gMHgzMzhlOwogIHQuc3F1YXJlbWlsID0gMHgzM2Q1OwogIHQuc3F1YXJlbW0gPSAweDMzOWM7CiAgdC5zcXVhcmVtc3F1YXJlZCA9IDB4MzNhMTsKICB0LnNxdWFyZW9ydGhvZ29uYWxjcm9zc2hhdGNoZmlsbCA9IDB4MjVhNjsKICB0LnNxdWFyZXVwcGVybGVmdHRvbG93ZXJyaWdodGZpbGwgPSAweDI1YTc7CiAgdC5zcXVhcmV1cHBlcnJpZ2h0dG9sb3dlcmxlZnRmaWxsID0gMHgyNWE4OwogIHQuc3F1YXJldmVydGljYWxmaWxsID0gMHgyNWE1OwogIHQuc3F1YXJld2hpdGV3aXRoc21hbGxibGFjayA9IDB4MjVhMzsKICB0LnNyc3F1YXJlID0gMHgzM2RiOwogIHQuc3NhYmVuZ2FsaSA9IDB4MDliNzsKICB0LnNzYWRldmEgPSAweDA5Mzc7CiAgdC5zc2FndWphcmF0aSA9IDB4MGFiNzsKICB0LnNzYW5nY2lldWNrb3JlYW4gPSAweDMxNDk7CiAgdC5zc2FuZ2hpZXVoa29yZWFuID0gMHgzMTg1OwogIHQuc3NhbmdpZXVuZ2tvcmVhbiA9IDB4MzE4MDsKICB0LnNzYW5na2l5ZW9ra29yZWFuID0gMHgzMTMyOwogIHQuc3NhbmduaWV1bmtvcmVhbiA9IDB4MzE2NTsKICB0LnNzYW5ncGlldXBrb3JlYW4gPSAweDMxNDM7CiAgdC5zc2FuZ3Npb3Nrb3JlYW4gPSAweDMxNDY7CiAgdC5zc2FuZ3Rpa2V1dGtvcmVhbiA9IDB4MzEzODsKICB0LnNzdXBlcmlvciA9IDB4ZjZmMjsKICB0LnN0ZXJsaW5nID0gMHgwMGEzOwogIHQuc3Rlcmxpbmdtb25vc3BhY2UgPSAweGZmZTE7CiAgdC5zdHJva2Vsb25nb3ZlcmxheWNtYiA9IDB4MDMzNjsKICB0LnN0cm9rZXNob3J0b3ZlcmxheWNtYiA9IDB4MDMzNTsKICB0LnN1YnNldCA9IDB4MjI4MjsKICB0LnN1YnNldG5vdGVxdWFsID0gMHgyMjhhOwogIHQuc3Vic2V0b3JlcXVhbCA9IDB4MjI4NjsKICB0LnN1Y2NlZWRzID0gMHgyMjdiOwogIHQuc3VjaHRoYXQgPSAweDIyMGI7CiAgdC5zdWhpcmFnYW5hID0gMHgzMDU5OwogIHQuc3VrYXRha2FuYSA9IDB4MzBiOTsKICB0LnN1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmN2Q7CiAgdC5zdWt1bmFyYWJpYyA9IDB4MDY1MjsKICB0LnN1bW1hdGlvbiA9IDB4MjIxMTsKICB0LnN1biA9IDB4MjYzYzsKICB0LnN1cGVyc2V0ID0gMHgyMjgzOwogIHQuc3VwZXJzZXRub3RlcXVhbCA9IDB4MjI4YjsKICB0LnN1cGVyc2V0b3JlcXVhbCA9IDB4MjI4NzsKICB0LnN2c3F1YXJlID0gMHgzM2RjOwogIHQuc3lvdXdhZXJhc3F1YXJlID0gMHgzMzdjOwogIHQudCA9IDB4MDA3NDsKICB0LnRhYmVuZ2FsaSA9IDB4MDlhNDsKICB0LnRhY2tkb3duID0gMHgyMmE0OwogIHQudGFja2xlZnQgPSAweDIyYTM7CiAgdC50YWRldmEgPSAweDA5MjQ7CiAgdC50YWd1amFyYXRpID0gMHgwYWE0OwogIHQudGFndXJtdWtoaSA9IDB4MGEyNDsKICB0LnRhaGFyYWJpYyA9IDB4MDYzNzsKICB0LnRhaGZpbmFsYXJhYmljID0gMHhmZWMyOwogIHQudGFoaW5pdGlhbGFyYWJpYyA9IDB4ZmVjMzsKICB0LnRhaGlyYWdhbmEgPSAweDMwNWY7CiAgdC50YWhtZWRpYWxhcmFiaWMgPSAweGZlYzQ7CiAgdC50YWlzeW91ZXJhc3F1YXJlID0gMHgzMzdkOwogIHQudGFrYXRha2FuYSA9IDB4MzBiZjsKICB0LnRha2F0YWthbmFoYWxmd2lkdGggPSAweGZmODA7CiAgdC50YXR3ZWVsYXJhYmljID0gMHgwNjQwOwogIHQudGF1ID0gMHgwM2M0OwogIHQudGF2ID0gMHgwNWVhOwogIHQudGF2ZGFnZXMgPSAweGZiNGE7CiAgdC50YXZkYWdlc2ggPSAweGZiNGE7CiAgdC50YXZkYWdlc2hoZWJyZXcgPSAweGZiNGE7CiAgdC50YXZoZWJyZXcgPSAweDA1ZWE7CiAgdC50YmFyID0gMHgwMTY3OwogIHQudGJvcG9tb2ZvID0gMHgzMTBhOwogIHQudGNhcm9uID0gMHgwMTY1OwogIHQudGNjdXJsID0gMHgwMmE4OwogIHQudGNlZGlsbGEgPSAweDAxNjM7CiAgdC50Y2hlaGFyYWJpYyA9IDB4MDY4NjsKICB0LnRjaGVoZmluYWxhcmFiaWMgPSAweGZiN2I7CiAgdC50Y2hlaGluaXRpYWxhcmFiaWMgPSAweGZiN2M7CiAgdC50Y2hlaG1lZGlhbGFyYWJpYyA9IDB4ZmI3ZDsKICB0LnRjaXJjbGUgPSAweDI0ZTM7CiAgdC50Y2lyY3VtZmxleGJlbG93ID0gMHgxZTcxOwogIHQudGNvbW1hYWNjZW50ID0gMHgwMTYzOwogIHQudGRpZXJlc2lzID0gMHgxZTk3OwogIHQudGRvdGFjY2VudCA9IDB4MWU2YjsKICB0LnRkb3RiZWxvdyA9IDB4MWU2ZDsKICB0LnRlY3lyaWxsaWMgPSAweDA0NDI7CiAgdC50ZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFkOwogIHQudGVoYXJhYmljID0gMHgwNjJhOwogIHQudGVoZmluYWxhcmFiaWMgPSAweGZlOTY7CiAgdC50ZWhoYWhpbml0aWFsYXJhYmljID0gMHhmY2EyOwogIHQudGVoaGFoaXNvbGF0ZWRhcmFiaWMgPSAweGZjMGM7CiAgdC50ZWhpbml0aWFsYXJhYmljID0gMHhmZTk3OwogIHQudGVoaXJhZ2FuYSA9IDB4MzA2NjsKICB0LnRlaGplZW1pbml0aWFsYXJhYmljID0gMHhmY2ExOwogIHQudGVoamVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzBiOwogIHQudGVobWFyYnV0YWFyYWJpYyA9IDB4MDYyOTsKICB0LnRlaG1hcmJ1dGFmaW5hbGFyYWJpYyA9IDB4ZmU5NDsKICB0LnRlaG1lZGlhbGFyYWJpYyA9IDB4ZmU5ODsKICB0LnRlaG1lZW1pbml0aWFsYXJhYmljID0gMHhmY2E0OwogIHQudGVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzBlOwogIHQudGVobm9vbmZpbmFsYXJhYmljID0gMHhmYzczOwogIHQudGVrYXRha2FuYSA9IDB4MzBjNjsKICB0LnRla2F0YWthbmFoYWxmd2lkdGggPSAweGZmODM7CiAgdC50ZWxlcGhvbmUgPSAweDIxMjE7CiAgdC50ZWxlcGhvbmVibGFjayA9IDB4MjYwZTsKICB0LnRlbGlzaGFnZWRvbGFoZWJyZXcgPSAweDA1YTA7CiAgdC50ZWxpc2hhcWV0YW5haGVicmV3ID0gMHgwNWE5OwogIHQudGVuY2lyY2xlID0gMHgyNDY5OwogIHQudGVuaWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyOTsKICB0LnRlbnBhcmVuID0gMHgyNDdkOwogIHQudGVucGVyaW9kID0gMHgyNDkxOwogIHQudGVucm9tYW4gPSAweDIxNzk7CiAgdC50ZXNoID0gMHgwMmE3OwogIHQudGV0ID0gMHgwNWQ4OwogIHQudGV0ZGFnZXNoID0gMHhmYjM4OwogIHQudGV0ZGFnZXNoaGVicmV3ID0gMHhmYjM4OwogIHQudGV0aGVicmV3ID0gMHgwNWQ4OwogIHQudGV0c2VjeXJpbGxpYyA9IDB4MDRiNTsKICB0LnRldmlyaGVicmV3ID0gMHgwNTliOwogIHQudGV2aXJsZWZ0aGVicmV3ID0gMHgwNTliOwogIHQudGhhYmVuZ2FsaSA9IDB4MDlhNTsKICB0LnRoYWRldmEgPSAweDA5MjU7CiAgdC50aGFndWphcmF0aSA9IDB4MGFhNTsKICB0LnRoYWd1cm11a2hpID0gMHgwYTI1OwogIHQudGhhbGFyYWJpYyA9IDB4MDYzMDsKICB0LnRoYWxmaW5hbGFyYWJpYyA9IDB4ZmVhYzsKICB0LnRoYW50aGFraGF0bG93bGVmdHRoYWkgPSAweGY4OTg7CiAgdC50aGFudGhha2hhdGxvd3JpZ2h0dGhhaSA9IDB4Zjg5NzsKICB0LnRoYW50aGFraGF0dGhhaSA9IDB4MGU0YzsKICB0LnRoYW50aGFraGF0dXBwZXJsZWZ0dGhhaSA9IDB4Zjg5NjsKICB0LnRoZWhhcmFiaWMgPSAweDA2MmI7CiAgdC50aGVoZmluYWxhcmFiaWMgPSAweGZlOWE7CiAgdC50aGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmU5YjsKICB0LnRoZWhtZWRpYWxhcmFiaWMgPSAweGZlOWM7CiAgdC50aGVyZWV4aXN0cyA9IDB4MjIwMzsKICB0LnRoZXJlZm9yZSA9IDB4MjIzNDsKICB0LnRoZXRhID0gMHgwM2I4OwogIHQudGhldGExID0gMHgwM2QxOwogIHQudGhldGFzeW1ib2xncmVlayA9IDB4MDNkMTsKICB0LnRoaWV1dGhhY2lyY2xla29yZWFuID0gMHgzMjc5OwogIHQudGhpZXV0aGFwYXJlbmtvcmVhbiA9IDB4MzIxOTsKICB0LnRoaWV1dGhjaXJjbGVrb3JlYW4gPSAweDMyNmI7CiAgdC50aGlldXRoa29yZWFuID0gMHgzMTRjOwogIHQudGhpZXV0aHBhcmVua29yZWFuID0gMHgzMjBiOwogIHQudGhpcnRlZW5jaXJjbGUgPSAweDI0NmM7CiAgdC50aGlydGVlbnBhcmVuID0gMHgyNDgwOwogIHQudGhpcnRlZW5wZXJpb2QgPSAweDI0OTQ7CiAgdC50aG9uYW5nbW9udGhvdGhhaSA9IDB4MGUxMTsKICB0LnRob29rID0gMHgwMWFkOwogIHQudGhvcGh1dGhhb3RoYWkgPSAweDBlMTI7CiAgdC50aG9ybiA9IDB4MDBmZTsKICB0LnRob3RoYWhhbnRoYWkgPSAweDBlMTc7CiAgdC50aG90aGFudGhhaSA9IDB4MGUxMDsKICB0LnRob3Rob25ndGhhaSA9IDB4MGUxODsKICB0LnRob3RodW5ndGhhaSA9IDB4MGUxNjsKICB0LnRob3VzYW5kY3lyaWxsaWMgPSAweDA0ODI7CiAgdC50aG91c2FuZHNzZXBhcmF0b3JhcmFiaWMgPSAweDA2NmM7CiAgdC50aG91c2FuZHNzZXBhcmF0b3JwZXJzaWFuID0gMHgwNjZjOwogIHQudGhyZWUgPSAweDAwMzM7CiAgdC50aHJlZWFyYWJpYyA9IDB4MDY2MzsKICB0LnRocmVlYmVuZ2FsaSA9IDB4MDllOTsKICB0LnRocmVlY2lyY2xlID0gMHgyNDYyOwogIHQudGhyZWVjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhjOwogIHQudGhyZWVkZXZhID0gMHgwOTY5OwogIHQudGhyZWVlaWdodGhzID0gMHgyMTVjOwogIHQudGhyZWVndWphcmF0aSA9IDB4MGFlOTsKICB0LnRocmVlZ3VybXVraGkgPSAweDBhNjk7CiAgdC50aHJlZWhhY2thcmFiaWMgPSAweDA2NjM7CiAgdC50aHJlZWhhbmd6aG91ID0gMHgzMDIzOwogIHQudGhyZWVpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjIyOwogIHQudGhyZWVpbmZlcmlvciA9IDB4MjA4MzsKICB0LnRocmVlbW9ub3NwYWNlID0gMHhmZjEzOwogIHQudGhyZWVudW1lcmF0b3JiZW5nYWxpID0gMHgwOWY2OwogIHQudGhyZWVvbGRzdHlsZSA9IDB4ZjczMzsKICB0LnRocmVlcGFyZW4gPSAweDI0NzY7CiAgdC50aHJlZXBlcmlvZCA9IDB4MjQ4YTsKICB0LnRocmVlcGVyc2lhbiA9IDB4MDZmMzsKICB0LnRocmVlcXVhcnRlcnMgPSAweDAwYmU7CiAgdC50aHJlZXF1YXJ0ZXJzZW1kYXNoID0gMHhmNmRlOwogIHQudGhyZWVyb21hbiA9IDB4MjE3MjsKICB0LnRocmVlc3VwZXJpb3IgPSAweDAwYjM7CiAgdC50aHJlZXRoYWkgPSAweDBlNTM7CiAgdC50aHpzcXVhcmUgPSAweDMzOTQ7CiAgdC50aWhpcmFnYW5hID0gMHgzMDYxOwogIHQudGlrYXRha2FuYSA9IDB4MzBjMTsKICB0LnRpa2F0YWthbmFoYWxmd2lkdGggPSAweGZmODE7CiAgdC50aWtldXRhY2lyY2xla29yZWFuID0gMHgzMjcwOwogIHQudGlrZXV0YXBhcmVua29yZWFuID0gMHgzMjEwOwogIHQudGlrZXV0Y2lyY2xla29yZWFuID0gMHgzMjYyOwogIHQudGlrZXV0a29yZWFuID0gMHgzMTM3OwogIHQudGlrZXV0cGFyZW5rb3JlYW4gPSAweDMyMDI7CiAgdC50aWxkZSA9IDB4MDJkYzsKICB0LnRpbGRlYmVsb3djbWIgPSAweDAzMzA7CiAgdC50aWxkZWNtYiA9IDB4MDMwMzsKICB0LnRpbGRlY29tYiA9IDB4MDMwMzsKICB0LnRpbGRlZG91YmxlY21iID0gMHgwMzYwOwogIHQudGlsZGVvcGVyYXRvciA9IDB4MjIzYzsKICB0LnRpbGRlb3ZlcmxheWNtYiA9IDB4MDMzNDsKICB0LnRpbGRldmVydGljYWxjbWIgPSAweDAzM2U7CiAgdC50aW1lc2NpcmNsZSA9IDB4MjI5NzsKICB0LnRpcGVoYWhlYnJldyA9IDB4MDU5NjsKICB0LnRpcGVoYWxlZnRoZWJyZXcgPSAweDA1OTY7CiAgdC50aXBwaWd1cm11a2hpID0gMHgwYTcwOwogIHQudGl0bG9jeXJpbGxpY2NtYiA9IDB4MDQ4MzsKICB0LnRpd25hcm1lbmlhbiA9IDB4MDU3ZjsKICB0LnRsaW5lYmVsb3cgPSAweDFlNmY7CiAgdC50bW9ub3NwYWNlID0gMHhmZjU0OwogIHQudG9hcm1lbmlhbiA9IDB4MDU2OTsKICB0LnRvaGlyYWdhbmEgPSAweDMwNjg7CiAgdC50b2thdGFrYW5hID0gMHgzMGM4OwogIHQudG9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4NDsKICB0LnRvbmViYXJleHRyYWhpZ2htb2QgPSAweDAyZTU7CiAgdC50b25lYmFyZXh0cmFsb3dtb2QgPSAweDAyZTk7CiAgdC50b25lYmFyaGlnaG1vZCA9IDB4MDJlNjsKICB0LnRvbmViYXJsb3dtb2QgPSAweDAyZTg7CiAgdC50b25lYmFybWlkbW9kID0gMHgwMmU3OwogIHQudG9uZWZpdmUgPSAweDAxYmQ7CiAgdC50b25lc2l4ID0gMHgwMTg1OwogIHQudG9uZXR3byA9IDB4MDFhODsKICB0LnRvbm9zID0gMHgwMzg0OwogIHQudG9uc3F1YXJlID0gMHgzMzI3OwogIHQudG9wYXRha3RoYWkgPSAweDBlMGY7CiAgdC50b3J0b2lzZXNoZWxsYnJhY2tldGxlZnQgPSAweDMwMTQ7CiAgdC50b3J0b2lzZXNoZWxsYnJhY2tldGxlZnRzbWFsbCA9IDB4ZmU1ZDsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTM5OwogIHQudG9ydG9pc2VzaGVsbGJyYWNrZXRyaWdodCA9IDB4MzAxNTsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHRzbWFsbCA9IDB4ZmU1ZTsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzYTsKICB0LnRvdGFvdGhhaSA9IDB4MGUxNTsKICB0LnRwYWxhdGFsaG9vayA9IDB4MDFhYjsKICB0LnRwYXJlbiA9IDB4MjRhZjsKICB0LnRyYWRlbWFyayA9IDB4MjEyMjsKICB0LnRyYWRlbWFya3NhbnMgPSAweGY4ZWE7CiAgdC50cmFkZW1hcmtzZXJpZiA9IDB4ZjZkYjsKICB0LnRyZXRyb2ZsZXhob29rID0gMHgwMjg4OwogIHQudHJpYWdkbiA9IDB4MjViYzsKICB0LnRyaWFnbGYgPSAweDI1YzQ7CiAgdC50cmlhZ3J0ID0gMHgyNWJhOwogIHQudHJpYWd1cCA9IDB4MjViMjsKICB0LnRzID0gMHgwMmE2OwogIHQudHNhZGkgPSAweDA1ZTY7CiAgdC50c2FkaWRhZ2VzaCA9IDB4ZmI0NjsKICB0LnRzYWRpZGFnZXNoaGVicmV3ID0gMHhmYjQ2OwogIHQudHNhZGloZWJyZXcgPSAweDA1ZTY7CiAgdC50c2VjeXJpbGxpYyA9IDB4MDQ0NjsKICB0LnRzZXJlID0gMHgwNWI1OwogIHQudHNlcmUxMiA9IDB4MDViNTsKICB0LnRzZXJlMWUgPSAweDA1YjU7CiAgdC50c2VyZTJiID0gMHgwNWI1OwogIHQudHNlcmVoZWJyZXcgPSAweDA1YjU7CiAgdC50c2VyZW5hcnJvd2hlYnJldyA9IDB4MDViNTsKICB0LnRzZXJlcXVhcnRlcmhlYnJldyA9IDB4MDViNTsKICB0LnRzZXJld2lkZWhlYnJldyA9IDB4MDViNTsKICB0LnRzaGVjeXJpbGxpYyA9IDB4MDQ1YjsKICB0LnRzdXBlcmlvciA9IDB4ZjZmMzsKICB0LnR0YWJlbmdhbGkgPSAweDA5OWY7CiAgdC50dGFkZXZhID0gMHgwOTFmOwogIHQudHRhZ3VqYXJhdGkgPSAweDBhOWY7CiAgdC50dGFndXJtdWtoaSA9IDB4MGExZjsKICB0LnR0ZWhhcmFiaWMgPSAweDA2Nzk7CiAgdC50dGVoZmluYWxhcmFiaWMgPSAweGZiNjc7CiAgdC50dGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI2ODsKICB0LnR0ZWhtZWRpYWxhcmFiaWMgPSAweGZiNjk7CiAgdC50dGhhYmVuZ2FsaSA9IDB4MDlhMDsKICB0LnR0aGFkZXZhID0gMHgwOTIwOwogIHQudHRoYWd1amFyYXRpID0gMHgwYWEwOwogIHQudHRoYWd1cm11a2hpID0gMHgwYTIwOwogIHQudHR1cm5lZCA9IDB4MDI4NzsKICB0LnR1aGlyYWdhbmEgPSAweDMwNjQ7CiAgdC50dWthdGFrYW5hID0gMHgzMGM0OwogIHQudHVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4MjsKICB0LnR1c21hbGxoaXJhZ2FuYSA9IDB4MzA2MzsKICB0LnR1c21hbGxrYXRha2FuYSA9IDB4MzBjMzsKICB0LnR1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2ZjsKICB0LnR3ZWx2ZWNpcmNsZSA9IDB4MjQ2YjsKICB0LnR3ZWx2ZXBhcmVuID0gMHgyNDdmOwogIHQudHdlbHZlcGVyaW9kID0gMHgyNDkzOwogIHQudHdlbHZlcm9tYW4gPSAweDIxN2I7CiAgdC50d2VudHljaXJjbGUgPSAweDI0NzM7CiAgdC50d2VudHloYW5nemhvdSA9IDB4NTM0NDsKICB0LnR3ZW50eXBhcmVuID0gMHgyNDg3OwogIHQudHdlbnR5cGVyaW9kID0gMHgyNDliOwogIHQudHdvID0gMHgwMDMyOwogIHQudHdvYXJhYmljID0gMHgwNjYyOwogIHQudHdvYmVuZ2FsaSA9IDB4MDllODsKICB0LnR3b2NpcmNsZSA9IDB4MjQ2MTsKICB0LnR3b2NpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGI7CiAgdC50d29kZXZhID0gMHgwOTY4OwogIHQudHdvZG90ZW5sZWFkZXIgPSAweDIwMjU7CiAgdC50d29kb3RsZWFkZXIgPSAweDIwMjU7CiAgdC50d29kb3RsZWFkZXJ2ZXJ0aWNhbCA9IDB4ZmUzMDsKICB0LnR3b2d1amFyYXRpID0gMHgwYWU4OwogIHQudHdvZ3VybXVraGkgPSAweDBhNjg7CiAgdC50d29oYWNrYXJhYmljID0gMHgwNjYyOwogIHQudHdvaGFuZ3pob3UgPSAweDMwMjI7CiAgdC50d29pZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjIxOwogIHQudHdvaW5mZXJpb3IgPSAweDIwODI7CiAgdC50d29tb25vc3BhY2UgPSAweGZmMTI7CiAgdC50d29udW1lcmF0b3JiZW5nYWxpID0gMHgwOWY1OwogIHQudHdvb2xkc3R5bGUgPSAweGY3MzI7CiAgdC50d29wYXJlbiA9IDB4MjQ3NTsKICB0LnR3b3BlcmlvZCA9IDB4MjQ4OTsKICB0LnR3b3BlcnNpYW4gPSAweDA2ZjI7CiAgdC50d29yb21hbiA9IDB4MjE3MTsKICB0LnR3b3N0cm9rZSA9IDB4MDFiYjsKICB0LnR3b3N1cGVyaW9yID0gMHgwMGIyOwogIHQudHdvdGhhaSA9IDB4MGU1MjsKICB0LnR3b3RoaXJkcyA9IDB4MjE1NDsKICB0LnUgPSAweDAwNzU7CiAgdC51YWN1dGUgPSAweDAwZmE7CiAgdC51YmFyID0gMHgwMjg5OwogIHQudWJlbmdhbGkgPSAweDA5ODk7CiAgdC51Ym9wb21vZm8gPSAweDMxMjg7CiAgdC51YnJldmUgPSAweDAxNmQ7CiAgdC51Y2Fyb24gPSAweDAxZDQ7CiAgdC51Y2lyY2xlID0gMHgyNGU0OwogIHQudWNpcmN1bWZsZXggPSAweDAwZmI7CiAgdC51Y2lyY3VtZmxleGJlbG93ID0gMHgxZTc3OwogIHQudWN5cmlsbGljID0gMHgwNDQzOwogIHQudWRhdHRhZGV2YSA9IDB4MDk1MTsKICB0LnVkYmxhY3V0ZSA9IDB4MDE3MTsKICB0LnVkYmxncmF2ZSA9IDB4MDIxNTsKICB0LnVkZXZhID0gMHgwOTA5OwogIHQudWRpZXJlc2lzID0gMHgwMGZjOwogIHQudWRpZXJlc2lzYWN1dGUgPSAweDAxZDg7CiAgdC51ZGllcmVzaXNiZWxvdyA9IDB4MWU3MzsKICB0LnVkaWVyZXNpc2Nhcm9uID0gMHgwMWRhOwogIHQudWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZjE7CiAgdC51ZGllcmVzaXNncmF2ZSA9IDB4MDFkYzsKICB0LnVkaWVyZXNpc21hY3JvbiA9IDB4MDFkNjsKICB0LnVkb3RiZWxvdyA9IDB4MWVlNTsKICB0LnVncmF2ZSA9IDB4MDBmOTsKICB0LnVndWphcmF0aSA9IDB4MGE4OTsKICB0LnVndXJtdWtoaSA9IDB4MGEwOTsKICB0LnVoaXJhZ2FuYSA9IDB4MzA0NjsKICB0LnVob29rYWJvdmUgPSAweDFlZTc7CiAgdC51aG9ybiA9IDB4MDFiMDsKICB0LnVob3JuYWN1dGUgPSAweDFlZTk7CiAgdC51aG9ybmRvdGJlbG93ID0gMHgxZWYxOwogIHQudWhvcm5ncmF2ZSA9IDB4MWVlYjsKICB0LnVob3JuaG9va2Fib3ZlID0gMHgxZWVkOwogIHQudWhvcm50aWxkZSA9IDB4MWVlZjsKICB0LnVodW5nYXJ1bWxhdXQgPSAweDAxNzE7CiAgdC51aHVuZ2FydW1sYXV0Y3lyaWxsaWMgPSAweDA0ZjM7CiAgdC51aW52ZXJ0ZWRicmV2ZSA9IDB4MDIxNzsKICB0LnVrYXRha2FuYSA9IDB4MzBhNjsKICB0LnVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3MzsKICB0LnVrY3lyaWxsaWMgPSAweDA0Nzk7CiAgdC51a29yZWFuID0gMHgzMTVjOwogIHQudW1hY3JvbiA9IDB4MDE2YjsKICB0LnVtYWNyb25jeXJpbGxpYyA9IDB4MDRlZjsKICB0LnVtYWNyb25kaWVyZXNpcyA9IDB4MWU3YjsKICB0LnVtYXRyYWd1cm11a2hpID0gMHgwYTQxOwogIHQudW1vbm9zcGFjZSA9IDB4ZmY1NTsKICB0LnVuZGVyc2NvcmUgPSAweDAwNWY7CiAgdC51bmRlcnNjb3JlZGJsID0gMHgyMDE3OwogIHQudW5kZXJzY29yZW1vbm9zcGFjZSA9IDB4ZmYzZjsKICB0LnVuZGVyc2NvcmV2ZXJ0aWNhbCA9IDB4ZmUzMzsKICB0LnVuZGVyc2NvcmV3YXZ5ID0gMHhmZTRmOwogIHQudW5pb24gPSAweDIyMmE7CiAgdC51bml2ZXJzYWwgPSAweDIyMDA7CiAgdC51b2dvbmVrID0gMHgwMTczOwogIHQudXBhcmVuID0gMHgyNGIwOwogIHQudXBibG9jayA9IDB4MjU4MDsKICB0LnVwcGVyZG90aGVicmV3ID0gMHgwNWM0OwogIHQudXBzaWxvbiA9IDB4MDNjNTsKICB0LnVwc2lsb25kaWVyZXNpcyA9IDB4MDNjYjsKICB0LnVwc2lsb25kaWVyZXNpc3Rvbm9zID0gMHgwM2IwOwogIHQudXBzaWxvbmxhdGluID0gMHgwMjhhOwogIHQudXBzaWxvbnRvbm9zID0gMHgwM2NkOwogIHQudXB0YWNrYmVsb3djbWIgPSAweDAzMWQ7CiAgdC51cHRhY2ttb2QgPSAweDAyZDQ7CiAgdC51cmFndXJtdWtoaSA9IDB4MGE3MzsKICB0LnVyaW5nID0gMHgwMTZmOwogIHQudXNob3J0Y3lyaWxsaWMgPSAweDA0NWU7CiAgdC51c21hbGxoaXJhZ2FuYSA9IDB4MzA0NTsKICB0LnVzbWFsbGthdGFrYW5hID0gMHgzMGE1OwogIHQudXNtYWxsa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjk7CiAgdC51c3RyYWlnaHRjeXJpbGxpYyA9IDB4MDRhZjsKICB0LnVzdHJhaWdodHN0cm9rZWN5cmlsbGljID0gMHgwNGIxOwogIHQudXRpbGRlID0gMHgwMTY5OwogIHQudXRpbGRlYWN1dGUgPSAweDFlNzk7CiAgdC51dGlsZGViZWxvdyA9IDB4MWU3NTsKICB0LnV1YmVuZ2FsaSA9IDB4MDk4YTsKICB0LnV1ZGV2YSA9IDB4MDkwYTsKICB0LnV1Z3VqYXJhdGkgPSAweDBhOGE7CiAgdC51dWd1cm11a2hpID0gMHgwYTBhOwogIHQudXVtYXRyYWd1cm11a2hpID0gMHgwYTQyOwogIHQudXV2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMyOwogIHQudXV2b3dlbHNpZ25kZXZhID0gMHgwOTQyOwogIHQudXV2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMjsKICB0LnV2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMxOwogIHQudXZvd2Vsc2lnbmRldmEgPSAweDA5NDE7CiAgdC51dm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzE7CiAgdC52ID0gMHgwMDc2OwogIHQudmFkZXZhID0gMHgwOTM1OwogIHQudmFndWphcmF0aSA9IDB4MGFiNTsKICB0LnZhZ3VybXVraGkgPSAweDBhMzU7CiAgdC52YWthdGFrYW5hID0gMHgzMGY3OwogIHQudmF2ID0gMHgwNWQ1OwogIHQudmF2ZGFnZXNoID0gMHhmYjM1OwogIHQudmF2ZGFnZXNoNjUgPSAweGZiMzU7CiAgdC52YXZkYWdlc2hoZWJyZXcgPSAweGZiMzU7CiAgdC52YXZoZWJyZXcgPSAweDA1ZDU7CiAgdC52YXZob2xhbSA9IDB4ZmI0YjsKICB0LnZhdmhvbGFtaGVicmV3ID0gMHhmYjRiOwogIHQudmF2dmF2aGVicmV3ID0gMHgwNWYwOwogIHQudmF2eW9kaGVicmV3ID0gMHgwNWYxOwogIHQudmNpcmNsZSA9IDB4MjRlNTsKICB0LnZkb3RiZWxvdyA9IDB4MWU3ZjsKICB0LnZlY3lyaWxsaWMgPSAweDA0MzI7CiAgdC52ZWhhcmFiaWMgPSAweDA2YTQ7CiAgdC52ZWhmaW5hbGFyYWJpYyA9IDB4ZmI2YjsKICB0LnZlaGluaXRpYWxhcmFiaWMgPSAweGZiNmM7CiAgdC52ZWhtZWRpYWxhcmFiaWMgPSAweGZiNmQ7CiAgdC52ZWthdGFrYW5hID0gMHgzMGY5OwogIHQudmVudXMgPSAweDI2NDA7CiAgdC52ZXJ0aWNhbGJhciA9IDB4MDA3YzsKICB0LnZlcnRpY2FsbGluZWFib3ZlY21iID0gMHgwMzBkOwogIHQudmVydGljYWxsaW5lYmVsb3djbWIgPSAweDAzMjk7CiAgdC52ZXJ0aWNhbGxpbmVsb3dtb2QgPSAweDAyY2M7CiAgdC52ZXJ0aWNhbGxpbmVtb2QgPSAweDAyYzg7CiAgdC52ZXdhcm1lbmlhbiA9IDB4MDU3ZTsKICB0LnZob29rID0gMHgwMjhiOwogIHQudmlrYXRha2FuYSA9IDB4MzBmODsKICB0LnZpcmFtYWJlbmdhbGkgPSAweDA5Y2Q7CiAgdC52aXJhbWFkZXZhID0gMHgwOTRkOwogIHQudmlyYW1hZ3VqYXJhdGkgPSAweDBhY2Q7CiAgdC52aXNhcmdhYmVuZ2FsaSA9IDB4MDk4MzsKICB0LnZpc2FyZ2FkZXZhID0gMHgwOTAzOwogIHQudmlzYXJnYWd1amFyYXRpID0gMHgwYTgzOwogIHQudm1vbm9zcGFjZSA9IDB4ZmY1NjsKICB0LnZvYXJtZW5pYW4gPSAweDA1Nzg7CiAgdC52b2ljZWRpdGVyYXRpb25oaXJhZ2FuYSA9IDB4MzA5ZTsKICB0LnZvaWNlZGl0ZXJhdGlvbmthdGFrYW5hID0gMHgzMGZlOwogIHQudm9pY2VkbWFya2thbmEgPSAweDMwOWI7CiAgdC52b2ljZWRtYXJra2FuYWhhbGZ3aWR0aCA9IDB4ZmY5ZTsKICB0LnZva2F0YWthbmEgPSAweDMwZmE7CiAgdC52cGFyZW4gPSAweDI0YjE7CiAgdC52dGlsZGUgPSAweDFlN2Q7CiAgdC52dHVybmVkID0gMHgwMjhjOwogIHQudnVoaXJhZ2FuYSA9IDB4MzA5NDsKICB0LnZ1a2F0YWthbmEgPSAweDMwZjQ7CiAgdC53ID0gMHgwMDc3OwogIHQud2FjdXRlID0gMHgxZTgzOwogIHQud2Fla29yZWFuID0gMHgzMTU5OwogIHQud2FoaXJhZ2FuYSA9IDB4MzA4ZjsKICB0Lndha2F0YWthbmEgPSAweDMwZWY7CiAgdC53YWthdGFrYW5haGFsZndpZHRoID0gMHhmZjljOwogIHQud2Frb3JlYW4gPSAweDMxNTg7CiAgdC53YXNtYWxsaGlyYWdhbmEgPSAweDMwOGU7CiAgdC53YXNtYWxsa2F0YWthbmEgPSAweDMwZWU7CiAgdC53YXR0b3NxdWFyZSA9IDB4MzM1NzsKICB0LndhdmVkYXNoID0gMHgzMDFjOwogIHQud2F2eXVuZGVyc2NvcmV2ZXJ0aWNhbCA9IDB4ZmUzNDsKICB0Lndhd2FyYWJpYyA9IDB4MDY0ODsKICB0Lndhd2ZpbmFsYXJhYmljID0gMHhmZWVlOwogIHQud2F3aGFtemFhYm92ZWFyYWJpYyA9IDB4MDYyNDsKICB0Lndhd2hhbXphYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmU4NjsKICB0Lndic3F1YXJlID0gMHgzM2RkOwogIHQud2NpcmNsZSA9IDB4MjRlNjsKICB0LndjaXJjdW1mbGV4ID0gMHgwMTc1OwogIHQud2RpZXJlc2lzID0gMHgxZTg1OwogIHQud2RvdGFjY2VudCA9IDB4MWU4NzsKICB0Lndkb3RiZWxvdyA9IDB4MWU4OTsKICB0LndlaGlyYWdhbmEgPSAweDMwOTE7CiAgdC53ZWllcnN0cmFzcyA9IDB4MjExODsKICB0Lndla2F0YWthbmEgPSAweDMwZjE7CiAgdC53ZWtvcmVhbiA9IDB4MzE1ZTsKICB0Lndlb2tvcmVhbiA9IDB4MzE1ZDsKICB0LndncmF2ZSA9IDB4MWU4MTsKICB0LndoaXRlYnVsbGV0ID0gMHgyNWU2OwogIHQud2hpdGVjaXJjbGUgPSAweDI1Y2I7CiAgdC53aGl0ZWNpcmNsZWludmVyc2UgPSAweDI1ZDk7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRsZWZ0ID0gMHgzMDBlOwogIHQud2hpdGVjb3JuZXJicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTQzOwogIHQud2hpdGVjb3JuZXJicmFja2V0cmlnaHQgPSAweDMwMGY7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTQ0OwogIHQud2hpdGVkaWFtb25kID0gMHgyNWM3OwogIHQud2hpdGVkaWFtb25kY29udGFpbmluZ2JsYWNrc21hbGxkaWFtb25kID0gMHgyNWM4OwogIHQud2hpdGVkb3ducG9pbnRpbmdzbWFsbHRyaWFuZ2xlID0gMHgyNWJmOwogIHQud2hpdGVkb3ducG9pbnRpbmd0cmlhbmdsZSA9IDB4MjViZDsKICB0LndoaXRlbGVmdHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjVjMzsKICB0LndoaXRlbGVmdHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YzE7CiAgdC53aGl0ZWxlbnRpY3VsYXJicmFja2V0bGVmdCA9IDB4MzAxNjsKICB0LndoaXRlbGVudGljdWxhcmJyYWNrZXRyaWdodCA9IDB4MzAxNzsKICB0LndoaXRlcmlnaHRwb2ludGluZ3NtYWxsdHJpYW5nbGUgPSAweDI1Yjk7CiAgdC53aGl0ZXJpZ2h0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjViNzsKICB0LndoaXRlc21hbGxzcXVhcmUgPSAweDI1YWI7CiAgdC53aGl0ZXNtaWxpbmdmYWNlID0gMHgyNjNhOwogIHQud2hpdGVzcXVhcmUgPSAweDI1YTE7CiAgdC53aGl0ZXN0YXIgPSAweDI2MDY7CiAgdC53aGl0ZXRlbGVwaG9uZSA9IDB4MjYwZjsKICB0LndoaXRldG9ydG9pc2VzaGVsbGJyYWNrZXRsZWZ0ID0gMHgzMDE4OwogIHQud2hpdGV0b3J0b2lzZXNoZWxsYnJhY2tldHJpZ2h0ID0gMHgzMDE5OwogIHQud2hpdGV1cHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjViNTsKICB0LndoaXRldXBwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWIzOwogIHQud2loaXJhZ2FuYSA9IDB4MzA5MDsKICB0Lndpa2F0YWthbmEgPSAweDMwZjA7CiAgdC53aWtvcmVhbiA9IDB4MzE1ZjsKICB0Lndtb25vc3BhY2UgPSAweGZmNTc7CiAgdC53b2hpcmFnYW5hID0gMHgzMDkyOwogIHQud29rYXRha2FuYSA9IDB4MzBmMjsKICB0Lndva2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjY7CiAgdC53b24gPSAweDIwYTk7CiAgdC53b25tb25vc3BhY2UgPSAweGZmZTY7CiAgdC53b3dhZW50aGFpID0gMHgwZTI3OwogIHQud3BhcmVuID0gMHgyNGIyOwogIHQud3JpbmcgPSAweDFlOTg7CiAgdC53c3VwZXJpb3IgPSAweDAyYjc7CiAgdC53dHVybmVkID0gMHgwMjhkOwogIHQud3lubiA9IDB4MDFiZjsKICB0LnggPSAweDAwNzg7CiAgdC54YWJvdmVjbWIgPSAweDAzM2Q7CiAgdC54Ym9wb21vZm8gPSAweDMxMTI7CiAgdC54Y2lyY2xlID0gMHgyNGU3OwogIHQueGRpZXJlc2lzID0gMHgxZThkOwogIHQueGRvdGFjY2VudCA9IDB4MWU4YjsKICB0LnhlaGFybWVuaWFuID0gMHgwNTZkOwogIHQueGkgPSAweDAzYmU7CiAgdC54bW9ub3NwYWNlID0gMHhmZjU4OwogIHQueHBhcmVuID0gMHgyNGIzOwogIHQueHN1cGVyaW9yID0gMHgwMmUzOwogIHQueSA9IDB4MDA3OTsKICB0LnlhYWRvc3F1YXJlID0gMHgzMzRlOwogIHQueWFiZW5nYWxpID0gMHgwOWFmOwogIHQueWFjdXRlID0gMHgwMGZkOwogIHQueWFkZXZhID0gMHgwOTJmOwogIHQueWFla29yZWFuID0gMHgzMTUyOwogIHQueWFndWphcmF0aSA9IDB4MGFhZjsKICB0LnlhZ3VybXVraGkgPSAweDBhMmY7CiAgdC55YWhpcmFnYW5hID0gMHgzMDg0OwogIHQueWFrYXRha2FuYSA9IDB4MzBlNDsKICB0Lnlha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTQ7CiAgdC55YWtvcmVhbiA9IDB4MzE1MTsKICB0LnlhbWFra2FudGhhaSA9IDB4MGU0ZTsKICB0Lnlhc21hbGxoaXJhZ2FuYSA9IDB4MzA4MzsKICB0Lnlhc21hbGxrYXRha2FuYSA9IDB4MzBlMzsKICB0Lnlhc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YzsKICB0LnlhdGN5cmlsbGljID0gMHgwNDYzOwogIHQueWNpcmNsZSA9IDB4MjRlODsKICB0LnljaXJjdW1mbGV4ID0gMHgwMTc3OwogIHQueWRpZXJlc2lzID0gMHgwMGZmOwogIHQueWRvdGFjY2VudCA9IDB4MWU4ZjsKICB0Lnlkb3RiZWxvdyA9IDB4MWVmNTsKICB0LnllaGFyYWJpYyA9IDB4MDY0YTsKICB0LnllaGJhcnJlZWFyYWJpYyA9IDB4MDZkMjsKICB0LnllaGJhcnJlZWZpbmFsYXJhYmljID0gMHhmYmFmOwogIHQueWVoZmluYWxhcmFiaWMgPSAweGZlZjI7CiAgdC55ZWhoYW16YWFib3ZlYXJhYmljID0gMHgwNjI2OwogIHQueWVoaGFtemFhYm92ZWZpbmFsYXJhYmljID0gMHhmZThhOwogIHQueWVoaGFtemFhYm92ZWluaXRpYWxhcmFiaWMgPSAweGZlOGI7CiAgdC55ZWhoYW16YWFib3ZlbWVkaWFsYXJhYmljID0gMHhmZThjOwogIHQueWVoaW5pdGlhbGFyYWJpYyA9IDB4ZmVmMzsKICB0LnllaG1lZGlhbGFyYWJpYyA9IDB4ZmVmNDsKICB0LnllaG1lZW1pbml0aWFsYXJhYmljID0gMHhmY2RkOwogIHQueWVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzU4OwogIHQueWVobm9vbmZpbmFsYXJhYmljID0gMHhmYzk0OwogIHQueWVodGhyZWVkb3RzYmVsb3dhcmFiaWMgPSAweDA2ZDE7CiAgdC55ZWtvcmVhbiA9IDB4MzE1NjsKICB0LnllbiA9IDB4MDBhNTsKICB0Lnllbm1vbm9zcGFjZSA9IDB4ZmZlNTsKICB0Lnllb2tvcmVhbiA9IDB4MzE1NTsKICB0Lnllb3JpbmhpZXVoa29yZWFuID0gMHgzMTg2OwogIHQueWVyYWhiZW55b21vaGVicmV3ID0gMHgwNWFhOwogIHQueWVyYWhiZW55b21vbGVmdGhlYnJldyA9IDB4MDVhYTsKICB0LnllcmljeXJpbGxpYyA9IDB4MDQ0YjsKICB0LnllcnVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY5OwogIHQueWVzaWV1bmdrb3JlYW4gPSAweDMxODE7CiAgdC55ZXNpZXVuZ3BhbnNpb3Nrb3JlYW4gPSAweDMxODM7CiAgdC55ZXNpZXVuZ3Npb3Nrb3JlYW4gPSAweDMxODI7CiAgdC55ZXRpdmhlYnJldyA9IDB4MDU5YTsKICB0LnlncmF2ZSA9IDB4MWVmMzsKICB0Lnlob29rID0gMHgwMWI0OwogIHQueWhvb2thYm92ZSA9IDB4MWVmNzsKICB0LnlpYXJtZW5pYW4gPSAweDA1NzU7CiAgdC55aWN5cmlsbGljID0gMHgwNDU3OwogIHQueWlrb3JlYW4gPSAweDMxNjI7CiAgdC55aW55YW5nID0gMHgyNjJmOwogIHQueWl3bmFybWVuaWFuID0gMHgwNTgyOwogIHQueW1vbm9zcGFjZSA9IDB4ZmY1OTsKICB0LnlvZCA9IDB4MDVkOTsKICB0LnlvZGRhZ2VzaCA9IDB4ZmIzOTsKICB0LnlvZGRhZ2VzaGhlYnJldyA9IDB4ZmIzOTsKICB0LnlvZGhlYnJldyA9IDB4MDVkOTsKICB0LnlvZHlvZGhlYnJldyA9IDB4MDVmMjsKICB0LnlvZHlvZHBhdGFoaGVicmV3ID0gMHhmYjFmOwogIHQueW9oaXJhZ2FuYSA9IDB4MzA4ODsKICB0LnlvaWtvcmVhbiA9IDB4MzE4OTsKICB0Lnlva2F0YWthbmEgPSAweDMwZTg7CiAgdC55b2thdGFrYW5haGFsZndpZHRoID0gMHhmZjk2OwogIHQueW9rb3JlYW4gPSAweDMxNWI7CiAgdC55b3NtYWxsaGlyYWdhbmEgPSAweDMwODc7CiAgdC55b3NtYWxsa2F0YWthbmEgPSAweDMwZTc7CiAgdC55b3NtYWxsa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNmU7CiAgdC55b3RncmVlayA9IDB4MDNmMzsKICB0LnlveWFla29yZWFuID0gMHgzMTg4OwogIHQueW95YWtvcmVhbiA9IDB4MzE4NzsKICB0LnlveWFrdGhhaSA9IDB4MGUyMjsKICB0LnlveWluZ3RoYWkgPSAweDBlMGQ7CiAgdC55cGFyZW4gPSAweDI0YjQ7CiAgdC55cG9nZWdyYW1tZW5pID0gMHgwMzdhOwogIHQueXBvZ2VncmFtbWVuaWdyZWVrY21iID0gMHgwMzQ1OwogIHQueXIgPSAweDAxYTY7CiAgdC55cmluZyA9IDB4MWU5OTsKICB0LnlzdXBlcmlvciA9IDB4MDJiODsKICB0Lnl0aWxkZSA9IDB4MWVmOTsKICB0Lnl0dXJuZWQgPSAweDAyOGU7CiAgdC55dWhpcmFnYW5hID0gMHgzMDg2OwogIHQueXVpa29yZWFuID0gMHgzMThjOwogIHQueXVrYXRha2FuYSA9IDB4MzBlNjsKICB0Lnl1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTU7CiAgdC55dWtvcmVhbiA9IDB4MzE2MDsKICB0Lnl1c2JpZ2N5cmlsbGljID0gMHgwNDZiOwogIHQueXVzYmlnaW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2ZDsKICB0Lnl1c2xpdHRsZWN5cmlsbGljID0gMHgwNDY3OwogIHQueXVzbGl0dGxlaW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2OTsKICB0Lnl1c21hbGxoaXJhZ2FuYSA9IDB4MzA4NTsKICB0Lnl1c21hbGxrYXRha2FuYSA9IDB4MzBlNTsKICB0Lnl1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2ZDsKICB0Lnl1eWVrb3JlYW4gPSAweDMxOGI7CiAgdC55dXllb2tvcmVhbiA9IDB4MzE4YTsKICB0Lnl5YWJlbmdhbGkgPSAweDA5ZGY7CiAgdC55eWFkZXZhID0gMHgwOTVmOwogIHQueiA9IDB4MDA3YTsKICB0LnphYXJtZW5pYW4gPSAweDA1NjY7CiAgdC56YWN1dGUgPSAweDAxN2E7CiAgdC56YWRldmEgPSAweDA5NWI7CiAgdC56YWd1cm11a2hpID0gMHgwYTViOwogIHQuemFoYXJhYmljID0gMHgwNjM4OwogIHQuemFoZmluYWxhcmFiaWMgPSAweGZlYzY7CiAgdC56YWhpbml0aWFsYXJhYmljID0gMHhmZWM3OwogIHQuemFoaXJhZ2FuYSA9IDB4MzA1NjsKICB0LnphaG1lZGlhbGFyYWJpYyA9IDB4ZmVjODsKICB0LnphaW5hcmFiaWMgPSAweDA2MzI7CiAgdC56YWluZmluYWxhcmFiaWMgPSAweGZlYjA7CiAgdC56YWthdGFrYW5hID0gMHgzMGI2OwogIHQuemFxZWZnYWRvbGhlYnJldyA9IDB4MDU5NTsKICB0LnphcWVmcWF0YW5oZWJyZXcgPSAweDA1OTQ7CiAgdC56YXJxYWhlYnJldyA9IDB4MDU5ODsKICB0LnpheWluID0gMHgwNWQ2OwogIHQuemF5aW5kYWdlc2ggPSAweGZiMzY7CiAgdC56YXlpbmRhZ2VzaGhlYnJldyA9IDB4ZmIzNjsKICB0LnpheWluaGVicmV3ID0gMHgwNWQ2OwogIHQuemJvcG9tb2ZvID0gMHgzMTE3OwogIHQuemNhcm9uID0gMHgwMTdlOwogIHQuemNpcmNsZSA9IDB4MjRlOTsKICB0LnpjaXJjdW1mbGV4ID0gMHgxZTkxOwogIHQuemN1cmwgPSAweDAyOTE7CiAgdC56ZG90ID0gMHgwMTdjOwogIHQuemRvdGFjY2VudCA9IDB4MDE3YzsKICB0Lnpkb3RiZWxvdyA9IDB4MWU5MzsKICB0LnplY3lyaWxsaWMgPSAweDA0Mzc7CiAgdC56ZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNDk5OwogIHQuemVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRmOwogIHQuemVoaXJhZ2FuYSA9IDB4MzA1YzsKICB0Lnpla2F0YWthbmEgPSAweDMwYmM7CiAgdC56ZXJvID0gMHgwMDMwOwogIHQuemVyb2FyYWJpYyA9IDB4MDY2MDsKICB0Lnplcm9iZW5nYWxpID0gMHgwOWU2OwogIHQuemVyb2RldmEgPSAweDA5NjY7CiAgdC56ZXJvZ3VqYXJhdGkgPSAweDBhZTY7CiAgdC56ZXJvZ3VybXVraGkgPSAweDBhNjY7CiAgdC56ZXJvaGFja2FyYWJpYyA9IDB4MDY2MDsKICB0Lnplcm9pbmZlcmlvciA9IDB4MjA4MDsKICB0Lnplcm9tb25vc3BhY2UgPSAweGZmMTA7CiAgdC56ZXJvb2xkc3R5bGUgPSAweGY3MzA7CiAgdC56ZXJvcGVyc2lhbiA9IDB4MDZmMDsKICB0Lnplcm9zdXBlcmlvciA9IDB4MjA3MDsKICB0Lnplcm90aGFpID0gMHgwZTUwOwogIHQuemVyb3dpZHRoam9pbmVyID0gMHhmZWZmOwogIHQuemVyb3dpZHRobm9uam9pbmVyID0gMHgyMDBjOwogIHQuemVyb3dpZHRoc3BhY2UgPSAweDIwMGI7CiAgdC56ZXRhID0gMHgwM2I2OwogIHQuemhib3BvbW9mbyA9IDB4MzExMzsKICB0LnpoZWFybWVuaWFuID0gMHgwNTZhOwogIHQuemhlYnJldmVjeXJpbGxpYyA9IDB4MDRjMjsKICB0LnpoZWN5cmlsbGljID0gMHgwNDM2OwogIHQuemhlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OTc7CiAgdC56aGVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRkOwogIHQuemloaXJhZ2FuYSA9IDB4MzA1ODsKICB0Lnppa2F0YWthbmEgPSAweDMwYjg7CiAgdC56aW5vcmhlYnJldyA9IDB4MDVhZTsKICB0LnpsaW5lYmVsb3cgPSAweDFlOTU7CiAgdC56bW9ub3NwYWNlID0gMHhmZjVhOwogIHQuem9oaXJhZ2FuYSA9IDB4MzA1ZTsKICB0Lnpva2F0YWthbmEgPSAweDMwYmU7CiAgdC56cGFyZW4gPSAweDI0YjU7CiAgdC56cmV0cm9mbGV4aG9vayA9IDB4MDI5MDsKICB0LnpzdHJva2UgPSAweDAxYjY7CiAgdC56dWhpcmFnYW5hID0gMHgzMDVhOwogIHQuenVrYXRha2FuYSA9IDB4MzBiYTsKICB0WyIubm90ZGVmIl0gPSAweDAwMDA7CiAgdC5hbmdicmFja2V0bGVmdGJpZyA9IDB4MjMyOTsKICB0LmFuZ2JyYWNrZXRsZWZ0QmlnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldGxlZnRiaWdnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldGxlZnRCaWdnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldHJpZ2h0QmlnID0gMHgyMzJhOwogIHQuYW5nYnJhY2tldHJpZ2h0YmlnID0gMHgyMzJhOwogIHQuYW5nYnJhY2tldHJpZ2h0QmlnZyA9IDB4MjMyYTsKICB0LmFuZ2JyYWNrZXRyaWdodGJpZ2cgPSAweDIzMmE7CiAgdC5hcnJvd2hvb2tsZWZ0ID0gMHgyMWFhOwogIHQuYXJyb3dob29rcmlnaHQgPSAweDIxYTk7CiAgdC5hcnJvd2xlZnR0b3BoYWxmID0gMHgyMWJjOwogIHQuYXJyb3dsZWZ0Ym90aGFsZiA9IDB4MjFiZDsKICB0LmFycm93bm9ydGhlYXN0ID0gMHgyMTk3OwogIHQuYXJyb3dub3J0aHdlc3QgPSAweDIxOTY7CiAgdC5hcnJvd3JpZ2h0dG9waGFsZiA9IDB4MjFjMDsKICB0LmFycm93cmlnaHRib3RoYWxmID0gMHgyMWMxOwogIHQuYXJyb3dzb3V0aGVhc3QgPSAweDIxOTg7CiAgdC5hcnJvd3NvdXRod2VzdCA9IDB4MjE5OTsKICB0LmJhY2tzbGFzaGJpZyA9IDB4MjIxNjsKICB0LmJhY2tzbGFzaEJpZyA9IDB4MjIxNjsKICB0LmJhY2tzbGFzaEJpZ2cgPSAweDIyMTY7CiAgdC5iYWNrc2xhc2hiaWdnID0gMHgyMjE2OwogIHQuYmFyZGJsID0gMHgyMDE2OwogIHQuYnJhY2VodGlwZG93bmxlZnQgPSAweGZlMzc7CiAgdC5icmFjZWh0aXBkb3ducmlnaHQgPSAweGZlMzc7CiAgdC5icmFjZWh0aXB1cGxlZnQgPSAweGZlMzg7CiAgdC5icmFjZWh0aXB1cHJpZ2h0ID0gMHhmZTM4OwogIHQuYnJhY2VsZWZ0QmlnID0gMHgwMDdiOwogIHQuYnJhY2VsZWZ0YmlnID0gMHgwMDdiOwogIHQuYnJhY2VsZWZ0YmlnZyA9IDB4MDA3YjsKICB0LmJyYWNlbGVmdEJpZ2cgPSAweDAwN2I7CiAgdC5icmFjZXJpZ2h0QmlnID0gMHgwMDdkOwogIHQuYnJhY2VyaWdodGJpZyA9IDB4MDA3ZDsKICB0LmJyYWNlcmlnaHRiaWdnID0gMHgwMDdkOwogIHQuYnJhY2VyaWdodEJpZ2cgPSAweDAwN2Q7CiAgdC5icmFja2V0bGVmdGJpZyA9IDB4MDA1YjsKICB0LmJyYWNrZXRsZWZ0QmlnID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRiaWdnID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRCaWdnID0gMHgwMDViOwogIHQuYnJhY2tldHJpZ2h0QmlnID0gMHgwMDVkOwogIHQuYnJhY2tldHJpZ2h0YmlnID0gMHgwMDVkOwogIHQuYnJhY2tldHJpZ2h0YmlnZyA9IDB4MDA1ZDsKICB0LmJyYWNrZXRyaWdodEJpZ2cgPSAweDAwNWQ7CiAgdC5jZWlsaW5nbGVmdGJpZyA9IDB4MjMwODsKICB0LmNlaWxpbmdsZWZ0QmlnID0gMHgyMzA4OwogIHQuY2VpbGluZ2xlZnRCaWdnID0gMHgyMzA4OwogIHQuY2VpbGluZ2xlZnRiaWdnID0gMHgyMzA4OwogIHQuY2VpbGluZ3JpZ2h0YmlnID0gMHgyMzA5OwogIHQuY2VpbGluZ3JpZ2h0QmlnID0gMHgyMzA5OwogIHQuY2VpbGluZ3JpZ2h0YmlnZyA9IDB4MjMwOTsKICB0LmNlaWxpbmdyaWdodEJpZ2cgPSAweDIzMDk7CiAgdC5jaXJjbGVkb3RkaXNwbGF5ID0gMHgyMjk5OwogIHQuY2lyY2xlZG90dGV4dCA9IDB4MjI5OTsKICB0LmNpcmNsZW11bHRpcGx5ZGlzcGxheSA9IDB4MjI5NzsKICB0LmNpcmNsZW11bHRpcGx5dGV4dCA9IDB4MjI5NzsKICB0LmNpcmNsZXBsdXNkaXNwbGF5ID0gMHgyMjk1OwogIHQuY2lyY2xlcGx1c3RleHQgPSAweDIyOTU7CiAgdC5jb250aW50ZWdyYWxkaXNwbGF5ID0gMHgyMjJlOwogIHQuY29udGludGVncmFsdGV4dCA9IDB4MjIyZTsKICB0LmNvcHJvZHVjdGRpc3BsYXkgPSAweDIyMTA7CiAgdC5jb3Byb2R1Y3R0ZXh0ID0gMHgyMjEwOwogIHQuZmxvb3JsZWZ0QmlnID0gMHgyMzBhOwogIHQuZmxvb3JsZWZ0YmlnID0gMHgyMzBhOwogIHQuZmxvb3JsZWZ0YmlnZyA9IDB4MjMwYTsKICB0LmZsb29ybGVmdEJpZ2cgPSAweDIzMGE7CiAgdC5mbG9vcnJpZ2h0YmlnID0gMHgyMzBiOwogIHQuZmxvb3JyaWdodEJpZyA9IDB4MjMwYjsKICB0LmZsb29ycmlnaHRCaWdnID0gMHgyMzBiOwogIHQuZmxvb3JyaWdodGJpZ2cgPSAweDIzMGI7CiAgdC5oYXR3aWRlID0gMHgwMzAyOwogIHQuaGF0d2lkZXIgPSAweDAzMDI7CiAgdC5oYXR3aWRlc3QgPSAweDAzMDI7CiAgdC5pbnRlcmNhbCA9IDB4MWQ0MDsKICB0LmludGVncmFsZGlzcGxheSA9IDB4MjIyYjsKICB0LmludGVncmFsdGV4dCA9IDB4MjIyYjsKICB0LmludGVyc2VjdGlvbmRpc3BsYXkgPSAweDIyYzI7CiAgdC5pbnRlcnNlY3Rpb250ZXh0ID0gMHgyMmMyOwogIHQubG9naWNhbGFuZGRpc3BsYXkgPSAweDIyMjc7CiAgdC5sb2dpY2FsYW5kdGV4dCA9IDB4MjIyNzsKICB0LmxvZ2ljYWxvcmRpc3BsYXkgPSAweDIyMjg7CiAgdC5sb2dpY2Fsb3J0ZXh0ID0gMHgyMjI4OwogIHQucGFyZW5sZWZ0QmlnID0gMHgwMDI4OwogIHQucGFyZW5sZWZ0YmlnID0gMHgwMDI4OwogIHQucGFyZW5sZWZ0QmlnZyA9IDB4MDAyODsKICB0LnBhcmVubGVmdGJpZ2cgPSAweDAwMjg7CiAgdC5wYXJlbnJpZ2h0QmlnID0gMHgwMDI5OwogIHQucGFyZW5yaWdodGJpZyA9IDB4MDAyOTsKICB0LnBhcmVucmlnaHRCaWdnID0gMHgwMDI5OwogIHQucGFyZW5yaWdodGJpZ2cgPSAweDAwMjk7CiAgdC5wcmltZSA9IDB4MjAzMjsKICB0LnByb2R1Y3RkaXNwbGF5ID0gMHgyMjBmOwogIHQucHJvZHVjdHRleHQgPSAweDIyMGY7CiAgdC5yYWRpY2FsYmlnID0gMHgyMjFhOwogIHQucmFkaWNhbEJpZyA9IDB4MjIxYTsKICB0LnJhZGljYWxCaWdnID0gMHgyMjFhOwogIHQucmFkaWNhbGJpZ2cgPSAweDIyMWE7CiAgdC5yYWRpY2FsYnQgPSAweDIyMWE7CiAgdC5yYWRpY2FsdHAgPSAweDIyMWE7CiAgdC5yYWRpY2FsdmVydGV4ID0gMHgyMjFhOwogIHQuc2xhc2hiaWcgPSAweDAwMmY7CiAgdC5zbGFzaEJpZyA9IDB4MDAyZjsKICB0LnNsYXNoQmlnZyA9IDB4MDAyZjsKICB0LnNsYXNoYmlnZyA9IDB4MDAyZjsKICB0LnN1bW1hdGlvbmRpc3BsYXkgPSAweDIyMTE7CiAgdC5zdW1tYXRpb250ZXh0ID0gMHgyMjExOwogIHQudGlsZGV3aWRlID0gMHgwMmRjOwogIHQudGlsZGV3aWRlciA9IDB4MDJkYzsKICB0LnRpbGRld2lkZXN0ID0gMHgwMmRjOwogIHQudW5pb25kaXNwbGF5ID0gMHgyMmMzOwogIHQudW5pb25tdWx0aWRpc3BsYXkgPSAweDIyOGU7CiAgdC51bmlvbm11bHRpdGV4dCA9IDB4MjI4ZTsKICB0LnVuaW9uc3FkaXNwbGF5ID0gMHgyMjk0OwogIHQudW5pb25zcXRleHQgPSAweDIyOTQ7CiAgdC51bmlvbnRleHQgPSAweDIyYzM7CiAgdC52ZXh0ZW5kZG91YmxlID0gMHgyMjI1OwogIHQudmV4dGVuZHNpbmdsZSA9IDB4MjIyMzsKfSk7CmNvbnN0IGdldERpbmdiYXRzR2x5cGhzVW5pY29kZSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuc3BhY2UgPSAweDAwMjA7CiAgdC5hMSA9IDB4MjcwMTsKICB0LmEyID0gMHgyNzAyOwogIHQuYTIwMiA9IDB4MjcwMzsKICB0LmEzID0gMHgyNzA0OwogIHQuYTQgPSAweDI2MGU7CiAgdC5hNSA9IDB4MjcwNjsKICB0LmExMTkgPSAweDI3MDc7CiAgdC5hMTE4ID0gMHgyNzA4OwogIHQuYTExNyA9IDB4MjcwOTsKICB0LmExMSA9IDB4MjYxYjsKICB0LmExMiA9IDB4MjYxZTsKICB0LmExMyA9IDB4MjcwYzsKICB0LmExNCA9IDB4MjcwZDsKICB0LmExNSA9IDB4MjcwZTsKICB0LmExNiA9IDB4MjcwZjsKICB0LmExMDUgPSAweDI3MTA7CiAgdC5hMTcgPSAweDI3MTE7CiAgdC5hMTggPSAweDI3MTI7CiAgdC5hMTkgPSAweDI3MTM7CiAgdC5hMjAgPSAweDI3MTQ7CiAgdC5hMjEgPSAweDI3MTU7CiAgdC5hMjIgPSAweDI3MTY7CiAgdC5hMjMgPSAweDI3MTc7CiAgdC5hMjQgPSAweDI3MTg7CiAgdC5hMjUgPSAweDI3MTk7CiAgdC5hMjYgPSAweDI3MWE7CiAgdC5hMjcgPSAweDI3MWI7CiAgdC5hMjggPSAweDI3MWM7CiAgdC5hNiA9IDB4MjcxZDsKICB0LmE3ID0gMHgyNzFlOwogIHQuYTggPSAweDI3MWY7CiAgdC5hOSA9IDB4MjcyMDsKICB0LmExMCA9IDB4MjcyMTsKICB0LmEyOSA9IDB4MjcyMjsKICB0LmEzMCA9IDB4MjcyMzsKICB0LmEzMSA9IDB4MjcyNDsKICB0LmEzMiA9IDB4MjcyNTsKICB0LmEzMyA9IDB4MjcyNjsKICB0LmEzNCA9IDB4MjcyNzsKICB0LmEzNSA9IDB4MjYwNTsKICB0LmEzNiA9IDB4MjcyOTsKICB0LmEzNyA9IDB4MjcyYTsKICB0LmEzOCA9IDB4MjcyYjsKICB0LmEzOSA9IDB4MjcyYzsKICB0LmE0MCA9IDB4MjcyZDsKICB0LmE0MSA9IDB4MjcyZTsKICB0LmE0MiA9IDB4MjcyZjsKICB0LmE0MyA9IDB4MjczMDsKICB0LmE0NCA9IDB4MjczMTsKICB0LmE0NSA9IDB4MjczMjsKICB0LmE0NiA9IDB4MjczMzsKICB0LmE0NyA9IDB4MjczNDsKICB0LmE0OCA9IDB4MjczNTsKICB0LmE0OSA9IDB4MjczNjsKICB0LmE1MCA9IDB4MjczNzsKICB0LmE1MSA9IDB4MjczODsKICB0LmE1MiA9IDB4MjczOTsKICB0LmE1MyA9IDB4MjczYTsKICB0LmE1NCA9IDB4MjczYjsKICB0LmE1NSA9IDB4MjczYzsKICB0LmE1NiA9IDB4MjczZDsKICB0LmE1NyA9IDB4MjczZTsKICB0LmE1OCA9IDB4MjczZjsKICB0LmE1OSA9IDB4Mjc0MDsKICB0LmE2MCA9IDB4Mjc0MTsKICB0LmE2MSA9IDB4Mjc0MjsKICB0LmE2MiA9IDB4Mjc0MzsKICB0LmE2MyA9IDB4Mjc0NDsKICB0LmE2NCA9IDB4Mjc0NTsKICB0LmE2NSA9IDB4Mjc0NjsKICB0LmE2NiA9IDB4Mjc0NzsKICB0LmE2NyA9IDB4Mjc0ODsKICB0LmE2OCA9IDB4Mjc0OTsKICB0LmE2OSA9IDB4Mjc0YTsKICB0LmE3MCA9IDB4Mjc0YjsKICB0LmE3MSA9IDB4MjVjZjsKICB0LmE3MiA9IDB4Mjc0ZDsKICB0LmE3MyA9IDB4MjVhMDsKICB0LmE3NCA9IDB4Mjc0ZjsKICB0LmEyMDMgPSAweDI3NTA7CiAgdC5hNzUgPSAweDI3NTE7CiAgdC5hMjA0ID0gMHgyNzUyOwogIHQuYTc2ID0gMHgyNWIyOwogIHQuYTc3ID0gMHgyNWJjOwogIHQuYTc4ID0gMHgyNWM2OwogIHQuYTc5ID0gMHgyNzU2OwogIHQuYTgxID0gMHgyNWQ3OwogIHQuYTgyID0gMHgyNzU4OwogIHQuYTgzID0gMHgyNzU5OwogIHQuYTg0ID0gMHgyNzVhOwogIHQuYTk3ID0gMHgyNzViOwogIHQuYTk4ID0gMHgyNzVjOwogIHQuYTk5ID0gMHgyNzVkOwogIHQuYTEwMCA9IDB4Mjc1ZTsKICB0LmExMDEgPSAweDI3NjE7CiAgdC5hMTAyID0gMHgyNzYyOwogIHQuYTEwMyA9IDB4Mjc2MzsKICB0LmExMDQgPSAweDI3NjQ7CiAgdC5hMTA2ID0gMHgyNzY1OwogIHQuYTEwNyA9IDB4Mjc2NjsKICB0LmExMDggPSAweDI3Njc7CiAgdC5hMTEyID0gMHgyNjYzOwogIHQuYTExMSA9IDB4MjY2NjsKICB0LmExMTAgPSAweDI2NjU7CiAgdC5hMTA5ID0gMHgyNjYwOwogIHQuYTEyMCA9IDB4MjQ2MDsKICB0LmExMjEgPSAweDI0NjE7CiAgdC5hMTIyID0gMHgyNDYyOwogIHQuYTEyMyA9IDB4MjQ2MzsKICB0LmExMjQgPSAweDI0NjQ7CiAgdC5hMTI1ID0gMHgyNDY1OwogIHQuYTEyNiA9IDB4MjQ2NjsKICB0LmExMjcgPSAweDI0Njc7CiAgdC5hMTI4ID0gMHgyNDY4OwogIHQuYTEyOSA9IDB4MjQ2OTsKICB0LmExMzAgPSAweDI3NzY7CiAgdC5hMTMxID0gMHgyNzc3OwogIHQuYTEzMiA9IDB4Mjc3ODsKICB0LmExMzMgPSAweDI3Nzk7CiAgdC5hMTM0ID0gMHgyNzdhOwogIHQuYTEzNSA9IDB4Mjc3YjsKICB0LmExMzYgPSAweDI3N2M7CiAgdC5hMTM3ID0gMHgyNzdkOwogIHQuYTEzOCA9IDB4Mjc3ZTsKICB0LmExMzkgPSAweDI3N2Y7CiAgdC5hMTQwID0gMHgyNzgwOwogIHQuYTE0MSA9IDB4Mjc4MTsKICB0LmExNDIgPSAweDI3ODI7CiAgdC5hMTQzID0gMHgyNzgzOwogIHQuYTE0NCA9IDB4Mjc4NDsKICB0LmExNDUgPSAweDI3ODU7CiAgdC5hMTQ2ID0gMHgyNzg2OwogIHQuYTE0NyA9IDB4Mjc4NzsKICB0LmExNDggPSAweDI3ODg7CiAgdC5hMTQ5ID0gMHgyNzg5OwogIHQuYTE1MCA9IDB4Mjc4YTsKICB0LmExNTEgPSAweDI3OGI7CiAgdC5hMTUyID0gMHgyNzhjOwogIHQuYTE1MyA9IDB4Mjc4ZDsKICB0LmExNTQgPSAweDI3OGU7CiAgdC5hMTU1ID0gMHgyNzhmOwogIHQuYTE1NiA9IDB4Mjc5MDsKICB0LmExNTcgPSAweDI3OTE7CiAgdC5hMTU4ID0gMHgyNzkyOwogIHQuYTE1OSA9IDB4Mjc5MzsKICB0LmExNjAgPSAweDI3OTQ7CiAgdC5hMTYxID0gMHgyMTkyOwogIHQuYTE2MyA9IDB4MjE5NDsKICB0LmExNjQgPSAweDIxOTU7CiAgdC5hMTk2ID0gMHgyNzk4OwogIHQuYTE2NSA9IDB4Mjc5OTsKICB0LmExOTIgPSAweDI3OWE7CiAgdC5hMTY2ID0gMHgyNzliOwogIHQuYTE2NyA9IDB4Mjc5YzsKICB0LmExNjggPSAweDI3OWQ7CiAgdC5hMTY5ID0gMHgyNzllOwogIHQuYTE3MCA9IDB4Mjc5ZjsKICB0LmExNzEgPSAweDI3YTA7CiAgdC5hMTcyID0gMHgyN2ExOwogIHQuYTE3MyA9IDB4MjdhMjsKICB0LmExNjIgPSAweDI3YTM7CiAgdC5hMTc0ID0gMHgyN2E0OwogIHQuYTE3NSA9IDB4MjdhNTsKICB0LmExNzYgPSAweDI3YTY7CiAgdC5hMTc3ID0gMHgyN2E3OwogIHQuYTE3OCA9IDB4MjdhODsKICB0LmExNzkgPSAweDI3YTk7CiAgdC5hMTkzID0gMHgyN2FhOwogIHQuYTE4MCA9IDB4MjdhYjsKICB0LmExOTkgPSAweDI3YWM7CiAgdC5hMTgxID0gMHgyN2FkOwogIHQuYTIwMCA9IDB4MjdhZTsKICB0LmExODIgPSAweDI3YWY7CiAgdC5hMjAxID0gMHgyN2IxOwogIHQuYTE4MyA9IDB4MjdiMjsKICB0LmExODQgPSAweDI3YjM7CiAgdC5hMTk3ID0gMHgyN2I0OwogIHQuYTE4NSA9IDB4MjdiNTsKICB0LmExOTQgPSAweDI3YjY7CiAgdC5hMTk4ID0gMHgyN2I3OwogIHQuYTE4NiA9IDB4MjdiODsKICB0LmExOTUgPSAweDI3Yjk7CiAgdC5hMTg3ID0gMHgyN2JhOwogIHQuYTE4OCA9IDB4MjdiYjsKICB0LmExODkgPSAweDI3YmM7CiAgdC5hMTkwID0gMHgyN2JkOwogIHQuYTE5MSA9IDB4MjdiZTsKICB0LmE4OSA9IDB4Mjc2ODsKICB0LmE5MCA9IDB4Mjc2OTsKICB0LmE5MyA9IDB4Mjc2YTsKICB0LmE5NCA9IDB4Mjc2YjsKICB0LmE5MSA9IDB4Mjc2YzsKICB0LmE5MiA9IDB4Mjc2ZDsKICB0LmEyMDUgPSAweDI3NmU7CiAgdC5hODUgPSAweDI3NmY7CiAgdC5hMjA2ID0gMHgyNzcwOwogIHQuYTg2ID0gMHgyNzcxOwogIHQuYTg3ID0gMHgyNzcyOwogIHQuYTg4ID0gMHgyNzczOwogIHQuYTk1ID0gMHgyNzc0OwogIHQuYTk2ID0gMHgyNzc1OwogIHRbIi5ub3RkZWYiXSA9IDB4MDAwMDsKfSk7Cgo7Ly8gLi9zcmMvY29yZS91bmljb2RlLmpzCgpjb25zdCBnZXRTcGVjaWFsUFVBU3ltYm9scyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHRbNjM3MjFdID0gMHgwMGE5OwogIHRbNjMxOTNdID0gMHgwMGE5OwogIHRbNjM3MjBdID0gMHgwMGFlOwogIHRbNjMxOTRdID0gMHgwMGFlOwogIHRbNjM3MjJdID0gMHgyMTIyOwogIHRbNjMxOTVdID0gMHgyMTIyOwogIHRbNjM3MjldID0gMHgyM2E3OwogIHRbNjM3MzBdID0gMHgyM2E4OwogIHRbNjM3MzFdID0gMHgyM2E5OwogIHRbNjM3NDBdID0gMHgyM2FiOwogIHRbNjM3NDFdID0gMHgyM2FjOwogIHRbNjM3NDJdID0gMHgyM2FkOwogIHRbNjM3MjZdID0gMHgyM2ExOwogIHRbNjM3MjddID0gMHgyM2EyOwogIHRbNjM3MjhdID0gMHgyM2EzOwogIHRbNjM3MzddID0gMHgyM2E0OwogIHRbNjM3MzhdID0gMHgyM2E1OwogIHRbNjM3MzldID0gMHgyM2E2OwogIHRbNjM3MjNdID0gMHgyMzliOwogIHRbNjM3MjRdID0gMHgyMzljOwogIHRbNjM3MjVdID0gMHgyMzlkOwogIHRbNjM3MzRdID0gMHgyMzllOwogIHRbNjM3MzVdID0gMHgyMzlmOwogIHRbNjM3MzZdID0gMHgyM2EwOwp9KTsKZnVuY3Rpb24gbWFwU3BlY2lhbFVuaWNvZGVWYWx1ZXMoY29kZSkgewogIGlmIChjb2RlID49IDB4ZmZmMCAmJiBjb2RlIDw9IDB4ZmZmZikgewogICAgcmV0dXJuIDA7CiAgfSBlbHNlIGlmIChjb2RlID49IDB4ZjYwMCAmJiBjb2RlIDw9IDB4ZjhmZikgewogICAgcmV0dXJuIGdldFNwZWNpYWxQVUFTeW1ib2xzKClbY29kZV0gfHwgY29kZTsKICB9IGVsc2UgaWYgKGNvZGUgPT09IDB4MDBhZCkgewogICAgcmV0dXJuIDB4MDAyZDsKICB9CiAgcmV0dXJuIGNvZGU7Cn0KZnVuY3Rpb24gZ2V0VW5pY29kZUZvckdseXBoKG5hbWUsIGdseXBoc1VuaWNvZGVNYXApIHsKICBsZXQgdW5pY29kZSA9IGdseXBoc1VuaWNvZGVNYXBbbmFtZV07CiAgaWYgKHVuaWNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIHVuaWNvZGU7CiAgfQogIGlmICghbmFtZSkgewogICAgcmV0dXJuIC0xOwogIH0KICBpZiAobmFtZVswXSA9PT0gInUiKSB7CiAgICBjb25zdCBuYW1lTGVuID0gbmFtZS5sZW5ndGg7CiAgICBsZXQgaGV4U3RyOwogICAgaWYgKG5hbWVMZW4gPT09IDcgJiYgbmFtZVsxXSA9PT0gIm4iICYmIG5hbWVbMl0gPT09ICJpIikgewogICAgICBoZXhTdHIgPSBuYW1lLnN1YnN0cmluZygzKTsKICAgIH0gZWxzZSBpZiAobmFtZUxlbiA+PSA1ICYmIG5hbWVMZW4gPD0gNykgewogICAgICBoZXhTdHIgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIGlmIChoZXhTdHIgPT09IGhleFN0ci50b1VwcGVyQ2FzZSgpKSB7CiAgICAgIHVuaWNvZGUgPSBwYXJzZUludChoZXhTdHIsIDE2KTsKICAgICAgaWYgKHVuaWNvZGUgPj0gMCkgewogICAgICAgIHJldHVybiB1bmljb2RlOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiAtMTsKfQpjb25zdCBVbmljb2RlUmFuZ2VzID0gW1sweDAwMDAsIDB4MDA3Zl0sIFsweDAwODAsIDB4MDBmZl0sIFsweDAxMDAsIDB4MDE3Zl0sIFsweDAxODAsIDB4MDI0Zl0sIFsweDAyNTAsIDB4MDJhZiwgMHgxZDAwLCAweDFkN2YsIDB4MWQ4MCwgMHgxZGJmXSwgWzB4MDJiMCwgMHgwMmZmLCAweGE3MDAsIDB4YTcxZl0sIFsweDAzMDAsIDB4MDM2ZiwgMHgxZGMwLCAweDFkZmZdLCBbMHgwMzcwLCAweDAzZmZdLCBbMHgyYzgwLCAweDJjZmZdLCBbMHgwNDAwLCAweDA0ZmYsIDB4MDUwMCwgMHgwNTJmLCAweDJkZTAsIDB4MmRmZiwgMHhhNjQwLCAweGE2OWZdLCBbMHgwNTMwLCAweDA1OGZdLCBbMHgwNTkwLCAweDA1ZmZdLCBbMHhhNTAwLCAweGE2M2ZdLCBbMHgwNjAwLCAweDA2ZmYsIDB4MDc1MCwgMHgwNzdmXSwgWzB4MDdjMCwgMHgwN2ZmXSwgWzB4MDkwMCwgMHgwOTdmXSwgWzB4MDk4MCwgMHgwOWZmXSwgWzB4MGEwMCwgMHgwYTdmXSwgWzB4MGE4MCwgMHgwYWZmXSwgWzB4MGIwMCwgMHgwYjdmXSwgWzB4MGI4MCwgMHgwYmZmXSwgWzB4MGMwMCwgMHgwYzdmXSwgWzB4MGM4MCwgMHgwY2ZmXSwgWzB4MGQwMCwgMHgwZDdmXSwgWzB4MGUwMCwgMHgwZTdmXSwgWzB4MGU4MCwgMHgwZWZmXSwgWzB4MTBhMCwgMHgxMGZmLCAweDJkMDAsIDB4MmQyZl0sIFsweDFiMDAsIDB4MWI3Zl0sIFsweDExMDAsIDB4MTFmZl0sIFsweDFlMDAsIDB4MWVmZiwgMHgyYzYwLCAweDJjN2YsIDB4YTcyMCwgMHhhN2ZmXSwgWzB4MWYwMCwgMHgxZmZmXSwgWzB4MjAwMCwgMHgyMDZmLCAweDJlMDAsIDB4MmU3Zl0sIFsweDIwNzAsIDB4MjA5Zl0sIFsweDIwYTAsIDB4MjBjZl0sIFsweDIwZDAsIDB4MjBmZl0sIFsweDIxMDAsIDB4MjE0Zl0sIFsweDIxNTAsIDB4MjE4Zl0sIFsweDIxOTAsIDB4MjFmZiwgMHgyN2YwLCAweDI3ZmYsIDB4MjkwMCwgMHgyOTdmLCAweDJiMDAsIDB4MmJmZl0sIFsweDIyMDAsIDB4MjJmZiwgMHgyYTAwLCAweDJhZmYsIDB4MjdjMCwgMHgyN2VmLCAweDI5ODAsIDB4MjlmZl0sIFsweDIzMDAsIDB4MjNmZl0sIFsweDI0MDAsIDB4MjQzZl0sIFsweDI0NDAsIDB4MjQ1Zl0sIFsweDI0NjAsIDB4MjRmZl0sIFsweDI1MDAsIDB4MjU3Zl0sIFsweDI1ODAsIDB4MjU5Zl0sIFsweDI1YTAsIDB4MjVmZl0sIFsweDI2MDAsIDB4MjZmZl0sIFsweDI3MDAsIDB4MjdiZl0sIFsweDMwMDAsIDB4MzAzZl0sIFsweDMwNDAsIDB4MzA5Zl0sIFsweDMwYTAsIDB4MzBmZiwgMHgzMWYwLCAweDMxZmZdLCBbMHgzMTAwLCAweDMxMmYsIDB4MzFhMCwgMHgzMWJmXSwgWzB4MzEzMCwgMHgzMThmXSwgWzB4YTg0MCwgMHhhODdmXSwgWzB4MzIwMCwgMHgzMmZmXSwgWzB4MzMwMCwgMHgzM2ZmXSwgWzB4YWMwMCwgMHhkN2FmXSwgWzB4ZDgwMCwgMHhkZmZmXSwgWzB4MTA5MDAsIDB4MTA5MWZdLCBbMHg0ZTAwLCAweDlmZmYsIDB4MmU4MCwgMHgyZWZmLCAweDJmMDAsIDB4MmZkZiwgMHgyZmYwLCAweDJmZmYsIDB4MzQwMCwgMHg0ZGJmLCAweDIwMDAwLCAweDJhNmRmLCAweDMxOTAsIDB4MzE5Zl0sIFsweGUwMDAsIDB4ZjhmZl0sIFsweDMxYzAsIDB4MzFlZiwgMHhmOTAwLCAweGZhZmYsIDB4MmY4MDAsIDB4MmZhMWZdLCBbMHhmYjAwLCAweGZiNGZdLCBbMHhmYjUwLCAweGZkZmZdLCBbMHhmZTIwLCAweGZlMmZdLCBbMHhmZTEwLCAweGZlMWZdLCBbMHhmZTUwLCAweGZlNmZdLCBbMHhmZTcwLCAweGZlZmZdLCBbMHhmZjAwLCAweGZmZWZdLCBbMHhmZmYwLCAweGZmZmZdLCBbMHgwZjAwLCAweDBmZmZdLCBbMHgwNzAwLCAweDA3NGZdLCBbMHgwNzgwLCAweDA3YmZdLCBbMHgwZDgwLCAweDBkZmZdLCBbMHgxMDAwLCAweDEwOWZdLCBbMHgxMjAwLCAweDEzN2YsIDB4MTM4MCwgMHgxMzlmLCAweDJkODAsIDB4MmRkZl0sIFsweDEzYTAsIDB4MTNmZl0sIFsweDE0MDAsIDB4MTY3Zl0sIFsweDE2ODAsIDB4MTY5Zl0sIFsweDE2YTAsIDB4MTZmZl0sIFsweDE3ODAsIDB4MTdmZl0sIFsweDE4MDAsIDB4MThhZl0sIFsweDI4MDAsIDB4MjhmZl0sIFsweGEwMDAsIDB4YTQ4Zl0sIFsweDE3MDAsIDB4MTcxZiwgMHgxNzIwLCAweDE3M2YsIDB4MTc0MCwgMHgxNzVmLCAweDE3NjAsIDB4MTc3Zl0sIFsweDEwMzAwLCAweDEwMzJmXSwgWzB4MTAzMzAsIDB4MTAzNGZdLCBbMHgxMDQwMCwgMHgxMDQ0Zl0sIFsweDFkMDAwLCAweDFkMGZmLCAweDFkMTAwLCAweDFkMWZmLCAweDFkMjAwLCAweDFkMjRmXSwgWzB4MWQ0MDAsIDB4MWQ3ZmZdLCBbMHhmZjAwMCwgMHhmZmZmZF0sIFsweGZlMDAsIDB4ZmUwZiwgMHhlMDEwMCwgMHhlMDFlZl0sIFsweGUwMDAwLCAweGUwMDdmXSwgWzB4MTkwMCwgMHgxOTRmXSwgWzB4MTk1MCwgMHgxOTdmXSwgWzB4MTk4MCwgMHgxOWRmXSwgWzB4MWEwMCwgMHgxYTFmXSwgWzB4MmMwMCwgMHgyYzVmXSwgWzB4MmQzMCwgMHgyZDdmXSwgWzB4NGRjMCwgMHg0ZGZmXSwgWzB4YTgwMCwgMHhhODJmXSwgWzB4MTAwMDAsIDB4MTAwN2YsIDB4MTAwODAsIDB4MTAwZmYsIDB4MTAxMDAsIDB4MTAxM2ZdLCBbMHgxMDE0MCwgMHgxMDE4Zl0sIFsweDEwMzgwLCAweDEwMzlmXSwgWzB4MTAzYTAsIDB4MTAzZGZdLCBbMHgxMDQ1MCwgMHgxMDQ3Zl0sIFsweDEwNDgwLCAweDEwNGFmXSwgWzB4MTA4MDAsIDB4MTA4M2ZdLCBbMHgxMGEwMCwgMHgxMGE1Zl0sIFsweDFkMzAwLCAweDFkMzVmXSwgWzB4MTIwMDAsIDB4MTIzZmYsIDB4MTI0MDAsIDB4MTI0N2ZdLCBbMHgxZDM2MCwgMHgxZDM3Zl0sIFsweDFiODAsIDB4MWJiZl0sIFsweDFjMDAsIDB4MWM0Zl0sIFsweDFjNTAsIDB4MWM3Zl0sIFsweGE4ODAsIDB4YThkZl0sIFsweGE5MDAsIDB4YTkyZl0sIFsweGE5MzAsIDB4YTk1Zl0sIFsweGFhMDAsIDB4YWE1Zl0sIFsweDEwMTkwLCAweDEwMWNmXSwgWzB4MTAxZDAsIDB4MTAxZmZdLCBbMHgxMDJhMCwgMHgxMDJkZiwgMHgxMDI4MCwgMHgxMDI5ZiwgMHgxMDkyMCwgMHgxMDkzZl0sIFsweDFmMDMwLCAweDFmMDlmLCAweDFmMDAwLCAweDFmMDJmXV07CmZ1bmN0aW9uIGdldFVuaWNvZGVSYW5nZUZvcih2YWx1ZSwgbGFzdFBvc2l0aW9uID0gLTEpIHsKICBpZiAobGFzdFBvc2l0aW9uICE9PSAtMSkgewogICAgY29uc3QgcmFuZ2UgPSBVbmljb2RlUmFuZ2VzW2xhc3RQb3NpdGlvbl07CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSByYW5nZS5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIGlmICh2YWx1ZSA+PSByYW5nZVtpXSAmJiB2YWx1ZSA8PSByYW5nZVtpICsgMV0pIHsKICAgICAgICByZXR1cm4gbGFzdFBvc2l0aW9uOwogICAgICB9CiAgICB9CiAgfQogIGZvciAobGV0IGkgPSAwLCBpaSA9IFVuaWNvZGVSYW5nZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgcmFuZ2UgPSBVbmljb2RlUmFuZ2VzW2ldOwogICAgZm9yIChsZXQgaiA9IDAsIGpqID0gcmFuZ2UubGVuZ3RoOyBqIDwgamo7IGogKz0gMikgewogICAgICBpZiAodmFsdWUgPj0gcmFuZ2Vbal0gJiYgdmFsdWUgPD0gcmFuZ2VbaiArIDFdKSB7CiAgICAgICAgcmV0dXJuIGk7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIC0xOwp9CmNvbnN0IFNwZWNpYWxDaGFyUmVnRXhwID0gbmV3IFJlZ0V4cCgiXihcXHMpfChcXHB7TW59KXwoXFxwe0NmfSkkIiwgInUiKTsKY29uc3QgQ2F0ZWdvcnlDYWNoZSA9IG5ldyBNYXAoKTsKZnVuY3Rpb24gZ2V0Q2hhclVuaWNvZGVDYXRlZ29yeShjaGFyKSB7CiAgY29uc3QgY2FjaGVkQ2F0ZWdvcnkgPSBDYXRlZ29yeUNhY2hlLmdldChjaGFyKTsKICBpZiAoY2FjaGVkQ2F0ZWdvcnkpIHsKICAgIHJldHVybiBjYWNoZWRDYXRlZ29yeTsKICB9CiAgY29uc3QgZ3JvdXBzID0gY2hhci5tYXRjaChTcGVjaWFsQ2hhclJlZ0V4cCk7CiAgY29uc3QgY2F0ZWdvcnkgPSB7CiAgICBpc1doaXRlc3BhY2U6ICEhZ3JvdXBzPy5bMV0sCiAgICBpc1plcm9XaWR0aERpYWNyaXRpYzogISFncm91cHM/LlsyXSwKICAgIGlzSW52aXNpYmxlRm9ybWF0TWFyazogISFncm91cHM/LlszXQogIH07CiAgQ2F0ZWdvcnlDYWNoZS5zZXQoY2hhciwgY2F0ZWdvcnkpOwogIHJldHVybiBjYXRlZ29yeTsKfQpmdW5jdGlvbiBjbGVhclVuaWNvZGVDYWNoZXMoKSB7CiAgQ2F0ZWdvcnlDYWNoZS5jbGVhcigpOwp9Cgo7Ly8gLi9zcmMvY29yZS9mb250c191dGlscy5qcwoKCgoKCmNvbnN0IFNFQUNfQU5BTFlTSVNfRU5BQkxFRCA9IHRydWU7CmNvbnN0IEZvbnRGbGFncyA9IHsKICBGaXhlZFBpdGNoOiAxLAogIFNlcmlmOiAyLAogIFN5bWJvbGljOiA0LAogIFNjcmlwdDogOCwKICBOb25zeW1ib2xpYzogMzIsCiAgSXRhbGljOiA2NCwKICBBbGxDYXA6IDY1NTM2LAogIFNtYWxsQ2FwOiAxMzEwNzIsCiAgRm9yY2VCb2xkOiAyNjIxNDQKfTsKY29uc3QgTWFjU3RhbmRhcmRHbHlwaE9yZGVyaW5nID0gWyIubm90ZGVmIiwgIi5udWxsIiwgIm5vbm1hcmtpbmdyZXR1cm4iLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3Rlc2luZ2xlIiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJncmF2ZSIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiQWRpZXJlc2lzIiwgIkFyaW5nIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJOdGlsZGUiLCAiT2RpZXJlc2lzIiwgIlVkaWVyZXNpcyIsICJhYWN1dGUiLCAiYWdyYXZlIiwgImFjaXJjdW1mbGV4IiwgImFkaWVyZXNpcyIsICJhdGlsZGUiLCAiYXJpbmciLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVncmF2ZSIsICJlY2lyY3VtZmxleCIsICJlZGllcmVzaXMiLCAiaWFjdXRlIiwgImlncmF2ZSIsICJpY2lyY3VtZmxleCIsICJpZGllcmVzaXMiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvZ3JhdmUiLCAib2NpcmN1bWZsZXgiLCAib2RpZXJlc2lzIiwgIm90aWxkZSIsICJ1YWN1dGUiLCAidWdyYXZlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJkYWdnZXIiLCAiZGVncmVlIiwgImNlbnQiLCAic3RlcmxpbmciLCAic2VjdGlvbiIsICJidWxsZXQiLCAicGFyYWdyYXBoIiwgImdlcm1hbmRibHMiLCAicmVnaXN0ZXJlZCIsICJjb3B5cmlnaHQiLCAidHJhZGVtYXJrIiwgImFjdXRlIiwgImRpZXJlc2lzIiwgIm5vdGVxdWFsIiwgIkFFIiwgIk9zbGFzaCIsICJpbmZpbml0eSIsICJwbHVzbWludXMiLCAibGVzc2VxdWFsIiwgImdyZWF0ZXJlcXVhbCIsICJ5ZW4iLCAibXUiLCAicGFydGlhbGRpZmYiLCAic3VtbWF0aW9uIiwgInByb2R1Y3QiLCAicGkiLCAiaW50ZWdyYWwiLCAib3JkZmVtaW5pbmUiLCAib3JkbWFzY3VsaW5lIiwgIk9tZWdhIiwgImFlIiwgIm9zbGFzaCIsICJxdWVzdGlvbmRvd24iLCAiZXhjbGFtZG93biIsICJsb2dpY2Fsbm90IiwgInJhZGljYWwiLCAiZmxvcmluIiwgImFwcHJveGVxdWFsIiwgIkRlbHRhIiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAibm9uYnJlYWtpbmdzcGFjZSIsICJBZ3JhdmUiLCAiQXRpbGRlIiwgIk90aWxkZSIsICJPRSIsICJvZSIsICJlbmRhc2giLCAiZW1kYXNoIiwgInF1b3RlZGJsbGVmdCIsICJxdW90ZWRibHJpZ2h0IiwgInF1b3RlbGVmdCIsICJxdW90ZXJpZ2h0IiwgImRpdmlkZSIsICJsb3plbmdlIiwgInlkaWVyZXNpcyIsICJZZGllcmVzaXMiLCAiZnJhY3Rpb24iLCAiY3VycmVuY3kiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJkYWdnZXJkYmwiLCAicGVyaW9kY2VudGVyZWQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInBlcnRob3VzYW5kIiwgIkFjaXJjdW1mbGV4IiwgIkVjaXJjdW1mbGV4IiwgIkFhY3V0ZSIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk9hY3V0ZSIsICJPY2lyY3VtZmxleCIsICJhcHBsZSIsICJPZ3JhdmUiLCAiVWFjdXRlIiwgIlVjaXJjdW1mbGV4IiwgIlVncmF2ZSIsICJkb3RsZXNzaSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiTHNsYXNoIiwgImxzbGFzaCIsICJTY2Fyb24iLCAic2Nhcm9uIiwgIlpjYXJvbiIsICJ6Y2Fyb24iLCAiYnJva2VuYmFyIiwgIkV0aCIsICJldGgiLCAiWWFjdXRlIiwgInlhY3V0ZSIsICJUaG9ybiIsICJ0aG9ybiIsICJtaW51cyIsICJtdWx0aXBseSIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgIm9uZWhhbGYiLCAib25lcXVhcnRlciIsICJ0aHJlZXF1YXJ0ZXJzIiwgImZyYW5jIiwgIkdicmV2ZSIsICJnYnJldmUiLCAiSWRvdGFjY2VudCIsICJTY2VkaWxsYSIsICJzY2VkaWxsYSIsICJDYWN1dGUiLCAiY2FjdXRlIiwgIkNjYXJvbiIsICJjY2Fyb24iLCAiZGNyb2F0Il07CmZ1bmN0aW9uIHJlY292ZXJHbHlwaE5hbWUobmFtZSwgZ2x5cGhzVW5pY29kZU1hcCkgewogIGlmIChnbHlwaHNVbmljb2RlTWFwW25hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBuYW1lOwogIH0KICBjb25zdCB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKG5hbWUsIGdseXBoc1VuaWNvZGVNYXApOwogIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgZm9yIChjb25zdCBrZXkgaW4gZ2x5cGhzVW5pY29kZU1hcCkgewogICAgICBpZiAoZ2x5cGhzVW5pY29kZU1hcFtrZXldID09PSB1bmljb2RlKSB7CiAgICAgICAgcmV0dXJuIGtleTsKICAgICAgfQogICAgfQogIH0KICBpbmZvKCJVbmFibGUgdG8gcmVjb3ZlciBhIHN0YW5kYXJkIGdseXBoIG5hbWUgZm9yOiAiICsgbmFtZSk7CiAgcmV0dXJuIG5hbWU7Cn0KZnVuY3Rpb24gdHlwZTFGb250R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMsIGJ1aWx0SW5FbmNvZGluZywgZ2x5cGhOYW1lcykgewogIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBsZXQgZ2x5cGhJZCwgY2hhckNvZGUsIGJhc2VFbmNvZGluZzsKICBjb25zdCBpc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU3ltYm9saWMpOwogIGlmIChwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250KSB7CiAgICBiYXNlRW5jb2RpbmcgPSBidWlsdEluRW5jb2Rpbmc7CiAgICBmb3IgKGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCBiYXNlRW5jb2RpbmcubGVuZ3RoOyBjaGFyQ29kZSsrKSB7CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoYmFzZUVuY29kaW5nW2NoYXJDb2RlXSk7CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgPj0gMCA/IGdseXBoSWQgOiAwOwogICAgfQogIH0gZWxzZSBpZiAocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lKSB7CiAgICBiYXNlRW5jb2RpbmcgPSBnZXRFbmNvZGluZyhwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUpOwogICAgZm9yIChjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgYmFzZUVuY29kaW5nLmxlbmd0aDsgY2hhckNvZGUrKykgewogICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGJhc2VFbmNvZGluZ1tjaGFyQ29kZV0pOwogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkID49IDAgPyBnbHlwaElkIDogMDsKICAgIH0KICB9IGVsc2UgaWYgKGlzU3ltYm9saWNGb250KSB7CiAgICBmb3IgKGNoYXJDb2RlIGluIGJ1aWx0SW5FbmNvZGluZykgewogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBidWlsdEluRW5jb2RpbmdbY2hhckNvZGVdOwogICAgfQogIH0gZWxzZSB7CiAgICBiYXNlRW5jb2RpbmcgPSBTdGFuZGFyZEVuY29kaW5nOwogICAgZm9yIChjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgYmFzZUVuY29kaW5nLmxlbmd0aDsgY2hhckNvZGUrKykgewogICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGJhc2VFbmNvZGluZ1tjaGFyQ29kZV0pOwogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkID49IDAgPyBnbHlwaElkIDogMDsKICAgIH0KICB9CiAgY29uc3QgZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogIGxldCBnbHlwaHNVbmljb2RlTWFwOwogIGlmIChkaWZmZXJlbmNlcykgewogICAgZm9yIChjaGFyQ29kZSBpbiBkaWZmZXJlbmNlcykgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSBkaWZmZXJlbmNlc1tjaGFyQ29kZV07CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoZ2x5cGhOYW1lKTsKICAgICAgaWYgKGdseXBoSWQgPT09IC0xKSB7CiAgICAgICAgaWYgKCFnbHlwaHNVbmljb2RlTWFwKSB7CiAgICAgICAgICBnbHlwaHNVbmljb2RlTWFwID0gZ2V0R2x5cGhzVW5pY29kZSgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBzdGFuZGFyZEdseXBoTmFtZSA9IHJlY292ZXJHbHlwaE5hbWUoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgICAgICBpZiAoc3RhbmRhcmRHbHlwaE5hbWUgIT09IGdseXBoTmFtZSkgewogICAgICAgICAgZ2x5cGhJZCA9IGdseXBoTmFtZXMuaW5kZXhPZihzdGFuZGFyZEdseXBoTmFtZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgPj0gMCA/IGdseXBoSWQgOiAwOwogICAgfQogIH0KICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7Cn0KZnVuY3Rpb24gbm9ybWFsaXplRm9udE5hbWUobmFtZSkgewogIHJldHVybiBuYW1lLnJlcGxhY2VBbGwoL1ssX10vZywgIi0iKS5yZXBsYWNlQWxsKC9ccy9nLCAiIik7Cn0KY29uc3QgZ2V0VmVydGljYWxQcmVzZW50YXRpb25Gb3JtID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KHQgPT4gewogIHRbMHgyMDEzXSA9IDB4ZmUzMjsKICB0WzB4MjAxNF0gPSAweGZlMzE7CiAgdFsweDIwMjVdID0gMHhmZTMwOwogIHRbMHgyMDI2XSA9IDB4ZmUxOTsKICB0WzB4MzAwMV0gPSAweGZlMTE7CiAgdFsweDMwMDJdID0gMHhmZTEyOwogIHRbMHgzMDA4XSA9IDB4ZmUzZjsKICB0WzB4MzAwOV0gPSAweGZlNDA7CiAgdFsweDMwMGFdID0gMHhmZTNkOwogIHRbMHgzMDBiXSA9IDB4ZmUzZTsKICB0WzB4MzAwY10gPSAweGZlNDE7CiAgdFsweDMwMGRdID0gMHhmZTQyOwogIHRbMHgzMDBlXSA9IDB4ZmU0MzsKICB0WzB4MzAwZl0gPSAweGZlNDQ7CiAgdFsweDMwMTBdID0gMHhmZTNiOwogIHRbMHgzMDExXSA9IDB4ZmUzYzsKICB0WzB4MzAxNF0gPSAweGZlMzk7CiAgdFsweDMwMTVdID0gMHhmZTNhOwogIHRbMHgzMDE2XSA9IDB4ZmUxNzsKICB0WzB4MzAxN10gPSAweGZlMTg7CiAgdFsweGZlNGZdID0gMHhmZTM0OwogIHRbMHhmZjAxXSA9IDB4ZmUxNTsKICB0WzB4ZmYwOF0gPSAweGZlMzU7CiAgdFsweGZmMDldID0gMHhmZTM2OwogIHRbMHhmZjBjXSA9IDB4ZmUxMDsKICB0WzB4ZmYxYV0gPSAweGZlMTM7CiAgdFsweGZmMWJdID0gMHhmZTE0OwogIHRbMHhmZjFmXSA9IDB4ZmUxNjsKICB0WzB4ZmYzYl0gPSAweGZlNDc7CiAgdFsweGZmM2RdID0gMHhmZTQ4OwogIHRbMHhmZjNmXSA9IDB4ZmUzMzsKICB0WzB4ZmY1Yl0gPSAweGZlMzc7CiAgdFsweGZmNWRdID0gMHhmZTM4Owp9KTsKY29uc3QgTUFYX1NJWkVfVE9fQ09NUElMRSA9IDEwMDA7CmZ1bmN0aW9uIGNvbXBpbGVUeXBlM0dseXBoKHsKICBkYXRhOiBpbWcsCiAgd2lkdGgsCiAgaGVpZ2h0Cn0pIHsKICBpZiAod2lkdGggPiBNQVhfU0laRV9UT19DT01QSUxFIHx8IGhlaWdodCA+IE1BWF9TSVpFX1RPX0NPTVBJTEUpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBQT0lOVF9UT19QUk9DRVNTX0xJTUlUID0gMTAwMDsKICBjb25zdCBQT0lOVF9UWVBFUyA9IG5ldyBVaW50OEFycmF5KFswLCAyLCA0LCAwLCAxLCAwLCA1LCA0LCA4LCAxMCwgMCwgOCwgMCwgMiwgMSwgMF0pOwogIGNvbnN0IHdpZHRoMSA9IHdpZHRoICsgMTsKICBjb25zdCBwb2ludHMgPSBuZXcgVWludDhBcnJheSh3aWR0aDEgKiAoaGVpZ2h0ICsgMSkpOwogIGxldCBpLCBqLCBqMDsKICBjb25zdCBsaW5lU2l6ZSA9IHdpZHRoICsgNyAmIH43OwogIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShsaW5lU2l6ZSAqIGhlaWdodCk7CiAgbGV0IHBvcyA9IDA7CiAgZm9yIChjb25zdCBlbGVtIG9mIGltZykgewogICAgbGV0IG1hc2sgPSAxMjg7CiAgICB3aGlsZSAobWFzayA+IDApIHsKICAgICAgZGF0YVtwb3MrK10gPSBlbGVtICYgbWFzayA/IDAgOiAyNTU7CiAgICAgIG1hc2sgPj49IDE7CiAgICB9CiAgfQogIGxldCBjb3VudCA9IDA7CiAgcG9zID0gMDsKICBpZiAoZGF0YVtwb3NdICE9PSAwKSB7CiAgICBwb2ludHNbMF0gPSAxOwogICAgKytjb3VudDsKICB9CiAgZm9yIChqID0gMTsgaiA8IHdpZHRoOyBqKyspIHsKICAgIGlmIChkYXRhW3Bvc10gIT09IGRhdGFbcG9zICsgMV0pIHsKICAgICAgcG9pbnRzW2pdID0gZGF0YVtwb3NdID8gMiA6IDE7CiAgICAgICsrY291bnQ7CiAgICB9CiAgICBwb3MrKzsKICB9CiAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgcG9pbnRzW2pdID0gMjsKICAgICsrY291bnQ7CiAgfQogIGZvciAoaSA9IDE7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgcG9zID0gaSAqIGxpbmVTaXplOwogICAgajAgPSBpICogd2lkdGgxOwogICAgaWYgKGRhdGFbcG9zIC0gbGluZVNpemVdICE9PSBkYXRhW3Bvc10pIHsKICAgICAgcG9pbnRzW2owXSA9IGRhdGFbcG9zXSA/IDEgOiA4OwogICAgICArK2NvdW50OwogICAgfQogICAgbGV0IHN1bSA9IChkYXRhW3Bvc10gPyA0IDogMCkgKyAoZGF0YVtwb3MgLSBsaW5lU2l6ZV0gPyA4IDogMCk7CiAgICBmb3IgKGogPSAxOyBqIDwgd2lkdGg7IGorKykgewogICAgICBzdW0gPSAoc3VtID4+IDIpICsgKGRhdGFbcG9zICsgMV0gPyA0IDogMCkgKyAoZGF0YVtwb3MgLSBsaW5lU2l6ZSArIDFdID8gOCA6IDApOwogICAgICBpZiAoUE9JTlRfVFlQRVNbc3VtXSkgewogICAgICAgIHBvaW50c1tqMCArIGpdID0gUE9JTlRfVFlQRVNbc3VtXTsKICAgICAgICArK2NvdW50OwogICAgICB9CiAgICAgIHBvcysrOwogICAgfQogICAgaWYgKGRhdGFbcG9zIC0gbGluZVNpemVdICE9PSBkYXRhW3Bvc10pIHsKICAgICAgcG9pbnRzW2owICsgal0gPSBkYXRhW3Bvc10gPyAyIDogNDsKICAgICAgKytjb3VudDsKICAgIH0KICAgIGlmIChjb3VudCA+IFBPSU5UX1RPX1BST0NFU1NfTElNSVQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQogIHBvcyA9IGxpbmVTaXplICogKGhlaWdodCAtIDEpOwogIGowID0gaSAqIHdpZHRoMTsKICBpZiAoZGF0YVtwb3NdICE9PSAwKSB7CiAgICBwb2ludHNbajBdID0gODsKICAgICsrY291bnQ7CiAgfQogIGZvciAoaiA9IDE7IGogPCB3aWR0aDsgaisrKSB7CiAgICBpZiAoZGF0YVtwb3NdICE9PSBkYXRhW3BvcyArIDFdKSB7CiAgICAgIHBvaW50c1tqMCArIGpdID0gZGF0YVtwb3NdID8gNCA6IDg7CiAgICAgICsrY291bnQ7CiAgICB9CiAgICBwb3MrKzsKICB9CiAgaWYgKGRhdGFbcG9zXSAhPT0gMCkgewogICAgcG9pbnRzW2owICsgal0gPSA0OwogICAgKytjb3VudDsKICB9CiAgaWYgKGNvdW50ID4gUE9JTlRfVE9fUFJPQ0VTU19MSU1JVCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IHN0ZXBzID0gbmV3IEludDMyQXJyYXkoWzAsIHdpZHRoMSwgLTEsIDAsIC13aWR0aDEsIDAsIDAsIDAsIDFdKTsKICBjb25zdCBwYXRoQnVmID0gW107CiAgY29uc3QgewogICAgYSwKICAgIGIsCiAgICBjLAogICAgZCwKICAgIGUsCiAgICBmCiAgfSA9IG5ldyBET01NYXRyaXgoKS5zY2FsZVNlbGYoMSAvIHdpZHRoLCAtMSAvIGhlaWdodCkudHJhbnNsYXRlU2VsZigwLCAtaGVpZ2h0KTsKICBmb3IgKGkgPSAwOyBjb3VudCAmJiBpIDw9IGhlaWdodDsgaSsrKSB7CiAgICBsZXQgcCA9IGkgKiB3aWR0aDE7CiAgICBjb25zdCBlbmQgPSBwICsgd2lkdGg7CiAgICB3aGlsZSAocCA8IGVuZCAmJiAhcG9pbnRzW3BdKSB7CiAgICAgIHArKzsKICAgIH0KICAgIGlmIChwID09PSBlbmQpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgeCA9IHAgJSB3aWR0aDE7CiAgICBsZXQgeSA9IGk7CiAgICBwYXRoQnVmLnB1c2goRHJhd09QUy5tb3ZlVG8sIGEgKiB4ICsgYyAqIHkgKyBlLCBiICogeCArIGQgKiB5ICsgZik7CiAgICBjb25zdCBwMCA9IHA7CiAgICBsZXQgdHlwZSA9IHBvaW50c1twXTsKICAgIGRvIHsKICAgICAgY29uc3Qgc3RlcCA9IHN0ZXBzW3R5cGVdOwogICAgICBkbyB7CiAgICAgICAgcCArPSBzdGVwOwogICAgICB9IHdoaWxlICghcG9pbnRzW3BdKTsKICAgICAgY29uc3QgcHAgPSBwb2ludHNbcF07CiAgICAgIGlmIChwcCAhPT0gNSAmJiBwcCAhPT0gMTApIHsKICAgICAgICB0eXBlID0gcHA7CiAgICAgICAgcG9pbnRzW3BdID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0eXBlID0gcHAgJiAweDMzICogdHlwZSA+PiA0OwogICAgICAgIHBvaW50c1twXSAmPSB0eXBlID4+IDIgfCB0eXBlIDw8IDI7CiAgICAgIH0KICAgICAgeCA9IHAgJSB3aWR0aDE7CiAgICAgIHkgPSBwIC8gd2lkdGgxIHwgMDsKICAgICAgcGF0aEJ1Zi5wdXNoKERyYXdPUFMubGluZVRvLCBhICogeCArIGMgKiB5ICsgZSwgYiAqIHggKyBkICogeSArIGYpOwogICAgICBpZiAoIXBvaW50c1twXSkgewogICAgICAgIC0tY291bnQ7CiAgICAgIH0KICAgIH0gd2hpbGUgKHAwICE9PSBwKTsKICAgIC0taTsKICB9CiAgcmV0dXJuIFtPUFMucmF3RmlsbFBhdGgsIFtuZXcgRmxvYXQzMkFycmF5KHBhdGhCdWYpXSwgbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgd2lkdGgsIGhlaWdodF0pXTsKfQoKOy8vIC4vc3JjL2NvcmUvY2hhcnNldHMuanMKY29uc3QgSVNPQWRvYmVDaGFyc2V0ID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXJpZ2h0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJxdW90ZWxlZnQiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJmcmFjdGlvbiIsICJ5ZW4iLCAiZmxvcmluIiwgInNlY3Rpb24iLCAiY3VycmVuY3kiLCAicXVvdGVzaW5nbGUiLCAicXVvdGVkYmxsZWZ0IiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJlbmRhc2giLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICJwYXJhZ3JhcGgiLCAiYnVsbGV0IiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJxdW90ZWRibHJpZ2h0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgInBlcnRob3VzYW5kIiwgInF1ZXN0aW9uZG93biIsICJncmF2ZSIsICJhY3V0ZSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAiZGllcmVzaXMiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiZW1kYXNoIiwgIkFFIiwgIm9yZGZlbWluaW5lIiwgIkxzbGFzaCIsICJPc2xhc2giLCAiT0UiLCAib3JkbWFzY3VsaW5lIiwgImFlIiwgImRvdGxlc3NpIiwgImxzbGFzaCIsICJvc2xhc2giLCAib2UiLCAiZ2VybWFuZGJscyIsICJvbmVzdXBlcmlvciIsICJsb2dpY2Fsbm90IiwgIm11IiwgInRyYWRlbWFyayIsICJFdGgiLCAib25laGFsZiIsICJwbHVzbWludXMiLCAiVGhvcm4iLCAib25lcXVhcnRlciIsICJkaXZpZGUiLCAiYnJva2VuYmFyIiwgImRlZ3JlZSIsICJ0aG9ybiIsICJ0aHJlZXF1YXJ0ZXJzIiwgInR3b3N1cGVyaW9yIiwgInJlZ2lzdGVyZWQiLCAibWludXMiLCAiZXRoIiwgIm11bHRpcGx5IiwgInRocmVlc3VwZXJpb3IiLCAiY29weXJpZ2h0IiwgIkFhY3V0ZSIsICJBY2lyY3VtZmxleCIsICJBZGllcmVzaXMiLCAiQWdyYXZlIiwgIkFyaW5nIiwgIkF0aWxkZSIsICJDY2VkaWxsYSIsICJFYWN1dGUiLCAiRWNpcmN1bWZsZXgiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJOdGlsZGUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgIk9kaWVyZXNpcyIsICJPZ3JhdmUiLCAiT3RpbGRlIiwgIlNjYXJvbiIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWRpZXJlc2lzIiwgIlVncmF2ZSIsICJZYWN1dGUiLCAiWWRpZXJlc2lzIiwgIlpjYXJvbiIsICJhYWN1dGUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImFncmF2ZSIsICJhcmluZyIsICJhdGlsZGUiLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJlZ3JhdmUiLCAiaWFjdXRlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJpZ3JhdmUiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib2dyYXZlIiwgIm90aWxkZSIsICJzY2Fyb24iLCAidWFjdXRlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJ1Z3JhdmUiLCAieWFjdXRlIiwgInlkaWVyZXNpcyIsICJ6Y2Fyb24iXTsKY29uc3QgRXhwZXJ0Q2hhcnNldCA9IFsiLm5vdGRlZiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgInF1ZXN0aW9uc21hbGwiLCAiYXN1cGVyaW9yIiwgImJzdXBlcmlvciIsICJjZW50c3VwZXJpb3IiLCAiZHN1cGVyaW9yIiwgImVzdXBlcmlvciIsICJpc3VwZXJpb3IiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5zdXBlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICJTY2Fyb25zbWFsbCIsICJaY2Fyb25zbWFsbCIsICJEaWVyZXNpc3NtYWxsIiwgIkJyZXZlc21hbGwiLCAiQ2Fyb25zbWFsbCIsICJEb3RhY2NlbnRzbWFsbCIsICJNYWNyb25zbWFsbCIsICJmaWd1cmVkYXNoIiwgImh5cGhlbmluZmVyaW9yIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiLCAiQWdyYXZlc21hbGwiLCAiQWFjdXRlc21hbGwiLCAiQWNpcmN1bWZsZXhzbWFsbCIsICJBdGlsZGVzbWFsbCIsICJBZGllcmVzaXNzbWFsbCIsICJBcmluZ3NtYWxsIiwgIkFFc21hbGwiLCAiQ2NlZGlsbGFzbWFsbCIsICJFZ3JhdmVzbWFsbCIsICJFYWN1dGVzbWFsbCIsICJFY2lyY3VtZmxleHNtYWxsIiwgIkVkaWVyZXNpc3NtYWxsIiwgIklncmF2ZXNtYWxsIiwgIklhY3V0ZXNtYWxsIiwgIkljaXJjdW1mbGV4c21hbGwiLCAiSWRpZXJlc2lzc21hbGwiLCAiRXRoc21hbGwiLCAiTnRpbGRlc21hbGwiLCAiT2dyYXZlc21hbGwiLCAiT2FjdXRlc21hbGwiLCAiT2NpcmN1bWZsZXhzbWFsbCIsICJPdGlsZGVzbWFsbCIsICJPZGllcmVzaXNzbWFsbCIsICJPRXNtYWxsIiwgIk9zbGFzaHNtYWxsIiwgIlVncmF2ZXNtYWxsIiwgIlVhY3V0ZXNtYWxsIiwgIlVjaXJjdW1mbGV4c21hbGwiLCAiVWRpZXJlc2lzc21hbGwiLCAiWWFjdXRlc21hbGwiLCAiVGhvcm5zbWFsbCIsICJZZGllcmVzaXNzbWFsbCJdOwpjb25zdCBFeHBlcnRTdWJzZXRDaGFyc2V0ID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiaXN1cGVyaW9yIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICJyc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgInRzdXBlcmlvciIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJoeXBoZW5zdXBlcmlvciIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiY2VudG9sZHN0eWxlIiwgImZpZ3VyZWRhc2giLCAiaHlwaGVuaW5mZXJpb3IiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiXTsKCjsvLyAuL3NyYy9jb3JlL2NmZl9wYXJzZXIuanMKCgoKCmNvbnN0IE1BWF9TVUJSX05FU1RJTkcgPSAxMDsKY29uc3QgQ0ZGU3RhbmRhcmRTdHJpbmdzID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXJpZ2h0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJxdW90ZWxlZnQiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJmcmFjdGlvbiIsICJ5ZW4iLCAiZmxvcmluIiwgInNlY3Rpb24iLCAiY3VycmVuY3kiLCAicXVvdGVzaW5nbGUiLCAicXVvdGVkYmxsZWZ0IiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJlbmRhc2giLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICJwYXJhZ3JhcGgiLCAiYnVsbGV0IiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJxdW90ZWRibHJpZ2h0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgInBlcnRob3VzYW5kIiwgInF1ZXN0aW9uZG93biIsICJncmF2ZSIsICJhY3V0ZSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAiZGllcmVzaXMiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiZW1kYXNoIiwgIkFFIiwgIm9yZGZlbWluaW5lIiwgIkxzbGFzaCIsICJPc2xhc2giLCAiT0UiLCAib3JkbWFzY3VsaW5lIiwgImFlIiwgImRvdGxlc3NpIiwgImxzbGFzaCIsICJvc2xhc2giLCAib2UiLCAiZ2VybWFuZGJscyIsICJvbmVzdXBlcmlvciIsICJsb2dpY2Fsbm90IiwgIm11IiwgInRyYWRlbWFyayIsICJFdGgiLCAib25laGFsZiIsICJwbHVzbWludXMiLCAiVGhvcm4iLCAib25lcXVhcnRlciIsICJkaXZpZGUiLCAiYnJva2VuYmFyIiwgImRlZ3JlZSIsICJ0aG9ybiIsICJ0aHJlZXF1YXJ0ZXJzIiwgInR3b3N1cGVyaW9yIiwgInJlZ2lzdGVyZWQiLCAibWludXMiLCAiZXRoIiwgIm11bHRpcGx5IiwgInRocmVlc3VwZXJpb3IiLCAiY29weXJpZ2h0IiwgIkFhY3V0ZSIsICJBY2lyY3VtZmxleCIsICJBZGllcmVzaXMiLCAiQWdyYXZlIiwgIkFyaW5nIiwgIkF0aWxkZSIsICJDY2VkaWxsYSIsICJFYWN1dGUiLCAiRWNpcmN1bWZsZXgiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJOdGlsZGUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgIk9kaWVyZXNpcyIsICJPZ3JhdmUiLCAiT3RpbGRlIiwgIlNjYXJvbiIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWRpZXJlc2lzIiwgIlVncmF2ZSIsICJZYWN1dGUiLCAiWWRpZXJlc2lzIiwgIlpjYXJvbiIsICJhYWN1dGUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImFncmF2ZSIsICJhcmluZyIsICJhdGlsZGUiLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJlZ3JhdmUiLCAiaWFjdXRlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJpZ3JhdmUiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib2dyYXZlIiwgIm90aWxkZSIsICJzY2Fyb24iLCAidWFjdXRlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJ1Z3JhdmUiLCAieWFjdXRlIiwgInlkaWVyZXNpcyIsICJ6Y2Fyb24iLCAiZXhjbGFtc21hbGwiLCAiSHVuZ2FydW1sYXV0c21hbGwiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAiYW1wZXJzYW5kc21hbGwiLCAiQWN1dGVzbWFsbCIsICJwYXJlbmxlZnRzdXBlcmlvciIsICJwYXJlbnJpZ2h0c3VwZXJpb3IiLCAidHdvZG90ZW5sZWFkZXIiLCAib25lZG90ZW5sZWFkZXIiLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbW1hc3VwZXJpb3IiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICJwZXJpb2RzdXBlcmlvciIsICJxdWVzdGlvbnNtYWxsIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiaXN1cGVyaW9yIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICJyc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgInRzdXBlcmlvciIsICJmZiIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJDaXJjdW1mbGV4c21hbGwiLCAiaHlwaGVuc3VwZXJpb3IiLCAiR3JhdmVzbWFsbCIsICJBc21hbGwiLCAiQnNtYWxsIiwgIkNzbWFsbCIsICJEc21hbGwiLCAiRXNtYWxsIiwgIkZzbWFsbCIsICJHc21hbGwiLCAiSHNtYWxsIiwgIklzbWFsbCIsICJKc21hbGwiLCAiS3NtYWxsIiwgIkxzbWFsbCIsICJNc21hbGwiLCAiTnNtYWxsIiwgIk9zbWFsbCIsICJQc21hbGwiLCAiUXNtYWxsIiwgIlJzbWFsbCIsICJTc21hbGwiLCAiVHNtYWxsIiwgIlVzbWFsbCIsICJWc21hbGwiLCAiV3NtYWxsIiwgIlhzbWFsbCIsICJZc21hbGwiLCAiWnNtYWxsIiwgImNvbG9ubW9uZXRhcnkiLCAib25lZml0dGVkIiwgInJ1cGlhaCIsICJUaWxkZXNtYWxsIiwgImV4Y2xhbWRvd25zbWFsbCIsICJjZW50b2xkc3R5bGUiLCAiTHNsYXNoc21hbGwiLCAiU2Nhcm9uc21hbGwiLCAiWmNhcm9uc21hbGwiLCAiRGllcmVzaXNzbWFsbCIsICJCcmV2ZXNtYWxsIiwgIkNhcm9uc21hbGwiLCAiRG90YWNjZW50c21hbGwiLCAiTWFjcm9uc21hbGwiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICJPZ29uZWtzbWFsbCIsICJSaW5nc21hbGwiLCAiQ2VkaWxsYXNtYWxsIiwgInF1ZXN0aW9uZG93bnNtYWxsIiwgIm9uZWVpZ2h0aCIsICJ0aHJlZWVpZ2h0aHMiLCAiZml2ZWVpZ2h0aHMiLCAic2V2ZW5laWdodGhzIiwgIm9uZXRoaXJkIiwgInR3b3RoaXJkcyIsICJ6ZXJvc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIiwgIjAwMS4wMDAiLCAiMDAxLjAwMSIsICIwMDEuMDAyIiwgIjAwMS4wMDMiLCAiQmxhY2siLCAiQm9sZCIsICJCb29rIiwgIkxpZ2h0IiwgIk1lZGl1bSIsICJSZWd1bGFyIiwgIlJvbWFuIiwgIlNlbWlib2xkIl07CmNvbnN0IE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HUyA9IDM5MTsKY29uc3QgQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhID0gW251bGwsIHsKICBpZDogImhzdGVtIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICBzdGVtOiB0cnVlCn0sIG51bGwsIHsKICBpZDogInZzdGVtIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICBzdGVtOiB0cnVlCn0sIHsKICBpZDogInZtb3ZldG8iLAogIG1pbjogMSwKICBzdGFja0NsZWFyaW5nOiB0cnVlCn0sIHsKICBpZDogInJsaW5ldG8iLAogIG1pbjogMiwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImhsaW5ldG8iLAogIG1pbjogMSwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogInZsaW5ldG8iLAogIG1pbjogMSwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogInJyY3VydmV0byIsCiAgbWluOiA2LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgbnVsbCwgewogIGlkOiAiY2FsbHN1YnIiLAogIG1pbjogMSwKICB1bmRlZlN0YWNrOiB0cnVlCn0sIHsKICBpZDogInJldHVybiIsCiAgbWluOiAwLAogIHVuZGVmU3RhY2s6IHRydWUKfSwgbnVsbCwgbnVsbCwgewogIGlkOiAiZW5kY2hhciIsCiAgbWluOiAwLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgbnVsbCwgbnVsbCwgbnVsbCwgewogIGlkOiAiaHN0ZW1obSIsCiAgbWluOiAyLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgc3RlbTogdHJ1ZQp9LCB7CiAgaWQ6ICJoaW50bWFzayIsCiAgbWluOiAwLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAiY250cm1hc2siLAogIG1pbjogMCwKICBzdGFja0NsZWFyaW5nOiB0cnVlCn0sIHsKICBpZDogInJtb3ZldG8iLAogIG1pbjogMiwKICBzdGFja0NsZWFyaW5nOiB0cnVlCn0sIHsKICBpZDogImhtb3ZldG8iLAogIG1pbjogMSwKICBzdGFja0NsZWFyaW5nOiB0cnVlCn0sIHsKICBpZDogInZzdGVtaG0iLAogIG1pbjogMiwKICBzdGFja0NsZWFyaW5nOiB0cnVlLAogIHN0ZW06IHRydWUKfSwgewogIGlkOiAicmN1cnZlbGluZSIsCiAgbWluOiA4LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAicmxpbmVjdXJ2ZSIsCiAgbWluOiA4LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAidnZjdXJ2ZXRvIiwKICBtaW46IDQsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJoaGN1cnZldG8iLAogIG1pbjogNCwKICByZXNldFN0YWNrOiB0cnVlCn0sIG51bGwsIHsKICBpZDogImNhbGxnc3ViciIsCiAgbWluOiAxLAogIHVuZGVmU3RhY2s6IHRydWUKfSwgewogIGlkOiAidmhjdXJ2ZXRvIiwKICBtaW46IDQsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJodmN1cnZldG8iLAogIG1pbjogNCwKICByZXNldFN0YWNrOiB0cnVlCn1dOwpjb25zdCBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGExMiA9IFtudWxsLCBudWxsLCBudWxsLCB7CiAgaWQ6ICJhbmQiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMQp9LCB7CiAgaWQ6ICJvciIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xCn0sIHsKICBpZDogIm5vdCIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDAKfSwgbnVsbCwgbnVsbCwgbnVsbCwgewogIGlkOiAiYWJzIiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogMAp9LCB7CiAgaWQ6ICJhZGQiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMSwKICBzdGFja0ZuKHN0YWNrLCBpbmRleCkgewogICAgc3RhY2tbaW5kZXggLSAyXSA9IHN0YWNrW2luZGV4IC0gMl0gKyBzdGFja1tpbmRleCAtIDFdOwogIH0KfSwgewogIGlkOiAic3ViIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEsCiAgc3RhY2tGbihzdGFjaywgaW5kZXgpIHsKICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdIC0gc3RhY2tbaW5kZXggLSAxXTsKICB9Cn0sIHsKICBpZDogImRpdiIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xLAogIHN0YWNrRm4oc3RhY2ssIGluZGV4KSB7CiAgICBzdGFja1tpbmRleCAtIDJdID0gc3RhY2tbaW5kZXggLSAyXSAvIHN0YWNrW2luZGV4IC0gMV07CiAgfQp9LCBudWxsLCB7CiAgaWQ6ICJuZWciLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwLAogIHN0YWNrRm4oc3RhY2ssIGluZGV4KSB7CiAgICBzdGFja1tpbmRleCAtIDFdID0gLXN0YWNrW2luZGV4IC0gMV07CiAgfQp9LCB7CiAgaWQ6ICJlcSIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xCn0sIG51bGwsIG51bGwsIHsKICBpZDogImRyb3AiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAtMQp9LCBudWxsLCB7CiAgaWQ6ICJwdXQiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMgp9LCB7CiAgaWQ6ICJnZXQiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogImlmZWxzZSIsCiAgbWluOiA0LAogIHN0YWNrRGVsdGE6IC0zCn0sIHsKICBpZDogInJhbmRvbSIsCiAgbWluOiAwLAogIHN0YWNrRGVsdGE6IDEKfSwgewogIGlkOiAibXVsIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEsCiAgc3RhY2tGbihzdGFjaywgaW5kZXgpIHsKICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdICogc3RhY2tbaW5kZXggLSAxXTsKICB9Cn0sIG51bGwsIHsKICBpZDogInNxcnQiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogImR1cCIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDEKfSwgewogIGlkOiAiZXhjaCIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IDAKfSwgewogIGlkOiAiaW5kZXgiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogInJvbGwiLAogIG1pbjogMywKICBzdGFja0RlbHRhOiAtMgp9LCBudWxsLCBudWxsLCBudWxsLCB7CiAgaWQ6ICJoZmxleCIsCiAgbWluOiA3LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiZmxleCIsCiAgbWluOiAxMywKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImhmbGV4MSIsCiAgbWluOiA5LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiZmxleDEiLAogIG1pbjogMTEsCiAgcmVzZXRTdGFjazogdHJ1ZQp9XTsKY2xhc3MgQ0ZGUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihmaWxlLCBwcm9wZXJ0aWVzLCBzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICB0aGlzLmJ5dGVzID0gZmlsZS5nZXRCeXRlcygpOwogICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKICAgIHRoaXMuc2VhY0FuYWx5c2lzRW5hYmxlZCA9ICEhc2VhY0FuYWx5c2lzRW5hYmxlZDsKICB9CiAgcGFyc2UoKSB7CiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgY29uc3QgY2ZmID0gbmV3IENGRigpOwogICAgdGhpcy5jZmYgPSBjZmY7CiAgICBjb25zdCBoZWFkZXIgPSB0aGlzLnBhcnNlSGVhZGVyKCk7CiAgICBjb25zdCBuYW1lSW5kZXggPSB0aGlzLnBhcnNlSW5kZXgoaGVhZGVyLmVuZFBvcyk7CiAgICBjb25zdCB0b3BEaWN0SW5kZXggPSB0aGlzLnBhcnNlSW5kZXgobmFtZUluZGV4LmVuZFBvcyk7CiAgICBjb25zdCBzdHJpbmdJbmRleCA9IHRoaXMucGFyc2VJbmRleCh0b3BEaWN0SW5kZXguZW5kUG9zKTsKICAgIGNvbnN0IGdsb2JhbFN1YnJJbmRleCA9IHRoaXMucGFyc2VJbmRleChzdHJpbmdJbmRleC5lbmRQb3MpOwogICAgY29uc3QgdG9wRGljdFBhcnNlZCA9IHRoaXMucGFyc2VEaWN0KHRvcERpY3RJbmRleC5vYmouZ2V0KDApKTsKICAgIGNvbnN0IHRvcERpY3QgPSB0aGlzLmNyZWF0ZURpY3QoQ0ZGVG9wRGljdCwgdG9wRGljdFBhcnNlZCwgY2ZmLnN0cmluZ3MpOwogICAgY2ZmLmhlYWRlciA9IGhlYWRlci5vYmo7CiAgICBjZmYubmFtZXMgPSB0aGlzLnBhcnNlTmFtZUluZGV4KG5hbWVJbmRleC5vYmopOwogICAgY2ZmLnN0cmluZ3MgPSB0aGlzLnBhcnNlU3RyaW5nSW5kZXgoc3RyaW5nSW5kZXgub2JqKTsKICAgIGNmZi50b3BEaWN0ID0gdG9wRGljdDsKICAgIGNmZi5nbG9iYWxTdWJySW5kZXggPSBnbG9iYWxTdWJySW5kZXgub2JqOwogICAgdGhpcy5wYXJzZVByaXZhdGVEaWN0KGNmZi50b3BEaWN0KTsKICAgIGNmZi5pc0NJREZvbnQgPSB0b3BEaWN0Lmhhc05hbWUoIlJPUyIpOwogICAgY29uc3QgY2hhclN0cmluZ09mZnNldCA9IHRvcERpY3QuZ2V0QnlOYW1lKCJDaGFyU3RyaW5ncyIpOwogICAgY29uc3QgY2hhclN0cmluZ0luZGV4ID0gdGhpcy5wYXJzZUluZGV4KGNoYXJTdHJpbmdPZmZzZXQpLm9iajsKICAgIGNvbnN0IGZvbnRNYXRyaXggPSB0b3BEaWN0LmdldEJ5TmFtZSgiRm9udE1hdHJpeCIpOwogICAgaWYgKGZvbnRNYXRyaXgpIHsKICAgICAgcHJvcGVydGllcy5mb250TWF0cml4ID0gZm9udE1hdHJpeDsKICAgIH0KICAgIGNvbnN0IGZvbnRCQm94ID0gdG9wRGljdC5nZXRCeU5hbWUoIkZvbnRCQm94Iik7CiAgICBpZiAoZm9udEJCb3gpIHsKICAgICAgcHJvcGVydGllcy5hc2NlbnQgPSBNYXRoLm1heChmb250QkJveFszXSwgZm9udEJCb3hbMV0pOwogICAgICBwcm9wZXJ0aWVzLmRlc2NlbnQgPSBNYXRoLm1pbihmb250QkJveFsxXSwgZm9udEJCb3hbM10pOwogICAgICBwcm9wZXJ0aWVzLmFzY2VudFNjYWxlZCA9IHRydWU7CiAgICB9CiAgICBsZXQgY2hhcnNldCwgZW5jb2Rpbmc7CiAgICBpZiAoY2ZmLmlzQ0lERm9udCkgewogICAgICBjb25zdCBmZEFycmF5SW5kZXggPSB0aGlzLnBhcnNlSW5kZXgodG9wRGljdC5nZXRCeU5hbWUoIkZEQXJyYXkiKSkub2JqOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmZEFycmF5SW5kZXguY291bnQ7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgY29uc3QgZGljdFJhdyA9IGZkQXJyYXlJbmRleC5nZXQoaSk7CiAgICAgICAgY29uc3QgZm9udERpY3QgPSB0aGlzLmNyZWF0ZURpY3QoQ0ZGVG9wRGljdCwgdGhpcy5wYXJzZURpY3QoZGljdFJhdyksIGNmZi5zdHJpbmdzKTsKICAgICAgICB0aGlzLnBhcnNlUHJpdmF0ZURpY3QoZm9udERpY3QpOwogICAgICAgIGNmZi5mZEFycmF5LnB1c2goZm9udERpY3QpOwogICAgICB9CiAgICAgIGVuY29kaW5nID0gbnVsbDsKICAgICAgY2hhcnNldCA9IHRoaXMucGFyc2VDaGFyc2V0cyh0b3BEaWN0LmdldEJ5TmFtZSgiY2hhcnNldCIpLCBjaGFyU3RyaW5nSW5kZXguY291bnQsIGNmZi5zdHJpbmdzLCB0cnVlKTsKICAgICAgY2ZmLmZkU2VsZWN0ID0gdGhpcy5wYXJzZUZEU2VsZWN0KHRvcERpY3QuZ2V0QnlOYW1lKCJGRFNlbGVjdCIpLCBjaGFyU3RyaW5nSW5kZXguY291bnQpOwogICAgfSBlbHNlIHsKICAgICAgY2hhcnNldCA9IHRoaXMucGFyc2VDaGFyc2V0cyh0b3BEaWN0LmdldEJ5TmFtZSgiY2hhcnNldCIpLCBjaGFyU3RyaW5nSW5kZXguY291bnQsIGNmZi5zdHJpbmdzLCBmYWxzZSk7CiAgICAgIGVuY29kaW5nID0gdGhpcy5wYXJzZUVuY29kaW5nKHRvcERpY3QuZ2V0QnlOYW1lKCJFbmNvZGluZyIpLCBwcm9wZXJ0aWVzLCBjZmYuc3RyaW5ncywgY2hhcnNldC5jaGFyc2V0KTsKICAgIH0KICAgIGNmZi5jaGFyc2V0ID0gY2hhcnNldDsKICAgIGNmZi5lbmNvZGluZyA9IGVuY29kaW5nOwogICAgY29uc3QgY2hhclN0cmluZ3NBbmRTZWFjcyA9IHRoaXMucGFyc2VDaGFyU3RyaW5ncyh7CiAgICAgIGNoYXJTdHJpbmdzOiBjaGFyU3RyaW5nSW5kZXgsCiAgICAgIGxvY2FsU3VickluZGV4OiB0b3BEaWN0LnByaXZhdGVEaWN0LnN1YnJzSW5kZXgsCiAgICAgIGdsb2JhbFN1YnJJbmRleDogZ2xvYmFsU3VickluZGV4Lm9iaiwKICAgICAgZmRTZWxlY3Q6IGNmZi5mZFNlbGVjdCwKICAgICAgZmRBcnJheTogY2ZmLmZkQXJyYXksCiAgICAgIHByaXZhdGVEaWN0OiB0b3BEaWN0LnByaXZhdGVEaWN0CiAgICB9KTsKICAgIGNmZi5jaGFyU3RyaW5ncyA9IGNoYXJTdHJpbmdzQW5kU2VhY3MuY2hhclN0cmluZ3M7CiAgICBjZmYuc2VhY3MgPSBjaGFyU3RyaW5nc0FuZFNlYWNzLnNlYWNzOwogICAgY2ZmLndpZHRocyA9IGNoYXJTdHJpbmdzQW5kU2VhY3Mud2lkdGhzOwogICAgcmV0dXJuIGNmZjsKICB9CiAgcGFyc2VIZWFkZXIoKSB7CiAgICBsZXQgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3QgYnl0ZXNMZW5ndGggPSBieXRlcy5sZW5ndGg7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIHdoaWxlIChvZmZzZXQgPCBieXRlc0xlbmd0aCAmJiBieXRlc1tvZmZzZXRdICE9PSAxKSB7CiAgICAgICsrb2Zmc2V0OwogICAgfQogICAgaWYgKG9mZnNldCA+PSBieXRlc0xlbmd0aCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgQ0ZGIGhlYWRlciIpOwogICAgfQogICAgaWYgKG9mZnNldCAhPT0gMCkgewogICAgICBpbmZvKCJjZmYgZGF0YSBpcyBzaGlmdGVkIik7CiAgICAgIGJ5dGVzID0gYnl0ZXMuc3ViYXJyYXkob2Zmc2V0KTsKICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwogICAgfQogICAgY29uc3QgbWFqb3IgPSBieXRlc1swXTsKICAgIGNvbnN0IG1pbm9yID0gYnl0ZXNbMV07CiAgICBjb25zdCBoZHJTaXplID0gYnl0ZXNbMl07CiAgICBjb25zdCBvZmZTaXplID0gYnl0ZXNbM107CiAgICBjb25zdCBoZWFkZXIgPSBuZXcgQ0ZGSGVhZGVyKG1ham9yLCBtaW5vciwgaGRyU2l6ZSwgb2ZmU2l6ZSk7CiAgICByZXR1cm4gewogICAgICBvYmo6IGhlYWRlciwKICAgICAgZW5kUG9zOiBoZHJTaXplCiAgICB9OwogIH0KICBwYXJzZURpY3QoZGljdCkgewogICAgbGV0IHBvcyA9IDA7CiAgICBmdW5jdGlvbiBwYXJzZU9wZXJhbmQoKSB7CiAgICAgIGxldCB2YWx1ZSA9IGRpY3RbcG9zKytdOwogICAgICBpZiAodmFsdWUgPT09IDMwKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXRPcGVyYW5kKCk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDI4KSB7CiAgICAgICAgdmFsdWUgPSByZWFkSW50MTYoZGljdCwgcG9zKTsKICAgICAgICBwb3MgKz0gMjsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDI5KSB7CiAgICAgICAgdmFsdWUgPSBkaWN0W3BvcysrXTsKICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IDggfCBkaWN0W3BvcysrXTsKICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IDggfCBkaWN0W3BvcysrXTsKICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IDggfCBkaWN0W3BvcysrXTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMzIgJiYgdmFsdWUgPD0gMjQ2KSB7CiAgICAgICAgcmV0dXJuIHZhbHVlIC0gMTM5OwogICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDI0NyAmJiB2YWx1ZSA8PSAyNTApIHsKICAgICAgICByZXR1cm4gKHZhbHVlIC0gMjQ3KSAqIDI1NiArIGRpY3RbcG9zKytdICsgMTA4OwogICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDI1MSAmJiB2YWx1ZSA8PSAyNTQpIHsKICAgICAgICByZXR1cm4gLSgodmFsdWUgLSAyNTEpICogMjU2KSAtIGRpY3RbcG9zKytdIC0gMTA4OwogICAgICB9CiAgICAgIHdhcm4oJ0NGRlBhcnNlcl9wYXJzZURpY3Q6ICInICsgdmFsdWUgKyAnIiBpcyBhIHJlc2VydmVkIGNvbW1hbmQuJyk7CiAgICAgIHJldHVybiBOYU47CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZUZsb2F0T3BlcmFuZCgpIHsKICAgICAgbGV0IHN0ciA9ICIiOwogICAgICBjb25zdCBlb2YgPSAxNTsKICAgICAgY29uc3QgbG9va3VwID0gWyIwIiwgIjEiLCAiMiIsICIzIiwgIjQiLCAiNSIsICI2IiwgIjciLCAiOCIsICI5IiwgIi4iLCAiRSIsICJFLSIsIG51bGwsICItIl07CiAgICAgIGNvbnN0IGxlbmd0aCA9IGRpY3QubGVuZ3RoOwogICAgICB3aGlsZSAocG9zIDwgbGVuZ3RoKSB7CiAgICAgICAgY29uc3QgYiA9IGRpY3RbcG9zKytdOwogICAgICAgIGNvbnN0IGIxID0gYiA+PiA0OwogICAgICAgIGNvbnN0IGIyID0gYiAmIDE1OwogICAgICAgIGlmIChiMSA9PT0gZW9mKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc3RyICs9IGxvb2t1cFtiMV07CiAgICAgICAgaWYgKGIyID09PSBlb2YpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHIgKz0gbG9va3VwW2IyXTsKICAgICAgfQogICAgICByZXR1cm4gcGFyc2VGbG9hdChzdHIpOwogICAgfQogICAgbGV0IG9wZXJhbmRzID0gW107CiAgICBjb25zdCBlbnRyaWVzID0gW107CiAgICBwb3MgPSAwOwogICAgY29uc3QgZW5kID0gZGljdC5sZW5ndGg7CiAgICB3aGlsZSAocG9zIDwgZW5kKSB7CiAgICAgIGxldCBiID0gZGljdFtwb3NdOwogICAgICBpZiAoYiA8PSAyMSkgewogICAgICAgIGlmIChiID09PSAxMikgewogICAgICAgICAgYiA9IGIgPDwgOCB8IGRpY3RbKytwb3NdOwogICAgICAgIH0KICAgICAgICBlbnRyaWVzLnB1c2goW2IsIG9wZXJhbmRzXSk7CiAgICAgICAgb3BlcmFuZHMgPSBbXTsKICAgICAgICArK3BvczsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcGVyYW5kcy5wdXNoKHBhcnNlT3BlcmFuZCgpKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGVudHJpZXM7CiAgfQogIHBhcnNlSW5kZXgocG9zKSB7CiAgICBjb25zdCBjZmZJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3QgY291bnQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgIGNvbnN0IG9mZnNldHMgPSBbXTsKICAgIGxldCBlbmQgPSBwb3M7CiAgICBsZXQgaSwgaWk7CiAgICBpZiAoY291bnQgIT09IDApIHsKICAgICAgY29uc3Qgb2Zmc2V0U2l6ZSA9IGJ5dGVzW3BvcysrXTsKICAgICAgY29uc3Qgc3RhcnRQb3MgPSBwb3MgKyAoY291bnQgKyAxKSAqIG9mZnNldFNpemUgLSAxOwogICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvdW50ICsgMTsgaSA8IGlpOyArK2kpIHsKICAgICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG9mZnNldFNpemU7ICsraikgewogICAgICAgICAgb2Zmc2V0IDw8PSA4OwogICAgICAgICAgb2Zmc2V0ICs9IGJ5dGVzW3BvcysrXTsKICAgICAgICB9CiAgICAgICAgb2Zmc2V0cy5wdXNoKHN0YXJ0UG9zICsgb2Zmc2V0KTsKICAgICAgfQogICAgICBlbmQgPSBvZmZzZXRzW2NvdW50XTsKICAgIH0KICAgIGZvciAoaSA9IDAsIGlpID0gb2Zmc2V0cy5sZW5ndGggLSAxOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBvZmZzZXRTdGFydCA9IG9mZnNldHNbaV07CiAgICAgIGNvbnN0IG9mZnNldEVuZCA9IG9mZnNldHNbaSArIDFdOwogICAgICBjZmZJbmRleC5hZGQoYnl0ZXMuc3ViYXJyYXkob2Zmc2V0U3RhcnQsIG9mZnNldEVuZCkpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgb2JqOiBjZmZJbmRleCwKICAgICAgZW5kUG9zOiBlbmQKICAgIH07CiAgfQogIHBhcnNlTmFtZUluZGV4KGluZGV4KSB7CiAgICBjb25zdCBuYW1lcyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5kZXguY291bnQ7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IG5hbWUgPSBpbmRleC5nZXQoaSk7CiAgICAgIG5hbWVzLnB1c2goYnl0ZXNUb1N0cmluZyhuYW1lKSk7CiAgICB9CiAgICByZXR1cm4gbmFtZXM7CiAgfQogIHBhcnNlU3RyaW5nSW5kZXgoaW5kZXgpIHsKICAgIGNvbnN0IHN0cmluZ3MgPSBuZXcgQ0ZGU3RyaW5ncygpOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5kZXguY291bnQ7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBpbmRleC5nZXQoaSk7CiAgICAgIHN0cmluZ3MuYWRkKGJ5dGVzVG9TdHJpbmcoZGF0YSkpOwogICAgfQogICAgcmV0dXJuIHN0cmluZ3M7CiAgfQogIGNyZWF0ZURpY3QoVHlwZSwgZGljdCwgc3RyaW5ncykgewogICAgY29uc3QgY2ZmRGljdCA9IG5ldyBUeXBlKHN0cmluZ3MpOwogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZGljdCkgewogICAgICBjZmZEaWN0LnNldEJ5S2V5KGtleSwgdmFsdWUpOwogICAgfQogICAgcmV0dXJuIGNmZkRpY3Q7CiAgfQogIHBhcnNlQ2hhclN0cmluZyhzdGF0ZSwgZGF0YSwgbG9jYWxTdWJySW5kZXgsIGdsb2JhbFN1YnJJbmRleCkgewogICAgaWYgKCFkYXRhIHx8IHN0YXRlLmNhbGxEZXB0aCA+IE1BWF9TVUJSX05FU1RJTkcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbGV0IHN0YWNrU2l6ZSA9IHN0YXRlLnN0YWNrU2l6ZTsKICAgIGNvbnN0IHN0YWNrID0gc3RhdGUuc3RhY2s7CiAgICBsZXQgbGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxlbmd0aDspIHsKICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW2orK107CiAgICAgIGxldCB2YWxpZGF0aW9uQ29tbWFuZCA9IG51bGw7CiAgICAgIGlmICh2YWx1ZSA9PT0gMTIpIHsKICAgICAgICBjb25zdCBxID0gZGF0YVtqKytdOwogICAgICAgIGlmIChxID09PSAwKSB7CiAgICAgICAgICBkYXRhW2ogLSAyXSA9IDEzOTsKICAgICAgICAgIGRhdGFbaiAtIDFdID0gMjI7CiAgICAgICAgICBzdGFja1NpemUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YTEyW3FdOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMjgpIHsKICAgICAgICBzdGFja1tzdGFja1NpemVdID0gcmVhZEludDE2KGRhdGEsIGopOwogICAgICAgIGogKz0gMjsKICAgICAgICBzdGFja1NpemUrKzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMTQpIHsKICAgICAgICBpZiAoc3RhY2tTaXplID49IDQpIHsKICAgICAgICAgIHN0YWNrU2l6ZSAtPSA0OwogICAgICAgICAgaWYgKHRoaXMuc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgICAgICAgICBzdGF0ZS5zZWFjID0gc3RhY2suc2xpY2Uoc3RhY2tTaXplLCBzdGFja1NpemUgKyA0KTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMzIgJiYgdmFsdWUgPD0gMjQ2KSB7CiAgICAgICAgc3RhY2tbc3RhY2tTaXplXSA9IHZhbHVlIC0gMTM5OwogICAgICAgIHN0YWNrU2l6ZSsrOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDI0NyAmJiB2YWx1ZSA8PSAyNTQpIHsKICAgICAgICBzdGFja1tzdGFja1NpemVdID0gdmFsdWUgPCAyNTEgPyAodmFsdWUgLSAyNDcgPDwgOCkgKyBkYXRhW2pdICsgMTA4IDogLSh2YWx1ZSAtIDI1MSA8PCA4KSAtIGRhdGFbal0gLSAxMDg7CiAgICAgICAgaisrOwogICAgICAgIHN0YWNrU2l6ZSsrOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAyNTUpIHsKICAgICAgICBzdGFja1tzdGFja1NpemVdID0gKGRhdGFbal0gPDwgMjQgfCBkYXRhW2ogKyAxXSA8PCAxNiB8IGRhdGFbaiArIDJdIDw8IDggfCBkYXRhW2ogKyAzXSkgLyA2NTUzNjsKICAgICAgICBqICs9IDQ7CiAgICAgICAgc3RhY2tTaXplKys7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDE5IHx8IHZhbHVlID09PSAyMCkgewogICAgICAgIHN0YXRlLmhpbnRzICs9IHN0YWNrU2l6ZSA+PiAxOwogICAgICAgIGlmIChzdGF0ZS5oaW50cyA9PT0gMCkgewogICAgICAgICAgZGF0YS5jb3B5V2l0aGluKGogLSAxLCBqLCAtMSk7CiAgICAgICAgICBqIC09IDE7CiAgICAgICAgICBsZW5ndGggLT0gMTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBqICs9IHN0YXRlLmhpbnRzICsgNyA+PiAzOwogICAgICAgIHN0YWNrU2l6ZSAlPSAyOwogICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMTAgfHwgdmFsdWUgPT09IDI5KSB7CiAgICAgICAgY29uc3Qgc3VicnNJbmRleCA9IHZhbHVlID09PSAxMCA/IGxvY2FsU3VickluZGV4IDogZ2xvYmFsU3VickluZGV4OwogICAgICAgIGlmICghc3VicnNJbmRleCkgewogICAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbdmFsdWVdOwogICAgICAgICAgd2FybigiTWlzc2luZyBzdWJyc0luZGV4IGZvciAiICsgdmFsaWRhdGlvbkNvbW1hbmQuaWQpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBsZXQgYmlhcyA9IDMyNzY4OwogICAgICAgIGlmIChzdWJyc0luZGV4LmNvdW50IDwgMTI0MCkgewogICAgICAgICAgYmlhcyA9IDEwNzsKICAgICAgICB9IGVsc2UgaWYgKHN1YnJzSW5kZXguY291bnQgPCAzMzkwMCkgewogICAgICAgICAgYmlhcyA9IDExMzE7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN1YnJOdW1iZXIgPSBzdGFja1stLXN0YWNrU2l6ZV0gKyBiaWFzOwogICAgICAgIGlmIChzdWJyTnVtYmVyIDwgMCB8fCBzdWJyTnVtYmVyID49IHN1YnJzSW5kZXguY291bnQgfHwgaXNOYU4oc3Vick51bWJlcikpIHsKICAgICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgICAgIHdhcm4oIk91dCBvZiBib3VuZHMgc3VickluZGV4IGZvciAiICsgdmFsaWRhdGlvbkNvbW1hbmQuaWQpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5zdGFja1NpemUgPSBzdGFja1NpemU7CiAgICAgICAgc3RhdGUuY2FsbERlcHRoKys7CiAgICAgICAgY29uc3QgdmFsaWQgPSB0aGlzLnBhcnNlQ2hhclN0cmluZyhzdGF0ZSwgc3VicnNJbmRleC5nZXQoc3Vick51bWJlciksIGxvY2FsU3VickluZGV4LCBnbG9iYWxTdWJySW5kZXgpOwogICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgc3RhdGUuY2FsbERlcHRoLS07CiAgICAgICAgc3RhY2tTaXplID0gc3RhdGUuc3RhY2tTaXplOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxMSkgewogICAgICAgIHN0YXRlLnN0YWNrU2l6ZSA9IHN0YWNrU2l6ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMCAmJiBqID09PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGRhdGFbaiAtIDFdID0gMTQ7CiAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbMTRdOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSA5KSB7CiAgICAgICAgZGF0YS5jb3B5V2l0aGluKGogLSAxLCBqLCAtMSk7CiAgICAgICAgaiAtPSAxOwogICAgICAgIGxlbmd0aCAtPSAxOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgfQogICAgICBpZiAodmFsaWRhdGlvbkNvbW1hbmQpIHsKICAgICAgICBpZiAodmFsaWRhdGlvbkNvbW1hbmQuc3RlbSkgewogICAgICAgICAgc3RhdGUuaGludHMgKz0gc3RhY2tTaXplID4+IDE7CiAgICAgICAgICBpZiAodmFsdWUgPT09IDMgfHwgdmFsdWUgPT09IDIzKSB7CiAgICAgICAgICAgIHN0YXRlLmhhc1ZTdGVtcyA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmhhc1ZTdGVtcyAmJiAodmFsdWUgPT09IDEgfHwgdmFsdWUgPT09IDE4KSkgewogICAgICAgICAgICB3YXJuKCJDRkYgc3RlbSBoaW50cyBhcmUgaW4gd3Jvbmcgb3JkZXIiKTsKICAgICAgICAgICAgZGF0YVtqIC0gMV0gPSB2YWx1ZSA9PT0gMSA/IDMgOiAyMzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCJtaW4iIGluIHZhbGlkYXRpb25Db21tYW5kKSB7CiAgICAgICAgICBpZiAoIXN0YXRlLnVuZGVmU3RhY2sgJiYgc3RhY2tTaXplIDwgdmFsaWRhdGlvbkNvbW1hbmQubWluKSB7CiAgICAgICAgICAgIHdhcm4oIk5vdCBlbm91Z2ggcGFyYW1ldGVycyBmb3IgIiArIHZhbGlkYXRpb25Db21tYW5kLmlkICsgIjsgYWN0dWFsOiAiICsgc3RhY2tTaXplICsgIiwgZXhwZWN0ZWQ6ICIgKyB2YWxpZGF0aW9uQ29tbWFuZC5taW4pOwogICAgICAgICAgICBpZiAoc3RhY2tTaXplID09PSAwKSB7CiAgICAgICAgICAgICAgZGF0YVtqIC0gMV0gPSAxNDsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0ZS5maXJzdFN0YWNrQ2xlYXJpbmcgJiYgdmFsaWRhdGlvbkNvbW1hbmQuc3RhY2tDbGVhcmluZykgewogICAgICAgICAgc3RhdGUuZmlyc3RTdGFja0NsZWFyaW5nID0gZmFsc2U7CiAgICAgICAgICBzdGFja1NpemUgLT0gdmFsaWRhdGlvbkNvbW1hbmQubWluOwogICAgICAgICAgaWYgKHN0YWNrU2l6ZSA+PSAyICYmIHZhbGlkYXRpb25Db21tYW5kLnN0ZW0pIHsKICAgICAgICAgICAgc3RhY2tTaXplICU9IDI7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YWNrU2l6ZSA+IDEpIHsKICAgICAgICAgICAgd2FybigiRm91bmQgdG9vIG1hbnkgcGFyYW1ldGVycyBmb3Igc3RhY2stY2xlYXJpbmcgY29tbWFuZCIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YWNrU2l6ZSA+IDApIHsKICAgICAgICAgICAgc3RhdGUud2lkdGggPSBzdGFja1tzdGFja1NpemUgLSAxXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCJzdGFja0RlbHRhIiBpbiB2YWxpZGF0aW9uQ29tbWFuZCkgewogICAgICAgICAgaWYgKCJzdGFja0ZuIiBpbiB2YWxpZGF0aW9uQ29tbWFuZCkgewogICAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZC5zdGFja0ZuKHN0YWNrLCBzdGFja1NpemUpOwogICAgICAgICAgfQogICAgICAgICAgc3RhY2tTaXplICs9IHZhbGlkYXRpb25Db21tYW5kLnN0YWNrRGVsdGE7CiAgICAgICAgfSBlbHNlIGlmICh2YWxpZGF0aW9uQ29tbWFuZC5zdGFja0NsZWFyaW5nKSB7CiAgICAgICAgICBzdGFja1NpemUgPSAwOwogICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGlvbkNvbW1hbmQucmVzZXRTdGFjaykgewogICAgICAgICAgc3RhY2tTaXplID0gMDsKICAgICAgICAgIHN0YXRlLnVuZGVmU3RhY2sgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKHZhbGlkYXRpb25Db21tYW5kLnVuZGVmU3RhY2spIHsKICAgICAgICAgIHN0YWNrU2l6ZSA9IDA7CiAgICAgICAgICBzdGF0ZS51bmRlZlN0YWNrID0gdHJ1ZTsKICAgICAgICAgIHN0YXRlLmZpcnN0U3RhY2tDbGVhcmluZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGxlbmd0aCA8IGRhdGEubGVuZ3RoKSB7CiAgICAgIGRhdGEuZmlsbCgxNCwgbGVuZ3RoKTsKICAgIH0KICAgIHN0YXRlLnN0YWNrU2l6ZSA9IHN0YWNrU2l6ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBwYXJzZUNoYXJTdHJpbmdzKHsKICAgIGNoYXJTdHJpbmdzLAogICAgbG9jYWxTdWJySW5kZXgsCiAgICBnbG9iYWxTdWJySW5kZXgsCiAgICBmZFNlbGVjdCwKICAgIGZkQXJyYXksCiAgICBwcml2YXRlRGljdAogIH0pIHsKICAgIGNvbnN0IHNlYWNzID0gW107CiAgICBjb25zdCB3aWR0aHMgPSBbXTsKICAgIGNvbnN0IGNvdW50ID0gY2hhclN0cmluZ3MuY291bnQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgY29uc3QgY2hhcnN0cmluZyA9IGNoYXJTdHJpbmdzLmdldChpKTsKICAgICAgY29uc3Qgc3RhdGUgPSB7CiAgICAgICAgY2FsbERlcHRoOiAwLAogICAgICAgIHN0YWNrU2l6ZTogMCwKICAgICAgICBzdGFjazogW10sCiAgICAgICAgdW5kZWZTdGFjazogdHJ1ZSwKICAgICAgICBoaW50czogMCwKICAgICAgICBmaXJzdFN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgICAgICAgc2VhYzogbnVsbCwKICAgICAgICB3aWR0aDogbnVsbCwKICAgICAgICBoYXNWU3RlbXM6IGZhbHNlCiAgICAgIH07CiAgICAgIGxldCB2YWxpZCA9IHRydWU7CiAgICAgIGxldCBsb2NhbFN1YnJUb1VzZSA9IG51bGw7CiAgICAgIGxldCBwcml2YXRlRGljdFRvVXNlID0gcHJpdmF0ZURpY3Q7CiAgICAgIGlmIChmZFNlbGVjdCAmJiBmZEFycmF5Lmxlbmd0aCkgewogICAgICAgIGNvbnN0IGZkSW5kZXggPSBmZFNlbGVjdC5nZXRGREluZGV4KGkpOwogICAgICAgIGlmIChmZEluZGV4ID09PSAtMSkgewogICAgICAgICAgd2FybigiR2x5cGggaW5kZXggaXMgbm90IGluIGZkIHNlbGVjdC4iKTsKICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChmZEluZGV4ID49IGZkQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgICB3YXJuKCJJbnZhbGlkIGZkIGluZGV4IGZvciBnbHlwaCBpbmRleC4iKTsKICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgcHJpdmF0ZURpY3RUb1VzZSA9IGZkQXJyYXlbZmRJbmRleF0ucHJpdmF0ZURpY3Q7CiAgICAgICAgICBsb2NhbFN1YnJUb1VzZSA9IHByaXZhdGVEaWN0VG9Vc2Uuc3VicnNJbmRleDsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobG9jYWxTdWJySW5kZXgpIHsKICAgICAgICBsb2NhbFN1YnJUb1VzZSA9IGxvY2FsU3VickluZGV4OwogICAgICB9CiAgICAgIGlmICh2YWxpZCkgewogICAgICAgIHZhbGlkID0gdGhpcy5wYXJzZUNoYXJTdHJpbmcoc3RhdGUsIGNoYXJzdHJpbmcsIGxvY2FsU3ViclRvVXNlLCBnbG9iYWxTdWJySW5kZXgpOwogICAgICB9CiAgICAgIGlmIChzdGF0ZS53aWR0aCAhPT0gbnVsbCkgewogICAgICAgIGNvbnN0IG5vbWluYWxXaWR0aCA9IHByaXZhdGVEaWN0VG9Vc2UuZ2V0QnlOYW1lKCJub21pbmFsV2lkdGhYIik7CiAgICAgICAgd2lkdGhzW2ldID0gbm9taW5hbFdpZHRoICsgc3RhdGUud2lkdGg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZGVmYXVsdFdpZHRoID0gcHJpdmF0ZURpY3RUb1VzZS5nZXRCeU5hbWUoImRlZmF1bHRXaWR0aFgiKTsKICAgICAgICB3aWR0aHNbaV0gPSBkZWZhdWx0V2lkdGg7CiAgICAgIH0KICAgICAgaWYgKHN0YXRlLnNlYWMgIT09IG51bGwpIHsKICAgICAgICBzZWFjc1tpXSA9IHN0YXRlLnNlYWM7CiAgICAgIH0KICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgIGNoYXJTdHJpbmdzLnNldChpLCBuZXcgVWludDhBcnJheShbMTRdKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgIGNoYXJTdHJpbmdzLAogICAgICBzZWFjcywKICAgICAgd2lkdGhzCiAgICB9OwogIH0KICBlbXB0eVByaXZhdGVEaWN0aW9uYXJ5KHBhcmVudERpY3QpIHsKICAgIGNvbnN0IHByaXZhdGVEaWN0ID0gdGhpcy5jcmVhdGVEaWN0KENGRlByaXZhdGVEaWN0LCBbXSwgcGFyZW50RGljdC5zdHJpbmdzKTsKICAgIHBhcmVudERpY3Quc2V0QnlLZXkoMTgsIFswLCAwXSk7CiAgICBwYXJlbnREaWN0LnByaXZhdGVEaWN0ID0gcHJpdmF0ZURpY3Q7CiAgfQogIHBhcnNlUHJpdmF0ZURpY3QocGFyZW50RGljdCkgewogICAgaWYgKCFwYXJlbnREaWN0Lmhhc05hbWUoIlByaXZhdGUiKSkgewogICAgICB0aGlzLmVtcHR5UHJpdmF0ZURpY3Rpb25hcnkocGFyZW50RGljdCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHByaXZhdGVPZmZzZXQgPSBwYXJlbnREaWN0LmdldEJ5TmFtZSgiUHJpdmF0ZSIpOwogICAgaWYgKCFBcnJheS5pc0FycmF5KHByaXZhdGVPZmZzZXQpIHx8IHByaXZhdGVPZmZzZXQubGVuZ3RoICE9PSAyKSB7CiAgICAgIHBhcmVudERpY3QucmVtb3ZlQnlOYW1lKCJQcml2YXRlIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHNpemUgPSBwcml2YXRlT2Zmc2V0WzBdOwogICAgY29uc3Qgb2Zmc2V0ID0gcHJpdmF0ZU9mZnNldFsxXTsKICAgIGlmIChzaXplID09PSAwIHx8IG9mZnNldCA+PSB0aGlzLmJ5dGVzLmxlbmd0aCkgewogICAgICB0aGlzLmVtcHR5UHJpdmF0ZURpY3Rpb25hcnkocGFyZW50RGljdCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHByaXZhdGVEaWN0RW5kID0gb2Zmc2V0ICsgc2l6ZTsKICAgIGNvbnN0IGRpY3REYXRhID0gdGhpcy5ieXRlcy5zdWJhcnJheShvZmZzZXQsIHByaXZhdGVEaWN0RW5kKTsKICAgIGNvbnN0IGRpY3QgPSB0aGlzLnBhcnNlRGljdChkaWN0RGF0YSk7CiAgICBjb25zdCBwcml2YXRlRGljdCA9IHRoaXMuY3JlYXRlRGljdChDRkZQcml2YXRlRGljdCwgZGljdCwgcGFyZW50RGljdC5zdHJpbmdzKTsKICAgIHBhcmVudERpY3QucHJpdmF0ZURpY3QgPSBwcml2YXRlRGljdDsKICAgIGlmIChwcml2YXRlRGljdC5nZXRCeU5hbWUoIkV4cGFuc2lvbkZhY3RvciIpID09PSAwKSB7CiAgICAgIHByaXZhdGVEaWN0LnNldEJ5TmFtZSgiRXhwYW5zaW9uRmFjdG9yIiwgMC4wNik7CiAgICB9CiAgICBpZiAoIXByaXZhdGVEaWN0LmdldEJ5TmFtZSgiU3VicnMiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzdWJyc09mZnNldCA9IHByaXZhdGVEaWN0LmdldEJ5TmFtZSgiU3VicnMiKTsKICAgIGNvbnN0IHJlbGF0aXZlT2Zmc2V0ID0gb2Zmc2V0ICsgc3VicnNPZmZzZXQ7CiAgICBpZiAoc3VicnNPZmZzZXQgPT09IDAgfHwgcmVsYXRpdmVPZmZzZXQgPj0gdGhpcy5ieXRlcy5sZW5ndGgpIHsKICAgICAgdGhpcy5lbXB0eVByaXZhdGVEaWN0aW9uYXJ5KHBhcmVudERpY3QpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzdWJyc0luZGV4ID0gdGhpcy5wYXJzZUluZGV4KHJlbGF0aXZlT2Zmc2V0KTsKICAgIHByaXZhdGVEaWN0LnN1YnJzSW5kZXggPSBzdWJyc0luZGV4Lm9iajsKICB9CiAgcGFyc2VDaGFyc2V0cyhwb3MsIGxlbmd0aCwgc3RyaW5ncywgY2lkKSB7CiAgICBpZiAocG9zID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgQ0ZGQ2hhcnNldCh0cnVlLCBDRkZDaGFyc2V0UHJlZGVmaW5lZFR5cGVzLklTT19BRE9CRSwgSVNPQWRvYmVDaGFyc2V0KTsKICAgIH0gZWxzZSBpZiAocG9zID09PSAxKSB7CiAgICAgIHJldHVybiBuZXcgQ0ZGQ2hhcnNldCh0cnVlLCBDRkZDaGFyc2V0UHJlZGVmaW5lZFR5cGVzLkVYUEVSVCwgRXhwZXJ0Q2hhcnNldCk7CiAgICB9IGVsc2UgaWYgKHBvcyA9PT0gMikgewogICAgICByZXR1cm4gbmV3IENGRkNoYXJzZXQodHJ1ZSwgQ0ZGQ2hhcnNldFByZWRlZmluZWRUeXBlcy5FWFBFUlRfU1VCU0VULCBFeHBlcnRTdWJzZXRDaGFyc2V0KTsKICAgIH0KICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGNvbnN0IHN0YXJ0ID0gcG9zOwogICAgY29uc3QgZm9ybWF0ID0gYnl0ZXNbcG9zKytdOwogICAgY29uc3QgY2hhcnNldCA9IFtjaWQgPyAwIDogIi5ub3RkZWYiXTsKICAgIGxldCBpZCwgY291bnQsIGk7CiAgICBsZW5ndGggLT0gMTsKICAgIHN3aXRjaCAoZm9ybWF0KSB7CiAgICAgIGNhc2UgMDoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlkID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgICBjaGFyc2V0LnB1c2goY2lkID8gaWQgOiBzdHJpbmdzLmdldChpZCkpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAxOgogICAgICAgIHdoaWxlIChjaGFyc2V0Lmxlbmd0aCA8PSBsZW5ndGgpIHsKICAgICAgICAgIGlkID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgICBjb3VudCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPD0gY291bnQ7IGkrKykgewogICAgICAgICAgICBjaGFyc2V0LnB1c2goY2lkID8gaWQrKyA6IHN0cmluZ3MuZ2V0KGlkKyspKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICB3aGlsZSAoY2hhcnNldC5sZW5ndGggPD0gbGVuZ3RoKSB7CiAgICAgICAgICBpZCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgY291bnQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPD0gY291bnQ7IGkrKykgewogICAgICAgICAgICBjaGFyc2V0LnB1c2goY2lkID8gaWQrKyA6IHN0cmluZ3MuZ2V0KGlkKyspKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbmtub3duIGNoYXJzZXQgZm9ybWF0Iik7CiAgICB9CiAgICBjb25zdCBlbmQgPSBwb3M7CiAgICBjb25zdCByYXcgPSBieXRlcy5zdWJhcnJheShzdGFydCwgZW5kKTsKICAgIHJldHVybiBuZXcgQ0ZGQ2hhcnNldChmYWxzZSwgZm9ybWF0LCBjaGFyc2V0LCByYXcpOwogIH0KICBwYXJzZUVuY29kaW5nKHBvcywgcHJvcGVydGllcywgc3RyaW5ncywgY2hhcnNldCkgewogICAgY29uc3QgZW5jb2RpbmcgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgbGV0IHByZWRlZmluZWQgPSBmYWxzZTsKICAgIGxldCBmb3JtYXQsIGksIGlpOwogICAgbGV0IHJhdyA9IG51bGw7CiAgICBmdW5jdGlvbiByZWFkU3VwcGxlbWVudCgpIHsKICAgICAgY29uc3Qgc3VwcGxlbWVudHNDb3VudCA9IGJ5dGVzW3BvcysrXTsKICAgICAgZm9yIChpID0gMDsgaSA8IHN1cHBsZW1lbnRzQ291bnQ7IGkrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSBieXRlc1twb3MrK107CiAgICAgICAgY29uc3Qgc2lkID0gKGJ5dGVzW3BvcysrXSA8PCA4KSArIChieXRlc1twb3MrK10gJiAweGZmKTsKICAgICAgICBlbmNvZGluZ1tjb2RlXSA9IGNoYXJzZXQuaW5kZXhPZihzdHJpbmdzLmdldChzaWQpKTsKICAgICAgfQogICAgfQogICAgaWYgKHBvcyA9PT0gMCB8fCBwb3MgPT09IDEpIHsKICAgICAgcHJlZGVmaW5lZCA9IHRydWU7CiAgICAgIGZvcm1hdCA9IHBvczsKICAgICAgY29uc3QgYmFzZUVuY29kaW5nID0gcG9zID8gRXhwZXJ0RW5jb2RpbmcgOiBTdGFuZGFyZEVuY29kaW5nOwogICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoYXJzZXQubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IGluZGV4ID0gYmFzZUVuY29kaW5nLmluZGV4T2YoY2hhcnNldFtpXSk7CiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgZW5jb2RpbmdbaW5kZXhdID0gaTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGRhdGFTdGFydCA9IHBvczsKICAgICAgZm9ybWF0ID0gYnl0ZXNbcG9zKytdOwogICAgICBzd2l0Y2ggKGZvcm1hdCAmIDB4N2YpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBjb25zdCBnbHlwaHNDb3VudCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gZ2x5cGhzQ291bnQ7IGkrKykgewogICAgICAgICAgICBlbmNvZGluZ1tieXRlc1twb3MrK11dID0gaTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIGNvbnN0IHJhbmdlc0NvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgbGV0IGdpZCA9IDE7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmFuZ2VzQ291bnQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBzdGFydCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgY29uc3QgbGVmdCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IHN0YXJ0OyBqIDw9IHN0YXJ0ICsgbGVmdDsgaisrKSB7CiAgICAgICAgICAgICAgZW5jb2Rpbmdbal0gPSBnaWQrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5rbm93biBlbmNvZGluZyBmb3JtYXQ6ICR7Zm9ybWF0fSBpbiBDRkZgKTsKICAgICAgfQogICAgICBjb25zdCBkYXRhRW5kID0gcG9zOwogICAgICBpZiAoZm9ybWF0ICYgMHg4MCkgewogICAgICAgIGJ5dGVzW2RhdGFTdGFydF0gJj0gMHg3ZjsKICAgICAgICByZWFkU3VwcGxlbWVudCgpOwogICAgICB9CiAgICAgIHJhdyA9IGJ5dGVzLnN1YmFycmF5KGRhdGFTdGFydCwgZGF0YUVuZCk7CiAgICB9CiAgICBmb3JtYXQgJj0gMHg3ZjsKICAgIHJldHVybiBuZXcgQ0ZGRW5jb2RpbmcocHJlZGVmaW5lZCwgZm9ybWF0LCBlbmNvZGluZywgcmF3KTsKICB9CiAgcGFyc2VGRFNlbGVjdChwb3MsIGxlbmd0aCkgewogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3QgZm9ybWF0ID0gYnl0ZXNbcG9zKytdOwogICAgY29uc3QgZmRTZWxlY3QgPSBbXTsKICAgIGxldCBpOwogICAgc3dpdGNoIChmb3JtYXQpIHsKICAgICAgY2FzZSAwOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgY29uc3QgaWQgPSBieXRlc1twb3MrK107CiAgICAgICAgICBmZFNlbGVjdC5wdXNoKGlkKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMzoKICAgICAgICBjb25zdCByYW5nZXNDb3VudCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCByYW5nZXNDb3VudDsgKytpKSB7CiAgICAgICAgICBsZXQgZmlyc3QgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGlmIChpID09PSAwICYmIGZpcnN0ICE9PSAwKSB7CiAgICAgICAgICAgIHdhcm4oInBhcnNlRkRTZWxlY3Q6IFRoZSBmaXJzdCByYW5nZSBtdXN0IGhhdmUgYSBmaXJzdCBHSUQgb2YgMCIgKyAiIC0tIHRyeWluZyB0byByZWNvdmVyLiIpOwogICAgICAgICAgICBmaXJzdCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBmZEluZGV4ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgY29uc3QgbmV4dCA9IGJ5dGVzW3Bvc10gPDwgOCB8IGJ5dGVzW3BvcyArIDFdOwogICAgICAgICAgZm9yIChsZXQgaiA9IGZpcnN0OyBqIDwgbmV4dDsgKytqKSB7CiAgICAgICAgICAgIGZkU2VsZWN0LnB1c2goZmRJbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHBvcyArPSAyOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgcGFyc2VGRFNlbGVjdDogVW5rbm93biBmb3JtYXQgIiR7Zm9ybWF0fSIuYCk7CiAgICB9CiAgICBpZiAoZmRTZWxlY3QubGVuZ3RoICE9PSBsZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJwYXJzZUZEU2VsZWN0OiBJbnZhbGlkIGZvbnQgZGF0YS4iKTsKICAgIH0KICAgIHJldHVybiBuZXcgQ0ZGRkRTZWxlY3QoZm9ybWF0LCBmZFNlbGVjdCk7CiAgfQp9CmNsYXNzIENGRiB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmhlYWRlciA9IG51bGw7CiAgICB0aGlzLm5hbWVzID0gW107CiAgICB0aGlzLnRvcERpY3QgPSBudWxsOwogICAgdGhpcy5zdHJpbmdzID0gbmV3IENGRlN0cmluZ3MoKTsKICAgIHRoaXMuZ2xvYmFsU3VickluZGV4ID0gbnVsbDsKICAgIHRoaXMuZW5jb2RpbmcgPSBudWxsOwogICAgdGhpcy5jaGFyc2V0ID0gbnVsbDsKICAgIHRoaXMuY2hhclN0cmluZ3MgPSBudWxsOwogICAgdGhpcy5mZEFycmF5ID0gW107CiAgICB0aGlzLmZkU2VsZWN0ID0gbnVsbDsKICAgIHRoaXMuaXNDSURGb250ID0gZmFsc2U7CiAgfQogIGR1cGxpY2F0ZUZpcnN0R2x5cGgoKSB7CiAgICBpZiAodGhpcy5jaGFyU3RyaW5ncy5jb3VudCA+PSA2NTUzNSkgewogICAgICB3YXJuKCJOb3QgZW5vdWdoIHNwYWNlIGluIGNoYXJzdHJpbmdzIHRvIGR1cGxpY2F0ZSBmaXJzdCBnbHlwaC4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZ2x5cGhaZXJvID0gdGhpcy5jaGFyU3RyaW5ncy5nZXQoMCk7CiAgICB0aGlzLmNoYXJTdHJpbmdzLmFkZChnbHlwaFplcm8pOwogICAgaWYgKHRoaXMuaXNDSURGb250KSB7CiAgICAgIHRoaXMuZmRTZWxlY3QuZmRTZWxlY3QucHVzaCh0aGlzLmZkU2VsZWN0LmZkU2VsZWN0WzBdKTsKICAgIH0KICB9CiAgaGFzR2x5cGhJZChpZCkgewogICAgaWYgKGlkIDwgMCB8fCBpZCA+PSB0aGlzLmNoYXJTdHJpbmdzLmNvdW50KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IGdseXBoID0gdGhpcy5jaGFyU3RyaW5ncy5nZXQoaWQpOwogICAgcmV0dXJuIGdseXBoLmxlbmd0aCA+IDA7CiAgfQp9CmNsYXNzIENGRkhlYWRlciB7CiAgY29uc3RydWN0b3IobWFqb3IsIG1pbm9yLCBoZHJTaXplLCBvZmZTaXplKSB7CiAgICB0aGlzLm1ham9yID0gbWFqb3I7CiAgICB0aGlzLm1pbm9yID0gbWlub3I7CiAgICB0aGlzLmhkclNpemUgPSBoZHJTaXplOwogICAgdGhpcy5vZmZTaXplID0gb2ZmU2l6ZTsKICB9Cn0KY2xhc3MgQ0ZGU3RyaW5ncyB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLnN0cmluZ3MgPSBbXTsKICB9CiAgZ2V0KGluZGV4KSB7CiAgICBpZiAoaW5kZXggPj0gMCAmJiBpbmRleCA8PSBOVU1fU1RBTkRBUkRfQ0ZGX1NUUklOR1MgLSAxKSB7CiAgICAgIHJldHVybiBDRkZTdGFuZGFyZFN0cmluZ3NbaW5kZXhdOwogICAgfQogICAgaWYgKGluZGV4IC0gTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTIDw9IHRoaXMuc3RyaW5ncy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RyaW5nc1tpbmRleCAtIE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HU107CiAgICB9CiAgICByZXR1cm4gQ0ZGU3RhbmRhcmRTdHJpbmdzWzBdOwogIH0KICBnZXRTSUQoc3RyKSB7CiAgICBsZXQgaW5kZXggPSBDRkZTdGFuZGFyZFN0cmluZ3MuaW5kZXhPZihzdHIpOwogICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICBpbmRleCA9IHRoaXMuc3RyaW5ncy5pbmRleE9mKHN0cik7CiAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgIHJldHVybiBpbmRleCArIE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HUzsKICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgYWRkKHZhbHVlKSB7CiAgICB0aGlzLnN0cmluZ3MucHVzaCh2YWx1ZSk7CiAgfQogIGdldCBjb3VudCgpIHsKICAgIHJldHVybiB0aGlzLnN0cmluZ3MubGVuZ3RoOwogIH0KfQpjbGFzcyBDRkZJbmRleCB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLm9iamVjdHMgPSBbXTsKICAgIHRoaXMubGVuZ3RoID0gMDsKICB9CiAgYWRkKGRhdGEpIHsKICAgIHRoaXMubGVuZ3RoICs9IGRhdGEubGVuZ3RoOwogICAgdGhpcy5vYmplY3RzLnB1c2goZGF0YSk7CiAgfQogIHNldChpbmRleCwgZGF0YSkgewogICAgdGhpcy5sZW5ndGggKz0gZGF0YS5sZW5ndGggLSB0aGlzLm9iamVjdHNbaW5kZXhdLmxlbmd0aDsKICAgIHRoaXMub2JqZWN0c1tpbmRleF0gPSBkYXRhOwogIH0KICBnZXQoaW5kZXgpIHsKICAgIHJldHVybiB0aGlzLm9iamVjdHNbaW5kZXhdOwogIH0KICBnZXQgY291bnQoKSB7CiAgICByZXR1cm4gdGhpcy5vYmplY3RzLmxlbmd0aDsKICB9Cn0KY2xhc3MgQ0ZGRGljdCB7CiAgY29uc3RydWN0b3IodGFibGVzLCBzdHJpbmdzKSB7CiAgICB0aGlzLmtleVRvTmFtZU1hcCA9IHRhYmxlcy5rZXlUb05hbWVNYXA7CiAgICB0aGlzLm5hbWVUb0tleU1hcCA9IHRhYmxlcy5uYW1lVG9LZXlNYXA7CiAgICB0aGlzLmRlZmF1bHRzID0gdGFibGVzLmRlZmF1bHRzOwogICAgdGhpcy50eXBlcyA9IHRhYmxlcy50eXBlczsKICAgIHRoaXMub3Bjb2RlcyA9IHRhYmxlcy5vcGNvZGVzOwogICAgdGhpcy5vcmRlciA9IHRhYmxlcy5vcmRlcjsKICAgIHRoaXMuc3RyaW5ncyA9IHN0cmluZ3M7CiAgICB0aGlzLnZhbHVlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQogIHNldEJ5S2V5KGtleSwgdmFsdWUpIHsKICAgIGlmICghKGtleSBpbiB0aGlzLmtleVRvTmFtZU1hcCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZvciAoY29uc3QgdmFsIG9mIHZhbHVlKSB7CiAgICAgIGlmIChpc05hTih2YWwpKSB7CiAgICAgICAgd2FybihgSW52YWxpZCBDRkZEaWN0IHZhbHVlOiAiJHt2YWx1ZX0iIGZvciBrZXkgIiR7a2V5fSIuYCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHR5cGUgPSB0aGlzLnR5cGVzW2tleV07CiAgICBpZiAodHlwZSA9PT0gIm51bSIgfHwgdHlwZSA9PT0gInNpZCIgfHwgdHlwZSA9PT0gIm9mZnNldCIpIHsKICAgICAgdmFsdWUgPSB2YWx1ZVswXTsKICAgIH0KICAgIHRoaXMudmFsdWVzW2tleV0gPSB2YWx1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBzZXRCeU5hbWUobmFtZSwgdmFsdWUpIHsKICAgIGlmICghKG5hbWUgaW4gdGhpcy5uYW1lVG9LZXlNYXApKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBkaWN0aW9uYXJ5IG5hbWUgIiR7bmFtZX0iYCk7CiAgICB9CiAgICB0aGlzLnZhbHVlc1t0aGlzLm5hbWVUb0tleU1hcFtuYW1lXV0gPSB2YWx1ZTsKICB9CiAgaGFzTmFtZShuYW1lKSB7CiAgICByZXR1cm4gdGhpcy5uYW1lVG9LZXlNYXBbbmFtZV0gaW4gdGhpcy52YWx1ZXM7CiAgfQogIGdldEJ5TmFtZShuYW1lKSB7CiAgICBpZiAoIShuYW1lIGluIHRoaXMubmFtZVRvS2V5TWFwKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZGljdGlvbmFyeSBuYW1lICR7bmFtZX0iYCk7CiAgICB9CiAgICBjb25zdCBrZXkgPSB0aGlzLm5hbWVUb0tleU1hcFtuYW1lXTsKICAgIGlmICghKGtleSBpbiB0aGlzLnZhbHVlcykpIHsKICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdHNba2V5XTsKICAgIH0KICAgIHJldHVybiB0aGlzLnZhbHVlc1trZXldOwogIH0KICByZW1vdmVCeU5hbWUobmFtZSkgewogICAgZGVsZXRlIHRoaXMudmFsdWVzW3RoaXMubmFtZVRvS2V5TWFwW25hbWVdXTsKICB9CiAgc3RhdGljIGNyZWF0ZVRhYmxlcyhsYXlvdXQpIHsKICAgIGNvbnN0IHRhYmxlcyA9IHsKICAgICAga2V5VG9OYW1lTWFwOiB7fSwKICAgICAgbmFtZVRvS2V5TWFwOiB7fSwKICAgICAgZGVmYXVsdHM6IHt9LAogICAgICB0eXBlczoge30sCiAgICAgIG9wY29kZXM6IHt9LAogICAgICBvcmRlcjogW10KICAgIH07CiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGxheW91dCkgewogICAgICBjb25zdCBrZXkgPSBBcnJheS5pc0FycmF5KGVudHJ5WzBdKSA/IChlbnRyeVswXVswXSA8PCA4KSArIGVudHJ5WzBdWzFdIDogZW50cnlbMF07CiAgICAgIHRhYmxlcy5rZXlUb05hbWVNYXBba2V5XSA9IGVudHJ5WzFdOwogICAgICB0YWJsZXMubmFtZVRvS2V5TWFwW2VudHJ5WzFdXSA9IGtleTsKICAgICAgdGFibGVzLnR5cGVzW2tleV0gPSBlbnRyeVsyXTsKICAgICAgdGFibGVzLmRlZmF1bHRzW2tleV0gPSBlbnRyeVszXTsKICAgICAgdGFibGVzLm9wY29kZXNba2V5XSA9IEFycmF5LmlzQXJyYXkoZW50cnlbMF0pID8gZW50cnlbMF0gOiBbZW50cnlbMF1dOwogICAgICB0YWJsZXMub3JkZXIucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIHRhYmxlczsKICB9Cn0KY29uc3QgQ0ZGVG9wRGljdExheW91dCA9IFtbWzEyLCAzMF0sICJST1MiLCBbInNpZCIsICJzaWQiLCAibnVtIl0sIG51bGxdLCBbWzEyLCAyMF0sICJTeW50aGV0aWNCYXNlIiwgIm51bSIsIG51bGxdLCBbMCwgInZlcnNpb24iLCAic2lkIiwgbnVsbF0sIFsxLCAiTm90aWNlIiwgInNpZCIsIG51bGxdLCBbWzEyLCAwXSwgIkNvcHlyaWdodCIsICJzaWQiLCBudWxsXSwgWzIsICJGdWxsTmFtZSIsICJzaWQiLCBudWxsXSwgWzMsICJGYW1pbHlOYW1lIiwgInNpZCIsIG51bGxdLCBbNCwgIldlaWdodCIsICJzaWQiLCBudWxsXSwgW1sxMiwgMV0sICJpc0ZpeGVkUGl0Y2giLCAibnVtIiwgMF0sIFtbMTIsIDJdLCAiSXRhbGljQW5nbGUiLCAibnVtIiwgMF0sIFtbMTIsIDNdLCAiVW5kZXJsaW5lUG9zaXRpb24iLCAibnVtIiwgLTEwMF0sIFtbMTIsIDRdLCAiVW5kZXJsaW5lVGhpY2tuZXNzIiwgIm51bSIsIDUwXSwgW1sxMiwgNV0sICJQYWludFR5cGUiLCAibnVtIiwgMF0sIFtbMTIsIDZdLCAiQ2hhcnN0cmluZ1R5cGUiLCAibnVtIiwgMl0sIFtbMTIsIDddLCAiRm9udE1hdHJpeCIsIFsibnVtIiwgIm51bSIsICJudW0iLCAibnVtIiwgIm51bSIsICJudW0iXSwgWzAuMDAxLCAwLCAwLCAwLjAwMSwgMCwgMF1dLCBbMTMsICJVbmlxdWVJRCIsICJudW0iLCBudWxsXSwgWzUsICJGb250QkJveCIsIFsibnVtIiwgIm51bSIsICJudW0iLCAibnVtIl0sIFswLCAwLCAwLCAwXV0sIFtbMTIsIDhdLCAiU3Ryb2tlV2lkdGgiLCAibnVtIiwgMF0sIFsxNCwgIlhVSUQiLCAiYXJyYXkiLCBudWxsXSwgWzE1LCAiY2hhcnNldCIsICJvZmZzZXQiLCAwXSwgWzE2LCAiRW5jb2RpbmciLCAib2Zmc2V0IiwgMF0sIFsxNywgIkNoYXJTdHJpbmdzIiwgIm9mZnNldCIsIDBdLCBbMTgsICJQcml2YXRlIiwgWyJvZmZzZXQiLCAib2Zmc2V0Il0sIG51bGxdLCBbWzEyLCAyMV0sICJQb3N0U2NyaXB0IiwgInNpZCIsIG51bGxdLCBbWzEyLCAyMl0sICJCYXNlRm9udE5hbWUiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDIzXSwgIkJhc2VGb250QmxlbmQiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgMzFdLCAiQ0lERm9udFZlcnNpb24iLCAibnVtIiwgMF0sIFtbMTIsIDMyXSwgIkNJREZvbnRSZXZpc2lvbiIsICJudW0iLCAwXSwgW1sxMiwgMzNdLCAiQ0lERm9udFR5cGUiLCAibnVtIiwgMF0sIFtbMTIsIDM0XSwgIkNJRENvdW50IiwgIm51bSIsIDg3MjBdLCBbWzEyLCAzNV0sICJVSURCYXNlIiwgIm51bSIsIG51bGxdLCBbWzEyLCAzN10sICJGRFNlbGVjdCIsICJvZmZzZXQiLCBudWxsXSwgW1sxMiwgMzZdLCAiRkRBcnJheSIsICJvZmZzZXQiLCBudWxsXSwgW1sxMiwgMzhdLCAiRm9udE5hbWUiLCAic2lkIiwgbnVsbF1dOwpjbGFzcyBDRkZUb3BEaWN0IGV4dGVuZHMgQ0ZGRGljdCB7CiAgc3RhdGljIGdldCB0YWJsZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ0YWJsZXMiLCB0aGlzLmNyZWF0ZVRhYmxlcyhDRkZUb3BEaWN0TGF5b3V0KSk7CiAgfQogIGNvbnN0cnVjdG9yKHN0cmluZ3MpIHsKICAgIHN1cGVyKENGRlRvcERpY3QudGFibGVzLCBzdHJpbmdzKTsKICAgIHRoaXMucHJpdmF0ZURpY3QgPSBudWxsOwogIH0KfQpjb25zdCBDRkZQcml2YXRlRGljdExheW91dCA9IFtbNiwgIkJsdWVWYWx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzcsICJPdGhlckJsdWVzIiwgImRlbHRhIiwgbnVsbF0sIFs4LCAiRmFtaWx5Qmx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzksICJGYW1pbHlPdGhlckJsdWVzIiwgImRlbHRhIiwgbnVsbF0sIFtbMTIsIDldLCAiQmx1ZVNjYWxlIiwgIm51bSIsIDAuMDM5NjI1XSwgW1sxMiwgMTBdLCAiQmx1ZVNoaWZ0IiwgIm51bSIsIDddLCBbWzEyLCAxMV0sICJCbHVlRnV6eiIsICJudW0iLCAxXSwgWzEwLCAiU3RkSFciLCAibnVtIiwgbnVsbF0sIFsxMSwgIlN0ZFZXIiwgIm51bSIsIG51bGxdLCBbWzEyLCAxMl0sICJTdGVtU25hcEgiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgMTNdLCAiU3RlbVNuYXBWIiwgImRlbHRhIiwgbnVsbF0sIFtbMTIsIDE0XSwgIkZvcmNlQm9sZCIsICJudW0iLCAwXSwgW1sxMiwgMTddLCAiTGFuZ3VhZ2VHcm91cCIsICJudW0iLCAwXSwgW1sxMiwgMThdLCAiRXhwYW5zaW9uRmFjdG9yIiwgIm51bSIsIDAuMDZdLCBbWzEyLCAxOV0sICJpbml0aWFsUmFuZG9tU2VlZCIsICJudW0iLCAwXSwgWzIwLCAiZGVmYXVsdFdpZHRoWCIsICJudW0iLCAwXSwgWzIxLCAibm9taW5hbFdpZHRoWCIsICJudW0iLCAwXSwgWzE5LCAiU3VicnMiLCAib2Zmc2V0IiwgbnVsbF1dOwpjbGFzcyBDRkZQcml2YXRlRGljdCBleHRlbmRzIENGRkRpY3QgewogIHN0YXRpYyBnZXQgdGFibGVzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidGFibGVzIiwgdGhpcy5jcmVhdGVUYWJsZXMoQ0ZGUHJpdmF0ZURpY3RMYXlvdXQpKTsKICB9CiAgY29uc3RydWN0b3Ioc3RyaW5ncykgewogICAgc3VwZXIoQ0ZGUHJpdmF0ZURpY3QudGFibGVzLCBzdHJpbmdzKTsKICAgIHRoaXMuc3VicnNJbmRleCA9IG51bGw7CiAgfQp9CmNvbnN0IENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMgPSB7CiAgSVNPX0FET0JFOiAwLAogIEVYUEVSVDogMSwKICBFWFBFUlRfU1VCU0VUOiAyCn07CmNsYXNzIENGRkNoYXJzZXQgewogIGNvbnN0cnVjdG9yKHByZWRlZmluZWQsIGZvcm1hdCwgY2hhcnNldCwgcmF3KSB7CiAgICB0aGlzLnByZWRlZmluZWQgPSBwcmVkZWZpbmVkOwogICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICB0aGlzLmNoYXJzZXQgPSBjaGFyc2V0OwogICAgdGhpcy5yYXcgPSByYXc7CiAgfQp9CmNsYXNzIENGRkVuY29kaW5nIHsKICBjb25zdHJ1Y3RvcihwcmVkZWZpbmVkLCBmb3JtYXQsIGVuY29kaW5nLCByYXcpIHsKICAgIHRoaXMucHJlZGVmaW5lZCA9IHByZWRlZmluZWQ7CiAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKICAgIHRoaXMuZW5jb2RpbmcgPSBlbmNvZGluZzsKICAgIHRoaXMucmF3ID0gcmF3OwogIH0KfQpjbGFzcyBDRkZGRFNlbGVjdCB7CiAgY29uc3RydWN0b3IoZm9ybWF0LCBmZFNlbGVjdCkgewogICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICB0aGlzLmZkU2VsZWN0ID0gZmRTZWxlY3Q7CiAgfQogIGdldEZESW5kZXgoZ2x5cGhJbmRleCkgewogICAgaWYgKGdseXBoSW5kZXggPCAwIHx8IGdseXBoSW5kZXggPj0gdGhpcy5mZFNlbGVjdC5sZW5ndGgpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgcmV0dXJuIHRoaXMuZmRTZWxlY3RbZ2x5cGhJbmRleF07CiAgfQp9CmNsYXNzIENGRk9mZnNldFRyYWNrZXIgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5vZmZzZXRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB9CiAgaXNUcmFja2luZyhrZXkpIHsKICAgIHJldHVybiBrZXkgaW4gdGhpcy5vZmZzZXRzOwogIH0KICB0cmFjayhrZXksIGxvY2F0aW9uKSB7CiAgICBpZiAoa2V5IGluIHRoaXMub2Zmc2V0cykgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEFscmVhZHkgdHJhY2tpbmcgbG9jYXRpb24gb2YgJHtrZXl9YCk7CiAgICB9CiAgICB0aGlzLm9mZnNldHNba2V5XSA9IGxvY2F0aW9uOwogIH0KICBvZmZzZXQodmFsdWUpIHsKICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMub2Zmc2V0cykgewogICAgICB0aGlzLm9mZnNldHNba2V5XSArPSB2YWx1ZTsKICAgIH0KICB9CiAgc2V0RW50cnlMb2NhdGlvbihrZXksIHZhbHVlcywgb3V0cHV0KSB7CiAgICBpZiAoIShrZXkgaW4gdGhpcy5vZmZzZXRzKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYE5vdCB0cmFja2luZyBsb2NhdGlvbiBvZiAke2tleX1gKTsKICAgIH0KICAgIGNvbnN0IGRhdGEgPSBvdXRwdXQuZGF0YTsKICAgIGNvbnN0IGRhdGFPZmZzZXQgPSB0aGlzLm9mZnNldHNba2V5XTsKICAgIGNvbnN0IHNpemUgPSA1OwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdmFsdWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3Qgb2Zmc2V0MCA9IGkgKiBzaXplICsgZGF0YU9mZnNldDsKICAgICAgY29uc3Qgb2Zmc2V0MSA9IG9mZnNldDAgKyAxOwogICAgICBjb25zdCBvZmZzZXQyID0gb2Zmc2V0MCArIDI7CiAgICAgIGNvbnN0IG9mZnNldDMgPSBvZmZzZXQwICsgMzsKICAgICAgY29uc3Qgb2Zmc2V0NCA9IG9mZnNldDAgKyA0OwogICAgICBpZiAoZGF0YVtvZmZzZXQwXSAhPT0gMHgxZCB8fCBkYXRhW29mZnNldDFdICE9PSAwIHx8IGRhdGFbb2Zmc2V0Ml0gIT09IDAgfHwgZGF0YVtvZmZzZXQzXSAhPT0gMCB8fCBkYXRhW29mZnNldDRdICE9PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJ3cml0aW5nIHRvIGFuIG9mZnNldCB0aGF0IGlzIG5vdCBlbXB0eSIpOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2ldOwogICAgICBkYXRhW29mZnNldDBdID0gMHgxZDsKICAgICAgZGF0YVtvZmZzZXQxXSA9IHZhbHVlID4+IDI0ICYgMHhmZjsKICAgICAgZGF0YVtvZmZzZXQyXSA9IHZhbHVlID4+IDE2ICYgMHhmZjsKICAgICAgZGF0YVtvZmZzZXQzXSA9IHZhbHVlID4+IDggJiAweGZmOwogICAgICBkYXRhW29mZnNldDRdID0gdmFsdWUgJiAweGZmOwogICAgfQogIH0KfQpjbGFzcyBDRkZDb21waWxlciB7CiAgY29uc3RydWN0b3IoY2ZmKSB7CiAgICB0aGlzLmNmZiA9IGNmZjsKICB9CiAgY29tcGlsZSgpIHsKICAgIGNvbnN0IGNmZiA9IHRoaXMuY2ZmOwogICAgY29uc3Qgb3V0cHV0ID0gewogICAgICBkYXRhOiBbXSwKICAgICAgbGVuZ3RoOiAwLAogICAgICBhZGQoZGF0YSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLmRhdGEucHVzaCguLi5kYXRhKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5jb25jYXQoZGF0YSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5kYXRhLmxlbmd0aDsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGhlYWRlciA9IHRoaXMuY29tcGlsZUhlYWRlcihjZmYuaGVhZGVyKTsKICAgIG91dHB1dC5hZGQoaGVhZGVyKTsKICAgIGNvbnN0IG5hbWVJbmRleCA9IHRoaXMuY29tcGlsZU5hbWVJbmRleChjZmYubmFtZXMpOwogICAgb3V0cHV0LmFkZChuYW1lSW5kZXgpOwogICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgaWYgKGNmZi50b3BEaWN0Lmhhc05hbWUoIkZvbnRNYXRyaXgiKSkgewogICAgICAgIGNvbnN0IGJhc2UgPSBjZmYudG9wRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKTsKICAgICAgICBjZmYudG9wRGljdC5yZW1vdmVCeU5hbWUoIkZvbnRNYXRyaXgiKTsKICAgICAgICBmb3IgKGNvbnN0IHN1YkRpY3Qgb2YgY2ZmLmZkQXJyYXkpIHsKICAgICAgICAgIGxldCBtYXRyaXggPSBiYXNlLnNsaWNlKDApOwogICAgICAgICAgaWYgKHN1YkRpY3QuaGFzTmFtZSgiRm9udE1hdHJpeCIpKSB7CiAgICAgICAgICAgIG1hdHJpeCA9IFV0aWwudHJhbnNmb3JtKG1hdHJpeCwgc3ViRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKSk7CiAgICAgICAgICB9CiAgICAgICAgICBzdWJEaWN0LnNldEJ5TmFtZSgiRm9udE1hdHJpeCIsIG1hdHJpeCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCB4dWlkID0gY2ZmLnRvcERpY3QuZ2V0QnlOYW1lKCJYVUlEIik7CiAgICBpZiAoeHVpZD8ubGVuZ3RoID4gMTYpIHsKICAgICAgY2ZmLnRvcERpY3QucmVtb3ZlQnlOYW1lKCJYVUlEIik7CiAgICB9CiAgICBjZmYudG9wRGljdC5zZXRCeU5hbWUoImNoYXJzZXQiLCAwKTsKICAgIGxldCBjb21waWxlZCA9IHRoaXMuY29tcGlsZVRvcERpY3RzKFtjZmYudG9wRGljdF0sIG91dHB1dC5sZW5ndGgsIGNmZi5pc0NJREZvbnQpOwogICAgb3V0cHV0LmFkZChjb21waWxlZC5vdXRwdXQpOwogICAgY29uc3QgdG9wRGljdFRyYWNrZXIgPSBjb21waWxlZC50cmFja2Vyc1swXTsKICAgIGNvbnN0IHN0cmluZ0luZGV4ID0gdGhpcy5jb21waWxlU3RyaW5nSW5kZXgoY2ZmLnN0cmluZ3Muc3RyaW5ncyk7CiAgICBvdXRwdXQuYWRkKHN0cmluZ0luZGV4KTsKICAgIGNvbnN0IGdsb2JhbFN1YnJJbmRleCA9IHRoaXMuY29tcGlsZUluZGV4KGNmZi5nbG9iYWxTdWJySW5kZXgpOwogICAgb3V0cHV0LmFkZChnbG9iYWxTdWJySW5kZXgpOwogICAgaWYgKGNmZi5lbmNvZGluZyAmJiBjZmYudG9wRGljdC5oYXNOYW1lKCJFbmNvZGluZyIpKSB7CiAgICAgIGlmIChjZmYuZW5jb2RpbmcucHJlZGVmaW5lZCkgewogICAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkVuY29kaW5nIiwgW2NmZi5lbmNvZGluZy5mb3JtYXRdLCBvdXRwdXQpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGVuY29kaW5nID0gdGhpcy5jb21waWxlRW5jb2RpbmcoY2ZmLmVuY29kaW5nKTsKICAgICAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJFbmNvZGluZyIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgICAgICBvdXRwdXQuYWRkKGVuY29kaW5nKTsKICAgICAgfQogICAgfQogICAgY29uc3QgY2hhcnNldCA9IHRoaXMuY29tcGlsZUNoYXJzZXQoY2ZmLmNoYXJzZXQsIGNmZi5jaGFyU3RyaW5ncy5jb3VudCwgY2ZmLnN0cmluZ3MsIGNmZi5pc0NJREZvbnQpOwogICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiY2hhcnNldCIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgIG91dHB1dC5hZGQoY2hhcnNldCk7CiAgICBjb25zdCBjaGFyU3RyaW5ncyA9IHRoaXMuY29tcGlsZUNoYXJTdHJpbmdzKGNmZi5jaGFyU3RyaW5ncyk7CiAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJDaGFyU3RyaW5ncyIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgIG91dHB1dC5hZGQoY2hhclN0cmluZ3MpOwogICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiRkRTZWxlY3QiLCBbb3V0cHV0Lmxlbmd0aF0sIG91dHB1dCk7CiAgICAgIGNvbnN0IGZkU2VsZWN0ID0gdGhpcy5jb21waWxlRkRTZWxlY3QoY2ZmLmZkU2VsZWN0KTsKICAgICAgb3V0cHV0LmFkZChmZFNlbGVjdCk7CiAgICAgIGNvbXBpbGVkID0gdGhpcy5jb21waWxlVG9wRGljdHMoY2ZmLmZkQXJyYXksIG91dHB1dC5sZW5ndGgsIHRydWUpOwogICAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJGREFycmF5IiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgICBvdXRwdXQuYWRkKGNvbXBpbGVkLm91dHB1dCk7CiAgICAgIGNvbnN0IGZvbnREaWN0VHJhY2tlcnMgPSBjb21waWxlZC50cmFja2VyczsKICAgICAgdGhpcy5jb21waWxlUHJpdmF0ZURpY3RzKGNmZi5mZEFycmF5LCBmb250RGljdFRyYWNrZXJzLCBvdXRwdXQpOwogICAgfQogICAgdGhpcy5jb21waWxlUHJpdmF0ZURpY3RzKFtjZmYudG9wRGljdF0sIFt0b3BEaWN0VHJhY2tlcl0sIG91dHB1dCk7CiAgICBvdXRwdXQuYWRkKFswXSk7CiAgICByZXR1cm4gb3V0cHV0LmRhdGE7CiAgfQogIGVuY29kZU51bWJlcih2YWx1ZSkgewogICAgaWYgKE51bWJlci5pc0ludGVnZXIodmFsdWUpKSB7CiAgICAgIHJldHVybiB0aGlzLmVuY29kZUludGVnZXIodmFsdWUpOwogICAgfQogICAgcmV0dXJuIHRoaXMuZW5jb2RlRmxvYXQodmFsdWUpOwogIH0KICBzdGF0aWMgZ2V0IEVuY29kZUZsb2F0UmVnRXhwKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiRW5jb2RlRmxvYXRSZWdFeHAiLCAvXC4oXGQqPykoPzo5ezUsMjB9fDB7NSwyMH0pXGR7MCwyfSg/OmUoLispfCQpLyk7CiAgfQogIGVuY29kZUZsb2F0KG51bSkgewogICAgbGV0IHZhbHVlID0gbnVtLnRvU3RyaW5nKCk7CiAgICBjb25zdCBtID0gQ0ZGQ29tcGlsZXIuRW5jb2RlRmxvYXRSZWdFeHAuZXhlYyh2YWx1ZSk7CiAgICBpZiAobSkgewogICAgICBjb25zdCBlcHNpbG9uID0gcGFyc2VGbG9hdCgiMWUiICsgKChtWzJdID8gK21bMl0gOiAwKSArIG1bMV0ubGVuZ3RoKSk7CiAgICAgIHZhbHVlID0gKE1hdGgucm91bmQobnVtICogZXBzaWxvbikgLyBlcHNpbG9uKS50b1N0cmluZygpOwogICAgfQogICAgbGV0IG5pYmJsZXMgPSAiIjsKICAgIGxldCBpLCBpaTsKICAgIGZvciAoaSA9IDAsIGlpID0gdmFsdWUubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBhID0gdmFsdWVbaV07CiAgICAgIGlmIChhID09PSAiZSIpIHsKICAgICAgICBuaWJibGVzICs9IHZhbHVlWysraV0gPT09ICItIiA/ICJjIiA6ICJiIjsKICAgICAgfSBlbHNlIGlmIChhID09PSAiLiIpIHsKICAgICAgICBuaWJibGVzICs9ICJhIjsKICAgICAgfSBlbHNlIGlmIChhID09PSAiLSIpIHsKICAgICAgICBuaWJibGVzICs9ICJlIjsKICAgICAgfSBlbHNlIHsKICAgICAgICBuaWJibGVzICs9IGE7CiAgICAgIH0KICAgIH0KICAgIG5pYmJsZXMgKz0gbmliYmxlcy5sZW5ndGggJiAxID8gImYiIDogImZmIjsKICAgIGNvbnN0IG91dCA9IFszMF07CiAgICBmb3IgKGkgPSAwLCBpaSA9IG5pYmJsZXMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICBvdXQucHVzaChwYXJzZUludChuaWJibGVzLnN1YnN0cmluZyhpLCBpICsgMiksIDE2KSk7CiAgICB9CiAgICByZXR1cm4gb3V0OwogIH0KICBlbmNvZGVJbnRlZ2VyKHZhbHVlKSB7CiAgICBsZXQgY29kZTsKICAgIGlmICh2YWx1ZSA+PSAtMTA3ICYmIHZhbHVlIDw9IDEwNykgewogICAgICBjb2RlID0gW3ZhbHVlICsgMTM5XTsKICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMTA4ICYmIHZhbHVlIDw9IDExMzEpIHsKICAgICAgdmFsdWUgLT0gMTA4OwogICAgICBjb2RlID0gWyh2YWx1ZSA+PiA4KSArIDI0NywgdmFsdWUgJiAweGZmXTsKICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gLTExMzEgJiYgdmFsdWUgPD0gLTEwOCkgewogICAgICB2YWx1ZSA9IC12YWx1ZSAtIDEwODsKICAgICAgY29kZSA9IFsodmFsdWUgPj4gOCkgKyAyNTEsIHZhbHVlICYgMHhmZl07CiAgICB9IGVsc2UgaWYgKHZhbHVlID49IC0zMjc2OCAmJiB2YWx1ZSA8PSAzMjc2NykgewogICAgICBjb2RlID0gWzB4MWMsIHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmZdOwogICAgfSBlbHNlIHsKICAgICAgY29kZSA9IFsweDFkLCB2YWx1ZSA+PiAyNCAmIDB4ZmYsIHZhbHVlID4+IDE2ICYgMHhmZiwgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZl07CiAgICB9CiAgICByZXR1cm4gY29kZTsKICB9CiAgY29tcGlsZUhlYWRlcihoZWFkZXIpIHsKICAgIHJldHVybiBbaGVhZGVyLm1ham9yLCBoZWFkZXIubWlub3IsIDQsIGhlYWRlci5vZmZTaXplXTsKICB9CiAgY29tcGlsZU5hbWVJbmRleChuYW1lcykgewogICAgY29uc3QgbmFtZUluZGV4ID0gbmV3IENGRkluZGV4KCk7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gTWF0aC5taW4obmFtZS5sZW5ndGgsIDEyNyk7CiAgICAgIGxldCBzYW5pdGl6ZWROYW1lID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGVuZ3RoOyBqKyspIHsKICAgICAgICBsZXQgY2hhciA9IG5hbWVbal07CiAgICAgICAgaWYgKGNoYXIgPCAiISIgfHwgY2hhciA+ICJ+IiB8fCBjaGFyID09PSAiWyIgfHwgY2hhciA9PT0gIl0iIHx8IGNoYXIgPT09ICIoIiB8fCBjaGFyID09PSAiKSIgfHwgY2hhciA9PT0gInsiIHx8IGNoYXIgPT09ICJ9IiB8fCBjaGFyID09PSAiPCIgfHwgY2hhciA9PT0gIj4iIHx8IGNoYXIgPT09ICIvIiB8fCBjaGFyID09PSAiJSIpIHsKICAgICAgICAgIGNoYXIgPSAiXyI7CiAgICAgICAgfQogICAgICAgIHNhbml0aXplZE5hbWVbal0gPSBjaGFyOwogICAgICB9CiAgICAgIHNhbml0aXplZE5hbWUgPSBzYW5pdGl6ZWROYW1lLmpvaW4oIiIpOwogICAgICBpZiAoc2FuaXRpemVkTmFtZSA9PT0gIiIpIHsKICAgICAgICBzYW5pdGl6ZWROYW1lID0gIkJhZF9Gb250X05hbWUiOwogICAgICB9CiAgICAgIG5hbWVJbmRleC5hZGQoc3RyaW5nVG9CeXRlcyhzYW5pdGl6ZWROYW1lKSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb21waWxlSW5kZXgobmFtZUluZGV4KTsKICB9CiAgY29tcGlsZVRvcERpY3RzKGRpY3RzLCBsZW5ndGgsIHJlbW92ZUNpZEtleXMpIHsKICAgIGNvbnN0IGZvbnREaWN0VHJhY2tlcnMgPSBbXTsKICAgIGxldCBmZEFycmF5SW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAoY29uc3QgZm9udERpY3Qgb2YgZGljdHMpIHsKICAgICAgaWYgKHJlbW92ZUNpZEtleXMpIHsKICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJREZvbnRWZXJzaW9uIik7CiAgICAgICAgZm9udERpY3QucmVtb3ZlQnlOYW1lKCJDSURGb250UmV2aXNpb24iKTsKICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJREZvbnRUeXBlIik7CiAgICAgICAgZm9udERpY3QucmVtb3ZlQnlOYW1lKCJDSURDb3VudCIpOwogICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiVUlEQmFzZSIpOwogICAgICB9CiAgICAgIGNvbnN0IGZvbnREaWN0VHJhY2tlciA9IG5ldyBDRkZPZmZzZXRUcmFja2VyKCk7CiAgICAgIGNvbnN0IGZvbnREaWN0RGF0YSA9IHRoaXMuY29tcGlsZURpY3QoZm9udERpY3QsIGZvbnREaWN0VHJhY2tlcik7CiAgICAgIGZvbnREaWN0VHJhY2tlcnMucHVzaChmb250RGljdFRyYWNrZXIpOwogICAgICBmZEFycmF5SW5kZXguYWRkKGZvbnREaWN0RGF0YSk7CiAgICAgIGZvbnREaWN0VHJhY2tlci5vZmZzZXQobGVuZ3RoKTsKICAgIH0KICAgIGZkQXJyYXlJbmRleCA9IHRoaXMuY29tcGlsZUluZGV4KGZkQXJyYXlJbmRleCwgZm9udERpY3RUcmFja2Vycyk7CiAgICByZXR1cm4gewogICAgICB0cmFja2VyczogZm9udERpY3RUcmFja2VycywKICAgICAgb3V0cHV0OiBmZEFycmF5SW5kZXgKICAgIH07CiAgfQogIGNvbXBpbGVQcml2YXRlRGljdHMoZGljdHMsIHRyYWNrZXJzLCBvdXRwdXQpIHsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGRpY3RzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3QgZm9udERpY3QgPSBkaWN0c1tpXTsKICAgICAgY29uc3QgcHJpdmF0ZURpY3QgPSBmb250RGljdC5wcml2YXRlRGljdDsKICAgICAgaWYgKCFwcml2YXRlRGljdCB8fCAhZm9udERpY3QuaGFzTmFtZSgiUHJpdmF0ZSIpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJUaGVyZSBtdXN0IGJlIGEgcHJpdmF0ZSBkaWN0aW9uYXJ5LiIpOwogICAgICB9CiAgICAgIGNvbnN0IHByaXZhdGVEaWN0VHJhY2tlciA9IG5ldyBDRkZPZmZzZXRUcmFja2VyKCk7CiAgICAgIGNvbnN0IHByaXZhdGVEaWN0RGF0YSA9IHRoaXMuY29tcGlsZURpY3QocHJpdmF0ZURpY3QsIHByaXZhdGVEaWN0VHJhY2tlcik7CiAgICAgIGxldCBvdXRwdXRMZW5ndGggPSBvdXRwdXQubGVuZ3RoOwogICAgICBwcml2YXRlRGljdFRyYWNrZXIub2Zmc2V0KG91dHB1dExlbmd0aCk7CiAgICAgIGlmICghcHJpdmF0ZURpY3REYXRhLmxlbmd0aCkgewogICAgICAgIG91dHB1dExlbmd0aCA9IDA7CiAgICAgIH0KICAgICAgdHJhY2tlcnNbaV0uc2V0RW50cnlMb2NhdGlvbigiUHJpdmF0ZSIsIFtwcml2YXRlRGljdERhdGEubGVuZ3RoLCBvdXRwdXRMZW5ndGhdLCBvdXRwdXQpOwogICAgICBvdXRwdXQuYWRkKHByaXZhdGVEaWN0RGF0YSk7CiAgICAgIGlmIChwcml2YXRlRGljdC5zdWJyc0luZGV4ICYmIHByaXZhdGVEaWN0Lmhhc05hbWUoIlN1YnJzIikpIHsKICAgICAgICBjb25zdCBzdWJycyA9IHRoaXMuY29tcGlsZUluZGV4KHByaXZhdGVEaWN0LnN1YnJzSW5kZXgpOwogICAgICAgIHByaXZhdGVEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJTdWJycyIsIFtwcml2YXRlRGljdERhdGEubGVuZ3RoXSwgb3V0cHV0KTsKICAgICAgICBvdXRwdXQuYWRkKHN1YnJzKTsKICAgICAgfQogICAgfQogIH0KICBjb21waWxlRGljdChkaWN0LCBvZmZzZXRUcmFja2VyKSB7CiAgICBjb25zdCBvdXQgPSBbXTsKICAgIGZvciAoY29uc3Qga2V5IG9mIGRpY3Qub3JkZXIpIHsKICAgICAgaWYgKCEoa2V5IGluIGRpY3QudmFsdWVzKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCB2YWx1ZXMgPSBkaWN0LnZhbHVlc1trZXldOwogICAgICBsZXQgdHlwZXMgPSBkaWN0LnR5cGVzW2tleV07CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0eXBlcykpIHsKICAgICAgICB0eXBlcyA9IFt0eXBlc107CiAgICAgIH0KICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlcykpIHsKICAgICAgICB2YWx1ZXMgPSBbdmFsdWVzXTsKICAgICAgfQogICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHR5cGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICBjb25zdCB0eXBlID0gdHlwZXNbal07CiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbal07CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICBjYXNlICJudW0iOgogICAgICAgICAgY2FzZSAic2lkIjoKICAgICAgICAgICAgb3V0LnB1c2goLi4udGhpcy5lbmNvZGVOdW1iZXIodmFsdWUpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJvZmZzZXQiOgogICAgICAgICAgICBjb25zdCBuYW1lID0gZGljdC5rZXlUb05hbWVNYXBba2V5XTsKICAgICAgICAgICAgaWYgKCFvZmZzZXRUcmFja2VyLmlzVHJhY2tpbmcobmFtZSkpIHsKICAgICAgICAgICAgICBvZmZzZXRUcmFja2VyLnRyYWNrKG5hbWUsIG91dC5sZW5ndGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dC5wdXNoKDB4MWQsIDAsIDAsIDAsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImFycmF5IjoKICAgICAgICAgIGNhc2UgImRlbHRhIjoKICAgICAgICAgICAgb3V0LnB1c2goLi4udGhpcy5lbmNvZGVOdW1iZXIodmFsdWUpKTsKICAgICAgICAgICAgZm9yIChsZXQgayA9IDEsIGtrID0gdmFsdWVzLmxlbmd0aDsgayA8IGtrOyArK2spIHsKICAgICAgICAgICAgICBvdXQucHVzaCguLi50aGlzLmVuY29kZU51bWJlcih2YWx1ZXNba10pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5rbm93biBkYXRhIHR5cGUgb2YgJHt0eXBlfWApOwogICAgICAgIH0KICAgICAgfQogICAgICBvdXQucHVzaCguLi5kaWN0Lm9wY29kZXNba2V5XSk7CiAgICB9CiAgICByZXR1cm4gb3V0OwogIH0KICBjb21waWxlU3RyaW5nSW5kZXgoc3RyaW5ncykgewogICAgY29uc3Qgc3RyaW5nSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAoY29uc3Qgc3RyaW5nIG9mIHN0cmluZ3MpIHsKICAgICAgc3RyaW5nSW5kZXguYWRkKHN0cmluZ1RvQnl0ZXMoc3RyaW5nKSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb21waWxlSW5kZXgoc3RyaW5nSW5kZXgpOwogIH0KICBjb21waWxlQ2hhclN0cmluZ3MoY2hhclN0cmluZ3MpIHsKICAgIGNvbnN0IGNoYXJTdHJpbmdzSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhclN0cmluZ3MuY291bnQ7IGkrKykgewogICAgICBjb25zdCBnbHlwaCA9IGNoYXJTdHJpbmdzLmdldChpKTsKICAgICAgaWYgKGdseXBoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNoYXJTdHJpbmdzSW5kZXguYWRkKG5ldyBVaW50OEFycmF5KFsweDhiLCAweDBlXSkpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNoYXJTdHJpbmdzSW5kZXguYWRkKGdseXBoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVJbmRleChjaGFyU3RyaW5nc0luZGV4KTsKICB9CiAgY29tcGlsZUNoYXJzZXQoY2hhcnNldCwgbnVtR2x5cGhzLCBzdHJpbmdzLCBpc0NJREZvbnQpIHsKICAgIGxldCBvdXQ7CiAgICBjb25zdCBudW1HbHlwaHNMZXNzTm90RGVmID0gbnVtR2x5cGhzIC0gMTsKICAgIGlmIChpc0NJREZvbnQpIHsKICAgICAgY29uc3QgbkxlZnQgPSBudW1HbHlwaHNMZXNzTm90RGVmIC0gMTsKICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoWzIsIDAsIDEsIG5MZWZ0ID4+IDggJiAweGZmLCBuTGVmdCAmIDB4ZmZdKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IDEgKyBudW1HbHlwaHNMZXNzTm90RGVmICogMjsKICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICAgICAgb3V0WzBdID0gMDsKICAgICAgbGV0IGNoYXJzZXRJbmRleCA9IDA7CiAgICAgIGNvbnN0IG51bUNoYXJzZXRzID0gY2hhcnNldC5jaGFyc2V0Lmxlbmd0aDsKICAgICAgbGV0IHdhcm5lZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG91dC5sZW5ndGg7IGkgKz0gMikgewogICAgICAgIGxldCBzaWQgPSAwOwogICAgICAgIGlmIChjaGFyc2V0SW5kZXggPCBudW1DaGFyc2V0cykgewogICAgICAgICAgY29uc3QgbmFtZSA9IGNoYXJzZXQuY2hhcnNldFtjaGFyc2V0SW5kZXgrK107CiAgICAgICAgICBzaWQgPSBzdHJpbmdzLmdldFNJRChuYW1lKTsKICAgICAgICAgIGlmIChzaWQgPT09IC0xKSB7CiAgICAgICAgICAgIHNpZCA9IDA7CiAgICAgICAgICAgIGlmICghd2FybmVkKSB7CiAgICAgICAgICAgICAgd2FybmVkID0gdHJ1ZTsKICAgICAgICAgICAgICB3YXJuKGBDb3VsZG4ndCBmaW5kICR7bmFtZX0gaW4gQ0ZGIHN0cmluZ3NgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvdXRbaV0gPSBzaWQgPj4gOCAmIDB4ZmY7CiAgICAgICAgb3V0W2kgKyAxXSA9IHNpZCAmIDB4ZmY7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVUeXBlZEFycmF5KG91dCk7CiAgfQogIGNvbXBpbGVFbmNvZGluZyhlbmNvZGluZykgewogICAgcmV0dXJuIHRoaXMuY29tcGlsZVR5cGVkQXJyYXkoZW5jb2RpbmcucmF3KTsKICB9CiAgY29tcGlsZUZEU2VsZWN0KGZkU2VsZWN0KSB7CiAgICBjb25zdCBmb3JtYXQgPSBmZFNlbGVjdC5mb3JtYXQ7CiAgICBsZXQgb3V0LCBpOwogICAgc3dpdGNoIChmb3JtYXQpIHsKICAgICAgY2FzZSAwOgogICAgICAgIG91dCA9IG5ldyBVaW50OEFycmF5KDEgKyBmZFNlbGVjdC5mZFNlbGVjdC5sZW5ndGgpOwogICAgICAgIG91dFswXSA9IGZvcm1hdDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmRTZWxlY3QuZmRTZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIG91dFtpICsgMV0gPSBmZFNlbGVjdC5mZFNlbGVjdFtpXTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMzoKICAgICAgICBjb25zdCBzdGFydCA9IDA7CiAgICAgICAgbGV0IGxhc3RGRCA9IGZkU2VsZWN0LmZkU2VsZWN0WzBdOwogICAgICAgIGNvbnN0IHJhbmdlcyA9IFtmb3JtYXQsIDAsIDAsIHN0YXJ0ID4+IDggJiAweGZmLCBzdGFydCAmIDB4ZmYsIGxhc3RGRF07CiAgICAgICAgZm9yIChpID0gMTsgaSA8IGZkU2VsZWN0LmZkU2VsZWN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjdXJyZW50RkQgPSBmZFNlbGVjdC5mZFNlbGVjdFtpXTsKICAgICAgICAgIGlmIChjdXJyZW50RkQgIT09IGxhc3RGRCkgewogICAgICAgICAgICByYW5nZXMucHVzaChpID4+IDggJiAweGZmLCBpICYgMHhmZiwgY3VycmVudEZEKTsKICAgICAgICAgICAgbGFzdEZEID0gY3VycmVudEZEOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBudW1SYW5nZXMgPSAocmFuZ2VzLmxlbmd0aCAtIDMpIC8gMzsKICAgICAgICByYW5nZXNbMV0gPSBudW1SYW5nZXMgPj4gOCAmIDB4ZmY7CiAgICAgICAgcmFuZ2VzWzJdID0gbnVtUmFuZ2VzICYgMHhmZjsKICAgICAgICByYW5nZXMucHVzaChpID4+IDggJiAweGZmLCBpICYgMHhmZik7CiAgICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkocmFuZ2VzKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVUeXBlZEFycmF5KG91dCk7CiAgfQogIGNvbXBpbGVUeXBlZEFycmF5KGRhdGEpIHsKICAgIHJldHVybiBBcnJheS5mcm9tKGRhdGEpOwogIH0KICBjb21waWxlSW5kZXgoaW5kZXgsIHRyYWNrZXJzID0gW10pIHsKICAgIGNvbnN0IG9iamVjdHMgPSBpbmRleC5vYmplY3RzOwogICAgY29uc3QgY291bnQgPSBvYmplY3RzLmxlbmd0aDsKICAgIGlmIChjb3VudCA9PT0gMCkgewogICAgICByZXR1cm4gWzAsIDBdOwogICAgfQogICAgY29uc3QgZGF0YSA9IFtjb3VudCA+PiA4ICYgMHhmZiwgY291bnQgJiAweGZmXTsKICAgIGxldCBsYXN0T2Zmc2V0ID0gMSwKICAgICAgaTsKICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgIGxhc3RPZmZzZXQgKz0gb2JqZWN0c1tpXS5sZW5ndGg7CiAgICB9CiAgICBsZXQgb2Zmc2V0U2l6ZTsKICAgIGlmIChsYXN0T2Zmc2V0IDwgMHgxMDApIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDE7CiAgICB9IGVsc2UgaWYgKGxhc3RPZmZzZXQgPCAweDEwMDAwKSB7CiAgICAgIG9mZnNldFNpemUgPSAyOwogICAgfSBlbHNlIGlmIChsYXN0T2Zmc2V0IDwgMHgxMDAwMDAwKSB7CiAgICAgIG9mZnNldFNpemUgPSAzOwogICAgfSBlbHNlIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDQ7CiAgICB9CiAgICBkYXRhLnB1c2gob2Zmc2V0U2l6ZSk7CiAgICBsZXQgcmVsYXRpdmVPZmZzZXQgPSAxOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50ICsgMTsgaSsrKSB7CiAgICAgIGlmIChvZmZzZXRTaXplID09PSAxKSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgIH0gZWxzZSBpZiAob2Zmc2V0U2l6ZSA9PT0gMikgewogICAgICAgIGRhdGEucHVzaChyZWxhdGl2ZU9mZnNldCA+PiA4ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfSBlbHNlIGlmIChvZmZzZXRTaXplID09PSAzKSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+IDE2ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gOCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+PiAyNCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ID4+IDE2ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gOCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgIH0KICAgICAgaWYgKG9iamVjdHNbaV0pIHsKICAgICAgICByZWxhdGl2ZU9mZnNldCArPSBvYmplY3RzW2ldLmxlbmd0aDsKICAgICAgfQogICAgfQogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgaWYgKHRyYWNrZXJzW2ldKSB7CiAgICAgICAgdHJhY2tlcnNbaV0ub2Zmc2V0KGRhdGEubGVuZ3RoKTsKICAgICAgfQogICAgICBkYXRhLnB1c2goLi4ub2JqZWN0c1tpXSk7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3N0YW5kYXJkX2ZvbnRzLmpzCgoKY29uc3QgZ2V0U3RkRm9udE1hcCA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHRbIlRpbWVzLVJvbWFuIl0gPSAiVGltZXMtUm9tYW4iOwogIHQuSGVsdmV0aWNhID0gIkhlbHZldGljYSI7CiAgdC5Db3VyaWVyID0gIkNvdXJpZXIiOwogIHQuU3ltYm9sID0gIlN5bWJvbCI7CiAgdFsiVGltZXMtQm9sZCJdID0gIlRpbWVzLUJvbGQiOwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkNvdXJpZXItQm9sZCJdID0gIkNvdXJpZXItQm9sZCI7CiAgdC5aYXBmRGluZ2JhdHMgPSAiWmFwZkRpbmdiYXRzIjsKICB0WyJUaW1lcy1JdGFsaWMiXSA9ICJUaW1lcy1JdGFsaWMiOwogIHRbIkhlbHZldGljYS1PYmxpcXVlIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkNvdXJpZXItT2JsaXF1ZSJdID0gIkNvdXJpZXItT2JsaXF1ZSI7CiAgdFsiVGltZXMtQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogIHRbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ291cmllci1Cb2xkT2JsaXF1ZSJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogIHQuQXJpYWxOYXJyb3cgPSAiSGVsdmV0aWNhIjsKICB0WyJBcmlhbE5hcnJvdy1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsTmFycm93LUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsTmFycm93LUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkFyaWFsQmxhY2sgPSAiSGVsdmV0aWNhIjsKICB0WyJBcmlhbEJsYWNrLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWxCbGFjay1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbEJsYWNrLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0WyJBcmlhbC1CbGFjayJdID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWwtQmxhY2stQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbC1CbGFjay1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1CbGFjay1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5BcmlhbCA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWwtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQXJpYWwtSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHQuQXJpYWxNVCA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsLUJvbGRJdGFsaWNNVCJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQXJpYWwtQm9sZE1UIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsLUl0YWxpY01UIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkFyaWFsLUJvbGRJdGFsaWNNVC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1Cb2xkTVQtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbC1JdGFsaWNNVC1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5BcmlhbFVuaWNvZGVNUyA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsVW5pY29kZU1TLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWxVbmljb2RlTVMtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQXJpYWxVbmljb2RlTVMtSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkNvdXJpZXItQm9sZEl0YWxpYyJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogIHRbIkNvdXJpZXItSXRhbGljIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0LkNvdXJpZXJOZXcgPSAiQ291cmllciI7CiAgdFsiQ291cmllck5ldy1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICB0WyJDb3VyaWVyTmV3LUJvbGRJdGFsaWMiXSA9ICJDb3VyaWVyLUJvbGRPYmxpcXVlIjsKICB0WyJDb3VyaWVyTmV3LUl0YWxpYyJdID0gIkNvdXJpZXItT2JsaXF1ZSI7CiAgdFsiQ291cmllck5ld1BTLUJvbGRJdGFsaWNNVCJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogIHRbIkNvdXJpZXJOZXdQUy1Cb2xkTVQiXSA9ICJDb3VyaWVyLUJvbGQiOwogIHRbIkNvdXJpZXJOZXdQUy1JdGFsaWNNVCJdID0gIkNvdXJpZXItT2JsaXF1ZSI7CiAgdC5Db3VyaWVyTmV3UFNNVCA9ICJDb3VyaWVyIjsKICB0WyJIZWx2ZXRpY2EtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiSGVsdmV0aWNhLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0WyJIZWx2ZXRpY2FMVFN0ZC1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIlN5bWJvbC1Cb2xkIl0gPSAiU3ltYm9sIjsKICB0WyJTeW1ib2wtQm9sZEl0YWxpYyJdID0gIlN5bWJvbCI7CiAgdFsiU3ltYm9sLUl0YWxpYyJdID0gIlN5bWJvbCI7CiAgdC5UaW1lc05ld1JvbWFuID0gIlRpbWVzLVJvbWFuIjsKICB0WyJUaW1lc05ld1JvbWFuLUJvbGQiXSA9ICJUaW1lcy1Cb2xkIjsKICB0WyJUaW1lc05ld1JvbWFuLUJvbGRJdGFsaWMiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdC5UaW1lc05ld1JvbWFuUFMgPSAiVGltZXMtUm9tYW4iOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiVGltZXNOZXdSb21hblBTLUJvbGRJdGFsaWMiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuUFMtQm9sZEl0YWxpY01UIl0gPSAiVGltZXMtQm9sZEl0YWxpYyI7CiAgdFsiVGltZXNOZXdSb21hblBTLUJvbGRNVCJdID0gIlRpbWVzLUJvbGQiOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1JdGFsaWMiXSA9ICJUaW1lcy1JdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1JdGFsaWNNVCJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdC5UaW1lc05ld1JvbWFuUFNNVCA9ICJUaW1lcy1Sb21hbiI7CiAgdFsiVGltZXNOZXdSb21hblBTTVQtQm9sZCJdID0gIlRpbWVzLUJvbGQiOwogIHRbIlRpbWVzTmV3Um9tYW5QU01ULUJvbGRJdGFsaWMiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuUFNNVC1JdGFsaWMiXSA9ICJUaW1lcy1JdGFsaWMiOwp9KTsKY29uc3QgZ2V0Rm9udE5hbWVUb0ZpbGVNYXAgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0LkNvdXJpZXIgPSAiRm94aXRGaXhlZC5wZmIiOwogIHRbIkNvdXJpZXItQm9sZCJdID0gIkZveGl0Rml4ZWRCb2xkLnBmYiI7CiAgdFsiQ291cmllci1Cb2xkT2JsaXF1ZSJdID0gIkZveGl0Rml4ZWRCb2xkSXRhbGljLnBmYiI7CiAgdFsiQ291cmllci1PYmxpcXVlIl0gPSAiRm94aXRGaXhlZEl0YWxpYy5wZmIiOwogIHQuSGVsdmV0aWNhID0gIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIudHRmIjsKICB0WyJIZWx2ZXRpY2EtQm9sZCJdID0gIkxpYmVyYXRpb25TYW5zLUJvbGQudHRmIjsKICB0WyJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiXSA9ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljLnR0ZiI7CiAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMudHRmIjsKICB0WyJUaW1lcy1Sb21hbiJdID0gIkZveGl0U2VyaWYucGZiIjsKICB0WyJUaW1lcy1Cb2xkIl0gPSAiRm94aXRTZXJpZkJvbGQucGZiIjsKICB0WyJUaW1lcy1Cb2xkSXRhbGljIl0gPSAiRm94aXRTZXJpZkJvbGRJdGFsaWMucGZiIjsKICB0WyJUaW1lcy1JdGFsaWMiXSA9ICJGb3hpdFNlcmlmSXRhbGljLnBmYiI7CiAgdC5TeW1ib2wgPSAiRm94aXRTeW1ib2wucGZiIjsKICB0LlphcGZEaW5nYmF0cyA9ICJGb3hpdERpbmdiYXRzLnBmYiI7CiAgdFsiTGliZXJhdGlvblNhbnMtUmVndWxhciJdID0gIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIudHRmIjsKICB0WyJMaWJlcmF0aW9uU2Fucy1Cb2xkIl0gPSAiTGliZXJhdGlvblNhbnMtQm9sZC50dGYiOwogIHRbIkxpYmVyYXRpb25TYW5zLUl0YWxpYyJdID0gIkxpYmVyYXRpb25TYW5zLUl0YWxpYy50dGYiOwogIHRbIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMiXSA9ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljLnR0ZiI7Cn0pOwpjb25zdCBnZXROb25TdGRGb250TWFwID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdC5DYWxpYnJpID0gIkhlbHZldGljYSI7CiAgdFsiQ2FsaWJyaS1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkNhbGlicmktQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ2FsaWJyaS1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5DZW50dXJ5R290aGljID0gIkhlbHZldGljYSI7CiAgdFsiQ2VudHVyeUdvdGhpYy1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkNlbnR1cnlHb3RoaWMtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ2VudHVyeUdvdGhpYy1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5Db21pY1NhbnNNUyA9ICJDb21pYyBTYW5zIE1TIjsKICB0WyJDb21pY1NhbnNNUy1Cb2xkIl0gPSAiQ29taWMgU2FucyBNUy1Cb2xkIjsKICB0WyJDb21pY1NhbnNNUy1Cb2xkSXRhbGljIl0gPSAiQ29taWMgU2FucyBNUy1Cb2xkSXRhbGljIjsKICB0WyJDb21pY1NhbnNNUy1JdGFsaWMiXSA9ICJDb21pYyBTYW5zIE1TLUl0YWxpYyI7CiAgdC5HaWxsU2Fuc01UID0gIkhlbHZldGljYSI7CiAgdFsiR2lsbFNhbnNNVC1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkdpbGxTYW5zTVQtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiR2lsbFNhbnNNVC1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5JbXBhY3QgPSAiSGVsdmV0aWNhIjsKICB0WyJJdGNTeW1ib2wtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJJdGNTeW1ib2wtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiSXRjU3ltYm9sLUJvb2siXSA9ICJIZWx2ZXRpY2EiOwogIHRbIkl0Y1N5bWJvbC1Cb29rSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkl0Y1N5bWJvbC1NZWRpdW0iXSA9ICJIZWx2ZXRpY2EiOwogIHRbIkl0Y1N5bWJvbC1NZWRpdW1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5MdWNpZGFDb25zb2xlID0gIkNvdXJpZXIiOwogIHRbIkx1Y2lkYUNvbnNvbGUtQm9sZCJdID0gIkNvdXJpZXItQm9sZCI7CiAgdFsiTHVjaWRhQ29uc29sZS1Cb2xkSXRhbGljIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiTHVjaWRhQ29uc29sZS1JdGFsaWMiXSA9ICJDb3VyaWVyLU9ibGlxdWUiOwogIHRbIkx1Y2lkYVNhbnMtRGVtaSJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJNUy1Hb3RoaWMiXSA9ICJNUyBHb3RoaWMiOwogIHRbIk1TLUdvdGhpYy1Cb2xkIl0gPSAiTVMgR290aGljLUJvbGQiOwogIHRbIk1TLUdvdGhpYy1Cb2xkSXRhbGljIl0gPSAiTVMgR290aGljLUJvbGRJdGFsaWMiOwogIHRbIk1TLUdvdGhpYy1JdGFsaWMiXSA9ICJNUyBHb3RoaWMtSXRhbGljIjsKICB0WyJNUy1NaW5jaG8iXSA9ICJNUyBNaW5jaG8iOwogIHRbIk1TLU1pbmNoby1Cb2xkIl0gPSAiTVMgTWluY2hvLUJvbGQiOwogIHRbIk1TLU1pbmNoby1Cb2xkSXRhbGljIl0gPSAiTVMgTWluY2hvLUJvbGRJdGFsaWMiOwogIHRbIk1TLU1pbmNoby1JdGFsaWMiXSA9ICJNUyBNaW5jaG8tSXRhbGljIjsKICB0WyJNUy1QR290aGljIl0gPSAiTVMgUEdvdGhpYyI7CiAgdFsiTVMtUEdvdGhpYy1Cb2xkIl0gPSAiTVMgUEdvdGhpYy1Cb2xkIjsKICB0WyJNUy1QR290aGljLUJvbGRJdGFsaWMiXSA9ICJNUyBQR290aGljLUJvbGRJdGFsaWMiOwogIHRbIk1TLVBHb3RoaWMtSXRhbGljIl0gPSAiTVMgUEdvdGhpYy1JdGFsaWMiOwogIHRbIk1TLVBNaW5jaG8iXSA9ICJNUyBQTWluY2hvIjsKICB0WyJNUy1QTWluY2hvLUJvbGQiXSA9ICJNUyBQTWluY2hvLUJvbGQiOwogIHRbIk1TLVBNaW5jaG8tQm9sZEl0YWxpYyJdID0gIk1TIFBNaW5jaG8tQm9sZEl0YWxpYyI7CiAgdFsiTVMtUE1pbmNoby1JdGFsaWMiXSA9ICJNUyBQTWluY2hvLUl0YWxpYyI7CiAgdC5OdXB0aWFsU2NyaXB0ID0gIlRpbWVzLUl0YWxpYyI7CiAgdC5TZWdvZVVJU3ltYm9sID0gIkhlbHZldGljYSI7Cn0pOwpjb25zdCBnZXRTZXJpZkZvbnRzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdFsiQWRvYmUgSmVuc29uIl0gPSB0cnVlOwogIHRbIkFkb2JlIFRleHQiXSA9IHRydWU7CiAgdC5BbGJlcnR1cyA9IHRydWU7CiAgdC5BbGR1cyA9IHRydWU7CiAgdC5BbGV4YW5kcmlhID0gdHJ1ZTsKICB0LkFsZ2VyaWFuID0gdHJ1ZTsKICB0WyJBbWVyaWNhbiBUeXBld3JpdGVyIl0gPSB0cnVlOwogIHQuQW50aXF1YSA9IHRydWU7CiAgdC5BcGV4ID0gdHJ1ZTsKICB0LkFybm8gPSB0cnVlOwogIHQuQXN0ZXIgPSB0cnVlOwogIHQuQXVyb3JhID0gdHJ1ZTsKICB0LkJhc2tlcnZpbGxlID0gdHJ1ZTsKICB0LkJlbGwgPSB0cnVlOwogIHQuQmVtYm8gPSB0cnVlOwogIHRbIkJlbWJvIFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdC5CZW5ndWlhdCA9IHRydWU7CiAgdFsiQmVya2VsZXkgT2xkIFN0eWxlIl0gPSB0cnVlOwogIHRbIkJlcm5oYXJkIE1vZGVybiJdID0gdHJ1ZTsKICB0WyJCZXJ0aG9sZCBDaXR5Il0gPSB0cnVlOwogIHQuQm9kb25pID0gdHJ1ZTsKICB0WyJCYXVlciBCb2RvbmkiXSA9IHRydWU7CiAgdFsiQm9vayBBbnRpcXVhIl0gPSB0cnVlOwogIHQuQm9va21hbiA9IHRydWU7CiAgdFsiQm9yZGVhdXggUm9tYW4iXSA9IHRydWU7CiAgdFsiQ2FsaWZvcm5pYW4gRkIiXSA9IHRydWU7CiAgdC5DYWxpc3RvID0gdHJ1ZTsKICB0LkNhbHZlcnQgPSB0cnVlOwogIHQuQ2FwaXRhbHMgPSB0cnVlOwogIHQuQ2FtYnJpYSA9IHRydWU7CiAgdC5DYXJ0aWVyID0gdHJ1ZTsKICB0LkNhc2xvbiA9IHRydWU7CiAgdC5DYXR1bGwgPSB0cnVlOwogIHQuQ2VudGF1ciA9IHRydWU7CiAgdFsiQ2VudHVyeSBPbGQgU3R5bGUiXSA9IHRydWU7CiAgdFsiQ2VudHVyeSBTY2hvb2xib29rIl0gPSB0cnVlOwogIHQuQ2hhcGFycmFsID0gdHJ1ZTsKICB0WyJDaGFyaXMgU0lMIl0gPSB0cnVlOwogIHQuQ2hlbHRlbmhhbSA9IHRydWU7CiAgdFsiQ2hvbGxhIFNsYWIiXSA9IHRydWU7CiAgdC5DbGFyZW5kb24gPSB0cnVlOwogIHQuQ2xlYXJmYWNlID0gdHJ1ZTsKICB0LkNvY2hpbiA9IHRydWU7CiAgdC5Db2xvbm5hID0gdHJ1ZTsKICB0WyJDb21wdXRlciBNb2Rlcm4iXSA9IHRydWU7CiAgdFsiQ29uY3JldGUgUm9tYW4iXSA9IHRydWU7CiAgdC5Db25zdGFudGlhID0gdHJ1ZTsKICB0WyJDb29wZXIgQmxhY2siXSA9IHRydWU7CiAgdC5Db3JvbmEgPSB0cnVlOwogIHQuRWNvdHlwZSA9IHRydWU7CiAgdC5FZ3lwdGllbm5lID0gdHJ1ZTsKICB0LkVsZXBoYW50ID0gdHJ1ZTsKICB0LkV4Y2Vsc2lvciA9IHRydWU7CiAgdC5GYWlyZmllbGQgPSB0cnVlOwogIHRbIkZGIFNjYWxhIl0gPSB0cnVlOwogIHQuRm9sa2FyZCA9IHRydWU7CiAgdC5Gb290bGlnaHQgPSB0cnVlOwogIHQuRnJlZVNlcmlmID0gdHJ1ZTsKICB0WyJGcml6IFF1YWRyYXRhIl0gPSB0cnVlOwogIHQuR2FyYW1vbmQgPSB0cnVlOwogIHQuR2VudGl1bSA9IHRydWU7CiAgdC5HZW9yZ2lhID0gdHJ1ZTsKICB0Lkdsb3VjZXN0ZXIgPSB0cnVlOwogIHRbIkdvdWR5IE9sZCBTdHlsZSJdID0gdHJ1ZTsKICB0WyJHb3VkeSBTY2hvb2xib29rIl0gPSB0cnVlOwogIHRbIkdvdWR5IFBybyBGb250Il0gPSB0cnVlOwogIHQuR3JhbmpvbiA9IHRydWU7CiAgdFsiR3VhcmRpYW4gRWd5cHRpYW4iXSA9IHRydWU7CiAgdC5IZWF0aGVyID0gdHJ1ZTsKICB0LkhlcmN1bGVzID0gdHJ1ZTsKICB0WyJIaWdoIFRvd2VyIFRleHQiXSA9IHRydWU7CiAgdC5IaXJvc2hpZ2UgPSB0cnVlOwogIHRbIkhvZWZsZXIgVGV4dCJdID0gdHJ1ZTsKICB0WyJIdW1hbmEgU2VyaWYiXSA9IHRydWU7CiAgdC5JbXByaW50ID0gdHJ1ZTsKICB0WyJJb25pYyBOby4gNSJdID0gdHJ1ZTsKICB0LkphbnNvbiA9IHRydWU7CiAgdC5Kb2FubmEgPSB0cnVlOwogIHQuS29yaW5uYSA9IHRydWU7CiAgdC5MZXhpY29uID0gdHJ1ZTsKICB0LkxpYmVyYXRpb25TZXJpZiA9IHRydWU7CiAgdFsiTGliZXJhdGlvbiBTZXJpZiJdID0gdHJ1ZTsKICB0WyJMaW51eCBMaWJlcnRpbmUiXSA9IHRydWU7CiAgdC5MaXRlcmF0dXJuYXlhID0gdHJ1ZTsKICB0Lkx1Y2lkYSA9IHRydWU7CiAgdFsiTHVjaWRhIEJyaWdodCJdID0gdHJ1ZTsKICB0Lk1lbGlvciA9IHRydWU7CiAgdC5NZW1waGlzID0gdHJ1ZTsKICB0Lk1pbGxlciA9IHRydWU7CiAgdC5NaW5pb24gPSB0cnVlOwogIHQuTW9kZXJuID0gdHJ1ZTsKICB0WyJNb25hIExpc2EiXSA9IHRydWU7CiAgdFsiTXJzIEVhdmVzIl0gPSB0cnVlOwogIHRbIk1TIFNlcmlmIl0gPSB0cnVlOwogIHRbIk11c2VvIFNsYWIiXSA9IHRydWU7CiAgdFsiTmV3IFlvcmsiXSA9IHRydWU7CiAgdFsiTmltYnVzIFJvbWFuIl0gPSB0cnVlOwogIHRbIk5QUyBSYXdsaW5zb24gUm9hZHdheSJdID0gdHJ1ZTsKICB0Lk51cHRpYWxTY3JpcHQgPSB0cnVlOwogIHQuUGFsYXRpbm8gPSB0cnVlOwogIHQuUGVycGV0dWEgPSB0cnVlOwogIHQuUGxhbnRpbiA9IHRydWU7CiAgdFsiUGxhbnRpbiBTY2hvb2xib29rIl0gPSB0cnVlOwogIHQuUGxheWJpbGwgPSB0cnVlOwogIHRbIlBvb3IgUmljaGFyZCJdID0gdHJ1ZTsKICB0WyJSYXdsaW5zb24gUm9hZHdheSJdID0gdHJ1ZTsKICB0LlJlbmF1bHQgPSB0cnVlOwogIHQuUmVxdWllbSA9IHRydWU7CiAgdC5Sb2Nrd2VsbCA9IHRydWU7CiAgdC5Sb21hbiA9IHRydWU7CiAgdFsiUm90aXMgU2VyaWYiXSA9IHRydWU7CiAgdC5TYWJvbiA9IHRydWU7CiAgdC5TY2FsYSA9IHRydWU7CiAgdC5TZWFndWxsID0gdHJ1ZTsKICB0LlNpc3RpbmEgPSB0cnVlOwogIHQuU291dmVuaXIgPSB0cnVlOwogIHQuU1RJWCA9IHRydWU7CiAgdFsiU3RvbmUgSW5mb3JtYWwiXSA9IHRydWU7CiAgdFsiU3RvbmUgU2VyaWYiXSA9IHRydWU7CiAgdC5TeWxmYWVuID0gdHJ1ZTsKICB0LlRpbWVzID0gdHJ1ZTsKICB0LlRyYWphbiA9IHRydWU7CiAgdFsiVHJpbml0w6kiXSA9IHRydWU7CiAgdFsiVHJ1bXAgTWVkaWFldmFsIl0gPSB0cnVlOwogIHQuVXRvcGlhID0gdHJ1ZTsKICB0WyJWYWxlIFR5cGUiXSA9IHRydWU7CiAgdFsiQml0c3RyZWFtIFZlcmEiXSA9IHRydWU7CiAgdFsiVmVyYSBTZXJpZiJdID0gdHJ1ZTsKICB0LlZlcnNhaWxsZXMgPSB0cnVlOwogIHQuV2FudGVkID0gdHJ1ZTsKICB0LldlaXNzID0gdHJ1ZTsKICB0WyJXaWRlIExhdGluIl0gPSB0cnVlOwogIHQuV2luZHNvciA9IHRydWU7CiAgdC5YSVRTID0gdHJ1ZTsKfSk7CmNvbnN0IGdldFN5bWJvbHNGb250cyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuRGluZ2JhdHMgPSB0cnVlOwogIHQuU3ltYm9sID0gdHJ1ZTsKICB0LlphcGZEaW5nYmF0cyA9IHRydWU7CiAgdC5XaW5nZGluZ3MgPSB0cnVlOwogIHRbIldpbmdkaW5ncy1Cb2xkIl0gPSB0cnVlOwogIHRbIldpbmdkaW5ncy1SZWd1bGFyIl0gPSB0cnVlOwp9KTsKY29uc3QgZ2V0R2x5cGhNYXBGb3JTdGFuZGFyZEZvbnRzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdFsyXSA9IDEwOwogIHRbM10gPSAzMjsKICB0WzRdID0gMzM7CiAgdFs1XSA9IDM0OwogIHRbNl0gPSAzNTsKICB0WzddID0gMzY7CiAgdFs4XSA9IDM3OwogIHRbOV0gPSAzODsKICB0WzEwXSA9IDM5OwogIHRbMTFdID0gNDA7CiAgdFsxMl0gPSA0MTsKICB0WzEzXSA9IDQyOwogIHRbMTRdID0gNDM7CiAgdFsxNV0gPSA0NDsKICB0WzE2XSA9IDQ1OwogIHRbMTddID0gNDY7CiAgdFsxOF0gPSA0NzsKICB0WzE5XSA9IDQ4OwogIHRbMjBdID0gNDk7CiAgdFsyMV0gPSA1MDsKICB0WzIyXSA9IDUxOwogIHRbMjNdID0gNTI7CiAgdFsyNF0gPSA1MzsKICB0WzI1XSA9IDU0OwogIHRbMjZdID0gNTU7CiAgdFsyN10gPSA1NjsKICB0WzI4XSA9IDU3OwogIHRbMjldID0gNTg7CiAgdFszMF0gPSA4OTQ7CiAgdFszMV0gPSA2MDsKICB0WzMyXSA9IDYxOwogIHRbMzNdID0gNjI7CiAgdFszNF0gPSA2MzsKICB0WzM1XSA9IDY0OwogIHRbMzZdID0gNjU7CiAgdFszN10gPSA2NjsKICB0WzM4XSA9IDY3OwogIHRbMzldID0gNjg7CiAgdFs0MF0gPSA2OTsKICB0WzQxXSA9IDcwOwogIHRbNDJdID0gNzE7CiAgdFs0M10gPSA3MjsKICB0WzQ0XSA9IDczOwogIHRbNDVdID0gNzQ7CiAgdFs0Nl0gPSA3NTsKICB0WzQ3XSA9IDc2OwogIHRbNDhdID0gNzc7CiAgdFs0OV0gPSA3ODsKICB0WzUwXSA9IDc5OwogIHRbNTFdID0gODA7CiAgdFs1Ml0gPSA4MTsKICB0WzUzXSA9IDgyOwogIHRbNTRdID0gODM7CiAgdFs1NV0gPSA4NDsKICB0WzU2XSA9IDg1OwogIHRbNTddID0gODY7CiAgdFs1OF0gPSA4NzsKICB0WzU5XSA9IDg4OwogIHRbNjBdID0gODk7CiAgdFs2MV0gPSA5MDsKICB0WzYyXSA9IDkxOwogIHRbNjNdID0gOTI7CiAgdFs2NF0gPSA5MzsKICB0WzY1XSA9IDk0OwogIHRbNjZdID0gOTU7CiAgdFs2N10gPSA5NjsKICB0WzY4XSA9IDk3OwogIHRbNjldID0gOTg7CiAgdFs3MF0gPSA5OTsKICB0WzcxXSA9IDEwMDsKICB0WzcyXSA9IDEwMTsKICB0WzczXSA9IDEwMjsKICB0Wzc0XSA9IDEwMzsKICB0Wzc1XSA9IDEwNDsKICB0Wzc2XSA9IDEwNTsKICB0Wzc3XSA9IDEwNjsKICB0Wzc4XSA9IDEwNzsKICB0Wzc5XSA9IDEwODsKICB0WzgwXSA9IDEwOTsKICB0WzgxXSA9IDExMDsKICB0WzgyXSA9IDExMTsKICB0WzgzXSA9IDExMjsKICB0Wzg0XSA9IDExMzsKICB0Wzg1XSA9IDExNDsKICB0Wzg2XSA9IDExNTsKICB0Wzg3XSA9IDExNjsKICB0Wzg4XSA9IDExNzsKICB0Wzg5XSA9IDExODsKICB0WzkwXSA9IDExOTsKICB0WzkxXSA9IDEyMDsKICB0WzkyXSA9IDEyMTsKICB0WzkzXSA9IDEyMjsKICB0Wzk0XSA9IDEyMzsKICB0Wzk1XSA9IDEyNDsKICB0Wzk2XSA9IDEyNTsKICB0Wzk3XSA9IDEyNjsKICB0Wzk4XSA9IDE5NjsKICB0Wzk5XSA9IDE5NzsKICB0WzEwMF0gPSAxOTk7CiAgdFsxMDFdID0gMjAxOwogIHRbMTAyXSA9IDIwOTsKICB0WzEwM10gPSAyMTQ7CiAgdFsxMDRdID0gMjIwOwogIHRbMTA1XSA9IDIyNTsKICB0WzEwNl0gPSAyMjQ7CiAgdFsxMDddID0gMjI2OwogIHRbMTA4XSA9IDIyODsKICB0WzEwOV0gPSAyMjc7CiAgdFsxMTBdID0gMjI5OwogIHRbMTExXSA9IDIzMTsKICB0WzExMl0gPSAyMzM7CiAgdFsxMTNdID0gMjMyOwogIHRbMTE0XSA9IDIzNDsKICB0WzExNV0gPSAyMzU7CiAgdFsxMTZdID0gMjM3OwogIHRbMTE3XSA9IDIzNjsKICB0WzExOF0gPSAyMzg7CiAgdFsxMTldID0gMjM5OwogIHRbMTIwXSA9IDI0MTsKICB0WzEyMV0gPSAyNDM7CiAgdFsxMjJdID0gMjQyOwogIHRbMTIzXSA9IDI0NDsKICB0WzEyNF0gPSAyNDY7CiAgdFsxMjVdID0gMjQ1OwogIHRbMTI2XSA9IDI1MDsKICB0WzEyN10gPSAyNDk7CiAgdFsxMjhdID0gMjUxOwogIHRbMTI5XSA9IDI1MjsKICB0WzEzMF0gPSA4MjI0OwogIHRbMTMxXSA9IDE3NjsKICB0WzEzMl0gPSAxNjI7CiAgdFsxMzNdID0gMTYzOwogIHRbMTM0XSA9IDE2NzsKICB0WzEzNV0gPSA4MjI2OwogIHRbMTM2XSA9IDE4MjsKICB0WzEzN10gPSAyMjM7CiAgdFsxMzhdID0gMTc0OwogIHRbMTM5XSA9IDE2OTsKICB0WzE0MF0gPSA4NDgyOwogIHRbMTQxXSA9IDE4MDsKICB0WzE0Ml0gPSAxNjg7CiAgdFsxNDNdID0gODgwMDsKICB0WzE0NF0gPSAxOTg7CiAgdFsxNDVdID0gMjE2OwogIHRbMTQ2XSA9IDg3MzQ7CiAgdFsxNDddID0gMTc3OwogIHRbMTQ4XSA9IDg4MDQ7CiAgdFsxNDldID0gODgwNTsKICB0WzE1MF0gPSAxNjU7CiAgdFsxNTFdID0gMTgxOwogIHRbMTUyXSA9IDg3MDY7CiAgdFsxNTNdID0gODcyMTsKICB0WzE1NF0gPSA4NzE5OwogIHRbMTU2XSA9IDg3NDc7CiAgdFsxNTddID0gMTcwOwogIHRbMTU4XSA9IDE4NjsKICB0WzE1OV0gPSA4NDg2OwogIHRbMTYwXSA9IDIzMDsKICB0WzE2MV0gPSAyNDg7CiAgdFsxNjJdID0gMTkxOwogIHRbMTYzXSA9IDE2MTsKICB0WzE2NF0gPSAxNzI7CiAgdFsxNjVdID0gODczMDsKICB0WzE2Nl0gPSA0MDI7CiAgdFsxNjddID0gODc3NjsKICB0WzE2OF0gPSA4NzEwOwogIHRbMTY5XSA9IDE3MTsKICB0WzE3MF0gPSAxODc7CiAgdFsxNzFdID0gODIzMDsKICB0WzE3OV0gPSA4MjIwOwogIHRbMTgwXSA9IDgyMjE7CiAgdFsxODFdID0gODIxNjsKICB0WzE4Ml0gPSA4MjE3OwogIHRbMjAwXSA9IDE5MzsKICB0WzIwM10gPSAyMDU7CiAgdFsyMDddID0gMjExOwogIHRbMjEwXSA9IDIxODsKICB0WzIyM10gPSA3MTE7CiAgdFsyMjRdID0gMzIxOwogIHRbMjI1XSA9IDMyMjsKICB0WzIyNl0gPSAzNTI7CiAgdFsyMjddID0gMzUzOwogIHRbMjI4XSA9IDM4MTsKICB0WzIyOV0gPSAzODI7CiAgdFsyMzNdID0gMjIxOwogIHRbMjM0XSA9IDI1MzsKICB0WzI1Ml0gPSAyNjM7CiAgdFsyNTNdID0gMjY4OwogIHRbMjU0XSA9IDI2OTsKICB0WzI1OF0gPSAyNTg7CiAgdFsyNjBdID0gMjYwOwogIHRbMjYxXSA9IDI2MTsKICB0WzI2NV0gPSAyODA7CiAgdFsyNjZdID0gMjgxOwogIHRbMjY3XSA9IDI4MjsKICB0WzI2OF0gPSAyODM7CiAgdFsyNjldID0gMzEzOwogIHRbMjc1XSA9IDMyMzsKICB0WzI3Nl0gPSAzMjQ7CiAgdFsyNzhdID0gMzI4OwogIHRbMjgzXSA9IDM0NDsKICB0WzI4NF0gPSAzNDU7CiAgdFsyODVdID0gMzQ2OwogIHRbMjg2XSA9IDM0NzsKICB0WzI5Ml0gPSAzNjc7CiAgdFsyOTVdID0gMzc3OwogIHRbMjk2XSA9IDM3ODsKICB0WzI5OF0gPSAzODA7CiAgdFszMDVdID0gOTYzOwogIHRbMzA2XSA9IDk2NDsKICB0WzMwN10gPSA5NjY7CiAgdFszMDhdID0gODIxNTsKICB0WzMwOV0gPSA4MjUyOwogIHRbMzEwXSA9IDgzMTk7CiAgdFszMTFdID0gODM1OTsKICB0WzMxMl0gPSA4NTkyOwogIHRbMzEzXSA9IDg1OTM7CiAgdFszMzddID0gOTU1MjsKICB0WzQ5M10gPSAxMDM5OwogIHRbNDk0XSA9IDEwNDA7CiAgdFs1NzBdID0gMTA0MDsKICB0WzU3MV0gPSAxMDQxOwogIHRbNTcyXSA9IDEwNDI7CiAgdFs1NzNdID0gMTA0MzsKICB0WzU3NF0gPSAxMDQ0OwogIHRbNTc1XSA9IDEwNDU7CiAgdFs1NzZdID0gMTA0NjsKICB0WzU3N10gPSAxMDQ3OwogIHRbNTc4XSA9IDEwNDg7CiAgdFs1NzldID0gMTA0OTsKICB0WzU4MF0gPSAxMDUwOwogIHRbNTgxXSA9IDEwNTE7CiAgdFs1ODJdID0gMTA1MjsKICB0WzU4M10gPSAxMDUzOwogIHRbNTg0XSA9IDEwNTQ7CiAgdFs1ODVdID0gMTA1NTsKICB0WzU4Nl0gPSAxMDU2OwogIHRbNTg3XSA9IDEwNTc7CiAgdFs1ODhdID0gMTA1ODsKICB0WzU4OV0gPSAxMDU5OwogIHRbNTkwXSA9IDEwNjA7CiAgdFs1OTFdID0gMTA2MTsKICB0WzU5Ml0gPSAxMDYyOwogIHRbNTkzXSA9IDEwNjM7CiAgdFs1OTRdID0gMTA2NDsKICB0WzU5NV0gPSAxMDY1OwogIHRbNTk2XSA9IDEwNjY7CiAgdFs1OTddID0gMTA2NzsKICB0WzU5OF0gPSAxMDY4OwogIHRbNTk5XSA9IDEwNjk7CiAgdFs2MDBdID0gMTA3MDsKICB0WzY3Ml0gPSAxNDg4OwogIHRbNjczXSA9IDE0ODk7CiAgdFs2NzRdID0gMTQ5MDsKICB0WzY3NV0gPSAxNDkxOwogIHRbNjc2XSA9IDE0OTI7CiAgdFs2NzddID0gMTQ5MzsKICB0WzY3OF0gPSAxNDk0OwogIHRbNjc5XSA9IDE0OTU7CiAgdFs2ODBdID0gMTQ5NjsKICB0WzY4MV0gPSAxNDk3OwogIHRbNjgyXSA9IDE0OTg7CiAgdFs2ODNdID0gMTQ5OTsKICB0WzY4NF0gPSAxNTAwOwogIHRbNjg1XSA9IDE1MDE7CiAgdFs2ODZdID0gMTUwMjsKICB0WzY4N10gPSAxNTAzOwogIHRbNjg4XSA9IDE1MDQ7CiAgdFs2ODldID0gMTUwNTsKICB0WzY5MF0gPSAxNTA2OwogIHRbNjkxXSA9IDE1MDc7CiAgdFs2OTJdID0gMTUwODsKICB0WzY5M10gPSAxNTA5OwogIHRbNjk0XSA9IDE1MTA7CiAgdFs2OTVdID0gMTUxMTsKICB0WzY5Nl0gPSAxNTEyOwogIHRbNjk3XSA9IDE1MTM7CiAgdFs2OThdID0gMTUxNDsKICB0WzcwNV0gPSAxNTI0OwogIHRbNzA2XSA9IDgzNjI7CiAgdFs3MTBdID0gNjQyODg7CiAgdFs3MTFdID0gNjQyOTg7CiAgdFs3NTldID0gMTYxNzsKICB0Wzc2MV0gPSAxNzc2OwogIHRbNzYzXSA9IDE3Nzg7CiAgdFs3NzVdID0gMTY1MjsKICB0Wzc3N10gPSAxNzY0OwogIHRbNzc4XSA9IDE3ODA7CiAgdFs3NzldID0gMTc4MTsKICB0Wzc4MF0gPSAxNzgyOwogIHRbNzgyXSA9IDc3MTsKICB0Wzc4M10gPSA2NDcyNjsKICB0Wzc4Nl0gPSA4MzYzOwogIHRbNzg4XSA9IDg1MzI7CiAgdFs3OTBdID0gNzY4OwogIHRbNzkxXSA9IDc2OTsKICB0Wzc5Ml0gPSA3Njg7CiAgdFs3OTVdID0gODAzOwogIHRbNzk3XSA9IDY0MzM2OwogIHRbNzk4XSA9IDY0MzM3OwogIHRbNzk5XSA9IDY0MzQyOwogIHRbODAwXSA9IDY0MzQzOwogIHRbODAxXSA9IDY0MzQ0OwogIHRbODAyXSA9IDY0MzQ1OwogIHRbODAzXSA9IDY0MzYyOwogIHRbODA0XSA9IDY0MzYzOwogIHRbODA1XSA9IDY0MzY0OwogIHRbMjQyNF0gPSA3ODIxOwogIHRbMjQyNV0gPSA3ODIyOwogIHRbMjQyNl0gPSA3ODIzOwogIHRbMjQyN10gPSA3ODI0OwogIHRbMjQyOF0gPSA3ODI1OwogIHRbMjQyOV0gPSA3ODI2OwogIHRbMjQzMF0gPSA3ODI3OwogIHRbMjQzM10gPSA3NjgyOwogIHRbMjY3OF0gPSA4MDQ1OwogIHRbMjY3OV0gPSA4MDQ2OwogIHRbMjgzMF0gPSAxNTUyOwogIHRbMjgzOF0gPSA2ODY7CiAgdFsyODQwXSA9IDc1MTsKICB0WzI4NDJdID0gNzUzOwogIHRbMjg0M10gPSA3NTQ7CiAgdFsyODQ0XSA9IDc1NTsKICB0WzI4NDZdID0gNzU3OwogIHRbMjg1Nl0gPSA3Njc7CiAgdFsyODU3XSA9IDg0ODsKICB0WzI4NThdID0gODQ5OwogIHRbMjg2Ml0gPSA4NTM7CiAgdFsyODYzXSA9IDg1NDsKICB0WzI4NjRdID0gODU1OwogIHRbMjg2NV0gPSA4NjE7CiAgdFsyODY2XSA9IDg2MjsKICB0WzI5MDZdID0gNzQ2MDsKICB0WzI5MDhdID0gNzQ2MjsKICB0WzI5MDldID0gNzQ2MzsKICB0WzI5MTBdID0gNzQ2NDsKICB0WzI5MTJdID0gNzQ2NjsKICB0WzI5MTNdID0gNzQ2NzsKICB0WzI5MTRdID0gNzQ2ODsKICB0WzI5MTZdID0gNzQ3MDsKICB0WzI5MTddID0gNzQ3MTsKICB0WzI5MThdID0gNzQ3MjsKICB0WzI5MjBdID0gNzQ3NDsKICB0WzI5MjFdID0gNzQ3NTsKICB0WzI5MjJdID0gNzQ3NjsKICB0WzI5MjRdID0gNzQ3ODsKICB0WzI5MjVdID0gNzQ3OTsKICB0WzI5MjZdID0gNzQ4MDsKICB0WzI5MjhdID0gNzQ4MjsKICB0WzI5MjldID0gNzQ4MzsKICB0WzI5MzBdID0gNzQ4NDsKICB0WzI5MzJdID0gNzQ4NjsKICB0WzI5MzNdID0gNzQ4NzsKICB0WzI5MzRdID0gNzQ4ODsKICB0WzI5MzZdID0gNzQ5MDsKICB0WzI5MzddID0gNzQ5MTsKICB0WzI5MzhdID0gNzQ5MjsKICB0WzI5NDBdID0gNzQ5NDsKICB0WzI5NDFdID0gNzQ5NTsKICB0WzI5NDJdID0gNzQ5NjsKICB0WzI5NDRdID0gNzQ5ODsKICB0WzI5NDZdID0gNzUwMDsKICB0WzI5NDhdID0gNzUwMjsKICB0WzI5NTBdID0gNzUwNDsKICB0WzI5NTFdID0gNzUwNTsKICB0WzI5NTJdID0gNzUwNjsKICB0WzI5NTRdID0gNzUwODsKICB0WzI5NTVdID0gNzUwOTsKICB0WzI5NTZdID0gNzUxMDsKICB0WzI5NThdID0gNzUxMjsKICB0WzI5NTldID0gNzUxMzsKICB0WzI5NjBdID0gNzUxNDsKICB0WzI5NjJdID0gNzUxNjsKICB0WzI5NjNdID0gNzUxNzsKICB0WzI5NjRdID0gNzUxODsKICB0WzI5NjZdID0gNzUyMDsKICB0WzI5NjddID0gNzUyMTsKICB0WzI5NjhdID0gNzUyMjsKICB0WzI5NzBdID0gNzUyNDsKICB0WzI5NzFdID0gNzUyNTsKICB0WzI5NzJdID0gNzUyNjsKICB0WzI5NzRdID0gNzUyODsKICB0WzI5NzVdID0gNzUyOTsKICB0WzI5NzZdID0gNzUzMDsKICB0WzI5NzhdID0gMTUzNzsKICB0WzI5NzldID0gMTUzODsKICB0WzI5ODBdID0gMTUzOTsKICB0WzI5ODJdID0gMTU0OTsKICB0WzI5ODNdID0gMTU1MTsKICB0WzI5ODRdID0gMTU1MjsKICB0WzI5ODZdID0gMTU1NDsKICB0WzI5ODddID0gMTU1NTsKICB0WzI5ODhdID0gMTU1NjsKICB0WzI5OTBdID0gMTYyMzsKICB0WzI5OTFdID0gMTYyNDsKICB0WzI5OTVdID0gMTc3NTsKICB0WzI5OTldID0gMTc5MTsKICB0WzMwMDJdID0gNjQyOTA7CiAgdFszMDAzXSA9IDY0MjkxOwogIHRbMzAwNF0gPSA2NDI5MjsKICB0WzMwMDZdID0gNjQyOTQ7CiAgdFszMDA3XSA9IDY0Mjk1OwogIHRbMzAwOF0gPSA2NDI5NjsKICB0WzMwMTFdID0gMTkwMDsKICB0WzMwMTRdID0gODIyMzsKICB0WzMwMTVdID0gODI0NDsKICB0WzMwMTddID0gNzUzMjsKICB0WzMwMThdID0gNzUzMzsKICB0WzMwMTldID0gNzUzNDsKICB0WzMwNzVdID0gNzU5MDsKICB0WzMwNzZdID0gNzU5MTsKICB0WzMwNzldID0gNzU5NDsKICB0WzMwODBdID0gNzU5NTsKICB0WzMwODNdID0gNzU5ODsKICB0WzMwODRdID0gNzU5OTsKICB0WzMwODddID0gNzYwMjsKICB0WzMwODhdID0gNzYwMzsKICB0WzMwOTFdID0gNzYwNjsKICB0WzMwOTJdID0gNzYwNzsKICB0WzMwOTVdID0gNzYxMDsKICB0WzMwOTZdID0gNzYxMTsKICB0WzMwOTldID0gNzYxNDsKICB0WzMxMDBdID0gNzYxNTsKICB0WzMxMDNdID0gNzYxODsKICB0WzMxMDRdID0gNzYxOTsKICB0WzMxMDddID0gODMzNzsKICB0WzMxMDhdID0gODMzODsKICB0WzMxMTZdID0gMTg4NDsKICB0WzMxMTldID0gMTg4NTsKICB0WzMxMjBdID0gMTg4NTsKICB0WzMxMjNdID0gMTg4NjsKICB0WzMxMjRdID0gMTg4NjsKICB0WzMxMjddID0gMTg4NzsKICB0WzMxMjhdID0gMTg4NzsKICB0WzMxMzFdID0gMTg4ODsKICB0WzMxMzJdID0gMTg4ODsKICB0WzMxMzVdID0gMTg4OTsKICB0WzMxMzZdID0gMTg4OTsKICB0WzMxMzldID0gMTg5MDsKICB0WzMxNDBdID0gMTg5MDsKICB0WzMxNDNdID0gMTg5MTsKICB0WzMxNDRdID0gMTg5MTsKICB0WzMxNDddID0gMTg5MjsKICB0WzMxNDhdID0gMTg5MjsKICB0WzMxNTNdID0gNTgwOwogIHRbMzE1NF0gPSA1ODE7CiAgdFszMTU3XSA9IDU4NDsKICB0WzMxNThdID0gNTg1OwogIHRbMzE2MV0gPSA1ODg7CiAgdFszMTYyXSA9IDU4OTsKICB0WzMxNjVdID0gODkxOwogIHRbMzE2Nl0gPSA4OTI7CiAgdFszMTY5XSA9IDEyNzQ7CiAgdFszMTcwXSA9IDEyNzU7CiAgdFszMTczXSA9IDEyNzg7CiAgdFszMTc0XSA9IDEyNzk7CiAgdFszMTgxXSA9IDc2MjI7CiAgdFszMTgyXSA9IDc2MjM7CiAgdFszMjgyXSA9IDExNzk5OwogIHRbMzMxNl0gPSA1Nzg7CiAgdFszMzc5XSA9IDQyNzg1OwogIHRbMzM5M10gPSAxMTU5OwogIHRbMzQxNl0gPSA4Mzc3Owp9KTsKY29uc3QgZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JBcmlhbEJsYWNrID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdFsyMjddID0gMzIyOwogIHRbMjY0XSA9IDI2MTsKICB0WzI5MV0gPSAzNDY7Cn0pOwpjb25zdCBnZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckNhbGlicmkgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WzFdID0gMzI7CiAgdFs0XSA9IDY1OwogIHRbNV0gPSAxOTI7CiAgdFs2XSA9IDE5MzsKICB0WzldID0gMTk2OwogIHRbMTddID0gNjY7CiAgdFsxOF0gPSA2NzsKICB0WzIxXSA9IDI2ODsKICB0WzI0XSA9IDY4OwogIHRbMjhdID0gNjk7CiAgdFsyOV0gPSAyMDA7CiAgdFszMF0gPSAyMDE7CiAgdFszMl0gPSAyODI7CiAgdFszOF0gPSA3MDsKICB0WzM5XSA9IDcxOwogIHRbNDRdID0gNzI7CiAgdFs0N10gPSA3MzsKICB0WzQ4XSA9IDIwNDsKICB0WzQ5XSA9IDIwNTsKICB0WzU4XSA9IDc0OwogIHRbNjBdID0gNzU7CiAgdFs2Ml0gPSA3NjsKICB0WzY4XSA9IDc3OwogIHRbNjldID0gNzg7CiAgdFs3NV0gPSA3OTsKICB0Wzc2XSA9IDIxMDsKICB0WzgwXSA9IDIxNDsKICB0Wzg3XSA9IDgwOwogIHRbODldID0gODE7CiAgdFs5MF0gPSA4MjsKICB0WzkyXSA9IDM0NDsKICB0Wzk0XSA9IDgzOwogIHRbOTddID0gMzUyOwogIHRbMTAwXSA9IDg0OwogIHRbMTA0XSA9IDg1OwogIHRbMTA5XSA9IDIyMDsKICB0WzExNV0gPSA4NjsKICB0WzExNl0gPSA4NzsKICB0WzEyMV0gPSA4ODsKICB0WzEyMl0gPSA4OTsKICB0WzEyNF0gPSAyMjE7CiAgdFsxMjddID0gOTA7CiAgdFsxMjldID0gMzgxOwogIHRbMjU4XSA9IDk3OwogIHRbMjU5XSA9IDIyNDsKICB0WzI2MF0gPSAyMjU7CiAgdFsyNjNdID0gMjI4OwogIHRbMjY4XSA9IDI2MTsKICB0WzI3MV0gPSA5ODsKICB0WzI3Ml0gPSA5OTsKICB0WzI3M10gPSAyNjM7CiAgdFsyNzVdID0gMjY5OwogIHRbMjgyXSA9IDEwMDsKICB0WzI4Nl0gPSAxMDE7CiAgdFsyODddID0gMjMyOwogIHRbMjg4XSA9IDIzMzsKICB0WzI5MF0gPSAyODM7CiAgdFsyOTVdID0gMjgxOwogIHRbMjk2XSA9IDEwMjsKICB0WzMzNl0gPSAxMDM7CiAgdFszNDZdID0gMTA0OwogIHRbMzQ5XSA9IDEwNTsKICB0WzM1MF0gPSAyMzY7CiAgdFszNTFdID0gMjM3OwogIHRbMzYxXSA9IDEwNjsKICB0WzM2NF0gPSAxMDc7CiAgdFszNjddID0gMTA4OwogIHRbMzcxXSA9IDMyMjsKICB0WzM3M10gPSAxMDk7CiAgdFszNzRdID0gMTEwOwogIHRbMzgxXSA9IDExMTsKICB0WzM4Ml0gPSAyNDI7CiAgdFszODNdID0gMjQzOwogIHRbMzg2XSA9IDI0NjsKICB0WzM5M10gPSAxMTI7CiAgdFszOTVdID0gMTEzOwogIHRbMzk2XSA9IDExNDsKICB0WzM5OF0gPSAzNDU7CiAgdFs0MDBdID0gMTE1OwogIHRbNDAxXSA9IDM0NzsKICB0WzQwM10gPSAzNTM7CiAgdFs0MTBdID0gMTE2OwogIHRbNDM3XSA9IDExNzsKICB0WzQ0Ml0gPSAyNTI7CiAgdFs0NDhdID0gMTE4OwogIHRbNDQ5XSA9IDExOTsKICB0WzQ1NF0gPSAxMjA7CiAgdFs0NTVdID0gMTIxOwogIHRbNDU3XSA9IDI1MzsKICB0WzQ2MF0gPSAxMjI7CiAgdFs0NjJdID0gMzgyOwogIHRbNDYzXSA9IDM4MDsKICB0Wzg1M10gPSA0NDsKICB0Wzg1NV0gPSA1ODsKICB0Wzg1Nl0gPSA0NjsKICB0Wzg3Nl0gPSA0NzsKICB0Wzg3OF0gPSA0NTsKICB0Wzg4Ml0gPSA0NTsKICB0Wzg5NF0gPSA0MDsKICB0Wzg5NV0gPSA0MTsKICB0Wzg5Nl0gPSA5MTsKICB0Wzg5N10gPSA5MzsKICB0WzkyM10gPSA2NDsKICB0Wzk0MF0gPSAxNjM7CiAgdFsxMDA0XSA9IDQ4OwogIHRbMTAwNV0gPSA0OTsKICB0WzEwMDZdID0gNTA7CiAgdFsxMDA3XSA9IDUxOwogIHRbMTAwOF0gPSA1MjsKICB0WzEwMDldID0gNTM7CiAgdFsxMDEwXSA9IDU0OwogIHRbMTAxMV0gPSA1NTsKICB0WzEwMTJdID0gNTY7CiAgdFsxMDEzXSA9IDU3OwogIHRbMTA4MV0gPSAzNzsKICB0WzEwODVdID0gNDM7CiAgdFsxMDg2XSA9IDQ1Owp9KTsKZnVuY3Rpb24gZ2V0U3RhbmRhcmRGb250TmFtZShuYW1lKSB7CiAgY29uc3QgZm9udE5hbWUgPSBub3JtYWxpemVGb250TmFtZShuYW1lKTsKICBjb25zdCBzdGRGb250TWFwID0gZ2V0U3RkRm9udE1hcCgpOwogIHJldHVybiBzdGRGb250TWFwW2ZvbnROYW1lXTsKfQpmdW5jdGlvbiBpc0tub3duRm9udE5hbWUobmFtZSkgewogIGNvbnN0IGZvbnROYW1lID0gbm9ybWFsaXplRm9udE5hbWUobmFtZSk7CiAgcmV0dXJuICEhKGdldFN0ZEZvbnRNYXAoKVtmb250TmFtZV0gfHwgZ2V0Tm9uU3RkRm9udE1hcCgpW2ZvbnROYW1lXSB8fCBnZXRTZXJpZkZvbnRzKClbZm9udE5hbWVdIHx8IGdldFN5bWJvbHNGb250cygpW2ZvbnROYW1lXSk7Cn0KCjsvLyAuL3NyYy9jb3JlL3RvX3VuaWNvZGVfbWFwLmpzCgpjbGFzcyBUb1VuaWNvZGVNYXAgewogIGNvbnN0cnVjdG9yKGNtYXAgPSBbXSkgewogICAgdGhpcy5fbWFwID0gY21hcDsKICB9CiAgZ2V0IGxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLl9tYXAubGVuZ3RoOwogIH0KICBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIHRoaXMuX21hcCkgewogICAgICBjYWxsYmFjayhjaGFyQ29kZSwgdGhpcy5fbWFwW2NoYXJDb2RlXS5jb2RlUG9pbnRBdCgwKSk7CiAgICB9CiAgfQogIGhhcyhpKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwW2ldICE9PSB1bmRlZmluZWQ7CiAgfQogIGdldChpKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwW2ldOwogIH0KICBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBpZiAobWFwLmxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIHJldHVybiBtYXAuaW5kZXhPZih2YWx1ZSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICBpZiAobWFwW2NoYXJDb2RlXSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gY2hhckNvZGUgfCAwOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIGFtZW5kKG1hcCkgewogICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBtYXApIHsKICAgICAgdGhpcy5fbWFwW2NoYXJDb2RlXSA9IG1hcFtjaGFyQ29kZV07CiAgICB9CiAgfQp9CmNsYXNzIElkZW50aXR5VG9Vbmljb2RlTWFwIHsKICBjb25zdHJ1Y3RvcihmaXJzdENoYXIsIGxhc3RDaGFyKSB7CiAgICB0aGlzLmZpcnN0Q2hhciA9IGZpcnN0Q2hhcjsKICAgIHRoaXMubGFzdENoYXIgPSBsYXN0Q2hhcjsKICB9CiAgZ2V0IGxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLmxhc3RDaGFyICsgMSAtIHRoaXMuZmlyc3RDaGFyOwogIH0KICBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICBmb3IgKGxldCBpID0gdGhpcy5maXJzdENoYXIsIGlpID0gdGhpcy5sYXN0Q2hhcjsgaSA8PSBpaTsgaSsrKSB7CiAgICAgIGNhbGxiYWNrKGksIGkpOwogICAgfQogIH0KICBoYXMoaSkgewogICAgcmV0dXJuIHRoaXMuZmlyc3RDaGFyIDw9IGkgJiYgaSA8PSB0aGlzLmxhc3RDaGFyOwogIH0KICBnZXQoaSkgewogICAgaWYgKHRoaXMuZmlyc3RDaGFyIDw9IGkgJiYgaSA8PSB0aGlzLmxhc3RDaGFyKSB7CiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgY2hhckNvZGVPZih2KSB7CiAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcih2KSAmJiB2ID49IHRoaXMuZmlyc3RDaGFyICYmIHYgPD0gdGhpcy5sYXN0Q2hhciA/IHYgOiAtMTsKICB9CiAgYW1lbmQobWFwKSB7CiAgICB1bnJlYWNoYWJsZSgiU2hvdWxkIG5vdCBjYWxsIGFtZW5kKCkiKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NmZl9mb250LmpzCgoKCmNsYXNzIENGRkZvbnQgewogIGNvbnN0cnVjdG9yKGZpbGUsIHByb3BlcnRpZXMpIHsKICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7CiAgICBjb25zdCBwYXJzZXIgPSBuZXcgQ0ZGUGFyc2VyKGZpbGUsIHByb3BlcnRpZXMsIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICB0aGlzLmNmZiA9IHBhcnNlci5wYXJzZSgpOwogICAgdGhpcy5jZmYuZHVwbGljYXRlRmlyc3RHbHlwaCgpOwogICAgY29uc3QgY29tcGlsZXIgPSBuZXcgQ0ZGQ29tcGlsZXIodGhpcy5jZmYpOwogICAgdGhpcy5zZWFjcyA9IHRoaXMuY2ZmLnNlYWNzOwogICAgdHJ5IHsKICAgICAgdGhpcy5kYXRhID0gY29tcGlsZXIuY29tcGlsZSgpOwogICAgfSBjYXRjaCB7CiAgICAgIHdhcm4oIkZhaWxlZCB0byBjb21waWxlIGZvbnQgIiArIHByb3BlcnRpZXMubG9hZGVkTmFtZSk7CiAgICAgIHRoaXMuZGF0YSA9IGZpbGU7CiAgICB9CiAgICB0aGlzLl9jcmVhdGVCdWlsdEluRW5jb2RpbmcoKTsKICB9CiAgZ2V0IG51bUdseXBocygpIHsKICAgIHJldHVybiB0aGlzLmNmZi5jaGFyU3RyaW5ncy5jb3VudDsKICB9CiAgZ2V0Q2hhcnNldCgpIHsKICAgIHJldHVybiB0aGlzLmNmZi5jaGFyc2V0LmNoYXJzZXQ7CiAgfQogIGdldEdseXBoTWFwcGluZygpIHsKICAgIGNvbnN0IGNmZiA9IHRoaXMuY2ZmOwogICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMucHJvcGVydGllczsKICAgIGNvbnN0IHsKICAgICAgY2lkVG9HaWRNYXAsCiAgICAgIGNNYXAKICAgIH0gPSBwcm9wZXJ0aWVzOwogICAgY29uc3QgY2hhcnNldHMgPSBjZmYuY2hhcnNldC5jaGFyc2V0OwogICAgbGV0IGNoYXJDb2RlVG9HbHlwaElkOwogICAgbGV0IGdseXBoSWQ7CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgbGV0IGludkNpZFRvR2lkTWFwOwogICAgICBpZiAoY2lkVG9HaWRNYXA/Lmxlbmd0aCA+IDApIHsKICAgICAgICBpbnZDaWRUb0dpZE1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2lkVG9HaWRNYXAubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgY29uc3QgZ2lkID0gY2lkVG9HaWRNYXBbaV07CiAgICAgICAgICBpZiAoZ2lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaW52Q2lkVG9HaWRNYXBbZ2lkXSA9IGk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgbGV0IGNoYXJDb2RlOwogICAgICBpZiAoY2ZmLmlzQ0lERm9udCkgewogICAgICAgIGZvciAoZ2x5cGhJZCA9IDA7IGdseXBoSWQgPCBjaGFyc2V0cy5sZW5ndGg7IGdseXBoSWQrKykgewogICAgICAgICAgY29uc3QgY2lkID0gY2hhcnNldHNbZ2x5cGhJZF07CiAgICAgICAgICBjaGFyQ29kZSA9IGNNYXAuY2hhckNvZGVPZihjaWQpOwogICAgICAgICAgaWYgKGludkNpZFRvR2lkTWFwPy5bY2hhckNvZGVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY2hhckNvZGUgPSBpbnZDaWRUb0dpZE1hcFtjaGFyQ29kZV07CiAgICAgICAgICB9CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGdseXBoSWQgPSAwOyBnbHlwaElkIDwgY2ZmLmNoYXJTdHJpbmdzLmNvdW50OyBnbHlwaElkKyspIHsKICAgICAgICAgIGNoYXJDb2RlID0gY01hcC5jaGFyQ29kZU9mKGdseXBoSWQpOwogICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYXJDb2RlVG9HbHlwaElkOwogICAgfQogICAgbGV0IGVuY29kaW5nID0gY2ZmLmVuY29kaW5nID8gY2ZmLmVuY29kaW5nLmVuY29kaW5nIDogbnVsbDsKICAgIGlmIChwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250KSB7CiAgICAgIGVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmc7CiAgICB9CiAgICBjaGFyQ29kZVRvR2x5cGhJZCA9IHR5cGUxRm9udEdseXBoTWFwcGluZyhwcm9wZXJ0aWVzLCBlbmNvZGluZywgY2hhcnNldHMpOwogICAgcmV0dXJuIGNoYXJDb2RlVG9HbHlwaElkOwogIH0KICBoYXNHbHlwaElkKGlkKSB7CiAgICByZXR1cm4gdGhpcy5jZmYuaGFzR2x5cGhJZChpZCk7CiAgfQogIF9jcmVhdGVCdWlsdEluRW5jb2RpbmcoKSB7CiAgICBjb25zdCB7CiAgICAgIGNoYXJzZXQsCiAgICAgIGVuY29kaW5nCiAgICB9ID0gdGhpcy5jZmY7CiAgICBpZiAoIWNoYXJzZXQgfHwgIWVuY29kaW5nKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGNoYXJzZXRzID0gY2hhcnNldC5jaGFyc2V0LAogICAgICBlbmNvZGluZ3MgPSBlbmNvZGluZy5lbmNvZGluZzsKICAgIGNvbnN0IG1hcCA9IFtdOwogICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBlbmNvZGluZ3MpIHsKICAgICAgY29uc3QgZ2x5cGhJZCA9IGVuY29kaW5nc1tjaGFyQ29kZV07CiAgICAgIGlmIChnbHlwaElkID49IDApIHsKICAgICAgICBjb25zdCBnbHlwaE5hbWUgPSBjaGFyc2V0c1tnbHlwaElkXTsKICAgICAgICBpZiAoZ2x5cGhOYW1lKSB7CiAgICAgICAgICBtYXBbY2hhckNvZGVdID0gZ2x5cGhOYW1lOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG1hcC5sZW5ndGggPiAwKSB7CiAgICAgIHRoaXMucHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcgPSBtYXA7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9mb250X3JlbmRlcmVyLmpzCgoKCgoKCmZ1bmN0aW9uIGdldEZsb2F0MjE0KGRhdGEsIG9mZnNldCkgewogIHJldHVybiByZWFkSW50MTYoZGF0YSwgb2Zmc2V0KSAvIDE2Mzg0Owp9CmZ1bmN0aW9uIGdldFN1YnJvdXRpbmVCaWFzKHN1YnJzKSB7CiAgY29uc3QgbnVtU3VicnMgPSBzdWJycy5sZW5ndGg7CiAgbGV0IGJpYXMgPSAzMjc2ODsKICBpZiAobnVtU3VicnMgPCAxMjQwKSB7CiAgICBiaWFzID0gMTA3OwogIH0gZWxzZSBpZiAobnVtU3VicnMgPCAzMzkwMCkgewogICAgYmlhcyA9IDExMzE7CiAgfQogIHJldHVybiBiaWFzOwp9CmZ1bmN0aW9uIHBhcnNlQ21hcChkYXRhLCBzdGFydCwgZW5kKSB7CiAgY29uc3Qgb2Zmc2V0ID0gcmVhZFVpbnQxNihkYXRhLCBzdGFydCArIDIpID09PSAxID8gcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDgpIDogcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDE2KTsKICBjb25zdCBmb3JtYXQgPSByZWFkVWludDE2KGRhdGEsIHN0YXJ0ICsgb2Zmc2V0KTsKICBsZXQgcmFuZ2VzLCBwLCBpOwogIGlmIChmb3JtYXQgPT09IDQpIHsKICAgIHJlYWRVaW50MTYoZGF0YSwgc3RhcnQgKyBvZmZzZXQgKyAyKTsKICAgIGNvbnN0IHNlZ0NvdW50ID0gcmVhZFVpbnQxNihkYXRhLCBzdGFydCArIG9mZnNldCArIDYpID4+IDE7CiAgICBwID0gc3RhcnQgKyBvZmZzZXQgKyAxNDsKICAgIHJhbmdlcyA9IFtdOwogICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICByYW5nZXNbaV0gPSB7CiAgICAgICAgZW5kOiByZWFkVWludDE2KGRhdGEsIHApCiAgICAgIH07CiAgICB9CiAgICBwICs9IDI7CiAgICBmb3IgKGkgPSAwOyBpIDwgc2VnQ291bnQ7IGkrKywgcCArPSAyKSB7CiAgICAgIHJhbmdlc1tpXS5zdGFydCA9IHJlYWRVaW50MTYoZGF0YSwgcCk7CiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgc2VnQ291bnQ7IGkrKywgcCArPSAyKSB7CiAgICAgIHJhbmdlc1tpXS5pZERlbHRhID0gcmVhZFVpbnQxNihkYXRhLCBwKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBzZWdDb3VudDsgaSsrLCBwICs9IDIpIHsKICAgICAgbGV0IGlkT2Zmc2V0ID0gcmVhZFVpbnQxNihkYXRhLCBwKTsKICAgICAgaWYgKGlkT2Zmc2V0ID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcmFuZ2VzW2ldLmlkcyA9IFtdOwogICAgICBmb3IgKGxldCBqID0gMCwgamogPSByYW5nZXNbaV0uZW5kIC0gcmFuZ2VzW2ldLnN0YXJ0ICsgMTsgaiA8IGpqOyBqKyspIHsKICAgICAgICByYW5nZXNbaV0uaWRzW2pdID0gcmVhZFVpbnQxNihkYXRhLCBwICsgaWRPZmZzZXQpOwogICAgICAgIGlkT2Zmc2V0ICs9IDI7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByYW5nZXM7CiAgfSBlbHNlIGlmIChmb3JtYXQgPT09IDEyKSB7CiAgICBjb25zdCBncm91cHMgPSByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgb2Zmc2V0ICsgMTIpOwogICAgcCA9IHN0YXJ0ICsgb2Zmc2V0ICsgMTY7CiAgICByYW5nZXMgPSBbXTsKICAgIGZvciAoaSA9IDA7IGkgPCBncm91cHM7IGkrKykgewogICAgICBzdGFydCA9IHJlYWRVaW50MzIoZGF0YSwgcCk7CiAgICAgIHJhbmdlcy5wdXNoKHsKICAgICAgICBzdGFydCwKICAgICAgICBlbmQ6IHJlYWRVaW50MzIoZGF0YSwgcCArIDQpLAogICAgICAgIGlkRGVsdGE6IHJlYWRVaW50MzIoZGF0YSwgcCArIDgpIC0gc3RhcnQKICAgICAgfSk7CiAgICAgIHAgKz0gMTI7CiAgICB9CiAgICByZXR1cm4gcmFuZ2VzOwogIH0KICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYHVuc3VwcG9ydGVkIGNtYXA6ICR7Zm9ybWF0fWApOwp9CmZ1bmN0aW9uIHBhcnNlQ2ZmKGRhdGEsIHN0YXJ0LCBlbmQsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICBjb25zdCBwcm9wZXJ0aWVzID0ge307CiAgY29uc3QgcGFyc2VyID0gbmV3IENGRlBhcnNlcihuZXcgU3RyZWFtKGRhdGEsIHN0YXJ0LCBlbmQgLSBzdGFydCksIHByb3BlcnRpZXMsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogIGNvbnN0IGNmZiA9IHBhcnNlci5wYXJzZSgpOwogIHJldHVybiB7CiAgICBnbHlwaHM6IGNmZi5jaGFyU3RyaW5ncy5vYmplY3RzLAogICAgc3VicnM6IGNmZi50b3BEaWN0LnByaXZhdGVEaWN0Py5zdWJyc0luZGV4Py5vYmplY3RzLAogICAgZ3N1YnJzOiBjZmYuZ2xvYmFsU3VickluZGV4Py5vYmplY3RzLAogICAgaXNDRkZDSURGb250OiBjZmYuaXNDSURGb250LAogICAgZmRTZWxlY3Q6IGNmZi5mZFNlbGVjdCwKICAgIGZkQXJyYXk6IGNmZi5mZEFycmF5CiAgfTsKfQpmdW5jdGlvbiBwYXJzZUdseWZUYWJsZShnbHlmLCBsb2NhLCBpc0dseXBoTG9jYXRpb25zTG9uZykgewogIGxldCBpdGVtU2l6ZSwgaXRlbURlY29kZTsKICBpZiAoaXNHbHlwaExvY2F0aW9uc0xvbmcpIHsKICAgIGl0ZW1TaXplID0gNDsKICAgIGl0ZW1EZWNvZGUgPSByZWFkVWludDMyOwogIH0gZWxzZSB7CiAgICBpdGVtU2l6ZSA9IDI7CiAgICBpdGVtRGVjb2RlID0gKGRhdGEsIG9mZnNldCkgPT4gMiAqIHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICB9CiAgY29uc3QgZ2x5cGhzID0gW107CiAgbGV0IHN0YXJ0T2Zmc2V0ID0gaXRlbURlY29kZShsb2NhLCAwKTsKICBmb3IgKGxldCBqID0gaXRlbVNpemU7IGogPCBsb2NhLmxlbmd0aDsgaiArPSBpdGVtU2l6ZSkgewogICAgY29uc3QgZW5kT2Zmc2V0ID0gaXRlbURlY29kZShsb2NhLCBqKTsKICAgIGdseXBocy5wdXNoKGdseWYuc3ViYXJyYXkoc3RhcnRPZmZzZXQsIGVuZE9mZnNldCkpOwogICAgc3RhcnRPZmZzZXQgPSBlbmRPZmZzZXQ7CiAgfQogIHJldHVybiBnbHlwaHM7Cn0KZnVuY3Rpb24gbG9va3VwQ21hcChyYW5nZXMsIHVuaWNvZGUpIHsKICBjb25zdCBjb2RlID0gdW5pY29kZS5jb2RlUG9pbnRBdCgwKTsKICBsZXQgZ2lkID0gMCwKICAgIGwgPSAwLAogICAgciA9IHJhbmdlcy5sZW5ndGggLSAxOwogIHdoaWxlIChsIDwgcikgewogICAgY29uc3QgYyA9IGwgKyByICsgMSA+PiAxOwogICAgaWYgKGNvZGUgPCByYW5nZXNbY10uc3RhcnQpIHsKICAgICAgciA9IGMgLSAxOwogICAgfSBlbHNlIHsKICAgICAgbCA9IGM7CiAgICB9CiAgfQogIGlmIChyYW5nZXNbbF0uc3RhcnQgPD0gY29kZSAmJiBjb2RlIDw9IHJhbmdlc1tsXS5lbmQpIHsKICAgIGdpZCA9IHJhbmdlc1tsXS5pZERlbHRhICsgKHJhbmdlc1tsXS5pZHMgPyByYW5nZXNbbF0uaWRzW2NvZGUgLSByYW5nZXNbbF0uc3RhcnRdIDogY29kZSkgJiAweGZmZmY7CiAgfQogIHJldHVybiB7CiAgICBjaGFyQ29kZTogY29kZSwKICAgIGdseXBoSWQ6IGdpZAogIH07Cn0KZnVuY3Rpb24gY29tcGlsZUdseWYoY29kZSwgY21kcywgZm9udCkgewogIGZ1bmN0aW9uIG1vdmVUbyh4LCB5KSB7CiAgICBpZiAoZmlyc3RQb2ludCkgewogICAgICBjbWRzLmFkZCgiTCIsIGZpcnN0UG9pbnQpOwogICAgfQogICAgZmlyc3RQb2ludCA9IFt4LCB5XTsKICAgIGNtZHMuYWRkKCJNIiwgW3gsIHldKTsKICB9CiAgZnVuY3Rpb24gbGluZVRvKHgsIHkpIHsKICAgIGNtZHMuYWRkKCJMIiwgW3gsIHldKTsKICB9CiAgZnVuY3Rpb24gcXVhZHJhdGljQ3VydmVUbyh4YSwgeWEsIHgsIHkpIHsKICAgIGNtZHMuYWRkKCJRIiwgW3hhLCB5YSwgeCwgeV0pOwogIH0KICBsZXQgaSA9IDA7CiAgY29uc3QgbnVtYmVyT2ZDb250b3VycyA9IHJlYWRJbnQxNihjb2RlLCBpKTsKICBsZXQgZmxhZ3M7CiAgbGV0IGZpcnN0UG9pbnQgPSBudWxsOwogIGxldCB4ID0gMCwKICAgIHkgPSAwOwogIGkgKz0gMTA7CiAgaWYgKG51bWJlck9mQ29udG91cnMgPCAwKSB7CiAgICBkbyB7CiAgICAgIGZsYWdzID0gcmVhZFVpbnQxNihjb2RlLCBpKTsKICAgICAgY29uc3QgZ2x5cGhJbmRleCA9IHJlYWRVaW50MTYoY29kZSwgaSArIDIpOwogICAgICBpICs9IDQ7CiAgICAgIGxldCBhcmcxLCBhcmcyOwogICAgICBpZiAoZmxhZ3MgJiAweDAxKSB7CiAgICAgICAgaWYgKGZsYWdzICYgMHgwMikgewogICAgICAgICAgYXJnMSA9IHJlYWRJbnQxNihjb2RlLCBpKTsKICAgICAgICAgIGFyZzIgPSByZWFkSW50MTYoY29kZSwgaSArIDIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhcmcxID0gcmVhZFVpbnQxNihjb2RlLCBpKTsKICAgICAgICAgIGFyZzIgPSByZWFkVWludDE2KGNvZGUsIGkgKyAyKTsKICAgICAgICB9CiAgICAgICAgaSArPSA0OwogICAgICB9IGVsc2UgaWYgKGZsYWdzICYgMHgwMikgewogICAgICAgIGFyZzEgPSByZWFkSW50OChjb2RlLCBpKyspOwogICAgICAgIGFyZzIgPSByZWFkSW50OChjb2RlLCBpKyspOwogICAgICB9IGVsc2UgewogICAgICAgIGFyZzEgPSBjb2RlW2krK107CiAgICAgICAgYXJnMiA9IGNvZGVbaSsrXTsKICAgICAgfQogICAgICBpZiAoZmxhZ3MgJiAweDAyKSB7CiAgICAgICAgeCA9IGFyZzE7CiAgICAgICAgeSA9IGFyZzI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeCA9IDA7CiAgICAgICAgeSA9IDA7CiAgICAgIH0KICAgICAgbGV0IHNjYWxlWCA9IDEsCiAgICAgICAgc2NhbGVZID0gMSwKICAgICAgICBzY2FsZTAxID0gMCwKICAgICAgICBzY2FsZTEwID0gMDsKICAgICAgaWYgKGZsYWdzICYgMHgwOCkgewogICAgICAgIHNjYWxlWCA9IHNjYWxlWSA9IGdldEZsb2F0MjE0KGNvZGUsIGkpOwogICAgICAgIGkgKz0gMjsKICAgICAgfSBlbHNlIGlmIChmbGFncyAmIDB4NDApIHsKICAgICAgICBzY2FsZVggPSBnZXRGbG9hdDIxNChjb2RlLCBpKTsKICAgICAgICBzY2FsZVkgPSBnZXRGbG9hdDIxNChjb2RlLCBpICsgMik7CiAgICAgICAgaSArPSA0OwogICAgICB9IGVsc2UgaWYgKGZsYWdzICYgMHg4MCkgewogICAgICAgIHNjYWxlWCA9IGdldEZsb2F0MjE0KGNvZGUsIGkpOwogICAgICAgIHNjYWxlMDEgPSBnZXRGbG9hdDIxNChjb2RlLCBpICsgMik7CiAgICAgICAgc2NhbGUxMCA9IGdldEZsb2F0MjE0KGNvZGUsIGkgKyA0KTsKICAgICAgICBzY2FsZVkgPSBnZXRGbG9hdDIxNChjb2RlLCBpICsgNik7CiAgICAgICAgaSArPSA4OwogICAgICB9CiAgICAgIGNvbnN0IHN1YmdseXBoID0gZm9udC5nbHlwaHNbZ2x5cGhJbmRleF07CiAgICAgIGlmIChzdWJnbHlwaCkgewogICAgICAgIGNtZHMuc2F2ZSgpOwogICAgICAgIGNtZHMudHJhbnNmb3JtKFtzY2FsZVgsIHNjYWxlMDEsIHNjYWxlMTAsIHNjYWxlWSwgeCwgeV0pOwogICAgICAgIGlmICghKGZsYWdzICYgMHgwMikpIHt9CiAgICAgICAgY29tcGlsZUdseWYoc3ViZ2x5cGgsIGNtZHMsIGZvbnQpOwogICAgICAgIGNtZHMucmVzdG9yZSgpOwogICAgICB9CiAgICB9IHdoaWxlIChmbGFncyAmIDB4MjApOwogIH0gZWxzZSB7CiAgICBjb25zdCBlbmRQdHNPZkNvbnRvdXJzID0gW107CiAgICBsZXQgaiwgamo7CiAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZDb250b3VyczsgaisrKSB7CiAgICAgIGVuZFB0c09mQ29udG91cnMucHVzaChyZWFkVWludDE2KGNvZGUsIGkpKTsKICAgICAgaSArPSAyOwogICAgfQogICAgY29uc3QgaW5zdHJ1Y3Rpb25MZW5ndGggPSByZWFkVWludDE2KGNvZGUsIGkpOwogICAgaSArPSAyICsgaW5zdHJ1Y3Rpb25MZW5ndGg7CiAgICBjb25zdCBudW1iZXJPZlBvaW50cyA9IGVuZFB0c09mQ29udG91cnMuYXQoLTEpICsgMTsKICAgIGNvbnN0IHBvaW50cyA9IFtdOwogICAgd2hpbGUgKHBvaW50cy5sZW5ndGggPCBudW1iZXJPZlBvaW50cykgewogICAgICBmbGFncyA9IGNvZGVbaSsrXTsKICAgICAgbGV0IHJlcGVhdCA9IDE7CiAgICAgIGlmIChmbGFncyAmIDB4MDgpIHsKICAgICAgICByZXBlYXQgKz0gY29kZVtpKytdOwogICAgICB9CiAgICAgIHdoaWxlIChyZXBlYXQtLSA+IDApIHsKICAgICAgICBwb2ludHMucHVzaCh7CiAgICAgICAgICBmbGFncwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZQb2ludHM7IGorKykgewogICAgICBzd2l0Y2ggKHBvaW50c1tqXS5mbGFncyAmIDB4MTIpIHsKICAgICAgICBjYXNlIDB4MDA6CiAgICAgICAgICB4ICs9IHJlYWRJbnQxNihjb2RlLCBpKTsKICAgICAgICAgIGkgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgwMjoKICAgICAgICAgIHggLT0gY29kZVtpKytdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDEyOgogICAgICAgICAgeCArPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBwb2ludHNbal0ueCA9IHg7CiAgICB9CiAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZQb2ludHM7IGorKykgewogICAgICBzd2l0Y2ggKHBvaW50c1tqXS5mbGFncyAmIDB4MjQpIHsKICAgICAgICBjYXNlIDB4MDA6CiAgICAgICAgICB5ICs9IHJlYWRJbnQxNihjb2RlLCBpKTsKICAgICAgICAgIGkgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgwNDoKICAgICAgICAgIHkgLT0gY29kZVtpKytdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDI0OgogICAgICAgICAgeSArPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBwb2ludHNbal0ueSA9IHk7CiAgICB9CiAgICBsZXQgc3RhcnRQb2ludCA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgbnVtYmVyT2ZDb250b3VyczsgaSsrKSB7CiAgICAgIGNvbnN0IGVuZFBvaW50ID0gZW5kUHRzT2ZDb250b3Vyc1tpXTsKICAgICAgY29uc3QgY29udG91ciA9IHBvaW50cy5zbGljZShzdGFydFBvaW50LCBlbmRQb2ludCArIDEpOwogICAgICBpZiAoY29udG91clswXS5mbGFncyAmIDEpIHsKICAgICAgICBjb250b3VyLnB1c2goY29udG91clswXSk7CiAgICAgIH0gZWxzZSBpZiAoY29udG91ci5hdCgtMSkuZmxhZ3MgJiAxKSB7CiAgICAgICAgY29udG91ci51bnNoaWZ0KGNvbnRvdXIuYXQoLTEpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgZmxhZ3M6IDEsCiAgICAgICAgICB4OiAoY29udG91clswXS54ICsgY29udG91ci5hdCgtMSkueCkgLyAyLAogICAgICAgICAgeTogKGNvbnRvdXJbMF0ueSArIGNvbnRvdXIuYXQoLTEpLnkpIC8gMgogICAgICAgIH07CiAgICAgICAgY29udG91ci51bnNoaWZ0KHApOwogICAgICAgIGNvbnRvdXIucHVzaChwKTsKICAgICAgfQogICAgICBtb3ZlVG8oY29udG91clswXS54LCBjb250b3VyWzBdLnkpOwogICAgICBmb3IgKGogPSAxLCBqaiA9IGNvbnRvdXIubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgIGlmIChjb250b3VyW2pdLmZsYWdzICYgMSkgewogICAgICAgICAgbGluZVRvKGNvbnRvdXJbal0ueCwgY29udG91cltqXS55KTsKICAgICAgICB9IGVsc2UgaWYgKGNvbnRvdXJbaiArIDFdLmZsYWdzICYgMSkgewogICAgICAgICAgcXVhZHJhdGljQ3VydmVUbyhjb250b3VyW2pdLngsIGNvbnRvdXJbal0ueSwgY29udG91cltqICsgMV0ueCwgY29udG91cltqICsgMV0ueSk7CiAgICAgICAgICBqKys7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1YWRyYXRpY0N1cnZlVG8oY29udG91cltqXS54LCBjb250b3VyW2pdLnksIChjb250b3VyW2pdLnggKyBjb250b3VyW2ogKyAxXS54KSAvIDIsIChjb250b3VyW2pdLnkgKyBjb250b3VyW2ogKyAxXS55KSAvIDIpOwogICAgICAgIH0KICAgICAgfQogICAgICBzdGFydFBvaW50ID0gZW5kUG9pbnQgKyAxOwogICAgfQogIH0KfQpmdW5jdGlvbiBjb21waWxlQ2hhclN0cmluZyhjaGFyU3RyaW5nQ29kZSwgY21kcywgZm9udCwgZ2x5cGhJZCkgewogIGZ1bmN0aW9uIG1vdmVUbyh4LCB5KSB7CiAgICBpZiAoZmlyc3RQb2ludCkgewogICAgICBjbWRzLmFkZCgiTCIsIGZpcnN0UG9pbnQpOwogICAgfQogICAgZmlyc3RQb2ludCA9IFt4LCB5XTsKICAgIGNtZHMuYWRkKCJNIiwgW3gsIHldKTsKICB9CiAgZnVuY3Rpb24gbGluZVRvKHgsIHkpIHsKICAgIGNtZHMuYWRkKCJMIiwgW3gsIHldKTsKICB9CiAgZnVuY3Rpb24gYmV6aWVyQ3VydmVUbyh4MSwgeTEsIHgyLCB5MiwgeCwgeSkgewogICAgY21kcy5hZGQoIkMiLCBbeDEsIHkxLCB4MiwgeTIsIHgsIHldKTsKICB9CiAgY29uc3Qgc3RhY2sgPSBbXTsKICBsZXQgeCA9IDAsCiAgICB5ID0gMDsKICBsZXQgc3RlbXMgPSAwOwogIGxldCBmaXJzdFBvaW50ID0gbnVsbDsKICBmdW5jdGlvbiBwYXJzZShjb2RlKSB7CiAgICBsZXQgaSA9IDA7CiAgICB3aGlsZSAoaSA8IGNvZGUubGVuZ3RoKSB7CiAgICAgIGxldCBzdGFja0NsZWFuID0gZmFsc2U7CiAgICAgIGxldCB2ID0gY29kZVtpKytdOwogICAgICBsZXQgeGEsIHhiLCB5YSwgeWIsIHkxLCB5MiwgeTMsIG4sIHN1YnJDb2RlOwogICAgICBzd2l0Y2ggKHYpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNDoKICAgICAgICAgIHkgKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICBtb3ZlVG8oeCwgeSk7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNToKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDY6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA3OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgODoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDEwOgogICAgICAgICAgbiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3VickNvZGUgPSBudWxsOwogICAgICAgICAgaWYgKGZvbnQuaXNDRkZDSURGb250KSB7CiAgICAgICAgICAgIGNvbnN0IGZkSW5kZXggPSBmb250LmZkU2VsZWN0LmdldEZESW5kZXgoZ2x5cGhJZCk7CiAgICAgICAgICAgIGlmIChmZEluZGV4ID49IDAgJiYgZmRJbmRleCA8IGZvbnQuZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICAgICAgICBjb25zdCBmb250RGljdCA9IGZvbnQuZmRBcnJheVtmZEluZGV4XTsKICAgICAgICAgICAgICBsZXQgc3VicnM7CiAgICAgICAgICAgICAgaWYgKGZvbnREaWN0LnByaXZhdGVEaWN0Py5zdWJyc0luZGV4KSB7CiAgICAgICAgICAgICAgICBzdWJycyA9IGZvbnREaWN0LnByaXZhdGVEaWN0LnN1YnJzSW5kZXgub2JqZWN0czsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHN1YnJzKSB7CiAgICAgICAgICAgICAgICBuICs9IGdldFN1YnJvdXRpbmVCaWFzKHN1YnJzKTsKICAgICAgICAgICAgICAgIHN1YnJDb2RlID0gc3VicnNbbl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHdhcm4oIkludmFsaWQgZmQgaW5kZXggZm9yIGdseXBoIGluZGV4LiIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdWJyQ29kZSA9IGZvbnQuc3VicnNbbiArIGZvbnQuc3VicnNCaWFzXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdWJyQ29kZSkgewogICAgICAgICAgICBwYXJzZShzdWJyQ29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDExOgogICAgICAgICAgcmV0dXJuOwogICAgICAgIGNhc2UgMTI6CiAgICAgICAgICB2ID0gY29kZVtpKytdOwogICAgICAgICAgc3dpdGNoICh2KSB7CiAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5MSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeSwgeGIsIHkxLCB4LCB5MSk7CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHkxLCB4YiwgeSwgeCwgeSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeTEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5MiA9IHkxICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHkxLCB4YiwgeTIsIHgsIHkyKTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkzID0geTIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTIsIHhiLCB5MywgeCwgeSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgY29uc3QgeDAgPSB4LAogICAgICAgICAgICAgICAgeTAgPSB5OwogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YjsKICAgICAgICAgICAgICB5ID0geWI7CiAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHggLSB4MCkgPiBNYXRoLmFicyh5IC0geTApKSB7CiAgICAgICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGB1bmtub3duIG9wZXJhdG9yOiAxMiAke3Z9YCk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE0OgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA+PSA0KSB7CiAgICAgICAgICAgIGNvbnN0IGFjaGFyID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNvbnN0IGJjaGFyID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHkgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgeCA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICBjbWRzLnNhdmUoKTsKICAgICAgICAgICAgY21kcy50cmFuc2xhdGUoeCwgeSk7CiAgICAgICAgICAgIGxldCBjbWFwID0gbG9va3VwQ21hcChmb250LmNtYXAsIFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udC5nbHlwaE5hbWVNYXBbU3RhbmRhcmRFbmNvZGluZ1thY2hhcl1dKSk7CiAgICAgICAgICAgIGNvbXBpbGVDaGFyU3RyaW5nKGZvbnQuZ2x5cGhzW2NtYXAuZ2x5cGhJZF0sIGNtZHMsIGZvbnQsIGNtYXAuZ2x5cGhJZCk7CiAgICAgICAgICAgIGNtZHMucmVzdG9yZSgpOwogICAgICAgICAgICBjbWFwID0gbG9va3VwQ21hcChmb250LmNtYXAsIFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udC5nbHlwaE5hbWVNYXBbU3RhbmRhcmRFbmNvZGluZ1tiY2hhcl1dKSk7CiAgICAgICAgICAgIGNvbXBpbGVDaGFyU3RyaW5nKGZvbnQuZ2x5cGhzW2NtYXAuZ2x5cGhJZF0sIGNtZHMsIGZvbnQsIGNtYXAuZ2x5cGhJZCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgY2FzZSAxODoKICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE5OgogICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICBpICs9IHN0ZW1zICsgNyA+PiAzOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDIwOgogICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICBpICs9IHN0ZW1zICsgNyA+PiAzOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDIxOgogICAgICAgICAgeSArPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHggKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICBtb3ZlVG8oeCwgeSk7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjI6CiAgICAgICAgICB4ICs9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbW92ZVRvKHgsIHkpOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDIzOgogICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMikgewogICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNToKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiA2KSB7CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggJSAyKSB7CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHhhID0geDsKICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGI7CiAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNzoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggJSAyKSB7CiAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHlhID0geTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWI7CiAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyODoKICAgICAgICAgIHN0YWNrLnB1c2gocmVhZEludDE2KGNvZGUsIGkpKTsKICAgICAgICAgIGkgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjk6CiAgICAgICAgICBuID0gc3RhY2sucG9wKCkgKyBmb250LmdzdWJyc0JpYXM7CiAgICAgICAgICBzdWJyQ29kZSA9IGZvbnQuZ3N1YnJzW25dOwogICAgICAgICAgaWYgKHN1YnJDb2RlKSB7CiAgICAgICAgICAgIHBhcnNlKHN1YnJDb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzA6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4YSA9IHg7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YSA9IHk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDMxOgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWEgPSB5OwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YiArIChzdGFjay5sZW5ndGggPT09IDEgPyBzdGFjay5zaGlmdCgpIDogMCk7CiAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeGEgPSB4OwogICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgPSB5YiArIChzdGFjay5sZW5ndGggPT09IDEgPyBzdGFjay5zaGlmdCgpIDogMCk7CiAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmICh2IDwgMzIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGB1bmtub3duIG9wZXJhdG9yOiAke3Z9YCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodiA8IDI0NykgewogICAgICAgICAgICBzdGFjay5wdXNoKHYgLSAxMzkpOwogICAgICAgICAgfSBlbHNlIGlmICh2IDwgMjUxKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goKHYgLSAyNDcpICogMjU2ICsgY29kZVtpKytdICsgMTA4KTsKICAgICAgICAgIH0gZWxzZSBpZiAodiA8IDI1NSkgewogICAgICAgICAgICBzdGFjay5wdXNoKC0odiAtIDI1MSkgKiAyNTYgLSBjb2RlW2krK10gLSAxMDgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaCgoY29kZVtpXSA8PCAyNCB8IGNvZGVbaSArIDFdIDw8IDE2IHwgY29kZVtpICsgMl0gPDwgOCB8IGNvZGVbaSArIDNdKSAvIDY1NTM2KTsKICAgICAgICAgICAgaSArPSA0OwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHN0YWNrQ2xlYW4pIHsKICAgICAgICBzdGFjay5sZW5ndGggPSAwOwogICAgICB9CiAgICB9CiAgfQogIHBhcnNlKGNoYXJTdHJpbmdDb2RlKTsKfQpjb25zdCBOT09QID0gIiI7CmNsYXNzIENvbW1hbmRzIHsKICBjbWRzID0gW107CiAgdHJhbnNmb3JtU3RhY2sgPSBbXTsKICBjdXJyZW50VHJhbnNmb3JtID0gWzEsIDAsIDAsIDEsIDAsIDBdOwogIGFkZChjbWQsIGFyZ3MpIHsKICAgIGlmIChhcmdzKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBjdXJyZW50VHJhbnNmb3JtCiAgICAgIH0gPSB0aGlzOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBhcmdzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICBVdGlsLmFwcGx5VHJhbnNmb3JtKGFyZ3MsIGN1cnJlbnRUcmFuc2Zvcm0sIGkpOwogICAgICB9CiAgICAgIHRoaXMuY21kcy5wdXNoKGAke2NtZH0ke2FyZ3Muam9pbigiICIpfWApOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jbWRzLnB1c2goY21kKTsKICAgIH0KICB9CiAgdHJhbnNmb3JtKHRyYW5zZikgewogICAgdGhpcy5jdXJyZW50VHJhbnNmb3JtID0gVXRpbC50cmFuc2Zvcm0odGhpcy5jdXJyZW50VHJhbnNmb3JtLCB0cmFuc2YpOwogIH0KICB0cmFuc2xhdGUoeCwgeSkgewogICAgdGhpcy50cmFuc2Zvcm0oWzEsIDAsIDAsIDEsIHgsIHldKTsKICB9CiAgc2F2ZSgpIHsKICAgIHRoaXMudHJhbnNmb3JtU3RhY2sucHVzaCh0aGlzLmN1cnJlbnRUcmFuc2Zvcm0uc2xpY2UoKSk7CiAgfQogIHJlc3RvcmUoKSB7CiAgICB0aGlzLmN1cnJlbnRUcmFuc2Zvcm0gPSB0aGlzLnRyYW5zZm9ybVN0YWNrLnBvcCgpIHx8IFsxLCAwLCAwLCAxLCAwLCAwXTsKICB9CiAgZ2V0U1ZHKCkgewogICAgcmV0dXJuIHRoaXMuY21kcy5qb2luKCIiKTsKICB9Cn0KY2xhc3MgQ29tcGlsZWRGb250IHsKICBjb25zdHJ1Y3Rvcihmb250TWF0cml4KSB7CiAgICB0aGlzLmZvbnRNYXRyaXggPSBmb250TWF0cml4OwogICAgdGhpcy5jb21waWxlZEdseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICBnZXRQYXRoSnModW5pY29kZSkgewogICAgY29uc3QgewogICAgICBjaGFyQ29kZSwKICAgICAgZ2x5cGhJZAogICAgfSA9IGxvb2t1cENtYXAodGhpcy5jbWFwLCB1bmljb2RlKTsKICAgIGxldCBmbiA9IHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF0sCiAgICAgIGNvbXBpbGVFeDsKICAgIGlmIChmbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZm4gPSB0aGlzLmNvbXBpbGVHbHlwaCh0aGlzLmdseXBoc1tnbHlwaElkXSwgZ2x5cGhJZCk7CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgZm4gPSBOT09QOwogICAgICAgIGNvbXBpbGVFeCA9IGV4OwogICAgICB9CiAgICAgIHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF0gPSBmbjsKICAgIH0KICAgIHRoaXMuY29tcGlsZWRDaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPz89IGdseXBoSWQ7CiAgICBpZiAoY29tcGlsZUV4KSB7CiAgICAgIHRocm93IGNvbXBpbGVFeDsKICAgIH0KICAgIHJldHVybiBmbjsKICB9CiAgY29tcGlsZUdseXBoKGNvZGUsIGdseXBoSWQpIHsKICAgIGlmICghY29kZT8ubGVuZ3RoIHx8IGNvZGVbMF0gPT09IDE0KSB7CiAgICAgIHJldHVybiBOT09QOwogICAgfQogICAgbGV0IGZvbnRNYXRyaXggPSB0aGlzLmZvbnRNYXRyaXg7CiAgICBpZiAodGhpcy5pc0NGRkNJREZvbnQpIHsKICAgICAgY29uc3QgZmRJbmRleCA9IHRoaXMuZmRTZWxlY3QuZ2V0RkRJbmRleChnbHlwaElkKTsKICAgICAgaWYgKGZkSW5kZXggPj0gMCAmJiBmZEluZGV4IDwgdGhpcy5mZEFycmF5Lmxlbmd0aCkgewogICAgICAgIGNvbnN0IGZvbnREaWN0ID0gdGhpcy5mZEFycmF5W2ZkSW5kZXhdOwogICAgICAgIGZvbnRNYXRyaXggPSBmb250RGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKSB8fCBGT05UX0lERU5USVRZX01BVFJJWDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJJbnZhbGlkIGZkIGluZGV4IGZvciBnbHlwaCBpbmRleC4iKTsKICAgICAgfQogICAgfQogICAgYXNzZXJ0KGlzTnVtYmVyQXJyYXkoZm9udE1hdHJpeCwgNiksICJFeHBlY3RlZCBhIHZhbGlkIGZvbnRNYXRyaXguIik7CiAgICBjb25zdCBjbWRzID0gbmV3IENvbW1hbmRzKCk7CiAgICBjbWRzLnRyYW5zZm9ybShmb250TWF0cml4LnNsaWNlKCkpOwogICAgdGhpcy5jb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMsIGdseXBoSWQpOwogICAgY21kcy5hZGQoIloiKTsKICAgIHJldHVybiBjbWRzLmdldFNWRygpOwogIH0KICBjb21waWxlR2x5cGhJbXBsKCkgewogICAgdW5yZWFjaGFibGUoIkNoaWxkcmVuIGNsYXNzZXMgc2hvdWxkIGltcGxlbWVudCB0aGlzLiIpOwogIH0KICBoYXNCdWlsdFBhdGgodW5pY29kZSkgewogICAgY29uc3QgewogICAgICBjaGFyQ29kZSwKICAgICAgZ2x5cGhJZAogICAgfSA9IGxvb2t1cENtYXAodGhpcy5jbWFwLCB1bmljb2RlKTsKICAgIHJldHVybiB0aGlzLmNvbXBpbGVkR2x5cGhzW2dseXBoSWRdICE9PSB1bmRlZmluZWQgJiYgdGhpcy5jb21waWxlZENoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSAhPT0gdW5kZWZpbmVkOwogIH0KfQpjbGFzcyBUcnVlVHlwZUNvbXBpbGVkIGV4dGVuZHMgQ29tcGlsZWRGb250IHsKICBjb25zdHJ1Y3RvcihnbHlwaHMsIGNtYXAsIGZvbnRNYXRyaXgpIHsKICAgIHN1cGVyKGZvbnRNYXRyaXggfHwgWzAuMDAwNDg4LCAwLCAwLCAwLjAwMDQ4OCwgMCwgMF0pOwogICAgdGhpcy5nbHlwaHMgPSBnbHlwaHM7CiAgICB0aGlzLmNtYXAgPSBjbWFwOwogIH0KICBjb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMpIHsKICAgIGNvbXBpbGVHbHlmKGNvZGUsIGNtZHMsIHRoaXMpOwogIH0KfQpjbGFzcyBUeXBlMkNvbXBpbGVkIGV4dGVuZHMgQ29tcGlsZWRGb250IHsKICBjb25zdHJ1Y3RvcihjZmZJbmZvLCBjbWFwLCBmb250TWF0cml4KSB7CiAgICBzdXBlcihmb250TWF0cml4IHx8IFswLjAwMSwgMCwgMCwgMC4wMDEsIDAsIDBdKTsKICAgIHRoaXMuZ2x5cGhzID0gY2ZmSW5mby5nbHlwaHM7CiAgICB0aGlzLmdzdWJycyA9IGNmZkluZm8uZ3N1YnJzIHx8IFtdOwogICAgdGhpcy5zdWJycyA9IGNmZkluZm8uc3VicnMgfHwgW107CiAgICB0aGlzLmNtYXAgPSBjbWFwOwogICAgdGhpcy5nbHlwaE5hbWVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgICB0aGlzLmdzdWJyc0JpYXMgPSBnZXRTdWJyb3V0aW5lQmlhcyh0aGlzLmdzdWJycyk7CiAgICB0aGlzLnN1YnJzQmlhcyA9IGdldFN1YnJvdXRpbmVCaWFzKHRoaXMuc3VicnMpOwogICAgdGhpcy5pc0NGRkNJREZvbnQgPSBjZmZJbmZvLmlzQ0ZGQ0lERm9udDsKICAgIHRoaXMuZmRTZWxlY3QgPSBjZmZJbmZvLmZkU2VsZWN0OwogICAgdGhpcy5mZEFycmF5ID0gY2ZmSW5mby5mZEFycmF5OwogIH0KICBjb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMsIGdseXBoSWQpIHsKICAgIGNvbXBpbGVDaGFyU3RyaW5nKGNvZGUsIGNtZHMsIHRoaXMsIGdseXBoSWQpOwogIH0KfQpjbGFzcyBGb250UmVuZGVyZXJGYWN0b3J5IHsKICBzdGF0aWMgY3JlYXRlKGZvbnQsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShmb250LmRhdGEpOwogICAgbGV0IGNtYXAsIGdseWYsIGxvY2EsIGNmZiwgaW5kZXhUb0xvY0Zvcm1hdCwgdW5pdHNQZXJFbTsKICAgIGNvbnN0IG51bVRhYmxlcyA9IHJlYWRVaW50MTYoZGF0YSwgNCk7CiAgICBmb3IgKGxldCBpID0gMCwgcCA9IDEyOyBpIDwgbnVtVGFibGVzOyBpKyssIHAgKz0gMTYpIHsKICAgICAgY29uc3QgdGFnID0gYnl0ZXNUb1N0cmluZyhkYXRhLnN1YmFycmF5KHAsIHAgKyA0KSk7CiAgICAgIGNvbnN0IG9mZnNldCA9IHJlYWRVaW50MzIoZGF0YSwgcCArIDgpOwogICAgICBjb25zdCBsZW5ndGggPSByZWFkVWludDMyKGRhdGEsIHAgKyAxMik7CiAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgY2FzZSAiY21hcCI6CiAgICAgICAgICBjbWFwID0gcGFyc2VDbWFwKGRhdGEsIG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImdseWYiOgogICAgICAgICAgZ2x5ZiA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibG9jYSI6CiAgICAgICAgICBsb2NhID0gZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJoZWFkIjoKICAgICAgICAgIHVuaXRzUGVyRW0gPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCArIDE4KTsKICAgICAgICAgIGluZGV4VG9Mb2NGb3JtYXQgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCArIDUwKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkNGRiAiOgogICAgICAgICAgY2ZmID0gcGFyc2VDZmYoZGF0YSwgb2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChnbHlmKSB7CiAgICAgIGNvbnN0IGZvbnRNYXRyaXggPSAhdW5pdHNQZXJFbSA/IGZvbnQuZm9udE1hdHJpeCA6IFsxIC8gdW5pdHNQZXJFbSwgMCwgMCwgMSAvIHVuaXRzUGVyRW0sIDAsIDBdOwogICAgICByZXR1cm4gbmV3IFRydWVUeXBlQ29tcGlsZWQocGFyc2VHbHlmVGFibGUoZ2x5ZiwgbG9jYSwgaW5kZXhUb0xvY0Zvcm1hdCksIGNtYXAsIGZvbnRNYXRyaXgpOwogICAgfQogICAgcmV0dXJuIG5ldyBUeXBlMkNvbXBpbGVkKGNmZiwgY21hcCwgZm9udC5mb250TWF0cml4KTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL21ldHJpY3MuanMKCmNvbnN0IGdldE1ldHJpY3MgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0LkNvdXJpZXIgPSA2MDA7CiAgdFsiQ291cmllci1Cb2xkIl0gPSA2MDA7CiAgdFsiQ291cmllci1Cb2xkT2JsaXF1ZSJdID0gNjAwOwogIHRbIkNvdXJpZXItT2JsaXF1ZSJdID0gNjAwOwogIHQuSGVsdmV0aWNhID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjc4OwogICAgdC5leGNsYW0gPSAyNzg7CiAgICB0LnF1b3RlZGJsID0gMzU1OwogICAgdC5udW1iZXJzaWduID0gNTU2OwogICAgdC5kb2xsYXIgPSA1NTY7CiAgICB0LnBlcmNlbnQgPSA4ODk7CiAgICB0LmFtcGVyc2FuZCA9IDY2NzsKICAgIHQucXVvdGVyaWdodCA9IDIyMjsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDM4OTsKICAgIHQucGx1cyA9IDU4NDsKICAgIHQuY29tbWEgPSAyNzg7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjc4OwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDU1NjsKICAgIHQub25lID0gNTU2OwogICAgdC50d28gPSA1NTY7CiAgICB0LnRocmVlID0gNTU2OwogICAgdC5mb3VyID0gNTU2OwogICAgdC5maXZlID0gNTU2OwogICAgdC5zaXggPSA1NTY7CiAgICB0LnNldmVuID0gNTU2OwogICAgdC5laWdodCA9IDU1NjsKICAgIHQubmluZSA9IDU1NjsKICAgIHQuY29sb24gPSAyNzg7CiAgICB0LnNlbWljb2xvbiA9IDI3ODsKICAgIHQubGVzcyA9IDU4NDsKICAgIHQuZXF1YWwgPSA1ODQ7CiAgICB0LmdyZWF0ZXIgPSA1ODQ7CiAgICB0LnF1ZXN0aW9uID0gNTU2OwogICAgdC5hdCA9IDEwMTU7CiAgICB0LkEgPSA2Njc7CiAgICB0LkIgPSA2Njc7CiAgICB0LkMgPSA3MjI7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3Nzg7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAyNzg7CiAgICB0LkogPSA1MDA7CiAgICB0LksgPSA2Njc7CiAgICB0LkwgPSA1NTY7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3Nzg7CiAgICB0LlAgPSA2Njc7CiAgICB0LlEgPSA3Nzg7CiAgICB0LlIgPSA3MjI7CiAgICB0LlMgPSA2Njc7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA5NDQ7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2Njc7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMjc4OwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDI3ODsKICAgIHQuYXNjaWljaXJjdW0gPSA0Njk7CiAgICB0LnVuZGVyc2NvcmUgPSA1NTY7CiAgICB0LnF1b3RlbGVmdCA9IDIyMjsKICAgIHQuYSA9IDU1NjsKICAgIHQuYiA9IDU1NjsKICAgIHQuYyA9IDUwMDsKICAgIHQuZCA9IDU1NjsKICAgIHQuZSA9IDU1NjsKICAgIHQuZiA9IDI3ODsKICAgIHQuZyA9IDU1NjsKICAgIHQuaCA9IDU1NjsKICAgIHQuaSA9IDIyMjsKICAgIHQuaiA9IDIyMjsKICAgIHQuayA9IDUwMDsKICAgIHQubCA9IDIyMjsKICAgIHQubSA9IDgzMzsKICAgIHQubiA9IDU1NjsKICAgIHQubyA9IDU1NjsKICAgIHQucCA9IDU1NjsKICAgIHQucSA9IDU1NjsKICAgIHQuciA9IDMzMzsKICAgIHQucyA9IDUwMDsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDU1NjsKICAgIHQudiA9IDUwMDsKICAgIHQudyA9IDcyMjsKICAgIHQueCA9IDUwMDsKICAgIHQueSA9IDUwMDsKICAgIHQueiA9IDUwMDsKICAgIHQuYnJhY2VsZWZ0ID0gMzM0OwogICAgdC5iYXIgPSAyNjA7CiAgICB0LmJyYWNlcmlnaHQgPSAzMzQ7CiAgICB0LmFzY2lpdGlsZGUgPSA1ODQ7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1NTY7CiAgICB0LnN0ZXJsaW5nID0gNTU2OwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTU2OwogICAgdC5mbG9yaW4gPSA1NTY7CiAgICB0LnNlY3Rpb24gPSA1NTY7CiAgICB0LmN1cnJlbmN5ID0gNTU2OwogICAgdC5xdW90ZXNpbmdsZSA9IDE5MTsKICAgIHQucXVvdGVkYmxsZWZ0ID0gMzMzOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTU2OwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1MDA7CiAgICB0LmZsID0gNTAwOwogICAgdC5lbmRhc2ggPSA1NTY7CiAgICB0LmRhZ2dlciA9IDU1NjsKICAgIHQuZGFnZ2VyZGJsID0gNTU2OwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI3ODsKICAgIHQucGFyYWdyYXBoID0gNTM3OwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMjIyOwogICAgdC5xdW90ZWRibGJhc2UgPSAzMzM7CiAgICB0LnF1b3RlZGJscmlnaHQgPSAzMzM7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTU2OwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNjExOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzNzA7CiAgICB0LkxzbGFzaCA9IDU1NjsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDM2NTsKICAgIHQuYWUgPSA4ODk7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyMjI7CiAgICB0Lm9zbGFzaCA9IDYxMTsKICAgIHQub2UgPSA5NDQ7CiAgICB0Lmdlcm1hbmRibHMgPSA2MTE7CiAgICB0LklkaWVyZXNpcyA9IDI3ODsKICAgIHQuZWFjdXRlID0gNTU2OwogICAgdC5hYnJldmUgPSA1NTY7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LmVjYXJvbiA9IDU1NjsKICAgIHQuWWRpZXJlc2lzID0gNjY3OwogICAgdC5kaXZpZGUgPSA1ODQ7CiAgICB0LllhY3V0ZSA9IDY2NzsKICAgIHQuQWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFhY3V0ZSA9IDU1NjsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDUwMDsKICAgIHQuc2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5lY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDU1NjsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNTU2OwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDczNzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNTAwOwogICAgdC5hcmluZyA9IDU1NjsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyMjI7CiAgICB0LmFncmF2ZSA9IDU1NjsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDU1NjsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gNTAwOwogICAgdC5zY2VkaWxsYSA9IDUwMDsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDcxOwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5BbWFjcm9uID0gNjY3OwogICAgdC5yY2Fyb24gPSAzMzM7CiAgICB0LmNjZWRpbGxhID0gNTAwOwogICAgdC5aZG90YWNjZW50ID0gNjExOwogICAgdC5UaG9ybiA9IDY2NzsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA2Njc7CiAgICB0LmRjYXJvbiA9IDY0MzsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA1NTY7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNjY3OwogICAgdC5BYnJldmUgPSA2Njc7CiAgICB0Lm11bHRpcGx5ID0gNTg0OwogICAgdC51YWN1dGUgPSA1NTY7CiAgICB0LlRjYXJvbiA9IDYxMTsKICAgIHQucGFydGlhbGRpZmYgPSA0NzY7CiAgICB0LnlkaWVyZXNpcyA9IDUwMDsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDU1NjsKICAgIHQuZWRpZXJlc2lzID0gNTU2OwogICAgdC5jYWN1dGUgPSA1MDA7CiAgICB0Lm5hY3V0ZSA9IDU1NjsKICAgIHQudW1hY3JvbiA9IDU1NjsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAyNzg7CiAgICB0LnBsdXNtaW51cyA9IDU4NDsKICAgIHQuYnJva2VuYmFyID0gMjYwOwogICAgdC5yZWdpc3RlcmVkID0gNzM3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAyNzg7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSAzMzM7CiAgICB0Lm9tYWNyb24gPSA1NTY7CiAgICB0LlphY3V0ZSA9IDYxMTsKICAgIHQuWmNhcm9uID0gNjExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDIyMjsKICAgIHQudGNhcm9uID0gMzE3OwogICAgdC5lb2dvbmVrID0gNTU2OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA2Njc7CiAgICB0LkFkaWVyZXNpcyA9IDY2NzsKICAgIHQuZWdyYXZlID0gNTU2OwogICAgdC56YWN1dGUgPSA1MDA7CiAgICB0LmlvZ29uZWsgPSAyMjI7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNTU2OwogICAgdC5hbWFjcm9uID0gNTU2OwogICAgdC5zYWN1dGUgPSA1MDA7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNTU2OwogICAgdC50d29zdXBlcmlvciA9IDMzMzsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDU1NjsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNTU2OwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA1NTY7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA4MzQ7CiAgICB0LlNjZWRpbGxhID0gNjY3OwogICAgdC5sY2Fyb24gPSAyOTk7CiAgICB0Lktjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuTGFjdXRlID0gNTU2OwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNTU2OwogICAgdC5JZ3JhdmUgPSAyNzg7CiAgICB0LkltYWNyb24gPSAyNzg7CiAgICB0LkxjYXJvbiA9IDU1NjsKICAgIHQub25laGFsZiA9IDgzNDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDU1NjsKICAgIHQubnRpbGRlID0gNTU2OwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA1NTY7CiAgICB0LmdicmV2ZSA9IDU1NjsKICAgIHQub25lcXVhcnRlciA9IDgzNDsKICAgIHQuU2Nhcm9uID0gNjY3OwogICAgdC5TY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNTU2OwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDU1NjsKICAgIHQucmFkaWNhbCA9IDQ1MzsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzMzM7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNTU2OwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuQXRpbGRlID0gNjY3OwogICAgdC5Bb2dvbmVrID0gNjY3OwogICAgdC5BcmluZyA9IDY2NzsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNTAwOwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAyNzg7CiAgICB0Lmtjb21tYWFjY2VudCA9IDUwMDsKICAgIHQubWludXMgPSA1ODQ7CiAgICB0LkljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5uY2Fyb24gPSA1NTY7CiAgICB0LnRjb21tYWFjY2VudCA9IDI3ODsKICAgIHQubG9naWNhbG5vdCA9IDU4NDsKICAgIHQub2RpZXJlc2lzID0gNTU2OwogICAgdC51ZGllcmVzaXMgPSA1NTY7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LmV0aCA9IDU1NjsKICAgIHQuemNhcm9uID0gNTAwOwogICAgdC5uY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzMzOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTU2OwogIH0pOwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNzg7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQucXVvdGVkYmwgPSA0NzQ7CiAgICB0Lm51bWJlcnNpZ24gPSA1NTY7CiAgICB0LmRvbGxhciA9IDU1NjsKICAgIHQucGVyY2VudCA9IDg4OTsKICAgIHQuYW1wZXJzYW5kID0gNzIyOwogICAgdC5xdW90ZXJpZ2h0ID0gMjc4OwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gMzg5OwogICAgdC5wbHVzID0gNTg0OwogICAgdC5jb21tYSA9IDI3ODsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNzg7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTU2OwogICAgdC5vbmUgPSA1NTY7CiAgICB0LnR3byA9IDU1NjsKICAgIHQudGhyZWUgPSA1NTY7CiAgICB0LmZvdXIgPSA1NTY7CiAgICB0LmZpdmUgPSA1NTY7CiAgICB0LnNpeCA9IDU1NjsKICAgIHQuc2V2ZW4gPSA1NTY7CiAgICB0LmVpZ2h0ID0gNTU2OwogICAgdC5uaW5lID0gNTU2OwogICAgdC5jb2xvbiA9IDMzMzsKICAgIHQuc2VtaWNvbG9uID0gMzMzOwogICAgdC5sZXNzID0gNTg0OwogICAgdC5lcXVhbCA9IDU4NDsKICAgIHQuZ3JlYXRlciA9IDU4NDsKICAgIHQucXVlc3Rpb24gPSA2MTE7CiAgICB0LmF0ID0gOTc1OwogICAgdC5BID0gNzIyOwogICAgdC5CID0gNzIyOwogICAgdC5DID0gNzIyOwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjY3OwogICAgdC5GID0gNjExOwogICAgdC5HID0gNzc4OwogICAgdC5IID0gNzIyOwogICAgdC5JID0gMjc4OwogICAgdC5KID0gNTU2OwogICAgdC5LID0gNzIyOwogICAgdC5MID0gNjExOwogICAgdC5NID0gODMzOwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzc4OwogICAgdC5QID0gNjY3OwogICAgdC5RID0gNzc4OwogICAgdC5SID0gNzIyOwogICAgdC5TID0gNjY3OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNjY3OwogICAgdC5XID0gOTQ0OwogICAgdC5YID0gNjY3OwogICAgdC5ZID0gNjY3OwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDMzMzsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAzMzM7CiAgICB0LmFzY2lpY2lyY3VtID0gNTg0OwogICAgdC51bmRlcnNjb3JlID0gNTU2OwogICAgdC5xdW90ZWxlZnQgPSAyNzg7CiAgICB0LmEgPSA1NTY7CiAgICB0LmIgPSA2MTE7CiAgICB0LmMgPSA1NTY7CiAgICB0LmQgPSA2MTE7CiAgICB0LmUgPSA1NTY7CiAgICB0LmYgPSAzMzM7CiAgICB0LmcgPSA2MTE7CiAgICB0LmggPSA2MTE7CiAgICB0LmkgPSAyNzg7CiAgICB0LmogPSAyNzg7CiAgICB0LmsgPSA1NTY7CiAgICB0LmwgPSAyNzg7CiAgICB0Lm0gPSA4ODk7CiAgICB0Lm4gPSA2MTE7CiAgICB0Lm8gPSA2MTE7CiAgICB0LnAgPSA2MTE7CiAgICB0LnEgPSA2MTE7CiAgICB0LnIgPSAzODk7CiAgICB0LnMgPSA1NTY7CiAgICB0LnQgPSAzMzM7CiAgICB0LnUgPSA2MTE7CiAgICB0LnYgPSA1NTY7CiAgICB0LncgPSA3Nzg7CiAgICB0LnggPSA1NTY7CiAgICB0LnkgPSA1NTY7CiAgICB0LnogPSA1MDA7CiAgICB0LmJyYWNlbGVmdCA9IDM4OTsKICAgIHQuYmFyID0gMjgwOwogICAgdC5icmFjZXJpZ2h0ID0gMzg5OwogICAgdC5hc2NpaXRpbGRlID0gNTg0OwogICAgdC5leGNsYW1kb3duID0gMzMzOwogICAgdC5jZW50ID0gNTU2OwogICAgdC5zdGVybGluZyA9IDU1NjsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDU1NjsKICAgIHQuZmxvcmluID0gNTU2OwogICAgdC5zZWN0aW9uID0gNTU2OwogICAgdC5jdXJyZW5jeSA9IDU1NjsKICAgIHQucXVvdGVzaW5nbGUgPSAyMzg7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDU1NjsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNjExOwogICAgdC5mbCA9IDYxMTsKICAgIHQuZW5kYXNoID0gNTU2OwogICAgdC5kYWdnZXIgPSA1NTY7CiAgICB0LmRhZ2dlcmRibCA9IDU1NjsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNzg7CiAgICB0LnBhcmFncmFwaCA9IDU1NjsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDI3ODsKICAgIHQucXVvdGVkYmxiYXNlID0gNTAwOwogICAgdC5xdW90ZWRibHJpZ2h0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDU1NjsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDYxMTsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDEwMDA7CiAgICB0Lm9yZGZlbWluaW5lID0gMzcwOwogICAgdC5Mc2xhc2ggPSA2MTE7CiAgICB0Lk9zbGFzaCA9IDc3ODsKICAgIHQuT0UgPSAxMDAwOwogICAgdC5vcmRtYXNjdWxpbmUgPSAzNjU7CiAgICB0LmFlID0gODg5OwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjc4OwogICAgdC5vc2xhc2ggPSA2MTE7CiAgICB0Lm9lID0gOTQ0OwogICAgdC5nZXJtYW5kYmxzID0gNjExOwogICAgdC5JZGllcmVzaXMgPSAyNzg7CiAgICB0LmVhY3V0ZSA9IDU1NjsKICAgIHQuYWJyZXZlID0gNTU2OwogICAgdC51aHVuZ2FydW1sYXV0ID0gNjExOwogICAgdC5lY2Fyb24gPSA1NTY7CiAgICB0LllkaWVyZXNpcyA9IDY2NzsKICAgIHQuZGl2aWRlID0gNTg0OwogICAgdC5ZYWN1dGUgPSA2Njc7CiAgICB0LkFjaXJjdW1mbGV4ID0gNzIyOwogICAgdC5hYWN1dGUgPSA1NTY7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA1NTY7CiAgICB0LnNjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuZWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA1NTY7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDYxMTsKICAgIHQuRWRpZXJlc2lzID0gNjY3OwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3Mzc7CiAgICB0LkVtYWNyb24gPSA2Njc7CiAgICB0LmNjYXJvbiA9IDU1NjsKICAgIHQuYXJpbmcgPSA1NTY7CiAgICB0Lk5jb21tYWFjY2VudCA9IDcyMjsKICAgIHQubGFjdXRlID0gMjc4OwogICAgdC5hZ3JhdmUgPSA1NTY7CiAgICB0LlRjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQ2FjdXRlID0gNzIyOwogICAgdC5hdGlsZGUgPSA1NTY7CiAgICB0LkVkb3RhY2NlbnQgPSA2Njc7CiAgICB0LnNjYXJvbiA9IDU1NjsKICAgIHQuc2NlZGlsbGEgPSA1NTY7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ5NDsKICAgIHQuUmNhcm9uID0gNzIyOwogICAgdC5HY29tbWFhY2NlbnQgPSA3Nzg7CiAgICB0LnVjaXJjdW1mbGV4ID0gNjExOwogICAgdC5hY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuQW1hY3JvbiA9IDcyMjsKICAgIHQucmNhcm9uID0gMzg5OwogICAgdC5jY2VkaWxsYSA9IDU1NjsKICAgIHQuWmRvdGFjY2VudCA9IDYxMTsKICAgIHQuVGhvcm4gPSA2Njc7CiAgICB0Lk9tYWNyb24gPSA3Nzg7CiAgICB0LlJhY3V0ZSA9IDcyMjsKICAgIHQuU2FjdXRlID0gNjY3OwogICAgdC5kY2Fyb24gPSA3NDM7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNjExOwogICAgdC50aHJlZXN1cGVyaW9yID0gMzMzOwogICAgdC5PZ3JhdmUgPSA3Nzg7CiAgICB0LkFncmF2ZSA9IDcyMjsKICAgIHQuQWJyZXZlID0gNzIyOwogICAgdC5tdWx0aXBseSA9IDU4NDsKICAgIHQudWFjdXRlID0gNjExOwogICAgdC5UY2Fyb24gPSA2MTE7CiAgICB0LnBhcnRpYWxkaWZmID0gNDk0OwogICAgdC55ZGllcmVzaXMgPSA1NTY7CiAgICB0Lk5hY3V0ZSA9IDcyMjsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hZGllcmVzaXMgPSA1NTY7CiAgICB0LmVkaWVyZXNpcyA9IDU1NjsKICAgIHQuY2FjdXRlID0gNTU2OwogICAgdC5uYWN1dGUgPSA2MTE7CiAgICB0LnVtYWNyb24gPSA2MTE7CiAgICB0Lk5jYXJvbiA9IDcyMjsKICAgIHQuSWFjdXRlID0gMjc4OwogICAgdC5wbHVzbWludXMgPSA1ODQ7CiAgICB0LmJyb2tlbmJhciA9IDI4MDsKICAgIHQucmVnaXN0ZXJlZCA9IDczNzsKICAgIHQuR2JyZXZlID0gNzc4OwogICAgdC5JZG90YWNjZW50ID0gMjc4OwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDY2NzsKICAgIHQucmFjdXRlID0gMzg5OwogICAgdC5vbWFjcm9uID0gNjExOwogICAgdC5aYWN1dGUgPSA2MTE7CiAgICB0LlpjYXJvbiA9IDYxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNzIyOwogICAgdC5sY29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LnRjYXJvbiA9IDM4OTsKICAgIHQuZW9nb25layA9IDU1NjsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNzIyOwogICAgdC5BZGllcmVzaXMgPSA3MjI7CiAgICB0LmVncmF2ZSA9IDU1NjsKICAgIHQuemFjdXRlID0gNTAwOwogICAgdC5pb2dvbmVrID0gMjc4OwogICAgdC5PYWN1dGUgPSA3Nzg7CiAgICB0Lm9hY3V0ZSA9IDYxMTsKICAgIHQuYW1hY3JvbiA9IDU1NjsKICAgIHQuc2FjdXRlID0gNTU2OwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzc4OwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDYxMTsKICAgIHQudHdvc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9kaWVyZXNpcyA9IDc3ODsKICAgIHQubXUgPSA2MTE7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDYxMTsKICAgIHQuRW9nb25layA9IDY2NzsKICAgIHQuZGNyb2F0ID0gNjExOwogICAgdC50aHJlZXF1YXJ0ZXJzID0gODM0OwogICAgdC5TY2VkaWxsYSA9IDY2NzsKICAgIHQubGNhcm9uID0gNDAwOwogICAgdC5LY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LkxhY3V0ZSA9IDYxMTsKICAgIHQudHJhZGVtYXJrID0gMTAwMDsKICAgIHQuZWRvdGFjY2VudCA9IDU1NjsKICAgIHQuSWdyYXZlID0gMjc4OwogICAgdC5JbWFjcm9uID0gMjc4OwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA4MzQ7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA2MTE7CiAgICB0Lm50aWxkZSA9IDYxMTsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjY3OwogICAgdC5lbWFjcm9uID0gNTU2OwogICAgdC5nYnJldmUgPSA2MTE7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA4MzQ7CiAgICB0LlNjYXJvbiA9IDY2NzsKICAgIHQuU2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzc4OwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDYxMTsKICAgIHQuQ2Nhcm9uID0gNzIyOwogICAgdC51Z3JhdmUgPSA2MTE7CiAgICB0LnJhZGljYWwgPSA1NDk7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzg5OwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDYxMTsKICAgIHQuUmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkF0aWxkZSA9IDcyMjsKICAgIHQuQW9nb25layA9IDcyMjsKICAgIHQuQXJpbmcgPSA3MjI7CiAgICB0Lk90aWxkZSA9IDc3ODsKICAgIHQuemRvdGFjY2VudCA9IDUwMDsKICAgIHQuRWNhcm9uID0gNjY3OwogICAgdC5Jb2dvbmVrID0gMjc4OwogICAgdC5rY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lm1pbnVzID0gNTg0OwogICAgdC5JY2lyY3VtZmxleCA9IDI3ODsKICAgIHQubmNhcm9uID0gNjExOwogICAgdC50Y29tbWFhY2NlbnQgPSAzMzM7CiAgICB0LmxvZ2ljYWxub3QgPSA1ODQ7CiAgICB0Lm9kaWVyZXNpcyA9IDYxMTsKICAgIHQudWRpZXJlc2lzID0gNjExOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNjExOwogICAgdC5ldGggPSA2MTE7CiAgICB0LnpjYXJvbiA9IDUwMDsKICAgIHQubmNvbW1hYWNjZW50ID0gNjExOwogICAgdC5vbmVzdXBlcmlvciA9IDMzMzsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDU1NjsKICB9KTsKICB0WyJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQ3NDsKICAgIHQubnVtYmVyc2lnbiA9IDU1NjsKICAgIHQuZG9sbGFyID0gNTU2OwogICAgdC5wZXJjZW50ID0gODg5OwogICAgdC5hbXBlcnNhbmQgPSA3MjI7CiAgICB0LnF1b3RlcmlnaHQgPSAyNzg7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSAzODk7CiAgICB0LnBsdXMgPSA1ODQ7CiAgICB0LmNvbW1hID0gMjc4OwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI3ODsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1NTY7CiAgICB0Lm9uZSA9IDU1NjsKICAgIHQudHdvID0gNTU2OwogICAgdC50aHJlZSA9IDU1NjsKICAgIHQuZm91ciA9IDU1NjsKICAgIHQuZml2ZSA9IDU1NjsKICAgIHQuc2l4ID0gNTU2OwogICAgdC5zZXZlbiA9IDU1NjsKICAgIHQuZWlnaHQgPSA1NTY7CiAgICB0Lm5pbmUgPSA1NTY7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA1ODQ7CiAgICB0LmVxdWFsID0gNTg0OwogICAgdC5ncmVhdGVyID0gNTg0OwogICAgdC5xdWVzdGlvbiA9IDYxMTsKICAgIHQuYXQgPSA5NzU7CiAgICB0LkEgPSA3MjI7CiAgICB0LkIgPSA3MjI7CiAgICB0LkMgPSA3MjI7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3Nzg7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAyNzg7CiAgICB0LkogPSA1NTY7CiAgICB0LksgPSA3MjI7CiAgICB0LkwgPSA2MTE7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3Nzg7CiAgICB0LlAgPSA2Njc7CiAgICB0LlEgPSA3Nzg7CiAgICB0LlIgPSA3MjI7CiAgICB0LlMgPSA2Njc7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA5NDQ7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2Njc7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1ODQ7CiAgICB0LnVuZGVyc2NvcmUgPSA1NTY7CiAgICB0LnF1b3RlbGVmdCA9IDI3ODsKICAgIHQuYSA9IDU1NjsKICAgIHQuYiA9IDYxMTsKICAgIHQuYyA9IDU1NjsKICAgIHQuZCA9IDYxMTsKICAgIHQuZSA9IDU1NjsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDYxMTsKICAgIHQuaCA9IDYxMTsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDU1NjsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDg4OTsKICAgIHQubiA9IDYxMTsKICAgIHQubyA9IDYxMTsKICAgIHQucCA9IDYxMTsKICAgIHQucSA9IDYxMTsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDU1NjsKICAgIHQudCA9IDMzMzsKICAgIHQudSA9IDYxMTsKICAgIHQudiA9IDU1NjsKICAgIHQudyA9IDc3ODsKICAgIHQueCA9IDU1NjsKICAgIHQueSA9IDU1NjsKICAgIHQueiA9IDUwMDsKICAgIHQuYnJhY2VsZWZ0ID0gMzg5OwogICAgdC5iYXIgPSAyODA7CiAgICB0LmJyYWNlcmlnaHQgPSAzODk7CiAgICB0LmFzY2lpdGlsZGUgPSA1ODQ7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1NTY7CiAgICB0LnN0ZXJsaW5nID0gNTU2OwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTU2OwogICAgdC5mbG9yaW4gPSA1NTY7CiAgICB0LnNlY3Rpb24gPSA1NTY7CiAgICB0LmN1cnJlbmN5ID0gNTU2OwogICAgdC5xdW90ZXNpbmdsZSA9IDIzODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTU2OwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA2MTE7CiAgICB0LmZsID0gNjExOwogICAgdC5lbmRhc2ggPSA1NTY7CiAgICB0LmRhZ2dlciA9IDU1NjsKICAgIHQuZGFnZ2VyZGJsID0gNTU2OwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI3ODsKICAgIHQucGFyYWdyYXBoID0gNTU2OwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMjc4OwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTU2OwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNjExOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzNzA7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDM2NTsKICAgIHQuYWUgPSA4ODk7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyNzg7CiAgICB0Lm9zbGFzaCA9IDYxMTsKICAgIHQub2UgPSA5NDQ7CiAgICB0Lmdlcm1hbmRibHMgPSA2MTE7CiAgICB0LklkaWVyZXNpcyA9IDI3ODsKICAgIHQuZWFjdXRlID0gNTU2OwogICAgdC5hYnJldmUgPSA1NTY7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA2MTE7CiAgICB0LmVjYXJvbiA9IDU1NjsKICAgIHQuWWRpZXJlc2lzID0gNjY3OwogICAgdC5kaXZpZGUgPSA1ODQ7CiAgICB0LllhY3V0ZSA9IDY2NzsKICAgIHQuQWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LmFhY3V0ZSA9IDU1NjsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDU1NjsKICAgIHQuc2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5lY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDU1NjsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNjExOwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDczNzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNTU2OwogICAgdC5hcmluZyA9IDU1NjsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyNzg7CiAgICB0LmFncmF2ZSA9IDU1NjsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDU1NjsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gNTU2OwogICAgdC5zY2VkaWxsYSA9IDU1NjsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA2MTE7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5BbWFjcm9uID0gNzIyOwogICAgdC5yY2Fyb24gPSAzODk7CiAgICB0LmNjZWRpbGxhID0gNTU2OwogICAgdC5aZG90YWNjZW50ID0gNjExOwogICAgdC5UaG9ybiA9IDY2NzsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA2Njc7CiAgICB0LmRjYXJvbiA9IDc0MzsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA2MTE7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNzIyOwogICAgdC5BYnJldmUgPSA3MjI7CiAgICB0Lm11bHRpcGx5ID0gNTg0OwogICAgdC51YWN1dGUgPSA2MTE7CiAgICB0LlRjYXJvbiA9IDYxMTsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LnlkaWVyZXNpcyA9IDU1NjsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDU1NjsKICAgIHQuZWRpZXJlc2lzID0gNTU2OwogICAgdC5jYWN1dGUgPSA1NTY7CiAgICB0Lm5hY3V0ZSA9IDYxMTsKICAgIHQudW1hY3JvbiA9IDYxMTsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAyNzg7CiAgICB0LnBsdXNtaW51cyA9IDU4NDsKICAgIHQuYnJva2VuYmFyID0gMjgwOwogICAgdC5yZWdpc3RlcmVkID0gNzM3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAyNzg7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSAzODk7CiAgICB0Lm9tYWNyb24gPSA2MTE7CiAgICB0LlphY3V0ZSA9IDYxMTsKICAgIHQuWmNhcm9uID0gNjExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDI3ODsKICAgIHQudGNhcm9uID0gMzg5OwogICAgdC5lb2dvbmVrID0gNTU2OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA3MjI7CiAgICB0LkFkaWVyZXNpcyA9IDcyMjsKICAgIHQuZWdyYXZlID0gNTU2OwogICAgdC56YWN1dGUgPSA1MDA7CiAgICB0LmlvZ29uZWsgPSAyNzg7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNjExOwogICAgdC5hbWFjcm9uID0gNTU2OwogICAgdC5zYWN1dGUgPSA1NTY7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNjExOwogICAgdC50d29zdXBlcmlvciA9IDMzMzsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDYxMTsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNjExOwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA2MTE7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA4MzQ7CiAgICB0LlNjZWRpbGxhID0gNjY3OwogICAgdC5sY2Fyb24gPSA0MDA7CiAgICB0Lktjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGFjdXRlID0gNjExOwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNTU2OwogICAgdC5JZ3JhdmUgPSAyNzg7CiAgICB0LkltYWNyb24gPSAyNzg7CiAgICB0LkxjYXJvbiA9IDYxMTsKICAgIHQub25laGFsZiA9IDgzNDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDYxMTsKICAgIHQubnRpbGRlID0gNjExOwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA1NTY7CiAgICB0LmdicmV2ZSA9IDYxMTsKICAgIHQub25lcXVhcnRlciA9IDgzNDsKICAgIHQuU2Nhcm9uID0gNjY3OwogICAgdC5TY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNjExOwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDYxMTsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzODk7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNjExOwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQXRpbGRlID0gNzIyOwogICAgdC5Bb2dvbmVrID0gNzIyOwogICAgdC5BcmluZyA9IDcyMjsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNTAwOwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAyNzg7CiAgICB0Lmtjb21tYWFjY2VudCA9IDU1NjsKICAgIHQubWludXMgPSA1ODQ7CiAgICB0LkljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5uY2Fyb24gPSA2MTE7CiAgICB0LnRjb21tYWFjY2VudCA9IDMzMzsKICAgIHQubG9naWNhbG5vdCA9IDU4NDsKICAgIHQub2RpZXJlc2lzID0gNjExOwogICAgdC51ZGllcmVzaXMgPSA2MTE7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LmV0aCA9IDYxMTsKICAgIHQuemNhcm9uID0gNTAwOwogICAgdC5uY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzMzOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTU2OwogIH0pOwogIHRbIkhlbHZldGljYS1PYmxpcXVlIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNzg7CiAgICB0LmV4Y2xhbSA9IDI3ODsKICAgIHQucXVvdGVkYmwgPSAzNTU7CiAgICB0Lm51bWJlcnNpZ24gPSA1NTY7CiAgICB0LmRvbGxhciA9IDU1NjsKICAgIHQucGVyY2VudCA9IDg4OTsKICAgIHQuYW1wZXJzYW5kID0gNjY3OwogICAgdC5xdW90ZXJpZ2h0ID0gMjIyOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gMzg5OwogICAgdC5wbHVzID0gNTg0OwogICAgdC5jb21tYSA9IDI3ODsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNzg7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTU2OwogICAgdC5vbmUgPSA1NTY7CiAgICB0LnR3byA9IDU1NjsKICAgIHQudGhyZWUgPSA1NTY7CiAgICB0LmZvdXIgPSA1NTY7CiAgICB0LmZpdmUgPSA1NTY7CiAgICB0LnNpeCA9IDU1NjsKICAgIHQuc2V2ZW4gPSA1NTY7CiAgICB0LmVpZ2h0ID0gNTU2OwogICAgdC5uaW5lID0gNTU2OwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTg0OwogICAgdC5lcXVhbCA9IDU4NDsKICAgIHQuZ3JlYXRlciA9IDU4NDsKICAgIHQucXVlc3Rpb24gPSA1NTY7CiAgICB0LmF0ID0gMTAxNTsKICAgIHQuQSA9IDY2NzsKICAgIHQuQiA9IDY2NzsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDcyMjsKICAgIHQuSSA9IDI3ODsKICAgIHQuSiA9IDUwMDsKICAgIHQuSyA9IDY2NzsKICAgIHQuTCA9IDU1NjsKICAgIHQuTSA9IDgzMzsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDY2NzsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDY2NzsKICAgIHQuVCA9IDYxMTsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDY2NzsKICAgIHQuVyA9IDk0NDsKICAgIHQuWCA9IDY2NzsKICAgIHQuWSA9IDY2NzsKICAgIHQuWiA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAyNzg7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMjc4OwogICAgdC5hc2NpaWNpcmN1bSA9IDQ2OTsKICAgIHQudW5kZXJzY29yZSA9IDU1NjsKICAgIHQucXVvdGVsZWZ0ID0gMjIyOwogICAgdC5hID0gNTU2OwogICAgdC5iID0gNTU2OwogICAgdC5jID0gNTAwOwogICAgdC5kID0gNTU2OwogICAgdC5lID0gNTU2OwogICAgdC5mID0gMjc4OwogICAgdC5nID0gNTU2OwogICAgdC5oID0gNTU2OwogICAgdC5pID0gMjIyOwogICAgdC5qID0gMjIyOwogICAgdC5rID0gNTAwOwogICAgdC5sID0gMjIyOwogICAgdC5tID0gODMzOwogICAgdC5uID0gNTU2OwogICAgdC5vID0gNTU2OwogICAgdC5wID0gNTU2OwogICAgdC5xID0gNTU2OwogICAgdC5yID0gMzMzOwogICAgdC5zID0gNTAwOwogICAgdC50ID0gMjc4OwogICAgdC51ID0gNTU2OwogICAgdC52ID0gNTAwOwogICAgdC53ID0gNzIyOwogICAgdC54ID0gNTAwOwogICAgdC55ID0gNTAwOwogICAgdC56ID0gNTAwOwogICAgdC5icmFjZWxlZnQgPSAzMzQ7CiAgICB0LmJhciA9IDI2MDsKICAgIHQuYnJhY2VyaWdodCA9IDMzNDsKICAgIHQuYXNjaWl0aWxkZSA9IDU4NDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDU1NjsKICAgIHQuc3RlcmxpbmcgPSA1NTY7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1NTY7CiAgICB0LmZsb3JpbiA9IDU1NjsKICAgIHQuc2VjdGlvbiA9IDU1NjsKICAgIHQuY3VycmVuY3kgPSA1NTY7CiAgICB0LnF1b3Rlc2luZ2xlID0gMTkxOwogICAgdC5xdW90ZWRibGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1NTY7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDUwMDsKICAgIHQuZmwgPSA1MDA7CiAgICB0LmVuZGFzaCA9IDU1NjsKICAgIHQuZGFnZ2VyID0gNTU2OwogICAgdC5kYWdnZXJkYmwgPSA1NTY7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjc4OwogICAgdC5wYXJhZ3JhcGggPSA1Mzc7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAyMjI7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxyaWdodCA9IDMzMzsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1NTY7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA2MTE7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDM3MDsKICAgIHQuTHNsYXNoID0gNTU2OwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzY1OwogICAgdC5hZSA9IDg4OTsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDIyMjsKICAgIHQub3NsYXNoID0gNjExOwogICAgdC5vZSA9IDk0NDsKICAgIHQuZ2VybWFuZGJscyA9IDYxMTsKICAgIHQuSWRpZXJlc2lzID0gMjc4OwogICAgdC5lYWN1dGUgPSA1NTY7CiAgICB0LmFicmV2ZSA9IDU1NjsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuZWNhcm9uID0gNTU2OwogICAgdC5ZZGllcmVzaXMgPSA2Njc7CiAgICB0LmRpdmlkZSA9IDU4NDsKICAgIHQuWWFjdXRlID0gNjY3OwogICAgdC5BY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWFjdXRlID0gNTU2OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTU2OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1NTY7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzM3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA1MDA7CiAgICB0LmFyaW5nID0gNTU2OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDIyMjsKICAgIHQuYWdyYXZlID0gNTU2OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTU2OwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSA1MDA7CiAgICB0LnNjZWRpbGxhID0gNTAwOwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDU1NjsKICAgIHQuYWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LkFtYWNyb24gPSA2Njc7CiAgICB0LnJjYXJvbiA9IDMzMzsKICAgIHQuY2NlZGlsbGEgPSA1MDA7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNjY3OwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDY2NzsKICAgIHQuZGNhcm9uID0gNjQzOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDU1NjsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMzMzsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA2Njc7CiAgICB0LkFicmV2ZSA9IDY2NzsKICAgIHQubXVsdGlwbHkgPSA1ODQ7CiAgICB0LnVhY3V0ZSA9IDU1NjsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTU2OwogICAgdC5lZGllcmVzaXMgPSA1NTY7CiAgICB0LmNhY3V0ZSA9IDUwMDsKICAgIHQubmFjdXRlID0gNTU2OwogICAgdC51bWFjcm9uID0gNTU2OwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDI3ODsKICAgIHQucGx1c21pbnVzID0gNTg0OwogICAgdC5icm9rZW5iYXIgPSAyNjA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3Mzc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDI3ODsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDMzMzsKICAgIHQub21hY3JvbiA9IDU1NjsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjIyOwogICAgdC50Y2Fyb24gPSAzMTc7CiAgICB0LmVvZ29uZWsgPSA1NTY7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDY2NzsKICAgIHQuQWRpZXJlc2lzID0gNjY3OwogICAgdC5lZ3JhdmUgPSA1NTY7CiAgICB0LnphY3V0ZSA9IDUwMDsKICAgIHQuaW9nb25layA9IDIyMjsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA1NTY7CiAgICB0LmFtYWNyb24gPSA1NTY7CiAgICB0LnNhY3V0ZSA9IDUwMDsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1NTY7CiAgICB0LnR3b3N1cGVyaW9yID0gMzMzOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNTU2OwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDU1NjsKICAgIHQudGhyZWVxdWFydGVycyA9IDgzNDsKICAgIHQuU2NlZGlsbGEgPSA2Njc7CiAgICB0LmxjYXJvbiA9IDI5OTsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA1NTY7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA1NTY7CiAgICB0LklncmF2ZSA9IDI3ODsKICAgIHQuSW1hY3JvbiA9IDI3ODsKICAgIHQuTGNhcm9uID0gNTU2OwogICAgdC5vbmVoYWxmID0gODM0OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNTU2OwogICAgdC5udGlsZGUgPSA1NTY7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDU1NjsKICAgIHQuZ2JyZXZlID0gNTU2OwogICAgdC5vbmVxdWFydGVyID0gODM0OwogICAgdC5TY2Fyb24gPSA2Njc7CiAgICB0LlNjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA1NTY7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNTU2OwogICAgdC5yYWRpY2FsID0gNDUzOwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDMzMzsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA1NTY7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5BdGlsZGUgPSA2Njc7CiAgICB0LkFvZ29uZWsgPSA2Njc7CiAgICB0LkFyaW5nID0gNjY3OwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA1MDA7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDI3ODsKICAgIHQua2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5taW51cyA9IDU4NDsKICAgIHQuSWNpcmN1bWZsZXggPSAyNzg7CiAgICB0Lm5jYXJvbiA9IDU1NjsKICAgIHQudGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC5sb2dpY2Fsbm90ID0gNTg0OwogICAgdC5vZGllcmVzaXMgPSA1NTY7CiAgICB0LnVkaWVyZXNpcyA9IDU1NjsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuZXRoID0gNTU2OwogICAgdC56Y2Fyb24gPSA1MDA7CiAgICB0Lm5jb21tYWFjY2VudCA9IDU1NjsKICAgIHQub25lc3VwZXJpb3IgPSAzMzM7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1NTY7CiAgfSk7CiAgdC5TeW1ib2wgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQudW5pdmVyc2FsID0gNzEzOwogICAgdC5udW1iZXJzaWduID0gNTAwOwogICAgdC5leGlzdGVudGlhbCA9IDU0OTsKICAgIHQucGVyY2VudCA9IDgzMzsKICAgIHQuYW1wZXJzYW5kID0gNzc4OwogICAgdC5zdWNodGhhdCA9IDQzOTsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3Rlcmlza21hdGggPSA1MDA7CiAgICB0LnBsdXMgPSA1NDk7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5taW51cyA9IDU0OTsKICAgIHQucGVyaW9kID0gMjUwOwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDUwMDsKICAgIHQub25lID0gNTAwOwogICAgdC50d28gPSA1MDA7CiAgICB0LnRocmVlID0gNTAwOwogICAgdC5mb3VyID0gNTAwOwogICAgdC5maXZlID0gNTAwOwogICAgdC5zaXggPSA1MDA7CiAgICB0LnNldmVuID0gNTAwOwogICAgdC5laWdodCA9IDUwMDsKICAgIHQubmluZSA9IDUwMDsKICAgIHQuY29sb24gPSAyNzg7CiAgICB0LnNlbWljb2xvbiA9IDI3ODsKICAgIHQubGVzcyA9IDU0OTsKICAgIHQuZXF1YWwgPSA1NDk7CiAgICB0LmdyZWF0ZXIgPSA1NDk7CiAgICB0LnF1ZXN0aW9uID0gNDQ0OwogICAgdC5jb25ncnVlbnQgPSA1NDk7CiAgICB0LkFscGhhID0gNzIyOwogICAgdC5CZXRhID0gNjY3OwogICAgdC5DaGkgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC5FcHNpbG9uID0gNjExOwogICAgdC5QaGkgPSA3NjM7CiAgICB0LkdhbW1hID0gNjAzOwogICAgdC5FdGEgPSA3MjI7CiAgICB0LklvdGEgPSAzMzM7CiAgICB0LnRoZXRhMSA9IDYzMTsKICAgIHQuS2FwcGEgPSA3MjI7CiAgICB0LkxhbWJkYSA9IDY4NjsKICAgIHQuTXUgPSA4ODk7CiAgICB0Lk51ID0gNzIyOwogICAgdC5PbWljcm9uID0gNzIyOwogICAgdC5QaSA9IDc2ODsKICAgIHQuVGhldGEgPSA3NDE7CiAgICB0LlJobyA9IDU1NjsKICAgIHQuU2lnbWEgPSA1OTI7CiAgICB0LlRhdSA9IDYxMTsKICAgIHQuVXBzaWxvbiA9IDY5MDsKICAgIHQuc2lnbWExID0gNDM5OwogICAgdC5PbWVnYSA9IDc2ODsKICAgIHQuWGkgPSA2NDU7CiAgICB0LlBzaSA9IDc5NTsKICAgIHQuWmV0YSA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAzMzM7CiAgICB0LnRoZXJlZm9yZSA9IDg2MzsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzMzOwogICAgdC5wZXJwZW5kaWN1bGFyID0gNjU4OwogICAgdC51bmRlcnNjb3JlID0gNTAwOwogICAgdC5yYWRpY2FsZXggPSA1MDA7CiAgICB0LmFscGhhID0gNjMxOwogICAgdC5iZXRhID0gNTQ5OwogICAgdC5jaGkgPSA1NDk7CiAgICB0LmRlbHRhID0gNDk0OwogICAgdC5lcHNpbG9uID0gNDM5OwogICAgdC5waGkgPSA1MjE7CiAgICB0LmdhbW1hID0gNDExOwogICAgdC5ldGEgPSA2MDM7CiAgICB0LmlvdGEgPSAzMjk7CiAgICB0LnBoaTEgPSA2MDM7CiAgICB0LmthcHBhID0gNTQ5OwogICAgdC5sYW1iZGEgPSA1NDk7CiAgICB0Lm11ID0gNTc2OwogICAgdC5udSA9IDUyMTsKICAgIHQub21pY3JvbiA9IDU0OTsKICAgIHQucGkgPSA1NDk7CiAgICB0LnRoZXRhID0gNTIxOwogICAgdC5yaG8gPSA1NDk7CiAgICB0LnNpZ21hID0gNjAzOwogICAgdC50YXUgPSA0Mzk7CiAgICB0LnVwc2lsb24gPSA1NzY7CiAgICB0Lm9tZWdhMSA9IDcxMzsKICAgIHQub21lZ2EgPSA2ODY7CiAgICB0LnhpID0gNDkzOwogICAgdC5wc2kgPSA2ODY7CiAgICB0LnpldGEgPSA0OTQ7CiAgICB0LmJyYWNlbGVmdCA9IDQ4MDsKICAgIHQuYmFyID0gMjAwOwogICAgdC5icmFjZXJpZ2h0ID0gNDgwOwogICAgdC5zaW1pbGFyID0gNTQ5OwogICAgdC5FdXJvID0gNzUwOwogICAgdC5VcHNpbG9uMSA9IDYyMDsKICAgIHQubWludXRlID0gMjQ3OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC5pbmZpbml0eSA9IDcxMzsKICAgIHQuZmxvcmluID0gNTAwOwogICAgdC5jbHViID0gNzUzOwogICAgdC5kaWFtb25kID0gNzUzOwogICAgdC5oZWFydCA9IDc1MzsKICAgIHQuc3BhZGUgPSA3NTM7CiAgICB0LmFycm93Ym90aCA9IDEwNDI7CiAgICB0LmFycm93bGVmdCA9IDk4NzsKICAgIHQuYXJyb3d1cCA9IDYwMzsKICAgIHQuYXJyb3dyaWdodCA9IDk4NzsKICAgIHQuYXJyb3dkb3duID0gNjAzOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0LnBsdXNtaW51cyA9IDU0OTsKICAgIHQuc2Vjb25kID0gNDExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0Lm11bHRpcGx5ID0gNTQ5OwogICAgdC5wcm9wb3J0aW9uYWwgPSA3MTM7CiAgICB0LnBhcnRpYWxkaWZmID0gNDk0OwogICAgdC5idWxsZXQgPSA0NjA7CiAgICB0LmRpdmlkZSA9IDU0OTsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0LmVxdWl2YWxlbmNlID0gNTQ5OwogICAgdC5hcHByb3hlcXVhbCA9IDU0OTsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5hcnJvd3ZlcnRleCA9IDYwMzsKICAgIHQuYXJyb3dob3JpemV4ID0gMTAwMDsKICAgIHQuY2FycmlhZ2VyZXR1cm4gPSA2NTg7CiAgICB0LmFsZXBoID0gODIzOwogICAgdC5JZnJha3R1ciA9IDY4NjsKICAgIHQuUmZyYWt0dXIgPSA3OTU7CiAgICB0LndlaWVyc3RyYXNzID0gOTg3OwogICAgdC5jaXJjbGVtdWx0aXBseSA9IDc2ODsKICAgIHQuY2lyY2xlcGx1cyA9IDc2ODsKICAgIHQuZW1wdHlzZXQgPSA4MjM7CiAgICB0LmludGVyc2VjdGlvbiA9IDc2ODsKICAgIHQudW5pb24gPSA3Njg7CiAgICB0LnByb3BlcnN1cGVyc2V0ID0gNzEzOwogICAgdC5yZWZsZXhzdXBlcnNldCA9IDcxMzsKICAgIHQubm90c3Vic2V0ID0gNzEzOwogICAgdC5wcm9wZXJzdWJzZXQgPSA3MTM7CiAgICB0LnJlZmxleHN1YnNldCA9IDcxMzsKICAgIHQuZWxlbWVudCA9IDcxMzsKICAgIHQubm90ZWxlbWVudCA9IDcxMzsKICAgIHQuYW5nbGUgPSA3Njg7CiAgICB0LmdyYWRpZW50ID0gNzEzOwogICAgdC5yZWdpc3RlcnNlcmlmID0gNzkwOwogICAgdC5jb3B5cmlnaHRzZXJpZiA9IDc5MDsKICAgIHQudHJhZGVtYXJrc2VyaWYgPSA4OTA7CiAgICB0LnByb2R1Y3QgPSA4MjM7CiAgICB0LnJhZGljYWwgPSA1NDk7CiAgICB0LmRvdG1hdGggPSAyNTA7CiAgICB0LmxvZ2ljYWxub3QgPSA3MTM7CiAgICB0LmxvZ2ljYWxhbmQgPSA2MDM7CiAgICB0LmxvZ2ljYWxvciA9IDYwMzsKICAgIHQuYXJyb3dkYmxib3RoID0gMTA0MjsKICAgIHQuYXJyb3dkYmxsZWZ0ID0gOTg3OwogICAgdC5hcnJvd2RibHVwID0gNjAzOwogICAgdC5hcnJvd2RibHJpZ2h0ID0gOTg3OwogICAgdC5hcnJvd2RibGRvd24gPSA2MDM7CiAgICB0LmxvemVuZ2UgPSA0OTQ7CiAgICB0LmFuZ2xlbGVmdCA9IDMyOTsKICAgIHQucmVnaXN0ZXJzYW5zID0gNzkwOwogICAgdC5jb3B5cmlnaHRzYW5zID0gNzkwOwogICAgdC50cmFkZW1hcmtzYW5zID0gNzg2OwogICAgdC5zdW1tYXRpb24gPSA3MTM7CiAgICB0LnBhcmVubGVmdHRwID0gMzg0OwogICAgdC5wYXJlbmxlZnRleCA9IDM4NDsKICAgIHQucGFyZW5sZWZ0YnQgPSAzODQ7CiAgICB0LmJyYWNrZXRsZWZ0dHAgPSAzODQ7CiAgICB0LmJyYWNrZXRsZWZ0ZXggPSAzODQ7CiAgICB0LmJyYWNrZXRsZWZ0YnQgPSAzODQ7CiAgICB0LmJyYWNlbGVmdHRwID0gNDk0OwogICAgdC5icmFjZWxlZnRtaWQgPSA0OTQ7CiAgICB0LmJyYWNlbGVmdGJ0ID0gNDk0OwogICAgdC5icmFjZWV4ID0gNDk0OwogICAgdC5hbmdsZXJpZ2h0ID0gMzI5OwogICAgdC5pbnRlZ3JhbCA9IDI3NDsKICAgIHQuaW50ZWdyYWx0cCA9IDY4NjsKICAgIHQuaW50ZWdyYWxleCA9IDY4NjsKICAgIHQuaW50ZWdyYWxidCA9IDY4NjsKICAgIHQucGFyZW5yaWdodHRwID0gMzg0OwogICAgdC5wYXJlbnJpZ2h0ZXggPSAzODQ7CiAgICB0LnBhcmVucmlnaHRidCA9IDM4NDsKICAgIHQuYnJhY2tldHJpZ2h0dHAgPSAzODQ7CiAgICB0LmJyYWNrZXRyaWdodGV4ID0gMzg0OwogICAgdC5icmFja2V0cmlnaHRidCA9IDM4NDsKICAgIHQuYnJhY2VyaWdodHRwID0gNDk0OwogICAgdC5icmFjZXJpZ2h0bWlkID0gNDk0OwogICAgdC5icmFjZXJpZ2h0YnQgPSA0OTQ7CiAgICB0LmFwcGxlID0gNzkwOwogIH0pOwogIHRbIlRpbWVzLVJvbWFuIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQucXVvdGVkYmwgPSA0MDg7CiAgICB0Lm51bWJlcnNpZ24gPSA1MDA7CiAgICB0LmRvbGxhciA9IDUwMDsKICAgIHQucGVyY2VudCA9IDgzMzsKICAgIHQuYW1wZXJzYW5kID0gNzc4OwogICAgdC5xdW90ZXJpZ2h0ID0gMzMzOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gNTAwOwogICAgdC5wbHVzID0gNTY0OwogICAgdC5jb21tYSA9IDI1MDsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNTA7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTAwOwogICAgdC5vbmUgPSA1MDA7CiAgICB0LnR3byA9IDUwMDsKICAgIHQudGhyZWUgPSA1MDA7CiAgICB0LmZvdXIgPSA1MDA7CiAgICB0LmZpdmUgPSA1MDA7CiAgICB0LnNpeCA9IDUwMDsKICAgIHQuc2V2ZW4gPSA1MDA7CiAgICB0LmVpZ2h0ID0gNTAwOwogICAgdC5uaW5lID0gNTAwOwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTY0OwogICAgdC5lcXVhbCA9IDU2NDsKICAgIHQuZ3JlYXRlciA9IDU2NDsKICAgIHQucXVlc3Rpb24gPSA0NDQ7CiAgICB0LmF0ID0gOTIxOwogICAgdC5BID0gNzIyOwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNjY3OwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjExOwogICAgdC5GID0gNTU2OwogICAgdC5HID0gNzIyOwogICAgdC5IID0gNzIyOwogICAgdC5JID0gMzMzOwogICAgdC5KID0gMzg5OwogICAgdC5LID0gNzIyOwogICAgdC5MID0gNjExOwogICAgdC5NID0gODg5OwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzIyOwogICAgdC5QID0gNTU2OwogICAgdC5RID0gNzIyOwogICAgdC5SID0gNjY3OwogICAgdC5TID0gNTU2OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNzIyOwogICAgdC5XID0gOTQ0OwogICAgdC5YID0gNzIyOwogICAgdC5ZID0gNzIyOwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDMzMzsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAzMzM7CiAgICB0LmFzY2lpY2lyY3VtID0gNDY5OwogICAgdC51bmRlcnNjb3JlID0gNTAwOwogICAgdC5xdW90ZWxlZnQgPSAzMzM7CiAgICB0LmEgPSA0NDQ7CiAgICB0LmIgPSA1MDA7CiAgICB0LmMgPSA0NDQ7CiAgICB0LmQgPSA1MDA7CiAgICB0LmUgPSA0NDQ7CiAgICB0LmYgPSAzMzM7CiAgICB0LmcgPSA1MDA7CiAgICB0LmggPSA1MDA7CiAgICB0LmkgPSAyNzg7CiAgICB0LmogPSAyNzg7CiAgICB0LmsgPSA1MDA7CiAgICB0LmwgPSAyNzg7CiAgICB0Lm0gPSA3Nzg7CiAgICB0Lm4gPSA1MDA7CiAgICB0Lm8gPSA1MDA7CiAgICB0LnAgPSA1MDA7CiAgICB0LnEgPSA1MDA7CiAgICB0LnIgPSAzMzM7CiAgICB0LnMgPSAzODk7CiAgICB0LnQgPSAyNzg7CiAgICB0LnUgPSA1MDA7CiAgICB0LnYgPSA1MDA7CiAgICB0LncgPSA3MjI7CiAgICB0LnggPSA1MDA7CiAgICB0LnkgPSA1MDA7CiAgICB0LnogPSA0NDQ7CiAgICB0LmJyYWNlbGVmdCA9IDQ4MDsKICAgIHQuYmFyID0gMjAwOwogICAgdC5icmFjZXJpZ2h0ID0gNDgwOwogICAgdC5hc2NpaXRpbGRlID0gNTQxOwogICAgdC5leGNsYW1kb3duID0gMzMzOwogICAgdC5jZW50ID0gNTAwOwogICAgdC5zdGVybGluZyA9IDUwMDsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDUwMDsKICAgIHQuZmxvcmluID0gNTAwOwogICAgdC5zZWN0aW9uID0gNTAwOwogICAgdC5jdXJyZW5jeSA9IDUwMDsKICAgIHQucXVvdGVzaW5nbGUgPSAxODA7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDQ0NDsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDUwMDsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNTU2OwogICAgdC5mbCA9IDU1NjsKICAgIHQuZW5kYXNoID0gNTAwOwogICAgdC5kYWdnZXIgPSA1MDA7CiAgICB0LmRhZ2dlcmRibCA9IDUwMDsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNTA7CiAgICB0LnBhcmFncmFwaCA9IDQ1MzsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxiYXNlID0gNDQ0OwogICAgdC5xdW90ZWRibHJpZ2h0ID0gNDQ0OwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDUwMDsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDQ0NDsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDg4OTsKICAgIHQub3JkZmVtaW5pbmUgPSAyNzY7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzIyOwogICAgdC5PRSA9IDg4OTsKICAgIHQub3JkbWFzY3VsaW5lID0gMzEwOwogICAgdC5hZSA9IDY2NzsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDcyMjsKICAgIHQuZ2VybWFuZGJscyA9IDUwMDsKICAgIHQuSWRpZXJlc2lzID0gMzMzOwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDQ0NDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA3MjI7CiAgICB0LmRpdmlkZSA9IDU2NDsKICAgIHQuWWFjdXRlID0gNzIyOwogICAgdC5BY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuYWFjdXRlID0gNDQ0OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNDQ0OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1MDA7CiAgICB0LkVkaWVyZXNpcyA9IDYxMTsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzYwOwogICAgdC5FbWFjcm9uID0gNjExOwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNDQ0OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNDQ0OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDY2NzsKICAgIHQuYXRpbGRlID0gNDQ0OwogICAgdC5FZG90YWNjZW50ID0gNjExOwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDY2NzsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC51Y2lyY3VtZmxleCA9IDUwMDsKICAgIHQuYWNpcmN1bWZsZXggPSA0NDQ7CiAgICB0LkFtYWNyb24gPSA3MjI7CiAgICB0LnJjYXJvbiA9IDMzMzsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNTU2OwogICAgdC5PbWFjcm9uID0gNzIyOwogICAgdC5SYWN1dGUgPSA2Njc7CiAgICB0LlNhY3V0ZSA9IDU1NjsKICAgIHQuZGNhcm9uID0gNTg4OwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDUwMDsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzIyOwogICAgdC5BZ3JhdmUgPSA3MjI7CiAgICB0LkFicmV2ZSA9IDcyMjsKICAgIHQubXVsdGlwbHkgPSA1NjQ7CiAgICB0LnVhY3V0ZSA9IDUwMDsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWRpZXJlc2lzID0gNDQ0OwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTAwOwogICAgdC51bWFjcm9uID0gNTAwOwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDMzMzsKICAgIHQucGx1c21pbnVzID0gNTY0OwogICAgdC5icm9rZW5iYXIgPSAyMDA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NjA7CiAgICB0LkdicmV2ZSA9IDcyMjsKICAgIHQuSWRvdGFjY2VudCA9IDMzMzsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2MTE7CiAgICB0LnJhY3V0ZSA9IDMzMzsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDY2NzsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzMjY7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDcyMjsKICAgIHQuQWRpZXJlc2lzID0gNzIyOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDQ0NDsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzIyOwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA0NDQ7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1MDA7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3MjI7CiAgICB0Lm11ID0gNTAwOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2MTE7CiAgICB0LmRjcm9hdCA9IDUwMDsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1NTY7CiAgICB0LmxjYXJvbiA9IDM0NDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MYWN1dGUgPSA2MTE7CiAgICB0LnRyYWRlbWFyayA9IDk4MDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzMzOwogICAgdC5JbWFjcm9uID0gMzMzOwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDUwMDsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjExOwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDU1NjsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1MDA7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkF0aWxkZSA9IDcyMjsKICAgIHQuQW9nb25layA9IDcyMjsKICAgIHQuQXJpbmcgPSA3MjI7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDQ0NDsKICAgIHQuRWNhcm9uID0gNjExOwogICAgdC5Jb2dvbmVrID0gMzMzOwogICAgdC5rY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm1pbnVzID0gNTY0OwogICAgdC5JY2lyY3VtZmxleCA9IDMzMzsKICAgIHQubmNhcm9uID0gNTAwOwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA1NjQ7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTAwOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDQ0NDsKICAgIHQubmNvbW1hYWNjZW50ID0gNTAwOwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0WyJUaW1lcy1Cb2xkIl0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQucXVvdGVkYmwgPSA1NTU7CiAgICB0Lm51bWJlcnNpZ24gPSA1MDA7CiAgICB0LmRvbGxhciA9IDUwMDsKICAgIHQucGVyY2VudCA9IDEwMDA7CiAgICB0LmFtcGVyc2FuZCA9IDgzMzsKICAgIHQucXVvdGVyaWdodCA9IDMzMzsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDUwMDsKICAgIHQucGx1cyA9IDU3MDsKICAgIHQuY29tbWEgPSAyNTA7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjUwOwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDUwMDsKICAgIHQub25lID0gNTAwOwogICAgdC50d28gPSA1MDA7CiAgICB0LnRocmVlID0gNTAwOwogICAgdC5mb3VyID0gNTAwOwogICAgdC5maXZlID0gNTAwOwogICAgdC5zaXggPSA1MDA7CiAgICB0LnNldmVuID0gNTAwOwogICAgdC5laWdodCA9IDUwMDsKICAgIHQubmluZSA9IDUwMDsKICAgIHQuY29sb24gPSAzMzM7CiAgICB0LnNlbWljb2xvbiA9IDMzMzsKICAgIHQubGVzcyA9IDU3MDsKICAgIHQuZXF1YWwgPSA1NzA7CiAgICB0LmdyZWF0ZXIgPSA1NzA7CiAgICB0LnF1ZXN0aW9uID0gNTAwOwogICAgdC5hdCA9IDkzMDsKICAgIHQuQSA9IDcyMjsKICAgIHQuQiA9IDY2NzsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDc3ODsKICAgIHQuSSA9IDM4OTsKICAgIHQuSiA9IDUwMDsKICAgIHQuSyA9IDc3ODsKICAgIHQuTCA9IDY2NzsKICAgIHQuTSA9IDk0NDsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDYxMTsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDU1NjsKICAgIHQuVCA9IDY2NzsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDcyMjsKICAgIHQuVyA9IDEwMDA7CiAgICB0LlggPSA3MjI7CiAgICB0LlkgPSA3MjI7CiAgICB0LlogPSA2Njc7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1ODE7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDUwMDsKICAgIHQuYiA9IDU1NjsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDU1NjsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDU1NjsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDMzMzsKICAgIHQuayA9IDU1NjsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDgzMzsKICAgIHQubiA9IDU1NjsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDU1NjsKICAgIHQucSA9IDU1NjsKICAgIHQuciA9IDQ0NDsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDMzMzsKICAgIHQudSA9IDU1NjsKICAgIHQudiA9IDUwMDsKICAgIHQudyA9IDcyMjsKICAgIHQueCA9IDUwMDsKICAgIHQueSA9IDUwMDsKICAgIHQueiA9IDQ0NDsKICAgIHQuYnJhY2VsZWZ0ID0gMzk0OwogICAgdC5iYXIgPSAyMjA7CiAgICB0LmJyYWNlcmlnaHQgPSAzOTQ7CiAgICB0LmFzY2lpdGlsZGUgPSA1MjA7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDI3ODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1NTY7CiAgICB0LmZsID0gNTU2OwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNTQwOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNTAwOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzMDA7CiAgICB0LkxzbGFzaCA9IDY2NzsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDMzMDsKICAgIHQuYWUgPSA3MjI7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyNzg7CiAgICB0Lm9zbGFzaCA9IDUwMDsKICAgIHQub2UgPSA3MjI7CiAgICB0Lmdlcm1hbmRibHMgPSA1NTY7CiAgICB0LklkaWVyZXNpcyA9IDM4OTsKICAgIHQuZWFjdXRlID0gNDQ0OwogICAgdC5hYnJldmUgPSA1MDA7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LmVjYXJvbiA9IDQ0NDsKICAgIHQuWWRpZXJlc2lzID0gNzIyOwogICAgdC5kaXZpZGUgPSA1NzA7CiAgICB0LllhY3V0ZSA9IDcyMjsKICAgIHQuQWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LmFhY3V0ZSA9IDUwMDsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDUwMDsKICAgIHQuc2NvbW1hYWNjZW50ID0gMzg5OwogICAgdC5lY2lyY3VtZmxleCA9IDQ0NDsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDUwMDsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNTU2OwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDc0NzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNDQ0OwogICAgdC5hcmluZyA9IDUwMDsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyNzg7CiAgICB0LmFncmF2ZSA9IDUwMDsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDUwMDsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gMzg5OwogICAgdC5zY2VkaWxsYSA9IDM4OTsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTAwOwogICAgdC5BbWFjcm9uID0gNzIyOwogICAgdC5yY2Fyb24gPSA0NDQ7CiAgICB0LmNjZWRpbGxhID0gNDQ0OwogICAgdC5aZG90YWNjZW50ID0gNjY3OwogICAgdC5UaG9ybiA9IDYxMTsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA1NTY7CiAgICB0LmRjYXJvbiA9IDY3MjsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA1NTY7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMDA7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNzIyOwogICAgdC5BYnJldmUgPSA3MjI7CiAgICB0Lm11bHRpcGx5ID0gNTcwOwogICAgdC51YWN1dGUgPSA1NTY7CiAgICB0LlRjYXJvbiA9IDY2NzsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LnlkaWVyZXNpcyA9IDUwMDsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDUwMDsKICAgIHQuZWRpZXJlc2lzID0gNDQ0OwogICAgdC5jYWN1dGUgPSA0NDQ7CiAgICB0Lm5hY3V0ZSA9IDU1NjsKICAgIHQudW1hY3JvbiA9IDU1NjsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAzODk7CiAgICB0LnBsdXNtaW51cyA9IDU3MDsKICAgIHQuYnJva2VuYmFyID0gMjIwOwogICAgdC5yZWdpc3RlcmVkID0gNzQ3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAzODk7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSA0NDQ7CiAgICB0Lm9tYWNyb24gPSA1MDA7CiAgICB0LlphY3V0ZSA9IDY2NzsKICAgIHQuWmNhcm9uID0gNjY3OwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDI3ODsKICAgIHQudGNhcm9uID0gNDE2OwogICAgdC5lb2dvbmVrID0gNDQ0OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA3MjI7CiAgICB0LkFkaWVyZXNpcyA9IDcyMjsKICAgIHQuZWdyYXZlID0gNDQ0OwogICAgdC56YWN1dGUgPSA0NDQ7CiAgICB0LmlvZ29uZWsgPSAyNzg7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNTAwOwogICAgdC5hbWFjcm9uID0gNTAwOwogICAgdC5zYWN1dGUgPSAzODk7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNTU2OwogICAgdC50d29zdXBlcmlvciA9IDMwMDsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDU1NjsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNTAwOwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA1NTY7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA3NTA7CiAgICB0LlNjZWRpbGxhID0gNTU2OwogICAgdC5sY2Fyb24gPSAzOTQ7CiAgICB0Lktjb21tYWFjY2VudCA9IDc3ODsKICAgIHQuTGFjdXRlID0gNjY3OwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNDQ0OwogICAgdC5JZ3JhdmUgPSAzODk7CiAgICB0LkltYWNyb24gPSAzODk7CiAgICB0LkxjYXJvbiA9IDY2NzsKICAgIHQub25laGFsZiA9IDc1MDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDUwMDsKICAgIHQubnRpbGRlID0gNTU2OwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA0NDQ7CiAgICB0LmdicmV2ZSA9IDUwMDsKICAgIHQub25lcXVhcnRlciA9IDc1MDsKICAgIHQuU2Nhcm9uID0gNTU2OwogICAgdC5TY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNTAwOwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDU1NjsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSA0NDQ7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNTAwOwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuQXRpbGRlID0gNzIyOwogICAgdC5Bb2dvbmVrID0gNzIyOwogICAgdC5BcmluZyA9IDcyMjsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNDQ0OwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAzODk7CiAgICB0Lmtjb21tYWFjY2VudCA9IDU1NjsKICAgIHQubWludXMgPSA1NzA7CiAgICB0LkljaXJjdW1mbGV4ID0gMzg5OwogICAgdC5uY2Fyb24gPSA1NTY7CiAgICB0LnRjb21tYWFjY2VudCA9IDMzMzsKICAgIHQubG9naWNhbG5vdCA9IDU3MDsKICAgIHQub2RpZXJlc2lzID0gNTAwOwogICAgdC51ZGllcmVzaXMgPSA1NTY7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmV0aCA9IDUwMDsKICAgIHQuemNhcm9uID0gNDQ0OwogICAgdC5uY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzAwOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTAwOwogIH0pOwogIHRbIlRpbWVzLUJvbGRJdGFsaWMiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzg5OwogICAgdC5xdW90ZWRibCA9IDU1NTsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gODMzOwogICAgdC5hbXBlcnNhbmQgPSA3Nzg7CiAgICB0LnF1b3RlcmlnaHQgPSAzMzM7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSA1MDA7CiAgICB0LnBsdXMgPSA1NzA7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI1MDsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1MDA7CiAgICB0Lm9uZSA9IDUwMDsKICAgIHQudHdvID0gNTAwOwogICAgdC50aHJlZSA9IDUwMDsKICAgIHQuZm91ciA9IDUwMDsKICAgIHQuZml2ZSA9IDUwMDsKICAgIHQuc2l4ID0gNTAwOwogICAgdC5zZXZlbiA9IDUwMDsKICAgIHQuZWlnaHQgPSA1MDA7CiAgICB0Lm5pbmUgPSA1MDA7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA1NzA7CiAgICB0LmVxdWFsID0gNTcwOwogICAgdC5ncmVhdGVyID0gNTcwOwogICAgdC5xdWVzdGlvbiA9IDUwMDsKICAgIHQuYXQgPSA4MzI7CiAgICB0LkEgPSA2Njc7CiAgICB0LkIgPSA2Njc7CiAgICB0LkMgPSA2Njc7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2Njc7CiAgICB0LkcgPSA3MjI7CiAgICB0LkggPSA3Nzg7CiAgICB0LkkgPSAzODk7CiAgICB0LkogPSA1MDA7CiAgICB0LksgPSA2Njc7CiAgICB0LkwgPSA2MTE7CiAgICB0Lk0gPSA4ODk7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3MjI7CiAgICB0LlAgPSA2MTE7CiAgICB0LlEgPSA3MjI7CiAgICB0LlIgPSA2Njc7CiAgICB0LlMgPSA1NTY7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA4ODk7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2MTE7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1NzA7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDUwMDsKICAgIHQuYiA9IDUwMDsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDUwMDsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDU1NjsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDUwMDsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDc3ODsKICAgIHQubiA9IDU1NjsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDUwMDsKICAgIHQucSA9IDUwMDsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDU1NjsKICAgIHQudiA9IDQ0NDsKICAgIHQudyA9IDY2NzsKICAgIHQueCA9IDUwMDsKICAgIHQueSA9IDQ0NDsKICAgIHQueiA9IDM4OTsKICAgIHQuYnJhY2VsZWZ0ID0gMzQ4OwogICAgdC5iYXIgPSAyMjA7CiAgICB0LmJyYWNlcmlnaHQgPSAzNDg7CiAgICB0LmFzY2lpdGlsZGUgPSA1NzA7CiAgICB0LmV4Y2xhbWRvd24gPSAzODk7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDI3ODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1NTY7CiAgICB0LmZsID0gNTU2OwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNTAwOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNTAwOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gOTQ0OwogICAgdC5vcmRmZW1pbmluZSA9IDI2NjsKICAgIHQuTHNsYXNoID0gNjExOwogICAgdC5Pc2xhc2ggPSA3MjI7CiAgICB0Lk9FID0gOTQ0OwogICAgdC5vcmRtYXNjdWxpbmUgPSAzMDA7CiAgICB0LmFlID0gNzIyOwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjc4OwogICAgdC5vc2xhc2ggPSA1MDA7CiAgICB0Lm9lID0gNzIyOwogICAgdC5nZXJtYW5kYmxzID0gNTAwOwogICAgdC5JZGllcmVzaXMgPSAzODk7CiAgICB0LmVhY3V0ZSA9IDQ0NDsKICAgIHQuYWJyZXZlID0gNTAwOwogICAgdC51aHVuZ2FydW1sYXV0ID0gNTU2OwogICAgdC5lY2Fyb24gPSA0NDQ7CiAgICB0LllkaWVyZXNpcyA9IDYxMTsKICAgIHQuZGl2aWRlID0gNTcwOwogICAgdC5ZYWN1dGUgPSA2MTE7CiAgICB0LkFjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hYWN1dGUgPSA1MDA7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA0NDQ7CiAgICB0LnNjb21tYWFjY2VudCA9IDM4OTsKICAgIHQuZWNpcmN1bWZsZXggPSA0NDQ7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA1MDA7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDU1NjsKICAgIHQuRWRpZXJlc2lzID0gNjY3OwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3NDc7CiAgICB0LkVtYWNyb24gPSA2Njc7CiAgICB0LmNjYXJvbiA9IDQ0NDsKICAgIHQuYXJpbmcgPSA1MDA7CiAgICB0Lk5jb21tYWFjY2VudCA9IDcyMjsKICAgIHQubGFjdXRlID0gMjc4OwogICAgdC5hZ3JhdmUgPSA1MDA7CiAgICB0LlRjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQ2FjdXRlID0gNjY3OwogICAgdC5hdGlsZGUgPSA1MDA7CiAgICB0LkVkb3RhY2NlbnQgPSA2Njc7CiAgICB0LnNjYXJvbiA9IDM4OTsKICAgIHQuc2NlZGlsbGEgPSAzODk7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ5NDsKICAgIHQuUmNhcm9uID0gNjY3OwogICAgdC5HY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LnVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5hY2lyY3VtZmxleCA9IDUwMDsKICAgIHQuQW1hY3JvbiA9IDY2NzsKICAgIHQucmNhcm9uID0gMzg5OwogICAgdC5jY2VkaWxsYSA9IDQ0NDsKICAgIHQuWmRvdGFjY2VudCA9IDYxMTsKICAgIHQuVGhvcm4gPSA2MTE7CiAgICB0Lk9tYWNyb24gPSA3MjI7CiAgICB0LlJhY3V0ZSA9IDY2NzsKICAgIHQuU2FjdXRlID0gNTU2OwogICAgdC5kY2Fyb24gPSA2MDg7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNTU2OwogICAgdC50aHJlZXN1cGVyaW9yID0gMzAwOwogICAgdC5PZ3JhdmUgPSA3MjI7CiAgICB0LkFncmF2ZSA9IDY2NzsKICAgIHQuQWJyZXZlID0gNjY3OwogICAgdC5tdWx0aXBseSA9IDU3MDsKICAgIHQudWFjdXRlID0gNTU2OwogICAgdC5UY2Fyb24gPSA2MTE7CiAgICB0LnBhcnRpYWxkaWZmID0gNDk0OwogICAgdC55ZGllcmVzaXMgPSA0NDQ7CiAgICB0Lk5hY3V0ZSA9IDcyMjsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hZGllcmVzaXMgPSA1MDA7CiAgICB0LmVkaWVyZXNpcyA9IDQ0NDsKICAgIHQuY2FjdXRlID0gNDQ0OwogICAgdC5uYWN1dGUgPSA1NTY7CiAgICB0LnVtYWNyb24gPSA1NTY7CiAgICB0Lk5jYXJvbiA9IDcyMjsKICAgIHQuSWFjdXRlID0gMzg5OwogICAgdC5wbHVzbWludXMgPSA1NzA7CiAgICB0LmJyb2tlbmJhciA9IDIyMDsKICAgIHQucmVnaXN0ZXJlZCA9IDc0NzsKICAgIHQuR2JyZXZlID0gNzIyOwogICAgdC5JZG90YWNjZW50ID0gMzg5OwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDY2NzsKICAgIHQucmFjdXRlID0gMzg5OwogICAgdC5vbWFjcm9uID0gNTAwOwogICAgdC5aYWN1dGUgPSA2MTE7CiAgICB0LlpjYXJvbiA9IDYxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNjY3OwogICAgdC5sY29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LnRjYXJvbiA9IDM2NjsKICAgIHQuZW9nb25layA9IDQ0NDsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNjY3OwogICAgdC5BZGllcmVzaXMgPSA2Njc7CiAgICB0LmVncmF2ZSA9IDQ0NDsKICAgIHQuemFjdXRlID0gMzg5OwogICAgdC5pb2dvbmVrID0gMjc4OwogICAgdC5PYWN1dGUgPSA3MjI7CiAgICB0Lm9hY3V0ZSA9IDUwMDsKICAgIHQuYW1hY3JvbiA9IDUwMDsKICAgIHQuc2FjdXRlID0gMzg5OwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzIyOwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDUwMDsKICAgIHQudHdvc3VwZXJpb3IgPSAzMDA7CiAgICB0Lk9kaWVyZXNpcyA9IDcyMjsKICAgIHQubXUgPSA1NzY7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuRW9nb25layA9IDY2NzsKICAgIHQuZGNyb2F0ID0gNTAwOwogICAgdC50aHJlZXF1YXJ0ZXJzID0gNzUwOwogICAgdC5TY2VkaWxsYSA9IDU1NjsKICAgIHQubGNhcm9uID0gMzgyOwogICAgdC5LY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LkxhY3V0ZSA9IDYxMTsKICAgIHQudHJhZGVtYXJrID0gMTAwMDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzg5OwogICAgdC5JbWFjcm9uID0gMzg5OwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDU1NjsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjY3OwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDU1NjsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1NTY7CiAgICB0LnJhZGljYWwgPSA1NDk7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzg5OwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkF0aWxkZSA9IDY2NzsKICAgIHQuQW9nb25layA9IDY2NzsKICAgIHQuQXJpbmcgPSA2Njc7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDM4OTsKICAgIHQuRWNhcm9uID0gNjY3OwogICAgdC5Jb2dvbmVrID0gMzg5OwogICAgdC5rY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm1pbnVzID0gNjA2OwogICAgdC5JY2lyY3VtZmxleCA9IDM4OTsKICAgIHQubmNhcm9uID0gNTU2OwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA2MDY7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTU2OwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDM4OTsKICAgIHQubmNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0WyJUaW1lcy1JdGFsaWMiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQyMDsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gODMzOwogICAgdC5hbXBlcnNhbmQgPSA3Nzg7CiAgICB0LnF1b3RlcmlnaHQgPSAzMzM7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSA1MDA7CiAgICB0LnBsdXMgPSA2NzU7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI1MDsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1MDA7CiAgICB0Lm9uZSA9IDUwMDsKICAgIHQudHdvID0gNTAwOwogICAgdC50aHJlZSA9IDUwMDsKICAgIHQuZm91ciA9IDUwMDsKICAgIHQuZml2ZSA9IDUwMDsKICAgIHQuc2l4ID0gNTAwOwogICAgdC5zZXZlbiA9IDUwMDsKICAgIHQuZWlnaHQgPSA1MDA7CiAgICB0Lm5pbmUgPSA1MDA7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA2NzU7CiAgICB0LmVxdWFsID0gNjc1OwogICAgdC5ncmVhdGVyID0gNjc1OwogICAgdC5xdWVzdGlvbiA9IDUwMDsKICAgIHQuYXQgPSA5MjA7CiAgICB0LkEgPSA2MTE7CiAgICB0LkIgPSA2MTE7CiAgICB0LkMgPSA2Njc7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2MTE7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3MjI7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAzMzM7CiAgICB0LkogPSA0NDQ7CiAgICB0LksgPSA2Njc7CiAgICB0LkwgPSA1NTY7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA2Njc7CiAgICB0Lk8gPSA3MjI7CiAgICB0LlAgPSA2MTE7CiAgICB0LlEgPSA3MjI7CiAgICB0LlIgPSA2MTE7CiAgICB0LlMgPSA1MDA7CiAgICB0LlQgPSA1NTY7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2MTE7CiAgICB0LlcgPSA4MzM7CiAgICB0LlggPSA2MTE7CiAgICB0LlkgPSA1NTY7CiAgICB0LlogPSA1NTY7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzg5OwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDM4OTsKICAgIHQuYXNjaWljaXJjdW0gPSA0MjI7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDUwMDsKICAgIHQuYiA9IDUwMDsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDUwMDsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDI3ODsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDUwMDsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDQ0NDsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDcyMjsKICAgIHQubiA9IDUwMDsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDUwMDsKICAgIHQucSA9IDUwMDsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDUwMDsKICAgIHQudiA9IDQ0NDsKICAgIHQudyA9IDY2NzsKICAgIHQueCA9IDQ0NDsKICAgIHQueSA9IDQ0NDsKICAgIHQueiA9IDM4OTsKICAgIHQuYnJhY2VsZWZ0ID0gNDAwOwogICAgdC5iYXIgPSAyNzU7CiAgICB0LmJyYWNlcmlnaHQgPSA0MDA7CiAgICB0LmFzY2lpdGlsZGUgPSA1NDE7CiAgICB0LmV4Y2xhbWRvd24gPSAzODk7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDIxNDsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTU2OwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1MDA7CiAgICB0LmZsID0gNTAwOwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNTIzOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA1NTY7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1NTY7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDg4OTsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA1MDA7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gODg5OwogICAgdC5BRSA9IDg4OTsKICAgIHQub3JkZmVtaW5pbmUgPSAyNzY7CiAgICB0LkxzbGFzaCA9IDU1NjsKICAgIHQuT3NsYXNoID0gNzIyOwogICAgdC5PRSA9IDk0NDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzEwOwogICAgdC5hZSA9IDY2NzsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDY2NzsKICAgIHQuZ2VybWFuZGJscyA9IDUwMDsKICAgIHQuSWRpZXJlc2lzID0gMzMzOwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDUwMDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA1NTY7CiAgICB0LmRpdmlkZSA9IDY3NTsKICAgIHQuWWFjdXRlID0gNTU2OwogICAgdC5BY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWFjdXRlID0gNTAwOwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNDQ0OwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTAwOwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1MDA7CiAgICB0LkVkaWVyZXNpcyA9IDYxMTsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzYwOwogICAgdC5FbWFjcm9uID0gNjExOwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNTAwOwogICAgdC5OY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTAwOwogICAgdC5UY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkNhY3V0ZSA9IDY2NzsKICAgIHQuYXRpbGRlID0gNTAwOwogICAgdC5FZG90YWNjZW50ID0gNjExOwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDYxMTsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC51Y2lyY3VtZmxleCA9IDUwMDsKICAgIHQuYWNpcmN1bWZsZXggPSA1MDA7CiAgICB0LkFtYWNyb24gPSA2MTE7CiAgICB0LnJjYXJvbiA9IDM4OTsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA1NTY7CiAgICB0LlRob3JuID0gNjExOwogICAgdC5PbWFjcm9uID0gNzIyOwogICAgdC5SYWN1dGUgPSA2MTE7CiAgICB0LlNhY3V0ZSA9IDUwMDsKICAgIHQuZGNhcm9uID0gNTQ0OwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDUwMDsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzIyOwogICAgdC5BZ3JhdmUgPSA2MTE7CiAgICB0LkFicmV2ZSA9IDYxMTsKICAgIHQubXVsdGlwbHkgPSA2NzU7CiAgICB0LnVhY3V0ZSA9IDUwMDsKICAgIHQuVGNhcm9uID0gNTU2OwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNDQ0OwogICAgdC5OYWN1dGUgPSA2Njc7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWRpZXJlc2lzID0gNTAwOwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTAwOwogICAgdC51bWFjcm9uID0gNTAwOwogICAgdC5OY2Fyb24gPSA2Njc7CiAgICB0LklhY3V0ZSA9IDMzMzsKICAgIHQucGx1c21pbnVzID0gNjc1OwogICAgdC5icm9rZW5iYXIgPSAyNzU7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NjA7CiAgICB0LkdicmV2ZSA9IDcyMjsKICAgIHQuSWRvdGFjY2VudCA9IDMzMzsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2MTE7CiAgICB0LnJhY3V0ZSA9IDM4OTsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNTU2OwogICAgdC5aY2Fyb24gPSA1NTY7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDY2NzsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzMDA7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDYxMTsKICAgIHQuQWRpZXJlc2lzID0gNjExOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDM4OTsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzIyOwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA1MDA7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1MDA7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3MjI7CiAgICB0Lm11ID0gNTAwOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2MTE7CiAgICB0LmRjcm9hdCA9IDUwMDsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1MDA7CiAgICB0LmxjYXJvbiA9IDMwMDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA1NTY7CiAgICB0LnRyYWRlbWFyayA9IDk4MDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzMzOwogICAgdC5JbWFjcm9uID0gMzMzOwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDUwMDsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjExOwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDUwMDsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1MDA7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzg5OwogICAgdC5OdGlsZGUgPSA2Njc7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjExOwogICAgdC5MY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkF0aWxkZSA9IDYxMTsKICAgIHQuQW9nb25layA9IDYxMTsKICAgIHQuQXJpbmcgPSA2MTE7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDM4OTsKICAgIHQuRWNhcm9uID0gNjExOwogICAgdC5Jb2dvbmVrID0gMzMzOwogICAgdC5rY29tbWFhY2NlbnQgPSA0NDQ7CiAgICB0Lm1pbnVzID0gNjc1OwogICAgdC5JY2lyY3VtZmxleCA9IDMzMzsKICAgIHQubmNhcm9uID0gNTAwOwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA2NzU7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTAwOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDM4OTsKICAgIHQubmNvbW1hYWNjZW50ID0gNTAwOwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0LlphcGZEaW5nYmF0cyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuYTEgPSA5NzQ7CiAgICB0LmEyID0gOTYxOwogICAgdC5hMjAyID0gOTc0OwogICAgdC5hMyA9IDk4MDsKICAgIHQuYTQgPSA3MTk7CiAgICB0LmE1ID0gNzg5OwogICAgdC5hMTE5ID0gNzkwOwogICAgdC5hMTE4ID0gNzkxOwogICAgdC5hMTE3ID0gNjkwOwogICAgdC5hMTEgPSA5NjA7CiAgICB0LmExMiA9IDkzOTsKICAgIHQuYTEzID0gNTQ5OwogICAgdC5hMTQgPSA4NTU7CiAgICB0LmExNSA9IDkxMTsKICAgIHQuYTE2ID0gOTMzOwogICAgdC5hMTA1ID0gOTExOwogICAgdC5hMTcgPSA5NDU7CiAgICB0LmExOCA9IDk3NDsKICAgIHQuYTE5ID0gNzU1OwogICAgdC5hMjAgPSA4NDY7CiAgICB0LmEyMSA9IDc2MjsKICAgIHQuYTIyID0gNzYxOwogICAgdC5hMjMgPSA1NzE7CiAgICB0LmEyNCA9IDY3NzsKICAgIHQuYTI1ID0gNzYzOwogICAgdC5hMjYgPSA3NjA7CiAgICB0LmEyNyA9IDc1OTsKICAgIHQuYTI4ID0gNzU0OwogICAgdC5hNiA9IDQ5NDsKICAgIHQuYTcgPSA1NTI7CiAgICB0LmE4ID0gNTM3OwogICAgdC5hOSA9IDU3NzsKICAgIHQuYTEwID0gNjkyOwogICAgdC5hMjkgPSA3ODY7CiAgICB0LmEzMCA9IDc4ODsKICAgIHQuYTMxID0gNzg4OwogICAgdC5hMzIgPSA3OTA7CiAgICB0LmEzMyA9IDc5MzsKICAgIHQuYTM0ID0gNzk0OwogICAgdC5hMzUgPSA4MTY7CiAgICB0LmEzNiA9IDgyMzsKICAgIHQuYTM3ID0gNzg5OwogICAgdC5hMzggPSA4NDE7CiAgICB0LmEzOSA9IDgyMzsKICAgIHQuYTQwID0gODMzOwogICAgdC5hNDEgPSA4MTY7CiAgICB0LmE0MiA9IDgzMTsKICAgIHQuYTQzID0gOTIzOwogICAgdC5hNDQgPSA3NDQ7CiAgICB0LmE0NSA9IDcyMzsKICAgIHQuYTQ2ID0gNzQ5OwogICAgdC5hNDcgPSA3OTA7CiAgICB0LmE0OCA9IDc5MjsKICAgIHQuYTQ5ID0gNjk1OwogICAgdC5hNTAgPSA3NzY7CiAgICB0LmE1MSA9IDc2ODsKICAgIHQuYTUyID0gNzkyOwogICAgdC5hNTMgPSA3NTk7CiAgICB0LmE1NCA9IDcwNzsKICAgIHQuYTU1ID0gNzA4OwogICAgdC5hNTYgPSA2ODI7CiAgICB0LmE1NyA9IDcwMTsKICAgIHQuYTU4ID0gODI2OwogICAgdC5hNTkgPSA4MTU7CiAgICB0LmE2MCA9IDc4OTsKICAgIHQuYTYxID0gNzg5OwogICAgdC5hNjIgPSA3MDc7CiAgICB0LmE2MyA9IDY4NzsKICAgIHQuYTY0ID0gNjk2OwogICAgdC5hNjUgPSA2ODk7CiAgICB0LmE2NiA9IDc4NjsKICAgIHQuYTY3ID0gNzg3OwogICAgdC5hNjggPSA3MTM7CiAgICB0LmE2OSA9IDc5MTsKICAgIHQuYTcwID0gNzg1OwogICAgdC5hNzEgPSA3OTE7CiAgICB0LmE3MiA9IDg3MzsKICAgIHQuYTczID0gNzYxOwogICAgdC5hNzQgPSA3NjI7CiAgICB0LmEyMDMgPSA3NjI7CiAgICB0LmE3NSA9IDc1OTsKICAgIHQuYTIwNCA9IDc1OTsKICAgIHQuYTc2ID0gODkyOwogICAgdC5hNzcgPSA4OTI7CiAgICB0LmE3OCA9IDc4ODsKICAgIHQuYTc5ID0gNzg0OwogICAgdC5hODEgPSA0Mzg7CiAgICB0LmE4MiA9IDEzODsKICAgIHQuYTgzID0gMjc3OwogICAgdC5hODQgPSA0MTU7CiAgICB0LmE5NyA9IDM5MjsKICAgIHQuYTk4ID0gMzkyOwogICAgdC5hOTkgPSA2Njg7CiAgICB0LmExMDAgPSA2Njg7CiAgICB0LmE4OSA9IDM5MDsKICAgIHQuYTkwID0gMzkwOwogICAgdC5hOTMgPSAzMTc7CiAgICB0LmE5NCA9IDMxNzsKICAgIHQuYTkxID0gMjc2OwogICAgdC5hOTIgPSAyNzY7CiAgICB0LmEyMDUgPSA1MDk7CiAgICB0LmE4NSA9IDUwOTsKICAgIHQuYTIwNiA9IDQxMDsKICAgIHQuYTg2ID0gNDEwOwogICAgdC5hODcgPSAyMzQ7CiAgICB0LmE4OCA9IDIzNDsKICAgIHQuYTk1ID0gMzM0OwogICAgdC5hOTYgPSAzMzQ7CiAgICB0LmExMDEgPSA3MzI7CiAgICB0LmExMDIgPSA1NDQ7CiAgICB0LmExMDMgPSA1NDQ7CiAgICB0LmExMDQgPSA5MTA7CiAgICB0LmExMDYgPSA2Njc7CiAgICB0LmExMDcgPSA3NjA7CiAgICB0LmExMDggPSA3NjA7CiAgICB0LmExMTIgPSA3NzY7CiAgICB0LmExMTEgPSA1OTU7CiAgICB0LmExMTAgPSA2OTQ7CiAgICB0LmExMDkgPSA2MjY7CiAgICB0LmExMjAgPSA3ODg7CiAgICB0LmExMjEgPSA3ODg7CiAgICB0LmExMjIgPSA3ODg7CiAgICB0LmExMjMgPSA3ODg7CiAgICB0LmExMjQgPSA3ODg7CiAgICB0LmExMjUgPSA3ODg7CiAgICB0LmExMjYgPSA3ODg7CiAgICB0LmExMjcgPSA3ODg7CiAgICB0LmExMjggPSA3ODg7CiAgICB0LmExMjkgPSA3ODg7CiAgICB0LmExMzAgPSA3ODg7CiAgICB0LmExMzEgPSA3ODg7CiAgICB0LmExMzIgPSA3ODg7CiAgICB0LmExMzMgPSA3ODg7CiAgICB0LmExMzQgPSA3ODg7CiAgICB0LmExMzUgPSA3ODg7CiAgICB0LmExMzYgPSA3ODg7CiAgICB0LmExMzcgPSA3ODg7CiAgICB0LmExMzggPSA3ODg7CiAgICB0LmExMzkgPSA3ODg7CiAgICB0LmExNDAgPSA3ODg7CiAgICB0LmExNDEgPSA3ODg7CiAgICB0LmExNDIgPSA3ODg7CiAgICB0LmExNDMgPSA3ODg7CiAgICB0LmExNDQgPSA3ODg7CiAgICB0LmExNDUgPSA3ODg7CiAgICB0LmExNDYgPSA3ODg7CiAgICB0LmExNDcgPSA3ODg7CiAgICB0LmExNDggPSA3ODg7CiAgICB0LmExNDkgPSA3ODg7CiAgICB0LmExNTAgPSA3ODg7CiAgICB0LmExNTEgPSA3ODg7CiAgICB0LmExNTIgPSA3ODg7CiAgICB0LmExNTMgPSA3ODg7CiAgICB0LmExNTQgPSA3ODg7CiAgICB0LmExNTUgPSA3ODg7CiAgICB0LmExNTYgPSA3ODg7CiAgICB0LmExNTcgPSA3ODg7CiAgICB0LmExNTggPSA3ODg7CiAgICB0LmExNTkgPSA3ODg7CiAgICB0LmExNjAgPSA4OTQ7CiAgICB0LmExNjEgPSA4Mzg7CiAgICB0LmExNjMgPSAxMDE2OwogICAgdC5hMTY0ID0gNDU4OwogICAgdC5hMTk2ID0gNzQ4OwogICAgdC5hMTY1ID0gOTI0OwogICAgdC5hMTkyID0gNzQ4OwogICAgdC5hMTY2ID0gOTE4OwogICAgdC5hMTY3ID0gOTI3OwogICAgdC5hMTY4ID0gOTI4OwogICAgdC5hMTY5ID0gOTI4OwogICAgdC5hMTcwID0gODM0OwogICAgdC5hMTcxID0gODczOwogICAgdC5hMTcyID0gODI4OwogICAgdC5hMTczID0gOTI0OwogICAgdC5hMTYyID0gOTI0OwogICAgdC5hMTc0ID0gOTE3OwogICAgdC5hMTc1ID0gOTMwOwogICAgdC5hMTc2ID0gOTMxOwogICAgdC5hMTc3ID0gNDYzOwogICAgdC5hMTc4ID0gODgzOwogICAgdC5hMTc5ID0gODM2OwogICAgdC5hMTkzID0gODM2OwogICAgdC5hMTgwID0gODY3OwogICAgdC5hMTk5ID0gODY3OwogICAgdC5hMTgxID0gNjk2OwogICAgdC5hMjAwID0gNjk2OwogICAgdC5hMTgyID0gODc0OwogICAgdC5hMjAxID0gODc0OwogICAgdC5hMTgzID0gNzYwOwogICAgdC5hMTg0ID0gOTQ2OwogICAgdC5hMTk3ID0gNzcxOwogICAgdC5hMTg1ID0gODY1OwogICAgdC5hMTk0ID0gNzcxOwogICAgdC5hMTk4ID0gODg4OwogICAgdC5hMTg2ID0gOTY3OwogICAgdC5hMTk1ID0gODg4OwogICAgdC5hMTg3ID0gODMxOwogICAgdC5hMTg4ID0gODczOwogICAgdC5hMTg5ID0gOTI3OwogICAgdC5hMTkwID0gOTcwOwogICAgdC5hMTkxID0gOTE4OwogIH0pOwp9KTsKY29uc3QgZ2V0Rm9udEJhc2ljTWV0cmljcyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuQ291cmllciA9IHsKICAgIGFzY2VudDogNjI5LAogICAgZGVzY2VudDogLTE1NywKICAgIGNhcEhlaWdodDogNTYyLAogICAgeEhlaWdodDogLTQyNgogIH07CiAgdFsiQ291cmllci1Cb2xkIl0gPSB7CiAgICBhc2NlbnQ6IDYyOSwKICAgIGRlc2NlbnQ6IC0xNTcsCiAgICBjYXBIZWlnaHQ6IDU2MiwKICAgIHhIZWlnaHQ6IDQzOQogIH07CiAgdFsiQ291cmllci1PYmxpcXVlIl0gPSB7CiAgICBhc2NlbnQ6IDYyOSwKICAgIGRlc2NlbnQ6IC0xNTcsCiAgICBjYXBIZWlnaHQ6IDU2MiwKICAgIHhIZWlnaHQ6IDQyNgogIH07CiAgdFsiQ291cmllci1Cb2xkT2JsaXF1ZSJdID0gewogICAgYXNjZW50OiA2MjksCiAgICBkZXNjZW50OiAtMTU3LAogICAgY2FwSGVpZ2h0OiA1NjIsCiAgICB4SGVpZ2h0OiA0MjYKICB9OwogIHQuSGVsdmV0aWNhID0gewogICAgYXNjZW50OiA3MTgsCiAgICBkZXNjZW50OiAtMjA3LAogICAgY2FwSGVpZ2h0OiA3MTgsCiAgICB4SGVpZ2h0OiA1MjMKICB9OwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSB7CiAgICBhc2NlbnQ6IDcxOCwKICAgIGRlc2NlbnQ6IC0yMDcsCiAgICBjYXBIZWlnaHQ6IDcxOCwKICAgIHhIZWlnaHQ6IDUzMgogIH07CiAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9IHsKICAgIGFzY2VudDogNzE4LAogICAgZGVzY2VudDogLTIwNywKICAgIGNhcEhlaWdodDogNzE4LAogICAgeEhlaWdodDogNTIzCiAgfTsKICB0WyJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiXSA9IHsKICAgIGFzY2VudDogNzE4LAogICAgZGVzY2VudDogLTIwNywKICAgIGNhcEhlaWdodDogNzE4LAogICAgeEhlaWdodDogNTMyCiAgfTsKICB0WyJUaW1lcy1Sb21hbiJdID0gewogICAgYXNjZW50OiA2ODMsCiAgICBkZXNjZW50OiAtMjE3LAogICAgY2FwSGVpZ2h0OiA2NjIsCiAgICB4SGVpZ2h0OiA0NTAKICB9OwogIHRbIlRpbWVzLUJvbGQiXSA9IHsKICAgIGFzY2VudDogNjgzLAogICAgZGVzY2VudDogLTIxNywKICAgIGNhcEhlaWdodDogNjc2LAogICAgeEhlaWdodDogNDYxCiAgfTsKICB0WyJUaW1lcy1JdGFsaWMiXSA9IHsKICAgIGFzY2VudDogNjgzLAogICAgZGVzY2VudDogLTIxNywKICAgIGNhcEhlaWdodDogNjUzLAogICAgeEhlaWdodDogNDQxCiAgfTsKICB0WyJUaW1lcy1Cb2xkSXRhbGljIl0gPSB7CiAgICBhc2NlbnQ6IDY4MywKICAgIGRlc2NlbnQ6IC0yMTcsCiAgICBjYXBIZWlnaHQ6IDY2OSwKICAgIHhIZWlnaHQ6IDQ2MgogIH07CiAgdC5TeW1ib2wgPSB7CiAgICBhc2NlbnQ6IE1hdGguTmFOLAogICAgZGVzY2VudDogTWF0aC5OYU4sCiAgICBjYXBIZWlnaHQ6IE1hdGguTmFOLAogICAgeEhlaWdodDogTWF0aC5OYU4KICB9OwogIHQuWmFwZkRpbmdiYXRzID0gewogICAgYXNjZW50OiBNYXRoLk5hTiwKICAgIGRlc2NlbnQ6IE1hdGguTmFOLAogICAgY2FwSGVpZ2h0OiBNYXRoLk5hTiwKICAgIHhIZWlnaHQ6IE1hdGguTmFOCiAgfTsKfSk7Cgo7Ly8gLi9zcmMvY29yZS9nbHlmLmpzCmNvbnN0IE9OX0NVUlZFX1BPSU5UID0gMSA8PCAwOwpjb25zdCBYX1NIT1JUX1ZFQ1RPUiA9IDEgPDwgMTsKY29uc3QgWV9TSE9SVF9WRUNUT1IgPSAxIDw8IDI7CmNvbnN0IFJFUEVBVF9GTEFHID0gMSA8PCAzOwpjb25zdCBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IgPSAxIDw8IDQ7CmNvbnN0IFlfSVNfU0FNRV9PUl9QT1NJVElWRV9ZX1NIT1JUX1ZFQ1RPUiA9IDEgPDwgNTsKY29uc3QgT1ZFUkxBUF9TSU1QTEUgPSAxIDw8IDY7CmNvbnN0IEFSR18xX0FORF8yX0FSRV9XT1JEUyA9IDEgPDwgMDsKY29uc3QgQVJHU19BUkVfWFlfVkFMVUVTID0gMSA8PCAxOwpjb25zdCBXRV9IQVZFX0FfU0NBTEUgPSAxIDw8IDM7CmNvbnN0IE1PUkVfQ09NUE9ORU5UUyA9IDEgPDwgNTsKY29uc3QgV0VfSEFWRV9BTl9YX0FORF9ZX1NDQUxFID0gMSA8PCA2Owpjb25zdCBXRV9IQVZFX0FfVFdPX0JZX1RXTyA9IDEgPDwgNzsKY29uc3QgV0VfSEFWRV9JTlNUUlVDVElPTlMgPSAxIDw8IDg7CmNsYXNzIEdseWZUYWJsZSB7CiAgY29uc3RydWN0b3IoewogICAgZ2x5ZlRhYmxlLAogICAgaXNHbHlwaExvY2F0aW9uc0xvbmcsCiAgICBsb2NhVGFibGUsCiAgICBudW1HbHlwaHMKICB9KSB7CiAgICB0aGlzLmdseXBocyA9IFtdOwogICAgY29uc3QgbG9jYSA9IG5ldyBEYXRhVmlldyhsb2NhVGFibGUuYnVmZmVyLCBsb2NhVGFibGUuYnl0ZU9mZnNldCwgbG9jYVRhYmxlLmJ5dGVMZW5ndGgpOwogICAgY29uc3QgZ2x5ZiA9IG5ldyBEYXRhVmlldyhnbHlmVGFibGUuYnVmZmVyLCBnbHlmVGFibGUuYnl0ZU9mZnNldCwgZ2x5ZlRhYmxlLmJ5dGVMZW5ndGgpOwogICAgY29uc3Qgb2Zmc2V0U2l6ZSA9IGlzR2x5cGhMb2NhdGlvbnNMb25nID8gNCA6IDI7CiAgICBsZXQgcHJldiA9IGlzR2x5cGhMb2NhdGlvbnNMb25nID8gbG9jYS5nZXRVaW50MzIoMCkgOiAyICogbG9jYS5nZXRVaW50MTYoMCk7CiAgICBsZXQgcG9zID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtR2x5cGhzOyBpKyspIHsKICAgICAgcG9zICs9IG9mZnNldFNpemU7CiAgICAgIGNvbnN0IG5leHQgPSBpc0dseXBoTG9jYXRpb25zTG9uZyA/IGxvY2EuZ2V0VWludDMyKHBvcykgOiAyICogbG9jYS5nZXRVaW50MTYocG9zKTsKICAgICAgaWYgKG5leHQgPT09IHByZXYpIHsKICAgICAgICB0aGlzLmdseXBocy5wdXNoKG5ldyBHbHlwaCh7fSkpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGdseXBoID0gR2x5cGgucGFyc2UocHJldiwgZ2x5Zik7CiAgICAgIHRoaXMuZ2x5cGhzLnB1c2goZ2x5cGgpOwogICAgICBwcmV2ID0gbmV4dDsKICAgIH0KICB9CiAgZ2V0U2l6ZSgpIHsKICAgIHJldHVybiBNYXRoLnN1bVByZWNpc2UodGhpcy5nbHlwaHMubWFwKGcgPT4gZy5nZXRTaXplKCkgKyAzICYgfjMpKTsKICB9CiAgd3JpdGUoKSB7CiAgICBjb25zdCB0b3RhbFNpemUgPSB0aGlzLmdldFNpemUoKTsKICAgIGNvbnN0IGdseWZUYWJsZSA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIodG90YWxTaXplKSk7CiAgICBjb25zdCBpc0xvY2F0aW9uTG9uZyA9IHRvdGFsU2l6ZSA+IDB4MWZmZmU7CiAgICBjb25zdCBvZmZzZXRTaXplID0gaXNMb2NhdGlvbkxvbmcgPyA0IDogMjsKICAgIGNvbnN0IGxvY2FUYWJsZSA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoKHRoaXMuZ2x5cGhzLmxlbmd0aCArIDEpICogb2Zmc2V0U2l6ZSkpOwogICAgaWYgKGlzTG9jYXRpb25Mb25nKSB7CiAgICAgIGxvY2FUYWJsZS5zZXRVaW50MzIoMCwgMCk7CiAgICB9IGVsc2UgewogICAgICBsb2NhVGFibGUuc2V0VWludDE2KDAsIDApOwogICAgfQogICAgbGV0IHBvcyA9IDA7CiAgICBsZXQgbG9jYUluZGV4ID0gMDsKICAgIGZvciAoY29uc3QgZ2x5cGggb2YgdGhpcy5nbHlwaHMpIHsKICAgICAgcG9zICs9IGdseXBoLndyaXRlKHBvcywgZ2x5ZlRhYmxlKTsKICAgICAgcG9zID0gcG9zICsgMyAmIH4zOwogICAgICBsb2NhSW5kZXggKz0gb2Zmc2V0U2l6ZTsKICAgICAgaWYgKGlzTG9jYXRpb25Mb25nKSB7CiAgICAgICAgbG9jYVRhYmxlLnNldFVpbnQzMihsb2NhSW5kZXgsIHBvcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9jYVRhYmxlLnNldFVpbnQxNihsb2NhSW5kZXgsIHBvcyA+PiAxKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgaXNMb2NhdGlvbkxvbmcsCiAgICAgIGxvY2E6IG5ldyBVaW50OEFycmF5KGxvY2FUYWJsZS5idWZmZXIpLAogICAgICBnbHlmOiBuZXcgVWludDhBcnJheShnbHlmVGFibGUuYnVmZmVyKQogICAgfTsKICB9CiAgc2NhbGUoZmFjdG9ycykgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5nbHlwaHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICB0aGlzLmdseXBoc1tpXS5zY2FsZShmYWN0b3JzW2ldKTsKICAgIH0KICB9Cn0KY2xhc3MgR2x5cGggewogIGNvbnN0cnVjdG9yKHsKICAgIGhlYWRlciA9IG51bGwsCiAgICBzaW1wbGUgPSBudWxsLAogICAgY29tcG9zaXRlcyA9IG51bGwKICB9KSB7CiAgICB0aGlzLmhlYWRlciA9IGhlYWRlcjsKICAgIHRoaXMuc2ltcGxlID0gc2ltcGxlOwogICAgdGhpcy5jb21wb3NpdGVzID0gY29tcG9zaXRlczsKICB9CiAgc3RhdGljIHBhcnNlKHBvcywgZ2x5ZikgewogICAgY29uc3QgW3JlYWQsIGhlYWRlcl0gPSBHbHlwaEhlYWRlci5wYXJzZShwb3MsIGdseWYpOwogICAgcG9zICs9IHJlYWQ7CiAgICBpZiAoaGVhZGVyLm51bWJlck9mQ29udG91cnMgPCAwKSB7CiAgICAgIGNvbnN0IGNvbXBvc2l0ZXMgPSBbXTsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBjb25zdCBbbiwgY29tcG9zaXRlXSA9IENvbXBvc2l0ZUdseXBoLnBhcnNlKHBvcywgZ2x5Zik7CiAgICAgICAgcG9zICs9IG47CiAgICAgICAgY29tcG9zaXRlcy5wdXNoKGNvbXBvc2l0ZSk7CiAgICAgICAgaWYgKCEoY29tcG9zaXRlLmZsYWdzICYgTU9SRV9DT01QT05FTlRTKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXcgR2x5cGgoewogICAgICAgIGhlYWRlciwKICAgICAgICBjb21wb3NpdGVzCiAgICAgIH0pOwogICAgfQogICAgY29uc3Qgc2ltcGxlID0gU2ltcGxlR2x5cGgucGFyc2UocG9zLCBnbHlmLCBoZWFkZXIubnVtYmVyT2ZDb250b3Vycyk7CiAgICByZXR1cm4gbmV3IEdseXBoKHsKICAgICAgaGVhZGVyLAogICAgICBzaW1wbGUKICAgIH0pOwogIH0KICBnZXRTaXplKCkgewogICAgaWYgKCF0aGlzLmhlYWRlcikgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGNvbnN0IHNpemUgPSB0aGlzLnNpbXBsZSA/IHRoaXMuc2ltcGxlLmdldFNpemUoKSA6IE1hdGguc3VtUHJlY2lzZSh0aGlzLmNvbXBvc2l0ZXMubWFwKGMgPT4gYy5nZXRTaXplKCkpKTsKICAgIHJldHVybiB0aGlzLmhlYWRlci5nZXRTaXplKCkgKyBzaXplOwogIH0KICB3cml0ZShwb3MsIGJ1ZikgewogICAgaWYgKCF0aGlzLmhlYWRlcikgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGNvbnN0IHNwb3MgPSBwb3M7CiAgICBwb3MgKz0gdGhpcy5oZWFkZXIud3JpdGUocG9zLCBidWYpOwogICAgaWYgKHRoaXMuc2ltcGxlKSB7CiAgICAgIHBvcyArPSB0aGlzLnNpbXBsZS53cml0ZShwb3MsIGJ1Zik7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGNvbXBvc2l0ZSBvZiB0aGlzLmNvbXBvc2l0ZXMpIHsKICAgICAgICBwb3MgKz0gY29tcG9zaXRlLndyaXRlKHBvcywgYnVmKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBvcyAtIHNwb3M7CiAgfQogIHNjYWxlKGZhY3RvcikgewogICAgaWYgKCF0aGlzLmhlYWRlcikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB4TWlkZGxlID0gKHRoaXMuaGVhZGVyLnhNaW4gKyB0aGlzLmhlYWRlci54TWF4KSAvIDI7CiAgICB0aGlzLmhlYWRlci5zY2FsZSh4TWlkZGxlLCBmYWN0b3IpOwogICAgaWYgKHRoaXMuc2ltcGxlKSB7CiAgICAgIHRoaXMuc2ltcGxlLnNjYWxlKHhNaWRkbGUsIGZhY3Rvcik7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGNvbXBvc2l0ZSBvZiB0aGlzLmNvbXBvc2l0ZXMpIHsKICAgICAgICBjb21wb3NpdGUuc2NhbGUoeE1pZGRsZSwgZmFjdG9yKTsKICAgICAgfQogICAgfQogIH0KfQpjbGFzcyBHbHlwaEhlYWRlciB7CiAgY29uc3RydWN0b3IoewogICAgbnVtYmVyT2ZDb250b3VycywKICAgIHhNaW4sCiAgICB5TWluLAogICAgeE1heCwKICAgIHlNYXgKICB9KSB7CiAgICB0aGlzLm51bWJlck9mQ29udG91cnMgPSBudW1iZXJPZkNvbnRvdXJzOwogICAgdGhpcy54TWluID0geE1pbjsKICAgIHRoaXMueU1pbiA9IHlNaW47CiAgICB0aGlzLnhNYXggPSB4TWF4OwogICAgdGhpcy55TWF4ID0geU1heDsKICB9CiAgc3RhdGljIHBhcnNlKHBvcywgZ2x5ZikgewogICAgcmV0dXJuIFsxMCwgbmV3IEdseXBoSGVhZGVyKHsKICAgICAgbnVtYmVyT2ZDb250b3VyczogZ2x5Zi5nZXRJbnQxNihwb3MpLAogICAgICB4TWluOiBnbHlmLmdldEludDE2KHBvcyArIDIpLAogICAgICB5TWluOiBnbHlmLmdldEludDE2KHBvcyArIDQpLAogICAgICB4TWF4OiBnbHlmLmdldEludDE2KHBvcyArIDYpLAogICAgICB5TWF4OiBnbHlmLmdldEludDE2KHBvcyArIDgpCiAgICB9KV07CiAgfQogIGdldFNpemUoKSB7CiAgICByZXR1cm4gMTA7CiAgfQogIHdyaXRlKHBvcywgYnVmKSB7CiAgICBidWYuc2V0SW50MTYocG9zLCB0aGlzLm51bWJlck9mQ29udG91cnMpOwogICAgYnVmLnNldEludDE2KHBvcyArIDIsIHRoaXMueE1pbik7CiAgICBidWYuc2V0SW50MTYocG9zICsgNCwgdGhpcy55TWluKTsKICAgIGJ1Zi5zZXRJbnQxNihwb3MgKyA2LCB0aGlzLnhNYXgpOwogICAgYnVmLnNldEludDE2KHBvcyArIDgsIHRoaXMueU1heCk7CiAgICByZXR1cm4gMTA7CiAgfQogIHNjYWxlKHgsIGZhY3RvcikgewogICAgdGhpcy54TWluID0gTWF0aC5yb3VuZCh4ICsgKHRoaXMueE1pbiAtIHgpICogZmFjdG9yKTsKICAgIHRoaXMueE1heCA9IE1hdGgucm91bmQoeCArICh0aGlzLnhNYXggLSB4KSAqIGZhY3Rvcik7CiAgfQp9CmNsYXNzIENvbnRvdXIgewogIGNvbnN0cnVjdG9yKHsKICAgIGZsYWdzLAogICAgeENvb3JkaW5hdGVzLAogICAgeUNvb3JkaW5hdGVzCiAgfSkgewogICAgdGhpcy54Q29vcmRpbmF0ZXMgPSB4Q29vcmRpbmF0ZXM7CiAgICB0aGlzLnlDb29yZGluYXRlcyA9IHlDb29yZGluYXRlczsKICAgIHRoaXMuZmxhZ3MgPSBmbGFnczsKICB9Cn0KY2xhc3MgU2ltcGxlR2x5cGggewogIGNvbnN0cnVjdG9yKHsKICAgIGNvbnRvdXJzLAogICAgaW5zdHJ1Y3Rpb25zCiAgfSkgewogICAgdGhpcy5jb250b3VycyA9IGNvbnRvdXJzOwogICAgdGhpcy5pbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnM7CiAgfQogIHN0YXRpYyBwYXJzZShwb3MsIGdseWYsIG51bWJlck9mQ29udG91cnMpIHsKICAgIGNvbnN0IGVuZFB0c09mQ29udG91cnMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZDb250b3VyczsgaSsrKSB7CiAgICAgIGNvbnN0IGVuZFB0ID0gZ2x5Zi5nZXRVaW50MTYocG9zKTsKICAgICAgcG9zICs9IDI7CiAgICAgIGVuZFB0c09mQ29udG91cnMucHVzaChlbmRQdCk7CiAgICB9CiAgICBjb25zdCBudW1iZXJPZlB0ID0gZW5kUHRzT2ZDb250b3Vyc1tudW1iZXJPZkNvbnRvdXJzIC0gMV0gKyAxOwogICAgY29uc3QgaW5zdHJ1Y3Rpb25MZW5ndGggPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgcG9zICs9IDI7CiAgICBjb25zdCBpbnN0cnVjdGlvbnMgPSBuZXcgVWludDhBcnJheShnbHlmKS5zbGljZShwb3MsIHBvcyArIGluc3RydWN0aW9uTGVuZ3RoKTsKICAgIHBvcyArPSBpbnN0cnVjdGlvbkxlbmd0aDsKICAgIGNvbnN0IGZsYWdzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mUHQ7IHBvcysrLCBpKyspIHsKICAgICAgbGV0IGZsYWcgPSBnbHlmLmdldFVpbnQ4KHBvcyk7CiAgICAgIGZsYWdzLnB1c2goZmxhZyk7CiAgICAgIGlmIChmbGFnICYgUkVQRUFUX0ZMQUcpIHsKICAgICAgICBjb25zdCBjb3VudCA9IGdseWYuZ2V0VWludDgoKytwb3MpOwogICAgICAgIGZsYWcgXj0gUkVQRUFUX0ZMQUc7CiAgICAgICAgZm9yIChsZXQgbSA9IDA7IG0gPCBjb3VudDsgbSsrKSB7CiAgICAgICAgICBmbGFncy5wdXNoKGZsYWcpOwogICAgICAgIH0KICAgICAgICBpICs9IGNvdW50OwogICAgICB9CiAgICB9CiAgICBjb25zdCBhbGxYQ29vcmRpbmF0ZXMgPSBbXTsKICAgIGxldCB4Q29vcmRpbmF0ZXMgPSBbXTsKICAgIGxldCB5Q29vcmRpbmF0ZXMgPSBbXTsKICAgIGxldCBwb2ludEZsYWdzID0gW107CiAgICBjb25zdCBjb250b3VycyA9IFtdOwogICAgbGV0IGVuZFB0c09mQ29udG91cnNJbmRleCA9IDA7CiAgICBsZXQgbGFzdENvb3JkaW5hdGUgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZlB0OyBpKyspIHsKICAgICAgY29uc3QgZmxhZyA9IGZsYWdzW2ldOwogICAgICBpZiAoZmxhZyAmIFhfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgY29uc3QgeCA9IGdseWYuZ2V0VWludDgocG9zKyspOwogICAgICAgIGxhc3RDb29yZGluYXRlICs9IGZsYWcgJiBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IgPyB4IDogLXg7CiAgICAgICAgeENvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9IGVsc2UgaWYgKGZsYWcgJiBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IpIHsKICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGFzdENvb3JkaW5hdGUgKz0gZ2x5Zi5nZXRJbnQxNihwb3MpOwogICAgICAgIHBvcyArPSAyOwogICAgICAgIHhDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfQogICAgICBpZiAoZW5kUHRzT2ZDb250b3Vyc1tlbmRQdHNPZkNvbnRvdXJzSW5kZXhdID09PSBpKSB7CiAgICAgICAgZW5kUHRzT2ZDb250b3Vyc0luZGV4Kys7CiAgICAgICAgYWxsWENvb3JkaW5hdGVzLnB1c2goeENvb3JkaW5hdGVzKTsKICAgICAgICB4Q29vcmRpbmF0ZXMgPSBbXTsKICAgICAgfQogICAgfQogICAgbGFzdENvb3JkaW5hdGUgPSAwOwogICAgZW5kUHRzT2ZDb250b3Vyc0luZGV4ID0gMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZQdDsgaSsrKSB7CiAgICAgIGNvbnN0IGZsYWcgPSBmbGFnc1tpXTsKICAgICAgaWYgKGZsYWcgJiBZX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIGNvbnN0IHkgPSBnbHlmLmdldFVpbnQ4KHBvcysrKTsKICAgICAgICBsYXN0Q29vcmRpbmF0ZSArPSBmbGFnICYgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SID8geSA6IC15OwogICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfSBlbHNlIGlmIChmbGFnICYgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9IGVsc2UgewogICAgICAgIGxhc3RDb29yZGluYXRlICs9IGdseWYuZ2V0SW50MTYocG9zKTsKICAgICAgICBwb3MgKz0gMjsKICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0KICAgICAgcG9pbnRGbGFncy5wdXNoKGZsYWcgJiBPTl9DVVJWRV9QT0lOVCB8IGZsYWcgJiBPVkVSTEFQX1NJTVBMRSk7CiAgICAgIGlmIChlbmRQdHNPZkNvbnRvdXJzW2VuZFB0c09mQ29udG91cnNJbmRleF0gPT09IGkpIHsKICAgICAgICB4Q29vcmRpbmF0ZXMgPSBhbGxYQ29vcmRpbmF0ZXNbZW5kUHRzT2ZDb250b3Vyc0luZGV4XTsKICAgICAgICBlbmRQdHNPZkNvbnRvdXJzSW5kZXgrKzsKICAgICAgICBjb250b3Vycy5wdXNoKG5ldyBDb250b3VyKHsKICAgICAgICAgIGZsYWdzOiBwb2ludEZsYWdzLAogICAgICAgICAgeENvb3JkaW5hdGVzLAogICAgICAgICAgeUNvb3JkaW5hdGVzCiAgICAgICAgfSkpOwogICAgICAgIHlDb29yZGluYXRlcyA9IFtdOwogICAgICAgIHBvaW50RmxhZ3MgPSBbXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5ldyBTaW1wbGVHbHlwaCh7CiAgICAgIGNvbnRvdXJzLAogICAgICBpbnN0cnVjdGlvbnMKICAgIH0pOwogIH0KICBnZXRTaXplKCkgewogICAgbGV0IHNpemUgPSB0aGlzLmNvbnRvdXJzLmxlbmd0aCAqIDIgKyAyICsgdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoOwogICAgbGV0IGxhc3RYID0gMDsKICAgIGxldCBsYXN0WSA9IDA7CiAgICBmb3IgKGNvbnN0IGNvbnRvdXIgb2YgdGhpcy5jb250b3VycykgewogICAgICBzaXplICs9IGNvbnRvdXIuZmxhZ3MubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjb250b3VyLnhDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgeCA9IGNvbnRvdXIueENvb3JkaW5hdGVzW2ldOwogICAgICAgIGNvbnN0IHkgPSBjb250b3VyLnlDb29yZGluYXRlc1tpXTsKICAgICAgICBsZXQgYWJzID0gTWF0aC5hYnMoeCAtIGxhc3RYKTsKICAgICAgICBpZiAoYWJzID4gMjU1KSB7CiAgICAgICAgICBzaXplICs9IDI7CiAgICAgICAgfSBlbHNlIGlmIChhYnMgPiAwKSB7CiAgICAgICAgICBzaXplICs9IDE7CiAgICAgICAgfQogICAgICAgIGxhc3RYID0geDsKICAgICAgICBhYnMgPSBNYXRoLmFicyh5IC0gbGFzdFkpOwogICAgICAgIGlmIChhYnMgPiAyNTUpIHsKICAgICAgICAgIHNpemUgKz0gMjsKICAgICAgICB9IGVsc2UgaWYgKGFicyA+IDApIHsKICAgICAgICAgIHNpemUgKz0gMTsKICAgICAgICB9CiAgICAgICAgbGFzdFkgPSB5OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2l6ZTsKICB9CiAgd3JpdGUocG9zLCBidWYpIHsKICAgIGNvbnN0IHNwb3MgPSBwb3M7CiAgICBjb25zdCB4Q29vcmRpbmF0ZXMgPSBbXTsKICAgIGNvbnN0IHlDb29yZGluYXRlcyA9IFtdOwogICAgY29uc3QgZmxhZ3MgPSBbXTsKICAgIGxldCBsYXN0WCA9IDA7CiAgICBsZXQgbGFzdFkgPSAwOwogICAgZm9yIChjb25zdCBjb250b3VyIG9mIHRoaXMuY29udG91cnMpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29udG91ci54Q29vcmRpbmF0ZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGxldCBmbGFnID0gY29udG91ci5mbGFnc1tpXTsKICAgICAgICBjb25zdCB4ID0gY29udG91ci54Q29vcmRpbmF0ZXNbaV07CiAgICAgICAgbGV0IGRlbHRhID0geCAtIGxhc3RYOwogICAgICAgIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgICAgZmxhZyB8PSBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1I7CiAgICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaCgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgYWJzID0gTWF0aC5hYnMoZGVsdGEpOwogICAgICAgICAgaWYgKGFicyA8PSAyNTUpIHsKICAgICAgICAgICAgZmxhZyB8PSBkZWx0YSA+PSAwID8gWF9TSE9SVF9WRUNUT1IgfCBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IgOiBYX1NIT1JUX1ZFQ1RPUjsKICAgICAgICAgICAgeENvb3JkaW5hdGVzLnB1c2goYWJzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHhDb29yZGluYXRlcy5wdXNoKGRlbHRhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGFzdFggPSB4OwogICAgICAgIGNvbnN0IHkgPSBjb250b3VyLnlDb29yZGluYXRlc1tpXTsKICAgICAgICBkZWx0YSA9IHkgLSBsYXN0WTsKICAgICAgICBpZiAoZGVsdGEgPT09IDApIHsKICAgICAgICAgIGZsYWcgfD0gWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SOwogICAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2goMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGFicyA9IE1hdGguYWJzKGRlbHRhKTsKICAgICAgICAgIGlmIChhYnMgPD0gMjU1KSB7CiAgICAgICAgICAgIGZsYWcgfD0gZGVsdGEgPj0gMCA/IFlfU0hPUlRfVkVDVE9SIHwgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SIDogWV9TSE9SVF9WRUNUT1I7CiAgICAgICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGFicyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaChkZWx0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxhc3RZID0geTsKICAgICAgICBmbGFncy5wdXNoKGZsYWcpOwogICAgICB9CiAgICAgIGJ1Zi5zZXRVaW50MTYocG9zLCB4Q29vcmRpbmF0ZXMubGVuZ3RoIC0gMSk7CiAgICAgIHBvcyArPSAyOwogICAgfQogICAgYnVmLnNldFVpbnQxNihwb3MsIHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aCk7CiAgICBwb3MgKz0gMjsKICAgIGlmICh0aGlzLmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgbmV3IFVpbnQ4QXJyYXkoYnVmLmJ1ZmZlciwgMCwgYnVmLmJ1ZmZlci5ieXRlTGVuZ3RoKS5zZXQodGhpcy5pbnN0cnVjdGlvbnMsIHBvcyk7CiAgICAgIHBvcyArPSB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICB9CiAgICBmb3IgKGNvbnN0IGZsYWcgb2YgZmxhZ3MpIHsKICAgICAgYnVmLnNldFVpbnQ4KHBvcysrLCBmbGFnKTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHhDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHggPSB4Q29vcmRpbmF0ZXNbaV07CiAgICAgIGNvbnN0IGZsYWcgPSBmbGFnc1tpXTsKICAgICAgaWYgKGZsYWcgJiBYX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIGJ1Zi5zZXRVaW50OChwb3MrKywgeCk7CiAgICAgIH0gZWxzZSBpZiAoIShmbGFnICYgWF9JU19TQU1FX09SX1BPU0lUSVZFX1hfU0hPUlRfVkVDVE9SKSkgewogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHgpOwogICAgICAgIHBvcyArPSAyOwogICAgICB9CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB5Q29vcmRpbmF0ZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCB5ID0geUNvb3JkaW5hdGVzW2ldOwogICAgICBjb25zdCBmbGFnID0gZmxhZ3NbaV07CiAgICAgIGlmIChmbGFnICYgWV9TSE9SVF9WRUNUT1IpIHsKICAgICAgICBidWYuc2V0VWludDgocG9zKyssIHkpOwogICAgICB9IGVsc2UgaWYgKCEoZmxhZyAmIFlfSVNfU0FNRV9PUl9QT1NJVElWRV9ZX1NIT1JUX1ZFQ1RPUikpIHsKICAgICAgICBidWYuc2V0SW50MTYocG9zLCB5KTsKICAgICAgICBwb3MgKz0gMjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBvcyAtIHNwb3M7CiAgfQogIHNjYWxlKHgsIGZhY3RvcikgewogICAgZm9yIChjb25zdCBjb250b3VyIG9mIHRoaXMuY29udG91cnMpIHsKICAgICAgaWYgKGNvbnRvdXIueENvb3JkaW5hdGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNvbnRvdXIueENvb3JkaW5hdGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb250b3VyLnhDb29yZGluYXRlc1tpXSA9IE1hdGgucm91bmQoeCArIChjb250b3VyLnhDb29yZGluYXRlc1tpXSAtIHgpICogZmFjdG9yKTsKICAgICAgfQogICAgfQogIH0KfQpjbGFzcyBDb21wb3NpdGVHbHlwaCB7CiAgY29uc3RydWN0b3IoewogICAgZmxhZ3MsCiAgICBnbHlwaEluZGV4LAogICAgYXJndW1lbnQxLAogICAgYXJndW1lbnQyLAogICAgdHJhbnNmLAogICAgaW5zdHJ1Y3Rpb25zCiAgfSkgewogICAgdGhpcy5mbGFncyA9IGZsYWdzOwogICAgdGhpcy5nbHlwaEluZGV4ID0gZ2x5cGhJbmRleDsKICAgIHRoaXMuYXJndW1lbnQxID0gYXJndW1lbnQxOwogICAgdGhpcy5hcmd1bWVudDIgPSBhcmd1bWVudDI7CiAgICB0aGlzLnRyYW5zZiA9IHRyYW5zZjsKICAgIHRoaXMuaW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb25zOwogIH0KICBzdGF0aWMgcGFyc2UocG9zLCBnbHlmKSB7CiAgICBjb25zdCBzcG9zID0gcG9zOwogICAgY29uc3QgdHJhbnNmID0gW107CiAgICBsZXQgZmxhZ3MgPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgY29uc3QgZ2x5cGhJbmRleCA9IGdseWYuZ2V0VWludDE2KHBvcyArIDIpOwogICAgcG9zICs9IDQ7CiAgICBsZXQgYXJndW1lbnQxLCBhcmd1bWVudDI7CiAgICBpZiAoZmxhZ3MgJiBBUkdfMV9BTkRfMl9BUkVfV09SRFMpIHsKICAgICAgaWYgKGZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRJbnQxNihwb3MpOwogICAgICAgIGFyZ3VtZW50MiA9IGdseWYuZ2V0SW50MTYocG9zICsgMik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRVaW50MTYocG9zKTsKICAgICAgICBhcmd1bWVudDIgPSBnbHlmLmdldFVpbnQxNihwb3MgKyAyKTsKICAgICAgfQogICAgICBwb3MgKz0gNDsKICAgICAgZmxhZ3MgXj0gQVJHXzFfQU5EXzJfQVJFX1dPUkRTOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRJbnQ4KHBvcyk7CiAgICAgICAgYXJndW1lbnQyID0gZ2x5Zi5nZXRJbnQ4KHBvcyArIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIGFyZ3VtZW50MSA9IGdseWYuZ2V0VWludDgocG9zKTsKICAgICAgICBhcmd1bWVudDIgPSBnbHlmLmdldFVpbnQ4KHBvcyArIDEpOwogICAgICB9CiAgICAgIHBvcyArPSAyOwogICAgfQogICAgaWYgKGZsYWdzICYgV0VfSEFWRV9BX1NDQUxFKSB7CiAgICAgIHRyYW5zZi5wdXNoKGdseWYuZ2V0VWludDE2KHBvcykpOwogICAgICBwb3MgKz0gMjsKICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiBXRV9IQVZFX0FOX1hfQU5EX1lfU0NBTEUpIHsKICAgICAgdHJhbnNmLnB1c2goZ2x5Zi5nZXRVaW50MTYocG9zKSwgZ2x5Zi5nZXRVaW50MTYocG9zICsgMikpOwogICAgICBwb3MgKz0gNDsKICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiBXRV9IQVZFX0FfVFdPX0JZX1RXTykgewogICAgICB0cmFuc2YucHVzaChnbHlmLmdldFVpbnQxNihwb3MpLCBnbHlmLmdldFVpbnQxNihwb3MgKyAyKSwgZ2x5Zi5nZXRVaW50MTYocG9zICsgNCksIGdseWYuZ2V0VWludDE2KHBvcyArIDYpKTsKICAgICAgcG9zICs9IDg7CiAgICB9CiAgICBsZXQgaW5zdHJ1Y3Rpb25zID0gbnVsbDsKICAgIGlmIChmbGFncyAmIFdFX0hBVkVfSU5TVFJVQ1RJT05TKSB7CiAgICAgIGNvbnN0IGluc3RydWN0aW9uTGVuZ3RoID0gZ2x5Zi5nZXRVaW50MTYocG9zKTsKICAgICAgcG9zICs9IDI7CiAgICAgIGluc3RydWN0aW9ucyA9IG5ldyBVaW50OEFycmF5KGdseWYpLnNsaWNlKHBvcywgcG9zICsgaW5zdHJ1Y3Rpb25MZW5ndGgpOwogICAgICBwb3MgKz0gaW5zdHJ1Y3Rpb25MZW5ndGg7CiAgICB9CiAgICByZXR1cm4gW3BvcyAtIHNwb3MsIG5ldyBDb21wb3NpdGVHbHlwaCh7CiAgICAgIGZsYWdzLAogICAgICBnbHlwaEluZGV4LAogICAgICBhcmd1bWVudDEsCiAgICAgIGFyZ3VtZW50MiwKICAgICAgdHJhbnNmLAogICAgICBpbnN0cnVjdGlvbnMKICAgIH0pXTsKICB9CiAgZ2V0U2l6ZSgpIHsKICAgIGxldCBzaXplID0gMiArIDIgKyB0aGlzLnRyYW5zZi5sZW5ndGggKiAyOwogICAgaWYgKHRoaXMuZmxhZ3MgJiBXRV9IQVZFX0lOU1RSVUNUSU9OUykgewogICAgICBzaXplICs9IDIgKyB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICB9CiAgICBzaXplICs9IDI7CiAgICBpZiAodGhpcy5mbGFncyAmIDIpIHsKICAgICAgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAxMjcgJiYgdGhpcy5hcmd1bWVudDIgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAxMjcpKSB7CiAgICAgICAgc2l6ZSArPSAyOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAyNTUgJiYgdGhpcy5hcmd1bWVudDIgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAyNTUpKSB7CiAgICAgIHNpemUgKz0gMjsKICAgIH0KICAgIHJldHVybiBzaXplOwogIH0KICB3cml0ZShwb3MsIGJ1ZikgewogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIGlmICh0aGlzLmZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgIGlmICghKHRoaXMuYXJndW1lbnQxID49IC0xMjggJiYgdGhpcy5hcmd1bWVudDEgPD0gMTI3ICYmIHRoaXMuYXJndW1lbnQyID49IC0xMjggJiYgdGhpcy5hcmd1bWVudDIgPD0gMTI3KSkgewogICAgICAgIHRoaXMuZmxhZ3MgfD0gQVJHXzFfQU5EXzJfQVJFX1dPUkRTOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAyNTUgJiYgdGhpcy5hcmd1bWVudDIgPj0gMCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAyNTUpKSB7CiAgICAgIHRoaXMuZmxhZ3MgfD0gQVJHXzFfQU5EXzJfQVJFX1dPUkRTOwogICAgfQogICAgYnVmLnNldFVpbnQxNihwb3MsIHRoaXMuZmxhZ3MpOwogICAgYnVmLnNldFVpbnQxNihwb3MgKyAyLCB0aGlzLmdseXBoSW5kZXgpOwogICAgcG9zICs9IDQ7CiAgICBpZiAodGhpcy5mbGFncyAmIEFSR18xX0FORF8yX0FSRV9XT1JEUykgewogICAgICBpZiAodGhpcy5mbGFncyAmIEFSR1NfQVJFX1hZX1ZBTFVFUykgewogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHRoaXMuYXJndW1lbnQxKTsKICAgICAgICBidWYuc2V0SW50MTYocG9zICsgMiwgdGhpcy5hcmd1bWVudDIpOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1Zi5zZXRVaW50MTYocG9zLCB0aGlzLmFyZ3VtZW50MSk7CiAgICAgICAgYnVmLnNldFVpbnQxNihwb3MgKyAyLCB0aGlzLmFyZ3VtZW50Mik7CiAgICAgIH0KICAgICAgcG9zICs9IDQ7CiAgICB9IGVsc2UgewogICAgICBidWYuc2V0VWludDgocG9zLCB0aGlzLmFyZ3VtZW50MSk7CiAgICAgIGJ1Zi5zZXRVaW50OChwb3MgKyAxLCB0aGlzLmFyZ3VtZW50Mik7CiAgICAgIHBvcyArPSAyOwogICAgfQogICAgaWYgKHRoaXMuZmxhZ3MgJiBXRV9IQVZFX0lOU1RSVUNUSU9OUykgewogICAgICBidWYuc2V0VWludDE2KHBvcywgdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoKTsKICAgICAgcG9zICs9IDI7CiAgICAgIGlmICh0aGlzLmluc3RydWN0aW9ucy5sZW5ndGgpIHsKICAgICAgICBuZXcgVWludDhBcnJheShidWYuYnVmZmVyLCAwLCBidWYuYnVmZmVyLmJ5dGVMZW5ndGgpLnNldCh0aGlzLmluc3RydWN0aW9ucywgcG9zKTsKICAgICAgICBwb3MgKz0gdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9zIC0gc3BvczsKICB9CiAgc2NhbGUoeCwgZmFjdG9yKSB7fQp9Cgo7Ly8gLi9zcmMvY29yZS9vcGVudHlwZV9maWxlX2J1aWxkZXIuanMKCgpmdW5jdGlvbiB3cml0ZUludDE2KGRlc3QsIG9mZnNldCwgbnVtKSB7CiAgZGVzdFtvZmZzZXRdID0gbnVtID4+IDggJiAweGZmOwogIGRlc3Rbb2Zmc2V0ICsgMV0gPSBudW0gJiAweGZmOwp9CmZ1bmN0aW9uIHdyaXRlSW50MzIoZGVzdCwgb2Zmc2V0LCBudW0pIHsKICBkZXN0W29mZnNldF0gPSBudW0gPj4gMjQgJiAweGZmOwogIGRlc3Rbb2Zmc2V0ICsgMV0gPSBudW0gPj4gMTYgJiAweGZmOwogIGRlc3Rbb2Zmc2V0ICsgMl0gPSBudW0gPj4gOCAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAzXSA9IG51bSAmIDB4ZmY7Cn0KZnVuY3Rpb24gd3JpdGVEYXRhKGRlc3QsIG9mZnNldCwgZGF0YSkgewogIGlmIChkYXRhIGluc3RhbmNlb2YgVWludDhBcnJheSkgewogICAgZGVzdC5zZXQoZGF0YSwgb2Zmc2V0KTsKICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGRlc3Rbb2Zmc2V0KytdID0gZGF0YS5jaGFyQ29kZUF0KGkpICYgMHhmZjsKICAgIH0KICB9IGVsc2UgewogICAgZm9yIChjb25zdCBudW0gb2YgZGF0YSkgewogICAgICBkZXN0W29mZnNldCsrXSA9IG51bSAmIDB4ZmY7CiAgICB9CiAgfQp9CmNvbnN0IE9URl9IRUFERVJfU0laRSA9IDEyOwpjb25zdCBPVEZfVEFCTEVfRU5UUllfU0laRSA9IDE2OwpjbGFzcyBPcGVuVHlwZUZpbGVCdWlsZGVyIHsKICBjb25zdHJ1Y3RvcihzZm50KSB7CiAgICB0aGlzLnNmbnQgPSBzZm50OwogICAgdGhpcy50YWJsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICBzdGF0aWMgZ2V0U2VhcmNoUGFyYW1zKGVudHJpZXNDb3VudCwgZW50cnlTaXplKSB7CiAgICBsZXQgbWF4UG93ZXIyID0gMSwKICAgICAgbG9nMiA9IDA7CiAgICB3aGlsZSAoKG1heFBvd2VyMiBeIGVudHJpZXNDb3VudCkgPiBtYXhQb3dlcjIpIHsKICAgICAgbWF4UG93ZXIyIDw8PSAxOwogICAgICBsb2cyKys7CiAgICB9CiAgICBjb25zdCBzZWFyY2hSYW5nZSA9IG1heFBvd2VyMiAqIGVudHJ5U2l6ZTsKICAgIHJldHVybiB7CiAgICAgIHJhbmdlOiBzZWFyY2hSYW5nZSwKICAgICAgZW50cnk6IGxvZzIsCiAgICAgIHJhbmdlU2hpZnQ6IGVudHJ5U2l6ZSAqIGVudHJpZXNDb3VudCAtIHNlYXJjaFJhbmdlCiAgICB9OwogIH0KICB0b0FycmF5KCkgewogICAgbGV0IHNmbnQgPSB0aGlzLnNmbnQ7CiAgICBjb25zdCB0YWJsZXMgPSB0aGlzLnRhYmxlczsKICAgIGNvbnN0IHRhYmxlc05hbWVzID0gT2JqZWN0LmtleXModGFibGVzKTsKICAgIHRhYmxlc05hbWVzLnNvcnQoKTsKICAgIGNvbnN0IG51bVRhYmxlcyA9IHRhYmxlc05hbWVzLmxlbmd0aDsKICAgIGxldCBpLCBqLCBqaiwgdGFibGUsIHRhYmxlTmFtZTsKICAgIGxldCBvZmZzZXQgPSBPVEZfSEVBREVSX1NJWkUgKyBudW1UYWJsZXMgKiBPVEZfVEFCTEVfRU5UUllfU0laRTsKICAgIGNvbnN0IHRhYmxlT2Zmc2V0cyA9IFtvZmZzZXRdOwogICAgZm9yIChpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgIHRhYmxlID0gdGFibGVzW3RhYmxlc05hbWVzW2ldXTsKICAgICAgY29uc3QgcGFkZGVkTGVuZ3RoID0gKHRhYmxlLmxlbmd0aCArIDMgJiB+MykgPj4+IDA7CiAgICAgIG9mZnNldCArPSBwYWRkZWRMZW5ndGg7CiAgICAgIHRhYmxlT2Zmc2V0cy5wdXNoKG9mZnNldCk7CiAgICB9CiAgICBjb25zdCBmaWxlID0gbmV3IFVpbnQ4QXJyYXkob2Zmc2V0KTsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1UYWJsZXM7IGkrKykgewogICAgICB0YWJsZSA9IHRhYmxlc1t0YWJsZXNOYW1lc1tpXV07CiAgICAgIHdyaXRlRGF0YShmaWxlLCB0YWJsZU9mZnNldHNbaV0sIHRhYmxlKTsKICAgIH0KICAgIGlmIChzZm50ID09PSAidHJ1ZSIpIHsKICAgICAgc2ZudCA9IHN0cmluZzMyKDB4MDAwMTAwMDApOwogICAgfQogICAgZmlsZVswXSA9IHNmbnQuY2hhckNvZGVBdCgwKSAmIDB4ZmY7CiAgICBmaWxlWzFdID0gc2ZudC5jaGFyQ29kZUF0KDEpICYgMHhmZjsKICAgIGZpbGVbMl0gPSBzZm50LmNoYXJDb2RlQXQoMikgJiAweGZmOwogICAgZmlsZVszXSA9IHNmbnQuY2hhckNvZGVBdCgzKSAmIDB4ZmY7CiAgICB3cml0ZUludDE2KGZpbGUsIDQsIG51bVRhYmxlcyk7CiAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBPcGVuVHlwZUZpbGVCdWlsZGVyLmdldFNlYXJjaFBhcmFtcyhudW1UYWJsZXMsIDE2KTsKICAgIHdyaXRlSW50MTYoZmlsZSwgNiwgc2VhcmNoUGFyYW1zLnJhbmdlKTsKICAgIHdyaXRlSW50MTYoZmlsZSwgOCwgc2VhcmNoUGFyYW1zLmVudHJ5KTsKICAgIHdyaXRlSW50MTYoZmlsZSwgMTAsIHNlYXJjaFBhcmFtcy5yYW5nZVNoaWZ0KTsKICAgIG9mZnNldCA9IE9URl9IRUFERVJfU0laRTsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1UYWJsZXM7IGkrKykgewogICAgICB0YWJsZU5hbWUgPSB0YWJsZXNOYW1lc1tpXTsKICAgICAgZmlsZVtvZmZzZXRdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMCkgJiAweGZmOwogICAgICBmaWxlW29mZnNldCArIDFdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMSkgJiAweGZmOwogICAgICBmaWxlW29mZnNldCArIDJdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMikgJiAweGZmOwogICAgICBmaWxlW29mZnNldCArIDNdID0gdGFibGVOYW1lLmNoYXJDb2RlQXQoMykgJiAweGZmOwogICAgICBsZXQgY2hlY2tzdW0gPSAwOwogICAgICBmb3IgKGogPSB0YWJsZU9mZnNldHNbaV0sIGpqID0gdGFibGVPZmZzZXRzW2kgKyAxXTsgaiA8IGpqOyBqICs9IDQpIHsKICAgICAgICBjb25zdCBxdWFkID0gcmVhZFVpbnQzMihmaWxlLCBqKTsKICAgICAgICBjaGVja3N1bSA9IGNoZWNrc3VtICsgcXVhZCA+Pj4gMDsKICAgICAgfQogICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDQsIGNoZWNrc3VtKTsKICAgICAgd3JpdGVJbnQzMihmaWxlLCBvZmZzZXQgKyA4LCB0YWJsZU9mZnNldHNbaV0pOwogICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDEyLCB0YWJsZXNbdGFibGVOYW1lXS5sZW5ndGgpOwogICAgICBvZmZzZXQgKz0gT1RGX1RBQkxFX0VOVFJZX1NJWkU7CiAgICB9CiAgICByZXR1cm4gZmlsZTsKICB9CiAgYWRkVGFibGUodGFnLCBkYXRhKSB7CiAgICBpZiAodGFnIGluIHRoaXMudGFibGVzKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVGFibGUgIiArIHRhZyArICIgYWxyZWFkeSBleGlzdHMiKTsKICAgIH0KICAgIHRoaXMudGFibGVzW3RhZ10gPSBkYXRhOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvdHlwZTFfcGFyc2VyLmpzCgoKCgpjb25zdCBISU5USU5HX0VOQUJMRUQgPSBmYWxzZTsKY29uc3QgQ09NTUFORF9NQVAgPSB7CiAgaHN0ZW06IFsxXSwKICB2c3RlbTogWzNdLAogIHZtb3ZldG86IFs0XSwKICBybGluZXRvOiBbNV0sCiAgaGxpbmV0bzogWzZdLAogIHZsaW5ldG86IFs3XSwKICBycmN1cnZldG86IFs4XSwKICBjYWxsc3VicjogWzEwXSwKICBmbGV4OiBbMTIsIDM1XSwKICBkcm9wOiBbMTIsIDE4XSwKICBlbmRjaGFyOiBbMTRdLAogIHJtb3ZldG86IFsyMV0sCiAgaG1vdmV0bzogWzIyXSwKICB2aGN1cnZldG86IFszMF0sCiAgaHZjdXJ2ZXRvOiBbMzFdCn07CmNsYXNzIFR5cGUxQ2hhclN0cmluZyB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLndpZHRoID0gMDsKICAgIHRoaXMubHNiID0gMDsKICAgIHRoaXMuZmxleGluZyA9IGZhbHNlOwogICAgdGhpcy5vdXRwdXQgPSBbXTsKICAgIHRoaXMuc3RhY2sgPSBbXTsKICB9CiAgY29udmVydChlbmNvZGVkLCBzdWJycywgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgY29uc3QgY291bnQgPSBlbmNvZGVkLmxlbmd0aDsKICAgIGxldCBlcnJvciA9IGZhbHNlOwogICAgbGV0IHd4LCBzYngsIHN1YnJOdW1iZXI7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgbGV0IHZhbHVlID0gZW5jb2RlZFtpXTsKICAgICAgaWYgKHZhbHVlIDwgMzIpIHsKICAgICAgICBpZiAodmFsdWUgPT09IDEyKSB7CiAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSA8PCA4KSArIGVuY29kZWRbKytpXTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAuaHN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgaWYgKCFISU5USU5HX0VOQUJMRUQpIHsKICAgICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLnZzdGVtKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGlmICh0aGlzLmZsZXhpbmcpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZHkgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCgwLCBkeSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLnZtb3ZldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLnJsaW5ldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLmhsaW5ldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDEsIENPTU1BTkRfTUFQLnZsaW5ldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDYsIENPTU1BTkRfTUFQLnJyY3VydmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWJyTnVtYmVyID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKCFzdWJyc1tzdWJyTnVtYmVyXSkgewogICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuY29udmVydChzdWJyc1tzdWJyTnVtYmVyXSwgc3VicnMsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd3ggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBzYnggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLmxzYiA9IHNieDsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHd4OwogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2god3gsIHNieCk7CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5obW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICB0aGlzLm91dHB1dC5wdXNoKENPTU1BTkRfTUFQLmVuZGNoYXJbMF0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgIGlmICh0aGlzLmZsZXhpbmcpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAucm1vdmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgaWYgKHRoaXMuZmxleGluZykgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCgwKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAuaG1vdmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLnZoY3VydmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLmh2Y3VydmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAwOgogICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAxOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAudnN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMjoKICAgICAgICAgICAgaWYgKCFISU5USU5HX0VOQUJMRUQpIHsKICAgICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLmhzdGVtKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDY6CiAgICAgICAgICAgIGlmIChzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICAgICAgICAgICAgY29uc3QgYXNiID0gdGhpcy5zdGFjay5hdCgtNSk7CiAgICAgICAgICAgICAgdGhpcy5zZWFjID0gdGhpcy5zdGFjay5zcGxpY2UoLTQsIDQpOwogICAgICAgICAgICAgIHRoaXMuc2VhY1swXSArPSB0aGlzLmxzYiAtIGFzYjsKICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMCwgQ09NTUFORF9NQVAuZW5kY2hhcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDQsIENPTU1BTkRfTUFQLmVuZGNoYXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyA3OgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCA0KSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHd4ID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgY29uc3Qgc2J5ID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgc2J4ID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgdGhpcy5sc2IgPSBzYng7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3eDsKICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKHd4LCBzYngsIHNieSk7CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgzLCBDT01NQU5EX01BUC5ybW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDEyOgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG51bTIgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBjb25zdCBudW0xID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKG51bTEgLyBudW0yKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDE2OgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnJOdW1iZXIgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBjb25zdCBudW1BcmdzID0gdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKHN1YnJOdW1iZXIgPT09IDAgJiYgbnVtQXJncyA9PT0gMykgewogICAgICAgICAgICAgIGNvbnN0IGZsZXhBcmdzID0gdGhpcy5zdGFjay5zcGxpY2UoLTE3LCAxNyk7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKGZsZXhBcmdzWzJdICsgZmxleEFyZ3NbMF0sIGZsZXhBcmdzWzNdICsgZmxleEFyZ3NbMV0sIGZsZXhBcmdzWzRdLCBmbGV4QXJnc1s1XSwgZmxleEFyZ3NbNl0sIGZsZXhBcmdzWzddLCBmbGV4QXJnc1s4XSwgZmxleEFyZ3NbOV0sIGZsZXhBcmdzWzEwXSwgZmxleEFyZ3NbMTFdLCBmbGV4QXJnc1sxMl0sIGZsZXhBcmdzWzEzXSwgZmxleEFyZ3NbMTRdKTsKICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMTMsIENPTU1BTkRfTUFQLmZsZXgsIHRydWUpOwogICAgICAgICAgICAgIHRoaXMuZmxleGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaChmbGV4QXJnc1sxNV0sIGZsZXhBcmdzWzE2XSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Vick51bWJlciA9PT0gMSAmJiBudW1BcmdzID09PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5mbGV4aW5nID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMTc6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAzMzoKICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHdhcm4oJ1Vua25vd24gdHlwZSAxIGNoYXJzdHJpbmcgY29tbWFuZCBvZiAiJyArIHZhbHVlICsgJyInKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlIDw9IDI0NikgewogICAgICAgIHZhbHVlIC09IDEzOTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8PSAyNTApIHsKICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAtIDI0NykgKiAyNTYgKyBlbmNvZGVkWysraV0gKyAxMDg7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPD0gMjU0KSB7CiAgICAgICAgdmFsdWUgPSAtKCh2YWx1ZSAtIDI1MSkgKiAyNTYpIC0gZW5jb2RlZFsrK2ldIC0gMTA4OwogICAgICB9IGVsc2UgewogICAgICAgIHZhbHVlID0gKGVuY29kZWRbKytpXSAmIDB4ZmYpIDw8IDI0IHwgKGVuY29kZWRbKytpXSAmIDB4ZmYpIDw8IDE2IHwgKGVuY29kZWRbKytpXSAmIDB4ZmYpIDw8IDggfCAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgMDsKICAgICAgfQogICAgICB0aGlzLnN0YWNrLnB1c2godmFsdWUpOwogICAgfQogICAgcmV0dXJuIGVycm9yOwogIH0KICBleGVjdXRlQ29tbWFuZChob3dNYW55QXJncywgY29tbWFuZCwga2VlcFN0YWNrKSB7CiAgICBjb25zdCBzdGFja0xlbmd0aCA9IHRoaXMuc3RhY2subGVuZ3RoOwogICAgaWYgKGhvd01hbnlBcmdzID4gc3RhY2tMZW5ndGgpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb25zdCBzdGFydCA9IHN0YWNrTGVuZ3RoIC0gaG93TWFueUFyZ3M7CiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBzdGFja0xlbmd0aDsgaSsrKSB7CiAgICAgIGxldCB2YWx1ZSA9IHRoaXMuc3RhY2tbaV07CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSkgewogICAgICAgIHRoaXMub3V0cHV0LnB1c2goMjgsIHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhbHVlID0gNjU1MzYgKiB2YWx1ZSB8IDA7CiAgICAgICAgdGhpcy5vdXRwdXQucHVzaCgyNTUsIHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKICAgICAgfQogICAgfQogICAgdGhpcy5vdXRwdXQucHVzaCguLi5jb21tYW5kKTsKICAgIGlmIChrZWVwU3RhY2spIHsKICAgICAgdGhpcy5zdGFjay5zcGxpY2Uoc3RhcnQsIGhvd01hbnlBcmdzKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc3RhY2subGVuZ3RoID0gMDsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9Cn0KY29uc3QgRUVYRUNfRU5DUllQVF9LRVkgPSA1NTY2NTsKY29uc3QgQ0hBUl9TVFJTX0VOQ1JZUFRfS0VZID0gNDMzMDsKZnVuY3Rpb24gaXNIZXhEaWdpdChjb2RlKSB7CiAgcmV0dXJuIGNvZGUgPj0gNDggJiYgY29kZSA8PSA1NyB8fCBjb2RlID49IDY1ICYmIGNvZGUgPD0gNzAgfHwgY29kZSA+PSA5NyAmJiBjb2RlIDw9IDEwMjsKfQpmdW5jdGlvbiBkZWNyeXB0KGRhdGEsIGtleSwgZGlzY2FyZE51bWJlcikgewogIGlmIChkaXNjYXJkTnVtYmVyID49IGRhdGEubGVuZ3RoKSB7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgfQogIGNvbnN0IGMxID0gNTI4NDUsCiAgICBjMiA9IDIyNzE5OwogIGxldCByID0ga2V5IHwgMCwKICAgIGksCiAgICBqOwogIGZvciAoaSA9IDA7IGkgPCBkaXNjYXJkTnVtYmVyOyBpKyspIHsKICAgIHIgPSAoZGF0YVtpXSArIHIpICogYzEgKyBjMiAmICgxIDw8IDE2KSAtIDE7CiAgfQogIGNvbnN0IGNvdW50ID0gZGF0YS5sZW5ndGggLSBkaXNjYXJkTnVtYmVyOwogIGNvbnN0IGRlY3J5cHRlZCA9IG5ldyBVaW50OEFycmF5KGNvdW50KTsKICBmb3IgKGkgPSBkaXNjYXJkTnVtYmVyLCBqID0gMDsgaiA8IGNvdW50OyBpKyssIGorKykgewogICAgY29uc3QgdmFsdWUgPSBkYXRhW2ldOwogICAgZGVjcnlwdGVkW2pdID0gdmFsdWUgXiByID4+IDg7CiAgICByID0gKHZhbHVlICsgcikgKiBjMSArIGMyICYgKDEgPDwgMTYpIC0gMTsKICB9CiAgcmV0dXJuIGRlY3J5cHRlZDsKfQpmdW5jdGlvbiBkZWNyeXB0QXNjaWkoZGF0YSwga2V5LCBkaXNjYXJkTnVtYmVyKSB7CiAgY29uc3QgYzEgPSA1Mjg0NSwKICAgIGMyID0gMjI3MTk7CiAgbGV0IHIgPSBrZXkgfCAwOwogIGNvbnN0IGNvdW50ID0gZGF0YS5sZW5ndGgsCiAgICBtYXliZUxlbmd0aCA9IGNvdW50ID4+PiAxOwogIGNvbnN0IGRlY3J5cHRlZCA9IG5ldyBVaW50OEFycmF5KG1heWJlTGVuZ3RoKTsKICBsZXQgaSwgajsKICBmb3IgKGkgPSAwLCBqID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgIGNvbnN0IGRpZ2l0MSA9IGRhdGFbaV07CiAgICBpZiAoIWlzSGV4RGlnaXQoZGlnaXQxKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGkrKzsKICAgIGxldCBkaWdpdDI7CiAgICB3aGlsZSAoaSA8IGNvdW50ICYmICFpc0hleERpZ2l0KGRpZ2l0MiA9IGRhdGFbaV0pKSB7CiAgICAgIGkrKzsKICAgIH0KICAgIGlmIChpIDwgY291bnQpIHsKICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUludChTdHJpbmcuZnJvbUNoYXJDb2RlKGRpZ2l0MSwgZGlnaXQyKSwgMTYpOwogICAgICBkZWNyeXB0ZWRbaisrXSA9IHZhbHVlIF4gciA+PiA4OwogICAgICByID0gKHZhbHVlICsgcikgKiBjMSArIGMyICYgKDEgPDwgMTYpIC0gMTsKICAgIH0KICB9CiAgcmV0dXJuIGRlY3J5cHRlZC5zbGljZShkaXNjYXJkTnVtYmVyLCBqKTsKfQpmdW5jdGlvbiBpc1NwZWNpYWwoYykgewogIHJldHVybiBjID09PSAweDJmIHx8IGMgPT09IDB4NWIgfHwgYyA9PT0gMHg1ZCB8fCBjID09PSAweDdiIHx8IGMgPT09IDB4N2QgfHwgYyA9PT0gMHgyOCB8fCBjID09PSAweDI5Owp9CmNsYXNzIFR5cGUxUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGVuY3J5cHRlZCwgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgaWYgKGVuY3J5cHRlZCkgewogICAgICBjb25zdCBkYXRhID0gc3RyZWFtLmdldEJ5dGVzKCk7CiAgICAgIGNvbnN0IGlzQmluYXJ5ID0gISgoaXNIZXhEaWdpdChkYXRhWzBdKSB8fCBpc1doaXRlU3BhY2UoZGF0YVswXSkpICYmIGlzSGV4RGlnaXQoZGF0YVsxXSkgJiYgaXNIZXhEaWdpdChkYXRhWzJdKSAmJiBpc0hleERpZ2l0KGRhdGFbM10pICYmIGlzSGV4RGlnaXQoZGF0YVs0XSkgJiYgaXNIZXhEaWdpdChkYXRhWzVdKSAmJiBpc0hleERpZ2l0KGRhdGFbNl0pICYmIGlzSGV4RGlnaXQoZGF0YVs3XSkpOwogICAgICBzdHJlYW0gPSBuZXcgU3RyZWFtKGlzQmluYXJ5ID8gZGVjcnlwdChkYXRhLCBFRVhFQ19FTkNSWVBUX0tFWSwgNCkgOiBkZWNyeXB0QXNjaWkoZGF0YSwgRUVYRUNfRU5DUllQVF9LRVksIDQpKTsKICAgIH0KICAgIHRoaXMuc2VhY0FuYWx5c2lzRW5hYmxlZCA9ICEhc2VhY0FuYWx5c2lzRW5hYmxlZDsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5uZXh0Q2hhcigpOwogIH0KICByZWFkTnVtYmVyQXJyYXkoKSB7CiAgICB0aGlzLmdldFRva2VuKCk7CiAgICBjb25zdCBhcnJheSA9IFtdOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbiA9PT0gIl0iIHx8IHRva2VuID09PSAifSIpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBhcnJheS5wdXNoKHBhcnNlRmxvYXQodG9rZW4gfHwgMCkpOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KICByZWFkTnVtYmVyKCkgewogICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICByZXR1cm4gcGFyc2VGbG9hdCh0b2tlbiB8fCAwKTsKICB9CiAgcmVhZEludCgpIHsKICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgcmV0dXJuIHBhcnNlSW50KHRva2VuIHx8IDAsIDEwKSB8IDA7CiAgfQogIHJlYWRCb29sZWFuKCkgewogICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICByZXR1cm4gdG9rZW4gPT09ICJ0cnVlIiA/IDEgOiAwOwogIH0KICBuZXh0Q2hhcigpIHsKICAgIHJldHVybiB0aGlzLmN1cnJlbnRDaGFyID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwogIH0KICBwcmV2Q2hhcigpIHsKICAgIHRoaXMuc3RyZWFtLnNraXAoLTIpOwogICAgcmV0dXJuIHRoaXMuY3VycmVudENoYXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgfQogIGdldFRva2VuKCkgewogICAgbGV0IGNvbW1lbnQgPSBmYWxzZTsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY2ggPT09IC0xKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKGNvbW1lbnQpIHsKICAgICAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgICAgIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjUpIHsKICAgICAgICBjb21tZW50ID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmICghaXNXaGl0ZVNwYWNlKGNoKSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgfQogICAgaWYgKGlzU3BlY2lhbChjaCkpIHsKICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICB9CiAgICBsZXQgdG9rZW4gPSAiIjsKICAgIGRvIHsKICAgICAgdG9rZW4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgfSB3aGlsZSAoY2ggPj0gMCAmJiAhaXNXaGl0ZVNwYWNlKGNoKSAmJiAhaXNTcGVjaWFsKGNoKSk7CiAgICByZXR1cm4gdG9rZW47CiAgfQogIHJlYWRDaGFyU3RyaW5ncyhieXRlcywgbGVuSVYpIHsKICAgIGlmIChsZW5JViA9PT0gLTEpIHsKICAgICAgcmV0dXJuIGJ5dGVzOwogICAgfQogICAgcmV0dXJuIGRlY3J5cHQoYnl0ZXMsIENIQVJfU1RSU19FTkNSWVBUX0tFWSwgbGVuSVYpOwogIH0KICBleHRyYWN0Rm9udFByb2dyYW0ocHJvcGVydGllcykgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICBjb25zdCBzdWJycyA9IFtdLAogICAgICBjaGFyc3RyaW5ncyA9IFtdOwogICAgY29uc3QgcHJpdmF0ZURhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgcHJpdmF0ZURhdGEubGVuSVYgPSA0OwogICAgY29uc3QgcHJvZ3JhbSA9IHsKICAgICAgc3VicnM6IFtdLAogICAgICBjaGFyc3RyaW5nczogW10sCiAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICBwcml2YXRlRGF0YQogICAgICB9CiAgICB9OwogICAgbGV0IHRva2VuLCBsZW5ndGgsIGRhdGEsIGxlbklWOwogICAgd2hpbGUgKCh0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKSkgIT09IG51bGwpIHsKICAgICAgaWYgKHRva2VuICE9PSAiLyIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgc3dpdGNoICh0b2tlbikgewogICAgICAgIGNhc2UgIkNoYXJTdHJpbmdzIjoKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4gPT09ICJlbmQiKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRva2VuICE9PSAiLyIpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBnbHlwaCA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZGF0YSA9IGxlbmd0aCA+IDAgPyBzdHJlYW0uZ2V0Qnl0ZXMobGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgICBsZW5JViA9IHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YS5sZW5JVjsKICAgICAgICAgICAgY29uc3QgZW5jb2RlZCA9IHRoaXMucmVhZENoYXJTdHJpbmdzKGRhdGEsIGxlbklWKTsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgaWYgKHRva2VuID09PSAibm9hY2Nlc3MiKSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRva2VuID09PSAiLyIpIHsKICAgICAgICAgICAgICB0aGlzLnByZXZDaGFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hhcnN0cmluZ3MucHVzaCh7CiAgICAgICAgICAgICAgZ2x5cGgsCiAgICAgICAgICAgICAgZW5jb2RlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlN1YnJzIjoKICAgICAgICAgIHRoaXMucmVhZEludCgpOwogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgd2hpbGUgKHRoaXMuZ2V0VG9rZW4oKSA9PT0gImR1cCIpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZGF0YSA9IGxlbmd0aCA+IDAgPyBzdHJlYW0uZ2V0Qnl0ZXMobGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgICBsZW5JViA9IHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YS5sZW5JVjsKICAgICAgICAgICAgY29uc3QgZW5jb2RlZCA9IHRoaXMucmVhZENoYXJTdHJpbmdzKGRhdGEsIGxlbklWKTsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgaWYgKHRva2VuID09PSAibm9hY2Nlc3MiKSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnJzW2luZGV4XSA9IGVuY29kZWQ7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCbHVlVmFsdWVzIjoKICAgICAgICBjYXNlICJPdGhlckJsdWVzIjoKICAgICAgICBjYXNlICJGYW1pbHlCbHVlcyI6CiAgICAgICAgY2FzZSAiRmFtaWx5T3RoZXJCbHVlcyI6CiAgICAgICAgICBjb25zdCBibHVlQXJyYXkgPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgaWYgKGJsdWVBcnJheS5sZW5ndGggPiAwICYmIGJsdWVBcnJheS5sZW5ndGggJSAyID09PSAwICYmIEhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gYmx1ZUFycmF5OwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU3RlbVNuYXBIIjoKICAgICAgICBjYXNlICJTdGVtU25hcFYiOgogICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlckFycmF5KCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTdGRIVyI6CiAgICAgICAgY2FzZSAiU3RkVlciOgogICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlckFycmF5KClbMF07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCbHVlU2hpZnQiOgogICAgICAgIGNhc2UgImxlbklWIjoKICAgICAgICBjYXNlICJCbHVlRnV6eiI6CiAgICAgICAgY2FzZSAiQmx1ZVNjYWxlIjoKICAgICAgICBjYXNlICJMYW5ndWFnZUdyb3VwIjoKICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSB0aGlzLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkV4cGFuc2lvbkZhY3RvciI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkTnVtYmVyKCkgfHwgMC4wNjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvcmNlQm9sZCI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkQm9vbGVhbigpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgewogICAgICBlbmNvZGVkLAogICAgICBnbHlwaAogICAgfSBvZiBjaGFyc3RyaW5ncykgewogICAgICBjb25zdCBjaGFyU3RyaW5nID0gbmV3IFR5cGUxQ2hhclN0cmluZygpOwogICAgICBjb25zdCBlcnJvciA9IGNoYXJTdHJpbmcuY29udmVydChlbmNvZGVkLCBzdWJycywgdGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkKTsKICAgICAgbGV0IG91dHB1dCA9IGNoYXJTdHJpbmcub3V0cHV0OwogICAgICBpZiAoZXJyb3IpIHsKICAgICAgICBvdXRwdXQgPSBbMTRdOwogICAgICB9CiAgICAgIGNvbnN0IGNoYXJTdHJpbmdPYmplY3QgPSB7CiAgICAgICAgZ2x5cGhOYW1lOiBnbHlwaCwKICAgICAgICBjaGFyc3RyaW5nOiBvdXRwdXQsCiAgICAgICAgd2lkdGg6IGNoYXJTdHJpbmcud2lkdGgsCiAgICAgICAgbHNiOiBjaGFyU3RyaW5nLmxzYiwKICAgICAgICBzZWFjOiBjaGFyU3RyaW5nLnNlYWMKICAgICAgfTsKICAgICAgaWYgKGdseXBoID09PSAiLm5vdGRlZiIpIHsKICAgICAgICBwcm9ncmFtLmNoYXJzdHJpbmdzLnVuc2hpZnQoY2hhclN0cmluZ09iamVjdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvZ3JhbS5jaGFyc3RyaW5ncy5wdXNoKGNoYXJTdHJpbmdPYmplY3QpOwogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZykgewogICAgICAgIGNvbnN0IGluZGV4ID0gcHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcuaW5kZXhPZihnbHlwaCk7CiAgICAgICAgaWYgKGluZGV4ID4gLTEgJiYgcHJvcGVydGllcy53aWR0aHNbaW5kZXhdID09PSB1bmRlZmluZWQgJiYgaW5kZXggPj0gcHJvcGVydGllcy5maXJzdENoYXIgJiYgaW5kZXggPD0gcHJvcGVydGllcy5sYXN0Q2hhcikgewogICAgICAgICAgcHJvcGVydGllcy53aWR0aHNbaW5kZXhdID0gY2hhclN0cmluZy53aWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwcm9ncmFtOwogIH0KICBleHRyYWN0Rm9udEhlYWRlcihwcm9wZXJ0aWVzKSB7CiAgICBsZXQgdG9rZW47CiAgICB3aGlsZSAoKHRva2VuID0gdGhpcy5nZXRUb2tlbigpKSAhPT0gbnVsbCkgewogICAgICBpZiAodG9rZW4gIT09ICIvIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICBzd2l0Y2ggKHRva2VuKSB7CiAgICAgICAgY2FzZSAiRm9udE1hdHJpeCI6CiAgICAgICAgICBjb25zdCBtYXRyaXggPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgcHJvcGVydGllcy5mb250TWF0cml4ID0gbWF0cml4OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRW5jb2RpbmciOgogICAgICAgICAgY29uc3QgZW5jb2RpbmdBcmcgPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICBsZXQgZW5jb2Rpbmc7CiAgICAgICAgICBpZiAoIS9eXGQrJC8udGVzdChlbmNvZGluZ0FyZykpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBnZXRFbmNvZGluZyhlbmNvZGluZ0FyZyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbmNvZGluZyA9IFtdOwogICAgICAgICAgICBjb25zdCBzaXplID0gcGFyc2VJbnQoZW5jb2RpbmdBcmcsIDEwKSB8IDA7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaXplOyBqKyspIHsKICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICB3aGlsZSAodG9rZW4gIT09ICJkdXAiICYmIHRva2VuICE9PSAiZGVmIikgewogICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodG9rZW4gPT09ICJkZWYiKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgY29uc3QgZ2x5cGggPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgZW5jb2RpbmdbaW5kZXhdID0gZ2x5cGg7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZyA9IGVuY29kaW5nOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRm9udEJCb3giOgogICAgICAgICAgY29uc3QgZm9udEJCb3ggPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgcHJvcGVydGllcy5hc2NlbnQgPSBNYXRoLm1heChmb250QkJveFszXSwgZm9udEJCb3hbMV0pOwogICAgICAgICAgcHJvcGVydGllcy5kZXNjZW50ID0gTWF0aC5taW4oZm9udEJCb3hbMV0sIGZvbnRCQm94WzNdKTsKICAgICAgICAgIHByb3BlcnRpZXMuYXNjZW50U2NhbGVkID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS90eXBlMV9mb250LmpzCgoKCgoKCmZ1bmN0aW9uIGZpbmRCbG9jayhzdHJlYW1CeXRlcywgc2lnbmF0dXJlLCBzdGFydEluZGV4KSB7CiAgY29uc3Qgc3RyZWFtQnl0ZXNMZW5ndGggPSBzdHJlYW1CeXRlcy5sZW5ndGg7CiAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gc2lnbmF0dXJlLmxlbmd0aDsKICBjb25zdCBzY2FuTGVuZ3RoID0gc3RyZWFtQnl0ZXNMZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CiAgbGV0IGkgPSBzdGFydEluZGV4LAogICAgZm91bmQgPSBmYWxzZTsKICB3aGlsZSAoaSA8IHNjYW5MZW5ndGgpIHsKICAgIGxldCBqID0gMDsKICAgIHdoaWxlIChqIDwgc2lnbmF0dXJlTGVuZ3RoICYmIHN0cmVhbUJ5dGVzW2kgKyBqXSA9PT0gc2lnbmF0dXJlW2pdKSB7CiAgICAgIGorKzsKICAgIH0KICAgIGlmIChqID49IHNpZ25hdHVyZUxlbmd0aCkgewogICAgICBpICs9IGo7CiAgICAgIHdoaWxlIChpIDwgc3RyZWFtQnl0ZXNMZW5ndGggJiYgaXNXaGl0ZVNwYWNlKHN0cmVhbUJ5dGVzW2ldKSkgewogICAgICAgIGkrKzsKICAgICAgfQogICAgICBmb3VuZCA9IHRydWU7CiAgICAgIGJyZWFrOwogICAgfQogICAgaSsrOwogIH0KICByZXR1cm4gewogICAgZm91bmQsCiAgICBsZW5ndGg6IGkKICB9Owp9CmZ1bmN0aW9uIGdldEhlYWRlckJsb2NrKHN0cmVhbSwgc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgY29uc3QgRUVYRUNfU0lHTkFUVVJFID0gWzB4NjUsIDB4NjUsIDB4NzgsIDB4NjUsIDB4NjNdOwogIGNvbnN0IHN0cmVhbVN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICBsZXQgaGVhZGVyQnl0ZXMsIGhlYWRlckJ5dGVzTGVuZ3RoLCBibG9jazsKICB0cnkgewogICAgaGVhZGVyQnl0ZXMgPSBzdHJlYW0uZ2V0Qnl0ZXMoc3VnZ2VzdGVkTGVuZ3RoKTsKICAgIGhlYWRlckJ5dGVzTGVuZ3RoID0gaGVhZGVyQnl0ZXMubGVuZ3RoOwogIH0gY2F0Y2gge30KICBpZiAoaGVhZGVyQnl0ZXNMZW5ndGggPT09IHN1Z2dlc3RlZExlbmd0aCkgewogICAgYmxvY2sgPSBmaW5kQmxvY2soaGVhZGVyQnl0ZXMsIEVFWEVDX1NJR05BVFVSRSwgc3VnZ2VzdGVkTGVuZ3RoIC0gMiAqIEVFWEVDX1NJR05BVFVSRS5sZW5ndGgpOwogICAgaWYgKGJsb2NrLmZvdW5kICYmIGJsb2NrLmxlbmd0aCA9PT0gc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RyZWFtOiBuZXcgU3RyZWFtKGhlYWRlckJ5dGVzKSwKICAgICAgICBsZW5ndGg6IHN1Z2dlc3RlZExlbmd0aAogICAgICB9OwogICAgfQogIH0KICB3YXJuKCdJbnZhbGlkICJMZW5ndGgxIiBwcm9wZXJ0eSBpbiBUeXBlMSBmb250IC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogIHN0cmVhbS5wb3MgPSBzdHJlYW1TdGFydFBvczsKICBjb25zdCBTQ0FOX0JMT0NLX0xFTkdUSCA9IDIwNDg7CiAgbGV0IGFjdHVhbExlbmd0aDsKICB3aGlsZSAodHJ1ZSkgewogICAgY29uc3Qgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhTQ0FOX0JMT0NLX0xFTkdUSCk7CiAgICBibG9jayA9IGZpbmRCbG9jayhzY2FuQnl0ZXMsIEVFWEVDX1NJR05BVFVSRSwgMCk7CiAgICBpZiAoYmxvY2subGVuZ3RoID09PSAwKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgc3RyZWFtLnBvcyArPSBibG9jay5sZW5ndGg7CiAgICBpZiAoYmxvY2suZm91bmQpIHsKICAgICAgYWN0dWFsTGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0cmVhbVN0YXJ0UG9zOwogICAgICBicmVhazsKICAgIH0KICB9CiAgc3RyZWFtLnBvcyA9IHN0cmVhbVN0YXJ0UG9zOwogIGlmIChhY3R1YWxMZW5ndGgpIHsKICAgIHJldHVybiB7CiAgICAgIHN0cmVhbTogbmV3IFN0cmVhbShzdHJlYW0uZ2V0Qnl0ZXMoYWN0dWFsTGVuZ3RoKSksCiAgICAgIGxlbmd0aDogYWN0dWFsTGVuZ3RoCiAgICB9OwogIH0KICB3YXJuKCdVbmFibGUgdG8gcmVjb3ZlciAiTGVuZ3RoMSIgcHJvcGVydHkgaW4gVHlwZTEgZm9udCAtLSB1c2luZyBhcyBpcy4nKTsKICByZXR1cm4gewogICAgc3RyZWFtOiBuZXcgU3RyZWFtKHN0cmVhbS5nZXRCeXRlcyhzdWdnZXN0ZWRMZW5ndGgpKSwKICAgIGxlbmd0aDogc3VnZ2VzdGVkTGVuZ3RoCiAgfTsKfQpmdW5jdGlvbiBnZXRFZXhlY0Jsb2NrKHN0cmVhbSwgc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgY29uc3QgZWV4ZWNCeXRlcyA9IHN0cmVhbS5nZXRCeXRlcygpOwogIGlmIChlZXhlY0J5dGVzLmxlbmd0aCA9PT0gMCkgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJnZXRFZXhlY0Jsb2NrIC0gbm8gZm9udCBwcm9ncmFtIGZvdW5kLiIpOwogIH0KICByZXR1cm4gewogICAgc3RyZWFtOiBuZXcgU3RyZWFtKGVleGVjQnl0ZXMpLAogICAgbGVuZ3RoOiBlZXhlY0J5dGVzLmxlbmd0aAogIH07Cn0KY2xhc3MgVHlwZTFGb250IHsKICBjb25zdHJ1Y3RvcihuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCBQRkJfSEVBREVSX1NJWkUgPSA2OwogICAgbGV0IGhlYWRlckJsb2NrTGVuZ3RoID0gcHJvcGVydGllcy5sZW5ndGgxOwogICAgbGV0IGVleGVjQmxvY2tMZW5ndGggPSBwcm9wZXJ0aWVzLmxlbmd0aDI7CiAgICBsZXQgcGZiSGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoUEZCX0hFQURFUl9TSVpFKTsKICAgIGNvbnN0IHBmYkhlYWRlclByZXNlbnQgPSBwZmJIZWFkZXJbMF0gPT09IDB4ODAgJiYgcGZiSGVhZGVyWzFdID09PSAweDAxOwogICAgaWYgKHBmYkhlYWRlclByZXNlbnQpIHsKICAgICAgZmlsZS5za2lwKFBGQl9IRUFERVJfU0laRSk7CiAgICAgIGhlYWRlckJsb2NrTGVuZ3RoID0gcGZiSGVhZGVyWzVdIDw8IDI0IHwgcGZiSGVhZGVyWzRdIDw8IDE2IHwgcGZiSGVhZGVyWzNdIDw8IDggfCBwZmJIZWFkZXJbMl07CiAgICB9CiAgICBjb25zdCBoZWFkZXJCbG9jayA9IGdldEhlYWRlckJsb2NrKGZpbGUsIGhlYWRlckJsb2NrTGVuZ3RoKTsKICAgIGNvbnN0IGhlYWRlckJsb2NrUGFyc2VyID0gbmV3IFR5cGUxUGFyc2VyKGhlYWRlckJsb2NrLnN0cmVhbSwgZmFsc2UsIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICBoZWFkZXJCbG9ja1BhcnNlci5leHRyYWN0Rm9udEhlYWRlcihwcm9wZXJ0aWVzKTsKICAgIGlmIChwZmJIZWFkZXJQcmVzZW50KSB7CiAgICAgIHBmYkhlYWRlciA9IGZpbGUuZ2V0Qnl0ZXMoUEZCX0hFQURFUl9TSVpFKTsKICAgICAgZWV4ZWNCbG9ja0xlbmd0aCA9IHBmYkhlYWRlcls1XSA8PCAyNCB8IHBmYkhlYWRlcls0XSA8PCAxNiB8IHBmYkhlYWRlclszXSA8PCA4IHwgcGZiSGVhZGVyWzJdOwogICAgfQogICAgY29uc3QgZWV4ZWNCbG9jayA9IGdldEVleGVjQmxvY2soZmlsZSwgZWV4ZWNCbG9ja0xlbmd0aCk7CiAgICBjb25zdCBlZXhlY0Jsb2NrUGFyc2VyID0gbmV3IFR5cGUxUGFyc2VyKGVleGVjQmxvY2suc3RyZWFtLCB0cnVlLCBTRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgY29uc3QgZGF0YSA9IGVleGVjQmxvY2tQYXJzZXIuZXh0cmFjdEZvbnRQcm9ncmFtKHByb3BlcnRpZXMpOwogICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YS5wcm9wZXJ0aWVzKSB7CiAgICAgIHByb3BlcnRpZXNba2V5XSA9IGRhdGEucHJvcGVydGllc1trZXldOwogICAgfQogICAgY29uc3QgY2hhcnN0cmluZ3MgPSBkYXRhLmNoYXJzdHJpbmdzOwogICAgY29uc3QgdHlwZTJDaGFyc3RyaW5ncyA9IHRoaXMuZ2V0VHlwZTJDaGFyc3RyaW5ncyhjaGFyc3RyaW5ncyk7CiAgICBjb25zdCBzdWJycyA9IHRoaXMuZ2V0VHlwZTJTdWJycyhkYXRhLnN1YnJzKTsKICAgIHRoaXMuY2hhcnN0cmluZ3MgPSBjaGFyc3RyaW5nczsKICAgIHRoaXMuZGF0YSA9IHRoaXMud3JhcChuYW1lLCB0eXBlMkNoYXJzdHJpbmdzLCB0aGlzLmNoYXJzdHJpbmdzLCBzdWJycywgcHJvcGVydGllcyk7CiAgICB0aGlzLnNlYWNzID0gdGhpcy5nZXRTZWFjcyhkYXRhLmNoYXJzdHJpbmdzKTsKICB9CiAgZ2V0IG51bUdseXBocygpIHsKICAgIHJldHVybiB0aGlzLmNoYXJzdHJpbmdzLmxlbmd0aCArIDE7CiAgfQogIGdldENoYXJzZXQoKSB7CiAgICBjb25zdCBjaGFyc2V0ID0gWyIubm90ZGVmIl07CiAgICBmb3IgKGNvbnN0IHsKICAgICAgZ2x5cGhOYW1lCiAgICB9IG9mIHRoaXMuY2hhcnN0cmluZ3MpIHsKICAgICAgY2hhcnNldC5wdXNoKGdseXBoTmFtZSk7CiAgICB9CiAgICByZXR1cm4gY2hhcnNldDsKICB9CiAgZ2V0R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IGNoYXJzdHJpbmdzID0gdGhpcy5jaGFyc3RyaW5nczsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBjb25zdCBjaGFyQ29kZVRvR2x5cGhJZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGZvciAobGV0IGdseXBoSWQgPSAwLCBjaGFyc3RyaW5nc0xlbiA9IGNoYXJzdHJpbmdzLmxlbmd0aDsgZ2x5cGhJZCA8IGNoYXJzdHJpbmdzTGVuOyBnbHlwaElkKyspIHsKICAgICAgICBjb25zdCBjaGFyQ29kZSA9IHByb3BlcnRpZXMuY01hcC5jaGFyQ29kZU9mKGdseXBoSWQpOwogICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgKyAxOwogICAgICB9CiAgICAgIHJldHVybiBjaGFyQ29kZVRvR2x5cGhJZDsKICAgIH0KICAgIGNvbnN0IGdseXBoTmFtZXMgPSBbIi5ub3RkZWYiXTsKICAgIGxldCBidWlsdEluRW5jb2RpbmcsIGdseXBoSWQ7CiAgICBmb3IgKGdseXBoSWQgPSAwOyBnbHlwaElkIDwgY2hhcnN0cmluZ3MubGVuZ3RoOyBnbHlwaElkKyspIHsKICAgICAgZ2x5cGhOYW1lcy5wdXNoKGNoYXJzdHJpbmdzW2dseXBoSWRdLmdseXBoTmFtZSk7CiAgICB9CiAgICBjb25zdCBlbmNvZGluZyA9IHByb3BlcnRpZXMuYnVpbHRJbkVuY29kaW5nOwogICAgaWYgKGVuY29kaW5nKSB7CiAgICAgIGJ1aWx0SW5FbmNvZGluZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gZW5jb2RpbmcpIHsKICAgICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGVuY29kaW5nW2NoYXJDb2RlXSk7CiAgICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgICAgYnVpbHRJbkVuY29kaW5nW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHlwZTFGb250R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMsIGJ1aWx0SW5FbmNvZGluZywgZ2x5cGhOYW1lcyk7CiAgfQogIGhhc0dseXBoSWQoaWQpIHsKICAgIGlmIChpZCA8IDAgfHwgaWQgPj0gdGhpcy5udW1HbHlwaHMpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKGlkID09PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgY29uc3QgZ2x5cGggPSB0aGlzLmNoYXJzdHJpbmdzW2lkIC0gMV07CiAgICByZXR1cm4gZ2x5cGguY2hhcnN0cmluZy5sZW5ndGggPiAwOwogIH0KICBnZXRTZWFjcyhjaGFyc3RyaW5ncykgewogICAgY29uc3Qgc2VhY01hcCA9IFtdOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2hhcnN0cmluZ3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBjaGFyc3RyaW5nID0gY2hhcnN0cmluZ3NbaV07CiAgICAgIGlmIChjaGFyc3RyaW5nLnNlYWMpIHsKICAgICAgICBzZWFjTWFwW2kgKyAxXSA9IGNoYXJzdHJpbmcuc2VhYzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNlYWNNYXA7CiAgfQogIGdldFR5cGUyQ2hhcnN0cmluZ3ModHlwZTFDaGFyc3RyaW5ncykgewogICAgY29uc3QgdHlwZTJDaGFyc3RyaW5ncyA9IFtdOwogICAgZm9yIChjb25zdCB0eXBlMUNoYXJzdHJpbmcgb2YgdHlwZTFDaGFyc3RyaW5ncykgewogICAgICB0eXBlMkNoYXJzdHJpbmdzLnB1c2godHlwZTFDaGFyc3RyaW5nLmNoYXJzdHJpbmcpOwogICAgfQogICAgcmV0dXJuIHR5cGUyQ2hhcnN0cmluZ3M7CiAgfQogIGdldFR5cGUyU3VicnModHlwZTFTdWJycykgewogICAgbGV0IGJpYXMgPSAwOwogICAgY29uc3QgY291bnQgPSB0eXBlMVN1YnJzLmxlbmd0aDsKICAgIGlmIChjb3VudCA8IDExMzMpIHsKICAgICAgYmlhcyA9IDEwNzsKICAgIH0gZWxzZSBpZiAoY291bnQgPCAzMzc2OSkgewogICAgICBiaWFzID0gMTEzMTsKICAgIH0gZWxzZSB7CiAgICAgIGJpYXMgPSAzMjc2ODsKICAgIH0KICAgIGNvbnN0IHR5cGUyU3VicnMgPSBbXTsKICAgIGxldCBpOwogICAgZm9yIChpID0gMDsgaSA8IGJpYXM7IGkrKykgewogICAgICB0eXBlMlN1YnJzLnB1c2goWzB4MGJdKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIHR5cGUyU3VicnMucHVzaCh0eXBlMVN1YnJzW2ldKTsKICAgIH0KICAgIHJldHVybiB0eXBlMlN1YnJzOwogIH0KICB3cmFwKG5hbWUsIGdseXBocywgY2hhcnN0cmluZ3MsIHN1YnJzLCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCBjZmYgPSBuZXcgQ0ZGKCk7CiAgICBjZmYuaGVhZGVyID0gbmV3IENGRkhlYWRlcigxLCAwLCA0LCA0KTsKICAgIGNmZi5uYW1lcyA9IFtuYW1lXTsKICAgIGNvbnN0IHRvcERpY3QgPSBuZXcgQ0ZGVG9wRGljdCgpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoInZlcnNpb24iLCAzOTEpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIk5vdGljZSIsIDM5Mik7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRnVsbE5hbWUiLCAzOTMpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkZhbWlseU5hbWUiLCAzOTQpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIldlaWdodCIsIDM5NSk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRW5jb2RpbmciLCBudWxsKTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJGb250TWF0cml4IiwgcHJvcGVydGllcy5mb250TWF0cml4KTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJGb250QkJveCIsIHByb3BlcnRpZXMuYmJveCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiY2hhcnNldCIsIG51bGwpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkNoYXJTdHJpbmdzIiwgbnVsbCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiUHJpdmF0ZSIsIG51bGwpOwogICAgY2ZmLnRvcERpY3QgPSB0b3BEaWN0OwogICAgY29uc3Qgc3RyaW5ncyA9IG5ldyBDRkZTdHJpbmdzKCk7CiAgICBzdHJpbmdzLmFkZCgiVmVyc2lvbiAwLjExIik7CiAgICBzdHJpbmdzLmFkZCgiU2VlIG9yaWdpbmFsIG5vdGljZSIpOwogICAgc3RyaW5ncy5hZGQobmFtZSk7CiAgICBzdHJpbmdzLmFkZChuYW1lKTsKICAgIHN0cmluZ3MuYWRkKCJNZWRpdW0iKTsKICAgIGNmZi5zdHJpbmdzID0gc3RyaW5nczsKICAgIGNmZi5nbG9iYWxTdWJySW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGNvbnN0IGNvdW50ID0gZ2x5cGhzLmxlbmd0aDsKICAgIGNvbnN0IGNoYXJzZXRBcnJheSA9IFsiLm5vdGRlZiJdOwogICAgbGV0IGksIGlpOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgY29uc3QgZ2x5cGhOYW1lID0gY2hhcnN0cmluZ3NbaV0uZ2x5cGhOYW1lOwogICAgICBjb25zdCBpbmRleCA9IENGRlN0YW5kYXJkU3RyaW5ncy5pbmRleE9mKGdseXBoTmFtZSk7CiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBzdHJpbmdzLmFkZChnbHlwaE5hbWUpOwogICAgICB9CiAgICAgIGNoYXJzZXRBcnJheS5wdXNoKGdseXBoTmFtZSk7CiAgICB9CiAgICBjZmYuY2hhcnNldCA9IG5ldyBDRkZDaGFyc2V0KGZhbHNlLCAwLCBjaGFyc2V0QXJyYXkpOwogICAgY29uc3QgY2hhclN0cmluZ3NJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgY2hhclN0cmluZ3NJbmRleC5hZGQoWzB4OGIsIDB4MGVdKTsKICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIGNoYXJTdHJpbmdzSW5kZXguYWRkKGdseXBoc1tpXSk7CiAgICB9CiAgICBjZmYuY2hhclN0cmluZ3MgPSBjaGFyU3RyaW5nc0luZGV4OwogICAgY29uc3QgcHJpdmF0ZURpY3QgPSBuZXcgQ0ZGUHJpdmF0ZURpY3QoKTsKICAgIHByaXZhdGVEaWN0LnNldEJ5TmFtZSgiU3VicnMiLCBudWxsKTsKICAgIGNvbnN0IGZpZWxkcyA9IFsiQmx1ZVZhbHVlcyIsICJPdGhlckJsdWVzIiwgIkZhbWlseUJsdWVzIiwgIkZhbWlseU90aGVyQmx1ZXMiLCAiU3RlbVNuYXBIIiwgIlN0ZW1TbmFwViIsICJCbHVlU2hpZnQiLCAiQmx1ZUZ1enoiLCAiQmx1ZVNjYWxlIiwgIkxhbmd1YWdlR3JvdXAiLCAiRXhwYW5zaW9uRmFjdG9yIiwgIkZvcmNlQm9sZCIsICJTdGRIVyIsICJTdGRWVyJdOwogICAgZm9yIChpID0gMCwgaWkgPSBmaWVsZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1tpXTsKICAgICAgaWYgKCEoZmllbGQgaW4gcHJvcGVydGllcy5wcml2YXRlRGF0YSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IHByb3BlcnRpZXMucHJpdmF0ZURhdGFbZmllbGRdOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICBmb3IgKGxldCBqID0gdmFsdWUubGVuZ3RoIC0gMTsgaiA+IDA7IGotLSkgewogICAgICAgICAgdmFsdWVbal0gLT0gdmFsdWVbaiAtIDFdOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlRGljdC5zZXRCeU5hbWUoZmllbGQsIHZhbHVlKTsKICAgIH0KICAgIGNmZi50b3BEaWN0LnByaXZhdGVEaWN0ID0gcHJpdmF0ZURpY3Q7CiAgICBjb25zdCBzdWJySW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAoaSA9IDAsIGlpID0gc3VicnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBzdWJySW5kZXguYWRkKHN1YnJzW2ldKTsKICAgIH0KICAgIHByaXZhdGVEaWN0LnN1YnJzSW5kZXggPSBzdWJySW5kZXg7CiAgICBjb25zdCBjb21waWxlciA9IG5ldyBDRkZDb21waWxlcihjZmYpOwogICAgcmV0dXJuIGNvbXBpbGVyLmNvbXBpbGUoKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ZvbnRzLmpzCgoKCgoKCgoKCgoKCgoKCgoKY29uc3QgUFJJVkFURV9VU0VfQVJFQVMgPSBbWzB4ZTAwMCwgMHhmOGZmXSwgWzB4MTAwMDAwLCAweDEwZmZmZF1dOwpjb25zdCBQREZfR0xZUEhfU1BBQ0VfVU5JVFMgPSAxMDAwOwpjb25zdCBFWFBPUlRfREFUQV9QUk9QRVJUSUVTID0gWyJhc2NlbnQiLCAiYmJveCIsICJibGFjayIsICJib2xkIiwgImNoYXJQcm9jT3BlcmF0b3JMaXN0IiwgImNzc0ZvbnRJbmZvIiwgImRhdGEiLCAiZGVmYXVsdFZNZXRyaWNzIiwgImRlZmF1bHRXaWR0aCIsICJkZXNjZW50IiwgImRpc2FibGVGb250RmFjZSIsICJmYWxsYmFja05hbWUiLCAiZm9udEV4dHJhUHJvcGVydGllcyIsICJmb250TWF0cml4IiwgImlzSW52YWxpZFBERmpzRm9udCIsICJpc1R5cGUzRm9udCIsICJpdGFsaWMiLCAibG9hZGVkTmFtZSIsICJtaW1ldHlwZSIsICJtaXNzaW5nRmlsZSIsICJuYW1lIiwgInJlbWVhc3VyZSIsICJzeXN0ZW1Gb250SW5mbyIsICJ2ZXJ0aWNhbCJdOwpjb25zdCBFWFBPUlRfREFUQV9FWFRSQV9QUk9QRVJUSUVTID0gWyJjTWFwIiwgImNvbXBvc2l0ZSIsICJkZWZhdWx0RW5jb2RpbmciLCAiZGlmZmVyZW5jZXMiLCAiaXNNb25vc3BhY2UiLCAiaXNTZXJpZkZvbnQiLCAiaXNTeW1ib2xpY0ZvbnQiLCAic2VhY01hcCIsICJzdWJ0eXBlIiwgInRvRm9udENoYXIiLCAidG9Vbmljb2RlIiwgInR5cGUiLCAidm1ldHJpY3MiLCAid2lkdGhzIl07CmZ1bmN0aW9uIGFkanVzdFdpZHRocyhwcm9wZXJ0aWVzKSB7CiAgaWYgKCFwcm9wZXJ0aWVzLmZvbnRNYXRyaXgpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuZm9udE1hdHJpeFswXSA9PT0gRk9OVF9JREVOVElUWV9NQVRSSVhbMF0pIHsKICAgIHJldHVybjsKICB9CiAgY29uc3Qgc2NhbGUgPSAwLjAwMSAvIHByb3BlcnRpZXMuZm9udE1hdHJpeFswXTsKICBjb25zdCBnbHlwaHNXaWR0aHMgPSBwcm9wZXJ0aWVzLndpZHRoczsKICBmb3IgKGNvbnN0IGdseXBoIGluIGdseXBoc1dpZHRocykgewogICAgZ2x5cGhzV2lkdGhzW2dseXBoXSAqPSBzY2FsZTsKICB9CiAgcHJvcGVydGllcy5kZWZhdWx0V2lkdGggKj0gc2NhbGU7Cn0KZnVuY3Rpb24gYWRqdXN0VHJ1ZVR5cGVUb1VuaWNvZGUocHJvcGVydGllcywgaXNTeW1ib2xpY0ZvbnQsIG5hbWVSZWNvcmRzKSB7CiAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKCFpc1N5bWJvbGljRm9udCkgewogICAgcmV0dXJuOwogIH0KICBpZiAobmFtZVJlY29yZHMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZyA9PT0gV2luQW5zaUVuY29kaW5nKSB7CiAgICByZXR1cm47CiAgfQogIGZvciAoY29uc3QgciBvZiBuYW1lUmVjb3JkcykgewogICAgaWYgKCFpc1dpbk5hbWVSZWNvcmQocikpIHsKICAgICAgcmV0dXJuOwogICAgfQogIH0KICBjb25zdCBlbmNvZGluZyA9IFdpbkFuc2lFbmNvZGluZzsKICBjb25zdCB0b1VuaWNvZGUgPSBbXSwKICAgIGdseXBoc1VuaWNvZGVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBlbmNvZGluZykgewogICAgY29uc3QgZ2x5cGhOYW1lID0gZW5jb2RpbmdbY2hhckNvZGVdOwogICAgaWYgKGdseXBoTmFtZSA9PT0gIiIpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCB1bmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdOwogICAgaWYgKHVuaWNvZGUgPT09IHVuZGVmaW5lZCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHRvVW5pY29kZVtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHVuaWNvZGUpOwogIH0KICBpZiAodG9Vbmljb2RlLmxlbmd0aCA+IDApIHsKICAgIHByb3BlcnRpZXMudG9Vbmljb2RlLmFtZW5kKHRvVW5pY29kZSk7CiAgfQp9CmZ1bmN0aW9uIGFkanVzdFR5cGUxVG9Vbmljb2RlKHByb3BlcnRpZXMsIGJ1aWx0SW5FbmNvZGluZykgewogIGlmIChwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250KSB7CiAgICByZXR1cm47CiAgfQogIGlmIChwcm9wZXJ0aWVzLmhhc0luY2x1ZGVkVG9Vbmljb2RlTWFwKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChidWlsdEluRW5jb2RpbmcgPT09IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChwcm9wZXJ0aWVzLnRvVW5pY29kZSBpbnN0YW5jZW9mIElkZW50aXR5VG9Vbmljb2RlTWFwKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHRvVW5pY29kZSA9IFtdLAogICAgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGJ1aWx0SW5FbmNvZGluZykgewogICAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcpIHsKICAgICAgaWYgKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSB8fCBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGdseXBoTmFtZSA9IGJ1aWx0SW5FbmNvZGluZ1tjaGFyQ29kZV07CiAgICBjb25zdCB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgdG9Vbmljb2RlW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgICB9CiAgfQogIGlmICh0b1VuaWNvZGUubGVuZ3RoID4gMCkgewogICAgcHJvcGVydGllcy50b1VuaWNvZGUuYW1lbmQodG9Vbmljb2RlKTsKICB9Cn0KZnVuY3Rpb24gYW1lbmRGYWxsYmFja1RvVW5pY29kZShwcm9wZXJ0aWVzKSB7CiAgaWYgKCFwcm9wZXJ0aWVzLmZhbGxiYWNrVG9Vbmljb2RlKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChwcm9wZXJ0aWVzLnRvVW5pY29kZSBpbnN0YW5jZW9mIElkZW50aXR5VG9Vbmljb2RlTWFwKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHRvVW5pY29kZSA9IFtdOwogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gcHJvcGVydGllcy5mYWxsYmFja1RvVW5pY29kZSkgewogICAgaWYgKHByb3BlcnRpZXMudG9Vbmljb2RlLmhhcyhjaGFyQ29kZSkpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICB0b1VuaWNvZGVbY2hhckNvZGVdID0gcHJvcGVydGllcy5mYWxsYmFja1RvVW5pY29kZVtjaGFyQ29kZV07CiAgfQogIGlmICh0b1VuaWNvZGUubGVuZ3RoID4gMCkgewogICAgcHJvcGVydGllcy50b1VuaWNvZGUuYW1lbmQodG9Vbmljb2RlKTsKICB9Cn0KY2xhc3MgZm9udHNfR2x5cGggewogIGNvbnN0cnVjdG9yKG9yaWdpbmFsQ2hhckNvZGUsIGZvbnRDaGFyLCB1bmljb2RlLCBhY2NlbnQsIHdpZHRoLCB2bWV0cmljLCBvcGVyYXRvckxpc3RJZCwgaXNTcGFjZSwgaXNJbkZvbnQpIHsKICAgIHRoaXMub3JpZ2luYWxDaGFyQ29kZSA9IG9yaWdpbmFsQ2hhckNvZGU7CiAgICB0aGlzLmZvbnRDaGFyID0gZm9udENoYXI7CiAgICB0aGlzLnVuaWNvZGUgPSB1bmljb2RlOwogICAgdGhpcy5hY2NlbnQgPSBhY2NlbnQ7CiAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICB0aGlzLnZtZXRyaWMgPSB2bWV0cmljOwogICAgdGhpcy5vcGVyYXRvckxpc3RJZCA9IG9wZXJhdG9yTGlzdElkOwogICAgdGhpcy5pc1NwYWNlID0gaXNTcGFjZTsKICAgIHRoaXMuaXNJbkZvbnQgPSBpc0luRm9udDsKICB9CiAgZ2V0IGNhdGVnb3J5KCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY2F0ZWdvcnkiLCBnZXRDaGFyVW5pY29kZUNhdGVnb3J5KHRoaXMudW5pY29kZSksIHRydWUpOwogIH0KfQpmdW5jdGlvbiBpbnQxNihiMCwgYjEpIHsKICByZXR1cm4gKGIwIDw8IDgpICsgYjE7Cn0KZnVuY3Rpb24gd3JpdGVTaWduZWRJbnQxNihieXRlcywgaW5kZXgsIHZhbHVlKSB7CiAgYnl0ZXNbaW5kZXggKyAxXSA9IHZhbHVlOwogIGJ5dGVzW2luZGV4XSA9IHZhbHVlID4+PiA4Owp9CmZ1bmN0aW9uIHNpZ25lZEludDE2KGIwLCBiMSkgewogIGNvbnN0IHZhbHVlID0gKGIwIDw8IDgpICsgYjE7CiAgcmV0dXJuIHZhbHVlICYgMSA8PCAxNSA/IHZhbHVlIC0gMHgxMDAwMCA6IHZhbHVlOwp9CmZ1bmN0aW9uIHdyaXRlVWludDMyKGJ5dGVzLCBpbmRleCwgdmFsdWUpIHsKICBieXRlc1tpbmRleCArIDNdID0gdmFsdWUgJiAweGZmOwogIGJ5dGVzW2luZGV4ICsgMl0gPSB2YWx1ZSA+Pj4gODsKICBieXRlc1tpbmRleCArIDFdID0gdmFsdWUgPj4+IDE2OwogIGJ5dGVzW2luZGV4XSA9IHZhbHVlID4+PiAyNDsKfQpmdW5jdGlvbiBpbnQzMihiMCwgYjEsIGIyLCBiMykgewogIHJldHVybiAoYjAgPDwgMjQpICsgKGIxIDw8IDE2KSArIChiMiA8PCA4KSArIGIzOwp9CmZ1bmN0aW9uIHN0cmluZzE2KHZhbHVlKSB7CiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZik7Cn0KZnVuY3Rpb24gc2FmZVN0cmluZzE2KHZhbHVlKSB7CiAgaWYgKHZhbHVlID4gMHg3ZmZmKSB7CiAgICB2YWx1ZSA9IDB4N2ZmZjsKICB9IGVsc2UgaWYgKHZhbHVlIDwgLTB4ODAwMCkgewogICAgdmFsdWUgPSAtMHg4MDAwOwogIH0KICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKfQpmdW5jdGlvbiBpc1RydWVUeXBlRmlsZShmaWxlKSB7CiAgY29uc3QgaGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoNCk7CiAgcmV0dXJuIHJlYWRVaW50MzIoaGVhZGVyLCAwKSA9PT0gMHgwMDAxMDAwMCB8fCBieXRlc1RvU3RyaW5nKGhlYWRlcikgPT09ICJ0cnVlIjsKfQpmdW5jdGlvbiBpc1RydWVUeXBlQ29sbGVjdGlvbkZpbGUoZmlsZSkgewogIGNvbnN0IGhlYWRlciA9IGZpbGUucGVla0J5dGVzKDQpOwogIHJldHVybiBieXRlc1RvU3RyaW5nKGhlYWRlcikgPT09ICJ0dGNmIjsKfQpmdW5jdGlvbiBpc09wZW5UeXBlRmlsZShmaWxlKSB7CiAgY29uc3QgaGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoNCk7CiAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoaGVhZGVyKSA9PT0gIk9UVE8iOwp9CmZ1bmN0aW9uIGlzVHlwZTFGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcygyKTsKICBpZiAoaGVhZGVyWzBdID09PSAweDI1ICYmIGhlYWRlclsxXSA9PT0gMHgyMSkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGlmIChoZWFkZXJbMF0gPT09IDB4ODAgJiYgaGVhZGVyWzFdID09PSAweDAxKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGlzQ0ZGRmlsZShmaWxlKSB7CiAgY29uc3QgaGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoNCk7CiAgaWYgKGhlYWRlclswXSA+PSAxICYmIGhlYWRlclszXSA+PSAxICYmIGhlYWRlclszXSA8PSA0KSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGdldEZvbnRGaWxlVHlwZShmaWxlLCB7CiAgdHlwZSwKICBzdWJ0eXBlLAogIGNvbXBvc2l0ZQp9KSB7CiAgbGV0IGZpbGVUeXBlLCBmaWxlU3VidHlwZTsKICBpZiAoaXNUcnVlVHlwZUZpbGUoZmlsZSkgfHwgaXNUcnVlVHlwZUNvbGxlY3Rpb25GaWxlKGZpbGUpKSB7CiAgICBmaWxlVHlwZSA9IGNvbXBvc2l0ZSA/ICJDSURGb250VHlwZTIiIDogIlRydWVUeXBlIjsKICB9IGVsc2UgaWYgKGlzT3BlblR5cGVGaWxlKGZpbGUpKSB7CiAgICBmaWxlVHlwZSA9IGNvbXBvc2l0ZSA/ICJDSURGb250VHlwZTIiIDogIk9wZW5UeXBlIjsKICB9IGVsc2UgaWYgKGlzVHlwZTFGaWxlKGZpbGUpKSB7CiAgICBpZiAoY29tcG9zaXRlKSB7CiAgICAgIGZpbGVUeXBlID0gIkNJREZvbnRUeXBlMCI7CiAgICB9IGVsc2UgewogICAgICBmaWxlVHlwZSA9IHR5cGUgPT09ICJNTVR5cGUxIiA/ICJNTVR5cGUxIiA6ICJUeXBlMSI7CiAgICB9CiAgfSBlbHNlIGlmIChpc0NGRkZpbGUoZmlsZSkpIHsKICAgIGlmIChjb21wb3NpdGUpIHsKICAgICAgZmlsZVR5cGUgPSAiQ0lERm9udFR5cGUwIjsKICAgICAgZmlsZVN1YnR5cGUgPSAiQ0lERm9udFR5cGUwQyI7CiAgICB9IGVsc2UgewogICAgICBmaWxlVHlwZSA9IHR5cGUgPT09ICJNTVR5cGUxIiA/ICJNTVR5cGUxIiA6ICJUeXBlMSI7CiAgICAgIGZpbGVTdWJ0eXBlID0gIlR5cGUxQyI7CiAgICB9CiAgfSBlbHNlIHsKICAgIHdhcm4oImdldEZvbnRGaWxlVHlwZTogVW5hYmxlIHRvIGRldGVjdCBjb3JyZWN0IGZvbnQgZmlsZSBUeXBlL1N1YnR5cGUuIik7CiAgICBmaWxlVHlwZSA9IHR5cGU7CiAgICBmaWxlU3VidHlwZSA9IHN1YnR5cGU7CiAgfQogIHJldHVybiBbZmlsZVR5cGUsIGZpbGVTdWJ0eXBlXTsKfQpmdW5jdGlvbiBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgZ2x5cGhNYXApIHsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGdseXBoTWFwKSB7CiAgICBtYXBbK2NoYXJDb2RlXSA9IGdseXBoTWFwW2NoYXJDb2RlXTsKICB9Cn0KZnVuY3Rpb24gYnVpbGRUb0ZvbnRDaGFyKGVuY29kaW5nLCBnbHlwaHNVbmljb2RlTWFwLCBkaWZmZXJlbmNlcykgewogIGNvbnN0IHRvRm9udENoYXIgPSBbXTsKICBsZXQgdW5pY29kZTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBlbmNvZGluZy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGVuY29kaW5nW2ldLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgICB0b0ZvbnRDaGFyW2ldID0gdW5pY29kZTsKICAgIH0KICB9CiAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBkaWZmZXJlbmNlcykgewogICAgdW5pY29kZSA9IGdldFVuaWNvZGVGb3JHbHlwaChkaWZmZXJlbmNlc1tjaGFyQ29kZV0sIGdseXBoc1VuaWNvZGVNYXApOwogICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgIHRvRm9udENoYXJbK2NoYXJDb2RlXSA9IHVuaWNvZGU7CiAgICB9CiAgfQogIHJldHVybiB0b0ZvbnRDaGFyOwp9CmZ1bmN0aW9uIGlzTWFjTmFtZVJlY29yZChyKSB7CiAgcmV0dXJuIHIucGxhdGZvcm0gPT09IDEgJiYgci5lbmNvZGluZyA9PT0gMCAmJiByLmxhbmd1YWdlID09PSAwOwp9CmZ1bmN0aW9uIGlzV2luTmFtZVJlY29yZChyKSB7CiAgcmV0dXJuIHIucGxhdGZvcm0gPT09IDMgJiYgci5lbmNvZGluZyA9PT0gMSAmJiByLmxhbmd1YWdlID09PSAweDQwOTsKfQpmdW5jdGlvbiBjb252ZXJ0Q2lkU3RyaW5nKGNoYXJDb2RlLCBjaWQsIHNob3VsZFRocm93ID0gZmFsc2UpIHsKICBzd2l0Y2ggKGNpZC5sZW5ndGgpIHsKICAgIGNhc2UgMToKICAgICAgcmV0dXJuIGNpZC5jaGFyQ29kZUF0KDApOwogICAgY2FzZSAyOgogICAgICByZXR1cm4gY2lkLmNoYXJDb2RlQXQoMCkgPDwgOCB8IGNpZC5jaGFyQ29kZUF0KDEpOwogIH0KICBjb25zdCBtc2cgPSBgVW5zdXBwb3J0ZWQgQ0lEIHN0cmluZyAoY2hhckNvZGUgJHtjaGFyQ29kZX0pOiAiJHtjaWR9Ii5gOwogIGlmIChzaG91bGRUaHJvdykgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKG1zZyk7CiAgfQogIHdhcm4obXNnKTsKICByZXR1cm4gY2lkOwp9CmZ1bmN0aW9uIGFkanVzdE1hcHBpbmcoY2hhckNvZGVUb0dseXBoSWQsIGhhc0dseXBoLCBuZXdHbHlwaFplcm9JZCwgdG9Vbmljb2RlKSB7CiAgY29uc3QgbmV3TWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBjb25zdCB0b1VuaWNvZGVFeHRyYU1hcCA9IG5ldyBNYXAoKTsKICBjb25zdCB0b0ZvbnRDaGFyID0gW107CiAgY29uc3QgdXNlZEdseXBoSWRzID0gbmV3IFNldCgpOwogIGxldCBwcml2YXRlVXNlQXJlYUluZGV4ID0gMDsKICBjb25zdCBwcml2YXRlVXNlT2ZmZXRTdGFydCA9IFBSSVZBVEVfVVNFX0FSRUFTW3ByaXZhdGVVc2VBcmVhSW5kZXhdWzBdOwogIGxldCBuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlID0gcHJpdmF0ZVVzZU9mZmV0U3RhcnQ7CiAgbGV0IHByaXZhdGVVc2VPZmZldEVuZCA9IFBSSVZBVEVfVVNFX0FSRUFTW3ByaXZhdGVVc2VBcmVhSW5kZXhdWzFdOwogIGNvbnN0IGlzSW5Qcml2YXRlQXJlYSA9IGNvZGUgPT4gUFJJVkFURV9VU0VfQVJFQVNbMF1bMF0gPD0gY29kZSAmJiBjb2RlIDw9IFBSSVZBVEVfVVNFX0FSRUFTWzBdWzFdIHx8IFBSSVZBVEVfVVNFX0FSRUFTWzFdWzBdIDw9IGNvZGUgJiYgY29kZSA8PSBQUklWQVRFX1VTRV9BUkVBU1sxXVsxXTsKICBsZXQgTElHQVRVUkVfVE9fVU5JQ09ERSA9IG51bGw7CiAgZm9yIChjb25zdCBvcmlnaW5hbENoYXJDb2RlIGluIGNoYXJDb2RlVG9HbHlwaElkKSB7CiAgICBsZXQgZ2x5cGhJZCA9IGNoYXJDb2RlVG9HbHlwaElkW29yaWdpbmFsQ2hhckNvZGVdOwogICAgaWYgKCFoYXNHbHlwaChnbHlwaElkKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlID4gcHJpdmF0ZVVzZU9mZmV0RW5kKSB7CiAgICAgIHByaXZhdGVVc2VBcmVhSW5kZXgrKzsKICAgICAgaWYgKHByaXZhdGVVc2VBcmVhSW5kZXggPj0gUFJJVkFURV9VU0VfQVJFQVMubGVuZ3RoKSB7CiAgICAgICAgd2FybigiUmFuIG91dCBvZiBzcGFjZSBpbiBmb250IHByaXZhdGUgdXNlIGFyZWEuIik7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZSA9IFBSSVZBVEVfVVNFX0FSRUFTW3ByaXZhdGVVc2VBcmVhSW5kZXhdWzBdOwogICAgICBwcml2YXRlVXNlT2ZmZXRFbmQgPSBQUklWQVRFX1VTRV9BUkVBU1twcml2YXRlVXNlQXJlYUluZGV4XVsxXTsKICAgIH0KICAgIGNvbnN0IGZvbnRDaGFyQ29kZSA9IG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUrKzsKICAgIGlmIChnbHlwaElkID09PSAwKSB7CiAgICAgIGdseXBoSWQgPSBuZXdHbHlwaFplcm9JZDsKICAgIH0KICAgIGxldCB1bmljb2RlID0gdG9Vbmljb2RlLmdldChvcmlnaW5hbENoYXJDb2RlKTsKICAgIGlmICh0eXBlb2YgdW5pY29kZSA9PT0gInN0cmluZyIpIHsKICAgICAgaWYgKHVuaWNvZGUubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdW5pY29kZSA9IHVuaWNvZGUuY29kZVBvaW50QXQoMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCFMSUdBVFVSRV9UT19VTklDT0RFKSB7CiAgICAgICAgICBMSUdBVFVSRV9UT19VTklDT0RFID0gbmV3IE1hcCgpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDB4ZmIwMDsgaSA8PSAweGZiNGY7IGkrKykgewogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkID0gU3RyaW5nLmZyb21DaGFyQ29kZShpKS5ub3JtYWxpemUoIk5GS0QiKTsKICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWQubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgIExJR0FUVVJFX1RPX1VOSUNPREUuc2V0KG5vcm1hbGl6ZWQsIGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHVuaWNvZGUgPSBMSUdBVFVSRV9UT19VTklDT0RFLmdldCh1bmljb2RlKSB8fCB1bmljb2RlLmNvZGVQb2ludEF0KDApOwogICAgICB9CiAgICB9CiAgICBpZiAodW5pY29kZSAmJiAhaXNJblByaXZhdGVBcmVhKHVuaWNvZGUpICYmICF1c2VkR2x5cGhJZHMuaGFzKGdseXBoSWQpKSB7CiAgICAgIHRvVW5pY29kZUV4dHJhTWFwLnNldCh1bmljb2RlLCBnbHlwaElkKTsKICAgICAgdXNlZEdseXBoSWRzLmFkZChnbHlwaElkKTsKICAgIH0KICAgIG5ld01hcFtmb250Q2hhckNvZGVdID0gZ2x5cGhJZDsKICAgIHRvRm9udENoYXJbb3JpZ2luYWxDaGFyQ29kZV0gPSBmb250Q2hhckNvZGU7CiAgfQogIHJldHVybiB7CiAgICB0b0ZvbnRDaGFyLAogICAgY2hhckNvZGVUb0dseXBoSWQ6IG5ld01hcCwKICAgIHRvVW5pY29kZUV4dHJhTWFwLAogICAgbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZQogIH07Cn0KZnVuY3Rpb24gZ2V0UmFuZ2VzKGdseXBocywgdG9Vbmljb2RlRXh0cmFNYXAsIG51bUdseXBocykgewogIGNvbnN0IGNvZGVzID0gW107CiAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBnbHlwaHMpIHsKICAgIGlmIChnbHlwaHNbY2hhckNvZGVdID49IG51bUdseXBocykgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvZGVzLnB1c2goewogICAgICBmb250Q2hhckNvZGU6IGNoYXJDb2RlIHwgMCwKICAgICAgZ2x5cGhJZDogZ2x5cGhzW2NoYXJDb2RlXQogICAgfSk7CiAgfQogIGlmICh0b1VuaWNvZGVFeHRyYU1hcCkgewogICAgZm9yIChjb25zdCBbdW5pY29kZSwgZ2x5cGhJZF0gb2YgdG9Vbmljb2RlRXh0cmFNYXApIHsKICAgICAgaWYgKGdseXBoSWQgPj0gbnVtR2x5cGhzKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29kZXMucHVzaCh7CiAgICAgICAgZm9udENoYXJDb2RlOiB1bmljb2RlLAogICAgICAgIGdseXBoSWQKICAgICAgfSk7CiAgICB9CiAgfQogIGlmIChjb2Rlcy5sZW5ndGggPT09IDApIHsKICAgIGNvZGVzLnB1c2goewogICAgICBmb250Q2hhckNvZGU6IDAsCiAgICAgIGdseXBoSWQ6IDAKICAgIH0pOwogIH0KICBjb2Rlcy5zb3J0KChhLCBiKSA9PiBhLmZvbnRDaGFyQ29kZSAtIGIuZm9udENoYXJDb2RlKTsKICBjb25zdCByYW5nZXMgPSBbXTsKICBjb25zdCBsZW5ndGggPSBjb2Rlcy5sZW5ndGg7CiAgZm9yIChsZXQgbiA9IDA7IG4gPCBsZW5ndGg7KSB7CiAgICBjb25zdCBzdGFydCA9IGNvZGVzW25dLmZvbnRDaGFyQ29kZTsKICAgIGNvbnN0IGNvZGVJbmRpY2VzID0gW2NvZGVzW25dLmdseXBoSWRdOwogICAgKytuOwogICAgbGV0IGVuZCA9IHN0YXJ0OwogICAgd2hpbGUgKG4gPCBsZW5ndGggJiYgZW5kICsgMSA9PT0gY29kZXNbbl0uZm9udENoYXJDb2RlKSB7CiAgICAgIGNvZGVJbmRpY2VzLnB1c2goY29kZXNbbl0uZ2x5cGhJZCk7CiAgICAgICsrZW5kOwogICAgICArK247CiAgICAgIGlmIChlbmQgPT09IDB4ZmZmZikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByYW5nZXMucHVzaChbc3RhcnQsIGVuZCwgY29kZUluZGljZXNdKTsKICB9CiAgcmV0dXJuIHJhbmdlczsKfQpmdW5jdGlvbiBjcmVhdGVDbWFwVGFibGUoZ2x5cGhzLCB0b1VuaWNvZGVFeHRyYU1hcCwgbnVtR2x5cGhzKSB7CiAgY29uc3QgcmFuZ2VzID0gZ2V0UmFuZ2VzKGdseXBocywgdG9Vbmljb2RlRXh0cmFNYXAsIG51bUdseXBocyk7CiAgY29uc3QgbnVtVGFibGVzID0gcmFuZ2VzLmF0KC0xKVsxXSA+IDB4ZmZmZiA/IDIgOiAxOwogIGxldCBjbWFwID0gIlx4MDBceDAwIiArIHN0cmluZzE2KG51bVRhYmxlcykgKyAiXHgwMFx4MDMiICsgIlx4MDBceDAxIiArIHN0cmluZzMyKDQgKyBudW1UYWJsZXMgKiA4KTsKICBsZXQgaSwgaWksIGosIGpqOwogIGZvciAoaSA9IHJhbmdlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgaWYgKHJhbmdlc1tpXVswXSA8PSAweGZmZmYpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQogIGNvbnN0IGJtcExlbmd0aCA9IGkgKyAxOwogIGlmIChyYW5nZXNbaV1bMF0gPCAweGZmZmYgJiYgcmFuZ2VzW2ldWzFdID09PSAweGZmZmYpIHsKICAgIHJhbmdlc1tpXVsxXSA9IDB4ZmZmZTsKICB9CiAgY29uc3QgdHJhaWxpbmdSYW5nZXNDb3VudCA9IHJhbmdlc1tpXVsxXSA8IDB4ZmZmZiA/IDEgOiAwOwogIGNvbnN0IHNlZ0NvdW50ID0gYm1wTGVuZ3RoICsgdHJhaWxpbmdSYW5nZXNDb3VudDsKICBjb25zdCBzZWFyY2hQYXJhbXMgPSBPcGVuVHlwZUZpbGVCdWlsZGVyLmdldFNlYXJjaFBhcmFtcyhzZWdDb3VudCwgMik7CiAgbGV0IHN0YXJ0Q291bnQgPSAiIjsKICBsZXQgZW5kQ291bnQgPSAiIjsKICBsZXQgaWREZWx0YXMgPSAiIjsKICBsZXQgaWRSYW5nZU9mZnNldHMgPSAiIjsKICBsZXQgZ2x5cGhzSWRzID0gIiI7CiAgbGV0IGJpYXMgPSAwOwogIGxldCByYW5nZSwgc3RhcnQsIGVuZCwgY29kZXM7CiAgZm9yIChpID0gMCwgaWkgPSBibXBMZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICByYW5nZSA9IHJhbmdlc1tpXTsKICAgIHN0YXJ0ID0gcmFuZ2VbMF07CiAgICBlbmQgPSByYW5nZVsxXTsKICAgIHN0YXJ0Q291bnQgKz0gc3RyaW5nMTYoc3RhcnQpOwogICAgZW5kQ291bnQgKz0gc3RyaW5nMTYoZW5kKTsKICAgIGNvZGVzID0gcmFuZ2VbMl07CiAgICBsZXQgY29udGlndW91cyA9IHRydWU7CiAgICBmb3IgKGogPSAxLCBqaiA9IGNvZGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgaWYgKGNvZGVzW2pdICE9PSBjb2Rlc1tqIC0gMV0gKyAxKSB7CiAgICAgICAgY29udGlndW91cyA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAoIWNvbnRpZ3VvdXMpIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gKHNlZ0NvdW50IC0gaSkgKiAyICsgYmlhcyAqIDI7CiAgICAgIGJpYXMgKz0gZW5kIC0gc3RhcnQgKyAxOwogICAgICBpZERlbHRhcyArPSBzdHJpbmcxNigwKTsKICAgICAgaWRSYW5nZU9mZnNldHMgKz0gc3RyaW5nMTYob2Zmc2V0KTsKICAgICAgZm9yIChqID0gMCwgamogPSBjb2Rlcy5sZW5ndGg7IGogPCBqajsgKytqKSB7CiAgICAgICAgZ2x5cGhzSWRzICs9IHN0cmluZzE2KGNvZGVzW2pdKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3Qgc3RhcnRDb2RlID0gY29kZXNbMF07CiAgICAgIGlkRGVsdGFzICs9IHN0cmluZzE2KHN0YXJ0Q29kZSAtIHN0YXJ0ICYgMHhmZmZmKTsKICAgICAgaWRSYW5nZU9mZnNldHMgKz0gc3RyaW5nMTYoMCk7CiAgICB9CiAgfQogIGlmICh0cmFpbGluZ1Jhbmdlc0NvdW50ID4gMCkgewogICAgZW5kQ291bnQgKz0gIlx4RkZceEZGIjsKICAgIHN0YXJ0Q291bnQgKz0gIlx4RkZceEZGIjsKICAgIGlkRGVsdGFzICs9ICJceDAwXHgwMSI7CiAgICBpZFJhbmdlT2Zmc2V0cyArPSAiXHgwMFx4MDAiOwogIH0KICBjb25zdCBmb3JtYXQzMTQgPSAiXHgwMFx4MDAiICsgc3RyaW5nMTYoMiAqIHNlZ0NvdW50KSArIHN0cmluZzE2KHNlYXJjaFBhcmFtcy5yYW5nZSkgKyBzdHJpbmcxNihzZWFyY2hQYXJhbXMuZW50cnkpICsgc3RyaW5nMTYoc2VhcmNoUGFyYW1zLnJhbmdlU2hpZnQpICsgZW5kQ291bnQgKyAiXHgwMFx4MDAiICsgc3RhcnRDb3VudCArIGlkRGVsdGFzICsgaWRSYW5nZU9mZnNldHMgKyBnbHlwaHNJZHM7CiAgbGV0IGZvcm1hdDMxMDEyID0gIiI7CiAgbGV0IGhlYWRlcjMxMDEyID0gIiI7CiAgaWYgKG51bVRhYmxlcyA+IDEpIHsKICAgIGNtYXAgKz0gIlx4MDBceDAzIiArICJceDAwXHgwQSIgKyBzdHJpbmczMig0ICsgbnVtVGFibGVzICogOCArIDQgKyBmb3JtYXQzMTQubGVuZ3RoKTsKICAgIGZvcm1hdDMxMDEyID0gIiI7CiAgICBmb3IgKGkgPSAwLCBpaSA9IHJhbmdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIHJhbmdlID0gcmFuZ2VzW2ldOwogICAgICBzdGFydCA9IHJhbmdlWzBdOwogICAgICBjb2RlcyA9IHJhbmdlWzJdOwogICAgICBsZXQgY29kZSA9IGNvZGVzWzBdOwogICAgICBmb3IgKGogPSAxLCBqaiA9IGNvZGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICBpZiAoY29kZXNbal0gIT09IGNvZGVzW2ogLSAxXSArIDEpIHsKICAgICAgICAgIGVuZCA9IHJhbmdlWzBdICsgaiAtIDE7CiAgICAgICAgICBmb3JtYXQzMTAxMiArPSBzdHJpbmczMihzdGFydCkgKyBzdHJpbmczMihlbmQpICsgc3RyaW5nMzIoY29kZSk7CiAgICAgICAgICBzdGFydCA9IGVuZCArIDE7CiAgICAgICAgICBjb2RlID0gY29kZXNbal07CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvcm1hdDMxMDEyICs9IHN0cmluZzMyKHN0YXJ0KSArIHN0cmluZzMyKHJhbmdlWzFdKSArIHN0cmluZzMyKGNvZGUpOwogICAgfQogICAgaGVhZGVyMzEwMTIgPSAiXHgwMFx4MEMiICsgIlx4MDBceDAwIiArIHN0cmluZzMyKGZvcm1hdDMxMDEyLmxlbmd0aCArIDE2KSArICJceDAwXHgwMFx4MDBceDAwIiArIHN0cmluZzMyKGZvcm1hdDMxMDEyLmxlbmd0aCAvIDEyKTsKICB9CiAgcmV0dXJuIGNtYXAgKyAiXHgwMFx4MDQiICsgc3RyaW5nMTYoZm9ybWF0MzE0Lmxlbmd0aCArIDQpICsgZm9ybWF0MzE0ICsgaGVhZGVyMzEwMTIgKyBmb3JtYXQzMTAxMjsKfQpmdW5jdGlvbiB2YWxpZGF0ZU9TMlRhYmxlKG9zMiwgZmlsZSkgewogIGZpbGUucG9zID0gKGZpbGUuc3RhcnQgfHwgMCkgKyBvczIub2Zmc2V0OwogIGNvbnN0IHZlcnNpb24gPSBmaWxlLmdldFVpbnQxNigpOwogIGZpbGUuc2tpcCg2MCk7CiAgY29uc3Qgc2VsZWN0aW9uID0gZmlsZS5nZXRVaW50MTYoKTsKICBpZiAodmVyc2lvbiA8IDQgJiYgc2VsZWN0aW9uICYgMHgwMzAwKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbnN0IGZpcnN0Q2hhciA9IGZpbGUuZ2V0VWludDE2KCk7CiAgY29uc3QgbGFzdENoYXIgPSBmaWxlLmdldFVpbnQxNigpOwogIGlmIChmaXJzdENoYXIgPiBsYXN0Q2hhcikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBmaWxlLnNraXAoNik7CiAgY29uc3QgdXNXaW5Bc2NlbnQgPSBmaWxlLmdldFVpbnQxNigpOwogIGlmICh1c1dpbkFzY2VudCA9PT0gMCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBvczIuZGF0YVs4XSA9IG9zMi5kYXRhWzldID0gMDsKICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBjcmVhdGVPUzJUYWJsZShwcm9wZXJ0aWVzLCBjaGFyc3RyaW5ncywgb3ZlcnJpZGUpIHsKICBvdmVycmlkZSB8fD0gewogICAgdW5pdHNQZXJFbTogMCwKICAgIHlNYXg6IDAsCiAgICB5TWluOiAwLAogICAgYXNjZW50OiAwLAogICAgZGVzY2VudDogMAogIH07CiAgbGV0IHVsVW5pY29kZVJhbmdlMSA9IDA7CiAgbGV0IHVsVW5pY29kZVJhbmdlMiA9IDA7CiAgbGV0IHVsVW5pY29kZVJhbmdlMyA9IDA7CiAgbGV0IHVsVW5pY29kZVJhbmdlNCA9IDA7CiAgbGV0IGZpcnN0Q2hhckluZGV4ID0gbnVsbDsKICBsZXQgbGFzdENoYXJJbmRleCA9IDA7CiAgbGV0IHBvc2l0aW9uID0gLTE7CiAgaWYgKGNoYXJzdHJpbmdzKSB7CiAgICBmb3IgKGxldCBjb2RlIGluIGNoYXJzdHJpbmdzKSB7CiAgICAgIGNvZGUgfD0gMDsKICAgICAgaWYgKGZpcnN0Q2hhckluZGV4ID4gY29kZSB8fCAhZmlyc3RDaGFySW5kZXgpIHsKICAgICAgICBmaXJzdENoYXJJbmRleCA9IGNvZGU7CiAgICAgIH0KICAgICAgaWYgKGxhc3RDaGFySW5kZXggPCBjb2RlKSB7CiAgICAgICAgbGFzdENoYXJJbmRleCA9IGNvZGU7CiAgICAgIH0KICAgICAgcG9zaXRpb24gPSBnZXRVbmljb2RlUmFuZ2VGb3IoY29kZSwgcG9zaXRpb24pOwogICAgICBpZiAocG9zaXRpb24gPCAzMikgewogICAgICAgIHVsVW5pY29kZVJhbmdlMSB8PSAxIDw8IHBvc2l0aW9uOwogICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDwgNjQpIHsKICAgICAgICB1bFVuaWNvZGVSYW5nZTIgfD0gMSA8PCBwb3NpdGlvbiAtIDMyOwogICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDwgOTYpIHsKICAgICAgICB1bFVuaWNvZGVSYW5nZTMgfD0gMSA8PCBwb3NpdGlvbiAtIDY0OwogICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDwgMTIzKSB7CiAgICAgICAgdWxVbmljb2RlUmFuZ2U0IHw9IDEgPDwgcG9zaXRpb24gLSA5NjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVuaWNvZGUgcmFuZ2VzIEJpdHMgPiAxMjMgYXJlIHJlc2VydmVkIGZvciBpbnRlcm5hbCB1c2FnZSIpOwogICAgICB9CiAgICB9CiAgICBpZiAobGFzdENoYXJJbmRleCA+IDB4ZmZmZikgewogICAgICBsYXN0Q2hhckluZGV4ID0gMHhmZmZmOwogICAgfQogIH0gZWxzZSB7CiAgICBmaXJzdENoYXJJbmRleCA9IDA7CiAgICBsYXN0Q2hhckluZGV4ID0gMjU1OwogIH0KICBjb25zdCBiYm94ID0gcHJvcGVydGllcy5iYm94IHx8IFswLCAwLCAwLCAwXTsKICBjb25zdCB1bml0c1BlckVtID0gb3ZlcnJpZGUudW5pdHNQZXJFbSB8fCAocHJvcGVydGllcy5mb250TWF0cml4ID8gMSAvIE1hdGgubWF4KC4uLnByb3BlcnRpZXMuZm9udE1hdHJpeC5zbGljZSgwLCA0KS5tYXAoTWF0aC5hYnMpKSA6IDEwMDApOwogIGNvbnN0IHNjYWxlID0gcHJvcGVydGllcy5hc2NlbnRTY2FsZWQgPyAxLjAgOiB1bml0c1BlckVtIC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogIGNvbnN0IHR5cG9Bc2NlbnQgPSBvdmVycmlkZS5hc2NlbnQgfHwgTWF0aC5yb3VuZChzY2FsZSAqIChwcm9wZXJ0aWVzLmFzY2VudCB8fCBiYm94WzNdKSk7CiAgbGV0IHR5cG9EZXNjZW50ID0gb3ZlcnJpZGUuZGVzY2VudCB8fCBNYXRoLnJvdW5kKHNjYWxlICogKHByb3BlcnRpZXMuZGVzY2VudCB8fCBiYm94WzFdKSk7CiAgaWYgKHR5cG9EZXNjZW50ID4gMCAmJiBwcm9wZXJ0aWVzLmRlc2NlbnQgPiAwICYmIGJib3hbMV0gPCAwKSB7CiAgICB0eXBvRGVzY2VudCA9IC10eXBvRGVzY2VudDsKICB9CiAgY29uc3Qgd2luQXNjZW50ID0gb3ZlcnJpZGUueU1heCB8fCB0eXBvQXNjZW50OwogIGNvbnN0IHdpbkRlc2NlbnQgPSAtb3ZlcnJpZGUueU1pbiB8fCAtdHlwb0Rlc2NlbnQ7CiAgcmV0dXJuICJceDAwXHgwMyIgKyAiXHgwMlx4MjQiICsgIlx4MDFceEY0IiArICJceDAwXHgwNSIgKyAiXHgwMFx4MDAiICsgIlx4MDJceDhBIiArICJceDAyXHhCQiIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDhDIiArICJceDAyXHg4QSIgKyAiXHgwMlx4QkIiICsgIlx4MDBceDAwIiArICJceDAxXHhERiIgKyAiXHgwMFx4MzEiICsgIlx4MDFceDAyIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDBceDA2IiArIFN0cmluZy5mcm9tQ2hhckNvZGUocHJvcGVydGllcy5maXhlZFBpdGNoID8gMHgwOSA6IDB4MDApICsgIlx4MDBceDAwXHgwMFx4MDBceDAwXHgwMCIgKyBzdHJpbmczMih1bFVuaWNvZGVSYW5nZTEpICsgc3RyaW5nMzIodWxVbmljb2RlUmFuZ2UyKSArIHN0cmluZzMyKHVsVW5pY29kZVJhbmdlMykgKyBzdHJpbmczMih1bFVuaWNvZGVSYW5nZTQpICsgIlx4MkFceDMyXHgzMVx4MkEiICsgc3RyaW5nMTYocHJvcGVydGllcy5pdGFsaWNBbmdsZSA/IDEgOiAwKSArIHN0cmluZzE2KGZpcnN0Q2hhckluZGV4IHx8IHByb3BlcnRpZXMuZmlyc3RDaGFyKSArIHN0cmluZzE2KGxhc3RDaGFySW5kZXggfHwgcHJvcGVydGllcy5sYXN0Q2hhcikgKyBzdHJpbmcxNih0eXBvQXNjZW50KSArIHN0cmluZzE2KHR5cG9EZXNjZW50KSArICJceDAwXHg2NCIgKyBzdHJpbmcxNih3aW5Bc2NlbnQpICsgc3RyaW5nMTYod2luRGVzY2VudCkgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyBzdHJpbmcxNihwcm9wZXJ0aWVzLnhIZWlnaHQpICsgc3RyaW5nMTYocHJvcGVydGllcy5jYXBIZWlnaHQpICsgc3RyaW5nMTYoMCkgKyBzdHJpbmcxNihmaXJzdENoYXJJbmRleCB8fCBwcm9wZXJ0aWVzLmZpcnN0Q2hhcikgKyAiXHgwMFx4MDMiOwp9CmZ1bmN0aW9uIGNyZWF0ZVBvc3RUYWJsZShwcm9wZXJ0aWVzKSB7CiAgY29uc3QgYW5nbGUgPSBNYXRoLmZsb29yKHByb3BlcnRpZXMuaXRhbGljQW5nbGUgKiAyICoqIDE2KTsKICByZXR1cm4gIlx4MDBceDAzXHgwMFx4MDAiICsgc3RyaW5nMzIoYW5nbGUpICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyBzdHJpbmczMihwcm9wZXJ0aWVzLmZpeGVkUGl0Y2ggPyAxIDogMCkgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyAiXHgwMFx4MDBceDAwXHgwMCI7Cn0KZnVuY3Rpb24gY3JlYXRlUG9zdHNjcmlwdE5hbWUobmFtZSkgewogIHJldHVybiBuYW1lLnJlcGxhY2VBbGwoL1teXHgyMS1ceDdFXXxbW1xdKCl7fTw+LyVdL2csICIiKS5zbGljZSgwLCA2Myk7Cn0KZnVuY3Rpb24gY3JlYXRlTmFtZVRhYmxlKG5hbWUsIHByb3RvKSB7CiAgaWYgKCFwcm90bykgewogICAgcHJvdG8gPSBbW10sIFtdXTsKICB9CiAgY29uc3Qgc3RyaW5ncyA9IFtwcm90b1swXVswXSB8fCAiT3JpZ2luYWwgbGljZW5jZSIsIHByb3RvWzBdWzFdIHx8IG5hbWUsIHByb3RvWzBdWzJdIHx8ICJVbmtub3duIiwgcHJvdG9bMF1bM10gfHwgInVuaXF1ZUlEIiwgcHJvdG9bMF1bNF0gfHwgbmFtZSwgcHJvdG9bMF1bNV0gfHwgIlZlcnNpb24gMC4xMSIsIHByb3RvWzBdWzZdIHx8IGNyZWF0ZVBvc3RzY3JpcHROYW1lKG5hbWUpLCBwcm90b1swXVs3XSB8fCAiVW5rbm93biIsIHByb3RvWzBdWzhdIHx8ICJVbmtub3duIiwgcHJvdG9bMF1bOV0gfHwgIlVua25vd24iXTsKICBjb25zdCBzdHJpbmdzVW5pY29kZSA9IFtdOwogIGxldCBpLCBpaSwgaiwgamosIHN0cjsKICBmb3IgKGkgPSAwLCBpaSA9IHN0cmluZ3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgc3RyID0gcHJvdG9bMV1baV0gfHwgc3RyaW5nc1tpXTsKICAgIGNvbnN0IHN0ckJ1ZlVuaWNvZGUgPSBbXTsKICAgIGZvciAoaiA9IDAsIGpqID0gc3RyLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgc3RyQnVmVW5pY29kZS5wdXNoKHN0cmluZzE2KHN0ci5jaGFyQ29kZUF0KGopKSk7CiAgICB9CiAgICBzdHJpbmdzVW5pY29kZS5wdXNoKHN0ckJ1ZlVuaWNvZGUuam9pbigiIikpOwogIH0KICBjb25zdCBuYW1lcyA9IFtzdHJpbmdzLCBzdHJpbmdzVW5pY29kZV07CiAgY29uc3QgcGxhdGZvcm1zID0gWyJceDAwXHgwMSIsICJceDAwXHgwMyJdOwogIGNvbnN0IGVuY29kaW5ncyA9IFsiXHgwMFx4MDAiLCAiXHgwMFx4MDEiXTsKICBjb25zdCBsYW5ndWFnZXMgPSBbIlx4MDBceDAwIiwgIlx4MDRceDA5Il07CiAgY29uc3QgbmFtZXNSZWNvcmRDb3VudCA9IHN0cmluZ3MubGVuZ3RoICogcGxhdGZvcm1zLmxlbmd0aDsKICBsZXQgbmFtZVRhYmxlID0gIlx4MDBceDAwIiArIHN0cmluZzE2KG5hbWVzUmVjb3JkQ291bnQpICsgc3RyaW5nMTYobmFtZXNSZWNvcmRDb3VudCAqIDEyICsgNik7CiAgbGV0IHN0ck9mZnNldCA9IDA7CiAgZm9yIChpID0gMCwgaWkgPSBwbGF0Zm9ybXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3Qgc3RycyA9IG5hbWVzW2ldOwogICAgZm9yIChqID0gMCwgamogPSBzdHJzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgc3RyID0gc3Ryc1tqXTsKICAgICAgY29uc3QgbmFtZVJlY29yZCA9IHBsYXRmb3Jtc1tpXSArIGVuY29kaW5nc1tpXSArIGxhbmd1YWdlc1tpXSArIHN0cmluZzE2KGopICsgc3RyaW5nMTYoc3RyLmxlbmd0aCkgKyBzdHJpbmcxNihzdHJPZmZzZXQpOwogICAgICBuYW1lVGFibGUgKz0gbmFtZVJlY29yZDsKICAgICAgc3RyT2Zmc2V0ICs9IHN0ci5sZW5ndGg7CiAgICB9CiAgfQogIG5hbWVUYWJsZSArPSBzdHJpbmdzLmpvaW4oIiIpICsgc3RyaW5nc1VuaWNvZGUuam9pbigiIik7CiAgcmV0dXJuIG5hbWVUYWJsZTsKfQpjbGFzcyBGb250IHsKICBjb25zdHJ1Y3RvcihuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzLCBldmFsdWF0b3JPcHRpb25zKSB7CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgdGhpcy5wc05hbWUgPSBudWxsOwogICAgdGhpcy5taW1ldHlwZSA9IG51bGw7CiAgICB0aGlzLmRpc2FibGVGb250RmFjZSA9IGV2YWx1YXRvck9wdGlvbnMuZGlzYWJsZUZvbnRGYWNlOwogICAgdGhpcy5mb250RXh0cmFQcm9wZXJ0aWVzID0gZXZhbHVhdG9yT3B0aW9ucy5mb250RXh0cmFQcm9wZXJ0aWVzOwogICAgdGhpcy5sb2FkZWROYW1lID0gcHJvcGVydGllcy5sb2FkZWROYW1lOwogICAgdGhpcy5pc1R5cGUzRm9udCA9IHByb3BlcnRpZXMuaXNUeXBlM0ZvbnQ7CiAgICB0aGlzLm1pc3NpbmdGaWxlID0gZmFsc2U7CiAgICB0aGlzLmNzc0ZvbnRJbmZvID0gcHJvcGVydGllcy5jc3NGb250SW5mbzsKICAgIHRoaXMuX2NoYXJzQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5fZ2x5cGhDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgaXNTZXJpZkZvbnQgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgRm9udEZsYWdzLlNlcmlmKTsKICAgIGlmICghaXNTZXJpZkZvbnQgJiYgIXByb3BlcnRpZXMuaXNTaW11bGF0ZWRGbGFncykgewogICAgICBjb25zdCBzdGRGb250TWFwID0gZ2V0U3RkRm9udE1hcCgpLAogICAgICAgIG5vblN0ZEZvbnRNYXAgPSBnZXROb25TdGRGb250TWFwKCksCiAgICAgICAgc2VyaWZGb250cyA9IGdldFNlcmlmRm9udHMoKTsKICAgICAgZm9yIChjb25zdCBuYW1lUGFydCBvZiBuYW1lLnNwbGl0KCIrIikpIHsKICAgICAgICBsZXQgZm9udE5hbWUgPSBuYW1lUGFydC5yZXBsYWNlQWxsKC9bLF9dL2csICItIik7CiAgICAgICAgZm9udE5hbWUgPSBzdGRGb250TWFwW2ZvbnROYW1lXSB8fCBub25TdGRGb250TWFwW2ZvbnROYW1lXSB8fCBmb250TmFtZTsKICAgICAgICBmb250TmFtZSA9IGZvbnROYW1lLnNwbGl0KCItIiwgMSlbMF07CiAgICAgICAgaWYgKHNlcmlmRm9udHNbZm9udE5hbWVdKSB7CiAgICAgICAgICBpc1NlcmlmRm9udCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuaXNTZXJpZkZvbnQgPSBpc1NlcmlmRm9udDsKICAgIHRoaXMuaXNTeW1ib2xpY0ZvbnQgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgRm9udEZsYWdzLlN5bWJvbGljKTsKICAgIHRoaXMuaXNNb25vc3BhY2UgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgRm9udEZsYWdzLkZpeGVkUGl0Y2gpOwogICAgbGV0IHsKICAgICAgdHlwZSwKICAgICAgc3VidHlwZQogICAgfSA9IHByb3BlcnRpZXM7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy5zdWJ0eXBlID0gc3VidHlwZTsKICAgIHRoaXMuc3lzdGVtRm9udEluZm8gPSBwcm9wZXJ0aWVzLnN5c3RlbUZvbnRJbmZvOwogICAgY29uc3QgbWF0Y2hlcyA9IG5hbWUubWF0Y2goL15JbnZhbGlkUERGanNGb250XyguKilfXGQrJC8pOwogICAgdGhpcy5pc0ludmFsaWRQREZqc0ZvbnQgPSAhIW1hdGNoZXM7CiAgICBpZiAodGhpcy5pc0ludmFsaWRQREZqc0ZvbnQpIHsKICAgICAgdGhpcy5mYWxsYmFja05hbWUgPSBtYXRjaGVzWzFdOwogICAgfSBlbHNlIGlmICh0aGlzLmlzTW9ub3NwYWNlKSB7CiAgICAgIHRoaXMuZmFsbGJhY2tOYW1lID0gIm1vbm9zcGFjZSI7CiAgICB9IGVsc2UgaWYgKHRoaXMuaXNTZXJpZkZvbnQpIHsKICAgICAgdGhpcy5mYWxsYmFja05hbWUgPSAic2VyaWYiOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5mYWxsYmFja05hbWUgPSAic2Fucy1zZXJpZiI7CiAgICB9CiAgICBpZiAodGhpcy5zeXN0ZW1Gb250SW5mbz8uZ3Vlc3NGYWxsYmFjaykgewogICAgICB0aGlzLnN5c3RlbUZvbnRJbmZvLmd1ZXNzRmFsbGJhY2sgPSBmYWxzZTsKICAgICAgdGhpcy5zeXN0ZW1Gb250SW5mby5jc3MgKz0gYCwke3RoaXMuZmFsbGJhY2tOYW1lfWA7CiAgICB9CiAgICB0aGlzLmRpZmZlcmVuY2VzID0gcHJvcGVydGllcy5kaWZmZXJlbmNlczsKICAgIHRoaXMud2lkdGhzID0gcHJvcGVydGllcy53aWR0aHM7CiAgICB0aGlzLmRlZmF1bHRXaWR0aCA9IHByb3BlcnRpZXMuZGVmYXVsdFdpZHRoOwogICAgdGhpcy5jb21wb3NpdGUgPSBwcm9wZXJ0aWVzLmNvbXBvc2l0ZTsKICAgIHRoaXMuY01hcCA9IHByb3BlcnRpZXMuY01hcDsKICAgIHRoaXMuY2FwSGVpZ2h0ID0gcHJvcGVydGllcy5jYXBIZWlnaHQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICB0aGlzLmFzY2VudCA9IHByb3BlcnRpZXMuYXNjZW50IC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogICAgdGhpcy5kZXNjZW50ID0gcHJvcGVydGllcy5kZXNjZW50IC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogICAgdGhpcy5saW5lSGVpZ2h0ID0gdGhpcy5hc2NlbnQgLSB0aGlzLmRlc2NlbnQ7CiAgICB0aGlzLmZvbnRNYXRyaXggPSBwcm9wZXJ0aWVzLmZvbnRNYXRyaXg7CiAgICB0aGlzLmJib3ggPSBwcm9wZXJ0aWVzLmJib3g7CiAgICB0aGlzLmRlZmF1bHRFbmNvZGluZyA9IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nOwogICAgdGhpcy50b1VuaWNvZGUgPSBwcm9wZXJ0aWVzLnRvVW5pY29kZTsKICAgIHRoaXMudG9Gb250Q2hhciA9IFtdOwogICAgaWYgKHByb3BlcnRpZXMudHlwZSA9PT0gIlR5cGUzIikgewogICAgICBmb3IgKGxldCBjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgMjU2OyBjaGFyQ29kZSsrKSB7CiAgICAgICAgdGhpcy50b0ZvbnRDaGFyW2NoYXJDb2RlXSA9IHRoaXMuZGlmZmVyZW5jZXNbY2hhckNvZGVdIHx8IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nW2NoYXJDb2RlXTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmNpZEVuY29kaW5nID0gcHJvcGVydGllcy5jaWRFbmNvZGluZyB8fCAiIjsKICAgIHRoaXMudmVydGljYWwgPSAhIXByb3BlcnRpZXMudmVydGljYWw7CiAgICBpZiAodGhpcy52ZXJ0aWNhbCkgewogICAgICB0aGlzLnZtZXRyaWNzID0gcHJvcGVydGllcy52bWV0cmljczsKICAgICAgdGhpcy5kZWZhdWx0Vk1ldHJpY3MgPSBwcm9wZXJ0aWVzLmRlZmF1bHRWTWV0cmljczsKICAgIH0KICAgIGlmICghZmlsZSB8fCBmaWxlLmlzRW1wdHkpIHsKICAgICAgaWYgKGZpbGUpIHsKICAgICAgICB3YXJuKCdGb250IGZpbGUgaXMgZW1wdHkgaW4gIicgKyBuYW1lICsgJyIgKCcgKyB0aGlzLmxvYWRlZE5hbWUgKyAiKSIpOwogICAgICB9CiAgICAgIHRoaXMuZmFsbGJhY2tUb1N5c3RlbUZvbnQocHJvcGVydGllcyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIFt0eXBlLCBzdWJ0eXBlXSA9IGdldEZvbnRGaWxlVHlwZShmaWxlLCBwcm9wZXJ0aWVzKTsKICAgIGlmICh0eXBlICE9PSB0aGlzLnR5cGUgfHwgc3VidHlwZSAhPT0gdGhpcy5zdWJ0eXBlKSB7CiAgICAgIGluZm8oIkluY29uc2lzdGVudCBmb250IGZpbGUgVHlwZS9TdWJUeXBlLCBleHBlY3RlZDogIiArIGAke3RoaXMudHlwZX0vJHt0aGlzLnN1YnR5cGV9IGJ1dCBmb3VuZDogJHt0eXBlfS8ke3N1YnR5cGV9LmApOwogICAgfQogICAgbGV0IGRhdGE7CiAgICB0cnkgewogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICJNTVR5cGUxIjoKICAgICAgICAgIGluZm8oIk1NVHlwZTEgZm9udCAoIiArIG5hbWUgKyAiKSwgZmFsbGluZyBiYWNrIHRvIFR5cGUxLiIpOwogICAgICAgIGNhc2UgIlR5cGUxIjoKICAgICAgICBjYXNlICJDSURGb250VHlwZTAiOgogICAgICAgICAgdGhpcy5taW1ldHlwZSA9ICJmb250L29wZW50eXBlIjsKICAgICAgICAgIGNvbnN0IGNmZiA9IHN1YnR5cGUgPT09ICJUeXBlMUMiIHx8IHN1YnR5cGUgPT09ICJDSURGb250VHlwZTBDIiA/IG5ldyBDRkZGb250KGZpbGUsIHByb3BlcnRpZXMpIDogbmV3IFR5cGUxRm9udChuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGFkanVzdFdpZHRocyhwcm9wZXJ0aWVzKTsKICAgICAgICAgIGRhdGEgPSB0aGlzLmNvbnZlcnQobmFtZSwgY2ZmLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk9wZW5UeXBlIjoKICAgICAgICBjYXNlICJUcnVlVHlwZSI6CiAgICAgICAgY2FzZSAiQ0lERm9udFR5cGUyIjoKICAgICAgICAgIHRoaXMubWltZXR5cGUgPSAiZm9udC9vcGVudHlwZSI7CiAgICAgICAgICBkYXRhID0gdGhpcy5jaGVja0FuZFJlcGFpcihuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGFkanVzdFdpZHRocyhwcm9wZXJ0aWVzKTsKICAgICAgICAgIGlmICh0aGlzLmlzT3BlblR5cGUpIHsKICAgICAgICAgICAgdHlwZSA9ICJPcGVuVHlwZSI7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBGb250ICR7dHlwZX0gaXMgbm90IHN1cHBvcnRlZGApOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHdhcm4oZSk7CiAgICAgIHRoaXMuZmFsbGJhY2tUb1N5c3RlbUZvbnQocHJvcGVydGllcyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGFtZW5kRmFsbGJhY2tUb1VuaWNvZGUocHJvcGVydGllcyk7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMuc3VidHlwZSA9IHN1YnR5cGU7CiAgICB0aGlzLmZvbnRNYXRyaXggPSBwcm9wZXJ0aWVzLmZvbnRNYXRyaXg7CiAgICB0aGlzLndpZHRocyA9IHByb3BlcnRpZXMud2lkdGhzOwogICAgdGhpcy5kZWZhdWx0V2lkdGggPSBwcm9wZXJ0aWVzLmRlZmF1bHRXaWR0aDsKICAgIHRoaXMudG9Vbmljb2RlID0gcHJvcGVydGllcy50b1VuaWNvZGU7CiAgICB0aGlzLnNlYWNNYXAgPSBwcm9wZXJ0aWVzLnNlYWNNYXA7CiAgfQogIGdldCByZW5kZXJlcigpIHsKICAgIGNvbnN0IHJlbmRlcmVyID0gRm9udFJlbmRlcmVyRmFjdG9yeS5jcmVhdGUodGhpcywgU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgInJlbmRlcmVyIiwgcmVuZGVyZXIpOwogIH0KICBleHBvcnREYXRhKCkgewogICAgY29uc3QgZGF0YSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBmb3IgKGNvbnN0IHByb3Agb2YgRVhQT1JUX0RBVEFfUFJPUEVSVElFUykgewogICAgICBjb25zdCB2YWx1ZSA9IHRoaXNbcHJvcF07CiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZGF0YVtwcm9wXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuZm9udEV4dHJhUHJvcGVydGllcykgewogICAgICByZXR1cm4gewogICAgICAgIGRhdGEKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IGV4dHJhID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3QgcHJvcCBvZiBFWFBPUlRfREFUQV9FWFRSQV9QUk9QRVJUSUVTKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1twcm9wXTsKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBleHRyYVtwcm9wXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBkYXRhLAogICAgICBleHRyYQogICAgfTsKICB9CiAgZmFsbGJhY2tUb1N5c3RlbUZvbnQocHJvcGVydGllcykgewogICAgdGhpcy5taXNzaW5nRmlsZSA9IHRydWU7CiAgICBjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIHR5cGUKICAgIH0gPSB0aGlzOwogICAgbGV0IGZvbnROYW1lID0gbm9ybWFsaXplRm9udE5hbWUobmFtZSk7CiAgICBjb25zdCBzdGRGb250TWFwID0gZ2V0U3RkRm9udE1hcCgpLAogICAgICBub25TdGRGb250TWFwID0gZ2V0Tm9uU3RkRm9udE1hcCgpOwogICAgY29uc3QgaXNTdGFuZGFyZEZvbnQgPSAhIXN0ZEZvbnRNYXBbZm9udE5hbWVdOwogICAgY29uc3QgaXNNYXBwZWRUb1N0YW5kYXJkRm9udCA9ICEhKG5vblN0ZEZvbnRNYXBbZm9udE5hbWVdICYmIHN0ZEZvbnRNYXBbbm9uU3RkRm9udE1hcFtmb250TmFtZV1dKTsKICAgIGZvbnROYW1lID0gc3RkRm9udE1hcFtmb250TmFtZV0gfHwgbm9uU3RkRm9udE1hcFtmb250TmFtZV0gfHwgZm9udE5hbWU7CiAgICBjb25zdCBmb250QmFzaWNNZXRyaWNzTWFwID0gZ2V0Rm9udEJhc2ljTWV0cmljcygpOwogICAgY29uc3QgbWV0cmljcyA9IGZvbnRCYXNpY01ldHJpY3NNYXBbZm9udE5hbWVdOwogICAgaWYgKG1ldHJpY3MpIHsKICAgICAgaWYgKGlzTmFOKHRoaXMuYXNjZW50KSkgewogICAgICAgIHRoaXMuYXNjZW50ID0gbWV0cmljcy5hc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICAgIH0KICAgICAgaWYgKGlzTmFOKHRoaXMuZGVzY2VudCkpIHsKICAgICAgICB0aGlzLmRlc2NlbnQgPSBtZXRyaWNzLmRlc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICAgIH0KICAgICAgaWYgKGlzTmFOKHRoaXMuY2FwSGVpZ2h0KSkgewogICAgICAgIHRoaXMuY2FwSGVpZ2h0ID0gbWV0cmljcy5jYXBIZWlnaHQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuYm9sZCA9IC9ib2xkL2dpLnRlc3QoZm9udE5hbWUpOwogICAgdGhpcy5pdGFsaWMgPSAvb2JsaXF1ZXxpdGFsaWMvZ2kudGVzdChmb250TmFtZSk7CiAgICB0aGlzLmJsYWNrID0gL0JsYWNrL2cudGVzdChuYW1lKTsKICAgIGNvbnN0IGlzTmFycm93ID0gL05hcnJvdy9nLnRlc3QobmFtZSk7CiAgICB0aGlzLnJlbWVhc3VyZSA9ICghaXNTdGFuZGFyZEZvbnQgfHwgaXNOYXJyb3cpICYmIE9iamVjdC5rZXlzKHRoaXMud2lkdGhzKS5sZW5ndGggPiAwOwogICAgaWYgKChpc1N0YW5kYXJkRm9udCB8fCBpc01hcHBlZFRvU3RhbmRhcmRGb250KSAmJiB0eXBlID09PSAiQ0lERm9udFR5cGUyIiAmJiB0aGlzLmNpZEVuY29kaW5nLnN0YXJ0c1dpdGgoIklkZW50aXR5LSIpKSB7CiAgICAgIGNvbnN0IGNpZFRvR2lkTWFwID0gcHJvcGVydGllcy5jaWRUb0dpZE1hcDsKICAgICAgY29uc3QgbWFwID0gW107CiAgICAgIGFwcGx5U3RhbmRhcmRGb250R2x5cGhNYXAobWFwLCBnZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMoKSk7CiAgICAgIGlmICgvQXJpYWwtP0JsYWNrL2kudGVzdChuYW1lKSkgewogICAgICAgIGFwcGx5U3RhbmRhcmRGb250R2x5cGhNYXAobWFwLCBnZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckFyaWFsQmxhY2soKSk7CiAgICAgIH0gZWxzZSBpZiAoL0NhbGlicmkvaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgYXBwbHlTdGFuZGFyZEZvbnRHbHlwaE1hcChtYXAsIGdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQ2FsaWJyaSgpKTsKICAgICAgfQogICAgICBpZiAoY2lkVG9HaWRNYXApIHsKICAgICAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICAgICAgY29uc3QgY2lkID0gbWFwW2NoYXJDb2RlXTsKICAgICAgICAgIGlmIChjaWRUb0dpZE1hcFtjaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbWFwWytjaGFyQ29kZV0gPSBjaWRUb0dpZE1hcFtjaWRdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2lkVG9HaWRNYXAubGVuZ3RoICE9PSB0aGlzLnRvVW5pY29kZS5sZW5ndGggJiYgcHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCAmJiB0aGlzLnRvVW5pY29kZSBpbnN0YW5jZW9mIElkZW50aXR5VG9Vbmljb2RlTWFwKSB7CiAgICAgICAgICB0aGlzLnRvVW5pY29kZS5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgdW5pY29kZUNoYXJDb2RlKSB7CiAgICAgICAgICAgIGNvbnN0IGNpZCA9IG1hcFtjaGFyQ29kZV07CiAgICAgICAgICAgIGlmIChjaWRUb0dpZE1hcFtjaWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IHVuaWNvZGVDaGFyQ29kZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghKHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApKSB7CiAgICAgICAgdGhpcy50b1VuaWNvZGUuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUsIHVuaWNvZGVDaGFyQ29kZSkgewogICAgICAgICAgbWFwWytjaGFyQ29kZV0gPSB1bmljb2RlQ2hhckNvZGU7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbWFwOwogICAgICB0aGlzLnRvVW5pY29kZSA9IG5ldyBUb1VuaWNvZGVNYXAobWFwKTsKICAgIH0gZWxzZSBpZiAoL1N5bWJvbC9pLnRlc3QoZm9udE5hbWUpKSB7CiAgICAgIHRoaXMudG9Gb250Q2hhciA9IGJ1aWxkVG9Gb250Q2hhcihTeW1ib2xTZXRFbmNvZGluZywgZ2V0R2x5cGhzVW5pY29kZSgpLCB0aGlzLmRpZmZlcmVuY2VzKTsKICAgIH0gZWxzZSBpZiAoL0RpbmdiYXRzL2kudGVzdChmb250TmFtZSkpIHsKICAgICAgdGhpcy50b0ZvbnRDaGFyID0gYnVpbGRUb0ZvbnRDaGFyKFphcGZEaW5nYmF0c0VuY29kaW5nLCBnZXREaW5nYmF0c0dseXBoc1VuaWNvZGUoKSwgdGhpcy5kaWZmZXJlbmNlcyk7CiAgICB9IGVsc2UgaWYgKGlzU3RhbmRhcmRGb250IHx8IGlzTWFwcGVkVG9TdGFuZGFyZEZvbnQpIHsKICAgICAgY29uc3QgbWFwID0gYnVpbGRUb0ZvbnRDaGFyKHRoaXMuZGVmYXVsdEVuY29kaW5nLCBnZXRHbHlwaHNVbmljb2RlKCksIHRoaXMuZGlmZmVyZW5jZXMpOwogICAgICBpZiAodHlwZSA9PT0gIkNJREZvbnRUeXBlMiIgJiYgIXRoaXMuY2lkRW5jb2Rpbmcuc3RhcnRzV2l0aCgiSWRlbnRpdHktIikgJiYgISh0aGlzLnRvVW5pY29kZSBpbnN0YW5jZW9mIElkZW50aXR5VG9Vbmljb2RlTWFwKSkgewogICAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpIHsKICAgICAgICAgIG1hcFsrY2hhckNvZGVdID0gdW5pY29kZUNoYXJDb2RlOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMudG9Gb250Q2hhciA9IG1hcDsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGdseXBoc1VuaWNvZGVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgICAgIGNvbnN0IG1hcCA9IFtdOwogICAgICB0aGlzLnRvVW5pY29kZS5mb3JFYWNoKChjaGFyQ29kZSwgdW5pY29kZUNoYXJDb2RlKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLmNvbXBvc2l0ZSkgewogICAgICAgICAgY29uc3QgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV0gfHwgdGhpcy5kZWZhdWx0RW5jb2RpbmdbY2hhckNvZGVdOwogICAgICAgICAgY29uc3QgdW5pY29kZSA9IGdldFVuaWNvZGVGb3JHbHlwaChnbHlwaE5hbWUsIGdseXBoc1VuaWNvZGVNYXApOwogICAgICAgICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgICAgICAgIHVuaWNvZGVDaGFyQ29kZSA9IHVuaWNvZGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG1hcFsrY2hhckNvZGVdID0gdW5pY29kZUNoYXJDb2RlOwogICAgICB9KTsKICAgICAgaWYgKHRoaXMuY29tcG9zaXRlICYmIHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgICAgICBpZiAoL1RhaG9tYXxWZXJkYW5hL2kudGVzdChuYW1lKSkgewogICAgICAgICAgYXBwbHlTdGFuZGFyZEZvbnRHbHlwaE1hcChtYXAsIGdldEdseXBoTWFwRm9yU3RhbmRhcmRGb250cygpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbWFwOwogICAgfQogICAgYW1lbmRGYWxsYmFja1RvVW5pY29kZShwcm9wZXJ0aWVzKTsKICAgIHRoaXMubG9hZGVkTmFtZSA9IGZvbnROYW1lLnNwbGl0KCItIiwgMSlbMF07CiAgfQogIGNoZWNrQW5kUmVwYWlyKG5hbWUsIGZvbnQsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IFZBTElEX1RBQkxFUyA9IFsiT1MvMiIsICJjbWFwIiwgImhlYWQiLCAiaGhlYSIsICJobXR4IiwgIm1heHAiLCAibmFtZSIsICJwb3N0IiwgImxvY2EiLCAiZ2x5ZiIsICJmcGdtIiwgInByZXAiLCAiY3Z0ICIsICJDRkYgIl07CiAgICBmdW5jdGlvbiByZWFkVGFibGVzKGZpbGUsIG51bVRhYmxlcykgewogICAgICBjb25zdCB0YWJsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB0YWJsZXNbIk9TLzIiXSA9IG51bGw7CiAgICAgIHRhYmxlcy5jbWFwID0gbnVsbDsKICAgICAgdGFibGVzLmhlYWQgPSBudWxsOwogICAgICB0YWJsZXMuaGhlYSA9IG51bGw7CiAgICAgIHRhYmxlcy5obXR4ID0gbnVsbDsKICAgICAgdGFibGVzLm1heHAgPSBudWxsOwogICAgICB0YWJsZXMubmFtZSA9IG51bGw7CiAgICAgIHRhYmxlcy5wb3N0ID0gbnVsbDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1UYWJsZXM7IGkrKykgewogICAgICAgIGNvbnN0IHRhYmxlID0gcmVhZFRhYmxlRW50cnkoZmlsZSk7CiAgICAgICAgaWYgKCFWQUxJRF9UQUJMRVMuaW5jbHVkZXModGFibGUudGFnKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0YWJsZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0YWJsZXNbdGFibGUudGFnXSA9IHRhYmxlOwogICAgICB9CiAgICAgIHJldHVybiB0YWJsZXM7CiAgICB9CiAgICBmdW5jdGlvbiByZWFkVGFibGVFbnRyeShmaWxlKSB7CiAgICAgIGNvbnN0IHRhZyA9IGZpbGUuZ2V0U3RyaW5nKDQpOwogICAgICBjb25zdCBjaGVja3N1bSA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICBjb25zdCBsZW5ndGggPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgIGNvbnN0IHByZXZpb3VzUG9zaXRpb24gPSBmaWxlLnBvczsKICAgICAgZmlsZS5wb3MgPSBmaWxlLnN0YXJ0IHx8IDA7CiAgICAgIGZpbGUuc2tpcChvZmZzZXQpOwogICAgICBjb25zdCBkYXRhID0gZmlsZS5nZXRCeXRlcyhsZW5ndGgpOwogICAgICBmaWxlLnBvcyA9IHByZXZpb3VzUG9zaXRpb247CiAgICAgIGlmICh0YWcgPT09ICJoZWFkIikgewogICAgICAgIGRhdGFbOF0gPSBkYXRhWzldID0gZGF0YVsxMF0gPSBkYXRhWzExXSA9IDA7CiAgICAgICAgZGF0YVsxN10gfD0gMHgyMDsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIHRhZywKICAgICAgICBjaGVja3N1bSwKICAgICAgICBsZW5ndGgsCiAgICAgICAgb2Zmc2V0LAogICAgICAgIGRhdGEKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlYWRPcGVuVHlwZUhlYWRlcih0dGYpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB2ZXJzaW9uOiB0dGYuZ2V0U3RyaW5nKDQpLAogICAgICAgIG51bVRhYmxlczogdHRmLmdldFVpbnQxNigpLAogICAgICAgIHNlYXJjaFJhbmdlOiB0dGYuZ2V0VWludDE2KCksCiAgICAgICAgZW50cnlTZWxlY3RvcjogdHRmLmdldFVpbnQxNigpLAogICAgICAgIHJhbmdlU2hpZnQ6IHR0Zi5nZXRVaW50MTYoKQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkhlYWRlcih0dGMpIHsKICAgICAgY29uc3QgdHRjVGFnID0gdHRjLmdldFN0cmluZyg0KTsKICAgICAgYXNzZXJ0KHR0Y1RhZyA9PT0gInR0Y2YiLCAiTXVzdCBiZSBhIFRydWVUeXBlIENvbGxlY3Rpb24gZm9udC4iKTsKICAgICAgY29uc3QgbWFqb3JWZXJzaW9uID0gdHRjLmdldFVpbnQxNigpOwogICAgICBjb25zdCBtaW5vclZlcnNpb24gPSB0dGMuZ2V0VWludDE2KCk7CiAgICAgIGNvbnN0IG51bUZvbnRzID0gdHRjLmdldEludDMyKCkgPj4+IDA7CiAgICAgIGNvbnN0IG9mZnNldFRhYmxlID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRm9udHM7IGkrKykgewogICAgICAgIG9mZnNldFRhYmxlLnB1c2godHRjLmdldEludDMyKCkgPj4+IDApOwogICAgICB9CiAgICAgIGNvbnN0IGhlYWRlciA9IHsKICAgICAgICB0dGNUYWcsCiAgICAgICAgbWFqb3JWZXJzaW9uLAogICAgICAgIG1pbm9yVmVyc2lvbiwKICAgICAgICBudW1Gb250cywKICAgICAgICBvZmZzZXRUYWJsZQogICAgICB9OwogICAgICBzd2l0Y2ggKG1ham9yVmVyc2lvbikgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJldHVybiBoZWFkZXI7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaGVhZGVyLmRzaWdUYWcgPSB0dGMuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIGhlYWRlci5kc2lnTGVuZ3RoID0gdHRjLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICBoZWFkZXIuZHNpZ09mZnNldCA9IHR0Yy5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgcmV0dXJuIGhlYWRlcjsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgVHJ1ZVR5cGUgQ29sbGVjdGlvbiBtYWpvclZlcnNpb246ICR7bWFqb3JWZXJzaW9ufS5gKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlYWRUcnVlVHlwZUNvbGxlY3Rpb25EYXRhKHR0YywgZm9udE5hbWUpIHsKICAgICAgY29uc3QgewogICAgICAgIG51bUZvbnRzLAogICAgICAgIG9mZnNldFRhYmxlCiAgICAgIH0gPSByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uSGVhZGVyKHR0Yyk7CiAgICAgIGNvbnN0IGZvbnROYW1lUGFydHMgPSBmb250TmFtZS5zcGxpdCgiKyIpOwogICAgICBsZXQgZmFsbGJhY2tEYXRhOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZvbnRzOyBpKyspIHsKICAgICAgICB0dGMucG9zID0gKHR0Yy5zdGFydCB8fCAwKSArIG9mZnNldFRhYmxlW2ldOwogICAgICAgIGNvbnN0IHBvdGVudGlhbEhlYWRlciA9IHJlYWRPcGVuVHlwZUhlYWRlcih0dGMpOwogICAgICAgIGNvbnN0IHBvdGVudGlhbFRhYmxlcyA9IHJlYWRUYWJsZXModHRjLCBwb3RlbnRpYWxIZWFkZXIubnVtVGFibGVzKTsKICAgICAgICBpZiAoIXBvdGVudGlhbFRhYmxlcy5uYW1lKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoJ1RydWVUeXBlIENvbGxlY3Rpb24gZm9udCBtdXN0IGNvbnRhaW4gYSAibmFtZSIgdGFibGUuJyk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IFtuYW1lVGFibGVdID0gcmVhZE5hbWVUYWJsZShwb3RlbnRpYWxUYWJsZXMubmFtZSk7CiAgICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gbmFtZVRhYmxlLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgIGZvciAobGV0IGsgPSAwLCBrayA9IG5hbWVUYWJsZVtqXS5sZW5ndGg7IGsgPCBrazsgaysrKSB7CiAgICAgICAgICAgIGNvbnN0IG5hbWVFbnRyeSA9IG5hbWVUYWJsZVtqXVtrXT8ucmVwbGFjZUFsbCgvXHMvZywgIiIpOwogICAgICAgICAgICBpZiAoIW5hbWVFbnRyeSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuYW1lRW50cnkgPT09IGZvbnROYW1lKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGhlYWRlcjogcG90ZW50aWFsSGVhZGVyLAogICAgICAgICAgICAgICAgdGFibGVzOiBwb3RlbnRpYWxUYWJsZXMKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmb250TmFtZVBhcnRzLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgZm9udE5hbWVQYXJ0cykgewogICAgICAgICAgICAgIGlmIChuYW1lRW50cnkgPT09IHBhcnQpIHsKICAgICAgICAgICAgICAgIGZhbGxiYWNrRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgbmFtZTogcGFydCwKICAgICAgICAgICAgICAgICAgaGVhZGVyOiBwb3RlbnRpYWxIZWFkZXIsCiAgICAgICAgICAgICAgICAgIHRhYmxlczogcG90ZW50aWFsVGFibGVzCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZmFsbGJhY2tEYXRhKSB7CiAgICAgICAgd2FybihgVHJ1ZVR5cGUgQ29sbGVjdGlvbiBkb2VzIG5vdCBjb250YWluICIke2ZvbnROYW1lfSIgZm9udCwgYCArIGBmYWxsaW5nIGJhY2sgdG8gIiR7ZmFsbGJhY2tEYXRhLm5hbWV9IiBmb250IGluc3RlYWQuYCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGhlYWRlcjogZmFsbGJhY2tEYXRhLmhlYWRlciwKICAgICAgICAgIHRhYmxlczogZmFsbGJhY2tEYXRhLnRhYmxlcwogICAgICAgIH07CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBUcnVlVHlwZSBDb2xsZWN0aW9uIGRvZXMgbm90IGNvbnRhaW4gIiR7Zm9udE5hbWV9IiBmb250LmApOwogICAgfQogICAgZnVuY3Rpb24gcmVhZENtYXBUYWJsZShjbWFwLCBmaWxlLCBpc1N5bWJvbGljRm9udCwgaGFzRW5jb2RpbmcpIHsKICAgICAgaWYgKCFjbWFwKSB7CiAgICAgICAgd2FybigiTm8gY21hcCB0YWJsZSBhdmFpbGFibGUuIik7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHBsYXRmb3JtSWQ6IC0xLAogICAgICAgICAgZW5jb2RpbmdJZDogLTEsCiAgICAgICAgICBtYXBwaW5nczogW10sCiAgICAgICAgICBoYXNTaG9ydENtYXA6IGZhbHNlCiAgICAgICAgfTsKICAgICAgfQogICAgICBsZXQgc2VnbWVudDsKICAgICAgbGV0IHN0YXJ0ID0gKGZpbGUuc3RhcnQgfHwgMCkgKyBjbWFwLm9mZnNldDsKICAgICAgZmlsZS5wb3MgPSBzdGFydDsKICAgICAgZmlsZS5za2lwKDIpOwogICAgICBjb25zdCBudW1UYWJsZXMgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICBsZXQgcG90ZW50aWFsVGFibGU7CiAgICAgIGxldCBjYW5CcmVhayA9IGZhbHNlOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgICAgY29uc3QgcGxhdGZvcm1JZCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgY29uc3QgZW5jb2RpbmdJZCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIGxldCB1c2VUYWJsZSA9IGZhbHNlOwogICAgICAgIGlmIChwb3RlbnRpYWxUYWJsZT8ucGxhdGZvcm1JZCA9PT0gcGxhdGZvcm1JZCAmJiBwb3RlbnRpYWxUYWJsZT8uZW5jb2RpbmdJZCA9PT0gZW5jb2RpbmdJZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChwbGF0Zm9ybUlkID09PSAwICYmIChlbmNvZGluZ0lkID09PSAwIHx8IGVuY29kaW5nSWQgPT09IDEgfHwgZW5jb2RpbmdJZCA9PT0gMykpIHsKICAgICAgICAgIHVzZVRhYmxlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHBsYXRmb3JtSWQgPT09IDEgJiYgZW5jb2RpbmdJZCA9PT0gMCkgewogICAgICAgICAgdXNlVGFibGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAocGxhdGZvcm1JZCA9PT0gMyAmJiBlbmNvZGluZ0lkID09PSAxICYmIChoYXNFbmNvZGluZyB8fCAhcG90ZW50aWFsVGFibGUpKSB7CiAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgICBpZiAoIWlzU3ltYm9saWNGb250KSB7CiAgICAgICAgICAgIGNhbkJyZWFrID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGlzU3ltYm9saWNGb250ICYmIHBsYXRmb3JtSWQgPT09IDMgJiYgZW5jb2RpbmdJZCA9PT0gMCkgewogICAgICAgICAgdXNlVGFibGUgPSB0cnVlOwogICAgICAgICAgbGV0IGNvcnJlY3RseVNvcnRlZCA9IHRydWU7CiAgICAgICAgICBpZiAoaSA8IG51bVRhYmxlcyAtIDEpIHsKICAgICAgICAgICAgY29uc3QgbmV4dEJ5dGVzID0gZmlsZS5wZWVrQnl0ZXMoMiksCiAgICAgICAgICAgICAgbmV4dFBsYXRmb3JtSWQgPSBpbnQxNihuZXh0Qnl0ZXNbMF0sIG5leHRCeXRlc1sxXSk7CiAgICAgICAgICAgIGlmIChuZXh0UGxhdGZvcm1JZCA8IHBsYXRmb3JtSWQpIHsKICAgICAgICAgICAgICBjb3JyZWN0bHlTb3J0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvcnJlY3RseVNvcnRlZCkgewogICAgICAgICAgICBjYW5CcmVhayA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh1c2VUYWJsZSkgewogICAgICAgICAgcG90ZW50aWFsVGFibGUgPSB7CiAgICAgICAgICAgIHBsYXRmb3JtSWQsCiAgICAgICAgICAgIGVuY29kaW5nSWQsCiAgICAgICAgICAgIG9mZnNldAogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKGNhbkJyZWFrKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHBvdGVudGlhbFRhYmxlKSB7CiAgICAgICAgZmlsZS5wb3MgPSBzdGFydCArIHBvdGVudGlhbFRhYmxlLm9mZnNldDsKICAgICAgfQogICAgICBpZiAoIXBvdGVudGlhbFRhYmxlIHx8IGZpbGUucGVla0J5dGUoKSA9PT0gLTEpIHsKICAgICAgICB3YXJuKCJDb3VsZCBub3QgZmluZCBhIHByZWZlcnJlZCBjbWFwIHRhYmxlLiIpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwbGF0Zm9ybUlkOiAtMSwKICAgICAgICAgIGVuY29kaW5nSWQ6IC0xLAogICAgICAgICAgbWFwcGluZ3M6IFtdLAogICAgICAgICAgaGFzU2hvcnRDbWFwOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0KICAgICAgY29uc3QgZm9ybWF0ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgbGV0IGhhc1Nob3J0Q21hcCA9IGZhbHNlOwogICAgICBjb25zdCBtYXBwaW5ncyA9IFtdOwogICAgICBsZXQgaiwgZ2x5cGhJZDsKICAgICAgaWYgKGZvcm1hdCA9PT0gMCkgewogICAgICAgIGZpbGUuc2tpcCgyICsgMik7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDI1NjsgaisrKSB7CiAgICAgICAgICBjb25zdCBpbmRleCA9IGZpbGUuZ2V0Qnl0ZSgpOwogICAgICAgICAgaWYgKCFpbmRleCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICBjaGFyQ29kZTogaiwKICAgICAgICAgICAgZ2x5cGhJZDogaW5kZXgKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBoYXNTaG9ydENtYXAgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gMikgewogICAgICAgIGZpbGUuc2tpcCgyICsgMik7CiAgICAgICAgY29uc3Qgc3ViSGVhZGVyS2V5cyA9IFtdOwogICAgICAgIGxldCBtYXhTdWJIZWFkZXJLZXkgPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICAgIGNvbnN0IHN1YkhlYWRlcktleSA9IGZpbGUuZ2V0VWludDE2KCkgPj4gMzsKICAgICAgICAgIHN1YkhlYWRlcktleXMucHVzaChzdWJIZWFkZXJLZXkpOwogICAgICAgICAgbWF4U3ViSGVhZGVyS2V5ID0gTWF0aC5tYXgoc3ViSGVhZGVyS2V5LCBtYXhTdWJIZWFkZXJLZXkpOwogICAgICAgIH0KICAgICAgICBjb25zdCBzdWJIZWFkZXJzID0gW107CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbWF4U3ViSGVhZGVyS2V5OyBpKyspIHsKICAgICAgICAgIHN1YkhlYWRlcnMucHVzaCh7CiAgICAgICAgICAgIGZpcnN0Q29kZTogZmlsZS5nZXRVaW50MTYoKSwKICAgICAgICAgICAgZW50cnlDb3VudDogZmlsZS5nZXRVaW50MTYoKSwKICAgICAgICAgICAgaWREZWx0YTogc2lnbmVkSW50MTYoZmlsZS5nZXRCeXRlKCksIGZpbGUuZ2V0Qnl0ZSgpKSwKICAgICAgICAgICAgaWRSYW5nZVBvczogZmlsZS5wb3MgKyBmaWxlLmdldFVpbnQxNigpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7IGkrKykgewogICAgICAgICAgaWYgKHN1YkhlYWRlcktleXNbaV0gPT09IDApIHsKICAgICAgICAgICAgZmlsZS5wb3MgPSBzdWJIZWFkZXJzWzBdLmlkUmFuZ2VQb3MgKyAyICogaTsKICAgICAgICAgICAgZ2x5cGhJZCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICAgIGNoYXJDb2RlOiBpLAogICAgICAgICAgICAgIGdseXBoSWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBzID0gc3ViSGVhZGVyc1tzdWJIZWFkZXJLZXlzW2ldXTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IHMuZW50cnlDb3VudDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgY2hhckNvZGUgPSAoaSA8PCA4KSArIGogKyBzLmZpcnN0Q29kZTsKICAgICAgICAgICAgICBmaWxlLnBvcyA9IHMuaWRSYW5nZVBvcyArIDIgKiBqOwogICAgICAgICAgICAgIGdseXBoSWQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgICAgICAgIGlmIChnbHlwaElkICE9PSAwKSB7CiAgICAgICAgICAgICAgICBnbHlwaElkID0gKGdseXBoSWQgKyBzLmlkRGVsdGEpICUgNjU1MzY7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICAgICAgY2hhckNvZGUsCiAgICAgICAgICAgICAgICBnbHlwaElkCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSA0KSB7CiAgICAgICAgZmlsZS5za2lwKDIgKyAyKTsKICAgICAgICBjb25zdCBzZWdDb3VudCA9IGZpbGUuZ2V0VWludDE2KCkgPj4gMTsKICAgICAgICBmaWxlLnNraXAoNik7CiAgICAgICAgY29uc3Qgc2VnbWVudHMgPSBbXTsKICAgICAgICBsZXQgc2VnSW5kZXg7CiAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgIHNlZ21lbnRzLnB1c2goewogICAgICAgICAgICBlbmQ6IGZpbGUuZ2V0VWludDE2KCkKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmaWxlLnNraXAoMik7CiAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgIHNlZ21lbnRzW3NlZ0luZGV4XS5zdGFydCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgfQogICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICBzZWdtZW50c1tzZWdJbmRleF0uZGVsdGEgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgIH0KICAgICAgICBsZXQgb2Zmc2V0c0NvdW50ID0gMCwKICAgICAgICAgIG9mZnNldEluZGV4OwogICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICBzZWdtZW50ID0gc2VnbWVudHNbc2VnSW5kZXhdOwogICAgICAgICAgY29uc3QgcmFuZ2VPZmZzZXQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgICAgaWYgKCFyYW5nZU9mZnNldCkgewogICAgICAgICAgICBzZWdtZW50Lm9mZnNldEluZGV4ID0gLTE7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgb2Zmc2V0SW5kZXggPSAocmFuZ2VPZmZzZXQgPj4gMSkgLSAoc2VnQ291bnQgLSBzZWdJbmRleCk7CiAgICAgICAgICBzZWdtZW50Lm9mZnNldEluZGV4ID0gb2Zmc2V0SW5kZXg7CiAgICAgICAgICBvZmZzZXRzQ291bnQgPSBNYXRoLm1heChvZmZzZXRzQ291bnQsIG9mZnNldEluZGV4ICsgc2VnbWVudC5lbmQgLSBzZWdtZW50LnN0YXJ0ICsgMSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG9mZnNldHMgPSBbXTsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgb2Zmc2V0c0NvdW50OyBqKyspIHsKICAgICAgICAgIG9mZnNldHMucHVzaChmaWxlLmdldFVpbnQxNigpKTsKICAgICAgICB9CiAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgIHNlZ21lbnQgPSBzZWdtZW50c1tzZWdJbmRleF07CiAgICAgICAgICBzdGFydCA9IHNlZ21lbnQuc3RhcnQ7CiAgICAgICAgICBjb25zdCBlbmQgPSBzZWdtZW50LmVuZDsKICAgICAgICAgIGNvbnN0IGRlbHRhID0gc2VnbWVudC5kZWx0YTsKICAgICAgICAgIG9mZnNldEluZGV4ID0gc2VnbWVudC5vZmZzZXRJbmRleDsKICAgICAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDw9IGVuZDsgaisrKSB7CiAgICAgICAgICAgIGlmIChqID09PSAweGZmZmYpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnbHlwaElkID0gb2Zmc2V0SW5kZXggPCAwID8gaiA6IG9mZnNldHNbb2Zmc2V0SW5kZXggKyBqIC0gc3RhcnRdOwogICAgICAgICAgICBnbHlwaElkID0gZ2x5cGhJZCArIGRlbHRhICYgMHhmZmZmOwogICAgICAgICAgICBtYXBwaW5ncy5wdXNoKHsKICAgICAgICAgICAgICBjaGFyQ29kZTogaiwKICAgICAgICAgICAgICBnbHlwaElkCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09IDYpIHsKICAgICAgICBmaWxlLnNraXAoMiArIDIpOwogICAgICAgIGNvbnN0IGZpcnN0Q29kZSA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgY29uc3QgZW50cnlDb3VudCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGVudHJ5Q291bnQ7IGorKykgewogICAgICAgICAgZ2x5cGhJZCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgICBjb25zdCBjaGFyQ29kZSA9IGZpcnN0Q29kZSArIGo7CiAgICAgICAgICBtYXBwaW5ncy5wdXNoKHsKICAgICAgICAgICAgY2hhckNvZGUsCiAgICAgICAgICAgIGdseXBoSWQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09IDEyKSB7CiAgICAgICAgZmlsZS5za2lwKDIgKyA0ICsgNCk7CiAgICAgICAgY29uc3Qgbkdyb3VwcyA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgbkdyb3VwczsgaisrKSB7CiAgICAgICAgICBjb25zdCBzdGFydENoYXJDb2RlID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgY29uc3QgZW5kQ2hhckNvZGUgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICBsZXQgZ2x5cGhDb2RlID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgZm9yIChsZXQgY2hhckNvZGUgPSBzdGFydENoYXJDb2RlOyBjaGFyQ29kZSA8PSBlbmRDaGFyQ29kZTsgY2hhckNvZGUrKykgewogICAgICAgICAgICBtYXBwaW5ncy5wdXNoKHsKICAgICAgICAgICAgICBjaGFyQ29kZSwKICAgICAgICAgICAgICBnbHlwaElkOiBnbHlwaENvZGUrKwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiY21hcCB0YWJsZSBoYXMgdW5zdXBwb3J0ZWQgZm9ybWF0OiAiICsgZm9ybWF0KTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcGxhdGZvcm1JZDogLTEsCiAgICAgICAgICBlbmNvZGluZ0lkOiAtMSwKICAgICAgICAgIG1hcHBpbmdzOiBbXSwKICAgICAgICAgIGhhc1Nob3J0Q21hcDogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIG1hcHBpbmdzLnNvcnQoKGEsIGIpID0+IGEuY2hhckNvZGUgLSBiLmNoYXJDb2RlKTsKICAgICAgY29uc3QgZmluYWxNYXBwaW5ncyA9IFtdLAogICAgICAgIHNlZW5DaGFyQ29kZXMgPSBuZXcgU2V0KCk7CiAgICAgIGZvciAoY29uc3QgbWFwIG9mIG1hcHBpbmdzKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgY2hhckNvZGUKICAgICAgICB9ID0gbWFwOwogICAgICAgIGlmIChzZWVuQ2hhckNvZGVzLmhhcyhjaGFyQ29kZSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBzZWVuQ2hhckNvZGVzLmFkZChjaGFyQ29kZSk7CiAgICAgICAgZmluYWxNYXBwaW5ncy5wdXNoKG1hcCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBwbGF0Zm9ybUlkOiBwb3RlbnRpYWxUYWJsZS5wbGF0Zm9ybUlkLAogICAgICAgIGVuY29kaW5nSWQ6IHBvdGVudGlhbFRhYmxlLmVuY29kaW5nSWQsCiAgICAgICAgbWFwcGluZ3M6IGZpbmFsTWFwcGluZ3MsCiAgICAgICAgaGFzU2hvcnRDbWFwCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBzYW5pdGl6ZU1ldHJpY3MoZmlsZSwgaGVhZGVyLCBtZXRyaWNzLCBoZWFkVGFibGUsIG51bUdseXBocywgZHVwRmlyc3RFbnRyeSkgewogICAgICBpZiAoIWhlYWRlcikgewogICAgICAgIGlmIChtZXRyaWNzKSB7CiAgICAgICAgICBtZXRyaWNzLmRhdGEgPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZmlsZS5wb3MgPSAoZmlsZS5zdGFydCB8fCAwKSArIGhlYWRlci5vZmZzZXQ7CiAgICAgIGZpbGUucG9zICs9IDQ7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGNvbnN0IGNhcmV0T2Zmc2V0ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgZmlsZS5wb3MgKz0gODsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgbGV0IG51bU9mTWV0cmljcyA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgIGlmIChjYXJldE9mZnNldCAhPT0gMCkgewogICAgICAgIGNvbnN0IG1hY1N0eWxlID0gaW50MTYoaGVhZFRhYmxlLmRhdGFbNDRdLCBoZWFkVGFibGUuZGF0YVs0NV0pOwogICAgICAgIGlmICghKG1hY1N0eWxlICYgMikpIHsKICAgICAgICAgIGhlYWRlci5kYXRhWzIyXSA9IDA7CiAgICAgICAgICBoZWFkZXIuZGF0YVsyM10gPSAwOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobnVtT2ZNZXRyaWNzID4gbnVtR2x5cGhzKSB7CiAgICAgICAgaW5mbyhgVGhlIG51bU9mTWV0cmljcyAoJHtudW1PZk1ldHJpY3N9KSBzaG91bGQgbm90IGJlIGAgKyBgZ3JlYXRlciB0aGFuIHRoZSBudW1HbHlwaHMgKCR7bnVtR2x5cGhzfSkuYCk7CiAgICAgICAgbnVtT2ZNZXRyaWNzID0gbnVtR2x5cGhzOwogICAgICAgIGhlYWRlci5kYXRhWzM0XSA9IChudW1PZk1ldHJpY3MgJiAweGZmMDApID4+IDg7CiAgICAgICAgaGVhZGVyLmRhdGFbMzVdID0gbnVtT2ZNZXRyaWNzICYgMHgwMGZmOwogICAgICB9CiAgICAgIGNvbnN0IG51bU9mU2lkZWJlYXJpbmdzID0gbnVtR2x5cGhzIC0gbnVtT2ZNZXRyaWNzOwogICAgICBjb25zdCBudW1NaXNzaW5nID0gbnVtT2ZTaWRlYmVhcmluZ3MgLSAobWV0cmljcy5sZW5ndGggLSBudW1PZk1ldHJpY3MgKiA0ID4+IDEpOwogICAgICBpZiAobnVtTWlzc2luZyA+IDApIHsKICAgICAgICBjb25zdCBlbnRyaWVzID0gbmV3IFVpbnQ4QXJyYXkobWV0cmljcy5sZW5ndGggKyBudW1NaXNzaW5nICogMik7CiAgICAgICAgZW50cmllcy5zZXQobWV0cmljcy5kYXRhKTsKICAgICAgICBpZiAoZHVwRmlyc3RFbnRyeSkgewogICAgICAgICAgZW50cmllc1ttZXRyaWNzLmxlbmd0aF0gPSBtZXRyaWNzLmRhdGFbMl07CiAgICAgICAgICBlbnRyaWVzW21ldHJpY3MubGVuZ3RoICsgMV0gPSBtZXRyaWNzLmRhdGFbM107CiAgICAgICAgfQogICAgICAgIG1ldHJpY3MuZGF0YSA9IGVudHJpZXM7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNhbml0aXplR2x5cGgoc291cmNlLCBzb3VyY2VTdGFydCwgc291cmNlRW5kLCBkZXN0LCBkZXN0U3RhcnQsIGhpbnRzVmFsaWQpIHsKICAgICAgY29uc3QgZ2x5cGhQcm9maWxlID0gewogICAgICAgIGxlbmd0aDogMCwKICAgICAgICBzaXplT2ZJbnN0cnVjdGlvbnM6IDAKICAgICAgfTsKICAgICAgaWYgKHNvdXJjZVN0YXJ0IDwgMCB8fCBzb3VyY2VTdGFydCA+PSBzb3VyY2UubGVuZ3RoIHx8IHNvdXJjZUVuZCA+IHNvdXJjZS5sZW5ndGggfHwgc291cmNlRW5kIC0gc291cmNlU3RhcnQgPD0gMTIpIHsKICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICB9CiAgICAgIGNvbnN0IGdseWYgPSBzb3VyY2Uuc3ViYXJyYXkoc291cmNlU3RhcnQsIHNvdXJjZUVuZCk7CiAgICAgIGNvbnN0IHhNaW4gPSBzaWduZWRJbnQxNihnbHlmWzJdLCBnbHlmWzNdKTsKICAgICAgY29uc3QgeU1pbiA9IHNpZ25lZEludDE2KGdseWZbNF0sIGdseWZbNV0pOwogICAgICBjb25zdCB4TWF4ID0gc2lnbmVkSW50MTYoZ2x5Zls2XSwgZ2x5Zls3XSk7CiAgICAgIGNvbnN0IHlNYXggPSBzaWduZWRJbnQxNihnbHlmWzhdLCBnbHlmWzldKTsKICAgICAgaWYgKHhNaW4gPiB4TWF4KSB7CiAgICAgICAgd3JpdGVTaWduZWRJbnQxNihnbHlmLCAyLCB4TWF4KTsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KGdseWYsIDYsIHhNaW4pOwogICAgICB9CiAgICAgIGlmICh5TWluID4geU1heCkgewogICAgICAgIHdyaXRlU2lnbmVkSW50MTYoZ2x5ZiwgNCwgeU1heCk7CiAgICAgICAgd3JpdGVTaWduZWRJbnQxNihnbHlmLCA4LCB5TWluKTsKICAgICAgfQogICAgICBjb25zdCBjb250b3Vyc0NvdW50ID0gc2lnbmVkSW50MTYoZ2x5ZlswXSwgZ2x5ZlsxXSk7CiAgICAgIGlmIChjb250b3Vyc0NvdW50IDwgMCkgewogICAgICAgIGlmIChjb250b3Vyc0NvdW50IDwgLTEpIHsKICAgICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgICAgfQogICAgICAgIGRlc3Quc2V0KGdseWYsIGRlc3RTdGFydCk7CiAgICAgICAgZ2x5cGhQcm9maWxlLmxlbmd0aCA9IGdseWYubGVuZ3RoOwogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgbGV0IGksCiAgICAgICAgaiA9IDEwLAogICAgICAgIGZsYWdzQ291bnQgPSAwOwogICAgICBmb3IgKGkgPSAwOyBpIDwgY29udG91cnNDb3VudDsgaSsrKSB7CiAgICAgICAgY29uc3QgZW5kUG9pbnQgPSBnbHlmW2pdIDw8IDggfCBnbHlmW2ogKyAxXTsKICAgICAgICBmbGFnc0NvdW50ID0gZW5kUG9pbnQgKyAxOwogICAgICAgIGogKz0gMjsKICAgICAgfQogICAgICBjb25zdCBpbnN0cnVjdGlvbnNTdGFydCA9IGo7CiAgICAgIGNvbnN0IGluc3RydWN0aW9uc0xlbmd0aCA9IGdseWZbal0gPDwgOCB8IGdseWZbaiArIDFdOwogICAgICBnbHlwaFByb2ZpbGUuc2l6ZU9mSW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb25zTGVuZ3RoOwogICAgICBqICs9IDIgKyBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgIGNvbnN0IGluc3RydWN0aW9uc0VuZCA9IGo7CiAgICAgIGxldCBjb29yZGluYXRlc0xlbmd0aCA9IDA7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBmbGFnc0NvdW50OyBpKyspIHsKICAgICAgICBjb25zdCBmbGFnID0gZ2x5ZltqKytdOwogICAgICAgIGlmIChmbGFnICYgMHhjMCkgewogICAgICAgICAgZ2x5ZltqIC0gMV0gPSBmbGFnICYgMHgzZjsKICAgICAgICB9CiAgICAgICAgbGV0IHhMZW5ndGggPSAyOwogICAgICAgIGlmIChmbGFnICYgMikgewogICAgICAgICAgeExlbmd0aCA9IDE7CiAgICAgICAgfSBlbHNlIGlmIChmbGFnICYgMTYpIHsKICAgICAgICAgIHhMZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgICBsZXQgeUxlbmd0aCA9IDI7CiAgICAgICAgaWYgKGZsYWcgJiA0KSB7CiAgICAgICAgICB5TGVuZ3RoID0gMTsKICAgICAgICB9IGVsc2UgaWYgKGZsYWcgJiAzMikgewogICAgICAgICAgeUxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHh5TGVuZ3RoID0geExlbmd0aCArIHlMZW5ndGg7CiAgICAgICAgY29vcmRpbmF0ZXNMZW5ndGggKz0geHlMZW5ndGg7CiAgICAgICAgaWYgKGZsYWcgJiA4KSB7CiAgICAgICAgICBjb25zdCByZXBlYXQgPSBnbHlmW2orK107CiAgICAgICAgICBpZiAocmVwZWF0ID09PSAwKSB7CiAgICAgICAgICAgIGdseWZbaiAtIDFdIF49IDg7CiAgICAgICAgICB9CiAgICAgICAgICBpICs9IHJlcGVhdDsKICAgICAgICAgIGNvb3JkaW5hdGVzTGVuZ3RoICs9IHJlcGVhdCAqIHh5TGVuZ3RoOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY29vcmRpbmF0ZXNMZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICB9CiAgICAgIGxldCBnbHlwaERhdGFMZW5ndGggPSBqICsgY29vcmRpbmF0ZXNMZW5ndGg7CiAgICAgIGlmIChnbHlwaERhdGFMZW5ndGggPiBnbHlmLmxlbmd0aCkgewogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgaWYgKCFoaW50c1ZhbGlkICYmIGluc3RydWN0aW9uc0xlbmd0aCA+IDApIHsKICAgICAgICBkZXN0LnNldChnbHlmLnN1YmFycmF5KDAsIGluc3RydWN0aW9uc1N0YXJ0KSwgZGVzdFN0YXJ0KTsKICAgICAgICBkZXN0LnNldChbMCwgMF0sIGRlc3RTdGFydCArIGluc3RydWN0aW9uc1N0YXJ0KTsKICAgICAgICBkZXN0LnNldChnbHlmLnN1YmFycmF5KGluc3RydWN0aW9uc0VuZCwgZ2x5cGhEYXRhTGVuZ3RoKSwgZGVzdFN0YXJ0ICsgaW5zdHJ1Y3Rpb25zU3RhcnQgKyAyKTsKICAgICAgICBnbHlwaERhdGFMZW5ndGggLT0gaW5zdHJ1Y3Rpb25zTGVuZ3RoOwogICAgICAgIGlmIChnbHlmLmxlbmd0aCAtIGdseXBoRGF0YUxlbmd0aCA+IDMpIHsKICAgICAgICAgIGdseXBoRGF0YUxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aCArIDMgJiB+MzsKICAgICAgICB9CiAgICAgICAgZ2x5cGhQcm9maWxlLmxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aDsKICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICB9CiAgICAgIGlmIChnbHlmLmxlbmd0aCAtIGdseXBoRGF0YUxlbmd0aCA+IDMpIHsKICAgICAgICBnbHlwaERhdGFMZW5ndGggPSBnbHlwaERhdGFMZW5ndGggKyAzICYgfjM7CiAgICAgICAgZGVzdC5zZXQoZ2x5Zi5zdWJhcnJheSgwLCBnbHlwaERhdGFMZW5ndGgpLCBkZXN0U3RhcnQpOwogICAgICAgIGdseXBoUHJvZmlsZS5sZW5ndGggPSBnbHlwaERhdGFMZW5ndGg7CiAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgfQogICAgICBkZXN0LnNldChnbHlmLCBkZXN0U3RhcnQpOwogICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5Zi5sZW5ndGg7CiAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICB9CiAgICBmdW5jdGlvbiBzYW5pdGl6ZUhlYWQoaGVhZCwgbnVtR2x5cGhzLCBsb2NhTGVuZ3RoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBoZWFkLmRhdGE7CiAgICAgIGNvbnN0IHZlcnNpb24gPSBpbnQzMihkYXRhWzBdLCBkYXRhWzFdLCBkYXRhWzJdLCBkYXRhWzNdKTsKICAgICAgaWYgKHZlcnNpb24gPj4gMTYgIT09IDEpIHsKICAgICAgICBpbmZvKCJBdHRlbXB0aW5nIHRvIGZpeCBpbnZhbGlkIHZlcnNpb24gaW4gaGVhZCB0YWJsZTogIiArIHZlcnNpb24pOwogICAgICAgIGRhdGFbMF0gPSAwOwogICAgICAgIGRhdGFbMV0gPSAxOwogICAgICAgIGRhdGFbMl0gPSAwOwogICAgICAgIGRhdGFbM10gPSAwOwogICAgICB9CiAgICAgIGNvbnN0IGluZGV4VG9Mb2NGb3JtYXQgPSBpbnQxNihkYXRhWzUwXSwgZGF0YVs1MV0pOwogICAgICBpZiAoaW5kZXhUb0xvY0Zvcm1hdCA8IDAgfHwgaW5kZXhUb0xvY0Zvcm1hdCA+IDEpIHsKICAgICAgICBpbmZvKCJBdHRlbXB0aW5nIHRvIGZpeCBpbnZhbGlkIGluZGV4VG9Mb2NGb3JtYXQgaW4gaGVhZCB0YWJsZTogIiArIGluZGV4VG9Mb2NGb3JtYXQpOwogICAgICAgIGNvbnN0IG51bUdseXBoc1BsdXNPbmUgPSBudW1HbHlwaHMgKyAxOwogICAgICAgIGlmIChsb2NhTGVuZ3RoID09PSBudW1HbHlwaHNQbHVzT25lIDw8IDEpIHsKICAgICAgICAgIGRhdGFbNTBdID0gMDsKICAgICAgICAgIGRhdGFbNTFdID0gMDsKICAgICAgICB9IGVsc2UgaWYgKGxvY2FMZW5ndGggPT09IG51bUdseXBoc1BsdXNPbmUgPDwgMikgewogICAgICAgICAgZGF0YVs1MF0gPSAwOwogICAgICAgICAgZGF0YVs1MV0gPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkNvdWxkIG5vdCBmaXggaW5kZXhUb0xvY0Zvcm1hdDogIiArIGluZGV4VG9Mb2NGb3JtYXQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2FuaXRpemVHbHlwaExvY2F0aW9ucyhsb2NhLCBnbHlmLCBudW1HbHlwaHMsIGlzR2x5cGhMb2NhdGlvbnNMb25nLCBoaW50c1ZhbGlkLCBkdXBGaXJzdEVudHJ5LCBtYXhTaXplT2ZJbnN0cnVjdGlvbnMpIHsKICAgICAgbGV0IGl0ZW1TaXplLCBpdGVtRGVjb2RlLCBpdGVtRW5jb2RlOwogICAgICBpZiAoaXNHbHlwaExvY2F0aW9uc0xvbmcpIHsKICAgICAgICBpdGVtU2l6ZSA9IDQ7CiAgICAgICAgaXRlbURlY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRGVjb2RlTG9uZyhkYXRhLCBvZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBkYXRhW29mZnNldF0gPDwgMjQgfCBkYXRhW29mZnNldCArIDFdIDw8IDE2IHwgZGF0YVtvZmZzZXQgKyAyXSA8PCA4IHwgZGF0YVtvZmZzZXQgKyAzXTsKICAgICAgICB9OwogICAgICAgIGl0ZW1FbmNvZGUgPSBmdW5jdGlvbiBmb250SXRlbUVuY29kZUxvbmcoZGF0YSwgb2Zmc2V0LCB2YWx1ZSkgewogICAgICAgICAgZGF0YVtvZmZzZXRdID0gdmFsdWUgPj4+IDI0ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+PiAxNiAmIDB4ZmY7CiAgICAgICAgICBkYXRhW29mZnNldCArIDJdID0gdmFsdWUgPj4gOCAmIDB4ZmY7CiAgICAgICAgICBkYXRhW29mZnNldCArIDNdID0gdmFsdWUgJiAweGZmOwogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaXRlbVNpemUgPSAyOwogICAgICAgIGl0ZW1EZWNvZGUgPSBmdW5jdGlvbiBmb250SXRlbURlY29kZShkYXRhLCBvZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBkYXRhW29mZnNldF0gPDwgOSB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTsKICAgICAgICB9OwogICAgICAgIGl0ZW1FbmNvZGUgPSBmdW5jdGlvbiBmb250SXRlbUVuY29kZShkYXRhLCBvZmZzZXQsIHZhbHVlKSB7CiAgICAgICAgICBkYXRhW29mZnNldF0gPSB2YWx1ZSA+PiA5ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+PiAxICYgMHhmZjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGNvbnN0IG51bUdseXBoc091dCA9IGR1cEZpcnN0RW50cnkgPyBudW1HbHlwaHMgKyAxIDogbnVtR2x5cGhzOwogICAgICBjb25zdCBsb2NhRGF0YVNpemUgPSBpdGVtU2l6ZSAqICgxICsgbnVtR2x5cGhzT3V0KTsKICAgICAgY29uc3QgbG9jYURhdGEgPSBuZXcgVWludDhBcnJheShsb2NhRGF0YVNpemUpOwogICAgICBsb2NhRGF0YS5zZXQobG9jYS5kYXRhLnN1YmFycmF5KDAsIGxvY2FEYXRhU2l6ZSkpOwogICAgICBsb2NhLmRhdGEgPSBsb2NhRGF0YTsKICAgICAgY29uc3Qgb2xkR2x5ZkRhdGEgPSBnbHlmLmRhdGE7CiAgICAgIGNvbnN0IG9sZEdseWZEYXRhTGVuZ3RoID0gb2xkR2x5ZkRhdGEubGVuZ3RoOwogICAgICBjb25zdCBuZXdHbHlmRGF0YSA9IG5ldyBVaW50OEFycmF5KG9sZEdseWZEYXRhTGVuZ3RoKTsKICAgICAgbGV0IGksIGo7CiAgICAgIGNvbnN0IGxvY2FFbnRyaWVzID0gW107CiAgICAgIGZvciAoaSA9IDAsIGogPSAwOyBpIDwgbnVtR2x5cGhzICsgMTsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgbGV0IG9mZnNldCA9IGl0ZW1EZWNvZGUobG9jYURhdGEsIGopOwogICAgICAgIGlmIChvZmZzZXQgPiBvbGRHbHlmRGF0YUxlbmd0aCkgewogICAgICAgICAgb2Zmc2V0ID0gb2xkR2x5ZkRhdGFMZW5ndGg7CiAgICAgICAgfQogICAgICAgIGxvY2FFbnRyaWVzLnB1c2goewogICAgICAgICAgaW5kZXg6IGksCiAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICBlbmRPZmZzZXQ6IDAKICAgICAgICB9KTsKICAgICAgfQogICAgICBsb2NhRW50cmllcy5zb3J0KChhLCBiKSA9PiBhLm9mZnNldCAtIGIub2Zmc2V0KTsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUdseXBoczsgaSsrKSB7CiAgICAgICAgbG9jYUVudHJpZXNbaV0uZW5kT2Zmc2V0ID0gbG9jYUVudHJpZXNbaSArIDFdLm9mZnNldDsKICAgICAgfQogICAgICBsb2NhRW50cmllcy5zb3J0KChhLCBiKSA9PiBhLmluZGV4IC0gYi5pbmRleCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1HbHlwaHM7IGkrKykgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIG9mZnNldCwKICAgICAgICAgIGVuZE9mZnNldAogICAgICAgIH0gPSBsb2NhRW50cmllc1tpXTsKICAgICAgICBpZiAob2Zmc2V0ICE9PSAwIHx8IGVuZE9mZnNldCAhPT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5leHRPZmZzZXQgPSBsb2NhRW50cmllc1tpICsgMV0ub2Zmc2V0OwogICAgICAgIGlmIChuZXh0T2Zmc2V0ID09PSAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbG9jYUVudHJpZXNbaV0uZW5kT2Zmc2V0ID0gbmV4dE9mZnNldDsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb25zdCBsYXN0ID0gbG9jYUVudHJpZXMuYXQoLTIpOwogICAgICBpZiAobGFzdC5vZmZzZXQgIT09IDAgJiYgbGFzdC5lbmRPZmZzZXQgPT09IDApIHsKICAgICAgICBsYXN0LmVuZE9mZnNldCA9IG9sZEdseWZEYXRhTGVuZ3RoOwogICAgICB9CiAgICAgIGNvbnN0IG1pc3NpbmdHbHlwaHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBsZXQgd3JpdGVPZmZzZXQgPSAwOwogICAgICBpdGVtRW5jb2RlKGxvY2FEYXRhLCAwLCB3cml0ZU9mZnNldCk7CiAgICAgIGZvciAoaSA9IDAsIGogPSBpdGVtU2l6ZTsgaSA8IG51bUdseXBoczsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgY29uc3QgZ2x5cGhQcm9maWxlID0gc2FuaXRpemVHbHlwaChvbGRHbHlmRGF0YSwgbG9jYUVudHJpZXNbaV0ub2Zmc2V0LCBsb2NhRW50cmllc1tpXS5lbmRPZmZzZXQsIG5ld0dseWZEYXRhLCB3cml0ZU9mZnNldCwgaGludHNWYWxpZCk7CiAgICAgICAgY29uc3QgbmV3TGVuZ3RoID0gZ2x5cGhQcm9maWxlLmxlbmd0aDsKICAgICAgICBpZiAobmV3TGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBtaXNzaW5nR2x5cGhzW2ldID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdseXBoUHJvZmlsZS5zaXplT2ZJbnN0cnVjdGlvbnMgPiBtYXhTaXplT2ZJbnN0cnVjdGlvbnMpIHsKICAgICAgICAgIG1heFNpemVPZkluc3RydWN0aW9ucyA9IGdseXBoUHJvZmlsZS5zaXplT2ZJbnN0cnVjdGlvbnM7CiAgICAgICAgfQogICAgICAgIHdyaXRlT2Zmc2V0ICs9IG5ld0xlbmd0aDsKICAgICAgICBpdGVtRW5jb2RlKGxvY2FEYXRhLCBqLCB3cml0ZU9mZnNldCk7CiAgICAgIH0KICAgICAgaWYgKHdyaXRlT2Zmc2V0ID09PSAwKSB7CiAgICAgICAgY29uc3Qgc2ltcGxlR2x5cGggPSBuZXcgVWludDhBcnJheShbMCwgMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgNDksIDBdKTsKICAgICAgICBmb3IgKGkgPSAwLCBqID0gaXRlbVNpemU7IGkgPCBudW1HbHlwaHNPdXQ7IGkrKywgaiArPSBpdGVtU2l6ZSkgewogICAgICAgICAgaXRlbUVuY29kZShsb2NhRGF0YSwgaiwgc2ltcGxlR2x5cGgubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgZ2x5Zi5kYXRhID0gc2ltcGxlR2x5cGg7CiAgICAgIH0gZWxzZSBpZiAoZHVwRmlyc3RFbnRyeSkgewogICAgICAgIGNvbnN0IGZpcnN0RW50cnlMZW5ndGggPSBpdGVtRGVjb2RlKGxvY2FEYXRhLCBpdGVtU2l6ZSk7CiAgICAgICAgaWYgKG5ld0dseWZEYXRhLmxlbmd0aCA+IGZpcnN0RW50cnlMZW5ndGggKyB3cml0ZU9mZnNldCkgewogICAgICAgICAgZ2x5Zi5kYXRhID0gbmV3R2x5ZkRhdGEuc3ViYXJyYXkoMCwgZmlyc3RFbnRyeUxlbmd0aCArIHdyaXRlT2Zmc2V0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZ2x5Zi5kYXRhID0gbmV3IFVpbnQ4QXJyYXkoZmlyc3RFbnRyeUxlbmd0aCArIHdyaXRlT2Zmc2V0KTsKICAgICAgICAgIGdseWYuZGF0YS5zZXQobmV3R2x5ZkRhdGEuc3ViYXJyYXkoMCwgd3JpdGVPZmZzZXQpKTsKICAgICAgICB9CiAgICAgICAgZ2x5Zi5kYXRhLnNldChuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCBmaXJzdEVudHJ5TGVuZ3RoKSwgd3JpdGVPZmZzZXQpOwogICAgICAgIGl0ZW1FbmNvZGUobG9jYS5kYXRhLCBsb2NhRGF0YS5sZW5ndGggLSBpdGVtU2l6ZSwgd3JpdGVPZmZzZXQgKyBmaXJzdEVudHJ5TGVuZ3RoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBnbHlmLmRhdGEgPSBuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCB3cml0ZU9mZnNldCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBtaXNzaW5nR2x5cGhzLAogICAgICAgIG1heFNpemVPZkluc3RydWN0aW9ucwogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gcmVhZFBvc3RTY3JpcHRUYWJsZShwb3N0LCBwcm9wZXJ0aWVzT2JqLCBtYXhwTnVtR2x5cGhzKSB7CiAgICAgIGNvbnN0IHN0YXJ0ID0gKGZvbnQuc3RhcnQgfHwgMCkgKyBwb3N0Lm9mZnNldDsKICAgICAgZm9udC5wb3MgPSBzdGFydDsKICAgICAgY29uc3QgbGVuZ3RoID0gcG9zdC5sZW5ndGgsCiAgICAgICAgZW5kID0gc3RhcnQgKyBsZW5ndGg7CiAgICAgIGNvbnN0IHZlcnNpb24gPSBmb250LmdldEludDMyKCk7CiAgICAgIGZvbnQuc2tpcCgyOCk7CiAgICAgIGxldCBnbHlwaE5hbWVzOwogICAgICBsZXQgdmFsaWQgPSB0cnVlOwogICAgICBsZXQgaTsKICAgICAgc3dpdGNoICh2ZXJzaW9uKSB7CiAgICAgICAgY2FzZSAweDAwMDEwMDAwOgogICAgICAgICAgZ2x5cGhOYW1lcyA9IE1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgwMDAyMDAwMDoKICAgICAgICAgIGNvbnN0IG51bUdseXBocyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICBpZiAobnVtR2x5cGhzICE9PSBtYXhwTnVtR2x5cGhzKSB7CiAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZ2x5cGhOYW1lSW5kZXhlcyA9IFtdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bUdseXBoczsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgICAgICAgaWYgKGluZGV4ID49IDMyNzY4KSB7CiAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBnbHlwaE5hbWVJbmRleGVzLnB1c2goaW5kZXgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGN1c3RvbU5hbWVzID0gW10sCiAgICAgICAgICAgIHN0ckJ1ZiA9IFtdOwogICAgICAgICAgd2hpbGUgKGZvbnQucG9zIDwgZW5kKSB7CiAgICAgICAgICAgIGNvbnN0IHN0cmluZ0xlbmd0aCA9IGZvbnQuZ2V0Qnl0ZSgpOwogICAgICAgICAgICBzdHJCdWYubGVuZ3RoID0gc3RyaW5nTGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3RyaW5nTGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBzdHJCdWZbaV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnQuZ2V0Qnl0ZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdXN0b21OYW1lcy5wdXNoKHN0ckJ1Zi5qb2luKCIiKSk7CiAgICAgICAgICB9CiAgICAgICAgICBnbHlwaE5hbWVzID0gW107CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgaiA9IGdseXBoTmFtZUluZGV4ZXNbaV07CiAgICAgICAgICAgIGlmIChqIDwgMjU4KSB7CiAgICAgICAgICAgICAgZ2x5cGhOYW1lcy5wdXNoKE1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZ1tqXSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2x5cGhOYW1lcy5wdXNoKGN1c3RvbU5hbWVzW2ogLSAyNThdKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgwMDAzMDAwMDoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB3YXJuKCJVbmtub3duL3Vuc3VwcG9ydGVkIHBvc3QgdGFibGUgdmVyc2lvbiAiICsgdmVyc2lvbik7CiAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgaWYgKHByb3BlcnRpZXNPYmouZGVmYXVsdEVuY29kaW5nKSB7CiAgICAgICAgICAgIGdseXBoTmFtZXMgPSBwcm9wZXJ0aWVzT2JqLmRlZmF1bHRFbmNvZGluZzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHByb3BlcnRpZXNPYmouZ2x5cGhOYW1lcyA9IGdseXBoTmFtZXM7CiAgICAgIHJldHVybiB2YWxpZDsKICAgIH0KICAgIGZ1bmN0aW9uIHJlYWROYW1lVGFibGUobmFtZVRhYmxlKSB7CiAgICAgIGNvbnN0IHN0YXJ0ID0gKGZvbnQuc3RhcnQgfHwgMCkgKyBuYW1lVGFibGUub2Zmc2V0OwogICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICBjb25zdCBuYW1lcyA9IFtbXSwgW11dLAogICAgICAgIHJlY29yZHMgPSBbXTsKICAgICAgY29uc3QgbGVuZ3RoID0gbmFtZVRhYmxlLmxlbmd0aCwKICAgICAgICBlbmQgPSBzdGFydCArIGxlbmd0aDsKICAgICAgY29uc3QgZm9ybWF0ID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgY29uc3QgRk9STUFUXzBfSEVBREVSX0xFTkdUSCA9IDY7CiAgICAgIGlmIChmb3JtYXQgIT09IDAgfHwgbGVuZ3RoIDwgRk9STUFUXzBfSEVBREVSX0xFTkdUSCkgewogICAgICAgIHJldHVybiBbbmFtZXMsIHJlY29yZHNdOwogICAgICB9CiAgICAgIGNvbnN0IG51bVJlY29yZHMgPSBmb250LmdldFVpbnQxNigpOwogICAgICBjb25zdCBzdHJpbmdzU3RhcnQgPSBmb250LmdldFVpbnQxNigpOwogICAgICBjb25zdCBOQU1FX1JFQ09SRF9MRU5HVEggPSAxMjsKICAgICAgbGV0IGksIGlpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtUmVjb3JkcyAmJiBmb250LnBvcyArIE5BTUVfUkVDT1JEX0xFTkdUSCA8PSBlbmQ7IGkrKykgewogICAgICAgIGNvbnN0IHIgPSB7CiAgICAgICAgICBwbGF0Zm9ybTogZm9udC5nZXRVaW50MTYoKSwKICAgICAgICAgIGVuY29kaW5nOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgbGFuZ3VhZ2U6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBuYW1lOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgbGVuZ3RoOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgb2Zmc2V0OiBmb250LmdldFVpbnQxNigpCiAgICAgICAgfTsKICAgICAgICBpZiAoaXNNYWNOYW1lUmVjb3JkKHIpIHx8IGlzV2luTmFtZVJlY29yZChyKSkgewogICAgICAgICAgcmVjb3Jkcy5wdXNoKHIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGkgPSAwLCBpaSA9IHJlY29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IHJlY29yZCA9IHJlY29yZHNbaV07CiAgICAgICAgaWYgKHJlY29yZC5sZW5ndGggPD0gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBvcyA9IHN0YXJ0ICsgc3RyaW5nc1N0YXJ0ICsgcmVjb3JkLm9mZnNldDsKICAgICAgICBpZiAocG9zICsgcmVjb3JkLmxlbmd0aCA+IGVuZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvbnQucG9zID0gcG9zOwogICAgICAgIGNvbnN0IG5hbWVJbmRleCA9IHJlY29yZC5uYW1lOwogICAgICAgIGlmIChyZWNvcmQuZW5jb2RpbmcpIHsKICAgICAgICAgIGxldCBzdHIgPSAiIjsKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJlY29yZC5sZW5ndGg7IGogPCBqajsgaiArPSAyKSB7CiAgICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnQuZ2V0VWludDE2KCkpOwogICAgICAgICAgfQogICAgICAgICAgbmFtZXNbMV1bbmFtZUluZGV4XSA9IHN0cjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmFtZXNbMF1bbmFtZUluZGV4XSA9IGZvbnQuZ2V0U3RyaW5nKHJlY29yZC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gW25hbWVzLCByZWNvcmRzXTsKICAgIH0KICAgIGNvbnN0IFRUT3BzU3RhY2tEZWx0YXMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgLTIsIC0yLCAtMiwgLTIsIDAsIDAsIC0yLCAtNSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAwLCAwLCAtMSwgMCwgLTEsIC0xLCAtMSwgLTEsIDEsIC0xLCAtOTk5LCAwLCAxLCAwLCAtMSwgLTIsIDAsIC0xLCAtMiwgLTEsIC0xLCAwLCAtMSwgLTEsIDAsIDAsIC05OTksIC05OTksIC0xLCAtMSwgLTEsIC0xLCAtMiwgLTk5OSwgLTIsIC0yLCAtOTk5LCAwLCAtMiwgLTIsIDAsIDAsIC0yLCAwLCAtMiwgMCwgMCwgMCwgLTIsIC0xLCAtMSwgMSwgMSwgMCwgMCwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIC0xLCAwLCAtMSwgLTEsIDAsIC05OTksIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIC0yLCAtOTk5LCAtOTk5LCAtOTk5LCAtOTk5LCAtOTk5LCAtMSwgLTEsIC0yLCAtMiwgMCwgMCwgMCwgMCwgLTEsIC0xLCAtOTk5LCAtMiwgLTIsIDAsIDAsIC0xLCAtMiwgLTIsIDAsIDAsIDAsIC0xLCAtMSwgLTEsIC0yXTsKICAgIGZ1bmN0aW9uIHNhbml0aXplVFRQcm9ncmFtKHRhYmxlLCB0dENvbnRleHQpIHsKICAgICAgbGV0IGRhdGEgPSB0YWJsZS5kYXRhOwogICAgICBsZXQgaSA9IDAsCiAgICAgICAgaiwKICAgICAgICBuLAogICAgICAgIGIsCiAgICAgICAgZnVuY0lkLAogICAgICAgIHBjLAogICAgICAgIGxhc3RFbmRmID0gMCwKICAgICAgICBsYXN0RGVmZiA9IDA7CiAgICAgIGNvbnN0IHN0YWNrID0gW107CiAgICAgIGNvbnN0IGNhbGxzdGFjayA9IFtdOwogICAgICBjb25zdCBmdW5jdGlvbnNDYWxsZWQgPSBbXTsKICAgICAgbGV0IHRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucyA9IHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnM7CiAgICAgIGxldCBpbkZERUYgPSBmYWxzZSwKICAgICAgICBpZkxldmVsID0gMCwKICAgICAgICBpbkVMU0UgPSAwOwogICAgICBmb3IgKGxldCBpaSA9IGRhdGEubGVuZ3RoOyBpIDwgaWk7KSB7CiAgICAgICAgY29uc3Qgb3AgPSBkYXRhW2krK107CiAgICAgICAgaWYgKG9wID09PSAweDQwKSB7CiAgICAgICAgICBuID0gZGF0YVtpKytdOwogICAgICAgICAgaWYgKGluRkRFRiB8fCBpbkVMU0UpIHsKICAgICAgICAgICAgaSArPSBuOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgIHN0YWNrLnB1c2goZGF0YVtpKytdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4NDEpIHsKICAgICAgICAgIG4gPSBkYXRhW2krK107CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG4gKiAyOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgIGIgPSBkYXRhW2krK107CiAgICAgICAgICAgICAgc3RhY2sucHVzaChiIDw8IDggfCBkYXRhW2krK10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgob3AgJiAweGY4KSA9PT0gMHhiMCkgewogICAgICAgICAgbiA9IG9wIC0gMHhiMCArIDE7CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG47CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgc3RhY2sucHVzaChkYXRhW2krK10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgob3AgJiAweGY4KSA9PT0gMHhiOCkgewogICAgICAgICAgbiA9IG9wIC0gMHhiOCArIDE7CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG4gKiAyOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgIGIgPSBkYXRhW2krK107CiAgICAgICAgICAgICAgc3RhY2sucHVzaChzaWduZWRJbnQxNihiLCBkYXRhW2krK10pKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4MmIgJiYgIXRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucykgewogICAgICAgICAgaWYgKCFpbkZERUYgJiYgIWluRUxTRSkgewogICAgICAgICAgICBmdW5jSWQgPSBzdGFjay5hdCgtMSk7CiAgICAgICAgICAgIGlmIChpc05hTihmdW5jSWQpKSB7CiAgICAgICAgICAgICAgaW5mbygiVFQ6IENBTEwgZW1wdHkgc3RhY2sgKG9yIGludmFsaWQgZW50cnkpLiIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHR0Q29udGV4dC5mdW5jdGlvbnNVc2VkW2Z1bmNJZF0gPSB0cnVlOwogICAgICAgICAgICAgIGlmIChmdW5jSWQgaW4gdHRDb250ZXh0LmZ1bmN0aW9uc1N0YWNrRGVsdGFzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdTdGFja0xlbmd0aCA9IHN0YWNrLmxlbmd0aCArIHR0Q29udGV4dC5mdW5jdGlvbnNTdGFja0RlbHRhc1tmdW5jSWRdOwogICAgICAgICAgICAgICAgaWYgKG5ld1N0YWNrTGVuZ3RoIDwgMCkgewogICAgICAgICAgICAgICAgICB3YXJuKCJUVDogQ0FMTCBpbnZhbGlkIGZ1bmN0aW9ucyBzdGFjayBkZWx0YS4iKTsKICAgICAgICAgICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhY2subGVuZ3RoID0gbmV3U3RhY2tMZW5ndGg7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChmdW5jSWQgaW4gdHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWQgJiYgIWZ1bmN0aW9uc0NhbGxlZC5pbmNsdWRlcyhmdW5jSWQpKSB7CiAgICAgICAgICAgICAgICBjYWxsc3RhY2sucHVzaCh7CiAgICAgICAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgIHN0YWNrVG9wOiBzdGFjay5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uc0NhbGxlZC5wdXNoKGZ1bmNJZCk7CiAgICAgICAgICAgICAgICBwYyA9IHR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2Z1bmNJZF07CiAgICAgICAgICAgICAgICBpZiAoIXBjKSB7CiAgICAgICAgICAgICAgICAgIHdhcm4oIlRUOiBDQUxMIG5vbi1leGlzdGVudCBmdW5jdGlvbiIpOwogICAgICAgICAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkYXRhID0gcGMuZGF0YTsKICAgICAgICAgICAgICAgIGkgPSBwYy5pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4MmMgJiYgIXRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucykgewogICAgICAgICAgaWYgKGluRkRFRiB8fCBpbkVMU0UpIHsKICAgICAgICAgICAgd2FybigiVFQ6IG5lc3RlZCBGREVGcyBub3QgYWxsb3dlZCIpOwogICAgICAgICAgICB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaW5GREVGID0gdHJ1ZTsKICAgICAgICAgIGxhc3REZWZmID0gaTsKICAgICAgICAgIGZ1bmNJZCA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgdHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWRbZnVuY0lkXSA9IHsKICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgaQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDJkKSB7CiAgICAgICAgICBpZiAoaW5GREVGKSB7CiAgICAgICAgICAgIGluRkRFRiA9IGZhbHNlOwogICAgICAgICAgICBsYXN0RW5kZiA9IGk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwYyA9IGNhbGxzdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKCFwYykgewogICAgICAgICAgICAgIHdhcm4oIlRUOiBFTkRGIGJhZCBzdGFjayIpOwogICAgICAgICAgICAgIHR0Q29udGV4dC5oaW50c1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmNJZCA9IGZ1bmN0aW9uc0NhbGxlZC5wb3AoKTsKICAgICAgICAgICAgZGF0YSA9IHBjLmRhdGE7CiAgICAgICAgICAgIGkgPSBwYy5pOwogICAgICAgICAgICB0dENvbnRleHQuZnVuY3Rpb25zU3RhY2tEZWx0YXNbZnVuY0lkXSA9IHN0YWNrLmxlbmd0aCAtIHBjLnN0YWNrVG9wOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4ODkpIHsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgIHdhcm4oIlRUOiBuZXN0ZWQgSURFRnMgbm90IGFsbG93ZWQiKTsKICAgICAgICAgICAgdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGluRkRFRiA9IHRydWU7CiAgICAgICAgICBsYXN0RGVmZiA9IGk7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg1OCkgewogICAgICAgICAgKytpZkxldmVsOwogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4MWIpIHsKICAgICAgICAgIGluRUxTRSA9IGlmTGV2ZWw7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg1OSkgewogICAgICAgICAgaWYgKGluRUxTRSA9PT0gaWZMZXZlbCkgewogICAgICAgICAgICBpbkVMU0UgPSAwOwogICAgICAgICAgfQogICAgICAgICAgLS1pZkxldmVsOwogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4MWMpIHsKICAgICAgICAgIGlmICghaW5GREVGICYmICFpbkVMU0UpIHsKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc3RhY2suYXQoLTEpOwogICAgICAgICAgICBpZiAob2Zmc2V0ID4gMCkgewogICAgICAgICAgICAgIGkgKz0gb2Zmc2V0IC0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWluRkRFRiAmJiAhaW5FTFNFKSB7CiAgICAgICAgICBsZXQgc3RhY2tEZWx0YSA9IDA7CiAgICAgICAgICBpZiAob3AgPD0gMHg4ZSkgewogICAgICAgICAgICBzdGFja0RlbHRhID0gVFRPcHNTdGFja0RlbHRhc1tvcF07CiAgICAgICAgICB9IGVsc2UgaWYgKG9wID49IDB4YzAgJiYgb3AgPD0gMHhkZikgewogICAgICAgICAgICBzdGFja0RlbHRhID0gLTE7CiAgICAgICAgICB9IGVsc2UgaWYgKG9wID49IDB4ZTApIHsKICAgICAgICAgICAgc3RhY2tEZWx0YSA9IC0yOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9wID49IDB4NzEgJiYgb3AgPD0gMHg3NSkgewogICAgICAgICAgICBuID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGlmICghaXNOYU4obikpIHsKICAgICAgICAgICAgICBzdGFja0RlbHRhID0gLW4gKiAyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoc3RhY2tEZWx0YSA8IDAgJiYgc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgc3RhY2tEZWx0YSsrOwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKHN0YWNrRGVsdGEgPiAwKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goTmFOKTsKICAgICAgICAgICAgc3RhY2tEZWx0YS0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0dENvbnRleHQudG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zID0gdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zOwogICAgICBjb25zdCBjb250ZW50ID0gW2RhdGFdOwogICAgICBpZiAoaSA+IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgY29udGVudC5wdXNoKG5ldyBVaW50OEFycmF5KGkgLSBkYXRhLmxlbmd0aCkpOwogICAgICB9CiAgICAgIGlmIChsYXN0RGVmZiA+IGxhc3RFbmRmKSB7CiAgICAgICAgd2FybigiVFQ6IGNvbXBsZW1lbnRpbmcgYSBtaXNzaW5nIGZ1bmN0aW9uIHRhaWwiKTsKICAgICAgICBjb250ZW50LnB1c2gobmV3IFVpbnQ4QXJyYXkoWzB4MjIsIDB4MmRdKSk7CiAgICAgIH0KICAgICAgZm9sZFRUVGFibGUodGFibGUsIGNvbnRlbnQpOwogICAgfQogICAgZnVuY3Rpb24gY2hlY2tJbnZhbGlkRnVuY3Rpb25zKHR0Q29udGV4dCwgbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgIGlmICh0dENvbnRleHQudG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0dENvbnRleHQuZnVuY3Rpb25zRGVmaW5lZC5sZW5ndGggPiBtYXhGdW5jdGlvbkRlZnMpIHsKICAgICAgICB3YXJuKCJUVDogbW9yZSBmdW5jdGlvbnMgZGVmaW5lZCB0aGFuIGV4cGVjdGVkIik7CiAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gdHRDb250ZXh0LmZ1bmN0aW9uc1VzZWQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgIGlmIChqID4gbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgICAgICB3YXJuKCJUVDogaW52YWxpZCBmdW5jdGlvbiBpZDogIiArIGopOwogICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHR0Q29udGV4dC5mdW5jdGlvbnNVc2VkW2pdICYmICF0dENvbnRleHQuZnVuY3Rpb25zRGVmaW5lZFtqXSkgewogICAgICAgICAgd2FybigiVFQ6IHVuZGVmaW5lZCBmdW5jdGlvbjogIiArIGopOwogICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGZvbGRUVFRhYmxlKHRhYmxlLCBjb250ZW50KSB7CiAgICAgIGlmIChjb250ZW50Lmxlbmd0aCA+IDEpIHsKICAgICAgICBsZXQgbmV3TGVuZ3RoID0gMDsKICAgICAgICBsZXQgaiwgamo7CiAgICAgICAgZm9yIChqID0gMCwgamogPSBjb250ZW50Lmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgIG5ld0xlbmd0aCArPSBjb250ZW50W2pdLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgbmV3TGVuZ3RoID0gbmV3TGVuZ3RoICsgMyAmIH4zOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KG5ld0xlbmd0aCk7CiAgICAgICAgbGV0IHBvcyA9IDA7CiAgICAgICAgZm9yIChqID0gMCwgamogPSBjb250ZW50Lmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgIHJlc3VsdC5zZXQoY29udGVudFtqXSwgcG9zKTsKICAgICAgICAgIHBvcyArPSBjb250ZW50W2pdLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgdGFibGUuZGF0YSA9IHJlc3VsdDsKICAgICAgICB0YWJsZS5sZW5ndGggPSBuZXdMZW5ndGg7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNhbml0aXplVFRQcm9ncmFtcyhmcGdtLCBwcmVwLCBjdnQsIG1heEZ1bmN0aW9uRGVmcykgewogICAgICBjb25zdCB0dENvbnRleHQgPSB7CiAgICAgICAgZnVuY3Rpb25zRGVmaW5lZDogW10sCiAgICAgICAgZnVuY3Rpb25zVXNlZDogW10sCiAgICAgICAgZnVuY3Rpb25zU3RhY2tEZWx0YXM6IFtdLAogICAgICAgIHRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9uczogZmFsc2UsCiAgICAgICAgaGludHNWYWxpZDogdHJ1ZQogICAgICB9OwogICAgICBpZiAoZnBnbSkgewogICAgICAgIHNhbml0aXplVFRQcm9ncmFtKGZwZ20sIHR0Q29udGV4dCk7CiAgICAgIH0KICAgICAgaWYgKHByZXApIHsKICAgICAgICBzYW5pdGl6ZVRUUHJvZ3JhbShwcmVwLCB0dENvbnRleHQpOwogICAgICB9CiAgICAgIGlmIChmcGdtKSB7CiAgICAgICAgY2hlY2tJbnZhbGlkRnVuY3Rpb25zKHR0Q29udGV4dCwgbWF4RnVuY3Rpb25EZWZzKTsKICAgICAgfQogICAgICBpZiAoY3Z0ICYmIGN2dC5sZW5ndGggJiAxKSB7CiAgICAgICAgY29uc3QgY3Z0RGF0YSA9IG5ldyBVaW50OEFycmF5KGN2dC5sZW5ndGggKyAxKTsKICAgICAgICBjdnREYXRhLnNldChjdnQuZGF0YSk7CiAgICAgICAgY3Z0LmRhdGEgPSBjdnREYXRhOwogICAgICB9CiAgICAgIHJldHVybiB0dENvbnRleHQuaGludHNWYWxpZDsKICAgIH0KICAgIGZvbnQgPSBuZXcgU3RyZWFtKG5ldyBVaW50OEFycmF5KGZvbnQuZ2V0Qnl0ZXMoKSkpOwogICAgbGV0IGhlYWRlciwgdGFibGVzOwogICAgaWYgKGlzVHJ1ZVR5cGVDb2xsZWN0aW9uRmlsZShmb250KSkgewogICAgICBjb25zdCB0dGNEYXRhID0gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkRhdGEoZm9udCwgdGhpcy5uYW1lKTsKICAgICAgaGVhZGVyID0gdHRjRGF0YS5oZWFkZXI7CiAgICAgIHRhYmxlcyA9IHR0Y0RhdGEudGFibGVzOwogICAgfSBlbHNlIHsKICAgICAgaGVhZGVyID0gcmVhZE9wZW5UeXBlSGVhZGVyKGZvbnQpOwogICAgICB0YWJsZXMgPSByZWFkVGFibGVzKGZvbnQsIGhlYWRlci5udW1UYWJsZXMpOwogICAgfQogICAgbGV0IGNmZiwgY2ZmRmlsZTsKICAgIGNvbnN0IGlzVHJ1ZVR5cGUgPSAhdGFibGVzWyJDRkYgIl07CiAgICBpZiAoIWlzVHJ1ZVR5cGUpIHsKICAgICAgY29uc3QgaXNDb21wb3NpdGUgPSBwcm9wZXJ0aWVzLmNvbXBvc2l0ZSAmJiAocHJvcGVydGllcy5jaWRUb0dpZE1hcD8ubGVuZ3RoID4gMCB8fCAhKHByb3BlcnRpZXMuY01hcCBpbnN0YW5jZW9mIElkZW50aXR5Q01hcCkpOwogICAgICBpZiAoaGVhZGVyLnZlcnNpb24gPT09ICJPVFRPIiAmJiAhaXNDb21wb3NpdGUgfHwgIXRhYmxlcy5oZWFkIHx8ICF0YWJsZXMuaGhlYSB8fCAhdGFibGVzLm1heHAgfHwgIXRhYmxlcy5wb3N0KSB7CiAgICAgICAgY2ZmRmlsZSA9IG5ldyBTdHJlYW0odGFibGVzWyJDRkYgIl0uZGF0YSk7CiAgICAgICAgY2ZmID0gbmV3IENGRkZvbnQoY2ZmRmlsZSwgcHJvcGVydGllcyk7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydChuYW1lLCBjZmYsIHByb3BlcnRpZXMpOwogICAgICB9CiAgICAgIGRlbGV0ZSB0YWJsZXMuZ2x5ZjsKICAgICAgZGVsZXRlIHRhYmxlcy5sb2NhOwogICAgICBkZWxldGUgdGFibGVzLmZwZ207CiAgICAgIGRlbGV0ZSB0YWJsZXMucHJlcDsKICAgICAgZGVsZXRlIHRhYmxlc1siY3Z0ICJdOwogICAgICB0aGlzLmlzT3BlblR5cGUgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCF0YWJsZXMubG9jYSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignUmVxdWlyZWQgImxvY2EiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgICB9CiAgICAgIGlmICghdGFibGVzLmdseWYpIHsKICAgICAgICB3YXJuKCdSZXF1aXJlZCAiZ2x5ZiIgdGFibGUgaXMgbm90IGZvdW5kIC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgIHRhYmxlcy5nbHlmID0gewogICAgICAgICAgdGFnOiAiZ2x5ZiIsCiAgICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheSgwKQogICAgICAgIH07CiAgICAgIH0KICAgICAgdGhpcy5pc09wZW5UeXBlID0gZmFsc2U7CiAgICB9CiAgICBpZiAoIXRhYmxlcy5tYXhwKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignUmVxdWlyZWQgIm1heHAiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgfQogICAgZm9udC5wb3MgPSAoZm9udC5zdGFydCB8fCAwKSArIHRhYmxlcy5tYXhwLm9mZnNldDsKICAgIGxldCB2ZXJzaW9uID0gZm9udC5nZXRJbnQzMigpOwogICAgY29uc3QgbnVtR2x5cGhzID0gZm9udC5nZXRVaW50MTYoKTsKICAgIGlmICh2ZXJzaW9uICE9PSAweDAwMDEwMDAwICYmIHZlcnNpb24gIT09IDB4MDAwMDUwMDApIHsKICAgICAgaWYgKHRhYmxlcy5tYXhwLmxlbmd0aCA9PT0gNikgewogICAgICAgIHZlcnNpb24gPSAweDAwMDUwMDA7CiAgICAgIH0gZWxzZSBpZiAodGFibGVzLm1heHAubGVuZ3RoID49IDMyKSB7CiAgICAgICAgdmVyc2lvbiA9IDB4MDAwMTAwMDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGAibWF4cCIgdGFibGUgaGFzIGEgd3JvbmcgdmVyc2lvbiBudW1iZXJgKTsKICAgICAgfQogICAgICB3cml0ZVVpbnQzMih0YWJsZXMubWF4cC5kYXRhLCAwLCB2ZXJzaW9uKTsKICAgIH0KICAgIGlmIChwcm9wZXJ0aWVzLnNjYWxlRmFjdG9ycz8ubGVuZ3RoID09PSBudW1HbHlwaHMgJiYgaXNUcnVlVHlwZSkgewogICAgICBjb25zdCB7CiAgICAgICAgc2NhbGVGYWN0b3JzCiAgICAgIH0gPSBwcm9wZXJ0aWVzOwogICAgICBjb25zdCBpc0dseXBoTG9jYXRpb25zTG9uZyA9IGludDE2KHRhYmxlcy5oZWFkLmRhdGFbNTBdLCB0YWJsZXMuaGVhZC5kYXRhWzUxXSk7CiAgICAgIGNvbnN0IGdseXBocyA9IG5ldyBHbHlmVGFibGUoewogICAgICAgIGdseWZUYWJsZTogdGFibGVzLmdseWYuZGF0YSwKICAgICAgICBpc0dseXBoTG9jYXRpb25zTG9uZywKICAgICAgICBsb2NhVGFibGU6IHRhYmxlcy5sb2NhLmRhdGEsCiAgICAgICAgbnVtR2x5cGhzCiAgICAgIH0pOwogICAgICBnbHlwaHMuc2NhbGUoc2NhbGVGYWN0b3JzKTsKICAgICAgY29uc3QgewogICAgICAgIGdseWYsCiAgICAgICAgbG9jYSwKICAgICAgICBpc0xvY2F0aW9uTG9uZwogICAgICB9ID0gZ2x5cGhzLndyaXRlKCk7CiAgICAgIHRhYmxlcy5nbHlmLmRhdGEgPSBnbHlmOwogICAgICB0YWJsZXMubG9jYS5kYXRhID0gbG9jYTsKICAgICAgaWYgKGlzTG9jYXRpb25Mb25nICE9PSAhIWlzR2x5cGhMb2NhdGlvbnNMb25nKSB7CiAgICAgICAgdGFibGVzLmhlYWQuZGF0YVs1MF0gPSAwOwogICAgICAgIHRhYmxlcy5oZWFkLmRhdGFbNTFdID0gaXNMb2NhdGlvbkxvbmcgPyAxIDogMDsKICAgICAgfQogICAgICBjb25zdCBtZXRyaWNzID0gdGFibGVzLmhtdHguZGF0YTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1HbHlwaHM7IGkrKykgewogICAgICAgIGNvbnN0IGogPSA0ICogaTsKICAgICAgICBjb25zdCBhZHZhbmNlV2lkdGggPSBNYXRoLnJvdW5kKHNjYWxlRmFjdG9yc1tpXSAqIGludDE2KG1ldHJpY3Nbal0sIG1ldHJpY3NbaiArIDFdKSk7CiAgICAgICAgbWV0cmljc1tqXSA9IGFkdmFuY2VXaWR0aCA+PiA4ICYgMHhmZjsKICAgICAgICBtZXRyaWNzW2ogKyAxXSA9IGFkdmFuY2VXaWR0aCAmIDB4ZmY7CiAgICAgICAgY29uc3QgbHNiID0gTWF0aC5yb3VuZChzY2FsZUZhY3RvcnNbaV0gKiBzaWduZWRJbnQxNihtZXRyaWNzW2ogKyAyXSwgbWV0cmljc1tqICsgM10pKTsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KG1ldHJpY3MsIGogKyAyLCBsc2IpOwogICAgICB9CiAgICB9CiAgICBsZXQgbnVtR2x5cGhzT3V0ID0gbnVtR2x5cGhzICsgMTsKICAgIGxldCBkdXBGaXJzdEVudHJ5ID0gdHJ1ZTsKICAgIGlmIChudW1HbHlwaHNPdXQgPiAweGZmZmYpIHsKICAgICAgZHVwRmlyc3RFbnRyeSA9IGZhbHNlOwogICAgICBudW1HbHlwaHNPdXQgPSBudW1HbHlwaHM7CiAgICAgIHdhcm4oIk5vdCBlbm91Z2ggc3BhY2UgaW4gZ2x5ZnMgdG8gZHVwbGljYXRlIGZpcnN0IGdseXBoLiIpOwogICAgfQogICAgbGV0IG1heEZ1bmN0aW9uRGVmcyA9IDA7CiAgICBsZXQgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID0gMDsKICAgIGlmICh2ZXJzaW9uID49IDB4MDAwMTAwMDAgJiYgdGFibGVzLm1heHAubGVuZ3RoID49IDMyKSB7CiAgICAgIGZvbnQucG9zICs9IDg7CiAgICAgIGNvbnN0IG1heFpvbmVzID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgaWYgKG1heFpvbmVzID4gMikgewogICAgICAgIHRhYmxlcy5tYXhwLmRhdGFbMTRdID0gMDsKICAgICAgICB0YWJsZXMubWF4cC5kYXRhWzE1XSA9IDI7CiAgICAgIH0KICAgICAgZm9udC5wb3MgKz0gNDsKICAgICAgbWF4RnVuY3Rpb25EZWZzID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgZm9udC5wb3MgKz0gNDsKICAgICAgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID0gZm9udC5nZXRVaW50MTYoKTsKICAgIH0KICAgIHRhYmxlcy5tYXhwLmRhdGFbNF0gPSBudW1HbHlwaHNPdXQgPj4gODsKICAgIHRhYmxlcy5tYXhwLmRhdGFbNV0gPSBudW1HbHlwaHNPdXQgJiAyNTU7CiAgICBjb25zdCBoaW50c1ZhbGlkID0gc2FuaXRpemVUVFByb2dyYW1zKHRhYmxlcy5mcGdtLCB0YWJsZXMucHJlcCwgdGFibGVzWyJjdnQgIl0sIG1heEZ1bmN0aW9uRGVmcyk7CiAgICBpZiAoIWhpbnRzVmFsaWQpIHsKICAgICAgZGVsZXRlIHRhYmxlcy5mcGdtOwogICAgICBkZWxldGUgdGFibGVzLnByZXA7CiAgICAgIGRlbGV0ZSB0YWJsZXNbImN2dCAiXTsKICAgIH0KICAgIHNhbml0aXplTWV0cmljcyhmb250LCB0YWJsZXMuaGhlYSwgdGFibGVzLmhtdHgsIHRhYmxlcy5oZWFkLCBudW1HbHlwaHNPdXQsIGR1cEZpcnN0RW50cnkpOwogICAgaWYgKCF0YWJsZXMuaGVhZCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoJ1JlcXVpcmVkICJoZWFkIiB0YWJsZSBpcyBub3QgZm91bmQnKTsKICAgIH0KICAgIHNhbml0aXplSGVhZCh0YWJsZXMuaGVhZCwgbnVtR2x5cGhzLCBpc1RydWVUeXBlID8gdGFibGVzLmxvY2EubGVuZ3RoIDogMCk7CiAgICBsZXQgbWlzc2luZ0dseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAoaXNUcnVlVHlwZSkgewogICAgICBjb25zdCBpc0dseXBoTG9jYXRpb25zTG9uZyA9IGludDE2KHRhYmxlcy5oZWFkLmRhdGFbNTBdLCB0YWJsZXMuaGVhZC5kYXRhWzUxXSk7CiAgICAgIGNvbnN0IGdseXBoc0luZm8gPSBzYW5pdGl6ZUdseXBoTG9jYXRpb25zKHRhYmxlcy5sb2NhLCB0YWJsZXMuZ2x5ZiwgbnVtR2x5cGhzLCBpc0dseXBoTG9jYXRpb25zTG9uZywgaGludHNWYWxpZCwgZHVwRmlyc3RFbnRyeSwgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zKTsKICAgICAgbWlzc2luZ0dseXBocyA9IGdseXBoc0luZm8ubWlzc2luZ0dseXBoczsKICAgICAgaWYgKHZlcnNpb24gPj0gMHgwMDAxMDAwMCAmJiB0YWJsZXMubWF4cC5sZW5ndGggPj0gMzIpIHsKICAgICAgICB0YWJsZXMubWF4cC5kYXRhWzI2XSA9IGdseXBoc0luZm8ubWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID4+IDg7CiAgICAgICAgdGFibGVzLm1heHAuZGF0YVsyN10gPSBnbHlwaHNJbmZvLm1heFNpemVPZkluc3RydWN0aW9ucyAmIDI1NTsKICAgICAgfQogICAgfQogICAgaWYgKCF0YWJsZXMuaGhlYSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoJ1JlcXVpcmVkICJoaGVhIiB0YWJsZSBpcyBub3QgZm91bmQnKTsKICAgIH0KICAgIGlmICh0YWJsZXMuaGhlYS5kYXRhWzEwXSA9PT0gMCAmJiB0YWJsZXMuaGhlYS5kYXRhWzExXSA9PT0gMCkgewogICAgICB0YWJsZXMuaGhlYS5kYXRhWzEwXSA9IDB4ZmY7CiAgICAgIHRhYmxlcy5oaGVhLmRhdGFbMTFdID0gMHhmZjsKICAgIH0KICAgIGNvbnN0IG1ldHJpY3NPdmVycmlkZSA9IHsKICAgICAgdW5pdHNQZXJFbTogaW50MTYodGFibGVzLmhlYWQuZGF0YVsxOF0sIHRhYmxlcy5oZWFkLmRhdGFbMTldKSwKICAgICAgeU1heDogc2lnbmVkSW50MTYodGFibGVzLmhlYWQuZGF0YVs0Ml0sIHRhYmxlcy5oZWFkLmRhdGFbNDNdKSwKICAgICAgeU1pbjogc2lnbmVkSW50MTYodGFibGVzLmhlYWQuZGF0YVszOF0sIHRhYmxlcy5oZWFkLmRhdGFbMzldKSwKICAgICAgYXNjZW50OiBzaWduZWRJbnQxNih0YWJsZXMuaGhlYS5kYXRhWzRdLCB0YWJsZXMuaGhlYS5kYXRhWzVdKSwKICAgICAgZGVzY2VudDogc2lnbmVkSW50MTYodGFibGVzLmhoZWEuZGF0YVs2XSwgdGFibGVzLmhoZWEuZGF0YVs3XSksCiAgICAgIGxpbmVHYXA6IHNpZ25lZEludDE2KHRhYmxlcy5oaGVhLmRhdGFbOF0sIHRhYmxlcy5oaGVhLmRhdGFbOV0pCiAgICB9OwogICAgdGhpcy5hc2NlbnQgPSBtZXRyaWNzT3ZlcnJpZGUuYXNjZW50IC8gbWV0cmljc092ZXJyaWRlLnVuaXRzUGVyRW07CiAgICB0aGlzLmRlc2NlbnQgPSBtZXRyaWNzT3ZlcnJpZGUuZGVzY2VudCAvIG1ldHJpY3NPdmVycmlkZS51bml0c1BlckVtOwogICAgdGhpcy5saW5lR2FwID0gbWV0cmljc092ZXJyaWRlLmxpbmVHYXAgLyBtZXRyaWNzT3ZlcnJpZGUudW5pdHNQZXJFbTsKICAgIGlmICh0aGlzLmNzc0ZvbnRJbmZvPy5saW5lSGVpZ2h0KSB7CiAgICAgIHRoaXMubGluZUhlaWdodCA9IHRoaXMuY3NzRm9udEluZm8ubWV0cmljcy5saW5lSGVpZ2h0OwogICAgICB0aGlzLmxpbmVHYXAgPSB0aGlzLmNzc0ZvbnRJbmZvLm1ldHJpY3MubGluZUdhcDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubGluZUhlaWdodCA9IHRoaXMuYXNjZW50IC0gdGhpcy5kZXNjZW50ICsgdGhpcy5saW5lR2FwOwogICAgfQogICAgaWYgKHRhYmxlcy5wb3N0KSB7CiAgICAgIHJlYWRQb3N0U2NyaXB0VGFibGUodGFibGVzLnBvc3QsIHByb3BlcnRpZXMsIG51bUdseXBocyk7CiAgICB9CiAgICB0YWJsZXMucG9zdCA9IHsKICAgICAgdGFnOiAicG9zdCIsCiAgICAgIGRhdGE6IGNyZWF0ZVBvc3RUYWJsZShwcm9wZXJ0aWVzKQogICAgfTsKICAgIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZ1bmN0aW9uIGhhc0dseXBoKGdseXBoSWQpIHsKICAgICAgcmV0dXJuICFtaXNzaW5nR2x5cGhzW2dseXBoSWRdOwogICAgfQogICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNpZFRvR2lkTWFwID0gcHJvcGVydGllcy5jaWRUb0dpZE1hcCB8fCBbXTsKICAgICAgY29uc3QgaXNDaWRUb0dpZE1hcEVtcHR5ID0gY2lkVG9HaWRNYXAubGVuZ3RoID09PSAwOwogICAgICBwcm9wZXJ0aWVzLmNNYXAuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUsIGNpZCkgewogICAgICAgIGlmICh0eXBlb2YgY2lkID09PSAic3RyaW5nIikgewogICAgICAgICAgY2lkID0gY29udmVydENpZFN0cmluZyhjaGFyQ29kZSwgY2lkLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNpZCA+IDB4ZmZmZikgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNYXggc2l6ZSBvZiBDSUQgaXMgNjUsNTM1Iik7CiAgICAgICAgfQogICAgICAgIGxldCBnbHlwaElkID0gLTE7CiAgICAgICAgaWYgKGlzQ2lkVG9HaWRNYXBFbXB0eSkgewogICAgICAgICAgZ2x5cGhJZCA9IGNpZDsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwW2NpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZ2x5cGhJZCA9IGNpZFRvR2lkTWFwW2NpZF07CiAgICAgICAgfQogICAgICAgIGlmIChnbHlwaElkID49IDAgJiYgZ2x5cGhJZCA8IG51bUdseXBocyAmJiBoYXNHbHlwaChnbHlwaElkKSkgewogICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgY21hcFRhYmxlID0gcmVhZENtYXBUYWJsZSh0YWJsZXMuY21hcCwgZm9udCwgdGhpcy5pc1N5bWJvbGljRm9udCwgcHJvcGVydGllcy5oYXNFbmNvZGluZyk7CiAgICAgIGNvbnN0IGNtYXBQbGF0Zm9ybUlkID0gY21hcFRhYmxlLnBsYXRmb3JtSWQ7CiAgICAgIGNvbnN0IGNtYXBFbmNvZGluZ0lkID0gY21hcFRhYmxlLmVuY29kaW5nSWQ7CiAgICAgIGNvbnN0IGNtYXBNYXBwaW5ncyA9IGNtYXBUYWJsZS5tYXBwaW5nczsKICAgICAgbGV0IGJhc2VFbmNvZGluZyA9IFtdLAogICAgICAgIGZvcmNlUG9zdFRhYmxlID0gZmFsc2U7CiAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc0VuY29kaW5nICYmIChwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgPT09ICJNYWNSb21hbkVuY29kaW5nIiB8fCBwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgPT09ICJXaW5BbnNpRW5jb2RpbmciKSkgewogICAgICAgIGJhc2VFbmNvZGluZyA9IGdldEVuY29kaW5nKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSk7CiAgICAgIH0KICAgICAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcgJiYgIXRoaXMuaXNTeW1ib2xpY0ZvbnQgJiYgKGNtYXBQbGF0Zm9ybUlkID09PSAzICYmIGNtYXBFbmNvZGluZ0lkID09PSAxIHx8IGNtYXBQbGF0Zm9ybUlkID09PSAxICYmIGNtYXBFbmNvZGluZ0lkID09PSAwKSkgewogICAgICAgIGNvbnN0IGdseXBoc1VuaWNvZGVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgICAgICAgZm9yIChsZXQgY2hhckNvZGUgPSAwOyBjaGFyQ29kZSA8IDI1NjsgY2hhckNvZGUrKykgewogICAgICAgICAgbGV0IGdseXBoTmFtZTsKICAgICAgICAgIGlmICh0aGlzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGdseXBoTmFtZSA9IHRoaXMuZGlmZmVyZW5jZXNbY2hhckNvZGVdOwogICAgICAgICAgfSBlbHNlIGlmIChiYXNlRW5jb2RpbmcubGVuZ3RoICYmIGJhc2VFbmNvZGluZ1tjaGFyQ29kZV0gIT09ICIiKSB7CiAgICAgICAgICAgIGdseXBoTmFtZSA9IGJhc2VFbmNvZGluZ1tjaGFyQ29kZV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnbHlwaE5hbWUgPSBTdGFuZGFyZEVuY29kaW5nW2NoYXJDb2RlXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghZ2x5cGhOYW1lKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3RhbmRhcmRHbHlwaE5hbWUgPSByZWNvdmVyR2x5cGhOYW1lKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgICBsZXQgdW5pY29kZU9yQ2hhckNvZGU7CiAgICAgICAgICBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDEpIHsKICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW3N0YW5kYXJkR2x5cGhOYW1lXTsKICAgICAgICAgIH0gZWxzZSBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDEgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHsKICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBNYWNSb21hbkVuY29kaW5nLmluZGV4T2Yoc3RhbmRhcmRHbHlwaE5hbWUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHVuaWNvZGVPckNoYXJDb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKCFwcm9wZXJ0aWVzLmdseXBoTmFtZXMgJiYgcHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCAmJiAhKHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApKSB7CiAgICAgICAgICAgICAgY29uc3QgdW5pY29kZSA9IHRoaXMudG9Vbmljb2RlLmdldChjaGFyQ29kZSk7CiAgICAgICAgICAgICAgaWYgKHVuaWNvZGUpIHsKICAgICAgICAgICAgICAgIHVuaWNvZGVPckNoYXJDb2RlID0gdW5pY29kZS5jb2RlUG9pbnRBdCgwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVuaWNvZGVPckNoYXJDb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZm9yIChjb25zdCBtYXBwaW5nIG9mIGNtYXBNYXBwaW5ncykgewogICAgICAgICAgICBpZiAobWFwcGluZy5jaGFyQ29kZSAhPT0gdW5pY29kZU9yQ2hhckNvZGUpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBtYXBwaW5nLmdseXBoSWQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMCkgewogICAgICAgIGZvciAoY29uc3QgbWFwcGluZyBvZiBjbWFwTWFwcGluZ3MpIHsKICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW21hcHBpbmcuY2hhckNvZGVdID0gbWFwcGluZy5nbHlwaElkOwogICAgICAgIH0KICAgICAgICBmb3JjZVBvc3RUYWJsZSA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHsKICAgICAgICBmb3IgKGNvbnN0IG1hcHBpbmcgb2YgY21hcE1hcHBpbmdzKSB7CiAgICAgICAgICBsZXQgY2hhckNvZGUgPSBtYXBwaW5nLmNoYXJDb2RlOwogICAgICAgICAgaWYgKGNoYXJDb2RlID49IDB4ZjAwMCAmJiBjaGFyQ29kZSA8PSAweGYwZmYpIHsKICAgICAgICAgICAgY2hhckNvZGUgJj0gMHhmZjsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IG1hcHBpbmcuZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBtYXBwaW5nIG9mIGNtYXBNYXBwaW5ncykgewogICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbbWFwcGluZy5jaGFyQ29kZV0gPSBtYXBwaW5nLmdseXBoSWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLmdseXBoTmFtZXMgJiYgKGJhc2VFbmNvZGluZy5sZW5ndGggfHwgdGhpcy5kaWZmZXJlbmNlcy5sZW5ndGgpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICAgICAgaWYgKCFmb3JjZVBvc3RUYWJsZSAmJiBjaGFyQ29kZVRvR2x5cGhJZFtpXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tpXSB8fCBiYXNlRW5jb2RpbmdbaV07CiAgICAgICAgICBpZiAoIWdseXBoTmFtZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGdseXBoSWQgPSBwcm9wZXJ0aWVzLmdseXBoTmFtZXMuaW5kZXhPZihnbHlwaE5hbWUpOwogICAgICAgICAgaWYgKGdseXBoSWQgPiAwICYmIGhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2ldID0gZ2x5cGhJZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChjaGFyQ29kZVRvR2x5cGhJZC5sZW5ndGggPT09IDApIHsKICAgICAgY2hhckNvZGVUb0dseXBoSWRbMF0gPSAwOwogICAgfQogICAgbGV0IGdseXBoWmVyb0lkID0gbnVtR2x5cGhzT3V0IC0gMTsKICAgIGlmICghZHVwRmlyc3RFbnRyeSkgewogICAgICBnbHlwaFplcm9JZCA9IDA7CiAgICB9CiAgICBpZiAoIXByb3BlcnRpZXMuY3NzRm9udEluZm8pIHsKICAgICAgY29uc3QgbmV3TWFwcGluZyA9IGFkanVzdE1hcHBpbmcoY2hhckNvZGVUb0dseXBoSWQsIGhhc0dseXBoLCBnbHlwaFplcm9JZCwgdGhpcy50b1VuaWNvZGUpOwogICAgICB0aGlzLnRvRm9udENoYXIgPSBuZXdNYXBwaW5nLnRvRm9udENoYXI7CiAgICAgIHRhYmxlcy5jbWFwID0gewogICAgICAgIHRhZzogImNtYXAiLAogICAgICAgIGRhdGE6IGNyZWF0ZUNtYXBUYWJsZShuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkLCBuZXdNYXBwaW5nLnRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHNPdXQpCiAgICAgIH07CiAgICAgIGlmICghdGFibGVzWyJPUy8yIl0gfHwgIXZhbGlkYXRlT1MyVGFibGUodGFibGVzWyJPUy8yIl0sIGZvbnQpKSB7CiAgICAgICAgdGFibGVzWyJPUy8yIl0gPSB7CiAgICAgICAgICB0YWc6ICJPUy8yIiwKICAgICAgICAgIGRhdGE6IGNyZWF0ZU9TMlRhYmxlKHByb3BlcnRpZXMsIG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQsIG1ldHJpY3NPdmVycmlkZSkKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBpZiAoIWlzVHJ1ZVR5cGUpIHsKICAgICAgdHJ5IHsKICAgICAgICBjZmZGaWxlID0gbmV3IFN0cmVhbSh0YWJsZXNbIkNGRiAiXS5kYXRhKTsKICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgQ0ZGUGFyc2VyKGNmZkZpbGUsIHByb3BlcnRpZXMsIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICAgICAgY2ZmID0gcGFyc2VyLnBhcnNlKCk7CiAgICAgICAgY2ZmLmR1cGxpY2F0ZUZpcnN0R2x5cGgoKTsKICAgICAgICBjb25zdCBjb21waWxlciA9IG5ldyBDRkZDb21waWxlcihjZmYpOwogICAgICAgIHRhYmxlc1siQ0ZGICJdLmRhdGEgPSBjb21waWxlci5jb21waWxlKCk7CiAgICAgIH0gY2F0Y2ggewogICAgICAgIHdhcm4oIkZhaWxlZCB0byBjb21waWxlIGZvbnQgIiArIHByb3BlcnRpZXMubG9hZGVkTmFtZSk7CiAgICAgIH0KICAgIH0KICAgIGlmICghdGFibGVzLm5hbWUpIHsKICAgICAgdGFibGVzLm5hbWUgPSB7CiAgICAgICAgdGFnOiAibmFtZSIsCiAgICAgICAgZGF0YTogY3JlYXRlTmFtZVRhYmxlKHRoaXMubmFtZSkKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IFtuYW1lUHJvdG90eXBlLCBuYW1lUmVjb3Jkc10gPSByZWFkTmFtZVRhYmxlKHRhYmxlcy5uYW1lKTsKICAgICAgdGFibGVzLm5hbWUuZGF0YSA9IGNyZWF0ZU5hbWVUYWJsZShuYW1lLCBuYW1lUHJvdG90eXBlKTsKICAgICAgdGhpcy5wc05hbWUgPSBuYW1lUHJvdG90eXBlWzBdWzZdIHx8IG51bGw7CiAgICAgIGlmICghcHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgICBhZGp1c3RUcnVlVHlwZVRvVW5pY29kZShwcm9wZXJ0aWVzLCB0aGlzLmlzU3ltYm9saWNGb250LCBuYW1lUmVjb3Jkcyk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgT3BlblR5cGVGaWxlQnVpbGRlcihoZWFkZXIudmVyc2lvbik7CiAgICBmb3IgKGNvbnN0IHRhYmxlVGFnIGluIHRhYmxlcykgewogICAgICBidWlsZGVyLmFkZFRhYmxlKHRhYmxlVGFnLCB0YWJsZXNbdGFibGVUYWddLmRhdGEpOwogICAgfQogICAgcmV0dXJuIGJ1aWxkZXIudG9BcnJheSgpOwogIH0KICBjb252ZXJ0KGZvbnROYW1lLCBmb250LCBwcm9wZXJ0aWVzKSB7CiAgICBwcm9wZXJ0aWVzLmZpeGVkUGl0Y2ggPSBmYWxzZTsKICAgIGlmIChwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZykgewogICAgICBhZGp1c3RUeXBlMVRvVW5pY29kZShwcm9wZXJ0aWVzLCBwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZyk7CiAgICB9CiAgICBsZXQgZ2x5cGhaZXJvSWQgPSAxOwogICAgaWYgKGZvbnQgaW5zdGFuY2VvZiBDRkZGb250KSB7CiAgICAgIGdseXBoWmVyb0lkID0gZm9udC5udW1HbHlwaHMgLSAxOwogICAgfQogICAgY29uc3QgbWFwcGluZyA9IGZvbnQuZ2V0R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMpOwogICAgbGV0IG5ld01hcHBpbmcgPSBudWxsOwogICAgbGV0IG5ld0NoYXJDb2RlVG9HbHlwaElkID0gbWFwcGluZzsKICAgIGxldCB0b1VuaWNvZGVFeHRyYU1hcCA9IG51bGw7CiAgICBpZiAoIXByb3BlcnRpZXMuY3NzRm9udEluZm8pIHsKICAgICAgbmV3TWFwcGluZyA9IGFkanVzdE1hcHBpbmcobWFwcGluZywgZm9udC5oYXNHbHlwaElkLmJpbmQoZm9udCksIGdseXBoWmVyb0lkLCB0aGlzLnRvVW5pY29kZSk7CiAgICAgIHRoaXMudG9Gb250Q2hhciA9IG5ld01hcHBpbmcudG9Gb250Q2hhcjsKICAgICAgbmV3Q2hhckNvZGVUb0dseXBoSWQgPSBuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkOwogICAgICB0b1VuaWNvZGVFeHRyYU1hcCA9IG5ld01hcHBpbmcudG9Vbmljb2RlRXh0cmFNYXA7CiAgICB9CiAgICBjb25zdCBudW1HbHlwaHMgPSBmb250Lm51bUdseXBoczsKICAgIGZ1bmN0aW9uIGdldENoYXJDb2RlcyhjaGFyQ29kZVRvR2x5cGhJZCwgZ2x5cGhJZCkgewogICAgICBsZXQgY2hhckNvZGVzID0gbnVsbDsKICAgICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBjaGFyQ29kZVRvR2x5cGhJZCkgewogICAgICAgIGlmIChnbHlwaElkID09PSBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0pIHsKICAgICAgICAgIChjaGFyQ29kZXMgfHw9IFtdKS5wdXNoKGNoYXJDb2RlIHwgMCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjaGFyQ29kZXM7CiAgICB9CiAgICBmdW5jdGlvbiBjcmVhdGVDaGFyQ29kZShjaGFyQ29kZVRvR2x5cGhJZCwgZ2x5cGhJZCkgewogICAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGNoYXJDb2RlVG9HbHlwaElkKSB7CiAgICAgICAgaWYgKGdseXBoSWQgPT09IGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSkgewogICAgICAgICAgcmV0dXJuIGNoYXJDb2RlIHwgMDsKICAgICAgICB9CiAgICAgIH0KICAgICAgbmV3TWFwcGluZy5jaGFyQ29kZVRvR2x5cGhJZFtuZXdNYXBwaW5nLm5leHRBdmFpbGFibGVGb250Q2hhckNvZGVdID0gZ2x5cGhJZDsKICAgICAgcmV0dXJuIG5ld01hcHBpbmcubmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZSsrOwogICAgfQogICAgY29uc3Qgc2VhY3MgPSBmb250LnNlYWNzOwogICAgaWYgKG5ld01hcHBpbmcgJiYgU0VBQ19BTkFMWVNJU19FTkFCTEVEICYmIHNlYWNzPy5sZW5ndGgpIHsKICAgICAgY29uc3QgbWF0cml4ID0gcHJvcGVydGllcy5mb250TWF0cml4IHx8IEZPTlRfSURFTlRJVFlfTUFUUklYOwogICAgICBjb25zdCBjaGFyc2V0ID0gZm9udC5nZXRDaGFyc2V0KCk7CiAgICAgIGNvbnN0IHNlYWNNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBmb3IgKGxldCBnbHlwaElkIGluIHNlYWNzKSB7CiAgICAgICAgZ2x5cGhJZCB8PSAwOwogICAgICAgIGNvbnN0IHNlYWMgPSBzZWFjc1tnbHlwaElkXTsKICAgICAgICBjb25zdCBiYXNlR2x5cGhOYW1lID0gU3RhbmRhcmRFbmNvZGluZ1tzZWFjWzJdXTsKICAgICAgICBjb25zdCBhY2NlbnRHbHlwaE5hbWUgPSBTdGFuZGFyZEVuY29kaW5nW3NlYWNbM11dOwogICAgICAgIGNvbnN0IGJhc2VHbHlwaElkID0gY2hhcnNldC5pbmRleE9mKGJhc2VHbHlwaE5hbWUpOwogICAgICAgIGNvbnN0IGFjY2VudEdseXBoSWQgPSBjaGFyc2V0LmluZGV4T2YoYWNjZW50R2x5cGhOYW1lKTsKICAgICAgICBpZiAoYmFzZUdseXBoSWQgPCAwIHx8IGFjY2VudEdseXBoSWQgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYWNjZW50T2Zmc2V0ID0gewogICAgICAgICAgeDogc2VhY1swXSAqIG1hdHJpeFswXSArIHNlYWNbMV0gKiBtYXRyaXhbMl0gKyBtYXRyaXhbNF0sCiAgICAgICAgICB5OiBzZWFjWzBdICogbWF0cml4WzFdICsgc2VhY1sxXSAqIG1hdHJpeFszXSArIG1hdHJpeFs1XQogICAgICAgIH07CiAgICAgICAgY29uc3QgY2hhckNvZGVzID0gZ2V0Q2hhckNvZGVzKG1hcHBpbmcsIGdseXBoSWQpOwogICAgICAgIGlmICghY2hhckNvZGVzKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBjaGFyQ29kZSBvZiBjaGFyQ29kZXMpIHsKICAgICAgICAgIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gbmV3TWFwcGluZy5jaGFyQ29kZVRvR2x5cGhJZDsKICAgICAgICAgIGNvbnN0IGJhc2VGb250Q2hhckNvZGUgPSBjcmVhdGVDaGFyQ29kZShjaGFyQ29kZVRvR2x5cGhJZCwgYmFzZUdseXBoSWQpOwogICAgICAgICAgY29uc3QgYWNjZW50Rm9udENoYXJDb2RlID0gY3JlYXRlQ2hhckNvZGUoY2hhckNvZGVUb0dseXBoSWQsIGFjY2VudEdseXBoSWQpOwogICAgICAgICAgc2VhY01hcFtjaGFyQ29kZV0gPSB7CiAgICAgICAgICAgIGJhc2VGb250Q2hhckNvZGUsCiAgICAgICAgICAgIGFjY2VudEZvbnRDaGFyQ29kZSwKICAgICAgICAgICAgYWNjZW50T2Zmc2V0CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgICBwcm9wZXJ0aWVzLnNlYWNNYXAgPSBzZWFjTWFwOwogICAgfQogICAgY29uc3QgdW5pdHNQZXJFbSA9IHByb3BlcnRpZXMuZm9udE1hdHJpeCA/IDEgLyBNYXRoLm1heCguLi5wcm9wZXJ0aWVzLmZvbnRNYXRyaXguc2xpY2UoMCwgNCkubWFwKE1hdGguYWJzKSkgOiAxMDAwOwogICAgY29uc3QgYnVpbGRlciA9IG5ldyBPcGVuVHlwZUZpbGVCdWlsZGVyKCJceDRGXHg1NFx4NTRceDRGIik7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJDRkYgIiwgZm9udC5kYXRhKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoIk9TLzIiLCBjcmVhdGVPUzJUYWJsZShwcm9wZXJ0aWVzLCBuZXdDaGFyQ29kZVRvR2x5cGhJZCkpOwogICAgYnVpbGRlci5hZGRUYWJsZSgiY21hcCIsIGNyZWF0ZUNtYXBUYWJsZShuZXdDaGFyQ29kZVRvR2x5cGhJZCwgdG9Vbmljb2RlRXh0cmFNYXAsIG51bUdseXBocykpOwogICAgYnVpbGRlci5hZGRUYWJsZSgiaGVhZCIsICJceDAwXHgwMVx4MDBceDAwIiArICJceDAwXHgwMFx4MTBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDVGXHgwRlx4M0NceEY1IiArICJceDAwXHgwMCIgKyBzYWZlU3RyaW5nMTYodW5pdHNQZXJFbSkgKyAiXHgwMFx4MDBceDAwXHgwMFx4OWVceDBiXHg3ZVx4MjciICsgIlx4MDBceDAwXHgwMFx4MDBceDllXHgwYlx4N2VceDI3IiArICJceDAwXHgwMCIgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5kZXNjZW50KSArICJceDBGXHhGRiIgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5hc2NlbnQpICsgc3RyaW5nMTYocHJvcGVydGllcy5pdGFsaWNBbmdsZSA/IDIgOiAwKSArICJceDAwXHgxMSIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIpOwogICAgYnVpbGRlci5hZGRUYWJsZSgiaGhlYSIsICJceDAwXHgwMVx4MDBceDAwIiArIHNhZmVTdHJpbmcxNihwcm9wZXJ0aWVzLmFzY2VudCkgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5kZXNjZW50KSArICJceDAwXHgwMCIgKyAiXHhGRlx4RkYiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuY2FwSGVpZ2h0KSArIHNhZmVTdHJpbmcxNihNYXRoLnRhbihwcm9wZXJ0aWVzLml0YWxpY0FuZ2xlKSAqIHByb3BlcnRpZXMueEhlaWdodCkgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyBzdHJpbmcxNihudW1HbHlwaHMpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoImhtdHgiLCBmdW5jdGlvbiBmb250RmllbGRzSG10eCgpIHsKICAgICAgY29uc3QgY2hhcnN0cmluZ3MgPSBmb250LmNoYXJzdHJpbmdzOwogICAgICBjb25zdCBjZmZXaWR0aHMgPSBmb250LmNmZiA/IGZvbnQuY2ZmLndpZHRocyA6IG51bGw7CiAgICAgIGxldCBobXR4ID0gIlx4MDBceDAwXHgwMFx4MDAiOwogICAgICBmb3IgKGxldCBpID0gMSwgaWkgPSBudW1HbHlwaHM7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgbGV0IHdpZHRoID0gMDsKICAgICAgICBpZiAoY2hhcnN0cmluZ3MpIHsKICAgICAgICAgIGNvbnN0IGNoYXJzdHJpbmcgPSBjaGFyc3RyaW5nc1tpIC0gMV07CiAgICAgICAgICB3aWR0aCA9ICJ3aWR0aCIgaW4gY2hhcnN0cmluZyA/IGNoYXJzdHJpbmcud2lkdGggOiAwOwogICAgICAgIH0gZWxzZSBpZiAoY2ZmV2lkdGhzKSB7CiAgICAgICAgICB3aWR0aCA9IE1hdGguY2VpbChjZmZXaWR0aHNbaV0gfHwgMCk7CiAgICAgICAgfQogICAgICAgIGhtdHggKz0gc3RyaW5nMTYod2lkdGgpICsgc3RyaW5nMTYoMCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGhtdHg7CiAgICB9KCkpOwogICAgYnVpbGRlci5hZGRUYWJsZSgibWF4cCIsICJceDAwXHgwMFx4NTBceDAwIiArIHN0cmluZzE2KG51bUdseXBocykpOwogICAgYnVpbGRlci5hZGRUYWJsZSgibmFtZSIsIGNyZWF0ZU5hbWVUYWJsZShmb250TmFtZSkpOwogICAgYnVpbGRlci5hZGRUYWJsZSgicG9zdCIsIGNyZWF0ZVBvc3RUYWJsZShwcm9wZXJ0aWVzKSk7CiAgICByZXR1cm4gYnVpbGRlci50b0FycmF5KCk7CiAgfQogIGdldCBfc3BhY2VXaWR0aCgpIHsKICAgIGNvbnN0IHBvc3NpYmxlU3BhY2VSZXBsYWNlbWVudHMgPSBbInNwYWNlIiwgIm1pbnVzIiwgIm9uZSIsICJpIiwgIkkiXTsKICAgIGxldCB3aWR0aDsKICAgIGZvciAoY29uc3QgZ2x5cGhOYW1lIG9mIHBvc3NpYmxlU3BhY2VSZXBsYWNlbWVudHMpIHsKICAgICAgaWYgKGdseXBoTmFtZSBpbiB0aGlzLndpZHRocykgewogICAgICAgIHdpZHRoID0gdGhpcy53aWR0aHNbZ2x5cGhOYW1lXTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb25zdCBnbHlwaHNVbmljb2RlTWFwID0gZ2V0R2x5cGhzVW5pY29kZSgpOwogICAgICBjb25zdCBnbHlwaFVuaWNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW2dseXBoTmFtZV07CiAgICAgIGxldCBjaGFyY29kZSA9IDA7CiAgICAgIGlmICh0aGlzLmNvbXBvc2l0ZSAmJiB0aGlzLmNNYXAuY29udGFpbnMoZ2x5cGhVbmljb2RlKSkgewogICAgICAgIGNoYXJjb2RlID0gdGhpcy5jTWFwLmxvb2t1cChnbHlwaFVuaWNvZGUpOwogICAgICAgIGlmICh0eXBlb2YgY2hhcmNvZGUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBjaGFyY29kZSA9IGNvbnZlcnRDaWRTdHJpbmcoZ2x5cGhVbmljb2RlLCBjaGFyY29kZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghY2hhcmNvZGUgJiYgdGhpcy50b1VuaWNvZGUpIHsKICAgICAgICBjaGFyY29kZSA9IHRoaXMudG9Vbmljb2RlLmNoYXJDb2RlT2YoZ2x5cGhVbmljb2RlKTsKICAgICAgfQogICAgICBpZiAoY2hhcmNvZGUgPD0gMCkgewogICAgICAgIGNoYXJjb2RlID0gZ2x5cGhVbmljb2RlOwogICAgICB9CiAgICAgIHdpZHRoID0gdGhpcy53aWR0aHNbY2hhcmNvZGVdOwogICAgICBpZiAod2lkdGgpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3NwYWNlV2lkdGgiLCB3aWR0aCB8fCB0aGlzLmRlZmF1bHRXaWR0aCk7CiAgfQogIF9jaGFyVG9HbHlwaChjaGFyY29kZSwgaXNTcGFjZSA9IGZhbHNlKSB7CiAgICBsZXQgZ2x5cGggPSB0aGlzLl9nbHlwaENhY2hlW2NoYXJjb2RlXTsKICAgIGlmIChnbHlwaD8uaXNTcGFjZSA9PT0gaXNTcGFjZSkgewogICAgICByZXR1cm4gZ2x5cGg7CiAgICB9CiAgICBsZXQgZm9udENoYXJDb2RlLCB3aWR0aCwgb3BlcmF0b3JMaXN0SWQ7CiAgICBsZXQgd2lkdGhDb2RlID0gY2hhcmNvZGU7CiAgICBpZiAodGhpcy5jTWFwPy5jb250YWlucyhjaGFyY29kZSkpIHsKICAgICAgd2lkdGhDb2RlID0gdGhpcy5jTWFwLmxvb2t1cChjaGFyY29kZSk7CiAgICAgIGlmICh0eXBlb2Ygd2lkdGhDb2RlID09PSAic3RyaW5nIikgewogICAgICAgIHdpZHRoQ29kZSA9IGNvbnZlcnRDaWRTdHJpbmcoY2hhcmNvZGUsIHdpZHRoQ29kZSk7CiAgICAgIH0KICAgIH0KICAgIHdpZHRoID0gdGhpcy53aWR0aHNbd2lkdGhDb2RlXTsKICAgIGlmICh0eXBlb2Ygd2lkdGggIT09ICJudW1iZXIiKSB7CiAgICAgIHdpZHRoID0gdGhpcy5kZWZhdWx0V2lkdGg7CiAgICB9CiAgICBjb25zdCB2bWV0cmljID0gdGhpcy52bWV0cmljcz8uW3dpZHRoQ29kZV07CiAgICBsZXQgdW5pY29kZSA9IHRoaXMudG9Vbmljb2RlLmdldChjaGFyY29kZSkgfHwgY2hhcmNvZGU7CiAgICBpZiAodHlwZW9mIHVuaWNvZGUgPT09ICJudW1iZXIiKSB7CiAgICAgIHVuaWNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHVuaWNvZGUpOwogICAgfQogICAgbGV0IGlzSW5Gb250ID0gdGhpcy50b0ZvbnRDaGFyW2NoYXJjb2RlXSAhPT0gdW5kZWZpbmVkOwogICAgZm9udENoYXJDb2RlID0gdGhpcy50b0ZvbnRDaGFyW2NoYXJjb2RlXSB8fCBjaGFyY29kZTsKICAgIGlmICh0aGlzLm1pc3NpbmdGaWxlKSB7CiAgICAgIGNvbnN0IGdseXBoTmFtZSA9IHRoaXMuZGlmZmVyZW5jZXNbY2hhcmNvZGVdIHx8IHRoaXMuZGVmYXVsdEVuY29kaW5nW2NoYXJjb2RlXTsKICAgICAgaWYgKChnbHlwaE5hbWUgPT09ICIubm90ZGVmIiB8fCBnbHlwaE5hbWUgPT09ICIiKSAmJiB0aGlzLnR5cGUgPT09ICJUeXBlMSIpIHsKICAgICAgICBmb250Q2hhckNvZGUgPSAweDIwOwogICAgICAgIGlmIChnbHlwaE5hbWUgPT09ICIiKSB7CiAgICAgICAgICB3aWR0aCB8fD0gdGhpcy5fc3BhY2VXaWR0aDsKICAgICAgICAgIHVuaWNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnRDaGFyQ29kZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvbnRDaGFyQ29kZSA9IG1hcFNwZWNpYWxVbmljb2RlVmFsdWVzKGZvbnRDaGFyQ29kZSk7CiAgICB9CiAgICBpZiAodGhpcy5pc1R5cGUzRm9udCkgewogICAgICBvcGVyYXRvckxpc3RJZCA9IGZvbnRDaGFyQ29kZTsKICAgIH0KICAgIGxldCBhY2NlbnQgPSBudWxsOwogICAgaWYgKHRoaXMuc2VhY01hcD8uW2NoYXJjb2RlXSkgewogICAgICBpc0luRm9udCA9IHRydWU7CiAgICAgIGNvbnN0IHNlYWMgPSB0aGlzLnNlYWNNYXBbY2hhcmNvZGVdOwogICAgICBmb250Q2hhckNvZGUgPSBzZWFjLmJhc2VGb250Q2hhckNvZGU7CiAgICAgIGFjY2VudCA9IHsKICAgICAgICBmb250Q2hhcjogU3RyaW5nLmZyb21Db2RlUG9pbnQoc2VhYy5hY2NlbnRGb250Q2hhckNvZGUpLAogICAgICAgIG9mZnNldDogc2VhYy5hY2NlbnRPZmZzZXQKICAgICAgfTsKICAgIH0KICAgIGxldCBmb250Q2hhciA9ICIiOwogICAgaWYgKHR5cGVvZiBmb250Q2hhckNvZGUgPT09ICJudW1iZXIiKSB7CiAgICAgIGlmIChmb250Q2hhckNvZGUgPD0gMHgxMGZmZmYpIHsKICAgICAgICBmb250Q2hhciA9IFN0cmluZy5mcm9tQ29kZVBvaW50KGZvbnRDaGFyQ29kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybihgY2hhclRvR2x5cGggLSBpbnZhbGlkIGZvbnRDaGFyQ29kZTogJHtmb250Q2hhckNvZGV9YCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLm1pc3NpbmdGaWxlICYmIHRoaXMudmVydGljYWwgJiYgZm9udENoYXIubGVuZ3RoID09PSAxKSB7CiAgICAgIGNvbnN0IHZlcnRpY2FsID0gZ2V0VmVydGljYWxQcmVzZW50YXRpb25Gb3JtKClbZm9udENoYXIuY2hhckNvZGVBdCgwKV07CiAgICAgIGlmICh2ZXJ0aWNhbCkgewogICAgICAgIGZvbnRDaGFyID0gdW5pY29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodmVydGljYWwpOwogICAgICB9CiAgICB9CiAgICBnbHlwaCA9IG5ldyBmb250c19HbHlwaChjaGFyY29kZSwgZm9udENoYXIsIHVuaWNvZGUsIGFjY2VudCwgd2lkdGgsIHZtZXRyaWMsIG9wZXJhdG9yTGlzdElkLCBpc1NwYWNlLCBpc0luRm9udCk7CiAgICByZXR1cm4gdGhpcy5fZ2x5cGhDYWNoZVtjaGFyY29kZV0gPSBnbHlwaDsKICB9CiAgY2hhcnNUb0dseXBocyhjaGFycykgewogICAgbGV0IGdseXBocyA9IHRoaXMuX2NoYXJzQ2FjaGVbY2hhcnNdOwogICAgaWYgKGdseXBocykgewogICAgICByZXR1cm4gZ2x5cGhzOwogICAgfQogICAgZ2x5cGhzID0gW107CiAgICBpZiAodGhpcy5jTWFwKSB7CiAgICAgIGNvbnN0IGMgPSBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgICAgIGlpID0gY2hhcnMubGVuZ3RoOwogICAgICBsZXQgaSA9IDA7CiAgICAgIHdoaWxlIChpIDwgaWkpIHsKICAgICAgICB0aGlzLmNNYXAucmVhZENoYXJDb2RlKGNoYXJzLCBpLCBjKTsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjaGFyY29kZSwKICAgICAgICAgIGxlbmd0aAogICAgICAgIH0gPSBjOwogICAgICAgIGkgKz0gbGVuZ3RoOwogICAgICAgIGNvbnN0IGdseXBoID0gdGhpcy5fY2hhclRvR2x5cGgoY2hhcmNvZGUsIGxlbmd0aCA9PT0gMSAmJiBjaGFycy5jaGFyQ29kZUF0KGkgLSAxKSA9PT0gMHgyMCk7CiAgICAgICAgZ2x5cGhzLnB1c2goZ2x5cGgpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaGFycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgY29uc3QgY2hhcmNvZGUgPSBjaGFycy5jaGFyQ29kZUF0KGkpOwogICAgICAgIGNvbnN0IGdseXBoID0gdGhpcy5fY2hhclRvR2x5cGgoY2hhcmNvZGUsIGNoYXJjb2RlID09PSAweDIwKTsKICAgICAgICBnbHlwaHMucHVzaChnbHlwaCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0aGlzLl9jaGFyc0NhY2hlW2NoYXJzXSA9IGdseXBoczsKICB9CiAgZ2V0Q2hhclBvc2l0aW9ucyhjaGFycykgewogICAgY29uc3QgcG9zaXRpb25zID0gW107CiAgICBpZiAodGhpcy5jTWFwKSB7CiAgICAgIGNvbnN0IGMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBsZXQgaSA9IDA7CiAgICAgIHdoaWxlIChpIDwgY2hhcnMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5jTWFwLnJlYWRDaGFyQ29kZShjaGFycywgaSwgYyk7CiAgICAgICAgY29uc3QgbGVuZ3RoID0gYy5sZW5ndGg7CiAgICAgICAgcG9zaXRpb25zLnB1c2goW2ksIGkgKyBsZW5ndGhdKTsKICAgICAgICBpICs9IGxlbmd0aDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY2hhcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgIHBvc2l0aW9ucy5wdXNoKFtpLCBpICsgMV0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9zaXRpb25zOwogIH0KICBnZXQgZ2x5cGhDYWNoZVZhbHVlcygpIHsKICAgIHJldHVybiBPYmplY3QudmFsdWVzKHRoaXMuX2dseXBoQ2FjaGUpOwogIH0KICBlbmNvZGVTdHJpbmcoc3RyKSB7CiAgICBjb25zdCBidWZmZXJzID0gW107CiAgICBjb25zdCBjdXJyZW50QnVmID0gW107CiAgICBjb25zdCBoYXNDdXJyZW50QnVmRXJyb3JzID0gKCkgPT4gYnVmZmVycy5sZW5ndGggJSAyID09PSAxOwogICAgY29uc3QgZ2V0Q2hhckNvZGUgPSB0aGlzLnRvVW5pY29kZSBpbnN0YW5jZW9mIElkZW50aXR5VG9Vbmljb2RlTWFwID8gdW5pY29kZSA9PiB0aGlzLnRvVW5pY29kZS5jaGFyQ29kZU9mKHVuaWNvZGUpIDogdW5pY29kZSA9PiB0aGlzLnRvVW5pY29kZS5jaGFyQ29kZU9mKFN0cmluZy5mcm9tQ29kZVBvaW50KHVuaWNvZGUpKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHVuaWNvZGUgPSBzdHIuY29kZVBvaW50QXQoaSk7CiAgICAgIGlmICh1bmljb2RlID4gMHhkN2ZmICYmICh1bmljb2RlIDwgMHhlMDAwIHx8IHVuaWNvZGUgPiAweGZmZmQpKSB7CiAgICAgICAgaSsrOwogICAgICB9CiAgICAgIGlmICh0aGlzLnRvVW5pY29kZSkgewogICAgICAgIGNvbnN0IGNoYXJDb2RlID0gZ2V0Q2hhckNvZGUodW5pY29kZSk7CiAgICAgICAgaWYgKGNoYXJDb2RlICE9PSAtMSkgewogICAgICAgICAgaWYgKGhhc0N1cnJlbnRCdWZFcnJvcnMoKSkgewogICAgICAgICAgICBidWZmZXJzLnB1c2goY3VycmVudEJ1Zi5qb2luKCIiKSk7CiAgICAgICAgICAgIGN1cnJlbnRCdWYubGVuZ3RoID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGNoYXJDb2RlTGVuZ3RoID0gdGhpcy5jTWFwID8gdGhpcy5jTWFwLmdldENoYXJDb2RlTGVuZ3RoKGNoYXJDb2RlKSA6IDE7CiAgICAgICAgICBmb3IgKGxldCBqID0gY2hhckNvZGVMZW5ndGggLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgICBjdXJyZW50QnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyQ29kZSA+PiA4ICogaiAmIDB4ZmYpKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWhhc0N1cnJlbnRCdWZFcnJvcnMoKSkgewogICAgICAgIGJ1ZmZlcnMucHVzaChjdXJyZW50QnVmLmpvaW4oIiIpKTsKICAgICAgICBjdXJyZW50QnVmLmxlbmd0aCA9IDA7CiAgICAgIH0KICAgICAgY3VycmVudEJ1Zi5wdXNoKFN0cmluZy5mcm9tQ29kZVBvaW50KHVuaWNvZGUpKTsKICAgIH0KICAgIGJ1ZmZlcnMucHVzaChjdXJyZW50QnVmLmpvaW4oIiIpKTsKICAgIHJldHVybiBidWZmZXJzOwogIH0KfQpjbGFzcyBFcnJvckZvbnQgewogIGNvbnN0cnVjdG9yKGVycm9yKSB7CiAgICB0aGlzLmVycm9yID0gZXJyb3I7CiAgICB0aGlzLmxvYWRlZE5hbWUgPSAiZ19mb250X2Vycm9yIjsKICAgIHRoaXMubWlzc2luZ0ZpbGUgPSB0cnVlOwogIH0KICBjaGFyc1RvR2x5cGhzKCkgewogICAgcmV0dXJuIFtdOwogIH0KICBlbmNvZGVTdHJpbmcoY2hhcnMpIHsKICAgIHJldHVybiBbY2hhcnNdOwogIH0KICBleHBvcnREYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZXJyb3I6IHRoaXMuZXJyb3IKICAgIH07CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9wYXR0ZXJuLmpzCgoKCgpjb25zdCBTaGFkaW5nVHlwZSA9IHsKICBGVU5DVElPTl9CQVNFRDogMSwKICBBWElBTDogMiwKICBSQURJQUw6IDMsCiAgRlJFRV9GT1JNX01FU0g6IDQsCiAgTEFUVElDRV9GT1JNX01FU0g6IDUsCiAgQ09PTlNfUEFUQ0hfTUVTSDogNiwKICBURU5TT1JfUEFUQ0hfTUVTSDogNwp9OwpjbGFzcyBQYXR0ZXJuIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHVucmVhY2hhYmxlKCJDYW5ub3QgaW5pdGlhbGl6ZSBQYXR0ZXJuLiIpOwogIH0KICBzdGF0aWMgcGFyc2VTaGFkaW5nKHNoYWRpbmcsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKSB7CiAgICBjb25zdCBkaWN0ID0gc2hhZGluZyBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gPyBzaGFkaW5nLmRpY3QgOiBzaGFkaW5nOwogICAgY29uc3QgdHlwZSA9IGRpY3QuZ2V0KCJTaGFkaW5nVHlwZSIpOwogICAgdHJ5IHsKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5BWElBTDoKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLlJBRElBTDoKICAgICAgICAgIHJldHVybiBuZXcgUmFkaWFsQXhpYWxTaGFkaW5nKGRpY3QsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLkZSRUVfRk9STV9NRVNIOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuTEFUVElDRV9GT1JNX01FU0g6CiAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5DT09OU19QQVRDSF9NRVNIOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuVEVOU09SX1BBVENIX01FU0g6CiAgICAgICAgICByZXR1cm4gbmV3IE1lc2hTaGFkaW5nKHNoYWRpbmcsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbnN1cHBvcnRlZCBTaGFkaW5nVHlwZTogIiArIHR5cGUpOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oZXgpOwogICAgICByZXR1cm4gbmV3IER1bW15U2hhZGluZygpOwogICAgfQogIH0KfQpjbGFzcyBCYXNlU2hhZGluZyB7CiAgc3RhdGljIFNNQUxMX05VTUJFUiA9IDFlLTY7CiAgZ2V0SVIoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRJUmAgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBSYWRpYWxBeGlhbFNoYWRpbmcgZXh0ZW5kcyBCYXNlU2hhZGluZyB7CiAgY29uc3RydWN0b3IoZGljdCwgeHJlZiwgcmVzb3VyY2VzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnNoYWRpbmdUeXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICBsZXQgY29vcmRzTGVuID0gMDsKICAgIGlmICh0aGlzLnNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5BWElBTCkgewogICAgICBjb29yZHNMZW4gPSA0OwogICAgfSBlbHNlIGlmICh0aGlzLnNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5SQURJQUwpIHsKICAgICAgY29vcmRzTGVuID0gNjsKICAgIH0KICAgIHRoaXMuY29vcmRzQXJyID0gZGljdC5nZXRBcnJheSgiQ29vcmRzIik7CiAgICBpZiAoIWlzTnVtYmVyQXJyYXkodGhpcy5jb29yZHNBcnIsIGNvb3Jkc0xlbikpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJSYWRpYWxBeGlhbFNoYWRpbmc6IEludmFsaWQgL0Nvb3JkcyBhcnJheS4iKTsKICAgIH0KICAgIGNvbnN0IGNzID0gQ29sb3JTcGFjZVV0aWxzLnBhcnNlKHsKICAgICAgY3M6IGRpY3QuZ2V0UmF3KCJDUyIpIHx8IGRpY3QuZ2V0UmF3KCJDb2xvclNwYWNlIiksCiAgICAgIHhyZWYsCiAgICAgIHJlc291cmNlcywKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KTsKICAgIHRoaXMuYmJveCA9IGxvb2t1cE5vcm1hbFJlY3QoZGljdC5nZXRBcnJheSgiQkJveCIpLCBudWxsKTsKICAgIGxldCB0MCA9IDAuMCwKICAgICAgdDEgPSAxLjA7CiAgICBjb25zdCBkb21haW5BcnIgPSBkaWN0LmdldEFycmF5KCJEb21haW4iKTsKICAgIGlmIChpc051bWJlckFycmF5KGRvbWFpbkFyciwgMikpIHsKICAgICAgW3QwLCB0MV0gPSBkb21haW5BcnI7CiAgICB9CiAgICBsZXQgZXh0ZW5kU3RhcnQgPSBmYWxzZSwKICAgICAgZXh0ZW5kRW5kID0gZmFsc2U7CiAgICBjb25zdCBleHRlbmRBcnIgPSBkaWN0LmdldEFycmF5KCJFeHRlbmQiKTsKICAgIGlmIChpc0Jvb2xlYW5BcnJheShleHRlbmRBcnIsIDIpKSB7CiAgICAgIFtleHRlbmRTdGFydCwgZXh0ZW5kRW5kXSA9IGV4dGVuZEFycjsKICAgIH0KICAgIGlmICh0aGlzLnNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5SQURJQUwgJiYgKCFleHRlbmRTdGFydCB8fCAhZXh0ZW5kRW5kKSkgewogICAgICBjb25zdCBbeDEsIHkxLCByMSwgeDIsIHkyLCByMl0gPSB0aGlzLmNvb3Jkc0FycjsKICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLmh5cG90KHgxIC0geDIsIHkxIC0geTIpOwogICAgICBpZiAocjEgPD0gcjIgKyBkaXN0YW5jZSAmJiByMiA8PSByMSArIGRpc3RhbmNlKSB7CiAgICAgICAgd2FybigiVW5zdXBwb3J0ZWQgcmFkaWFsIGdyYWRpZW50LiIpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmV4dGVuZFN0YXJ0ID0gZXh0ZW5kU3RhcnQ7CiAgICB0aGlzLmV4dGVuZEVuZCA9IGV4dGVuZEVuZDsKICAgIGNvbnN0IGZuT2JqID0gZGljdC5nZXRSYXcoIkZ1bmN0aW9uIik7CiAgICBjb25zdCBmbiA9IHBkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUoZm5PYmosIHRydWUpOwogICAgY29uc3QgTlVNQkVSX09GX1NBTVBMRVMgPSA4NDA7CiAgICBjb25zdCBzdGVwID0gKHQxIC0gdDApIC8gTlVNQkVSX09GX1NBTVBMRVM7CiAgICBjb25zdCBjb2xvclN0b3BzID0gdGhpcy5jb2xvclN0b3BzID0gW107CiAgICBpZiAodDAgPj0gdDEgfHwgc3RlcCA8PSAwKSB7CiAgICAgIGluZm8oIkJhZCBzaGFkaW5nIGRvbWFpbi4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY29sb3IgPSBuZXcgRmxvYXQzMkFycmF5KGNzLm51bUNvbXBzKSwKICAgICAgcmF0aW8gPSBuZXcgRmxvYXQzMkFycmF5KDEpOwogICAgbGV0IGlCYXNlID0gMDsKICAgIHJhdGlvWzBdID0gdDA7CiAgICBmbihyYXRpbywgMCwgY29sb3IsIDApOwogICAgY29uc3QgcmdiQnVmZmVyID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogICAgY3MuZ2V0UmdiKGNvbG9yLCAwLCByZ2JCdWZmZXIpOwogICAgbGV0IFtyQmFzZSwgZ0Jhc2UsIGJCYXNlXSA9IHJnYkJ1ZmZlcjsKICAgIGNvbG9yU3RvcHMucHVzaChbMCwgVXRpbC5tYWtlSGV4Q29sb3IockJhc2UsIGdCYXNlLCBiQmFzZSldKTsKICAgIGxldCBpUHJldiA9IDE7CiAgICByYXRpb1swXSA9IHQwICsgc3RlcDsKICAgIGZuKHJhdGlvLCAwLCBjb2xvciwgMCk7CiAgICBjcy5nZXRSZ2IoY29sb3IsIDAsIHJnYkJ1ZmZlcik7CiAgICBsZXQgW3JQcmV2LCBnUHJldiwgYlByZXZdID0gcmdiQnVmZmVyOwogICAgbGV0IG1heFNsb3BlUiA9IHJQcmV2IC0gckJhc2UgKyAxOwogICAgbGV0IG1heFNsb3BlRyA9IGdQcmV2IC0gZ0Jhc2UgKyAxOwogICAgbGV0IG1heFNsb3BlQiA9IGJQcmV2IC0gYkJhc2UgKyAxOwogICAgbGV0IG1pblNsb3BlUiA9IHJQcmV2IC0gckJhc2UgLSAxOwogICAgbGV0IG1pblNsb3BlRyA9IGdQcmV2IC0gZ0Jhc2UgLSAxOwogICAgbGV0IG1pblNsb3BlQiA9IGJQcmV2IC0gYkJhc2UgLSAxOwogICAgZm9yIChsZXQgaSA9IDI7IGkgPCBOVU1CRVJfT0ZfU0FNUExFUzsgaSsrKSB7CiAgICAgIHJhdGlvWzBdID0gdDAgKyBpICogc3RlcDsKICAgICAgZm4ocmF0aW8sIDAsIGNvbG9yLCAwKTsKICAgICAgY3MuZ2V0UmdiKGNvbG9yLCAwLCByZ2JCdWZmZXIpOwogICAgICBjb25zdCBbciwgZywgYl0gPSByZ2JCdWZmZXI7CiAgICAgIGNvbnN0IHJ1biA9IGkgLSBpQmFzZTsKICAgICAgbWF4U2xvcGVSID0gTWF0aC5taW4obWF4U2xvcGVSLCAociAtIHJCYXNlICsgMSkgLyBydW4pOwogICAgICBtYXhTbG9wZUcgPSBNYXRoLm1pbihtYXhTbG9wZUcsIChnIC0gZ0Jhc2UgKyAxKSAvIHJ1bik7CiAgICAgIG1heFNsb3BlQiA9IE1hdGgubWluKG1heFNsb3BlQiwgKGIgLSBiQmFzZSArIDEpIC8gcnVuKTsKICAgICAgbWluU2xvcGVSID0gTWF0aC5tYXgobWluU2xvcGVSLCAociAtIHJCYXNlIC0gMSkgLyBydW4pOwogICAgICBtaW5TbG9wZUcgPSBNYXRoLm1heChtaW5TbG9wZUcsIChnIC0gZ0Jhc2UgLSAxKSAvIHJ1bik7CiAgICAgIG1pblNsb3BlQiA9IE1hdGgubWF4KG1pblNsb3BlQiwgKGIgLSBiQmFzZSAtIDEpIC8gcnVuKTsKICAgICAgY29uc3Qgc2xvcGVzRXhpc3QgPSBtaW5TbG9wZVIgPD0gbWF4U2xvcGVSICYmIG1pblNsb3BlRyA8PSBtYXhTbG9wZUcgJiYgbWluU2xvcGVCIDw9IG1heFNsb3BlQjsKICAgICAgaWYgKCFzbG9wZXNFeGlzdCkgewogICAgICAgIGNvbnN0IGNzc0NvbG9yID0gVXRpbC5tYWtlSGV4Q29sb3IoclByZXYsIGdQcmV2LCBiUHJldik7CiAgICAgICAgY29sb3JTdG9wcy5wdXNoKFtpUHJldiAvIE5VTUJFUl9PRl9TQU1QTEVTLCBjc3NDb2xvcl0pOwogICAgICAgIG1heFNsb3BlUiA9IHIgLSByUHJldiArIDE7CiAgICAgICAgbWF4U2xvcGVHID0gZyAtIGdQcmV2ICsgMTsKICAgICAgICBtYXhTbG9wZUIgPSBiIC0gYlByZXYgKyAxOwogICAgICAgIG1pblNsb3BlUiA9IHIgLSByUHJldiAtIDE7CiAgICAgICAgbWluU2xvcGVHID0gZyAtIGdQcmV2IC0gMTsKICAgICAgICBtaW5TbG9wZUIgPSBiIC0gYlByZXYgLSAxOwogICAgICAgIGlCYXNlID0gaVByZXY7CiAgICAgICAgckJhc2UgPSByUHJldjsKICAgICAgICBnQmFzZSA9IGdQcmV2OwogICAgICAgIGJCYXNlID0gYlByZXY7CiAgICAgIH0KICAgICAgaVByZXYgPSBpOwogICAgICByUHJldiA9IHI7CiAgICAgIGdQcmV2ID0gZzsKICAgICAgYlByZXYgPSBiOwogICAgfQogICAgY29sb3JTdG9wcy5wdXNoKFsxLCBVdGlsLm1ha2VIZXhDb2xvcihyUHJldiwgZ1ByZXYsIGJQcmV2KV0pOwogICAgbGV0IGJhY2tncm91bmQgPSAidHJhbnNwYXJlbnQiOwogICAgaWYgKGRpY3QuaGFzKCJCYWNrZ3JvdW5kIikpIHsKICAgICAgYmFja2dyb3VuZCA9IGNzLmdldFJnYkhleChkaWN0LmdldCgiQmFja2dyb3VuZCIpLCAwKTsKICAgIH0KICAgIGlmICghZXh0ZW5kU3RhcnQpIHsKICAgICAgY29sb3JTdG9wcy51bnNoaWZ0KFswLCBiYWNrZ3JvdW5kXSk7CiAgICAgIGNvbG9yU3RvcHNbMV1bMF0gKz0gQmFzZVNoYWRpbmcuU01BTExfTlVNQkVSOwogICAgfQogICAgaWYgKCFleHRlbmRFbmQpIHsKICAgICAgY29sb3JTdG9wcy5hdCgtMSlbMF0gLT0gQmFzZVNoYWRpbmcuU01BTExfTlVNQkVSOwogICAgICBjb2xvclN0b3BzLnB1c2goWzEsIGJhY2tncm91bmRdKTsKICAgIH0KICAgIHRoaXMuY29sb3JTdG9wcyA9IGNvbG9yU3RvcHM7CiAgfQogIGdldElSKCkgewogICAgY29uc3QgewogICAgICBjb29yZHNBcnIsCiAgICAgIHNoYWRpbmdUeXBlCiAgICB9ID0gdGhpczsKICAgIGxldCB0eXBlLCBwMCwgcDEsIHIwLCByMTsKICAgIGlmIChzaGFkaW5nVHlwZSA9PT0gU2hhZGluZ1R5cGUuQVhJQUwpIHsKICAgICAgcDAgPSBbY29vcmRzQXJyWzBdLCBjb29yZHNBcnJbMV1dOwogICAgICBwMSA9IFtjb29yZHNBcnJbMl0sIGNvb3Jkc0FyclszXV07CiAgICAgIHIwID0gbnVsbDsKICAgICAgcjEgPSBudWxsOwogICAgICB0eXBlID0gImF4aWFsIjsKICAgIH0gZWxzZSBpZiAoc2hhZGluZ1R5cGUgPT09IFNoYWRpbmdUeXBlLlJBRElBTCkgewogICAgICBwMCA9IFtjb29yZHNBcnJbMF0sIGNvb3Jkc0FyclsxXV07CiAgICAgIHAxID0gW2Nvb3Jkc0FyclszXSwgY29vcmRzQXJyWzRdXTsKICAgICAgcjAgPSBjb29yZHNBcnJbMl07CiAgICAgIHIxID0gY29vcmRzQXJyWzVdOwogICAgICB0eXBlID0gInJhZGlhbCI7CiAgICB9IGVsc2UgewogICAgICB1bnJlYWNoYWJsZShgZ2V0UGF0dGVybiB0eXBlIHVua25vd246ICR7c2hhZGluZ1R5cGV9YCk7CiAgICB9CiAgICByZXR1cm4gWyJSYWRpYWxBeGlhbCIsIHR5cGUsIHRoaXMuYmJveCwgdGhpcy5jb2xvclN0b3BzLCBwMCwgcDEsIHIwLCByMV07CiAgfQp9CmNsYXNzIE1lc2hTdHJlYW1SZWFkZXIgewogIGNvbnN0cnVjdG9yKHN0cmVhbSwgY29udGV4dCkgewogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0OwogICAgdGhpcy5idWZmZXIgPSAwOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogICAgY29uc3QgbnVtQ29tcHMgPSBjb250ZXh0Lm51bUNvbXBzOwogICAgdGhpcy50bXBDb21wc0J1ZiA9IG5ldyBGbG9hdDMyQXJyYXkobnVtQ29tcHMpOwogICAgY29uc3QgY3NOdW1Db21wcyA9IGNvbnRleHQuY29sb3JTcGFjZS5udW1Db21wczsKICAgIHRoaXMudG1wQ3NDb21wc0J1ZiA9IGNvbnRleHQuY29sb3JGbiA/IG5ldyBGbG9hdDMyQXJyYXkoY3NOdW1Db21wcykgOiB0aGlzLnRtcENvbXBzQnVmOwogIH0KICBnZXQgaGFzRGF0YSgpIHsKICAgIGlmICh0aGlzLnN0cmVhbS5lbmQpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLnBvcyA8IHRoaXMuc3RyZWFtLmVuZDsKICAgIH0KICAgIGlmICh0aGlzLmJ1ZmZlckxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb25zdCBuZXh0Qnl0ZSA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgIGlmIChuZXh0Qnl0ZSA8IDApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBuZXh0Qnl0ZTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gODsKICAgIHJldHVybiB0cnVlOwogIH0KICByZWFkQml0cyhuKSB7CiAgICBjb25zdCB7CiAgICAgIHN0cmVhbQogICAgfSA9IHRoaXM7CiAgICBsZXQgewogICAgICBidWZmZXIsCiAgICAgIGJ1ZmZlckxlbmd0aAogICAgfSA9IHRoaXM7CiAgICBpZiAobiA9PT0gMzIpIHsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBzdHJlYW0uZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgfQogICAgICBidWZmZXIgPSBidWZmZXIgPDwgMjQgfCBzdHJlYW0uZ2V0Qnl0ZSgpIDw8IDE2IHwgc3RyZWFtLmdldEJ5dGUoKSA8PCA4IHwgc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgY29uc3QgbmV4dEJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICB0aGlzLmJ1ZmZlciA9IG5leHRCeXRlICYgKDEgPDwgYnVmZmVyTGVuZ3RoKSAtIDE7CiAgICAgIHJldHVybiAoYnVmZmVyIDw8IDggLSBidWZmZXJMZW5ndGggfCAobmV4dEJ5dGUgJiAweGZmKSA+PiBidWZmZXJMZW5ndGgpID4+PiAwOwogICAgfQogICAgaWYgKG4gPT09IDggJiYgYnVmZmVyTGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgfQogICAgd2hpbGUgKGJ1ZmZlckxlbmd0aCA8IG4pIHsKICAgICAgYnVmZmVyID0gYnVmZmVyIDw8IDggfCBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICBidWZmZXJMZW5ndGggKz0gODsKICAgIH0KICAgIGJ1ZmZlckxlbmd0aCAtPSBuOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBidWZmZXJMZW5ndGg7CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlciAmICgxIDw8IGJ1ZmZlckxlbmd0aCkgLSAxOwogICAgcmV0dXJuIGJ1ZmZlciA+PiBidWZmZXJMZW5ndGg7CiAgfQogIGFsaWduKCkgewogICAgdGhpcy5idWZmZXIgPSAwOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogIH0KICByZWFkRmxhZygpIHsKICAgIHJldHVybiB0aGlzLnJlYWRCaXRzKHRoaXMuY29udGV4dC5iaXRzUGVyRmxhZyk7CiAgfQogIHJlYWRDb29yZGluYXRlKCkgewogICAgY29uc3QgewogICAgICBiaXRzUGVyQ29vcmRpbmF0ZSwKICAgICAgZGVjb2RlCiAgICB9ID0gdGhpcy5jb250ZXh0OwogICAgY29uc3QgeGkgPSB0aGlzLnJlYWRCaXRzKGJpdHNQZXJDb29yZGluYXRlKTsKICAgIGNvbnN0IHlpID0gdGhpcy5yZWFkQml0cyhiaXRzUGVyQ29vcmRpbmF0ZSk7CiAgICBjb25zdCBzY2FsZSA9IGJpdHNQZXJDb29yZGluYXRlIDwgMzIgPyAxIC8gKCgxIDw8IGJpdHNQZXJDb29yZGluYXRlKSAtIDEpIDogMi4zMjgzMDY0MzY1Mzg2OTYzZS0xMDsKICAgIHJldHVybiBbeGkgKiBzY2FsZSAqIChkZWNvZGVbMV0gLSBkZWNvZGVbMF0pICsgZGVjb2RlWzBdLCB5aSAqIHNjYWxlICogKGRlY29kZVszXSAtIGRlY29kZVsyXSkgKyBkZWNvZGVbMl1dOwogIH0KICByZWFkQ29tcG9uZW50cygpIHsKICAgIGNvbnN0IHsKICAgICAgYml0c1BlckNvbXBvbmVudCwKICAgICAgY29sb3JGbiwKICAgICAgY29sb3JTcGFjZSwKICAgICAgZGVjb2RlLAogICAgICBudW1Db21wcwogICAgfSA9IHRoaXMuY29udGV4dDsKICAgIGNvbnN0IHNjYWxlID0gYml0c1BlckNvbXBvbmVudCA8IDMyID8gMSAvICgoMSA8PCBiaXRzUGVyQ29tcG9uZW50KSAtIDEpIDogMi4zMjgzMDY0MzY1Mzg2OTYzZS0xMDsKICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLnRtcENvbXBzQnVmOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSA0OyBpIDwgbnVtQ29tcHM7IGkrKywgaiArPSAyKSB7CiAgICAgIGNvbnN0IGNpID0gdGhpcy5yZWFkQml0cyhiaXRzUGVyQ29tcG9uZW50KTsKICAgICAgY29tcG9uZW50c1tpXSA9IGNpICogc2NhbGUgKiAoZGVjb2RlW2ogKyAxXSAtIGRlY29kZVtqXSkgKyBkZWNvZGVbal07CiAgICB9CiAgICBjb25zdCBjb2xvciA9IHRoaXMudG1wQ3NDb21wc0J1ZjsKICAgIGNvbG9yRm4/Lihjb21wb25lbnRzLCAwLCBjb2xvciwgMCk7CiAgICByZXR1cm4gY29sb3JTcGFjZS5nZXRSZ2IoY29sb3IsIDApOwogIH0KfQpsZXQgYkNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKZnVuY3Rpb24gYnVpbGRCKGNvdW50KSB7CiAgY29uc3QgbHV0ID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY291bnQ7IGkrKykgewogICAgY29uc3QgdCA9IGkgLyBjb3VudCwKICAgICAgdF8gPSAxIC0gdDsKICAgIGx1dC5wdXNoKG5ldyBGbG9hdDMyQXJyYXkoW3RfICoqIDMsIDMgKiB0ICogdF8gKiogMiwgMyAqIHQgKiogMiAqIHRfLCB0ICoqIDNdKSk7CiAgfQogIHJldHVybiBsdXQ7Cn0KZnVuY3Rpb24gZ2V0Qihjb3VudCkgewogIHJldHVybiBiQ2FjaGVbY291bnRdIHx8PSBidWlsZEIoY291bnQpOwp9CmZ1bmN0aW9uIGNsZWFyUGF0dGVybkNhY2hlcygpIHsKICBiQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwp9CmNsYXNzIE1lc2hTaGFkaW5nIGV4dGVuZHMgQmFzZVNoYWRpbmcgewogIHN0YXRpYyBNSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCA9IDM7CiAgc3RhdGljIE1BWF9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5UID0gMjA7CiAgc3RhdGljIFRSSUFOR0xFX0RFTlNJVFkgPSAyMDsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHhyZWYsIHJlc291cmNlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKSB7CiAgICBzdXBlcigpOwogICAgaWYgKCEoc3RyZWFtIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNZXNoIGRhdGEgaXMgbm90IGEgc3RyZWFtIik7CiAgICB9CiAgICBjb25zdCBkaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICB0aGlzLnNoYWRpbmdUeXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICB0aGlzLmJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgICBjb25zdCBjcyA9IENvbG9yU3BhY2VVdGlscy5wYXJzZSh7CiAgICAgIGNzOiBkaWN0LmdldFJhdygiQ1MiKSB8fCBkaWN0LmdldFJhdygiQ29sb3JTcGFjZSIpLAogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgfSk7CiAgICB0aGlzLmJhY2tncm91bmQgPSBkaWN0LmhhcygiQmFja2dyb3VuZCIpID8gY3MuZ2V0UmdiKGRpY3QuZ2V0KCJCYWNrZ3JvdW5kIiksIDApIDogbnVsbDsKICAgIGNvbnN0IGZuT2JqID0gZGljdC5nZXRSYXcoIkZ1bmN0aW9uIik7CiAgICBjb25zdCBmbiA9IGZuT2JqID8gcGRmRnVuY3Rpb25GYWN0b3J5LmNyZWF0ZShmbk9iaiwgdHJ1ZSkgOiBudWxsOwogICAgdGhpcy5jb29yZHMgPSBbXTsKICAgIHRoaXMuY29sb3JzID0gW107CiAgICB0aGlzLmZpZ3VyZXMgPSBbXTsKICAgIGNvbnN0IGRlY29kZUNvbnRleHQgPSB7CiAgICAgIGJpdHNQZXJDb29yZGluYXRlOiBkaWN0LmdldCgiQml0c1BlckNvb3JkaW5hdGUiKSwKICAgICAgYml0c1BlckNvbXBvbmVudDogZGljdC5nZXQoIkJpdHNQZXJDb21wb25lbnQiKSwKICAgICAgYml0c1BlckZsYWc6IGRpY3QuZ2V0KCJCaXRzUGVyRmxhZyIpLAogICAgICBkZWNvZGU6IGRpY3QuZ2V0QXJyYXkoIkRlY29kZSIpLAogICAgICBjb2xvckZuOiBmbiwKICAgICAgY29sb3JTcGFjZTogY3MsCiAgICAgIG51bUNvbXBzOiBmbiA/IDEgOiBjcy5udW1Db21wcwogICAgfTsKICAgIGNvbnN0IHJlYWRlciA9IG5ldyBNZXNoU3RyZWFtUmVhZGVyKHN0cmVhbSwgZGVjb2RlQ29udGV4dCk7CiAgICBsZXQgcGF0Y2hNZXNoID0gZmFsc2U7CiAgICBzd2l0Y2ggKHRoaXMuc2hhZGluZ1R5cGUpIHsKICAgICAgY2FzZSBTaGFkaW5nVHlwZS5GUkVFX0ZPUk1fTUVTSDoKICAgICAgICB0aGlzLl9kZWNvZGVUeXBlNFNoYWRpbmcocmVhZGVyKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTaGFkaW5nVHlwZS5MQVRUSUNFX0ZPUk1fTUVTSDoKICAgICAgICBjb25zdCB2ZXJ0aWNlc1BlclJvdyA9IGRpY3QuZ2V0KCJWZXJ0aWNlc1BlclJvdyIpIHwgMDsKICAgICAgICBpZiAodmVydGljZXNQZXJSb3cgPCAyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgVmVydGljZXNQZXJSb3ciKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fZGVjb2RlVHlwZTVTaGFkaW5nKHJlYWRlciwgdmVydGljZXNQZXJSb3cpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNoYWRpbmdUeXBlLkNPT05TX1BBVENIX01FU0g6CiAgICAgICAgdGhpcy5fZGVjb2RlVHlwZTZTaGFkaW5nKHJlYWRlcik7CiAgICAgICAgcGF0Y2hNZXNoID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTaGFkaW5nVHlwZS5URU5TT1JfUEFUQ0hfTUVTSDoKICAgICAgICB0aGlzLl9kZWNvZGVUeXBlN1NoYWRpbmcocmVhZGVyKTsKICAgICAgICBwYXRjaE1lc2ggPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHVucmVhY2hhYmxlKCJVbnN1cHBvcnRlZCBtZXNoIHR5cGUuIik7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAocGF0Y2hNZXNoKSB7CiAgICAgIHRoaXMuX3VwZGF0ZUJvdW5kcygpOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLmZpZ3VyZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIHRoaXMuX2J1aWxkRmlndXJlRnJvbVBhdGNoKGkpOwogICAgICB9CiAgICB9CiAgICB0aGlzLl91cGRhdGVCb3VuZHMoKTsKICAgIHRoaXMuX3BhY2tEYXRhKCk7CiAgfQogIF9kZWNvZGVUeXBlNFNoYWRpbmcocmVhZGVyKSB7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkczsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3Qgb3BlcmF0b3JzID0gW107CiAgICBjb25zdCBwcyA9IFtdOwogICAgbGV0IHZlcnRpY2VzTGVmdCA9IDA7CiAgICB3aGlsZSAocmVhZGVyLmhhc0RhdGEpIHsKICAgICAgY29uc3QgZiA9IHJlYWRlci5yZWFkRmxhZygpOwogICAgICBjb25zdCBjb29yZCA9IHJlYWRlci5yZWFkQ29vcmRpbmF0ZSgpOwogICAgICBjb25zdCBjb2xvciA9IHJlYWRlci5yZWFkQ29tcG9uZW50cygpOwogICAgICBpZiAodmVydGljZXNMZWZ0ID09PSAwKSB7CiAgICAgICAgaWYgKCEoMCA8PSBmICYmIGYgPD0gMikpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5rbm93biB0eXBlNCBmbGFnIik7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoZikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB2ZXJ0aWNlc0xlZnQgPSAzOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcHMucHVzaChwcy5hdCgtMiksIHBzLmF0KC0xKSk7CiAgICAgICAgICAgIHZlcnRpY2VzTGVmdCA9IDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBwcy5wdXNoKHBzLmF0KC0zKSwgcHMuYXQoLTEpKTsKICAgICAgICAgICAgdmVydGljZXNMZWZ0ID0gMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIG9wZXJhdG9ycy5wdXNoKGYpOwogICAgICB9CiAgICAgIHBzLnB1c2goY29vcmRzLmxlbmd0aCk7CiAgICAgIGNvb3Jkcy5wdXNoKGNvb3JkKTsKICAgICAgY29sb3JzLnB1c2goY29sb3IpOwogICAgICB2ZXJ0aWNlc0xlZnQtLTsKICAgICAgcmVhZGVyLmFsaWduKCk7CiAgICB9CiAgICB0aGlzLmZpZ3VyZXMucHVzaCh7CiAgICAgIHR5cGU6ICJ0cmlhbmdsZXMiLAogICAgICBjb29yZHM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgY29sb3JzOiBuZXcgSW50MzJBcnJheShwcykKICAgIH0pOwogIH0KICBfZGVjb2RlVHlwZTVTaGFkaW5nKHJlYWRlciwgdmVydGljZXNQZXJSb3cpIHsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBwcyA9IFtdOwogICAgd2hpbGUgKHJlYWRlci5oYXNEYXRhKSB7CiAgICAgIGNvbnN0IGNvb3JkID0gcmVhZGVyLnJlYWRDb29yZGluYXRlKCk7CiAgICAgIGNvbnN0IGNvbG9yID0gcmVhZGVyLnJlYWRDb21wb25lbnRzKCk7CiAgICAgIHBzLnB1c2goY29vcmRzLmxlbmd0aCk7CiAgICAgIGNvb3Jkcy5wdXNoKGNvb3JkKTsKICAgICAgY29sb3JzLnB1c2goY29sb3IpOwogICAgfQogICAgdGhpcy5maWd1cmVzLnB1c2goewogICAgICB0eXBlOiAibGF0dGljZSIsCiAgICAgIGNvb3JkczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgdmVydGljZXNQZXJSb3cKICAgIH0pOwogIH0KICBfZGVjb2RlVHlwZTZTaGFkaW5nKHJlYWRlcikgewogICAgY29uc3QgY29vcmRzID0gdGhpcy5jb29yZHM7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IHBzID0gbmV3IEludDMyQXJyYXkoMTYpOwogICAgY29uc3QgY3MgPSBuZXcgSW50MzJBcnJheSg0KTsKICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICBjb25zdCBmID0gcmVhZGVyLnJlYWRGbGFnKCk7CiAgICAgIGlmICghKDAgPD0gZiAmJiBmIDw9IDMpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbmtub3duIHR5cGU2IGZsYWciKTsKICAgICAgfQogICAgICBjb25zdCBwaSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGYgIT09IDAgPyA4IDogMTI7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29vcmRzLnB1c2gocmVhZGVyLnJlYWRDb29yZGluYXRlKCkpOwogICAgICB9CiAgICAgIGNvbnN0IGNpID0gY29sb3JzLmxlbmd0aDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZiAhPT0gMCA/IDIgOiA0OyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbG9ycy5wdXNoKHJlYWRlci5yZWFkQ29tcG9uZW50cygpKTsKICAgICAgfQogICAgICBsZXQgdG1wMSwgdG1wMiwgdG1wMywgdG1wNDsKICAgICAgc3dpdGNoIChmKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcHNbMTJdID0gcGkgKyAzOwogICAgICAgICAgcHNbMTNdID0gcGkgKyA0OwogICAgICAgICAgcHNbMTRdID0gcGkgKyA1OwogICAgICAgICAgcHNbMTVdID0gcGkgKyA2OwogICAgICAgICAgcHNbOF0gPSBwaSArIDI7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1s0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzddID0gcGkgKyA4OwogICAgICAgICAgcHNbMF0gPSBwaTsKICAgICAgICAgIHBzWzFdID0gcGkgKyAxMTsKICAgICAgICAgIHBzWzJdID0gcGkgKyAxMDsKICAgICAgICAgIHBzWzNdID0gcGkgKyA5OwogICAgICAgICAgY3NbMl0gPSBjaSArIDE7CiAgICAgICAgICBjc1szXSA9IGNpICsgMjsKICAgICAgICAgIGNzWzBdID0gY2k7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHRtcDEgPSBwc1sxMl07CiAgICAgICAgICB0bXAyID0gcHNbMTNdOwogICAgICAgICAgdG1wMyA9IHBzWzE0XTsKICAgICAgICAgIHRtcDQgPSBwc1sxNV07CiAgICAgICAgICBwc1sxMl0gPSB0bXA0OwogICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgcHNbOF0gPSB0bXAzOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSB0bXAyOwogICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICBwc1swXSA9IHRtcDE7CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICB0bXAxID0gY3NbMl07CiAgICAgICAgICB0bXAyID0gY3NbM107CiAgICAgICAgICBjc1syXSA9IHRtcDI7CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgY3NbMV0gPSBjaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICB0bXAxID0gcHNbMTVdOwogICAgICAgICAgdG1wMiA9IHBzWzExXTsKICAgICAgICAgIHBzWzEyXSA9IHBzWzNdOwogICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgcHNbOF0gPSBwc1s3XTsKICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzRdID0gdG1wMjsKICAgICAgICAgIHBzWzddID0gcGkgKyA0OwogICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgcHNbMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgdG1wMSA9IGNzWzNdOwogICAgICAgICAgY3NbMl0gPSBjc1sxXTsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IHRtcDE7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHBzWzEyXSA9IHBzWzBdOwogICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgcHNbOF0gPSBwc1sxXTsKICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzRdID0gcHNbMl07CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gcHNbM107CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICBjc1syXSA9IGNzWzBdOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gY3NbMV07CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHBzWzVdID0gY29vcmRzLmxlbmd0aDsKICAgICAgY29vcmRzLnB1c2goWygtNCAqIGNvb3Jkc1twc1swXV1bMF0gLSBjb29yZHNbcHNbMTVdXVswXSArIDYgKiAoY29vcmRzW3BzWzRdXVswXSArIGNvb3Jkc1twc1sxXV1bMF0pIC0gMiAqIChjb29yZHNbcHNbMTJdXVswXSArIGNvb3Jkc1twc1szXV1bMF0pICsgMyAqIChjb29yZHNbcHNbMTNdXVswXSArIGNvb3Jkc1twc1s3XV1bMF0pKSAvIDksICgtNCAqIGNvb3Jkc1twc1swXV1bMV0gLSBjb29yZHNbcHNbMTVdXVsxXSArIDYgKiAoY29vcmRzW3BzWzRdXVsxXSArIGNvb3Jkc1twc1sxXV1bMV0pIC0gMiAqIChjb29yZHNbcHNbMTJdXVsxXSArIGNvb3Jkc1twc1szXV1bMV0pICsgMyAqIChjb29yZHNbcHNbMTNdXVsxXSArIGNvb3Jkc1twc1s3XV1bMV0pKSAvIDldKTsKICAgICAgcHNbNl0gPSBjb29yZHMubGVuZ3RoOwogICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzNdXVswXSAtIGNvb3Jkc1twc1sxMl1dWzBdICsgNiAqIChjb29yZHNbcHNbMl1dWzBdICsgY29vcmRzW3BzWzddXVswXSkgLSAyICogKGNvb3Jkc1twc1swXV1bMF0gKyBjb29yZHNbcHNbMTVdXVswXSkgKyAzICogKGNvb3Jkc1twc1s0XV1bMF0gKyBjb29yZHNbcHNbMTRdXVswXSkpIC8gOSwgKC00ICogY29vcmRzW3BzWzNdXVsxXSAtIGNvb3Jkc1twc1sxMl1dWzFdICsgNiAqIChjb29yZHNbcHNbMl1dWzFdICsgY29vcmRzW3BzWzddXVsxXSkgLSAyICogKGNvb3Jkc1twc1swXV1bMV0gKyBjb29yZHNbcHNbMTVdXVsxXSkgKyAzICogKGNvb3Jkc1twc1s0XV1bMV0gKyBjb29yZHNbcHNbMTRdXVsxXSkpIC8gOV0pOwogICAgICBwc1s5XSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgIGNvb3Jkcy5wdXNoKFsoLTQgKiBjb29yZHNbcHNbMTJdXVswXSAtIGNvb3Jkc1twc1szXV1bMF0gKyA2ICogKGNvb3Jkc1twc1s4XV1bMF0gKyBjb29yZHNbcHNbMTNdXVswXSkgLSAyICogKGNvb3Jkc1twc1swXV1bMF0gKyBjb29yZHNbcHNbMTVdXVswXSkgKyAzICogKGNvb3Jkc1twc1sxMV1dWzBdICsgY29vcmRzW3BzWzFdXVswXSkpIC8gOSwgKC00ICogY29vcmRzW3BzWzEyXV1bMV0gLSBjb29yZHNbcHNbM11dWzFdICsgNiAqIChjb29yZHNbcHNbOF1dWzFdICsgY29vcmRzW3BzWzEzXV1bMV0pIC0gMiAqIChjb29yZHNbcHNbMF1dWzFdICsgY29vcmRzW3BzWzE1XV1bMV0pICsgMyAqIChjb29yZHNbcHNbMTFdXVsxXSArIGNvb3Jkc1twc1sxXV1bMV0pKSAvIDldKTsKICAgICAgcHNbMTBdID0gY29vcmRzLmxlbmd0aDsKICAgICAgY29vcmRzLnB1c2goWygtNCAqIGNvb3Jkc1twc1sxNV1dWzBdIC0gY29vcmRzW3BzWzBdXVswXSArIDYgKiAoY29vcmRzW3BzWzExXV1bMF0gKyBjb29yZHNbcHNbMTRdXVswXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzBdICsgY29vcmRzW3BzWzNdXVswXSkgKyAzICogKGNvb3Jkc1twc1syXV1bMF0gKyBjb29yZHNbcHNbOF1dWzBdKSkgLyA5LCAoLTQgKiBjb29yZHNbcHNbMTVdXVsxXSAtIGNvb3Jkc1twc1swXV1bMV0gKyA2ICogKGNvb3Jkc1twc1sxMV1dWzFdICsgY29vcmRzW3BzWzE0XV1bMV0pIC0gMiAqIChjb29yZHNbcHNbMTJdXVsxXSArIGNvb3Jkc1twc1szXV1bMV0pICsgMyAqIChjb29yZHNbcHNbMl1dWzFdICsgY29vcmRzW3BzWzhdXVsxXSkpIC8gOV0pOwogICAgICB0aGlzLmZpZ3VyZXMucHVzaCh7CiAgICAgICAgdHlwZTogInBhdGNoIiwKICAgICAgICBjb29yZHM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KGNzKQogICAgICB9KTsKICAgIH0KICB9CiAgX2RlY29kZVR5cGU3U2hhZGluZyhyZWFkZXIpIHsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBwcyA9IG5ldyBJbnQzMkFycmF5KDE2KTsKICAgIGNvbnN0IGNzID0gbmV3IEludDMyQXJyYXkoNCk7CiAgICB3aGlsZSAocmVhZGVyLmhhc0RhdGEpIHsKICAgICAgY29uc3QgZiA9IHJlYWRlci5yZWFkRmxhZygpOwogICAgICBpZiAoISgwIDw9IGYgJiYgZiA8PSAzKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5rbm93biB0eXBlNyBmbGFnIik7CiAgICAgIH0KICAgICAgY29uc3QgcGkgPSBjb29yZHMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmICE9PSAwID8gMTIgOiAxNjsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb29yZHMucHVzaChyZWFkZXIucmVhZENvb3JkaW5hdGUoKSk7CiAgICAgIH0KICAgICAgY29uc3QgY2kgPSBjb2xvcnMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmICE9PSAwID8gMiA6IDQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29sb3JzLnB1c2gocmVhZGVyLnJlYWRDb21wb25lbnRzKCkpOwogICAgICB9CiAgICAgIGxldCB0bXAxLCB0bXAyLCB0bXAzLCB0bXA0OwogICAgICBzd2l0Y2ggKGYpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBwc1sxMl0gPSBwaSArIDM7CiAgICAgICAgICBwc1sxM10gPSBwaSArIDQ7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDU7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDY7CiAgICAgICAgICBwc1s4XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzldID0gcGkgKyAxMzsKICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTQ7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1s0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzVdID0gcGkgKyAxMjsKICAgICAgICAgIHBzWzZdID0gcGkgKyAxNTsKICAgICAgICAgIHBzWzddID0gcGkgKyA4OwogICAgICAgICAgcHNbMF0gPSBwaTsKICAgICAgICAgIHBzWzFdID0gcGkgKyAxMTsKICAgICAgICAgIHBzWzJdID0gcGkgKyAxMDsKICAgICAgICAgIHBzWzNdID0gcGkgKyA5OwogICAgICAgICAgY3NbMl0gPSBjaSArIDE7CiAgICAgICAgICBjc1szXSA9IGNpICsgMjsKICAgICAgICAgIGNzWzBdID0gY2k7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHRtcDEgPSBwc1sxMl07CiAgICAgICAgICB0bXAyID0gcHNbMTNdOwogICAgICAgICAgdG1wMyA9IHBzWzE0XTsKICAgICAgICAgIHRtcDQgPSBwc1sxNV07CiAgICAgICAgICBwc1sxMl0gPSB0bXA0OwogICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgcHNbOF0gPSB0bXAzOwogICAgICAgICAgcHNbOV0gPSBwaSArIDk7CiAgICAgICAgICBwc1sxMF0gPSBwaSArIDEwOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSB0bXAyOwogICAgICAgICAgcHNbNV0gPSBwaSArIDg7CiAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gdG1wMTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIHRtcDEgPSBjc1syXTsKICAgICAgICAgIHRtcDIgPSBjc1szXTsKICAgICAgICAgIGNzWzJdID0gdG1wMjsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IHRtcDE7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHRtcDEgPSBwc1sxNV07CiAgICAgICAgICB0bXAyID0gcHNbMTFdOwogICAgICAgICAgcHNbMTJdID0gcHNbM107CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHBzWzddOwogICAgICAgICAgcHNbOV0gPSBwaSArIDk7CiAgICAgICAgICBwc1sxMF0gPSBwaSArIDEwOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSB0bXAyOwogICAgICAgICAgcHNbNV0gPSBwaSArIDg7CiAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gdG1wMTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIHRtcDEgPSBjc1szXTsKICAgICAgICAgIGNzWzJdID0gY3NbMV07CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgY3NbMV0gPSBjaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBwc1sxMl0gPSBwc1swXTsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzhdID0gcHNbMV07CiAgICAgICAgICBwc1s5XSA9IHBpICsgOTsKICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTA7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHBzWzJdOwogICAgICAgICAgcHNbNV0gPSBwaSArIDg7CiAgICAgICAgICBwc1s2XSA9IHBpICsgMTE7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gcHNbM107CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICBjc1syXSA9IGNzWzBdOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gY3NbMV07CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMuZmlndXJlcy5wdXNoKHsKICAgICAgICB0eXBlOiAicGF0Y2giLAogICAgICAgIGNvb3JkczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICAgIGNvbG9yczogbmV3IEludDMyQXJyYXkoY3MpCiAgICAgIH0pOwogICAgfQogIH0KICBfYnVpbGRGaWd1cmVGcm9tUGF0Y2goaW5kZXgpIHsKICAgIGNvbnN0IGZpZ3VyZSA9IHRoaXMuZmlndXJlc1tpbmRleF07CiAgICBhc3NlcnQoZmlndXJlLnR5cGUgPT09ICJwYXRjaCIsICJVbmV4cGVjdGVkIHBhdGNoIG1lc2ggZmlndXJlIik7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkcywKICAgICAgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBwaSA9IGZpZ3VyZS5jb29yZHM7CiAgICBjb25zdCBjaSA9IGZpZ3VyZS5jb2xvcnM7CiAgICBjb25zdCBmaWd1cmVNaW5YID0gTWF0aC5taW4oY29vcmRzW3BpWzBdXVswXSwgY29vcmRzW3BpWzNdXVswXSwgY29vcmRzW3BpWzEyXV1bMF0sIGNvb3Jkc1twaVsxNV1dWzBdKTsKICAgIGNvbnN0IGZpZ3VyZU1pblkgPSBNYXRoLm1pbihjb29yZHNbcGlbMF1dWzFdLCBjb29yZHNbcGlbM11dWzFdLCBjb29yZHNbcGlbMTJdXVsxXSwgY29vcmRzW3BpWzE1XV1bMV0pOwogICAgY29uc3QgZmlndXJlTWF4WCA9IE1hdGgubWF4KGNvb3Jkc1twaVswXV1bMF0sIGNvb3Jkc1twaVszXV1bMF0sIGNvb3Jkc1twaVsxMl1dWzBdLCBjb29yZHNbcGlbMTVdXVswXSk7CiAgICBjb25zdCBmaWd1cmVNYXhZID0gTWF0aC5tYXgoY29vcmRzW3BpWzBdXVsxXSwgY29vcmRzW3BpWzNdXVsxXSwgY29vcmRzW3BpWzEyXV1bMV0sIGNvb3Jkc1twaVsxNV1dWzFdKTsKICAgIGxldCBzcGxpdFhCeSA9IE1hdGguY2VpbCgoZmlndXJlTWF4WCAtIGZpZ3VyZU1pblgpICogTWVzaFNoYWRpbmcuVFJJQU5HTEVfREVOU0lUWSAvICh0aGlzLmJvdW5kc1syXSAtIHRoaXMuYm91bmRzWzBdKSk7CiAgICBzcGxpdFhCeSA9IE1hdGhDbGFtcChzcGxpdFhCeSwgTWVzaFNoYWRpbmcuTUlOX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQsIE1lc2hTaGFkaW5nLk1BWF9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5UKTsKICAgIGxldCBzcGxpdFlCeSA9IE1hdGguY2VpbCgoZmlndXJlTWF4WSAtIGZpZ3VyZU1pblkpICogTWVzaFNoYWRpbmcuVFJJQU5HTEVfREVOU0lUWSAvICh0aGlzLmJvdW5kc1szXSAtIHRoaXMuYm91bmRzWzFdKSk7CiAgICBzcGxpdFlCeSA9IE1hdGhDbGFtcChzcGxpdFlCeSwgTWVzaFNoYWRpbmcuTUlOX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQsIE1lc2hTaGFkaW5nLk1BWF9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5UKTsKICAgIGNvbnN0IHZlcnRpY2VzUGVyUm93ID0gc3BsaXRYQnkgKyAxOwogICAgY29uc3QgZmlndXJlQ29vcmRzID0gbmV3IEludDMyQXJyYXkoKHNwbGl0WUJ5ICsgMSkgKiB2ZXJ0aWNlc1BlclJvdyk7CiAgICBjb25zdCBmaWd1cmVDb2xvcnMgPSBuZXcgSW50MzJBcnJheSgoc3BsaXRZQnkgKyAxKSAqIHZlcnRpY2VzUGVyUm93KTsKICAgIGxldCBrID0gMDsKICAgIGNvbnN0IGNsID0gbmV3IFVpbnQ4QXJyYXkoMyksCiAgICAgIGNyID0gbmV3IFVpbnQ4QXJyYXkoMyk7CiAgICBjb25zdCBjMCA9IGNvbG9yc1tjaVswXV0sCiAgICAgIGMxID0gY29sb3JzW2NpWzFdXSwKICAgICAgYzIgPSBjb2xvcnNbY2lbMl1dLAogICAgICBjMyA9IGNvbG9yc1tjaVszXV07CiAgICBjb25zdCBiUm93ID0gZ2V0QihzcGxpdFlCeSksCiAgICAgIGJDb2wgPSBnZXRCKHNwbGl0WEJ5KTsKICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8PSBzcGxpdFlCeTsgcm93KyspIHsKICAgICAgY2xbMF0gPSAoYzBbMF0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzJbMF0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBjbFsxXSA9IChjMFsxXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjMlsxXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNsWzJdID0gKGMwWzJdICogKHNwbGl0WUJ5IC0gcm93KSArIGMyWzJdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgY3JbMF0gPSAoYzFbMF0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzNbMF0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBjclsxXSA9IChjMVsxXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjM1sxXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNyWzJdID0gKGMxWzJdICogKHNwbGl0WUJ5IC0gcm93KSArIGMzWzJdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDw9IHNwbGl0WEJ5OyBjb2wrKywgaysrKSB7CiAgICAgICAgaWYgKChyb3cgPT09IDAgfHwgcm93ID09PSBzcGxpdFlCeSkgJiYgKGNvbCA9PT0gMCB8fCBjb2wgPT09IHNwbGl0WEJ5KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCB4ID0gMCwKICAgICAgICAgIHkgPSAwOwogICAgICAgIGxldCBxID0gMDsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAzOyBpKyspIHsKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IDM7IGorKywgcSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG0gPSBiUm93W3Jvd11baV0gKiBiQ29sW2NvbF1bal07CiAgICAgICAgICAgIHggKz0gY29vcmRzW3BpW3FdXVswXSAqIG07CiAgICAgICAgICAgIHkgKz0gY29vcmRzW3BpW3FdXVsxXSAqIG07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpZ3VyZUNvb3Jkc1trXSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgICAgY29vcmRzLnB1c2goW3gsIHldKTsKICAgICAgICBmaWd1cmVDb2xvcnNba10gPSBjb2xvcnMubGVuZ3RoOwogICAgICAgIGNvbnN0IG5ld0NvbG9yID0gbmV3IFVpbnQ4QXJyYXkoMyk7CiAgICAgICAgbmV3Q29sb3JbMF0gPSAoY2xbMF0gKiAoc3BsaXRYQnkgLSBjb2wpICsgY3JbMF0gKiBjb2wpIC8gc3BsaXRYQnkgfCAwOwogICAgICAgIG5ld0NvbG9yWzFdID0gKGNsWzFdICogKHNwbGl0WEJ5IC0gY29sKSArIGNyWzFdICogY29sKSAvIHNwbGl0WEJ5IHwgMDsKICAgICAgICBuZXdDb2xvclsyXSA9IChjbFsyXSAqIChzcGxpdFhCeSAtIGNvbCkgKyBjclsyXSAqIGNvbCkgLyBzcGxpdFhCeSB8IDA7CiAgICAgICAgY29sb3JzLnB1c2gobmV3Q29sb3IpOwogICAgICB9CiAgICB9CiAgICBmaWd1cmVDb29yZHNbMF0gPSBwaVswXTsKICAgIGZpZ3VyZUNvbG9yc1swXSA9IGNpWzBdOwogICAgZmlndXJlQ29vcmRzW3NwbGl0WEJ5XSA9IHBpWzNdOwogICAgZmlndXJlQ29sb3JzW3NwbGl0WEJ5XSA9IGNpWzFdOwogICAgZmlndXJlQ29vcmRzW3ZlcnRpY2VzUGVyUm93ICogc3BsaXRZQnldID0gcGlbMTJdOwogICAgZmlndXJlQ29sb3JzW3ZlcnRpY2VzUGVyUm93ICogc3BsaXRZQnldID0gY2lbMl07CiAgICBmaWd1cmVDb29yZHNbdmVydGljZXNQZXJSb3cgKiBzcGxpdFlCeSArIHNwbGl0WEJ5XSA9IHBpWzE1XTsKICAgIGZpZ3VyZUNvbG9yc1t2ZXJ0aWNlc1BlclJvdyAqIHNwbGl0WUJ5ICsgc3BsaXRYQnldID0gY2lbM107CiAgICB0aGlzLmZpZ3VyZXNbaW5kZXhdID0gewogICAgICB0eXBlOiAibGF0dGljZSIsCiAgICAgIGNvb3JkczogZmlndXJlQ29vcmRzLAogICAgICBjb2xvcnM6IGZpZ3VyZUNvbG9ycywKICAgICAgdmVydGljZXNQZXJSb3cKICAgIH07CiAgfQogIF91cGRhdGVCb3VuZHMoKSB7CiAgICBsZXQgbWluWCA9IHRoaXMuY29vcmRzWzBdWzBdLAogICAgICBtaW5ZID0gdGhpcy5jb29yZHNbMF1bMV0sCiAgICAgIG1heFggPSBtaW5YLAogICAgICBtYXhZID0gbWluWTsKICAgIGZvciAobGV0IGkgPSAxLCBpaSA9IHRoaXMuY29vcmRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgeCA9IHRoaXMuY29vcmRzW2ldWzBdLAogICAgICAgIHkgPSB0aGlzLmNvb3Jkc1tpXVsxXTsKICAgICAgbWluWCA9IG1pblggPiB4ID8geCA6IG1pblg7CiAgICAgIG1pblkgPSBtaW5ZID4geSA/IHkgOiBtaW5ZOwogICAgICBtYXhYID0gbWF4WCA8IHggPyB4IDogbWF4WDsKICAgICAgbWF4WSA9IG1heFkgPCB5ID8geSA6IG1heFk7CiAgICB9CiAgICB0aGlzLmJvdW5kcyA9IFttaW5YLCBtaW5ZLCBtYXhYLCBtYXhZXTsKICB9CiAgX3BhY2tEYXRhKCkgewogICAgbGV0IGksIGlpLCBqLCBqajsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29vcmRzUGFja2VkID0gbmV3IEZsb2F0MzJBcnJheShjb29yZHMubGVuZ3RoICogMik7CiAgICBmb3IgKGkgPSAwLCBqID0gMCwgaWkgPSBjb29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCB4eSA9IGNvb3Jkc1tpXTsKICAgICAgY29vcmRzUGFja2VkW2orK10gPSB4eVswXTsKICAgICAgY29vcmRzUGFja2VkW2orK10gPSB4eVsxXTsKICAgIH0KICAgIHRoaXMuY29vcmRzID0gY29vcmRzUGFja2VkOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBjb2xvcnNQYWNrZWQgPSBuZXcgVWludDhBcnJheShjb2xvcnMubGVuZ3RoICogMyk7CiAgICBmb3IgKGkgPSAwLCBqID0gMCwgaWkgPSBjb2xvcnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBjID0gY29sb3JzW2ldOwogICAgICBjb2xvcnNQYWNrZWRbaisrXSA9IGNbMF07CiAgICAgIGNvbG9yc1BhY2tlZFtqKytdID0gY1sxXTsKICAgICAgY29sb3JzUGFja2VkW2orK10gPSBjWzJdOwogICAgfQogICAgdGhpcy5jb2xvcnMgPSBjb2xvcnNQYWNrZWQ7CiAgICBjb25zdCBmaWd1cmVzID0gdGhpcy5maWd1cmVzOwogICAgZm9yIChpID0gMCwgaWkgPSBmaWd1cmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgZmlndXJlID0gZmlndXJlc1tpXSwKICAgICAgICBwcyA9IGZpZ3VyZS5jb29yZHMsCiAgICAgICAgY3MgPSBmaWd1cmUuY29sb3JzOwogICAgICBmb3IgKGogPSAwLCBqaiA9IHBzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICBwc1tqXSAqPSAyOwogICAgICAgIGNzW2pdICo9IDM7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0SVIoKSB7CiAgICBjb25zdCB7CiAgICAgIGJvdW5kcwogICAgfSA9IHRoaXM7CiAgICBpZiAoYm91bmRzWzJdIC0gYm91bmRzWzBdID09PSAwIHx8IGJvdW5kc1szXSAtIGJvdW5kc1sxXSA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgTWVzaFNoYWRpbmcgYm91bmRzOiBbJHtib3VuZHN9XS5gKTsKICAgIH0KICAgIHJldHVybiBbIk1lc2giLCB0aGlzLnNoYWRpbmdUeXBlLCB0aGlzLmNvb3JkcywgdGhpcy5jb2xvcnMsIHRoaXMuZmlndXJlcywgYm91bmRzLCB0aGlzLmJib3gsIHRoaXMuYmFja2dyb3VuZF07CiAgfQp9CmNsYXNzIER1bW15U2hhZGluZyBleHRlbmRzIEJhc2VTaGFkaW5nIHsKICBnZXRJUigpIHsKICAgIHJldHVybiBbIkR1bW15Il07CiAgfQp9CmZ1bmN0aW9uIGdldFRpbGluZ1BhdHRlcm5JUihvcGVyYXRvckxpc3QsIGRpY3QsIGNvbG9yKSB7CiAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBJREVOVElUWV9NQVRSSVgpOwogIGNvbnN0IGJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgaWYgKCFiYm94IHx8IGJib3hbMl0gLSBiYm94WzBdID09PSAwIHx8IGJib3hbM10gLSBiYm94WzFdID09PSAwKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZ2V0VGlsaW5nUGF0dGVybklSIC9CQm94IGFycmF5LmApOwogIH0KICBjb25zdCB4c3RlcCA9IGRpY3QuZ2V0KCJYU3RlcCIpOwogIGlmICh0eXBlb2YgeHN0ZXAgIT09ICJudW1iZXIiKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZ2V0VGlsaW5nUGF0dGVybklSIC9YU3RlcCB2YWx1ZS5gKTsKICB9CiAgY29uc3QgeXN0ZXAgPSBkaWN0LmdldCgiWVN0ZXAiKTsKICBpZiAodHlwZW9mIHlzdGVwICE9PSAibnVtYmVyIikgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGdldFRpbGluZ1BhdHRlcm5JUiAvWVN0ZXAgdmFsdWUuYCk7CiAgfQogIGNvbnN0IHBhaW50VHlwZSA9IGRpY3QuZ2V0KCJQYWludFR5cGUiKTsKICBpZiAoIU51bWJlci5pc0ludGVnZXIocGFpbnRUeXBlKSkgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGdldFRpbGluZ1BhdHRlcm5JUiAvUGFpbnRUeXBlIHZhbHVlLmApOwogIH0KICBjb25zdCB0aWxpbmdUeXBlID0gZGljdC5nZXQoIlRpbGluZ1R5cGUiKTsKICBpZiAoIU51bWJlci5pc0ludGVnZXIodGlsaW5nVHlwZSkpIHsKICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBnZXRUaWxpbmdQYXR0ZXJuSVIgL1RpbGluZ1R5cGUgdmFsdWUuYCk7CiAgfQogIHJldHVybiBbIlRpbGluZ1BhdHRlcm4iLCBjb2xvciwgb3BlcmF0b3JMaXN0LCBtYXRyaXgsIGJib3gsIHhzdGVwLCB5c3RlcCwgcGFpbnRUeXBlLCB0aWxpbmdUeXBlXTsKfQoKOy8vIC4vc3JjL2NvcmUvY2FsaWJyaV9mYWN0b3JzLmpzCmNvbnN0IENhbGlicmlCb2xkRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDAuOTc4MDEsIDAuOTI0ODIsIDAuODk1NTIsIDAuOTExMzMsIDAuODE5ODgsIDAuOTc1NjYsIDAuOTgxNTIsIDAuOTM1NDgsIDAuOTM1NDgsIDEuMjc5OCwgMC44NTI4NCwgMC45Mjc5NCwgMSwgMC45NjEzNCwgMS41NDY1NywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC44Mjg0NSwgMC44Mjg0NSwgMC44NTI4NCwgMC44NTI4NCwgMC44NTI4NCwgMC43NTg1OSwgMC45MjEzOCwgMC44MzkwOCwgMC43NzYyLCAwLjczMjkzLCAwLjg3Mjg5LCAwLjczMTMzLCAwLjc1MTQsIDAuODE5MjEsIDAuODczNTYsIDAuOTU5NTgsIDAuNTk1MjYsIDAuNzU3MjcsIDAuNjkyMjUsIDEuMDQ5MjQsIDAuOTEyMSwgMC44Njk0MywgMC43OTc5NSwgMC44ODE5OCwgMC43Nzk1OCwgMC43MDg2NCwgMC44MTA1NSwgMC45MDM5OSwgMC44ODY1MywgMC45NjAxNywgMC44MjU3NywgMC43Nzg5MiwgMC43ODI1NywgMC45NzUwNywgMS41NDY1NywgMC45NzUwNywgMC44NTI4NCwgMC44OTU1MiwgMC45MDE3NiwgMC44ODc2MiwgMC44Nzg1LCAwLjc1MjQxLCAwLjg3ODUsIDAuOTA1MTgsIDAuOTUwMTUsIDAuNzc2MTgsIDAuODc4NSwgMC44ODQwMSwgMC45MTkxNiwgMC44NjMwNCwgMC44ODQwMSwgMC45MTQ4OCwgMC44Nzg1LCAwLjg4MDEsIDAuODc4NSwgMC44Nzg1LCAwLjkxMzQzLCAwLjcxNzMsIDEuMDQxMDYsIDAuODc4NSwgMC44NTA3NSwgMC45NTc5NCwgMC44MjYxNiwgMC44NTE2MiwgMC43OTQ5MiwgMC44ODMzMSwgMS42OTgwOCwgMC44ODMzMSwgMC44NTI4NCwgMC45NzgwMSwgMC44OTU1MiwgMC45MTEzMywgMC44OTU1MiwgMC45MTEzMywgMS43ODAxLCAwLjg5NTUyLCAxLjI0NDg3LCAxLjEzMjU0LCAxLjEyNDAxLCAwLjk2ODM5LCAwLjg1Mjg0LCAwLjY4Nzg3LCAwLjcwNjQ1LCAwLjg1NTkyLCAwLjkwNzQ3LCAxLjAxNDY2LCAxLjAwODgsIDAuOTAzMjMsIDEsIDEuMDc0NjMsIDEsIDAuOTEwNTYsIDAuNzU4MDYsIDEuMTkxMTgsIDAuOTY4MzksIDAuNzg4NjQsIDAuODI4NDUsIDAuODQxMzMsIDAuNzU4NTksIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuNzc1MzksIDAuNzMyOTMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuOTU5NTgsIDAuOTU5NTgsIDAuOTU5NTgsIDAuOTU5NTgsIDAuODg1MDYsIDAuOTEyMSwgMC44Njk0MywgMC44Njk0MywgMC44Njk0MywgMC44Njk0MywgMC44Njk0MywgMC44NTI4NCwgMC44NzUwOCwgMC45MDM5OSwgMC45MDM5OSwgMC45MDM5OSwgMC45MDM5OSwgMC43Nzg5MiwgMC43OTc5NSwgMC45MDgwNywgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44ODc2MiwgMC44NzE1LCAwLjc1MjQxLCAwLjkwNTE4LCAwLjkwNTE4LCAwLjkwNTE4LCAwLjkwNTE4LCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg3ODUsIDAuODc4NSwgMC44ODAxLCAwLjg4MDEsIDAuODgwMSwgMC44ODAxLCAwLjg4MDEsIDAuOTA3NDcsIDAuODkwNDksIDAuODc4NSwgMC44Nzg1LCAwLjg3ODUsIDAuODc4NSwgMC44NTE2MiwgMC44Nzg1LCAwLjg1MTYyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjczMjkzLCAwLjc1MjQxLCAwLjczMjkzLCAwLjc1MjQxLCAwLjczMjkzLCAwLjc1MjQxLCAwLjczMjkzLCAwLjc1MjQxLCAwLjg3Mjg5LCAwLjgzMDE2LCAwLjg4NTA2LCAwLjkzMTI1LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjczMTMzLCAwLjkwNTE4LCAwLjgxOTIxLCAwLjc3NjE4LCAwLjgxOTIxLCAwLjc3NjE4LCAwLjgxOTIxLCAwLjc3NjE4LCAxLCAxLCAwLjg3MzU2LCAwLjg3ODUsIDAuOTEwNzUsIDAuODk2MDgsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuNzYyMjksIDAuOTAxNjcsIDAuNTk1MjYsIDAuOTE5MTYsIDEsIDEsIDAuODYzMDQsIDAuNjkyMjUsIDAuODg0MDEsIDEsIDEsIDAuNzA0MjQsIDAuNzk0NjgsIDAuOTE5MjYsIDAuODgxNzUsIDAuNzA4MjMsIDAuOTQ5MDMsIDAuOTEyMSwgMC44Nzg1LCAxLCAxLCAwLjkxMjEsIDAuODc4NSwgMC44NzgwMiwgMC44ODY1NiwgMC44Nzg1LCAwLjg2OTQzLCAwLjg4MDEsIDAuODY5NDMsIDAuODgwMSwgMC44Njk0MywgMC44ODAxLCAwLjg3NDAyLCAwLjg5MjkxLCAwLjc3OTU4LCAwLjkxMzQzLCAxLCAxLCAwLjc3OTU4LCAwLjkxMzQzLCAwLjcwODY0LCAwLjcxNzMsIDAuNzA4NjQsIDAuNzE3MywgMC43MDg2NCwgMC43MTczLCAwLjcwODY0LCAwLjcxNzMsIDEsIDEsIDAuODEwNTUsIDAuNzU4NDEsIDAuODEwNTUsIDEuMDY0NTIsIDAuOTAzOTksIDAuODc4NSwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTAzOTksIDAuODc4NSwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTYwMTcsIDAuOTU3OTQsIDAuNzc4OTIsIDAuODUxNjIsIDAuNzc4OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuOTI5NywgMC41Njg5MiwgMC44MzkwOCwgMC44ODc2MiwgMC43NzUzOSwgMC44NzE1LCAwLjg3NTA4LCAwLjg5MDQ5LCAxLCAxLCAwLjgxMDU1LCAxLjA0MTA2LCAxLjIwNTI4LCAxLjIwNTI4LCAxLCAxLjE1NTQzLCAwLjcwNjc0LCAwLjk4Mzg3LCAwLjk0NzIxLCAxLjMzNDMxLCAxLjQ1ODk0LCAwLjk1MTYxLCAxLjA2MzAzLCAwLjgzOTA4LCAwLjgwMzUyLCAwLjU3MTg0LCAwLjY5NjUsIDAuNTYyODksIDAuODIwMDEsIDAuNTYwMjksIDAuODEyMzUsIDEuMDI5ODgsIDAuODM5MDgsIDAuNzc2MiwgMC42ODE1NiwgMC44MDM2NywgMC43MzEzMywgMC43ODI1NywgMC44NzM1NiwgMC44Njk0MywgMC45NTk1OCwgMC43NTcyNywgMC44OTAxOSwgMS4wNDkyNCwgMC45MTIxLCAwLjc2NDgsIDAuODY5NDMsIDAuODczNTYsIDAuNzk3OTUsIDAuNzgyNzUsIDAuODEwNTUsIDAuNzc4OTIsIDAuOTc2MiwgMC44MjU3NywgMC45OTgxOSwgMC44NDg5NiwgMC45NTk1OCwgMC43Nzg5MiwgMC45NjEwOCwgMS4wMTQwNywgMC44OTA0OSwgMS4wMjk4OCwgMC45NDIxMSwgMC45NjEwOCwgMC44OTM2LCAwLjg0MDIxLCAwLjg3ODQyLCAwLjk2Mzk5LCAwLjc5MTA5LCAwLjg5MDQ5LCAxLjAwODEzLCAxLjAyOTg4LCAwLjg2MDc3LCAwLjg3NDQ1LCAwLjkyMDk5LCAwLjg0NzIzLCAwLjg2NTEzLCAwLjg4MDEsIDAuNzU2MzgsIDAuODU3MTQsIDAuNzgyMTYsIDAuNzk1ODYsIDAuODc5NjUsIDAuOTQyMTEsIDAuOTc3NDcsIDAuNzgyODcsIDAuOTc5MjYsIDAuODQ5NzEsIDEuMDI5ODgsIDAuOTQyMTEsIDAuODgwMSwgMC45NDIxMSwgMC44NDk3MSwgMC43MzEzMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDI2NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDUxOCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDU0OCwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NjAxNywgMC45NTc5NCwgMC45NjAxNywgMC45NTc5NCwgMC45NjAxNywgMC45NTc5NCwgMC43Nzg5MiwgMC44NTE2MiwgMSwgMSwgMC44OTU1MiwgMC45MDUyNywgMSwgMC45MDM2MywgMC45Mjc5NCwgMC45Mjc5NCwgMC45Mjc5NCwgMC45Mjc5NCwgMC44NzAxMiwgMC44NzAxMiwgMC44NzAxMiwgMC44OTU1MiwgMC44OTU1MiwgMS40MjI1OSwgMC43MTE0MywgMS4wNjE1MiwgMSwgMSwgMS4wMzM3MiwgMS4wMzM3MiwgMC45NzE3MSwgMS40OTU2LCAyLjI4MDcsIDAuOTM4MzUsIDAuODM0MDYsIDAuOTExMzMsIDAuODQxMDcsIDAuOTExMzMsIDEsIDEsIDEsIDAuNzIwMjEsIDEsIDEuMjMxMDgsIDAuODM0ODksIDAuODg1MjUsIDAuODg1MjUsIDAuODE0OTksIDAuOTA1MjcsIDEuODEwNTUsIDAuOTA1MjcsIDEuODEwNTUsIDEuMzEwMDYsIDEuNTM3MTEsIDAuOTQ0MzQsIDEuMDg2OTYsIDEsIDAuOTUwMTgsIDAuNzcxOTIsIDAuODUyODQsIDAuOTA3NDcsIDEuMTc1MzQsIDAuNjk4MjUsIDAuOTcxNiwgMS4zNzA3NywgMC45MDc0NywgMC45MDc0NywgMC44NTM1NiwgMC45MDc0NywgMC45MDc0NywgMS40NDk0NywgMC44NTI4NCwgMC44OTQxLCAwLjg5NDEsIDAuNzA1NzIsIDAuOCwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4wODAwNCwgMC45MTAyNywgMSwgMSwgMSwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDcyNywgMC45MDcyNywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IENhbGlicmlCb2xkTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmNvbnN0IENhbGlicmlCb2xkSXRhbGljRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDAuOTc4MDEsIDAuOTI0ODIsIDAuODk1NTIsIDAuOTExMzMsIDAuODE5ODgsIDAuOTc1NjYsIDAuOTgxNTIsIDAuOTM1NDgsIDAuOTM1NDgsIDEuMjc5OCwgMC44NTI4NCwgMC45Mjc5NCwgMSwgMC45NjEzNCwgMS41NjIzOSwgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC44Mjg0NSwgMC44Mjg0NSwgMC44NTI4NCwgMC44NTI4NCwgMC44NTI4NCwgMC43NTg1OSwgMC45MjEzOCwgMC44MzkwOCwgMC43NzYyLCAwLjcxODA1LCAwLjg3Mjg5LCAwLjczMTMzLCAwLjc1MTQsIDAuODE5MjEsIDAuODczNTYsIDAuOTU5NTgsIDAuNTk1MjYsIDAuNzU3MjcsIDAuNjkyMjUsIDEuMDQ5MjQsIDAuOTA4NzIsIDAuODU5MzgsIDAuNzk3OTUsIDAuODcwNjgsIDAuNzc5NTgsIDAuNjk3NjYsIDAuODEwNTUsIDAuOTAzOTksIDAuODg2NTMsIDAuOTYwNjgsIDAuODI1NzcsIDAuNzc4OTIsIDAuNzgyNTcsIDAuOTc1MDcsIDEuNTI5LCAwLjk3NTA3LCAwLjg1Mjg0LCAwLjg5NTUyLCAwLjkwMTc2LCAwLjk0OTA4LCAwLjg2NDExLCAwLjc0MDEyLCAwLjg2NDExLCAwLjg4MzIzLCAwLjk1MDE1LCAwLjg2NDExLCAwLjg2MzMxLCAwLjg4NDAxLCAwLjkxOTE2LCAwLjg2MzA0LCAwLjg4NDAxLCAwLjkwMzksIDAuODYzMzEsIDAuODYzMzEsIDAuODY0MTEsIDAuODY0MTEsIDAuOTA0NjQsIDAuNzA4NTIsIDEuMDQxMDYsIDAuODYzMzEsIDAuODQzNzIsIDAuOTU3OTQsIDAuODI2MTYsIDAuODQ1NDgsIDAuNzk0OTIsIDAuODgzMzEsIDEuNjk4MDgsIDAuODgzMzEsIDAuODUyODQsIDAuOTc4MDEsIDAuODk1NTIsIDAuOTExMzMsIDAuODk1NTIsIDAuOTExMzMsIDEuNzgwMSwgMC44OTU1MiwgMS4yNDQ4NywgMS4xMzI1NCwgMS4xOTEyOSwgMC45NjgzOSwgMC44NTI4NCwgMC42ODc4NywgMC43MDY0NSwgMC44NTU5MiwgMC45MDc0NywgMS4wMTQ2NiwgMS4wMDg4LCAwLjkwMzIzLCAxLCAxLjA3NDYzLCAxLCAwLjkxMDU2LCAwLjc1ODA2LCAxLjE5MTE4LCAwLjk2ODM5LCAwLjc4ODY0LCAwLjgyODQ1LCAwLjg0MTMzLCAwLjc1ODU5LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjgzOTA4LCAwLjc3NTM5LCAwLjcxODA1LCAwLjczMTMzLCAwLjczMTMzLCAwLjczMTMzLCAwLjczMTMzLCAwLjk1OTU4LCAwLjk1OTU4LCAwLjk1OTU4LCAwLjk1OTU4LCAwLjg4NTA2LCAwLjkwODcyLCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1OTM4LCAwLjg1Mjg0LCAwLjg3MDY4LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjc3ODkyLCAwLjc5Nzk1LCAwLjkwODA3LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjk0OTA4LCAwLjg1ODg3LCAwLjc0MDEyLCAwLjg4MzIzLCAwLjg4MzIzLCAwLjg4MzIzLCAwLjg4MzIzLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg4NDAxLCAwLjg3ODUsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuOTA3NDcsIDAuODkwNDksIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODYzMzEsIDAuODQ1NDgsIDAuODY0MTEsIDAuODQ1NDgsIDAuODM5MDgsIDAuOTQ5MDgsIDAuODM5MDgsIDAuOTQ5MDgsIDAuODM5MDgsIDAuOTQ5MDgsIDAuNzE4MDUsIDAuNzQwMTIsIDAuNzE4MDUsIDAuNzQwMTIsIDAuNzE4MDUsIDAuNzQwMTIsIDAuNzE4MDUsIDAuNzQwMTIsIDAuODcyODksIDAuNzk1MzgsIDAuODg1MDYsIDAuOTI3MjYsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuNzMxMzMsIDAuODgzMjMsIDAuODE5MjEsIDAuODY0MTEsIDAuODE5MjEsIDAuODY0MTEsIDAuODE5MjEsIDAuODY0MTEsIDEsIDEsIDAuODczNTYsIDAuODYzMzEsIDAuOTEwNzUsIDAuODc3NywgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC43NjQ2NywgMC45MDE2NywgMC41OTUyNiwgMC45MTkxNiwgMSwgMSwgMC44NjMwNCwgMC42OTIyNSwgMC44ODQwMSwgMSwgMSwgMC43MDQyNCwgMC43NzMxMiwgMC45MTkyNiwgMC44ODE3NSwgMC43MDgyMywgMC45NDkwMywgMC45MDg3MiwgMC44NjMzMSwgMSwgMSwgMC45MDg3MiwgMC44NjMzMSwgMC44NjkwNiwgMC44ODExNiwgMC44NjMzMSwgMC44NTkzOCwgMC44NjMzMSwgMC44NTkzOCwgMC44NjMzMSwgMC44NTkzOCwgMC44NjMzMSwgMC44NzQwMiwgMC44NjU0OSwgMC43Nzk1OCwgMC45MDQ2NCwgMSwgMSwgMC43Nzk1OCwgMC45MDQ2NCwgMC42OTc2NiwgMC43MDg1MiwgMC42OTc2NiwgMC43MDg1MiwgMC42OTc2NiwgMC43MDg1MiwgMC42OTc2NiwgMC43MDg1MiwgMSwgMSwgMC44MTA1NSwgMC43NTg0MSwgMC44MTA1NSwgMS4wNjQ1MiwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45MDM5OSwgMC44NjMzMSwgMC45NjA2OCwgMC45NTc5NCwgMC43Nzg5MiwgMC44NDU0OCwgMC43Nzg5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC45Mjk3LCAwLjU2ODkyLCAwLjgzOTA4LCAwLjk0OTA4LCAwLjc3NTM5LCAwLjg1ODg3LCAwLjg3MDY4LCAwLjg5MDQ5LCAxLCAxLCAwLjgxMDU1LCAxLjA0MTA2LCAxLjIwNTI4LCAxLjIwNTI4LCAxLCAxLjE1NTQzLCAwLjcwMDg4LCAwLjk4Mzg3LCAwLjk0NzIxLCAxLjMzNDMxLCAxLjQ1ODk0LCAwLjk1MTYxLCAxLjQ4Mzg3LCAwLjgzOTA4LCAwLjgwMzUyLCAwLjU3MTE4LCAwLjY5NjUsIDAuNTYzNDcsIDAuNzkxNzksIDAuNTU4NTMsIDAuODAzNDYsIDEuMDI5ODgsIDAuODM5MDgsIDAuNzc2MiwgMC42NzE3NCwgMC44NjAzNiwgMC43MzEzMywgMC43ODI1NywgMC44NzM1NiwgMC44NjQ0MSwgMC45NTk1OCwgMC43NTcyNywgMC44OTAxOSwgMS4wNDkyNCwgMC45MDg3MiwgMC43NDg4OSwgMC44NTkzOCwgMC44Nzg5MSwgMC43OTc5NSwgMC43OTU3LCAwLjgxMDU1LCAwLjc3ODkyLCAwLjk3NDQ3LCAwLjgyNTc3LCAwLjk3NDY2LCAwLjg3MTc5LCAwLjk1OTU4LCAwLjc3ODkyLCAwLjk0MjUyLCAwLjk1NjEyLCAwLjg3NTMsIDEuMDI5ODgsIDAuOTI3MzMsIDAuOTQyNTIsIDAuODc0MTEsIDAuODQwMjEsIDAuODcyOCwgMC45NTYxMiwgMC43NDA4MSwgMC44NzUzLCAxLjAyMTg5LCAxLjAyOTg4LCAwLjg0ODE0LCAwLjg3NDQ1LCAwLjkxODIyLCAwLjg0NzIzLCAwLjg1NjY4LCAwLjg2MzMxLCAwLjgxMzQ0LCAwLjg3NTgxLCAwLjc2NDIyLCAwLjgyMDQ2LCAwLjk2MDU3LCAwLjkyNzMzLCAwLjk5Mzc1LCAwLjc4MDIyLCAwLjk1NDUyLCAwLjg2MDE1LCAxLjAyOTg4LCAwLjkyNzMzLCAwLjg2MzMxLCAwLjkyNzMzLCAwLjg2MDE1LCAwLjczMTMzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNjMxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg4MzIzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg1MTc0LCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk2MDY4LCAwLjk1Nzk0LCAwLjk2MDY4LCAwLjk1Nzk0LCAwLjk2MDY4LCAwLjk1Nzk0LCAwLjc3ODkyLCAwLjg0NTQ4LCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMzYzLCAwLjkyNzk0LCAwLjkyNzk0LCAwLjkyNzk0LCAwLjg5ODA3LCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjcxMDk0LCAxLjA2MTUyLCAxLCAxLCAxLjAzMzcyLCAxLjAzMzcyLCAwLjk3MTcxLCAxLjQ5NTYsIDIuMjgwNywgMC45Mjk3MiwgMC44MzQwNiwgMC45MTEzMywgMC44MzMyNiwgMC45MTEzMywgMSwgMSwgMSwgMC43MjAyMSwgMSwgMS4yMzEwOCwgMC44MzQ4OSwgMC44ODUyNSwgMC44ODUyNSwgMC44MTQ5OSwgMC45MDYxNiwgMS44MTA1NSwgMC45MDUyNywgMS44MTA1NSwgMS4zMTA3LCAxLjUzNzExLCAwLjk0NDM0LCAxLjA4Njk2LCAxLCAwLjk1MDE4LCAwLjc3MTkyLCAwLjg1Mjg0LCAwLjkwNzQ3LCAxLjE3NTM0LCAwLjY5ODI1LCAwLjk3MTYsIDEuMzcwNzcsIDAuOTA3NDcsIDAuOTA3NDcsIDAuODUzNTYsIDAuOTA3NDcsIDAuOTA3NDcsIDEuNDQ5NDcsIDAuODUyODQsIDAuODk0MSwgMC44OTQxLCAwLjcwNTcyLCAwLjgsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMDgwMDQsIDAuOTEwMjcsIDEsIDEsIDEsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTA3MjcsIDAuOTA3MjcsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBDYWxpYnJpQm9sZEl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yMjA3LAogIGxpbmVHYXA6IDAuMjIwNwp9Owpjb25zdCBDYWxpYnJpSXRhbGljRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDEuMTcyMjMsIDEuMTI5MywgMC44OTU1MiwgMC45MTEzMywgMC44MDM5NSwgMS4wMjI2OSwgMS4xNTYwMSwgMC45MTA1NiwgMC45MTA1NiwgMS4yNzk4LCAwLjg1Mjg0LCAwLjg5ODA3LCAxLCAwLjkwODYxLCAxLjM5NTQzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjk2MzA5LCAwLjk2MzA5LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjgzMzE5LCAwLjg4MDcxLCAwLjg2NzUsIDAuODE1NTIsIDAuNzIzNDYsIDAuODUxOTMsIDAuNzMyMDYsIDAuNzUyMiwgMC44MTEwNSwgMC44NjI3NSwgMC45MDY4NSwgMC42Mzc3LCAwLjc3ODkyLCAwLjc1NTkzLCAxLjAyNjM4LCAwLjg5MjQ5LCAwLjg0MTE4LCAwLjc3NDUyLCAwLjg1Mzc0LCAwLjc1MTg2LCAwLjY3Nzg5LCAwLjc5Nzc2LCAwLjg4ODQ0LCAwLjg1MDY2LCAwLjk0MzA5LCAwLjc3ODE4LCAwLjczMDYsIDAuNzY2NTksIDEuMTAzNjksIDEuMzgzMTMsIDEuMTAzNjksIDEuMDYxMzksIDAuODk1NTIsIDAuODczOSwgMC45MjQ1LCAwLjkyNDUsIDAuODMyMDMsIDAuOTI0NSwgMC44NTg2NSwgMS4wOTg0MiwgMC45MjQ1LCAwLjkyNDUsIDEuMDMyOTcsIDEuMDc2OTIsIDAuOTA5MTgsIDEuMDMyOTcsIDAuOTQ5NTksIDAuOTI0NSwgMC45MjI3NCwgMC45MjQ1LCAwLjkyNDUsIDEuMDI5MzMsIDAuNzc4MzIsIDEuMjA1NjIsIDAuOTI0NSwgMC44OTE2LCAwLjk4OTg2LCAwLjg2NjIxLCAwLjg5NDUzLCAwLjc5MDA0LCAwLjk0MTUyLCAxLjc3MjU2LCAwLjk0MTUyLCAwLjg1Mjg0LCAwLjk3ODAxLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjg5NTUyLCAwLjkxMTMzLCAxLjkxNzI5LCAwLjg5NTUyLCAxLjE3ODg5LCAxLjEzMjU0LCAxLjE2MzU5LCAwLjkyMDk4LCAwLjg1Mjg0LCAwLjY4Nzg3LCAwLjcxMzUzLCAwLjg0NzM3LCAwLjkwNzQ3LCAxLjAwODgsIDEuMDA0NCwgMC44NzY4MywgMSwgMS4wOTA5MSwgMSwgMC45MjIyOSwgMC43MzksIDEuMTU2NDIsIDAuOTIwOTgsIDAuNzYyODgsIDAuODA1MDQsIDAuODA5NzIsIDAuNzU4NTksIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuNzYzMTgsIDAuNzIzNDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuODY0NzcsIDAuODkyNDksIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODUyODQsIDAuODQ1NTcsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuNzMwNiwgMC43NzQ1MiwgMC44NjMzMSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC44NDg0MywgMC44MzIwMywgMC44NTg2NSwgMC44NTg2NSwgMC44NTg2NSwgMC44NTg2NSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC45NDQ2OSwgMC45MjQ1LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkwNzQ3LCAwLjg2NjUxLCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuODk0NTMsIDAuOTI0NSwgMC44OTQ1MywgMC44Njc1LCAwLjkyNDUsIDAuODY3NSwgMC45MjQ1LCAwLjg2NzUsIDAuOTI0NSwgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC44NTE5MywgMC44ODc1LCAwLjg2NDc3LCAwLjk5MDM0LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjgxMTA1LCAwLjkyNDUsIDAuODExMDUsIDAuOTI0NSwgMC44MTEwNSwgMC45MjQ1LCAxLCAxLCAwLjg2Mjc1LCAwLjkyNDUsIDAuOTA4NzIsIDAuOTM1OTEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDEuMDMyOTcsIDAuOTA2ODUsIDAuODI2MDEsIDAuNzc4OTYsIDEuMDU2MTEsIDAuNjM3NywgMS4wNzY5MiwgMSwgMSwgMC45MDkxOCwgMC43NTU5MywgMS4wMzI5NywgMSwgMSwgMC43NjAzMiwgMC45Mzc1LCAwLjk4MTU2LCAwLjkzNDA3LCAwLjc3MjYxLCAxLjExNDI5LCAwLjg5MjQ5LCAwLjkyNDUsIDEsIDEsIDAuODkyNDksIDAuOTI0NSwgMC45MjUzNCwgMC44NjY5OCwgMC45MjQ1LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg2NjcsIDAuODYyOTEsIDAuNzUxODYsIDEuMDI5MzMsIDEsIDEsIDAuNzUxODYsIDEuMDI5MzMsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDEsIDEsIDAuNzk3NzYsIDAuOTc2NTUsIDAuNzk3NzYsIDEuMjMwMjMsIDAuODg4NDQsIDAuOTI0NSwgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuODg4NDQsIDAuOTI0NSwgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuOTQzMDksIDAuOTg5ODYsIDAuNzMwNiwgMC44OTQ1MywgMC43MzA2LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAxLjA5MjMxLCAwLjU0ODczLCAwLjg2NzUsIDAuOTI0NSwgMC43NjMxOCwgMC44NDg0MywgMC44NDU1NywgMC44NjY1MSwgMSwgMSwgMC43OTc3NiwgMS4yMDU2MiwgMS4xODYyMiwgMS4xODYyMiwgMSwgMS4xNDM3LCAwLjY3MDA5LCAwLjk2MzM0LCAwLjkzNjk1LCAxLjM1MTkxLCAxLjQwOTA5LCAwLjk1MTYxLCAxLjQ4Mzg3LCAwLjg2NzUsIDAuOTA4NjEsIDAuNjE5MiwgMC43MzYzLCAwLjY0ODI0LCAwLjgyNDExLCAwLjU2MzIxLCAwLjg1Njk2LCAxLjIzNTE2LCAwLjg2NzUsIDAuODE1NTIsIDAuNzI4NiwgMC44NDEzNCwgMC43MzIwNiwgMC43NjY1OSwgMC44NjI3NSwgMC44NDM2OSwgMC45MDY4NSwgMC43Nzg5MiwgMC44NTg3MSwgMS4wMjYzOCwgMC44OTI0OSwgMC43NTgyOCwgMC44NDExOCwgMC44NTk4NCwgMC43NzQ1MiwgMC43NjQ2NiwgMC43OTc3NiwgMC43MzA2LCAwLjkwNzgyLCAwLjc3ODE4LCAwLjkwMywgMC44NzI5MSwgMC45MDY4NSwgMC43MzA2LCAwLjk5MDU4LCAxLjAzNjY3LCAwLjk0NjM1LCAxLjIzNTE2LCAwLjk4NDksIDAuOTkwNTgsIDAuOTIzOTMsIDAuODkxNiwgMC45NDIsIDEuMDM2NjcsIDAuNzUwMjYsIDAuOTQ2MzUsIDEuMDI5NywgMS4yMzUxNiwgMC45MDkxOCwgMC45NDA0OCwgMC45ODIxNywgMC44OTc0NiwgMC44NDE1MywgMC45MjI3NCwgMC44MjUwNywgMC44ODgzMiwgMC44NDQzOCwgMC44ODE3OCwgMS4wMzUyNSwgMC45ODQ5LCAxLjAwMjI1LCAwLjc4MDg2LCAwLjk3MjQ4LCAwLjg5NDA0LCAxLjIzNTE2LCAwLjk4NDksIDAuOTIyNzQsIDAuOTg0OSwgMC44OTQwNCwgMC43MzIwNiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44OTY5MywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44NTg2NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDkzMywgMSwgMSwgMSwgMSwgMSwgMSwgMC45NDMwOSwgMC45ODk4NiwgMC45NDMwOSwgMC45ODk4NiwgMC45NDMwOSwgMC45ODk4NiwgMC43MzA2LCAwLjg5NDUzLCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMTg2LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjI1NjYsIDEuMjU2NiwgMS4yNTY2LCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjY4OTk0LCAxLjAzODA5LCAxLCAxLCAxLjAxNzYsIDEuMDE3NiwgMS4xMTUyMywgMS40OTU2LCAyLjAxNDYyLCAwLjk3ODU4LCAwLjgyNjE2LCAwLjkxMTMzLCAwLjgzNDM3LCAwLjkxMTMzLCAxLCAxLCAxLCAwLjcwNTA4LCAxLCAxLjIzMTA4LCAwLjc5ODAxLCAwLjg0NDI2LCAwLjg0NDI2LCAwLjc3NCwgMC45MDU3MiwgMS44MTA1NSwgMC45MDc0OSwgMS44MTA1NSwgMS4yODgwOSwgMS41NTQ2OSwgMC45NDQzNCwgMS4wNzgwNiwgMSwgMC45NzA5NCwgMC43NTg5LCAwLjg1Mjg0LCAwLjkwNzQ3LCAxLjE5NjU4LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjMzNTEyLCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1Mjg0LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjAzMzYsIDAuOTEwMjcsIDEsIDEsIDEsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDU4NTksIDEuMDU4NTksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBDYWxpYnJpSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmNvbnN0IENhbGlicmlSZWd1bGFyRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDEuMTcyMjMsIDEuMTI5MywgMC44OTU1MiwgMC45MTEzMywgMC44MDM5NSwgMS4wMjI2OSwgMS4xNTYwMSwgMC45MTA1NiwgMC45MTA1NiwgMS4yNzk4LCAwLjg1Mjg0LCAwLjg5ODA3LCAxLCAwLjkwODYxLCAxLjM5MDE2LCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjk2MzA5LCAwLjk2MzA5LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjgzMzE5LCAwLjg4MDcxLCAwLjg2NzUsIDAuODE1NTIsIDAuNzM4MzQsIDAuODUxOTMsIDAuNzMyMDYsIDAuNzUyMiwgMC44MTEwNSwgMC44NjI3NSwgMC45MDY4NSwgMC42Mzc3LCAwLjc3ODkyLCAwLjc1NTkzLCAxLjAyNjM4LCAwLjg5Mzg1LCAwLjg1MTIyLCAwLjc3NDUyLCAwLjg2NTAzLCAwLjc1MTg2LCAwLjY4ODg3LCAwLjc5Nzc2LCAwLjg4ODQ0LCAwLjg1MDY2LCAwLjk0MjU4LCAwLjc3ODE4LCAwLjczMDYsIDAuNzY2NTksIDEuMTAzNjksIDEuMzkwMTYsIDEuMTAzNjksIDEuMDYxMzksIDAuODk1NTIsIDAuODczOSwgMC44NjEyOCwgMC45NDQ2OSwgMC44NDU3LCAwLjk0NDY5LCAwLjg5NDY0LCAxLjA5ODQyLCAwLjg0NjM2LCAwLjk0NDY5LCAxLjAzMjk3LCAxLjA3NjkyLCAwLjkwOTE4LCAxLjAzMjk3LCAwLjk1ODk3LCAwLjk0NDY5LCAwLjk0ODIsIDAuOTQ0NjksIDAuOTQ0NjksIDEuMDQ2OTIsIDAuNzgyMjMsIDEuMjA1NjIsIDAuOTQ0NjksIDAuOTAzMzIsIDAuOTg5ODYsIDAuODY2MjEsIDAuOTA1MjcsIDAuNzkwMDQsIDAuOTQxNTIsIDEuNzcyNTYsIDAuOTQxNTIsIDAuODUyODQsIDAuOTc4MDEsIDAuODk1NTIsIDAuOTExMzMsIDAuODk1NTIsIDAuOTExMzMsIDEuOTE3MjksIDAuODk1NTIsIDEuMTc4ODksIDEuMTMyNTQsIDEuMDg3MDcsIDAuOTIwOTgsIDAuODUyODQsIDAuNjg3ODcsIDAuNzEzNTMsIDAuODQ3MzcsIDAuOTA3NDcsIDEuMDA4OCwgMS4wMDQ0LCAwLjg3NjgzLCAxLCAxLjA5MDkxLCAxLCAwLjkyMjI5LCAwLjczOSwgMS4xNTY0MiwgMC45MjA5OCwgMC43NjI4OCwgMC44MDUwNCwgMC44MDk3MiwgMC43NTg1OSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC43NjMxOCwgMC43MzgzNCwgMC43MzIwNiwgMC43MzIwNiwgMC43MzIwNiwgMC43MzIwNiwgMC45MDY4NSwgMC45MDY4NSwgMC45MDY4NSwgMC45MDY4NSwgMC44NjQ3NywgMC44OTM4NSwgMC44NTEyMiwgMC44NTEyMiwgMC44NTEyMiwgMC44NTEyMiwgMC44NTEyMiwgMC44NTI4NCwgMC44NTMxMSwgMC44ODg0NCwgMC44ODg0NCwgMC44ODg0NCwgMC44ODg0NCwgMC43MzA2LCAwLjc3NDUyLCAwLjg2MzMxLCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2MTI4LCAwLjg2OTMsIDAuODQ1NywgMC44OTQ2NCwgMC44OTQ2NCwgMC44OTQ2NCwgMC44OTQ2NCwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC45NDQ2OSwgMC45NDQ2OSwgMC45NDgyLCAwLjk0ODIsIDAuOTQ4MiwgMC45NDgyLCAwLjk0ODIsIDAuOTA3NDcsIDAuODY2NTEsIDAuOTQ0NjksIDAuOTQ0NjksIDAuOTQ0NjksIDAuOTQ0NjksIDAuOTA1MjcsIDAuOTQ0NjksIDAuOTA1MjcsIDAuODY3NSwgMC44NjEyOCwgMC44Njc1LCAwLjg2MTI4LCAwLjg2NzUsIDAuODYxMjgsIDAuNzM4MzQsIDAuODQ1NywgMC43MzgzNCwgMC44NDU3LCAwLjczODM0LCAwLjg0NTcsIDAuNzM4MzQsIDAuODQ1NywgMC44NTE5MywgMC45MjQ1NCwgMC44NjQ3NywgMC45OTIxLCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjczMjA2LCAwLjg5NDY0LCAwLjgxMTA1LCAwLjg0NjM2LCAwLjgxMTA1LCAwLjg0NjM2LCAwLjgxMTA1LCAwLjg0NjM2LCAxLCAxLCAwLjg2Mjc1LCAwLjk0NDY5LCAwLjkwODcyLCAwLjk1Nzg2LCAwLjkwNjg1LCAwLjgyNjAxLCAwLjkwNjg1LCAwLjgyNjAxLCAwLjkwNjg1LCAwLjgyNjAxLCAwLjkwNjg1LCAxLjAzMjk3LCAwLjkwNjg1LCAwLjgyNjAxLCAwLjc3NzQxLCAxLjA1NjExLCAwLjYzNzcsIDEuMDc2OTIsIDEsIDEsIDAuOTA5MTgsIDAuNzU1OTMsIDEuMDMyOTcsIDEsIDEsIDAuNzYwMzIsIDAuOTA0NTIsIDAuOTgxNTYsIDEuMTE4NDIsIDAuNzcyNjEsIDEuMTE0MjksIDAuODkzODUsIDAuOTQ0NjksIDEsIDEsIDAuODkzODUsIDAuOTQ0NjksIDAuOTU4NzcsIDAuODY5MDEsIDAuOTQ0NjksIDAuODUxMjIsIDAuOTQ4MiwgMC44NTEyMiwgMC45NDgyLCAwLjg1MTIyLCAwLjk0ODIsIDAuODY2NywgMC45MDAxNiwgMC43NTE4NiwgMS4wNDY5MiwgMSwgMSwgMC43NTE4NiwgMS4wNDY5MiwgMC42ODg4NywgMC43ODIyMywgMC42ODg4NywgMC43ODIyMywgMC42ODg4NywgMC43ODIyMywgMC42ODg4NywgMC43ODIyMywgMSwgMSwgMC43OTc3NiwgMC45MjE4OCwgMC43OTc3NiwgMS4yMzAyMywgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC44ODg0NCwgMC45NDQ2OSwgMC45NDI1OCwgMC45ODk4NiwgMC43MzA2LCAwLjkwNTI3LCAwLjczMDYsIDAuNzY2NTksIDAuNzkwMDQsIDAuNzY2NTksIDAuNzkwMDQsIDAuNzY2NTksIDAuNzkwMDQsIDEuMDkyMzEsIDAuNTQ4NzMsIDAuODY3NSwgMC44NjEyOCwgMC43NjMxOCwgMC44NjkzLCAwLjg1MzExLCAwLjg2NjUxLCAxLCAxLCAwLjc5Nzc2LCAxLjIwNTYyLCAxLjE4NjIyLCAxLjE4NjIyLCAxLCAxLjE0MzcsIDAuNjc3NDIsIDAuOTYzMzQsIDAuOTM2OTUsIDEuMzUxOTEsIDEuNDA5MDksIDAuOTUxNjEsIDEuNDgzODcsIDAuODY2ODYsIDAuOTA4NjEsIDAuNjIyNjcsIDAuNzQzNTksIDAuNjU2NDksIDAuODU0OTgsIDAuNTY5NjMsIDAuODgyNTQsIDEuMjM1MTYsIDAuODY3NSwgMC44MTU1MiwgMC43NTQ0MywgMC44NDUwMywgMC43MzIwNiwgMC43NjY1OSwgMC44NjI3NSwgMC44NTEyMiwgMC45MDY4NSwgMC43Nzg5MiwgMC44NTc0NiwgMS4wMjYzOCwgMC44OTM4NSwgMC43NTY1NywgMC44NTEyMiwgMC44NjI3NSwgMC43NzQ1MiwgMC43NDE3MSwgMC43OTc3NiwgMC43MzA2LCAwLjk1MTY1LCAwLjc3ODE4LCAwLjg5NzcyLCAwLjg4ODMxLCAwLjkwNjg1LCAwLjczMDYsIDAuOTgxNDIsIDEuMDIxOTEsIDAuOTY1NzYsIDEuMjM1MTYsIDAuOTkwMTgsIDAuOTgxNDIsIDAuOTIzNiwgMC44OTI1OCwgMC45NDAzNSwgMS4wMjE5MSwgMC43ODg0OCwgMC45NjU3NiwgMC45NTYxLCAxLjIzNTE2LCAwLjkwOTE4LCAwLjkyNTc4LCAwLjk1NDI0LCAwLjg5NzQ2LCAwLjgzOTY5LCAwLjk0ODIsIDAuODAxMTMsIDAuODk0NDIsIDAuODUyMDgsIDAuODYxNTUsIDAuOTgwMjIsIDAuOTkwMTgsIDEuMDA0NTIsIDAuODEyMDksIDAuOTkyNDcsIDAuODkxODEsIDEuMjM1MTYsIDAuOTkwMTgsIDAuOTQ4MiwgMC45OTAxOCwgMC44OTE4MSwgMC43MzIwNiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44ODg0NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44OTQ2NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45Njc2NiwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NDI1OCwgMC45ODk4NiwgMC45NDI1OCwgMC45ODk4NiwgMC45NDI1OCwgMC45ODk4NiwgMC43MzA2LCAwLjkwNTI3LCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMTg2LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjI1NjYsIDEuMjU2NiwgMS4yNTY2LCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjY5MDQzLCAxLjAzODA5LCAxLCAxLCAxLjAxNzYsIDEuMDE3NiwgMS4xMTUyMywgMS40OTU2LCAyLjAxNDYyLCAwLjk5MzMxLCAwLjgyNjE2LCAwLjkxMTMzLCAwLjg0Mjg2LCAwLjkxMTMzLCAxLCAxLCAxLCAwLjcwNTA4LCAxLCAxLjIzMTA4LCAwLjc5ODAxLCAwLjg0NDI2LCAwLjg0NDI2LCAwLjc3NCwgMC45MDUyNywgMS44MTA1NSwgMC45MDUyNywgMS44MTA1NSwgMS4yODgwOSwgMS41NTQ2OSwgMC45NDQzNCwgMS4wNzgwNiwgMSwgMC45NzA5NCwgMC43NTg5LCAwLjg1Mjg0LCAwLjkwNzQ3LCAxLjE5NjU4LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjMzNTEyLCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1MzU2LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjAzMzYsIDAuOTEwMjcsIDEsIDEsIDEsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDU4NTksIDEuMDU4NTksIDEsIDEsIDEsIDEuMDcxODUsIDAuOTk0MTMsIDAuOTYzMzQsIDEuMDgwNjUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBDYWxpYnJpUmVndWxhck1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yMjA3LAogIGxpbmVHYXA6IDAuMjIwNwp9OwoKOy8vIC4vc3JjL2NvcmUvaGVsdmV0aWNhX2ZhY3RvcnMuanMKY29uc3QgSGVsdmV0aWNhQm9sZEZhY3RvcnMgPSBbMC43NjExNiwgMSwgMSwgMS4wMDA2LCAwLjk5OTk4LCAwLjk5OTc0LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAwLjk5OTc3LCAxLjAwMDg3LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTU5LCAxLjAwMDAzLCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTk4LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDI2LCAwLjk5OTksIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3NywgMS4wMDAyNiwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAwMSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAxNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTk4LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTgyLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTU5LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTU5LCAxLjAwMDc3LCAwLjk5OTU5LCAxLjAwMDAzLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDc3LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI1LCAwLjk5OTY4LCAwLjk5OTczLCAxLjAwMDAzLCAxLjAwMDI1LCAwLjYwMjk5LCAxLjAwMDI0LCAxLjA2NDA5LCAxLCAxLCAwLjk5OTk4LCAxLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjA2NDA5LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAxLjAzMzc0LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNDIsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDM4MjgsIDEuMDAwMjYsIDAuOTk5OTksIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTkzLCAwLjk5OTgsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5OTgsIDEuMDAwMjYsIDAuODEyMSwgMS4wMDAyNiwgMC45OTk5OCwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAxLjAwMDM0LCAwLjk5OTc3LCAxLCAwLjk5OTk3LCAxLjAwMDI2LCAxLjAwMDc4LCAxLjAwMDM2LCAwLjk5OTczLCAxLjAwMDEzLCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5ODgsIDAuODUxNDgsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk3NywgMS4wMDA2OSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk4NCwgMS4wMDAyNiwgMS4wMDAwMSwgMS4wMDAyNCwgMS4wMDAwMSwgMC45OTk5LCAxLCAxLjAwMDYsIDEuMDAwMDEsIDEuMDAwNDEsIDAuOTk5NjIsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk5NSwgMS4wMDA0MSwgMC45OTk0MiwgMC45OTk3MywgMC45OTkyNywgMS4wMDA4MiwgMC45OTkwMiwgMS4wMDAyNiwgMS4wMDA4NywgMS4wMDA2LCAxLjAwMDY5LCAwLjk5OTczLCAwLjk5ODY3LCAwLjk5OTczLCAwLjk5OTMsIDEuMDAwMjYsIDEuMDAwNDksIDEuMDAwNTYsIDEsIDAuOTk5ODgsIDAuOTk5MzUsIDAuOTk5OTUsIDAuOTk5NTQsIDEuMDAwNTUsIDAuOTk5NDUsIDEuMDAwMzIsIDEuMDAwNiwgMC45OTk5NSwgMS4wMDAyNiwgMC45OTk5NSwgMS4wMDAzMiwgMS4wMDAwMSwgMS4wMDAwOCwgMC45OTk3MSwgMS4wMDAxOSwgMC45OTk0LCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNDQsIDAuOTk5NzMsIDEuMDAwMjMsIDEuMDAwNDcsIDEsIDAuOTk5NDIsIDAuOTk1NjEsIDAuOTk5ODksIDEuMDAwMzUsIDAuOTk5NzcsIDEuMDAwMzUsIDAuOTk5NzcsIDEuMDAwMTksIDAuOTk5NDQsIDEuMDAwMDEsIDEuMDAwMjEsIDAuOTk5MjYsIDEuMDAwMzUsIDEuMDAwMzUsIDAuOTk5NDIsIDEuMDAwNDgsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMzUsIDEuMDAwMDEsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5ODksIDEuMDAwNTcsIDEuMDAwMDEsIDAuOTk5MzYsIDEuMDAwNTIsIDEuMDAwMTIsIDAuOTk5OTYsIDEuMDAwNDMsIDEsIDEuMDAwMzUsIDAuOTk5NCwgMC45OTk3NiwgMS4wMDAzNSwgMC45OTk3MywgMS4wMDA1MiwgMS4wMDA0MSwgMS4wMDExOSwgMS4wMDAzNywgMC45OTk3MywgMS4wMDAwMiwgMC45OTk4NiwgMS4wMDA0MSwgMS4wMDA0MSwgMC45OTkwMiwgMC45OTk2LCAxLjAwMDM0LCAwLjk5OTk5LCAxLjAwMDI2LCAwLjk5OTk5LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDUyLCAwLjk5OTczLCAxLCAwLjk5OTczLCAxLjAwMDQxLCAxLjAwMDc1LCAwLjk5OTQsIDEuMDAwMywgMC45OTk5OSwgMSwgMS4wMDA0MSwgMC45OTk1NSwgMSwgMC45OTkxNSwgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMS4wMDExOSwgMC45OTk1NSwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTExLCAxLjAwMDYsIDEuMDAwMjYsIDAuOTk5NzIsIDEuMDAwMjYsIDAuOTk5MDIsIDEuMDAwNDEsIDAuOTk5NzMsIDAuOTk5OTksIDEsIDEsIDEuMDAwMzgsIDEuMDAwNSwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMSwgMSwgMC45OTk3MywgMSwgMSwgMC45OTk1NSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTcyLCAxLCAxLCAxLjAwMTA2LCAwLjk5OTk5LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk5LCAwLjk5OTk4LCAxLjY2NDc1LCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDIzLCAwLjk5OTczLCAwLjk5OTcxLCAxLjAwMDQ3LCAxLjAwMDIzLCAxLCAwLjk5OTkxLCAwLjk5OTg0LCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5OTcyLCAxLCAxLjIwOTg1LCAxLjM5NzEzLCAxLjAwMDAzLCAxLjAwMDMxLCAxLjAwMDE1LCAxLCAwLjk5NTYxLCAxLjAwMDI3LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTE1LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTk5LCAxLjAwMDAzLCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQxMTQ0LCAxLjYsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDA1NzksIDEuNDA1NzksIDEuMzY2MjUsIDAuOTk5OTksIDEsIDAuOTk4NjEsIDAuOTk4NjEsIDEsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzIsIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDEuNDA0ODMsIDEsIDAuOTk5NzcsIDEuMDAwNTQsIDEsIDEsIDAuOTk5NTMsIDAuOTk5NjIsIDEuMDAwNDIsIDAuOTk5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IEhlbHZldGljYUJvbGRNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMiwKICBsaW5lR2FwOiAwLjIKfTsKY29uc3QgSGVsdmV0aWNhQm9sZEl0YWxpY0ZhY3RvcnMgPSBbMC43NjExNiwgMSwgMSwgMS4wMDA2LCAwLjk5OTk4LCAwLjk5OTc0LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAwLjk5OTc3LCAxLjAwMDg3LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTU5LCAxLjAwMDAzLCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTk4LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDI2LCAwLjk5OTksIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3NywgMS4wMDAyNiwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAwMSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAxNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTk4LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTgyLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTU5LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTU5LCAxLjAwMDc3LCAwLjk5OTU5LCAxLjAwMDAzLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDc3LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI1LCAwLjk5OTY4LCAwLjk5OTczLCAxLjAwMDAzLCAxLjAwMDI1LCAwLjYwMjk5LCAxLjAwMDI0LCAxLjA2NDA5LCAxLCAxLCAwLjk5OTk4LCAxLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjA2NDA5LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAxLjAwNDQsIDAuOTk5NzcsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MSwgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMS4wMTAxMSwgMS4wMDAyNiwgMC45OTk5OSwgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTMsIDAuOTk5OCwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMSwgMS4wMDAxNiwgMC45OTk3NywgMC45OTk1OSwgMC45OTk3NywgMC45OTk1OSwgMC45OTk3NywgMC45OTk1OSwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDAyNiwgMC44MTIxLCAxLjAwMDI2LCAwLjk5OTk4LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEsIDAuOTk5ODIsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NzcsIDEsIDEsIDEuMDAwMjYsIDAuOTk5NjksIDAuOTk5NzIsIDAuOTk5ODEsIDAuOTk5OCwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDIyLCAwLjkxMTU1LCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDYsIDAuOTk5NzcsIDEuMDAwMDEsIDAuOTk5OTksIDAuOTk5NzcsIDAuOTk5NjYsIDEuMDAwMjIsIDEuMDAwMzIsIDEuMDAwMDEsIDAuOTk5NDQsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NjgsIDEuMDAwMDEsIDEuMDAwNDcsIDEsIDEuMDAwNiwgMS4wMDAwMSwgMC45OTk4MSwgMS4wMDEwMSwgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTQ4LCAwLjk5OTgxLCAxLjAwMDY0LCAwLjk5OTczLCAwLjk5OTQyLCAxLjAwMTAxLCAxLjAwMDYxLCAxLjAwMDI2LCAxLjAwMDY5LCAxLjAwMDYsIDEuMDAwMTQsIDAuOTk5NzMsIDEuMDEzMjIsIDAuOTk5NzMsIDEuMDAwNjUsIDEuMDAwMjYsIDEuMDAwMTIsIDAuOTk5MjMsIDEsIDEuMDAwNjQsIDEuMDAwNzYsIDAuOTk5NDgsIDEuMDAwNTUsIDEuMDAwNjMsIDEuMDAwMDcsIDAuOTk5NDMsIDEuMDAwNiwgMC45OTk0OCwgMS4wMDAyNiwgMC45OTk0OCwgMC45OTk0MywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyOSwgMS4wMDAzOCwgMS4wMDAzNSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzgsIDEuMDAwMDEsIDEuMDAwNTcsIDAuOTk5ODksIDAuOTk5NjcsIDAuOTk5NjQsIDAuOTk5NjcsIDAuOTk5NzcsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMzgsIDAuOTk5NzcsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwNjYsIDAuOTk5NjcsIDAuOTk5NjcsIDEuMDAwNDEsIDAuOTk5OTgsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDAuOTk5NjcsIDEuMDAwMDEsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NjQsIDEuMDAwMzEsIDEuMDAwMDEsIDAuOTk5OTksIDAuOTk5OTksIDEsIDEuMDAwMjMsIDEsIDEsIDAuOTk5OTksIDEuMDAwMzUsIDEuMDAwMDEsIDAuOTk5OTksIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5OTksIDEuMDAwNTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NTUsIDAuOTk5NSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAzMiwgMC45OTk4OSwgMS4wMDAzNCwgMC45OTk5OSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45OTk3MywgMC40NTk5OCwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk4MiwgMC45OTk5NCwgMC45OTk5NiwgMSwgMS4wMDA0MiwgMS4wMDA0NCwgMS4wMDAyOSwgMS4wMDAyMywgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMC45OTk0OSwgMS4wMDAwMiwgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAzMiwgMC45ODY4NSwgMC45OTk3MywgMS4wMDAyNiwgMSwgMSwgMC45OTk2NiwgMS4wMDA0NCwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMSwgMSwgMC45OTk3MywgMSwgMSwgMC45OTk1NSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTcyLCAxLCAxLCAxLjAwMTA2LCAwLjk5OTk5LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk5LCAwLjk5OTk4LCAxLjY2NDc1LCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAwLjk5OTcxLCAwLjk5OTc4LCAxLCAxLCAwLjk5OTkxLCAwLjk5OTg0LCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDk4LCAxLCAxLCAxLCAxLjAwMDQ5LCAxLCAxLCAwLjk5OTcyLCAxLCAxLjIwOTg1LCAxLjM5NzEzLCAxLjAwMDAzLCAxLjAwMDMxLCAxLjAwMDE1LCAxLCAwLjk5NTYxLCAxLjAwMDI3LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTE1LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTk5LCAxLjAwMDAzLCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQxMTQ0LCAxLjYsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDA1NzksIDEuNDA1NzksIDEuMzY2MjUsIDAuOTk5OTksIDEsIDAuOTk4NjEsIDAuOTk4NjEsIDEsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzIsIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDEuNDA0ODMsIDEsIDAuOTk5NzcsIDEuMDAwNTQsIDEsIDEsIDAuOTk5NTMsIDAuOTk5NjIsIDEuMDAwNDIsIDAuOTk5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IEhlbHZldGljYUJvbGRJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMzUsCiAgbGluZUdhcDogMC4yCn07CmNvbnN0IEhlbHZldGljYUl0YWxpY0ZhY3RvcnMgPSBbMC43NjExNiwgMSwgMSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5ODIsIDEuMDAwMDEsIDEuMDAwNDMsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NTksIDEuMDAwMDMsIDEuMDAwNiwgMC45OTk5OCwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMSwgMS4wMDAwMywgMS4wMDAwMywgMS4wMDAwMywgMC45OTk3MywgMC45OTk4NywgMS4wMDAwMSwgMS4wMDAwMSwgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDA2LCAxLCAxLjAwMDAxLCAwLjk5OTczLCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDAxLCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDE2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTQ5LCAwLjk5OTczLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5MjQsIDEsIDAuOTk5MjQsIDAuOTk5OTksIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5OTgsIDEsIDEuMDAwNiwgMC45OTk3MywgMSwgMC45OTk3NywgMSwgMSwgMSwgMS4wMDAwNSwgMS4wMDA5LCAxLjAwMDA1LCAxLjAwMDAzLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDksIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjUsIDAuOTk5NjgsIDAuOTk5NzMsIDEuMDAwMDMsIDEuMDAwMjUsIDAuNjAyOTksIDEuMDAwMjQsIDEuMDY0MDksIDEsIDEsIDAuOTk5OTgsIDEsIDAuOTk5OCwgMS4wMDA2LCAwLjk5OTk4LCAxLCAwLjk5OTM2LCAwLjk5OTczLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDI2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMDMsIDEuMDAwMjIsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5ODIsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wNjQwOSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMSwgMC45OTk3MywgMSwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMC45OTk3NywgMSwgMC45OTk3NywgMSwgMC45OTk3NywgMSwgMC45OTk3NywgMSwgMC45OTk3NywgMS4wMjg4LCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5MjQsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTQ2LCAxLjAwMDM0LCAxLCAwLjk5OTI0LCAxLjAwMDAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAxLjA2MzExLCAwLjk5OTczLCAxLjAwMDI0LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDQxLCAwLjk5OTgsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMC44OTU0NywgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLCAxLjAwMDAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAwLjk5OTI0LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAxLCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDEuMDAwMDEsIDEsIDEuMDAwNTQsIDAuOTk5NzcsIDEuMDAwODQsIDEuMDAwMDcsIDAuOTk5NzMsIDEuMDAwMTMsIDAuOTk5MjQsIDEuMDAwMDEsIDEuMDAwMDEsIDAuOTk5NDUsIDAuOTEyMjEsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNiwgMS4wMDAwMSwgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk3NywgMC45OTkzMywgMS4wMDAyMiwgMS4wMDA1NCwgMS4wMDAwMSwgMS4wMDA2NSwgMS4wMDAyNiwgMS4wMDAwMSwgMS4wMDAxLCAxLjAwMDAxLCAxLjAwMDUyLCAxLCAxLjAwMDYsIDEuMDAwMDEsIDAuOTk5NDUsIDAuOTk4OTcsIDAuOTk5NjgsIDAuOTk5MjQsIDEuMDAwMzYsIDAuOTk5NDUsIDAuOTk5NDksIDEsIDEuMDAwNiwgMC45OTg5NywgMC45OTkxOCwgMC45OTk2OCwgMC45OTkxMSwgMC45OTkyNCwgMSwgMC45OTk2MiwgMS4wMTQ4NywgMSwgMS4wMDA1LCAwLjk5OTczLCAxLjAwMDEyLCAxLjAwMDQzLCAxLCAwLjk5OTk1LCAwLjk5OTk0LCAxLjAwMDM2LCAwLjk5OTQ3LCAxLjAwMDE5LCAxLjAwMDYzLCAxLjAwMDI1LCAwLjk5OTI0LCAxLjAwMDM2LCAwLjk5OTczLCAxLjAwMDM2LCAxLjAwMDI1LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI3LCAxLjAwMDEsIDEuMDAwNjgsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLCAxLjAwMDA4LCAwLjk5OTU3LCAwLjk5OTcyLCAwLjk5OTQsIDAuOTk5NTQsIDAuOTk5NzUsIDEuMDAwNTEsIDEuMDAwMDEsIDEuMDAwMTksIDEuMDAwMDEsIDEuMDAwMSwgMC45OTk4NiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAzOCwgMC45OTk1NCwgMC45OTk1NCwgMC45OTk0LCAxLjAwMDY2LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDU0LCAxLjAwMDAxLCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc1LCAxLjAwMDEsIDEuMDAwMDEsIDAuOTk5OTMsIDAuOTk5NSwgMC45OTk1NSwgMS4wMDAxNiwgMC45OTk3OCwgMC45OTk3NCwgMS4wMDAxOSwgMS4wMDAyMiwgMC45OTk1NSwgMS4wMDA1MywgMC45OTk3MywgMS4wMDA4OSwgMS4wMDAwNSwgMC45OTk2NywgMS4wMDA0OCwgMC45OTk3MywgMS4wMDAwMiwgMS4wMDAzNCwgMC45OTk3MywgMC45OTk3MywgMC45OTk2NCwgMS4wMDAwNiwgMS4wMDA2NiwgMC45OTk0NywgMC45OTk3MywgMC45ODg5NCwgMC45OTk3MywgMSwgMC40NDg5OCwgMSwgMC45OTk0NiwgMSwgMS4wMDAzOSwgMS4wMDA4MiwgMC45OTk5MSwgMC45OTk5MSwgMC45OTk4NSwgMS4wMDAyMiwgMS4wMDAyMywgMS4wMDA2MSwgMS4wMDAwNiwgMC45OTk2NiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDAxOSwgMS4wMDA4LCAxLCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTgzLCAxLjAwMDQ0LCAwLjk5OTczLCAwLjk5OTY0LCAwLjk4MzMyLCAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTYyLCAwLjk5ODk1LCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLCAxLCAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTU1LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTI0LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTcyLCAxLCAxLCAxLjAwMjY3LCAwLjk5OTk5LCAwLjk5OTk4LCAwLjk5OTk4LCAxLCAwLjk5OTk4LCAxLjY2NDc1LCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDIzLCAwLjk5OTczLCAxLjAwNDIzLCAwLjk5OTI1LCAwLjk5OTk5LCAxLCAwLjk5OTkxLCAwLjk5OTg0LCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDQ5LCAxLCAxLjAwMjQ1LCAxLCAxLCAxLCAxLCAwLjk2MzI5LCAxLCAxLjIwOTg1LCAxLjM5NzEzLCAxLjAwMDAzLCAwLjgyNTQsIDEuMDAwMTUsIDEsIDEuMDAwMzUsIDEuMDAwMjcsIDEuMDAwMzEsIDEuMDAwMzEsIDEuMDAwMDMsIDEuMDAwMzEsIDEuMDAwMzEsIDAuOTk5OTksIDEuMDAwMDMsIDAuOTk5OTksIDAuOTk5OTksIDEuNDExNDQsIDEuNiwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MDU3OSwgMS40MDU3OSwgMS4zNjYyNSwgMC45OTk5OSwgMSwgMC45OTg2MSwgMC45OTg2MSwgMSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45NTMxNywgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMS40MDQ4MywgMSwgMC45OTk3NywgMS4wMDA1NCwgMSwgMSwgMC45OTk1MywgMC45OTk2MiwgMS4wMDA0MiwgMC45OTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgSGVsdmV0aWNhSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjM1LAogIGxpbmVHYXA6IDAuMgp9Owpjb25zdCBIZWx2ZXRpY2FSZWd1bGFyRmFjdG9ycyA9IFswLjc2MTE2LCAxLCAxLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMS4wMDAwMSwgMS4wMDA0MywgMC45OTk5OCwgMC45OTk5OCwgMC45OTk1OSwgMS4wMDAwMywgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTg3LCAxLjAwMDAxLCAxLjAwMDAxLCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDYsIDEsIDEuMDAwMDEsIDAuOTk5NzMsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMDEsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMTYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NDksIDAuOTk5NzMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTkyNCwgMC45OTkyNCwgMSwgMC45OTkyNCwgMC45OTk5OSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk5OCwgMSwgMS4wMDA2LCAwLjk5OTczLCAxLCAwLjk5OTc3LCAxLCAxLCAxLCAxLjAwMDA1LCAxLjAwMDksIDEuMDAwMDUsIDEuMDAwMDMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwOSwgMC45OTk3MywgMC45OTk5OCwgMS4wMDAyNSwgMC45OTk2OCwgMC45OTk3MywgMS4wMDAwMywgMS4wMDAyNSwgMC42MDI5OSwgMS4wMDAyNCwgMS4wNjQwOSwgMSwgMSwgMC45OTk5OCwgMSwgMC45OTk4LCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjA2NDA5LCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAxLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLjA0NTk2LCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5MjQsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDE5LCAxLjAwMDM0LCAxLCAwLjk5OTI0LCAxLjAwMDAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTczLCAxLjAyNTcyLCAwLjk5OTczLCAxLjAwMDA1LCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTk5LCAwLjk5OTgsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDAuOTk5NzcsIDAuOTk5OTgsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMC44NDUzMywgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDE2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLCAxLjAwMDAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAwLjk5OTI0LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAxLCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5MjgsIDEsIDAuOTk5NzcsIDEuMDAwMTMsIDEuMDAwNTUsIDAuOTk5NDcsIDAuOTk5NDUsIDAuOTk5NDEsIDAuOTk5MjQsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNCwgMC45MTYyMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDA2LCAxLjAwMDAxLCAxLjAwMDA1LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDE1LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDI2LCAxLjAwMDAxLCAxLjAwMDE5LCAxLjAwMDAxLCAwLjk5OTQ2LCAxLCAxLjAwMDYsIDEuMDAwMDEsIDAuOTk5NzgsIDEuMDAwNDUsIDAuOTk5NzMsIDAuOTk5MjQsIDEuMDAwMjMsIDAuOTk5NzgsIDAuOTk5NjYsIDEsIDEuMDAwNjUsIDEuMDAwNDUsIDEuMDAwMTksIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5MjQsIDEsIDEsIDAuOTY0OTksIDEsIDEuMDAwNTUsIDAuOTk5NzMsIDEuMDAwMDgsIDEuMDAwMjcsIDEsIDAuOTk5NywgMC45OTk5NSwgMS4wMDAyMywgMC45OTkzMywgMS4wMDAxOSwgMS4wMDAxNSwgMS4wMDAzMSwgMC45OTkyNCwgMS4wMDAyMywgMC45OTk3MywgMS4wMDAyMywgMS4wMDAzMSwgMS4wMDAwMSwgMC45OTkyOCwgMS4wMDAyOSwgMS4wMDA5MiwgMS4wMDAzNSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEsIDAuOTk5ODgsIDAuOTk5NzUsIDEsIDEuMDAwODIsIDAuOTk1NjEsIDAuOTk5NiwgMS4wMDAzNSwgMS4wMDAwMSwgMC45OTk2MiwgMS4wMDAwMSwgMS4wMDA5MiwgMC45OTk2NCwgMS4wMDAwMSwgMC45OTk2MywgMC45OTk5OSwgMS4wMDAzNSwgMS4wMDAzNSwgMS4wMDA4MiwgMC45OTk2MiwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAzNSwgMS4wMDAwMSwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk2LCAwLjk5OTY3LCAxLjAwMDAxLCAxLjAwMDM0LCAxLjAwMDc0LCAxLjAwMDU0LCAxLjAwMDUzLCAxLjAwMDYzLCAwLjk5OTcxLCAwLjk5OTYyLCAxLjAwMDM1LCAwLjk5OTc1LCAwLjk5OTc3LCAwLjk5OTczLCAxLjAwMDQzLCAwLjk5OTUzLCAxLjAwMDcsIDAuOTk5MTUsIDAuOTk5NzMsIDEuMDAwMDgsIDAuOTk4OTIsIDEuMDAwNzMsIDEuMDAwNzMsIDEuMDAxMTQsIDAuOTk5MTUsIDEuMDAwNzMsIDAuOTk5NTUsIDAuOTk5NzMsIDEuMDAwOTIsIDAuOTk5NzMsIDEsIDAuOTk5OTgsIDEsIDEuMDAwMywgMSwgMS4wMDA0MywgMS4wMDAwMSwgMC45OTk2OSwgMS4wMDAzLCAxLCAxLjAwMDM1LCAxLjAwMDAxLCAwLjk5OTUsIDEsIDEuMDAwOTIsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNywgMC45OTk1LCAxLCAwLjk5OTI0LCAxLjAwMDYsIDAuOTk5MjQsIDAuOTk5NzIsIDEuMDAwNjIsIDAuOTk5NzMsIDEuMDAxMTQsIDEuMDAwNzMsIDEsIDAuOTk5NTUsIDEsIDEsIDEuMDAwNDcsIDAuOTk5NjgsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEsIDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NTUsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzIsIDEsIDEsIDEuMDAyNjcsIDAuOTk5OTksIDAuOTk5OTgsIDAuOTk5OTgsIDEsIDAuOTk5OTgsIDEuNjY0NzUsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwMjMsIDAuOTk5NzMsIDAuOTk5NzEsIDAuOTk5MjUsIDEuMDAwMjMsIDEsIDAuOTk5OTEsIDAuOTk5ODQsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTYzMjksIDEsIDEuMjA5ODUsIDEuMzk3MTMsIDEuMDAwMDMsIDAuODI1NCwgMS4wMDAxNSwgMSwgMS4wMDAzNSwgMS4wMDAyNywgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTkxNSwgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTk5OSwgMS4wMDAwMywgMC45OTk5OSwgMC45OTk5OSwgMS40MTE0NCwgMS42LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQwNTc5LCAxLjQwNTc5LCAxLjM2NjI1LCAwLjk5OTk5LCAxLCAwLjk5ODYxLCAwLjk5ODYxLCAxLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk1MzE3LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQwNDgzLCAxLCAwLjk5OTc3LCAxLjAwMDU0LCAxLCAxLCAwLjk5OTUzLCAwLjk5OTYyLCAxLjAwMDQyLCAwLjk5OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBIZWx2ZXRpY2FSZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIsCiAgbGluZUdhcDogMC4yCn07Cgo7Ly8gLi9zcmMvY29yZS9saWJlcmF0aW9uc2Fuc193aWR0aHMuanMKY29uc3QgTGliZXJhdGlvblNhbnNCb2xkV2lkdGhzID0gWzM2NSwgMCwgMzMzLCAyNzgsIDMzMywgNDc0LCA1NTYsIDU1NiwgODg5LCA3MjIsIDIzOCwgMzMzLCAzMzMsIDM4OSwgNTg0LCAyNzgsIDMzMywgMjc4LCAyNzgsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMzMzLCAzMzMsIDU4NCwgNTg0LCA1ODQsIDYxMSwgOTc1LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjExLCA3NzgsIDcyMiwgMjc4LCA1NTYsIDcyMiwgNjExLCA4MzMsIDcyMiwgNzc4LCA2NjcsIDc3OCwgNzIyLCA2NjcsIDYxMSwgNzIyLCA2NjcsIDk0NCwgNjY3LCA2NjcsIDYxMSwgMzMzLCAyNzgsIDMzMywgNTg0LCA1NTYsIDMzMywgNTU2LCA2MTEsIDU1NiwgNjExLCA1NTYsIDMzMywgNjExLCA2MTEsIDI3OCwgMjc4LCA1NTYsIDI3OCwgODg5LCA2MTEsIDYxMSwgNjExLCA2MTEsIDM4OSwgNTU2LCAzMzMsIDYxMSwgNTU2LCA3NzgsIDU1NiwgNTU2LCA1MDAsIDM4OSwgMjgwLCAzODksIDU4NCwgMzMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI4MCwgNTU2LCAzMzMsIDczNywgMzcwLCA1NTYsIDU4NCwgNzM3LCA1NTIsIDQwMCwgNTQ5LCAzMzMsIDMzMywgMzMzLCA1NzYsIDU1NiwgMjc4LCAzMzMsIDMzMywgMzY1LCA1NTYsIDgzNCwgODM0LCA4MzQsIDYxMSwgNzIyLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDcyMiwgMTAwMCwgNzIyLCA2NjcsIDY2NywgNjY3LCA2NjcsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzIyLCA3MjIsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNzc4LCA1ODQsIDc3OCwgNzIyLCA3MjIsIDcyMiwgNzIyLCA2NjcsIDY2NywgNjExLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA4ODksIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNTQ5LCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNTU2LCA2MTEsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNzE5LCA3MjIsIDYxMSwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDc4NSwgNTU2LCA1NTYsIDI3OCwgNzIyLCA1NTYsIDU1NiwgNjExLCAyNzgsIDYxMSwgMjc4LCA2MTEsIDM4NSwgNjExLCA0NzksIDYxMSwgMjc4LCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MDgsIDcyMywgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCAxMDAwLCA5NDQsIDcyMiwgMzg5LCA3MjIsIDM4OSwgNzIyLCAzODksIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2MTEsIDMzMywgNjExLCA0NzksIDYxMSwgMzMzLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA5NDQsIDc3OCwgNjY3LCA1NTYsIDY2NywgNjExLCA1MDAsIDYxMSwgNTAwLCA2MTEsIDUwMCwgMjc4LCA1NTYsIDcyMiwgNTU2LCAxMDAwLCA4ODksIDc3OCwgNjExLCA2NjcsIDU1NiwgNjExLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgNDY1LCA3MjIsIDMzMywgODUzLCA5MDYsIDQ3NCwgODI1LCA5MjcsIDgzOCwgMjc4LCA3MjIsIDcyMiwgNjAxLCA3MTksIDY2NywgNjExLCA3MjIsIDc3OCwgMjc4LCA3MjIsIDY2NywgODMzLCA3MjIsIDY0NCwgNzc4LCA3MjIsIDY2NywgNjAwLCA2MTEsIDY2NywgODIxLCA2NjcsIDgwOSwgODAyLCAyNzgsIDY2NywgNjE1LCA0NTEsIDYxMSwgMjc4LCA1ODIsIDYxNSwgNjEwLCA1NTYsIDYwNiwgNDc1LCA0NjAsIDYxMSwgNTQxLCAyNzgsIDU1OCwgNTU2LCA2MTIsIDU1NiwgNDQ1LCA2MTEsIDc2NiwgNjE5LCA1MjAsIDY4NCwgNDQ2LCA1ODIsIDcxNSwgNTc2LCA3NTMsIDg0NSwgMjc4LCA1ODIsIDYxMSwgNTgyLCA4NDUsIDY2NywgNjY5LCA4ODUsIDU2NywgNzExLCA2NjcsIDI3OCwgMjc2LCA1NTYsIDEwOTQsIDEwNjIsIDg3NSwgNjEwLCA3MjIsIDYyMiwgNzE5LCA3MjIsIDcxOSwgNzIyLCA1NjcsIDcxMiwgNjY3LCA5MDQsIDYyNiwgNzE5LCA3MTksIDYxMCwgNzAyLCA4MzMsIDcyMiwgNzc4LCA3MTksIDY2NywgNzIyLCA2MTEsIDYyMiwgODU0LCA2NjcsIDczMCwgNzAzLCAxMDA1LCAxMDE5LCA4NzAsIDk3OSwgNzE5LCA3MTEsIDEwMzEsIDcxOSwgNTU2LCA2MTgsIDYxNSwgNDE3LCA2MzUsIDU1NiwgNzA5LCA0OTcsIDYxNSwgNjE1LCA1MDAsIDYzNSwgNzQwLCA2MDQsIDYxMSwgNjA0LCA2MTEsIDU1NiwgNDkwLCA1NTYsIDg3NSwgNTU2LCA2MTUsIDU4MSwgODMzLCA4NDQsIDcyOSwgODU0LCA2MTUsIDU1MiwgODU0LCA1ODMsIDU1NiwgNTU2LCA2MTEsIDQxNywgNTUyLCA1NTYsIDI3OCwgMjgxLCAyNzgsIDk2OSwgOTA2LCA2MTEsIDUwMCwgNjE1LCA1NTYsIDYwNCwgNzc4LCA2MTEsIDQ4NywgNDQ3LCA5NDQsIDc3OCwgOTQ0LCA3NzgsIDk0NCwgNzc4LCA2NjcsIDU1NiwgMzMzLCAzMzMsIDU1NiwgMTAwMCwgMTAwMCwgNTUyLCAyNzgsIDI3OCwgMjc4LCAyNzgsIDUwMCwgNTAwLCA1MDAsIDU1NiwgNTU2LCAzNTAsIDEwMDAsIDEwMDAsIDI0MCwgNDc5LCAzMzMsIDMzMywgNjA0LCAzMzMsIDE2NywgMzk2LCA1NTYsIDU1NiwgMTA5NCwgNTU2LCA4ODUsIDQ4OSwgMTExNSwgMTAwMCwgNzY4LCA2MDAsIDgzNCwgODM0LCA4MzQsIDgzNCwgMTAwMCwgNTAwLCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgNTAwLCA0OTQsIDYxMiwgODIzLCA3MTMsIDU4NCwgNTQ5LCA3MTMsIDk3OSwgNzIyLCAyNzQsIDU0OSwgNTQ5LCA1ODMsIDU0OSwgNTQ5LCA2MDQsIDU4NCwgNjA0LCA2MDQsIDcwOCwgNjI1LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MjksIDYwNCwgNjA0LCAzNTQsIDM1NCwgMTAwMCwgOTkwLCA5OTAsIDk5MCwgOTkwLCA0OTQsIDYwNCwgNjA0LCA2MDQsIDYwNCwgMzU0LCAxMDIxLCAxMDUyLCA5MTcsIDc1MCwgNzUwLCA1MzEsIDY1NiwgNTk0LCA1MTAsIDUwMCwgNzUwLCA3NTAsIDYxMSwgNjExLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMjIyLCAyMjIsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzXTsKY29uc3QgTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMzMzLCA0NzQsIDU1NiwgNTU2LCA4ODksIDcyMiwgMjM4LCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAzMzMsIDMzMywgNTg0LCA1ODQsIDU4NCwgNjExLCA5NzUsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDU1NiwgNzIyLCA2MTEsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAzMzMsIDI3OCwgMzMzLCA1ODQsIDU1NiwgMzMzLCA1NTYsIDYxMSwgNTU2LCA2MTEsIDU1NiwgMzMzLCA2MTEsIDYxMSwgMjc4LCAyNzgsIDU1NiwgMjc4LCA4ODksIDYxMSwgNjExLCA2MTEsIDYxMSwgMzg5LCA1NTYsIDMzMywgNjExLCA1NTYsIDc3OCwgNTU2LCA1NTYsIDUwMCwgMzg5LCAyODAsIDM4OSwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjgwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTU2LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNzIyLCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NDksIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NTYsIDYxMSwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA3NDAsIDcyMiwgNjExLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzgyLCA1NTYsIDU1NiwgMjc4LCA3MjIsIDU1NiwgNTU2LCA2MTEsIDI3OCwgNjExLCAyNzgsIDYxMSwgMzk2LCA2MTEsIDQ3OSwgNjExLCAyNzgsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcwOCwgNzIzLCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDEwMDAsIDk0NCwgNzIyLCAzODksIDcyMiwgMzg5LCA3MjIsIDM4OSwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDYxMSwgMzMzLCA2MTEsIDQ3OSwgNjExLCAzMzMsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDk0NCwgNzc4LCA2NjcsIDU1NiwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyNzgsIDU1NiwgNzIyLCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTU2LCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDcyMiwgMzMzLCA4NTQsIDkwNiwgNDczLCA4NDQsIDkzMCwgODQ3LCAyNzgsIDcyMiwgNzIyLCA2MTAsIDY3MSwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDcyMiwgNjY3LCA4MzMsIDcyMiwgNjU3LCA3NzgsIDcxOCwgNjY3LCA1OTAsIDYxMSwgNjY3LCA4MjIsIDY2NywgODI5LCA3ODEsIDI3OCwgNjY3LCA2MjAsIDQ3OSwgNjExLCAyNzgsIDU5MSwgNjIwLCA2MjEsIDU1NiwgNjEwLCA0NzksIDQ5MiwgNjExLCA1NTgsIDI3OCwgNTY2LCA1NTYsIDYwMywgNTU2LCA0NTAsIDYxMSwgNzEyLCA2MDUsIDUzMiwgNjY0LCA0MDksIDU5MSwgNzA0LCA1NzgsIDc3MywgODM0LCAyNzgsIDU5MSwgNjExLCA1OTEsIDgzNCwgNjY3LCA2NjcsIDg4NiwgNjE0LCA3MTksIDY2NywgMjc4LCAyNzgsIDU1NiwgMTA5NCwgMTA0MiwgODU0LCA2MjIsIDcxOSwgNjc3LCA3MTksIDcyMiwgNzA4LCA3MjIsIDYxNCwgNzIyLCA2NjcsIDkyNywgNjQzLCA3MTksIDcxOSwgNjE1LCA2ODcsIDgzMywgNzIyLCA3NzgsIDcxOSwgNjY3LCA3MjIsIDYxMSwgNjc3LCA3ODEsIDY2NywgNzI5LCA3MDgsIDk3OSwgOTg5LCA4NTQsIDEwMDAsIDcwOCwgNzE5LCAxMDQyLCA3MjksIDU1NiwgNjE5LCA2MDQsIDUzNCwgNjE4LCA1NTYsIDczNiwgNTEwLCA2MTEsIDYxMSwgNTA3LCA2MjIsIDc0MCwgNjA0LCA2MTEsIDYxMSwgNjExLCA1NTYsIDg4OSwgNTU2LCA4ODUsIDU1NiwgNjQ2LCA1ODMsIDg4OSwgOTM1LCA3MDcsIDg1NCwgNTk0LCA1NTIsIDg2NSwgNTg5LCA1NTYsIDU1NiwgNjExLCA0NjksIDU2MywgNTU2LCAyNzgsIDI3OCwgMjc4LCA5NjksIDkwNiwgNjExLCA1MDcsIDYxOSwgNTU2LCA2MTEsIDc3OCwgNjExLCA1NzUsIDQ2NywgOTQ0LCA3NzgsIDk0NCwgNzc4LCA5NDQsIDc3OCwgNjY3LCA1NTYsIDMzMywgMzMzLCA1NTYsIDEwMDAsIDEwMDAsIDU1MiwgMjc4LCAyNzgsIDI3OCwgMjc4LCA1MDAsIDUwMCwgNTAwLCA1NTYsIDU1NiwgMzUwLCAxMDAwLCAxMDAwLCAyNDAsIDQ3OSwgMzMzLCAzMzMsIDYwNCwgMzMzLCAxNjcsIDM5NiwgNTU2LCA1NTYsIDExMDQsIDU1NiwgODg1LCA1MTYsIDExNDYsIDEwMDAsIDc2OCwgNjAwLCA4MzQsIDgzNCwgODM0LCA4MzQsIDk5OSwgNTAwLCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgNTAwLCA0OTQsIDYxMiwgODIzLCA3MTMsIDU4NCwgNTQ5LCA3MTMsIDk3OSwgNzIyLCAyNzQsIDU0OSwgNTQ5LCA1ODMsIDU0OSwgNTQ5LCA2MDQsIDU4NCwgNjA0LCA2MDQsIDcwOCwgNjI1LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MjksIDYwNCwgNjA0LCAzNTQsIDM1NCwgMTAwMCwgOTkwLCA5OTAsIDk5MCwgOTkwLCA0OTQsIDYwNCwgNjA0LCA2MDQsIDYwNCwgMzU0LCAxMDIxLCAxMDUyLCA5MTcsIDc1MCwgNzUwLCA1MzEsIDY1NiwgNTk0LCA1MTAsIDUwMCwgNzUwLCA3NTAsIDYxMSwgNjExLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMjIyLCAyMjIsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzXTsKY29uc3QgTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocyA9IFszNjUsIDAsIDMzMywgMjc4LCAyNzgsIDM1NSwgNTU2LCA1NTYsIDg4OSwgNjY3LCAxOTEsIDMzMywgMzMzLCAzODksIDU4NCwgMjc4LCAzMzMsIDI3OCwgMjc4LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCA1ODQsIDU4NCwgNTg0LCA1NTYsIDEwMTUsIDY2NywgNjY3LCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDUwMCwgNjY3LCA1NTYsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAyNzgsIDI3OCwgMjc4LCA0NjksIDU1NiwgMzMzLCA1NTYsIDU1NiwgNTAwLCA1NTYsIDU1NiwgMjc4LCA1NTYsIDU1NiwgMjIyLCAyMjIsIDUwMCwgMjIyLCA4MzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMzMzLCA1MDAsIDI3OCwgNTU2LCA1MDAsIDcyMiwgNTAwLCA1MDAsIDUwMCwgMzM0LCAyNjAsIDMzNCwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjYwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTM3LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA2NjcsIDY2NywgNjY3LCA2NjcsIDY2NywgNjY3LCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTAwLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NDksIDYxMSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1MDAsIDU1NiwgNTAwLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA2MjUsIDcyMiwgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjIyLCAyNzgsIDI3OCwgNzMzLCA0NDQsIDUwMCwgMjIyLCA2NjcsIDUwMCwgNTAwLCA1NTYsIDIyMiwgNTU2LCAyMjIsIDU1NiwgMjgxLCA1NTYsIDQwMCwgNTU2LCAyMjIsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDYxNSwgNzIzLCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDEwMDAsIDk0NCwgNzIyLCAzMzMsIDcyMiwgMzMzLCA3MjIsIDMzMywgNjY3LCA1MDAsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDYxMSwgMjc4LCA2MTEsIDM1NCwgNjExLCAyNzgsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDk0NCwgNzIyLCA2NjcsIDUwMCwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyMjIsIDU1NiwgNjY3LCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTAwLCA2MTEsIDI3OCwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDY2NywgMjc4LCA3ODksIDg0NiwgMzg5LCA3OTQsIDg2NSwgNzc1LCAyMjIsIDY2NywgNjY3LCA1NzAsIDY3MSwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDY2NywgNjY3LCA4MzMsIDcyMiwgNjQ4LCA3NzgsIDcyNSwgNjY3LCA2MDAsIDYxMSwgNjY3LCA4MzcsIDY2NywgODMxLCA3NjEsIDI3OCwgNjY3LCA1NzAsIDQzOSwgNTU1LCAyMjIsIDU1MCwgNTcwLCA1NzEsIDUwMCwgNTU2LCA0MzksIDQ2MywgNTU1LCA1NDIsIDIyMiwgNTAwLCA0OTIsIDU0OCwgNTAwLCA0NDcsIDU1NiwgNjcwLCA1NzMsIDQ4NiwgNjAzLCAzNzQsIDU1MCwgNjUyLCA1NDYsIDcyOCwgNzc5LCAyMjIsIDU1MCwgNTU2LCA1NTAsIDc3OSwgNjY3LCA2NjcsIDg0MywgNTQ0LCA3MDgsIDY2NywgMjc4LCAyNzgsIDUwMCwgMTA2NiwgOTgyLCA4NDQsIDU4OSwgNzE1LCA2MzksIDcyNCwgNjY3LCA2NTEsIDY2NywgNTQ0LCA3MDQsIDY2NywgOTE3LCA2MTQsIDcxNSwgNzE1LCA1ODksIDY4NiwgODMzLCA3MjIsIDc3OCwgNzI1LCA2NjcsIDcyMiwgNjExLCA2MzksIDc5NSwgNjY3LCA3MjcsIDY3MywgOTIwLCA5MjMsIDgwNSwgODg2LCA2NTEsIDY5NCwgMTAyMiwgNjgyLCA1NTYsIDU2MiwgNTIyLCA0OTMsIDU1MywgNTU2LCA2ODgsIDQ2NSwgNTU2LCA1NTYsIDQ3MiwgNTY0LCA2ODYsIDU1MCwgNTU2LCA1NTYsIDU1NiwgNTAwLCA4MzMsIDUwMCwgODM1LCA1MDAsIDU3MiwgNTE4LCA4MzAsIDg1MSwgNjIxLCA3MzYsIDUyNiwgNDkyLCA3NTIsIDUzNCwgNTU2LCA1NTYsIDU1NiwgMzc4LCA0OTYsIDUwMCwgMjIyLCAyMjIsIDIyMiwgOTEwLCA4MjgsIDU1NiwgNDcyLCA1NjUsIDUwMCwgNTU2LCA3NzgsIDU1NiwgNDkyLCAzMzksIDk0NCwgNzIyLCA5NDQsIDcyMiwgOTQ0LCA3MjIsIDY2NywgNTAwLCAzMzMsIDMzMywgNTU2LCAxMDAwLCAxMDAwLCA1NTIsIDIyMiwgMjIyLCAyMjIsIDIyMiwgMzMzLCAzMzMsIDMzMywgNTU2LCA1NTYsIDM1MCwgMTAwMCwgMTAwMCwgMTg4LCAzNTQsIDMzMywgMzMzLCA1MDAsIDMzMywgMTY3LCAzNjUsIDU1NiwgNTU2LCAxMDk0LCA1NTYsIDg4NSwgMzIzLCAxMDgzLCAxMDAwLCA3NjgsIDYwMCwgODM0LCA4MzQsIDgzNCwgODM0LCAxMDAwLCA1MDAsIDk5OCwgNTAwLCAxMDAwLCA1MDAsIDUwMCwgNDk0LCA2MTIsIDgyMywgNzEzLCA1ODQsIDU0OSwgNzEzLCA5NzksIDcxOSwgMjc0LCA1NDksIDU0OSwgNTg0LCA1NDksIDU0OSwgNjA0LCA1ODQsIDYwNCwgNjA0LCA3MDgsIDYyNSwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzI5LCA2MDQsIDYwNCwgMzU0LCAzNTQsIDEwMDAsIDk5MCwgOTkwLCA5OTAsIDk5MCwgNDk0LCA2MDQsIDYwNCwgNjA0LCA2MDQsIDM1NCwgMTAyMSwgMTA1MiwgOTE3LCA3NTAsIDc1MCwgNTMxLCA2NTYsIDU5NCwgNTEwLCA1MDAsIDc1MCwgNzUwLCA1MDAsIDUwMCwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDIyMiwgMjIyLCAyOTQsIDI5NCwgMzI0LCAzMjQsIDMxNiwgMzI4LCAzOTgsIDI4NV07CmNvbnN0IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMjc4LCAzNTUsIDU1NiwgNTU2LCA4ODksIDY2NywgMTkxLCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgNTg0LCA1ODQsIDU4NCwgNTU2LCAxMDE1LCA2NjcsIDY2NywgNzIyLCA3MjIsIDY2NywgNjExLCA3NzgsIDcyMiwgMjc4LCA1MDAsIDY2NywgNTU2LCA4MzMsIDcyMiwgNzc4LCA2NjcsIDc3OCwgNzIyLCA2NjcsIDYxMSwgNzIyLCA2NjcsIDk0NCwgNjY3LCA2NjcsIDYxMSwgMjc4LCAyNzgsIDI3OCwgNDY5LCA1NTYsIDMzMywgNTU2LCA1NTYsIDUwMCwgNTU2LCA1NTYsIDI3OCwgNTU2LCA1NTYsIDIyMiwgMjIyLCA1MDAsIDIyMiwgODMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDMzMywgNTAwLCAyNzgsIDU1NiwgNTAwLCA3MjIsIDUwMCwgNTAwLCA1MDAsIDMzNCwgMjYwLCAzMzQsIDU4NCwgMzMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI2MCwgNTU2LCAzMzMsIDczNywgMzcwLCA1NTYsIDU4NCwgNzM3LCA1NTIsIDQwMCwgNTQ5LCAzMzMsIDMzMywgMzMzLCA1NzYsIDUzNywgMjc4LCAzMzMsIDMzMywgMzY1LCA1NTYsIDgzNCwgODM0LCA4MzQsIDYxMSwgNjY3LCA2NjcsIDY2NywgNjY3LCA2NjcsIDY2NywgMTAwMCwgNzIyLCA2NjcsIDY2NywgNjY3LCA2NjcsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzIyLCA3MjIsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNzc4LCA1ODQsIDc3OCwgNzIyLCA3MjIsIDcyMiwgNzIyLCA2NjcsIDY2NywgNjExLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA4ODksIDUwMCwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTQ5LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTAwLCA1NTYsIDUwMCwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNjE1LCA3MjIsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDIyMiwgMjc4LCAyNzgsIDczNSwgNDQ0LCA1MDAsIDIyMiwgNjY3LCA1MDAsIDUwMCwgNTU2LCAyMjIsIDU1NiwgMjIyLCA1NTYsIDI5MiwgNTU2LCAzMzQsIDU1NiwgMjIyLCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA2MDQsIDcyMywgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCAxMDAwLCA5NDQsIDcyMiwgMzMzLCA3MjIsIDMzMywgNzIyLCAzMzMsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDY2NywgNTAwLCA2MTEsIDI3OCwgNjExLCAzNzUsIDYxMSwgMjc4LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA5NDQsIDcyMiwgNjY3LCA1MDAsIDY2NywgNjExLCA1MDAsIDYxMSwgNTAwLCA2MTEsIDUwMCwgMjIyLCA1NTYsIDY2NywgNTU2LCAxMDAwLCA4ODksIDc3OCwgNjExLCA2NjcsIDUwMCwgNjExLCAyNzgsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCA2NjcsIDI3OCwgNzg0LCA4MzgsIDM4NCwgNzc0LCA4NTUsIDc1MiwgMjIyLCA2NjcsIDY2NywgNTUxLCA2NjgsIDY2NywgNjExLCA3MjIsIDc3OCwgMjc4LCA2NjcsIDY2OCwgODMzLCA3MjIsIDY1MCwgNzc4LCA3MjIsIDY2NywgNjE4LCA2MTEsIDY2NywgNzk4LCA2NjcsIDgzNSwgNzQ4LCAyNzgsIDY2NywgNTc4LCA0NDYsIDU1NiwgMjIyLCA1NDcsIDU3OCwgNTc1LCA1MDAsIDU1NywgNDQ2LCA0NDEsIDU1NiwgNTU2LCAyMjIsIDUwMCwgNTAwLCA1NzYsIDUwMCwgNDQ4LCA1NTYsIDY5MCwgNTY5LCA0ODIsIDYxNywgMzk1LCA1NDcsIDY0OCwgNTI1LCA3MTMsIDc4MSwgMjIyLCA1NDcsIDU1NiwgNTQ3LCA3ODEsIDY2NywgNjY3LCA4NjUsIDU0MiwgNzE5LCA2NjcsIDI3OCwgMjc4LCA1MDAsIDEwNTcsIDEwMTAsIDg1NCwgNTgzLCA3MjIsIDYzNSwgNzE5LCA2NjcsIDY1NiwgNjY3LCA1NDIsIDY3NywgNjY3LCA5MjMsIDYwNCwgNzE5LCA3MTksIDU4MywgNjU2LCA4MzMsIDcyMiwgNzc4LCA3MTksIDY2NywgNzIyLCA2MTEsIDYzNSwgNzYwLCA2NjcsIDc0MCwgNjY3LCA5MTcsIDkzOCwgNzkyLCA4ODUsIDY1NiwgNzE5LCAxMDEwLCA3MjIsIDU1NiwgNTczLCA1MzEsIDM2NSwgNTgzLCA1NTYsIDY2OSwgNDU4LCA1NTksIDU1OSwgNDM4LCA1ODMsIDY4OCwgNTUyLCA1NTYsIDU0MiwgNTU2LCA1MDAsIDQ1OCwgNTAwLCA4MjMsIDUwMCwgNTczLCA1MjEsIDgwMiwgODIzLCA2MjUsIDcxOSwgNTIxLCA1MTAsIDc1MCwgNTQyLCA1NTYsIDU1NiwgNTU2LCAzNjUsIDUxMCwgNTAwLCAyMjIsIDI3OCwgMjIyLCA5MDYsIDgxMiwgNTU2LCA0MzgsIDU1OSwgNTAwLCA1NTIsIDc3OCwgNTU2LCA0ODksIDQxMSwgOTQ0LCA3MjIsIDk0NCwgNzIyLCA5NDQsIDcyMiwgNjY3LCA1MDAsIDMzMywgMzMzLCA1NTYsIDEwMDAsIDEwMDAsIDU1MiwgMjIyLCAyMjIsIDIyMiwgMjIyLCAzMzMsIDMzMywgMzMzLCA1NTYsIDU1NiwgMzUwLCAxMDAwLCAxMDAwLCAxODgsIDM1NCwgMzMzLCAzMzMsIDUwMCwgMzMzLCAxNjcsIDM2NSwgNTU2LCA1NTYsIDEwOTQsIDU1NiwgODg1LCAzMjMsIDEwNzMsIDEwMDAsIDc2OCwgNjAwLCA4MzQsIDgzNCwgODM0LCA4MzQsIDEwMDAsIDUwMCwgMTAwMCwgNTAwLCAxMDAwLCA1MDAsIDUwMCwgNDk0LCA2MTIsIDgyMywgNzEzLCA1ODQsIDU0OSwgNzEzLCA5NzksIDcxOSwgMjc0LCA1NDksIDU0OSwgNTgzLCA1NDksIDU0OSwgNjA0LCA1ODQsIDYwNCwgNjA0LCA3MDgsIDYyNSwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzI5LCA2MDQsIDYwNCwgMzU0LCAzNTQsIDEwMDAsIDk5MCwgOTkwLCA5OTAsIDk5MCwgNDk0LCA2MDQsIDYwNCwgNjA0LCA2MDQsIDM1NCwgMTAyMSwgMTA1MiwgOTE3LCA3NTAsIDc1MCwgNTMxLCA2NTYsIDU5NCwgNTEwLCA1MDAsIDc1MCwgNzUwLCA1MDAsIDUwMCwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDIyMiwgMjIyLCAyOTQsIDI5NCwgMzI0LCAzMjQsIDMxNiwgMzI4LCAzOTgsIDI4NV07CmNvbnN0IExpYmVyYXRpb25TYW5zUmVndWxhck1hcHBpbmcgPSBbLTEsIC0xLCAtMSwgMzIsIDMzLCAzNCwgMzUsIDM2LCAzNywgMzgsIDM5LCA0MCwgNDEsIDQyLCA0MywgNDQsIDQ1LCA0NiwgNDcsIDQ4LCA0OSwgNTAsIDUxLCA1MiwgNTMsIDU0LCA1NSwgNTYsIDU3LCA1OCwgNTksIDYwLCA2MSwgNjIsIDYzLCA2NCwgNjUsIDY2LCA2NywgNjgsIDY5LCA3MCwgNzEsIDcyLCA3MywgNzQsIDc1LCA3NiwgNzcsIDc4LCA3OSwgODAsIDgxLCA4MiwgODMsIDg0LCA4NSwgODYsIDg3LCA4OCwgODksIDkwLCA5MSwgOTIsIDkzLCA5NCwgOTUsIDk2LCA5NywgOTgsIDk5LCAxMDAsIDEwMSwgMTAyLCAxMDMsIDEwNCwgMTA1LCAxMDYsIDEwNywgMTA4LCAxMDksIDExMCwgMTExLCAxMTIsIDExMywgMTE0LCAxMTUsIDExNiwgMTE3LCAxMTgsIDExOSwgMTIwLCAxMjEsIDEyMiwgMTIzLCAxMjQsIDEyNSwgMTI2LCAxNjEsIDE2MiwgMTYzLCAxNjQsIDE2NSwgMTY2LCAxNjcsIDE2OCwgMTY5LCAxNzAsIDE3MSwgMTcyLCAxNzQsIDE3NSwgMTc2LCAxNzcsIDE3OCwgMTc5LCAxODAsIDE4MSwgMTgyLCAxODMsIDE4NCwgMTg1LCAxODYsIDE4NywgMTg4LCAxODksIDE5MCwgMTkxLCAxOTIsIDE5MywgMTk0LCAxOTUsIDE5NiwgMTk3LCAxOTgsIDE5OSwgMjAwLCAyMDEsIDIwMiwgMjAzLCAyMDQsIDIwNSwgMjA2LCAyMDcsIDIwOCwgMjA5LCAyMTAsIDIxMSwgMjEyLCAyMTMsIDIxNCwgMjE1LCAyMTYsIDIxNywgMjE4LCAyMTksIDIyMCwgMjIxLCAyMjIsIDIyMywgMjI0LCAyMjUsIDIyNiwgMjI3LCAyMjgsIDIyOSwgMjMwLCAyMzEsIDIzMiwgMjMzLCAyMzQsIDIzNSwgMjM2LCAyMzcsIDIzOCwgMjM5LCAyNDAsIDI0MSwgMjQyLCAyNDMsIDI0NCwgMjQ1LCAyNDYsIDI0NywgMjQ4LCAyNDksIDI1MCwgMjUxLCAyNTIsIDI1MywgMjU0LCAyNTUsIDI1NiwgMjU3LCAyNTgsIDI1OSwgMjYwLCAyNjEsIDI2MiwgMjYzLCAyNjQsIDI2NSwgMjY2LCAyNjcsIDI2OCwgMjY5LCAyNzAsIDI3MSwgMjcyLCAyNzMsIDI3NCwgMjc1LCAyNzYsIDI3NywgMjc4LCAyNzksIDI4MCwgMjgxLCAyODIsIDI4MywgMjg0LCAyODUsIDI4NiwgMjg3LCAyODgsIDI4OSwgMjkwLCAyOTEsIDI5MiwgMjkzLCAyOTQsIDI5NSwgMjk2LCAyOTcsIDI5OCwgMjk5LCAzMDAsIDMwMSwgMzAyLCAzMDMsIDMwNCwgMzA1LCAzMDYsIDMwNywgMzA4LCAzMDksIDMxMCwgMzExLCAzMTIsIDMxMywgMzE0LCAzMTUsIDMxNiwgMzE3LCAzMTgsIDMxOSwgMzIwLCAzMjEsIDMyMiwgMzIzLCAzMjQsIDMyNSwgMzI2LCAzMjcsIDMyOCwgMzI5LCAzMzAsIDMzMSwgMzMyLCAzMzMsIDMzNCwgMzM1LCAzMzYsIDMzNywgMzM4LCAzMzksIDM0MCwgMzQxLCAzNDIsIDM0MywgMzQ0LCAzNDUsIDM0NiwgMzQ3LCAzNDgsIDM0OSwgMzUwLCAzNTEsIDM1MiwgMzUzLCAzNTQsIDM1NSwgMzU2LCAzNTcsIDM1OCwgMzU5LCAzNjAsIDM2MSwgMzYyLCAzNjMsIDM2NCwgMzY1LCAzNjYsIDM2NywgMzY4LCAzNjksIDM3MCwgMzcxLCAzNzIsIDM3MywgMzc0LCAzNzUsIDM3NiwgMzc3LCAzNzgsIDM3OSwgMzgwLCAzODEsIDM4MiwgMzgzLCA0MDIsIDUwNiwgNTA3LCA1MDgsIDUwOSwgNTEwLCA1MTEsIDUzNiwgNTM3LCA1MzgsIDUzOSwgNzEwLCA3MTEsIDcxMywgNzI4LCA3MjksIDczMCwgNzMxLCA3MzIsIDczMywgOTAwLCA5MDEsIDkwMiwgOTAzLCA5MDQsIDkwNSwgOTA2LCA5MDgsIDkxMCwgOTExLCA5MTIsIDkxMywgOTE0LCA5MTUsIDkxNiwgOTE3LCA5MTgsIDkxOSwgOTIwLCA5MjEsIDkyMiwgOTIzLCA5MjQsIDkyNSwgOTI2LCA5MjcsIDkyOCwgOTI5LCA5MzEsIDkzMiwgOTMzLCA5MzQsIDkzNSwgOTM2LCA5MzcsIDkzOCwgOTM5LCA5NDAsIDk0MSwgOTQyLCA5NDMsIDk0NCwgOTQ1LCA5NDYsIDk0NywgOTQ4LCA5NDksIDk1MCwgOTUxLCA5NTIsIDk1MywgOTU0LCA5NTUsIDk1NiwgOTU3LCA5NTgsIDk1OSwgOTYwLCA5NjEsIDk2MiwgOTYzLCA5NjQsIDk2NSwgOTY2LCA5NjcsIDk2OCwgOTY5LCA5NzAsIDk3MSwgOTcyLCA5NzMsIDk3NCwgMTAyNCwgMTAyNSwgMTAyNiwgMTAyNywgMTAyOCwgMTAyOSwgMTAzMCwgMTAzMSwgMTAzMiwgMTAzMywgMTAzNCwgMTAzNSwgMTAzNiwgMTAzNywgMTAzOCwgMTAzOSwgMTA0MCwgMTA0MSwgMTA0MiwgMTA0MywgMTA0NCwgMTA0NSwgMTA0NiwgMTA0NywgMTA0OCwgMTA0OSwgMTA1MCwgMTA1MSwgMTA1MiwgMTA1MywgMTA1NCwgMTA1NSwgMTA1NiwgMTA1NywgMTA1OCwgMTA1OSwgMTA2MCwgMTA2MSwgMTA2MiwgMTA2MywgMTA2NCwgMTA2NSwgMTA2NiwgMTA2NywgMTA2OCwgMTA2OSwgMTA3MCwgMTA3MSwgMTA3MiwgMTA3MywgMTA3NCwgMTA3NSwgMTA3NiwgMTA3NywgMTA3OCwgMTA3OSwgMTA4MCwgMTA4MSwgMTA4MiwgMTA4MywgMTA4NCwgMTA4NSwgMTA4NiwgMTA4NywgMTA4OCwgMTA4OSwgMTA5MCwgMTA5MSwgMTA5MiwgMTA5MywgMTA5NCwgMTA5NSwgMTA5NiwgMTA5NywgMTA5OCwgMTA5OSwgMTEwMCwgMTEwMSwgMTEwMiwgMTEwMywgMTEwNCwgMTEwNSwgMTEwNiwgMTEwNywgMTEwOCwgMTEwOSwgMTExMCwgMTExMSwgMTExMiwgMTExMywgMTExNCwgMTExNSwgMTExNiwgMTExNywgMTExOCwgMTExOSwgMTEzOCwgMTEzOSwgMTE2OCwgMTE2OSwgNzgwOCwgNzgwOSwgNzgxMCwgNzgxMSwgNzgxMiwgNzgxMywgNzkyMiwgNzkyMywgODIwOCwgODIwOSwgODIxMSwgODIxMiwgODIxMywgODIxNSwgODIxNiwgODIxNywgODIxOCwgODIxOSwgODIyMCwgODIyMSwgODIyMiwgODIyNCwgODIyNSwgODIyNiwgODIzMCwgODI0MCwgODI0MiwgODI0MywgODI0OSwgODI1MCwgODI1MiwgODI1NCwgODI2MCwgODMxOSwgODM1NSwgODM1NiwgODM1OSwgODM2NCwgODQ1MywgODQ2NywgODQ3MCwgODQ4MiwgODQ4NiwgODQ5NCwgODUzOSwgODU0MCwgODU0MSwgODU0MiwgODU5MiwgODU5MywgODU5NCwgODU5NSwgODU5NiwgODU5NywgODYxNiwgODcwNiwgODcxMCwgODcxOSwgODcyMSwgODcyMiwgODczMCwgODczNCwgODczNSwgODc0NSwgODc0NywgODc3NiwgODgwMCwgODgwMSwgODgwNCwgODgwNSwgODk2MiwgODk3NiwgODk5MiwgODk5MywgOTQ3MiwgOTQ3NCwgOTQ4NCwgOTQ4OCwgOTQ5MiwgOTQ5NiwgOTUwMCwgOTUwOCwgOTUxNiwgOTUyNCwgOTUzMiwgOTU1MiwgOTU1MywgOTU1NCwgOTU1NSwgOTU1NiwgOTU1NywgOTU1OCwgOTU1OSwgOTU2MCwgOTU2MSwgOTU2MiwgOTU2MywgOTU2NCwgOTU2NSwgOTU2NiwgOTU2NywgOTU2OCwgOTU2OSwgOTU3MCwgOTU3MSwgOTU3MiwgOTU3MywgOTU3NCwgOTU3NSwgOTU3NiwgOTU3NywgOTU3OCwgOTU3OSwgOTU4MCwgOTYwMCwgOTYwNCwgOTYwOCwgOTYxMiwgOTYxNiwgOTYxNywgOTYxOCwgOTYxOSwgOTYzMiwgOTYzMywgOTY0MiwgOTY0MywgOTY0NCwgOTY1MCwgOTY1OCwgOTY2MCwgOTY2OCwgOTY3NCwgOTY3NSwgOTY3OSwgOTY4OCwgOTY4OSwgOTcwMiwgOTc4NiwgOTc4NywgOTc4OCwgOTc5MiwgOTc5NCwgOTgyNCwgOTgyNywgOTgyOSwgOTgzMCwgOTgzNCwgOTgzNSwgOTgzNiwgNjE0NDEsIDYxNDQyLCA2MTQ0NSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xXTsKCjsvLyAuL3NyYy9jb3JlL215cmlhZHByb19mYWN0b3JzLmpzCmNvbnN0IE15cmlhZFByb0JvbGRGYWN0b3JzID0gWzEuMzY4OTgsIDEsIDEsIDAuNzI3MDYsIDAuODA0NzksIDAuODM3MzQsIDAuOTg4OTQsIDAuOTk3OTMsIDAuOTg5NywgMC45Mzg4NCwgMC44NjIwOSwgMC45NDI5MiwgMC45NDI5MiwgMS4xNjY2MSwgMS4wMjA1OCwgMC45MzU4MiwgMC45NjY5NCwgMC45MzU4MiwgMS4xOTEzNywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC43ODA3NiwgMC43ODA3NiwgMS4wMjA1OCwgMS4wMjA1OCwgMS4wMjA1OCwgMC43Mjg1MSwgMC43ODk2NiwgMC45MDgzOCwgMC44MzYzNywgMC44MjM5MSwgMC45NjM3NiwgMC44MDA2MSwgMC44NjI3NSwgMC44NzY4LCAwLjk1NDA3LCAxLjAyNTgsIDAuNzM5MDEsIDAuODUwMjIsIDAuODM2NTUsIDEuMDE1NiwgMC45NTU0NiwgMC45MjE3OSwgMC44NzEwNywgMC45MjE3OSwgMC44MjExNCwgMC44MDk2LCAwLjg5NzEzLCAwLjk0NDM4LCAwLjk1MzUzLCAwLjk0MDgzLCAwLjkxOTA1LCAwLjkwNDA2LCAwLjk0NDYsIDAuOTQyOTIsIDEuMTg3NzcsIDAuOTQyOTIsIDEuMDIwNTgsIDAuODk5MDMsIDAuOTAwODgsIDAuOTQ5MzgsIDAuOTc4OTgsIDAuODEwOTMsIDAuOTc1NzEsIDAuOTQ5MzgsIDEuMDI0LCAwLjk1NzcsIDAuOTU5MzMsIDAuOTg2MjEsIDEuMDQ3NCwgMC45NzQ1NSwgMC45ODk4MSwgMC45NjcyLCAwLjk1OTMzLCAwLjk0NDYsIDAuOTc4OTgsIDAuOTc0MDcsIDAuOTc2NDYsIDAuNzgwMzYsIDEuMTAyMDgsIDAuOTU0NDIsIDAuOTUyOTgsIDAuOTc1NzksIDAuOTMzMiwgMC45NDAzOSwgMC45MzgsIDAuODA2ODcsIDEuMDExNDksIDAuODA2ODcsIDEuMDIwNTgsIDAuODA0NzksIDAuOTk3OTMsIDAuOTk3OTMsIDAuOTk3OTMsIDAuOTk3OTMsIDEuMDExNDksIDEuMDA4NzIsIDAuOTAwODgsIDAuOTE4ODIsIDEuMDIxMywgMC44MzYxLCAxLjAyMDU4LCAwLjYyMjk1LCAwLjU0MzI0LCAwLjg5MDIyLCAxLjA4NTk1LCAxLCAxLCAwLjkwMDg4LCAxLCAwLjk3NDU1LCAwLjkzNTgyLCAwLjkwMDg4LCAxLCAxLjA1Njg2LCAwLjgzNjEsIDAuOTk2NDIsIDAuOTk2NDIsIDAuOTk2NDIsIDAuNzI4NTEsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuOTA4MzgsIDAuODY4LCAwLjgyMzkxLCAwLjgwMDYxLCAwLjgwMDYxLCAwLjgwMDYxLCAwLjgwMDYxLCAxLjAyNTgsIDEuMDI1OCwgMS4wMjU4LCAxLjAyNTgsIDAuOTc0ODQsIDAuOTU1NDYsIDAuOTIxNzksIDAuOTIxNzksIDAuOTIxNzksIDAuOTIxNzksIDAuOTIxNzksIDEuMDIwNTgsIDAuOTIxNzksIDAuOTQ0MzgsIDAuOTQ0MzgsIDAuOTQ0MzgsIDAuOTQ0MzgsIDAuOTA0MDYsIDAuODY5NTgsIDAuOTgyMjUsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTQ5MzgsIDAuOTAzMSwgMC44MTA5MywgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45ODYyMSwgMC45ODYyMSwgMC45ODYyMSwgMC45ODYyMSwgMC45Mzk2OSwgMC45NTkzMywgMC45NDQ2LCAwLjk0NDYsIDAuOTQ0NiwgMC45NDQ2LCAwLjk0NDYsIDEuMDg1OTUsIDAuOTQ0NiwgMC45NTQ0MiwgMC45NTQ0MiwgMC45NTQ0MiwgMC45NTQ0MiwgMC45NDAzOSwgMC45Nzg5OCwgMC45NDAzOSwgMC45MDgzOCwgMC45NDkzOCwgMC45MDgzOCwgMC45NDkzOCwgMC45MDgzOCwgMC45NDkzOCwgMC44MjM5MSwgMC44MTA5MywgMC44MjM5MSwgMC44MTA5MywgMC44MjM5MSwgMC44MTA5MywgMC44MjM5MSwgMC44MTA5MywgMC45NjM3NiwgMC44NDMxMywgMC45NzQ4NCwgMC45NzU3MSwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44MDA2MSwgMC45NDkzOCwgMC44NzY4LCAwLjk1NzcsIDAuODc2OCwgMC45NTc3LCAwLjg3NjgsIDAuOTU3NywgMSwgMSwgMC45NTQwNywgMC45NTkzMywgMC45NzA2OSwgMC45NTkzMywgMS4wMjU4LCAwLjk4NjIxLCAxLjAyNTgsIDAuOTg2MjEsIDEuMDI1OCwgMC45ODYyMSwgMS4wMjU4LCAwLjk4NjIxLCAxLjAyNTgsIDAuOTg2MjEsIDAuODg3LCAxLjAxNTkxLCAwLjczOTAxLCAxLjA0NzQsIDEsIDEsIDAuOTc0NTUsIDAuODM2NTUsIDAuOTg5ODEsIDEsIDEsIDAuODM2NTUsIDAuNzM5NzcsIDAuODM2NTUsIDAuNzM5MDMsIDAuODQ2MzgsIDEuMDMzLCAwLjk1NTQ2LCAwLjk1OTMzLCAxLCAxLCAwLjk1NTQ2LCAwLjk1OTMzLCAwLjgyNzEsIDAuOTU0MTcsIDAuOTU5MzMsIDAuOTIxNzksIDAuOTQ0NiwgMC45MjE3OSwgMC45NDQ2LCAwLjkyMTc5LCAwLjk0NDYsIDAuOTM2LCAwLjkxOTY0LCAwLjgyMTE0LCAwLjk3NjQ2LCAxLCAxLCAwLjgyMTE0LCAwLjk3NjQ2LCAwLjgwOTYsIDAuNzgwMzYsIDAuODA5NiwgMC43ODAzNiwgMSwgMSwgMC44MDk2LCAwLjc4MDM2LCAxLCAxLCAwLjg5NzEzLCAwLjc3NDUyLCAwLjg5NzEzLCAxLjEwMjA4LCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0NDM4LCAwLjk1NDQyLCAwLjk0MDgzLCAwLjk3NTc5LCAwLjkwNDA2LCAwLjk0MDM5LCAwLjkwNDA2LCAwLjk0NDYsIDAuOTM4LCAwLjk0NDYsIDAuOTM4LCAwLjk0NDYsIDAuOTM4LCAxLCAwLjk5NzkzLCAwLjkwODM4LCAwLjk0OTM4LCAwLjg2OCwgMC45MDMxLCAwLjkyMTc5LCAwLjk0NDYsIDEsIDEsIDAuODk3MTMsIDEuMTAyMDgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTA5ODksIDAuOTM1OCwgMC45MTk0NSwgMC44MzE4MSwgMC43NTI2MSwgMC44Nzk5MiwgMC44Mjk3NiwgMC45NjAzNCwgMC44MzY4OSwgMC45NzI2OCwgMS4wMDc4LCAwLjkwODM4LCAwLjgzNjM3LCAwLjgwMTksIDAuOTAxNTcsIDAuODAwNjEsIDAuOTQ0NiwgMC45NTQwNywgMC45MjQzNiwgMS4wMjU4LCAwLjg1MDIyLCAwLjk3MTUzLCAxLjAxNTYsIDAuOTU1NDYsIDAuODkxOTIsIDAuOTIxNzksIDAuOTIzNjEsIDAuODcxMDcsIDAuOTYzMTgsIDAuODk3MTMsIDAuOTM3MDQsIDAuOTU2MzgsIDAuOTE5MDUsIDAuOTE3MDksIDAuOTI3OTYsIDEuMDI1OCwgMC45MzcwNCwgMC45NDgzNiwgMS4wMzczLCAwLjk1OTMzLCAxLjAwNzgsIDAuOTU4NzEsIDAuOTQ4MzYsIDAuOTYxNzQsIDAuOTI2MDEsIDAuOTQ5OCwgMC45ODYwNywgMC45NTc3NiwgMC45NTkzMywgMS4wNTQ1MywgMS4wMDc4LCAwLjk4Mjc1LCAwLjkzMTQsIDAuOTU2MTcsIDAuOTE3MDEsIDEuMDU5OTMsIDAuOTQ0NiwgMC43ODM2NywgMC45NTUzLCAxLCAwLjg2ODMyLCAxLjAxMjgsIDAuOTU4NzEsIDAuOTkzOTQsIDAuODc1NDgsIDAuOTYzNjEsIDAuODY3NzQsIDEuMDA3OCwgMC45NTg3MSwgMC45NDQ2LCAwLjk1ODcxLCAwLjg2Nzc0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk0MDgzLCAwLjk3NTc5LCAwLjk0MDgzLCAwLjk3NTc5LCAwLjk0MDgzLCAwLjk3NTc5LCAwLjkwNDA2LCAwLjk0MDM5LCAwLjk2Njk0LCAxLCAwLjg5OTAzLCAxLCAxLCAxLCAwLjkzNTgyLCAwLjkzNTgyLCAwLjkzNTgyLCAxLCAwLjkwOCwgMC45MDgsIDAuOTE4LCAwLjk0MjE5LCAwLjk0MjE5LCAwLjk2NTQ0LCAxLCAxLjI4NSwgMSwgMSwgMC44MTA3OSwgMC44MTA3OSwgMSwgMSwgMC43NDg1NCwgMSwgMSwgMSwgMSwgMC45OTc5MywgMSwgMSwgMSwgMC42NSwgMSwgMS4zNjE0NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4xNzE3MywgMSwgMC44MDUzNSwgMC43NjE2OSwgMS4wMjA1OCwgMS4wNzMyLCAxLjA1NDg2LCAxLCAxLCAxLjMwNjkyLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjE2MTYxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgTXlyaWFkUHJvQm9sZE1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9Owpjb25zdCBNeXJpYWRQcm9Cb2xkSXRhbGljRmFjdG9ycyA9IFsxLjM2ODk4LCAxLCAxLCAwLjY2MjI3LCAwLjgwNzc5LCAwLjgxNjI1LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3NzMzLCAwLjkyMjIyLCAwLjgzMjY2LCAwLjk0MjkyLCAwLjk0MjkyLCAxLjE2MTQ4LCAxLjAyMDU4LCAwLjkzNTgyLCAwLjk2Njk0LCAwLjkzNTgyLCAxLjE3MzM3LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjc4MDc2LCAwLjc4MDc2LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjcxNTQxLCAwLjc2ODEzLCAwLjg1NTc2LCAwLjgwNTkxLCAwLjgwNzI5LCAwLjk0Mjk5LCAwLjc3NTEyLCAwLjgzNjU1LCAwLjg2NTIzLCAwLjkyMjIyLCAwLjk4NjIxLCAwLjcxNzQzLCAwLjgxNjk4LCAwLjc5NzI2LCAwLjk4NTU4LCAwLjkyMjIyLCAwLjkwNjM3LCAwLjgzODA5LCAwLjkwNjM3LCAwLjgwNzI5LCAwLjc2NDYzLCAwLjg2Mjc1LCAwLjkwNjk5LCAwLjkxNjA1LCAwLjkxNTQsIDAuODUzMDgsIDAuODU0NTgsIDAuOTA1MzEsIDAuOTQyOTIsIDEuMjEyOTYsIDAuOTQyOTIsIDEuMDIwNTgsIDAuODk5MDMsIDEuMTg2MTYsIDAuOTk2MTMsIDAuOTE2NzcsIDAuNzgyMTYsIDAuOTE2NzcsIDAuOTAwODMsIDAuOTg3OTYsIDAuOTEzNSwgMC45MjE2OCwgMC45NTM4MSwgMC45ODk4MSwgMC45NTI5OCwgMC45NTM4MSwgMC45MzQ1OSwgMC45MjE2OCwgMC45MTUxMywgMC45MjAwNCwgMC45MTY3NywgMC45NTA3NywgMC43NDgsIDEuMDQ1MDIsIDAuOTE2NzcsIDAuOTIwNjEsIDAuOTQyMzYsIDAuODk1NDQsIDAuODkzNjQsIDAuOSwgMC44MDY4NywgMC44NTc4LCAwLjgwNjg3LCAxLjAyMDU4LCAwLjgwNzc5LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjg1NzgsIDAuOTk5NzMsIDEuMTg2MTYsIDAuOTEzMzksIDEuMDgwNzQsIDAuODI4OTEsIDEuMDIwNTgsIDAuNTU1MDksIDAuNzE1MjYsIDAuODkwMjIsIDEuMDg1OTUsIDEsIDEsIDEuMTg2MTYsIDEsIDAuOTY3MzYsIDAuOTM1ODIsIDEuMTg2MTYsIDEsIDEuMDQ4NjQsIDAuODI3MTEsIDAuOTkwNDMsIDAuOTkwNDMsIDAuOTkwNDMsIDAuNzE1NDEsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODQ1LCAwLjgwNzI5LCAwLjc3NTEyLCAwLjc3NTEyLCAwLjc3NTEyLCAwLjc3NTEyLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk1OTYxLCAwLjkyMjIyLCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAxLjAyMDU4LCAwLjkwMjUxLCAwLjkwNjk5LCAwLjkwNjk5LCAwLjkwNjk5LCAwLjkwNjk5LCAwLjg1NDU4LCAwLjgzNjU5LCAwLjk0OTUxLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjg1ODExLCAwLjc4MjE2LCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjkxMzUsIDAuOTIxNjgsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDEuMDg1OTUsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuODkzNjQsIDAuOTIzMzIsIDAuODkzNjQsIDAuODU1NzYsIDAuOTk2MTMsIDAuODU1NzYsIDAuOTk2MTMsIDAuODU1NzYsIDAuOTk2MTMsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuOTQyOTksIDAuNzY3ODMsIDAuOTU5NjEsIDAuOTE2NzcsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuODY1MjMsIDAuOTEzNSwgMC44NjUyMywgMC45MTM1LCAwLjg2NTIzLCAwLjkxMzUsIDEsIDEsIDAuOTIyMjIsIDAuOTIxNjgsIDAuOTIyMjIsIDAuOTIxNjgsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuODYwMzYsIDAuOTcwOTYsIDAuNzE3NDMsIDAuOTg5ODEsIDEsIDEsIDAuOTUyOTgsIDAuNzk3MjYsIDAuOTUzODEsIDEsIDEsIDAuNzk3MjYsIDAuNjg5NCwgMC43OTcyNiwgMC43NDMyMSwgMC44MTY5MSwgMS4wMDA2LCAwLjkyMjIyLCAwLjkyMTY4LCAxLCAxLCAwLjkyMjIyLCAwLjkyMTY4LCAwLjc5NDY0LCAwLjkyMDk4LCAwLjkyMTY4LCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwOSwgMC44NzUxNCwgMC44MDcyOSwgMC45NTA3NywgMSwgMSwgMC44MDcyOSwgMC45NTA3NywgMC43NjQ2MywgMC43NDgsIDAuNzY0NjMsIDAuNzQ4LCAxLCAxLCAwLjc2NDYzLCAwLjc0OCwgMSwgMSwgMC44NjI3NSwgMC43MjY1MSwgMC44NjI3NSwgMS4wNDUwMiwgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MTU0LCAwLjk0MjM2LCAwLjg1NDU4LCAwLjg5MzY0LCAwLjg1NDU4LCAwLjkwNTMxLCAwLjksIDAuOTA1MzEsIDAuOSwgMC45MDUzMSwgMC45LCAxLCAwLjk3Mjc2LCAwLjg1NTc2LCAwLjk5NjEzLCAwLjg0NSwgMC44NTgxMSwgMC45MDI1MSwgMC45MTY3NywgMSwgMSwgMC44NjI3NSwgMS4wNDUwMiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4wMDg5OSwgMS4zMDYyOCwgMC44NTU3NiwgMC44MDE3OCwgMC42Njg2MiwgMC43OTI3LCAwLjY5MzIzLCAwLjg4MTI3LCAwLjcyNDU5LCAwLjg5NzExLCAwLjk1MzgxLCAwLjg1NTc2LCAwLjgwNTkxLCAwLjc4MDUsIDAuOTQ3MjksIDAuNzc1MTIsIDAuOTA1MzEsIDAuOTIyMjIsIDAuOTA2MzcsIDAuOTg2MjEsIDAuODE2OTgsIDAuOTI2NTUsIDAuOTg1NTgsIDAuOTIyMjIsIDAuODUzNTksIDAuOTA2MzcsIDAuOTA5NzYsIDAuODM4MDksIDAuOTQ1MjMsIDAuODYyNzUsIDAuODM1MDksIDAuOTMxNTcsIDAuODUzMDgsIDAuODMzOTIsIDAuOTIzNDYsIDAuOTg2MjEsIDAuODM1MDksIDAuOTI4ODYsIDAuOTEzMjQsIDAuOTIxNjgsIDAuOTUzODEsIDAuOTA2NDYsIDAuOTI4ODYsIDAuOTA1NTcsIDAuODY4NDcsIDAuOTAyNzYsIDAuOTEzMjQsIDAuODY4NDIsIDAuOTIxNjgsIDAuOTk1MzEsIDAuOTUzODEsIDAuOTIyNCwgMC44NTQwOCwgMC45MjY5OSwgMC44Njg0NywgMS4wMDUxLCAwLjkxNTEzLCAwLjgwNDg3LCAwLjkzNDgxLCAxLCAwLjg4MTU5LCAxLjA1MjE0LCAwLjkwNjQ2LCAwLjk3MzU1LCAwLjgxNTM5LCAwLjg5Mzk4LCAwLjg1OTIzLCAwLjk1MzgxLCAwLjkwNjQ2LCAwLjkxNTEzLCAwLjkwNjQ2LCAwLjg1OTIzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkxNTQsIDAuOTQyMzYsIDAuOTE1NCwgMC45NDIzNiwgMC45MTU0LCAwLjk0MjM2LCAwLjg1NDU4LCAwLjg5MzY0LCAwLjk2Njk0LCAxLCAwLjg5OTAzLCAxLCAxLCAxLCAwLjkxNzgyLCAwLjkxNzgyLCAwLjkxNzgyLCAxLCAwLjg5NiwgMC44OTYsIDAuODk2LCAwLjkzMzIsIDAuOTMzMiwgMC45NTk3MywgMSwgMS4yNiwgMSwgMSwgMC44MDQ3OSwgMC44MDE3OCwgMSwgMSwgMC44NTYzMywgMSwgMSwgMSwgMSwgMC45NzI3NiwgMSwgMSwgMSwgMC42OTgsIDEsIDEuMzYxNDUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMTQ1NDIsIDEsIDAuNzkxOTksIDAuNzg2OTQsIDEuMDIwNTgsIDEuMDM0OTMsIDEuMDU0ODYsIDEsIDEsIDEuMjMwMjYsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMjAwMDYsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBNeXJpYWRQcm9Cb2xkSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIsCiAgbGluZUdhcDogMC4yCn07CmNvbnN0IE15cmlhZFByb0l0YWxpY0ZhY3RvcnMgPSBbMS4zNjg5OCwgMSwgMSwgMC42NTUwNywgMC44NDk0MywgMC44NTYzOSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44NjkzNiwgMC44ODMwNywgMC44Njk0OCwgMC44NTI4MywgMC44NTI4MywgMS4wNjM4MywgMS4wMjA1OCwgMC43NTk0NSwgMC45MjE5LCAwLjc1OTQ1LCAxLjE3MzM3LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjc1OTQ1LCAwLjc1OTQ1LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjY5MDQ2LCAwLjcwOTI2LCAwLjg1MTU4LCAwLjc3ODEyLCAwLjc2ODUyLCAwLjg5NTkxLCAwLjcwNDY2LCAwLjc2MTI1LCAwLjgwMDk0LCAwLjg2ODIyLCAwLjgzODY0LCAwLjcyOCwgMC43NzIxMiwgMC43OTQ3NSwgMC45MzYzNywgMC44NzUxNCwgMC44NTg4LCAwLjc2MDEzLCAwLjg1ODgsIDAuNzI0MjEsIDAuNjk4NjYsIDAuNzc1OTgsIDAuODU5OTEsIDAuODA4MTEsIDAuODc4MzIsIDAuNzgxMTIsIDAuNzc1MTIsIDAuODU2MiwgMS4wMjIyLCAxLjE4NDE3LCAxLjAyMjIsIDEuMjcwMTQsIDAuODk5MDMsIDEuMTUwMTIsIDAuOTM4NTksIDAuOTQzOTksIDAuODQ2LCAwLjk0Mzk5LCAwLjgxNDUzLCAxLjAxODYsIDAuOTQyMTksIDAuOTYwMTcsIDEuMDMwNzUsIDEuMDIxNzUsIDAuOTEyLCAxLjAzMDc1LCAwLjk2OTk4LCAwLjk2MDE3LCAwLjkzODU5LCAwLjk0Mzk5LCAwLjk0Mzk5LCAwLjk1NDkzLCAwLjc0NiwgMS4xMjY1OCwgMC45NDU3OCwgMC45MSwgMC45NzksIDAuODgyLCAwLjg4MiwgMC44MywgMC44NTAzNCwgMC44MzUzNywgMC44NTAzNCwgMS4wMjA1OCwgMC43MDg2OSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44MzUzNywgMC45MDA4MywgMS4xNTAxMiwgMC45MTYxLCAwLjk0NTY1LCAwLjczNTQxLCAxLjAyMDU4LCAwLjUzNjA5LCAwLjY5MzUzLCAwLjc5NTE5LCAxLjA4NTk1LCAxLCAxLCAxLjE1MDEyLCAxLCAwLjkxOTc0LCAwLjc1OTQ1LCAxLjE1MDEyLCAxLCAwLjk0NDYsIDAuNzMzNjEsIDAuOTAwNSwgMC45MDA1LCAwLjkwMDUsIDAuNjI4NjQsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuODUxNTgsIDAuNzczLCAwLjc2ODUyLCAwLjcwNDY2LCAwLjcwNDY2LCAwLjcwNDY2LCAwLjcwNDY2LCAwLjgzODY0LCAwLjgzODY0LCAwLjgzODY0LCAwLjgzODY0LCAwLjkwNTYxLCAwLjg3NTE0LCAwLjg1ODgsIDAuODU4OCwgMC44NTg4LCAwLjg1ODgsIDAuODU4OCwgMS4wMjA1OCwgMC44NTc1MSwgMC44NTk5MSwgMC44NTk5MSwgMC44NTk5MSwgMC44NTk5MSwgMC43NzUxMiwgMC43NjAxMywgMC44ODA3NSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC44MDc1LCAwLjg0NiwgMC44MTQ1MywgMC44MTQ1MywgMC44MTQ1MywgMC44MTQ1MywgMC44MjQyNCwgMC44MjQyNCwgMC44MjQyNCwgMC44MjQyNCwgMC45Mjc4LCAwLjk2MDE3LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAxLjA4NTk1LCAwLjg1NjIsIDAuOTQ1NzgsIDAuOTQ1NzgsIDAuOTQ1NzgsIDAuOTQ1NzgsIDAuODgyLCAwLjk0NTc4LCAwLjg4MiwgMC44NTE1OCwgMC45Mzg1OSwgMC44NTE1OCwgMC45Mzg1OSwgMC44NTE1OCwgMC45Mzg1OSwgMC43Njg1MiwgMC44NDYsIDAuNzY4NTIsIDAuODQ2LCAwLjc2ODUyLCAwLjg0NiwgMC43Njg1MiwgMC44NDYsIDAuODk1OTEsIDAuODU0NCwgMC45MDU2MSwgMC45NDM5OSwgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC43MDQ2NiwgMC44MTQ1MywgMC44MDA5NCwgMC45NDIxOSwgMC44MDA5NCwgMC45NDIxOSwgMC44MDA5NCwgMC45NDIxOSwgMSwgMSwgMC44NjgyMiwgMC45NjAxNywgMC44NjgyMiwgMC45NjAxNywgMC44Mzg2NCwgMC44MjQyNCwgMC44Mzg2NCwgMC44MjQyNCwgMC44Mzg2NCwgMC44MjQyNCwgMC44Mzg2NCwgMS4wMzA3NSwgMC44Mzg2NCwgMC44MjQyNCwgMC44MTQwMiwgMS4wMjczOCwgMC43MjgsIDEuMDIxNzUsIDEsIDEsIDAuOTEyLCAwLjc5NDc1LCAxLjAzMDc1LCAxLCAxLCAwLjc5NDc1LCAwLjgzOTExLCAwLjc5NDc1LCAwLjY2MjY2LCAwLjgwNTUzLCAxLjA2Njc2LCAwLjg3NTE0LCAwLjk2MDE3LCAxLCAxLCAwLjg3NTE0LCAwLjk2MDE3LCAwLjg2ODY1LCAwLjg3Mzk2LCAwLjk2MDE3LCAwLjg1ODgsIDAuOTM4NTksIDAuODU4OCwgMC45Mzg1OSwgMC44NTg4LCAwLjkzODU5LCAwLjg2NywgMC44NDc1OSwgMC43MjQyMSwgMC45NTQ5MywgMSwgMSwgMC43MjQyMSwgMC45NTQ5MywgMC42OTg2NiwgMC43NDYsIDAuNjk4NjYsIDAuNzQ2LCAxLCAxLCAwLjY5ODY2LCAwLjc0NiwgMSwgMSwgMC43NzU5OCwgMC44ODQxNywgMC43NzU5OCwgMS4xMjY1OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NTk5MSwgMC45NDU3OCwgMC44NzgzMiwgMC45NzksIDAuNzc1MTIsIDAuODgyLCAwLjc3NTEyLCAwLjg1NjIsIDAuODMsIDAuODU2MiwgMC44MywgMC44NTYyLCAwLjgzLCAxLCAwLjg4NDY1LCAwLjg1MTU4LCAwLjkzODU5LCAwLjc3MywgMC44MDc1LCAwLjg1NzUxLCAwLjg1NjIsIDEsIDEsIDAuNzc1OTgsIDEuMTI2NTgsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUzMTMsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMTUwMTIsIDEuMDgxMDYsIDEuMDM5MDEsIDAuODUxNTgsIDAuNzcwMjUsIDAuNjIyNjQsIDAuNzY0NiwgMC42NTM1MSwgMC44NjAyNiwgMC42OTQ2MSwgMC44OTk0NywgMS4wMzA3NSwgMC44NTE1OCwgMC43NzgxMiwgMC43NjQ0OSwgMC44ODgzNiwgMC43MDQ2NiwgMC44NTYyLCAwLjg2ODIyLCAwLjg1ODgsIDAuODM4NjQsIDAuNzcyMTIsIDAuODUzMDgsIDAuOTM2MzcsIDAuODc1MTQsIDAuODIzNTIsIDAuODU4OCwgMC44NTcwMSwgMC43NjAxMywgMC44OTA1OCwgMC43NzU5OCwgMC44MTU2LCAwLjgyNTY1LCAwLjc4MTEyLCAwLjc3ODk5LCAwLjg5Mzg2LCAwLjgzODY0LCAwLjgxNTYsIDAuOTQ4NiwgMC45MjM4OCwgMC45NjE4NiwgMS4wMzA3NSwgMC45MTEyMywgMC45NDg2LCAwLjkzMjk4LCAwLjg3OCwgMC45Mzk0MiwgMC45MjM4OCwgMC44NDU5NiwgMC45NjE4NiwgMC45NTExOSwgMS4wMzA3NSwgMC45MjIsIDAuODg3ODcsIDAuOTU4MjksIDAuODgsIDAuOTM1NTksIDAuOTM4NTksIDAuNzg4MTUsIDAuOTM3NTgsIDEsIDAuODkyMTcsIDEuMDM3MzcsIDAuOTExMjMsIDAuOTM5NjksIDAuNzc0ODcsIDAuODU3NjksIDAuODY3OTksIDEuMDMwNzUsIDAuOTExMjMsIDAuOTM4NTksIDAuOTExMjMsIDAuODY3OTksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODc4MzIsIDAuOTc5LCAwLjg3ODMyLCAwLjk3OSwgMC44NzgzMiwgMC45NzksIDAuNzc1MTIsIDAuODgyLCAwLjkyMTksIDEsIDAuODk5MDMsIDEsIDEsIDEsIDAuODczMjEsIDAuODczMjEsIDAuODczMjEsIDEsIDEuMDI3LCAxLjAyNywgMS4wMjcsIDAuODY4NDcsIDAuODY4NDcsIDAuNzkxMjEsIDEsIDEuMTI0LCAxLCAxLCAwLjczNTcyLCAwLjczNTcyLCAxLCAxLCAwLjg1MDM0LCAxLCAxLCAxLCAxLCAwLjg4NDY1LCAxLCAxLCAxLCAwLjY2OSwgMSwgMS4zNjE0NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNDgyOCwgMSwgMC43NDk0OCwgMC43NTE4NywgMS4wMjA1OCwgMC45ODM5MSwgMS4wMjExOSwgMSwgMSwgMS4wNjIzMywgMS4wODU5NSwgMS4wODU5NSwgMSwgMS4wODU5NSwgMS4wODU5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNTIzMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IE15cmlhZFByb0l0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9Owpjb25zdCBNeXJpYWRQcm9SZWd1bGFyRmFjdG9ycyA9IFsxLjM2ODk4LCAxLCAxLCAwLjc2MzA1LCAwLjgyNzg0LCAwLjk0OTM1LCAwLjg5MzY0LCAwLjkyMjQxLCAwLjg5MDczLCAwLjkwNzA2LCAwLjk4NDcyLCAwLjg1MjgzLCAwLjg1MjgzLCAxLjA2NjQsIDEuMDIwNTgsIDAuNzQ1MDUsIDAuOTIxOSwgMC43NDUwNSwgMS4yMzQ1NiwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC43NDUwNSwgMC43NDUwNSwgMS4wMjA1OCwgMS4wMjA1OCwgMS4wMjA1OCwgMC43MzAwMiwgMC43MjYwMSwgMC45MTc1NSwgMC44MTI2LCAwLjgwMzE0LCAwLjkyMjIyLCAwLjczNzY0LCAwLjc5NzI2LCAwLjgzMDUxLCAwLjkwMjg0LCAwLjg2MDIzLCAwLjc0LCAwLjgxMjYsIDAuODQ4NjksIDAuOTY1MTgsIDAuOTExMTUsIDAuODg1OCwgMC43OTc2MSwgMC44ODU4LCAwLjc0NDk4LCAwLjczOTE0LCAwLjgxMzYzLCAwLjg5NTkxLCAwLjgzNjU5LCAwLjg5NjMzLCAwLjg1NjA4LCAwLjgxMTEsIDAuOTA1MzEsIDEuMDIyMiwgMS4yMjczNiwgMS4wMjIyLCAxLjI3MDE0LCAwLjg5OTAzLCAwLjkwMDg4LCAwLjg2NjY3LCAxLjAyMzEsIDAuODk2LCAxLjAxNDExLCAwLjkwMDgzLCAxLjA1MDk5LCAxLjAwNTEyLCAwLjk5NzkzLCAxLjA1MzI2LCAxLjA5Mzc3LCAwLjkzOCwgMS4wNjIyNiwgMS4wMDExOSwgMC45OTc5MywgMC45ODcxNCwgMS4wMjMxLCAxLjAxMjMxLCAwLjk4MTk2LCAwLjc5MiwgMS4xOTEzNywgMC45OTA3NCwgMC45NjIsIDEuMDE5MTUsIDAuOTI2LCAwLjk0MiwgMC44NTYsIDAuODUwMzQsIDAuOTIwMDYsIDAuODUwMzQsIDEuMDIwNTgsIDAuNjkwNjcsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIwMDYsIDAuOTMzMiwgMC45MDA4OCwgMC45MTg4MiwgMC45MzQ4NCwgMC43NTMzOSwgMS4wMjA1OCwgMC41Njg2NiwgMC41NDMyNCwgMC43OTUxOSwgMS4wODU5NSwgMSwgMSwgMC45MDA4OCwgMSwgMC45NTMyNSwgMC43NDUwNSwgMC45MDA4OCwgMSwgMC45NzE5OCwgMC43NTMzOSwgMC45MTAwOSwgMC45MTAwOSwgMC45MTAwOSwgMC42NjQ2NiwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC45MTc1NSwgMC43ODgsIDAuODAzMTQsIDAuNzM3NjQsIDAuNzM3NjQsIDAuNzM3NjQsIDAuNzM3NjQsIDAuODYwMjMsIDAuODYwMjMsIDAuODYwMjMsIDAuODYwMjMsIDAuOTI5MTUsIDAuOTExMTUsIDAuODg1OCwgMC44ODU4LCAwLjg4NTgsIDAuODg1OCwgMC44ODU4LCAxLjAyMDU4LCAwLjg4NTgsIDAuODk1OTEsIDAuODk1OTEsIDAuODk1OTEsIDAuODk1OTEsIDAuODExMSwgMC43OTYxMSwgMC44OTcxMywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjY2NywgMC44NjkzNiwgMC44OTYsIDAuOTAwODMsIDAuOTAwODMsIDAuOTAwODMsIDAuOTAwODMsIDAuODQyMjQsIDAuODQyMjQsIDAuODQyMjQsIDAuODQyMjQsIDAuOTcyNzYsIDAuOTk3OTMsIDAuOTg3MTQsIDAuOTg3MTQsIDAuOTg3MTQsIDAuOTg3MTQsIDAuOTg3MTQsIDEuMDg1OTUsIDAuODk4NzYsIDAuOTkwNzQsIDAuOTkwNzQsIDAuOTkwNzQsIDAuOTkwNzQsIDAuOTQyLCAxLjAyMzEsIDAuOTQyLCAwLjkxNzU1LCAwLjg2NjY3LCAwLjkxNzU1LCAwLjg2NjY3LCAwLjkxNzU1LCAwLjg2NjY3LCAwLjgwMzE0LCAwLjg5NiwgMC44MDMxNCwgMC44OTYsIDAuODAzMTQsIDAuODk2LCAwLjgwMzE0LCAwLjg5NiwgMC45MjIyMiwgMC45MzM3MiwgMC45MjkxNSwgMS4wMTQxMSwgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC43Mzc2NCwgMC45MDA4MywgMC44MzA1MSwgMS4wMDUxMiwgMC44MzA1MSwgMS4wMDUxMiwgMC44MzA1MSwgMS4wMDUxMiwgMSwgMSwgMC45MDI4NCwgMC45OTc5MywgMC45MDk3NiwgMC45OTc5MywgMC44NjAyMywgMC44NDIyNCwgMC44NjAyMywgMC44NDIyNCwgMC44NjAyMywgMC44NDIyNCwgMC44NjAyMywgMS4wNTMyNiwgMC44NjAyMywgMC44NDIyNCwgMC44Mjg3MywgMS4wNzQ2OSwgMC43NCwgMS4wOTM3NywgMSwgMSwgMC45MzgsIDAuODQ4NjksIDEuMDYyMjYsIDEsIDEsIDAuODQ4NjksIDAuODM3MDQsIDAuODQ4NjksIDAuODE0NDEsIDAuODU1ODgsIDEuMDg5MjcsIDAuOTExMTUsIDAuOTk3OTMsIDEsIDEsIDAuOTExMTUsIDAuOTk3OTMsIDAuOTE4ODcsIDAuOTA5OTEsIDAuOTk3OTMsIDAuODg1OCwgMC45ODcxNCwgMC44ODU4LCAwLjk4NzE0LCAwLjg4NTgsIDAuOTg3MTQsIDAuODk0LCAwLjkxNDM0LCAwLjc0NDk4LCAwLjk4MTk2LCAxLCAxLCAwLjc0NDk4LCAwLjk4MTk2LCAwLjczOTE0LCAwLjc5MiwgMC43MzkxNCwgMC43OTIsIDEsIDEsIDAuNzM5MTQsIDAuNzkyLCAxLCAxLCAwLjgxMzYzLCAwLjkwNCwgMC44MTM2MywgMS4xOTEzNywgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTU5MSwgMC45OTA3NCwgMC44OTYzMywgMS4wMTkxNSwgMC44MTExLCAwLjk0MiwgMC44MTExLCAwLjkwNTMxLCAwLjg1NiwgMC45MDUzMSwgMC44NTYsIDAuOTA1MzEsIDAuODU2LCAxLCAwLjkyMjQxLCAwLjkxNzU1LCAwLjg2NjY3LCAwLjc4OCwgMC44NjkzNiwgMC44ODU4LCAwLjg5ODc2LCAxLCAxLCAwLjgxMzYzLCAxLjE5MTM3LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMDg4LCAwLjkwMzg4LCAxLjAzOTAxLCAwLjkyMTM4LCAwLjc4MTA1LCAwLjcxNTQsIDAuODYxNjksIDAuODA1MTMsIDAuOTQwMDcsIDAuODI1MjgsIDAuOTg2MTIsIDEuMDYyMjYsIDAuOTE3NTUsIDAuODEyNiwgMC44MTg4NCwgMC45MjgxOSwgMC43Mzc2NCwgMC45MDUzMSwgMC45MDI4NCwgMC44ODU4LCAwLjg2MDIzLCAwLjgxMjYsIDAuOTExNzIsIDAuOTY1MTgsIDAuOTExMTUsIDAuODMwODksIDAuODg1OCwgMC44Nzc5MSwgMC43OTc2MSwgMC44OTI5NywgMC44MTM2MywgMC44ODE1NywgMC44OTk5MiwgMC44NTYwOCwgMC44MTk5MiwgMC45NDMwNywgMC44NjAyMywgMC44ODE1NywgMC45NTMwOCwgMC45ODY5OSwgMC45OTc5MywgMS4wNjIyNiwgMC45NTgxNywgMC45NTMwOCwgMC45NzM1OCwgMC45MjgsIDAuOTgwODgsIDAuOTg2OTksIDAuOTI3NjEsIDAuOTk3OTMsIDAuOTYwMTcsIDEuMDYyMjYsIDAuOTg2LCAwLjk0NCwgMC45NTk3OCwgMC45MzgsIDAuOTY3MDUsIDAuOTg3MTQsIDAuODA0NDIsIDAuOTg5NzIsIDEsIDAuODk3NjIsIDEuMDQ1NTIsIDAuOTU4MTcsIDAuOTkwMDcsIDAuODcwNjQsIDAuOTE4NzksIDAuODg4ODgsIDEuMDYyMjYsIDAuOTU4MTcsIDAuOTg3MTQsIDAuOTU4MTcsIDAuODg4ODgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODk2MzMsIDEuMDE5MTUsIDAuODk2MzMsIDEuMDE5MTUsIDAuODk2MzMsIDEuMDE5MTUsIDAuODExMSwgMC45NDIsIDAuOTIxOSwgMSwgMC44OTkwMywgMSwgMSwgMSwgMC45MzE3MywgMC45MzE3MywgMC45MzE3MywgMSwgMS4wNjMwNCwgMS4wNjMwNCwgMS4wNjkwNCwgMC44OTkwMywgMC44OTkwMywgMC44MDU0OSwgMSwgMS4xNTYsIDEsIDEsIDAuNzY1NzUsIDAuNzY1NzUsIDEsIDEsIDAuNzI0NTgsIDEsIDEsIDEsIDEsIDAuOTIyNDEsIDEsIDEsIDEsIDAuNjE5LCAxLCAxLjM2MTQ1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA3MjU3LCAxLCAwLjc0NzA1LCAwLjcxMTE5LCAxLjAyMDU4LCAxLjAyNCwgMS4wMjExOSwgMSwgMSwgMS4xNTM2LCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA1NjM4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgTXlyaWFkUHJvUmVndWxhck1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9OwoKOy8vIC4vc3JjL2NvcmUvc2Vnb2V1aV9mYWN0b3JzLmpzCmNvbnN0IFNlZ29ldWlCb2xkRmFjdG9ycyA9IFsxLjc2NzM4LCAxLCAxLCAwLjk5Mjk3LCAwLjk4MjQsIDEuMDQwMTYsIDEuMDY0OTcsIDEuMDM0MjQsIDAuOTc1MjksIDEuMTc2NDcsIDEuMjMyMDMsIDEuMTA4NSwgMS4xMDg1LCAxLjE2OTM5LCAxLjIxMDcsIDAuOTc1NCwgMS4yMTQwOCwgMC45NzU0LCAxLjU5NTc4LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAwLjgxMzc4LCAwLjgxMzc4LCAxLjIxMDcsIDEuMjEwNywgMS4yMTA3LCAwLjcxNzAzLCAwLjk3ODQ3LCAwLjk3MzYzLCAwLjg4Nzc2LCAwLjg2NDEsIDEuMDIwOTYsIDAuNzk3OTUsIDAuODUxMzIsIDAuOTE0LCAxLjA2MDg1LCAxLjE0MDYsIDAuODAwNywgMC44OTg1OCwgMC44MzY5MywgMS4xNDg4OSwgMS4wOTM5OCwgMC45NzQ4OSwgMC45MjA5NCwgMC45NzQ4OSwgMC45MDM5OSwgMC44NDA0MSwgMC45NTkyMywgMS4wMDEzNSwgMSwgMS4wNjQ2NywgMC45ODI0MywgMC45MDk5NiwgMC45OTM2MSwgMS4xMDg1LCAxLjU2OTQyLCAxLjEwODUsIDEuMjEwNywgMC43NDYyNywgMC45NDI4MiwgMC45Njc1MiwgMS4wMTUxOSwgMC44NjMwNCwgMS4wMTM1OSwgMC45NzI3OCwgMS4xNTEwMywgMS4wMTM1OSwgMC45ODU2MSwgMS4wMjI4NSwgMS4wMjI4NSwgMS4wMDUyNywgMS4wMjI4NSwgMS4wMzAyLCAwLjk5MDQxLCAxLjAwMDgsIDEuMDE1MTksIDEuMDEzNTksIDEuMDIyNTgsIDAuNzkxMDQsIDEuMTY4NjIsIDAuOTkwNDEsIDAuOTc0NTQsIDEuMDI1MTEsIDAuOTkyOTgsIDAuOTY3NTIsIDAuOTU4MDEsIDAuOTQ4NTYsIDEuMTY1NzksIDAuOTQ4NTYsIDEuMjEwNywgMC45ODI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLCAxLjAzNDI0LCAxLjE2NTc5LCAwLjg3MjcsIDEuMzg3MSwgMS4xODYyMiwgMS4xMDgxOCwgMS4wNDQ3OCwgMS4yMTA3LCAxLjE4NjIyLCAwLjc1MTU1LCAwLjk0OTk0LCAxLjI4ODI2LCAxLjIxNDA4LCAxLjIxNDA4LCAwLjkxMDU2LCAxLCAwLjkxNTcyLCAwLjk3NTQsIDAuNjQ2NjMsIDEuMTgzMjgsIDEuMjQ4NjYsIDEuMDQ0NzgsIDEuMTQxNjksIDEuMTU3NDksIDEuMTczODksIDAuNzE3MDMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTM1MDYsIDAuODY0MSwgMC43OTc5NSwgMC43OTc5NSwgMC43OTc5NSwgMC43OTc5NSwgMS4xNDA2LCAxLjE0MDYsIDEuMTQwNiwgMS4xNDA2LCAxLjAyMDk2LCAxLjA5Mzk4LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAxLjIxMDcsIDAuOTc0ODksIDEuMDAxMzUsIDEuMDAxMzUsIDEuMDAxMzUsIDEuMDAxMzUsIDAuOTA5OTYsIDAuOTIwOTQsIDEuMDI3OTgsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTMxMzYsIDAuODYzMDQsIDAuOTcyNzgsIDAuOTcyNzgsIDAuOTcyNzgsIDAuOTcyNzgsIDEuMDIyODUsIDEuMDIyODUsIDEuMDIyODUsIDEuMDIyODUsIDAuOTcxMjIsIDAuOTkwNDEsIDEsIDEsIDEsIDEsIDEsIDEuMjg4MjYsIDEuMDAwOCwgMC45OTA0MSwgMC45OTA0MSwgMC45OTA0MSwgMC45OTA0MSwgMC45Njc1MiwgMS4wMTUxOSwgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC44NjQxLCAwLjg2MzA0LCAwLjg2NDEsIDAuODYzMDQsIDAuODY0MSwgMC44NjMwNCwgMC44NjQxLCAwLjg2MzA0LCAxLjAyMDk2LCAxLjAzMDU3LCAxLjAyMDk2LCAxLjAzNTE3LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjkxNCwgMS4wMTM1OSwgMC45MTQsIDEuMDEzNTksIDAuOTE0LCAxLjAxMzU5LCAxLCAxLCAxLjA2MDg1LCAwLjk4NTYxLCAxLjA2MDg1LCAxLjAwODc5LCAxLjE0MDYsIDEuMDIyODUsIDEuMTQwNiwgMS4wMjI4NSwgMS4xNDA2LCAxLjAyMjg1LCAxLjE0MDYsIDEuMDIyODUsIDEuMTQwNiwgMS4wMjI4NSwgMC45NzEzOCwgMS4wODY5MiwgMC44MDA3LCAxLjAyMjg1LCAxLCAxLCAxLjAwNTI3LCAwLjgzNjkzLCAxLjAyMjg1LCAxLCAxLCAwLjgzNjkzLCAwLjk0NTUsIDAuODM2OTMsIDAuOTA0MTgsIDAuODM2OTMsIDEuMTMwMDUsIDEuMDkzOTgsIDAuOTkwNDEsIDEsIDEsIDEuMDkzOTgsIDAuOTkwNDEsIDAuOTY2OTIsIDEuMDkyNTEsIDAuOTkwNDEsIDAuOTc0ODksIDEuMDAwOCwgMC45NzQ4OSwgMS4wMDA4LCAwLjk3NDg5LCAxLjAwMDgsIDAuOTM5OTQsIDAuOTc5MzEsIDAuOTAzOTksIDEuMDIyNTgsIDEsIDEsIDAuOTAzOTksIDEuMDIyNTgsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDEsIDEsIDAuOTU5MjMsIDEuMDcwMzQsIDAuOTU5MjMsIDEuMTY4NjIsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDY0NjcsIDEuMDI1MTEsIDAuOTA5OTYsIDAuOTY3NTIsIDAuOTA5OTYsIDAuOTkzNjEsIDAuOTU4MDEsIDAuOTkzNjEsIDAuOTU4MDEsIDAuOTkzNjEsIDAuOTU4MDEsIDEuMDc3MzMsIDEuMDM0MjQsIDAuOTczNjMsIDAuOTY3NTIsIDAuOTM1MDYsIDAuOTMxMzYsIDAuOTc0ODksIDEuMDAwOCwgMSwgMSwgMC45NTkyMywgMS4xNjg2MiwgMS4xNTEwMywgMS4xNTEwMywgMS4wMTE3MywgMS4wMzk1OSwgMC43NTk1MywgMC44MTM3OCwgMC43OTkxMiwgMS4xNTEwMywgMS4yMTk5NCwgMC45NTE2MSwgMC44NzgxNSwgMS4wMTE0OSwgMC44MTUyNSwgMC43Njc2LCAwLjk4MTY3LCAxLjAxMTM0LCAxLjAyNTQ2LCAwLjg0MDk3LCAxLjAzMDg5LCAxLjE4MTAyLCAwLjk3MzYzLCAwLjg4Nzc2LCAwLjg1MTM0LCAwLjk3ODI2LCAwLjc5Nzk1LCAwLjk5MzYxLCAxLjA2MDg1LCAwLjk3NDg5LCAxLjE0MDYsIDAuODk4NTgsIDEuMDM4OCwgMS4xNDg4OSwgMS4wOTM5OCwgMC44NjAzOSwgMC45NzQ4OSwgMS4wNTk1LCAwLjkyMDk0LCAwLjk0NzkzLCAwLjk1OTIzLCAwLjkwOTk2LCAwLjk5MzQ2LCAwLjk4MjQzLCAxLjAyMTEyLCAwLjk1NDkzLCAxLjE0MDYsIDAuOTA5OTYsIDEuMDM1NzQsIDEuMDI1OTcsIDEuMDAwOCwgMS4xODEwMiwgMS4wNjYyOCwgMS4wMzU3NCwgMS4wMTkyLCAxLjAxOTMyLCAxLjAwODg2LCAwLjk3NTMxLCAxLjAxMDYsIDEuMDAwOCwgMS4xMzE4OSwgMS4xODEwMiwgMS4wMjI3NywgMC45ODY4MywgMS4wMDE2LCAwLjk5NTYxLCAxLjA3MjM3LCAxLjAwMDgsIDAuOTA0MzQsIDAuOTk5MjEsIDAuOTM4MDMsIDAuODk2NSwgMS4yMzA4NSwgMS4wNjYyOCwgMS4wNDk4MywgMC45NjI2OCwgMS4wNDk5LCAwLjk4NDM5LCAxLjE4MTAyLCAxLjA2NjI4LCAxLjAwMDgsIDEuMDY2MjgsIDAuOTg0MzksIDAuNzk3OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDk0NjYsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTcyNzgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDIwNjUsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDY0NjcsIDEuMDI1MTEsIDEuMDY0NjcsIDEuMDI1MTEsIDEuMDY0NjcsIDEuMDI1MTEsIDAuOTA5OTYsIDAuOTY3NTIsIDEsIDEuMjE0MDgsIDAuODk5MDMsIDEsIDEsIDAuNzUxNTUsIDEuMDQzOTQsIDEuMDQzOTQsIDEuMDQzOTQsIDEuMDQzOTQsIDAuOTg2MzMsIDAuOTg2MzMsIDAuOTg2MzMsIDAuNzMwNDcsIDAuNzMwNDcsIDEuMjA2NDIsIDAuOTEyMTEsIDEuMjU2MzUsIDEuMjIyLCAxLjAyOTU2LCAxLjAzMzcyLCAxLjAzMzcyLCAwLjk2MDM5LCAxLjI0NjMzLCAxLCAxLjEyNDU0LCAwLjkzNTAzLCAxLjAzNDI0LCAxLjE5Njg3LCAxLjAzNDI0LCAxLCAxLCAxLCAwLjc3MSwgMSwgMSwgMS4xNTc0OSwgMS4xNTc0OSwgMS4xNTc0OSwgMS4xMDk0OCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjE4MiwgMSwgMSwgMS4xNjg5NywgMSwgMC45NjA4NSwgMC45MDEzNywgMS4yMTA3LCAxLjE4NDE2LCAxLjEzOTczLCAwLjY5ODI1LCAwLjk3MTYsIDIuMTAzMzksIDEuMjkwMDQsIDEuMjkwMDQsIDEuMjExNzIsIDEuMjkwMDQsIDEuMjkwMDQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTg4NzQsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4wOTE5MywgMS4wOTE5MywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IFNlZ29ldWlCb2xkTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjMzMDA4LAogIGxpbmVHYXA6IDAKfTsKY29uc3QgU2Vnb2V1aUJvbGRJdGFsaWNGYWN0b3JzID0gWzEuNzY3MzgsIDEsIDEsIDAuOTg5NDYsIDEuMDM5NTksIDEuMDQwMTYsIDEuMDI4MDksIDEuMDM2LCAwLjk3NjM5LCAxLjEwOTUzLCAxLjIzMjAzLCAxLjExMTQ0LCAxLjExMTQ0LCAxLjE2OTM5LCAxLjIxMjM3LCAwLjk3NTQsIDEuMjEyNjEsIDAuOTc1NCwgMS41OTc1NCwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDAuODEzNzgsIDAuODEzNzgsIDEuMjEyMzcsIDEuMjEyMzcsIDEuMjEyMzcsIDAuNzM1NDEsIDAuOTc4NDcsIDAuOTczNjMsIDAuODk3MjMsIDAuODc4OTcsIDEuMDQyNiwgMC43OTQyOSwgMC44NTI5MiwgMC45MTE0OSwgMS4wNTgxNSwgMS4xNDA2LCAwLjc5NjMxLCAwLjkwMTI4LCAwLjgzODUzLCAxLjA0Mzk2LCAxLjEwNjE1LCAwLjk3NTUyLCAwLjk0NDM2LCAwLjk3NTUyLCAwLjg4NjQxLCAwLjgwNTI3LCAwLjk2MDgzLCAxLjAwMTM1LCAxLCAxLjA2Nzc3LCAwLjk4MTcsIDAuOTExNDIsIDAuOTkzNjEsIDEuMTExNDQsIDEuNTcyOTMsIDEuMTExNDQsIDEuMjEyMzcsIDAuNzQ2MjcsIDEuMzE4MTgsIDEuMDY1ODUsIDAuOTcwNDIsIDAuODMwNTUsIDAuOTcwNDIsIDAuOTM1MDMsIDEuMTI2MSwgMC45NzA0MiwgMC45NzkyMiwgMS4xNDIzNiwgMC45NDU1MiwgMS4wMTA1NCwgMS4xNDIzNiwgMS4wMjQ3MSwgMC45NzkyMiwgMC45NDE2NSwgMC45NzA0MiwgMC45NzA0MiwgMS4wMjc2LCAwLjc4OTI5LCAxLjEyNjEsIDAuOTc5MjIsIDAuOTU4NzQsIDEuMDIxOTcsIDAuOTg1MDcsIDAuOTY3NTIsIDAuOTcxNjgsIDAuOTUxMDcsIDEuMTY1NzksIDAuOTUxMDcsIDEuMjEyMzcsIDEuMDM5NTksIDEuMDM2LCAxLjAzNiwgMSwgMS4wMzYsIDEuMTY1NzksIDAuODczNTcsIDEuMzE4MTgsIDEuMTg3NTQsIDEuMjY3ODEsIDEuMDUzNTYsIDEuMjEyMzcsIDEuMTg2MjIsIDAuNzk0ODcsIDAuOTQ5OTQsIDEuMjkwMDQsIDEuMjQwNDcsIDEuMjQwNDcsIDEuMzE4MTgsIDEsIDAuOTE0ODQsIDAuOTc1NCwgMS4zMTgxOCwgMS4xMzQ5LCAxLjI0ODY2LCAxLjA1MzU2LCAxLjEzOTM0LCAxLjE1NTc0LCAxLjE3Mzg5LCAwLjczNTQxLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk3MzYzLCAwLjk0Mzg1LCAwLjg3ODk3LCAwLjc5NDI5LCAwLjc5NDI5LCAwLjc5NDI5LCAwLjc5NDI5LCAxLjE0MDYsIDEuMTQwNiwgMS4xNDA2LCAxLjE0MDYsIDEuMDQyNiwgMS4xMDYxNSwgMC45NzU1MiwgMC45NzU1MiwgMC45NzU1MiwgMC45NzU1MiwgMC45NzU1MiwgMS4yMTIzNywgMC45NzU1MiwgMS4wMDEzNSwgMS4wMDEzNSwgMS4wMDEzNSwgMS4wMDEzNSwgMC45MTE0MiwgMC45NDQzNiwgMC45ODcyMSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMS4wNjU4NSwgMC45NjcwNSwgMC44MzA1NSwgMC45MzUwMywgMC45MzUwMywgMC45MzUwMywgMC45MzUwMywgMS4xNDIzNiwgMS4xNDIzNiwgMS4xNDIzNiwgMS4xNDIzNiwgMC45MzEyNSwgMC45NzkyMiwgMC45NDE2NSwgMC45NDE2NSwgMC45NDE2NSwgMC45NDE2NSwgMC45NDE2NSwgMS4yOTAwNCwgMC45NDE2NSwgMC45NzkyMiwgMC45NzkyMiwgMC45NzkyMiwgMC45NzkyMiwgMC45Njc1MiwgMC45NzA0MiwgMC45Njc1MiwgMC45NzM2MywgMS4wNjU4NSwgMC45NzM2MywgMS4wNjU4NSwgMC45NzM2MywgMS4wNjU4NSwgMC44Nzg5NywgMC44MzA1NSwgMC44Nzg5NywgMC44MzA1NSwgMC44Nzg5NywgMC44MzA1NSwgMC44Nzg5NywgMC44MzA1NSwgMS4wNDI2LCAxLjAwMzMsIDEuMDQyNiwgMC45NzA0MiwgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC43OTQyOSwgMC45MzUwMywgMC45MTE0OSwgMC45NzA0MiwgMC45MTE0OSwgMC45NzA0MiwgMC45MTE0OSwgMC45NzA0MiwgMSwgMSwgMS4wNTgxNSwgMC45NzkyMiwgMS4wNTgxNSwgMC45NzkyMiwgMS4xNDA2LCAxLjE0MjM2LCAxLjE0MDYsIDEuMTQyMzYsIDEuMTQwNiwgMS4xNDIzNiwgMS4xNDA2LCAxLjE0MjM2LCAxLjE0MDYsIDEuMTQyMzYsIDAuOTc0NDEsIDEuMDQzMDIsIDAuNzk2MzEsIDEuMDE1ODIsIDEsIDEsIDEuMDEwNTQsIDAuODM4NTMsIDEuMTQyMzYsIDEsIDEsIDAuODM4NTMsIDEuMDkxMjUsIDAuODM4NTMsIDAuOTA0MTgsIDAuODM4NTMsIDEuMTk1MDgsIDEuMTA2MTUsIDAuOTc5MjIsIDEsIDEsIDEuMTA2MTUsIDAuOTc5MjIsIDEuMDEwMzQsIDEuMTA0NjYsIDAuOTc5MjIsIDAuOTc1NTIsIDAuOTQxNjUsIDAuOTc1NTIsIDAuOTQxNjUsIDAuOTc1NTIsIDAuOTQxNjUsIDAuOTE2MDIsIDAuOTE5ODEsIDAuODg2NDEsIDEuMDI3NiwgMSwgMSwgMC44ODY0MSwgMS4wMjc2LCAwLjgwNTI3LCAwLjc4OTI5LCAwLjgwNTI3LCAwLjc4OTI5LCAwLjgwNTI3LCAwLjc4OTI5LCAwLjgwNTI3LCAwLjc4OTI5LCAxLCAxLCAwLjk2MDgzLCAxLjA1NDAzLCAwLjk1OTIzLCAxLjE2ODYyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjAwMTM1LCAwLjk3OTIyLCAxLjA2Nzc3LCAxLjAyMTk3LCAwLjkxMTQyLCAwLjk2NzUyLCAwLjkxMTQyLCAwLjk5MzYxLCAwLjk3MTY4LCAwLjk5MzYxLCAwLjk3MTY4LCAwLjk5MzYxLCAwLjk3MTY4LCAxLjIzMTk5LCAxLjAzNiwgMC45NzM2MywgMS4wNjU4NSwgMC45NDM4NSwgMC45NjcwNSwgMC45NzU1MiwgMC45NDE2NSwgMSwgMSwgMC45NjA4MywgMS4xMjYxLCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAxLjMxODE4LCAwLjk1MTYxLCAxLjI3MTI2LCAxLjAwODExLCAwLjgzMjg0LCAwLjc3NzAyLCAwLjk5MTM3LCAwLjk1MjUzLCAxLjAzNDcsIDAuODYxNDIsIDEuMDcyMDUsIDEuMTQyMzYsIDAuOTczNjMsIDAuODk3MjMsIDAuODY4NjksIDEuMDk4MTgsIDAuNzk0MjksIDAuOTkzNjEsIDEuMDU4MTUsIDAuOTc1NTIsIDEuMTQwNiwgMC45MDEyOCwgMS4wNjY2MiwgMS4wNDM5NiwgMS4xMDYxNSwgMC44NDkxOCwgMC45NzU1MiwgMS4wNDY5NCwgMC45NDQzNiwgMC45ODAxNSwgMC45NjA4MywgMC45MTE0MiwgMS4wMDM1NiwgMC45ODE3LCAxLjAxOTQ1LCAwLjk4OTk5LCAxLjE0MDYsIDAuOTExNDIsIDEuMDQ5NjEsIDAuOTg5OCwgMS4wMDYzOSwgMS4xNDIzNiwgMS4wNzUxNCwgMS4wNDk2MSwgMC45OTYwNywgMS4wMjg5NywgMS4wMDgsIDAuOTg5OCwgMC45NTEzNCwgMS4wMDYzOSwgMS4xMTEyMSwgMS4xNDIzNiwgMS4wMDUxOCwgMC45Nzk4MSwgMS4wMjE4NiwgMSwgMS4wODU3OCwgMC45NDE2NSwgMC45OTMxNCwgMC45ODM4NywgMC45MzAyOCwgMC45MzM3NywgMS4zNTEyNSwgMS4wNzUxNCwgMS4xMDY4NywgMC45MzQ5MSwgMS4wNDIzMiwgMS4wMDM1MSwgMS4xNDIzNiwgMS4wNzUxNCwgMC45NDE2NSwgMS4wNzUxNCwgMS4wMDM1MSwgMC43OTQyOSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wOTA5NywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MzUwMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NjYwOSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNjc3NywgMS4wMjE5NywgMS4wNjc3NywgMS4wMjE5NywgMS4wNjc3NywgMS4wMjE5NywgMC45MTE0MiwgMC45Njc1MiwgMSwgMS4yMTI2MSwgMC44OTkwMywgMSwgMSwgMC43NTE1NSwgMS4wNDc0NSwgMS4wNDc0NSwgMS4wNDc0NSwgMS4wNDM5NCwgMC45ODYzMywgMC45ODYzMywgMC45ODYzMywgMC43Mjk1OSwgMC43Mjk1OSwgMS4yMDUwMiwgMC45MTQwNiwgMS4yNjUxNCwgMS4yMjIsIDEuMDI5NTYsIDEuMDMzNzIsIDEuMDMzNzIsIDAuOTYwMzksIDEuMjQ2MzMsIDEsIDEuMDkxMjUsIDAuOTMzMjcsIDEuMDMzMzYsIDEuMTY1NDEsIDEuMDM2LCAxLCAxLCAxLCAwLjc3MSwgMSwgMSwgMS4xNTU3NCwgMS4xNTU3NCwgMS4xNTU3NCwgMS4xNTU3NCwgMC44NjM2NCwgMC45NDQzNCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjIyNCwgMSwgMSwgMS4xNjc5OCwgMSwgMC45NjA4NSwgMC45MDA2OCwgMS4yMTIzNywgMS4xODQxNiwgMS4xMzkwNCwgMC42OTgyNSwgMC45NzE2LCAyLjEwMzM5LCAxLjI5MDA0LCAxLjI5MDA0LCAxLjIxMzM5LCAxLjI5MDA0LCAxLjI5MDA0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjQyNjAzLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAwLjg3MDI1LCAwLjg3MDI1LCAwLjg3MDI1LCAwLjg3MDI1LCAxLjE4Nzc1LCAxLjQyNjAzLCAxLCAxLjQyNjAzLCAxLjQyNjAzLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjI4ODYsIDEuMDQzMTUsIDEuMTUyOTYsIDEuMzQxNjMsIDEsIDEsIDEsIDEuMTMyNjksIDEuMTMyNjksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBTZWdvZXVpQm9sZEl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zMzAwOCwKICBsaW5lR2FwOiAwCn07CmNvbnN0IFNlZ29ldWlJdGFsaWNGYWN0b3JzID0gWzEuNzY3MzgsIDEsIDEsIDAuOTg5NDYsIDEuMTQ3NjMsIDEuMDUzNjUsIDEuMDYyMzQsIDAuOTY5MjcsIDAuOTI1ODYsIDEuMTUzNzMsIDEuMTg0MTQsIDAuOTEzNDksIDAuOTEzNDksIDEuMDc0MDMsIDEuMTczMDgsIDAuNzgzODMsIDEuMjAwODgsIDAuNzgzODMsIDEuNDI1MzEsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuNzgzODMsIDAuNzgzODMsIDEuMTczMDgsIDEuMTczMDgsIDEuMTczMDgsIDAuNzczNDksIDAuOTQ1NjUsIDAuOTQ3MjksIDAuODU5NDQsIDAuODg1MDYsIDAuOTg1OCwgMC43NDgxNywgMC44MDAxNiwgMC44ODQ0OSwgMC45ODAzOSwgMC45NTc4MiwgMC42OTIzOCwgMC44OTg5OCwgMC44MzIzMSwgMC45ODE4MywgMS4wMzk4OSwgMC45NjkyNCwgMC44NjIzNywgMC45NjkyNCwgMC44MDU5NSwgMC43NDUyNCwgMC44NjA5MSwgMC45NTQwMiwgMC45NDE0MywgMC45ODQ0OCwgMC44ODU4LCAwLjgzMDg5LCAwLjkzMjg1LCAxLjA5NDksIDEuMzkwMTYsIDEuMDk0OSwgMS40NTk5NCwgMC43NDYyNywgMS4wNDgzOSwgMC45NzQ1NCwgMC45NzQ1NCwgMC44NzIwNywgMC45NzQ1NCwgMC44NzUzMywgMS4wNjE1MSwgMC45NzQ1NCwgMS4wMDE3NiwgMS4xNjQ4NCwgMS4wODEzMiwgMC45ODA0NywgMS4xNjQ4NCwgMS4wMjk4OSwgMS4wMTA1NCwgMC45NjIyNSwgMC45NzQ1NCwgMC45NzQ1NCwgMS4wNjU5OCwgMC43OTAwNCwgMS4xNjM0NCwgMS4wMDM1MSwgMC45NDYyOSwgMC45OTczLCAwLjkxMDE2LCAwLjk2Nzc3LCAwLjkwNDMsIDAuOTEwODIsIDAuOTI0ODEsIDAuOTEwODIsIDEuMTczMDgsIDAuOTU3NDgsIDAuOTY5MjcsIDAuOTY5MjcsIDEsIDAuOTY5MjcsIDAuOTI0ODEsIDAuODA1OTcsIDEuMDQ4MzksIDEuMjMzOTMsIDEuMTc4MSwgMC45MjQ1LCAxLjE3MzA4LCAxLjIwODA4LCAwLjYzMjE4LCAwLjk0MjYxLCAxLjI0ODIyLCAxLjA5OTcxLCAxLjA5OTcxLCAxLjA0ODM5LCAxLCAwLjg1MjczLCAwLjc4MDMyLCAxLjA0ODM5LCAxLjA5OTcxLCAxLjIyMzI2LCAwLjkyNDUsIDEuMDk4MzYsIDEuMTM1MjUsIDEuMTUyMjIsIDAuNzA0MjQsIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuOTQ3MjksIDAuODU0OTgsIDAuODg1MDYsIDAuNzQ4MTcsIDAuNzQ4MTcsIDAuNzQ4MTcsIDAuNzQ4MTcsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTg1OCwgMS4wMzk4OSwgMC45NjkyNCwgMC45NjkyNCwgMC45NjkyNCwgMC45NjkyNCwgMC45NjkyNCwgMS4xNzMwOCwgMC45NjkyNCwgMC45NTQwMiwgMC45NTQwMiwgMC45NTQwMiwgMC45NTQwMiwgMC44MzA4OSwgMC44NjIzNywgMC44ODQwOSwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45NzQ1NCwgMC45MjkxNiwgMC44NzIwNywgMC44NzUzMywgMC44NzUzMywgMC44NzUzMywgMC44NzUzMywgMC45MzE0NiwgMC45MzE0NiwgMC45MzE0NiwgMC45MzE0NiwgMC45Mzg1NCwgMS4wMTA1NCwgMC45NjIyNSwgMC45NjIyNSwgMC45NjIyNSwgMC45NjIyNSwgMC45NjIyNSwgMS4yNDgyMiwgMC44NzYxLCAxLjAwMzUxLCAxLjAwMzUxLCAxLjAwMzUxLCAxLjAwMzUxLCAwLjk2Nzc3LCAwLjk3NDU0LCAwLjk2Nzc3LCAwLjk0NzI5LCAwLjk3NDU0LCAwLjk0NzI5LCAwLjk3NDU0LCAwLjk0NzI5LCAwLjk3NDU0LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjg4NTA2LCAwLjg3MjA3LCAwLjk4NTgsIDAuOTUzOTEsIDAuOTg1OCwgMC45NzQ1NCwgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC43NDgxNywgMC44NzUzMywgMC44ODQ0OSwgMC45NzQ1NCwgMC44ODQ0OSwgMC45NzQ1NCwgMC44ODQ0OSwgMC45NzQ1NCwgMSwgMSwgMC45ODAzOSwgMS4wMDE3NiwgMC45ODAzOSwgMS4wMDE3NiwgMC45NTc4MiwgMC45MzE0NiwgMC45NTc4MiwgMC45MzE0NiwgMC45NTc4MiwgMC45MzE0NiwgMC45NTc4MiwgMS4xNjQ4NCwgMC45NTc4MiwgMC45MzE0NiwgMC44NDQyMSwgMS4xMjc2MSwgMC42OTIzOCwgMS4wODEzMiwgMSwgMSwgMC45ODA0NywgMC44MzIzMSwgMS4xNjQ4NCwgMSwgMSwgMC44NDcyMywgMS4wNDg2MSwgMC44NDcyMywgMC43ODc1NSwgMC44MzIzMSwgMS4yMzczNiwgMS4wMzk4OSwgMS4wMTA1NCwgMSwgMSwgMS4wMzk4OSwgMS4wMTA1NCwgMC45ODU3LCAxLjAzODQ5LCAxLjAxMDU0LCAwLjk2OTI0LCAwLjk2MjI1LCAwLjk2OTI0LCAwLjk2MjI1LCAwLjk2OTI0LCAwLjk2MjI1LCAwLjkyMzgzLCAwLjkwMTcxLCAwLjgwNTk1LCAxLjA2NTk4LCAxLCAxLCAwLjgwNTk1LCAxLjA2NTk4LCAwLjc0NTI0LCAwLjc5MDA0LCAwLjc0NTI0LCAwLjc5MDA0LCAwLjc0NTI0LCAwLjc5MDA0LCAwLjc0NTI0LCAwLjc5MDA0LCAxLCAxLCAwLjg2MDkxLCAxLjAyNzU5LCAwLjg1NzcxLCAxLjE2MzQ0LCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk1NDAyLCAxLjAwMzUxLCAwLjk4NDQ4LCAwLjk5NzMsIDAuODMwODksIDAuOTY3NzcsIDAuODMwODksIDAuOTMyODUsIDAuOTA0MywgMC45MzI4NSwgMC45MDQzLCAwLjkzMjg1LCAwLjkwNDMsIDEuMzE4NjgsIDAuOTY5MjcsIDAuOTQ3MjksIDAuOTc0NTQsIDAuODU0OTgsIDAuOTI5MTYsIDAuOTY5MjQsIDAuODc2MSwgMSwgMSwgMC44NjA5MSwgMS4xNjM0NCwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMS4wNDgzOSwgMC44MTk2NSwgMC44MTk2NSwgMC45NDcyOSwgMC43ODAzMiwgMC43MTAyMiwgMC45MDg4MywgMC44NDE3MSwgMC45OTg3NywgMC43NzU5NiwgMS4wNTczNCwgMS4yLCAwLjk0NzI5LCAwLjg1OTQ0LCAwLjgyNzkxLCAwLjk2MDcsIDAuNzQ4MTcsIDAuOTMyODUsIDAuOTgwMzksIDAuOTY5MjQsIDAuOTU3ODIsIDAuODk4OTgsIDAuOTgzMTYsIDAuOTgxODMsIDEuMDM5ODksIDAuNzg2MTQsIDAuOTY5MjQsIDAuOTc2NDIsIDAuODYyMzcsIDAuODYwNzUsIDAuODYwOTEsIDAuODMwODksIDAuOTAwODIsIDAuODg1OCwgMC45NzI5NiwgMS4wMTI4NCwgMC45NTc4MiwgMC44MzA4OSwgMS4wOTc2LCAxLjA0LCAxLjAzMzQyLCAxLjIsIDEuMDY3NSwgMS4wOTc2LCAwLjk4MjA1LCAxLjAzODA5LCAxLjA1MDk3LCAxLjA0LCAwLjk1MzY0LCAxLjAzMzQyLCAxLjA1NDAxLCAxLjIsIDEuMDIxNDgsIDEuMDExOSwgMS4wNDcyNCwgMS4wMTI3LCAxLjAyNzMyLCAwLjk2MjI1LCAwLjg5NjUsIDAuOTc3ODMsIDAuOTM1NzQsIDAuOTQ4MTgsIDEuMzA2NzksIDEuMDY3NSwgMS4xMTgyNiwgMC45OTgyMSwgMS4wNTU3LCAxLjAzMjYsIDEuMiwgMS4wNjc1LCAwLjk2MjI1LCAxLjA2NzUsIDEuMDMyNiwgMC43NDgxNywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wMzc1NCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44NzUzMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45ODcwNSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45ODQ0OCwgMC45OTczLCAwLjk4NDQ4LCAwLjk5NzMsIDAuOTg0NDgsIDAuOTk3MywgMC44MzA4OSwgMC45Njc3NywgMSwgMS4yMDA4OCwgMC44OTkwMywgMSwgMSwgMC43NTE1NSwgMC45NDk0NSwgMC45NDk0NSwgMC45NDk0NSwgMC45NDk0NSwgMS4xMjMxNywgMS4xMjMxNywgMS4xMjMxNywgMC42NzYwMywgMC42NzYwMywgMS4xNTYyMSwgMC43MzU4NCwgMS4yMTE5MSwgMS4yMjEzNSwgMS4wNjQ4MywgMC45NDg2OCwgMC45NDg2OCwgMC45NTk5NiwgMS4yNDYzMywgMSwgMS4wNzQ5NywgMC44NzcwOSwgMC45NjkyNywgMS4wMTQ3MywgMC45NjkyNywgMSwgMSwgMSwgMC43NzI5NSwgMSwgMSwgMS4wOTgzNiwgMS4wOTgzNiwgMS4wOTgzNiwgMS4wMTUyMiwgMC44NjMyMSwgMC45NDQzNCwgMC44NjQ5LCAwLjk0NDM0LCAwLjg2MTgyLCAxLCAxLCAxLjA4MywgMSwgMC45MTU3OCwgMC44NjQzOCwgMS4xNzMwOCwgMS4xODQxNiwgMS4xNDU4OSwgMC42OTgyNSwgMC45NzYyMiwgMS45Njc5MSwgMS4yNDgyMiwgMS4yNDgyMiwgMS4xNzMwOCwgMS4yNDgyMiwgMS4yNDgyMiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS40MjYwMywgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMS4xNzk4NCwgMS40MjYwMywgMSwgMS40MjYwMywgMS40MjYwMywgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4yODg2LCAxLjA0MzE1LCAxLjE1Mjk2LCAxLjM0MTYzLCAxLCAxLCAxLCAxLjEwNzQyLCAxLjEwNzQyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgU2Vnb2V1aUl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zMzAwOCwKICBsaW5lR2FwOiAwCn07CmNvbnN0IFNlZ29ldWlSZWd1bGFyRmFjdG9ycyA9IFsxLjc2NzM4LCAxLCAxLCAwLjk4NTk0LCAxLjAyMjg1LCAxLjEwNDU0LCAxLjA2MjM0LCAwLjk2OTI3LCAwLjkyMDM3LCAxLjE5OTg1LCAxLjIwNDYsIDAuOTA2MTYsIDAuOTA2MTYsIDEuMDcxNTIsIDEuMTcxNCwgMC43ODAzMiwgMS4yMDA4OCwgMC43ODAzMiwgMS40MDI0NiwgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC43ODAzMiwgMC43ODAzMiwgMS4xNzE0LCAxLjE3MTQsIDEuMTcxNCwgMC44MDU5NywgMC45NDA4NCwgMC45NjcwNiwgMC44NTk0NCwgMC44NTczNCwgMC45NzA5MywgMC43NTg0MiwgMC43OTkzNiwgMC44ODE5OCwgMC45ODMxLCAwLjk1NzgyLCAwLjcxMzg3LCAwLjg2OTY5LCAwLjg0NjM2LCAxLjA3Nzk2LCAxLjAzNTg0LCAwLjk2OTI0LCAwLjgzOTY4LCAwLjk2OTI0LCAwLjgyODI2LCAwLjc5NjQ5LCAwLjg1NzcxLCAwLjk1MTMyLCAwLjkzMTE5LCAwLjk4OTY1LCAwLjg4NDMzLCAwLjgyODcsIDAuOTMzNjUsIDEuMDg2MTIsIDEuMzYzOCwgMS4wODYxMiwgMS40NTc4NiwgMC43NDYyNywgMC44MDQ5OSwgMC45MTQ4NCwgMS4wNTcwNywgMC45MjM4MywgMS4wNTg4MiwgMC45NDAzLCAxLjEyNjU0LCAxLjA1ODgyLCAxLjAxNzU2LCAxLjA5MDExLCAxLjA5MDExLCAwLjk5NDE0LCAxLjA5MDExLCAxLjAzNCwgMS4wMTc1NiwgMS4wNTM1NiwgMS4wNTcwNywgMS4wNTg4MiwgMS4wNDM5OSwgMC44NDg2MywgMS4yMTk2OCwgMS4wMTc1NiwgMC45NTgwMSwgMS4wMDA2OCwgMC45MTc5NywgMC45Njc3NywgMC45MDQzLCAwLjkwMzUxLCAwLjkyMTA1LCAwLjkwMzUxLCAxLjE3MTQsIDAuODUzMzcsIDAuOTY5MjcsIDAuOTY5MjcsIDAuOTk5MTIsIDAuOTY5MjcsIDAuOTIxMDUsIDAuODA1OTcsIDEuMjQzNCwgMS4yMDgwOCwgMS4wNTkzNywgMC45MDk1NywgMS4xNzE0LCAxLjIwODA4LCAwLjc1MTU1LCAwLjk0MjYxLCAxLjI0NjQ0LCAxLjA5OTcxLCAxLjA5OTcxLCAwLjg0NzUxLCAxLCAwLjg1MjczLCAwLjc4MDMyLCAwLjYxNTg0LCAxLjA1NDI1LCAxLjE3OTE0LCAwLjkwOTU3LCAxLjA4NjY1LCAxLjExNTkzLCAxLjE0MTY5LCAwLjczMzgxLCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjk2NzA2LCAwLjg2MDM1LCAwLjg1NzM0LCAwLjc1ODQyLCAwLjc1ODQyLCAwLjc1ODQyLCAwLjc1ODQyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk3MDkzLCAxLjAzNTg0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAxLjE3MTQsIDAuOTY5MjQsIDAuOTUxMzIsIDAuOTUxMzIsIDAuOTUxMzIsIDAuOTUxMzIsIDAuODI4NywgMC44Mzk2OCwgMC44OTA0OSwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MTQ4NCwgMC45MzU3NSwgMC45MjM4MywgMC45NDAzLCAwLjk0MDMsIDAuOTQwMywgMC45NDAzLCAwLjg3MTcsIDAuODcxNywgMC44NzE3LCAwLjg3MTcsIDEuMDA1MjcsIDEuMDE3NTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMDUzNTYsIDEuMjQ2NDQsIDAuOTU5MjMsIDEuMDE3NTYsIDEuMDE3NTYsIDEuMDE3NTYsIDEuMDE3NTYsIDAuOTY3NzcsIDEuMDU3MDcsIDAuOTY3NzcsIDAuOTY3MDYsIDAuOTE0ODQsIDAuOTY3MDYsIDAuOTE0ODQsIDAuOTY3MDYsIDAuOTE0ODQsIDAuODU3MzQsIDAuOTIzODMsIDAuODU3MzQsIDAuOTIzODMsIDAuODU3MzQsIDAuOTIzODMsIDAuODU3MzQsIDAuOTIzODMsIDAuOTcwOTMsIDEuMDk2OSwgMC45NzA5MywgMS4wNTg4MiwgMC43NTg0MiwgMC45NDAzLCAwLjc1ODQyLCAwLjk0MDMsIDAuNzU4NDIsIDAuOTQwMywgMC43NTg0MiwgMC45NDAzLCAwLjc1ODQyLCAwLjk0MDMsIDAuODgxOTgsIDEuMDU4ODIsIDAuODgxOTgsIDEuMDU4ODIsIDAuODgxOTgsIDEuMDU4ODIsIDEsIDEsIDAuOTgzMSwgMS4wMTc1NiwgMC45ODMxLCAxLjAxNzU2LCAwLjk1NzgyLCAwLjg3MTcsIDAuOTU3ODIsIDAuODcxNywgMC45NTc4MiwgMC44NzE3LCAwLjk1NzgyLCAxLjA5MDExLCAwLjk1NzgyLCAwLjg3MTcsIDAuODQ3ODQsIDEuMTE1NTEsIDAuNzEzODcsIDEuMDkwMTEsIDEsIDEsIDAuOTk0MTQsIDAuODQ2MzYsIDEuMDkwMTEsIDEsIDEsIDAuODQ2MzYsIDEuMDUzNiwgMC44NDYzNiwgMC45NDI5OCwgMC44NDYzNiwgMS4yMzI5NywgMS4wMzU4NCwgMS4wMTc1NiwgMSwgMSwgMS4wMzU4NCwgMS4wMTc1NiwgMS4wMDMyMywgMS4wMzQ0NCwgMS4wMTc1NiwgMC45NjkyNCwgMS4wNTM1NiwgMC45NjkyNCwgMS4wNTM1NiwgMC45NjkyNCwgMS4wNTM1NiwgMC45MzA2NiwgMC45ODI5MywgMC44MjgyNiwgMS4wNDM5OSwgMSwgMSwgMC44MjgyNiwgMS4wNDM5OSwgMC43OTY0OSwgMC44NDg2MywgMC43OTY0OSwgMC44NDg2MywgMC43OTY0OSwgMC44NDg2MywgMC43OTY0OSwgMC44NDg2MywgMSwgMSwgMC44NTc3MSwgMS4xNzMxOCwgMC44NTc3MSwgMS4yMTk2OCwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45NTEzMiwgMS4wMTc1NiwgMC45ODk2NSwgMS4wMDA2OCwgMC44Mjg3LCAwLjk2Nzc3LCAwLjgyODcsIDAuOTMzNjUsIDAuOTA0MywgMC45MzM2NSwgMC45MDQzLCAwLjkzMzY1LCAwLjkwNDMsIDEuMDg1NzEsIDAuOTY5MjcsIDAuOTY3MDYsIDAuOTE0ODQsIDAuODYwMzUsIDAuOTM1NzUsIDAuOTY5MjQsIDAuOTU5MjMsIDEsIDEsIDAuODU3NzEsIDEuMjE5NjgsIDEuMTE0MzcsIDEuMTE0MzcsIDAuOTMxMDksIDAuOTEyMDIsIDAuNjA0MTEsIDAuODQxNjQsIDAuNTU1NzIsIDEuMDExNzMsIDAuOTczNjEsIDAuODE4MTgsIDAuODE4MTgsIDAuOTY2MzUsIDAuNzgwMzIsIDAuNzI3MjcsIDAuOTIzNjYsIDAuOTg2MDEsIDEuMDM0MDUsIDAuNzc5NjgsIDEuMDk3OTksIDEuMiwgMC45NjcwNiwgMC44NTk0NCwgMC44NTYzOCwgMC45NjQ5MSwgMC43NTg0MiwgMC45MzM2NSwgMC45ODMxLCAwLjk2OTI0LCAwLjk1NzgyLCAwLjg2OTY5LCAwLjk0MTUyLCAxLjA3Nzk2LCAxLjAzNTg0LCAwLjc4NDM3LCAwLjk2OTI0LCAwLjk4NzE1LCAwLjgzOTY4LCAwLjgzNDkxLCAwLjg1NzcxLCAwLjgyODcsIDAuOTQ0OTIsIDAuODg0MzMsIDAuOTI4NywgMS4wMDk4LCAwLjk1NzgyLCAwLjgyODcsIDEuMDYyNSwgMC45ODI0OCwgMS4wMzQyNCwgMS4yLCAxLjAxMDcxLCAxLjA2MjUsIDAuOTUyNDYsIDEuMDM4MDksIDEuMDQ5MTIsIDAuOTgyNDgsIDEuMDAyMjEsIDEuMDM0MjQsIDEuMDU0NDMsIDEuMiwgMS4wNDc4NSwgMC45OTYwOSwgMS4wMDE2OSwgMS4wNTE3NiwgMC45OTM0NiwgMS4wNTM1NiwgMC45MDg3LCAxLjAzMDA0LCAwLjk1NTQyLCAwLjkzMTE3LCAxLjIzMzYyLCAxLjAxMDcxLCAxLjA3ODMxLCAxLjAyNTEyLCAxLjA1MjA1LCAxLjAzNTAyLCAxLjIsIDEuMDEwNzEsIDEuMDUzNTYsIDEuMDEwNzEsIDEuMDM1MDIsIDAuNzU4NDIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDM3MTksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTQwMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNDAyMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45ODk2NSwgMS4wMDA2OCwgMC45ODk2NSwgMS4wMDA2OCwgMC45ODk2NSwgMS4wMDA2OCwgMC44Mjg3LCAwLjk2Nzc3LCAxLCAxLjIwMDg4LCAwLjg5OTAzLCAxLCAxLCAwLjc1MTU1LCAxLjAzMDc3LCAxLjAzMDc3LCAxLjAzMDc3LCAxLjAzMDc3LCAxLjEzMTk2LCAxLjEzMTk2LCAxLjEzMTk2LCAwLjY3NDI4LCAwLjY3NDI4LCAxLjE2MDM5LCAwLjczMjkxLCAxLjIwOTk2LCAxLjIyMTM1LCAxLjA2NDgzLCAwLjk0ODY4LCAwLjk0ODY4LCAwLjk1OTk2LCAxLjI0NjMzLCAxLCAxLjA3NDk3LCAwLjg3Nzk2LCAwLjk2OTI3LCAxLjAxNTE4LCAwLjk2OTI3LCAxLCAxLCAxLCAwLjc3Mjk1LCAxLCAxLCAxLjEwNTM5LCAxLjEwNTM5LCAxLjExMzU4LCAxLjA2OTY3LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2MTgyLCAxLCAxLCAxLjA4MywgMSwgMC45MTU3OCwgMC44NjUwNywgMS4xNzE0LCAxLjE4NDE2LCAxLjE0NTg5LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjk2OTcsIDEuMjQ4MjIsIDEuMjQ4MjIsIDEuMTcyMzgsIDEuMjQ4MjIsIDEuMjQ4MjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTgwODMsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4xMDkzOCwgMS4xMDkzOCwgMSwgMSwgMSwgMS4wNTQyNSwgMS4wOTk3MSwgMS4wOTk3MSwgMS4wOTk3MSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IFNlZ29ldWlSZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjMzMDA4LAogIGxpbmVHYXA6IDAKfTsKCjsvLyAuL3NyYy9jb3JlL3hmYV9mb250cy5qcwoKCgoKCgoKCmNvbnN0IGdldFhGQUZvbnRNYXAgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WyJNeXJpYWRQcm8tUmVndWxhciJdID0gdFsiUGRmSlMtRmFsbGJhY2stUmVndWxhciJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIiLAogICAgZmFjdG9yczogTXlyaWFkUHJvUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IE15cmlhZFByb1JlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJNeXJpYWRQcm8tQm9sZCJdID0gdFsiUGRmSlMtRmFsbGJhY2stQm9sZCJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGQiLAogICAgZmFjdG9yczogTXlyaWFkUHJvQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IE15cmlhZFByb0JvbGRNZXRyaWNzCiAgfTsKICB0WyJNeXJpYWRQcm8tSXQiXSA9IHRbIk15cmlhZFByby1JdGFsaWMiXSA9IHRbIlBkZkpTLUZhbGxiYWNrLUl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUl0YWxpYyIsCiAgICBmYWN0b3JzOiBNeXJpYWRQcm9JdGFsaWNGYWN0b3JzLAogICAgYmFzZVdpZHRoczogTGliZXJhdGlvblNhbnNJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNJdGFsaWNNYXBwaW5nLAogICAgbWV0cmljczogTXlyaWFkUHJvSXRhbGljTWV0cmljcwogIH07CiAgdFsiTXlyaWFkUHJvLUJvbGRJdCJdID0gdFsiTXlyaWFkUHJvLUJvbGRJdGFsaWMiXSA9IHRbIlBkZkpTLUZhbGxiYWNrLUJvbGRJdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljIiwKICAgIGZhY3RvcnM6IE15cmlhZFByb0JvbGRJdGFsaWNGYWN0b3JzLAogICAgYmFzZVdpZHRoczogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBNeXJpYWRQcm9Cb2xkSXRhbGljTWV0cmljcwogIH07CiAgdC5BcmlhbE1UID0gdC5BcmlhbCA9IHRbIkFyaWFsLVJlZ3VsYXIiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIiwKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nCiAgfTsKICB0WyJBcmlhbC1Cb2xkTVQiXSA9IHRbIkFyaWFsLUJvbGQiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkIiwKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nCiAgfTsKICB0WyJBcmlhbC1JdGFsaWNNVCJdID0gdFsiQXJpYWwtSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtSXRhbGljIiwKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZwogIH07CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01UIl0gPSB0WyJBcmlhbC1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZwogIH07CiAgdFsiQ2FsaWJyaS1SZWd1bGFyIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBDYWxpYnJpUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IENhbGlicmlSZWd1bGFyTWV0cmljcwogIH07CiAgdFsiQ2FsaWJyaS1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBDYWxpYnJpQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IENhbGlicmlCb2xkTWV0cmljcwogIH07CiAgdFsiQ2FsaWJyaS1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgZmFjdG9yczogQ2FsaWJyaUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBDYWxpYnJpSXRhbGljTWV0cmljcwogIH07CiAgdFsiQ2FsaWJyaS1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBmYWN0b3JzOiBDYWxpYnJpQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IENhbGlicmlCb2xkSXRhbGljTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1SZWd1bGFyIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBTZWdvZXVpUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IFNlZ29ldWlSZWd1bGFyTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBTZWdvZXVpQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IFNlZ29ldWlCb2xkTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgZmFjdG9yczogU2Vnb2V1aUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBTZWdvZXVpSXRhbGljTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBmYWN0b3JzOiBTZWdvZXVpQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IFNlZ29ldWlCb2xkSXRhbGljTWV0cmljcwogIH07CiAgdFsiSGVsdmV0aWNhLVJlZ3VsYXIiXSA9IHQuSGVsdmV0aWNhID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIiLAogICAgZmFjdG9yczogSGVsdmV0aWNhUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IEhlbHZldGljYVJlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtQm9sZCJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGQiLAogICAgZmFjdG9yczogSGVsdmV0aWNhQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IEhlbHZldGljYUJvbGRNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtSXRhbGljIiwKICAgIGZhY3RvcnM6IEhlbHZldGljYUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBIZWx2ZXRpY2FJdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtQm9sZEl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMiLAogICAgZmFjdG9yczogSGVsdmV0aWNhQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IEhlbHZldGljYUJvbGRJdGFsaWNNZXRyaWNzCiAgfTsKfSk7CmZ1bmN0aW9uIGdldFhmYUZvbnROYW1lKG5hbWUpIHsKICBjb25zdCBmb250TmFtZSA9IG5vcm1hbGl6ZUZvbnROYW1lKG5hbWUpOwogIGNvbnN0IGZvbnRNYXAgPSBnZXRYRkFGb250TWFwKCk7CiAgcmV0dXJuIGZvbnRNYXBbZm9udE5hbWVdOwp9CmZ1bmN0aW9uIGdldFhmYUZvbnRXaWR0aHMobmFtZSkgewogIGNvbnN0IGluZm8gPSBnZXRYZmFGb250TmFtZShuYW1lKTsKICBpZiAoIWluZm8pIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCB7CiAgICBiYXNlV2lkdGhzLAogICAgYmFzZU1hcHBpbmcsCiAgICBmYWN0b3JzCiAgfSA9IGluZm87CiAgY29uc3QgcmVzY2FsZWRCYXNlV2lkdGhzID0gIWZhY3RvcnMgPyBiYXNlV2lkdGhzIDogYmFzZVdpZHRocy5tYXAoKHcsIGkpID0+IHcgKiBmYWN0b3JzW2ldKTsKICBsZXQgY3VycmVudENvZGUgPSAtMjsKICBsZXQgY3VycmVudEFycmF5OwogIGNvbnN0IG5ld1dpZHRocyA9IFtdOwogIGZvciAoY29uc3QgW3VuaWNvZGUsIGdseXBoSW5kZXhdIG9mIGJhc2VNYXBwaW5nLm1hcCgoY2hhclVuaWNvZGUsIGluZGV4KSA9PiBbY2hhclVuaWNvZGUsIGluZGV4XSkuc29ydCgoW3VuaWNvZGUxXSwgW3VuaWNvZGUyXSkgPT4gdW5pY29kZTEgLSB1bmljb2RlMikpIHsKICAgIGlmICh1bmljb2RlID09PSAtMSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmICh1bmljb2RlID09PSBjdXJyZW50Q29kZSArIDEpIHsKICAgICAgY3VycmVudEFycmF5LnB1c2gocmVzY2FsZWRCYXNlV2lkdGhzW2dseXBoSW5kZXhdKTsKICAgICAgY3VycmVudENvZGUgKz0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnRDb2RlID0gdW5pY29kZTsKICAgICAgY3VycmVudEFycmF5ID0gW3Jlc2NhbGVkQmFzZVdpZHRoc1tnbHlwaEluZGV4XV07CiAgICAgIG5ld1dpZHRocy5wdXNoKHVuaWNvZGUsIGN1cnJlbnRBcnJheSk7CiAgICB9CiAgfQogIHJldHVybiBuZXdXaWR0aHM7Cn0KZnVuY3Rpb24gZ2V0WGZhRm9udERpY3QobmFtZSkgewogIGNvbnN0IHdpZHRocyA9IGdldFhmYUZvbnRXaWR0aHMobmFtZSk7CiAgY29uc3QgZGljdCA9IG5ldyBEaWN0KG51bGwpOwogIGRpY3Quc2V0KCJCYXNlRm9udCIsIE5hbWUuZ2V0KG5hbWUpKTsKICBkaWN0LnNldCgiVHlwZSIsIE5hbWUuZ2V0KCJGb250IikpOwogIGRpY3Quc2V0KCJTdWJ0eXBlIiwgTmFtZS5nZXQoIkNJREZvbnRUeXBlMiIpKTsKICBkaWN0LnNldCgiRW5jb2RpbmciLCBOYW1lLmdldCgiSWRlbnRpdHktSCIpKTsKICBkaWN0LnNldCgiQ0lEVG9HSURNYXAiLCBOYW1lLmdldCgiSWRlbnRpdHkiKSk7CiAgZGljdC5zZXQoIlciLCB3aWR0aHMpOwogIGRpY3Quc2V0KCJGaXJzdENoYXIiLCB3aWR0aHNbMF0pOwogIGRpY3Quc2V0KCJMYXN0Q2hhciIsIHdpZHRocy5hdCgtMikgKyB3aWR0aHMuYXQoLTEpLmxlbmd0aCAtIDEpOwogIGNvbnN0IGRlc2NyaXB0b3IgPSBuZXcgRGljdChudWxsKTsKICBkaWN0LnNldCgiRm9udERlc2NyaXB0b3IiLCBkZXNjcmlwdG9yKTsKICBjb25zdCBzeXN0ZW1JbmZvID0gbmV3IERpY3QobnVsbCk7CiAgc3lzdGVtSW5mby5zZXQoIk9yZGVyaW5nIiwgIklkZW50aXR5Iik7CiAgc3lzdGVtSW5mby5zZXQoIlJlZ2lzdHJ5IiwgIkFkb2JlIik7CiAgc3lzdGVtSW5mby5zZXQoIlN1cHBsZW1lbnQiLCAwKTsKICBkaWN0LnNldCgiQ0lEU3lzdGVtSW5mbyIsIHN5c3RlbUluZm8pOwogIHJldHVybiBkaWN0Owp9Cgo7Ly8gLi9zcmMvY29yZS9wc19wYXJzZXIuanMKCgoKY2xhc3MgUG9zdFNjcmlwdFBhcnNlciB7CiAgY29uc3RydWN0b3IobGV4ZXIpIHsKICAgIHRoaXMubGV4ZXIgPSBsZXhlcjsKICAgIHRoaXMub3BlcmF0b3JzID0gW107CiAgICB0aGlzLnRva2VuID0gbnVsbDsKICAgIHRoaXMucHJldiA9IG51bGw7CiAgfQogIG5leHRUb2tlbigpIHsKICAgIHRoaXMucHJldiA9IHRoaXMudG9rZW47CiAgICB0aGlzLnRva2VuID0gdGhpcy5sZXhlci5nZXRUb2tlbigpOwogIH0KICBhY2NlcHQodHlwZSkgewogICAgaWYgKHRoaXMudG9rZW4udHlwZSA9PT0gdHlwZSkgewogICAgICB0aGlzLm5leHRUb2tlbigpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZXhwZWN0KHR5cGUpIHsKICAgIGlmICh0aGlzLmFjY2VwdCh0eXBlKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5leHBlY3RlZCBzeW1ib2w6IGZvdW5kICR7dGhpcy50b2tlbi50eXBlfSBleHBlY3RlZCAke3R5cGV9LmApOwogIH0KICBwYXJzZSgpIHsKICAgIHRoaXMubmV4dFRva2VuKCk7CiAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5MQlJBQ0UpOwogICAgdGhpcy5wYXJzZUJsb2NrKCk7CiAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgcmV0dXJuIHRoaXMub3BlcmF0b3JzOwogIH0KICBwYXJzZUJsb2NrKCkgewogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLk5VTUJFUikpIHsKICAgICAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKHRoaXMucHJldi52YWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuT1BFUkFUT1IpKSB7CiAgICAgICAgdGhpcy5vcGVyYXRvcnMucHVzaCh0aGlzLnByZXYudmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSkpIHsKICAgICAgICB0aGlzLnBhcnNlQ29uZGl0aW9uKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgfQogIHBhcnNlQ29uZGl0aW9uKCkgewogICAgY29uc3QgY29uZGl0aW9uTG9jYXRpb24gPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKG51bGwsIG51bGwpOwogICAgdGhpcy5wYXJzZUJsb2NrKCk7CiAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLklGKSkgewogICAgICB0aGlzLm9wZXJhdG9yc1tjb25kaXRpb25Mb2NhdGlvbl0gPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICAgIHRoaXMub3BlcmF0b3JzW2NvbmRpdGlvbkxvY2F0aW9uICsgMV0gPSAianoiOwogICAgfSBlbHNlIGlmICh0aGlzLmFjY2VwdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5MQlJBQ0UpKSB7CiAgICAgIGNvbnN0IGp1bXBMb2NhdGlvbiA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgICAgdGhpcy5vcGVyYXRvcnMucHVzaChudWxsLCBudWxsKTsKICAgICAgY29uc3QgZW5kT2ZUcnVlID0gdGhpcy5vcGVyYXRvcnMubGVuZ3RoOwogICAgICB0aGlzLnBhcnNlQmxvY2soKTsKICAgICAgdGhpcy5leHBlY3QoUG9zdFNjcmlwdFRva2VuVHlwZXMuUkJSQUNFKTsKICAgICAgdGhpcy5leHBlY3QoUG9zdFNjcmlwdFRva2VuVHlwZXMuSUZFTFNFKTsKICAgICAgdGhpcy5vcGVyYXRvcnNbanVtcExvY2F0aW9uXSA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgICAgdGhpcy5vcGVyYXRvcnNbanVtcExvY2F0aW9uICsgMV0gPSAiaiI7CiAgICAgIHRoaXMub3BlcmF0b3JzW2NvbmRpdGlvbkxvY2F0aW9uXSA9IGVuZE9mVHJ1ZTsKICAgICAgdGhpcy5vcGVyYXRvcnNbY29uZGl0aW9uTG9jYXRpb24gKyAxXSA9ICJqeiI7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBTIEZ1bmN0aW9uOiBlcnJvciBwYXJzaW5nIGNvbmRpdGlvbmFsLiIpOwogICAgfQogIH0KfQpjb25zdCBQb3N0U2NyaXB0VG9rZW5UeXBlcyA9IHsKICBMQlJBQ0U6IDAsCiAgUkJSQUNFOiAxLAogIE5VTUJFUjogMiwKICBPUEVSQVRPUjogMywKICBJRjogNCwKICBJRkVMU0U6IDUKfTsKY2xhc3MgUG9zdFNjcmlwdFRva2VuIHsKICBzdGF0aWMgZ2V0IG9wQ2FjaGUoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJvcENhY2hlIiwgT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgfQogIGNvbnN0cnVjdG9yKHR5cGUsIHZhbHVlKSB7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogIH0KICBzdGF0aWMgZ2V0T3BlcmF0b3Iob3ApIHsKICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4ub3BDYWNoZVtvcF0gfHw9IG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuT1BFUkFUT1IsIG9wKTsKICB9CiAgc3RhdGljIGdldCBMQlJBQ0UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJMQlJBQ0UiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSwgInsiKSk7CiAgfQogIHN0YXRpYyBnZXQgUkJSQUNFKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiUkJSQUNFIiwgbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UsICJ9IikpOwogIH0KICBzdGF0aWMgZ2V0IElGKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiSUYiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLklGLCAiSUYiKSk7CiAgfQogIHN0YXRpYyBnZXQgSUZFTFNFKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiSUZFTFNFIiwgbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRkVMU0UsICJJRkVMU0UiKSk7CiAgfQp9CmNsYXNzIFBvc3RTY3JpcHRMZXhlciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtKSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMubmV4dENoYXIoKTsKICAgIHRoaXMuc3RyQnVmID0gW107CiAgfQogIG5leHRDaGFyKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudENoYXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgfQogIGdldFRva2VuKCkgewogICAgbGV0IGNvbW1lbnQgPSBmYWxzZTsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY2ggPCAwKSB7CiAgICAgICAgcmV0dXJuIEVPRjsKICAgICAgfQogICAgICBpZiAoY29tbWVudCkgewogICAgICAgIGlmIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCkgewogICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyNSkgewogICAgICAgIGNvbW1lbnQgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKCFpc1doaXRlU3BhY2UoY2gpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICBjYXNlIDB4MzA6CiAgICAgIGNhc2UgMHgzMToKICAgICAgY2FzZSAweDMyOgogICAgICBjYXNlIDB4MzM6CiAgICAgIGNhc2UgMHgzNDoKICAgICAgY2FzZSAweDM1OgogICAgICBjYXNlIDB4MzY6CiAgICAgIGNhc2UgMHgzNzoKICAgICAgY2FzZSAweDM4OgogICAgICBjYXNlIDB4Mzk6CiAgICAgIGNhc2UgMHgyYjoKICAgICAgY2FzZSAweDJkOgogICAgICBjYXNlIDB4MmU6CiAgICAgICAgcmV0dXJuIG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuTlVNQkVSLCB0aGlzLmdldE51bWJlcigpKTsKICAgICAgY2FzZSAweDdiOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLkxCUkFDRTsKICAgICAgY2FzZSAweDdkOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLlJCUkFDRTsKICAgIH0KICAgIGNvbnN0IHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICBzdHJCdWZbMF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDAgJiYgKGNoID49IDB4NDEgJiYgY2ggPD0gMHg1YSB8fCBjaCA+PSAweDYxICYmIGNoIDw9IDB4N2EpKSB7CiAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgIH0KICAgIGNvbnN0IHN0ciA9IHN0ckJ1Zi5qb2luKCIiKTsKICAgIHN3aXRjaCAoc3RyLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgY2FzZSAiaWYiOgogICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uSUY7CiAgICAgIGNhc2UgImlmZWxzZSI6CiAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5JRkVMU0U7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5nZXRPcGVyYXRvcihzdHIpOwogICAgfQogIH0KICBnZXROdW1iZXIoKSB7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgY29uc3Qgc3RyQnVmID0gdGhpcy5zdHJCdWY7CiAgICBzdHJCdWYubGVuZ3RoID0gMDsKICAgIHN0ckJ1ZlswXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCkgewogICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5IHx8IGNoID09PSAweDJkIHx8IGNoID09PSAweDJlKSB7CiAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICB9IGVsc2UgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQoc3RyQnVmLmpvaW4oIiIpKTsKICAgIGlmIChpc05hTih2YWx1ZSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGZsb2F0aW5nIHBvaW50IG51bWJlcjogJHt2YWx1ZX1gKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ltYWdlX3V0aWxzLmpzCgoKY2xhc3MgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHRoaXMuX29ubHlSZWZzID0gb3B0aW9ucz8ub25seVJlZnMgPT09IHRydWU7CiAgICBpZiAoIXRoaXMuX29ubHlSZWZzKSB7CiAgICAgIHRoaXMuX25hbWVSZWZNYXAgPSBuZXcgTWFwKCk7CiAgICAgIHRoaXMuX2ltYWdlTWFwID0gbmV3IE1hcCgpOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIH0KICBnZXRCeU5hbWUobmFtZSkgewogICAgaWYgKHRoaXMuX29ubHlSZWZzKSB7CiAgICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgYGdldEJ5TmFtZWAgbWV0aG9kLiIpOwogICAgfQogICAgY29uc3QgcmVmID0gdGhpcy5fbmFtZVJlZk1hcC5nZXQobmFtZSk7CiAgICBpZiAocmVmKSB7CiAgICAgIHJldHVybiB0aGlzLmdldEJ5UmVmKHJlZik7CiAgICB9CiAgICByZXR1cm4gdGhpcy5faW1hZ2VNYXAuZ2V0KG5hbWUpIHx8IG51bGw7CiAgfQogIGdldEJ5UmVmKHJlZikgewogICAgcmV0dXJuIHRoaXMuX2ltYWdlQ2FjaGUuZ2V0KHJlZikgfHwgbnVsbDsKICB9CiAgc2V0KG5hbWUsIHJlZiwgZGF0YSkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgc2V0YCBjYWxsZWQuIik7CiAgfQp9CmNsYXNzIExvY2FsSW1hZ2VDYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBzZXQobmFtZSwgcmVmID0gbnVsbCwgZGF0YSkgewogICAgaWYgKHR5cGVvZiBuYW1lICE9PSAic3RyaW5nIikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsSW1hZ2VDYWNoZS5zZXQgLSBleHBlY3RlZCAibmFtZSIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAocmVmKSB7CiAgICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX25hbWVSZWZNYXAuc2V0KG5hbWUsIHJlZik7CiAgICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZU1hcC5oYXMobmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VNYXAuc2V0KG5hbWUsIGRhdGEpOwogIH0KfQpjbGFzcyBMb2NhbENvbG9yU3BhY2VDYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBzZXQobmFtZSA9IG51bGwsIHJlZiA9IG51bGwsIGRhdGEpIHsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIgJiYgIXJlZikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsQ29sb3JTcGFjZUNhY2hlLnNldCAtIGV4cGVjdGVkICJuYW1lIiBhbmQvb3IgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAocmVmKSB7CiAgICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChuYW1lICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5fbmFtZVJlZk1hcC5zZXQobmFtZSwgcmVmKTsKICAgICAgfQogICAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VNYXAuaGFzKG5hbWUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlTWFwLnNldChuYW1lLCBkYXRhKTsKICB9Cn0KY2xhc3MgTG9jYWxGdW5jdGlvbkNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKHsKICAgICAgb25seVJlZnM6IHRydWUKICAgIH0pOwogIH0KICBzZXQobmFtZSA9IG51bGwsIHJlZiwgZGF0YSkgewogICAgaWYgKCFyZWYpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbEZ1bmN0aW9uQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogIH0KfQpjbGFzcyBMb2NhbEdTdGF0ZUNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIHNldChuYW1lLCByZWYgPSBudWxsLCBkYXRhKSB7CiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICJzdHJpbmciKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxHU3RhdGVDYWNoZS5zZXQgLSBleHBlY3RlZCAibmFtZSIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAocmVmKSB7CiAgICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX25hbWVSZWZNYXAuc2V0KG5hbWUsIHJlZik7CiAgICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZU1hcC5oYXMobmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VNYXAuc2V0KG5hbWUsIGRhdGEpOwogIH0KfQpjbGFzcyBMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcih7CiAgICAgIG9ubHlSZWZzOiB0cnVlCiAgICB9KTsKICB9CiAgc2V0KG5hbWUgPSBudWxsLCByZWYsIGRhdGEpIHsKICAgIGlmICghcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogIH0KfQpjbGFzcyBSZWdpb25hbEltYWdlQ2FjaGUgZXh0ZW5kcyBCYXNlTG9jYWxDYWNoZSB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgc3VwZXIoewogICAgICBvbmx5UmVmczogdHJ1ZQogICAgfSk7CiAgfQogIHNldChuYW1lID0gbnVsbCwgcmVmLCBkYXRhKSB7CiAgICBpZiAoIXJlZikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZ2lvbmFsSW1hZ2VDYWNoZS5zZXQgLSBleHBlY3RlZCAicmVmIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgfQp9CmNsYXNzIEdsb2JhbENvbG9yU3BhY2VDYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcih7CiAgICAgIG9ubHlSZWZzOiB0cnVlCiAgICB9KTsKICB9CiAgc2V0KG5hbWUgPSBudWxsLCByZWYsIGRhdGEpIHsKICAgIGlmICghcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignR2xvYmFsQ29sb3JTcGFjZUNhY2hlLnNldCAtIGV4cGVjdGVkICJyZWYiIGFyZ3VtZW50LicpOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICB9CiAgY2xlYXIoKSB7CiAgICB0aGlzLl9pbWFnZUNhY2hlLmNsZWFyKCk7CiAgfQp9CmNsYXNzIEdsb2JhbEltYWdlQ2FjaGUgewogIHN0YXRpYyBOVU1fUEFHRVNfVEhSRVNIT0xEID0gMjsKICBzdGF0aWMgTUlOX0lNQUdFU19UT19DQUNIRSA9IDEwOwogIHN0YXRpYyBNQVhfQllURV9TSVpFID0gNWU3OwogICNkZWNvZGVGYWlsZWRTZXQgPSBuZXcgUmVmU2V0KCk7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLl9yZWZDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgdGhpcy5faW1hZ2VDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIH0KICBnZXQgI2J5dGVTaXplKCkgewogICAgbGV0IGJ5dGVTaXplID0gMDsKICAgIGZvciAoY29uc3QgaW1hZ2VEYXRhIG9mIHRoaXMuX2ltYWdlQ2FjaGUpIHsKICAgICAgYnl0ZVNpemUgKz0gaW1hZ2VEYXRhLmJ5dGVTaXplOwogICAgfQogICAgcmV0dXJuIGJ5dGVTaXplOwogIH0KICBnZXQgI2NhY2hlTGltaXRSZWFjaGVkKCkgewogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuc2l6ZSA8IEdsb2JhbEltYWdlQ2FjaGUuTUlOX0lNQUdFU19UT19DQUNIRSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy4jYnl0ZVNpemUgPCBHbG9iYWxJbWFnZUNhY2hlLk1BWF9CWVRFX1NJWkUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIHNob3VsZENhY2hlKHJlZiwgcGFnZUluZGV4KSB7CiAgICBsZXQgcGFnZUluZGV4U2V0ID0gdGhpcy5fcmVmQ2FjaGUuZ2V0KHJlZik7CiAgICBpZiAoIXBhZ2VJbmRleFNldCkgewogICAgICBwYWdlSW5kZXhTZXQgPSBuZXcgU2V0KCk7CiAgICAgIHRoaXMuX3JlZkNhY2hlLnB1dChyZWYsIHBhZ2VJbmRleFNldCk7CiAgICB9CiAgICBwYWdlSW5kZXhTZXQuYWRkKHBhZ2VJbmRleCk7CiAgICBpZiAocGFnZUluZGV4U2V0LnNpemUgPCBHbG9iYWxJbWFnZUNhY2hlLk5VTV9QQUdFU19USFJFU0hPTEQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKCF0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpICYmIHRoaXMuI2NhY2hlTGltaXRSZWFjaGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBhZGREZWNvZGVGYWlsZWQocmVmKSB7CiAgICB0aGlzLiNkZWNvZGVGYWlsZWRTZXQucHV0KHJlZik7CiAgfQogIGhhc0RlY29kZUZhaWxlZChyZWYpIHsKICAgIHJldHVybiB0aGlzLiNkZWNvZGVGYWlsZWRTZXQuaGFzKHJlZik7CiAgfQogIGFkZEJ5dGVTaXplKHJlZiwgYnl0ZVNpemUpIHsKICAgIGNvbnN0IGltYWdlRGF0YSA9IHRoaXMuX2ltYWdlQ2FjaGUuZ2V0KHJlZik7CiAgICBpZiAoIWltYWdlRGF0YSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoaW1hZ2VEYXRhLmJ5dGVTaXplKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGltYWdlRGF0YS5ieXRlU2l6ZSA9IGJ5dGVTaXplOwogIH0KICBnZXREYXRhKHJlZiwgcGFnZUluZGV4KSB7CiAgICBjb25zdCBwYWdlSW5kZXhTZXQgPSB0aGlzLl9yZWZDYWNoZS5nZXQocmVmKTsKICAgIGlmICghcGFnZUluZGV4U2V0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHBhZ2VJbmRleFNldC5zaXplIDwgR2xvYmFsSW1hZ2VDYWNoZS5OVU1fUEFHRVNfVEhSRVNIT0xEKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgaW1hZ2VEYXRhID0gdGhpcy5faW1hZ2VDYWNoZS5nZXQocmVmKTsKICAgIGlmICghaW1hZ2VEYXRhKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcGFnZUluZGV4U2V0LmFkZChwYWdlSW5kZXgpOwogICAgcmV0dXJuIGltYWdlRGF0YTsKICB9CiAgc2V0RGF0YShyZWYsIGRhdGEpIHsKICAgIGlmICghdGhpcy5fcmVmQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdHbG9iYWxJbWFnZUNhY2hlLnNldERhdGEgLSBleHBlY3RlZCAic2hvdWxkQ2FjaGUiIHRvIGhhdmUgYmVlbiBjYWxsZWQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy4jY2FjaGVMaW1pdFJlYWNoZWQpIHsKICAgICAgd2FybigiR2xvYmFsSW1hZ2VDYWNoZS5zZXREYXRhIC0gY2FjaGUgbGltaXQgcmVhY2hlZC4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICB9CiAgY2xlYXIob25seURhdGEgPSBmYWxzZSkgewogICAgaWYgKCFvbmx5RGF0YSkgewogICAgICB0aGlzLiNkZWNvZGVGYWlsZWRTZXQuY2xlYXIoKTsKICAgICAgdGhpcy5fcmVmQ2FjaGUuY2xlYXIoKTsKICAgIH0KICAgIHRoaXMuX2ltYWdlQ2FjaGUuY2xlYXIoKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2Z1bmN0aW9uLmpzCgoKCgoKCmNsYXNzIFBERkZ1bmN0aW9uRmFjdG9yeSB7CiAgY29uc3RydWN0b3IoewogICAgeHJlZiwKICAgIGlzRXZhbFN1cHBvcnRlZCA9IHRydWUKICB9KSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5pc0V2YWxTdXBwb3J0ZWQgPSBpc0V2YWxTdXBwb3J0ZWQgIT09IGZhbHNlOwogIH0KICBjcmVhdGUoZm4sIHBhcnNlQXJyYXkgPSBmYWxzZSkgewogICAgbGV0IGZuUmVmLCBwYXJzZWRGbjsKICAgIGlmIChmbiBpbnN0YW5jZW9mIFJlZikgewogICAgICBmblJlZiA9IGZuOwogICAgfSBlbHNlIGlmIChmbiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgZm5SZWYgPSBmbi5vYmpJZDsKICAgIH0gZWxzZSBpZiAoZm4gaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgIGZuUmVmID0gZm4uZGljdD8ub2JqSWQ7CiAgICB9CiAgICBpZiAoZm5SZWYpIHsKICAgICAgY29uc3QgY2FjaGVkRm4gPSB0aGlzLl9sb2NhbEZ1bmN0aW9uQ2FjaGUuZ2V0QnlSZWYoZm5SZWYpOwogICAgICBpZiAoY2FjaGVkRm4pIHsKICAgICAgICByZXR1cm4gY2FjaGVkRm47CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGZuT2JqID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZm4pOwogICAgaWYgKEFycmF5LmlzQXJyYXkoZm5PYmopKSB7CiAgICAgIGlmICghcGFyc2VBcnJheSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignUERGRnVuY3Rpb25GYWN0b3J5LmNyZWF0ZSAtIGV4cGVjdGVkICJwYXJzZUFycmF5IiBhcmd1bWVudC4nKTsKICAgICAgfQogICAgICBwYXJzZWRGbiA9IFBERkZ1bmN0aW9uLnBhcnNlQXJyYXkodGhpcywgZm5PYmopOwogICAgfSBlbHNlIHsKICAgICAgcGFyc2VkRm4gPSBQREZGdW5jdGlvbi5wYXJzZSh0aGlzLCBmbk9iaik7CiAgICB9CiAgICBpZiAoZm5SZWYpIHsKICAgICAgdGhpcy5fbG9jYWxGdW5jdGlvbkNhY2hlLnNldChudWxsLCBmblJlZiwgcGFyc2VkRm4pOwogICAgfQogICAgcmV0dXJuIHBhcnNlZEZuOwogIH0KICBnZXQgX2xvY2FsRnVuY3Rpb25DYWNoZSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9sb2NhbEZ1bmN0aW9uQ2FjaGUiLCBuZXcgTG9jYWxGdW5jdGlvbkNhY2hlKCkpOwogIH0KfQpmdW5jdGlvbiB0b051bWJlckFycmF5KGFycikgewogIGlmICghQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKCFpc051bWJlckFycmF5KGFyciwgbnVsbCkpIHsKICAgIHJldHVybiBhcnIubWFwKHggPT4gK3gpOwogIH0KICByZXR1cm4gYXJyOwp9CmNsYXNzIFBERkZ1bmN0aW9uIHsKICBzdGF0aWMgZ2V0U2FtcGxlQXJyYXkoc2l6ZSwgb3V0cHV0U2l6ZSwgYnBzLCBzdHJlYW0pIHsKICAgIGxldCBpLCBpaTsKICAgIGxldCBsZW5ndGggPSAxOwogICAgZm9yIChpID0gMCwgaWkgPSBzaXplLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgbGVuZ3RoICo9IHNpemVbaV07CiAgICB9CiAgICBsZW5ndGggKj0gb3V0cHV0U2l6ZTsKICAgIGNvbnN0IGFycmF5ID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBsZXQgY29kZVNpemUgPSAwOwogICAgbGV0IGNvZGVCdWYgPSAwOwogICAgY29uc3Qgc2FtcGxlTXVsID0gMS4wIC8gKDIuMCAqKiBicHMgLSAxKTsKICAgIGNvbnN0IHN0ckJ5dGVzID0gc3RyZWFtLmdldEJ5dGVzKChsZW5ndGggKiBicHMgKyA3KSAvIDgpOwogICAgbGV0IHN0cklkeCA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgd2hpbGUgKGNvZGVTaXplIDwgYnBzKSB7CiAgICAgICAgY29kZUJ1ZiA8PD0gODsKICAgICAgICBjb2RlQnVmIHw9IHN0ckJ5dGVzW3N0cklkeCsrXTsKICAgICAgICBjb2RlU2l6ZSArPSA4OwogICAgICB9CiAgICAgIGNvZGVTaXplIC09IGJwczsKICAgICAgYXJyYXlbaV0gPSAoY29kZUJ1ZiA+PiBjb2RlU2l6ZSkgKiBzYW1wbGVNdWw7CiAgICAgIGNvZGVCdWYgJj0gKDEgPDwgY29kZVNpemUpIC0gMTsKICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CiAgc3RhdGljIHBhcnNlKGZhY3RvcnksIGZuKSB7CiAgICBjb25zdCBkaWN0ID0gZm4uZGljdCB8fCBmbjsKICAgIGNvbnN0IHR5cGVOdW0gPSBkaWN0LmdldCgiRnVuY3Rpb25UeXBlIik7CiAgICBzd2l0Y2ggKHR5cGVOdW0pIHsKICAgICAgY2FzZSAwOgogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdFNhbXBsZWQoZmFjdG9yeSwgZm4sIGRpY3QpOwogICAgICBjYXNlIDE6CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RJbnRlcnBvbGF0ZWQoZmFjdG9yeSwgZGljdCk7CiAgICAgIGNhc2UgMzoKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RTdGljaGVkKGZhY3RvcnksIGRpY3QpOwogICAgICBjYXNlIDQ6CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0UG9zdFNjcmlwdChmYWN0b3J5LCBmbiwgZGljdCk7CiAgICB9CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZSBvZiBmdW5jdGlvbiIpOwogIH0KICBzdGF0aWMgcGFyc2VBcnJheShmYWN0b3J5LCBmbk9iaikgewogICAgY29uc3QgewogICAgICB4cmVmCiAgICB9ID0gZmFjdG9yeTsKICAgIGNvbnN0IGZuQXJyYXkgPSBbXTsKICAgIGZvciAoY29uc3QgZm4gb2YgZm5PYmopIHsKICAgICAgZm5BcnJheS5wdXNoKHRoaXMucGFyc2UoZmFjdG9yeSwgeHJlZi5mZXRjaElmUmVmKGZuKSkpOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uIChzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmbkFycmF5Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBmbkFycmF5W2ldKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0ICsgaSk7CiAgICAgIH0KICAgIH07CiAgfQogIHN0YXRpYyBjb25zdHJ1Y3RTYW1wbGVkKGZhY3RvcnksIGZuLCBkaWN0KSB7CiAgICBmdW5jdGlvbiB0b011bHRpQXJyYXkoYXJyKSB7CiAgICAgIGNvbnN0IGlucHV0TGVuZ3RoID0gYXJyLmxlbmd0aDsKICAgICAgY29uc3Qgb3V0ID0gW107CiAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRMZW5ndGg7IGkgKz0gMikgewogICAgICAgIG91dFtpbmRleCsrXSA9IFthcnJbaV0sIGFycltpICsgMV1dOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZSh4LCB4bWluLCB4bWF4LCB5bWluLCB5bWF4KSB7CiAgICAgIHJldHVybiB5bWluICsgKHggLSB4bWluKSAqICgoeW1heCAtIHltaW4pIC8gKHhtYXggLSB4bWluKSk7CiAgICB9CiAgICBsZXQgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CiAgICBsZXQgcmFuZ2UgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlJhbmdlIikpOwogICAgaWYgKCFkb21haW4gfHwgIXJhbmdlKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gZG9tYWluIG9yIHJhbmdlIik7CiAgICB9CiAgICBjb25zdCBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoIC8gMjsKICAgIGNvbnN0IG91dHB1dFNpemUgPSByYW5nZS5sZW5ndGggLyAyOwogICAgZG9tYWluID0gdG9NdWx0aUFycmF5KGRvbWFpbik7CiAgICByYW5nZSA9IHRvTXVsdGlBcnJheShyYW5nZSk7CiAgICBjb25zdCBzaXplID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJTaXplIikpOwogICAgY29uc3QgYnBzID0gZGljdC5nZXQoIkJpdHNQZXJTYW1wbGUiKTsKICAgIGNvbnN0IG9yZGVyID0gZGljdC5nZXQoIk9yZGVyIikgfHwgMTsKICAgIGlmIChvcmRlciAhPT0gMSkgewogICAgICBpbmZvKCJObyBzdXBwb3J0IGZvciBjdWJpYyBzcGxpbmUgaW50ZXJwb2xhdGlvbjogIiArIG9yZGVyKTsKICAgIH0KICAgIGxldCBlbmNvZGUgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkVuY29kZSIpKTsKICAgIGlmICghZW5jb2RlKSB7CiAgICAgIGVuY29kZSA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0U2l6ZTsgKytpKSB7CiAgICAgICAgZW5jb2RlLnB1c2goWzAsIHNpemVbaV0gLSAxXSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGVuY29kZSA9IHRvTXVsdGlBcnJheShlbmNvZGUpOwogICAgfQogICAgbGV0IGRlY29kZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRGVjb2RlIikpOwogICAgZGVjb2RlID0gIWRlY29kZSA/IHJhbmdlIDogdG9NdWx0aUFycmF5KGRlY29kZSk7CiAgICBjb25zdCBzYW1wbGVzID0gdGhpcy5nZXRTYW1wbGVBcnJheShzaXplLCBvdXRwdXRTaXplLCBicHMsIGZuKTsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RTYW1wbGVkRm4oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgY29uc3QgY3ViZVZlcnRpY2VzID0gMSA8PCBpbnB1dFNpemU7CiAgICAgIGNvbnN0IGN1YmVOID0gbmV3IEZsb2F0NjRBcnJheShjdWJlVmVydGljZXMpLmZpbGwoMSk7CiAgICAgIGNvbnN0IGN1YmVWZXJ0ZXggPSBuZXcgVWludDMyQXJyYXkoY3ViZVZlcnRpY2VzKTsKICAgICAgbGV0IGksIGo7CiAgICAgIGxldCBrID0gb3V0cHV0U2l6ZSwKICAgICAgICBwb3MgPSAxOwogICAgICBmb3IgKGkgPSAwOyBpIDwgaW5wdXRTaXplOyArK2kpIHsKICAgICAgICBjb25zdCBkb21haW5fMmkgPSBkb21haW5baV1bMF07CiAgICAgICAgY29uc3QgZG9tYWluXzJpXzEgPSBkb21haW5baV1bMV07CiAgICAgICAgY29uc3QgeGkgPSBNYXRoQ2xhbXAoc3JjW3NyY09mZnNldCArIGldLCBkb21haW5fMmksIGRvbWFpbl8yaV8xKTsKICAgICAgICBsZXQgZSA9IGludGVycG9sYXRlKHhpLCBkb21haW5fMmksIGRvbWFpbl8yaV8xLCBlbmNvZGVbaV1bMF0sIGVuY29kZVtpXVsxXSk7CiAgICAgICAgY29uc3Qgc2l6ZV9pID0gc2l6ZVtpXTsKICAgICAgICBlID0gTWF0aENsYW1wKGUsIDAsIHNpemVfaSAtIDEpOwogICAgICAgIGNvbnN0IGUwID0gZSA8IHNpemVfaSAtIDEgPyBNYXRoLmZsb29yKGUpIDogZSAtIDE7CiAgICAgICAgY29uc3QgbjAgPSBlMCArIDEgLSBlOwogICAgICAgIGNvbnN0IG4xID0gZSAtIGUwOwogICAgICAgIGNvbnN0IG9mZnNldDAgPSBlMCAqIGs7CiAgICAgICAgY29uc3Qgb2Zmc2V0MSA9IG9mZnNldDAgKyBrOwogICAgICAgIGZvciAoaiA9IDA7IGogPCBjdWJlVmVydGljZXM7IGorKykgewogICAgICAgICAgaWYgKGogJiBwb3MpIHsKICAgICAgICAgICAgY3ViZU5bal0gKj0gbjE7CiAgICAgICAgICAgIGN1YmVWZXJ0ZXhbal0gKz0gb2Zmc2V0MTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1YmVOW2pdICo9IG4wOwogICAgICAgICAgICBjdWJlVmVydGV4W2pdICs9IG9mZnNldDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGsgKj0gc2l6ZV9pOwogICAgICAgIHBvcyA8PD0gMTsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgb3V0cHV0U2l6ZTsgKytqKSB7CiAgICAgICAgbGV0IHJqID0gMDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY3ViZVZlcnRpY2VzOyBpKyspIHsKICAgICAgICAgIHJqICs9IHNhbXBsZXNbY3ViZVZlcnRleFtpXSArIGpdICogY3ViZU5baV07CiAgICAgICAgfQogICAgICAgIHJqID0gaW50ZXJwb2xhdGUocmosIDAsIDEsIGRlY29kZVtqXVswXSwgZGVjb2RlW2pdWzFdKTsKICAgICAgICBkZXN0W2Rlc3RPZmZzZXQgKyBqXSA9IE1hdGhDbGFtcChyaiwgcmFuZ2Vbal1bMF0sIHJhbmdlW2pdWzFdKTsKICAgICAgfQogICAgfTsKICB9CiAgc3RhdGljIGNvbnN0cnVjdEludGVycG9sYXRlZChmYWN0b3J5LCBkaWN0KSB7CiAgICBjb25zdCBjMCA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiQzAiKSkgfHwgWzBdOwogICAgY29uc3QgYzEgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkMxIikpIHx8IFsxXTsKICAgIGNvbnN0IG4gPSBkaWN0LmdldCgiTiIpOwogICAgY29uc3QgZGlmZiA9IFtdOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYzAubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBkaWZmLnB1c2goYzFbaV0gLSBjMFtpXSk7CiAgICB9CiAgICBjb25zdCBsZW5ndGggPSBkaWZmLmxlbmd0aDsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RJbnRlcnBvbGF0ZWRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBjb25zdCB4ID0gbiA9PT0gMSA/IHNyY1tzcmNPZmZzZXRdIDogc3JjW3NyY09mZnNldF0gKiogbjsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7ICsraikgewogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIGpdID0gYzBbal0gKyB4ICogZGlmZltqXTsKICAgICAgfQogICAgfTsKICB9CiAgc3RhdGljIGNvbnN0cnVjdFN0aWNoZWQoZmFjdG9yeSwgZGljdCkgewogICAgY29uc3QgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CiAgICBpZiAoIWRvbWFpbikgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk5vIGRvbWFpbiIpOwogICAgfQogICAgY29uc3QgaW5wdXRTaXplID0gZG9tYWluLmxlbmd0aCAvIDI7CiAgICBpZiAoaW5wdXRTaXplICE9PSAxKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQmFkIGRvbWFpbiBmb3Igc3RpY2hlZCBmdW5jdGlvbiIpOwogICAgfQogICAgY29uc3QgewogICAgICB4cmVmCiAgICB9ID0gZmFjdG9yeTsKICAgIGNvbnN0IGZucyA9IFtdOwogICAgZm9yIChjb25zdCBmbiBvZiBkaWN0LmdldCgiRnVuY3Rpb25zIikpIHsKICAgICAgZm5zLnB1c2godGhpcy5wYXJzZShmYWN0b3J5LCB4cmVmLmZldGNoSWZSZWYoZm4pKSk7CiAgICB9CiAgICBjb25zdCBib3VuZHMgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkJvdW5kcyIpKTsKICAgIGNvbnN0IGVuY29kZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRW5jb2RlIikpOwogICAgY29uc3QgdG1wQnVmID0gbmV3IEZsb2F0MzJBcnJheSgxKTsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RTdGljaGVkRm4oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgY29uc3QgdiA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0XSwgZG9tYWluWzBdLCBkb21haW5bMV0pOwogICAgICBjb25zdCBsZW5ndGggPSBib3VuZHMubGVuZ3RoOwogICAgICBsZXQgaTsKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKHYgPCBib3VuZHNbaV0pIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQgZG1pbiA9IGRvbWFpblswXTsKICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgZG1pbiA9IGJvdW5kc1tpIC0gMV07CiAgICAgIH0KICAgICAgbGV0IGRtYXggPSBkb21haW5bMV07CiAgICAgIGlmIChpIDwgYm91bmRzLmxlbmd0aCkgewogICAgICAgIGRtYXggPSBib3VuZHNbaV07CiAgICAgIH0KICAgICAgY29uc3Qgcm1pbiA9IGVuY29kZVsyICogaV07CiAgICAgIGNvbnN0IHJtYXggPSBlbmNvZGVbMiAqIGkgKyAxXTsKICAgICAgdG1wQnVmWzBdID0gZG1pbiA9PT0gZG1heCA/IHJtaW4gOiBybWluICsgKHYgLSBkbWluKSAqIChybWF4IC0gcm1pbikgLyAoZG1heCAtIGRtaW4pOwogICAgICBmbnNbaV0odG1wQnVmLCAwLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgIH07CiAgfQogIHN0YXRpYyBjb25zdHJ1Y3RQb3N0U2NyaXB0KGZhY3RvcnksIGZuLCBkaWN0KSB7CiAgICBjb25zdCBkb21haW4gPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkRvbWFpbiIpKTsKICAgIGNvbnN0IHJhbmdlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJSYW5nZSIpKTsKICAgIGlmICghZG9tYWluKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gZG9tYWluLiIpOwogICAgfQogICAgaWYgKCFyYW5nZSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk5vIHJhbmdlLiIpOwogICAgfQogICAgY29uc3QgbGV4ZXIgPSBuZXcgUG9zdFNjcmlwdExleGVyKGZuKTsKICAgIGNvbnN0IHBhcnNlciA9IG5ldyBQb3N0U2NyaXB0UGFyc2VyKGxleGVyKTsKICAgIGNvbnN0IGNvZGUgPSBwYXJzZXIucGFyc2UoKTsKICAgIGlmIChmYWN0b3J5LmlzRXZhbFN1cHBvcnRlZCAmJiBGZWF0dXJlVGVzdC5pc0V2YWxTdXBwb3J0ZWQpIHsKICAgICAgY29uc3QgY29tcGlsZWQgPSBuZXcgUG9zdFNjcmlwdENvbXBpbGVyKCkuY29tcGlsZShjb2RlLCBkb21haW4sIHJhbmdlKTsKICAgICAgaWYgKGNvbXBpbGVkKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbigic3JjIiwgInNyY09mZnNldCIsICJkZXN0IiwgImRlc3RPZmZzZXQiLCBjb21waWxlZCk7CiAgICAgIH0KICAgIH0KICAgIGluZm8oIlVuYWJsZSB0byBjb21waWxlIFBTIGZ1bmN0aW9uIik7CiAgICBjb25zdCBudW1PdXRwdXRzID0gcmFuZ2UubGVuZ3RoID4+IDE7CiAgICBjb25zdCBudW1JbnB1dHMgPSBkb21haW4ubGVuZ3RoID4+IDE7CiAgICBjb25zdCBldmFsdWF0b3IgPSBuZXcgUG9zdFNjcmlwdEV2YWx1YXRvcihjb2RlKTsKICAgIGNvbnN0IGNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbnN0IE1BWF9DQUNIRV9TSVpFID0gMjA0OCAqIDQ7CiAgICBsZXQgY2FjaGVfYXZhaWxhYmxlID0gTUFYX0NBQ0hFX1NJWkU7CiAgICBjb25zdCB0bXBCdWYgPSBuZXcgRmxvYXQzMkFycmF5KG51bUlucHV0cyk7CiAgICByZXR1cm4gZnVuY3Rpb24gY29uc3RydWN0UG9zdFNjcmlwdEZuKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgIGxldCBpLCB2YWx1ZTsKICAgICAgbGV0IGtleSA9ICIiOwogICAgICBjb25zdCBpbnB1dCA9IHRtcEJ1ZjsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUlucHV0czsgaSsrKSB7CiAgICAgICAgdmFsdWUgPSBzcmNbc3JjT2Zmc2V0ICsgaV07CiAgICAgICAgaW5wdXRbaV0gPSB2YWx1ZTsKICAgICAgICBrZXkgKz0gdmFsdWUgKyAiXyI7CiAgICAgIH0KICAgICAgY29uc3QgY2FjaGVkVmFsdWUgPSBjYWNoZVtrZXldOwogICAgICBpZiAoY2FjaGVkVmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGRlc3Quc2V0KGNhY2hlZFZhbHVlLCBkZXN0T2Zmc2V0KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgb3V0cHV0ID0gbmV3IEZsb2F0MzJBcnJheShudW1PdXRwdXRzKTsKICAgICAgY29uc3Qgc3RhY2sgPSBldmFsdWF0b3IuZXhlY3V0ZShpbnB1dCk7CiAgICAgIGNvbnN0IHN0YWNrSW5kZXggPSBzdGFjay5sZW5ndGggLSBudW1PdXRwdXRzOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtT3V0cHV0czsgaSsrKSB7CiAgICAgICAgdmFsdWUgPSBzdGFja1tzdGFja0luZGV4ICsgaV07CiAgICAgICAgbGV0IGJvdW5kID0gcmFuZ2VbaSAqIDJdOwogICAgICAgIGlmICh2YWx1ZSA8IGJvdW5kKSB7CiAgICAgICAgICB2YWx1ZSA9IGJvdW5kOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBib3VuZCA9IHJhbmdlW2kgKiAyICsgMV07CiAgICAgICAgICBpZiAodmFsdWUgPiBib3VuZCkgewogICAgICAgICAgICB2YWx1ZSA9IGJvdW5kOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvdXRwdXRbaV0gPSB2YWx1ZTsKICAgICAgfQogICAgICBpZiAoY2FjaGVfYXZhaWxhYmxlID4gMCkgewogICAgICAgIGNhY2hlX2F2YWlsYWJsZS0tOwogICAgICAgIGNhY2hlW2tleV0gPSBvdXRwdXQ7CiAgICAgIH0KICAgICAgZGVzdC5zZXQob3V0cHV0LCBkZXN0T2Zmc2V0KTsKICAgIH07CiAgfQp9CmZ1bmN0aW9uIGlzUERGRnVuY3Rpb24odikgewogIGxldCBmbkRpY3Q7CiAgaWYgKHYgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICBmbkRpY3QgPSB2OwogIH0gZWxzZSBpZiAodiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgIGZuRGljdCA9IHYuZGljdDsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICByZXR1cm4gZm5EaWN0LmhhcygiRnVuY3Rpb25UeXBlIik7Cn0KY2xhc3MgUG9zdFNjcmlwdFN0YWNrIHsKICBzdGF0aWMgTUFYX1NUQUNLX1NJWkUgPSAxMDA7CiAgY29uc3RydWN0b3IoaW5pdGlhbFN0YWNrKSB7CiAgICB0aGlzLnN0YWNrID0gaW5pdGlhbFN0YWNrID8gQXJyYXkuZnJvbShpbml0aWFsU3RhY2spIDogW107CiAgfQogIHB1c2godmFsdWUpIHsKICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA+PSBQb3N0U2NyaXB0U3RhY2suTUFYX1NUQUNLX1NJWkUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQb3N0U2NyaXB0IGZ1bmN0aW9uIHN0YWNrIG92ZXJmbG93LiIpOwogICAgfQogICAgdGhpcy5zdGFjay5wdXNoKHZhbHVlKTsKICB9CiAgcG9wKCkgewogICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDw9IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQb3N0U2NyaXB0IGZ1bmN0aW9uIHN0YWNrIHVuZGVyZmxvdy4iKTsKICAgIH0KICAgIHJldHVybiB0aGlzLnN0YWNrLnBvcCgpOwogIH0KICBjb3B5KG4pIHsKICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCArIG4gPj0gUG9zdFNjcmlwdFN0YWNrLk1BWF9TVEFDS19TSVpFKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiUG9zdFNjcmlwdCBmdW5jdGlvbiBzdGFjayBvdmVyZmxvdy4iKTsKICAgIH0KICAgIGNvbnN0IHN0YWNrID0gdGhpcy5zdGFjazsKICAgIGZvciAobGV0IGkgPSBzdGFjay5sZW5ndGggLSBuLCBqID0gbiAtIDE7IGogPj0gMDsgai0tLCBpKyspIHsKICAgICAgc3RhY2sucHVzaChzdGFja1tpXSk7CiAgICB9CiAgfQogIGluZGV4KG4pIHsKICAgIHRoaXMucHVzaCh0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gbiAtIDFdKTsKICB9CiAgcm9sbChuLCBwKSB7CiAgICBjb25zdCBzdGFjayA9IHRoaXMuc3RhY2s7CiAgICBjb25zdCBsID0gc3RhY2subGVuZ3RoIC0gbjsKICAgIGNvbnN0IHIgPSBzdGFjay5sZW5ndGggLSAxOwogICAgY29uc3QgYyA9IGwgKyAocCAtIE1hdGguZmxvb3IocCAvIG4pICogbik7CiAgICBmb3IgKGxldCBpID0gbCwgaiA9IHI7IGkgPCBqOyBpKyssIGotLSkgewogICAgICBjb25zdCB0ID0gc3RhY2tbaV07CiAgICAgIHN0YWNrW2ldID0gc3RhY2tbal07CiAgICAgIHN0YWNrW2pdID0gdDsKICAgIH0KICAgIGZvciAobGV0IGkgPSBsLCBqID0gYyAtIDE7IGkgPCBqOyBpKyssIGotLSkgewogICAgICBjb25zdCB0ID0gc3RhY2tbaV07CiAgICAgIHN0YWNrW2ldID0gc3RhY2tbal07CiAgICAgIHN0YWNrW2pdID0gdDsKICAgIH0KICAgIGZvciAobGV0IGkgPSBjLCBqID0gcjsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgIGNvbnN0IHQgPSBzdGFja1tpXTsKICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgc3RhY2tbal0gPSB0OwogICAgfQogIH0KfQpjbGFzcyBQb3N0U2NyaXB0RXZhbHVhdG9yIHsKICBjb25zdHJ1Y3RvcihvcGVyYXRvcnMpIHsKICAgIHRoaXMub3BlcmF0b3JzID0gb3BlcmF0b3JzOwogIH0KICBleGVjdXRlKGluaXRpYWxTdGFjaykgewogICAgY29uc3Qgc3RhY2sgPSBuZXcgUG9zdFNjcmlwdFN0YWNrKGluaXRpYWxTdGFjayk7CiAgICBsZXQgY291bnRlciA9IDA7CiAgICBjb25zdCBvcGVyYXRvcnMgPSB0aGlzLm9wZXJhdG9yczsKICAgIGNvbnN0IGxlbmd0aCA9IG9wZXJhdG9ycy5sZW5ndGg7CiAgICBsZXQgb3BlcmF0b3IsIGEsIGI7CiAgICB3aGlsZSAoY291bnRlciA8IGxlbmd0aCkgewogICAgICBvcGVyYXRvciA9IG9wZXJhdG9yc1tjb3VudGVyKytdOwogICAgICBpZiAodHlwZW9mIG9wZXJhdG9yID09PSAibnVtYmVyIikgewogICAgICAgIHN0YWNrLnB1c2gob3BlcmF0b3IpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHsKICAgICAgICBjYXNlICJqeiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAoIWEpIHsKICAgICAgICAgICAgY291bnRlciA9IGI7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJqIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGNvdW50ZXIgPSBhOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiYWJzIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5hYnMoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiYWRkIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSArIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiYW5kIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iICYmIHR5cGVvZiBiID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhICYmIGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhICYgYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhdGFuIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBNYXRoLmF0YW4yKGEsIGIpIC8gTWF0aC5QSSAqIDE4MDsKICAgICAgICAgIGlmIChhIDwgMCkgewogICAgICAgICAgICBhICs9IDM2MDsKICAgICAgICAgIH0KICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJiaXRzaGlmdCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAoYSA+IDApIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIDw8IGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhID4+IGIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY2VpbGluZyI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGguY2VpbChhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjb3B5IjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLmNvcHkoYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjb3MiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLmNvcyhhICUgMzYwIC8gMTgwICogTWF0aC5QSSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY3ZpIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKSB8IDA7CiAgICAgICAgICBzdGFjay5wdXNoKGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY3ZyIjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRpdiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgLyBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImR1cCI6CiAgICAgICAgICBzdGFjay5jb3B5KDEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXEiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhID09PSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImV4Y2giOgogICAgICAgICAgc3RhY2sucm9sbCgyLCAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImV4cCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgKiogYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJmYWxzZSI6CiAgICAgICAgICBzdGFjay5wdXNoKGZhbHNlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZsb29yIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5mbG9vcihhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJnZSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPj0gYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJndCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPiBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImlkaXYiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhIC8gYiB8IDApOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaW5kZXgiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2suaW5kZXgoYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsZSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPD0gYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsbiI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGgubG9nKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxvZyI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGgubG9nMTAoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibHQiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhIDwgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtb2QiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhICUgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtdWwiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhICogYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJuZSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgIT09IGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibmVnIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goLWEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibm90IjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goIWEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaCh+YSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJvciI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAodHlwZW9mIGEgPT09ICJib29sZWFuIiAmJiB0eXBlb2YgYiA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYSB8fCBiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYSB8IGIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicG9wIjoKICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicm9sbCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5yb2xsKGEsIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicm91bmQiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLnJvdW5kKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNpbiI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGguc2luKGEgJSAzNjAgLyAxODAgKiBNYXRoLlBJKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzcXJ0IjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5zcXJ0KGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN1YiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgLSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInRydWUiOgogICAgICAgICAgc3RhY2sucHVzaCh0cnVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInRydW5jYXRlIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBhIDwgMCA/IE1hdGguY2VpbChhKSA6IE1hdGguZmxvb3IoYSk7CiAgICAgICAgICBzdGFjay5wdXNoKGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAieG9yIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iICYmIHR5cGVvZiBiID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhICE9PSBiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYSBeIGIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5rbm93biBvcGVyYXRvciAke29wZXJhdG9yfWApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RhY2suc3RhY2s7CiAgfQp9CmNsYXNzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKHR5cGUpIHsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHVucmVhY2hhYmxlKCJhYnN0cmFjdCBtZXRob2QiKTsKICB9Cn0KY2xhc3MgQXN0QXJndW1lbnQgZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihpbmRleCwgbWluLCBtYXgpIHsKICAgIHN1cGVyKCJhcmdzIik7CiAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICB0aGlzLm1pbiA9IG1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0QXJndW1lbnQodGhpcyk7CiAgfQp9CmNsYXNzIEFzdExpdGVyYWwgZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihudW1iZXIpIHsKICAgIHN1cGVyKCJsaXRlcmFsIik7CiAgICB0aGlzLm51bWJlciA9IG51bWJlcjsKICAgIHRoaXMubWluID0gbnVtYmVyOwogICAgdGhpcy5tYXggPSBudW1iZXI7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRMaXRlcmFsKHRoaXMpOwogIH0KfQpjbGFzcyBBc3RCaW5hcnlPcGVyYXRpb24gZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihvcCwgYXJnMSwgYXJnMiwgbWluLCBtYXgpIHsKICAgIHN1cGVyKCJiaW5hcnkiKTsKICAgIHRoaXMub3AgPSBvcDsKICAgIHRoaXMuYXJnMSA9IGFyZzE7CiAgICB0aGlzLmFyZzIgPSBhcmcyOwogICAgdGhpcy5taW4gPSBtaW47CiAgICB0aGlzLm1heCA9IG1heDsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdEJpbmFyeU9wZXJhdGlvbih0aGlzKTsKICB9Cn0KY2xhc3MgQXN0TWluIGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IoYXJnLCBtYXgpIHsKICAgIHN1cGVyKCJtYXgiKTsKICAgIHRoaXMuYXJnID0gYXJnOwogICAgdGhpcy5taW4gPSBhcmcubWluOwogICAgdGhpcy5tYXggPSBtYXg7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRNaW4odGhpcyk7CiAgfQp9CmNsYXNzIEFzdFZhcmlhYmxlIGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IoaW5kZXgsIG1pbiwgbWF4KSB7CiAgICBzdXBlcigidmFyIik7CiAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICB0aGlzLm1pbiA9IG1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0VmFyaWFibGUodGhpcyk7CiAgfQp9CmNsYXNzIEFzdFZhcmlhYmxlRGVmaW5pdGlvbiBleHRlbmRzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKHZhcmlhYmxlLCBhcmcpIHsKICAgIHN1cGVyKCJkZWZpbml0aW9uIik7CiAgICB0aGlzLnZhcmlhYmxlID0gdmFyaWFibGU7CiAgICB0aGlzLmFyZyA9IGFyZzsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdFZhcmlhYmxlRGVmaW5pdGlvbih0aGlzKTsKICB9Cn0KY2xhc3MgRXhwcmVzc2lvbkJ1aWxkZXJWaXNpdG9yIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMucGFydHMgPSBbXTsKICB9CiAgdmlzaXRBcmd1bWVudChhcmcpIHsKICAgIHRoaXMucGFydHMucHVzaCgiTWF0aC5tYXgoIiwgYXJnLm1pbiwgIiwgTWF0aC5taW4oIiwgYXJnLm1heCwgIiwgc3JjW3NyY09mZnNldCArICIsIGFyZy5pbmRleCwgIl0pKSIpOwogIH0KICB2aXNpdFZhcmlhYmxlKHZhcmlhYmxlKSB7CiAgICB0aGlzLnBhcnRzLnB1c2goInYiLCB2YXJpYWJsZS5pbmRleCk7CiAgfQogIHZpc2l0TGl0ZXJhbChsaXRlcmFsKSB7CiAgICB0aGlzLnBhcnRzLnB1c2gobGl0ZXJhbC5udW1iZXIpOwogIH0KICB2aXNpdEJpbmFyeU9wZXJhdGlvbihvcGVyYXRpb24pIHsKICAgIHRoaXMucGFydHMucHVzaCgiKCIpOwogICAgb3BlcmF0aW9uLmFyZzEudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIiAiLCBvcGVyYXRpb24ub3AsICIgIik7CiAgICBvcGVyYXRpb24uYXJnMi52aXNpdCh0aGlzKTsKICAgIHRoaXMucGFydHMucHVzaCgiKSIpOwogIH0KICB2aXNpdFZhcmlhYmxlRGVmaW5pdGlvbihkZWZpbml0aW9uKSB7CiAgICB0aGlzLnBhcnRzLnB1c2goInZhciAiKTsKICAgIGRlZmluaXRpb24udmFyaWFibGUudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIiA9ICIpOwogICAgZGVmaW5pdGlvbi5hcmcudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIjsiKTsKICB9CiAgdmlzaXRNaW4obWF4KSB7CiAgICB0aGlzLnBhcnRzLnB1c2goIk1hdGgubWluKCIpOwogICAgbWF4LmFyZy52aXNpdCh0aGlzKTsKICAgIHRoaXMucGFydHMucHVzaCgiLCAiLCBtYXgubWF4LCAiKSIpOwogIH0KICB0b1N0cmluZygpIHsKICAgIHJldHVybiB0aGlzLnBhcnRzLmpvaW4oIiIpOwogIH0KfQpmdW5jdGlvbiBidWlsZEFkZE9wZXJhdGlvbihudW0xLCBudW0yKSB7CiAgaWYgKG51bTIudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTIubnVtYmVyID09PSAwKSB7CiAgICByZXR1cm4gbnVtMTsKICB9CiAgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTEubnVtYmVyID09PSAwKSB7CiAgICByZXR1cm4gbnVtMjsKICB9CiAgaWYgKG51bTIudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwobnVtMS5udW1iZXIgKyBudW0yLm51bWJlcik7CiAgfQogIHJldHVybiBuZXcgQXN0QmluYXJ5T3BlcmF0aW9uKCIrIiwgbnVtMSwgbnVtMiwgbnVtMS5taW4gKyBudW0yLm1pbiwgbnVtMS5tYXggKyBudW0yLm1heCk7Cn0KZnVuY3Rpb24gYnVpbGRNdWxPcGVyYXRpb24obnVtMSwgbnVtMikgewogIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgaWYgKG51bTIubnVtYmVyID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbCgwKTsKICAgIH0gZWxzZSBpZiAobnVtMi5udW1iZXIgPT09IDEpIHsKICAgICAgcmV0dXJuIG51bTE7CiAgICB9IGVsc2UgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbChudW0xLm51bWJlciAqIG51bTIubnVtYmVyKTsKICAgIH0KICB9CiAgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICBpZiAobnVtMS5udW1iZXIgPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKDApOwogICAgfSBlbHNlIGlmIChudW0xLm51bWJlciA9PT0gMSkgewogICAgICByZXR1cm4gbnVtMjsKICAgIH0KICB9CiAgY29uc3QgbWluID0gTWF0aC5taW4obnVtMS5taW4gKiBudW0yLm1pbiwgbnVtMS5taW4gKiBudW0yLm1heCwgbnVtMS5tYXggKiBudW0yLm1pbiwgbnVtMS5tYXggKiBudW0yLm1heCk7CiAgY29uc3QgbWF4ID0gTWF0aC5tYXgobnVtMS5taW4gKiBudW0yLm1pbiwgbnVtMS5taW4gKiBudW0yLm1heCwgbnVtMS5tYXggKiBudW0yLm1pbiwgbnVtMS5tYXggKiBudW0yLm1heCk7CiAgcmV0dXJuIG5ldyBBc3RCaW5hcnlPcGVyYXRpb24oIioiLCBudW0xLCBudW0yLCBtaW4sIG1heCk7Cn0KZnVuY3Rpb24gYnVpbGRTdWJPcGVyYXRpb24obnVtMSwgbnVtMikgewogIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgaWYgKG51bTIubnVtYmVyID09PSAwKSB7CiAgICAgIHJldHVybiBudW0xOwogICAgfSBlbHNlIGlmIChudW0xLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwobnVtMS5udW1iZXIgLSBudW0yLm51bWJlcik7CiAgICB9CiAgfQogIGlmIChudW0yLnR5cGUgPT09ICJiaW5hcnkiICYmIG51bTIub3AgPT09ICItIiAmJiBudW0xLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0xLm51bWJlciA9PT0gMSAmJiBudW0yLmFyZzEudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTIuYXJnMS5udW1iZXIgPT09IDEpIHsKICAgIHJldHVybiBudW0yLmFyZzI7CiAgfQogIHJldHVybiBuZXcgQXN0QmluYXJ5T3BlcmF0aW9uKCItIiwgbnVtMSwgbnVtMiwgbnVtMS5taW4gLSBudW0yLm1heCwgbnVtMS5tYXggLSBudW0yLm1pbik7Cn0KZnVuY3Rpb24gYnVpbGRNaW5PcGVyYXRpb24obnVtMSwgbWF4KSB7CiAgaWYgKG51bTEubWluID49IG1heCkgewogICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKG1heCk7CiAgfSBlbHNlIGlmIChudW0xLm1heCA8PSBtYXgpIHsKICAgIHJldHVybiBudW0xOwogIH0KICByZXR1cm4gbmV3IEFzdE1pbihudW0xLCBtYXgpOwp9CmNsYXNzIFBvc3RTY3JpcHRDb21waWxlciB7CiAgY29tcGlsZShjb2RlLCBkb21haW4sIHJhbmdlKSB7CiAgICBjb25zdCBzdGFjayA9IFtdOwogICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gW107CiAgICBjb25zdCBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoID4+IDEsCiAgICAgIG91dHB1dFNpemUgPSByYW5nZS5sZW5ndGggPj4gMTsKICAgIGxldCBsYXN0UmVnaXN0ZXIgPSAwOwogICAgbGV0IG4sIGo7CiAgICBsZXQgbnVtMSwgbnVtMiwgYXN0MSwgYXN0MiwgdG1wVmFyLCBpdGVtOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dFNpemU7IGkrKykgewogICAgICBzdGFjay5wdXNoKG5ldyBBc3RBcmd1bWVudChpLCBkb21haW5baSAqIDJdLCBkb21haW5baSAqIDIgKyAxXSkpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29kZS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGl0ZW0gPSBjb2RlW2ldOwogICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICJudW1iZXIiKSB7CiAgICAgICAgc3RhY2sucHVzaChuZXcgQXN0TGl0ZXJhbChpdGVtKSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChpdGVtKSB7CiAgICAgICAgY2FzZSAiYWRkIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChidWlsZEFkZE9wZXJhdGlvbihudW0xLCBudW0yKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjdnIiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtdWwiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBudW0yID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGJ1aWxkTXVsT3BlcmF0aW9uKG51bTEsIG51bTIpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN1YiI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG51bTIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYnVpbGRTdWJPcGVyYXRpb24obnVtMSwgbnVtMikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXhjaCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGFzdDEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGFzdDIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYXN0MSwgYXN0Mik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJwb3AiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImluZGV4IjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKG51bTEudHlwZSAhPT0gImxpdGVyYWwiKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbiA9IG51bTEubnVtYmVyOwogICAgICAgICAgaWYgKG4gPCAwIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pIHx8IHN0YWNrLmxlbmd0aCA8IG4pIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBhc3QxID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gbiAtIDFdOwogICAgICAgICAgaWYgKGFzdDEudHlwZSA9PT0gImxpdGVyYWwiIHx8IGFzdDEudHlwZSA9PT0gInZhciIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhc3QxKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB0bXBWYXIgPSBuZXcgQXN0VmFyaWFibGUobGFzdFJlZ2lzdGVyKyssIGFzdDEubWluLCBhc3QxLm1heCk7CiAgICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSBuIC0gMV0gPSB0bXBWYXI7CiAgICAgICAgICBzdGFjay5wdXNoKHRtcFZhcik7CiAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaChuZXcgQXN0VmFyaWFibGVEZWZpbml0aW9uKHRtcFZhciwgYXN0MSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZHVwIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBjb2RlW2kgKyAxXSA9PT0gIm51bWJlciIgJiYgY29kZVtpICsgMl0gPT09ICJndCIgJiYgY29kZVtpICsgM10gPT09IGkgKyA3ICYmIGNvZGVbaSArIDRdID09PSAianoiICYmIGNvZGVbaSArIDVdID09PSAicG9wIiAmJiBjb2RlW2kgKyA2XSA9PT0gY29kZVtpICsgMV0pIHsKICAgICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICBzdGFjay5wdXNoKGJ1aWxkTWluT3BlcmF0aW9uKG51bTEsIGNvZGVbaSArIDFdKSk7CiAgICAgICAgICAgIGkgKz0gNjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBhc3QxID0gc3RhY2suYXQoLTEpOwogICAgICAgICAgaWYgKGFzdDEudHlwZSA9PT0gImxpdGVyYWwiIHx8IGFzdDEudHlwZSA9PT0gInZhciIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhc3QxKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB0bXBWYXIgPSBuZXcgQXN0VmFyaWFibGUobGFzdFJlZ2lzdGVyKyssIGFzdDEubWluLCBhc3QxLm1heCk7CiAgICAgICAgICBzdGFja1tzdGFjay5sZW5ndGggLSAxXSA9IHRtcFZhcjsKICAgICAgICAgIHN0YWNrLnB1c2godG1wVmFyKTsKICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKG5ldyBBc3RWYXJpYWJsZURlZmluaXRpb24odG1wVmFyLCBhc3QxKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyb2xsIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKG51bTIudHlwZSAhPT0gImxpdGVyYWwiIHx8IG51bTEudHlwZSAhPT0gImxpdGVyYWwiKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaiA9IG51bTIubnVtYmVyOwogICAgICAgICAgbiA9IG51bTEubnVtYmVyOwogICAgICAgICAgaWYgKG4gPD0gMCB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSB8fCAhTnVtYmVyLmlzSW50ZWdlcihqKSB8fCBzdGFjay5sZW5ndGggPCBuKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaiA9IChqICUgbiArIG4pICUgbjsKICAgICAgICAgIGlmIChqID09PSAwKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgc3RhY2sucHVzaCguLi5zdGFjay5zcGxpY2Uoc3RhY2subGVuZ3RoIC0gbiwgbiAtIGopKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgaWYgKHN0YWNrLmxlbmd0aCAhPT0gb3V0cHV0U2l6ZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgZm9yIChjb25zdCBpbnN0cnVjdGlvbiBvZiBpbnN0cnVjdGlvbnMpIHsKICAgICAgY29uc3Qgc3RhdGVtZW50QnVpbGRlciA9IG5ldyBFeHByZXNzaW9uQnVpbGRlclZpc2l0b3IoKTsKICAgICAgaW5zdHJ1Y3Rpb24udmlzaXQoc3RhdGVtZW50QnVpbGRlcik7CiAgICAgIHJlc3VsdC5wdXNoKHN0YXRlbWVudEJ1aWxkZXIudG9TdHJpbmcoKSk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdGFjay5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGV4cHIgPSBzdGFja1tpXSwKICAgICAgICBzdGF0ZW1lbnRCdWlsZGVyID0gbmV3IEV4cHJlc3Npb25CdWlsZGVyVmlzaXRvcigpOwogICAgICBleHByLnZpc2l0KHN0YXRlbWVudEJ1aWxkZXIpOwogICAgICBjb25zdCBtaW4gPSByYW5nZVtpICogMl0sCiAgICAgICAgbWF4ID0gcmFuZ2VbaSAqIDIgKyAxXTsKICAgICAgY29uc3Qgb3V0ID0gW3N0YXRlbWVudEJ1aWxkZXIudG9TdHJpbmcoKV07CiAgICAgIGlmIChtaW4gPiBleHByLm1pbikgewogICAgICAgIG91dC51bnNoaWZ0KCJNYXRoLm1heCgiLCBtaW4sICIsICIpOwogICAgICAgIG91dC5wdXNoKCIpIik7CiAgICAgIH0KICAgICAgaWYgKG1heCA8IGV4cHIubWF4KSB7CiAgICAgICAgb3V0LnVuc2hpZnQoIk1hdGgubWluKCIsIG1heCwgIiwgIik7CiAgICAgICAgb3V0LnB1c2goIikiKTsKICAgICAgfQogICAgICBvdXQudW5zaGlmdCgiZGVzdFtkZXN0T2Zmc2V0ICsgIiwgaSwgIl0gPSAiKTsKICAgICAgb3V0LnB1c2goIjsiKTsKICAgICAgcmVzdWx0LnB1c2gob3V0LmpvaW4oIiIpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQuam9pbigiXG4iKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2JpZGkuanMKCmNvbnN0IGJhc2VUeXBlcyA9IFsiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiUyIsICJCIiwgIlMiLCAiV1MiLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCIiwgIkIiLCAiQiIsICJTIiwgIldTIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVUIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkVTIiwgIkNTIiwgIkVTIiwgIkNTIiwgIkNTIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkNTIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJDUyIsICJPTiIsICJFVCIsICJFVCIsICJFVCIsICJFVCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIk9OIiwgIk9OIiwgIkJOIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVOIiwgIkVOIiwgIk9OIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiRU4iLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiXTsKY29uc3QgYXJhYmljVHlwZXMgPSBbIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIk9OIiwgIk9OIiwgIkFMIiwgIkVUIiwgIkVUIiwgIkFMIiwgIkNTIiwgIkFMIiwgIk9OIiwgIk9OIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkVUIiwgIkFOIiwgIkFOIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQU4iLCAiT04iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiTlNNIiwgIk5TTSIsICJPTiIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiXTsKZnVuY3Rpb24gaXNPZGQoaSkgewogIHJldHVybiAoaSAmIDEpICE9PSAwOwp9CmZ1bmN0aW9uIGlzRXZlbihpKSB7CiAgcmV0dXJuIChpICYgMSkgPT09IDA7Cn0KZnVuY3Rpb24gZmluZFVuZXF1YWwoYXJyLCBzdGFydCwgdmFsdWUpIHsKICBsZXQgaiwgamo7CiAgZm9yIChqID0gc3RhcnQsIGpqID0gYXJyLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgIGlmIChhcnJbal0gIT09IHZhbHVlKSB7CiAgICAgIHJldHVybiBqOwogICAgfQogIH0KICByZXR1cm4gajsKfQpmdW5jdGlvbiByZXZlcnNlVmFsdWVzKGFyciwgc3RhcnQsIGVuZCkgewogIGZvciAobGV0IGkgPSBzdGFydCwgaiA9IGVuZCAtIDE7IGkgPCBqOyArK2ksIC0taikgewogICAgY29uc3QgdGVtcCA9IGFycltpXTsKICAgIGFycltpXSA9IGFycltqXTsKICAgIGFycltqXSA9IHRlbXA7CiAgfQp9CmZ1bmN0aW9uIGNyZWF0ZUJpZGlUZXh0KHN0ciwgaXNMVFIsIHZlcnRpY2FsID0gZmFsc2UpIHsKICBsZXQgZGlyID0gImx0ciI7CiAgaWYgKHZlcnRpY2FsKSB7CiAgICBkaXIgPSAidHRiIjsKICB9IGVsc2UgaWYgKCFpc0xUUikgewogICAgZGlyID0gInJ0bCI7CiAgfQogIHJldHVybiB7CiAgICBzdHIsCiAgICBkaXIKICB9Owp9CmNvbnN0IGNoYXJzID0gW107CmNvbnN0IHR5cGVzID0gW107CmZ1bmN0aW9uIGJpZGkoc3RyLCBzdGFydExldmVsID0gLTEsIHZlcnRpY2FsID0gZmFsc2UpIHsKICBsZXQgaXNMVFIgPSB0cnVlOwogIGNvbnN0IHN0ckxlbmd0aCA9IHN0ci5sZW5ndGg7CiAgaWYgKHN0ckxlbmd0aCA9PT0gMCB8fCB2ZXJ0aWNhbCkgewogICAgcmV0dXJuIGNyZWF0ZUJpZGlUZXh0KHN0ciwgaXNMVFIsIHZlcnRpY2FsKTsKICB9CiAgY2hhcnMubGVuZ3RoID0gc3RyTGVuZ3RoOwogIHR5cGVzLmxlbmd0aCA9IHN0ckxlbmd0aDsKICBsZXQgbnVtQmlkaSA9IDA7CiAgbGV0IGksIGlpOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgY2hhcnNbaV0gPSBzdHIuY2hhckF0KGkpOwogICAgY29uc3QgY2hhckNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgIGxldCBjaGFyVHlwZSA9ICJMIjsKICAgIGlmIChjaGFyQ29kZSA8PSAweDAwZmYpIHsKICAgICAgY2hhclR5cGUgPSBiYXNlVHlwZXNbY2hhckNvZGVdOwogICAgfSBlbHNlIGlmICgweDA1OTAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHgwNWY0KSB7CiAgICAgIGNoYXJUeXBlID0gIlIiOwogICAgfSBlbHNlIGlmICgweDA2MDAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHgwNmZmKSB7CiAgICAgIGNoYXJUeXBlID0gYXJhYmljVHlwZXNbY2hhckNvZGUgJiAweGZmXTsKICAgICAgaWYgKCFjaGFyVHlwZSkgewogICAgICAgIHdhcm4oIkJpZGk6IGludmFsaWQgVW5pY29kZSBjaGFyYWN0ZXIgIiArIGNoYXJDb2RlLnRvU3RyaW5nKDE2KSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoMHgwNzAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4MDhhYyB8fCAweGZiNTAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHhmZGZmIHx8IDB4ZmU3MCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweGZlZmYpIHsKICAgICAgY2hhclR5cGUgPSAiQUwiOwogICAgfQogICAgaWYgKGNoYXJUeXBlID09PSAiUiIgfHwgY2hhclR5cGUgPT09ICJBTCIgfHwgY2hhclR5cGUgPT09ICJBTiIpIHsKICAgICAgbnVtQmlkaSsrOwogICAgfQogICAgdHlwZXNbaV0gPSBjaGFyVHlwZTsKICB9CiAgaWYgKG51bUJpZGkgPT09IDApIHsKICAgIGlzTFRSID0gdHJ1ZTsKICAgIHJldHVybiBjcmVhdGVCaWRpVGV4dChzdHIsIGlzTFRSKTsKICB9CiAgaWYgKHN0YXJ0TGV2ZWwgPT09IC0xKSB7CiAgICBpZiAobnVtQmlkaSAvIHN0ckxlbmd0aCA8IDAuMyAmJiBzdHJMZW5ndGggPiA0KSB7CiAgICAgIGlzTFRSID0gdHJ1ZTsKICAgICAgc3RhcnRMZXZlbCA9IDA7CiAgICB9IGVsc2UgewogICAgICBpc0xUUiA9IGZhbHNlOwogICAgICBzdGFydExldmVsID0gMTsKICAgIH0KICB9CiAgY29uc3QgbGV2ZWxzID0gW107CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICBsZXZlbHNbaV0gPSBzdGFydExldmVsOwogIH0KICBjb25zdCBlID0gaXNPZGQoc3RhcnRMZXZlbCkgPyAiUiIgOiAiTCI7CiAgY29uc3Qgc29yID0gZTsKICBjb25zdCBlb3IgPSBzb3I7CiAgbGV0IGxhc3RUeXBlID0gc29yOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiTlNNIikgewogICAgICB0eXBlc1tpXSA9IGxhc3RUeXBlOwogICAgfSBlbHNlIHsKICAgICAgbGFzdFR5cGUgPSB0eXBlc1tpXTsKICAgIH0KICB9CiAgbGFzdFR5cGUgPSBzb3I7CiAgbGV0IHQ7CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIkVOIikgewogICAgICB0eXBlc1tpXSA9IGxhc3RUeXBlID09PSAiQUwiID8gIkFOIiA6ICJFTiI7CiAgICB9IGVsc2UgaWYgKHQgPT09ICJSIiB8fCB0ID09PSAiTCIgfHwgdCA9PT0gIkFMIikgewogICAgICBsYXN0VHlwZSA9IHQ7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKHQgPT09ICJBTCIpIHsKICAgICAgdHlwZXNbaV0gPSAiUiI7CiAgICB9CiAgfQogIGZvciAoaSA9IDE7IGkgPCBzdHJMZW5ndGggLSAxOyArK2kpIHsKICAgIGlmICh0eXBlc1tpXSA9PT0gIkVTIiAmJiB0eXBlc1tpIC0gMV0gPT09ICJFTiIgJiYgdHlwZXNbaSArIDFdID09PSAiRU4iKSB7CiAgICAgIHR5cGVzW2ldID0gIkVOIjsKICAgIH0KICAgIGlmICh0eXBlc1tpXSA9PT0gIkNTIiAmJiAodHlwZXNbaSAtIDFdID09PSAiRU4iIHx8IHR5cGVzW2kgLSAxXSA9PT0gIkFOIikgJiYgdHlwZXNbaSArIDFdID09PSB0eXBlc1tpIC0gMV0pIHsKICAgICAgdHlwZXNbaV0gPSB0eXBlc1tpIC0gMV07CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiRU4iKSB7CiAgICAgIGZvciAobGV0IGogPSBpIC0gMTsgaiA+PSAwOyAtLWopIHsKICAgICAgICBpZiAodHlwZXNbal0gIT09ICJFVCIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0eXBlc1tqXSA9ICJFTiI7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgc3RyTGVuZ3RoOyArK2opIHsKICAgICAgICBpZiAodHlwZXNbal0gIT09ICJFVCIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0eXBlc1tqXSA9ICJFTiI7CiAgICAgIH0KICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIldTIiB8fCB0ID09PSAiRVMiIHx8IHQgPT09ICJFVCIgfHwgdCA9PT0gIkNTIikgewogICAgICB0eXBlc1tpXSA9ICJPTiI7CiAgICB9CiAgfQogIGxhc3RUeXBlID0gc29yOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKHQgPT09ICJFTiIpIHsKICAgICAgdHlwZXNbaV0gPSBsYXN0VHlwZSA9PT0gIkwiID8gIkwiIDogIkVOIjsKICAgIH0gZWxzZSBpZiAodCA9PT0gIlIiIHx8IHQgPT09ICJMIikgewogICAgICBsYXN0VHlwZSA9IHQ7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiT04iKSB7CiAgICAgIGNvbnN0IGVuZCA9IGZpbmRVbmVxdWFsKHR5cGVzLCBpICsgMSwgIk9OIik7CiAgICAgIGxldCBiZWZvcmUgPSBzb3I7CiAgICAgIGlmIChpID4gMCkgewogICAgICAgIGJlZm9yZSA9IHR5cGVzW2kgLSAxXTsKICAgICAgfQogICAgICBsZXQgYWZ0ZXIgPSBlb3I7CiAgICAgIGlmIChlbmQgKyAxIDwgc3RyTGVuZ3RoKSB7CiAgICAgICAgYWZ0ZXIgPSB0eXBlc1tlbmQgKyAxXTsKICAgICAgfQogICAgICBpZiAoYmVmb3JlICE9PSAiTCIpIHsKICAgICAgICBiZWZvcmUgPSAiUiI7CiAgICAgIH0KICAgICAgaWYgKGFmdGVyICE9PSAiTCIpIHsKICAgICAgICBhZnRlciA9ICJSIjsKICAgICAgfQogICAgICBpZiAoYmVmb3JlID09PSBhZnRlcikgewogICAgICAgIHR5cGVzLmZpbGwoYmVmb3JlLCBpLCBlbmQpOwogICAgICB9CiAgICAgIGkgPSBlbmQgLSAxOwogICAgfQogIH0KICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgIGlmICh0eXBlc1tpXSA9PT0gIk9OIikgewogICAgICB0eXBlc1tpXSA9IGU7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKGlzRXZlbihsZXZlbHNbaV0pKSB7CiAgICAgIGlmICh0ID09PSAiUiIpIHsKICAgICAgICBsZXZlbHNbaV0gKz0gMTsKICAgICAgfSBlbHNlIGlmICh0ID09PSAiQU4iIHx8IHQgPT09ICJFTiIpIHsKICAgICAgICBsZXZlbHNbaV0gKz0gMjsKICAgICAgfQogICAgfSBlbHNlIGlmICh0ID09PSAiTCIgfHwgdCA9PT0gIkFOIiB8fCB0ID09PSAiRU4iKSB7CiAgICAgIGxldmVsc1tpXSArPSAxOwogICAgfQogIH0KICBsZXQgaGlnaGVzdExldmVsID0gLTE7CiAgbGV0IGxvd2VzdE9kZExldmVsID0gOTk7CiAgbGV0IGxldmVsOwogIGZvciAoaSA9IDAsIGlpID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgIGxldmVsID0gbGV2ZWxzW2ldOwogICAgaWYgKGhpZ2hlc3RMZXZlbCA8IGxldmVsKSB7CiAgICAgIGhpZ2hlc3RMZXZlbCA9IGxldmVsOwogICAgfQogICAgaWYgKGxvd2VzdE9kZExldmVsID4gbGV2ZWwgJiYgaXNPZGQobGV2ZWwpKSB7CiAgICAgIGxvd2VzdE9kZExldmVsID0gbGV2ZWw7CiAgICB9CiAgfQogIGZvciAobGV2ZWwgPSBoaWdoZXN0TGV2ZWw7IGxldmVsID49IGxvd2VzdE9kZExldmVsOyAtLWxldmVsKSB7CiAgICBsZXQgc3RhcnQgPSAtMTsKICAgIGZvciAoaSA9IDAsIGlpID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgaWYgKGxldmVsc1tpXSA8IGxldmVsKSB7CiAgICAgICAgaWYgKHN0YXJ0ID49IDApIHsKICAgICAgICAgIHJldmVyc2VWYWx1ZXMoY2hhcnMsIHN0YXJ0LCBpKTsKICAgICAgICAgIHN0YXJ0ID0gLTE7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHN0YXJ0IDwgMCkgewogICAgICAgIHN0YXJ0ID0gaTsKICAgICAgfQogICAgfQogICAgaWYgKHN0YXJ0ID49IDApIHsKICAgICAgcmV2ZXJzZVZhbHVlcyhjaGFycywgc3RhcnQsIGxldmVscy5sZW5ndGgpOwogICAgfQogIH0KICBmb3IgKGkgPSAwLCBpaSA9IGNoYXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgIGNvbnN0IGNoID0gY2hhcnNbaV07CiAgICBpZiAoY2ggPT09ICI8IiB8fCBjaCA9PT0gIj4iKSB7CiAgICAgIGNoYXJzW2ldID0gIiI7CiAgICB9CiAgfQogIHJldHVybiBjcmVhdGVCaWRpVGV4dChjaGFycy5qb2luKCIiKSwgaXNMVFIpOwp9Cgo7Ly8gLi9zcmMvc2hhcmVkL29iai1iaW4tdHJhbnNmb3JtLmpzCgpjbGFzcyBDc3NGb250SW5mbyB7CiAgI2J1ZmZlcjsKICAjdmlldzsKICAjZGVjb2RlcjsKICBzdGF0aWMgc3RyaW5ncyA9IFsiZm9udEZhbWlseSIsICJmb250V2VpZ2h0IiwgIml0YWxpY0FuZ2xlIl07CiAgc3RhdGljIHdyaXRlKGluZm8pIHsKICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgIGNvbnN0IGVuY29kZWRTdHJpbmdzID0ge307CiAgICBsZXQgc3RyaW5nc0xlbmd0aCA9IDA7CiAgICBmb3IgKGNvbnN0IHByb3Agb2YgQ3NzRm9udEluZm8uc3RyaW5ncykgewogICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2Rlci5lbmNvZGUoaW5mb1twcm9wXSk7CiAgICAgIGVuY29kZWRTdHJpbmdzW3Byb3BdID0gZW5jb2RlZDsKICAgICAgc3RyaW5nc0xlbmd0aCArPSA0ICsgZW5jb2RlZC5sZW5ndGg7CiAgICB9CiAgICBjb25zdCBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoc3RyaW5nc0xlbmd0aCk7CiAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgZm9yIChjb25zdCBwcm9wIG9mIENzc0ZvbnRJbmZvLnN0cmluZ3MpIHsKICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZWRTdHJpbmdzW3Byb3BdOwogICAgICBjb25zdCBsZW5ndGggPSBlbmNvZGVkLmxlbmd0aDsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBsZW5ndGgpOwogICAgICBkYXRhLnNldChlbmNvZGVkLCBvZmZzZXQgKyA0KTsKICAgICAgb2Zmc2V0ICs9IDQgKyBsZW5ndGg7CiAgICB9CiAgICBhc3NlcnQob2Zmc2V0ID09PSBidWZmZXIuYnl0ZUxlbmd0aCwgIkNzc0ZvbnRJbmZvLndyaXRlOiBCdWZmZXIgb3ZlcmZsb3ciKTsKICAgIHJldHVybiBidWZmZXI7CiAgfQogIGNvbnN0cnVjdG9yKGJ1ZmZlcikgewogICAgdGhpcy4jYnVmZmVyID0gYnVmZmVyOwogICAgdGhpcy4jdmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLiNidWZmZXIpOwogICAgdGhpcy4jZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOwogIH0KICAjcmVhZFN0cmluZyhpbmRleCkgewogICAgYXNzZXJ0KGluZGV4IDwgQ3NzRm9udEluZm8uc3RyaW5ncy5sZW5ndGgsICJJbnZhbGlkIHN0cmluZyBpbmRleCIpOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4OyBpKyspIHsKICAgICAgb2Zmc2V0ICs9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCkgKyA0OwogICAgfQogICAgY29uc3QgbGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIHJldHVybiB0aGlzLiNkZWNvZGVyLmRlY29kZShuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIGxlbmd0aCkpOwogIH0KICBnZXQgZm9udEZhbWlseSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDApOwogIH0KICBnZXQgZm9udFdlaWdodCgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDEpOwogIH0KICBnZXQgaXRhbGljQW5nbGUoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZFN0cmluZygyKTsKICB9Cn0KY2xhc3MgU3lzdGVtRm9udEluZm8gewogICNidWZmZXI7CiAgI3ZpZXc7CiAgI2RlY29kZXI7CiAgc3RhdGljIHN0cmluZ3MgPSBbImNzcyIsICJsb2FkZWROYW1lIiwgImJhc2VGb250TmFtZSIsICJzcmMiXTsKICBzdGF0aWMgd3JpdGUoaW5mbykgewogICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpOwogICAgY29uc3QgZW5jb2RlZFN0cmluZ3MgPSB7fTsKICAgIGxldCBzdHJpbmdzTGVuZ3RoID0gMDsKICAgIGZvciAoY29uc3QgcHJvcCBvZiBTeXN0ZW1Gb250SW5mby5zdHJpbmdzKSB7CiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVyLmVuY29kZShpbmZvW3Byb3BdKTsKICAgICAgZW5jb2RlZFN0cmluZ3NbcHJvcF0gPSBlbmNvZGVkOwogICAgICBzdHJpbmdzTGVuZ3RoICs9IDQgKyBlbmNvZGVkLmxlbmd0aDsKICAgIH0KICAgIHN0cmluZ3NMZW5ndGggKz0gNDsKICAgIGxldCBlbmNvZGVkU3R5bGVTdHlsZSwKICAgICAgZW5jb2RlZFN0eWxlV2VpZ2h0LAogICAgICBsZW5ndGhFc3RpbWF0ZSA9IDEgKyBzdHJpbmdzTGVuZ3RoOwogICAgaWYgKGluZm8uc3R5bGUpIHsKICAgICAgZW5jb2RlZFN0eWxlU3R5bGUgPSBlbmNvZGVyLmVuY29kZShpbmZvLnN0eWxlLnN0eWxlKTsKICAgICAgZW5jb2RlZFN0eWxlV2VpZ2h0ID0gZW5jb2Rlci5lbmNvZGUoaW5mby5zdHlsZS53ZWlnaHQpOwogICAgICBsZW5ndGhFc3RpbWF0ZSArPSA0ICsgZW5jb2RlZFN0eWxlU3R5bGUubGVuZ3RoICsgNCArIGVuY29kZWRTdHlsZVdlaWdodC5sZW5ndGg7CiAgICB9CiAgICBjb25zdCBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIobGVuZ3RoRXN0aW1hdGUpOwogICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIHZpZXcuc2V0VWludDgob2Zmc2V0KyssIGluZm8uZ3Vlc3NGYWxsYmFjayA/IDEgOiAwKTsKICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgMCk7CiAgICBvZmZzZXQgKz0gNDsKICAgIHN0cmluZ3NMZW5ndGggPSAwOwogICAgZm9yIChjb25zdCBwcm9wIG9mIFN5c3RlbUZvbnRJbmZvLnN0cmluZ3MpIHsKICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZWRTdHJpbmdzW3Byb3BdOwogICAgICBjb25zdCBsZW5ndGggPSBlbmNvZGVkLmxlbmd0aDsKICAgICAgc3RyaW5nc0xlbmd0aCArPSA0ICsgbGVuZ3RoOwogICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIGxlbmd0aCk7CiAgICAgIGRhdGEuc2V0KGVuY29kZWQsIG9mZnNldCArIDQpOwogICAgICBvZmZzZXQgKz0gNCArIGxlbmd0aDsKICAgIH0KICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCAtIHN0cmluZ3NMZW5ndGggLSA0LCBzdHJpbmdzTGVuZ3RoKTsKICAgIGlmIChpbmZvLnN0eWxlKSB7CiAgICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgZW5jb2RlZFN0eWxlU3R5bGUubGVuZ3RoKTsKICAgICAgZGF0YS5zZXQoZW5jb2RlZFN0eWxlU3R5bGUsIG9mZnNldCArIDQpOwogICAgICBvZmZzZXQgKz0gNCArIGVuY29kZWRTdHlsZVN0eWxlLmxlbmd0aDsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBlbmNvZGVkU3R5bGVXZWlnaHQubGVuZ3RoKTsKICAgICAgZGF0YS5zZXQoZW5jb2RlZFN0eWxlV2VpZ2h0LCBvZmZzZXQgKyA0KTsKICAgICAgb2Zmc2V0ICs9IDQgKyBlbmNvZGVkU3R5bGVXZWlnaHQubGVuZ3RoOwogICAgfQogICAgYXNzZXJ0KG9mZnNldCA8PSBidWZmZXIuYnl0ZUxlbmd0aCwgIlN1YnN0aXRpb25JbmZvLndyaXRlOiBCdWZmZXIgb3ZlcmZsb3ciKTsKICAgIHJldHVybiBidWZmZXIudHJhbnNmZXJUb0ZpeGVkTGVuZ3RoKG9mZnNldCk7CiAgfQogIGNvbnN0cnVjdG9yKGJ1ZmZlcikgewogICAgdGhpcy4jYnVmZmVyID0gYnVmZmVyOwogICAgdGhpcy4jdmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLiNidWZmZXIpOwogICAgdGhpcy4jZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOwogIH0KICBnZXQgZ3Vlc3NGYWxsYmFjaygpIHsKICAgIHJldHVybiB0aGlzLiN2aWV3LmdldFVpbnQ4KDApICE9PSAwOwogIH0KICAjcmVhZFN0cmluZyhpbmRleCkgewogICAgYXNzZXJ0KGluZGV4IDwgU3lzdGVtRm9udEluZm8uc3RyaW5ncy5sZW5ndGgsICJJbnZhbGlkIHN0cmluZyBpbmRleCIpOwogICAgbGV0IG9mZnNldCA9IDU7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4OyBpKyspIHsKICAgICAgb2Zmc2V0ICs9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCkgKyA0OwogICAgfQogICAgY29uc3QgbGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIHJldHVybiB0aGlzLiNkZWNvZGVyLmRlY29kZShuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIGxlbmd0aCkpOwogIH0KICBnZXQgY3NzKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRTdHJpbmcoMCk7CiAgfQogIGdldCBsb2FkZWROYW1lKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRTdHJpbmcoMSk7CiAgfQogIGdldCBiYXNlRm9udE5hbWUoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZFN0cmluZygyKTsKICB9CiAgZ2V0IHNyYygpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDMpOwogIH0KICBnZXQgc3R5bGUoKSB7CiAgICBsZXQgb2Zmc2V0ID0gMTsKICAgIG9mZnNldCArPSA0ICsgdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIGNvbnN0IHN0eWxlTGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIGNvbnN0IHN0eWxlID0gdGhpcy4jZGVjb2Rlci5kZWNvZGUobmV3IFVpbnQ4QXJyYXkodGhpcy4jYnVmZmVyLCBvZmZzZXQgKyA0LCBzdHlsZUxlbmd0aCkpOwogICAgb2Zmc2V0ICs9IDQgKyBzdHlsZUxlbmd0aDsKICAgIGNvbnN0IHdlaWdodExlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBjb25zdCB3ZWlnaHQgPSB0aGlzLiNkZWNvZGVyLmRlY29kZShuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIHdlaWdodExlbmd0aCkpOwogICAgcmV0dXJuIHsKICAgICAgc3R5bGUsCiAgICAgIHdlaWdodAogICAgfTsKICB9Cn0KY2xhc3MgRm9udEluZm8gewogIHN0YXRpYyBib29scyA9IFsiYmxhY2siLCAiYm9sZCIsICJkaXNhYmxlRm9udEZhY2UiLCAiZm9udEV4dHJhUHJvcGVydGllcyIsICJpc0ludmFsaWRQREZqc0ZvbnQiLCAiaXNUeXBlM0ZvbnQiLCAiaXRhbGljIiwgIm1pc3NpbmdGaWxlIiwgInJlbWVhc3VyZSIsICJ2ZXJ0aWNhbCJdOwogIHN0YXRpYyBudW1iZXJzID0gWyJhc2NlbnQiLCAiZGVmYXVsdFdpZHRoIiwgImRlc2NlbnQiXTsKICBzdGF0aWMgc3RyaW5ncyA9IFsiZmFsbGJhY2tOYW1lIiwgImxvYWRlZE5hbWUiLCAibWltZXR5cGUiLCAibmFtZSJdOwogIHN0YXRpYyAjT0ZGU0VUX05VTUJFUlMgPSBNYXRoLmNlaWwodGhpcy5ib29scy5sZW5ndGggKiAyIC8gOCk7CiAgc3RhdGljICNPRkZTRVRfQkJPWCA9IHRoaXMuI09GRlNFVF9OVU1CRVJTICsgdGhpcy5udW1iZXJzLmxlbmd0aCAqIDg7CiAgc3RhdGljICNPRkZTRVRfRk9OVF9NQVRSSVggPSB0aGlzLiNPRkZTRVRfQkJPWCArIDEgKyAyICogNDsKICBzdGF0aWMgI09GRlNFVF9ERUZBVUxUX1ZNRVRSSUNTID0gdGhpcy4jT0ZGU0VUX0ZPTlRfTUFUUklYICsgMSArIDggKiA2OwogIHN0YXRpYyAjT0ZGU0VUX1NUUklOR1MgPSB0aGlzLiNPRkZTRVRfREVGQVVMVF9WTUVUUklDUyArIDEgKyAyICogMzsKICAjYnVmZmVyOwogICNkZWNvZGVyOwogICN2aWV3OwogIGNvbnN0cnVjdG9yKHsKICAgIGRhdGEsCiAgICBleHRyYQogIH0pIHsKICAgIHRoaXMuI2J1ZmZlciA9IGRhdGE7CiAgICB0aGlzLiNkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7CiAgICB0aGlzLiN2aWV3ID0gbmV3IERhdGFWaWV3KHRoaXMuI2J1ZmZlcik7CiAgICBpZiAoZXh0cmEpIHsKICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBleHRyYSk7CiAgICB9CiAgfQogICNyZWFkQm9vbGVhbihpbmRleCkgewogICAgYXNzZXJ0KGluZGV4IDwgRm9udEluZm8uYm9vbHMubGVuZ3RoLCAiSW52YWxpZCBib29sZWFuIGluZGV4Iik7CiAgICBjb25zdCBieXRlT2Zmc2V0ID0gTWF0aC5mbG9vcihpbmRleCAvIDQpOwogICAgY29uc3QgYml0T2Zmc2V0ID0gaW5kZXggKiAyICUgODsKICAgIGNvbnN0IHZhbHVlID0gdGhpcy4jdmlldy5nZXRVaW50OChieXRlT2Zmc2V0KSA+PiBiaXRPZmZzZXQgJiAweDAzOwogICAgcmV0dXJuIHZhbHVlID09PSAweDAwID8gdW5kZWZpbmVkIDogdmFsdWUgPT09IDB4MDI7CiAgfQogIGdldCBibGFjaygpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkQm9vbGVhbigwKTsKICB9CiAgZ2V0IGJvbGQoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZEJvb2xlYW4oMSk7CiAgfQogIGdldCBkaXNhYmxlRm9udEZhY2UoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZEJvb2xlYW4oMik7CiAgfQogIGdldCBmb250RXh0cmFQcm9wZXJ0aWVzKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRCb29sZWFuKDMpOwogIH0KICBnZXQgaXNJbnZhbGlkUERGanNGb250KCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRCb29sZWFuKDQpOwogIH0KICBnZXQgaXNUeXBlM0ZvbnQoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZEJvb2xlYW4oNSk7CiAgfQogIGdldCBpdGFsaWMoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZEJvb2xlYW4oNik7CiAgfQogIGdldCBtaXNzaW5nRmlsZSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkQm9vbGVhbig3KTsKICB9CiAgZ2V0IHJlbWVhc3VyZSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkQm9vbGVhbig4KTsKICB9CiAgZ2V0IHZlcnRpY2FsKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRCb29sZWFuKDkpOwogIH0KICAjcmVhZE51bWJlcihpbmRleCkgewogICAgYXNzZXJ0KGluZGV4IDwgRm9udEluZm8ubnVtYmVycy5sZW5ndGgsICJJbnZhbGlkIG51bWJlciBpbmRleCIpOwogICAgcmV0dXJuIHRoaXMuI3ZpZXcuZ2V0RmxvYXQ2NChGb250SW5mby4jT0ZGU0VUX05VTUJFUlMgKyBpbmRleCAqIDgpOwogIH0KICBnZXQgYXNjZW50KCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWROdW1iZXIoMCk7CiAgfQogIGdldCBkZWZhdWx0V2lkdGgoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZE51bWJlcigxKTsKICB9CiAgZ2V0IGRlc2NlbnQoKSB7CiAgICByZXR1cm4gdGhpcy4jcmVhZE51bWJlcigyKTsKICB9CiAgZ2V0IGJib3goKSB7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9CQk9YOwogICAgY29uc3QgbnVtQ29vcmRzID0gdGhpcy4jdmlldy5nZXRVaW50OChvZmZzZXQpOwogICAgaWYgKG51bUNvb3JkcyA9PT0gMCkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgb2Zmc2V0ICs9IDE7CiAgICBjb25zdCBiYm94ID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICBiYm94LnB1c2godGhpcy4jdmlldy5nZXRJbnQxNihvZmZzZXQsIHRydWUpKTsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9CiAgICByZXR1cm4gYmJveDsKICB9CiAgZ2V0IGZvbnRNYXRyaXgoKSB7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9GT05UX01BVFJJWDsKICAgIGNvbnN0IG51bVBvaW50cyA9IHRoaXMuI3ZpZXcuZ2V0VWludDgob2Zmc2V0KTsKICAgIGlmIChudW1Qb2ludHMgPT09IDApIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIG9mZnNldCArPSAxOwogICAgY29uc3QgZm9udE1hdHJpeCA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgZm9udE1hdHJpeC5wdXNoKHRoaXMuI3ZpZXcuZ2V0RmxvYXQ2NChvZmZzZXQsIHRydWUpKTsKICAgICAgb2Zmc2V0ICs9IDg7CiAgICB9CiAgICByZXR1cm4gZm9udE1hdHJpeDsKICB9CiAgZ2V0IGRlZmF1bHRWTWV0cmljcygpIHsKICAgIGxldCBvZmZzZXQgPSBGb250SW5mby4jT0ZGU0VUX0RFRkFVTFRfVk1FVFJJQ1M7CiAgICBjb25zdCBudW1NZXRyaWNzID0gdGhpcy4jdmlldy5nZXRVaW50OChvZmZzZXQpOwogICAgaWYgKG51bU1ldHJpY3MgPT09IDApIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIG9mZnNldCArPSAxOwogICAgY29uc3QgZGVmYXVsdFZNZXRyaWNzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykgewogICAgICBkZWZhdWx0Vk1ldHJpY3MucHVzaCh0aGlzLiN2aWV3LmdldEludDE2KG9mZnNldCwgdHJ1ZSkpOwogICAgICBvZmZzZXQgKz0gMjsKICAgIH0KICAgIHJldHVybiBkZWZhdWx0Vk1ldHJpY3M7CiAgfQogICNyZWFkU3RyaW5nKGluZGV4KSB7CiAgICBhc3NlcnQoaW5kZXggPCBGb250SW5mby5zdHJpbmdzLmxlbmd0aCwgIkludmFsaWQgc3RyaW5nIGluZGV4Iik7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9TVFJJTkdTICsgNDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXg7IGkrKykgewogICAgICBvZmZzZXQgKz0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KSArIDQ7CiAgICB9CiAgICBjb25zdCBsZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgY29uc3Qgc3RyaW5nRGF0YSA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICBzdHJpbmdEYXRhLnNldChuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIGxlbmd0aCkpOwogICAgcmV0dXJuIHRoaXMuI2RlY29kZXIuZGVjb2RlKHN0cmluZ0RhdGEpOwogIH0KICBnZXQgZmFsbGJhY2tOYW1lKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRTdHJpbmcoMCk7CiAgfQogIGdldCBsb2FkZWROYW1lKCkgewogICAgcmV0dXJuIHRoaXMuI3JlYWRTdHJpbmcoMSk7CiAgfQogIGdldCBtaW1ldHlwZSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDIpOwogIH0KICBnZXQgbmFtZSgpIHsKICAgIHJldHVybiB0aGlzLiNyZWFkU3RyaW5nKDMpOwogIH0KICBnZXQgZGF0YSgpIHsKICAgIGxldCBvZmZzZXQgPSBGb250SW5mby4jT0ZGU0VUX1NUUklOR1M7CiAgICBjb25zdCBzdHJpbmdzTGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIG9mZnNldCArPSA0ICsgc3RyaW5nc0xlbmd0aDsKICAgIGNvbnN0IHN5c3RlbUZvbnRJbmZvTGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIG9mZnNldCArPSA0ICsgc3lzdGVtRm9udEluZm9MZW5ndGg7CiAgICBjb25zdCBjc3NGb250SW5mb0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIGNzc0ZvbnRJbmZvTGVuZ3RoOwogICAgY29uc3QgbGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIGlmIChsZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiBuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIGxlbmd0aCk7CiAgfQogIGNsZWFyRGF0YSgpIHsKICAgIGxldCBvZmZzZXQgPSBGb250SW5mby4jT0ZGU0VUX1NUUklOR1M7CiAgICBjb25zdCBzdHJpbmdzTGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIG9mZnNldCArPSA0ICsgc3RyaW5nc0xlbmd0aDsKICAgIGNvbnN0IHN5c3RlbUZvbnRJbmZvTGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIG9mZnNldCArPSA0ICsgc3lzdGVtRm9udEluZm9MZW5ndGg7CiAgICBjb25zdCBjc3NGb250SW5mb0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIGNzc0ZvbnRJbmZvTGVuZ3RoOwogICAgY29uc3QgbGVuZ3RoID0gdGhpcy4jdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIGxlbmd0aCk7CiAgICBkYXRhLmZpbGwoMCk7CiAgICB0aGlzLiN2aWV3LnNldFVpbnQzMihvZmZzZXQsIDApOwogIH0KICBnZXQgY3NzRm9udEluZm8oKSB7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9TVFJJTkdTOwogICAgY29uc3Qgc3RyaW5nc0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIHN0cmluZ3NMZW5ndGg7CiAgICBjb25zdCBzeXN0ZW1Gb250SW5mb0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIHN5c3RlbUZvbnRJbmZvTGVuZ3RoOwogICAgY29uc3QgY3NzRm9udEluZm9MZW5ndGggPSB0aGlzLiN2aWV3LmdldFVpbnQzMihvZmZzZXQpOwogICAgaWYgKGNzc0ZvbnRJbmZvTGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgY3NzRm9udEluZm9EYXRhID0gbmV3IFVpbnQ4QXJyYXkoY3NzRm9udEluZm9MZW5ndGgpOwogICAgY3NzRm9udEluZm9EYXRhLnNldChuZXcgVWludDhBcnJheSh0aGlzLiNidWZmZXIsIG9mZnNldCArIDQsIGNzc0ZvbnRJbmZvTGVuZ3RoKSk7CiAgICByZXR1cm4gbmV3IENzc0ZvbnRJbmZvKGNzc0ZvbnRJbmZvRGF0YS5idWZmZXIpOwogIH0KICBnZXQgc3lzdGVtRm9udEluZm8oKSB7CiAgICBsZXQgb2Zmc2V0ID0gRm9udEluZm8uI09GRlNFVF9TVFJJTkdTOwogICAgY29uc3Qgc3RyaW5nc0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBvZmZzZXQgKz0gNCArIHN0cmluZ3NMZW5ndGg7CiAgICBjb25zdCBzeXN0ZW1Gb250SW5mb0xlbmd0aCA9IHRoaXMuI3ZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBpZiAoc3lzdGVtRm9udEluZm9MZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBzeXN0ZW1Gb250SW5mb0RhdGEgPSBuZXcgVWludDhBcnJheShzeXN0ZW1Gb250SW5mb0xlbmd0aCk7CiAgICBzeXN0ZW1Gb250SW5mb0RhdGEuc2V0KG5ldyBVaW50OEFycmF5KHRoaXMuI2J1ZmZlciwgb2Zmc2V0ICsgNCwgc3lzdGVtRm9udEluZm9MZW5ndGgpKTsKICAgIHJldHVybiBuZXcgU3lzdGVtRm9udEluZm8oc3lzdGVtRm9udEluZm9EYXRhLmJ1ZmZlcik7CiAgfQogIHN0YXRpYyB3cml0ZShmb250KSB7CiAgICBjb25zdCBzeXN0ZW1Gb250SW5mb0J1ZmZlciA9IGZvbnQuc3lzdGVtRm9udEluZm8gPyBTeXN0ZW1Gb250SW5mby53cml0ZShmb250LnN5c3RlbUZvbnRJbmZvKSA6IG51bGw7CiAgICBjb25zdCBjc3NGb250SW5mb0J1ZmZlciA9IGZvbnQuY3NzRm9udEluZm8gPyBDc3NGb250SW5mby53cml0ZShmb250LmNzc0ZvbnRJbmZvKSA6IG51bGw7CiAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7CiAgICBjb25zdCBlbmNvZGVkU3RyaW5ncyA9IHt9OwogICAgbGV0IHN0cmluZ3NMZW5ndGggPSAwOwogICAgZm9yIChjb25zdCBwcm9wIG9mIEZvbnRJbmZvLnN0cmluZ3MpIHsKICAgICAgZW5jb2RlZFN0cmluZ3NbcHJvcF0gPSBlbmNvZGVyLmVuY29kZShmb250W3Byb3BdKTsKICAgICAgc3RyaW5nc0xlbmd0aCArPSA0ICsgZW5jb2RlZFN0cmluZ3NbcHJvcF0ubGVuZ3RoOwogICAgfQogICAgY29uc3QgbGVuZ3RoRXN0aW1hdGUgPSBGb250SW5mby4jT0ZGU0VUX1NUUklOR1MgKyA0ICsgc3RyaW5nc0xlbmd0aCArIDQgKyAoc3lzdGVtRm9udEluZm9CdWZmZXIgPyBzeXN0ZW1Gb250SW5mb0J1ZmZlci5ieXRlTGVuZ3RoIDogMCkgKyA0ICsgKGNzc0ZvbnRJbmZvQnVmZmVyID8gY3NzRm9udEluZm9CdWZmZXIuYnl0ZUxlbmd0aCA6IDApICsgNCArIChmb250LmRhdGEgPyBmb250LmRhdGEubGVuZ3RoIDogMCk7CiAgICBjb25zdCBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIobGVuZ3RoRXN0aW1hdGUpOwogICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGNvbnN0IG51bUJvb2xzID0gRm9udEluZm8uYm9vbHMubGVuZ3RoOwogICAgbGV0IGJvb2xCeXRlID0gMCwKICAgICAgYm9vbEJpdCA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUJvb2xzOyBpKyspIHsKICAgICAgY29uc3QgdmFsdWUgPSBmb250W0ZvbnRJbmZvLmJvb2xzW2ldXTsKICAgICAgY29uc3QgYml0cyA9IHZhbHVlID09PSB1bmRlZmluZWQgPyAweDAwIDogdmFsdWUgPyAweDAyIDogMHgwMTsKICAgICAgYm9vbEJ5dGUgfD0gYml0cyA8PCBib29sQml0OwogICAgICBib29sQml0ICs9IDI7CiAgICAgIGlmIChib29sQml0ID09PSA4IHx8IGkgPT09IG51bUJvb2xzIC0gMSkgewogICAgICAgIHZpZXcuc2V0VWludDgob2Zmc2V0KyssIGJvb2xCeXRlKTsKICAgICAgICBib29sQnl0ZSA9IDA7CiAgICAgICAgYm9vbEJpdCA9IDA7CiAgICAgIH0KICAgIH0KICAgIGFzc2VydChvZmZzZXQgPT09IEZvbnRJbmZvLiNPRkZTRVRfTlVNQkVSUywgIkZvbnRJbmZvLndyaXRlOiBCb29sZWFuIHByb3BlcnRpZXMgb2Zmc2V0IG1pc21hdGNoIik7CiAgICBmb3IgKGNvbnN0IHByb3Agb2YgRm9udEluZm8ubnVtYmVycykgewogICAgICB2aWV3LnNldEZsb2F0NjQob2Zmc2V0LCBmb250W3Byb3BdKTsKICAgICAgb2Zmc2V0ICs9IDg7CiAgICB9CiAgICBhc3NlcnQob2Zmc2V0ID09PSBGb250SW5mby4jT0ZGU0VUX0JCT1gsICJGb250SW5mby53cml0ZTogTnVtYmVyIHByb3BlcnRpZXMgb2Zmc2V0IG1pc21hdGNoIik7CiAgICBpZiAoZm9udC5iYm94KSB7CiAgICAgIHZpZXcuc2V0VWludDgob2Zmc2V0KyssIDQpOwogICAgICBmb3IgKGNvbnN0IGNvb3JkIG9mIGZvbnQuYmJveCkgewogICAgICAgIHZpZXcuc2V0SW50MTYob2Zmc2V0LCBjb29yZCwgdHJ1ZSk7CiAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZpZXcuc2V0VWludDgob2Zmc2V0KyssIDApOwogICAgICBvZmZzZXQgKz0gMiAqIDQ7CiAgICB9CiAgICBhc3NlcnQob2Zmc2V0ID09PSBGb250SW5mby4jT0ZGU0VUX0ZPTlRfTUFUUklYLCAiRm9udEluZm8ud3JpdGU6IEJCb3ggcHJvcGVydGllcyBvZmZzZXQgbWlzbWF0Y2giKTsKICAgIGlmIChmb250LmZvbnRNYXRyaXgpIHsKICAgICAgdmlldy5zZXRVaW50OChvZmZzZXQrKywgNik7CiAgICAgIGZvciAoY29uc3QgcG9pbnQgb2YgZm9udC5mb250TWF0cml4KSB7CiAgICAgICAgdmlldy5zZXRGbG9hdDY0KG9mZnNldCwgcG9pbnQsIHRydWUpOwogICAgICAgIG9mZnNldCArPSA4OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCsrLCAwKTsKICAgICAgb2Zmc2V0ICs9IDggKiA2OwogICAgfQogICAgYXNzZXJ0KG9mZnNldCA9PT0gRm9udEluZm8uI09GRlNFVF9ERUZBVUxUX1ZNRVRSSUNTLCAiRm9udEluZm8ud3JpdGU6IEZvbnRNYXRyaXggcHJvcGVydGllcyBvZmZzZXQgbWlzbWF0Y2giKTsKICAgIGlmIChmb250LmRlZmF1bHRWTWV0cmljcykgewogICAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCsrLCAxKTsKICAgICAgZm9yIChjb25zdCBtZXRyaWMgb2YgZm9udC5kZWZhdWx0Vk1ldHJpY3MpIHsKICAgICAgICB2aWV3LnNldEludDE2KG9mZnNldCwgbWV0cmljLCB0cnVlKTsKICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmlldy5zZXRVaW50OChvZmZzZXQrKywgMCk7CiAgICAgIG9mZnNldCArPSAzICogMjsKICAgIH0KICAgIGFzc2VydChvZmZzZXQgPT09IEZvbnRJbmZvLiNPRkZTRVRfU1RSSU5HUywgIkZvbnRJbmZvLndyaXRlOiBEZWZhdWx0Vk1ldHJpY3MgcHJvcGVydGllcyBvZmZzZXQgbWlzbWF0Y2giKTsKICAgIHZpZXcuc2V0VWludDMyKEZvbnRJbmZvLiNPRkZTRVRfU1RSSU5HUywgMCk7CiAgICBvZmZzZXQgKz0gNDsKICAgIGZvciAoY29uc3QgcHJvcCBvZiBGb250SW5mby5zdHJpbmdzKSB7CiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVkU3RyaW5nc1twcm9wXTsKICAgICAgY29uc3QgbGVuZ3RoID0gZW5jb2RlZC5sZW5ndGg7CiAgICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgbGVuZ3RoKTsKICAgICAgZGF0YS5zZXQoZW5jb2RlZCwgb2Zmc2V0ICsgNCk7CiAgICAgIG9mZnNldCArPSA0ICsgbGVuZ3RoOwogICAgfQogICAgdmlldy5zZXRVaW50MzIoRm9udEluZm8uI09GRlNFVF9TVFJJTkdTLCBvZmZzZXQgLSBGb250SW5mby4jT0ZGU0VUX1NUUklOR1MgLSA0KTsKICAgIGlmICghc3lzdGVtRm9udEluZm9CdWZmZXIpIHsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCAwKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBsZW5ndGggPSBzeXN0ZW1Gb250SW5mb0J1ZmZlci5ieXRlTGVuZ3RoOwogICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIGxlbmd0aCk7CiAgICAgIGFzc2VydChvZmZzZXQgKyA0ICsgbGVuZ3RoIDw9IGJ1ZmZlci5ieXRlTGVuZ3RoLCAiRm9udEluZm8ud3JpdGU6IEJ1ZmZlciBvdmVyZmxvdyBhdCBzeXN0ZW1Gb250SW5mbyIpOwogICAgICBkYXRhLnNldChuZXcgVWludDhBcnJheShzeXN0ZW1Gb250SW5mb0J1ZmZlciksIG9mZnNldCArIDQpOwogICAgICBvZmZzZXQgKz0gNCArIGxlbmd0aDsKICAgIH0KICAgIGlmICghY3NzRm9udEluZm9CdWZmZXIpIHsKICAgICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCAwKTsKICAgICAgb2Zmc2V0ICs9IDQ7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBsZW5ndGggPSBjc3NGb250SW5mb0J1ZmZlci5ieXRlTGVuZ3RoOwogICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIGxlbmd0aCk7CiAgICAgIGFzc2VydChvZmZzZXQgKyA0ICsgbGVuZ3RoIDw9IGJ1ZmZlci5ieXRlTGVuZ3RoLCAiRm9udEluZm8ud3JpdGU6IEJ1ZmZlciBvdmVyZmxvdyBhdCBjc3NGb250SW5mbyIpOwogICAgICBkYXRhLnNldChuZXcgVWludDhBcnJheShjc3NGb250SW5mb0J1ZmZlciksIG9mZnNldCArIDQpOwogICAgICBvZmZzZXQgKz0gNCArIGxlbmd0aDsKICAgIH0KICAgIGlmIChmb250LmRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIDApOwogICAgICBvZmZzZXQgKz0gNDsKICAgIH0gZWxzZSB7CiAgICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCwgZm9udC5kYXRhLmxlbmd0aCk7CiAgICAgIGRhdGEuc2V0KGZvbnQuZGF0YSwgb2Zmc2V0ICsgNCk7CiAgICAgIG9mZnNldCArPSA0ICsgZm9udC5kYXRhLmxlbmd0aDsKICAgIH0KICAgIGFzc2VydChvZmZzZXQgPD0gYnVmZmVyLmJ5dGVMZW5ndGgsICJGb250SW5mby53cml0ZTogQnVmZmVyIG92ZXJmbG93Iik7CiAgICByZXR1cm4gYnVmZmVyLnRyYW5zZmVyVG9GaXhlZExlbmd0aChvZmZzZXQpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZm9udF9zdWJzdGl0dXRpb25zLmpzCgoKCmNvbnN0IE5PUk1BTCA9IHsKICBzdHlsZTogIm5vcm1hbCIsCiAgd2VpZ2h0OiAibm9ybWFsIgp9Owpjb25zdCBCT0xEID0gewogIHN0eWxlOiAibm9ybWFsIiwKICB3ZWlnaHQ6ICJib2xkIgp9Owpjb25zdCBJVEFMSUMgPSB7CiAgc3R5bGU6ICJpdGFsaWMiLAogIHdlaWdodDogIm5vcm1hbCIKfTsKY29uc3QgQk9MRElUQUxJQyA9IHsKICBzdHlsZTogIml0YWxpYyIsCiAgd2VpZ2h0OiAiYm9sZCIKfTsKY29uc3Qgc3Vic3RpdHV0aW9uTWFwID0gbmV3IE1hcChbWyJUaW1lcy1Sb21hbiIsIHsKICBsb2NhbDogWyJUaW1lcyBOZXcgUm9tYW4iLCAiVGltZXMtUm9tYW4iLCAiVGltZXMiLCAiTGliZXJhdGlvbiBTZXJpZiIsICJOaW1idXMgUm9tYW4iLCAiTmltYnVzIFJvbWFuIEwiLCAiVGlub3MiLCAiVGhvcm5kYWxlIiwgIlRlWCBHeXJlIFRlcm1lcyIsICJGcmVlU2VyaWYiLCAiTGludXggTGliZXJ0aW5lIE8iLCAiTGliZXJ0aW51cyBTZXJpZiIsICJEZWphVnUgU2VyaWYiLCAiQml0c3RyZWFtIFZlcmEgU2VyaWYiLCAiVWJ1bnR1Il0sCiAgc3R5bGU6IE5PUk1BTCwKICB1bHRpbWF0ZTogInNlcmlmIgp9XSwgWyJUaW1lcy1Cb2xkIiwgewogIGFsaWFzOiAiVGltZXMtUm9tYW4iLAogIHN0eWxlOiBCT0xELAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIlRpbWVzLUl0YWxpYyIsIHsKICBhbGlhczogIlRpbWVzLVJvbWFuIiwKICBzdHlsZTogSVRBTElDLAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIlRpbWVzLUJvbGRJdGFsaWMiLCB7CiAgYWxpYXM6ICJUaW1lcy1Sb21hbiIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgdWx0aW1hdGU6ICJzZXJpZiIKfV0sIFsiSGVsdmV0aWNhIiwgewogIGxvY2FsOiBbIkhlbHZldGljYSIsICJIZWx2ZXRpY2EgTmV1ZSIsICJBcmlhbCIsICJBcmlhbCBOb3ZhIiwgIkxpYmVyYXRpb24gU2FucyIsICJBcmltbyIsICJOaW1idXMgU2FucyIsICJOaW1idXMgU2FucyBMIiwgIkEwMzAiLCAiVGVYIEd5cmUgSGVyb3MiLCAiRnJlZVNhbnMiLCAiRGVqYVZ1IFNhbnMiLCAiQWxiYW55IiwgIkJpdHN0cmVhbSBWZXJhIFNhbnMiLCAiQXJpYWwgVW5pY29kZSBNUyIsICJNaWNyb3NvZnQgU2FucyBTZXJpZiIsICJBcHBsZSBTeW1ib2xzIiwgIkNhbnRhcmVsbCJdLAogIHBhdGg6ICJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyLnR0ZiIsCiAgc3R5bGU6IE5PUk1BTCwKICB1bHRpbWF0ZTogInNhbnMtc2VyaWYiCn1dLCBbIkhlbHZldGljYS1Cb2xkIiwgewogIGFsaWFzOiAiSGVsdmV0aWNhIiwKICBwYXRoOiAiTGliZXJhdGlvblNhbnMtQm9sZC50dGYiLAogIHN0eWxlOiBCT0xELAogIHVsdGltYXRlOiAic2Fucy1zZXJpZiIKfV0sIFsiSGVsdmV0aWNhLU9ibGlxdWUiLCB7CiAgYWxpYXM6ICJIZWx2ZXRpY2EiLAogIHBhdGg6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMudHRmIiwKICBzdHlsZTogSVRBTElDLAogIHVsdGltYXRlOiAic2Fucy1zZXJpZiIKfV0sIFsiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIiwgewogIGFsaWFzOiAiSGVsdmV0aWNhIiwKICBwYXRoOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYy50dGYiLAogIHN0eWxlOiBCT0xESVRBTElDLAogIHVsdGltYXRlOiAic2Fucy1zZXJpZiIKfV0sIFsiQ291cmllciIsIHsKICBsb2NhbDogWyJDb3VyaWVyIiwgIkNvdXJpZXIgTmV3IiwgIkxpYmVyYXRpb24gTW9ubyIsICJOaW1idXMgTW9ubyIsICJOaW1idXMgTW9ubyBMIiwgIkNvdXNpbmUiLCAiQ3VtYmVybGFuZCIsICJUZVggR3lyZSBDdXJzb3IiLCAiRnJlZU1vbm8iLCAiTGludXggTGliZXJ0aW5lIE1vbm8gTyIsICJMaWJlcnRpbnVzIE1vbm8iXSwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAibW9ub3NwYWNlIgp9XSwgWyJDb3VyaWVyLUJvbGQiLCB7CiAgYWxpYXM6ICJDb3VyaWVyIiwKICBzdHlsZTogQk9MRCwKICB1bHRpbWF0ZTogIm1vbm9zcGFjZSIKfV0sIFsiQ291cmllci1PYmxpcXVlIiwgewogIGFsaWFzOiAiQ291cmllciIsCiAgc3R5bGU6IElUQUxJQywKICB1bHRpbWF0ZTogIm1vbm9zcGFjZSIKfV0sIFsiQ291cmllci1Cb2xkT2JsaXF1ZSIsIHsKICBhbGlhczogIkNvdXJpZXIiLAogIHN0eWxlOiBCT0xESVRBTElDLAogIHVsdGltYXRlOiAibW9ub3NwYWNlIgp9XSwgWyJBcmlhbEJsYWNrIiwgewogIGxvY2FsOiBbIkFyaWFsIEJsYWNrIl0sCiAgc3R5bGU6IHsKICAgIHN0eWxlOiAibm9ybWFsIiwKICAgIHdlaWdodDogIjkwMCIKICB9LAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLUJvbGQiCn1dLCBbIkFyaWFsQmxhY2stQm9sZCIsIHsKICBhbGlhczogIkFyaWFsQmxhY2siCn1dLCBbIkFyaWFsQmxhY2stSXRhbGljIiwgewogIGFsaWFzOiAiQXJpYWxCbGFjayIsCiAgc3R5bGU6IHsKICAgIHN0eWxlOiAiaXRhbGljIiwKICAgIHdlaWdodDogIjkwMCIKICB9LAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIgp9XSwgWyJBcmlhbEJsYWNrLUJvbGRJdGFsaWMiLCB7CiAgYWxpYXM6ICJBcmlhbEJsYWNrLUl0YWxpYyIKfV0sIFsiQXJpYWxOYXJyb3ciLCB7CiAgbG9jYWw6IFsiQXJpYWwgTmFycm93IiwgIkxpYmVyYXRpb24gU2FucyBOYXJyb3ciLCAiSGVsdmV0aWNhIENvbmRlbnNlZCIsICJOaW1idXMgU2FucyBOYXJyb3ciLCAiVGVYIEd5cmUgSGVyb3MgQ24iXSwKICBzdHlsZTogTk9STUFMLAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhIgp9XSwgWyJBcmlhbE5hcnJvdy1Cb2xkIiwgewogIGFsaWFzOiAiQXJpYWxOYXJyb3ciLAogIHN0eWxlOiBCT0xELAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLUJvbGQiCn1dLCBbIkFyaWFsTmFycm93LUl0YWxpYyIsIHsKICBhbGlhczogIkFyaWFsTmFycm93IiwKICBzdHlsZTogSVRBTElDLAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLU9ibGlxdWUiCn1dLCBbIkFyaWFsTmFycm93LUJvbGRJdGFsaWMiLCB7CiAgYWxpYXM6ICJBcmlhbE5hcnJvdyIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiCn1dLCBbIkNhbGlicmkiLCB7CiAgbG9jYWw6IFsiQ2FsaWJyaSIsICJDYXJsaXRvIl0sCiAgc3R5bGU6IE5PUk1BTCwKICBmYWxsYmFjazogIkhlbHZldGljYSIKfV0sIFsiQ2FsaWJyaS1Cb2xkIiwgewogIGFsaWFzOiAiQ2FsaWJyaSIsCiAgc3R5bGU6IEJPTEQsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZCIKfV0sIFsiQ2FsaWJyaS1JdGFsaWMiLCB7CiAgYWxpYXM6ICJDYWxpYnJpIiwKICBzdHlsZTogSVRBTElDLAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLU9ibGlxdWUiCn1dLCBbIkNhbGlicmktQm9sZEl0YWxpYyIsIHsKICBhbGlhczogIkNhbGlicmkiLAogIHN0eWxlOiBCT0xESVRBTElDLAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIgp9XSwgWyJXaW5nZGluZ3MiLCB7CiAgbG9jYWw6IFsiV2luZ2RpbmdzIiwgIlVSVyBEaW5nYmF0cyJdLAogIHN0eWxlOiBOT1JNQUwKfV0sIFsiV2luZ2RpbmdzLVJlZ3VsYXIiLCB7CiAgYWxpYXM6ICJXaW5nZGluZ3MiCn1dLCBbIldpbmdkaW5ncy1Cb2xkIiwgewogIGFsaWFzOiAiV2luZ2RpbmdzIgp9XV0pOwpjb25zdCBmb250QWxpYXNlcyA9IG5ldyBNYXAoW1siQXJpYWwtQmxhY2siLCAiQXJpYWxCbGFjayJdXSk7CmZ1bmN0aW9uIGdldFN0eWxlVG9BcHBlbmQoc3R5bGUpIHsKICBzd2l0Y2ggKHN0eWxlKSB7CiAgICBjYXNlIEJPTEQ6CiAgICAgIHJldHVybiAiQm9sZCI7CiAgICBjYXNlIElUQUxJQzoKICAgICAgcmV0dXJuICJJdGFsaWMiOwogICAgY2FzZSBCT0xESVRBTElDOgogICAgICByZXR1cm4gIkJvbGQgSXRhbGljIjsKICAgIGRlZmF1bHQ6CiAgICAgIGlmIChzdHlsZT8ud2VpZ2h0ID09PSAiYm9sZCIpIHsKICAgICAgICByZXR1cm4gIkJvbGQiOwogICAgICB9CiAgICAgIGlmIChzdHlsZT8uc3R5bGUgPT09ICJpdGFsaWMiKSB7CiAgICAgICAgcmV0dXJuICJJdGFsaWMiOwogICAgICB9CiAgfQogIHJldHVybiAiIjsKfQpmdW5jdGlvbiBnZXRGYW1pbHlOYW1lKHN0cikgewogIGNvbnN0IGtleXdvcmRzID0gbmV3IFNldChbInRoaW4iLCAiZXh0cmFsaWdodCIsICJ1bHRyYWxpZ2h0IiwgImRlbWlsaWdodCIsICJzZW1pbGlnaHQiLCAibGlnaHQiLCAiYm9vayIsICJyZWd1bGFyIiwgIm5vcm1hbCIsICJtZWRpdW0iLCAiZGVtaWJvbGQiLCAic2VtaWJvbGQiLCAiYm9sZCIsICJleHRyYWJvbGQiLCAidWx0cmFib2xkIiwgImJsYWNrIiwgImhlYXZ5IiwgImV4dHJhYmxhY2siLCAidWx0cmFibGFjayIsICJyb21hbiIsICJpdGFsaWMiLCAib2JsaXF1ZSIsICJ1bHRyYWNvbmRlbnNlZCIsICJleHRyYWNvbmRlbnNlZCIsICJjb25kZW5zZWQiLCAic2VtaWNvbmRlbnNlZCIsICJub3JtYWwiLCAic2VtaWV4cGFuZGVkIiwgImV4cGFuZGVkIiwgImV4dHJhZXhwYW5kZWQiLCAidWx0cmFleHBhbmRlZCIsICJib2xkaXRhbGljIl0pOwogIHJldHVybiBzdHIuc3BsaXQoL1stICwrXSsvZykuZmlsdGVyKHRvayA9PiAha2V5d29yZHMuaGFzKHRvay50b0xvd2VyQ2FzZSgpKSkuam9pbigiICIpOwp9CmZ1bmN0aW9uIGdlbmVyYXRlRm9udCh7CiAgYWxpYXMsCiAgbG9jYWwsCiAgcGF0aCwKICBmYWxsYmFjaywKICBzdHlsZSwKICB1bHRpbWF0ZQp9LCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrID0gdHJ1ZSwgdXNlUGF0aCA9IHRydWUsIGFwcGVuZCA9ICIiKSB7CiAgY29uc3QgcmVzdWx0ID0gewogICAgc3R5bGU6IG51bGwsCiAgICB1bHRpbWF0ZTogbnVsbAogIH07CiAgaWYgKGxvY2FsKSB7CiAgICBjb25zdCBleHRyYSA9IGFwcGVuZCA/IGAgJHthcHBlbmR9YCA6ICIiOwogICAgZm9yIChjb25zdCBuYW1lIG9mIGxvY2FsKSB7CiAgICAgIHNyYy5wdXNoKGBsb2NhbCgke25hbWV9JHtleHRyYX0pYCk7CiAgICB9CiAgfQogIGlmIChhbGlhcykgewogICAgY29uc3Qgc3Vic3RpdHV0aW9uID0gc3Vic3RpdHV0aW9uTWFwLmdldChhbGlhcyk7CiAgICBjb25zdCBhbGlhc0FwcGVuZCA9IGFwcGVuZCB8fCBnZXRTdHlsZVRvQXBwZW5kKHN0eWxlKTsKICAgIE9iamVjdC5hc3NpZ24ocmVzdWx0LCBnZW5lcmF0ZUZvbnQoc3Vic3RpdHV0aW9uLCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrICYmICFmYWxsYmFjaywgdXNlUGF0aCAmJiAhcGF0aCwgYWxpYXNBcHBlbmQpKTsKICB9CiAgaWYgKHN0eWxlKSB7CiAgICByZXN1bHQuc3R5bGUgPSBzdHlsZTsKICB9CiAgaWYgKHVsdGltYXRlKSB7CiAgICByZXN1bHQudWx0aW1hdGUgPSB1bHRpbWF0ZTsKICB9CiAgaWYgKHVzZUZhbGxiYWNrICYmIGZhbGxiYWNrKSB7CiAgICBjb25zdCBmYWxsYmFja0luZm8gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KGZhbGxiYWNrKTsKICAgIGNvbnN0IHsKICAgICAgdWx0aW1hdGU6IGZhbGxiYWNrVWx0aW1hdGUKICAgIH0gPSBnZW5lcmF0ZUZvbnQoZmFsbGJhY2tJbmZvLCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrLCB1c2VQYXRoICYmICFwYXRoLCBhcHBlbmQpOwogICAgcmVzdWx0LnVsdGltYXRlIHx8PSBmYWxsYmFja1VsdGltYXRlOwogIH0KICBpZiAodXNlUGF0aCAmJiBwYXRoICYmIGxvY2FsRm9udFBhdGgpIHsKICAgIHNyYy5wdXNoKGB1cmwoJHtsb2NhbEZvbnRQYXRofSR7cGF0aH0pYCk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KZnVuY3Rpb24gZ2V0Rm9udFN1YnN0aXR1dGlvbihzeXN0ZW1Gb250Q2FjaGUsIGlkRmFjdG9yeSwgbG9jYWxGb250UGF0aCwgYmFzZUZvbnROYW1lLCBzdGFuZGFyZEZvbnROYW1lLCB0eXBlKSB7CiAgaWYgKGJhc2VGb250TmFtZS5zdGFydHNXaXRoKCJJbnZhbGlkUERGanNGb250XyIpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKCh0eXBlID09PSAiVHJ1ZVR5cGUiIHx8IHR5cGUgPT09ICJUeXBlMSIpICYmIC9eW0EtWl17Nn1cKy8udGVzdChiYXNlRm9udE5hbWUpKSB7CiAgICBiYXNlRm9udE5hbWUgPSBiYXNlRm9udE5hbWUuc2xpY2UoNyk7CiAgfQogIGJhc2VGb250TmFtZSA9IG5vcm1hbGl6ZUZvbnROYW1lKGJhc2VGb250TmFtZSk7CiAgY29uc3Qga2V5ID0gYmFzZUZvbnROYW1lOwogIGxldCBzdWJzdGl0dXRpb25JbmZvID0gc3lzdGVtRm9udENhY2hlLmdldChrZXkpOwogIGlmIChzdWJzdGl0dXRpb25JbmZvKSB7CiAgICByZXR1cm4gc3Vic3RpdHV0aW9uSW5mbzsKICB9CiAgbGV0IHN1YnN0aXR1dGlvbiA9IHN1YnN0aXR1dGlvbk1hcC5nZXQoYmFzZUZvbnROYW1lKTsKICBpZiAoIXN1YnN0aXR1dGlvbikgewogICAgZm9yIChjb25zdCBbYWxpYXMsIHN1YnN0XSBvZiBmb250QWxpYXNlcykgewogICAgICBpZiAoYmFzZUZvbnROYW1lLnN0YXJ0c1dpdGgoYWxpYXMpKSB7CiAgICAgICAgYmFzZUZvbnROYW1lID0gYCR7c3Vic3R9JHtiYXNlRm9udE5hbWUuc3Vic3RyaW5nKGFsaWFzLmxlbmd0aCl9YDsKICAgICAgICBzdWJzdGl0dXRpb24gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KGJhc2VGb250TmFtZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgbGV0IG11c3RBZGRCYXNlRm9udCA9IGZhbHNlOwogIGlmICghc3Vic3RpdHV0aW9uKSB7CiAgICBzdWJzdGl0dXRpb24gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KHN0YW5kYXJkRm9udE5hbWUpOwogICAgbXVzdEFkZEJhc2VGb250ID0gdHJ1ZTsKICB9CiAgY29uc3QgbG9hZGVkTmFtZSA9IGAke2lkRmFjdG9yeS5nZXREb2NJZCgpfV9zJHtpZEZhY3RvcnkuY3JlYXRlRm9udElkKCl9YDsKICBpZiAoIXN1YnN0aXR1dGlvbikgewogICAgaWYgKCF2YWxpZGF0ZUZvbnROYW1lKGJhc2VGb250TmFtZSkpIHsKICAgICAgd2FybihgQ2Fubm90IHN1YnN0aXR1dGUgdGhlIGZvbnQgYmVjYXVzZSBvZiBpdHMgbmFtZTogJHtiYXNlRm9udE5hbWV9YCk7CiAgICAgIHN5c3RlbUZvbnRDYWNoZS5zZXQoa2V5LCBudWxsKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBib2xkID0gL2JvbGQvZ2kudGVzdChiYXNlRm9udE5hbWUpOwogICAgY29uc3QgaXRhbGljID0gL29ibGlxdWV8aXRhbGljL2dpLnRlc3QoYmFzZUZvbnROYW1lKTsKICAgIGNvbnN0IHN0eWxlID0gYm9sZCAmJiBpdGFsaWMgJiYgQk9MRElUQUxJQyB8fCBib2xkICYmIEJPTEQgfHwgaXRhbGljICYmIElUQUxJQyB8fCBOT1JNQUw7CiAgICBzdWJzdGl0dXRpb25JbmZvID0gewogICAgICBjc3M6IGAiJHtnZXRGYW1pbHlOYW1lKGJhc2VGb250TmFtZSl9Iiwke2xvYWRlZE5hbWV9YCwKICAgICAgZ3Vlc3NGYWxsYmFjazogdHJ1ZSwKICAgICAgbG9hZGVkTmFtZSwKICAgICAgYmFzZUZvbnROYW1lLAogICAgICBzcmM6IGBsb2NhbCgke2Jhc2VGb250TmFtZX0pYCwKICAgICAgc3R5bGUKICAgIH07CiAgICBzeXN0ZW1Gb250Q2FjaGUuc2V0KGtleSwgc3Vic3RpdHV0aW9uSW5mbyk7CiAgICByZXR1cm4gc3Vic3RpdHV0aW9uSW5mbzsKICB9CiAgY29uc3Qgc3JjID0gW107CiAgaWYgKG11c3RBZGRCYXNlRm9udCAmJiB2YWxpZGF0ZUZvbnROYW1lKGJhc2VGb250TmFtZSkpIHsKICAgIHNyYy5wdXNoKGBsb2NhbCgke2Jhc2VGb250TmFtZX0pYCk7CiAgfQogIGNvbnN0IHsKICAgIHN0eWxlLAogICAgdWx0aW1hdGUKICB9ID0gZ2VuZXJhdGVGb250KHN1YnN0aXR1dGlvbiwgc3JjLCBsb2NhbEZvbnRQYXRoKTsKICBjb25zdCBndWVzc0ZhbGxiYWNrID0gdWx0aW1hdGUgPT09IG51bGw7CiAgY29uc3QgZmFsbGJhY2sgPSBndWVzc0ZhbGxiYWNrID8gIiIgOiBgLCR7dWx0aW1hdGV9YDsKICBzdWJzdGl0dXRpb25JbmZvID0gewogICAgY3NzOiBgIiR7Z2V0RmFtaWx5TmFtZShiYXNlRm9udE5hbWUpfSIsJHtsb2FkZWROYW1lfSR7ZmFsbGJhY2t9YCwKICAgIGd1ZXNzRmFsbGJhY2ssCiAgICBsb2FkZWROYW1lLAogICAgYmFzZUZvbnROYW1lLAogICAgc3JjOiBzcmMuam9pbigiLCIpLAogICAgc3R5bGUKICB9OwogIHN5c3RlbUZvbnRDYWNoZS5zZXQoa2V5LCBzdWJzdGl0dXRpb25JbmZvKTsKICByZXR1cm4gc3Vic3RpdHV0aW9uSW5mbzsKfQoKOy8vIC4vc3JjL3NoYXJlZC9tdXJtdXJoYXNoMy5qcwpjb25zdCBTRUVEID0gMHhjM2QyZTFmMDsKY29uc3QgTUFTS19ISUdIID0gMHhmZmZmMDAwMDsKY29uc3QgTUFTS19MT1cgPSAweGZmZmY7CmNsYXNzIE11cm11ckhhc2gzXzY0IHsKICBjb25zdHJ1Y3RvcihzZWVkKSB7CiAgICB0aGlzLmgxID0gc2VlZCA/IHNlZWQgJiAweGZmZmZmZmZmIDogU0VFRDsKICAgIHRoaXMuaDIgPSBzZWVkID8gc2VlZCAmIDB4ZmZmZmZmZmYgOiBTRUVEOwogIH0KICB1cGRhdGUoaW5wdXQpIHsKICAgIGxldCBkYXRhLCBsZW5ndGg7CiAgICBpZiAodHlwZW9mIGlucHV0ID09PSAic3RyaW5nIikgewogICAgICBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQubGVuZ3RoICogMik7CiAgICAgIGxlbmd0aCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGlucHV0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBjb2RlID0gaW5wdXQuY2hhckNvZGVBdChpKTsKICAgICAgICBpZiAoY29kZSA8PSAweGZmKSB7CiAgICAgICAgICBkYXRhW2xlbmd0aCsrXSA9IGNvZGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRhdGFbbGVuZ3RoKytdID0gY29kZSA+Pj4gODsKICAgICAgICAgIGRhdGFbbGVuZ3RoKytdID0gY29kZSAmIDB4ZmY7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyhpbnB1dCkpIHsKICAgICAgZGF0YSA9IGlucHV0LnNsaWNlKCk7CiAgICAgIGxlbmd0aCA9IGRhdGEuYnl0ZUxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBkYXRhIGZvcm1hdCwgbXVzdCBiZSBhIHN0cmluZyBvciBUeXBlZEFycmF5LiIpOwogICAgfQogICAgY29uc3QgYmxvY2tDb3VudHMgPSBsZW5ndGggPj4gMjsKICAgIGNvbnN0IHRhaWxMZW5ndGggPSBsZW5ndGggLSBibG9ja0NvdW50cyAqIDQ7CiAgICBjb25zdCBkYXRhVWludDMyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyLCAwLCBibG9ja0NvdW50cyk7CiAgICBsZXQgazEgPSAwLAogICAgICBrMiA9IDA7CiAgICBsZXQgaDEgPSB0aGlzLmgxLAogICAgICBoMiA9IHRoaXMuaDI7CiAgICBjb25zdCBDMSA9IDB4Y2M5ZTJkNTEsCiAgICAgIEMyID0gMHgxYjg3MzU5MzsKICAgIGNvbnN0IEMxX0xPVyA9IEMxICYgTUFTS19MT1csCiAgICAgIEMyX0xPVyA9IEMyICYgTUFTS19MT1c7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrQ291bnRzOyBpKyspIHsKICAgICAgaWYgKGkgJiAxKSB7CiAgICAgICAgazEgPSBkYXRhVWludDMyW2ldOwogICAgICAgIGsxID0gazEgKiBDMSAmIE1BU0tfSElHSCB8IGsxICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgazEgPSBrMSA8PCAxNSB8IGsxID4+PiAxNzsKICAgICAgICBrMSA9IGsxICogQzIgJiBNQVNLX0hJR0ggfCBrMSAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGgxIF49IGsxOwogICAgICAgIGgxID0gaDEgPDwgMTMgfCBoMSA+Pj4gMTk7CiAgICAgICAgaDEgPSBoMSAqIDUgKyAweGU2NTQ2YjY0OwogICAgICB9IGVsc2UgewogICAgICAgIGsyID0gZGF0YVVpbnQzMltpXTsKICAgICAgICBrMiA9IGsyICogQzEgJiBNQVNLX0hJR0ggfCBrMiAqIEMxX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGsyID0gazIgPDwgMTUgfCBrMiA+Pj4gMTc7CiAgICAgICAgazIgPSBrMiAqIEMyICYgTUFTS19ISUdIIHwgazIgKiBDMl9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBoMiBePSBrMjsKICAgICAgICBoMiA9IGgyIDw8IDEzIHwgaDIgPj4+IDE5OwogICAgICAgIGgyID0gaDIgKiA1ICsgMHhlNjU0NmI2NDsKICAgICAgfQogICAgfQogICAgazEgPSAwOwogICAgc3dpdGNoICh0YWlsTGVuZ3RoKSB7CiAgICAgIGNhc2UgMzoKICAgICAgICBrMSBePSBkYXRhW2Jsb2NrQ291bnRzICogNCArIDJdIDw8IDE2OwogICAgICBjYXNlIDI6CiAgICAgICAgazEgXj0gZGF0YVtibG9ja0NvdW50cyAqIDQgKyAxXSA8PCA4OwogICAgICBjYXNlIDE6CiAgICAgICAgazEgXj0gZGF0YVtibG9ja0NvdW50cyAqIDRdOwogICAgICAgIGsxID0gazEgKiBDMSAmIE1BU0tfSElHSCB8IGsxICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgazEgPSBrMSA8PCAxNSB8IGsxID4+PiAxNzsKICAgICAgICBrMSA9IGsxICogQzIgJiBNQVNLX0hJR0ggfCBrMSAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGlmIChibG9ja0NvdW50cyAmIDEpIHsKICAgICAgICAgIGgxIF49IGsxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoMiBePSBrMTsKICAgICAgICB9CiAgICB9CiAgICB0aGlzLmgxID0gaDE7CiAgICB0aGlzLmgyID0gaDI7CiAgfQogIGhleGRpZ2VzdCgpIHsKICAgIGxldCBoMSA9IHRoaXMuaDEsCiAgICAgIGgyID0gdGhpcy5oMjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgaDEgPSBoMSAqIDB4ZWQ1NThjY2QgJiBNQVNLX0hJR0ggfCBoMSAqIDB4OGNjZCAmIE1BU0tfTE9XOwogICAgaDIgPSBoMiAqIDB4ZmY1MWFmZDcgJiBNQVNLX0hJR0ggfCAoKGgyIDw8IDE2IHwgaDEgPj4+IDE2KSAqIDB4YWZkN2VkNTUgJiBNQVNLX0hJR0gpID4+PiAxNjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgaDEgPSBoMSAqIDB4MWE4NWVjNTMgJiBNQVNLX0hJR0ggfCBoMSAqIDB4ZWM1MyAmIE1BU0tfTE9XOwogICAgaDIgPSBoMiAqIDB4YzRjZWI5ZmUgJiBNQVNLX0hJR0ggfCAoKGgyIDw8IDE2IHwgaDEgPj4+IDE2KSAqIDB4YjlmZTFhODUgJiBNQVNLX0hJR0gpID4+PiAxNjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgcmV0dXJuIChoMSA+Pj4gMCkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDgsICIwIikgKyAoaDIgPj4+IDApLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg4LCAiMCIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvaW1hZ2UuanMKCgoKCgoKCgoKCmZ1bmN0aW9uIHJlc2l6ZUltYWdlTWFzayhzcmMsIGJwYywgdzEsIGgxLCB3MiwgaDIpIHsKICBjb25zdCBsZW5ndGggPSB3MiAqIGgyOwogIGxldCBkZXN0OwogIGlmIChicGMgPD0gOCkgewogICAgZGVzdCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgfSBlbHNlIGlmIChicGMgPD0gMTYpIHsKICAgIGRlc3QgPSBuZXcgVWludDE2QXJyYXkobGVuZ3RoKTsKICB9IGVsc2UgewogICAgZGVzdCA9IG5ldyBVaW50MzJBcnJheShsZW5ndGgpOwogIH0KICBjb25zdCB4UmF0aW8gPSB3MSAvIHcyOwogIGNvbnN0IHlSYXRpbyA9IGgxIC8gaDI7CiAgbGV0IGksCiAgICBqLAogICAgcHksCiAgICBuZXdJbmRleCA9IDAsCiAgICBvbGRJbmRleDsKICBjb25zdCB4U2NhbGVkID0gbmV3IFVpbnQxNkFycmF5KHcyKTsKICBjb25zdCB3MVNjYW5saW5lID0gdzE7CiAgZm9yIChpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgIHhTY2FsZWRbaV0gPSBNYXRoLmZsb29yKGkgKiB4UmF0aW8pOwogIH0KICBmb3IgKGkgPSAwOyBpIDwgaDI7IGkrKykgewogICAgcHkgPSBNYXRoLmZsb29yKGkgKiB5UmF0aW8pICogdzFTY2FubGluZTsKICAgIGZvciAoaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgIG9sZEluZGV4ID0gcHkgKyB4U2NhbGVkW2pdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4XTsKICAgIH0KICB9CiAgcmV0dXJuIGRlc3Q7Cn0KY2xhc3MgUERGSW1hZ2UgewogIGNvbnN0cnVjdG9yKHsKICAgIHhyZWYsCiAgICByZXMsCiAgICBpbWFnZSwKICAgIGlzSW5saW5lID0gZmFsc2UsCiAgICBzbWFzayA9IG51bGwsCiAgICBtYXNrID0gbnVsbCwKICAgIGlzTWFzayA9IGZhbHNlLAogICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICB9KSB7CiAgICB0aGlzLmltYWdlID0gaW1hZ2U7CiAgICBjb25zdCBkaWN0ID0gaW1hZ2UuZGljdDsKICAgIGNvbnN0IGZpbHRlciA9IGRpY3QuZ2V0KCJGIiwgIkZpbHRlciIpOwogICAgbGV0IGZpbHRlck5hbWU7CiAgICBpZiAoZmlsdGVyIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBmaWx0ZXJOYW1lID0gZmlsdGVyLm5hbWU7CiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkgewogICAgICBjb25zdCBmaWx0ZXJaZXJvID0geHJlZi5mZXRjaElmUmVmKGZpbHRlclswXSk7CiAgICAgIGlmIChmaWx0ZXJaZXJvIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGZpbHRlck5hbWUgPSBmaWx0ZXJaZXJvLm5hbWU7CiAgICAgIH0KICAgIH0KICAgIHN3aXRjaCAoZmlsdGVyTmFtZSkgewogICAgICBjYXNlICJKUFhEZWNvZGUiOgogICAgICAgICh7CiAgICAgICAgICB3aWR0aDogaW1hZ2Uud2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGltYWdlLmhlaWdodCwKICAgICAgICAgIGNvbXBvbmVudHNDb3VudDogaW1hZ2UubnVtQ29tcHMsCiAgICAgICAgICBiaXRzUGVyQ29tcG9uZW50OiBpbWFnZS5iaXRzUGVyQ29tcG9uZW50CiAgICAgICAgfSA9IEpweEltYWdlLnBhcnNlSW1hZ2VQcm9wZXJ0aWVzKGltYWdlLnN0cmVhbSkpOwogICAgICAgIGltYWdlLnN0cmVhbS5yZXNldCgpOwogICAgICAgIGNvbnN0IHJlZHVjZVBvd2VyID0gSW1hZ2VSZXNpemVyLmdldFJlZHVjZVBvd2VyRm9ySlBYKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLm51bUNvbXBzKTsKICAgICAgICB0aGlzLmpweERlY29kZXJPcHRpb25zID0gewogICAgICAgICAgbnVtQ29tcG9uZW50czogMCwKICAgICAgICAgIGlzSW5kZXhlZENvbG9ybWFwOiBmYWxzZSwKICAgICAgICAgIHNtYXNrSW5EYXRhOiBkaWN0LmhhcygiU01hc2tJbkRhdGEiKSwKICAgICAgICAgIHJlZHVjZVBvd2VyCiAgICAgICAgfTsKICAgICAgICBpZiAocmVkdWNlUG93ZXIpIHsKICAgICAgICAgIGNvbnN0IGZhY3RvciA9IDIgKiogcmVkdWNlUG93ZXI7CiAgICAgICAgICBpbWFnZS53aWR0aCA9IE1hdGguY2VpbChpbWFnZS53aWR0aCAvIGZhY3Rvcik7CiAgICAgICAgICBpbWFnZS5oZWlnaHQgPSBNYXRoLmNlaWwoaW1hZ2UuaGVpZ2h0IC8gZmFjdG9yKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkpCSUcyRGVjb2RlIjoKICAgICAgICBpbWFnZS5iaXRzUGVyQ29tcG9uZW50ID0gMTsKICAgICAgICBpbWFnZS5udW1Db21wcyA9IDE7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBsZXQgd2lkdGggPSBkaWN0LmdldCgiVyIsICJXaWR0aCIpOwogICAgbGV0IGhlaWdodCA9IGRpY3QuZ2V0KCJIIiwgIkhlaWdodCIpOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIoaW1hZ2Uud2lkdGgpICYmIGltYWdlLndpZHRoID4gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKGltYWdlLmhlaWdodCkgJiYgaW1hZ2UuaGVpZ2h0ID4gMCAmJiAoaW1hZ2Uud2lkdGggIT09IHdpZHRoIHx8IGltYWdlLmhlaWdodCAhPT0gaGVpZ2h0KSkgewogICAgICB3YXJuKCJQREZJbWFnZSAtIHVzaW5nIHRoZSBXaWR0aC9IZWlnaHQgb2YgdGhlIGltYWdlIGRhdGEsICIgKyAicmF0aGVyIHRoYW4gdGhlIGltYWdlIGRpY3Rpb25hcnkuIik7CiAgICAgIHdpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgIGhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHZhbGlkV2lkdGggPSB0eXBlb2Ygd2lkdGggPT09ICJudW1iZXIiICYmIHdpZHRoID4gMCwKICAgICAgICB2YWxpZEhlaWdodCA9IHR5cGVvZiBoZWlnaHQgPT09ICJudW1iZXIiICYmIGhlaWdodCA+IDA7CiAgICAgIGlmICghdmFsaWRXaWR0aCB8fCAhdmFsaWRIZWlnaHQpIHsKICAgICAgICBpZiAoIWltYWdlLmZhbGxiYWNrRGltcykgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGltYWdlIHdpZHRoOiAke3dpZHRofSBvciBoZWlnaHQ6ICR7aGVpZ2h0fWApOwogICAgICAgIH0KICAgICAgICB3YXJuKCJQREZJbWFnZSAtIHVzaW5nIHRoZSBXaWR0aC9IZWlnaHQgb2YgdGhlIHBhcmVudCBpbWFnZSwgZm9yIFNNYXNrL01hc2sgZGF0YS4iKTsKICAgICAgICBpZiAoIXZhbGlkV2lkdGgpIHsKICAgICAgICAgIHdpZHRoID0gaW1hZ2UuZmFsbGJhY2tEaW1zLndpZHRoOwogICAgICAgIH0KICAgICAgICBpZiAoIXZhbGlkSGVpZ2h0KSB7CiAgICAgICAgICBoZWlnaHQgPSBpbWFnZS5mYWxsYmFja0RpbXMuaGVpZ2h0OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICB0aGlzLmludGVycG9sYXRlID0gZGljdC5nZXQoIkkiLCAiSW50ZXJwb2xhdGUiKTsKICAgIHRoaXMuaW1hZ2VNYXNrID0gZGljdC5nZXQoIklNIiwgIkltYWdlTWFzayIpIHx8IGZhbHNlOwogICAgdGhpcy5tYXR0ZSA9IGRpY3QuZ2V0KCJNYXR0ZSIpIHx8IGZhbHNlOwogICAgbGV0IGJpdHNQZXJDb21wb25lbnQgPSBpbWFnZS5iaXRzUGVyQ29tcG9uZW50OwogICAgaWYgKCFiaXRzUGVyQ29tcG9uZW50KSB7CiAgICAgIGJpdHNQZXJDb21wb25lbnQgPSBkaWN0LmdldCgiQlBDIiwgIkJpdHNQZXJDb21wb25lbnQiKTsKICAgICAgaWYgKCFiaXRzUGVyQ29tcG9uZW50KSB7CiAgICAgICAgaWYgKHRoaXMuaW1hZ2VNYXNrKSB7CiAgICAgICAgICBiaXRzUGVyQ29tcG9uZW50ID0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBCaXRzIHBlciBjb21wb25lbnQgbWlzc2luZyBpbiBpbWFnZTogJHt0aGlzLmltYWdlTWFza31gKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuYnBjID0gYml0c1BlckNvbXBvbmVudDsKICAgIGlmICghdGhpcy5pbWFnZU1hc2spIHsKICAgICAgbGV0IGNvbG9yU3BhY2UgPSBkaWN0LmdldFJhdygiQ1MiKSB8fCBkaWN0LmdldFJhdygiQ29sb3JTcGFjZSIpOwogICAgICBjb25zdCBoYXNDb2xvclNwYWNlID0gISFjb2xvclNwYWNlOwogICAgICBpZiAoIWhhc0NvbG9yU3BhY2UpIHsKICAgICAgICBpZiAodGhpcy5qcHhEZWNvZGVyT3B0aW9ucykgewogICAgICAgICAgY29sb3JTcGFjZSA9IE5hbWUuZ2V0KCJEZXZpY2VSR0JBIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN3aXRjaCAoaW1hZ2UubnVtQ29tcHMpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlR3JheSIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgY29sb3JTcGFjZSA9IE5hbWUuZ2V0KCJEZXZpY2VSR0IiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlQ01ZSyIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW1hZ2VzIHdpdGggJHtpbWFnZS5udW1Db21wc30gY29sb3IgY29tcG9uZW50cyBub3Qgc3VwcG9ydGVkLmApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aGlzLmpweERlY29kZXJPcHRpb25zPy5zbWFza0luRGF0YSkgewogICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlUkdCQSIpOwogICAgICB9CiAgICAgIHRoaXMuY29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5wYXJzZSh7CiAgICAgICAgY3M6IGNvbG9yU3BhY2UsCiAgICAgICAgeHJlZiwKICAgICAgICByZXNvdXJjZXM6IGlzSW5saW5lID8gcmVzIDogbnVsbCwKICAgICAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgIH0pOwogICAgICB0aGlzLm51bUNvbXBzID0gdGhpcy5jb2xvclNwYWNlLm51bUNvbXBzOwogICAgICBpZiAodGhpcy5qcHhEZWNvZGVyT3B0aW9ucykgewogICAgICAgIHRoaXMuanB4RGVjb2Rlck9wdGlvbnMubnVtQ29tcG9uZW50cyA9IGhhc0NvbG9yU3BhY2UgPyB0aGlzLm51bUNvbXBzIDogMDsKICAgICAgICB0aGlzLmpweERlY29kZXJPcHRpb25zLmlzSW5kZXhlZENvbG9ybWFwID0gdGhpcy5jb2xvclNwYWNlLm5hbWUgPT09ICJJbmRleGVkIjsKICAgICAgfQogICAgfQogICAgdGhpcy5kZWNvZGUgPSBkaWN0LmdldEFycmF5KCJEIiwgIkRlY29kZSIpOwogICAgdGhpcy5uZWVkc0RlY29kZSA9IGZhbHNlOwogICAgaWYgKHRoaXMuZGVjb2RlICYmICh0aGlzLmNvbG9yU3BhY2UgJiYgIXRoaXMuY29sb3JTcGFjZS5pc0RlZmF1bHREZWNvZGUodGhpcy5kZWNvZGUsIGJpdHNQZXJDb21wb25lbnQpIHx8IGlzTWFzayAmJiAhQ29sb3JTcGFjZS5pc0RlZmF1bHREZWNvZGUodGhpcy5kZWNvZGUsIDEpKSkgewogICAgICB0aGlzLm5lZWRzRGVjb2RlID0gdHJ1ZTsKICAgICAgY29uc3QgbWF4ID0gKDEgPDwgYml0c1BlckNvbXBvbmVudCkgLSAxOwogICAgICB0aGlzLmRlY29kZUNvZWZmaWNpZW50cyA9IFtdOwogICAgICB0aGlzLmRlY29kZUFkZGVuZHMgPSBbXTsKICAgICAgY29uc3QgaXNJbmRleGVkID0gdGhpcy5jb2xvclNwYWNlPy5uYW1lID09PSAiSW5kZXhlZCI7CiAgICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IHRoaXMuZGVjb2RlLmxlbmd0aDsgaSArPSAyLCArK2opIHsKICAgICAgICBjb25zdCBkbWluID0gdGhpcy5kZWNvZGVbaV07CiAgICAgICAgY29uc3QgZG1heCA9IHRoaXMuZGVjb2RlW2kgKyAxXTsKICAgICAgICB0aGlzLmRlY29kZUNvZWZmaWNpZW50c1tqXSA9IGlzSW5kZXhlZCA/IChkbWF4IC0gZG1pbikgLyBtYXggOiBkbWF4IC0gZG1pbjsKICAgICAgICB0aGlzLmRlY29kZUFkZGVuZHNbal0gPSBpc0luZGV4ZWQgPyBkbWluIDogbWF4ICogZG1pbjsKICAgICAgfQogICAgfQogICAgaWYgKHNtYXNrKSB7CiAgICAgIHNtYXNrLmZhbGxiYWNrRGltcyA/Pz0gewogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodAogICAgICB9OwogICAgICB0aGlzLnNtYXNrID0gbmV3IFBERkltYWdlKHsKICAgICAgICB4cmVmLAogICAgICAgIHJlcywKICAgICAgICBpbWFnZTogc21hc2ssCiAgICAgICAgaXNJbmxpbmUsCiAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAobWFzaykgewogICAgICBpZiAobWFzayBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBjb25zdCBtYXNrRGljdCA9IG1hc2suZGljdCwKICAgICAgICAgIGltYWdlTWFzayA9IG1hc2tEaWN0LmdldCgiSU0iLCAiSW1hZ2VNYXNrIik7CiAgICAgICAgaWYgKCFpbWFnZU1hc2spIHsKICAgICAgICAgIHdhcm4oIklnbm9yaW5nIC9NYXNrIGluIGltYWdlIHdpdGhvdXQgL0ltYWdlTWFzay4iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWFzay5mYWxsYmFja0RpbXMgPz89IHsKICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgIGhlaWdodAogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMubWFzayA9IG5ldyBQREZJbWFnZSh7CiAgICAgICAgICAgIHhyZWYsCiAgICAgICAgICAgIHJlcywKICAgICAgICAgICAgaW1hZ2U6IG1hc2ssCiAgICAgICAgICAgIGlzSW5saW5lLAogICAgICAgICAgICBpc01hc2s6IHRydWUsCiAgICAgICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubWFzayA9IG1hc2s7CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGFzeW5jIGJ1aWxkSW1hZ2UoewogICAgeHJlZiwKICAgIHJlcywKICAgIGltYWdlLAogICAgaXNJbmxpbmUgPSBmYWxzZSwKICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgfSkgewogICAgY29uc3QgaW1hZ2VEYXRhID0gaW1hZ2U7CiAgICBsZXQgc21hc2tEYXRhID0gbnVsbDsKICAgIGxldCBtYXNrRGF0YSA9IG51bGw7CiAgICBjb25zdCBzbWFzayA9IGltYWdlLmRpY3QuZ2V0KCJTTWFzayIpOwogICAgY29uc3QgbWFzayA9IGltYWdlLmRpY3QuZ2V0KCJNYXNrIik7CiAgICBpZiAoc21hc2spIHsKICAgICAgaWYgKHNtYXNrIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIHNtYXNrRGF0YSA9IHNtYXNrOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oIlVuc3VwcG9ydGVkIC9TTWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobWFzaykgewogICAgICBpZiAobWFzayBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gfHwgQXJyYXkuaXNBcnJheShtYXNrKSkgewogICAgICAgIG1hc2tEYXRhID0gbWFzazsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCAvTWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgUERGSW1hZ2UoewogICAgICB4cmVmLAogICAgICByZXMsCiAgICAgIGltYWdlOiBpbWFnZURhdGEsCiAgICAgIGlzSW5saW5lLAogICAgICBzbWFzazogc21hc2tEYXRhLAogICAgICBtYXNrOiBtYXNrRGF0YSwKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU1hc2soewogICAgaW1hZ2UsCiAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IGZhbHNlCiAgfSkgewogICAgY29uc3QgewogICAgICBkaWN0CiAgICB9ID0gaW1hZ2U7CiAgICBjb25zdCB3aWR0aCA9IGRpY3QuZ2V0KCJXIiwgIldpZHRoIik7CiAgICBjb25zdCBoZWlnaHQgPSBkaWN0LmdldCgiSCIsICJIZWlnaHQiKTsKICAgIGNvbnN0IGludGVycG9sYXRlID0gZGljdC5nZXQoIkkiLCAiSW50ZXJwb2xhdGUiKTsKICAgIGNvbnN0IGRlY29kZSA9IGRpY3QuZ2V0QXJyYXkoIkQiLCAiRGVjb2RlIik7CiAgICBjb25zdCBpbnZlcnNlRGVjb2RlID0gZGVjb2RlPy5bMF0gPiAwOwogICAgY29uc3QgY29tcHV0ZWRMZW5ndGggPSAod2lkdGggKyA3ID4+IDMpICogaGVpZ2h0OwogICAgY29uc3QgaW1nQXJyYXkgPSBpbWFnZS5nZXRCeXRlcyhjb21wdXRlZExlbmd0aCk7CiAgICBjb25zdCBpc1NpbmdsZU9wYXF1ZVBpeGVsID0gd2lkdGggPT09IDEgJiYgaGVpZ2h0ID09PSAxICYmIGludmVyc2VEZWNvZGUgPT09IChpbWdBcnJheS5sZW5ndGggPT09IDAgfHwgISEoaW1nQXJyYXlbMF0gJiAxMjgpKTsKICAgIGlmIChpc1NpbmdsZU9wYXF1ZVBpeGVsKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaXNTaW5nbGVPcGFxdWVQaXhlbAogICAgICB9OwogICAgfQogICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgIGlmIChJbWFnZVJlc2l6ZXIubmVlZHNUb0JlUmVzaXplZCh3aWR0aCwgaGVpZ2h0KSkgewogICAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQgKiA0KTsKICAgICAgICBjb252ZXJ0QmxhY2tBbmRXaGl0ZVRvUkdCQSh7CiAgICAgICAgICBzcmM6IGltZ0FycmF5LAogICAgICAgICAgZGVzdDogZGF0YSwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgbm9uQmxhY2tDb2xvcjogMCwKICAgICAgICAgIGludmVyc2VEZWNvZGUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gSW1hZ2VSZXNpemVyLmNyZWF0ZUltYWdlKHsKICAgICAgICAgIGtpbmQ6IEltYWdlS2luZC5SR0JBXzMyQlBQLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgaW50ZXJwb2xhdGUKICAgICAgICB9KTsKICAgICAgfQogICAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY29uc3QgaW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnZlcnRCbGFja0FuZFdoaXRlVG9SR0JBKHsKICAgICAgICBzcmM6IGltZ0FycmF5LAogICAgICAgIGRlc3Q6IGltZ0RhdGEuZGF0YSwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgbm9uQmxhY2tDb2xvcjogMCwKICAgICAgICBpbnZlcnNlRGVjb2RlCiAgICAgIH0pOwogICAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApOwogICAgICBjb25zdCBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGF0YTogbnVsbCwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaW50ZXJwb2xhdGUsCiAgICAgICAgYml0bWFwCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBhY3R1YWxMZW5ndGggPSBpbWdBcnJheS5ieXRlTGVuZ3RoOwogICAgY29uc3QgaGF2ZUZ1bGxEYXRhID0gY29tcHV0ZWRMZW5ndGggPT09IGFjdHVhbExlbmd0aDsKICAgIGxldCBkYXRhOwogICAgaWYgKGltYWdlIGluc3RhbmNlb2YgRGVjb2RlU3RyZWFtICYmICghaW52ZXJzZURlY29kZSB8fCBoYXZlRnVsbERhdGEpKSB7CiAgICAgIGRhdGEgPSBpbWdBcnJheTsKICAgIH0gZWxzZSBpZiAoIWludmVyc2VEZWNvZGUpIHsKICAgICAgZGF0YSA9IG5ldyBVaW50OEFycmF5KGltZ0FycmF5KTsKICAgIH0gZWxzZSB7CiAgICAgIGRhdGEgPSBuZXcgVWludDhBcnJheShjb21wdXRlZExlbmd0aCk7CiAgICAgIGRhdGEuc2V0KGltZ0FycmF5KTsKICAgICAgZGF0YS5maWxsKDB4ZmYsIGFjdHVhbExlbmd0aCk7CiAgICB9CiAgICBpZiAoaW52ZXJzZURlY29kZSkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFjdHVhbExlbmd0aDsgaSsrKSB7CiAgICAgICAgZGF0YVtpXSBePSAweGZmOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBkYXRhLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBpbnRlcnBvbGF0ZQogICAgfTsKICB9CiAgZ2V0IGRyYXdXaWR0aCgpIHsKICAgIHJldHVybiBNYXRoLm1heCh0aGlzLndpZHRoLCB0aGlzLnNtYXNrPy53aWR0aCB8fCAwLCB0aGlzLm1hc2s/LndpZHRoIHx8IDApOwogIH0KICBnZXQgZHJhd0hlaWdodCgpIHsKICAgIHJldHVybiBNYXRoLm1heCh0aGlzLmhlaWdodCwgdGhpcy5zbWFzaz8uaGVpZ2h0IHx8IDAsIHRoaXMubWFzaz8uaGVpZ2h0IHx8IDApOwogIH0KICBkZWNvZGVCdWZmZXIoYnVmZmVyKSB7CiAgICBjb25zdCBicGMgPSB0aGlzLmJwYzsKICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgIGNvbnN0IGRlY29kZUFkZGVuZHMgPSB0aGlzLmRlY29kZUFkZGVuZHM7CiAgICBjb25zdCBkZWNvZGVDb2VmZmljaWVudHMgPSB0aGlzLmRlY29kZUNvZWZmaWNpZW50czsKICAgIGNvbnN0IG1heCA9ICgxIDw8IGJwYykgLSAxOwogICAgbGV0IGksIGlpOwogICAgaWYgKGJwYyA9PT0gMSkgewogICAgICBmb3IgKGkgPSAwLCBpaSA9IGJ1ZmZlci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgYnVmZmVyW2ldID0gKyFidWZmZXJbaV07CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGluZGV4ID0gMDsKICAgIGZvciAoaSA9IDAsIGlpID0gdGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0OyBpIDwgaWk7IGkrKykgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG51bUNvbXBzOyBqKyspIHsKICAgICAgICBidWZmZXJbaW5kZXhdID0gTWF0aENsYW1wKGRlY29kZUFkZGVuZHNbal0gKyBidWZmZXJbaW5kZXhdICogZGVjb2RlQ29lZmZpY2llbnRzW2pdLCAwLCBtYXgpOwogICAgICAgIGluZGV4Kys7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0Q29tcG9uZW50cyhidWZmZXIpIHsKICAgIGNvbnN0IGJwYyA9IHRoaXMuYnBjOwogICAgaWYgKGJwYyA9PT0gOCkgewogICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoOwogICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBsZW5ndGggPSB3aWR0aCAqIGhlaWdodCAqIG51bUNvbXBzOwogICAgbGV0IGJ1ZmZlclBvcyA9IDA7CiAgICBsZXQgb3V0cHV0OwogICAgaWYgKGJwYyA8PSA4KSB7CiAgICAgIG91dHB1dCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICB9IGVsc2UgaWYgKGJwYyA8PSAxNikgewogICAgICBvdXRwdXQgPSBuZXcgVWludDE2QXJyYXkobGVuZ3RoKTsKICAgIH0gZWxzZSB7CiAgICAgIG91dHB1dCA9IG5ldyBVaW50MzJBcnJheShsZW5ndGgpOwogICAgfQogICAgY29uc3Qgcm93Q29tcHMgPSB3aWR0aCAqIG51bUNvbXBzOwogICAgY29uc3QgbWF4ID0gKDEgPDwgYnBjKSAtIDE7CiAgICBsZXQgaSA9IDAsCiAgICAgIGlpLAogICAgICBidWY7CiAgICBpZiAoYnBjID09PSAxKSB7CiAgICAgIGxldCBtYXNrLCBsb29wMUVuZCwgbG9vcDJFbmQ7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaGVpZ2h0OyBqKyspIHsKICAgICAgICBsb29wMUVuZCA9IGkgKyAocm93Q29tcHMgJiB+Nyk7CiAgICAgICAgbG9vcDJFbmQgPSBpICsgcm93Q29tcHM7CiAgICAgICAgd2hpbGUgKGkgPCBsb29wMUVuZCkgewogICAgICAgICAgYnVmID0gYnVmZmVyW2J1ZmZlclBvcysrXTsKICAgICAgICAgIG91dHB1dFtpXSA9IGJ1ZiA+PiA3ICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgMV0gPSBidWYgPj4gNiAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDJdID0gYnVmID4+IDUgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyAzXSA9IGJ1ZiA+PiA0ICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgNF0gPSBidWYgPj4gMyAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDVdID0gYnVmID4+IDIgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyA2XSA9IGJ1ZiA+PiAxICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgN10gPSBidWYgJiAxOwogICAgICAgICAgaSArPSA4OwogICAgICAgIH0KICAgICAgICBpZiAoaSA8IGxvb3AyRW5kKSB7CiAgICAgICAgICBidWYgPSBidWZmZXJbYnVmZmVyUG9zKytdOwogICAgICAgICAgbWFzayA9IDEyODsKICAgICAgICAgIHdoaWxlIChpIDwgbG9vcDJFbmQpIHsKICAgICAgICAgICAgb3V0cHV0W2krK10gPSArISEoYnVmICYgbWFzayk7CiAgICAgICAgICAgIG1hc2sgPj49IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsZXQgYml0cyA9IDA7CiAgICAgIGJ1ZiA9IDA7CiAgICAgIGZvciAoaSA9IDAsIGlpID0gbGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgIGlmIChpICUgcm93Q29tcHMgPT09IDApIHsKICAgICAgICAgIGJ1ZiA9IDA7CiAgICAgICAgICBiaXRzID0gMDsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKGJpdHMgPCBicGMpIHsKICAgICAgICAgIGJ1ZiA9IGJ1ZiA8PCA4IHwgYnVmZmVyW2J1ZmZlclBvcysrXTsKICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICB9CiAgICAgICAgY29uc3QgcmVtYWluaW5nQml0cyA9IGJpdHMgLSBicGM7CiAgICAgICAgbGV0IHZhbHVlID0gYnVmID4+IHJlbWFpbmluZ0JpdHM7CiAgICAgICAgaWYgKHZhbHVlIDwgMCkgewogICAgICAgICAgdmFsdWUgPSAwOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBtYXgpIHsKICAgICAgICAgIHZhbHVlID0gbWF4OwogICAgICAgIH0KICAgICAgICBvdXRwdXRbaV0gPSB2YWx1ZTsKICAgICAgICBidWYgJj0gKDEgPDwgcmVtYWluaW5nQml0cykgLSAxOwogICAgICAgIGJpdHMgPSByZW1haW5pbmdCaXRzOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBhc3luYyBmaWxsT3BhY2l0eShyZ2JhQnVmLCB3aWR0aCwgaGVpZ2h0LCBhY3R1YWxIZWlnaHQsIGltYWdlKSB7CiAgICBjb25zdCBzbWFzayA9IHRoaXMuc21hc2s7CiAgICBjb25zdCBtYXNrID0gdGhpcy5tYXNrOwogICAgbGV0IGFscGhhQnVmLCBzdywgc2gsIGksIGlpLCBqOwogICAgaWYgKHNtYXNrKSB7CiAgICAgIHN3ID0gc21hc2sud2lkdGg7CiAgICAgIHNoID0gc21hc2suaGVpZ2h0OwogICAgICBhbHBoYUJ1ZiA9IG5ldyBVaW50OENsYW1wZWRBcnJheShzdyAqIHNoKTsKICAgICAgYXdhaXQgc21hc2suZmlsbEdyYXlCdWZmZXIoYWxwaGFCdWYpOwogICAgICBpZiAoc3cgIT09IHdpZHRoIHx8IHNoICE9PSBoZWlnaHQpIHsKICAgICAgICBhbHBoYUJ1ZiA9IHJlc2l6ZUltYWdlTWFzayhhbHBoYUJ1Ziwgc21hc2suYnBjLCBzdywgc2gsIHdpZHRoLCBoZWlnaHQpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKG1hc2spIHsKICAgICAgaWYgKG1hc2sgaW5zdGFuY2VvZiBQREZJbWFnZSkgewogICAgICAgIHN3ID0gbWFzay53aWR0aDsKICAgICAgICBzaCA9IG1hc2suaGVpZ2h0OwogICAgICAgIGFscGhhQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHN3ICogc2gpOwogICAgICAgIG1hc2subnVtQ29tcHMgPSAxOwogICAgICAgIGF3YWl0IG1hc2suZmlsbEdyYXlCdWZmZXIoYWxwaGFCdWYpOwogICAgICAgIGZvciAoaSA9IDAsIGlpID0gc3cgKiBzaDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgIGFscGhhQnVmW2ldID0gMjU1IC0gYWxwaGFCdWZbaV07CiAgICAgICAgfQogICAgICAgIGlmIChzdyAhPT0gd2lkdGggfHwgc2ggIT09IGhlaWdodCkgewogICAgICAgICAgYWxwaGFCdWYgPSByZXNpemVJbWFnZU1hc2soYWxwaGFCdWYsIG1hc2suYnBjLCBzdywgc2gsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG1hc2spKSB7CiAgICAgICAgYWxwaGFCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwogICAgICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHdpZHRoICogaGVpZ2h0OyBpIDwgaWk7ICsraSkgewogICAgICAgICAgbGV0IG9wYWNpdHkgPSAwOwogICAgICAgICAgY29uc3QgaW1hZ2VPZmZzZXQgPSBpICogbnVtQ29tcHM7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbnVtQ29tcHM7ICsraikgewogICAgICAgICAgICBjb25zdCBjb2xvciA9IGltYWdlW2ltYWdlT2Zmc2V0ICsgal07CiAgICAgICAgICAgIGNvbnN0IG1hc2tPZmZzZXQgPSBqICogMjsKICAgICAgICAgICAgaWYgKGNvbG9yIDwgbWFza1ttYXNrT2Zmc2V0XSB8fCBjb2xvciA+IG1hc2tbbWFza09mZnNldCArIDFdKSB7CiAgICAgICAgICAgICAgb3BhY2l0eSA9IDI1NTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYWxwaGFCdWZbaV0gPSBvcGFjaXR5OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gbWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0KICAgIGlmIChhbHBoYUJ1ZikgewogICAgICBmb3IgKGkgPSAwLCBqID0gMywgaWkgPSB3aWR0aCAqIGFjdHVhbEhlaWdodDsgaSA8IGlpOyArK2ksIGogKz0gNCkgewogICAgICAgIHJnYmFCdWZbal0gPSBhbHBoYUJ1ZltpXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yIChpID0gMCwgaiA9IDMsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgKytpLCBqICs9IDQpIHsKICAgICAgICByZ2JhQnVmW2pdID0gMjU1OwogICAgICB9CiAgICB9CiAgfQogIHVuZG9QcmVibGVuZChidWZmZXIsIHdpZHRoLCBoZWlnaHQpIHsKICAgIGNvbnN0IG1hdHRlID0gdGhpcy5zbWFzaz8ubWF0dGU7CiAgICBpZiAoIW1hdHRlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1hdHRlUmdiID0gdGhpcy5jb2xvclNwYWNlLmdldFJnYihtYXR0ZSwgMCk7CiAgICBjb25zdCBtYXR0ZVIgPSBtYXR0ZVJnYlswXTsKICAgIGNvbnN0IG1hdHRlRyA9IG1hdHRlUmdiWzFdOwogICAgY29uc3QgbWF0dGVCID0gbWF0dGVSZ2JbMl07CiAgICBjb25zdCBsZW5ndGggPSB3aWR0aCAqIGhlaWdodCAqIDQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSA0KSB7CiAgICAgIGNvbnN0IGFscGhhID0gYnVmZmVyW2kgKyAzXTsKICAgICAgaWYgKGFscGhhID09PSAwKSB7CiAgICAgICAgYnVmZmVyW2ldID0gMjU1OwogICAgICAgIGJ1ZmZlcltpICsgMV0gPSAyNTU7CiAgICAgICAgYnVmZmVyW2kgKyAyXSA9IDI1NTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBrID0gMjU1IC8gYWxwaGE7CiAgICAgIGJ1ZmZlcltpXSA9IChidWZmZXJbaV0gLSBtYXR0ZVIpICogayArIG1hdHRlUjsKICAgICAgYnVmZmVyW2kgKyAxXSA9IChidWZmZXJbaSArIDFdIC0gbWF0dGVHKSAqIGsgKyBtYXR0ZUc7CiAgICAgIGJ1ZmZlcltpICsgMl0gPSAoYnVmZmVyW2kgKyAyXSAtIG1hdHRlQikgKiBrICsgbWF0dGVCOwogICAgfQogIH0KICBhc3luYyBjcmVhdGVJbWFnZURhdGEoZm9yY2VSR0JBID0gZmFsc2UsIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID0gZmFsc2UpIHsKICAgIGNvbnN0IGRyYXdXaWR0aCA9IHRoaXMuZHJhd1dpZHRoOwogICAgY29uc3QgZHJhd0hlaWdodCA9IHRoaXMuZHJhd0hlaWdodDsKICAgIGNvbnN0IGltZ0RhdGEgPSB7CiAgICAgIHdpZHRoOiBkcmF3V2lkdGgsCiAgICAgIGhlaWdodDogZHJhd0hlaWdodCwKICAgICAgaW50ZXJwb2xhdGU6IHRoaXMuaW50ZXJwb2xhdGUsCiAgICAgIGtpbmQ6IDAsCiAgICAgIGRhdGE6IG51bGwKICAgIH07CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBvcmlnaW5hbFdpZHRoID0gdGhpcy53aWR0aDsKICAgIGNvbnN0IG9yaWdpbmFsSGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICBjb25zdCBicGMgPSB0aGlzLmJwYzsKICAgIGNvbnN0IHJvd0J5dGVzID0gb3JpZ2luYWxXaWR0aCAqIG51bUNvbXBzICogYnBjICsgNyA+PiAzOwogICAgY29uc3QgbXVzdEJlUmVzaXplZCA9IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkICYmIEltYWdlUmVzaXplci5uZWVkc1RvQmVSZXNpemVkKGRyYXdXaWR0aCwgZHJhd0hlaWdodCk7CiAgICBpZiAoIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzayAmJiB0aGlzLmNvbG9yU3BhY2UubmFtZSA9PT0gIkRldmljZVJHQkEiKSB7CiAgICAgIGltZ0RhdGEua2luZCA9IEltYWdlS2luZC5SR0JBXzMyQlBQOwogICAgICBjb25zdCBpbWdBcnJheSA9IGltZ0RhdGEuZGF0YSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIG9yaWdpbmFsV2lkdGggKiA0LCB7fSk7CiAgICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICAgIGlmICghbXVzdEJlUmVzaXplZCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQml0bWFwKEltYWdlS2luZC5SR0JBXzMyQlBQLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGltZ0FycmF5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhLCBmYWxzZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGltZ0RhdGE7CiAgICB9CiAgICBpZiAoIWZvcmNlUkdCQSkgewogICAgICBsZXQga2luZDsKICAgICAgaWYgKHRoaXMuY29sb3JTcGFjZS5uYW1lID09PSAiRGV2aWNlR3JheSIgJiYgYnBjID09PSAxKSB7CiAgICAgICAga2luZCA9IEltYWdlS2luZC5HUkFZU0NBTEVfMUJQUDsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbG9yU3BhY2UubmFtZSA9PT0gIkRldmljZVJHQiIgJiYgYnBjID09PSA4ICYmICF0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAga2luZCA9IEltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgIH0KICAgICAgaWYgKGtpbmQgJiYgIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzayAmJiBkcmF3V2lkdGggPT09IG9yaWdpbmFsV2lkdGggJiYgZHJhd0hlaWdodCA9PT0gb3JpZ2luYWxIZWlnaHQpIHsKICAgICAgICBjb25zdCBpbWFnZSA9IGF3YWl0IHRoaXMuI2dldEltYWdlKG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0KTsKICAgICAgICBpZiAoaW1hZ2UpIHsKICAgICAgICAgIHJldHVybiBpbWFnZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzLCB7fSk7CiAgICAgICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgICBpZiAobXVzdEJlUmVzaXplZCkgewogICAgICAgICAgICByZXR1cm4gSW1hZ2VSZXNpemVyLmNyZWF0ZUltYWdlKHsKICAgICAgICAgICAgICBkYXRhLAogICAgICAgICAgICAgIGtpbmQsCiAgICAgICAgICAgICAgd2lkdGg6IGRyYXdXaWR0aCwKICAgICAgICAgICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgICAgICAgICAgaW50ZXJwb2xhdGU6IHRoaXMuaW50ZXJwb2xhdGUKICAgICAgICAgICAgfSwgdGhpcy5uZWVkc0RlY29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVCaXRtYXAoa2luZCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIGRhdGEpOwogICAgICAgIH0KICAgICAgICBpbWdEYXRhLmtpbmQgPSBraW5kOwogICAgICAgIGltZ0RhdGEuZGF0YSA9IGRhdGE7CiAgICAgICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgICAgIGFzc2VydChraW5kID09PSBJbWFnZUtpbmQuR1JBWVNDQUxFXzFCUFAsICJQREZJbWFnZS5jcmVhdGVJbWFnZURhdGE6IFRoZSBpbWFnZSBtdXN0IGJlIGdyYXlzY2FsZS4iKTsKICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IGltZ0RhdGEuZGF0YTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGJ1ZmZlci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGJ1ZmZlcltpXSBePSAweGZmOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaW1nRGF0YTsKICAgICAgfQogICAgICBpZiAodGhpcy5pbWFnZSBpbnN0YW5jZW9mIEpwZWdTdHJlYW0gJiYgIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzayAmJiAhdGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgIGxldCBpbWFnZUxlbmd0aCA9IG9yaWdpbmFsSGVpZ2h0ICogcm93Qnl0ZXM7CiAgICAgICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkICYmICFtdXN0QmVSZXNpemVkKSB7CiAgICAgICAgICBsZXQgaXNIYW5kbGVkID0gZmFsc2U7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuY29sb3JTcGFjZS5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgICAgIGltYWdlTGVuZ3RoICo9IDQ7CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgICAgICBpbWFnZUxlbmd0aCA9IGltYWdlTGVuZ3RoIC8gMyAqIDQ7CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiRGV2aWNlQ01ZSyI6CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc0hhbmRsZWQpIHsKICAgICAgICAgICAgY29uc3QgaW1hZ2UgPSBhd2FpdCB0aGlzLiNnZXRJbWFnZShkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgICAgICAgICBpZiAoaW1hZ2UpIHsKICAgICAgICAgICAgICByZXR1cm4gaW1hZ2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcmdiYSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhpbWFnZUxlbmd0aCwgewogICAgICAgICAgICAgIGRyYXdXaWR0aCwKICAgICAgICAgICAgICBkcmF3SGVpZ2h0LAogICAgICAgICAgICAgIGZvcmNlUkdCQTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQml0bWFwKEltYWdlS2luZC5SR0JBXzMyQlBQLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIHJnYmEpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuY29sb3JTcGFjZS5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgICAgIGltYWdlTGVuZ3RoICo9IDM7CiAgICAgICAgICAgIGNhc2UgIkRldmljZVJHQiI6CiAgICAgICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgICAgIGltZ0RhdGEua2luZCA9IEltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgICAgICAgaW1nRGF0YS5kYXRhID0gYXdhaXQgdGhpcy5nZXRJbWFnZUJ5dGVzKGltYWdlTGVuZ3RoLCB7CiAgICAgICAgICAgICAgICBkcmF3V2lkdGgsCiAgICAgICAgICAgICAgICBkcmF3SGVpZ2h0LAogICAgICAgICAgICAgICAgZm9yY2VSR0I6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAobXVzdEJlUmVzaXplZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGltZ0RhdGE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCBpbWdBcnJheSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzLCB7CiAgICAgIGludGVybmFsOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IGFjdHVhbEhlaWdodCA9IDAgfCBpbWdBcnJheS5sZW5ndGggLyByb3dCeXRlcyAqIGRyYXdIZWlnaHQgLyBvcmlnaW5hbEhlaWdodDsKICAgIGNvbnN0IGNvbXBzID0gdGhpcy5nZXRDb21wb25lbnRzKGltZ0FycmF5KTsKICAgIGxldCBhbHBoYTAxLCBtYXliZVVuZG9QcmVibGVuZDsKICAgIGxldCBjYW52YXMsIGN0eCwgY2FudmFzSW1nRGF0YSwgZGF0YTsKICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiAhbXVzdEJlUmVzaXplZCkgewogICAgICBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKGRyYXdXaWR0aCwgZHJhd0hlaWdodCk7CiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICBjYW52YXNJbWdEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgICBkYXRhID0gY2FudmFzSW1nRGF0YS5kYXRhOwogICAgfQogICAgaW1nRGF0YS5raW5kID0gSW1hZ2VLaW5kLlJHQkFfMzJCUFA7CiAgICBpZiAoIWZvcmNlUkdCQSAmJiAhdGhpcy5zbWFzayAmJiAhdGhpcy5tYXNrKSB7CiAgICAgIGlmICghaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgfHwgbXVzdEJlUmVzaXplZCkgewogICAgICAgIGltZ0RhdGEua2luZCA9IEltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogMyk7CiAgICAgICAgYWxwaGEwMSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYXJyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyKTsKICAgICAgICBhcnIuZmlsbChGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4ZmYwMDAwMDAgOiAweDAwMDAwMGZmKTsKICAgICAgICBhbHBoYTAxID0gMTsKICAgICAgfQogICAgICBtYXliZVVuZG9QcmVibGVuZCA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCFpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCB8fCBtdXN0QmVSZXNpemVkKSB7CiAgICAgICAgZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogNCk7CiAgICAgIH0KICAgICAgYWxwaGEwMSA9IDE7CiAgICAgIG1heWJlVW5kb1ByZWJsZW5kID0gdHJ1ZTsKICAgICAgYXdhaXQgdGhpcy5maWxsT3BhY2l0eShkYXRhLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGFjdHVhbEhlaWdodCwgY29tcHMpOwogICAgfQogICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgdGhpcy5kZWNvZGVCdWZmZXIoY29tcHMpOwogICAgfQogICAgdGhpcy5jb2xvclNwYWNlLmZpbGxSZ2IoZGF0YSwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIGRyYXdXaWR0aCwgZHJhd0hlaWdodCwgYWN0dWFsSGVpZ2h0LCBicGMsIGNvbXBzLCBhbHBoYTAxKTsKICAgIGlmIChtYXliZVVuZG9QcmVibGVuZCkgewogICAgICB0aGlzLnVuZG9QcmVibGVuZChkYXRhLCBkcmF3V2lkdGgsIGFjdHVhbEhlaWdodCk7CiAgICB9CiAgICBpZiAoaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgJiYgIW11c3RCZVJlc2l6ZWQpIHsKICAgICAgY3R4LnB1dEltYWdlRGF0YShjYW52YXNJbWdEYXRhLCAwLCAwKTsKICAgICAgY29uc3QgYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgICByZXR1cm4gewogICAgICAgIGRhdGE6IG51bGwsCiAgICAgICAgd2lkdGg6IGRyYXdXaWR0aCwKICAgICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgICAgYml0bWFwLAogICAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICAgIH07CiAgICB9CiAgICBpbWdEYXRhLmRhdGEgPSBkYXRhOwogICAgaWYgKG11c3RCZVJlc2l6ZWQpIHsKICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhKTsKICAgIH0KICAgIHJldHVybiBpbWdEYXRhOwogIH0KICBhc3luYyBmaWxsR3JheUJ1ZmZlcihidWZmZXIpIHsKICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgIGlmIChudW1Db21wcyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFJlYWRpbmcgZ3JheSBzY2FsZSBmcm9tIGEgY29sb3IgaW1hZ2U6ICR7bnVtQ29tcHN9YCk7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IHRoaXMud2lkdGg7CiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGNvbnN0IGJwYyA9IHRoaXMuYnBjOwogICAgY29uc3Qgcm93Qnl0ZXMgPSB3aWR0aCAqIG51bUNvbXBzICogYnBjICsgNyA+PiAzOwogICAgY29uc3QgaW1nQXJyYXkgPSBhd2FpdCB0aGlzLmdldEltYWdlQnl0ZXMoaGVpZ2h0ICogcm93Qnl0ZXMsIHsKICAgICAgaW50ZXJuYWw6IHRydWUKICAgIH0pOwogICAgY29uc3QgY29tcHMgPSB0aGlzLmdldENvbXBvbmVudHMoaW1nQXJyYXkpOwogICAgbGV0IGksIGxlbmd0aDsKICAgIGlmIChicGMgPT09IDEpIHsKICAgICAgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgIGlmICh0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaV0gPSBjb21wc1tpXSAtIDEgJiAyNTU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgYnVmZmVyW2ldID0gLWNvbXBzW2ldICYgMjU1OwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5uZWVkc0RlY29kZSkgewogICAgICB0aGlzLmRlY29kZUJ1ZmZlcihjb21wcyk7CiAgICB9CiAgICBsZW5ndGggPSB3aWR0aCAqIGhlaWdodDsKICAgIGNvbnN0IHNjYWxlID0gMjU1IC8gKCgxIDw8IGJwYykgLSAxKTsKICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICBidWZmZXJbaV0gPSBzY2FsZSAqIGNvbXBzW2ldOwogICAgfQogIH0KICBjcmVhdGVCaXRtYXAoa2luZCwgd2lkdGgsIGhlaWdodCwgc3JjKSB7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICBsZXQgaW1nRGF0YTsKICAgIGlmIChraW5kID09PSBJbWFnZUtpbmQuUkdCQV8zMkJQUCkgewogICAgICBpbWdEYXRhID0gbmV3IEltYWdlRGF0YShzcmMsIHdpZHRoLCBoZWlnaHQpOwogICAgfSBlbHNlIHsKICAgICAgaW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnZlcnRUb1JHQkEoewogICAgICAgIGtpbmQsCiAgICAgICAgc3JjLAogICAgICAgIGRlc3Q6IG5ldyBVaW50MzJBcnJheShpbWdEYXRhLmRhdGEuYnVmZmVyKSwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaW52ZXJzZURlY29kZTogdGhpcy5uZWVkc0RlY29kZQogICAgICB9KTsKICAgIH0KICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgMCwgMCk7CiAgICBjb25zdCBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICByZXR1cm4gewogICAgICBkYXRhOiBudWxsLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBiaXRtYXAsCiAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICB9OwogIH0KICBhc3luYyAjZ2V0SW1hZ2Uod2lkdGgsIGhlaWdodCkgewogICAgY29uc3QgYml0bWFwID0gYXdhaXQgdGhpcy5pbWFnZS5nZXRUcmFuc2ZlcmFibGVJbWFnZSgpOwogICAgaWYgKCFiaXRtYXApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gewogICAgICBkYXRhOiBudWxsLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBiaXRtYXAsCiAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICB9OwogIH0KICBhc3luYyBnZXRJbWFnZUJ5dGVzKGxlbmd0aCwgewogICAgZHJhd1dpZHRoLAogICAgZHJhd0hlaWdodCwKICAgIGZvcmNlUkdCQSA9IGZhbHNlLAogICAgZm9yY2VSR0IgPSBmYWxzZSwKICAgIGludGVybmFsID0gZmFsc2UKICB9KSB7CiAgICB0aGlzLmltYWdlLnJlc2V0KCk7CiAgICB0aGlzLmltYWdlLmRyYXdXaWR0aCA9IGRyYXdXaWR0aCB8fCB0aGlzLndpZHRoOwogICAgdGhpcy5pbWFnZS5kcmF3SGVpZ2h0ID0gZHJhd0hlaWdodCB8fCB0aGlzLmhlaWdodDsKICAgIHRoaXMuaW1hZ2UuZm9yY2VSR0JBID0gISFmb3JjZVJHQkE7CiAgICB0aGlzLmltYWdlLmZvcmNlUkdCID0gISFmb3JjZVJHQjsKICAgIGNvbnN0IGltYWdlQnl0ZXMgPSBhd2FpdCB0aGlzLmltYWdlLmdldEltYWdlRGF0YShsZW5ndGgsIHRoaXMuanB4RGVjb2Rlck9wdGlvbnMpOwogICAgaWYgKGludGVybmFsIHx8IHRoaXMuaW1hZ2UgaW5zdGFuY2VvZiBEZWNvZGVTdHJlYW0pIHsKICAgICAgcmV0dXJuIGltYWdlQnl0ZXM7CiAgICB9CiAgICBhc3NlcnQoaW1hZ2VCeXRlcyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXksICdQREZJbWFnZS5nZXRJbWFnZUJ5dGVzOiBVbnN1cHBvcnRlZCAiaW1hZ2VCeXRlcyIgdHlwZS4nKTsKICAgIHJldHVybiBuZXcgVWludDhBcnJheShpbWFnZUJ5dGVzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2V2YWx1YXRvci5qcwoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICBtYXhJbWFnZVNpemU6IC0xLAogIGRpc2FibGVGb250RmFjZTogZmFsc2UsCiAgaWdub3JlRXJyb3JzOiBmYWxzZSwKICBpc0V2YWxTdXBwb3J0ZWQ6IHRydWUsCiAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ6IGZhbHNlLAogIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOiBmYWxzZSwKICBjYW52YXNNYXhBcmVhSW5CeXRlczogLTEsCiAgZm9udEV4dHJhUHJvcGVydGllczogZmFsc2UsCiAgdXNlU3lzdGVtRm9udHM6IHRydWUsCiAgdXNlV2FzbTogdHJ1ZSwKICB1c2VXb3JrZXJGZXRjaDogdHJ1ZSwKICBjTWFwVXJsOiBudWxsLAogIGljY1VybDogbnVsbCwKICBzdGFuZGFyZEZvbnREYXRhVXJsOiBudWxsLAogIHdhc21Vcmw6IG51bGwKfSk7CmNvbnN0IFBhdHRlcm5UeXBlID0gewogIFRJTElORzogMSwKICBTSEFESU5HOiAyCn07CmNvbnN0IFRFWFRfQ0hVTktfQkFUQ0hfU0laRSA9IDEwOwpjb25zdCBkZWZlcnJlZCA9IFByb21pc2UucmVzb2x2ZSgpOwpmdW5jdGlvbiBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUsIHBhcnNpbmdBcnJheSA9IGZhbHNlKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICBmb3IgKGNvbnN0IHZhbCBvZiB2YWx1ZSkgewogICAgICBjb25zdCBtYXliZUJNID0gbm9ybWFsaXplQmxlbmRNb2RlKHZhbCwgdHJ1ZSk7CiAgICAgIGlmIChtYXliZUJNKSB7CiAgICAgICAgcmV0dXJuIG1heWJlQk07CiAgICAgIH0KICAgIH0KICAgIHdhcm4oYFVuc3VwcG9ydGVkIGJsZW5kIG1vZGUgQXJyYXk6ICR7dmFsdWV9YCk7CiAgICByZXR1cm4gInNvdXJjZS1vdmVyIjsKICB9CiAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgaWYgKHBhcnNpbmdBcnJheSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiAic291cmNlLW92ZXIiOwogIH0KICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgIGNhc2UgIk5vcm1hbCI6CiAgICBjYXNlICJDb21wYXRpYmxlIjoKICAgICAgcmV0dXJuICJzb3VyY2Utb3ZlciI7CiAgICBjYXNlICJNdWx0aXBseSI6CiAgICAgIHJldHVybiAibXVsdGlwbHkiOwogICAgY2FzZSAiU2NyZWVuIjoKICAgICAgcmV0dXJuICJzY3JlZW4iOwogICAgY2FzZSAiT3ZlcmxheSI6CiAgICAgIHJldHVybiAib3ZlcmxheSI7CiAgICBjYXNlICJEYXJrZW4iOgogICAgICByZXR1cm4gImRhcmtlbiI7CiAgICBjYXNlICJMaWdodGVuIjoKICAgICAgcmV0dXJuICJsaWdodGVuIjsKICAgIGNhc2UgIkNvbG9yRG9kZ2UiOgogICAgICByZXR1cm4gImNvbG9yLWRvZGdlIjsKICAgIGNhc2UgIkNvbG9yQnVybiI6CiAgICAgIHJldHVybiAiY29sb3ItYnVybiI7CiAgICBjYXNlICJIYXJkTGlnaHQiOgogICAgICByZXR1cm4gImhhcmQtbGlnaHQiOwogICAgY2FzZSAiU29mdExpZ2h0IjoKICAgICAgcmV0dXJuICJzb2Z0LWxpZ2h0IjsKICAgIGNhc2UgIkRpZmZlcmVuY2UiOgogICAgICByZXR1cm4gImRpZmZlcmVuY2UiOwogICAgY2FzZSAiRXhjbHVzaW9uIjoKICAgICAgcmV0dXJuICJleGNsdXNpb24iOwogICAgY2FzZSAiSHVlIjoKICAgICAgcmV0dXJuICJodWUiOwogICAgY2FzZSAiU2F0dXJhdGlvbiI6CiAgICAgIHJldHVybiAic2F0dXJhdGlvbiI7CiAgICBjYXNlICJDb2xvciI6CiAgICAgIHJldHVybiAiY29sb3IiOwogICAgY2FzZSAiTHVtaW5vc2l0eSI6CiAgICAgIHJldHVybiAibHVtaW5vc2l0eSI7CiAgfQogIGlmIChwYXJzaW5nQXJyYXkpIHsKICAgIHJldHVybiBudWxsOwogIH0KICB3YXJuKGBVbnN1cHBvcnRlZCBibGVuZCBtb2RlOiAke3ZhbHVlLm5hbWV9YCk7CiAgcmV0dXJuICJzb3VyY2Utb3ZlciI7Cn0KZnVuY3Rpb24gYWRkQ2FjaGVkSW1hZ2VPcHMob3BMaXN0LCB7CiAgb2JqSWQsCiAgZm4sCiAgYXJncywKICBvcHRpb25hbENvbnRlbnQsCiAgaGFzTWFzawp9KSB7CiAgaWYgKG9iaklkKSB7CiAgICBvcExpc3QuYWRkRGVwZW5kZW5jeShvYmpJZCk7CiAgfQogIG9wTGlzdC5hZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrKTsKICBpZiAoZm4gPT09IE9QUy5wYWludEltYWdlTWFza1hPYmplY3QgJiYgYXJnc1swXT8uY291bnQgPiAwKSB7CiAgICBhcmdzWzBdLmNvdW50Kys7CiAgfQp9CmNsYXNzIFRpbWVTbG90TWFuYWdlciB7CiAgc3RhdGljIFRJTUVfU0xPVF9EVVJBVElPTl9NUyA9IDIwOwogIHN0YXRpYyBDSEVDS19USU1FX0VWRVJZID0gMTAwOwogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5yZXNldCgpOwogIH0KICBjaGVjaygpIHsKICAgIGlmICgrK3RoaXMuY2hlY2tlZCA8IFRpbWVTbG90TWFuYWdlci5DSEVDS19USU1FX0VWRVJZKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuY2hlY2tlZCA9IDA7CiAgICByZXR1cm4gdGhpcy5lbmRUaW1lIDw9IERhdGUubm93KCk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5lbmRUaW1lID0gRGF0ZS5ub3coKSArIFRpbWVTbG90TWFuYWdlci5USU1FX1NMT1RfRFVSQVRJT05fTVM7CiAgICB0aGlzLmNoZWNrZWQgPSAwOwogIH0KfQpjbGFzcyBQYXJ0aWFsRXZhbHVhdG9yIHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgaGFuZGxlciwKICAgIHBhZ2VJbmRleCwKICAgIGlkRmFjdG9yeSwKICAgIGZvbnRDYWNoZSwKICAgIGJ1aWx0SW5DTWFwQ2FjaGUsCiAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGUsCiAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBnbG9iYWxJbWFnZUNhY2hlLAogICAgc3lzdGVtRm9udENhY2hlLAogICAgb3B0aW9ucyA9IG51bGwKICB9KSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjsKICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgdGhpcy5pZEZhY3RvcnkgPSBpZEZhY3Rvcnk7CiAgICB0aGlzLmZvbnRDYWNoZSA9IGZvbnRDYWNoZTsKICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IGJ1aWx0SW5DTWFwQ2FjaGU7CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSA9IHN0YW5kYXJkRm9udERhdGFDYWNoZTsKICAgIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlID0gZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOwogICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlID0gZ2xvYmFsSW1hZ2VDYWNoZTsKICAgIHRoaXMuc3lzdGVtRm9udENhY2hlID0gc3lzdGVtRm9udENhY2hlOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnR5cGUzRm9udFJlZnMgPSBudWxsOwogICAgdGhpcy5fcmVnaW9uYWxJbWFnZUNhY2hlID0gbmV3IFJlZ2lvbmFsSW1hZ2VDYWNoZSgpOwogICAgdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kID0gdGhpcy5mZXRjaEJ1aWx0SW5DTWFwLmJpbmQodGhpcyk7CiAgfQogIGdldCBfcGRmRnVuY3Rpb25GYWN0b3J5KCkgewogICAgY29uc3QgcGRmRnVuY3Rpb25GYWN0b3J5ID0gbmV3IFBERkZ1bmN0aW9uRmFjdG9yeSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaXNFdmFsU3VwcG9ydGVkOiB0aGlzLm9wdGlvbnMuaXNFdmFsU3VwcG9ydGVkCiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9wZGZGdW5jdGlvbkZhY3RvcnkiLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogIH0KICBnZXQgcGFyc2luZ1R5cGUzRm9udCgpIHsKICAgIHJldHVybiAhIXRoaXMudHlwZTNGb250UmVmczsKICB9CiAgY2xvbmUobmV3T3B0aW9ucyA9IG51bGwpIHsKICAgIGNvbnN0IG5ld0V2YWx1YXRvciA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBuZXdFdmFsdWF0b3Iub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgdGhpcy5vcHRpb25zLCBuZXdPcHRpb25zKTsKICAgIHJldHVybiBuZXdFdmFsdWF0b3I7CiAgfQogIGhhc0JsZW5kTW9kZXMocmVzb3VyY2VzLCBub25CbGVuZE1vZGVzU2V0KSB7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAocmVzb3VyY2VzLm9iaklkICYmIG5vbkJsZW5kTW9kZXNTZXQuaGFzKHJlc291cmNlcy5vYmpJZCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgcHJvY2Vzc2VkID0gbmV3IFJlZlNldChub25CbGVuZE1vZGVzU2V0KTsKICAgIGlmIChyZXNvdXJjZXMub2JqSWQpIHsKICAgICAgcHJvY2Vzc2VkLnB1dChyZXNvdXJjZXMub2JqSWQpOwogICAgfQogICAgY29uc3Qgbm9kZXMgPSBbcmVzb3VyY2VzXSwKICAgICAgeHJlZiA9IHRoaXMueHJlZjsKICAgIHdoaWxlIChub2Rlcy5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzLnNoaWZ0KCk7CiAgICAgIGNvbnN0IGdyYXBoaWNTdGF0ZXMgPSBub2RlLmdldCgiRXh0R1N0YXRlIik7CiAgICAgIGlmIChncmFwaGljU3RhdGVzIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGZvciAobGV0IGdyYXBoaWNTdGF0ZSBvZiBncmFwaGljU3RhdGVzLmdldFJhd1ZhbHVlcygpKSB7CiAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGdyYXBoaWNTdGF0ZSkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGdyYXBoaWNTdGF0ZSA9IHhyZWYuZmV0Y2goZ3JhcGhpY1N0YXRlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICBwcm9jZXNzZWQucHV0KGdyYXBoaWNTdGF0ZSk7CiAgICAgICAgICAgICAgaW5mbyhgaGFzQmxlbmRNb2RlcyAtIGlnbm9yaW5nIEV4dEdTdGF0ZTogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCEoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlLm9iaklkKSB7CiAgICAgICAgICAgIHByb2Nlc3NlZC5wdXQoZ3JhcGhpY1N0YXRlLm9iaklkKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGJtID0gZ3JhcGhpY1N0YXRlLmdldCgiQk0iKTsKICAgICAgICAgIGlmIChibSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgaWYgKGJtLm5hbWUgIT09ICJOb3JtYWwiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYm0gIT09IHVuZGVmaW5lZCAmJiBBcnJheS5pc0FycmF5KGJtKSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYm0pIHsKICAgICAgICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIE5hbWUgJiYgZWxlbWVudC5uYW1lICE9PSAiTm9ybWFsIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHhPYmplY3RzID0gbm9kZS5nZXQoIlhPYmplY3QiKTsKICAgICAgaWYgKCEoeE9iamVjdHMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAobGV0IHhPYmplY3Qgb2YgeE9iamVjdHMuZ2V0UmF3VmFsdWVzKCkpIHsKICAgICAgICBpZiAoeE9iamVjdCBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgaWYgKHByb2Nlc3NlZC5oYXMoeE9iamVjdCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB4T2JqZWN0ID0geHJlZi5mZXRjaCh4T2JqZWN0KTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHByb2Nlc3NlZC5wdXQoeE9iamVjdCk7CiAgICAgICAgICAgIGluZm8oYGhhc0JsZW5kTW9kZXMgLSBpZ25vcmluZyBYT2JqZWN0OiAiJHtleH0iLmApOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCEoeE9iamVjdCBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHhPYmplY3QuZGljdC5vYmpJZCkgewogICAgICAgICAgcHJvY2Vzc2VkLnB1dCh4T2JqZWN0LmRpY3Qub2JqSWQpOwogICAgICAgIH0KICAgICAgICBjb25zdCB4UmVzb3VyY2VzID0geE9iamVjdC5kaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICAgICAgaWYgKCEoeFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHhSZXNvdXJjZXMub2JqSWQgJiYgcHJvY2Vzc2VkLmhhcyh4UmVzb3VyY2VzLm9iaklkKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIG5vZGVzLnB1c2goeFJlc291cmNlcyk7CiAgICAgICAgaWYgKHhSZXNvdXJjZXMub2JqSWQpIHsKICAgICAgICAgIHByb2Nlc3NlZC5wdXQoeFJlc291cmNlcy5vYmpJZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IHJlZiBvZiBwcm9jZXNzZWQpIHsKICAgICAgbm9uQmxlbmRNb2Rlc1NldC5wdXQocmVmKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgZmV0Y2hCdWlsdEluQ01hcChuYW1lKSB7CiAgICBjb25zdCBjYWNoZWREYXRhID0gdGhpcy5idWlsdEluQ01hcENhY2hlLmdldChuYW1lKTsKICAgIGlmIChjYWNoZWREYXRhKSB7CiAgICAgIHJldHVybiBjYWNoZWREYXRhOwogICAgfQogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5vcHRpb25zLnVzZVdvcmtlckZldGNoKSB7CiAgICAgIGRhdGEgPSB7CiAgICAgICAgY01hcERhdGE6IGF3YWl0IGZldGNoQmluYXJ5RGF0YShgJHt0aGlzLm9wdGlvbnMuY01hcFVybH0ke25hbWV9LmJjbWFwYCksCiAgICAgICAgaXNDb21wcmVzc2VkOiB0cnVlCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBkYXRhID0gYXdhaXQgdGhpcy5oYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiRmV0Y2hCaW5hcnlEYXRhIiwgewogICAgICAgIHR5cGU6ICJjTWFwUmVhZGVyRmFjdG9yeSIsCiAgICAgICAgbmFtZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZS5zZXQobmFtZSwgZGF0YSk7CiAgICByZXR1cm4gZGF0YTsKICB9CiAgYXN5bmMgZmV0Y2hTdGFuZGFyZEZvbnREYXRhKG5hbWUpIHsKICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZS5nZXQobmFtZSk7CiAgICBpZiAoY2FjaGVkRGF0YSkgewogICAgICByZXR1cm4gbmV3IFN0cmVhbShjYWNoZWREYXRhKTsKICAgIH0KICAgIGlmICh0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMgJiYgbmFtZSAhPT0gIlN5bWJvbCIgJiYgbmFtZSAhPT0gIlphcGZEaW5nYmF0cyIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBzdGFuZGFyZEZvbnROYW1lVG9GaWxlTmFtZSA9IGdldEZvbnROYW1lVG9GaWxlTWFwKCksCiAgICAgIGZpbGVuYW1lID0gc3RhbmRhcmRGb250TmFtZVRvRmlsZU5hbWVbbmFtZV07CiAgICBsZXQgZGF0YTsKICAgIHRyeSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMudXNlV29ya2VyRmV0Y2gpIHsKICAgICAgICBkYXRhID0gYXdhaXQgZmV0Y2hCaW5hcnlEYXRhKGAke3RoaXMub3B0aW9ucy5zdGFuZGFyZEZvbnREYXRhVXJsfSR7ZmlsZW5hbWV9YCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YSA9IGF3YWl0IHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkZldGNoQmluYXJ5RGF0YSIsIHsKICAgICAgICAgIHR5cGU6ICJzdGFuZGFyZEZvbnREYXRhRmFjdG9yeSIsCiAgICAgICAgICBmaWxlbmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICB3YXJuKGV4KTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZS5zZXQobmFtZSwgZGF0YSk7CiAgICByZXR1cm4gbmV3IFN0cmVhbShkYXRhKTsKICB9CiAgYXN5bmMgYnVpbGRGb3JtWE9iamVjdChyZXNvdXJjZXMsIHhvYmosIHNtYXNrLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSB4b2JqOwogICAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBudWxsKTsKICAgIGNvbnN0IGJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50LCBncm91cE9wdGlvbnM7CiAgICBpZiAoZGljdC5oYXMoIk9DIikpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgdGhpcy5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhkaWN0LmdldCgiT0MiKSwgcmVzb3VyY2VzKTsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLCBbIk9DIiwgb3B0aW9uYWxDb250ZW50XSk7CiAgICB9CiAgICBjb25zdCBncm91cCA9IGRpY3QuZ2V0KCJHcm91cCIpOwogICAgaWYgKGdyb3VwKSB7CiAgICAgIGdyb3VwT3B0aW9ucyA9IHsKICAgICAgICBtYXRyaXgsCiAgICAgICAgYmJveCwKICAgICAgICBzbWFzaywKICAgICAgICBpc29sYXRlZDogZmFsc2UsCiAgICAgICAga25vY2tvdXQ6IGZhbHNlCiAgICAgIH07CiAgICAgIGNvbnN0IGdyb3VwU3VidHlwZSA9IGdyb3VwLmdldCgiUyIpOwogICAgICBsZXQgY29sb3JTcGFjZSA9IG51bGw7CiAgICAgIGlmIChpc05hbWUoZ3JvdXBTdWJ0eXBlLCAiVHJhbnNwYXJlbmN5IikpIHsKICAgICAgICBncm91cE9wdGlvbnMuaXNvbGF0ZWQgPSBncm91cC5nZXQoIkkiKSB8fCBmYWxzZTsKICAgICAgICBncm91cE9wdGlvbnMua25vY2tvdXQgPSBncm91cC5nZXQoIksiKSB8fCBmYWxzZTsKICAgICAgICBpZiAoZ3JvdXAuaGFzKCJDUyIpKSB7CiAgICAgICAgICBjb25zdCBjcyA9IHRoaXMuX2dldENvbG9yU3BhY2UoZ3JvdXAuZ2V0UmF3KCJDUyIpLCByZXNvdXJjZXMsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICAgIGNvbG9yU3BhY2UgPSBjcyBpbnN0YW5jZW9mIENvbG9yU3BhY2UgPyBjcyA6IGF3YWl0IHRoaXMuX2hhbmRsZUNvbG9yU3BhY2UoY3MpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc21hc2s/LmJhY2tkcm9wKSB7CiAgICAgICAgY29sb3JTcGFjZSB8fD0gQ29sb3JTcGFjZVV0aWxzLnJnYjsKICAgICAgICBzbWFzay5iYWNrZHJvcCA9IGNvbG9yU3BhY2UuZ2V0UmdiSGV4KHNtYXNrLmJhY2tkcm9wLCAwKTsKICAgICAgfQogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmJlZ2luR3JvdXAsIFtncm91cE9wdGlvbnNdKTsKICAgIH0KICAgIGNvbnN0IGYzMm1hdHJpeCA9IG1hdHJpeCAmJiBuZXcgRmxvYXQzMkFycmF5KG1hdHJpeCk7CiAgICBjb25zdCBmMzJiYm94ID0gIWdyb3VwICYmIGJib3ggJiYgbmV3IEZsb2F0MzJBcnJheShiYm94KSB8fCBudWxsOwogICAgY29uc3QgYXJncyA9IFtmMzJtYXRyaXgsIGYzMmJib3hdOwogICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5wYWludEZvcm1YT2JqZWN0QmVnaW4sIGFyZ3MpOwogICAgY29uc3QgbG9jYWxSZXNvdXJjZXMgPSBkaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICBhd2FpdCB0aGlzLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgIHN0cmVhbTogeG9iaiwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzOiBsb2NhbFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QgPyBsb2NhbFJlc291cmNlcyA6IHJlc291cmNlcywKICAgICAgb3BlcmF0b3JMaXN0LAogICAgICBpbml0aWFsU3RhdGUsCiAgICAgIHByZXZSZWZzOiBzZWVuUmVmcwogICAgfSk7CiAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnBhaW50Rm9ybVhPYmplY3RFbmQsIFtdKTsKICAgIGlmIChncm91cCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmVuZEdyb3VwLCBbZ3JvdXBPcHRpb25zXSk7CiAgICB9CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5lbmRNYXJrZWRDb250ZW50LCBbXSk7CiAgICB9CiAgfQogIF9zZW5kSW1nRGF0YShvYmpJZCwgaW1nRGF0YSwgY2FjaGVHbG9iYWxseSA9IGZhbHNlKSB7CiAgICBjb25zdCB0cmFuc2ZlcnMgPSBpbWdEYXRhID8gW2ltZ0RhdGEuYml0bWFwIHx8IGltZ0RhdGEuZGF0YS5idWZmZXJdIDogbnVsbDsKICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQgfHwgY2FjaGVHbG9iYWxseSkgewogICAgICByZXR1cm4gdGhpcy5oYW5kbGVyLnNlbmQoImNvbW1vbm9iaiIsIFtvYmpJZCwgIkltYWdlIiwgaW1nRGF0YV0sIHRyYW5zZmVycyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5oYW5kbGVyLnNlbmQoIm9iaiIsIFtvYmpJZCwgdGhpcy5wYWdlSW5kZXgsICJJbWFnZSIsIGltZ0RhdGFdLCB0cmFuc2ZlcnMpOwogIH0KICBhc3luYyBidWlsZFBhaW50SW1hZ2VYT2JqZWN0KHsKICAgIHJlc291cmNlcywKICAgIGltYWdlLAogICAgaXNJbmxpbmUgPSBmYWxzZSwKICAgIG9wZXJhdG9yTGlzdCwKICAgIGNhY2hlS2V5LAogICAgbG9jYWxJbWFnZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIG1heEltYWdlU2l6ZSwKICAgICAgaWdub3JlRXJyb3JzLAogICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgfSA9IHRoaXMub3B0aW9uczsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IGltYWdlOwogICAgY29uc3QgaW1hZ2VSZWYgPSBkaWN0Lm9iaklkOwogICAgY29uc3QgdyA9IGRpY3QuZ2V0KCJXIiwgIldpZHRoIik7CiAgICBjb25zdCBoID0gZGljdC5nZXQoIkgiLCAiSGVpZ2h0Iik7CiAgICBpZiAoISh3ICYmIHR5cGVvZiB3ID09PSAibnVtYmVyIikgfHwgIShoICYmIHR5cGVvZiBoID09PSAibnVtYmVyIikpIHsKICAgICAgd2FybigiSW1hZ2UgZGltZW5zaW9ucyBhcmUgbWlzc2luZywgb3Igbm90IG51bWJlcnMuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChtYXhJbWFnZVNpemUgIT09IC0xICYmIHcgKiBoID4gbWF4SW1hZ2VTaXplKSB7CiAgICAgIGNvbnN0IG1zZyA9ICJJbWFnZSBleGNlZWRlZCBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBhbmQgd2FzIHJlbW92ZWQuIjsKICAgICAgaWYgKCFpZ25vcmVFcnJvcnMpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgICAgfQogICAgICB3YXJuKG1zZyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBvcHRpb25hbENvbnRlbnQ7CiAgICBpZiAoZGljdC5oYXMoIk9DIikpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgdGhpcy5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhkaWN0LmdldCgiT0MiKSwgcmVzb3VyY2VzKTsKICAgIH0KICAgIGNvbnN0IGltYWdlTWFzayA9IGRpY3QuZ2V0KCJJTSIsICJJbWFnZU1hc2siKSB8fCBmYWxzZTsKICAgIGxldCBpbWdEYXRhLCBmbiwgYXJnczsKICAgIGlmIChpbWFnZU1hc2spIHsKICAgICAgaW1nRGF0YSA9IGF3YWl0IFBERkltYWdlLmNyZWF0ZU1hc2soewogICAgICAgIGltYWdlLAogICAgICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOiBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiAhdGhpcy5wYXJzaW5nVHlwZTNGb250CiAgICAgIH0pOwogICAgICBpZiAoaW1nRGF0YS5pc1NpbmdsZU9wYXF1ZVBpeGVsKSB7CiAgICAgICAgZm4gPSBPUFMucGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrOwogICAgICAgIGFyZ3MgPSBbXTsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoZm4sIGFyZ3MsIG9wdGlvbmFsQ29udGVudCk7CiAgICAgICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgICAgICBjb25zdCBjYWNoZURhdGEgPSB7CiAgICAgICAgICAgIGZuLAogICAgICAgICAgICBhcmdzLAogICAgICAgICAgICBvcHRpb25hbENvbnRlbnQKICAgICAgICAgIH07CiAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICAgIGlmIChpbWFnZVJlZikgewogICAgICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGFyc2luZ1R5cGUzRm9udCkgewogICAgICAgIGFyZ3MgPSBjb21waWxlVHlwZTNHbHlwaChpbWdEYXRhKTsKICAgICAgICBpZiAoYXJncykgewogICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZEltYWdlT3BzKE9QUy5jb25zdHJ1Y3RQYXRoLCBhcmdzLCBvcHRpb25hbENvbnRlbnQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB3YXJuKCJDYW5ub3QgY29tcGlsZSBUeXBlMyBnbHlwaC4iKTsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCwgW2ltZ0RhdGFdLCBvcHRpb25hbENvbnRlbnQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBvYmpJZCA9IGBtYXNrXyR7dGhpcy5pZEZhY3RvcnkuY3JlYXRlT2JqSWQoKX1gOwogICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jeShvYmpJZCk7CiAgICAgIGltZ0RhdGEuZGF0YUxlbiA9IGltZ0RhdGEuYml0bWFwID8gaW1nRGF0YS53aWR0aCAqIGltZ0RhdGEuaGVpZ2h0ICogNCA6IGltZ0RhdGEuZGF0YS5sZW5ndGg7CiAgICAgIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBpbWdEYXRhKTsKICAgICAgZm4gPSBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0OwogICAgICBhcmdzID0gW3sKICAgICAgICBkYXRhOiBvYmpJZCwKICAgICAgICB3aWR0aDogaW1nRGF0YS53aWR0aCwKICAgICAgICBoZWlnaHQ6IGltZ0RhdGEuaGVpZ2h0LAogICAgICAgIGludGVycG9sYXRlOiBpbWdEYXRhLmludGVycG9sYXRlLAogICAgICAgIGNvdW50OiAxCiAgICAgIH1dOwogICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoZm4sIGFyZ3MsIG9wdGlvbmFsQ29udGVudCk7CiAgICAgIGlmIChjYWNoZUtleSkgewogICAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICAgIG9iaklkLAogICAgICAgICAgZm4sCiAgICAgICAgICBhcmdzLAogICAgICAgICAgb3B0aW9uYWxDb250ZW50CiAgICAgICAgfTsKICAgICAgICBsb2NhbEltYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICAgIHRoaXMuX3JlZ2lvbmFsSW1hZ2VDYWNoZS5zZXQobnVsbCwgaW1hZ2VSZWYsIGNhY2hlRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFNNQUxMX0lNQUdFX0RJTUVOU0lPTlMgPSAyMDA7CiAgICBjb25zdCBoYXNNYXNrID0gZGljdC5oYXMoIlNNYXNrIikgfHwgZGljdC5oYXMoIk1hc2siKTsKICAgIGlmIChpc0lubGluZSAmJiB3ICsgaCA8IFNNQUxMX0lNQUdFX0RJTUVOU0lPTlMgJiYgIWhhc01hc2spIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBpbWFnZU9iaiA9IG5ldyBQREZJbWFnZSh7CiAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICByZXM6IHJlc291cmNlcywKICAgICAgICAgIGltYWdlLAogICAgICAgICAgaXNJbmxpbmUsCiAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgIH0pOwogICAgICAgIGltZ0RhdGEgPSBhd2FpdCBpbWFnZU9iai5jcmVhdGVJbWFnZURhdGEodHJ1ZSwgZmFsc2UpOwogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QsIFtpbWdEYXRhXSwgb3B0aW9uYWxDb250ZW50KTsKICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgY29uc3QgbXNnID0gYFVuYWJsZSB0byBkZWNvZGUgaW5saW5lIGltYWdlOiAiJHtyZWFzb259Ii5gOwogICAgICAgIGlmICghaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgICAgICB9CiAgICAgICAgd2Fybihtc2cpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBvYmpJZCA9IGBpbWdfJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWAsCiAgICAgIGNhY2hlR2xvYmFsbHkgPSBmYWxzZSwKICAgICAgZ2xvYmFsQ2FjaGVEYXRhID0gbnVsbDsKICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgb2JqSWQgPSBgJHt0aGlzLmlkRmFjdG9yeS5nZXREb2NJZCgpfV90eXBlM18ke29iaklkfWA7CiAgICB9IGVsc2UgaWYgKGNhY2hlS2V5ICYmIGltYWdlUmVmKSB7CiAgICAgIGNhY2hlR2xvYmFsbHkgPSB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuc2hvdWxkQ2FjaGUoaW1hZ2VSZWYsIHRoaXMucGFnZUluZGV4KTsKICAgICAgaWYgKGNhY2hlR2xvYmFsbHkpIHsKICAgICAgICBhc3NlcnQoIWlzSW5saW5lLCAiQ2Fubm90IGNhY2hlIGFuIGlubGluZSBpbWFnZSBnbG9iYWxseS4iKTsKICAgICAgICBvYmpJZCA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9XyR7b2JqSWR9YDsKICAgICAgfQogICAgfQogICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY3kob2JqSWQpOwogICAgZm4gPSBPUFMucGFpbnRJbWFnZVhPYmplY3Q7CiAgICBhcmdzID0gW29iaklkLCB3LCBoXTsKICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrKTsKICAgIGlmIChjYWNoZUdsb2JhbGx5KSB7CiAgICAgIGdsb2JhbENhY2hlRGF0YSA9IHsKICAgICAgICBvYmpJZCwKICAgICAgICBmbiwKICAgICAgICBhcmdzLAogICAgICAgIG9wdGlvbmFsQ29udGVudCwKICAgICAgICBoYXNNYXNrLAogICAgICAgIGJ5dGVTaXplOiAwCiAgICAgIH07CiAgICAgIGlmICh0aGlzLmdsb2JhbEltYWdlQ2FjaGUuaGFzRGVjb2RlRmFpbGVkKGltYWdlUmVmKSkgewogICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5zZXREYXRhKGltYWdlUmVmLCBnbG9iYWxDYWNoZURhdGEpOwogICAgICAgIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBudWxsLCBjYWNoZUdsb2JhbGx5KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHcgKiBoID4gMjUwMDAwIHx8IGhhc01hc2spIHsKICAgICAgICBjb25zdCBsb2NhbExlbmd0aCA9IGF3YWl0IHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoImNvbW1vbm9iaiIsIFtvYmpJZCwgIkNvcHlMb2NhbEltYWdlIiwgewogICAgICAgICAgaW1hZ2VSZWYKICAgICAgICB9XSk7CiAgICAgICAgaWYgKGxvY2FsTGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuc2V0RGF0YShpbWFnZVJlZiwgZ2xvYmFsQ2FjaGVEYXRhKTsKICAgICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5hZGRCeXRlU2l6ZShpbWFnZVJlZiwgbG9jYWxMZW5ndGgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgUERGSW1hZ2UuYnVpbGRJbWFnZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgcmVzOiByZXNvdXJjZXMsCiAgICAgIGltYWdlLAogICAgICBpc0lubGluZSwKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5OiB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KS50aGVuKGFzeW5jIGltYWdlT2JqID0+IHsKICAgICAgaW1nRGF0YSA9IGF3YWl0IGltYWdlT2JqLmNyZWF0ZUltYWdlRGF0YShmYWxzZSwgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpOwogICAgICBpbWdEYXRhLmRhdGFMZW4gPSBpbWdEYXRhLmJpdG1hcCA/IGltZ0RhdGEud2lkdGggKiBpbWdEYXRhLmhlaWdodCAqIDQgOiBpbWdEYXRhLmRhdGEubGVuZ3RoOwogICAgICBpbWdEYXRhLnJlZiA9IGltYWdlUmVmOwogICAgICBpZiAoY2FjaGVHbG9iYWxseSkgewogICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5hZGRCeXRlU2l6ZShpbWFnZVJlZiwgaW1nRGF0YS5kYXRhTGVuKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fc2VuZEltZ0RhdGEob2JqSWQsIGltZ0RhdGEsIGNhY2hlR2xvYmFsbHkpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgd2FybihgVW5hYmxlIHRvIGRlY29kZSBpbWFnZSAiJHtvYmpJZH0iOiAiJHtyZWFzb259Ii5gKTsKICAgICAgaWYgKGltYWdlUmVmKSB7CiAgICAgICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLmFkZERlY29kZUZhaWxlZChpbWFnZVJlZik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBudWxsLCBjYWNoZUdsb2JhbGx5KTsKICAgIH0pOwogICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICBvYmpJZCwKICAgICAgICBmbiwKICAgICAgICBhcmdzLAogICAgICAgIG9wdGlvbmFsQ29udGVudCwKICAgICAgICBoYXNNYXNrCiAgICAgIH07CiAgICAgIGxvY2FsSW1hZ2VDYWNoZS5zZXQoY2FjaGVLZXksIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgIGlmIChjYWNoZUdsb2JhbGx5KSB7CiAgICAgICAgICBhc3NlcnQoZ2xvYmFsQ2FjaGVEYXRhLCAiVGhlIGdsb2JhbCBjYWNoZS1kYXRhIG11c3QgYmUgYXZhaWxhYmxlLiIpOwogICAgICAgICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLnNldERhdGEoaW1hZ2VSZWYsIGdsb2JhbENhY2hlRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGhhbmRsZVNNYXNrKHNtYXNrLCByZXNvdXJjZXMsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgc2VlblJlZnMpIHsKICAgIGNvbnN0IHNtYXNrQ29udGVudCA9IHNtYXNrLmdldCgiRyIpOwogICAgY29uc3Qgc21hc2tPcHRpb25zID0gewogICAgICBzdWJ0eXBlOiBzbWFzay5nZXQoIlMiKS5uYW1lLAogICAgICBiYWNrZHJvcDogc21hc2suZ2V0KCJCQyIpCiAgICB9OwogICAgY29uc3QgdHJhbnNmZXJPYmogPSBzbWFzay5nZXQoIlRSIik7CiAgICBpZiAoaXNQREZGdW5jdGlvbih0cmFuc2Zlck9iaikpIHsKICAgICAgY29uc3QgdHJhbnNmZXJGbiA9IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICBjb25zdCB0cmFuc2Zlck1hcCA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgICAgIGNvbnN0IHRtcCA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICB0bXBbMF0gPSBpIC8gMjU1OwogICAgICAgIHRyYW5zZmVyRm4odG1wLCAwLCB0bXAsIDApOwogICAgICAgIHRyYW5zZmVyTWFwW2ldID0gdG1wWzBdICogMjU1IHwgMDsKICAgICAgfQogICAgICBzbWFza09wdGlvbnMudHJhbnNmZXJNYXAgPSB0cmFuc2Zlck1hcDsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1aWxkRm9ybVhPYmplY3QocmVzb3VyY2VzLCBzbWFza0NvbnRlbnQsIHNtYXNrT3B0aW9ucywgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoewogICAgICBuZXdQYXRoOiB0cnVlCiAgICB9KSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKTsKICB9CiAgaGFuZGxlVHJhbnNmZXJGdW5jdGlvbih0cikgewogICAgbGV0IHRyYW5zZmVyQXJyYXk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0cikpIHsKICAgICAgdHJhbnNmZXJBcnJheSA9IHRyOwogICAgfSBlbHNlIGlmIChpc1BERkZ1bmN0aW9uKHRyKSkgewogICAgICB0cmFuc2ZlckFycmF5ID0gW3RyXTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgdHJhbnNmZXJNYXBzID0gW107CiAgICBsZXQgbnVtRm5zID0gMCwKICAgICAgbnVtRWZmZWN0ZnVsRm5zID0gMDsKICAgIGZvciAoY29uc3QgZW50cnkgb2YgdHJhbnNmZXJBcnJheSkgewogICAgICBjb25zdCB0cmFuc2Zlck9iaiA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGVudHJ5KTsKICAgICAgbnVtRm5zKys7CiAgICAgIGlmIChpc05hbWUodHJhbnNmZXJPYmosICJJZGVudGl0eSIpKSB7CiAgICAgICAgdHJhbnNmZXJNYXBzLnB1c2gobnVsbCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSBpZiAoIWlzUERGRnVuY3Rpb24odHJhbnNmZXJPYmopKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgdHJhbnNmZXJGbiA9IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICBjb25zdCB0cmFuc2Zlck1hcCA9IG5ldyBVaW50OEFycmF5KDI1NiksCiAgICAgICAgdG1wID0gbmV3IEZsb2F0MzJBcnJheSgxKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAyNTY7IGorKykgewogICAgICAgIHRtcFswXSA9IGogLyAyNTU7CiAgICAgICAgdHJhbnNmZXJGbih0bXAsIDAsIHRtcCwgMCk7CiAgICAgICAgdHJhbnNmZXJNYXBbal0gPSB0bXBbMF0gKiAyNTUgfCAwOwogICAgICB9CiAgICAgIHRyYW5zZmVyTWFwcy5wdXNoKHRyYW5zZmVyTWFwKTsKICAgICAgbnVtRWZmZWN0ZnVsRm5zKys7CiAgICB9CiAgICBpZiAoIShudW1GbnMgPT09IDEgfHwgbnVtRm5zID09PSA0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChudW1FZmZlY3RmdWxGbnMgPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gdHJhbnNmZXJNYXBzOwogIH0KICBoYW5kbGVUaWxpbmdUeXBlKGZuLCBjb2xvciwgcmVzb3VyY2VzLCBwYXR0ZXJuLCBwYXR0ZXJuRGljdCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSkgewogICAgY29uc3QgdGlsaW5nT3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgY29uc3QgcGF0dGVyblJlc291cmNlcyA9IERpY3QubWVyZ2UoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGRpY3RBcnJheTogW3BhdHRlcm5EaWN0LmdldCgiUmVzb3VyY2VzIiksIHJlc291cmNlc10KICAgIH0pOwogICAgcmV0dXJuIHRoaXMuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgc3RyZWFtOiBwYXR0ZXJuLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXM6IHBhdHRlcm5SZXNvdXJjZXMsCiAgICAgIG9wZXJhdG9yTGlzdDogdGlsaW5nT3BMaXN0CiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3Qgb3BlcmF0b3JMaXN0SVIgPSB0aWxpbmdPcExpc3QuZ2V0SVIoKTsKICAgICAgY29uc3QgdGlsaW5nUGF0dGVybklSID0gZ2V0VGlsaW5nUGF0dGVybklSKG9wZXJhdG9yTGlzdElSLCBwYXR0ZXJuRGljdCwgY29sb3IpOwogICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jaWVzKHRpbGluZ09wTGlzdC5kZXBlbmRlbmNpZXMpOwogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHRpbGluZ1BhdHRlcm5JUik7CiAgICAgIGlmIChwYXR0ZXJuRGljdC5vYmpJZCkgewogICAgICAgIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLnNldChudWxsLCBwYXR0ZXJuRGljdC5vYmpJZCwgewogICAgICAgICAgb3BlcmF0b3JMaXN0SVIsCiAgICAgICAgICBkaWN0OiBwYXR0ZXJuRGljdAogICAgICAgIH0pOwogICAgICB9CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBoYW5kbGVUaWxpbmdUeXBlIC0gaWdub3JpbmcgcGF0dGVybjogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0pOwogIH0KICBhc3luYyBoYW5kbGVTZXRGb250KHJlc291cmNlcywgZm9udEFyZ3MsIGZvbnRSZWYsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGUsIGZhbGxiYWNrRm9udERpY3QgPSBudWxsLCBjc3NGb250SW5mbyA9IG51bGwpIHsKICAgIGNvbnN0IGZvbnROYW1lID0gZm9udEFyZ3M/LlswXSBpbnN0YW5jZW9mIE5hbWUgPyBmb250QXJnc1swXS5uYW1lIDogbnVsbDsKICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSBhd2FpdCB0aGlzLmxvYWRGb250KGZvbnROYW1lLCBmb250UmVmLCByZXNvdXJjZXMsIHRhc2ssIGZhbGxiYWNrRm9udERpY3QsIGNzc0ZvbnRJbmZvKTsKICAgIGlmICh0cmFuc2xhdGVkLmZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY2llcyh0cmFuc2xhdGVkLnR5cGUzRGVwZW5kZW5jaWVzKTsKICAgIH0KICAgIHN0YXRlLmZvbnQgPSB0cmFuc2xhdGVkLmZvbnQ7CiAgICB0cmFuc2xhdGVkLnNlbmQodGhpcy5oYW5kbGVyKTsKICAgIHJldHVybiB0cmFuc2xhdGVkLmxvYWRlZE5hbWU7CiAgfQogIGhhbmRsZVRleHQoY2hhcnMsIHN0YXRlKSB7CiAgICBjb25zdCBmb250ID0gc3RhdGUuZm9udDsKICAgIGNvbnN0IGdseXBocyA9IGZvbnQuY2hhcnNUb0dseXBocyhjaGFycyk7CiAgICBpZiAoZm9udC5kYXRhKSB7CiAgICAgIGNvbnN0IGlzQWRkVG9QYXRoU2V0ID0gISEoc3RhdGUudGV4dFJlbmRlcmluZ01vZGUgJiBUZXh0UmVuZGVyaW5nTW9kZS5BRERfVE9fUEFUSF9GTEFHKTsKICAgICAgaWYgKGlzQWRkVG9QYXRoU2V0IHx8IHN0YXRlLmZpbGxDb2xvclNwYWNlLm5hbWUgPT09ICJQYXR0ZXJuIiB8fCBmb250LmRpc2FibGVGb250RmFjZSkgewogICAgICAgIFBhcnRpYWxFdmFsdWF0b3IuYnVpbGRGb250UGF0aHMoZm9udCwgZ2x5cGhzLCB0aGlzLmhhbmRsZXIsIHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBnbHlwaHM7CiAgfQogIGVuc3VyZVN0YXRlRm9udChzdGF0ZSkgewogICAgaWYgKHN0YXRlLmZvbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVhc29uID0gbmV3IEZvcm1hdEVycm9yKCJNaXNzaW5nIHNldEZvbnQgKFRmKSBvcGVyYXRvciBiZWZvcmUgdGV4dCByZW5kZXJpbmcgb3BlcmF0b3IuIik7CiAgICBpZiAodGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICB3YXJuKGBlbnN1cmVTdGF0ZUZvbnQ6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aHJvdyByZWFzb247CiAgfQogIGFzeW5jIHNldEdTdGF0ZSh7CiAgICByZXNvdXJjZXMsCiAgICBnU3RhdGUsCiAgICBvcGVyYXRvckxpc3QsCiAgICBjYWNoZUtleSwKICAgIHRhc2ssCiAgICBzdGF0ZU1hbmFnZXIsCiAgICBsb2NhbEdTdGF0ZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBzZWVuUmVmcwogIH0pIHsKICAgIGNvbnN0IGdTdGF0ZVJlZiA9IGdTdGF0ZS5vYmpJZDsKICAgIGxldCBpc1NpbXBsZUdTdGF0ZSA9IHRydWU7CiAgICBjb25zdCBnU3RhdGVPYmogPSBbXTsKICAgIGxldCBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBnU3RhdGUpIHsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJUeXBlIjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkxXIjoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIHdhcm4oYEludmFsaWQgTFcgKGxpbmUgd2lkdGgpOiAke3ZhbHVlfWApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIE1hdGguYWJzKHZhbHVlKV0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTEMiOgogICAgICAgIGNhc2UgIkxKIjoKICAgICAgICBjYXNlICJNTCI6CiAgICAgICAgY2FzZSAiRCI6CiAgICAgICAgY2FzZSAiUkkiOgogICAgICAgIGNhc2UgIkZMIjoKICAgICAgICBjYXNlICJDQSI6CiAgICAgICAgY2FzZSAiY2EiOgogICAgICAgICAgZ1N0YXRlT2JqLnB1c2goW2tleSwgdmFsdWVdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvbnQiOgogICAgICAgICAgaXNTaW1wbGVHU3RhdGUgPSBmYWxzZTsKICAgICAgICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oKCkgPT4gdGhpcy5oYW5kbGVTZXRGb250KHJlc291cmNlcywgbnVsbCwgdmFsdWVbMF0sIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLnN0YXRlKS50aGVuKGZ1bmN0aW9uIChsb2FkZWROYW1lKSB7CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGxvYWRlZE5hbWUpOwogICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBbbG9hZGVkTmFtZSwgdmFsdWVbMV1dXSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCTSI6CiAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUpXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTTWFzayI6CiAgICAgICAgICBpZiAoaXNOYW1lKHZhbHVlLCAiTm9uZSIpKSB7CiAgICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIGZhbHNlXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICBpc1NpbXBsZUdTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKCgpID0+IHRoaXMuaGFuZGxlU01hc2sodmFsdWUsIHJlc291cmNlcywgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIsIGxvY2FsQ29sb3JTcGFjZUNhY2hlLCBzZWVuUmVmcykpOwogICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB0cnVlXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCBTTWFzayB0eXBlIik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUUiI6CiAgICAgICAgICBjb25zdCB0cmFuc2Zlck1hcHMgPSB0aGlzLmhhbmRsZVRyYW5zZmVyRnVuY3Rpb24odmFsdWUpOwogICAgICAgICAgZ1N0YXRlT2JqLnB1c2goW2tleSwgdHJhbnNmZXJNYXBzXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJPUCI6CiAgICAgICAgY2FzZSAib3AiOgogICAgICAgIGNhc2UgIk9QTSI6CiAgICAgICAgY2FzZSAiQkciOgogICAgICAgIGNhc2UgIkJHMiI6CiAgICAgICAgY2FzZSAiVUNSIjoKICAgICAgICBjYXNlICJVQ1IyIjoKICAgICAgICBjYXNlICJUUjIiOgogICAgICAgIGNhc2UgIkhUIjoKICAgICAgICBjYXNlICJTTSI6CiAgICAgICAgY2FzZSAiU0EiOgogICAgICAgIGNhc2UgIkFJUyI6CiAgICAgICAgY2FzZSAiVEsiOgogICAgICAgICAgaW5mbygiZ3JhcGhpYyBzdGF0ZSBvcGVyYXRvciAiICsga2V5KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpbmZvKCJVbmtub3duIGdyYXBoaWMgc3RhdGUgb3BlcmF0b3IgIiArIGtleSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgYXdhaXQgcHJvbWlzZTsKICAgIGlmIChnU3RhdGVPYmoubGVuZ3RoID4gMCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnNldEdTdGF0ZSwgW2dTdGF0ZU9ial0pOwogICAgfQogICAgaWYgKGlzU2ltcGxlR1N0YXRlKSB7CiAgICAgIGxvY2FsR1N0YXRlQ2FjaGUuc2V0KGNhY2hlS2V5LCBnU3RhdGVSZWYsIGdTdGF0ZU9iaik7CiAgICB9CiAgfQogIGxvYWRGb250KGZvbnROYW1lLCBmb250LCByZXNvdXJjZXMsIHRhc2ssIGZhbGxiYWNrRm9udERpY3QgPSBudWxsLCBjc3NGb250SW5mbyA9IG51bGwpIHsKICAgIGNvbnN0IGVycm9yRm9udCA9IGFzeW5jICgpID0+IG5ldyBUcmFuc2xhdGVkRm9udCh7CiAgICAgIGxvYWRlZE5hbWU6ICJnX2ZvbnRfZXJyb3IiLAogICAgICBmb250OiBuZXcgRXJyb3JGb250KGBGb250ICIke2ZvbnROYW1lfSIgaXMgbm90IGF2YWlsYWJsZS5gKSwKICAgICAgZGljdDogZm9udAogICAgfSk7CiAgICBsZXQgZm9udFJlZjsKICAgIGlmIChmb250KSB7CiAgICAgIGlmIChmb250IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgZm9udFJlZiA9IGZvbnQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGZvbnRSZXMgPSByZXNvdXJjZXMuZ2V0KCJGb250Iik7CiAgICAgIGlmIChmb250UmVzKSB7CiAgICAgICAgZm9udFJlZiA9IGZvbnRSZXMuZ2V0UmF3KGZvbnROYW1lKTsKICAgICAgfQogICAgfQogICAgaWYgKGZvbnRSZWYpIHsKICAgICAgaWYgKHRoaXMudHlwZTNGb250UmVmcz8uaGFzKGZvbnRSZWYpKSB7CiAgICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmZvbnRDYWNoZS5oYXMoZm9udFJlZikpIHsKICAgICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnRSZWYpOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgZm9udCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZvbnRSZWYpOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHdhcm4oYGxvYWRGb250IC0gbG9va3VwIGZhaWxlZDogIiR7ZXh9Ii5gKTsKICAgICAgfQogICAgfQogICAgaWYgKCEoZm9udCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycyAmJiAhdGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgICAgd2FybihgRm9udCAiJHtmb250TmFtZX0iIGlzIG5vdCBhdmFpbGFibGUuYCk7CiAgICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgICB9CiAgICAgIHdhcm4oYEZvbnQgIiR7Zm9udE5hbWV9IiBpcyBub3QgYXZhaWxhYmxlIC0tIGF0dGVtcHRpbmcgdG8gZmFsbGJhY2sgdG8gYSBkZWZhdWx0IGZvbnQuYCk7CiAgICAgIGZvbnQgPSBmYWxsYmFja0ZvbnREaWN0IHx8IFBhcnRpYWxFdmFsdWF0b3IuZmFsbGJhY2tGb250RGljdDsKICAgIH0KICAgIGlmIChmb250LmNhY2hlS2V5ICYmIHRoaXMuZm9udENhY2hlLmhhcyhmb250LmNhY2hlS2V5KSkgewogICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnQuY2FjaGVLZXkpOwogICAgfQogICAgY29uc3QgewogICAgICBwcm9taXNlLAogICAgICByZXNvbHZlCiAgICB9ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICBsZXQgcHJlRXZhbHVhdGVkRm9udDsKICAgIHRyeSB7CiAgICAgIHByZUV2YWx1YXRlZEZvbnQgPSB0aGlzLnByZUV2YWx1YXRlRm9udChmb250KTsKICAgICAgcHJlRXZhbHVhdGVkRm9udC5jc3NGb250SW5mbyA9IGNzc0ZvbnRJbmZvOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIHdhcm4oYGxvYWRGb250IC0gcHJlRXZhbHVhdGVGb250IGZhaWxlZDogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBlcnJvckZvbnQoKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgZGVzY3JpcHRvciwKICAgICAgaGFzaAogICAgfSA9IHByZUV2YWx1YXRlZEZvbnQ7CiAgICBjb25zdCBmb250UmVmSXNSZWYgPSBmb250UmVmIGluc3RhbmNlb2YgUmVmOwogICAgbGV0IGZvbnRJRDsKICAgIGlmIChoYXNoICYmIGRlc2NyaXB0b3IgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IGZvbnRBbGlhc2VzID0gZGVzY3JpcHRvci5mb250QWxpYXNlcyB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgaWYgKGZvbnRBbGlhc2VzW2hhc2hdKSB7CiAgICAgICAgY29uc3QgYWxpYXNGb250UmVmID0gZm9udEFsaWFzZXNbaGFzaF0uYWxpYXNSZWY7CiAgICAgICAgaWYgKGZvbnRSZWZJc1JlZiAmJiBhbGlhc0ZvbnRSZWYgJiYgdGhpcy5mb250Q2FjaGUuaGFzKGFsaWFzRm9udFJlZikpIHsKICAgICAgICAgIHRoaXMuZm9udENhY2hlLnB1dEFsaWFzKGZvbnRSZWYsIGFsaWFzRm9udFJlZik7CiAgICAgICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnRSZWYpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb250QWxpYXNlc1toYXNoXSA9IHsKICAgICAgICAgIGZvbnRJRDogdGhpcy5pZEZhY3RvcnkuY3JlYXRlRm9udElkKCkKICAgICAgICB9OwogICAgICB9CiAgICAgIGlmIChmb250UmVmSXNSZWYpIHsKICAgICAgICBmb250QWxpYXNlc1toYXNoXS5hbGlhc1JlZiA9IGZvbnRSZWY7CiAgICAgIH0KICAgICAgZm9udElEID0gZm9udEFsaWFzZXNbaGFzaF0uZm9udElEOwogICAgfSBlbHNlIHsKICAgICAgZm9udElEID0gdGhpcy5pZEZhY3RvcnkuY3JlYXRlRm9udElkKCk7CiAgICB9CiAgICBhc3NlcnQoZm9udElEPy5zdGFydHNXaXRoKCJmIiksICdUaGUgImZvbnRJRCIgbXVzdCBiZSAoY29ycmVjdGx5KSBkZWZpbmVkLicpOwogICAgaWYgKGZvbnRSZWZJc1JlZikgewogICAgICB0aGlzLmZvbnRDYWNoZS5wdXQoZm9udFJlZiwgcHJvbWlzZSk7CiAgICB9IGVsc2UgewogICAgICBmb250LmNhY2hlS2V5ID0gYGNhY2hlS2V5XyR7Zm9udElEfWA7CiAgICAgIHRoaXMuZm9udENhY2hlLnB1dChmb250LmNhY2hlS2V5LCBwcm9taXNlKTsKICAgIH0KICAgIGZvbnQubG9hZGVkTmFtZSA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9XyR7Zm9udElEfWA7CiAgICB0aGlzLnRyYW5zbGF0ZUZvbnQocHJlRXZhbHVhdGVkRm9udCkudGhlbihhc3luYyB0cmFuc2xhdGVkRm9udCA9PiB7CiAgICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSBuZXcgVHJhbnNsYXRlZEZvbnQoewogICAgICAgIGxvYWRlZE5hbWU6IGZvbnQubG9hZGVkTmFtZSwKICAgICAgICBmb250OiB0cmFuc2xhdGVkRm9udCwKICAgICAgICBkaWN0OiBmb250CiAgICAgIH0pOwogICAgICBpZiAodHJhbnNsYXRlZEZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgYXdhaXQgdHJhbnNsYXRlZC5sb2FkVHlwZTNEYXRhKHRoaXMsIHJlc291cmNlcywgdGFzayk7CiAgICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFR5cGUzIGZvbnQgbG9hZCBlcnJvcjogJHtyZWFzb259YCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJlc29sdmUodHJhbnNsYXRlZCk7CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICB3YXJuKGBsb2FkRm9udCAtIHRyYW5zbGF0ZUZvbnQgZmFpbGVkOiAiJHtyZWFzb259Ii5gKTsKICAgICAgcmVzb2x2ZShuZXcgVHJhbnNsYXRlZEZvbnQoewogICAgICAgIGxvYWRlZE5hbWU6IGZvbnQubG9hZGVkTmFtZSwKICAgICAgICBmb250OiBuZXcgRXJyb3JGb250KHJlYXNvbj8ubWVzc2FnZSksCiAgICAgICAgZGljdDogZm9udAogICAgICB9KSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9taXNlOwogIH0KICBidWlsZFBhdGgoZm4sIGFyZ3MsIHN0YXRlKSB7CiAgICBjb25zdCB7CiAgICAgIHBhdGhNaW5NYXg6IG1pbk1heCwKICAgICAgcGF0aEJ1ZmZlcgogICAgfSA9IHN0YXRlOwogICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgY2FzZSBPUFMucmVjdGFuZ2xlOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHggPSBzdGF0ZS5jdXJyZW50UG9pbnRYID0gYXJnc1swXTsKICAgICAgICAgIGNvbnN0IHkgPSBzdGF0ZS5jdXJyZW50UG9pbnRZID0gYXJnc1sxXTsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gYXJnc1syXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGFyZ3NbM107CiAgICAgICAgICBjb25zdCB4dyA9IHggKyB3aWR0aDsKICAgICAgICAgIGNvbnN0IHloID0geSArIGhlaWdodDsKICAgICAgICAgIGlmICh3aWR0aCA9PT0gMCB8fCBoZWlnaHQgPT09IDApIHsKICAgICAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMubW92ZVRvLCB4LCB5LCBEcmF3T1BTLmxpbmVUbywgeHcsIHloLCBEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5tb3ZlVG8sIHgsIHksIERyYXdPUFMubGluZVRvLCB4dywgeSwgRHJhd09QUy5saW5lVG8sIHh3LCB5aCwgRHJhd09QUy5saW5lVG8sIHgsIHloLCBEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICB9CiAgICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCh4LCB5LCB4dywgeWgsIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLm1vdmVUbzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB4ID0gc3RhdGUuY3VycmVudFBvaW50WCA9IGFyZ3NbMF07CiAgICAgICAgICBjb25zdCB5ID0gc3RhdGUuY3VycmVudFBvaW50WSA9IGFyZ3NbMV07CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5tb3ZlVG8sIHgsIHkpOwogICAgICAgICAgVXRpbC5wb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLmxpbmVUbzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB4ID0gc3RhdGUuY3VycmVudFBvaW50WCA9IGFyZ3NbMF07CiAgICAgICAgICBjb25zdCB5ID0gc3RhdGUuY3VycmVudFBvaW50WSA9IGFyZ3NbMV07CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5saW5lVG8sIHgsIHkpOwogICAgICAgICAgVXRpbC5wb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLmN1cnZlVG86CiAgICAgICAgewogICAgICAgICAgY29uc3Qgc3RhcnRYID0gc3RhdGUuY3VycmVudFBvaW50WDsKICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHN0YXRlLmN1cnJlbnRQb2ludFk7CiAgICAgICAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTIsIHgsIHldID0gYXJnczsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFggPSB4OwogICAgICAgICAgc3RhdGUuY3VycmVudFBvaW50WSA9IHk7CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5jdXJ2ZVRvLCB4MSwgeTEsIHgyLCB5MiwgeCwgeSk7CiAgICAgICAgICBVdGlsLmJlemllckJvdW5kaW5nQm94KHN0YXJ0WCwgc3RhcnRZLCB4MSwgeTEsIHgyLCB5MiwgeCwgeSwgbWluTWF4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSBPUFMuY3VydmVUbzI6CiAgICAgICAgewogICAgICAgICAgY29uc3Qgc3RhcnRYID0gc3RhdGUuY3VycmVudFBvaW50WDsKICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHN0YXRlLmN1cnJlbnRQb2ludFk7CiAgICAgICAgICBjb25zdCBbeDEsIHkxLCB4LCB5XSA9IGFyZ3M7CiAgICAgICAgICBzdGF0ZS5jdXJyZW50UG9pbnRYID0geDsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFkgPSB5OwogICAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMuY3VydmVUbywgc3RhcnRYLCBzdGFydFksIHgxLCB5MSwgeCwgeSk7CiAgICAgICAgICBVdGlsLmJlemllckJvdW5kaW5nQm94KHN0YXJ0WCwgc3RhcnRZLCBzdGFydFgsIHN0YXJ0WSwgeDEsIHkxLCB4LCB5LCBtaW5NYXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIE9QUy5jdXJ2ZVRvMzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBzdGFydFggPSBzdGF0ZS5jdXJyZW50UG9pbnRYOwogICAgICAgICAgY29uc3Qgc3RhcnRZID0gc3RhdGUuY3VycmVudFBvaW50WTsKICAgICAgICAgIGNvbnN0IFt4MSwgeTEsIHgsIHldID0gYXJnczsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFggPSB4OwogICAgICAgICAgc3RhdGUuY3VycmVudFBvaW50WSA9IHk7CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5jdXJ2ZVRvLCB4MSwgeTEsIHgsIHksIHgsIHkpOwogICAgICAgICAgVXRpbC5iZXppZXJCb3VuZGluZ0JveChzdGFydFgsIHN0YXJ0WSwgeDEsIHkxLCB4LCB5LCB4LCB5LCBtaW5NYXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIE9QUy5jbG9zZVBhdGg6CiAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMuY2xvc2VQYXRoKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgX2dldENvbG9yU3BhY2UoY3MsIHJlc291cmNlcywgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHJldHVybiBDb2xvclNwYWNlVXRpbHMucGFyc2UoewogICAgICBjcywKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogdGhpcy5fcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgYXN5bmNJZk5vdENhY2hlZDogdHJ1ZQogICAgfSk7CiAgfQogIGFzeW5jIF9oYW5kbGVDb2xvclNwYWNlKGNzUHJvbWlzZSkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGF3YWl0IGNzUHJvbWlzZTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBfaGFuZGxlQ29sb3JTcGFjZSAtIGlnbm9yaW5nIENvbG9yU3BhY2U6ICIke2V4fSIuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdGhyb3cgZXg7CiAgICB9CiAgfQogIHBhcnNlU2hhZGluZyh7CiAgICBzaGFkaW5nLAogICAgcmVzb3VyY2VzLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUKICB9KSB7CiAgICBsZXQgaWQgPSBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuZ2V0KHNoYWRpbmcpOwogICAgaWYgKGlkKSB7CiAgICAgIHJldHVybiBpZDsKICAgIH0KICAgIGxldCBwYXR0ZXJuSVI7CiAgICB0cnkgewogICAgICBjb25zdCBzaGFkaW5nRmlsbCA9IFBhdHRlcm4ucGFyc2VTaGFkaW5nKHNoYWRpbmcsIHRoaXMueHJlZiwgcmVzb3VyY2VzLCB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgIHBhdHRlcm5JUiA9IHNoYWRpbmdGaWxsLmdldElSKCk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBwYXJzZVNoYWRpbmcgLSBpZ25vcmluZyBzaGFkaW5nOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuc2V0KHNoYWRpbmcsIG51bGwpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0KICAgIGlkID0gYHBhdHRlcm5fJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWA7CiAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgIGlkID0gYCR7dGhpcy5pZEZhY3RvcnkuZ2V0RG9jSWQoKX1fdHlwZTNfJHtpZH1gOwogICAgfQogICAgbG9jYWxTaGFkaW5nUGF0dGVybkNhY2hlLnNldChzaGFkaW5nLCBpZCk7CiAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgIHRoaXMuaGFuZGxlci5zZW5kKCJjb21tb25vYmoiLCBbaWQsICJQYXR0ZXJuIiwgcGF0dGVybklSXSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmhhbmRsZXIuc2VuZCgib2JqIiwgW2lkLCB0aGlzLnBhZ2VJbmRleCwgIlBhdHRlcm4iLCBwYXR0ZXJuSVJdKTsKICAgIH0KICAgIHJldHVybiBpZDsKICB9CiAgaGFuZGxlQ29sb3JOKG9wZXJhdG9yTGlzdCwgZm4sIGFyZ3MsIGNzLCBwYXR0ZXJucywgcmVzb3VyY2VzLCB0YXNrLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUsIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZSkgewogICAgY29uc3QgcGF0dGVybk5hbWUgPSBhcmdzLnBvcCgpOwogICAgaWYgKHBhdHRlcm5OYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCByYXdQYXR0ZXJuID0gcGF0dGVybnMuZ2V0UmF3KHBhdHRlcm5OYW1lLm5hbWUpOwogICAgICBjb25zdCBsb2NhbFRpbGluZ1BhdHRlcm4gPSByYXdQYXR0ZXJuIGluc3RhbmNlb2YgUmVmICYmIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLmdldEJ5UmVmKHJhd1BhdHRlcm4pOwogICAgICBpZiAobG9jYWxUaWxpbmdQYXR0ZXJuKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGNvbG9yID0gY3MuYmFzZSA/IGNzLmJhc2UuZ2V0UmdiSGV4KGFyZ3MsIDApIDogbnVsbDsKICAgICAgICAgIGNvbnN0IHRpbGluZ1BhdHRlcm5JUiA9IGdldFRpbGluZ1BhdHRlcm5JUihsb2NhbFRpbGluZ1BhdHRlcm4ub3BlcmF0b3JMaXN0SVIsIGxvY2FsVGlsaW5nUGF0dGVybi5kaWN0LCBjb2xvcik7CiAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHRpbGluZ1BhdHRlcm5JUik7CiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0gY2F0Y2gge30KICAgICAgfQogICAgICBjb25zdCBwYXR0ZXJuID0gdGhpcy54cmVmLmZldGNoSWZSZWYocmF3UGF0dGVybik7CiAgICAgIGlmIChwYXR0ZXJuKSB7CiAgICAgICAgY29uc3QgZGljdCA9IHBhdHRlcm4gaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gcGF0dGVybi5kaWN0IDogcGF0dGVybjsKICAgICAgICBjb25zdCB0eXBlTnVtID0gZGljdC5nZXQoIlBhdHRlcm5UeXBlIik7CiAgICAgICAgaWYgKHR5cGVOdW0gPT09IFBhdHRlcm5UeXBlLlRJTElORykgewogICAgICAgICAgY29uc3QgY29sb3IgPSBjcy5iYXNlID8gY3MuYmFzZS5nZXRSZ2JIZXgoYXJncywgMCkgOiBudWxsOwogICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVGlsaW5nVHlwZShmbiwgY29sb3IsIHJlc291cmNlcywgcGF0dGVybiwgZGljdCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlTnVtID09PSBQYXR0ZXJuVHlwZS5TSEFESU5HKSB7CiAgICAgICAgICBjb25zdCBzaGFkaW5nID0gZGljdC5nZXQoIlNoYWRpbmciKTsKICAgICAgICAgIGNvbnN0IG9iaklkID0gdGhpcy5wYXJzZVNoYWRpbmcoewogICAgICAgICAgICBzaGFkaW5nLAogICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKG9iaklkKSB7CiAgICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IGxvb2t1cE1hdHJpeChkaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgbnVsbCk7CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChmbiwgWyJTaGFkaW5nIiwgb2JqSWQsIG1hdHJpeF0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIFBhdHRlcm5UeXBlOiAke3R5cGVOdW19YCk7CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5rbm93biBQYXR0ZXJuTmFtZTogJHtwYXR0ZXJuTmFtZX1gKTsKICB9CiAgX3BhcnNlVmlzaWJpbGl0eUV4cHJlc3Npb24oYXJyYXksIG5lc3RpbmdDb3VudGVyLCBjdXJyZW50UmVzdWx0KSB7CiAgICBjb25zdCBNQVhfTkVTVElORyA9IDEwOwogICAgaWYgKCsrbmVzdGluZ0NvdW50ZXIgPiBNQVhfTkVTVElORykgewogICAgICB3YXJuKCJWaXNpYmlsaXR5IGV4cHJlc3Npb24gaXMgdG9vIGRlZXBseSBuZXN0ZWQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgY29uc3Qgb3BlcmF0b3IgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihhcnJheVswXSk7CiAgICBpZiAobGVuZ3RoIDwgMiB8fCAhKG9wZXJhdG9yIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgd2FybigiSW52YWxpZCB2aXNpYmlsaXR5IGV4cHJlc3Npb24iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3dpdGNoIChvcGVyYXRvci5uYW1lKSB7CiAgICAgIGNhc2UgIkFuZCI6CiAgICAgIGNhc2UgIk9yIjoKICAgICAgY2FzZSAiTm90IjoKICAgICAgICBjdXJyZW50UmVzdWx0LnB1c2gob3BlcmF0b3IubmFtZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgd2FybihgSW52YWxpZCBvcGVyYXRvciAke29wZXJhdG9yLm5hbWV9IGluIHZpc2liaWxpdHkgZXhwcmVzc2lvbmApOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgcmF3ID0gYXJyYXlbaV07CiAgICAgIGNvbnN0IG9iamVjdCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKHJhdyk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iamVjdCkpIHsKICAgICAgICBjb25zdCBuZXN0ZWRSZXN1bHQgPSBbXTsKICAgICAgICBjdXJyZW50UmVzdWx0LnB1c2gobmVzdGVkUmVzdWx0KTsKICAgICAgICB0aGlzLl9wYXJzZVZpc2liaWxpdHlFeHByZXNzaW9uKG9iamVjdCwgbmVzdGluZ0NvdW50ZXIsIG5lc3RlZFJlc3VsdCk7CiAgICAgIH0gZWxzZSBpZiAocmF3IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgY3VycmVudFJlc3VsdC5wdXNoKHJhdy50b1N0cmluZygpKTsKICAgICAgfQogICAgfQogIH0KICBhc3luYyBwYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhjb250ZW50UHJvcGVydGllcywgcmVzb3VyY2VzKSB7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKGNvbnRlbnRQcm9wZXJ0aWVzIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCBwcm9wZXJ0aWVzID0gcmVzb3VyY2VzLmdldCgiUHJvcGVydGllcyIpOwogICAgICBvcHRpb25hbENvbnRlbnQgPSBwcm9wZXJ0aWVzLmdldChjb250ZW50UHJvcGVydGllcy5uYW1lKTsKICAgIH0gZWxzZSBpZiAoY29udGVudFByb3BlcnRpZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIG9wdGlvbmFsQ29udGVudCA9IGNvbnRlbnRQcm9wZXJ0aWVzOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJPcHRpb25hbCBjb250ZW50IHByb3BlcnRpZXMgbWFsZm9ybWVkLiIpOwogICAgfQogICAgY29uc3Qgb3B0aW9uYWxDb250ZW50VHlwZSA9IG9wdGlvbmFsQ29udGVudC5nZXQoIlR5cGUiKT8ubmFtZTsKICAgIGlmIChvcHRpb25hbENvbnRlbnRUeXBlID09PSAiT0NHIikgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgaWQ6IG9wdGlvbmFsQ29udGVudC5vYmpJZAogICAgICB9OwogICAgfSBlbHNlIGlmIChvcHRpb25hbENvbnRlbnRUeXBlID09PSAiT0NNRCIpIHsKICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IG9wdGlvbmFsQ29udGVudC5nZXQoIlZFIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4cHJlc3Npb24pKSB7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgdGhpcy5fcGFyc2VWaXNpYmlsaXR5RXhwcmVzc2lvbihleHByZXNzaW9uLCAwLCByZXN1bHQpOwogICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogIk9DTUQiLAogICAgICAgICAgICBleHByZXNzaW9uOiByZXN1bHQKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IG9wdGlvbmFsQ29udGVudEdyb3VwcyA9IG9wdGlvbmFsQ29udGVudC5nZXQoIk9DR3MiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9uYWxDb250ZW50R3JvdXBzKSB8fCBvcHRpb25hbENvbnRlbnRHcm91cHMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgZ3JvdXBJZHMgPSBbXTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25hbENvbnRlbnRHcm91cHMpKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IG9jZyBvZiBvcHRpb25hbENvbnRlbnRHcm91cHMpIHsKICAgICAgICAgICAgZ3JvdXBJZHMucHVzaChvY2cudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdyb3VwSWRzLnB1c2gob3B0aW9uYWxDb250ZW50R3JvdXBzLm9iaklkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgICBpZHM6IGdyb3VwSWRzLAogICAgICAgICAgcG9saWN5OiBvcHRpb25hbENvbnRlbnQuZ2V0KCJQIikgaW5zdGFuY2VvZiBOYW1lID8gb3B0aW9uYWxDb250ZW50LmdldCgiUCIpLm5hbWUgOiBudWxsLAogICAgICAgICAgZXhwcmVzc2lvbjogbnVsbAogICAgICAgIH07CiAgICAgIH0gZWxzZSBpZiAob3B0aW9uYWxDb250ZW50R3JvdXBzIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgICBpZDogb3B0aW9uYWxDb250ZW50R3JvdXBzLnRvU3RyaW5nKCkKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0T3BlcmF0b3JMaXN0KHsKICAgIHN0cmVhbSwKICAgIHRhc2ssCiAgICByZXNvdXJjZXMsCiAgICBvcGVyYXRvckxpc3QsCiAgICBpbml0aWFsU3RhdGUgPSBudWxsLAogICAgZmFsbGJhY2tGb250RGljdCA9IG51bGwsCiAgICBwcmV2UmVmcyA9IG51bGwKICB9KSB7CiAgICBjb25zdCBvYmpJZCA9IHN0cmVhbS5kaWN0Py5vYmpJZDsKICAgIGNvbnN0IHNlZW5SZWZzID0gbmV3IFJlZlNldChwcmV2UmVmcyk7CiAgICBpZiAob2JqSWQpIHsKICAgICAgaWYgKHByZXZSZWZzPy5oYXMob2JqSWQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBjaXJjdWxhciByZWZlcmVuY2U6ICR7b2JqSWR9YCk7CiAgICAgIH0KICAgICAgc2VlblJlZnMucHV0KG9iaklkKTsKICAgIH0KICAgIHJlc291cmNlcyB8fD0gRGljdC5lbXB0eTsKICAgIGluaXRpYWxTdGF0ZSB8fD0gbmV3IEV2YWxTdGF0ZSgpOwogICAgaWYgKCFvcGVyYXRvckxpc3QpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRPcGVyYXRvckxpc3Q6IG1pc3NpbmcgIm9wZXJhdG9yTGlzdCIgcGFyYW1ldGVyJyk7CiAgICB9CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBsb2NhbEltYWdlQ2FjaGUgPSBuZXcgTG9jYWxJbWFnZUNhY2hlKCk7CiAgICBjb25zdCBsb2NhbENvbG9yU3BhY2VDYWNoZSA9IG5ldyBMb2NhbENvbG9yU3BhY2VDYWNoZSgpOwogICAgY29uc3QgbG9jYWxHU3RhdGVDYWNoZSA9IG5ldyBMb2NhbEdTdGF0ZUNhY2hlKCk7CiAgICBjb25zdCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSA9IG5ldyBMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSgpOwogICAgY29uc3QgbG9jYWxTaGFkaW5nUGF0dGVybkNhY2hlID0gbmV3IE1hcCgpOwogICAgY29uc3QgeG9ianMgPSByZXNvdXJjZXMuZ2V0KCJYT2JqZWN0IikgfHwgRGljdC5lbXB0eTsKICAgIGNvbnN0IHBhdHRlcm5zID0gcmVzb3VyY2VzLmdldCgiUGF0dGVybiIpIHx8IERpY3QuZW1wdHk7CiAgICBjb25zdCBzdGF0ZU1hbmFnZXIgPSBuZXcgU3RhdGVNYW5hZ2VyKGluaXRpYWxTdGF0ZSk7CiAgICBjb25zdCBwcmVwcm9jZXNzb3IgPSBuZXcgRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKTsKICAgIGNvbnN0IHRpbWVTbG90TWFuYWdlciA9IG5ldyBUaW1lU2xvdE1hbmFnZXIoKTsKICAgIGZ1bmN0aW9uIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoYXJndW1lbnQpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcHJlcHJvY2Vzc29yLnNhdmVkU3RhdGVzRGVwdGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5yZXN0b3JlLCBbXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiBwcm9taXNlQm9keShyZXNvbHZlLCByZWplY3QpIHsKICAgICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UsIG9wZXJhdG9yTGlzdC5yZWFkeV0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcHJvbWlzZUJvZHkocmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHJlamVjdChleCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgfTsKICAgICAgdGFzay5lbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgIHRpbWVTbG90TWFuYWdlci5yZXNldCgpOwogICAgICBjb25zdCBvcGVyYXRpb24gPSB7fTsKICAgICAgbGV0IHN0b3AsIGksIGlpLCBjcywgbmFtZSwgaXNWYWxpZE5hbWU7CiAgICAgIHdoaWxlICghKHN0b3AgPSB0aW1lU2xvdE1hbmFnZXIuY2hlY2soKSkpIHsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IG51bGw7CiAgICAgICAgaWYgKCFwcmVwcm9jZXNzb3IucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGV0IGFyZ3MgPSBvcGVyYXRpb24uYXJnczsKICAgICAgICBsZXQgZm4gPSBvcGVyYXRpb24uZm47CiAgICAgICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgICAgIGNhc2UgT1BTLnBhaW50WE9iamVjdDoKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeU5hbWUobmFtZSk7CiAgICAgICAgICAgICAgaWYgKGxvY2FsSW1hZ2UpIHsKICAgICAgICAgICAgICAgIGFkZENhY2hlZEltYWdlT3BzKG9wZXJhdG9yTGlzdCwgbG9jYWxJbWFnZSk7CiAgICAgICAgICAgICAgICBhcmdzID0gbnVsbDsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlWE9iamVjdCwgcmVqZWN0WE9iamVjdCkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiWE9iamVjdCBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCB4b2JqID0geG9ianMuZ2V0UmF3KG5hbWUpOwogICAgICAgICAgICAgIGlmICh4b2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYWNoZWRJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeVJlZih4b2JqKSB8fCBzZWxmLl9yZWdpb25hbEltYWdlQ2FjaGUuZ2V0QnlSZWYoeG9iaikgfHwgc2VsZi5nbG9iYWxJbWFnZUNhY2hlLmdldERhdGEoeG9iaiwgc2VsZi5wYWdlSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGNhY2hlZEltYWdlKSB7CiAgICAgICAgICAgICAgICAgIGFkZENhY2hlZEltYWdlT3BzKG9wZXJhdG9yTGlzdCwgY2FjaGVkSW1hZ2UpOwogICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4b2JqID0geHJlZi5mZXRjaCh4b2JqKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCEoeG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB4b2JqLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGhhdmUgYSBOYW1lIHN1YnR5cGUiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHR5cGUubmFtZSA9PT0gIkZvcm0iKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc2F2ZSgpOwogICAgICAgICAgICAgICAgc2VsZi5idWlsZEZvcm1YT2JqZWN0KHJlc291cmNlcywgeG9iaiwgbnVsbCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoewogICAgICAgICAgICAgICAgICBuZXdQYXRoOiB0cnVlCiAgICAgICAgICAgICAgICB9KSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgIH0sIHJlamVjdFhPYmplY3QpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZS5uYW1lID09PSAiSW1hZ2UiKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgIGltYWdlOiB4b2JqLAogICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUsCiAgICAgICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgICAgICB9KS50aGVuKHJlc29sdmVYT2JqZWN0LCByZWplY3RYT2JqZWN0KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUubmFtZSA9PT0gIlBTIikgewogICAgICAgICAgICAgICAgaW5mbygiSWdub3JlZCBYT2JqZWN0IHN1YnR5cGUgUFMiKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmhhbmRsZWQgWE9iamVjdCBzdWJ0eXBlICR7dHlwZS5uYW1lfWApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBYT2JqZWN0OiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNhc2UgT1BTLnNldEZvbnQ6CiAgICAgICAgICAgIGNvbnN0IGZvbnRTaXplID0gYXJnc1sxXTsKICAgICAgICAgICAgbmV4dChzZWxmLmhhbmRsZVNldEZvbnQocmVzb3VyY2VzLCBhcmdzLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlci5zdGF0ZSwgZmFsbGJhY2tGb250RGljdCkudGhlbihmdW5jdGlvbiAobG9hZGVkTmFtZSkgewogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGxvYWRlZE5hbWUpOwogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuc2V0Rm9udCwgW2xvYWRlZE5hbWUsIGZvbnRTaXplXSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuZW5kSW5saW5lSW1hZ2U6CiAgICAgICAgICAgIGNvbnN0IGNhY2hlS2V5ID0gYXJnc1swXS5jYWNoZUtleTsKICAgICAgICAgICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeU5hbWUoY2FjaGVLZXkpOwogICAgICAgICAgICAgIGlmIChsb2NhbEltYWdlKSB7CiAgICAgICAgICAgICAgICBhZGRDYWNoZWRJbWFnZU9wcyhvcGVyYXRvckxpc3QsIGxvY2FsSW1hZ2UpOwogICAgICAgICAgICAgICAgYXJncyA9IG51bGw7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dChzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICBpbWFnZTogYXJnc1swXSwKICAgICAgICAgICAgICBpc0lubGluZTogdHJ1ZSwKICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgY2FjaGVLZXksCiAgICAgICAgICAgICAgbG9jYWxJbWFnZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY29tYmluZWRHbHlwaHMgPSBbXSwKICAgICAgICAgICAgICBzdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZTsKICAgICAgICAgICAgZm9yIChjb25zdCBhcnJJdGVtIG9mIGFyZ3NbMF0pIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKC4uLnNlbGYuaGFuZGxlVGV4dChhcnJJdGVtLCBzdGF0ZSkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKGFyckl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzWzBdID0gY29tYmluZWRHbHlwaHM7CiAgICAgICAgICAgIGZuID0gT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMubmV4dExpbmUpOwogICAgICAgICAgICBhcmdzWzBdID0gc2VsZi5oYW5kbGVUZXh0KGFyZ3NbMF0sIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgIGZuID0gT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLm5leHRMaW5lKTsKICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5zZXRXb3JkU3BhY2luZywgW2FyZ3Muc2hpZnQoKV0pOwogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnNldENoYXJTcGFjaW5nLCBbYXJncy5zaGlmdCgpXSk7CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgZm4gPSBPUFMuc2hvd1RleHQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0VGV4dFJlbmRlcmluZ01vZGU6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS50ZXh0UmVuZGVyaW5nTW9kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yU3BhY2U6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zdCBmaWxsQ1MgPSBzZWxmLl9nZXRDb2xvclNwYWNlKGFyZ3NbMF0sIHJlc291cmNlcywgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgICAgICAgICAgIGlmIChmaWxsQ1MgaW5zdGFuY2VvZiBDb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuZmlsbENvbG9yU3BhY2UgPSBmaWxsQ1M7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbmV4dChzZWxmLl9oYW5kbGVDb2xvclNwYWNlKGZpbGxDUykudGhlbihjb2xvclNwYWNlID0+IHsKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2UgfHwgQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZToKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHN0cm9rZUNTID0gc2VsZi5fZ2V0Q29sb3JTcGFjZShhcmdzWzBdLCByZXNvdXJjZXMsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICAgICAgICBpZiAoc3Ryb2tlQ1MgaW5zdGFuY2VvZiBDb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IHN0cm9rZUNTOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG5leHQoc2VsZi5faGFuZGxlQ29sb3JTcGFjZShzdHJva2VDUykudGhlbihjb2xvclNwYWNlID0+IHsKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gY29sb3JTcGFjZSB8fCBDb2xvclNwYWNlVXRpbHMuZ3JheTsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3I6CiAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlOwogICAgICAgICAgICBhcmdzID0gW2NzLmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgIGZuID0gT1BTLnNldEZpbGxSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VDb2xvcjoKICAgICAgICAgICAgY3MgPSBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZTsKICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsR3JheToKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUdyYXk6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmNteWs7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUNNWUtDb2xvcjoKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2UgPSBDb2xvclNwYWNlVXRpbHMuY215azsKICAgICAgICAgICAgYXJncyA9IFtDb2xvclNwYWNlVXRpbHMuY215ay5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsUkdCQ29sb3I6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5yZ2I7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZVJHQkNvbG9yOgogICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5yZ2I7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvck46CiAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLnBhdHRlcm5GaWxsQ29sb3JTcGFjZTsKICAgICAgICAgICAgaWYgKCFjcykgewogICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KGFyZ3MsIG51bGwpKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gW0NvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgICAgICBmbiA9IE9QUy5zZXRGaWxsUkdCQ29sb3I7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXJncyA9IFtdOwogICAgICAgICAgICAgIGZuID0gT1BTLnNldEZpbGxUcmFuc3BhcmVudDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3MubmFtZSA9PT0gIlBhdHRlcm4iKSB7CiAgICAgICAgICAgICAgbmV4dChzZWxmLmhhbmRsZUNvbG9yTihvcGVyYXRvckxpc3QsIE9QUy5zZXRGaWxsQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRGaWxsUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JOOgogICAgICAgICAgICBjcyA9IHN0YXRlTWFuYWdlci5zdGF0ZS5wYXR0ZXJuU3Ryb2tlQ29sb3JTcGFjZTsKICAgICAgICAgICAgaWYgKCFjcykgewogICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KGFyZ3MsIG51bGwpKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gW0NvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhcmdzID0gW107CiAgICAgICAgICAgICAgZm4gPSBPUFMuc2V0U3Ryb2tlVHJhbnNwYXJlbnQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNzLm5hbWUgPT09ICJQYXR0ZXJuIikgewogICAgICAgICAgICAgIG5leHQoc2VsZi5oYW5kbGVDb2xvck4ob3BlcmF0b3JMaXN0LCBPUFMuc2V0U3Ryb2tlQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaGFkaW5nRmlsbDoKICAgICAgICAgICAgbGV0IHNoYWRpbmc7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uc3Qgc2hhZGluZ1JlcyA9IHJlc291cmNlcy5nZXQoIlNoYWRpbmciKTsKICAgICAgICAgICAgICBpZiAoIXNoYWRpbmdSZXMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gc2hhZGluZyByZXNvdXJjZSBmb3VuZCIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzaGFkaW5nID0gc2hhZGluZ1Jlcy5nZXQoYXJnc1swXS5uYW1lKTsKICAgICAgICAgICAgICBpZiAoIXNoYWRpbmcpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gc2hhZGluZyBvYmplY3QgZm91bmQiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBTaGFkaW5nOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcGF0dGVybklkID0gc2VsZi5wYXJzZVNoYWRpbmcoewogICAgICAgICAgICAgIHNoYWRpbmcsCiAgICAgICAgICAgICAgcmVzb3VyY2VzLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKCFwYXR0ZXJuSWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzID0gW3BhdHRlcm5JZF07CiAgICAgICAgICAgIGZuID0gT1BTLnNoYWRpbmdGaWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEdTdGF0ZToKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxHU3RhdGVPYmogPSBsb2NhbEdTdGF0ZUNhY2hlLmdldEJ5TmFtZShuYW1lKTsKICAgICAgICAgICAgICBpZiAobG9jYWxHU3RhdGVPYmopIHsKICAgICAgICAgICAgICAgIGlmIChsb2NhbEdTdGF0ZU9iai5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuc2V0R1N0YXRlLCBbbG9jYWxHU3RhdGVPYmpdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFyZ3MgPSBudWxsOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIG11c3QgYmUgcmVmZXJyZWQgdG8gYnkgbmFtZS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CiAgICAgICAgICAgICAgaWYgKCEoZXh0R1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRXh0R1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZSA9IGV4dEdTdGF0ZS5nZXQobmFtZSk7CiAgICAgICAgICAgICAgaWYgKCEoZ1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNlbGYuc2V0R1N0YXRlKHsKICAgICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICAgIGdTdGF0ZSwKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdCwKICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgdGFzaywKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlciwKICAgICAgICAgICAgICAgIGxvY2FsR1N0YXRlQ2FjaGUsCiAgICAgICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgICAgIHNlZW5SZWZzCiAgICAgICAgICAgICAgfSkudGhlbihyZXNvbHZlR1N0YXRlLCByZWplY3RHU3RhdGUpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBFeHRHU3RhdGU6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2V0TGluZVdpZHRoOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgW3RoaWNrbmVzc10gPSBhcmdzOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpY2tuZXNzICE9PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgd2FybihgSW52YWxpZCBzZXRMaW5lV2lkdGg6ICR7dGhpY2tuZXNzfWApOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFyZ3NbMF0gPSBNYXRoLmFicyh0aGlja25lc3MpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXREYXNoOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgZGFzaFBoYXNlID0gYXJnc1sxXTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhc2hQaGFzZSAhPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIHdhcm4oYEludmFsaWQgc2V0RGFzaDogJHtkYXNoUGhhc2V9YCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZGFzaEFycmF5ID0gYXJnc1swXTsKICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGFzaEFycmF5KSkgewogICAgICAgICAgICAgICAgd2FybihgSW52YWxpZCBzZXREYXNoOiAke2Rhc2hBcnJheX1gKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZGFzaEFycmF5LnNvbWUoeCA9PiB0eXBlb2YgeCAhPT0gIm51bWJlciIpKSB7CiAgICAgICAgICAgICAgICBhcmdzWzBdID0gZGFzaEFycmF5LmZpbHRlcih4ID0+IHR5cGVvZiB4ID09PSAibnVtYmVyIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5tb3ZlVG86CiAgICAgICAgICBjYXNlIE9QUy5saW5lVG86CiAgICAgICAgICBjYXNlIE9QUy5jdXJ2ZVRvOgogICAgICAgICAgY2FzZSBPUFMuY3VydmVUbzI6CiAgICAgICAgICBjYXNlIE9QUy5jdXJ2ZVRvMzoKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlUGF0aDoKICAgICAgICAgIGNhc2UgT1BTLnJlY3RhbmdsZToKICAgICAgICAgICAgc2VsZi5idWlsZFBhdGgoZm4sIGFyZ3MsIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBPUFMuc3Ryb2tlOgogICAgICAgICAgY2FzZSBPUFMuY2xvc2VTdHJva2U6CiAgICAgICAgICBjYXNlIE9QUy5maWxsOgogICAgICAgICAgY2FzZSBPUFMuZW9GaWxsOgogICAgICAgICAgY2FzZSBPUFMuZmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmVvRmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlRmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlRU9GaWxsU3Ryb2tlOgogICAgICAgICAgY2FzZSBPUFMuZW5kUGF0aDoKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIHN0YXRlOiB7CiAgICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIsCiAgICAgICAgICAgICAgICAgIHBhdGhNaW5NYXgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9ID0gc3RhdGVNYW5hZ2VyOwogICAgICAgICAgICAgIGlmIChmbiA9PT0gT1BTLmNsb3NlU3Ryb2tlIHx8IGZuID09PSBPUFMuY2xvc2VGaWxsU3Ryb2tlIHx8IGZuID09PSBPUFMuY2xvc2VFT0ZpbGxTdHJva2UpIHsKICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIucHVzaChEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChwYXRoQnVmZmVyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5jb25zdHJ1Y3RQYXRoLCBbZm4sIFtudWxsXSwgbnVsbF0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmNvbnN0cnVjdFBhdGgsIFtmbiwgW25ldyBGbG9hdDMyQXJyYXkocGF0aEJ1ZmZlcildLCBwYXRoTWluTWF4LnNsaWNlKCldKTsKICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgIHBhdGhNaW5NYXguc2V0KFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XSwgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXRUZXh0TWF0cml4OgogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIFtuZXcgRmxvYXQzMkFycmF5KGFyZ3MpXSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBPUFMubWFya1BvaW50OgogICAgICAgICAgY2FzZSBPUFMubWFya1BvaW50UHJvcHM6CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbkNvbXBhdDoKICAgICAgICAgIGNhc2UgT1BTLmVuZENvbXBhdDoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wczoKICAgICAgICAgICAgaWYgKCEoYXJnc1swXSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgd2FybihgRXhwZWN0ZWQgbmFtZSBmb3IgYmVnaW5NYXJrZWRDb250ZW50UHJvcHMgYXJnMD0ke2FyZ3NbMF19YCk7CiAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG51bGxdKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJnc1swXS5uYW1lID09PSAiT0MiKSB7CiAgICAgICAgICAgICAgbmV4dChzZWxmLnBhcnNlTWFya2VkQ29udGVudFByb3BzKGFyZ3NbMV0sIHJlc291cmNlcykudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBkYXRhXSk7CiAgICAgICAgICAgICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBiZWdpbk1hcmtlZENvbnRlbnRQcm9wczogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBudWxsXSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3MgPSBbYXJnc1swXS5uYW1lLCBhcmdzWzFdIGluc3RhbmNlb2YgRGljdCA/IGFyZ3NbMV0uZ2V0KCJNQ0lEIikgOiBudWxsXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbk1hcmtlZENvbnRlbnQ6CiAgICAgICAgICBjYXNlIE9QUy5lbmRNYXJrZWRDb250ZW50OgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgaWYgKGFyZ3MgIT09IG51bGwpIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGFyZ3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0gaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaSA8IGlpKSB7CiAgICAgICAgICAgICAgICB3YXJuKCJnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBvcGVyYXRvcjogIiArIGZuKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIGFyZ3MpOwogICAgICB9CiAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgbmV4dChkZWZlcnJlZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgcmVzb2x2ZSgpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgd2FybihgZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgZXJyb3JzIGR1cmluZyAiJHt0YXNrLm5hbWV9IiBgICsgYHRhc2s6ICIke3JlYXNvbn0iLmApOwogICAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhyb3cgcmVhc29uOwogICAgfSk7CiAgfQogIGdldFRleHRDb250ZW50KHsKICAgIHN0cmVhbSwKICAgIHRhc2ssCiAgICByZXNvdXJjZXMsCiAgICBzdGF0ZU1hbmFnZXIgPSBudWxsLAogICAgaW5jbHVkZU1hcmtlZENvbnRlbnQgPSBmYWxzZSwKICAgIHNpbmssCiAgICBzZWVuU3R5bGVzID0gbmV3IFNldCgpLAogICAgdmlld0JveCwKICAgIGxhbmcgPSBudWxsLAogICAgbWFya2VkQ29udGVudERhdGEgPSBudWxsLAogICAgZGlzYWJsZU5vcm1hbGl6YXRpb24gPSBmYWxzZSwKICAgIGtlZXBXaGl0ZVNwYWNlID0gZmFsc2UsCiAgICBwcmV2UmVmcyA9IG51bGwsCiAgICBpbnRlcnNlY3RvciA9IG51bGwKICB9KSB7CiAgICBjb25zdCBvYmpJZCA9IHN0cmVhbS5kaWN0Py5vYmpJZDsKICAgIGNvbnN0IHNlZW5SZWZzID0gbmV3IFJlZlNldChwcmV2UmVmcyk7CiAgICBpZiAob2JqSWQpIHsKICAgICAgaWYgKHByZXZSZWZzPy5oYXMob2JqSWQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIGNpcmN1bGFyIHJlZmVyZW5jZTogJHtvYmpJZH1gKTsKICAgICAgfQogICAgICBzZWVuUmVmcy5wdXQob2JqSWQpOwogICAgfQogICAgcmVzb3VyY2VzIHx8PSBEaWN0LmVtcHR5OwogICAgc3RhdGVNYW5hZ2VyIHx8PSBuZXcgU3RhdGVNYW5hZ2VyKG5ldyBUZXh0U3RhdGUoKSk7CiAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgbWFya2VkQ29udGVudERhdGEgfHw9IHsKICAgICAgICBsZXZlbDogMAogICAgICB9OwogICAgfQogICAgY29uc3QgdGV4dENvbnRlbnQgPSB7CiAgICAgIGl0ZW1zOiBbXSwKICAgICAgc3R5bGVzOiBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgICBsYW5nCiAgICB9OwogICAgY29uc3QgdGV4dENvbnRlbnRJdGVtID0gewogICAgICBpbml0aWFsaXplZDogZmFsc2UsCiAgICAgIHN0cjogW10sCiAgICAgIHRvdGFsV2lkdGg6IDAsCiAgICAgIHRvdGFsSGVpZ2h0OiAwLAogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwLAogICAgICB2ZXJ0aWNhbDogZmFsc2UsCiAgICAgIHByZXZUcmFuc2Zvcm06IG51bGwsCiAgICAgIHRleHRBZHZhbmNlU2NhbGU6IDAsCiAgICAgIHNwYWNlSW5GbG93TWluOiAwLAogICAgICBzcGFjZUluRmxvd01heDogMCwKICAgICAgdHJhY2tpbmdTcGFjZU1pbjogSW5maW5pdHksCiAgICAgIG5lZ2F0aXZlU3BhY2VNYXg6IC1JbmZpbml0eSwKICAgICAgbm90QVNwYWNlOiAtSW5maW5pdHksCiAgICAgIHRyYW5zZm9ybTogbnVsbCwKICAgICAgZm9udE5hbWU6IG51bGwsCiAgICAgIGhhc0VPTDogZmFsc2UKICAgIH07CiAgICBjb25zdCB0d29MYXN0Q2hhcnMgPSBbIiAiLCAiICJdOwogICAgbGV0IHR3b0xhc3RDaGFyc1BvcyA9IDA7CiAgICBmdW5jdGlvbiBzYXZlTGFzdENoYXIoY2hhcikgewogICAgICBjb25zdCBuZXh0UG9zID0gKHR3b0xhc3RDaGFyc1BvcyArIDEpICUgMjsKICAgICAgY29uc3QgcmV0ID0gdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gIT09ICIgIiAmJiB0d29MYXN0Q2hhcnNbbmV4dFBvc10gPT09ICIgIjsKICAgICAgdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gPSBjaGFyOwogICAgICB0d29MYXN0Q2hhcnNQb3MgPSBuZXh0UG9zOwogICAgICByZXR1cm4gIWtlZXBXaGl0ZVNwYWNlICYmIHJldDsKICAgIH0KICAgIGZ1bmN0aW9uIHNob3VsZEFkZFdoaXRlcHNhY2UoKSB7CiAgICAgIHJldHVybiAha2VlcFdoaXRlU3BhY2UgJiYgdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gIT09ICIgIiAmJiB0d29MYXN0Q2hhcnNbKHR3b0xhc3RDaGFyc1BvcyArIDEpICUgMl0gPT09ICIgIjsKICAgIH0KICAgIGZ1bmN0aW9uIHJlc2V0TGFzdENoYXJzKCkgewogICAgICB0d29MYXN0Q2hhcnNbMF0gPSB0d29MYXN0Q2hhcnNbMV0gPSAiICI7CiAgICAgIHR3b0xhc3RDaGFyc1BvcyA9IDA7CiAgICB9CiAgICBjb25zdCBUUkFDS0lOR19TUEFDRV9GQUNUT1IgPSAwLjEwMjsKICAgIGNvbnN0IE5PVF9BX1NQQUNFX0ZBQ1RPUiA9IDAuMDM7CiAgICBjb25zdCBORUdBVElWRV9TUEFDRV9GQUNUT1IgPSAtMC4yOwogICAgY29uc3QgU1BBQ0VfSU5fRkxPV19NSU5fRkFDVE9SID0gMC4xMDI7CiAgICBjb25zdCBTUEFDRV9JTl9GTE9XX01BWF9GQUNUT1IgPSAwLjY7CiAgICBjb25zdCBWRVJUSUNBTF9TSElGVF9SQVRJTyA9IDAuMjU7CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBzaG93U3BhY2VkVGV4dEJ1ZmZlciA9IFtdOwogICAgbGV0IHhvYmpzID0gbnVsbDsKICAgIGNvbnN0IGVtcHR5WE9iamVjdENhY2hlID0gbmV3IExvY2FsSW1hZ2VDYWNoZSgpOwogICAgY29uc3QgZW1wdHlHU3RhdGVDYWNoZSA9IG5ldyBMb2NhbEdTdGF0ZUNhY2hlKCk7CiAgICBjb25zdCBwcmVwcm9jZXNzb3IgPSBuZXcgRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKTsKICAgIGxldCB0ZXh0U3RhdGU7CiAgICBmdW5jdGlvbiBwdXNoV2hpdGVzcGFjZSh7CiAgICAgIHdpZHRoID0gMCwKICAgICAgaGVpZ2h0ID0gMCwKICAgICAgdHJhbnNmb3JtID0gdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0sCiAgICAgIGZvbnROYW1lID0gdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lCiAgICB9KSB7CiAgICAgIGludGVyc2VjdG9yPy5hZGRFeHRyYUNoYXIoIiAiKTsKICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaCh7CiAgICAgICAgc3RyOiAiICIsCiAgICAgICAgZGlyOiAibHRyIiwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgdHJhbnNmb3JtLAogICAgICAgIGZvbnROYW1lLAogICAgICAgIGhhc0VPTDogZmFsc2UKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpIHsKICAgICAgY29uc3QgZm9udCA9IHRleHRTdGF0ZS5mb250OwogICAgICBjb25zdCB0c20gPSBbdGV4dFN0YXRlLmZvbnRTaXplICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDAsIDAsIHRleHRTdGF0ZS5mb250U2l6ZSwgMCwgdGV4dFN0YXRlLnRleHRSaXNlXTsKICAgICAgaWYgKGZvbnQuaXNUeXBlM0ZvbnQgJiYgKHRleHRTdGF0ZS5mb250U2l6ZSA8PSAxIHx8IGZvbnQuaXNDaGFyQkJveCkgJiYgIWlzQXJyYXlFcXVhbCh0ZXh0U3RhdGUuZm9udE1hdHJpeCwgRk9OVF9JREVOVElUWV9NQVRSSVgpKSB7CiAgICAgICAgY29uc3QgZ2x5cGhIZWlnaHQgPSBmb250LmJib3hbM10gLSBmb250LmJib3hbMV07CiAgICAgICAgaWYgKGdseXBoSGVpZ2h0ID4gMCkgewogICAgICAgICAgdHNtWzNdICo9IGdseXBoSGVpZ2h0ICogdGV4dFN0YXRlLmZvbnRNYXRyaXhbM107CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBVdGlsLnRyYW5zZm9ybSh0ZXh0U3RhdGUuY3RtLCBVdGlsLnRyYW5zZm9ybSh0ZXh0U3RhdGUudGV4dE1hdHJpeCwgdHNtKSk7CiAgICB9CiAgICBmdW5jdGlvbiBlbnN1cmVUZXh0Q29udGVudEl0ZW0oKSB7CiAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm4gdGV4dENvbnRlbnRJdGVtOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBmb250LAogICAgICAgIGxvYWRlZE5hbWUKICAgICAgfSA9IHRleHRTdGF0ZTsKICAgICAgaWYgKCFzZWVuU3R5bGVzLmhhcyhsb2FkZWROYW1lKSkgewogICAgICAgIHNlZW5TdHlsZXMuYWRkKGxvYWRlZE5hbWUpOwogICAgICAgIHRleHRDb250ZW50LnN0eWxlc1tsb2FkZWROYW1lXSA9IHsKICAgICAgICAgIGZvbnRGYW1pbHk6IGZvbnQuZmFsbGJhY2tOYW1lLAogICAgICAgICAgYXNjZW50OiBmb250LmFzY2VudCwKICAgICAgICAgIGRlc2NlbnQ6IGZvbnQuZGVzY2VudCwKICAgICAgICAgIHZlcnRpY2FsOiBmb250LnZlcnRpY2FsCiAgICAgICAgfTsKICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmZvbnRFeHRyYVByb3BlcnRpZXMgJiYgZm9udC5zeXN0ZW1Gb250SW5mbykgewogICAgICAgICAgY29uc3Qgc3R5bGUgPSB0ZXh0Q29udGVudC5zdHlsZXNbbG9hZGVkTmFtZV07CiAgICAgICAgICBzdHlsZS5mb250U3Vic3RpdHV0aW9uID0gZm9udC5zeXN0ZW1Gb250SW5mby5jc3M7CiAgICAgICAgICBzdHlsZS5mb250U3Vic3RpdHV0aW9uTG9hZGVkTmFtZSA9IGZvbnQuc3lzdGVtRm9udEluZm8ubG9hZGVkTmFtZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lID0gbG9hZGVkTmFtZTsKICAgICAgY29uc3QgdHJtID0gdGV4dENvbnRlbnRJdGVtLnRyYW5zZm9ybSA9IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCk7CiAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCA9IHRleHRDb250ZW50SXRlbS50b3RhbFdpZHRoID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gTWF0aC5oeXBvdCh0cm1bMl0sIHRybVszXSk7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsV2lkdGggPSBNYXRoLmh5cG90KHRybVswXSwgdHJtWzFdKTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udmVydGljYWwgPSB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IHNjYWxlTGluZVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeFswXSwgdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzFdKTsKICAgICAgY29uc3Qgc2NhbGVDdG1YID0gTWF0aC5oeXBvdCh0ZXh0U3RhdGUuY3RtWzBdLCB0ZXh0U3RhdGUuY3RtWzFdKTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUN0bVggKiBzY2FsZUxpbmVYOwogICAgICBjb25zdCB7CiAgICAgICAgZm9udFNpemUKICAgICAgfSA9IHRleHRTdGF0ZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRyYWNraW5nU3BhY2VNaW4gPSBmb250U2l6ZSAqIFRSQUNLSU5HX1NQQUNFX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLm5vdEFTcGFjZSA9IGZvbnRTaXplICogTk9UX0FfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0ubmVnYXRpdmVTcGFjZU1heCA9IGZvbnRTaXplICogTkVHQVRJVkVfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0uc3BhY2VJbkZsb3dNaW4gPSBmb250U2l6ZSAqIFNQQUNFX0lOX0ZMT1dfTUlOX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLnNwYWNlSW5GbG93TWF4ID0gZm9udFNpemUgKiBTUEFDRV9JTl9GTE9XX01BWF9GQUNUT1I7CiAgICAgIHRleHRDb250ZW50SXRlbS5oYXNFT0wgPSBmYWxzZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRleHRDb250ZW50SXRlbTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUFkdmFuY2VTY2FsZSgpIHsKICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgc2NhbGVMaW5lWCA9IE1hdGguaHlwb3QodGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzBdLCB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXhbMV0pOwogICAgICBjb25zdCBzY2FsZUN0bVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS5jdG1bMF0sIHRleHRTdGF0ZS5jdG1bMV0pOwogICAgICBjb25zdCBzY2FsZUZhY3RvciA9IHNjYWxlQ3RtWCAqIHNjYWxlTGluZVg7CiAgICAgIGlmIChzY2FsZUZhY3RvciA9PT0gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0udmVydGljYWwpIHsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udG90YWxXaWR0aCArPSB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKiB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRleHRDb250ZW50SXRlbS50b3RhbEhlaWdodCArPSB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCA9IDA7CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUZhY3RvcjsKICAgIH0KICAgIGZ1bmN0aW9uIHJ1bkJpZGlUcmFuc2Zvcm0odGV4dENodW5rKSB7CiAgICAgIGxldCB0ZXh0ID0gdGV4dENodW5rLnN0ci5qb2luKCIiKTsKICAgICAgaWYgKCFkaXNhYmxlTm9ybWFsaXphdGlvbikgewogICAgICAgIHRleHQgPSBub3JtYWxpemVVbmljb2RlKHRleHQpOwogICAgICB9CiAgICAgIGNvbnN0IGJpZGlSZXN1bHQgPSBiaWRpKHRleHQsIC0xLCB0ZXh0Q2h1bmsudmVydGljYWwpOwogICAgICByZXR1cm4gewogICAgICAgIHN0cjogYmlkaVJlc3VsdC5zdHIsCiAgICAgICAgZGlyOiBiaWRpUmVzdWx0LmRpciwKICAgICAgICB3aWR0aDogTWF0aC5hYnModGV4dENodW5rLnRvdGFsV2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5hYnModGV4dENodW5rLnRvdGFsSGVpZ2h0KSwKICAgICAgICB0cmFuc2Zvcm06IHRleHRDaHVuay50cmFuc2Zvcm0sCiAgICAgICAgZm9udE5hbWU6IHRleHRDaHVuay5mb250TmFtZSwKICAgICAgICBoYXNFT0w6IHRleHRDaHVuay5oYXNFT0wKICAgICAgfTsKICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNldEZvbnQoZm9udE5hbWUsIGZvbnRSZWYpIHsKICAgICAgY29uc3QgdHJhbnNsYXRlZCA9IGF3YWl0IHNlbGYubG9hZEZvbnQoZm9udE5hbWUsIGZvbnRSZWYsIHJlc291cmNlcywgdGFzayk7CiAgICAgIHRleHRTdGF0ZS5sb2FkZWROYW1lID0gdHJhbnNsYXRlZC5sb2FkZWROYW1lOwogICAgICB0ZXh0U3RhdGUuZm9udCA9IHRyYW5zbGF0ZWQuZm9udDsKICAgICAgdGV4dFN0YXRlLmZvbnRNYXRyaXggPSB0cmFuc2xhdGVkLmZvbnQuZm9udE1hdHJpeCB8fCBGT05UX0lERU5USVRZX01BVFJJWDsKICAgIH0KICAgIGZ1bmN0aW9uIGFwcGx5SW52ZXJzZVJvdGF0aW9uKHgsIHksIG1hdHJpeCkgewogICAgICBjb25zdCBzY2FsZSA9IE1hdGguaHlwb3QobWF0cml4WzBdLCBtYXRyaXhbMV0pOwogICAgICByZXR1cm4gWyhtYXRyaXhbMF0gKiB4ICsgbWF0cml4WzFdICogeSkgLyBzY2FsZSwgKG1hdHJpeFsyXSAqIHggKyBtYXRyaXhbM10gKiB5KSAvIHNjYWxlXTsKICAgIH0KICAgIGZ1bmN0aW9uIGNvbXBhcmVXaXRoTGFzdFBvc2l0aW9uKGdseXBoV2lkdGgpIHsKICAgICAgY29uc3QgY3VycmVudFRyYW5zZm9ybSA9IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCk7CiAgICAgIGxldCBwb3NYID0gY3VycmVudFRyYW5zZm9ybVs0XTsKICAgICAgbGV0IHBvc1kgPSBjdXJyZW50VHJhbnNmb3JtWzVdOwogICAgICBpZiAodGV4dFN0YXRlLmZvbnQ/LnZlcnRpY2FsKSB7CiAgICAgICAgaWYgKHBvc1ggPCB2aWV3Qm94WzBdIHx8IHBvc1ggPiB2aWV3Qm94WzJdIHx8IHBvc1kgKyBnbHlwaFdpZHRoIDwgdmlld0JveFsxXSB8fCBwb3NZID4gdmlld0JveFszXSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwb3NYICsgZ2x5cGhXaWR0aCA8IHZpZXdCb3hbMF0gfHwgcG9zWCA+IHZpZXdCb3hbMl0gfHwgcG9zWSA8IHZpZXdCb3hbMV0gfHwgcG9zWSA+IHZpZXdCb3hbM10pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0U3RhdGUuZm9udCB8fCAhdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBsZXQgbGFzdFBvc1ggPSB0ZXh0Q29udGVudEl0ZW0ucHJldlRyYW5zZm9ybVs0XTsKICAgICAgbGV0IGxhc3RQb3NZID0gdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm1bNV07CiAgICAgIGlmIChsYXN0UG9zWCA9PT0gcG9zWCAmJiBsYXN0UG9zWSA9PT0gcG9zWSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGxldCByb3RhdGUgPSAtMTsKICAgICAgaWYgKGN1cnJlbnRUcmFuc2Zvcm1bMF0gJiYgY3VycmVudFRyYW5zZm9ybVsxXSA9PT0gMCAmJiBjdXJyZW50VHJhbnNmb3JtWzJdID09PSAwKSB7CiAgICAgICAgcm90YXRlID0gY3VycmVudFRyYW5zZm9ybVswXSA+IDAgPyAwIDogMTgwOwogICAgICB9IGVsc2UgaWYgKGN1cnJlbnRUcmFuc2Zvcm1bMV0gJiYgY3VycmVudFRyYW5zZm9ybVswXSA9PT0gMCAmJiBjdXJyZW50VHJhbnNmb3JtWzNdID09PSAwKSB7CiAgICAgICAgcm90YXRlID0gY3VycmVudFRyYW5zZm9ybVsxXSA+IDAgPyA5MCA6IDI3MDsKICAgICAgfQogICAgICBzd2l0Y2ggKHJvdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICBbcG9zWCwgcG9zWV0gPSBbcG9zWSwgcG9zWF07CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFtsYXN0UG9zWSwgbGFzdFBvc1hdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxODA6CiAgICAgICAgICBbcG9zWCwgcG9zWSwgbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFstcG9zWCwgLXBvc1ksIC1sYXN0UG9zWCwgLWxhc3RQb3NZXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjcwOgogICAgICAgICAgW3Bvc1gsIHBvc1ldID0gWy1wb3NZLCAtcG9zWF07CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFstbGFzdFBvc1ksIC1sYXN0UG9zWF07CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgW3Bvc1gsIHBvc1ldID0gYXBwbHlJbnZlcnNlUm90YXRpb24ocG9zWCwgcG9zWSwgY3VycmVudFRyYW5zZm9ybSk7CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IGFwcGx5SW52ZXJzZVJvdGF0aW9uKGxhc3RQb3NYLCBsYXN0UG9zWSwgdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0pOwogICAgICB9CiAgICAgIGlmICh0ZXh0U3RhdGUuZm9udC52ZXJ0aWNhbCkgewogICAgICAgIGNvbnN0IGFkdmFuY2VZID0gKGxhc3RQb3NZIC0gcG9zWSkgLyB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgICBjb25zdCBhZHZhbmNlWCA9IHBvc1ggLSBsYXN0UG9zWDsKICAgICAgICBjb25zdCB0ZXh0T3JpZW50YXRpb24gPSBNYXRoLnNpZ24odGV4dENvbnRlbnRJdGVtLmhlaWdodCk7CiAgICAgICAgaWYgKGFkdmFuY2VZIDwgdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5lZ2F0aXZlU3BhY2VNYXgpIHsKICAgICAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWCkgPiAwLjUgKiB0ZXh0Q29udGVudEl0ZW0ud2lkdGgpIHsKICAgICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VYKSA+IHRleHRDb250ZW50SXRlbS53aWR0aCkgewogICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFkdmFuY2VZIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5ub3RBU3BhY2UpIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChhZHZhbmNlWSA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0udHJhY2tpbmdTcGFjZU1pbikgewogICAgICAgICAgaWYgKHNob3VsZEFkZFdoaXRlcHNhY2UoKSkgewogICAgICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmFicyhhZHZhbmNlWSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICs9IGFkdmFuY2VZOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWFkZEZha2VTcGFjZXMoYWR2YW5jZVksIHRleHRDb250ZW50SXRlbS5wcmV2VHJhbnNmb3JtLCB0ZXh0T3JpZW50YXRpb24pKSB7CiAgICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLnN0ci5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgICAgICAgIGhlaWdodDogTWF0aC5hYnMoYWR2YW5jZVkpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCArPSBhZHZhbmNlWTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VYKSA+IHRleHRDb250ZW50SXRlbS53aWR0aCAqIFZFUlRJQ0FMX1NISUZUX1JBVElPKSB7CiAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBjb25zdCBhZHZhbmNlWCA9IChwb3NYIC0gbGFzdFBvc1gpIC8gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgIGNvbnN0IGFkdmFuY2VZID0gcG9zWSAtIGxhc3RQb3NZOwogICAgICBjb25zdCB0ZXh0T3JpZW50YXRpb24gPSBNYXRoLnNpZ24odGV4dENvbnRlbnRJdGVtLndpZHRoKTsKICAgICAgaWYgKGFkdmFuY2VYIDwgdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5lZ2F0aXZlU3BhY2VNYXgpIHsKICAgICAgICBpZiAoTWF0aC5hYnMoYWR2YW5jZVkpID4gMC41ICogdGV4dENvbnRlbnRJdGVtLmhlaWdodCkgewogICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWSkgPiB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0KSB7CiAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKGFkdmFuY2VYIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5ub3RBU3BhY2UpIHsKICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICB9CiAgICAgIGlmIChhZHZhbmNlWCA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0udHJhY2tpbmdTcGFjZU1pbikgewogICAgICAgIGlmIChzaG91bGRBZGRXaGl0ZXBzYWNlKCkpIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgICAgICB3aWR0aDogTWF0aC5hYnMoYWR2YW5jZVgpCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoICs9IGFkdmFuY2VYOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghYWRkRmFrZVNwYWNlcyhhZHZhbmNlWCwgdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0sIHRleHRPcmllbnRhdGlvbikpIHsKICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLnN0ci5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmFicyhhZHZhbmNlWCkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKz0gYWR2YW5jZVg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWSkgPiB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogVkVSVElDQUxfU0hJRlRfUkFUSU8pIHsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICBjaGFycywKICAgICAgZXh0cmFTcGFjaW5nCiAgICB9KSB7CiAgICAgIGNvbnN0IGZvbnQgPSB0ZXh0U3RhdGUuZm9udDsKICAgICAgaWYgKCFjaGFycykgewogICAgICAgIGNvbnN0IGNoYXJTcGFjaW5nID0gdGV4dFN0YXRlLmNoYXJTcGFjaW5nICsgZXh0cmFTcGFjaW5nOwogICAgICAgIGlmIChjaGFyU3BhY2luZykgewogICAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KGNoYXJTcGFjaW5nICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgLWNoYXJTcGFjaW5nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGtlZXBXaGl0ZVNwYWNlKSB7CiAgICAgICAgICBjb21wYXJlV2l0aExhc3RQb3NpdGlvbigwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGdseXBocyA9IGZvbnQuY2hhcnNUb0dseXBocyhjaGFycyk7CiAgICAgIGNvbnN0IHNjYWxlID0gdGV4dFN0YXRlLmZvbnRNYXRyaXhbMF0gKiB0ZXh0U3RhdGUuZm9udFNpemU7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgICAgY29uc3QgewogICAgICAgICAgY2F0ZWdvcnksCiAgICAgICAgICBvcmlnaW5hbENoYXJDb2RlCiAgICAgICAgfSA9IGdseXBoOwogICAgICAgIGlmIChjYXRlZ29yeS5pc0ludmlzaWJsZUZvcm1hdE1hcmspIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsZXQgY2hhclNwYWNpbmcgPSB0ZXh0U3RhdGUuY2hhclNwYWNpbmcgKyAoaSArIDEgPT09IGlpID8gZXh0cmFTcGFjaW5nIDogMCk7CiAgICAgICAgbGV0IGdseXBoV2lkdGggPSBnbHlwaC53aWR0aDsKICAgICAgICBpZiAoZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgZ2x5cGhXaWR0aCA9IGdseXBoLnZtZXRyaWMgPyBnbHlwaC52bWV0cmljWzBdIDogLWdseXBoV2lkdGg7CiAgICAgICAgfQogICAgICAgIGxldCBzY2FsZWREaW0gPSBnbHlwaFdpZHRoICogc2NhbGU7CiAgICAgICAgaWYgKG9yaWdpbmFsQ2hhckNvZGUgPT09IDB4MjApIHsKICAgICAgICAgIGNoYXJTcGFjaW5nICs9IHRleHRTdGF0ZS53b3JkU3BhY2luZzsKICAgICAgICB9CiAgICAgICAgaWYgKCFrZWVwV2hpdGVTcGFjZSAmJiBjYXRlZ29yeS5pc1doaXRlc3BhY2UpIHsKICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICBjaGFyU3BhY2luZyArPSBzY2FsZWREaW07CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KGNoYXJTcGFjaW5nICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhclNwYWNpbmcgKz0gLXNjYWxlZERpbTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgLWNoYXJTcGFjaW5nKTsKICAgICAgICAgIH0KICAgICAgICAgIHNhdmVMYXN0Q2hhcigiICIpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghY2F0ZWdvcnkuaXNaZXJvV2lkdGhEaWFjcml0aWMgJiYgIWNvbXBhcmVXaXRoTGFzdFBvc2l0aW9uKHNjYWxlZERpbSkpIHsKICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeChzY2FsZWREaW0gKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeCgwLCBzY2FsZWREaW0pOwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRleHRDaHVuayA9IGVuc3VyZVRleHRDb250ZW50SXRlbSgpOwogICAgICAgIGlmIChjYXRlZ29yeS5pc1plcm9XaWR0aERpYWNyaXRpYykgewogICAgICAgICAgc2NhbGVkRGltID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICBzY2FsZWREaW0gKj0gdGV4dFN0YXRlLnRleHRIU2NhbGU7CiAgICAgICAgICBpbnRlcnNlY3Rvcj8uYWRkR2x5cGgoZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKSwgc2NhbGVkRGltLCAwLCBnbHlwaC51bmljb2RlKTsKICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KHNjYWxlZERpbSwgMCk7CiAgICAgICAgICB0ZXh0Q2h1bmsud2lkdGggKz0gc2NhbGVkRGltOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpbnRlcnNlY3Rvcj8uYWRkR2x5cGgoZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKSwgMCwgc2NhbGVkRGltLCBnbHlwaC51bmljb2RlKTsKICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KDAsIHNjYWxlZERpbSk7CiAgICAgICAgICBzY2FsZWREaW0gPSBNYXRoLmFicyhzY2FsZWREaW0pOwogICAgICAgICAgdGV4dENodW5rLmhlaWdodCArPSBzY2FsZWREaW07CiAgICAgICAgfQogICAgICAgIGlmIChzY2FsZWREaW0pIHsKICAgICAgICAgIHRleHRDaHVuay5wcmV2VHJhbnNmb3JtID0gZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZ2x5cGhVbmljb2RlID0gZ2x5cGgudW5pY29kZTsKICAgICAgICBpZiAoc2F2ZUxhc3RDaGFyKGdseXBoVW5pY29kZSkpIHsKICAgICAgICAgIHRleHRDaHVuay5zdHIucHVzaCgiICIpOwogICAgICAgICAgaW50ZXJzZWN0b3I/LmFkZEV4dHJhQ2hhcigiICIpOwogICAgICAgIH0KICAgICAgICBpZiAoIWludGVyc2VjdG9yKSB7CiAgICAgICAgICB0ZXh0Q2h1bmsuc3RyLnB1c2goZ2x5cGhVbmljb2RlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNoYXJTcGFjaW5nKSB7CiAgICAgICAgICBpZiAoIWZvbnQudmVydGljYWwpIHsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoY2hhclNwYWNpbmcgKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeCgwLCAtY2hhclNwYWNpbmcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYXBwZW5kRU9MKCkgewogICAgICBpbnRlcnNlY3Rvcj8uYWRkRXh0cmFDaGFyKCJcbiIpOwogICAgICByZXNldExhc3RDaGFycygpOwogICAgICBpZiAodGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkKSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhhc0VPTCA9IHRydWU7CiAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICAgIHN0cjogIiIsCiAgICAgICAgICBkaXI6ICJsdHIiLAogICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICB0cmFuc2Zvcm06IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCksCiAgICAgICAgICBmb250TmFtZTogdGV4dFN0YXRlLmxvYWRlZE5hbWUsCiAgICAgICAgICBoYXNFT0w6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYWRkRmFrZVNwYWNlcyh3aWR0aCwgdHJhbnNmLCB0ZXh0T3JpZW50YXRpb24pIHsKICAgICAgaWYgKHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5zcGFjZUluRmxvd01pbiA8PSB3aWR0aCAmJiB3aWR0aCA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0uc3BhY2VJbkZsb3dNYXgpIHsKICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkKSB7CiAgICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgICAgdGV4dENvbnRlbnRJdGVtLnN0ci5wdXNoKCIgIik7CiAgICAgICAgICBpbnRlcnNlY3Rvcj8uYWRkRXh0cmFDaGFyKCIgIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBmb250TmFtZSA9IHRleHRDb250ZW50SXRlbS5mb250TmFtZTsKICAgICAgbGV0IGhlaWdodCA9IDA7CiAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0udmVydGljYWwpIHsKICAgICAgICBoZWlnaHQgPSB3aWR0aDsKICAgICAgICB3aWR0aCA9IDA7CiAgICAgIH0KICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgIHdpZHRoOiBNYXRoLmFicyh3aWR0aCksCiAgICAgICAgaGVpZ2h0OiBNYXRoLmFicyhoZWlnaHQpLAogICAgICAgIHRyYW5zZm9ybTogdHJhbnNmIHx8IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCksCiAgICAgICAgZm9udE5hbWUKICAgICAgfSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gZmx1c2hUZXh0Q29udGVudEl0ZW0oKSB7CiAgICAgIGlmICghdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkIHx8ICF0ZXh0Q29udGVudEl0ZW0uc3RyKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghdGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsKSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRvdGFsV2lkdGggKz0gdGV4dENvbnRlbnRJdGVtLndpZHRoICogdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ICs9IHRleHRDb250ZW50SXRlbS5oZWlnaHQgKiB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgfQogICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHJ1bkJpZGlUcmFuc2Zvcm0odGV4dENvbnRlbnRJdGVtKSk7CiAgICAgIHRleHRDb250ZW50SXRlbS5pbml0aWFsaXplZCA9IGZhbHNlOwogICAgICB0ZXh0Q29udGVudEl0ZW0uc3RyLmxlbmd0aCA9IDA7CiAgICB9CiAgICBmdW5jdGlvbiBlbnF1ZXVlQ2h1bmsoYmF0Y2ggPSBmYWxzZSkgewogICAgICBjb25zdCBsZW5ndGggPSB0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGg7CiAgICAgIGlmIChsZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGJhdGNoICYmIGxlbmd0aCA8IFRFWFRfQ0hVTktfQkFUQ0hfU0laRSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBzaW5rPy5lbnF1ZXVlKHRleHRDb250ZW50LCBsZW5ndGgpOwogICAgICB0ZXh0Q29udGVudC5pdGVtcyA9IFtdOwogICAgICB0ZXh0Q29udGVudC5zdHlsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgY29uc3QgdGltZVNsb3RNYW5hZ2VyID0gbmV3IFRpbWVTbG90TWFuYWdlcigpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCkgewogICAgICBjb25zdCBuZXh0ID0gZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICBlbnF1ZXVlQ2h1bmsodHJ1ZSk7CiAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UsIHNpbms/LnJlYWR5XSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBwcm9taXNlQm9keShyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgcmVqZWN0KGV4KTsKICAgICAgICAgIH0KICAgICAgICB9LCByZWplY3QpOwogICAgICB9OwogICAgICB0YXNrLmVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgdGltZVNsb3RNYW5hZ2VyLnJlc2V0KCk7CiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IHt9OwogICAgICBsZXQgc3RvcCwKICAgICAgICBuYW1lLAogICAgICAgIGlzVmFsaWROYW1lLAogICAgICAgIGFyZ3MgPSBbXTsKICAgICAgd2hpbGUgKCEoc3RvcCA9IHRpbWVTbG90TWFuYWdlci5jaGVjaygpKSkgewogICAgICAgIGFyZ3MubGVuZ3RoID0gMDsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKCFwcmVwcm9jZXNzb3IucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0ZSA9IHRleHRTdGF0ZTsKICAgICAgICB0ZXh0U3RhdGUgPSBzdGF0ZU1hbmFnZXIuc3RhdGU7CiAgICAgICAgY29uc3QgZm4gPSBvcGVyYXRpb24uZm47CiAgICAgICAgYXJncyA9IG9wZXJhdGlvbi5hcmdzOwogICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGb250OgogICAgICAgICAgICBjb25zdCBmb250TmFtZUFyZyA9IGFyZ3NbMF0ubmFtZSwKICAgICAgICAgICAgICBmb250U2l6ZUFyZyA9IGFyZ3NbMV07CiAgICAgICAgICAgIGlmICh0ZXh0U3RhdGUuZm9udCAmJiBmb250TmFtZUFyZyA9PT0gdGV4dFN0YXRlLmZvbnROYW1lICYmIGZvbnRTaXplQXJnID09PSB0ZXh0U3RhdGUuZm9udFNpemUpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICB0ZXh0U3RhdGUuZm9udE5hbWUgPSBmb250TmFtZUFyZzsKICAgICAgICAgICAgdGV4dFN0YXRlLmZvbnRTaXplID0gZm9udFNpemVBcmc7CiAgICAgICAgICAgIG5leHQoaGFuZGxlU2V0Rm9udChmb250TmFtZUFyZywgbnVsbCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIE9QUy5zZXRUZXh0UmlzZToKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRSaXNlID0gYXJnc1swXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRIU2NhbGU6CiAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0SFNjYWxlID0gYXJnc1swXSAvIDEwMDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRMZWFkaW5nOgogICAgICAgICAgICB0ZXh0U3RhdGUubGVhZGluZyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMubW92ZVRleHQ6CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRNYXRyaXggPSB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRMZWFkaW5nTW92ZVRleHQ6CiAgICAgICAgICAgIHRleHRTdGF0ZS5sZWFkaW5nID0gLWFyZ3NbMV07CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRNYXRyaXggPSB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZToKICAgICAgICAgICAgdGV4dFN0YXRlLmNhcnJpYWdlUmV0dXJuKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0VGV4dE1hdHJpeDoKICAgICAgICAgICAgdGV4dFN0YXRlLnNldFRleHRNYXRyaXgoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSwgYXJnc1s0XSwgYXJnc1s1XSk7CiAgICAgICAgICAgIHRleHRTdGF0ZS5zZXRUZXh0TGluZU1hdHJpeChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdKTsKICAgICAgICAgICAgdXBkYXRlQWR2YW5jZVNjYWxlKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0Q2hhclNwYWNpbmc6CiAgICAgICAgICAgIHRleHRTdGF0ZS5jaGFyU3BhY2luZyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0V29yZFNwYWNpbmc6CiAgICAgICAgICAgIHRleHRTdGF0ZS53b3JkU3BhY2luZyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuYmVnaW5UZXh0OgogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dE1hdHJpeCA9IElERU5USVRZX01BVFJJWC5zbGljZSgpOwogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXggPSBJREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc3BhY2VGYWN0b3IgPSAodGV4dFN0YXRlLmZvbnQudmVydGljYWwgPyAxIDogLTEpICogdGV4dFN0YXRlLmZvbnRTaXplIC8gMTAwMDsKICAgICAgICAgICAgY29uc3QgZWxlbWVudHMgPSBhcmdzWzBdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGVsZW1lbnRzW2ldOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgIHNob3dTcGFjZWRUZXh0QnVmZmVyLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaXRlbSA9PT0gIm51bWJlciIgJiYgaXRlbSAhPT0gMCkgewogICAgICAgICAgICAgICAgY29uc3Qgc3RyID0gc2hvd1NwYWNlZFRleHRCdWZmZXIuam9pbigiIik7CiAgICAgICAgICAgICAgICBzaG93U3BhY2VkVGV4dEJ1ZmZlci5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgICAgICBjaGFyczogc3RyLAogICAgICAgICAgICAgICAgICBleHRyYVNwYWNpbmc6IGl0ZW0gKiBzcGFjZUZhY3RvcgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzaG93U3BhY2VkVGV4dEJ1ZmZlci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3Qgc3RyID0gc2hvd1NwYWNlZFRleHRCdWZmZXIuam9pbigiIik7CiAgICAgICAgICAgICAgc2hvd1NwYWNlZFRleHRCdWZmZXIubGVuZ3RoID0gMDsKICAgICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbSh7CiAgICAgICAgICAgICAgICBjaGFyczogc3RyLAogICAgICAgICAgICAgICAgZXh0cmFTcGFjaW5nOiAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93VGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgIGNoYXJzOiBhcmdzWzBdLAogICAgICAgICAgICAgIGV4dHJhU3BhY2luZzogMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZVNob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0ZXh0U3RhdGUuY2FycmlhZ2VSZXR1cm4oKTsKICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgIGNoYXJzOiBhcmdzWzBdLAogICAgICAgICAgICAgIGV4dHJhU3BhY2luZzogMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGV4dFN0YXRlLndvcmRTcGFjaW5nID0gYXJnc1swXTsKICAgICAgICAgICAgdGV4dFN0YXRlLmNoYXJTcGFjaW5nID0gYXJnc1sxXTsKICAgICAgICAgICAgdGV4dFN0YXRlLmNhcnJpYWdlUmV0dXJuKCk7CiAgICAgICAgICAgIGJ1aWxkVGV4dENvbnRlbnRJdGVtKHsKICAgICAgICAgICAgICBjaGFyczogYXJnc1syXSwKICAgICAgICAgICAgICBleHRyYVNwYWNpbmc6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMucGFpbnRYT2JqZWN0OgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICB4b2JqcyA/Pz0gcmVzb3VyY2VzLmdldCgiWE9iamVjdCIpIHx8IERpY3QuZW1wdHk7CiAgICAgICAgICAgIGlzVmFsaWROYW1lID0gYXJnc1swXSBpbnN0YW5jZW9mIE5hbWU7CiAgICAgICAgICAgIG5hbWUgPSBhcmdzWzBdLm5hbWU7CiAgICAgICAgICAgIGlmIChpc1ZhbGlkTmFtZSAmJiBlbXB0eVhPYmplY3RDYWNoZS5nZXRCeU5hbWUobmFtZSkpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlWE9iamVjdCwgcmVqZWN0WE9iamVjdCkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiWE9iamVjdCBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCB4b2JqID0geG9ianMuZ2V0UmF3KG5hbWUpOwogICAgICAgICAgICAgIGlmICh4b2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgICBpZiAoZW1wdHlYT2JqZWN0Q2FjaGUuZ2V0QnlSZWYoeG9iaikpIHsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgZ2xvYmFsSW1hZ2UgPSBzZWxmLmdsb2JhbEltYWdlQ2FjaGUuZ2V0RGF0YSh4b2JqLCBzZWxmLnBhZ2VJbmRleCk7CiAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsSW1hZ2UpIHsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeG9iaiA9IHhyZWYuZmV0Y2goeG9iaik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICghKHhvYmogaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJYT2JqZWN0IHNob3VsZCBiZSBhIHN0cmVhbSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgICBkaWN0CiAgICAgICAgICAgICAgfSA9IHhvYmo7CiAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGhhdmUgYSBOYW1lIHN1YnR5cGUiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHR5cGUubmFtZSAhPT0gIkZvcm0iKSB7CiAgICAgICAgICAgICAgICBlbXB0eVhPYmplY3RDYWNoZS5zZXQobmFtZSwgZGljdC5vYmpJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhdGUgPSBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoKTsKICAgICAgICAgICAgICBjb25zdCB4T2JqU3RhdGVNYW5hZ2VyID0gbmV3IFN0YXRlTWFuYWdlcihjdXJyZW50U3RhdGUpOwogICAgICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IGxvb2t1cE1hdHJpeChkaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgbnVsbCk7CiAgICAgICAgICAgICAgaWYgKG1hdHJpeCkgewogICAgICAgICAgICAgICAgeE9ialN0YXRlTWFuYWdlci50cmFuc2Zvcm0obWF0cml4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxSZXNvdXJjZXMgPSBkaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICAgICAgICAgICAgZW5xdWV1ZUNodW5rKCk7CiAgICAgICAgICAgICAgY29uc3Qgc2lua1dyYXBwZXIgPSB7CiAgICAgICAgICAgICAgICBlbnF1ZXVlSW52b2tlZDogZmFsc2UsCiAgICAgICAgICAgICAgICBlbnF1ZXVlKGNodW5rLCBzaXplKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZW5xdWV1ZUludm9rZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzaW5rLmVucXVldWUoY2h1bmssIHNpemUpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldCBkZXNpcmVkU2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbmsuZGVzaXJlZFNpemUgPz8gMDsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXQgcmVhZHkoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzaW5rLnJlYWR5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgc2VsZi5nZXRUZXh0Q29udGVudCh7CiAgICAgICAgICAgICAgICBzdHJlYW06IHhvYmosCiAgICAgICAgICAgICAgICB0YXNrLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBsb2NhbFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QgPyBsb2NhbFJlc291cmNlcyA6IHJlc291cmNlcywKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlcjogeE9ialN0YXRlTWFuYWdlciwKICAgICAgICAgICAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50LAogICAgICAgICAgICAgICAgc2luazogc2luayAmJiBzaW5rV3JhcHBlciwKICAgICAgICAgICAgICAgIHNlZW5TdHlsZXMsCiAgICAgICAgICAgICAgICB2aWV3Qm94LAogICAgICAgICAgICAgICAgbGFuZywKICAgICAgICAgICAgICAgIG1hcmtlZENvbnRlbnREYXRhLAogICAgICAgICAgICAgICAgZGlzYWJsZU5vcm1hbGl6YXRpb24sCiAgICAgICAgICAgICAgICBrZWVwV2hpdGVTcGFjZSwKICAgICAgICAgICAgICAgIHByZXZSZWZzOiBzZWVuUmVmcwogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCFzaW5rV3JhcHBlci5lbnF1ZXVlSW52b2tlZCkgewogICAgICAgICAgICAgICAgICBlbXB0eVhPYmplY3RDYWNoZS5zZXQobmFtZSwgZGljdC5vYmpJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgIH0sIHJlamVjdFhPYmplY3QpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIFhPYmplY3Q6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2V0R1N0YXRlOgogICAgICAgICAgICBpc1ZhbGlkTmFtZSA9IGFyZ3NbMF0gaW5zdGFuY2VvZiBOYW1lOwogICAgICAgICAgICBuYW1lID0gYXJnc1swXS5uYW1lOwogICAgICAgICAgICBpZiAoaXNWYWxpZE5hbWUgJiYgZW1wdHlHU3RhdGVDYWNoZS5nZXRCeU5hbWUobmFtZSkpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlR1N0YXRlLCByZWplY3RHU3RhdGUpIHsKICAgICAgICAgICAgICBpZiAoIWlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkdTdGF0ZSBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGV4dEdTdGF0ZSA9IHJlc291cmNlcy5nZXQoIkV4dEdTdGF0ZSIpOwogICAgICAgICAgICAgIGlmICghKGV4dEdTdGF0ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkV4dEdTdGF0ZSBzaG91bGQgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBnU3RhdGUgPSBleHRHU3RhdGUuZ2V0KG5hbWUpOwogICAgICAgICAgICAgIGlmICghKGdTdGF0ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkdTdGF0ZSBzaG91bGQgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBnU3RhdGVGb250ID0gZ1N0YXRlLmdldCgiRm9udCIpOwogICAgICAgICAgICAgIGlmICghZ1N0YXRlRm9udCkgewogICAgICAgICAgICAgICAgZW1wdHlHU3RhdGVDYWNoZS5zZXQobmFtZSwgZ1N0YXRlLm9iaklkLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlc29sdmVHU3RhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgICB0ZXh0U3RhdGUuZm9udE5hbWUgPSBudWxsOwogICAgICAgICAgICAgIHRleHRTdGF0ZS5mb250U2l6ZSA9IGdTdGF0ZUZvbnRbMV07CiAgICAgICAgICAgICAgaGFuZGxlU2V0Rm9udChudWxsLCBnU3RhdGVGb250WzBdKS50aGVuKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgICAgICAgIHdhcm4oYGdldFRleHRDb250ZW50IC0gaWdub3JpbmcgRXh0R1N0YXRlOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNhc2UgT1BTLmJlZ2luTWFya2VkQ29udGVudDoKICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgaWYgKGluY2x1ZGVNYXJrZWRDb250ZW50KSB7CiAgICAgICAgICAgICAgbWFya2VkQ29udGVudERhdGEubGV2ZWwrKzsKICAgICAgICAgICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJiZWdpbk1hcmtlZENvbnRlbnQiLAogICAgICAgICAgICAgICAgdGFnOiBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZSA/IGFyZ3NbMF0ubmFtZSA6IG51bGwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzOgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgICAgICAgICBtYXJrZWRDb250ZW50RGF0YS5sZXZlbCsrOwogICAgICAgICAgICAgIGxldCBtY2lkID0gbnVsbDsKICAgICAgICAgICAgICBpZiAoYXJnc1sxXSBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgICAgICAgIG1jaWQgPSBhcmdzWzFdLmdldCgiTUNJRCIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJiZWdpbk1hcmtlZENvbnRlbnRQcm9wcyIsCiAgICAgICAgICAgICAgICBpZDogTnVtYmVyLmlzSW50ZWdlcihtY2lkKSA/IGAke3NlbGYuaWRGYWN0b3J5LmdldFBhZ2VPYmpJZCgpfV9tYyR7bWNpZH1gIDogbnVsbCwKICAgICAgICAgICAgICAgIHRhZzogYXJnc1swXSBpbnN0YW5jZW9mIE5hbWUgPyBhcmdzWzBdLm5hbWUgOiBudWxsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5lbmRNYXJrZWRDb250ZW50OgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgICAgICAgICBpZiAobWFya2VkQ29udGVudERhdGEubGV2ZWwgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtYXJrZWRDb250ZW50RGF0YS5sZXZlbC0tOwogICAgICAgICAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgdHlwZTogImVuZE1hcmtlZENvbnRlbnQiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5yZXN0b3JlOgogICAgICAgICAgICBpZiAocHJldmlvdXNTdGF0ZSAmJiAocHJldmlvdXNTdGF0ZS5mb250ICE9PSB0ZXh0U3RhdGUuZm9udCB8fCBwcmV2aW91c1N0YXRlLmZvbnRTaXplICE9PSB0ZXh0U3RhdGUuZm9udFNpemUgfHwgcHJldmlvdXNTdGF0ZS5mb250TmFtZSAhPT0gdGV4dFN0YXRlLmZvbnROYW1lKSkgewogICAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmICh0ZXh0Q29udGVudC5pdGVtcy5sZW5ndGggPj0gKHNpbms/LmRlc2lyZWRTaXplID8/IDEpKSB7CiAgICAgICAgICBzdG9wID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3RvcCkgewogICAgICAgIG5leHQoZGVmZXJyZWQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICBlbnF1ZXVlQ2h1bmsoKTsKICAgICAgcmVzb2x2ZSgpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgd2FybihgZ2V0VGV4dENvbnRlbnQgLSBpZ25vcmluZyBlcnJvcnMgZHVyaW5nICIke3Rhc2submFtZX0iIGAgKyBgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICBlbnF1ZXVlQ2h1bmsoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhyb3cgcmVhc29uOwogICAgfSk7CiAgfQogIGFzeW5jIGV4dHJhY3REYXRhU3RydWN0dXJlcyhkaWN0LCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmOwogICAgbGV0IGNpZFRvR2lkQnl0ZXM7CiAgICBjb25zdCB0b1VuaWNvZGVQcm9taXNlID0gdGhpcy5yZWFkVG9Vbmljb2RlKHByb3BlcnRpZXMudG9Vbmljb2RlKTsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBjb25zdCBjaWRTeXN0ZW1JbmZvID0gZGljdC5nZXQoIkNJRFN5c3RlbUluZm8iKTsKICAgICAgaWYgKGNpZFN5c3RlbUluZm8gaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvID0gewogICAgICAgICAgcmVnaXN0cnk6IHN0cmluZ1RvUERGU3RyaW5nKGNpZFN5c3RlbUluZm8uZ2V0KCJSZWdpc3RyeSIpKSwKICAgICAgICAgIG9yZGVyaW5nOiBzdHJpbmdUb1BERlN0cmluZyhjaWRTeXN0ZW1JbmZvLmdldCgiT3JkZXJpbmciKSksCiAgICAgICAgICBzdXBwbGVtZW50OiBjaWRTeXN0ZW1JbmZvLmdldCgiU3VwcGxlbWVudCIpCiAgICAgICAgfTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGNvbnN0IGNpZFRvR2lkTWFwID0gZGljdC5nZXQoIkNJRFRvR0lETWFwIik7CiAgICAgICAgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgICAgY2lkVG9HaWRCeXRlcyA9IGNpZFRvR2lkTWFwLmdldEJ5dGVzKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgfQogICAgICAgIHdhcm4oYGV4dHJhY3REYXRhU3RydWN0dXJlcyAtIGlnbm9yaW5nIENJRFRvR0lETWFwIGRhdGE6ICIke2V4fSIuYCk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpZmZlcmVuY2VzID0gW107CiAgICBsZXQgYmFzZUVuY29kaW5nTmFtZSA9IG51bGw7CiAgICBsZXQgZW5jb2Rpbmc7CiAgICBpZiAoZGljdC5oYXMoIkVuY29kaW5nIikpIHsKICAgICAgZW5jb2RpbmcgPSBkaWN0LmdldCgiRW5jb2RpbmciKTsKICAgICAgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBlbmNvZGluZy5nZXQoIkJhc2VFbmNvZGluZyIpOwogICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBiYXNlRW5jb2RpbmdOYW1lIGluc3RhbmNlb2YgTmFtZSA/IGJhc2VFbmNvZGluZ05hbWUubmFtZSA6IG51bGw7CiAgICAgICAgaWYgKGVuY29kaW5nLmhhcygiRGlmZmVyZW5jZXMiKSkgewogICAgICAgICAgY29uc3QgZGlmZkVuY29kaW5nID0gZW5jb2RpbmcuZ2V0KCJEaWZmZXJlbmNlcyIpOwogICAgICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZGlmZkVuY29kaW5nKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB4cmVmLmZldGNoSWZSZWYoZW50cnkpOwogICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgaW5kZXggPSBkYXRhOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgZGlmZmVyZW5jZXNbaW5kZXgrK10gPSBkYXRhLm5hbWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGVudHJ5IGluICdEaWZmZXJlbmNlcycgYXJyYXk6ICR7ZGF0YX1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gZW5jb2RpbmcubmFtZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBtc2cgPSAiRW5jb2RpbmcgaXMgbm90IGEgTmFtZSBub3IgYSBEaWN0IjsKICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihtc2cpOwogICAgICAgIH0KICAgICAgICB3YXJuKG1zZyk7CiAgICAgIH0KICAgICAgaWYgKGJhc2VFbmNvZGluZ05hbWUgIT09ICJNYWNSb21hbkVuY29kaW5nIiAmJiBiYXNlRW5jb2RpbmdOYW1lICE9PSAiTWFjRXhwZXJ0RW5jb2RpbmciICYmIGJhc2VFbmNvZGluZ05hbWUgIT09ICJXaW5BbnNpRW5jb2RpbmciKSB7CiAgICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG5vbkVtYmVkZGVkRm9udCA9ICFwcm9wZXJ0aWVzLmZpbGUgfHwgcHJvcGVydGllcy5pc0ludGVybmFsRm9udCwKICAgICAgaXNTeW1ib2xzRm9udE5hbWUgPSBnZXRTeW1ib2xzRm9udHMoKVtwcm9wZXJ0aWVzLm5hbWVdOwogICAgaWYgKGJhc2VFbmNvZGluZ05hbWUgJiYgbm9uRW1iZWRkZWRGb250ICYmIGlzU3ltYm9sc0ZvbnROYW1lKSB7CiAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBudWxsOwogICAgfQogICAgaWYgKGJhc2VFbmNvZGluZ05hbWUpIHsKICAgICAgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcgPSBnZXRFbmNvZGluZyhiYXNlRW5jb2RpbmdOYW1lKTsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBpc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU3ltYm9saWMpOwogICAgICBjb25zdCBpc05vbnN5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuTm9uc3ltYm9saWMpOwogICAgICBpZiAocHJvcGVydGllcy50eXBlID09PSAiVHJ1ZVR5cGUiICYmIGlzU3ltYm9saWNGb250ICYmIGlzTm9uc3ltYm9saWNGb250ICYmIGRpZmZlcmVuY2VzLmxlbmd0aCAhPT0gMCkgewogICAgICAgIHByb3BlcnRpZXMuZmxhZ3MgJj0gfkZvbnRGbGFncy5TeW1ib2xpYzsKICAgICAgICBpc1N5bWJvbGljRm9udCA9IGZhbHNlOwogICAgICB9CiAgICAgIGVuY29kaW5nID0gU3RhbmRhcmRFbmNvZGluZzsKICAgICAgaWYgKHByb3BlcnRpZXMudHlwZSA9PT0gIlRydWVUeXBlIiAmJiAhaXNOb25zeW1ib2xpY0ZvbnQpIHsKICAgICAgICBlbmNvZGluZyA9IFdpbkFuc2lFbmNvZGluZzsKICAgICAgfQogICAgICBpZiAoaXNTeW1ib2xpY0ZvbnQgfHwgaXNTeW1ib2xzRm9udE5hbWUpIHsKICAgICAgICBlbmNvZGluZyA9IE1hY1JvbWFuRW5jb2Rpbmc7CiAgICAgICAgaWYgKG5vbkVtYmVkZGVkRm9udCkgewogICAgICAgICAgaWYgKC9TeW1ib2wvaS50ZXN0KHByb3BlcnRpZXMubmFtZSkpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBTeW1ib2xTZXRFbmNvZGluZzsKICAgICAgICAgIH0gZWxzZSBpZiAoL0RpbmdiYXRzL2kudGVzdChwcm9wZXJ0aWVzLm5hbWUpKSB7CiAgICAgICAgICAgIGVuY29kaW5nID0gWmFwZkRpbmdiYXRzRW5jb2Rpbmc7CiAgICAgICAgICB9IGVsc2UgaWYgKC9XaW5nZGluZ3MvaS50ZXN0KHByb3BlcnRpZXMubmFtZSkpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBXaW5BbnNpRW5jb2Rpbmc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICB9CiAgICBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzID0gZGlmZmVyZW5jZXM7CiAgICBwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgPSBiYXNlRW5jb2RpbmdOYW1lOwogICAgcHJvcGVydGllcy5oYXNFbmNvZGluZyA9ICEhYmFzZUVuY29kaW5nTmFtZSB8fCBkaWZmZXJlbmNlcy5sZW5ndGggPiAwOwogICAgcHJvcGVydGllcy5kaWN0ID0gZGljdDsKICAgIHByb3BlcnRpZXMudG9Vbmljb2RlID0gYXdhaXQgdG9Vbmljb2RlUHJvbWlzZTsKICAgIGNvbnN0IGJ1aWx0VG9Vbmljb2RlID0gYXdhaXQgdGhpcy5idWlsZFRvVW5pY29kZShwcm9wZXJ0aWVzKTsKICAgIHByb3BlcnRpZXMudG9Vbmljb2RlID0gYnVpbHRUb1VuaWNvZGU7CiAgICBpZiAoY2lkVG9HaWRCeXRlcykgewogICAgICBwcm9wZXJ0aWVzLmNpZFRvR2lkTWFwID0gdGhpcy5yZWFkQ2lkVG9HaWRNYXAoY2lkVG9HaWRCeXRlcywgYnVpbHRUb1VuaWNvZGUpOwogICAgfQogICAgcmV0dXJuIHByb3BlcnRpZXM7CiAgfQogIF9zaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMsIGZvcmNlR2x5cGhzID0gZmFsc2UpIHsKICAgIGFzc2VydCghcHJvcGVydGllcy5jb21wb3NpdGUsICJNdXN0IGJlIGEgc2ltcGxlIGZvbnQuIik7CiAgICBjb25zdCB0b1VuaWNvZGUgPSBbXTsKICAgIGNvbnN0IGVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmcuc2xpY2UoKTsKICAgIGNvbnN0IGJhc2VFbmNvZGluZ05hbWUgPSBwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWU7CiAgICBjb25zdCBkaWZmZXJlbmNlcyA9IHByb3BlcnRpZXMuZGlmZmVyZW5jZXM7CiAgICBmb3IgKGNvbnN0IGNoYXJjb2RlIGluIGRpZmZlcmVuY2VzKSB7CiAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGRpZmZlcmVuY2VzW2NoYXJjb2RlXTsKICAgICAgaWYgKGdseXBoTmFtZSA9PT0gIi5ub3RkZWYiKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZW5jb2RpbmdbY2hhcmNvZGVdID0gZ2x5cGhOYW1lOwogICAgfQogICAgY29uc3QgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICAgIGZvciAoY29uc3QgY2hhcmNvZGUgaW4gZW5jb2RpbmcpIHsKICAgICAgbGV0IGdseXBoTmFtZSA9IGVuY29kaW5nW2NoYXJjb2RlXTsKICAgICAgaWYgKGdseXBoTmFtZSA9PT0gIiIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgdW5pY29kZSA9IGdseXBoc1VuaWNvZGVNYXBbZ2x5cGhOYW1lXTsKICAgICAgaWYgKHVuaWNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHVuaWNvZGUpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCBjb2RlID0gMDsKICAgICAgc3dpdGNoIChnbHlwaE5hbWVbMF0pIHsKICAgICAgICBjYXNlICJHIjoKICAgICAgICAgIGlmIChnbHlwaE5hbWUubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgIGNvZGUgPSBwYXJzZUludChnbHlwaE5hbWUuc3Vic3RyaW5nKDEpLCAxNik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJnIjoKICAgICAgICAgIGlmIChnbHlwaE5hbWUubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgIGNvZGUgPSBwYXJzZUludChnbHlwaE5hbWUuc3Vic3RyaW5nKDEpLCAxNik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJDIjoKICAgICAgICBjYXNlICJjIjoKICAgICAgICAgIGlmIChnbHlwaE5hbWUubGVuZ3RoID49IDMgJiYgZ2x5cGhOYW1lLmxlbmd0aCA8PSA0KSB7CiAgICAgICAgICAgIGNvbnN0IGNvZGVTdHIgPSBnbHlwaE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICBpZiAoZm9yY2VHbHlwaHMpIHsKICAgICAgICAgICAgICBjb2RlID0gcGFyc2VJbnQoY29kZVN0ciwgMTYpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvZGUgPSArY29kZVN0cjsKICAgICAgICAgICAgaWYgKE51bWJlci5pc05hTihjb2RlKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKHBhcnNlSW50KGNvZGVTdHIsIDE2KSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2ltcGxlRm9udFRvVW5pY29kZShwcm9wZXJ0aWVzLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidSI6CiAgICAgICAgICB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgICAgICAgY29kZSA9IHVuaWNvZGU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgc3dpdGNoIChnbHlwaE5hbWUpIHsKICAgICAgICAgICAgY2FzZSAiZl9oIjoKICAgICAgICAgICAgY2FzZSAiZl90IjoKICAgICAgICAgICAgY2FzZSAiVF9oIjoKICAgICAgICAgICAgICB0b1VuaWNvZGVbY2hhcmNvZGVdID0gZ2x5cGhOYW1lLnJlcGxhY2VBbGwoIl8iLCAiIik7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoY29kZSA+IDAgJiYgY29kZSA8PSAweDEwZmZmZiAmJiBOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpKSB7CiAgICAgICAgaWYgKGJhc2VFbmNvZGluZ05hbWUgJiYgY29kZSA9PT0gK2NoYXJjb2RlKSB7CiAgICAgICAgICBjb25zdCBiYXNlRW5jb2RpbmcgPSBnZXRFbmNvZGluZyhiYXNlRW5jb2RpbmdOYW1lKTsKICAgICAgICAgIGlmIChiYXNlRW5jb2RpbmcgJiYgKGdseXBoTmFtZSA9IGJhc2VFbmNvZGluZ1tjaGFyY29kZV0pKSB7CiAgICAgICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGdseXBoc1VuaWNvZGVNYXBbZ2x5cGhOYW1lXSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0b1VuaWNvZGVbY2hhcmNvZGVdID0gU3RyaW5nLmZyb21Db2RlUG9pbnQoY29kZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0b1VuaWNvZGU7CiAgfQogIGFzeW5jIGJ1aWxkVG9Vbmljb2RlKHByb3BlcnRpZXMpIHsKICAgIHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXAgPSBwcm9wZXJ0aWVzLnRvVW5pY29kZT8ubGVuZ3RoID4gMDsKICAgIGlmIChwcm9wZXJ0aWVzLmhhc0luY2x1ZGVkVG9Vbmljb2RlTWFwKSB7CiAgICAgIGlmICghcHJvcGVydGllcy5jb21wb3NpdGUgJiYgcHJvcGVydGllcy5oYXNFbmNvZGluZykgewogICAgICAgIHByb3BlcnRpZXMuZmFsbGJhY2tUb1VuaWNvZGUgPSB0aGlzLl9zaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgICB9CiAgICAgIHJldHVybiBwcm9wZXJ0aWVzLnRvVW5pY29kZTsKICAgIH0KICAgIGlmICghcHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgcmV0dXJuIG5ldyBUb1VuaWNvZGVNYXAodGhpcy5fc2ltcGxlRm9udFRvVW5pY29kZShwcm9wZXJ0aWVzKSk7CiAgICB9CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUgJiYgKHByb3BlcnRpZXMuY01hcC5idWlsdEluQ01hcCAmJiAhKHByb3BlcnRpZXMuY01hcCBpbnN0YW5jZW9mIElkZW50aXR5Q01hcCkgfHwgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvPy5yZWdpc3RyeSA9PT0gIkFkb2JlIiAmJiAocHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLm9yZGVyaW5nID09PSAiR0IxIiB8fCBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8ub3JkZXJpbmcgPT09ICJDTlMxIiB8fCBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8ub3JkZXJpbmcgPT09ICJKYXBhbjEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIktvcmVhMSIpKSkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVnaXN0cnksCiAgICAgICAgb3JkZXJpbmcKICAgICAgfSA9IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mbzsKICAgICAgY29uc3QgdWNzMkNNYXBOYW1lID0gTmFtZS5nZXQoYCR7cmVnaXN0cnl9LSR7b3JkZXJpbmd9LVVDUzJgKTsKICAgICAgY29uc3QgdWNzMkNNYXAgPSBhd2FpdCBDTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgIGVuY29kaW5nOiB1Y3MyQ01hcE5hbWUsCiAgICAgICAgZmV0Y2hCdWlsdEluQ01hcDogdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kLAogICAgICAgIHVzZUNNYXA6IG51bGwKICAgICAgfSk7CiAgICAgIGNvbnN0IHRvVW5pY29kZSA9IFtdLAogICAgICAgIGJ1ZiA9IFtdOwogICAgICBwcm9wZXJ0aWVzLmNNYXAuZm9yRWFjaChmdW5jdGlvbiAoY2hhcmNvZGUsIGNpZCkgewogICAgICAgIGlmIChjaWQgPiAweGZmZmYpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTWF4IHNpemUgb2YgQ0lEIGlzIDY1LDUzNSIpOwogICAgICAgIH0KICAgICAgICBjb25zdCB1Y3MyID0gdWNzMkNNYXAubG9va3VwKGNpZCk7CiAgICAgICAgaWYgKHVjczIpIHsKICAgICAgICAgIGJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdWNzMi5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICAgIGJ1Zi5wdXNoKCh1Y3MyLmNoYXJDb2RlQXQoaSkgPDwgOCkgKyB1Y3MyLmNoYXJDb2RlQXQoaSArIDEpKTsKICAgICAgICAgIH0KICAgICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmJ1Zik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIG5ldyBUb1VuaWNvZGVNYXAodG9Vbmljb2RlKTsKICAgIH0KICAgIHJldHVybiBuZXcgSWRlbnRpdHlUb1VuaWNvZGVNYXAocHJvcGVydGllcy5maXJzdENoYXIsIHByb3BlcnRpZXMubGFzdENoYXIpOwogIH0KICBhc3luYyByZWFkVG9Vbmljb2RlKGNtYXBPYmopIHsKICAgIGlmICghY21hcE9iaikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChjbWFwT2JqIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCBjbWFwID0gYXdhaXQgQ01hcEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICBlbmNvZGluZzogY21hcE9iaiwKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KTsKICAgICAgaWYgKGNtYXAgaW5zdGFuY2VvZiBJZGVudGl0eUNNYXApIHsKICAgICAgICByZXR1cm4gbmV3IElkZW50aXR5VG9Vbmljb2RlTWFwKDAsIDB4ZmZmZik7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBUb1VuaWNvZGVNYXAoY21hcC5nZXRNYXAoKSk7CiAgICB9CiAgICBpZiAoY21hcE9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBjbWFwID0gYXdhaXQgQ01hcEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICAgIGVuY29kaW5nOiBjbWFwT2JqLAogICAgICAgICAgZmV0Y2hCdWlsdEluQ01hcDogdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kLAogICAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICAgIH0pOwogICAgICAgIGlmIChjbWFwIGluc3RhbmNlb2YgSWRlbnRpdHlDTWFwKSB7CiAgICAgICAgICByZXR1cm4gbmV3IElkZW50aXR5VG9Vbmljb2RlTWFwKDAsIDB4ZmZmZik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBBcnJheShjbWFwLmxlbmd0aCk7CiAgICAgICAgY21hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgdG9rZW4pIHsKICAgICAgICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludCh0b2tlbik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0b2tlbi5sZW5ndGggJSAyICE9PSAwKSB7CiAgICAgICAgICAgIHRva2VuID0gIlx1MDAwMCIgKyB0b2tlbjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0ciA9IFtdOwogICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0b2tlbi5sZW5ndGg7IGsgKz0gMikgewogICAgICAgICAgICBjb25zdCB3MSA9IHRva2VuLmNoYXJDb2RlQXQoaykgPDwgOCB8IHRva2VuLmNoYXJDb2RlQXQoayArIDEpOwogICAgICAgICAgICBpZiAoKHcxICYgMHhmODAwKSAhPT0gMHhkODAwKSB7CiAgICAgICAgICAgICAgc3RyLnB1c2godzEpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGsgKz0gMjsKICAgICAgICAgICAgY29uc3QgdzIgPSB0b2tlbi5jaGFyQ29kZUF0KGspIDw8IDggfCB0b2tlbi5jaGFyQ29kZUF0KGsgKyAxKTsKICAgICAgICAgICAgc3RyLnB1c2goKCh3MSAmIDB4M2ZmKSA8PCAxMCkgKyAodzIgJiAweDNmZikgKyAweDEwMDAwKTsKICAgICAgICAgIH0KICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludCguLi5zdHIpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBuZXcgVG9Vbmljb2RlTWFwKG1hcCk7CiAgICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB3YXJuKGByZWFkVG9Vbmljb2RlIC0gaWdub3JpbmcgVG9Vbmljb2RlIGRhdGE6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIHJlYWRDaWRUb0dpZE1hcChnbHlwaHNEYXRhLCB0b1VuaWNvZGUpIHsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgZm9yIChsZXQgaiA9IDAsIGpqID0gZ2x5cGhzRGF0YS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgIGNvbnN0IGdseXBoSUQgPSBnbHlwaHNEYXRhW2orK10gPDwgOCB8IGdseXBoc0RhdGFbal07CiAgICAgIGNvbnN0IGNvZGUgPSBqID4+IDE7CiAgICAgIGlmIChnbHlwaElEID09PSAwICYmICF0b1VuaWNvZGUuaGFzKGNvZGUpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcmVzdWx0W2NvZGVdID0gZ2x5cGhJRDsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGV4dHJhY3RXaWR0aHMoZGljdCwgZGVzY3JpcHRvciwgcHJvcGVydGllcykgewogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGxldCBnbHlwaHNXaWR0aHMgPSBbXTsKICAgIGxldCBkZWZhdWx0V2lkdGggPSAwOwogICAgY29uc3QgZ2x5cGhzVk1ldHJpY3MgPSBbXTsKICAgIGxldCBkZWZhdWx0Vk1ldHJpY3M7CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgY29uc3QgZHcgPSBkaWN0LmdldCgiRFciKTsKICAgICAgZGVmYXVsdFdpZHRoID0gdHlwZW9mIGR3ID09PSAibnVtYmVyIiA/IE1hdGguY2VpbChkdykgOiAxMDAwOwogICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiVyIpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh3aWR0aHMpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gd2lkdGhzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGxldCBzdGFydCA9IHhyZWYuZmV0Y2hJZlJlZih3aWR0aHNbaSsrXSk7CiAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoc3RhcnQpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgY29kZSA9IHhyZWYuZmV0Y2hJZlJlZih3aWR0aHNbaV0pOwogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZSkpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGNvZGUpIHsKICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHhyZWYuZmV0Y2hJZlJlZihjKTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpZHRoID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgZ2x5cGhzV2lkdGhzW3N0YXJ0XSA9IHdpZHRoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdGFydCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIoY29kZSkpIHsKICAgICAgICAgICAgY29uc3Qgd2lkdGggPSB4cmVmLmZldGNoSWZSZWYod2lkdGhzWysraV0pOwogICAgICAgICAgICBpZiAodHlwZW9mIHdpZHRoICE9PSAibnVtYmVyIikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGogPSBzdGFydDsgaiA8PSBjb2RlOyBqKyspIHsKICAgICAgICAgICAgICBnbHlwaHNXaWR0aHNbal0gPSB3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLnZlcnRpY2FsKSB7CiAgICAgICAgY29uc3QgZHcyID0gZGljdC5nZXRBcnJheSgiRFcyIik7CiAgICAgICAgbGV0IHZtZXRyaWNzID0gaXNOdW1iZXJBcnJheShkdzIsIDIpID8gZHcyIDogWzg4MCwgLTEwMDBdOwogICAgICAgIGRlZmF1bHRWTWV0cmljcyA9IFt2bWV0cmljc1sxXSwgZGVmYXVsdFdpZHRoICogMC41LCB2bWV0cmljc1swXV07CiAgICAgICAgdm1ldHJpY3MgPSBkaWN0LmdldCgiVzIiKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2bWV0cmljcykpIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZtZXRyaWNzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgbGV0IHN0YXJ0ID0geHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzW2krK10pOwogICAgICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoc3RhcnQpKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY29kZSA9IHhyZWYuZmV0Y2hJZlJlZih2bWV0cmljc1tpXSk7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvZGUpKSB7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gY29kZS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB2bWV0cmljID0gW3hyZWYuZmV0Y2hJZlJlZihjb2RlW2orK10pLCB4cmVmLmZldGNoSWZSZWYoY29kZVtqKytdKSwgeHJlZi5mZXRjaElmUmVmKGNvZGVbal0pXTsKICAgICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KHZtZXRyaWMsIG51bGwpKSB7CiAgICAgICAgICAgICAgICAgIGdseXBoc1ZNZXRyaWNzW3N0YXJ0XSA9IHZtZXRyaWM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGFydCsrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpKSB7CiAgICAgICAgICAgICAgY29uc3Qgdm1ldHJpYyA9IFt4cmVmLmZldGNoSWZSZWYodm1ldHJpY3NbKytpXSksIHhyZWYuZmV0Y2hJZlJlZih2bWV0cmljc1srK2ldKSwgeHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzWysraV0pXTsKICAgICAgICAgICAgICBpZiAoIWlzTnVtYmVyQXJyYXkodm1ldHJpYywgbnVsbCkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKGxldCBqID0gc3RhcnQ7IGogPD0gY29kZTsgaisrKSB7CiAgICAgICAgICAgICAgICBnbHlwaHNWTWV0cmljc1tqXSA9IHZtZXRyaWM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHdpZHRocykpIHsKICAgICAgICBsZXQgaiA9IHByb3BlcnRpZXMuZmlyc3RDaGFyOwogICAgICAgIGZvciAoY29uc3QgdyBvZiB3aWR0aHMpIHsKICAgICAgICAgIGNvbnN0IHdpZHRoID0geHJlZi5mZXRjaElmUmVmKHcpOwogICAgICAgICAgaWYgKHR5cGVvZiB3aWR0aCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgZ2x5cGhzV2lkdGhzW2pdID0gd2lkdGg7CiAgICAgICAgICB9CiAgICAgICAgICBqKys7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1pc3NpbmdXaWR0aCA9IGRlc2NyaXB0b3IuZ2V0KCJNaXNzaW5nV2lkdGgiKTsKICAgICAgICBkZWZhdWx0V2lkdGggPSB0eXBlb2YgbWlzc2luZ1dpZHRoID09PSAibnVtYmVyIiA/IG1pc3NpbmdXaWR0aCA6IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYmFzZUZvbnROYW1lID0gZGljdC5nZXQoIkJhc2VGb250Iik7CiAgICAgICAgaWYgKGJhc2VGb250TmFtZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLmdldEJhc2VGb250TWV0cmljcyhiYXNlRm9udE5hbWUubmFtZSk7CiAgICAgICAgICBnbHlwaHNXaWR0aHMgPSB0aGlzLmJ1aWxkQ2hhckNvZGVUb1dpZHRoKG1ldHJpY3Mud2lkdGhzLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGRlZmF1bHRXaWR0aCA9IG1ldHJpY3MuZGVmYXVsdFdpZHRoOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IGlzTW9ub3NwYWNlID0gdHJ1ZTsKICAgIGxldCBmaXJzdFdpZHRoID0gZGVmYXVsdFdpZHRoOwogICAgZm9yIChjb25zdCBnbHlwaCBpbiBnbHlwaHNXaWR0aHMpIHsKICAgICAgY29uc3QgZ2x5cGhXaWR0aCA9IGdseXBoc1dpZHRoc1tnbHlwaF07CiAgICAgIGlmICghZ2x5cGhXaWR0aCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghZmlyc3RXaWR0aCkgewogICAgICAgIGZpcnN0V2lkdGggPSBnbHlwaFdpZHRoOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChmaXJzdFdpZHRoICE9PSBnbHlwaFdpZHRoKSB7CiAgICAgICAgaXNNb25vc3BhY2UgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKGlzTW9ub3NwYWNlKSB7CiAgICAgIHByb3BlcnRpZXMuZmxhZ3MgfD0gRm9udEZsYWdzLkZpeGVkUGl0Y2g7CiAgICB9IGVsc2UgewogICAgICBwcm9wZXJ0aWVzLmZsYWdzICY9IH5Gb250RmxhZ3MuRml4ZWRQaXRjaDsKICAgIH0KICAgIHByb3BlcnRpZXMuZGVmYXVsdFdpZHRoID0gZGVmYXVsdFdpZHRoOwogICAgcHJvcGVydGllcy53aWR0aHMgPSBnbHlwaHNXaWR0aHM7CiAgICBwcm9wZXJ0aWVzLmRlZmF1bHRWTWV0cmljcyA9IGRlZmF1bHRWTWV0cmljczsKICAgIHByb3BlcnRpZXMudm1ldHJpY3MgPSBnbHlwaHNWTWV0cmljczsKICB9CiAgaXNTZXJpZkZvbnQoYmFzZUZvbnROYW1lKSB7CiAgICBjb25zdCBmb250TmFtZVdvU3R5bGUgPSBiYXNlRm9udE5hbWUuc3BsaXQoIi0iLCAxKVswXTsKICAgIHJldHVybiBmb250TmFtZVdvU3R5bGUgaW4gZ2V0U2VyaWZGb250cygpIHx8IC9zZXJpZi9naS50ZXN0KGZvbnROYW1lV29TdHlsZSk7CiAgfQogIGdldEJhc2VGb250TWV0cmljcyhuYW1lKSB7CiAgICBsZXQgZGVmYXVsdFdpZHRoID0gMDsKICAgIGxldCB3aWR0aHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbGV0IG1vbm9zcGFjZSA9IGZhbHNlOwogICAgY29uc3Qgc3RkRm9udE1hcCA9IGdldFN0ZEZvbnRNYXAoKTsKICAgIGxldCBsb29rdXBOYW1lID0gc3RkRm9udE1hcFtuYW1lXSB8fCBuYW1lOwogICAgY29uc3QgTWV0cmljcyA9IGdldE1ldHJpY3MoKTsKICAgIGlmICghKGxvb2t1cE5hbWUgaW4gTWV0cmljcykpIHsKICAgICAgbG9va3VwTmFtZSA9IHRoaXMuaXNTZXJpZkZvbnQobmFtZSkgPyAiVGltZXMtUm9tYW4iIDogIkhlbHZldGljYSI7CiAgICB9CiAgICBjb25zdCBnbHlwaFdpZHRocyA9IE1ldHJpY3NbbG9va3VwTmFtZV07CiAgICBpZiAodHlwZW9mIGdseXBoV2lkdGhzID09PSAibnVtYmVyIikgewogICAgICBkZWZhdWx0V2lkdGggPSBnbHlwaFdpZHRoczsKICAgICAgbW9ub3NwYWNlID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHdpZHRocyA9IGdseXBoV2lkdGhzKCk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBkZWZhdWx0V2lkdGgsCiAgICAgIG1vbm9zcGFjZSwKICAgICAgd2lkdGhzCiAgICB9OwogIH0KICBidWlsZENoYXJDb2RlVG9XaWR0aCh3aWR0aHNCeUdseXBoTmFtZSwgcHJvcGVydGllcykgewogICAgY29uc3Qgd2lkdGhzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbnN0IGRpZmZlcmVuY2VzID0gcHJvcGVydGllcy5kaWZmZXJlbmNlczsKICAgIGNvbnN0IGVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmc7CiAgICBmb3IgKGxldCBjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgMjU2OyBjaGFyQ29kZSsrKSB7CiAgICAgIGlmIChjaGFyQ29kZSBpbiBkaWZmZXJlbmNlcyAmJiB3aWR0aHNCeUdseXBoTmFtZVtkaWZmZXJlbmNlc1tjaGFyQ29kZV1dKSB7CiAgICAgICAgd2lkdGhzW2NoYXJDb2RlXSA9IHdpZHRoc0J5R2x5cGhOYW1lW2RpZmZlcmVuY2VzW2NoYXJDb2RlXV07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNoYXJDb2RlIGluIGVuY29kaW5nICYmIHdpZHRoc0J5R2x5cGhOYW1lW2VuY29kaW5nW2NoYXJDb2RlXV0pIHsKICAgICAgICB3aWR0aHNbY2hhckNvZGVdID0gd2lkdGhzQnlHbHlwaE5hbWVbZW5jb2RpbmdbY2hhckNvZGVdXTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHdpZHRoczsKICB9CiAgcHJlRXZhbHVhdGVGb250KGRpY3QpIHsKICAgIGNvbnN0IGJhc2VEaWN0ID0gZGljdDsKICAgIGxldCB0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgIGlmICghKHR5cGUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBTdWJ0eXBlIik7CiAgICB9CiAgICBsZXQgY29tcG9zaXRlID0gZmFsc2U7CiAgICBsZXQgaGFzaDsKICAgIGlmICh0eXBlLm5hbWUgPT09ICJUeXBlMCIpIHsKICAgICAgY29uc3QgZGYgPSBkaWN0LmdldCgiRGVzY2VuZGFudEZvbnRzIik7CiAgICAgIGlmICghZGYpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkRlc2NlbmRhbnQgZm9udHMgYXJlIG5vdCBzcGVjaWZpZWQiKTsKICAgICAgfQogICAgICBkaWN0ID0gQXJyYXkuaXNBcnJheShkZikgPyB0aGlzLnhyZWYuZmV0Y2hJZlJlZihkZlswXSkgOiBkZjsKICAgICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJEZXNjZW5kYW50IGZvbnQgaXMgbm90IGEgZGljdGlvbmFyeS4iKTsKICAgICAgfQogICAgICB0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJpbnZhbGlkIGZvbnQgU3VidHlwZSIpOwogICAgICB9CiAgICAgIGNvbXBvc2l0ZSA9IHRydWU7CiAgICB9CiAgICBsZXQgZmlyc3RDaGFyID0gZGljdC5nZXQoIkZpcnN0Q2hhciIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0Q2hhcikpIHsKICAgICAgZmlyc3RDaGFyID0gMDsKICAgIH0KICAgIGxldCBsYXN0Q2hhciA9IGRpY3QuZ2V0KCJMYXN0Q2hhciIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGxhc3RDaGFyKSkgewogICAgICBsYXN0Q2hhciA9IGNvbXBvc2l0ZSA/IDB4ZmZmZiA6IDB4ZmY7CiAgICB9CiAgICBjb25zdCBkZXNjcmlwdG9yID0gZGljdC5nZXQoIkZvbnREZXNjcmlwdG9yIik7CiAgICBjb25zdCB0b1VuaWNvZGUgPSBkaWN0LmdldCgiVG9Vbmljb2RlIikgfHwgYmFzZURpY3QuZ2V0KCJUb1VuaWNvZGUiKTsKICAgIGlmIChkZXNjcmlwdG9yKSB7CiAgICAgIGhhc2ggPSBuZXcgTXVybXVySGFzaDNfNjQoKTsKICAgICAgY29uc3QgZW5jb2RpbmcgPSBiYXNlRGljdC5nZXRSYXcoIkVuY29kaW5nIik7CiAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBoYXNoLnVwZGF0ZShlbmNvZGluZy5uYW1lKTsKICAgICAgfSBlbHNlIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIGhhc2gudXBkYXRlKGVuY29kaW5nLnRvU3RyaW5nKCkpOwogICAgICB9IGVsc2UgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW5jb2RpbmcuZ2V0UmF3VmFsdWVzKCkpIHsKICAgICAgICAgIGlmIChlbnRyeSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgaGFzaC51cGRhdGUoZW50cnkubmFtZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIGhhc2gudXBkYXRlKGVudHJ5LnRvU3RyaW5nKCkpOwogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVudHJ5KSkgewogICAgICAgICAgICBjb25zdCBkaWZmTGVuZ3RoID0gZW50cnkubGVuZ3RoLAogICAgICAgICAgICAgIGRpZmZCdWYgPSBuZXcgQXJyYXkoZGlmZkxlbmd0aCk7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZGlmZkxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgY29uc3QgZGlmZkVudHJ5ID0gZW50cnlbal07CiAgICAgICAgICAgICAgaWYgKGRpZmZFbnRyeSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICAgIGRpZmZCdWZbal0gPSBkaWZmRW50cnkubmFtZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkaWZmRW50cnkgPT09ICJudW1iZXIiIHx8IGRpZmZFbnRyeSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICAgICAgZGlmZkJ1ZltqXSA9IGRpZmZFbnRyeS50b1N0cmluZygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBoYXNoLnVwZGF0ZShkaWZmQnVmLmpvaW4oKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGhhc2gudXBkYXRlKGAke2ZpcnN0Q2hhcn0tJHtsYXN0Q2hhcn1gKTsKICAgICAgaWYgKHRvVW5pY29kZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBjb25zdCBzdHJlYW0gPSB0b1VuaWNvZGUuc3RyIHx8IHRvVW5pY29kZTsKICAgICAgICBjb25zdCB1aW50OGFycmF5ID0gc3RyZWFtLmJ1ZmZlciA/IG5ldyBVaW50OEFycmF5KHN0cmVhbS5idWZmZXIuYnVmZmVyLCAwLCBzdHJlYW0uYnVmZmVyTGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KHN0cmVhbS5ieXRlcy5idWZmZXIsIHN0cmVhbS5zdGFydCwgc3RyZWFtLmVuZCAtIHN0cmVhbS5zdGFydCk7CiAgICAgICAgaGFzaC51cGRhdGUodWludDhhcnJheSk7CiAgICAgIH0gZWxzZSBpZiAodG9Vbmljb2RlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGhhc2gudXBkYXRlKHRvVW5pY29kZS5uYW1lKTsKICAgICAgfQogICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIikgfHwgYmFzZURpY3QuZ2V0KCJXaWR0aHMiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkod2lkdGhzKSkgewogICAgICAgIGNvbnN0IHdpZHRoc0J1ZiA9IFtdOwogICAgICAgIGZvciAoY29uc3QgZW50cnkgb2Ygd2lkdGhzKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGVudHJ5ID09PSAibnVtYmVyIiB8fCBlbnRyeSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICB3aWR0aHNCdWYucHVzaChlbnRyeS50b1N0cmluZygpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaGFzaC51cGRhdGUod2lkdGhzQnVmLmpvaW4oKSk7CiAgICAgIH0KICAgICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICAgIGhhc2gudXBkYXRlKCJjb21wb3NpdGVGb250Iik7CiAgICAgICAgY29uc3QgY29tcG9zaXRlV2lkdGhzID0gZGljdC5nZXQoIlciKSB8fCBiYXNlRGljdC5nZXQoIlciKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb21wb3NpdGVXaWR0aHMpKSB7CiAgICAgICAgICBjb25zdCB3aWR0aHNCdWYgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgY29tcG9zaXRlV2lkdGhzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkgPT09ICJudW1iZXIiIHx8IGVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgd2lkdGhzQnVmLnB1c2goZW50cnkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShlbnRyeSkpIHsKICAgICAgICAgICAgICBjb25zdCBzdWJXaWR0aHNCdWYgPSBbXTsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZW50cnkpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gIm51bWJlciIgfHwgZWxlbWVudCBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICAgICAgICBzdWJXaWR0aHNCdWYucHVzaChlbGVtZW50LnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB3aWR0aHNCdWYucHVzaChgWyR7c3ViV2lkdGhzQnVmLmpvaW4oKX1dYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGhhc2gudXBkYXRlKHdpZHRoc0J1Zi5qb2luKCkpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjaWRUb0dpZE1hcCA9IGRpY3QuZ2V0UmF3KCJDSURUb0dJRE1hcCIpIHx8IGJhc2VEaWN0LmdldFJhdygiQ0lEVG9HSURNYXAiKTsKICAgICAgICBpZiAoY2lkVG9HaWRNYXAgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICBoYXNoLnVwZGF0ZShjaWRUb0dpZE1hcC5uYW1lKTsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICBoYXNoLnVwZGF0ZShjaWRUb0dpZE1hcC50b1N0cmluZygpKTsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgICAgaGFzaC51cGRhdGUoY2lkVG9HaWRNYXAucGVla0J5dGVzKCkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgZGVzY3JpcHRvciwKICAgICAgZGljdCwKICAgICAgYmFzZURpY3QsCiAgICAgIGNvbXBvc2l0ZSwKICAgICAgdHlwZTogdHlwZS5uYW1lLAogICAgICBmaXJzdENoYXIsCiAgICAgIGxhc3RDaGFyLAogICAgICB0b1VuaWNvZGUsCiAgICAgIGhhc2g6IGhhc2ggPyBoYXNoLmhleGRpZ2VzdCgpIDogIiIKICAgIH07CiAgfQogIGFzeW5jIHRyYW5zbGF0ZUZvbnQoewogICAgZGVzY3JpcHRvciwKICAgIGRpY3QsCiAgICBiYXNlRGljdCwKICAgIGNvbXBvc2l0ZSwKICAgIHR5cGUsCiAgICBmaXJzdENoYXIsCiAgICBsYXN0Q2hhciwKICAgIHRvVW5pY29kZSwKICAgIGNzc0ZvbnRJbmZvCiAgfSkgewogICAgY29uc3QgaXNUeXBlM0ZvbnQgPSB0eXBlID09PSAiVHlwZTMiOwogICAgaWYgKCFkZXNjcmlwdG9yKSB7CiAgICAgIGlmIChpc1R5cGUzRm9udCkgewogICAgICAgIGRlc2NyaXB0b3IgPSBEaWN0LmVtcHR5OwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBiYXNlRm9udE5hbWUgPSBkaWN0LmdldCgiQmFzZUZvbnQiKTsKICAgICAgICBpZiAoIShiYXNlRm9udE5hbWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJCYXNlIGZvbnQgaXMgbm90IHNwZWNpZmllZCIpOwogICAgICAgIH0KICAgICAgICBiYXNlRm9udE5hbWUgPSBiYXNlRm9udE5hbWUubmFtZS5yZXBsYWNlQWxsKC9bLF9dL2csICItIik7CiAgICAgICAgY29uc3QgbWV0cmljcyA9IHRoaXMuZ2V0QmFzZUZvbnRNZXRyaWNzKGJhc2VGb250TmFtZSk7CiAgICAgICAgY29uc3QgZm9udE5hbWVXb1N0eWxlID0gYmFzZUZvbnROYW1lLnNwbGl0KCItIiwgMSlbMF07CiAgICAgICAgY29uc3QgZmxhZ3MgPSAodGhpcy5pc1NlcmlmRm9udChmb250TmFtZVdvU3R5bGUpID8gRm9udEZsYWdzLlNlcmlmIDogMCkgfCAobWV0cmljcy5tb25vc3BhY2UgPyBGb250RmxhZ3MuRml4ZWRQaXRjaCA6IDApIHwgKGdldFN5bWJvbHNGb250cygpW2ZvbnROYW1lV29TdHlsZV0gPyBGb250RmxhZ3MuU3ltYm9saWMgOiBGb250RmxhZ3MuTm9uc3ltYm9saWMpOwogICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgbmFtZTogYmFzZUZvbnROYW1lLAogICAgICAgICAgbG9hZGVkTmFtZTogYmFzZURpY3QubG9hZGVkTmFtZSwKICAgICAgICAgIHN5c3RlbUZvbnRJbmZvOiBudWxsLAogICAgICAgICAgd2lkdGhzOiBtZXRyaWNzLndpZHRocywKICAgICAgICAgIGRlZmF1bHRXaWR0aDogbWV0cmljcy5kZWZhdWx0V2lkdGgsCiAgICAgICAgICBpc1NpbXVsYXRlZEZsYWdzOiB0cnVlLAogICAgICAgICAgZmxhZ3MsCiAgICAgICAgICBmaXJzdENoYXIsCiAgICAgICAgICBsYXN0Q2hhciwKICAgICAgICAgIHRvVW5pY29kZSwKICAgICAgICAgIHhIZWlnaHQ6IDAsCiAgICAgICAgICBjYXBIZWlnaHQ6IDAsCiAgICAgICAgICBpdGFsaWNBbmdsZTogMCwKICAgICAgICAgIGlzVHlwZTNGb250CiAgICAgICAgfTsKICAgICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIik7CiAgICAgICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZSA9IGdldFN0YW5kYXJkRm9udE5hbWUoYmFzZUZvbnROYW1lKTsKICAgICAgICBsZXQgZmlsZSA9IG51bGw7CiAgICAgICAgaWYgKHN0YW5kYXJkRm9udE5hbWUpIHsKICAgICAgICAgIGZpbGUgPSBhd2FpdCB0aGlzLmZldGNoU3RhbmRhcmRGb250RGF0YShzdGFuZGFyZEZvbnROYW1lKTsKICAgICAgICAgIHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQgPSAhIWZpbGU7CiAgICAgICAgfQogICAgICAgIGlmICghcHJvcGVydGllcy5pc0ludGVybmFsRm9udCAmJiB0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMpIHsKICAgICAgICAgIHByb3BlcnRpZXMuc3lzdGVtRm9udEluZm8gPSBnZXRGb250U3Vic3RpdHV0aW9uKHRoaXMuc3lzdGVtRm9udENhY2hlLCB0aGlzLmlkRmFjdG9yeSwgdGhpcy5vcHRpb25zLnN0YW5kYXJkRm9udERhdGFVcmwsIGJhc2VGb250TmFtZSwgc3RhbmRhcmRGb250TmFtZSwgdHlwZSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5ld1Byb3BlcnRpZXMgPSBhd2FpdCB0aGlzLmV4dHJhY3REYXRhU3RydWN0dXJlcyhkaWN0LCBwcm9wZXJ0aWVzKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh3aWR0aHMpKSB7CiAgICAgICAgICBjb25zdCBnbHlwaFdpZHRocyA9IFtdOwogICAgICAgICAgbGV0IGogPSBmaXJzdENoYXI7CiAgICAgICAgICBmb3IgKGNvbnN0IHcgb2Ygd2lkdGhzKSB7CiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy54cmVmLmZldGNoSWZSZWYodyk7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2lkdGggPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgZ2x5cGhXaWR0aHNbal0gPSB3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBqKys7CiAgICAgICAgICB9CiAgICAgICAgICBuZXdQcm9wZXJ0aWVzLndpZHRocyA9IGdseXBoV2lkdGhzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXdQcm9wZXJ0aWVzLndpZHRocyA9IHRoaXMuYnVpbGRDaGFyQ29kZVRvV2lkdGgobWV0cmljcy53aWR0aHMsIG5ld1Byb3BlcnRpZXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEZvbnQoYmFzZUZvbnROYW1lLCBmaWxlLCBuZXdQcm9wZXJ0aWVzLCB0aGlzLm9wdGlvbnMpOwogICAgICB9CiAgICB9CiAgICBsZXQgZm9udE5hbWUgPSBkZXNjcmlwdG9yLmdldCgiRm9udE5hbWUiKTsKICAgIGxldCBiYXNlRm9udCA9IGRpY3QuZ2V0KCJCYXNlRm9udCIpOwogICAgaWYgKHR5cGVvZiBmb250TmFtZSA9PT0gInN0cmluZyIpIHsKICAgICAgZm9udE5hbWUgPSBOYW1lLmdldChmb250TmFtZSk7CiAgICB9CiAgICBpZiAodHlwZW9mIGJhc2VGb250ID09PSAic3RyaW5nIikgewogICAgICBiYXNlRm9udCA9IE5hbWUuZ2V0KGJhc2VGb250KTsKICAgIH0KICAgIGNvbnN0IGZvbnROYW1lU3RyID0gZm9udE5hbWU/Lm5hbWU7CiAgICBjb25zdCBiYXNlRm9udFN0ciA9IGJhc2VGb250Py5uYW1lOwogICAgaWYgKGlzVHlwZTNGb250KSB7CiAgICAgIGlmICghZm9udE5hbWVTdHIpIHsKICAgICAgICBmb250TmFtZSA9IE5hbWUuZ2V0KHR5cGUpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGZvbnROYW1lU3RyICE9PSBiYXNlRm9udFN0cikgewogICAgICBpbmZvKGBUaGUgRm9udERlc2NyaXB0b3IncyBGb250TmFtZSBpcyAiJHtmb250TmFtZVN0cn0iIGJ1dCBgICsgYHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgRm9udCdzIEJhc2VGb250ICIke2Jhc2VGb250U3RyfSIuYCk7CiAgICAgIGlmIChmb250TmFtZVN0ciAmJiBiYXNlRm9udFN0ciAmJiAoYmFzZUZvbnRTdHIuc3RhcnRzV2l0aChmb250TmFtZVN0cikgfHwgIWlzS25vd25Gb250TmFtZShmb250TmFtZVN0cikgJiYgaXNLbm93bkZvbnROYW1lKGJhc2VGb250U3RyKSkpIHsKICAgICAgICBmb250TmFtZSA9IG51bGw7CiAgICAgIH0KICAgICAgZm9udE5hbWUgfHw9IGJhc2VGb250OwogICAgfQogICAgaWYgKCEoZm9udE5hbWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBuYW1lIik7CiAgICB9CiAgICBsZXQgZm9udEZpbGUsIHN1YnR5cGUsIGxlbmd0aDEsIGxlbmd0aDIsIGxlbmd0aDM7CiAgICB0cnkgewogICAgICBmb250RmlsZSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250RmlsZSIsICJGb250RmlsZTIiLCAiRm9udEZpbGUzIik7CiAgICAgIGlmIChmb250RmlsZSkgewogICAgICAgIGlmICghKGZvbnRGaWxlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRm9udEZpbGUgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgfSBlbHNlIGlmIChmb250RmlsZS5pc0VtcHR5KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkZvbnRGaWxlIGlzIGVtcHR5Iik7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGB0cmFuc2xhdGVGb250IC0gZmV0Y2hpbmcgIiR7Zm9udE5hbWUubmFtZX0iIGZvbnQgZmlsZTogIiR7ZXh9Ii5gKTsKICAgICAgZm9udEZpbGUgPSBudWxsOwogICAgfQogICAgbGV0IGlzSW50ZXJuYWxGb250ID0gZmFsc2U7CiAgICBsZXQgZ2x5cGhTY2FsZUZhY3RvcnMgPSBudWxsOwogICAgbGV0IHN5c3RlbUZvbnRJbmZvID0gbnVsbDsKICAgIGlmIChmb250RmlsZSkgewogICAgICBpZiAoZm9udEZpbGUuZGljdCkgewogICAgICAgIGNvbnN0IHN1YnR5cGVFbnRyeSA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgaWYgKHN1YnR5cGVFbnRyeSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgIHN1YnR5cGUgPSBzdWJ0eXBlRW50cnkubmFtZTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoMSA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJMZW5ndGgxIik7CiAgICAgICAgbGVuZ3RoMiA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJMZW5ndGgyIik7CiAgICAgICAgbGVuZ3RoMyA9IGZvbnRGaWxlLmRpY3QuZ2V0KCJMZW5ndGgzIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoY3NzRm9udEluZm8pIHsKICAgICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZSA9IGdldFhmYUZvbnROYW1lKGZvbnROYW1lLm5hbWUpOwogICAgICBpZiAoc3RhbmRhcmRGb250TmFtZSkgewogICAgICAgIGNzc0ZvbnRJbmZvLmZvbnRGYW1pbHkgPSBgJHtjc3NGb250SW5mby5mb250RmFtaWx5fS1QZGZKUy1YRkFgOwogICAgICAgIGNzc0ZvbnRJbmZvLm1ldHJpY3MgPSBzdGFuZGFyZEZvbnROYW1lLm1ldHJpY3MgfHwgbnVsbDsKICAgICAgICBnbHlwaFNjYWxlRmFjdG9ycyA9IHN0YW5kYXJkRm9udE5hbWUuZmFjdG9ycyB8fCBudWxsOwogICAgICAgIGZvbnRGaWxlID0gYXdhaXQgdGhpcy5mZXRjaFN0YW5kYXJkRm9udERhdGEoc3RhbmRhcmRGb250TmFtZS5uYW1lKTsKICAgICAgICBpc0ludGVybmFsRm9udCA9ICEhZm9udEZpbGU7CiAgICAgICAgYmFzZURpY3QgPSBkaWN0ID0gZ2V0WGZhRm9udERpY3QoZm9udE5hbWUubmFtZSk7CiAgICAgICAgY29tcG9zaXRlID0gdHJ1ZTsKICAgICAgfQogICAgfSBlbHNlIGlmICghaXNUeXBlM0ZvbnQpIHsKICAgICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZSA9IGdldFN0YW5kYXJkRm9udE5hbWUoZm9udE5hbWUubmFtZSk7CiAgICAgIGlmIChzdGFuZGFyZEZvbnROYW1lKSB7CiAgICAgICAgZm9udEZpbGUgPSBhd2FpdCB0aGlzLmZldGNoU3RhbmRhcmRGb250RGF0YShzdGFuZGFyZEZvbnROYW1lKTsKICAgICAgICBpc0ludGVybmFsRm9udCA9ICEhZm9udEZpbGU7CiAgICAgIH0KICAgICAgaWYgKCFpc0ludGVybmFsRm9udCAmJiB0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMpIHsKICAgICAgICBzeXN0ZW1Gb250SW5mbyA9IGdldEZvbnRTdWJzdGl0dXRpb24odGhpcy5zeXN0ZW1Gb250Q2FjaGUsIHRoaXMuaWRGYWN0b3J5LCB0aGlzLm9wdGlvbnMuc3RhbmRhcmRGb250RGF0YVVybCwgZm9udE5hbWUubmFtZSwgc3RhbmRhcmRGb250TmFtZSwgdHlwZSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGZvbnRNYXRyaXggPSBsb29rdXBNYXRyaXgoZGljdC5nZXRBcnJheSgiRm9udE1hdHJpeCIpLCBGT05UX0lERU5USVRZX01BVFJJWCk7CiAgICBjb25zdCBiYm94ID0gbG9va3VwTm9ybWFsUmVjdChkZXNjcmlwdG9yLmdldEFycmF5KCJGb250QkJveCIpIHx8IGRpY3QuZ2V0QXJyYXkoIkZvbnRCQm94IiksIGlzVHlwZTNGb250ID8gWzAsIDAsIDAsIDBdIDogdW5kZWZpbmVkKTsKICAgIGxldCBhc2NlbnQgPSBkZXNjcmlwdG9yLmdldCgiQXNjZW50Iik7CiAgICBpZiAodHlwZW9mIGFzY2VudCAhPT0gIm51bWJlciIpIHsKICAgICAgYXNjZW50ID0gdW5kZWZpbmVkOwogICAgfQogICAgbGV0IGRlc2NlbnQgPSBkZXNjcmlwdG9yLmdldCgiRGVzY2VudCIpOwogICAgaWYgKHR5cGVvZiBkZXNjZW50ICE9PSAibnVtYmVyIikgewogICAgICBkZXNjZW50ID0gdW5kZWZpbmVkOwogICAgfQogICAgbGV0IHhIZWlnaHQgPSBkZXNjcmlwdG9yLmdldCgiWEhlaWdodCIpOwogICAgaWYgKHR5cGVvZiB4SGVpZ2h0ICE9PSAibnVtYmVyIikgewogICAgICB4SGVpZ2h0ID0gMDsKICAgIH0KICAgIGxldCBjYXBIZWlnaHQgPSBkZXNjcmlwdG9yLmdldCgiQ2FwSGVpZ2h0Iik7CiAgICBpZiAodHlwZW9mIGNhcEhlaWdodCAhPT0gIm51bWJlciIpIHsKICAgICAgY2FwSGVpZ2h0ID0gMDsKICAgIH0KICAgIGxldCBmbGFncyA9IGRlc2NyaXB0b3IuZ2V0KCJGbGFncyIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZsYWdzKSkgewogICAgICBmbGFncyA9IDA7CiAgICB9CiAgICBsZXQgaXRhbGljQW5nbGUgPSBkZXNjcmlwdG9yLmdldCgiSXRhbGljQW5nbGUiKTsKICAgIGlmICh0eXBlb2YgaXRhbGljQW5nbGUgIT09ICJudW1iZXIiKSB7CiAgICAgIGl0YWxpY0FuZ2xlID0gMDsKICAgIH0KICAgIGNvbnN0IHByb3BlcnRpZXMgPSB7CiAgICAgIHR5cGUsCiAgICAgIG5hbWU6IGZvbnROYW1lLm5hbWUsCiAgICAgIHN1YnR5cGUsCiAgICAgIGZpbGU6IGZvbnRGaWxlLAogICAgICBsZW5ndGgxLAogICAgICBsZW5ndGgyLAogICAgICBsZW5ndGgzLAogICAgICBpc0ludGVybmFsRm9udCwKICAgICAgbG9hZGVkTmFtZTogYmFzZURpY3QubG9hZGVkTmFtZSwKICAgICAgY29tcG9zaXRlLAogICAgICBmaXhlZFBpdGNoOiBmYWxzZSwKICAgICAgZm9udE1hdHJpeCwKICAgICAgZmlyc3RDaGFyLAogICAgICBsYXN0Q2hhciwKICAgICAgdG9Vbmljb2RlLAogICAgICBiYm94LAogICAgICBhc2NlbnQsCiAgICAgIGRlc2NlbnQsCiAgICAgIHhIZWlnaHQsCiAgICAgIGNhcEhlaWdodCwKICAgICAgZmxhZ3MsCiAgICAgIGl0YWxpY0FuZ2xlLAogICAgICBpc1R5cGUzRm9udCwKICAgICAgY3NzRm9udEluZm8sCiAgICAgIHNjYWxlRmFjdG9yczogZ2x5cGhTY2FsZUZhY3RvcnMsCiAgICAgIHN5c3RlbUZvbnRJbmZvCiAgICB9OwogICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICBjb25zdCBjaWRFbmNvZGluZyA9IGJhc2VEaWN0LmdldCgiRW5jb2RpbmciKTsKICAgICAgaWYgKGNpZEVuY29kaW5nIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIHByb3BlcnRpZXMuY2lkRW5jb2RpbmcgPSBjaWRFbmNvZGluZy5uYW1lOwogICAgICB9CiAgICAgIGNvbnN0IGNNYXAgPSBhd2FpdCBDTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgIGVuY29kaW5nOiBjaWRFbmNvZGluZywKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KTsKICAgICAgcHJvcGVydGllcy5jTWFwID0gY01hcDsKICAgICAgcHJvcGVydGllcy52ZXJ0aWNhbCA9IHByb3BlcnRpZXMuY01hcC52ZXJ0aWNhbDsKICAgIH0KICAgIGNvbnN0IG5ld1Byb3BlcnRpZXMgPSBhd2FpdCB0aGlzLmV4dHJhY3REYXRhU3RydWN0dXJlcyhkaWN0LCBwcm9wZXJ0aWVzKTsKICAgIHRoaXMuZXh0cmFjdFdpZHRocyhkaWN0LCBkZXNjcmlwdG9yLCBuZXdQcm9wZXJ0aWVzKTsKICAgIHJldHVybiBuZXcgRm9udChmb250TmFtZS5uYW1lLCBmb250RmlsZSwgbmV3UHJvcGVydGllcywgdGhpcy5vcHRpb25zKTsKICB9CiAgc3RhdGljIGJ1aWxkRm9udFBhdGhzKGZvbnQsIGdseXBocywgaGFuZGxlciwgZXZhbHVhdG9yT3B0aW9ucykgewogICAgZnVuY3Rpb24gYnVpbGRQYXRoKGZvbnRDaGFyKSB7CiAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGAke2ZvbnQubG9hZGVkTmFtZX1fcGF0aF8ke2ZvbnRDaGFyfWA7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGZvbnQucmVuZGVyZXIuaGFzQnVpbHRQYXRoKGZvbnRDaGFyKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBoYW5kbGVyLnNlbmQoImNvbW1vbm9iaiIsIFtnbHlwaE5hbWUsICJGb250UGF0aCIsIGZvbnQucmVuZGVyZXIuZ2V0UGF0aEpzKGZvbnRDaGFyKV0pOwogICAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgICBpZiAoZXZhbHVhdG9yT3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgIHdhcm4oYGJ1aWxkRm9udFBhdGhzIC0gaWdub3JpbmcgJHtnbHlwaE5hbWV9IGdseXBoOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IGdseXBoIG9mIGdseXBocykgewogICAgICBidWlsZFBhdGgoZ2x5cGguZm9udENoYXIpOwogICAgICBjb25zdCBhY2NlbnQgPSBnbHlwaC5hY2NlbnQ7CiAgICAgIGlmIChhY2NlbnQ/LmZvbnRDaGFyKSB7CiAgICAgICAgYnVpbGRQYXRoKGFjY2VudC5mb250Q2hhcik7CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGdldCBmYWxsYmFja0ZvbnREaWN0KCkgewogICAgY29uc3QgZGljdCA9IG5ldyBEaWN0KCk7CiAgICBkaWN0LnNldCgiQmFzZUZvbnQiLCBOYW1lLmdldCgiSGVsdmV0aWNhIikpOwogICAgZGljdC5zZXQoIlR5cGUiLCBOYW1lLmdldCgiRmFsbGJhY2tUeXBlIikpOwogICAgZGljdC5zZXQoIlN1YnR5cGUiLCBOYW1lLmdldCgiRmFsbGJhY2tUeXBlIikpOwogICAgZGljdC5zZXQoIkVuY29kaW5nIiwgTmFtZS5nZXQoIldpbkFuc2lFbmNvZGluZyIpKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImZhbGxiYWNrRm9udERpY3QiLCBkaWN0KTsKICB9Cn0KY2xhc3MgVHJhbnNsYXRlZEZvbnQgewogICNzZW50ID0gZmFsc2U7CiAgI3R5cGUzTG9hZGVkID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBsb2FkZWROYW1lLAogICAgZm9udCwKICAgIGRpY3QKICB9KSB7CiAgICB0aGlzLmxvYWRlZE5hbWUgPSBsb2FkZWROYW1lOwogICAgdGhpcy5mb250ID0gZm9udDsKICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICB0aGlzLnR5cGUzRGVwZW5kZW5jaWVzID0gZm9udC5pc1R5cGUzRm9udCA/IG5ldyBTZXQoKSA6IG51bGw7CiAgfQogIHNlbmQoaGFuZGxlcikgewogICAgaWYgKHRoaXMuI3NlbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jc2VudCA9IHRydWU7CiAgICBjb25zdCBmb250RGF0YSA9IHRoaXMuZm9udC5leHBvcnREYXRhKCk7CiAgICBjb25zdCB0cmFuc2ZlciA9IFtdOwogICAgaWYgKGZvbnREYXRhLmRhdGEpIHsKICAgICAgaWYgKGZvbnREYXRhLmRhdGEuY2hhclByb2NPcGVyYXRvckxpc3QpIHsKICAgICAgICBmb250RGF0YS5jaGFyUHJvY09wZXJhdG9yTGlzdCA9IGZvbnREYXRhLmRhdGEuY2hhclByb2NPcGVyYXRvckxpc3Q7CiAgICAgIH0KICAgICAgZm9udERhdGEuZGF0YSA9IEZvbnRJbmZvLndyaXRlKGZvbnREYXRhLmRhdGEpOwogICAgICB0cmFuc2Zlci5wdXNoKGZvbnREYXRhLmRhdGEpOwogICAgfQogICAgaGFuZGxlci5zZW5kKCJjb21tb25vYmoiLCBbdGhpcy5sb2FkZWROYW1lLCAiRm9udCIsIGZvbnREYXRhXSwgdHJhbnNmZXIpOwogIH0KICBmYWxsYmFjayhoYW5kbGVyLCBldmFsdWF0b3JPcHRpb25zKSB7CiAgICBpZiAoIXRoaXMuZm9udC5kYXRhKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZm9udC5kaXNhYmxlRm9udEZhY2UgPSB0cnVlOwogICAgUGFydGlhbEV2YWx1YXRvci5idWlsZEZvbnRQYXRocyh0aGlzLmZvbnQsIHRoaXMuZm9udC5nbHlwaENhY2hlVmFsdWVzLCBoYW5kbGVyLCBldmFsdWF0b3JPcHRpb25zKTsKICB9CiAgbG9hZFR5cGUzRGF0YShldmFsdWF0b3IsIHJlc291cmNlcywgdGFzaykgewogICAgaWYgKHRoaXMuI3R5cGUzTG9hZGVkKSB7CiAgICAgIHJldHVybiB0aGlzLiN0eXBlM0xvYWRlZDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgZm9udCwKICAgICAgdHlwZTNEZXBlbmRlbmNpZXMKICAgIH0gPSB0aGlzOwogICAgYXNzZXJ0KGZvbnQuaXNUeXBlM0ZvbnQsICJNdXN0IGJlIGEgVHlwZTMgZm9udC4iKTsKICAgIGNvbnN0IHR5cGUzRXZhbHVhdG9yID0gZXZhbHVhdG9yLmNsb25lKHsKICAgICAgaWdub3JlRXJyb3JzOiBmYWxzZQogICAgfSk7CiAgICBjb25zdCB0eXBlM0ZvbnRSZWZzID0gbmV3IFJlZlNldChldmFsdWF0b3IudHlwZTNGb250UmVmcyk7CiAgICBpZiAodGhpcy5kaWN0Lm9iaklkICYmICF0eXBlM0ZvbnRSZWZzLmhhcyh0aGlzLmRpY3Qub2JqSWQpKSB7CiAgICAgIHR5cGUzRm9udFJlZnMucHV0KHRoaXMuZGljdC5vYmpJZCk7CiAgICB9CiAgICB0eXBlM0V2YWx1YXRvci50eXBlM0ZvbnRSZWZzID0gdHlwZTNGb250UmVmczsKICAgIGxldCBsb2FkQ2hhclByb2NzUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpOwogICAgY29uc3QgY2hhclByb2NzID0gdGhpcy5kaWN0LmdldCgiQ2hhclByb2NzIik7CiAgICBjb25zdCBmb250UmVzb3VyY2VzID0gdGhpcy5kaWN0LmdldCgiUmVzb3VyY2VzIikgfHwgcmVzb3VyY2VzOwogICAgY29uc3QgY2hhclByb2NPcGVyYXRvckxpc3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgW3gwLCB5MCwgeDEsIHkxXSA9IGZvbnQuYmJveCwKICAgICAgd2lkdGggPSB4MSAtIHgwLAogICAgICBoZWlnaHQgPSB5MSAtIHkwOwogICAgY29uc3QgZm9udEJCb3hTaXplID0gTWF0aC5oeXBvdCh3aWR0aCwgaGVpZ2h0KTsKICAgIGZvciAoY29uc3Qga2V5IG9mIGNoYXJQcm9jcy5nZXRLZXlzKCkpIHsKICAgICAgbG9hZENoYXJQcm9jc1Byb21pc2UgPSBsb2FkQ2hhclByb2NzUHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgICBjb25zdCBnbHlwaFN0cmVhbSA9IGNoYXJQcm9jcy5nZXQoa2V5KTsKICAgICAgICBjb25zdCBvcGVyYXRvckxpc3QgPSBuZXcgT3BlcmF0b3JMaXN0KCk7CiAgICAgICAgcmV0dXJuIHR5cGUzRXZhbHVhdG9yLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgICAgICBzdHJlYW06IGdseXBoU3RyZWFtLAogICAgICAgICAgdGFzaywKICAgICAgICAgIHJlc291cmNlczogZm9udFJlc291cmNlcywKICAgICAgICAgIG9wZXJhdG9yTGlzdAogICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgc3dpdGNoIChvcGVyYXRvckxpc3QuZm5BcnJheVswXSkgewogICAgICAgICAgICBjYXNlIE9QUy5zZXRDaGFyV2lkdGhBbmRCb3VuZHM6CiAgICAgICAgICAgICAgdGhpcy4jcmVtb3ZlVHlwZTNDb2xvck9wZXJhdG9ycyhvcGVyYXRvckxpc3QsIGZvbnRCQm94U2l6ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BTLnNldENoYXJXaWR0aDoKICAgICAgICAgICAgICBpZiAoIWZvbnRCQm94U2l6ZSkgewogICAgICAgICAgICAgICAgdGhpcy4jZ3Vlc3NUeXBlM0ZvbnRCQm94KG9wZXJhdG9yTGlzdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY2hhclByb2NPcGVyYXRvckxpc3Rba2V5XSA9IG9wZXJhdG9yTGlzdC5nZXRJUigpOwogICAgICAgICAgZm9yIChjb25zdCBkZXBlbmRlbmN5IG9mIG9wZXJhdG9yTGlzdC5kZXBlbmRlbmNpZXMpIHsKICAgICAgICAgICAgdHlwZTNEZXBlbmRlbmNpZXMuYWRkKGRlcGVuZGVuY3kpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIHdhcm4oYFR5cGUzIGZvbnQgcmVzb3VyY2UgIiR7a2V5fSIgaXMgbm90IGF2YWlsYWJsZS5gKTsKICAgICAgICAgIGNvbnN0IGR1bW15T3BlcmF0b3JMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgICAgICAgY2hhclByb2NPcGVyYXRvckxpc3Rba2V5XSA9IGR1bW15T3BlcmF0b3JMaXN0LmdldElSKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgdGhpcy4jdHlwZTNMb2FkZWQgPSBsb2FkQ2hhclByb2NzUHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgZm9udC5jaGFyUHJvY09wZXJhdG9yTGlzdCA9IGNoYXJQcm9jT3BlcmF0b3JMaXN0OwogICAgICBpZiAodGhpcy5fYmJveCkgewogICAgICAgIGZvbnQuaXNDaGFyQkJveCA9IHRydWU7CiAgICAgICAgZm9udC5iYm94ID0gdGhpcy5fYmJveDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdGhpcy4jdHlwZTNMb2FkZWQ7CiAgfQogICNyZW1vdmVUeXBlM0NvbG9yT3BlcmF0b3JzKG9wZXJhdG9yTGlzdCwgZm9udEJCb3hTaXplID0gTmFOKSB7CiAgICBjb25zdCBjaGFyQkJveCA9IFV0aWwubm9ybWFsaXplUmVjdChvcGVyYXRvckxpc3QuYXJnc0FycmF5WzBdLnNsaWNlKDIpKSwKICAgICAgd2lkdGggPSBjaGFyQkJveFsyXSAtIGNoYXJCQm94WzBdLAogICAgICBoZWlnaHQgPSBjaGFyQkJveFszXSAtIGNoYXJCQm94WzFdOwogICAgY29uc3QgY2hhckJCb3hTaXplID0gTWF0aC5oeXBvdCh3aWR0aCwgaGVpZ2h0KTsKICAgIGlmICh3aWR0aCA9PT0gMCB8fCBoZWlnaHQgPT09IDApIHsKICAgICAgb3BlcmF0b3JMaXN0LmZuQXJyYXkuc3BsaWNlKDAsIDEpOwogICAgICBvcGVyYXRvckxpc3QuYXJnc0FycmF5LnNwbGljZSgwLCAxKTsKICAgIH0gZWxzZSBpZiAoZm9udEJCb3hTaXplID09PSAwIHx8IE1hdGgucm91bmQoY2hhckJCb3hTaXplIC8gZm9udEJCb3hTaXplKSA+PSAxMCkgewogICAgICB0aGlzLl9iYm94ID8/PSBbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV07CiAgICAgIFV0aWwucmVjdEJvdW5kaW5nQm94KC4uLmNoYXJCQm94LCB0aGlzLl9iYm94KTsKICAgIH0KICAgIGxldCBpID0gMCwKICAgICAgaWkgPSBvcGVyYXRvckxpc3QubGVuZ3RoOwogICAgd2hpbGUgKGkgPCBpaSkgewogICAgICBzd2l0Y2ggKG9wZXJhdG9yTGlzdC5mbkFycmF5W2ldKSB7CiAgICAgICAgY2FzZSBPUFMuc2V0Q2hhcldpZHRoQW5kQm91bmRzOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZToKICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3JTcGFjZToKICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VDb2xvcjoKICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VDb2xvck46CiAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yOgogICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvck46CiAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlR3JheToKICAgICAgICBjYXNlIE9QUy5zZXRGaWxsR3JheToKICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VSR0JDb2xvcjoKICAgICAgICBjYXNlIE9QUy5zZXRGaWxsUkdCQ29sb3I6CiAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ01ZS0NvbG9yOgogICAgICAgIGNhc2UgT1BTLnNldEZpbGxDTVlLQ29sb3I6CiAgICAgICAgY2FzZSBPUFMuc2hhZGluZ0ZpbGw6CiAgICAgICAgY2FzZSBPUFMuc2V0UmVuZGVyaW5nSW50ZW50OgogICAgICAgICAgb3BlcmF0b3JMaXN0LmZuQXJyYXkuc3BsaWNlKGksIDEpOwogICAgICAgICAgb3BlcmF0b3JMaXN0LmFyZ3NBcnJheS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBpaS0tOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgY2FzZSBPUFMuc2V0R1N0YXRlOgogICAgICAgICAgY29uc3QgW2dTdGF0ZU9ial0gPSBvcGVyYXRvckxpc3QuYXJnc0FycmF5W2ldOwogICAgICAgICAgbGV0IGogPSAwLAogICAgICAgICAgICBqaiA9IGdTdGF0ZU9iai5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoaiA8IGpqKSB7CiAgICAgICAgICAgIGNvbnN0IFtnU3RhdGVLZXldID0gZ1N0YXRlT2JqW2pdOwogICAgICAgICAgICBzd2l0Y2ggKGdTdGF0ZUtleSkgewogICAgICAgICAgICAgIGNhc2UgIlRSIjoKICAgICAgICAgICAgICBjYXNlICJUUjIiOgogICAgICAgICAgICAgIGNhc2UgIkhUIjoKICAgICAgICAgICAgICBjYXNlICJCRyI6CiAgICAgICAgICAgICAgY2FzZSAiQkcyIjoKICAgICAgICAgICAgICBjYXNlICJVQ1IiOgogICAgICAgICAgICAgIGNhc2UgIlVDUjIiOgogICAgICAgICAgICAgICAgZ1N0YXRlT2JqLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgIGpqLS07CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBqKys7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpKys7CiAgICB9CiAgfQogICNndWVzc1R5cGUzRm9udEJCb3gob3BlcmF0b3JMaXN0KSB7CiAgICBsZXQgaSA9IDE7CiAgICBjb25zdCBpaSA9IG9wZXJhdG9yTGlzdC5sZW5ndGg7CiAgICB3aGlsZSAoaSA8IGlpKSB7CiAgICAgIHN3aXRjaCAob3BlcmF0b3JMaXN0LmZuQXJyYXlbaV0pIHsKICAgICAgICBjYXNlIE9QUy5jb25zdHJ1Y3RQYXRoOgogICAgICAgICAgY29uc3QgbWluTWF4ID0gb3BlcmF0b3JMaXN0LmFyZ3NBcnJheVtpXVsyXTsKICAgICAgICAgIHRoaXMuX2Jib3ggPz89IFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XTsKICAgICAgICAgIFV0aWwucmVjdEJvdW5kaW5nQm94KC4uLm1pbk1heCwgdGhpcy5fYmJveCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpKys7CiAgICB9CiAgfQp9CmNsYXNzIFN0YXRlTWFuYWdlciB7CiAgY29uc3RydWN0b3IoaW5pdGlhbFN0YXRlID0gbmV3IEV2YWxTdGF0ZSgpKSB7CiAgICB0aGlzLnN0YXRlID0gaW5pdGlhbFN0YXRlOwogICAgdGhpcy5zdGF0ZVN0YWNrID0gW107CiAgfQogIHNhdmUoKSB7CiAgICBjb25zdCBvbGQgPSB0aGlzLnN0YXRlOwogICAgdGhpcy5zdGF0ZVN0YWNrLnB1c2godGhpcy5zdGF0ZSk7CiAgICB0aGlzLnN0YXRlID0gb2xkLmNsb25lKCk7CiAgfQogIHJlc3RvcmUoKSB7CiAgICBjb25zdCBwcmV2ID0gdGhpcy5zdGF0ZVN0YWNrLnBvcCgpOwogICAgaWYgKHByZXYpIHsKICAgICAgdGhpcy5zdGF0ZSA9IHByZXY7CiAgICB9CiAgfQogIHRyYW5zZm9ybShhcmdzKSB7CiAgICB0aGlzLnN0YXRlLmN0bSA9IFV0aWwudHJhbnNmb3JtKHRoaXMuc3RhdGUuY3RtLCBhcmdzKTsKICB9Cn0KY2xhc3MgVGV4dFN0YXRlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuY3RtID0gbmV3IEZsb2F0MzJBcnJheShJREVOVElUWV9NQVRSSVgpOwogICAgdGhpcy5mb250TmFtZSA9IG51bGw7CiAgICB0aGlzLmZvbnRTaXplID0gMDsKICAgIHRoaXMubG9hZGVkTmFtZSA9IG51bGw7CiAgICB0aGlzLmZvbnQgPSBudWxsOwogICAgdGhpcy5mb250TWF0cml4ID0gRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICB0aGlzLnRleHRNYXRyaXggPSBJREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgIHRoaXMudGV4dExpbmVNYXRyaXggPSBJREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgIHRoaXMuY2hhclNwYWNpbmcgPSAwOwogICAgdGhpcy53b3JkU3BhY2luZyA9IDA7CiAgICB0aGlzLmxlYWRpbmcgPSAwOwogICAgdGhpcy50ZXh0SFNjYWxlID0gMTsKICAgIHRoaXMudGV4dFJpc2UgPSAwOwogIH0KICBzZXRUZXh0TWF0cml4KGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRNYXRyaXg7CiAgICBtWzBdID0gYTsKICAgIG1bMV0gPSBiOwogICAgbVsyXSA9IGM7CiAgICBtWzNdID0gZDsKICAgIG1bNF0gPSBlOwogICAgbVs1XSA9IGY7CiAgfQogIHNldFRleHRMaW5lTWF0cml4KGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRMaW5lTWF0cml4OwogICAgbVswXSA9IGE7CiAgICBtWzFdID0gYjsKICAgIG1bMl0gPSBjOwogICAgbVszXSA9IGQ7CiAgICBtWzRdID0gZTsKICAgIG1bNV0gPSBmOwogIH0KICB0cmFuc2xhdGVUZXh0TWF0cml4KHgsIHkpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRNYXRyaXg7CiAgICBtWzRdID0gbVswXSAqIHggKyBtWzJdICogeSArIG1bNF07CiAgICBtWzVdID0gbVsxXSAqIHggKyBtWzNdICogeSArIG1bNV07CiAgfQogIHRyYW5zbGF0ZVRleHRMaW5lTWF0cml4KHgsIHkpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRMaW5lTWF0cml4OwogICAgbVs0XSA9IG1bMF0gKiB4ICsgbVsyXSAqIHkgKyBtWzRdOwogICAgbVs1XSA9IG1bMV0gKiB4ICsgbVszXSAqIHkgKyBtWzVdOwogIH0KICBjYXJyaWFnZVJldHVybigpIHsKICAgIHRoaXMudHJhbnNsYXRlVGV4dExpbmVNYXRyaXgoMCwgLXRoaXMubGVhZGluZyk7CiAgICB0aGlzLnRleHRNYXRyaXggPSB0aGlzLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgfQogIGNsb25lKCkgewogICAgY29uc3QgY2xvbmUgPSBPYmplY3QuY3JlYXRlKHRoaXMpOwogICAgY2xvbmUudGV4dE1hdHJpeCA9IHRoaXMudGV4dE1hdHJpeC5zbGljZSgpOwogICAgY2xvbmUudGV4dExpbmVNYXRyaXggPSB0aGlzLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgICBjbG9uZS5mb250TWF0cml4ID0gdGhpcy5mb250TWF0cml4LnNsaWNlKCk7CiAgICByZXR1cm4gY2xvbmU7CiAgfQp9CmNsYXNzIEV2YWxTdGF0ZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmN0bSA9IG5ldyBGbG9hdDMyQXJyYXkoSURFTlRJVFlfTUFUUklYKTsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLnRleHRSZW5kZXJpbmdNb2RlID0gVGV4dFJlbmRlcmluZ01vZGUuRklMTDsKICAgIHRoaXMuX2ZpbGxDb2xvclNwYWNlID0gdGhpcy5fc3Ryb2tlQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5ncmF5OwogICAgdGhpcy5wYXR0ZXJuRmlsbENvbG9yU3BhY2UgPSBudWxsOwogICAgdGhpcy5wYXR0ZXJuU3Ryb2tlQ29sb3JTcGFjZSA9IG51bGw7CiAgICB0aGlzLmN1cnJlbnRQb2ludFggPSB0aGlzLmN1cnJlbnRQb2ludFkgPSAwOwogICAgdGhpcy5wYXRoTWluTWF4ID0gbmV3IEZsb2F0MzJBcnJheShbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV0pOwogICAgdGhpcy5wYXRoQnVmZmVyID0gW107CiAgfQogIGdldCBmaWxsQ29sb3JTcGFjZSgpIHsKICAgIHJldHVybiB0aGlzLl9maWxsQ29sb3JTcGFjZTsKICB9CiAgc2V0IGZpbGxDb2xvclNwYWNlKGNvbG9yU3BhY2UpIHsKICAgIHRoaXMuX2ZpbGxDb2xvclNwYWNlID0gdGhpcy5wYXR0ZXJuRmlsbENvbG9yU3BhY2UgPSBjb2xvclNwYWNlOwogIH0KICBnZXQgc3Ryb2tlQ29sb3JTcGFjZSgpIHsKICAgIHJldHVybiB0aGlzLl9zdHJva2VDb2xvclNwYWNlOwogIH0KICBzZXQgc3Ryb2tlQ29sb3JTcGFjZShjb2xvclNwYWNlKSB7CiAgICB0aGlzLl9zdHJva2VDb2xvclNwYWNlID0gdGhpcy5wYXR0ZXJuU3Ryb2tlQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CiAgfQogIGNsb25lKHsKICAgIG5ld1BhdGggPSBmYWxzZQogIH0gPSB7fSkgewogICAgY29uc3QgY2xvbmUgPSBPYmplY3QuY3JlYXRlKHRoaXMpOwogICAgaWYgKG5ld1BhdGgpIHsKICAgICAgY2xvbmUucGF0aEJ1ZmZlciA9IFtdOwogICAgICBjbG9uZS5wYXRoTWluTWF4ID0gbmV3IEZsb2F0MzJBcnJheShbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV0pOwogICAgfQogICAgcmV0dXJuIGNsb25lOwogIH0KfQpjbGFzcyBFdmFsdWF0b3JQcmVwcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgb3BNYXAoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJvcE1hcCIsIE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgewogICAgICB3OiB7CiAgICAgICAgaWQ6IE9QUy5zZXRMaW5lV2lkdGgsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEo6IHsKICAgICAgICBpZDogT1BTLnNldExpbmVDYXAsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGo6IHsKICAgICAgICBpZDogT1BTLnNldExpbmVKb2luLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBNOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRNaXRlckxpbWl0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBkOiB7CiAgICAgICAgaWQ6IE9QUy5zZXREYXNoLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICByaTogewogICAgICAgIGlkOiBPUFMuc2V0UmVuZGVyaW5nSW50ZW50LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBpOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGbGF0bmVzcywKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgZ3M6IHsKICAgICAgICBpZDogT1BTLnNldEdTdGF0ZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgcTogewogICAgICAgIGlkOiBPUFMuc2F2ZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgUTogewogICAgICAgIGlkOiBPUFMucmVzdG9yZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgY206IHsKICAgICAgICBpZDogT1BTLnRyYW5zZm9ybSwKICAgICAgICBudW1BcmdzOiA2LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgbTogewogICAgICAgIGlkOiBPUFMubW92ZVRvLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBsOiB7CiAgICAgICAgaWQ6IE9QUy5saW5lVG8sCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGM6IHsKICAgICAgICBpZDogT1BTLmN1cnZlVG8sCiAgICAgICAgbnVtQXJnczogNiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHY6IHsKICAgICAgICBpZDogT1BTLmN1cnZlVG8yLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICB5OiB7CiAgICAgICAgaWQ6IE9QUy5jdXJ2ZVRvMywKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgaDogewogICAgICAgIGlkOiBPUFMuY2xvc2VQYXRoLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICByZTogewogICAgICAgIGlkOiBPUFMucmVjdGFuZ2xlLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBTOiB7CiAgICAgICAgaWQ6IE9QUy5zdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHM6IHsKICAgICAgICBpZDogT1BTLmNsb3NlU3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBmOiB7CiAgICAgICAgaWQ6IE9QUy5maWxsLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBGOiB7CiAgICAgICAgaWQ6IE9QUy5maWxsLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiZioiOiB7CiAgICAgICAgaWQ6IE9QUy5lb0ZpbGwsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEI6IHsKICAgICAgICBpZDogT1BTLmZpbGxTdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICJCKiI6IHsKICAgICAgICBpZDogT1BTLmVvRmlsbFN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgYjogewogICAgICAgIGlkOiBPUFMuY2xvc2VGaWxsU3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiYioiOiB7CiAgICAgICAgaWQ6IE9QUy5jbG9zZUVPRmlsbFN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgbjogewogICAgICAgIGlkOiBPUFMuZW5kUGF0aCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVzogewogICAgICAgIGlkOiBPUFMuY2xpcCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgIlcqIjogewogICAgICAgIGlkOiBPUFMuZW9DbGlwLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCVDogewogICAgICAgIGlkOiBPUFMuYmVnaW5UZXh0LAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBFVDogewogICAgICAgIGlkOiBPUFMuZW5kVGV4dCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVGM6IHsKICAgICAgICBpZDogT1BTLnNldENoYXJTcGFjaW5nLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUdzogewogICAgICAgIGlkOiBPUFMuc2V0V29yZFNwYWNpbmcsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFR6OiB7CiAgICAgICAgaWQ6IE9QUy5zZXRIU2NhbGUsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRMOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRMZWFkaW5nLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUZjogewogICAgICAgIGlkOiBPUFMuc2V0Rm9udCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVHI6IHsKICAgICAgICBpZDogT1BTLnNldFRleHRSZW5kZXJpbmdNb2RlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUczogewogICAgICAgIGlkOiBPUFMuc2V0VGV4dFJpc2UsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRkOiB7CiAgICAgICAgaWQ6IE9QUy5tb3ZlVGV4dCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVEQ6IHsKICAgICAgICBpZDogT1BTLnNldExlYWRpbmdNb3ZlVGV4dCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVG06IHsKICAgICAgICBpZDogT1BTLnNldFRleHRNYXRyaXgsCiAgICAgICAgbnVtQXJnczogNiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICJUKiI6IHsKICAgICAgICBpZDogT1BTLm5leHRMaW5lLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUajogewogICAgICAgIGlkOiBPUFMuc2hvd1RleHQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRKOiB7CiAgICAgICAgaWQ6IE9QUy5zaG93U3BhY2VkVGV4dCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgIiciOiB7CiAgICAgICAgaWQ6IE9QUy5uZXh0TGluZVNob3dUZXh0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAnIic6IHsKICAgICAgICBpZDogT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0LAogICAgICAgIG51bUFyZ3M6IDMsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBkMDogewogICAgICAgIGlkOiBPUFMuc2V0Q2hhcldpZHRoLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBkMTogewogICAgICAgIGlkOiBPUFMuc2V0Q2hhcldpZHRoQW5kQm91bmRzLAogICAgICAgIG51bUFyZ3M6IDYsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBDUzogewogICAgICAgIGlkOiBPUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgY3M6IHsKICAgICAgICBpZDogT1BTLnNldEZpbGxDb2xvclNwYWNlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBTQzogewogICAgICAgIGlkOiBPUFMuc2V0U3Ryb2tlQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IHRydWUKICAgICAgfSwKICAgICAgU0NOOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRTdHJva2VDb2xvck4sCiAgICAgICAgbnVtQXJnczogMzMsCiAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgIH0sCiAgICAgIHNjOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGaWxsQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IHRydWUKICAgICAgfSwKICAgICAgc2NuOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGaWxsQ29sb3JOLAogICAgICAgIG51bUFyZ3M6IDMzLAogICAgICAgIHZhcmlhYmxlQXJnczogdHJ1ZQogICAgICB9LAogICAgICBHOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRTdHJva2VHcmF5LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBnOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGaWxsR3JheSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgUkc6IHsKICAgICAgICBpZDogT1BTLnNldFN0cm9rZVJHQkNvbG9yLAogICAgICAgIG51bUFyZ3M6IDMsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICByZzogewogICAgICAgIGlkOiBPUFMuc2V0RmlsbFJHQkNvbG9yLAogICAgICAgIG51bUFyZ3M6IDMsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBLOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRTdHJva2VDTVlLQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGs6IHsKICAgICAgICBpZDogT1BTLnNldEZpbGxDTVlLQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHNoOiB7CiAgICAgICAgaWQ6IE9QUy5zaGFkaW5nRmlsbCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQkk6IHsKICAgICAgICBpZDogT1BTLmJlZ2luSW5saW5lSW1hZ2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIElEOiB7CiAgICAgICAgaWQ6IE9QUy5iZWdpbkltYWdlRGF0YSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRUk6IHsKICAgICAgICBpZDogT1BTLmVuZElubGluZUltYWdlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBEbzogewogICAgICAgIGlkOiBPUFMucGFpbnRYT2JqZWN0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBNUDogewogICAgICAgIGlkOiBPUFMubWFya1BvaW50LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBEUDogewogICAgICAgIGlkOiBPUFMubWFya1BvaW50UHJvcHMsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJNQzogewogICAgICAgIGlkOiBPUFMuYmVnaW5NYXJrZWRDb250ZW50LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCREM6IHsKICAgICAgICBpZDogT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBFTUM6IHsKICAgICAgICBpZDogT1BTLmVuZE1hcmtlZENvbnRlbnQsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJYOiB7CiAgICAgICAgaWQ6IE9QUy5iZWdpbkNvbXBhdCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRVg6IHsKICAgICAgICBpZDogT1BTLmVuZENvbXBhdCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQk06IG51bGwsCiAgICAgIEJEOiBudWxsLAogICAgICB0cnVlOiBudWxsLAogICAgICBmYTogbnVsbCwKICAgICAgZmFsOiBudWxsLAogICAgICBmYWxzOiBudWxsLAogICAgICBmYWxzZTogbnVsbCwKICAgICAgbnU6IG51bGwsCiAgICAgIG51bDogbnVsbCwKICAgICAgbnVsbDogbnVsbAogICAgfSkpOwogIH0KICBzdGF0aWMgTUFYX0lOVkFMSURfUEFUSF9PUFMgPSAxMDsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHhyZWYsIHN0YXRlTWFuYWdlciA9IG5ldyBTdGF0ZU1hbmFnZXIoKSkgewogICAgdGhpcy5wYXJzZXIgPSBuZXcgUGFyc2VyKHsKICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0sIEV2YWx1YXRvclByZXByb2Nlc3Nvci5vcE1hcCksCiAgICAgIHhyZWYKICAgIH0pOwogICAgdGhpcy5zdGF0ZU1hbmFnZXIgPSBzdGF0ZU1hbmFnZXI7CiAgICB0aGlzLm5vblByb2Nlc3NlZEFyZ3MgPSBbXTsKICAgIHRoaXMuX2lzUGF0aE9wID0gZmFsc2U7CiAgICB0aGlzLl9udW1JbnZhbGlkUGF0aE9QUyA9IDA7CiAgfQogIGdldCBzYXZlZFN0YXRlc0RlcHRoKCkgewogICAgcmV0dXJuIHRoaXMuc3RhdGVNYW5hZ2VyLnN0YXRlU3RhY2subGVuZ3RoOwogIH0KICByZWFkKG9wZXJhdGlvbikgewogICAgbGV0IGFyZ3MgPSBvcGVyYXRpb24uYXJnczsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMucGFyc2VyLmdldE9iaigpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgQ21kKSB7CiAgICAgICAgY29uc3QgY21kID0gb2JqLmNtZDsKICAgICAgICBjb25zdCBvcFNwZWMgPSBFdmFsdWF0b3JQcmVwcm9jZXNzb3Iub3BNYXBbY21kXTsKICAgICAgICBpZiAoIW9wU3BlYykgewogICAgICAgICAgd2FybihgVW5rbm93biBjb21tYW5kICIke2NtZH0iLmApOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZuID0gb3BTcGVjLmlkOwogICAgICAgIGNvbnN0IG51bUFyZ3MgPSBvcFNwZWMubnVtQXJnczsKICAgICAgICBsZXQgYXJnc0xlbmd0aCA9IGFyZ3MgIT09IG51bGwgPyBhcmdzLmxlbmd0aCA6IDA7CiAgICAgICAgaWYgKCF0aGlzLl9pc1BhdGhPcCkgewogICAgICAgICAgdGhpcy5fbnVtSW52YWxpZFBhdGhPUFMgPSAwOwogICAgICAgIH0KICAgICAgICB0aGlzLl9pc1BhdGhPcCA9IGZuID49IE9QUy5tb3ZlVG8gJiYgZm4gPD0gT1BTLmVuZFBhdGg7CiAgICAgICAgaWYgKCFvcFNwZWMudmFyaWFibGVBcmdzKSB7CiAgICAgICAgICBpZiAoYXJnc0xlbmd0aCAhPT0gbnVtQXJncykgewogICAgICAgICAgICBjb25zdCBub25Qcm9jZXNzZWRBcmdzID0gdGhpcy5ub25Qcm9jZXNzZWRBcmdzOwogICAgICAgICAgICB3aGlsZSAoYXJnc0xlbmd0aCA+IG51bUFyZ3MpIHsKICAgICAgICAgICAgICBub25Qcm9jZXNzZWRBcmdzLnB1c2goYXJncy5zaGlmdCgpKTsKICAgICAgICAgICAgICBhcmdzTGVuZ3RoLS07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUgKGFyZ3NMZW5ndGggPCBudW1BcmdzICYmIG5vblByb2Nlc3NlZEFyZ3MubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgaWYgKGFyZ3MgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGFyZ3MgPSBbXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXJncy51bnNoaWZ0KG5vblByb2Nlc3NlZEFyZ3MucG9wKCkpOwogICAgICAgICAgICAgIGFyZ3NMZW5ndGgrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGFyZ3NMZW5ndGggPCBudW1BcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcnRpYWxNc2cgPSBgY29tbWFuZCAke2NtZH06IGV4cGVjdGVkICR7bnVtQXJnc30gYXJncywgYCArIGBidXQgcmVjZWl2ZWQgJHthcmdzTGVuZ3RofSBhcmdzLmA7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc1BhdGhPcCAmJiArK3RoaXMuX251bUludmFsaWRQYXRoT1BTID4gRXZhbHVhdG9yUHJlcHJvY2Vzc29yLk1BWF9JTlZBTElEX1BBVEhfT1BTKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkICR7cGFydGlhbE1zZ31gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3YXJuKGBTa2lwcGluZyAke3BhcnRpYWxNc2d9YCk7CiAgICAgICAgICAgIGlmIChhcmdzICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgYXJncy5sZW5ndGggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYXJnc0xlbmd0aCA+IG51bUFyZ3MpIHsKICAgICAgICAgIGluZm8oYENvbW1hbmQgJHtjbWR9OiBleHBlY3RlZCBbMCwgJHtudW1BcmdzfV0gYXJncywgYCArIGBidXQgcmVjZWl2ZWQgJHthcmdzTGVuZ3RofSBhcmdzLmApOwogICAgICAgIH0KICAgICAgICB0aGlzLnByZXByb2Nlc3NDb21tYW5kKGZuLCBhcmdzKTsKICAgICAgICBvcGVyYXRpb24uZm4gPSBmbjsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IGFyZ3M7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG9iaiA9PT0gRU9GKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChvYmogIT09IG51bGwpIHsKICAgICAgICBpZiAoYXJncyA9PT0gbnVsbCkgewogICAgICAgICAgYXJncyA9IFtdOwogICAgICAgIH0KICAgICAgICBhcmdzLnB1c2gob2JqKTsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAzMykgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJUb28gbWFueSBhcmd1bWVudHMiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgcHJlcHJvY2Vzc0NvbW1hbmQoZm4sIGFyZ3MpIHsKICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgIGNhc2UgT1BTLnNhdmU6CiAgICAgICAgdGhpcy5zdGF0ZU1hbmFnZXIuc2F2ZSgpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIE9QUy5yZXN0b3JlOgogICAgICAgIHRoaXMuc3RhdGVNYW5hZ2VyLnJlc3RvcmUoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBPUFMudHJhbnNmb3JtOgogICAgICAgIHRoaXMuc3RhdGVNYW5hZ2VyLnRyYW5zZm9ybShhcmdzKTsKICAgICAgICBicmVhazsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2RlZmF1bHRfYXBwZWFyYW5jZS5qcwoKCgoKCgoKCmNsYXNzIERlZmF1bHRBcHBlYXJhbmNlRXZhbHVhdG9yIGV4dGVuZHMgRXZhbHVhdG9yUHJlcHJvY2Vzc29yIHsKICBjb25zdHJ1Y3RvcihzdHIpIHsKICAgIHN1cGVyKG5ldyBTdHJpbmdTdHJlYW0oc3RyKSk7CiAgfQogIHBhcnNlKCkgewogICAgY29uc3Qgb3BlcmF0aW9uID0gewogICAgICBmbjogMCwKICAgICAgYXJnczogW10KICAgIH07CiAgICBjb25zdCByZXN1bHQgPSB7CiAgICAgIGZvbnRTaXplOiAwLAogICAgICBmb250TmFtZTogIiIsCiAgICAgIGZvbnRDb2xvcjogbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpCiAgICB9OwogICAgdHJ5IHsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBvcGVyYXRpb24uYXJncy5sZW5ndGggPSAwOwogICAgICAgIGlmICghdGhpcy5yZWFkKG9wZXJhdGlvbikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zYXZlZFN0YXRlc0RlcHRoICE9PSAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgewogICAgICAgICAgZm4sCiAgICAgICAgICBhcmdzCiAgICAgICAgfSA9IG9wZXJhdGlvbjsKICAgICAgICBzd2l0Y2ggKGZuIHwgMCkgewogICAgICAgICAgY2FzZSBPUFMuc2V0Rm9udDoKICAgICAgICAgICAgY29uc3QgW2ZvbnROYW1lLCBmb250U2l6ZV0gPSBhcmdzOwogICAgICAgICAgICBpZiAoZm9udE5hbWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgcmVzdWx0LmZvbnROYW1lID0gZm9udE5hbWUubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIGZvbnRTaXplID09PSAibnVtYmVyIiAmJiBmb250U2l6ZSA+IDApIHsKICAgICAgICAgICAgICByZXN1bHQuZm9udFNpemUgPSBmb250U2l6ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxSR0JDb2xvcjoKICAgICAgICAgICAgQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JJdGVtKGFyZ3MsIDAsIHJlc3VsdC5mb250Q29sb3IsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxHcmF5OgogICAgICAgICAgICBDb2xvclNwYWNlVXRpbHMuZ3JheS5nZXRSZ2JJdGVtKGFyZ3MsIDAsIHJlc3VsdC5mb250Q29sb3IsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxDTVlLQ29sb3I6CiAgICAgICAgICAgIENvbG9yU3BhY2VVdGlscy5jbXlrLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIHdhcm4oYHBhcnNlRGVmYXVsdEFwcGVhcmFuY2UgLSBpZ25vcmluZyBlcnJvcnM6ICIke3JlYXNvbn0iLmApOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0KZnVuY3Rpb24gcGFyc2VEZWZhdWx0QXBwZWFyYW5jZShzdHIpIHsKICByZXR1cm4gbmV3IERlZmF1bHRBcHBlYXJhbmNlRXZhbHVhdG9yKHN0cikucGFyc2UoKTsKfQpjbGFzcyBBcHBlYXJhbmNlU3RyZWFtRXZhbHVhdG9yIGV4dGVuZHMgRXZhbHVhdG9yUHJlcHJvY2Vzc29yIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGV2YWx1YXRvck9wdGlvbnMsIHhyZWYsIGdsb2JhbENvbG9yU3BhY2VDYWNoZSkgewogICAgc3VwZXIoc3RyZWFtKTsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5ldmFsdWF0b3JPcHRpb25zID0gZXZhbHVhdG9yT3B0aW9uczsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSA9IGdsb2JhbENvbG9yU3BhY2VDYWNoZTsKICAgIHRoaXMucmVzb3VyY2VzID0gc3RyZWFtLmRpY3Q/LmdldCgiUmVzb3VyY2VzIik7CiAgfQogIHBhcnNlKCkgewogICAgY29uc3Qgb3BlcmF0aW9uID0gewogICAgICBmbjogMCwKICAgICAgYXJnczogW10KICAgIH07CiAgICBsZXQgcmVzdWx0ID0gewogICAgICBzY2FsZUZhY3RvcjogMSwKICAgICAgZm9udFNpemU6IDAsCiAgICAgIGZvbnROYW1lOiAiIiwKICAgICAgZm9udENvbG9yOiBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyksCiAgICAgIGZpbGxDb2xvclNwYWNlOiBDb2xvclNwYWNlVXRpbHMuZ3JheQogICAgfTsKICAgIGxldCBicmVha0xvb3AgPSBmYWxzZTsKICAgIGNvbnN0IHN0YWNrID0gW107CiAgICB0cnkgewogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIG9wZXJhdGlvbi5hcmdzLmxlbmd0aCA9IDA7CiAgICAgICAgaWYgKGJyZWFrTG9vcCB8fCAhdGhpcy5yZWFkKG9wZXJhdGlvbikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb25zdCB7CiAgICAgICAgICBmbiwKICAgICAgICAgIGFyZ3MKICAgICAgICB9ID0gb3BlcmF0aW9uOwogICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICBjYXNlIE9QUy5zYXZlOgogICAgICAgICAgICBzdGFjay5wdXNoKHsKICAgICAgICAgICAgICBzY2FsZUZhY3RvcjogcmVzdWx0LnNjYWxlRmFjdG9yLAogICAgICAgICAgICAgIGZvbnRTaXplOiByZXN1bHQuZm9udFNpemUsCiAgICAgICAgICAgICAgZm9udE5hbWU6IHJlc3VsdC5mb250TmFtZSwKICAgICAgICAgICAgICBmb250Q29sb3I6IHJlc3VsdC5mb250Q29sb3Iuc2xpY2UoKSwKICAgICAgICAgICAgICBmaWxsQ29sb3JTcGFjZTogcmVzdWx0LmZpbGxDb2xvclNwYWNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnJlc3RvcmU6CiAgICAgICAgICAgIHJlc3VsdCA9IHN0YWNrLnBvcCgpIHx8IHJlc3VsdDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRUZXh0TWF0cml4OgogICAgICAgICAgICByZXN1bHQuc2NhbGVGYWN0b3IgKj0gTWF0aC5oeXBvdChhcmdzWzBdLCBhcmdzWzFdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGb250OgogICAgICAgICAgICBjb25zdCBbZm9udE5hbWUsIGZvbnRTaXplXSA9IGFyZ3M7CiAgICAgICAgICAgIGlmIChmb250TmFtZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICByZXN1bHQuZm9udE5hbWUgPSBmb250TmFtZS5uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgZm9udFNpemUgPT09ICJudW1iZXIiICYmIGZvbnRTaXplID4gMCkgewogICAgICAgICAgICAgIHJlc3VsdC5mb250U2l6ZSA9IGZvbnRTaXplICogcmVzdWx0LnNjYWxlRmFjdG9yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yU3BhY2U6CiAgICAgICAgICAgIHJlc3VsdC5maWxsQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5wYXJzZSh7CiAgICAgICAgICAgICAgY3M6IGFyZ3NbMF0sCiAgICAgICAgICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICAgICAgICAgIHJlc291cmNlczogdGhpcy5yZXNvdXJjZXMsCiAgICAgICAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5OiB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgICAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5fbG9jYWxDb2xvclNwYWNlQ2FjaGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yOgogICAgICAgICAgICBjb25zdCBjcyA9IHJlc3VsdC5maWxsQ29sb3JTcGFjZTsKICAgICAgICAgICAgY3MuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsUkdCQ29sb3I6CiAgICAgICAgICAgIENvbG9yU3BhY2VVdGlscy5yZ2IuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsR3JheToKICAgICAgICAgICAgQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ01ZS0NvbG9yOgogICAgICAgICAgICBDb2xvclNwYWNlVXRpbHMuY215ay5nZXRSZ2JJdGVtKGFyZ3MsIDAsIHJlc3VsdC5mb250Q29sb3IsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNob3dUZXh0OgogICAgICAgICAgY2FzZSBPUFMuc2hvd1NwYWNlZFRleHQ6CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZVNob3dUZXh0OgogICAgICAgICAgY2FzZSBPUFMubmV4dExpbmVTZXRTcGFjaW5nU2hvd1RleHQ6CiAgICAgICAgICAgIGJyZWFrTG9vcCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIHdhcm4oYHBhcnNlQXBwZWFyYW5jZVN0cmVhbSAtIGlnbm9yaW5nIGVycm9yczogIiR7cmVhc29ufSIuYCk7CiAgICB9CiAgICB0aGlzLnN0cmVhbS5yZXNldCgpOwogICAgZGVsZXRlIHJlc3VsdC5zY2FsZUZhY3RvcjsKICAgIGRlbGV0ZSByZXN1bHQuZmlsbENvbG9yU3BhY2U7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBnZXQgX2xvY2FsQ29sb3JTcGFjZUNhY2hlKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX2xvY2FsQ29sb3JTcGFjZUNhY2hlIiwgbmV3IExvY2FsQ29sb3JTcGFjZUNhY2hlKCkpOwogIH0KICBnZXQgX3BkZkZ1bmN0aW9uRmFjdG9yeSgpIHsKICAgIGNvbnN0IHBkZkZ1bmN0aW9uRmFjdG9yeSA9IG5ldyBQREZGdW5jdGlvbkZhY3RvcnkoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGlzRXZhbFN1cHBvcnRlZDogdGhpcy5ldmFsdWF0b3JPcHRpb25zLmlzRXZhbFN1cHBvcnRlZAogICAgfSk7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfcGRmRnVuY3Rpb25GYWN0b3J5IiwgcGRmRnVuY3Rpb25GYWN0b3J5KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VBcHBlYXJhbmNlU3RyZWFtKHN0cmVhbSwgZXZhbHVhdG9yT3B0aW9ucywgeHJlZiwgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlKSB7CiAgcmV0dXJuIG5ldyBBcHBlYXJhbmNlU3RyZWFtRXZhbHVhdG9yKHN0cmVhbSwgZXZhbHVhdG9yT3B0aW9ucywgeHJlZiwgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlKS5wYXJzZSgpOwp9CmZ1bmN0aW9uIGdldFBkZkNvbG9yKGNvbG9yLCBpc0ZpbGwpIHsKICBpZiAoY29sb3JbMF0gPT09IGNvbG9yWzFdICYmIGNvbG9yWzFdID09PSBjb2xvclsyXSkgewogICAgY29uc3QgZ3JheSA9IGNvbG9yWzBdIC8gMjU1OwogICAgcmV0dXJuIGAke251bWJlclRvU3RyaW5nKGdyYXkpfSAke2lzRmlsbCA/ICJnIiA6ICJHIn1gOwogIH0KICByZXR1cm4gQXJyYXkuZnJvbShjb2xvciwgYyA9PiBudW1iZXJUb1N0cmluZyhjIC8gMjU1KSkuam9pbigiICIpICsgYCAke2lzRmlsbCA/ICJyZyIgOiAiUkcifWA7Cn0KZnVuY3Rpb24gY3JlYXRlRGVmYXVsdEFwcGVhcmFuY2UoewogIGZvbnRTaXplLAogIGZvbnROYW1lLAogIGZvbnRDb2xvcgp9KSB7CiAgcmV0dXJuIGAvJHtlc2NhcGVQREZOYW1lKGZvbnROYW1lKX0gJHtmb250U2l6ZX0gVGYgJHtnZXRQZGZDb2xvcihmb250Q29sb3IsIHRydWUpfWA7Cn0KY2xhc3MgRmFrZVVuaWNvZGVGb250IHsKICBjb25zdHJ1Y3Rvcih4cmVmLCBmb250RmFtaWx5KSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy53aWR0aHMgPSBudWxsOwogICAgdGhpcy5maXJzdENoYXIgPSBJbmZpbml0eTsKICAgIHRoaXMubGFzdENoYXIgPSAtSW5maW5pdHk7CiAgICB0aGlzLmZvbnRGYW1pbHkgPSBmb250RmFtaWx5OwogICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcygxLCAxKTsKICAgIHRoaXMuY3R4TWVhc3VyZSA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIsIHsKICAgICAgd2lsbFJlYWRGcmVxdWVudGx5OiB0cnVlCiAgICB9KTsKICAgIGlmICghRmFrZVVuaWNvZGVGb250Ll9mb250TmFtZUlkKSB7CiAgICAgIEZha2VVbmljb2RlRm9udC5fZm9udE5hbWVJZCA9IDE7CiAgICB9CiAgICB0aGlzLmZvbnROYW1lID0gTmFtZS5nZXQoYEludmFsaWRQREZqc0ZvbnRfJHtmb250RmFtaWx5fV8ke0Zha2VVbmljb2RlRm9udC5fZm9udE5hbWVJZCsrfWApOwogIH0KICBnZXQgZm9udERlc2NyaXB0b3JSZWYoKSB7CiAgICBpZiAoIUZha2VVbmljb2RlRm9udC5fZm9udERlc2NyaXB0b3JSZWYpIHsKICAgICAgY29uc3QgZm9udERlc2NyaXB0b3IgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgICBmb250RGVzY3JpcHRvci5zZXRJZk5hbWUoIlR5cGUiLCAiRm9udERlc2NyaXB0b3IiKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJGb250TmFtZSIsIHRoaXMuZm9udE5hbWUpOwogICAgICBmb250RGVzY3JpcHRvci5zZXQoIkZvbnRGYW1pbHkiLCAiTXlyaWFkUHJvIFJlZ3VsYXIiKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJGb250QkJveCIsIFswLCAwLCAwLCAwXSk7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldElmTmFtZSgiRm9udFN0cmV0Y2giLCAiTm9ybWFsIik7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldCgiRm9udFdlaWdodCIsIDQwMCk7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldCgiSXRhbGljQW5nbGUiLCAwKTsKICAgICAgRmFrZVVuaWNvZGVGb250Ll9mb250RGVzY3JpcHRvclJlZiA9IHRoaXMueHJlZi5nZXROZXdQZXJzaXN0ZW50UmVmKGZvbnREZXNjcmlwdG9yKTsKICAgIH0KICAgIHJldHVybiBGYWtlVW5pY29kZUZvbnQuX2ZvbnREZXNjcmlwdG9yUmVmOwogIH0KICBnZXQgZGVzY2VuZGFudEZvbnRSZWYoKSB7CiAgICBjb25zdCBkZXNjZW5kYW50Rm9udCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIkJhc2VGb250IiwgdGhpcy5mb250TmFtZSk7CiAgICBkZXNjZW5kYW50Rm9udC5zZXRJZk5hbWUoIlR5cGUiLCAiRm9udCIpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkNJREZvbnRUeXBlMCIpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0SWZOYW1lKCJDSURUb0dJRE1hcCIsICJJZGVudGl0eSIpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJGaXJzdENoYXIiLCB0aGlzLmZpcnN0Q2hhcik7CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIkxhc3RDaGFyIiwgdGhpcy5sYXN0Q2hhcik7CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIkZvbnREZXNjcmlwdG9yIiwgdGhpcy5mb250RGVzY3JpcHRvclJlZik7CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIkRXIiwgMTAwMCk7CiAgICBjb25zdCB3aWR0aHMgPSBbXTsKICAgIGNvbnN0IGNoYXJzID0gWy4uLnRoaXMud2lkdGhzLmVudHJpZXMoKV0uc29ydCgpOwogICAgbGV0IGN1cnJlbnRDaGFyID0gbnVsbDsKICAgIGxldCBjdXJyZW50V2lkdGhzID0gbnVsbDsKICAgIGZvciAoY29uc3QgW2NoYXIsIHdpZHRoXSBvZiBjaGFycykgewogICAgICBpZiAoIWN1cnJlbnRDaGFyKSB7CiAgICAgICAgY3VycmVudENoYXIgPSBjaGFyOwogICAgICAgIGN1cnJlbnRXaWR0aHMgPSBbd2lkdGhdOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjaGFyID09PSBjdXJyZW50Q2hhciArIGN1cnJlbnRXaWR0aHMubGVuZ3RoKSB7CiAgICAgICAgY3VycmVudFdpZHRocy5wdXNoKHdpZHRoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aWR0aHMucHVzaChjdXJyZW50Q2hhciwgY3VycmVudFdpZHRocyk7CiAgICAgICAgY3VycmVudENoYXIgPSBjaGFyOwogICAgICAgIGN1cnJlbnRXaWR0aHMgPSBbd2lkdGhdOwogICAgICB9CiAgICB9CiAgICBpZiAoY3VycmVudENoYXIpIHsKICAgICAgd2lkdGhzLnB1c2goY3VycmVudENoYXIsIGN1cnJlbnRXaWR0aHMpOwogICAgfQogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJXIiwgd2lkdGhzKTsKICAgIGNvbnN0IGNpZFN5c3RlbUluZm8gPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgY2lkU3lzdGVtSW5mby5zZXQoIk9yZGVyaW5nIiwgIklkZW50aXR5Iik7CiAgICBjaWRTeXN0ZW1JbmZvLnNldCgiUmVnaXN0cnkiLCAiQWRvYmUiKTsKICAgIGNpZFN5c3RlbUluZm8uc2V0KCJTdXBwbGVtZW50IiwgMCk7CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIkNJRFN5c3RlbUluZm8iLCBjaWRTeXN0ZW1JbmZvKTsKICAgIHJldHVybiB0aGlzLnhyZWYuZ2V0TmV3UGVyc2lzdGVudFJlZihkZXNjZW5kYW50Rm9udCk7CiAgfQogIGdldCBiYXNlRm9udFJlZigpIHsKICAgIGNvbnN0IGJhc2VGb250ID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgIGJhc2VGb250LnNldCgiQmFzZUZvbnQiLCB0aGlzLmZvbnROYW1lKTsKICAgIGJhc2VGb250LnNldElmTmFtZSgiVHlwZSIsICJGb250Iik7CiAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiVHlwZTAiKTsKICAgIGJhc2VGb250LnNldElmTmFtZSgiRW5jb2RpbmciLCAiSWRlbnRpdHktSCIpOwogICAgYmFzZUZvbnQuc2V0KCJEZXNjZW5kYW50Rm9udHMiLCBbdGhpcy5kZXNjZW5kYW50Rm9udFJlZl0pOwogICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJUb1VuaWNvZGUiLCAiSWRlbnRpdHktSCIpOwogICAgcmV0dXJuIHRoaXMueHJlZi5nZXROZXdQZXJzaXN0ZW50UmVmKGJhc2VGb250KTsKICB9CiAgZ2V0IHJlc291cmNlcygpIHsKICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBjb25zdCBmb250ID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgIGZvbnQuc2V0KHRoaXMuZm9udE5hbWUubmFtZSwgdGhpcy5iYXNlRm9udFJlZik7CiAgICByZXNvdXJjZXMuc2V0KCJGb250IiwgZm9udCk7CiAgICByZXR1cm4gcmVzb3VyY2VzOwogIH0KICBfY3JlYXRlQ29udGV4dCgpIHsKICAgIHRoaXMud2lkdGhzID0gbmV3IE1hcCgpOwogICAgdGhpcy5jdHhNZWFzdXJlLmZvbnQgPSBgMTAwMHB4ICR7dGhpcy5mb250RmFtaWx5fWA7CiAgICByZXR1cm4gdGhpcy5jdHhNZWFzdXJlOwogIH0KICBjcmVhdGVGb250UmVzb3VyY2VzKHRleHQpIHsKICAgIGNvbnN0IGN0eCA9IHRoaXMuX2NyZWF0ZUNvbnRleHQoKTsKICAgIGZvciAoY29uc3QgbGluZSBvZiB0ZXh0LnNwbGl0KC9cclxuP3xcbi8pKSB7CiAgICAgIGZvciAoY29uc3QgY2hhciBvZiBsaW5lLnNwbGl0KCIiKSkgewogICAgICAgIGNvbnN0IGNvZGUgPSBjaGFyLmNoYXJDb2RlQXQoMCk7CiAgICAgICAgaWYgKHRoaXMud2lkdGhzLmhhcyhjb2RlKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1ldHJpY3MgPSBjdHgubWVhc3VyZVRleHQoY2hhcik7CiAgICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLmNlaWwobWV0cmljcy53aWR0aCk7CiAgICAgICAgdGhpcy53aWR0aHMuc2V0KGNvZGUsIHdpZHRoKTsKICAgICAgICB0aGlzLmZpcnN0Q2hhciA9IE1hdGgubWluKGNvZGUsIHRoaXMuZmlyc3RDaGFyKTsKICAgICAgICB0aGlzLmxhc3RDaGFyID0gTWF0aC5tYXgoY29kZSwgdGhpcy5sYXN0Q2hhcik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0aGlzLnJlc291cmNlczsKICB9CiAgc3RhdGljIGdldEZpcnN0UG9zaXRpb25JbmZvKHJlY3QsIHJvdGF0aW9uLCBmb250U2l6ZSkgewogICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IHJlY3Q7CiAgICBsZXQgdyA9IHgyIC0geDE7CiAgICBsZXQgaCA9IHkyIC0geTE7CiAgICBpZiAocm90YXRpb24gJSAxODAgIT09IDApIHsKICAgICAgW3csIGhdID0gW2gsIHddOwogICAgfQogICAgY29uc3QgbGluZUhlaWdodCA9IExJTkVfRkFDVE9SICogZm9udFNpemU7CiAgICBjb25zdCBsaW5lRGVzY2VudCA9IExJTkVfREVTQ0VOVF9GQUNUT1IgKiBmb250U2l6ZTsKICAgIHJldHVybiB7CiAgICAgIGNvb3JkczogWzAsIGggKyBsaW5lRGVzY2VudCAtIGxpbmVIZWlnaHRdLAogICAgICBiYm94OiBbMCwgMCwgdywgaF0sCiAgICAgIG1hdHJpeDogcm90YXRpb24gIT09IDAgPyBnZXRSb3RhdGlvbk1hdHJpeChyb3RhdGlvbiwgaCwgbGluZUhlaWdodCkgOiB1bmRlZmluZWQKICAgIH07CiAgfQogIGNyZWF0ZUFwcGVhcmFuY2UodGV4dCwgcmVjdCwgcm90YXRpb24sIGZvbnRTaXplLCBiZ0NvbG9yLCBzdHJva2VBbHBoYSkgewogICAgY29uc3QgY3R4ID0gdGhpcy5fY3JlYXRlQ29udGV4dCgpOwogICAgY29uc3QgbGluZXMgPSBbXTsKICAgIGxldCBtYXhXaWR0aCA9IC1JbmZpbml0eTsKICAgIGZvciAoY29uc3QgbGluZSBvZiB0ZXh0LnNwbGl0KC9cclxuP3xcbi8pKSB7CiAgICAgIGxpbmVzLnB1c2gobGluZSk7CiAgICAgIGNvbnN0IGxpbmVXaWR0aCA9IGN0eC5tZWFzdXJlVGV4dChsaW5lKS53aWR0aDsKICAgICAgbWF4V2lkdGggPSBNYXRoLm1heChtYXhXaWR0aCwgbGluZVdpZHRoKTsKICAgICAgZm9yIChjb25zdCBjb2RlIG9mIGNvZGVQb2ludEl0ZXIobGluZSkpIHsKICAgICAgICBjb25zdCBjaGFyID0gU3RyaW5nLmZyb21Db2RlUG9pbnQoY29kZSk7CiAgICAgICAgbGV0IHdpZHRoID0gdGhpcy53aWR0aHMuZ2V0KGNvZGUpOwogICAgICAgIGlmICh3aWR0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb25zdCBtZXRyaWNzID0gY3R4Lm1lYXN1cmVUZXh0KGNoYXIpOwogICAgICAgICAgd2lkdGggPSBNYXRoLmNlaWwobWV0cmljcy53aWR0aCk7CiAgICAgICAgICB0aGlzLndpZHRocy5zZXQoY29kZSwgd2lkdGgpOwogICAgICAgICAgdGhpcy5maXJzdENoYXIgPSBNYXRoLm1pbihjb2RlLCB0aGlzLmZpcnN0Q2hhcik7CiAgICAgICAgICB0aGlzLmxhc3RDaGFyID0gTWF0aC5tYXgoY29kZSwgdGhpcy5sYXN0Q2hhcik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBtYXhXaWR0aCAqPSBmb250U2l6ZSAvIDEwMDA7CiAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTJdID0gcmVjdDsKICAgIGxldCB3ID0geDIgLSB4MTsKICAgIGxldCBoID0geTIgLSB5MTsKICAgIGlmIChyb3RhdGlvbiAlIDE4MCAhPT0gMCkgewogICAgICBbdywgaF0gPSBbaCwgd107CiAgICB9CiAgICBsZXQgaHNjYWxlID0gMTsKICAgIGlmIChtYXhXaWR0aCA+IHcpIHsKICAgICAgaHNjYWxlID0gdyAvIG1heFdpZHRoOwogICAgfQogICAgbGV0IHZzY2FsZSA9IDE7CiAgICBjb25zdCBsaW5lSGVpZ2h0ID0gTElORV9GQUNUT1IgKiBmb250U2l6ZTsKICAgIGNvbnN0IGxpbmVEZXNjZW50ID0gTElORV9ERVNDRU5UX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgY29uc3QgbWF4SGVpZ2h0ID0gbGluZUhlaWdodCAqIGxpbmVzLmxlbmd0aDsKICAgIGlmIChtYXhIZWlnaHQgPiBoKSB7CiAgICAgIHZzY2FsZSA9IGggLyBtYXhIZWlnaHQ7CiAgICB9CiAgICBjb25zdCBmc2NhbGUgPSBNYXRoLm1pbihoc2NhbGUsIHZzY2FsZSk7CiAgICBjb25zdCBuZXdGb250U2l6ZSA9IGZvbnRTaXplICogZnNjYWxlOwogICAgY29uc3QgYnVmZmVyID0gWyJxIiwgYDAgMCAke251bWJlclRvU3RyaW5nKHcpfSAke251bWJlclRvU3RyaW5nKGgpfSByZSBXIG5gLCBgQlRgLCBgMSAwIDAgMSAwICR7bnVtYmVyVG9TdHJpbmcoaCArIGxpbmVEZXNjZW50KX0gVG0gMCBUYyAke2dldFBkZkNvbG9yKGJnQ29sb3IsIHRydWUpfWAsIGAvJHt0aGlzLmZvbnROYW1lLm5hbWV9ICR7bnVtYmVyVG9TdHJpbmcobmV3Rm9udFNpemUpfSBUZmBdOwogICAgY29uc3QgewogICAgICByZXNvdXJjZXMKICAgIH0gPSB0aGlzOwogICAgc3Ryb2tlQWxwaGEgPSB0eXBlb2Ygc3Ryb2tlQWxwaGEgPT09ICJudW1iZXIiICYmIHN0cm9rZUFscGhhID49IDAgJiYgc3Ryb2tlQWxwaGEgPD0gMSA/IHN0cm9rZUFscGhhIDogMTsKICAgIGlmIChzdHJva2VBbHBoYSAhPT0gMSkgewogICAgICBidWZmZXIucHVzaCgiL1IwIGdzIik7CiAgICAgIGNvbnN0IGV4dEdTdGF0ZSA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICAgIGNvbnN0IHIwID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgICAgcjAuc2V0KCJjYSIsIHN0cm9rZUFscGhhKTsKICAgICAgcjAuc2V0KCJDQSIsIHN0cm9rZUFscGhhKTsKICAgICAgcjAuc2V0SWZOYW1lKCJUeXBlIiwgIkV4dEdTdGF0ZSIpOwogICAgICBleHRHU3RhdGUuc2V0KCJSMCIsIHIwKTsKICAgICAgcmVzb3VyY2VzLnNldCgiRXh0R1N0YXRlIiwgZXh0R1N0YXRlKTsKICAgIH0KICAgIGNvbnN0IHZTaGlmdCA9IG51bWJlclRvU3RyaW5nKGxpbmVIZWlnaHQpOwogICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGAwIC0ke3ZTaGlmdH0gVGQgPCR7c3RyaW5nVG9VVEYxNkhleFN0cmluZyhsaW5lKX0+IFRqYCk7CiAgICB9CiAgICBidWZmZXIucHVzaCgiRVQiLCAiUSIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCBbMCwgMCwgdywgaF0pOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJMZW5ndGgiLCBhcHBlYXJhbmNlLmxlbmd0aCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBpZiAocm90YXRpb24pIHsKICAgICAgY29uc3QgbWF0cml4ID0gZ2V0Um90YXRpb25NYXRyaXgocm90YXRpb24sIHcsIGgpOwogICAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIk1hdHJpeCIsIG1hdHJpeCk7CiAgICB9CiAgICBjb25zdCBhcCA9IG5ldyBTdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQp9Cgo7Ly8gLi9zcmMvc2hhcmVkL3NjcmlwdGluZ191dGlscy5qcwpmdW5jdGlvbiBtYWtlQ29sb3JDb21wKG4pIHsKICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBuKSkgKiAyNTUpLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpOwp9CmZ1bmN0aW9uIHNjYWxlQW5kQ2xhbXAoeCkgewogIHJldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbigyNTUsIDI1NSAqIHgpKTsKfQpjbGFzcyBDb2xvckNvbnZlcnRlcnMgewogIHN0YXRpYyBDTVlLX0coW2MsIHksIG0sIGtdKSB7CiAgICByZXR1cm4gWyJHIiwgMSAtIE1hdGgubWluKDEsIDAuMyAqIGMgKyAwLjU5ICogbSArIDAuMTEgKiB5ICsgayldOwogIH0KICBzdGF0aWMgR19DTVlLKFtnXSkgewogICAgcmV0dXJuIFsiQ01ZSyIsIDAsIDAsIDAsIDEgLSBnXTsKICB9CiAgc3RhdGljIEdfUkdCKFtnXSkgewogICAgcmV0dXJuIFsiUkdCIiwgZywgZywgZ107CiAgfQogIHN0YXRpYyBHX3JnYihbZ10pIHsKICAgIGcgPSBzY2FsZUFuZENsYW1wKGcpOwogICAgcmV0dXJuIFtnLCBnLCBnXTsKICB9CiAgc3RhdGljIEdfSFRNTChbZ10pIHsKICAgIGNvbnN0IEcgPSBtYWtlQ29sb3JDb21wKGcpOwogICAgcmV0dXJuIGAjJHtHfSR7R30ke0d9YDsKICB9CiAgc3RhdGljIFJHQl9HKFtyLCBnLCBiXSkgewogICAgcmV0dXJuIFsiRyIsIDAuMyAqIHIgKyAwLjU5ICogZyArIDAuMTEgKiBiXTsKICB9CiAgc3RhdGljIFJHQl9yZ2IoY29sb3IpIHsKICAgIHJldHVybiBjb2xvci5tYXAoc2NhbGVBbmRDbGFtcCk7CiAgfQogIHN0YXRpYyBSR0JfSFRNTChjb2xvcikgewogICAgcmV0dXJuIGAjJHtjb2xvci5tYXAobWFrZUNvbG9yQ29tcCkuam9pbigiIil9YDsKICB9CiAgc3RhdGljIFRfSFRNTCgpIHsKICAgIHJldHVybiAiIzAwMDAwMDAwIjsKICB9CiAgc3RhdGljIFRfcmdiKCkgewogICAgcmV0dXJuIFtudWxsXTsKICB9CiAgc3RhdGljIENNWUtfUkdCKFtjLCB5LCBtLCBrXSkgewogICAgcmV0dXJuIFsiUkdCIiwgMSAtIE1hdGgubWluKDEsIGMgKyBrKSwgMSAtIE1hdGgubWluKDEsIG0gKyBrKSwgMSAtIE1hdGgubWluKDEsIHkgKyBrKV07CiAgfQogIHN0YXRpYyBDTVlLX3JnYihbYywgeSwgbSwga10pIHsKICAgIHJldHVybiBbc2NhbGVBbmRDbGFtcCgxIC0gTWF0aC5taW4oMSwgYyArIGspKSwgc2NhbGVBbmRDbGFtcCgxIC0gTWF0aC5taW4oMSwgbSArIGspKSwgc2NhbGVBbmRDbGFtcCgxIC0gTWF0aC5taW4oMSwgeSArIGspKV07CiAgfQogIHN0YXRpYyBDTVlLX0hUTUwoY29tcG9uZW50cykgewogICAgY29uc3QgcmdiID0gdGhpcy5DTVlLX1JHQihjb21wb25lbnRzKS5zbGljZSgxKTsKICAgIHJldHVybiB0aGlzLlJHQl9IVE1MKHJnYik7CiAgfQogIHN0YXRpYyBSR0JfQ01ZSyhbciwgZywgYl0pIHsKICAgIGNvbnN0IGMgPSAxIC0gcjsKICAgIGNvbnN0IG0gPSAxIC0gZzsKICAgIGNvbnN0IHkgPSAxIC0gYjsKICAgIGNvbnN0IGsgPSBNYXRoLm1pbihjLCBtLCB5KTsKICAgIHJldHVybiBbIkNNWUsiLCBjLCBtLCB5LCBrXTsKICB9Cn0KY29uc3QgRGF0ZUZvcm1hdHMgPSBbIm0vZCIsICJtL2QveXkiLCAibW0vZGQveXkiLCAibW0veXkiLCAiZC1tbW0iLCAiZC1tbW0teXkiLCAiZGQtbW1tLXl5IiwgInl5LW1tLWRkIiwgIm1tbS15eSIsICJtbW1tLXl5IiwgIm1tbSBkLCB5eXl5IiwgIm1tbW0gZCwgeXl5eSIsICJtL2QveXkgaDpNTSB0dCIsICJtL2QveXkgSEg6TU0iXTsKY29uc3QgVGltZUZvcm1hdHMgPSBbIkhIOk1NIiwgImg6TU0gdHQiLCAiSEg6TU06c3MiLCAiaDpNTTpzcyB0dCJdOwoKOy8vIC4vc3JjL2NvcmUvbmFtZV9udW1iZXJfdHJlZS5qcwoKCmNsYXNzIE5hbWVPck51bWJlclRyZWUgewogIGNvbnN0cnVjdG9yKHJvb3QsIHhyZWYsIHR5cGUpIHsKICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5fdHlwZSA9IHR5cGU7CiAgfQogIGdldEFsbCgpIHsKICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgIGlmICghdGhpcy5yb290KSB7CiAgICAgIHJldHVybiBtYXA7CiAgICB9CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmOwogICAgY29uc3QgcHJvY2Vzc2VkID0gbmV3IFJlZlNldCgpOwogICAgcHJvY2Vzc2VkLnB1dCh0aGlzLnJvb3QpOwogICAgY29uc3QgcXVldWUgPSBbdGhpcy5yb290XTsKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IG9iaiA9IHhyZWYuZmV0Y2hJZlJlZihxdWV1ZS5zaGlmdCgpKTsKICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAob2JqLmhhcygiS2lkcyIpKSB7CiAgICAgICAgY29uc3Qga2lkcyA9IG9iai5nZXQoIktpZHMiKTsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGtpZCBvZiBraWRzKSB7CiAgICAgICAgICBpZiAocHJvY2Vzc2VkLmhhcyhraWQpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgRHVwbGljYXRlIGVudHJ5IGluICIke3RoaXMuX3R5cGV9IiB0cmVlLmApOwogICAgICAgICAgfQogICAgICAgICAgcXVldWUucHVzaChraWQpOwogICAgICAgICAgcHJvY2Vzc2VkLnB1dChraWQpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBlbnRyaWVzID0gb2JqLmdldCh0aGlzLl90eXBlKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGVudHJpZXMpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZW50cmllcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgbWFwLnNldCh4cmVmLmZldGNoSWZSZWYoZW50cmllc1tpXSksIHhyZWYuZmV0Y2hJZlJlZihlbnRyaWVzW2kgKyAxXSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWFwOwogIH0KICBnZXRSYXcoa2V5KSB7CiAgICBpZiAoIXRoaXMucm9vdCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBsZXQga2lkc09yRW50cmllcyA9IHhyZWYuZmV0Y2hJZlJlZih0aGlzLnJvb3QpOwogICAgbGV0IGxvb3BDb3VudCA9IDA7CiAgICBjb25zdCBNQVhfTEVWRUxTID0gMTA7CiAgICB3aGlsZSAoa2lkc09yRW50cmllcy5oYXMoIktpZHMiKSkgewogICAgICBpZiAoKytsb29wQ291bnQgPiBNQVhfTEVWRUxTKSB7CiAgICAgICAgd2FybihgU2VhcmNoIGRlcHRoIGxpbWl0IHJlYWNoZWQgZm9yICIke3RoaXMuX3R5cGV9IiB0cmVlLmApOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGtpZHMgPSBraWRzT3JFbnRyaWVzLmdldCgiS2lkcyIpOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBsZXQgbCA9IDAsCiAgICAgICAgciA9IGtpZHMubGVuZ3RoIC0gMTsKICAgICAgd2hpbGUgKGwgPD0gcikgewogICAgICAgIGNvbnN0IG0gPSBsICsgciA+PiAxOwogICAgICAgIGNvbnN0IGtpZCA9IHhyZWYuZmV0Y2hJZlJlZihraWRzW21dKTsKICAgICAgICBjb25zdCBsaW1pdHMgPSBraWQuZ2V0KCJMaW1pdHMiKTsKICAgICAgICBpZiAoa2V5IDwgeHJlZi5mZXRjaElmUmVmKGxpbWl0c1swXSkpIHsKICAgICAgICAgIHIgPSBtIC0gMTsKICAgICAgICB9IGVsc2UgaWYgKGtleSA+IHhyZWYuZmV0Y2hJZlJlZihsaW1pdHNbMV0pKSB7CiAgICAgICAgICBsID0gbSArIDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGtpZHNPckVudHJpZXMgPSBraWQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGwgPiByKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGVudHJpZXMgPSBraWRzT3JFbnRyaWVzLmdldCh0aGlzLl90eXBlKTsKICAgIGlmIChBcnJheS5pc0FycmF5KGVudHJpZXMpKSB7CiAgICAgIGxldCBsID0gMCwKICAgICAgICByID0gZW50cmllcy5sZW5ndGggLSAyOwogICAgICB3aGlsZSAobCA8PSByKSB7CiAgICAgICAgY29uc3QgdG1wID0gbCArIHIgPj4gMSwKICAgICAgICAgIG0gPSB0bXAgKyAodG1wICYgMSk7CiAgICAgICAgY29uc3QgY3VycmVudEtleSA9IHhyZWYuZmV0Y2hJZlJlZihlbnRyaWVzW21dKTsKICAgICAgICBpZiAoa2V5IDwgY3VycmVudEtleSkgewogICAgICAgICAgciA9IG0gLSAyOwogICAgICAgIH0gZWxzZSBpZiAoa2V5ID4gY3VycmVudEtleSkgewogICAgICAgICAgbCA9IG0gKyAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZW50cmllc1ttICsgMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0KGtleSkgewogICAgcmV0dXJuIHRoaXMueHJlZi5mZXRjaElmUmVmKHRoaXMuZ2V0UmF3KGtleSkpOwogIH0KfQpjbGFzcyBOYW1lVHJlZSBleHRlbmRzIE5hbWVPck51bWJlclRyZWUgewogIGNvbnN0cnVjdG9yKHJvb3QsIHhyZWYpIHsKICAgIHN1cGVyKHJvb3QsIHhyZWYsICJOYW1lcyIpOwogIH0KfQpjbGFzcyBOdW1iZXJUcmVlIGV4dGVuZHMgTmFtZU9yTnVtYmVyVHJlZSB7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZikgewogICAgc3VwZXIocm9vdCwgeHJlZiwgIk51bXMiKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NsZWFudXBfaGVscGVyLmpzCgoKCgpmdW5jdGlvbiBjbGVhckdsb2JhbENhY2hlcygpIHsKICBjbGVhclBhdHRlcm5DYWNoZXMoKTsKICBjbGVhclByaW1pdGl2ZUNhY2hlcygpOwogIGNsZWFyVW5pY29kZUNhY2hlcygpOwogIEpweEltYWdlLmNsZWFudXAoKTsKfQoKOy8vIC4vc3JjL2NvcmUvZmlsZV9zcGVjLmpzCgoKCmZ1bmN0aW9uIHBpY2tQbGF0Zm9ybUl0ZW0oZGljdCkgewogIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChkaWN0LmhhcygiVUYiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJVRiIpOwogIH0gZWxzZSBpZiAoZGljdC5oYXMoIkYiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJGIik7CiAgfSBlbHNlIGlmIChkaWN0LmhhcygiVW5peCIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIlVuaXgiKTsKICB9IGVsc2UgaWYgKGRpY3QuaGFzKCJNYWMiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJNYWMiKTsKICB9IGVsc2UgaWYgKGRpY3QuaGFzKCJET1MiKSkgewogICAgcmV0dXJuIGRpY3QuZ2V0KCJET1MiKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gc3RyaXBQYXRoKHN0cikgewogIHJldHVybiBzdHIuc3Vic3RyaW5nKHN0ci5sYXN0SW5kZXhPZigiLyIpICsgMSk7Cn0KY2xhc3MgRmlsZVNwZWMgewogICNjb250ZW50QXZhaWxhYmxlID0gZmFsc2U7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZiwgc2tpcENvbnRlbnQgPSBmYWxzZSkgewogICAgaWYgKCEocm9vdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLnJvb3QgPSByb290OwogICAgaWYgKHJvb3QuaGFzKCJGUyIpKSB7CiAgICAgIHRoaXMuZnMgPSByb290LmdldCgiRlMiKTsKICAgIH0KICAgIGlmIChyb290LmhhcygiUkYiKSkgewogICAgICB3YXJuKCJSZWxhdGVkIGZpbGUgc3BlY2lmaWNhdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIH0KICAgIGlmICghc2tpcENvbnRlbnQpIHsKICAgICAgaWYgKHJvb3QuaGFzKCJFRiIpKSB7CiAgICAgICAgdGhpcy4jY29udGVudEF2YWlsYWJsZSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiTm9uLWVtYmVkZGVkIGZpbGUgc3BlY2lmaWNhdGlvbnMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgfQogICAgfQogIH0KICBnZXQgZmlsZW5hbWUoKSB7CiAgICBsZXQgZmlsZW5hbWUgPSAiIjsKICAgIGNvbnN0IGl0ZW0gPSBwaWNrUGxhdGZvcm1JdGVtKHRoaXMucm9vdCk7CiAgICBpZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpIHsKICAgICAgZmlsZW5hbWUgPSBzdHJpbmdUb1BERlN0cmluZyhpdGVtLCB0cnVlKS5yZXBsYWNlQWxsKCJcXFxcIiwgIlxcIikucmVwbGFjZUFsbCgiXFwvIiwgIi8iKS5yZXBsYWNlQWxsKCJcXCIsICIvIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJmaWxlbmFtZSIsIGZpbGVuYW1lIHx8ICJ1bm5hbWVkIik7CiAgfQogIGdldCBjb250ZW50KCkgewogICAgaWYgKCF0aGlzLiNjb250ZW50QXZhaWxhYmxlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdGhpcy5fY29udGVudFJlZiB8fD0gcGlja1BsYXRmb3JtSXRlbSh0aGlzLnJvb3Q/LmdldCgiRUYiKSk7CiAgICBsZXQgY29udGVudCA9IG51bGw7CiAgICBpZiAodGhpcy5fY29udGVudFJlZikgewogICAgICBjb25zdCBmaWxlT2JqID0gdGhpcy54cmVmLmZldGNoSWZSZWYodGhpcy5fY29udGVudFJlZik7CiAgICAgIGlmIChmaWxlT2JqIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnRlbnQgPSBmaWxlT2JqLmdldEJ5dGVzKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiRW1iZWRkZWQgZmlsZSBzcGVjaWZpY2F0aW9uIHBvaW50cyB0byBub24tZXhpc3RpbmcvaW52YWxpZCBjb250ZW50Iik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oIkVtYmVkZGVkIGZpbGUgc3BlY2lmaWNhdGlvbiBkb2VzIG5vdCBoYXZlIGFueSBjb250ZW50Iik7CiAgICB9CiAgICByZXR1cm4gY29udGVudDsKICB9CiAgZ2V0IGRlc2NyaXB0aW9uKCkgewogICAgbGV0IGRlc2NyaXB0aW9uID0gIiI7CiAgICBjb25zdCBkZXNjID0gdGhpcy5yb290Py5nZXQoIkRlc2MiKTsKICAgIGlmIChkZXNjICYmIHR5cGVvZiBkZXNjID09PSAic3RyaW5nIikgewogICAgICBkZXNjcmlwdGlvbiA9IHN0cmluZ1RvUERGU3RyaW5nKGRlc2MpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZGVzY3JpcHRpb24iLCBkZXNjcmlwdGlvbik7CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICByZXR1cm4gewogICAgICByYXdGaWxlbmFtZTogdGhpcy5maWxlbmFtZSwKICAgICAgZmlsZW5hbWU6IHN0cmlwUGF0aCh0aGlzLmZpbGVuYW1lKSwKICAgICAgY29udGVudDogdGhpcy5jb250ZW50LAogICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbgogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3htbF9wYXJzZXIuanMKCmNvbnN0IFhNTFBhcnNlckVycm9yQ29kZSA9IHsKICBOb0Vycm9yOiAwLAogIEVuZE9mRG9jdW1lbnQ6IC0xLAogIFVudGVybWluYXRlZENkYXQ6IC0yLAogIFVudGVybWluYXRlZFhtbERlY2xhcmF0aW9uOiAtMywKICBVbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb246IC00LAogIFVudGVybWluYXRlZENvbW1lbnQ6IC01LAogIE1hbGZvcm1lZEVsZW1lbnQ6IC02LAogIE91dE9mTWVtb3J5OiAtNywKICBVbnRlcm1pbmF0ZWRBdHRyaWJ1dGVWYWx1ZTogLTgsCiAgVW50ZXJtaW5hdGVkRWxlbWVudDogLTksCiAgRWxlbWVudE5ldmVyQmVndW46IC0xMAp9OwpmdW5jdGlvbiBpc1doaXRlc3BhY2UocywgaW5kZXgpIHsKICBjb25zdCBjaCA9IHNbaW5kZXhdOwogIHJldHVybiBjaCA9PT0gIiAiIHx8IGNoID09PSAiXG4iIHx8IGNoID09PSAiXHIiIHx8IGNoID09PSAiXHQiOwp9CmZ1bmN0aW9uIGlzV2hpdGVzcGFjZVN0cmluZyhzKSB7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBpZiAoIWlzV2hpdGVzcGFjZShzLCBpKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmNsYXNzIFhNTFBhcnNlckJhc2UgewogIF9yZXNvbHZlRW50aXRpZXMocykgewogICAgcmV0dXJuIHMucmVwbGFjZUFsbCgvJihbXjtdKyk7L2csIChhbGwsIGVudGl0eSkgPT4gewogICAgICBpZiAoZW50aXR5LnN1YnN0cmluZygwLCAyKSA9PT0gIiN4IikgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChwYXJzZUludChlbnRpdHkuc3Vic3RyaW5nKDIpLCAxNikpOwogICAgICB9IGVsc2UgaWYgKGVudGl0eS5zdWJzdHJpbmcoMCwgMSkgPT09ICIjIikgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChwYXJzZUludChlbnRpdHkuc3Vic3RyaW5nKDEpLCAxMCkpOwogICAgICB9CiAgICAgIHN3aXRjaCAoZW50aXR5KSB7CiAgICAgICAgY2FzZSAibHQiOgogICAgICAgICAgcmV0dXJuICI8IjsKICAgICAgICBjYXNlICJndCI6CiAgICAgICAgICByZXR1cm4gIj4iOwogICAgICAgIGNhc2UgImFtcCI6CiAgICAgICAgICByZXR1cm4gIiYiOwogICAgICAgIGNhc2UgInF1b3QiOgogICAgICAgICAgcmV0dXJuICciJzsKICAgICAgICBjYXNlICJhcG9zIjoKICAgICAgICAgIHJldHVybiAiJyI7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMub25SZXNvbHZlRW50aXR5KGVudGl0eSk7CiAgICB9KTsKICB9CiAgX3BhcnNlQ29udGVudChzLCBzdGFydCkgewogICAgY29uc3QgYXR0cmlidXRlcyA9IFtdOwogICAgbGV0IHBvcyA9IHN0YXJ0OwogICAgZnVuY3Rpb24gc2tpcFdzKCkgewogICAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgaXNXaGl0ZXNwYWNlKHMsIHBvcykpIHsKICAgICAgICArK3BvczsKICAgICAgfQogICAgfQogICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmICFpc1doaXRlc3BhY2UocywgcG9zKSAmJiBzW3Bvc10gIT09ICI+IiAmJiBzW3Bvc10gIT09ICIvIikgewogICAgICArK3BvczsKICAgIH0KICAgIGNvbnN0IG5hbWUgPSBzLnN1YnN0cmluZyhzdGFydCwgcG9zKTsKICAgIHNraXBXcygpOwogICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmIHNbcG9zXSAhPT0gIj4iICYmIHNbcG9zXSAhPT0gIi8iICYmIHNbcG9zXSAhPT0gIj8iKSB7CiAgICAgIHNraXBXcygpOwogICAgICBsZXQgYXR0ck5hbWUgPSAiIiwKICAgICAgICBhdHRyVmFsdWUgPSAiIjsKICAgICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmICFpc1doaXRlc3BhY2UocywgcG9zKSAmJiBzW3Bvc10gIT09ICI9IikgewogICAgICAgIGF0dHJOYW1lICs9IHNbcG9zXTsKICAgICAgICArK3BvczsKICAgICAgfQogICAgICBza2lwV3MoKTsKICAgICAgaWYgKHNbcG9zXSAhPT0gIj0iKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgKytwb3M7CiAgICAgIHNraXBXcygpOwogICAgICBjb25zdCBhdHRyRW5kQ2hhciA9IHNbcG9zXTsKICAgICAgaWYgKGF0dHJFbmRDaGFyICE9PSAnIicgJiYgYXR0ckVuZENoYXIgIT09ICInIikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGF0dHJFbmRJbmRleCA9IHMuaW5kZXhPZihhdHRyRW5kQ2hhciwgKytwb3MpOwogICAgICBpZiAoYXR0ckVuZEluZGV4IDwgMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGF0dHJWYWx1ZSA9IHMuc3Vic3RyaW5nKHBvcywgYXR0ckVuZEluZGV4KTsKICAgICAgYXR0cmlidXRlcy5wdXNoKHsKICAgICAgICBuYW1lOiBhdHRyTmFtZSwKICAgICAgICB2YWx1ZTogdGhpcy5fcmVzb2x2ZUVudGl0aWVzKGF0dHJWYWx1ZSkKICAgICAgfSk7CiAgICAgIHBvcyA9IGF0dHJFbmRJbmRleCArIDE7CiAgICAgIHNraXBXcygpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgbmFtZSwKICAgICAgYXR0cmlidXRlcywKICAgICAgcGFyc2VkOiBwb3MgLSBzdGFydAogICAgfTsKICB9CiAgX3BhcnNlUHJvY2Vzc2luZ0luc3RydWN0aW9uKHMsIHN0YXJ0KSB7CiAgICBsZXQgcG9zID0gc3RhcnQ7CiAgICBmdW5jdGlvbiBza2lwV3MoKSB7CiAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiBpc1doaXRlc3BhY2UocywgcG9zKSkgewogICAgICAgICsrcG9zOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgIWlzV2hpdGVzcGFjZShzLCBwb3MpICYmIHNbcG9zXSAhPT0gIj4iICYmIHNbcG9zXSAhPT0gIj8iICYmIHNbcG9zXSAhPT0gIi8iKSB7CiAgICAgICsrcG9zOwogICAgfQogICAgY29uc3QgbmFtZSA9IHMuc3Vic3RyaW5nKHN0YXJ0LCBwb3MpOwogICAgc2tpcFdzKCk7CiAgICBjb25zdCBhdHRyU3RhcnQgPSBwb3M7CiAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgKHNbcG9zXSAhPT0gIj8iIHx8IHNbcG9zICsgMV0gIT09ICI+IikpIHsKICAgICAgKytwb3M7CiAgICB9CiAgICBjb25zdCB2YWx1ZSA9IHMuc3Vic3RyaW5nKGF0dHJTdGFydCwgcG9zKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWUsCiAgICAgIHZhbHVlLAogICAgICBwYXJzZWQ6IHBvcyAtIHN0YXJ0CiAgICB9OwogIH0KICBwYXJzZVhtbChzKSB7CiAgICBsZXQgaSA9IDA7CiAgICB3aGlsZSAoaSA8IHMubGVuZ3RoKSB7CiAgICAgIGNvbnN0IGNoID0gc1tpXTsKICAgICAgbGV0IGogPSBpOwogICAgICBpZiAoY2ggPT09ICI8IikgewogICAgICAgICsrajsKICAgICAgICBjb25zdCBjaDIgPSBzW2pdOwogICAgICAgIGxldCBxOwogICAgICAgIHN3aXRjaCAoY2gyKSB7CiAgICAgICAgICBjYXNlICIvIjoKICAgICAgICAgICAgKytqOwogICAgICAgICAgICBxID0gcy5pbmRleE9mKCI+Iiwgaik7CiAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRWxlbWVudCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub25FbmRFbGVtZW50KHMuc3Vic3RyaW5nKGosIHEpKTsKICAgICAgICAgICAgaiA9IHEgKyAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIj8iOgogICAgICAgICAgICArK2o7CiAgICAgICAgICAgIGNvbnN0IHBpID0gdGhpcy5fcGFyc2VQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24ocywgaik7CiAgICAgICAgICAgIGlmIChzLnN1YnN0cmluZyhqICsgcGkucGFyc2VkLCBqICsgcGkucGFyc2VkICsgMikgIT09ICI/PiIpIHsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZFhtbERlY2xhcmF0aW9uKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vblBpKHBpLm5hbWUsIHBpLnZhbHVlKTsKICAgICAgICAgICAgaiArPSBwaS5wYXJzZWQgKyAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIiEiOgogICAgICAgICAgICBpZiAocy5zdWJzdHJpbmcoaiArIDEsIGogKyAzKSA9PT0gIi0tIikgewogICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIi0tPiIsIGogKyAzKTsKICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkQ29tbWVudCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMub25Db21tZW50KHMuc3Vic3RyaW5nKGogKyAzLCBxKSk7CiAgICAgICAgICAgICAgaiA9IHEgKyAzOwogICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyAxLCBqICsgOCkgPT09ICJbQ0RBVEFbIikgewogICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIl1dPiIsIGogKyA4KTsKICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkQ2RhdCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMub25DZGF0YShzLnN1YnN0cmluZyhqICsgOCwgcSkpOwogICAgICAgICAgICAgIGogPSBxICsgMzsKICAgICAgICAgICAgfSBlbHNlIGlmIChzLnN1YnN0cmluZyhqICsgMSwgaiArIDgpID09PSAiRE9DVFlQRSIpIHsKICAgICAgICAgICAgICBjb25zdCBxMiA9IHMuaW5kZXhPZigiWyIsIGogKyA4KTsKICAgICAgICAgICAgICBsZXQgY29tcGxleERvY3R5cGUgPSBmYWxzZTsKICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCI+IiwgaiArIDgpOwogICAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocTIgPiAwICYmIHEgPiBxMikgewogICAgICAgICAgICAgICAgcSA9IHMuaW5kZXhPZigiXT4iLCBqICsgOCk7CiAgICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb24pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb21wbGV4RG9jdHlwZSA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGRvY3R5cGVDb250ZW50ID0gcy5zdWJzdHJpbmcoaiArIDgsIHEgKyAoY29tcGxleERvY3R5cGUgPyAxIDogMCkpOwogICAgICAgICAgICAgIHRoaXMub25Eb2N0eXBlKGRvY3R5cGVDb250ZW50KTsKICAgICAgICAgICAgICBqID0gcSArIChjb21wbGV4RG9jdHlwZSA/IDIgOiAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLk1hbGZvcm1lZEVsZW1lbnQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLl9wYXJzZUNvbnRlbnQocywgaik7CiAgICAgICAgICAgIGlmIChjb250ZW50ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5NYWxmb3JtZWRFbGVtZW50KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGlzQ2xvc2VkID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChzLnN1YnN0cmluZyhqICsgY29udGVudC5wYXJzZWQsIGogKyBjb250ZW50LnBhcnNlZCArIDIpID09PSAiLz4iKSB7CiAgICAgICAgICAgICAgaXNDbG9zZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyBjb250ZW50LnBhcnNlZCwgaiArIGNvbnRlbnQucGFyc2VkICsgMSkgIT09ICI+IikgewogICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRWxlbWVudCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub25CZWdpbkVsZW1lbnQoY29udGVudC5uYW1lLCBjb250ZW50LmF0dHJpYnV0ZXMsIGlzQ2xvc2VkKTsKICAgICAgICAgICAgaiArPSBjb250ZW50LnBhcnNlZCArIChpc0Nsb3NlZCA/IDIgOiAxKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHdoaWxlIChqIDwgcy5sZW5ndGggJiYgc1tqXSAhPT0gIjwiKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRleHQgPSBzLnN1YnN0cmluZyhpLCBqKTsKICAgICAgICB0aGlzLm9uVGV4dCh0aGlzLl9yZXNvbHZlRW50aXRpZXModGV4dCkpOwogICAgICB9CiAgICAgIGkgPSBqOwogICAgfQogIH0KICBvblJlc29sdmVFbnRpdHkobmFtZSkgewogICAgcmV0dXJuIGAmJHtuYW1lfTtgOwogIH0KICBvblBpKG5hbWUsIHZhbHVlKSB7fQogIG9uQ29tbWVudCh0ZXh0KSB7fQogIG9uQ2RhdGEodGV4dCkge30KICBvbkRvY3R5cGUoZG9jdHlwZUNvbnRlbnQpIHt9CiAgb25UZXh0KHRleHQpIHt9CiAgb25CZWdpbkVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgaXNFbXB0eSkge30KICBvbkVuZEVsZW1lbnQobmFtZSkge30KICBvbkVycm9yKGNvZGUpIHt9Cn0KY2xhc3MgU2ltcGxlRE9NTm9kZSB7CiAgY29uc3RydWN0b3Iobm9kZU5hbWUsIG5vZGVWYWx1ZSkgewogICAgdGhpcy5ub2RlTmFtZSA9IG5vZGVOYW1lOwogICAgdGhpcy5ub2RlVmFsdWUgPSBub2RlVmFsdWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgInBhcmVudE5vZGUiLCB7CiAgICAgIHZhbHVlOiBudWxsLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfQogIGdldCBmaXJzdENoaWxkKCkgewogICAgcmV0dXJuIHRoaXMuY2hpbGROb2Rlcz8uWzBdOwogIH0KICBnZXQgbmV4dFNpYmxpbmcoKSB7CiAgICBjb25zdCBjaGlsZE5vZGVzID0gdGhpcy5wYXJlbnROb2RlLmNoaWxkTm9kZXM7CiAgICBpZiAoIWNoaWxkTm9kZXMpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IGluZGV4ID0gY2hpbGROb2Rlcy5pbmRleE9mKHRoaXMpOwogICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIGNoaWxkTm9kZXNbaW5kZXggKyAxXTsKICB9CiAgZ2V0IHRleHRDb250ZW50KCkgewogICAgaWYgKCF0aGlzLmNoaWxkTm9kZXMpIHsKICAgICAgcmV0dXJuIHRoaXMubm9kZVZhbHVlIHx8ICIiOwogICAgfQogICAgcmV0dXJuIHRoaXMuY2hpbGROb2Rlcy5tYXAoY2hpbGQgPT4gY2hpbGQudGV4dENvbnRlbnQpLmpvaW4oIiIpOwogIH0KICBnZXQgY2hpbGRyZW4oKSB7CiAgICByZXR1cm4gdGhpcy5jaGlsZE5vZGVzIHx8IFtdOwogIH0KICBoYXNDaGlsZE5vZGVzKCkgewogICAgcmV0dXJuIHRoaXMuY2hpbGROb2Rlcz8ubGVuZ3RoID4gMDsKICB9CiAgc2VhcmNoTm9kZShwYXRocywgcG9zKSB7CiAgICBpZiAocG9zID49IHBhdGhzLmxlbmd0aCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvbnN0IGNvbXBvbmVudCA9IHBhdGhzW3Bvc107CiAgICBpZiAoY29tcG9uZW50Lm5hbWUuc3RhcnRzV2l0aCgiIyIpICYmIHBvcyA8IHBhdGhzLmxlbmd0aCAtIDEpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VhcmNoTm9kZShwYXRocywgcG9zICsgMSk7CiAgICB9CiAgICBjb25zdCBzdGFjayA9IFtdOwogICAgbGV0IG5vZGUgPSB0aGlzOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKGNvbXBvbmVudC5uYW1lID09PSBub2RlLm5vZGVOYW1lKSB7CiAgICAgICAgaWYgKGNvbXBvbmVudC5wb3MgPT09IDApIHsKICAgICAgICAgIGNvbnN0IHJlcyA9IG5vZGUuc2VhcmNoTm9kZShwYXRocywgcG9zICsgMSk7CiAgICAgICAgICBpZiAocmVzICE9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBbcGFyZW50XSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbGV0IHNpYmxpbmdQb3MgPSAwOwogICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBwYXJlbnQuY2hpbGROb2RlcykgewogICAgICAgICAgICBpZiAoY29tcG9uZW50Lm5hbWUgPT09IGNoaWxkLm5vZGVOYW1lKSB7CiAgICAgICAgICAgICAgaWYgKHNpYmxpbmdQb3MgPT09IGNvbXBvbmVudC5wb3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZC5zZWFyY2hOb2RlKHBhdGhzLCBwb3MgKyAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2libGluZ1BvcysrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbm9kZS5zZWFyY2hOb2RlKHBhdGhzLCBwb3MgKyAxKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG5vZGUuY2hpbGROb2Rlcz8ubGVuZ3RoID4gMCkgewogICAgICAgIHN0YWNrLnB1c2goW25vZGUsIDBdKTsKICAgICAgICBub2RlID0gbm9kZS5jaGlsZE5vZGVzWzBdOwogICAgICB9IGVsc2UgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggIT09IDApIHsKICAgICAgICAgIGNvbnN0IFtwYXJlbnQsIGN1cnJlbnRQb3NdID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBjb25zdCBuZXdQb3MgPSBjdXJyZW50UG9zICsgMTsKICAgICAgICAgIGlmIChuZXdQb3MgPCBwYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChbcGFyZW50LCBuZXdQb3NdKTsKICAgICAgICAgICAgbm9kZSA9IHBhcmVudC5jaGlsZE5vZGVzW25ld1Bvc107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgZHVtcChidWZmZXIpIHsKICAgIGlmICh0aGlzLm5vZGVOYW1lID09PSAiI3RleHQiKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGVuY29kZVRvWG1sU3RyaW5nKHRoaXMubm9kZVZhbHVlKSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGJ1ZmZlci5wdXNoKGA8JHt0aGlzLm5vZGVOYW1lfWApOwogICAgaWYgKHRoaXMuYXR0cmlidXRlcykgewogICAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiB0aGlzLmF0dHJpYnV0ZXMpIHsKICAgICAgICBidWZmZXIucHVzaChgICR7YXR0cmlidXRlLm5hbWV9PSIke2VuY29kZVRvWG1sU3RyaW5nKGF0dHJpYnV0ZS52YWx1ZSl9ImApOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgYnVmZmVyLnB1c2goIj4iKTsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmNoaWxkTm9kZXMpIHsKICAgICAgICBjaGlsZC5kdW1wKGJ1ZmZlcik7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goYDwvJHt0aGlzLm5vZGVOYW1lfT5gKTsKICAgIH0gZWxzZSBpZiAodGhpcy5ub2RlVmFsdWUpIHsKICAgICAgYnVmZmVyLnB1c2goYD4ke2VuY29kZVRvWG1sU3RyaW5nKHRoaXMubm9kZVZhbHVlKX08LyR7dGhpcy5ub2RlTmFtZX0+YCk7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIucHVzaCgiLz4iKTsKICAgIH0KICB9Cn0KY2xhc3MgU2ltcGxlWE1MUGFyc2VyIGV4dGVuZHMgWE1MUGFyc2VyQmFzZSB7CiAgY29uc3RydWN0b3IoewogICAgaGFzQXR0cmlidXRlcyA9IGZhbHNlLAogICAgbG93ZXJDYXNlTmFtZSA9IGZhbHNlCiAgfSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudCA9IG51bGw7CiAgICB0aGlzLl9zdGFjayA9IG51bGw7CiAgICB0aGlzLl9lcnJvckNvZGUgPSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcjsKICAgIHRoaXMuX2hhc0F0dHJpYnV0ZXMgPSBoYXNBdHRyaWJ1dGVzOwogICAgdGhpcy5fbG93ZXJDYXNlTmFtZSA9IGxvd2VyQ2FzZU5hbWU7CiAgfQogIHBhcnNlRnJvbVN0cmluZyhkYXRhKSB7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQgPSBbXTsKICAgIHRoaXMuX3N0YWNrID0gW107CiAgICB0aGlzLl9lcnJvckNvZGUgPSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcjsKICAgIHRoaXMucGFyc2VYbWwoZGF0YSk7CiAgICBpZiAodGhpcy5fZXJyb3JDb2RlICE9PSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcikgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgY29uc3QgW2RvY3VtZW50RWxlbWVudF0gPSB0aGlzLl9jdXJyZW50RnJhZ21lbnQ7CiAgICBpZiAoIWRvY3VtZW50RWxlbWVudCkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZG9jdW1lbnRFbGVtZW50CiAgICB9OwogIH0KICBvblRleHQodGV4dCkgewogICAgaWYgKGlzV2hpdGVzcGFjZVN0cmluZyh0ZXh0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBub2RlID0gbmV3IFNpbXBsZURPTU5vZGUoIiN0ZXh0IiwgdGV4dCk7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQucHVzaChub2RlKTsKICB9CiAgb25DZGF0YSh0ZXh0KSB7CiAgICBjb25zdCBub2RlID0gbmV3IFNpbXBsZURPTU5vZGUoIiN0ZXh0IiwgdGV4dCk7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQucHVzaChub2RlKTsKICB9CiAgb25CZWdpbkVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgaXNFbXB0eSkgewogICAgaWYgKHRoaXMuX2xvd2VyQ2FzZU5hbWUpIHsKICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIH0KICAgIGNvbnN0IG5vZGUgPSBuZXcgU2ltcGxlRE9NTm9kZShuYW1lKTsKICAgIG5vZGUuY2hpbGROb2RlcyA9IFtdOwogICAgaWYgKHRoaXMuX2hhc0F0dHJpYnV0ZXMpIHsKICAgICAgbm9kZS5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKICAgIH0KICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudC5wdXNoKG5vZGUpOwogICAgaWYgKGlzRW1wdHkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fc3RhY2sucHVzaCh0aGlzLl9jdXJyZW50RnJhZ21lbnQpOwogICAgdGhpcy5fY3VycmVudEZyYWdtZW50ID0gbm9kZS5jaGlsZE5vZGVzOwogIH0KICBvbkVuZEVsZW1lbnQobmFtZSkgewogICAgdGhpcy5fY3VycmVudEZyYWdtZW50ID0gdGhpcy5fc3RhY2sucG9wKCkgfHwgW107CiAgICBjb25zdCBsYXN0RWxlbWVudCA9IHRoaXMuX2N1cnJlbnRGcmFnbWVudC5hdCgtMSk7CiAgICBpZiAoIWxhc3RFbGVtZW50KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZE5vZGUgb2YgbGFzdEVsZW1lbnQuY2hpbGROb2RlcykgewogICAgICBjaGlsZE5vZGUucGFyZW50Tm9kZSA9IGxhc3RFbGVtZW50OwogICAgfQogICAgcmV0dXJuIGxhc3RFbGVtZW50OwogIH0KICBvbkVycm9yKGNvZGUpIHsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IGNvZGU7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9tZXRhZGF0YV9wYXJzZXIuanMKCmNsYXNzIE1ldGFkYXRhUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICBkYXRhID0gdGhpcy5fcmVwYWlyKGRhdGEpOwogICAgY29uc3QgcGFyc2VyID0gbmV3IFNpbXBsZVhNTFBhcnNlcih7CiAgICAgIGxvd2VyQ2FzZU5hbWU6IHRydWUKICAgIH0pOwogICAgY29uc3QgeG1sRG9jdW1lbnQgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKGRhdGEpOwogICAgdGhpcy5fbWV0YWRhdGFNYXAgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9kYXRhID0gZGF0YTsKICAgIGlmICh4bWxEb2N1bWVudCkgewogICAgICB0aGlzLl9wYXJzZSh4bWxEb2N1bWVudCk7CiAgICB9CiAgfQogIF9yZXBhaXIoZGF0YSkgewogICAgcmV0dXJuIGRhdGEucmVwbGFjZSgvXltePF0rLywgIiIpLnJlcGxhY2VBbGwoLz5cXDM3NlxcMzc3KFtePF0rKS9nLCBmdW5jdGlvbiAoYWxsLCBjb2RlcykgewogICAgICBjb25zdCBieXRlcyA9IGNvZGVzLnJlcGxhY2VBbGwoL1xcKFswLTNdKShbMC03XSkoWzAtN10pL2csIGZ1bmN0aW9uIChjb2RlLCBkMSwgZDIsIGQzKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZDEgKiA2NCArIGQyICogOCArIGQzICogMSk7CiAgICAgIH0pLnJlcGxhY2VBbGwoLyYoYW1wfGFwb3N8Z3R8bHR8cXVvdCk7L2csIGZ1bmN0aW9uIChzdHIsIG5hbWUpIHsKICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgIGNhc2UgImFtcCI6CiAgICAgICAgICAgIHJldHVybiAiJiI7CiAgICAgICAgICBjYXNlICJhcG9zIjoKICAgICAgICAgICAgcmV0dXJuICInIjsKICAgICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgICAgcmV0dXJuICI+IjsKICAgICAgICAgIGNhc2UgImx0IjoKICAgICAgICAgICAgcmV0dXJuICI8IjsKICAgICAgICAgIGNhc2UgInF1b3QiOgogICAgICAgICAgICByZXR1cm4gJyInOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYF9yZXBhaXI6ICR7bmFtZX0gaXNuJ3QgZGVmaW5lZC5gKTsKICAgICAgfSk7CiAgICAgIGNvbnN0IGNoYXJCdWYgPSBbIj4iXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYnl0ZXMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgIGNvbnN0IGNvZGUgPSBieXRlcy5jaGFyQ29kZUF0KGkpICogMjU2ICsgYnl0ZXMuY2hhckNvZGVBdChpICsgMSk7CiAgICAgICAgaWYgKGNvZGUgPj0gMzIgJiYgY29kZSA8IDEyNyAmJiBjb2RlICE9PSA2MCAmJiBjb2RlICE9PSA2MiAmJiBjb2RlICE9PSAzOCkgewogICAgICAgICAgY2hhckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjaGFyQnVmLnB1c2goIiYjeCIgKyAoMHgxMDAwMCArIGNvZGUpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSkgKyAiOyIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhckJ1Zi5qb2luKCIiKTsKICAgIH0pOwogIH0KICBfZ2V0U2VxdWVuY2UoZW50cnkpIHsKICAgIGNvbnN0IG5hbWUgPSBlbnRyeS5ub2RlTmFtZTsKICAgIGlmIChuYW1lICE9PSAicmRmOmJhZyIgJiYgbmFtZSAhPT0gInJkZjpzZXEiICYmIG5hbWUgIT09ICJyZGY6YWx0IikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiBlbnRyeS5jaGlsZE5vZGVzLmZpbHRlcihub2RlID0+IG5vZGUubm9kZU5hbWUgPT09ICJyZGY6bGkiKTsKICB9CiAgX3BhcnNlQXJyYXkoZW50cnkpIHsKICAgIGlmICghZW50cnkuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFtzZXFOb2RlXSA9IGVudHJ5LmNoaWxkTm9kZXM7CiAgICBjb25zdCBzZXF1ZW5jZSA9IHRoaXMuX2dldFNlcXVlbmNlKHNlcU5vZGUpIHx8IFtdOwogICAgdGhpcy5fbWV0YWRhdGFNYXAuc2V0KGVudHJ5Lm5vZGVOYW1lLCBzZXF1ZW5jZS5tYXAobm9kZSA9PiBub2RlLnRleHRDb250ZW50LnRyaW0oKSkpOwogIH0KICBfcGFyc2UoeG1sRG9jdW1lbnQpIHsKICAgIGxldCByZGYgPSB4bWxEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICBpZiAocmRmLm5vZGVOYW1lICE9PSAicmRmOnJkZiIpIHsKICAgICAgcmRmID0gcmRmLmZpcnN0Q2hpbGQ7CiAgICAgIHdoaWxlIChyZGYgJiYgcmRmLm5vZGVOYW1lICE9PSAicmRmOnJkZiIpIHsKICAgICAgICByZGYgPSByZGYubmV4dFNpYmxpbmc7CiAgICAgIH0KICAgIH0KICAgIGlmICghcmRmIHx8IHJkZi5ub2RlTmFtZSAhPT0gInJkZjpyZGYiIHx8ICFyZGYuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgZGVzYyBvZiByZGYuY2hpbGROb2RlcykgewogICAgICBpZiAoZGVzYy5ub2RlTmFtZSAhPT0gInJkZjpkZXNjcmlwdGlvbiIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGRlc2MuY2hpbGROb2RlcykgewogICAgICAgIGNvbnN0IG5hbWUgPSBlbnRyeS5ub2RlTmFtZTsKICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgIGNhc2UgIiN0ZXh0IjoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlICJkYzpjcmVhdG9yIjoKICAgICAgICAgIGNhc2UgImRjOnN1YmplY3QiOgogICAgICAgICAgICB0aGlzLl9wYXJzZUFycmF5KGVudHJ5KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuX21ldGFkYXRhTWFwLnNldChuYW1lLCBlbnRyeS50ZXh0Q29udGVudC50cmltKCkpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICByZXR1cm4gewogICAgICBwYXJzZWREYXRhOiB0aGlzLl9tZXRhZGF0YU1hcCwKICAgICAgcmF3RGF0YTogdGhpcy5fZGF0YQogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3N0cnVjdF90cmVlLmpzCgoKCgpjb25zdCBNQVhfREVQVEggPSA0MDsKY29uc3QgU3RydWN0RWxlbWVudFR5cGUgPSB7CiAgUEFHRV9DT05URU5UOiAxLAogIFNUUkVBTV9DT05URU5UOiAyLAogIE9CSkVDVDogMywKICBBTk5PVEFUSU9OOiA0LAogIEVMRU1FTlQ6IDUKfTsKY2xhc3MgU3RydWN0VHJlZVJvb3QgewogIGNvbnN0cnVjdG9yKHhyZWYsIHJvb3REaWN0LCByb290UmVmKSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5kaWN0ID0gcm9vdERpY3Q7CiAgICB0aGlzLnJlZiA9IHJvb3RSZWYgaW5zdGFuY2VvZiBSZWYgPyByb290UmVmIDogbnVsbDsKICAgIHRoaXMucm9sZU1hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuc3RydWN0UGFyZW50SWRzID0gbnVsbDsKICB9CiAgaW5pdCgpIHsKICAgIHRoaXMucmVhZFJvbGVNYXAoKTsKICB9CiAgI2FkZElkVG9QYWdlKHBhZ2VSZWYsIGlkLCB0eXBlKSB7CiAgICBpZiAoIShwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSB8fCBpZCA8IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5zdHJ1Y3RQYXJlbnRJZHMgfHw9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgbGV0IGlkcyA9IHRoaXMuc3RydWN0UGFyZW50SWRzLmdldChwYWdlUmVmKTsKICAgIGlmICghaWRzKSB7CiAgICAgIGlkcyA9IFtdOwogICAgICB0aGlzLnN0cnVjdFBhcmVudElkcy5wdXQocGFnZVJlZiwgaWRzKTsKICAgIH0KICAgIGlkcy5wdXNoKFtpZCwgdHlwZV0pOwogIH0KICBhZGRBbm5vdGF0aW9uSWRUb1BhZ2UocGFnZVJlZiwgaWQpIHsKICAgIHRoaXMuI2FkZElkVG9QYWdlKHBhZ2VSZWYsIGlkLCBTdHJ1Y3RFbGVtZW50VHlwZS5BTk5PVEFUSU9OKTsKICB9CiAgcmVhZFJvbGVNYXAoKSB7CiAgICBjb25zdCByb2xlTWFwRGljdCA9IHRoaXMuZGljdC5nZXQoIlJvbGVNYXAiKTsKICAgIGlmICghKHJvbGVNYXBEaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2Ygcm9sZU1hcERpY3QpIHsKICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIHRoaXMucm9sZU1hcC5zZXQoa2V5LCB2YWx1ZS5uYW1lKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgY2FuQ3JlYXRlU3RydWN0dXJlVHJlZSh7CiAgICBjYXRhbG9nUmVmLAogICAgcGRmTWFuYWdlciwKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlCiAgfSkgewogICAgaWYgKCEoY2F0YWxvZ1JlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgd2FybigiQ2Fubm90IHNhdmUgdGhlIHN0cnVjdCB0cmVlOiBubyBjYXRhbG9nIHJlZmVyZW5jZS4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbGV0IG5leHRLZXkgPSAwOwogICAgbGV0IGhhc05vdGhpbmdUb1VwZGF0ZSA9IHRydWU7CiAgICBmb3IgKGNvbnN0IFtwYWdlSW5kZXgsIGVsZW1lbnRzXSBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVmOiBwYWdlUmVmCiAgICAgIH0gPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgaWYgKCEocGFnZVJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgICB3YXJuKGBDYW5ub3Qgc2F2ZSB0aGUgc3RydWN0IHRyZWU6IHBhZ2UgJHtwYWdlSW5kZXh9IGhhcyBubyByZWYuYCk7CiAgICAgICAgaGFzTm90aGluZ1RvVXBkYXRlID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICBpZiAoZWxlbWVudC5hY2Nlc3NpYmlsaXR5RGF0YT8udHlwZSkgewogICAgICAgICAgZWxlbWVudC5wYXJlbnRUcmVlSWQgPSBuZXh0S2V5Kys7CiAgICAgICAgICBoYXNOb3RoaW5nVG9VcGRhdGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChoYXNOb3RoaW5nVG9VcGRhdGUpIHsKICAgICAgZm9yIChjb25zdCBlbGVtZW50cyBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZS52YWx1ZXMoKSkgewogICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykgewogICAgICAgICAgZGVsZXRlIGVsZW1lbnQucGFyZW50VHJlZUlkOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZVN0cnVjdHVyZVRyZWUoewogICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICB4cmVmLAogICAgY2F0YWxvZ1JlZiwKICAgIHBkZk1hbmFnZXIsCiAgICBjaGFuZ2VzCiAgfSkgewogICAgY29uc3Qgcm9vdCA9IGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiY2xvbmVEaWN0Iik7CiAgICBjb25zdCBjYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgY2FjaGUucHV0KGNhdGFsb2dSZWYsIHJvb3QpOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3RSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgcm9vdC5zZXQoIlN0cnVjdFRyZWVSb290Iiwgc3RydWN0VHJlZVJvb3RSZWYpOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIHN0cnVjdFRyZWVSb290LnNldCgiVHlwZSIsIE5hbWUuZ2V0KCJTdHJ1Y3RUcmVlUm9vdCIpKTsKICAgIGNvbnN0IHBhcmVudFRyZWVSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgc3RydWN0VHJlZVJvb3Quc2V0KCJQYXJlbnRUcmVlIiwgcGFyZW50VHJlZVJlZik7CiAgICBjb25zdCBraWRzID0gW107CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIksiLCBraWRzKTsKICAgIGNhY2hlLnB1dChzdHJ1Y3RUcmVlUm9vdFJlZiwgc3RydWN0VHJlZVJvb3QpOwogICAgY29uc3QgcGFyZW50VHJlZSA9IG5ldyBEaWN0KHhyZWYpOwogICAgY29uc3QgbnVtcyA9IFtdOwogICAgcGFyZW50VHJlZS5zZXQoIk51bXMiLCBudW1zKTsKICAgIGNvbnN0IG5leHRLZXkgPSBhd2FpdCB0aGlzLiN3cml0ZUtpZHMoewogICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZSwKICAgICAgc3RydWN0VHJlZVJvb3RSZWYsCiAgICAgIHN0cnVjdFRyZWVSb290OiBudWxsLAogICAgICBraWRzLAogICAgICBudW1zLAogICAgICB4cmVmLAogICAgICBwZGZNYW5hZ2VyLAogICAgICBjaGFuZ2VzLAogICAgICBjYWNoZQogICAgfSk7CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWVOZXh0S2V5IiwgbmV4dEtleSk7CiAgICBjYWNoZS5wdXQocGFyZW50VHJlZVJlZiwgcGFyZW50VHJlZSk7CiAgICBmb3IgKGNvbnN0IFtyZWYsIG9ial0gb2YgY2FjaGUuaXRlbXMoKSkgewogICAgICBjaGFuZ2VzLnB1dChyZWYsIHsKICAgICAgICBkYXRhOiBvYmoKICAgICAgfSk7CiAgICB9CiAgfQogIGFzeW5jIGNhblVwZGF0ZVN0cnVjdFRyZWUoewogICAgcGRmTWFuYWdlciwKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlCiAgfSkgewogICAgaWYgKCF0aGlzLnJlZikgewogICAgICB3YXJuKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogbm8gcm9vdCByZWZlcmVuY2UuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGxldCBuZXh0S2V5ID0gdGhpcy5kaWN0LmdldCgiUGFyZW50VHJlZU5leHRLZXkiKTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihuZXh0S2V5KSB8fCBuZXh0S2V5IDwgMCkgewogICAgICB3YXJuKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogaW52YWxpZCBuZXh0IGtleS4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgcGFyZW50VHJlZSA9IHRoaXMuZGljdC5nZXQoIlBhcmVudFRyZWUiKTsKICAgIGlmICghKHBhcmVudFRyZWUgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICB3YXJuKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogUGFyZW50VHJlZSBpc24ndCBhIGRpY3QuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IG51bXMgPSBwYXJlbnRUcmVlLmdldCgiTnVtcyIpOwogICAgaWYgKCFBcnJheS5pc0FycmF5KG51bXMpKSB7CiAgICAgIHdhcm4oIkNhbm5vdCB1cGRhdGUgdGhlIHN0cnVjdCB0cmVlOiBudW1zIGlzbid0IGFuIGFycmF5LiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBudW1iZXJUcmVlID0gbmV3IE51bWJlclRyZWUocGFyZW50VHJlZSwgdGhpcy54cmVmKTsKICAgIGZvciAoY29uc3QgcGFnZUluZGV4IG9mIG5ld0Fubm90YXRpb25zQnlQYWdlLmtleXMoKSkgewogICAgICBjb25zdCB7CiAgICAgICAgcGFnZURpY3QKICAgICAgfSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICBpZiAoIXBhZ2VEaWN0LmhhcygiU3RydWN0UGFyZW50cyIpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaWQgPSBwYWdlRGljdC5nZXQoIlN0cnVjdFBhcmVudHMiKTsKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGlkKSB8fCAhQXJyYXkuaXNBcnJheShudW1iZXJUcmVlLmdldChpZCkpKSB7CiAgICAgICAgd2FybihgQ2Fubm90IHNhdmUgdGhlIHN0cnVjdCB0cmVlOiBwYWdlICR7cGFnZUluZGV4fSBoYXMgYSB3cm9uZyBpZC5gKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxldCBoYXNOb3RoaW5nVG9VcGRhdGUgPSB0cnVlOwogICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBlbGVtZW50c10gb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgY29uc3QgewogICAgICAgIHBhZ2VEaWN0CiAgICAgIH0gPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgU3RydWN0VHJlZVJvb3QuI2NvbGxlY3RQYXJlbnRzKHsKICAgICAgICBlbGVtZW50cywKICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgcGFnZURpY3QsCiAgICAgICAgbnVtYmVyVHJlZQogICAgICB9KTsKICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgICAgaWYgKGVsZW1lbnQuYWNjZXNzaWJpbGl0eURhdGE/LnR5cGUpIHsKICAgICAgICAgIGlmICghKGVsZW1lbnQuYWNjZXNzaWJpbGl0eURhdGEuc3RydWN0UGFyZW50ID49IDApKSB7CiAgICAgICAgICAgIGVsZW1lbnQucGFyZW50VHJlZUlkID0gbmV4dEtleSsrOwogICAgICAgICAgfQogICAgICAgICAgaGFzTm90aGluZ1RvVXBkYXRlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoaGFzTm90aGluZ1RvVXBkYXRlKSB7CiAgICAgIGZvciAoY29uc3QgZWxlbWVudHMgb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UudmFsdWVzKCkpIHsKICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnBhcmVudFRyZWVJZDsKICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBhc3luYyB1cGRhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgcGRmTWFuYWdlciwKICAgIGNoYW5nZXMKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIHJlZjogc3RydWN0VHJlZVJvb3RSZWYsCiAgICAgIHhyZWYKICAgIH0gPSB0aGlzOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3QgPSB0aGlzLmRpY3QuY2xvbmUoKTsKICAgIGNvbnN0IGNhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICBjYWNoZS5wdXQoc3RydWN0VHJlZVJvb3RSZWYsIHN0cnVjdFRyZWVSb290KTsKICAgIGxldCBwYXJlbnRUcmVlUmVmID0gc3RydWN0VHJlZVJvb3QuZ2V0UmF3KCJQYXJlbnRUcmVlIik7CiAgICBsZXQgcGFyZW50VHJlZTsKICAgIGlmIChwYXJlbnRUcmVlUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHBhcmVudFRyZWUgPSB4cmVmLmZldGNoKHBhcmVudFRyZWVSZWYpOwogICAgfSBlbHNlIHsKICAgICAgcGFyZW50VHJlZSA9IHBhcmVudFRyZWVSZWY7CiAgICAgIHBhcmVudFRyZWVSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWUiLCBwYXJlbnRUcmVlUmVmKTsKICAgIH0KICAgIHBhcmVudFRyZWUgPSBwYXJlbnRUcmVlLmNsb25lKCk7CiAgICBjYWNoZS5wdXQocGFyZW50VHJlZVJlZiwgcGFyZW50VHJlZSk7CiAgICBsZXQgbnVtcyA9IHBhcmVudFRyZWUuZ2V0UmF3KCJOdW1zIik7CiAgICBsZXQgbnVtc1JlZiA9IG51bGw7CiAgICBpZiAobnVtcyBpbnN0YW5jZW9mIFJlZikgewogICAgICBudW1zUmVmID0gbnVtczsKICAgICAgbnVtcyA9IHhyZWYuZmV0Y2gobnVtc1JlZik7CiAgICB9CiAgICBudW1zID0gbnVtcy5zbGljZSgpOwogICAgaWYgKCFudW1zUmVmKSB7CiAgICAgIHBhcmVudFRyZWUuc2V0KCJOdW1zIiwgbnVtcyk7CiAgICB9CiAgICBjb25zdCBuZXdOZXh0S2V5ID0gYXdhaXQgU3RydWN0VHJlZVJvb3QuI3dyaXRlS2lkcyh7CiAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgICBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgICAgc3RydWN0VHJlZVJvb3Q6IHRoaXMsCiAgICAgIGtpZHM6IG51bGwsCiAgICAgIG51bXMsCiAgICAgIHhyZWYsCiAgICAgIHBkZk1hbmFnZXIsCiAgICAgIGNoYW5nZXMsCiAgICAgIGNhY2hlCiAgICB9KTsKICAgIGlmIChuZXdOZXh0S2V5ID09PSAtMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWVOZXh0S2V5IiwgbmV3TmV4dEtleSk7CiAgICBpZiAobnVtc1JlZikgewogICAgICBjYWNoZS5wdXQobnVtc1JlZiwgbnVtcyk7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtyZWYsIG9ial0gb2YgY2FjaGUuaXRlbXMoKSkgewogICAgICBjaGFuZ2VzLnB1dChyZWYsIHsKICAgICAgICBkYXRhOiBvYmoKICAgICAgfSk7CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyAjd3JpdGVLaWRzKHsKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgc3RydWN0VHJlZVJvb3RSZWYsCiAgICBzdHJ1Y3RUcmVlUm9vdCwKICAgIGtpZHMsCiAgICBudW1zLAogICAgeHJlZiwKICAgIHBkZk1hbmFnZXIsCiAgICBjaGFuZ2VzLAogICAgY2FjaGUKICB9KSB7CiAgICBjb25zdCBvYmpyID0gTmFtZS5nZXQoIk9CSlIiKTsKICAgIGxldCBuZXh0S2V5ID0gLTE7CiAgICBsZXQgc3RydWN0VHJlZVBhZ2VPYmpzOwogICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBlbGVtZW50c10gb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICBjb25zdCB7CiAgICAgICAgcmVmOiBwYWdlUmVmCiAgICAgIH0gPSBwYWdlOwogICAgICBjb25zdCBpc1BhZ2VSZWYgPSBwYWdlUmVmIGluc3RhbmNlb2YgUmVmOwogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICBhY2Nlc3NpYmlsaXR5RGF0YSwKICAgICAgICByZWYsCiAgICAgICAgcGFyZW50VHJlZUlkLAogICAgICAgIHN0cnVjdFRyZWVQYXJlbnQKICAgICAgfSBvZiBlbGVtZW50cykgewogICAgICAgIGlmICghYWNjZXNzaWJpbGl0eURhdGE/LnR5cGUpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCB7CiAgICAgICAgICBzdHJ1Y3RQYXJlbnQKICAgICAgICB9ID0gYWNjZXNzaWJpbGl0eURhdGE7CiAgICAgICAgaWYgKHN0cnVjdFRyZWVSb290ICYmIE51bWJlci5pc0ludGVnZXIoc3RydWN0UGFyZW50KSAmJiBzdHJ1Y3RQYXJlbnQgPj0gMCkgewogICAgICAgICAgbGV0IG9ianMgPSAoc3RydWN0VHJlZVBhZ2VPYmpzIHx8PSBuZXcgTWFwKCkpLmdldChwYWdlSW5kZXgpOwogICAgICAgICAgaWYgKG9ianMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzdHJ1Y3RUcmVlUGFnZSA9IG5ldyBTdHJ1Y3RUcmVlUGFnZShzdHJ1Y3RUcmVlUm9vdCwgcGFnZS5wYWdlRGljdCk7CiAgICAgICAgICAgIG9ianMgPSBzdHJ1Y3RUcmVlUGFnZS5jb2xsZWN0T2JqZWN0cyhwYWdlUmVmKTsKICAgICAgICAgICAgc3RydWN0VHJlZVBhZ2VPYmpzLnNldChwYWdlSW5kZXgsIG9ianMpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgb2JqUmVmID0gb2Jqcz8uZ2V0KHN0cnVjdFBhcmVudCk7CiAgICAgICAgICBpZiAob2JqUmVmKSB7CiAgICAgICAgICAgIGNvbnN0IHRhZ0RpY3QgPSB4cmVmLmZldGNoKG9ialJlZikuY2xvbmUoKTsKICAgICAgICAgICAgU3RydWN0VHJlZVJvb3QuI3dyaXRlUHJvcGVydGllcyh0YWdEaWN0LCBhY2Nlc3NpYmlsaXR5RGF0YSk7CiAgICAgICAgICAgIGNoYW5nZXMucHV0KG9ialJlZiwgewogICAgICAgICAgICAgIGRhdGE6IHRhZ0RpY3QKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBuZXh0S2V5ID0gTWF0aC5tYXgobmV4dEtleSwgcGFyZW50VHJlZUlkKTsKICAgICAgICBjb25zdCB0YWdSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgIGNvbnN0IHRhZ0RpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgICBTdHJ1Y3RUcmVlUm9vdC4jd3JpdGVQcm9wZXJ0aWVzKHRhZ0RpY3QsIGFjY2Vzc2liaWxpdHlEYXRhKTsKICAgICAgICBhd2FpdCB0aGlzLiN1cGRhdGVQYXJlbnRUYWcoewogICAgICAgICAgc3RydWN0VHJlZVBhcmVudCwKICAgICAgICAgIHRhZ0RpY3QsCiAgICAgICAgICBuZXdUYWdSZWY6IHRhZ1JlZiwKICAgICAgICAgIHN0cnVjdFRyZWVSb290UmVmLAogICAgICAgICAgZmFsbGJhY2tLaWRzOiBraWRzLAogICAgICAgICAgeHJlZiwKICAgICAgICAgIGNhY2hlCiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgb2JqRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICAgIHRhZ0RpY3Quc2V0KCJLIiwgb2JqRGljdCk7CiAgICAgICAgb2JqRGljdC5zZXQoIlR5cGUiLCBvYmpyKTsKICAgICAgICBpZiAoaXNQYWdlUmVmKSB7CiAgICAgICAgICBvYmpEaWN0LnNldCgiUGciLCBwYWdlUmVmKTsKICAgICAgICB9CiAgICAgICAgb2JqRGljdC5zZXQoIk9iaiIsIHJlZik7CiAgICAgICAgY2FjaGUucHV0KHRhZ1JlZiwgdGFnRGljdCk7CiAgICAgICAgbnVtcy5wdXNoKHBhcmVudFRyZWVJZCwgdGFnUmVmKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5leHRLZXkgKyAxOwogIH0KICBzdGF0aWMgI3dyaXRlUHJvcGVydGllcyh0YWdEaWN0LCB7CiAgICB0eXBlLAogICAgdGl0bGUsCiAgICBsYW5nLAogICAgYWx0LAogICAgZXhwYW5kZWQsCiAgICBhY3R1YWxUZXh0CiAgfSkgewogICAgdGFnRGljdC5zZXQoIlMiLCBOYW1lLmdldCh0eXBlKSk7CiAgICBpZiAodGl0bGUpIHsKICAgICAgdGFnRGljdC5zZXQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHRpdGxlKSk7CiAgICB9CiAgICBpZiAobGFuZykgewogICAgICB0YWdEaWN0LnNldCgiTGFuZyIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUobGFuZykpOwogICAgfQogICAgaWYgKGFsdCkgewogICAgICB0YWdEaWN0LnNldCgiQWx0Iiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRShhbHQpKTsKICAgIH0KICAgIGlmIChleHBhbmRlZCkgewogICAgICB0YWdEaWN0LnNldCgiRSIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUoZXhwYW5kZWQpKTsKICAgIH0KICAgIGlmIChhY3R1YWxUZXh0KSB7CiAgICAgIHRhZ0RpY3Quc2V0KCJBY3R1YWxUZXh0Iiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRShhY3R1YWxUZXh0KSk7CiAgICB9CiAgfQogIHN0YXRpYyAjY29sbGVjdFBhcmVudHMoewogICAgZWxlbWVudHMsCiAgICB4cmVmLAogICAgcGFnZURpY3QsCiAgICBudW1iZXJUcmVlCiAgfSkgewogICAgY29uc3QgaWRUb0VsZW1lbnRzID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgIGlmIChlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnRJZCkgewogICAgICAgIGNvbnN0IGlkID0gcGFyc2VJbnQoZWxlbWVudC5zdHJ1Y3RUcmVlUGFyZW50SWQuc3BsaXQoIl9tYyIpWzFdLCAxMCk7CiAgICAgICAgbGV0IGVsZW1zID0gaWRUb0VsZW1lbnRzLmdldChpZCk7CiAgICAgICAgaWYgKCFlbGVtcykgewogICAgICAgICAgZWxlbXMgPSBbXTsKICAgICAgICAgIGlkVG9FbGVtZW50cy5zZXQoaWQsIGVsZW1zKTsKICAgICAgICB9CiAgICAgICAgZWxlbXMucHVzaChlbGVtZW50KTsKICAgICAgfQogICAgfQogICAgY29uc3QgaWQgPSBwYWdlRGljdC5nZXQoIlN0cnVjdFBhcmVudHMiKTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihpZCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFyZW50QXJyYXkgPSBudW1iZXJUcmVlLmdldChpZCk7CiAgICBjb25zdCB1cGRhdGVFbGVtZW50ID0gKGtpZCwgcGFnZUtpZCwga2lkUmVmKSA9PiB7CiAgICAgIGNvbnN0IGVsZW1zID0gaWRUb0VsZW1lbnRzLmdldChraWQpOwogICAgICBpZiAoZWxlbXMpIHsKICAgICAgICBjb25zdCBwYXJlbnRSZWYgPSBwYWdlS2lkLmdldFJhdygiUCIpOwogICAgICAgIGNvbnN0IHBhcmVudERpY3QgPSB4cmVmLmZldGNoSWZSZWYocGFyZW50UmVmKTsKICAgICAgICBpZiAocGFyZW50UmVmIGluc3RhbmNlb2YgUmVmICYmIHBhcmVudERpY3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIHJlZjoga2lkUmVmLAogICAgICAgICAgICBkaWN0OiBwYWdlS2lkCiAgICAgICAgICB9OwogICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1zKSB7CiAgICAgICAgICAgIGVsZW1lbnQuc3RydWN0VHJlZVBhcmVudCA9IHBhcmFtczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKICAgIGZvciAoY29uc3Qga2lkUmVmIG9mIHBhcmVudEFycmF5KSB7CiAgICAgIGlmICghKGtpZFJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBwYWdlS2lkID0geHJlZi5mZXRjaChraWRSZWYpOwogICAgICBjb25zdCBrID0gcGFnZUtpZC5nZXQoIksiKTsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoaykpIHsKICAgICAgICB1cGRhdGVFbGVtZW50KGssIHBhZ2VLaWQsIGtpZFJlZik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGspKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQga2lkIG9mIGspIHsKICAgICAgICBraWQgPSB4cmVmLmZldGNoSWZSZWYoa2lkKTsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihraWQpICYmIHVwZGF0ZUVsZW1lbnQoa2lkLCBwYWdlS2lkLCBraWRSZWYpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKCEoa2lkIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzTmFtZShraWQuZ2V0KCJUeXBlIiksICJNQ1IiKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1jaWQgPSBraWQuZ2V0KCJNQ0lEIik7CiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIobWNpZCkgJiYgdXBkYXRlRWxlbWVudChtY2lkLCBwYWdlS2lkLCBraWRSZWYpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGFzeW5jICN1cGRhdGVQYXJlbnRUYWcoewogICAgc3RydWN0VHJlZVBhcmVudCwKICAgIHRhZ0RpY3QsCiAgICBuZXdUYWdSZWYsCiAgICBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgIGZhbGxiYWNrS2lkcywKICAgIHhyZWYsCiAgICBjYWNoZQogIH0pIHsKICAgIGxldCByZWYgPSBudWxsOwogICAgbGV0IHBhcmVudFJlZjsKICAgIGlmIChzdHJ1Y3RUcmVlUGFyZW50KSB7CiAgICAgICh7CiAgICAgICAgcmVmCiAgICAgIH0gPSBzdHJ1Y3RUcmVlUGFyZW50KTsKICAgICAgcGFyZW50UmVmID0gc3RydWN0VHJlZVBhcmVudC5kaWN0LmdldFJhdygiUCIpIHx8IHN0cnVjdFRyZWVSb290UmVmOwogICAgfSBlbHNlIHsKICAgICAgcGFyZW50UmVmID0gc3RydWN0VHJlZVJvb3RSZWY7CiAgICB9CiAgICB0YWdEaWN0LnNldCgiUCIsIHBhcmVudFJlZik7CiAgICBjb25zdCBwYXJlbnREaWN0ID0geHJlZi5mZXRjaElmUmVmKHBhcmVudFJlZik7CiAgICBpZiAoIXBhcmVudERpY3QpIHsKICAgICAgZmFsbGJhY2tLaWRzLnB1c2gobmV3VGFnUmVmKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGNhY2hlZFBhcmVudERpY3QgPSBjYWNoZS5nZXQocGFyZW50UmVmKTsKICAgIGlmICghY2FjaGVkUGFyZW50RGljdCkgewogICAgICBjYWNoZWRQYXJlbnREaWN0ID0gcGFyZW50RGljdC5jbG9uZSgpOwogICAgICBjYWNoZS5wdXQocGFyZW50UmVmLCBjYWNoZWRQYXJlbnREaWN0KTsKICAgIH0KICAgIGNvbnN0IHBhcmVudEtpZHNSYXcgPSBjYWNoZWRQYXJlbnREaWN0LmdldFJhdygiSyIpOwogICAgbGV0IGNhY2hlZFBhcmVudEtpZHMgPSBwYXJlbnRLaWRzUmF3IGluc3RhbmNlb2YgUmVmID8gY2FjaGUuZ2V0KHBhcmVudEtpZHNSYXcpIDogbnVsbDsKICAgIGlmICghY2FjaGVkUGFyZW50S2lkcykgewogICAgICBjYWNoZWRQYXJlbnRLaWRzID0geHJlZi5mZXRjaElmUmVmKHBhcmVudEtpZHNSYXcpOwogICAgICBjYWNoZWRQYXJlbnRLaWRzID0gQXJyYXkuaXNBcnJheShjYWNoZWRQYXJlbnRLaWRzKSA/IGNhY2hlZFBhcmVudEtpZHMuc2xpY2UoKSA6IFtwYXJlbnRLaWRzUmF3XTsKICAgICAgY29uc3QgcGFyZW50S2lkc1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIGNhY2hlZFBhcmVudERpY3Quc2V0KCJLIiwgcGFyZW50S2lkc1JlZik7CiAgICAgIGNhY2hlLnB1dChwYXJlbnRLaWRzUmVmLCBjYWNoZWRQYXJlbnRLaWRzKTsKICAgIH0KICAgIGNvbnN0IGluZGV4ID0gY2FjaGVkUGFyZW50S2lkcy5pbmRleE9mKHJlZik7CiAgICBjYWNoZWRQYXJlbnRLaWRzLnNwbGljZShpbmRleCA+PSAwID8gaW5kZXggKyAxIDogY2FjaGVkUGFyZW50S2lkcy5sZW5ndGgsIDAsIG5ld1RhZ1JlZik7CiAgfQp9CmNsYXNzIFN0cnVjdEVsZW1lbnROb2RlIHsKICBjb25zdHJ1Y3Rvcih0cmVlLCBkaWN0KSB7CiAgICB0aGlzLnRyZWUgPSB0cmVlOwogICAgdGhpcy54cmVmID0gdHJlZS54cmVmOwogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIHRoaXMua2lkcyA9IFtdOwogICAgdGhpcy5wYXJzZUtpZHMoKTsKICB9CiAgZ2V0IHJvbGUoKSB7CiAgICBjb25zdCBuYW1lT2JqID0gdGhpcy5kaWN0LmdldCgiUyIpOwogICAgY29uc3QgbmFtZSA9IG5hbWVPYmogaW5zdGFuY2VvZiBOYW1lID8gbmFtZU9iai5uYW1lIDogIiI7CiAgICBjb25zdCB7CiAgICAgIHJvb3QKICAgIH0gPSB0aGlzLnRyZWU7CiAgICByZXR1cm4gcm9vdC5yb2xlTWFwLmdldChuYW1lKSA/PyBuYW1lOwogIH0KICBwYXJzZUtpZHMoKSB7CiAgICBsZXQgcGFnZU9iaklkID0gbnVsbDsKICAgIGNvbnN0IG9ialJlZiA9IHRoaXMuZGljdC5nZXRSYXcoIlBnIik7CiAgICBpZiAob2JqUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHBhZ2VPYmpJZCA9IG9ialJlZi50b1N0cmluZygpOwogICAgfQogICAgY29uc3Qga2lkcyA9IHRoaXMuZGljdC5nZXQoIksiKTsKICAgIGlmIChBcnJheS5pc0FycmF5KGtpZHMpKSB7CiAgICAgIGZvciAoY29uc3Qga2lkIG9mIGtpZHMpIHsKICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5wYXJzZUtpZChwYWdlT2JqSWQsIHRoaXMueHJlZi5mZXRjaElmUmVmKGtpZCkpOwogICAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgICB0aGlzLmtpZHMucHVzaChlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLnBhcnNlS2lkKHBhZ2VPYmpJZCwga2lkcyk7CiAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgdGhpcy5raWRzLnB1c2goZWxlbWVudCk7CiAgICAgIH0KICAgIH0KICB9CiAgcGFyc2VLaWQocGFnZU9iaklkLCBraWQpIHsKICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGtpZCkpIHsKICAgICAgaWYgKHRoaXMudHJlZS5wYWdlRGljdC5vYmpJZCAhPT0gcGFnZU9iaklkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBTdHJ1Y3RFbGVtZW50KHsKICAgICAgICB0eXBlOiBTdHJ1Y3RFbGVtZW50VHlwZS5QQUdFX0NPTlRFTlQsCiAgICAgICAgbWNpZDoga2lkLAogICAgICAgIHBhZ2VPYmpJZAogICAgICB9KTsKICAgIH0KICAgIGlmICghKGtpZCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgcGFnZVJlZiA9IGtpZC5nZXRSYXcoIlBnIik7CiAgICBpZiAocGFnZVJlZiBpbnN0YW5jZW9mIFJlZikgewogICAgICBwYWdlT2JqSWQgPSBwYWdlUmVmLnRvU3RyaW5nKCk7CiAgICB9CiAgICBjb25zdCB0eXBlID0ga2lkLmdldCgiVHlwZSIpIGluc3RhbmNlb2YgTmFtZSA/IGtpZC5nZXQoIlR5cGUiKS5uYW1lIDogbnVsbDsKICAgIGlmICh0eXBlID09PSAiTUNSIikgewogICAgICBpZiAodGhpcy50cmVlLnBhZ2VEaWN0Lm9iaklkICE9PSBwYWdlT2JqSWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBraWRSZWYgPSBraWQuZ2V0UmF3KCJTdG0iKTsKICAgICAgcmV0dXJuIG5ldyBTdHJ1Y3RFbGVtZW50KHsKICAgICAgICB0eXBlOiBTdHJ1Y3RFbGVtZW50VHlwZS5TVFJFQU1fQ09OVEVOVCwKICAgICAgICByZWZPYmpJZDoga2lkUmVmIGluc3RhbmNlb2YgUmVmID8ga2lkUmVmLnRvU3RyaW5nKCkgOiBudWxsLAogICAgICAgIHBhZ2VPYmpJZCwKICAgICAgICBtY2lkOiBraWQuZ2V0KCJNQ0lEIikKICAgICAgfSk7CiAgICB9CiAgICBpZiAodHlwZSA9PT0gIk9CSlIiKSB7CiAgICAgIGlmICh0aGlzLnRyZWUucGFnZURpY3Qub2JqSWQgIT09IHBhZ2VPYmpJZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGtpZFJlZiA9IGtpZC5nZXRSYXcoIk9iaiIpOwogICAgICByZXR1cm4gbmV3IFN0cnVjdEVsZW1lbnQoewogICAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLk9CSkVDVCwKICAgICAgICByZWZPYmpJZDoga2lkUmVmIGluc3RhbmNlb2YgUmVmID8ga2lkUmVmLnRvU3RyaW5nKCkgOiBudWxsLAogICAgICAgIHBhZ2VPYmpJZAogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBuZXcgU3RydWN0RWxlbWVudCh7CiAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLkVMRU1FTlQsCiAgICAgIGRpY3Q6IGtpZAogICAgfSk7CiAgfQp9CmNsYXNzIFN0cnVjdEVsZW1lbnQgewogIGNvbnN0cnVjdG9yKHsKICAgIHR5cGUsCiAgICBkaWN0ID0gbnVsbCwKICAgIG1jaWQgPSBudWxsLAogICAgcGFnZU9iaklkID0gbnVsbCwKICAgIHJlZk9iaklkID0gbnVsbAogIH0pIHsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogICAgdGhpcy5tY2lkID0gbWNpZDsKICAgIHRoaXMucGFnZU9iaklkID0gcGFnZU9iaklkOwogICAgdGhpcy5yZWZPYmpJZCA9IHJlZk9iaklkOwogICAgdGhpcy5wYXJlbnROb2RlID0gbnVsbDsKICB9Cn0KY2xhc3MgU3RydWN0VHJlZVBhZ2UgewogIGNvbnN0cnVjdG9yKHN0cnVjdFRyZWVSb290LCBwYWdlRGljdCkgewogICAgdGhpcy5yb290ID0gc3RydWN0VHJlZVJvb3Q7CiAgICB0aGlzLnhyZWYgPSBzdHJ1Y3RUcmVlUm9vdD8ueHJlZiA/PyBudWxsOwogICAgdGhpcy5yb290RGljdCA9IHN0cnVjdFRyZWVSb290Py5kaWN0ID8/IG51bGw7CiAgICB0aGlzLnBhZ2VEaWN0ID0gcGFnZURpY3Q7CiAgICB0aGlzLm5vZGVzID0gW107CiAgfQogIGNvbGxlY3RPYmplY3RzKHBhZ2VSZWYpIHsKICAgIGlmICghdGhpcy5yb290IHx8ICF0aGlzLnJvb3REaWN0IHx8ICEocGFnZVJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBwYXJlbnRUcmVlID0gdGhpcy5yb290RGljdC5nZXQoIlBhcmVudFRyZWUiKTsKICAgIGlmICghcGFyZW50VHJlZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGlkcyA9IHRoaXMucm9vdC5zdHJ1Y3RQYXJlbnRJZHM/LmdldChwYWdlUmVmKTsKICAgIGlmICghaWRzKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgY29uc3QgbnVtYmVyVHJlZSA9IG5ldyBOdW1iZXJUcmVlKHBhcmVudFRyZWUsIHRoaXMueHJlZik7CiAgICBmb3IgKGNvbnN0IFtlbGVtSWRdIG9mIGlkcykgewogICAgICBjb25zdCBvYmogPSBudW1iZXJUcmVlLmdldFJhdyhlbGVtSWQpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgbWFwLnNldChlbGVtSWQsIG9iaik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXA7CiAgfQogIHBhcnNlKHBhZ2VSZWYpIHsKICAgIGlmICghdGhpcy5yb290IHx8ICF0aGlzLnJvb3REaWN0IHx8ICEocGFnZVJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFyZW50VHJlZSA9IHRoaXMucm9vdERpY3QuZ2V0KCJQYXJlbnRUcmVlIik7CiAgICBpZiAoIXBhcmVudFRyZWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgaWQgPSB0aGlzLnBhZ2VEaWN0LmdldCgiU3RydWN0UGFyZW50cyIpOwogICAgY29uc3QgaWRzID0gdGhpcy5yb290LnN0cnVjdFBhcmVudElkcz8uZ2V0KHBhZ2VSZWYpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGlkKSAmJiAhaWRzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgIGNvbnN0IG51bWJlclRyZWUgPSBuZXcgTnVtYmVyVHJlZShwYXJlbnRUcmVlLCB0aGlzLnhyZWYpOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIoaWQpKSB7CiAgICAgIGNvbnN0IHBhcmVudEFycmF5ID0gbnVtYmVyVHJlZS5nZXQoaWQpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXJlbnRBcnJheSkpIHsKICAgICAgICBmb3IgKGNvbnN0IHJlZiBvZiBwYXJlbnRBcnJheSkgewogICAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICB0aGlzLmFkZE5vZGUodGhpcy54cmVmLmZldGNoKHJlZiksIG1hcCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIWlkcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IFtlbGVtSWQsIHR5cGVdIG9mIGlkcykgewogICAgICBjb25zdCBvYmogPSBudW1iZXJUcmVlLmdldChlbGVtSWQpOwogICAgICBpZiAob2JqKSB7CiAgICAgICAgY29uc3QgZWxlbSA9IHRoaXMuYWRkTm9kZSh0aGlzLnhyZWYuZmV0Y2hJZlJlZihvYmopLCBtYXApOwogICAgICAgIGlmIChlbGVtPy5raWRzPy5sZW5ndGggPT09IDEgJiYgZWxlbS5raWRzWzBdLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLk9CSkVDVCkgewogICAgICAgICAgZWxlbS5raWRzWzBdLnR5cGUgPSB0eXBlOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBhZGROb2RlKGRpY3QsIG1hcCwgbGV2ZWwgPSAwKSB7CiAgICBpZiAobGV2ZWwgPiBNQVhfREVQVEgpIHsKICAgICAgd2FybigiU3RydWN0VHJlZSBNQVhfREVQVEggcmVhY2hlZC4iKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAoIShkaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAobWFwLmhhcyhkaWN0KSkgewogICAgICByZXR1cm4gbWFwLmdldChkaWN0KTsKICAgIH0KICAgIGNvbnN0IGVsZW1lbnQgPSBuZXcgU3RydWN0RWxlbWVudE5vZGUodGhpcywgZGljdCk7CiAgICBtYXAuc2V0KGRpY3QsIGVsZW1lbnQpOwogICAgY29uc3QgcGFyZW50ID0gZGljdC5nZXQoIlAiKTsKICAgIGlmICghKHBhcmVudCBpbnN0YW5jZW9mIERpY3QpIHx8IGlzTmFtZShwYXJlbnQuZ2V0KCJUeXBlIiksICJTdHJ1Y3RUcmVlUm9vdCIpKSB7CiAgICAgIGlmICghdGhpcy5hZGRUb3BMZXZlbE5vZGUoZGljdCwgZWxlbWVudCkpIHsKICAgICAgICBtYXAuZGVsZXRlKGRpY3QpOwogICAgICB9CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQogICAgY29uc3QgcGFyZW50Tm9kZSA9IHRoaXMuYWRkTm9kZShwYXJlbnQsIG1hcCwgbGV2ZWwgKyAxKTsKICAgIGlmICghcGFyZW50Tm9kZSkgewogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KICAgIGxldCBzYXZlID0gZmFsc2U7CiAgICBmb3IgKGNvbnN0IGtpZCBvZiBwYXJlbnROb2RlLmtpZHMpIHsKICAgICAgaWYgKGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5FTEVNRU5UICYmIGtpZC5kaWN0ID09PSBkaWN0KSB7CiAgICAgICAga2lkLnBhcmVudE5vZGUgPSBlbGVtZW50OwogICAgICAgIHNhdmUgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICBpZiAoIXNhdmUpIHsKICAgICAgbWFwLmRlbGV0ZShkaWN0KTsKICAgIH0KICAgIHJldHVybiBlbGVtZW50OwogIH0KICBhZGRUb3BMZXZlbE5vZGUoZGljdCwgZWxlbWVudCkgewogICAgY29uc3Qgb2JqID0gdGhpcy5yb290RGljdC5nZXQoIksiKTsKICAgIGlmICghb2JqKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGlmIChvYmoub2JqSWQgIT09IGRpY3Qub2JqSWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdGhpcy5ub2Rlc1swXSA9IGVsZW1lbnQ7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKCFBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBsZXQgc2F2ZSA9IGZhbHNlOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3Qga2lkUmVmID0gb2JqW2ldOwogICAgICBpZiAoa2lkUmVmPy50b1N0cmluZygpID09PSBkaWN0Lm9iaklkKSB7CiAgICAgICAgdGhpcy5ub2Rlc1tpXSA9IGVsZW1lbnQ7CiAgICAgICAgc2F2ZSA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzYXZlOwogIH0KICBnZXQgc2VyaWFsaXphYmxlKCkgewogICAgZnVuY3Rpb24gbm9kZVRvU2VyaWFsaXphYmxlKG5vZGUsIHBhcmVudCwgbGV2ZWwgPSAwKSB7CiAgICAgIGlmIChsZXZlbCA+IE1BWF9ERVBUSCkgewogICAgICAgIHdhcm4oIlN0cnVjdFRyZWUgdG9vIGRlZXAgdG8gYmUgZnVsbHkgc2VyaWFsaXplZC4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgb2JqID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgb2JqLnJvbGUgPSBub2RlLnJvbGU7CiAgICAgIG9iai5jaGlsZHJlbiA9IFtdOwogICAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChvYmopOwogICAgICBsZXQgYWx0ID0gbm9kZS5kaWN0LmdldCgiQWx0Iik7CiAgICAgIGlmICh0eXBlb2YgYWx0ICE9PSAic3RyaW5nIikgewogICAgICAgIGFsdCA9IG5vZGUuZGljdC5nZXQoIkFjdHVhbFRleHQiKTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGFsdCA9PT0gInN0cmluZyIpIHsKICAgICAgICBvYmouYWx0ID0gc3RyaW5nVG9QREZTdHJpbmcoYWx0KTsKICAgICAgfQogICAgICBjb25zdCBhID0gbm9kZS5kaWN0LmdldCgiQSIpOwogICAgICBpZiAoYSBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBjb25zdCBiYm94ID0gbG9va3VwTm9ybWFsUmVjdChhLmdldEFycmF5KCJCQm94IiksIG51bGwpOwogICAgICAgIGlmIChiYm94KSB7CiAgICAgICAgICBvYmouYmJveCA9IGJib3g7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gYS5nZXQoIldpZHRoIik7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBhLmdldCgiSGVpZ2h0Iik7CiAgICAgICAgICBpZiAodHlwZW9mIHdpZHRoID09PSAibnVtYmVyIiAmJiB3aWR0aCA+IDAgJiYgdHlwZW9mIGhlaWdodCA9PT0gIm51bWJlciIgJiYgaGVpZ2h0ID4gMCkgewogICAgICAgICAgICBvYmouYmJveCA9IFswLCAwLCB3aWR0aCwgaGVpZ2h0XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgbGFuZyA9IG5vZGUuZGljdC5nZXQoIkxhbmciKTsKICAgICAgaWYgKHR5cGVvZiBsYW5nID09PSAic3RyaW5nIikgewogICAgICAgIG9iai5sYW5nID0gc3RyaW5nVG9QREZTdHJpbmcobGFuZyk7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBraWQgb2Ygbm9kZS5raWRzKSB7CiAgICAgICAgY29uc3Qga2lkRWxlbWVudCA9IGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5FTEVNRU5UID8ga2lkLnBhcmVudE5vZGUgOiBudWxsOwogICAgICAgIGlmIChraWRFbGVtZW50KSB7CiAgICAgICAgICBub2RlVG9TZXJpYWxpemFibGUoa2lkRWxlbWVudCwgb2JqLCBsZXZlbCArIDEpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSBlbHNlIGlmIChraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuUEFHRV9DT05URU5UIHx8IGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5TVFJFQU1fQ09OVEVOVCkgewogICAgICAgICAgb2JqLmNoaWxkcmVuLnB1c2goewogICAgICAgICAgICB0eXBlOiAiY29udGVudCIsCiAgICAgICAgICAgIGlkOiBgcCR7a2lkLnBhZ2VPYmpJZH1fbWMke2tpZC5tY2lkfWAKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoa2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLk9CSkVDVCkgewogICAgICAgICAgb2JqLmNoaWxkcmVuLnB1c2goewogICAgICAgICAgICB0eXBlOiAib2JqZWN0IiwKICAgICAgICAgICAgaWQ6IGtpZC5yZWZPYmpJZAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuQU5OT1RBVElPTikgewogICAgICAgICAgb2JqLmNoaWxkcmVuLnB1c2goewogICAgICAgICAgICB0eXBlOiAiYW5ub3RhdGlvbiIsCiAgICAgICAgICAgIGlkOiBgJHtBbm5vdGF0aW9uUHJlZml4fSR7a2lkLnJlZk9iaklkfWAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3Qgcm9vdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICByb290LmNoaWxkcmVuID0gW107CiAgICByb290LnJvbGUgPSAiUm9vdCI7CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMubm9kZXMpIHsKICAgICAgaWYgKCFjaGlsZCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIG5vZGVUb1NlcmlhbGl6YWJsZShjaGlsZCwgcm9vdCk7CiAgICB9CiAgICByZXR1cm4gcm9vdDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NhdGFsb2cuanMKCgoKCgoKCgoKCgpjb25zdCBpc1JlZiA9IHYgPT4gdiBpbnN0YW5jZW9mIFJlZjsKY29uc3QgaXNWYWxpZEV4cGxpY2l0RGVzdCA9IF9pc1ZhbGlkRXhwbGljaXREZXN0LmJpbmQobnVsbCwgaXNSZWYsIGlzTmFtZSk7CmZ1bmN0aW9uIGZldGNoRGVzdChkZXN0KSB7CiAgaWYgKGRlc3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICBkZXN0ID0gZGVzdC5nZXQoIkQiKTsKICB9CiAgcmV0dXJuIGlzVmFsaWRFeHBsaWNpdERlc3QoZGVzdCkgPyBkZXN0IDogbnVsbDsKfQpmdW5jdGlvbiBmZXRjaFJlbW90ZURlc3QoYWN0aW9uKSB7CiAgbGV0IGRlc3QgPSBhY3Rpb24uZ2V0KCJEIik7CiAgaWYgKGRlc3QpIHsKICAgIGlmIChkZXN0IGluc3RhbmNlb2YgTmFtZSkgewogICAgICBkZXN0ID0gZGVzdC5uYW1lOwogICAgfQogICAgaWYgKHR5cGVvZiBkZXN0ID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gc3RyaW5nVG9QREZTdHJpbmcoZGVzdCwgdHJ1ZSk7CiAgICB9IGVsc2UgaWYgKGlzVmFsaWRFeHBsaWNpdERlc3QoZGVzdCkpIHsKICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRlc3QpOwogICAgfQogIH0KICByZXR1cm4gbnVsbDsKfQpjbGFzcyBDYXRhbG9nIHsKICAjYWN0dWFsTnVtUGFnZXMgPSBudWxsOwogICNjYXREaWN0ID0gbnVsbDsKICBidWlsdEluQ01hcENhY2hlID0gbmV3IE1hcCgpOwogIGZvbnRDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIGdsb2JhbENvbG9yU3BhY2VDYWNoZSA9IG5ldyBHbG9iYWxDb2xvclNwYWNlQ2FjaGUoKTsKICBnbG9iYWxJbWFnZUNhY2hlID0gbmV3IEdsb2JhbEltYWdlQ2FjaGUoKTsKICBub25CbGVuZE1vZGVzU2V0ID0gbmV3IFJlZlNldCgpOwogIHBhZ2VEaWN0Q2FjaGUgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICBwYWdlSW5kZXhDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIHBhZ2VLaWRzQ291bnRDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIHN0YW5kYXJkRm9udERhdGFDYWNoZSA9IG5ldyBNYXAoKTsKICBzeXN0ZW1Gb250Q2FjaGUgPSBuZXcgTWFwKCk7CiAgY29uc3RydWN0b3IocGRmTWFuYWdlciwgeHJlZikgewogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLiNjYXREaWN0ID0geHJlZi5nZXRDYXRhbG9nT2JqKCk7CiAgICBpZiAoISh0aGlzLiNjYXREaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJDYXRhbG9nIG9iamVjdCBpcyBub3QgYSBkaWN0aW9uYXJ5LiIpOwogICAgfQogICAgdGhpcy50b3BsZXZlbFBhZ2VzRGljdDsKICB9CiAgY2xvbmVEaWN0KCkgewogICAgcmV0dXJuIHRoaXMuI2NhdERpY3QuY2xvbmUoKTsKICB9CiAgZ2V0IHZlcnNpb24oKSB7CiAgICBjb25zdCB2ZXJzaW9uID0gdGhpcy4jY2F0RGljdC5nZXQoIlZlcnNpb24iKTsKICAgIGlmICh2ZXJzaW9uIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBpZiAoUERGX1ZFUlNJT05fUkVHRVhQLnRlc3QodmVyc2lvbi5uYW1lKSkgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInZlcnNpb24iLCB2ZXJzaW9uLm5hbWUpOwogICAgICB9CiAgICAgIHdhcm4oYEludmFsaWQgUERGIGNhdGFsb2cgdmVyc2lvbjogJHt2ZXJzaW9uLm5hbWV9YCk7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ2ZXJzaW9uIiwgbnVsbCk7CiAgfQogIGdldCBsYW5nKCkgewogICAgY29uc3QgbGFuZyA9IHRoaXMuI2NhdERpY3QuZ2V0KCJMYW5nIik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJsYW5nIiwgbGFuZyAmJiB0eXBlb2YgbGFuZyA9PT0gInN0cmluZyIgPyBzdHJpbmdUb1BERlN0cmluZyhsYW5nKSA6IG51bGwpOwogIH0KICBnZXQgbmVlZHNSZW5kZXJpbmcoKSB7CiAgICBjb25zdCBuZWVkc1JlbmRlcmluZyA9IHRoaXMuI2NhdERpY3QuZ2V0KCJOZWVkc1JlbmRlcmluZyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibmVlZHNSZW5kZXJpbmciLCB0eXBlb2YgbmVlZHNSZW5kZXJpbmcgPT09ICJib29sZWFuIiA/IG5lZWRzUmVuZGVyaW5nIDogZmFsc2UpOwogIH0KICBnZXQgY29sbGVjdGlvbigpIHsKICAgIGxldCBjb2xsZWN0aW9uID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJDb2xsZWN0aW9uIik7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0ICYmIG9iai5zaXplID4gMCkgewogICAgICAgIGNvbGxlY3Rpb24gPSBvYmo7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgaW5mbygiQ2Fubm90IGZldGNoIENvbGxlY3Rpb24gZW50cnk7IGFzc3VtaW5nIG5vIGNvbGxlY3Rpb24gaXMgcHJlc2VudC4iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImNvbGxlY3Rpb24iLCBjb2xsZWN0aW9uKTsKICB9CiAgZ2V0IGFjcm9Gb3JtKCkgewogICAgbGV0IGFjcm9Gb3JtID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJBY3JvRm9ybSIpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCAmJiBvYmouc2l6ZSA+IDApIHsKICAgICAgICBhY3JvRm9ybSA9IG9iajsKICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICBpbmZvKCJDYW5ub3QgZmV0Y2ggQWNyb0Zvcm0gZW50cnk7IGFzc3VtaW5nIG5vIGZvcm1zIGFyZSBwcmVzZW50LiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYWNyb0Zvcm0iLCBhY3JvRm9ybSk7CiAgfQogIGdldCBhY3JvRm9ybVJlZigpIHsKICAgIGNvbnN0IHZhbHVlID0gdGhpcy4jY2F0RGljdC5nZXRSYXcoIkFjcm9Gb3JtIik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJhY3JvRm9ybVJlZiIsIHZhbHVlIGluc3RhbmNlb2YgUmVmID8gdmFsdWUgOiBudWxsKTsKICB9CiAgZ2V0IG1ldGFkYXRhKCkgewogICAgY29uc3Qgc3RyZWFtUmVmID0gdGhpcy4jY2F0RGljdC5nZXRSYXcoIk1ldGFkYXRhIik7CiAgICBpZiAoIShzdHJlYW1SZWYgaW5zdGFuY2VvZiBSZWYpKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgIm1ldGFkYXRhIiwgbnVsbCk7CiAgICB9CiAgICBsZXQgbWV0YWRhdGEgPSBudWxsOwogICAgdHJ5IHsKICAgICAgY29uc3Qgc3RyZWFtID0gdGhpcy54cmVmLmZldGNoKHN0cmVhbVJlZiwgIXRoaXMueHJlZi5lbmNyeXB0Py5lbmNyeXB0TWV0YWRhdGEpOwogICAgICBpZiAoc3RyZWFtIGluc3RhbmNlb2YgQmFzZVN0cmVhbSAmJiBzdHJlYW0uZGljdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBjb25zdCB0eXBlID0gc3RyZWFtLmRpY3QuZ2V0KCJUeXBlIik7CiAgICAgICAgY29uc3Qgc3VidHlwZSA9IHN0cmVhbS5kaWN0LmdldCgiU3VidHlwZSIpOwogICAgICAgIGlmIChpc05hbWUodHlwZSwgIk1ldGFkYXRhIikgJiYgaXNOYW1lKHN1YnR5cGUsICJYTUwiKSkgewogICAgICAgICAgY29uc3QgZGF0YSA9IHN0cmluZ1RvVVRGOFN0cmluZyhzdHJlYW0uZ2V0U3RyaW5nKCkpOwogICAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgbWV0YWRhdGEgPSBuZXcgTWV0YWRhdGFQYXJzZXIoZGF0YSkuc2VyaWFsaXphYmxlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICBpbmZvKGBTa2lwcGluZyBpbnZhbGlkIE1ldGFkYXRhOiAiJHtleH0iLmApOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibWV0YWRhdGEiLCBtZXRhZGF0YSk7CiAgfQogIGdldCBtYXJrSW5mbygpIHsKICAgIGxldCBtYXJrSW5mbyA9IG51bGw7CiAgICB0cnkgewogICAgICBtYXJrSW5mbyA9IHRoaXMuI3JlYWRNYXJrSW5mbygpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKCJVbmFibGUgdG8gcmVhZCBtYXJrIGluZm8uIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJtYXJrSW5mbyIsIG1hcmtJbmZvKTsKICB9CiAgI3JlYWRNYXJrSW5mbygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJNYXJrSW5mbyIpOwogICAgaWYgKCEob2JqIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBtYXJrSW5mbyA9IHsKICAgICAgTWFya2VkOiBmYWxzZSwKICAgICAgVXNlclByb3BlcnRpZXM6IGZhbHNlLAogICAgICBTdXNwZWN0czogZmFsc2UKICAgIH07CiAgICBmb3IgKGNvbnN0IGtleSBpbiBtYXJrSW5mbykgewogICAgICBjb25zdCB2YWx1ZSA9IG9iai5nZXQoa2V5KTsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgbWFya0luZm9ba2V5XSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWFya0luZm87CiAgfQogIGdldCBzdHJ1Y3RUcmVlUm9vdCgpIHsKICAgIGxldCBzdHJ1Y3RUcmVlID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIHN0cnVjdFRyZWUgPSB0aGlzLiNyZWFkU3RydWN0VHJlZVJvb3QoKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybigiVW5hYmxlIHJlYWQgdG8gc3RydWN0VHJlZVJvb3QgaW5mby4iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInN0cnVjdFRyZWVSb290Iiwgc3RydWN0VHJlZSk7CiAgfQogICNyZWFkU3RydWN0VHJlZVJvb3QoKSB7CiAgICBjb25zdCByYXdPYmogPSB0aGlzLiNjYXREaWN0LmdldFJhdygiU3RydWN0VHJlZVJvb3QiKTsKICAgIGNvbnN0IG9iaiA9IHRoaXMueHJlZi5mZXRjaElmUmVmKHJhd09iaik7CiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHJvb3QgPSBuZXcgU3RydWN0VHJlZVJvb3QodGhpcy54cmVmLCBvYmosIHJhd09iaik7CiAgICByb290LmluaXQoKTsKICAgIHJldHVybiByb290OwogIH0KICBnZXQgdG9wbGV2ZWxQYWdlc0RpY3QoKSB7CiAgICBjb25zdCBwYWdlc09iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJQYWdlcyIpOwogICAgaWYgKCEocGFnZXNPYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgdG9wLWxldmVsIHBhZ2VzIGRpY3Rpb25hcnkuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ0b3BsZXZlbFBhZ2VzRGljdCIsIHBhZ2VzT2JqKTsKICB9CiAgZ2V0IGRvY3VtZW50T3V0bGluZSgpIHsKICAgIGxldCBvYmogPSBudWxsOwogICAgdHJ5IHsKICAgICAgb2JqID0gdGhpcy4jcmVhZERvY3VtZW50T3V0bGluZSgpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKCJVbmFibGUgdG8gcmVhZCBkb2N1bWVudCBvdXRsaW5lLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZG9jdW1lbnRPdXRsaW5lIiwgb2JqKTsKICB9CiAgI3JlYWREb2N1bWVudE91dGxpbmUoKSB7CiAgICBsZXQgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk91dGxpbmVzIik7CiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIG9iaiA9IG9iai5nZXRSYXcoIkZpcnN0Iik7CiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBSZWYpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgcm9vdCA9IHsKICAgICAgaXRlbXM6IFtdCiAgICB9OwogICAgY29uc3QgcXVldWUgPSBbewogICAgICBvYmosCiAgICAgIHBhcmVudDogcm9vdAogICAgfV07CiAgICBjb25zdCBwcm9jZXNzZWQgPSBuZXcgUmVmU2V0KCk7CiAgICBwcm9jZXNzZWQucHV0KG9iaik7CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmLAogICAgICBibGFja0NvbG9yID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgaSA9IHF1ZXVlLnNoaWZ0KCk7CiAgICAgIGNvbnN0IG91dGxpbmVEaWN0ID0geHJlZi5mZXRjaElmUmVmKGkub2JqKTsKICAgICAgaWYgKG91dGxpbmVEaWN0ID09PSBudWxsKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFvdXRsaW5lRGljdC5oYXMoIlRpdGxlIikpIHsKICAgICAgICB3YXJuKCJJbnZhbGlkIG91dGxpbmUgaXRlbSBlbmNvdW50ZXJlZC4iKTsKICAgICAgfQogICAgICBjb25zdCBkYXRhID0gewogICAgICAgIHVybDogbnVsbCwKICAgICAgICBkZXN0OiBudWxsLAogICAgICAgIGFjdGlvbjogbnVsbAogICAgICB9OwogICAgICBDYXRhbG9nLnBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgICAgIGRlc3REaWN0OiBvdXRsaW5lRGljdCwKICAgICAgICByZXN1bHRPYmo6IGRhdGEsCiAgICAgICAgZG9jQmFzZVVybDogdGhpcy5iYXNlVXJsLAogICAgICAgIGRvY0F0dGFjaG1lbnRzOiB0aGlzLmF0dGFjaG1lbnRzCiAgICAgIH0pOwogICAgICBjb25zdCB0aXRsZSA9IG91dGxpbmVEaWN0LmdldCgiVGl0bGUiKTsKICAgICAgY29uc3QgZmxhZ3MgPSBvdXRsaW5lRGljdC5nZXQoIkYiKSB8fCAwOwogICAgICBjb25zdCBjb2xvciA9IG91dGxpbmVEaWN0LmdldEFycmF5KCJDIik7CiAgICAgIGNvbnN0IGNvdW50ID0gb3V0bGluZURpY3QuZ2V0KCJDb3VudCIpOwogICAgICBsZXQgcmdiQ29sb3IgPSBibGFja0NvbG9yOwogICAgICBpZiAoaXNOdW1iZXJBcnJheShjb2xvciwgMykgJiYgKGNvbG9yWzBdICE9PSAwIHx8IGNvbG9yWzFdICE9PSAwIHx8IGNvbG9yWzJdICE9PSAwKSkgewogICAgICAgIHJnYkNvbG9yID0gQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2IoY29sb3IsIDApOwogICAgICB9CiAgICAgIGNvbnN0IG91dGxpbmVJdGVtID0gewogICAgICAgIGFjdGlvbjogZGF0YS5hY3Rpb24sCiAgICAgICAgYXR0YWNobWVudDogZGF0YS5hdHRhY2htZW50LAogICAgICAgIGRlc3Q6IGRhdGEuZGVzdCwKICAgICAgICB1cmw6IGRhdGEudXJsLAogICAgICAgIHVuc2FmZVVybDogZGF0YS51bnNhZmVVcmwsCiAgICAgICAgbmV3V2luZG93OiBkYXRhLm5ld1dpbmRvdywKICAgICAgICBzZXRPQ0dTdGF0ZTogZGF0YS5zZXRPQ0dTdGF0ZSwKICAgICAgICB0aXRsZTogdHlwZW9mIHRpdGxlID09PSAic3RyaW5nIiA/IHN0cmluZ1RvUERGU3RyaW5nKHRpdGxlKSA6ICIiLAogICAgICAgIGNvbG9yOiByZ2JDb2xvciwKICAgICAgICBjb3VudDogTnVtYmVyLmlzSW50ZWdlcihjb3VudCkgPyBjb3VudCA6IHVuZGVmaW5lZCwKICAgICAgICBib2xkOiAhIShmbGFncyAmIDIpLAogICAgICAgIGl0YWxpYzogISEoZmxhZ3MgJiAxKSwKICAgICAgICBpdGVtczogW10KICAgICAgfTsKICAgICAgaS5wYXJlbnQuaXRlbXMucHVzaChvdXRsaW5lSXRlbSk7CiAgICAgIG9iaiA9IG91dGxpbmVEaWN0LmdldFJhdygiRmlyc3QiKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZiAmJiAhcHJvY2Vzc2VkLmhhcyhvYmopKSB7CiAgICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgICBvYmosCiAgICAgICAgICBwYXJlbnQ6IG91dGxpbmVJdGVtCiAgICAgICAgfSk7CiAgICAgICAgcHJvY2Vzc2VkLnB1dChvYmopOwogICAgICB9CiAgICAgIG9iaiA9IG91dGxpbmVEaWN0LmdldFJhdygiTmV4dCIpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmICYmICFwcm9jZXNzZWQuaGFzKG9iaikpIHsKICAgICAgICBxdWV1ZS5wdXNoKHsKICAgICAgICAgIG9iaiwKICAgICAgICAgIHBhcmVudDogaS5wYXJlbnQKICAgICAgICB9KTsKICAgICAgICBwcm9jZXNzZWQucHV0KG9iaik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByb290Lml0ZW1zLmxlbmd0aCA+IDAgPyByb290Lml0ZW1zIDogbnVsbDsKICB9CiAgZ2V0IHBlcm1pc3Npb25zKCkgewogICAgbGV0IHBlcm1pc3Npb25zID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIHBlcm1pc3Npb25zID0gdGhpcy4jcmVhZFBlcm1pc3Npb25zKCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oIlVuYWJsZSB0byByZWFkIHBlcm1pc3Npb25zLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicGVybWlzc2lvbnMiLCBwZXJtaXNzaW9ucyk7CiAgfQogICNyZWFkUGVybWlzc2lvbnMoKSB7CiAgICBjb25zdCBlbmNyeXB0ID0gdGhpcy54cmVmLnRyYWlsZXIuZ2V0KCJFbmNyeXB0Iik7CiAgICBpZiAoIShlbmNyeXB0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgZmxhZ3MgPSBlbmNyeXB0LmdldCgiUCIpOwogICAgaWYgKHR5cGVvZiBmbGFncyAhPT0gIm51bWJlciIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmbGFncyArPSAyICoqIDMyOwogICAgY29uc3QgcGVybWlzc2lvbnMgPSBbXTsKICAgIGZvciAoY29uc3Qga2V5IGluIFBlcm1pc3Npb25GbGFnKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gUGVybWlzc2lvbkZsYWdba2V5XTsKICAgICAgaWYgKGZsYWdzICYgdmFsdWUpIHsKICAgICAgICBwZXJtaXNzaW9ucy5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBlcm1pc3Npb25zOwogIH0KICBnZXQgb3B0aW9uYWxDb250ZW50Q29uZmlnKCkgewogICAgbGV0IGNvbmZpZyA9IG51bGw7CiAgICB0cnkgewogICAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy4jY2F0RGljdC5nZXQoIk9DUHJvcGVydGllcyIpOwogICAgICBpZiAoIXByb3BlcnRpZXMpIHsKICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJvcHRpb25hbENvbnRlbnRDb25maWciLCBudWxsKTsKICAgICAgfQogICAgICBjb25zdCBkZWZhdWx0Q29uZmlnID0gcHJvcGVydGllcy5nZXQoIkQiKTsKICAgICAgaWYgKCFkZWZhdWx0Q29uZmlnKSB7CiAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgbnVsbCk7CiAgICAgIH0KICAgICAgY29uc3QgZ3JvdXBzRGF0YSA9IHByb3BlcnRpZXMuZ2V0KCJPQ0dzIik7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShncm91cHNEYXRhKSkgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgIm9wdGlvbmFsQ29udGVudENvbmZpZyIsIG51bGwpOwogICAgICB9CiAgICAgIGNvbnN0IGdyb3VwUmVmQ2FjaGUgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICAgICAgZm9yIChjb25zdCBncm91cFJlZiBvZiBncm91cHNEYXRhKSB7CiAgICAgICAgaWYgKCEoZ3JvdXBSZWYgaW5zdGFuY2VvZiBSZWYpIHx8IGdyb3VwUmVmQ2FjaGUuaGFzKGdyb3VwUmVmKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGdyb3VwUmVmQ2FjaGUucHV0KGdyb3VwUmVmLCB0aGlzLiNyZWFkT3B0aW9uYWxDb250ZW50R3JvdXAoZ3JvdXBSZWYpKTsKICAgICAgfQogICAgICBjb25maWcgPSB0aGlzLiNyZWFkT3B0aW9uYWxDb250ZW50Q29uZmlnKGRlZmF1bHRDb25maWcsIGdyb3VwUmVmQ2FjaGUpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGBVbmFibGUgdG8gcmVhZCBvcHRpb25hbCBjb250ZW50IGNvbmZpZzogJHtleH1gKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgIm9wdGlvbmFsQ29udGVudENvbmZpZyIsIGNvbmZpZyk7CiAgfQogICNyZWFkT3B0aW9uYWxDb250ZW50R3JvdXAoZ3JvdXBSZWYpIHsKICAgIGNvbnN0IGdyb3VwID0gdGhpcy54cmVmLmZldGNoKGdyb3VwUmVmKTsKICAgIGNvbnN0IG9iaiA9IHsKICAgICAgaWQ6IGdyb3VwUmVmLnRvU3RyaW5nKCksCiAgICAgIG5hbWU6IG51bGwsCiAgICAgIGludGVudDogbnVsbCwKICAgICAgdXNhZ2U6IHsKICAgICAgICBwcmludDogbnVsbCwKICAgICAgICB2aWV3OiBudWxsCiAgICAgIH0sCiAgICAgIHJiR3JvdXBzOiBbXQogICAgfTsKICAgIGNvbnN0IG5hbWUgPSBncm91cC5nZXQoIk5hbWUiKTsKICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIpIHsKICAgICAgb2JqLm5hbWUgPSBzdHJpbmdUb1BERlN0cmluZyhuYW1lKTsKICAgIH0KICAgIGxldCBpbnRlbnQgPSBncm91cC5nZXRBcnJheSgiSW50ZW50Iik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoaW50ZW50KSkgewogICAgICBpbnRlbnQgPSBbaW50ZW50XTsKICAgIH0KICAgIGlmIChpbnRlbnQuZXZlcnkoaSA9PiBpIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgb2JqLmludGVudCA9IGludGVudC5tYXAoaSA9PiBpLm5hbWUpOwogICAgfQogICAgY29uc3QgdXNhZ2UgPSBncm91cC5nZXQoIlVzYWdlIik7CiAgICBpZiAoISh1c2FnZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBvYmo7CiAgICB9CiAgICBjb25zdCB1c2FnZU9iaiA9IG9iai51c2FnZTsKICAgIGNvbnN0IHByaW50ID0gdXNhZ2UuZ2V0KCJQcmludCIpOwogICAgaWYgKHByaW50IGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBwcmludFN0YXRlID0gcHJpbnQuZ2V0KCJQcmludFN0YXRlIik7CiAgICAgIGlmIChwcmludFN0YXRlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIHN3aXRjaCAocHJpbnRTdGF0ZS5uYW1lKSB7CiAgICAgICAgICBjYXNlICJPTiI6CiAgICAgICAgICBjYXNlICJPRkYiOgogICAgICAgICAgICB1c2FnZU9iai5wcmludCA9IHsKICAgICAgICAgICAgICBwcmludFN0YXRlOiBwcmludFN0YXRlLm5hbWUKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHZpZXcgPSB1c2FnZS5nZXQoIlZpZXciKTsKICAgIGlmICh2aWV3IGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCB2aWV3U3RhdGUgPSB2aWV3LmdldCgiVmlld1N0YXRlIik7CiAgICAgIGlmICh2aWV3U3RhdGUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgc3dpdGNoICh2aWV3U3RhdGUubmFtZSkgewogICAgICAgICAgY2FzZSAiT04iOgogICAgICAgICAgY2FzZSAiT0ZGIjoKICAgICAgICAgICAgdXNhZ2VPYmoudmlldyA9IHsKICAgICAgICAgICAgICB2aWV3U3RhdGU6IHZpZXdTdGF0ZS5uYW1lCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gb2JqOwogIH0KICAjcmVhZE9wdGlvbmFsQ29udGVudENvbmZpZyhjb25maWcsIGdyb3VwUmVmQ2FjaGUpIHsKICAgIGZ1bmN0aW9uIHBhcnNlT25PZmYocmVmcykgewogICAgICBjb25zdCBvblBhcnNlZCA9IFtdOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShyZWZzKSkgewogICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgcmVmcykgewogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIGdyb3VwUmVmQ2FjaGUuaGFzKHZhbHVlKSkgewogICAgICAgICAgICBvblBhcnNlZC5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb25QYXJzZWQ7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZU9yZGVyKHJlZnMsIG5lc3RlZExldmVscyA9IDApIHsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJlZnMpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3Qgb3JkZXIgPSBbXTsKICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiByZWZzKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIGdyb3VwUmVmQ2FjaGUuaGFzKHZhbHVlKSkgewogICAgICAgICAgcGFyc2VkT3JkZXJSZWZzLnB1dCh2YWx1ZSk7CiAgICAgICAgICBvcmRlci5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5lc3RlZE9yZGVyID0gcGFyc2VOZXN0ZWRPcmRlcih2YWx1ZSwgbmVzdGVkTGV2ZWxzKTsKICAgICAgICBpZiAobmVzdGVkT3JkZXIpIHsKICAgICAgICAgIG9yZGVyLnB1c2gobmVzdGVkT3JkZXIpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobmVzdGVkTGV2ZWxzID4gMCkgewogICAgICAgIHJldHVybiBvcmRlcjsKICAgICAgfQogICAgICBjb25zdCBoaWRkZW5Hcm91cHMgPSBbXTsKICAgICAgZm9yIChjb25zdCBbZ3JvdXBSZWZdIG9mIGdyb3VwUmVmQ2FjaGUuaXRlbXMoKSkgewogICAgICAgIGlmIChwYXJzZWRPcmRlclJlZnMuaGFzKGdyb3VwUmVmKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGhpZGRlbkdyb3Vwcy5wdXNoKGdyb3VwUmVmLnRvU3RyaW5nKCkpOwogICAgICB9CiAgICAgIGlmIChoaWRkZW5Hcm91cHMubGVuZ3RoKSB7CiAgICAgICAgb3JkZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiBudWxsLAogICAgICAgICAgb3JkZXI6IGhpZGRlbkdyb3VwcwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBvcmRlcjsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlTmVzdGVkT3JkZXIocmVmLCBuZXN0ZWRMZXZlbHMpIHsKICAgICAgaWYgKCsrbmVzdGVkTGV2ZWxzID4gTUFYX05FU1RFRF9MRVZFTFMpIHsKICAgICAgICB3YXJuKCJwYXJzZU5lc3RlZE9yZGVyIC0gcmVhY2hlZCBNQVhfTkVTVEVEX0xFVkVMUy4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IHhyZWYuZmV0Y2hJZlJlZihyZWYpOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgbmVzdGVkTmFtZSA9IHhyZWYuZmV0Y2hJZlJlZih2YWx1ZVswXSk7CiAgICAgIGlmICh0eXBlb2YgbmVzdGVkTmFtZSAhPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBuZXN0ZWRPcmRlciA9IHBhcnNlT3JkZXIodmFsdWUuc2xpY2UoMSksIG5lc3RlZExldmVscyk7CiAgICAgIGlmICghbmVzdGVkT3JkZXI/Lmxlbmd0aCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogc3RyaW5nVG9QREZTdHJpbmcobmVzdGVkTmFtZSksCiAgICAgICAgb3JkZXI6IG5lc3RlZE9yZGVyCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZVJCR3JvdXBzKHJiR3JvdXBzKSB7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShyYkdyb3VwcykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiByYkdyb3VwcykgewogICAgICAgIGNvbnN0IHJiR3JvdXAgPSB4cmVmLmZldGNoSWZSZWYodmFsdWUpOwogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyYkdyb3VwKSB8fCAhcmJHcm91cC5sZW5ndGgpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBwYXJzZWRSYkdyb3VwID0gbmV3IFNldCgpOwogICAgICAgIGZvciAoY29uc3QgcmVmIG9mIHJiR3JvdXApIHsKICAgICAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBSZWYgJiYgZ3JvdXBSZWZDYWNoZS5oYXMocmVmKSAmJiAhcGFyc2VkUmJHcm91cC5oYXMocmVmLnRvU3RyaW5nKCkpKSB7CiAgICAgICAgICAgIHBhcnNlZFJiR3JvdXAuYWRkKHJlZi50b1N0cmluZygpKTsKICAgICAgICAgICAgZ3JvdXBSZWZDYWNoZS5nZXQocmVmKS5yYkdyb3Vwcy5wdXNoKHBhcnNlZFJiR3JvdXApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZiwKICAgICAgcGFyc2VkT3JkZXJSZWZzID0gbmV3IFJlZlNldCgpLAogICAgICBNQVhfTkVTVEVEX0xFVkVMUyA9IDEwOwogICAgcGFyc2VSQkdyb3Vwcyhjb25maWcuZ2V0KCJSQkdyb3VwcyIpKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IHR5cGVvZiBjb25maWcuZ2V0KCJOYW1lIikgPT09ICJzdHJpbmciID8gc3RyaW5nVG9QREZTdHJpbmcoY29uZmlnLmdldCgiTmFtZSIpKSA6IG51bGwsCiAgICAgIGNyZWF0b3I6IHR5cGVvZiBjb25maWcuZ2V0KCJDcmVhdG9yIikgPT09ICJzdHJpbmciID8gc3RyaW5nVG9QREZTdHJpbmcoY29uZmlnLmdldCgiQ3JlYXRvciIpKSA6IG51bGwsCiAgICAgIGJhc2VTdGF0ZTogY29uZmlnLmdldCgiQmFzZVN0YXRlIikgaW5zdGFuY2VvZiBOYW1lID8gY29uZmlnLmdldCgiQmFzZVN0YXRlIikubmFtZSA6IG51bGwsCiAgICAgIG9uOiBwYXJzZU9uT2ZmKGNvbmZpZy5nZXQoIk9OIikpLAogICAgICBvZmY6IHBhcnNlT25PZmYoY29uZmlnLmdldCgiT0ZGIikpLAogICAgICBvcmRlcjogcGFyc2VPcmRlcihjb25maWcuZ2V0KCJPcmRlciIpKSwKICAgICAgZ3JvdXBzOiBbLi4uZ3JvdXBSZWZDYWNoZV0KICAgIH07CiAgfQogIHNldEFjdHVhbE51bVBhZ2VzKG51bSA9IG51bGwpIHsKICAgIHRoaXMuI2FjdHVhbE51bVBhZ2VzID0gbnVtOwogIH0KICBnZXQgaGFzQWN0dWFsTnVtUGFnZXMoKSB7CiAgICByZXR1cm4gdGhpcy4jYWN0dWFsTnVtUGFnZXMgIT09IG51bGw7CiAgfQogIGdldCBfcGFnZXNDb3VudCgpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMudG9wbGV2ZWxQYWdlc0RpY3QuZ2V0KCJDb3VudCIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJQYWdlIGNvdW50IGluIHRvcC1sZXZlbCBwYWdlcyBkaWN0aW9uYXJ5IGlzIG5vdCBhbiBpbnRlZ2VyLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3BhZ2VzQ291bnQiLCBvYmopOwogIH0KICBnZXQgbnVtUGFnZXMoKSB7CiAgICByZXR1cm4gdGhpcy4jYWN0dWFsTnVtUGFnZXMgPz8gdGhpcy5fcGFnZXNDb3VudDsKICB9CiAgZ2V0IGRlc3RpbmF0aW9ucygpIHsKICAgIGNvbnN0IHJhd0Rlc3RzID0gdGhpcy4jcmVhZERlc3RzKCksCiAgICAgIGRlc3RzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3Qgb2JqIG9mIHJhd0Rlc3RzKSB7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lVHJlZSkgewogICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG9iai5nZXRBbGwoKSkgewogICAgICAgICAgY29uc3QgZGVzdCA9IGZldGNoRGVzdCh2YWx1ZSk7CiAgICAgICAgICBpZiAoZGVzdCkgewogICAgICAgICAgICBkZXN0c1tzdHJpbmdUb1BERlN0cmluZyhrZXksIHRydWUpXSA9IGRlc3Q7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBvYmopIHsKICAgICAgICAgIGNvbnN0IGRlc3QgPSBmZXRjaERlc3QodmFsdWUpOwogICAgICAgICAgaWYgKGRlc3QpIHsKICAgICAgICAgICAgZGVzdHNbc3RyaW5nVG9QREZTdHJpbmcoa2V5LCB0cnVlKV0gfHw9IGRlc3Q7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkZXN0aW5hdGlvbnMiLCBkZXN0cyk7CiAgfQogIGdldERlc3RpbmF0aW9uKGlkKSB7CiAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgiZGVzdGluYXRpb25zIikpIHsKICAgICAgcmV0dXJuIHRoaXMuZGVzdGluYXRpb25zW2lkXSA/PyBudWxsOwogICAgfQogICAgY29uc3QgcmF3RGVzdHMgPSB0aGlzLiNyZWFkRGVzdHMoKTsKICAgIGZvciAoY29uc3Qgb2JqIG9mIHJhd0Rlc3RzKSB7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lVHJlZSB8fCBvYmogaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgZGVzdCA9IGZldGNoRGVzdChvYmouZ2V0KGlkKSk7CiAgICAgICAgaWYgKGRlc3QpIHsKICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHJhd0Rlc3RzLmxlbmd0aCkgewogICAgICBjb25zdCBkZXN0ID0gdGhpcy5kZXN0aW5hdGlvbnNbaWRdOwogICAgICBpZiAoZGVzdCkgewogICAgICAgIHJldHVybiBkZXN0OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgI3JlYWREZXN0cygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJOYW1lcyIpOwogICAgY29uc3QgcmF3RGVzdHMgPSBbXTsKICAgIGlmIChvYmo/LmhhcygiRGVzdHMiKSkgewogICAgICByYXdEZXN0cy5wdXNoKG5ldyBOYW1lVHJlZShvYmouZ2V0UmF3KCJEZXN0cyIpLCB0aGlzLnhyZWYpKTsKICAgIH0KICAgIGlmICh0aGlzLiNjYXREaWN0LmhhcygiRGVzdHMiKSkgewogICAgICByYXdEZXN0cy5wdXNoKHRoaXMuI2NhdERpY3QuZ2V0KCJEZXN0cyIpKTsKICAgIH0KICAgIHJldHVybiByYXdEZXN0czsKICB9CiAgZ2V0IHBhZ2VMYWJlbHMoKSB7CiAgICBsZXQgb2JqID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIG9iaiA9IHRoaXMuI3JlYWRQYWdlTGFiZWxzKCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oIlVuYWJsZSB0byByZWFkIHBhZ2UgbGFiZWxzLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicGFnZUxhYmVscyIsIG9iaik7CiAgfQogICNyZWFkUGFnZUxhYmVscygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJQYWdlTGFiZWxzIik7CiAgICBpZiAoIW9iaikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHBhZ2VMYWJlbHMgPSBuZXcgQXJyYXkodGhpcy5udW1QYWdlcyk7CiAgICBsZXQgc3R5bGUgPSBudWxsLAogICAgICBwcmVmaXggPSAiIjsKICAgIGNvbnN0IG51bWJlclRyZWUgPSBuZXcgTnVtYmVyVHJlZShvYmosIHRoaXMueHJlZik7CiAgICBjb25zdCBudW1zID0gbnVtYmVyVHJlZS5nZXRBbGwoKTsKICAgIGxldCBjdXJyZW50TGFiZWwgPSAiIiwKICAgICAgY3VycmVudEluZGV4ID0gMTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHRoaXMubnVtUGFnZXM7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGxhYmVsRGljdCA9IG51bXMuZ2V0KGkpOwogICAgICBpZiAobGFiZWxEaWN0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoIShsYWJlbERpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJQYWdlTGFiZWwgaXMgbm90IGEgZGljdGlvbmFyeS4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlR5cGUiKSAmJiAhaXNOYW1lKGxhYmVsRGljdC5nZXQoIlR5cGUiKSwgIlBhZ2VMYWJlbCIpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgdHlwZSBpbiBQYWdlTGFiZWwgZGljdGlvbmFyeS4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlMiKSkgewogICAgICAgICAgY29uc3QgcyA9IGxhYmVsRGljdC5nZXQoIlMiKTsKICAgICAgICAgIGlmICghKHMgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgc3R5bGUgaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB9CiAgICAgICAgICBzdHlsZSA9IHMubmFtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3R5bGUgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAobGFiZWxEaWN0LmhhcygiUCIpKSB7CiAgICAgICAgICBjb25zdCBwID0gbGFiZWxEaWN0LmdldCgiUCIpOwogICAgICAgICAgaWYgKHR5cGVvZiBwICE9PSAic3RyaW5nIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgcHJlZml4IGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgfQogICAgICAgICAgcHJlZml4ID0gc3RyaW5nVG9QREZTdHJpbmcocCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByZWZpeCA9ICIiOwogICAgICAgIH0KICAgICAgICBpZiAobGFiZWxEaWN0LmhhcygiU3QiKSkgewogICAgICAgICAgY29uc3Qgc3QgPSBsYWJlbERpY3QuZ2V0KCJTdCIpOwogICAgICAgICAgaWYgKCEoTnVtYmVyLmlzSW50ZWdlcihzdCkgJiYgc3QgPj0gMSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIHN0YXJ0IGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudEluZGV4ID0gc3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRJbmRleCA9IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN3aXRjaCAoc3R5bGUpIHsKICAgICAgICBjYXNlICJEIjoKICAgICAgICAgIGN1cnJlbnRMYWJlbCA9IGN1cnJlbnRJbmRleDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlIiOgogICAgICAgIGNhc2UgInIiOgogICAgICAgICAgY3VycmVudExhYmVsID0gdG9Sb21hbk51bWVyYWxzKGN1cnJlbnRJbmRleCwgc3R5bGUgPT09ICJyIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJBIjoKICAgICAgICBjYXNlICJhIjoKICAgICAgICAgIGNvbnN0IExJTUlUID0gMjY7CiAgICAgICAgICBjb25zdCBBX1VQUEVSX0NBU0UgPSAweDQxLAogICAgICAgICAgICBBX0xPV0VSX0NBU0UgPSAweDYxOwogICAgICAgICAgY29uc3QgYmFzZUNoYXJDb2RlID0gc3R5bGUgPT09ICJhIiA/IEFfTE9XRVJfQ0FTRSA6IEFfVVBQRVJfQ0FTRTsKICAgICAgICAgIGNvbnN0IGxldHRlckluZGV4ID0gY3VycmVudEluZGV4IC0gMTsKICAgICAgICAgIGNvbnN0IGNoYXJhY3RlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYmFzZUNoYXJDb2RlICsgbGV0dGVySW5kZXggJSBMSU1JVCk7CiAgICAgICAgICBjdXJyZW50TGFiZWwgPSBjaGFyYWN0ZXIucmVwZWF0KE1hdGguZmxvb3IobGV0dGVySW5kZXggLyBMSU1JVCkgKyAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAoc3R5bGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIHN0eWxlICIke3N0eWxlfSIgaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuYCk7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50TGFiZWwgPSAiIjsKICAgICAgfQogICAgICBwYWdlTGFiZWxzW2ldID0gcHJlZml4ICsgY3VycmVudExhYmVsOwogICAgICBjdXJyZW50SW5kZXgrKzsKICAgIH0KICAgIHJldHVybiBwYWdlTGFiZWxzOwogIH0KICBnZXQgcGFnZUxheW91dCgpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJQYWdlTGF5b3V0Iik7CiAgICBsZXQgcGFnZUxheW91dCA9ICIiOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgc3dpdGNoIChvYmoubmFtZSkgewogICAgICAgIGNhc2UgIlNpbmdsZVBhZ2UiOgogICAgICAgIGNhc2UgIk9uZUNvbHVtbiI6CiAgICAgICAgY2FzZSAiVHdvQ29sdW1uTGVmdCI6CiAgICAgICAgY2FzZSAiVHdvQ29sdW1uUmlnaHQiOgogICAgICAgIGNhc2UgIlR3b1BhZ2VMZWZ0IjoKICAgICAgICBjYXNlICJUd29QYWdlUmlnaHQiOgogICAgICAgICAgcGFnZUxheW91dCA9IG9iai5uYW1lOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJwYWdlTGF5b3V0IiwgcGFnZUxheW91dCk7CiAgfQogIGdldCBwYWdlTW9kZSgpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJQYWdlTW9kZSIpOwogICAgbGV0IHBhZ2VNb2RlID0gIlVzZU5vbmUiOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgc3dpdGNoIChvYmoubmFtZSkgewogICAgICAgIGNhc2UgIlVzZU5vbmUiOgogICAgICAgIGNhc2UgIlVzZU91dGxpbmVzIjoKICAgICAgICBjYXNlICJVc2VUaHVtYnMiOgogICAgICAgIGNhc2UgIkZ1bGxTY3JlZW4iOgogICAgICAgIGNhc2UgIlVzZU9DIjoKICAgICAgICBjYXNlICJVc2VBdHRhY2htZW50cyI6CiAgICAgICAgICBwYWdlTW9kZSA9IG9iai5uYW1lOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJwYWdlTW9kZSIsIHBhZ2VNb2RlKTsKICB9CiAgZ2V0IHZpZXdlclByZWZlcmVuY2VzKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIlZpZXdlclByZWZlcmVuY2VzIik7CiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ2aWV3ZXJQcmVmZXJlbmNlcyIsIG51bGwpOwogICAgfQogICAgbGV0IHByZWZzID0gbnVsbDsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG9iaikgewogICAgICBsZXQgcHJlZlZhbHVlOwogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgIkhpZGVUb29sYmFyIjoKICAgICAgICBjYXNlICJIaWRlTWVudWJhciI6CiAgICAgICAgY2FzZSAiSGlkZVdpbmRvd1VJIjoKICAgICAgICBjYXNlICJGaXRXaW5kb3ciOgogICAgICAgIGNhc2UgIkNlbnRlcldpbmRvdyI6CiAgICAgICAgY2FzZSAiRGlzcGxheURvY1RpdGxlIjoKICAgICAgICBjYXNlICJQaWNrVHJheUJ5UERGU2l6ZSI6CiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJOb25GdWxsU2NyZWVuUGFnZU1vZGUiOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJVc2VOb25lIjoKICAgICAgICAgICAgICBjYXNlICJVc2VPdXRsaW5lcyI6CiAgICAgICAgICAgICAgY2FzZSAiVXNlVGh1bWJzIjoKICAgICAgICAgICAgICBjYXNlICJVc2VPQyI6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZS5uYW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJVc2VOb25lIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRGlyZWN0aW9uIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiTDJSIjoKICAgICAgICAgICAgICBjYXNlICJSMkwiOgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiTDJSIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiVmlld0FyZWEiOgogICAgICAgIGNhc2UgIlZpZXdDbGlwIjoKICAgICAgICBjYXNlICJQcmludEFyZWEiOgogICAgICAgIGNhc2UgIlByaW50Q2xpcCI6CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgIk1lZGlhQm94IjoKICAgICAgICAgICAgICBjYXNlICJDcm9wQm94IjoKICAgICAgICAgICAgICBjYXNlICJCbGVlZEJveCI6CiAgICAgICAgICAgICAgY2FzZSAiVHJpbUJveCI6CiAgICAgICAgICAgICAgY2FzZSAiQXJ0Qm94IjoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIkNyb3BCb3giOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJQcmludFNjYWxpbmciOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJOb25lIjoKICAgICAgICAgICAgICBjYXNlICJBcHBEZWZhdWx0IjoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIkFwcERlZmF1bHQiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJEdXBsZXgiOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJTaW1wbGV4IjoKICAgICAgICAgICAgICBjYXNlICJEdXBsZXhGbGlwU2hvcnRFZGdlIjoKICAgICAgICAgICAgICBjYXNlICJEdXBsZXhGbGlwTG9uZ0VkZ2UiOgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiTm9uZSI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlByaW50UGFnZVJhbmdlIjoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggJSAyID09PSAwKSB7CiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWQgPSB2YWx1ZS5ldmVyeSgocGFnZSwgaSwgYXJyKSA9PiBOdW1iZXIuaXNJbnRlZ2VyKHBhZ2UpICYmIHBhZ2UgPiAwICYmIChpID09PSAwIHx8IHBhZ2UgPj0gYXJyW2kgLSAxXSkgJiYgcGFnZSA8PSB0aGlzLm51bVBhZ2VzKTsKICAgICAgICAgICAgaWYgKGlzVmFsaWQpIHsKICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTnVtQ29waWVzIjoKICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSAmJiB2YWx1ZSA+IDApIHsKICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgd2FybihgSWdub3Jpbmcgbm9uLXN0YW5kYXJkIGtleSBpbiBWaWV3ZXJQcmVmZXJlbmNlczogJHtrZXl9LmApOwogICAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHByZWZWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgd2FybihgQmFkIHZhbHVlLCBmb3Iga2V5ICIke2tleX0iLCBpbiBWaWV3ZXJQcmVmZXJlbmNlczogJHt2YWx1ZX0uYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcHJlZnMgPz89IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHByZWZzW2tleV0gPSBwcmVmVmFsdWU7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ2aWV3ZXJQcmVmZXJlbmNlcyIsIHByZWZzKTsKICB9CiAgZ2V0IG9wZW5BY3Rpb24oKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiT3BlbkFjdGlvbiIpOwogICAgY29uc3Qgb3BlbkFjdGlvbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBkZXN0RGljdCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICAgIGRlc3REaWN0LnNldCgiQSIsIG9iaik7CiAgICAgIGNvbnN0IHJlc3VsdE9iaiA9IHsKICAgICAgICB1cmw6IG51bGwsCiAgICAgICAgZGVzdDogbnVsbCwKICAgICAgICBhY3Rpb246IG51bGwKICAgICAgfTsKICAgICAgQ2F0YWxvZy5wYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgICAgICBkZXN0RGljdCwKICAgICAgICByZXN1bHRPYmoKICAgICAgfSk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdE9iai5kZXN0KSkgewogICAgICAgIG9wZW5BY3Rpb24uZGVzdCA9IHJlc3VsdE9iai5kZXN0OwogICAgICB9IGVsc2UgaWYgKHJlc3VsdE9iai5hY3Rpb24pIHsKICAgICAgICBvcGVuQWN0aW9uLmFjdGlvbiA9IHJlc3VsdE9iai5hY3Rpb247CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNWYWxpZEV4cGxpY2l0RGVzdChvYmopKSB7CiAgICAgIG9wZW5BY3Rpb24uZGVzdCA9IG9iajsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgIm9wZW5BY3Rpb24iLCBvYmplY3RTaXplKG9wZW5BY3Rpb24pID4gMCA/IG9wZW5BY3Rpb24gOiBudWxsKTsKICB9CiAgZ2V0IGF0dGFjaG1lbnRzKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk5hbWVzIik7CiAgICBsZXQgYXR0YWNobWVudHMgPSBudWxsOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QgJiYgb2JqLmhhcygiRW1iZWRkZWRGaWxlcyIpKSB7CiAgICAgIGNvbnN0IG5hbWVUcmVlID0gbmV3IE5hbWVUcmVlKG9iai5nZXRSYXcoIkVtYmVkZGVkRmlsZXMiKSwgdGhpcy54cmVmKTsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgbmFtZVRyZWUuZ2V0QWxsKCkpIHsKICAgICAgICBjb25zdCBmcyA9IG5ldyBGaWxlU3BlYyh2YWx1ZSwgdGhpcy54cmVmKTsKICAgICAgICBhdHRhY2htZW50cyA/Pz0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBhdHRhY2htZW50c1tzdHJpbmdUb1BERlN0cmluZyhrZXksIHRydWUpXSA9IGZzLnNlcmlhbGl6YWJsZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYXR0YWNobWVudHMiLCBhdHRhY2htZW50cyk7CiAgfQogIGdldCB4ZmFJbWFnZXMoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiTmFtZXMiKTsKICAgIGxldCB4ZmFJbWFnZXMgPSBudWxsOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QgJiYgb2JqLmhhcygiWEZBSW1hZ2VzIikpIHsKICAgICAgY29uc3QgbmFtZVRyZWUgPSBuZXcgTmFtZVRyZWUob2JqLmdldFJhdygiWEZBSW1hZ2VzIiksIHRoaXMueHJlZik7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG5hbWVUcmVlLmdldEFsbCgpKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgICAgeGZhSW1hZ2VzID8/PSBuZXcgTWFwKCk7CiAgICAgICAgICB4ZmFJbWFnZXMuc2V0KHN0cmluZ1RvUERGU3RyaW5nKGtleSwgdHJ1ZSksIHZhbHVlLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAieGZhSW1hZ2VzIiwgeGZhSW1hZ2VzKTsKICB9CiAgI2NvbGxlY3RKYXZhU2NyaXB0KCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk5hbWVzIik7CiAgICBsZXQgamF2YVNjcmlwdCA9IG51bGw7CiAgICBmdW5jdGlvbiBhcHBlbmRJZkphdmFTY3JpcHREaWN0KG5hbWUsIGpzRGljdCkgewogICAgICBpZiAoIShqc0RpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIWlzTmFtZShqc0RpY3QuZ2V0KCJTIiksICJKYXZhU2NyaXB0IikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IGpzID0ganNEaWN0LmdldCgiSlMiKTsKICAgICAgaWYgKGpzIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGpzID0ganMuZ2V0U3RyaW5nKCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGpzICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBqcyA9IHN0cmluZ1RvUERGU3RyaW5nKGpzLCB0cnVlKS5yZXBsYWNlQWxsKCJceDAwIiwgIiIpOwogICAgICBpZiAoanMpIHsKICAgICAgICAoamF2YVNjcmlwdCB8fD0gbmV3IE1hcCgpKS5zZXQobmFtZSwganMpOwogICAgICB9CiAgICB9CiAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCAmJiBvYmouaGFzKCJKYXZhU2NyaXB0IikpIHsKICAgICAgY29uc3QgbmFtZVRyZWUgPSBuZXcgTmFtZVRyZWUob2JqLmdldFJhdygiSmF2YVNjcmlwdCIpLCB0aGlzLnhyZWYpOwogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBuYW1lVHJlZS5nZXRBbGwoKSkgewogICAgICAgIGFwcGVuZElmSmF2YVNjcmlwdERpY3Qoc3RyaW5nVG9QREZTdHJpbmcoa2V5LCB0cnVlKSwgdmFsdWUpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBvcGVuQWN0aW9uID0gdGhpcy4jY2F0RGljdC5nZXQoIk9wZW5BY3Rpb24iKTsKICAgIGlmIChvcGVuQWN0aW9uKSB7CiAgICAgIGFwcGVuZElmSmF2YVNjcmlwdERpY3QoIk9wZW5BY3Rpb24iLCBvcGVuQWN0aW9uKTsKICAgIH0KICAgIHJldHVybiBqYXZhU2NyaXB0OwogIH0KICBnZXQganNBY3Rpb25zKCkgewogICAgY29uc3QgamF2YVNjcmlwdCA9IHRoaXMuI2NvbGxlY3RKYXZhU2NyaXB0KCk7CiAgICBsZXQgYWN0aW9ucyA9IGNvbGxlY3RBY3Rpb25zKHRoaXMueHJlZiwgdGhpcy4jY2F0RGljdCwgRG9jdW1lbnRBY3Rpb25FdmVudFR5cGUpOwogICAgaWYgKGphdmFTY3JpcHQpIHsKICAgICAgYWN0aW9ucyB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIGphdmFTY3JpcHQpIHsKICAgICAgICBpZiAoa2V5IGluIGFjdGlvbnMpIHsKICAgICAgICAgIGFjdGlvbnNba2V5XS5wdXNoKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFjdGlvbnNba2V5XSA9IFt2YWxdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAianNBY3Rpb25zIiwgYWN0aW9ucyk7CiAgfQogIGFzeW5jIGNsZWFudXAobWFudWFsbHlUcmlnZ2VyZWQgPSBmYWxzZSkgewogICAgY2xlYXJHbG9iYWxDYWNoZXMoKTsKICAgIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLmNsZWFyKCk7CiAgICB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuY2xlYXIobWFudWFsbHlUcmlnZ2VyZWQpOwogICAgdGhpcy5wYWdlS2lkc0NvdW50Q2FjaGUuY2xlYXIoKTsKICAgIHRoaXMucGFnZUluZGV4Q2FjaGUuY2xlYXIoKTsKICAgIHRoaXMucGFnZURpY3RDYWNoZS5jbGVhcigpOwogICAgdGhpcy5ub25CbGVuZE1vZGVzU2V0LmNsZWFyKCk7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgZGljdAogICAgfSBvZiBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLmZvbnRDYWNoZSkpIHsKICAgICAgZGVsZXRlIGRpY3QuY2FjaGVLZXk7CiAgICB9CiAgICB0aGlzLmZvbnRDYWNoZS5jbGVhcigpOwogICAgdGhpcy5idWlsdEluQ01hcENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZS5jbGVhcigpOwogICAgdGhpcy5zeXN0ZW1Gb250Q2FjaGUuY2xlYXIoKTsKICB9CiAgYXN5bmMgZ2V0UGFnZURpY3QocGFnZUluZGV4KSB7CiAgICBjb25zdCBub2Rlc1RvVmlzaXQgPSBbdGhpcy50b3BsZXZlbFBhZ2VzRGljdF07CiAgICBjb25zdCB2aXNpdGVkTm9kZXMgPSBuZXcgUmVmU2V0KCk7CiAgICBjb25zdCBwYWdlc1JlZiA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJQYWdlcyIpOwogICAgaWYgKHBhZ2VzUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHZpc2l0ZWROb2Rlcy5wdXQocGFnZXNSZWYpOwogICAgfQogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZiwKICAgICAgcGFnZUtpZHNDb3VudENhY2hlID0gdGhpcy5wYWdlS2lkc0NvdW50Q2FjaGUsCiAgICAgIHBhZ2VJbmRleENhY2hlID0gdGhpcy5wYWdlSW5kZXhDYWNoZSwKICAgICAgcGFnZURpY3RDYWNoZSA9IHRoaXMucGFnZURpY3RDYWNoZTsKICAgIGxldCBjdXJyZW50UGFnZUluZGV4ID0gMDsKICAgIHdoaWxlIChub2Rlc1RvVmlzaXQubGVuZ3RoKSB7CiAgICAgIGNvbnN0IGN1cnJlbnROb2RlID0gbm9kZXNUb1Zpc2l0LnBvcCgpOwogICAgICBpZiAoY3VycmVudE5vZGUgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICBjb25zdCBjb3VudCA9IHBhZ2VLaWRzQ291bnRDYWNoZS5nZXQoY3VycmVudE5vZGUpOwogICAgICAgIGlmIChjb3VudCA+PSAwICYmIGN1cnJlbnRQYWdlSW5kZXggKyBjb3VudCA8PSBwYWdlSW5kZXgpIHsKICAgICAgICAgIGN1cnJlbnRQYWdlSW5kZXggKz0gY291bnQ7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHZpc2l0ZWROb2Rlcy5oYXMoY3VycmVudE5vZGUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2VzIHRyZWUgY29udGFpbnMgY2lyY3VsYXIgcmVmZXJlbmNlLiIpOwogICAgICAgIH0KICAgICAgICB2aXNpdGVkTm9kZXMucHV0KGN1cnJlbnROb2RlKTsKICAgICAgICBjb25zdCBvYmogPSBhd2FpdCAocGFnZURpY3RDYWNoZS5nZXQoY3VycmVudE5vZGUpIHx8IHhyZWYuZmV0Y2hBc3luYyhjdXJyZW50Tm9kZSkpOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICBsZXQgdHlwZSA9IG9iai5nZXRSYXcoIlR5cGUiKTsKICAgICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIHR5cGUgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmModHlwZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNOYW1lKHR5cGUsICJQYWdlIikgfHwgIW9iai5oYXMoIktpZHMiKSkgewogICAgICAgICAgICBpZiAoIXBhZ2VLaWRzQ291bnRDYWNoZS5oYXMoY3VycmVudE5vZGUpKSB7CiAgICAgICAgICAgICAgcGFnZUtpZHNDb3VudENhY2hlLnB1dChjdXJyZW50Tm9kZSwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFwYWdlSW5kZXhDYWNoZS5oYXMoY3VycmVudE5vZGUpKSB7CiAgICAgICAgICAgICAgcGFnZUluZGV4Q2FjaGUucHV0KGN1cnJlbnROb2RlLCBjdXJyZW50UGFnZUluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3VycmVudFBhZ2VJbmRleCA9PT0gcGFnZUluZGV4KSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtvYmosIGN1cnJlbnROb2RlXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdXJyZW50UGFnZUluZGV4Kys7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBub2Rlc1RvVmlzaXQucHVzaChvYmopOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgZGljdGlvbmFyeSBraWQgcmVmZXJlbmNlIHBvaW50cyB0byB3cm9uZyB0eXBlIG9mIG9iamVjdC4iKTsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgb2JqSWQKICAgICAgfSA9IGN1cnJlbnROb2RlOwogICAgICBsZXQgY291bnQgPSBjdXJyZW50Tm9kZS5nZXRSYXcoIkNvdW50Iik7CiAgICAgIGlmIChjb3VudCBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIGNvdW50ID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKGNvdW50KTsKICAgICAgfQogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihjb3VudCkgJiYgY291bnQgPj0gMCkgewogICAgICAgIGlmIChvYmpJZCAmJiAhcGFnZUtpZHNDb3VudENhY2hlLmhhcyhvYmpJZCkpIHsKICAgICAgICAgIHBhZ2VLaWRzQ291bnRDYWNoZS5wdXQob2JqSWQsIGNvdW50KTsKICAgICAgICB9CiAgICAgICAgaWYgKGN1cnJlbnRQYWdlSW5kZXggKyBjb3VudCA8PSBwYWdlSW5kZXgpIHsKICAgICAgICAgIGN1cnJlbnRQYWdlSW5kZXggKz0gY291bnQ7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IGtpZHMgPSBjdXJyZW50Tm9kZS5nZXRSYXcoIktpZHMiKTsKICAgICAgaWYgKGtpZHMgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICBraWRzID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKGtpZHMpOwogICAgICB9CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgIGxldCB0eXBlID0gY3VycmVudE5vZGUuZ2V0UmF3KCJUeXBlIik7CiAgICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgIHR5cGUgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmModHlwZSk7CiAgICAgICAgfQogICAgICAgIGlmIChpc05hbWUodHlwZSwgIlBhZ2UiKSB8fCAhY3VycmVudE5vZGUuaGFzKCJLaWRzIikpIHsKICAgICAgICAgIGlmIChjdXJyZW50UGFnZUluZGV4ID09PSBwYWdlSW5kZXgpIHsKICAgICAgICAgICAgcmV0dXJuIFtjdXJyZW50Tm9kZSwgbnVsbF07CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50UGFnZUluZGV4Kys7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkcyBvYmplY3QgaXMgbm90IGFuIGFycmF5LiIpOwogICAgICB9CiAgICAgIGZvciAobGV0IGxhc3QgPSBraWRzLmxlbmd0aCAtIDE7IGxhc3QgPj0gMDsgbGFzdC0tKSB7CiAgICAgICAgY29uc3QgbGFzdEtpZCA9IGtpZHNbbGFzdF07CiAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2gobGFzdEtpZCk7CiAgICAgICAgaWYgKGN1cnJlbnROb2RlID09PSB0aGlzLnRvcGxldmVsUGFnZXNEaWN0ICYmIGxhc3RLaWQgaW5zdGFuY2VvZiBSZWYgJiYgIXBhZ2VEaWN0Q2FjaGUuaGFzKGxhc3RLaWQpKSB7CiAgICAgICAgICBwYWdlRGljdENhY2hlLnB1dChsYXN0S2lkLCB4cmVmLmZldGNoQXN5bmMobGFzdEtpZCkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhyb3cgbmV3IEVycm9yKGBQYWdlIGluZGV4ICR7cGFnZUluZGV4fSBub3QgZm91bmQuYCk7CiAgfQogIGFzeW5jIGdldEFsbFBhZ2VEaWN0cyhyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgY29uc3QgewogICAgICBpZ25vcmVFcnJvcnMKICAgIH0gPSB0aGlzLnBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9uczsKICAgIGNvbnN0IHF1ZXVlID0gW3sKICAgICAgY3VycmVudE5vZGU6IHRoaXMudG9wbGV2ZWxQYWdlc0RpY3QsCiAgICAgIHBvc0luS2lkczogMAogICAgfV07CiAgICBjb25zdCB2aXNpdGVkTm9kZXMgPSBuZXcgUmVmU2V0KCk7CiAgICBjb25zdCBwYWdlc1JlZiA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJQYWdlcyIpOwogICAgaWYgKHBhZ2VzUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHZpc2l0ZWROb2Rlcy5wdXQocGFnZXNSZWYpOwogICAgfQogICAgY29uc3QgbWFwID0gbmV3IE1hcCgpLAogICAgICB4cmVmID0gdGhpcy54cmVmLAogICAgICBwYWdlSW5kZXhDYWNoZSA9IHRoaXMucGFnZUluZGV4Q2FjaGU7CiAgICBsZXQgcGFnZUluZGV4ID0gMDsKICAgIGZ1bmN0aW9uIGFkZFBhZ2VEaWN0KHBhZ2VEaWN0LCBwYWdlUmVmKSB7CiAgICAgIGlmIChwYWdlUmVmICYmICFwYWdlSW5kZXhDYWNoZS5oYXMocGFnZVJlZikpIHsKICAgICAgICBwYWdlSW5kZXhDYWNoZS5wdXQocGFnZVJlZiwgcGFnZUluZGV4KTsKICAgICAgfQogICAgICBtYXAuc2V0KHBhZ2VJbmRleCsrLCBbcGFnZURpY3QsIHBhZ2VSZWZdKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZFBhZ2VFcnJvcihlcnJvcikgewogICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBYUmVmRW50cnlFeGNlcHRpb24gJiYgIXJlY292ZXJ5TW9kZSkgewogICAgICAgIHRocm93IGVycm9yOwogICAgICB9CiAgICAgIGlmIChyZWNvdmVyeU1vZGUgJiYgaWdub3JlRXJyb3JzICYmIHBhZ2VJbmRleCA9PT0gMCkgewogICAgICAgIHdhcm4oYGdldEFsbFBhZ2VEaWN0cyAtIFNraXBwaW5nIGludmFsaWQgZmlyc3QgcGFnZTogIiR7ZXJyb3J9Ii5gKTsKICAgICAgICBlcnJvciA9IERpY3QuZW1wdHk7CiAgICAgIH0KICAgICAgbWFwLnNldChwYWdlSW5kZXgrKywgW2Vycm9yLCBudWxsXSk7CiAgICB9CiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBxdWV1ZUl0ZW0gPSBxdWV1ZS5hdCgtMSk7CiAgICAgIGNvbnN0IHsKICAgICAgICBjdXJyZW50Tm9kZSwKICAgICAgICBwb3NJbktpZHMKICAgICAgfSA9IHF1ZXVlSXRlbTsKICAgICAgbGV0IGtpZHMgPSBjdXJyZW50Tm9kZS5nZXRSYXcoIktpZHMiKTsKICAgICAgaWYgKGtpZHMgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICB0cnkgewogICAgICAgICAga2lkcyA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhraWRzKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgYWRkUGFnZUVycm9yKGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICBhZGRQYWdlRXJyb3IobmV3IEZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkcyBvYmplY3QgaXMgbm90IGFuIGFycmF5LiIpKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAocG9zSW5LaWRzID49IGtpZHMubGVuZ3RoKSB7CiAgICAgICAgcXVldWUucG9wKCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qga2lkT2JqID0ga2lkc1twb3NJbktpZHNdOwogICAgICBsZXQgb2JqOwogICAgICBpZiAoa2lkT2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaWYgKHZpc2l0ZWROb2Rlcy5oYXMoa2lkT2JqKSkgewogICAgICAgICAgYWRkUGFnZUVycm9yKG5ldyBGb3JtYXRFcnJvcigiUGFnZXMgdHJlZSBjb250YWlucyBjaXJjdWxhciByZWZlcmVuY2UuIikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHZpc2l0ZWROb2Rlcy5wdXQoa2lkT2JqKTsKICAgICAgICB0cnkgewogICAgICAgICAgb2JqID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKGtpZE9iaik7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIGFkZFBhZ2VFcnJvcihleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2JqID0ga2lkT2JqOwogICAgICB9CiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgYWRkUGFnZUVycm9yKG5ldyBGb3JtYXRFcnJvcigiUGFnZSBkaWN0aW9uYXJ5IGtpZCByZWZlcmVuY2UgcG9pbnRzIHRvIHdyb25nIHR5cGUgb2Ygb2JqZWN0LiIpKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBsZXQgdHlwZSA9IG9iai5nZXRSYXcoIlR5cGUiKTsKICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgYWRkUGFnZUVycm9yKGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaXNOYW1lKHR5cGUsICJQYWdlIikgfHwgIW9iai5oYXMoIktpZHMiKSkgewogICAgICAgIGFkZFBhZ2VEaWN0KG9iaiwga2lkT2JqIGluc3RhbmNlb2YgUmVmID8ga2lkT2JqIDogbnVsbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgICBjdXJyZW50Tm9kZTogb2JqLAogICAgICAgICAgcG9zSW5LaWRzOiAwCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcXVldWVJdGVtLnBvc0luS2lkcysrOwogICAgfQogICAgcmV0dXJuIG1hcDsKICB9CiAgZ2V0UGFnZUluZGV4KHBhZ2VSZWYpIHsKICAgIGNvbnN0IGNhY2hlZFBhZ2VJbmRleCA9IHRoaXMucGFnZUluZGV4Q2FjaGUuZ2V0KHBhZ2VSZWYpOwogICAgaWYgKGNhY2hlZFBhZ2VJbmRleCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY2FjaGVkUGFnZUluZGV4KTsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBmdW5jdGlvbiBwYWdlc0JlZm9yZVJlZihraWRSZWYpIHsKICAgICAgbGV0IHRvdGFsID0gMCwKICAgICAgICBwYXJlbnRSZWY7CiAgICAgIHJldHVybiB4cmVmLmZldGNoQXN5bmMoa2lkUmVmKS50aGVuKGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgaWYgKGlzUmVmc0VxdWFsKGtpZFJlZiwgcGFnZVJlZikgJiYgIWlzRGljdChub2RlLCAiUGFnZSIpICYmICEobm9kZSBpbnN0YW5jZW9mIERpY3QgJiYgIW5vZGUuaGFzKCJUeXBlIikgJiYgbm9kZS5oYXMoIkNvbnRlbnRzIikpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlRoZSByZWZlcmVuY2UgZG9lcyBub3QgcG9pbnQgdG8gYSAvUGFnZSBkaWN0aW9uYXJ5LiIpOwogICAgICAgIH0KICAgICAgICBpZiAoIW5vZGUpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIShub2RlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm9kZSBtdXN0IGJlIGEgZGljdGlvbmFyeS4iKTsKICAgICAgICB9CiAgICAgICAgcGFyZW50UmVmID0gbm9kZS5nZXRSYXcoIlBhcmVudCIpOwogICAgICAgIHJldHVybiBub2RlLmdldEFzeW5jKCJQYXJlbnQiKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAocGFyZW50KSB7CiAgICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIShwYXJlbnQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJQYXJlbnQgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJlbnQuZ2V0QXN5bmMoIktpZHMiKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoa2lkcykgewogICAgICAgIGlmICgha2lkcykgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGtpZFByb21pc2VzID0gW107CiAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgZm9yIChjb25zdCBraWQgb2Yga2lkcykgewogICAgICAgICAgaWYgKCEoa2lkIGluc3RhbmNlb2YgUmVmKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIktpZCBtdXN0IGJlIGEgcmVmZXJlbmNlLiIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzUmVmc0VxdWFsKGtpZCwga2lkUmVmKSkgewogICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAga2lkUHJvbWlzZXMucHVzaCh4cmVmLmZldGNoQXN5bmMoa2lkKS50aGVuKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIktpZCBub2RlIG11c3QgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvYmouaGFzKCJDb3VudCIpKSB7CiAgICAgICAgICAgICAgdG90YWwgKz0gb2JqLmdldCgiQ291bnQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0b3RhbCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiS2lkIHJlZmVyZW5jZSBub3QgZm91bmQgaW4gcGFyZW50J3Mga2lkcy4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGtpZFByb21pc2VzKS50aGVuKCgpID0+IFt0b3RhbCwgcGFyZW50UmVmXSk7CiAgICAgIH0pOwogICAgfQogICAgbGV0IHRvdGFsID0gMDsKICAgIGNvbnN0IG5leHQgPSByZWYgPT4gcGFnZXNCZWZvcmVSZWYocmVmKS50aGVuKGFyZ3MgPT4gewogICAgICBpZiAoIWFyZ3MpIHsKICAgICAgICB0aGlzLnBhZ2VJbmRleENhY2hlLnB1dChwYWdlUmVmLCB0b3RhbCk7CiAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgICB9CiAgICAgIGNvbnN0IFtjb3VudCwgcGFyZW50UmVmXSA9IGFyZ3M7CiAgICAgIHRvdGFsICs9IGNvdW50OwogICAgICByZXR1cm4gbmV4dChwYXJlbnRSZWYpOwogICAgfSk7CiAgICByZXR1cm4gbmV4dChwYWdlUmVmKTsKICB9CiAgZ2V0IGJhc2VVcmwoKSB7CiAgICBjb25zdCB1cmkgPSB0aGlzLiNjYXREaWN0LmdldCgiVVJJIik7CiAgICBpZiAodXJpIGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBiYXNlID0gdXJpLmdldCgiQmFzZSIpOwogICAgICBpZiAodHlwZW9mIGJhc2UgPT09ICJzdHJpbmciKSB7CiAgICAgICAgY29uc3QgYWJzb2x1dGVVcmwgPSBjcmVhdGVWYWxpZEFic29sdXRlVXJsKGJhc2UsIG51bGwsIHsKICAgICAgICAgIHRyeUNvbnZlcnRFbmNvZGluZzogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGlmIChhYnNvbHV0ZVVybCkgewogICAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYmFzZVVybCIsIGFic29sdXRlVXJsLmhyZWYpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYmFzZVVybCIsIHRoaXMucGRmTWFuYWdlci5kb2NCYXNlVXJsKTsKICB9CiAgc3RhdGljIHBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgZGVzdERpY3QsCiAgICByZXN1bHRPYmosCiAgICBkb2NCYXNlVXJsID0gbnVsbCwKICAgIGRvY0F0dGFjaG1lbnRzID0gbnVsbAogIH0pIHsKICAgIGlmICghKGRlc3REaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgd2FybigicGFyc2VEZXN0RGljdGlvbmFyeTogYGRlc3REaWN0YCBtdXN0IGJlIGEgZGljdGlvbmFyeS4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGFjdGlvbiA9IGRlc3REaWN0LmdldCgiQSIpLAogICAgICB1cmwsCiAgICAgIGRlc3Q7CiAgICBpZiAoIShhY3Rpb24gaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICBpZiAoZGVzdERpY3QuaGFzKCJEZXN0IikpIHsKICAgICAgICBhY3Rpb24gPSBkZXN0RGljdC5nZXQoIkRlc3QiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhY3Rpb24gPSBkZXN0RGljdC5nZXQoIkFBIik7CiAgICAgICAgaWYgKGFjdGlvbiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgIGlmIChhY3Rpb24uaGFzKCJEIikpIHsKICAgICAgICAgICAgYWN0aW9uID0gYWN0aW9uLmdldCgiRCIpOwogICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uaGFzKCJVIikpIHsKICAgICAgICAgICAgYWN0aW9uID0gYWN0aW9uLmdldCgiVSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGFjdGlvbiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgYWN0aW9uVHlwZSA9IGFjdGlvbi5nZXQoIlMiKTsKICAgICAgaWYgKCEoYWN0aW9uVHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgd2FybigicGFyc2VEZXN0RGljdGlvbmFyeTogSW52YWxpZCB0eXBlIGluIEFjdGlvbiBkaWN0aW9uYXJ5LiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBhY3Rpb25OYW1lID0gYWN0aW9uVHlwZS5uYW1lOwogICAgICBzd2l0Y2ggKGFjdGlvbk5hbWUpIHsKICAgICAgICBjYXNlICJSZXNldEZvcm0iOgogICAgICAgICAgY29uc3QgZmxhZ3MgPSBhY3Rpb24uZ2V0KCJGbGFncyIpOwogICAgICAgICAgY29uc3QgaW5jbHVkZSA9ICgodHlwZW9mIGZsYWdzID09PSAibnVtYmVyIiA/IGZsYWdzIDogMCkgJiAxKSA9PT0gMDsKICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IFtdOwogICAgICAgICAgY29uc3QgcmVmcyA9IFtdOwogICAgICAgICAgZm9yIChjb25zdCBvYmogb2YgYWN0aW9uLmdldCgiRmllbGRzIikgfHwgW10pIHsKICAgICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICAgIHJlZnMucHVzaChvYmoudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9iaiA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICBmaWVsZHMucHVzaChzdHJpbmdUb1BERlN0cmluZyhvYmopKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmVzdWx0T2JqLnJlc2V0Rm9ybSA9IHsKICAgICAgICAgICAgZmllbGRzLAogICAgICAgICAgICByZWZzLAogICAgICAgICAgICBpbmNsdWRlCiAgICAgICAgICB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiVVJJIjoKICAgICAgICAgIHVybCA9IGFjdGlvbi5nZXQoIlVSSSIpOwogICAgICAgICAgaWYgKHVybCBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgdXJsID0gIi8iICsgdXJsLm5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJHb1RvIjoKICAgICAgICAgIGRlc3QgPSBhY3Rpb24uZ2V0KCJEIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJMYXVuY2giOgogICAgICAgIGNhc2UgIkdvVG9SIjoKICAgICAgICAgIGNvbnN0IHVybERpY3QgPSBhY3Rpb24uZ2V0KCJGIik7CiAgICAgICAgICBpZiAodXJsRGljdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgICAgY29uc3QgZnMgPSBuZXcgRmlsZVNwZWModXJsRGljdCwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICByYXdGaWxlbmFtZQogICAgICAgICAgICB9ID0gZnMuc2VyaWFsaXphYmxlOwogICAgICAgICAgICB1cmwgPSByYXdGaWxlbmFtZTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHVybERpY3QgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHVybCA9IHVybERpY3Q7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCByZW1vdGVEZXN0ID0gZmV0Y2hSZW1vdGVEZXN0KGFjdGlvbik7CiAgICAgICAgICBpZiAocmVtb3RlRGVzdCAmJiB0eXBlb2YgdXJsID09PSAic3RyaW5nIikgewogICAgICAgICAgICB1cmwgPSB1cmwuc3BsaXQoIiMiLCAxKVswXSArICIjIiArIHJlbW90ZURlc3Q7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBuZXdXaW5kb3cgPSBhY3Rpb24uZ2V0KCJOZXdXaW5kb3ciKTsKICAgICAgICAgIGlmICh0eXBlb2YgbmV3V2luZG93ID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgcmVzdWx0T2JqLm5ld1dpbmRvdyA9IG5ld1dpbmRvdzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkdvVG9FIjoKICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGFjdGlvbi5nZXQoIlQiKTsKICAgICAgICAgIGxldCBhdHRhY2htZW50OwogICAgICAgICAgaWYgKGRvY0F0dGFjaG1lbnRzICYmIHRhcmdldCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgICAgY29uc3QgcmVsYXRpb25zaGlwID0gdGFyZ2V0LmdldCgiUiIpOwogICAgICAgICAgICBjb25zdCBuYW1lID0gdGFyZ2V0LmdldCgiTiIpOwogICAgICAgICAgICBpZiAoaXNOYW1lKHJlbGF0aW9uc2hpcCwgIkMiKSAmJiB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICBhdHRhY2htZW50ID0gZG9jQXR0YWNobWVudHNbc3RyaW5nVG9QREZTdHJpbmcobmFtZSwgdHJ1ZSldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYXR0YWNobWVudCkgewogICAgICAgICAgICByZXN1bHRPYmouYXR0YWNobWVudCA9IGF0dGFjaG1lbnQ7CiAgICAgICAgICAgIGNvbnN0IGF0dGFjaG1lbnREZXN0ID0gZmV0Y2hSZW1vdGVEZXN0KGFjdGlvbik7CiAgICAgICAgICAgIGlmIChhdHRhY2htZW50RGVzdCkgewogICAgICAgICAgICAgIHJlc3VsdE9iai5hdHRhY2htZW50RGVzdCA9IGF0dGFjaG1lbnREZXN0OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXJuKGBwYXJzZURlc3REaWN0aW9uYXJ5IC0gdW5pbXBsZW1lbnRlZCAiR29Ub0UiIGFjdGlvbi5gKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk5hbWVkIjoKICAgICAgICAgIGNvbnN0IG5hbWVkQWN0aW9uID0gYWN0aW9uLmdldCgiTiIpOwogICAgICAgICAgaWYgKG5hbWVkQWN0aW9uIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICByZXN1bHRPYmouYWN0aW9uID0gbmFtZWRBY3Rpb24ubmFtZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlNldE9DR1N0YXRlIjoKICAgICAgICAgIGNvbnN0IHN0YXRlID0gYWN0aW9uLmdldCgiU3RhdGUiKTsKICAgICAgICAgIGNvbnN0IHByZXNlcnZlUkIgPSBhY3Rpb24uZ2V0KCJQcmVzZXJ2ZVJCIik7CiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3RhdGUpIHx8IHN0YXRlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0YXRlQXJyID0gW107CiAgICAgICAgICBmb3IgKGNvbnN0IGVsZW0gb2Ygc3RhdGUpIHsKICAgICAgICAgICAgaWYgKGVsZW0gaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChlbGVtLm5hbWUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIk9OIjoKICAgICAgICAgICAgICAgIGNhc2UgIk9GRiI6CiAgICAgICAgICAgICAgICBjYXNlICJUb2dnbGUiOgogICAgICAgICAgICAgICAgICBzdGF0ZUFyci5wdXNoKGVsZW0ubmFtZSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgc3RhdGVBcnIucHVzaChlbGVtLnRvU3RyaW5nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGVBcnIubGVuZ3RoICE9PSBzdGF0ZS5sZW5ndGgpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHRPYmouc2V0T0NHU3RhdGUgPSB7CiAgICAgICAgICAgIHN0YXRlOiBzdGF0ZUFyciwKICAgICAgICAgICAgcHJlc2VydmVSQjogdHlwZW9mIHByZXNlcnZlUkIgPT09ICJib29sZWFuIiA/IHByZXNlcnZlUkIgOiB0cnVlCiAgICAgICAgICB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiSmF2YVNjcmlwdCI6CiAgICAgICAgICBjb25zdCBqc0FjdGlvbiA9IGFjdGlvbi5nZXQoIkpTIik7CiAgICAgICAgICBsZXQganM7CiAgICAgICAgICBpZiAoanNBY3Rpb24gaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgICAgIGpzID0ganNBY3Rpb24uZ2V0U3RyaW5nKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBqc0FjdGlvbiA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAganMgPSBqc0FjdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGpzVVJMID0ganMgJiYgcmVjb3ZlckpzVVJMKHN0cmluZ1RvUERGU3RyaW5nKGpzLCB0cnVlKSk7CiAgICAgICAgICBpZiAoanNVUkwpIHsKICAgICAgICAgICAgdXJsID0ganNVUkwudXJsOwogICAgICAgICAgICByZXN1bHRPYmoubmV3V2luZG93ID0ganNVUkwubmV3V2luZG93OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKGFjdGlvbk5hbWUgPT09ICJKYXZhU2NyaXB0IiB8fCBhY3Rpb25OYW1lID09PSAiU3VibWl0Rm9ybSIpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB3YXJuKGBwYXJzZURlc3REaWN0aW9uYXJ5IC0gdW5zdXBwb3J0ZWQgYWN0aW9uOiAiJHthY3Rpb25OYW1lfSIuYCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSBlbHNlIGlmIChkZXN0RGljdC5oYXMoIkRlc3QiKSkgewogICAgICBkZXN0ID0gZGVzdERpY3QuZ2V0KCJEZXN0Iik7CiAgICB9CiAgICBpZiAodHlwZW9mIHVybCA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgYWJzb2x1dGVVcmwgPSBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCwgZG9jQmFzZVVybCwgewogICAgICAgIGFkZERlZmF1bHRQcm90b2NvbDogdHJ1ZSwKICAgICAgICB0cnlDb252ZXJ0RW5jb2Rpbmc6IHRydWUKICAgICAgfSk7CiAgICAgIGlmIChhYnNvbHV0ZVVybCkgewogICAgICAgIHJlc3VsdE9iai51cmwgPSBhYnNvbHV0ZVVybC5ocmVmOwogICAgICB9CiAgICAgIHJlc3VsdE9iai51bnNhZmVVcmwgPSB1cmw7CiAgICB9CiAgICBpZiAoZGVzdCkgewogICAgICBpZiAoZGVzdCBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBkZXN0ID0gZGVzdC5uYW1lOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgZGVzdCA9PT0gInN0cmluZyIpIHsKICAgICAgICByZXN1bHRPYmouZGVzdCA9IHN0cmluZ1RvUERGU3RyaW5nKGRlc3QsIHRydWUpOwogICAgICB9IGVsc2UgaWYgKGlzVmFsaWRFeHBsaWNpdERlc3QoZGVzdCkpIHsKICAgICAgICByZXN1bHRPYmouZGVzdCA9IGRlc3Q7CiAgICAgIH0KICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL29iamVjdF9sb2FkZXIuanMKCgoKCmZ1bmN0aW9uIG1heUhhdmVDaGlsZHJlbih2YWx1ZSkgewogIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFJlZiB8fCB2YWx1ZSBpbnN0YW5jZW9mIERpY3QgfHwgdmFsdWUgaW5zdGFuY2VvZiBCYXNlU3RyZWFtIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpOwp9CmZ1bmN0aW9uIGFkZENoaWxkcmVuKG5vZGUsIG5vZGVzVG9WaXNpdCkgewogIGlmIChub2RlIGluc3RhbmNlb2YgRGljdCkgewogICAgbm9kZSA9IG5vZGUuZ2V0UmF3VmFsdWVzKCk7CiAgfSBlbHNlIGlmIChub2RlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgbm9kZSA9IG5vZGUuZGljdC5nZXRSYXdWYWx1ZXMoKTsKICB9IGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KG5vZGUpKSB7CiAgICByZXR1cm47CiAgfQogIGZvciAoY29uc3QgcmF3VmFsdWUgb2Ygbm9kZSkgewogICAgaWYgKG1heUhhdmVDaGlsZHJlbihyYXdWYWx1ZSkpIHsKICAgICAgbm9kZXNUb1Zpc2l0LnB1c2gocmF3VmFsdWUpOwogICAgfQogIH0KfQpjbGFzcyBPYmplY3RMb2FkZXIgewogIHJlZlNldCA9IG5ldyBSZWZTZXQoKTsKICBjb25zdHJ1Y3RvcihkaWN0LCBrZXlzLCB4cmVmKSB7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogICAgdGhpcy5rZXlzID0ga2V5czsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgfQogIGFzeW5jIGxvYWQoKSB7CiAgICBjb25zdCB7CiAgICAgIGtleXMsCiAgICAgIGRpY3QKICAgIH0gPSB0aGlzOwogICAgY29uc3Qgbm9kZXNUb1Zpc2l0ID0gW107CiAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7CiAgICAgIGNvbnN0IHJhd1ZhbHVlID0gZGljdC5nZXRSYXcoa2V5KTsKICAgICAgaWYgKHJhd1ZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBub2Rlc1RvVmlzaXQucHVzaChyYXdWYWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIGF3YWl0IHRoaXMuI3dhbGsobm9kZXNUb1Zpc2l0KTsKICAgIHRoaXMucmVmU2V0ID0gbnVsbDsKICB9CiAgYXN5bmMgI3dhbGsobm9kZXNUb1Zpc2l0KSB7CiAgICBjb25zdCBub2Rlc1RvUmV2aXNpdCA9IFtdOwogICAgY29uc3QgcGVuZGluZ1JlcXVlc3RzID0gW107CiAgICB3aGlsZSAobm9kZXNUb1Zpc2l0Lmxlbmd0aCkgewogICAgICBsZXQgY3VycmVudE5vZGUgPSBub2Rlc1RvVmlzaXQucG9wKCk7CiAgICAgIGlmIChjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIGlmICh0aGlzLnJlZlNldC5oYXMoY3VycmVudE5vZGUpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMucmVmU2V0LnB1dChjdXJyZW50Tm9kZSk7CiAgICAgICAgICBjdXJyZW50Tm9kZSA9IHRoaXMueHJlZi5mZXRjaChjdXJyZW50Tm9kZSk7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIGlmICghKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pKSB7CiAgICAgICAgICAgIHdhcm4oYE9iamVjdExvYWRlci4jd2FsayAtIHJlcXVlc3RpbmcgYWxsIGRhdGE6ICIke2V4fSIuYCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMueHJlZi5zdHJlYW0ubWFuYWdlci5yZXF1ZXN0QWxsQ2h1bmtzKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIG5vZGVzVG9SZXZpc2l0LnB1c2goY3VycmVudE5vZGUpOwogICAgICAgICAgcGVuZGluZ1JlcXVlc3RzLnB1c2goewogICAgICAgICAgICBiZWdpbjogZXguYmVnaW4sCiAgICAgICAgICAgIGVuZDogZXguZW5kCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnN0IGJhc2VTdHJlYW1zID0gY3VycmVudE5vZGUuZ2V0QmFzZVN0cmVhbXMoKTsKICAgICAgICBpZiAoYmFzZVN0cmVhbXMpIHsKICAgICAgICAgIGxldCBmb3VuZE1pc3NpbmdEYXRhID0gZmFsc2U7CiAgICAgICAgICBmb3IgKGNvbnN0IHN0cmVhbSBvZiBiYXNlU3RyZWFtcykgewogICAgICAgICAgICBpZiAoc3RyZWFtLmlzRGF0YUxvYWRlZCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvdW5kTWlzc2luZ0RhdGEgPSB0cnVlOwogICAgICAgICAgICBwZW5kaW5nUmVxdWVzdHMucHVzaCh7CiAgICAgICAgICAgICAgYmVnaW46IHN0cmVhbS5zdGFydCwKICAgICAgICAgICAgICBlbmQ6IHN0cmVhbS5lbmQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZm91bmRNaXNzaW5nRGF0YSkgewogICAgICAgICAgICBub2Rlc1RvUmV2aXNpdC5wdXNoKGN1cnJlbnROb2RlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgYWRkQ2hpbGRyZW4oY3VycmVudE5vZGUsIG5vZGVzVG9WaXNpdCk7CiAgICB9CiAgICBpZiAocGVuZGluZ1JlcXVlc3RzLmxlbmd0aCkgewogICAgICBhd2FpdCB0aGlzLnhyZWYuc3RyZWFtLm1hbmFnZXIucmVxdWVzdFJhbmdlcyhwZW5kaW5nUmVxdWVzdHMpOwogICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXNUb1JldmlzaXQpIHsKICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgdGhpcy5yZWZTZXQucmVtb3ZlKG5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgICBhd2FpdCB0aGlzLiN3YWxrKG5vZGVzVG9SZXZpc2l0KTsKICAgIH0KICB9CiAgc3RhdGljIGFzeW5jIGxvYWQob2JqLCBrZXlzLCB4cmVmKSB7CiAgICBpZiAoeHJlZi5zdHJlYW0uaXNEYXRhTG9hZGVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG9iakxvYWRlciA9IG5ldyBPYmplY3RMb2FkZXIob2JqLCBrZXlzLCB4cmVmKTsKICAgIGF3YWl0IG9iakxvYWRlci5sb2FkKCk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvc3ltYm9sX3V0aWxzLmpzCmNvbnN0ICRhY2NlcHRXaGl0ZXNwYWNlID0gU3ltYm9sKCk7CmNvbnN0ICRhZGRIVE1MID0gU3ltYm9sKCk7CmNvbnN0ICRhcHBlbmRDaGlsZCA9IFN5bWJvbCgpOwpjb25zdCAkY2hpbGRyZW5Ub0hUTUwgPSBTeW1ib2woKTsKY29uc3QgJGNsZWFuID0gU3ltYm9sKCk7CmNvbnN0ICRjbGVhblBhZ2UgPSBTeW1ib2woKTsKY29uc3QgJGNsZWFudXAgPSBTeW1ib2woKTsKY29uc3QgJGNsb25lID0gU3ltYm9sKCk7CmNvbnN0ICRjb25zdW1lZCA9IFN5bWJvbCgpOwpjb25zdCAkY29udGVudCA9IFN5bWJvbCgiY29udGVudCIpOwpjb25zdCAkZGF0YSA9IFN5bWJvbCgiZGF0YSIpOwpjb25zdCAkZHVtcCA9IFN5bWJvbCgpOwpjb25zdCAkZXh0cmEgPSBTeW1ib2woImV4dHJhIik7CmNvbnN0ICRmaW5hbGl6ZSA9IFN5bWJvbCgpOwpjb25zdCAkZmx1c2hIVE1MID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRBdHRyaWJ1dGVJdCA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0QXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0QXZhaWxhYmxlU3BhY2UgPSBTeW1ib2woKTsKY29uc3QgJGdldENoaWxkcmVuQnlDbGFzcyA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0Q2hpbGRyZW5CeU5hbWUgPSBTeW1ib2woKTsKY29uc3QgJGdldENoaWxkcmVuQnlOYW1lSXQgPSBTeW1ib2woKTsKY29uc3QgJGdldERhdGFWYWx1ZSA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0RXh0cmEgPSBTeW1ib2woKTsKY29uc3QgJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0ID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRDaGlsZHJlbiA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0Q29udGFpbmVkQ2hpbGRyZW4gPSBTeW1ib2woKTsKY29uc3QgJGdldE5leHRQYWdlID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRTdWJmb3JtUGFyZW50ID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRQYXJlbnQgPSBTeW1ib2woKTsKY29uc3QgJGdldFRlbXBsYXRlUm9vdCA9IFN5bWJvbCgpOwpjb25zdCAkZ2xvYmFsRGF0YSA9IFN5bWJvbCgpOwpjb25zdCAkaGFzU2V0dGFibGVWYWx1ZSA9IFN5bWJvbCgpOwpjb25zdCAkaWRzID0gU3ltYm9sKCk7CmNvbnN0ICRpbmRleE9mID0gU3ltYm9sKCk7CmNvbnN0ICRpbnNlcnRBdCA9IFN5bWJvbCgpOwpjb25zdCAkaXNDREFUQVhtbCA9IFN5bWJvbCgpOwpjb25zdCAkaXNCaW5kYWJsZSA9IFN5bWJvbCgpOwpjb25zdCAkaXNEYXRhVmFsdWUgPSBTeW1ib2woKTsKY29uc3QgJGlzRGVzY2VuZGVudCA9IFN5bWJvbCgpOwpjb25zdCAkaXNOc0Fnbm9zdGljID0gU3ltYm9sKCk7CmNvbnN0ICRpc1NwbGl0dGFibGUgPSBTeW1ib2woKTsKY29uc3QgJGlzVGhlcmVNb3JlV2lkdGggPSBTeW1ib2woKTsKY29uc3QgJGlzVHJhbnNwYXJlbnQgPSBTeW1ib2woKTsKY29uc3QgJGlzVXNhYmxlID0gU3ltYm9sKCk7CmNvbnN0ICRsYXN0QXR0cmlidXRlID0gU3ltYm9sKCk7CmNvbnN0ICRuYW1lc3BhY2VJZCA9IFN5bWJvbCgibmFtZXNwYWNlSWQiKTsKY29uc3QgJG5vZGVOYW1lID0gU3ltYm9sKCJub2RlTmFtZSIpOwpjb25zdCAkbnNBdHRyaWJ1dGVzID0gU3ltYm9sKCk7CmNvbnN0ICRvbkNoaWxkID0gU3ltYm9sKCk7CmNvbnN0ICRvbkNoaWxkQ2hlY2sgPSBTeW1ib2woKTsKY29uc3QgJG9uVGV4dCA9IFN5bWJvbCgpOwpjb25zdCAkcHVzaEdseXBocyA9IFN5bWJvbCgpOwpjb25zdCAkcG9wUGFyYSA9IFN5bWJvbCgpOwpjb25zdCAkcHVzaFBhcmEgPSBTeW1ib2woKTsKY29uc3QgJHJlbW92ZUNoaWxkID0gU3ltYm9sKCk7CmNvbnN0ICRyb290ID0gU3ltYm9sKCJyb290Iik7CmNvbnN0ICRyZXNvbHZlUHJvdG90eXBlcyA9IFN5bWJvbCgpOwpjb25zdCAkc2VhcmNoTm9kZSA9IFN5bWJvbCgpOwpjb25zdCAkc2V0SWQgPSBTeW1ib2woKTsKY29uc3QgJHNldFNldEF0dHJpYnV0ZXMgPSBTeW1ib2woKTsKY29uc3QgJHNldFZhbHVlID0gU3ltYm9sKCk7CmNvbnN0ICR0YWJJbmRleCA9IFN5bWJvbCgpOwpjb25zdCAkdGV4dCA9IFN5bWJvbCgpOwpjb25zdCAkdG9QYWdlcyA9IFN5bWJvbCgpOwpjb25zdCAkdG9IVE1MID0gU3ltYm9sKCk7CmNvbnN0ICR0b1N0cmluZyA9IFN5bWJvbCgpOwpjb25zdCAkdG9TdHlsZSA9IFN5bWJvbCgpOwpjb25zdCAkdWlkID0gU3ltYm9sKCJ1aWQiKTsKCjsvLyAuL3NyYy9jb3JlL3hmYS9uYW1lc3BhY2VzLmpzCmNvbnN0ICRidWlsZFhGQU9iamVjdCA9IFN5bWJvbCgpOwpjb25zdCBOYW1lc3BhY2VJZHMgPSB7CiAgY29uZmlnOiB7CiAgICBpZDogMCwKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hjaS8iKQogIH0sCiAgY29ubmVjdGlvblNldDogewogICAgaWQ6IDEsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtY29ubmVjdGlvbi1zZXQvIikKICB9LAogIGRhdGFzZXRzOiB7CiAgICBpZDogMiwKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hmYS1kYXRhLyIpCiAgfSwKICBmb3JtOiB7CiAgICBpZDogMywKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hmYS1mb3JtLyIpCiAgfSwKICBsb2NhbGVTZXQ6IHsKICAgIGlkOiA0LAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWxvY2FsZS1zZXQvIikKICB9LAogIHBkZjogewogICAgaWQ6IDUsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vbnMuYWRvYmUuY29tL3hkcC9wZGYvIgogIH0sCiAgc2lnbmF0dXJlOiB7CiAgICBpZDogNiwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiCiAgfSwKICBzb3VyY2VTZXQ6IHsKICAgIGlkOiA3LAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLXNvdXJjZS1zZXQvIikKICB9LAogIHN0eWxlc2hlZXQ6IHsKICAgIGlkOiA4LAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL3d3dy53My5vcmcvMTk5OS9YU0wvVHJhbnNmb3JtIgogIH0sCiAgdGVtcGxhdGU6IHsKICAgIGlkOiA5LAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLXRlbXBsYXRlLyIpCiAgfSwKICB4ZGM6IHsKICAgIGlkOiAxMCwKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hkYy8iKQogIH0sCiAgeGRwOiB7CiAgICBpZDogMTEsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vbnMuYWRvYmUuY29tL3hkcC8iCiAgfSwKICB4ZmRmOiB7CiAgICBpZDogMTIsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vbnMuYWRvYmUuY29tL3hmZGYvIgogIH0sCiAgeGh0bWw6IHsKICAgIGlkOiAxMywKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiCiAgfSwKICB4bXBtZXRhOiB7CiAgICBpZDogMTQsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vbnMuYWRvYmUuY29tL3htcG1ldGEvIgogIH0KfTsKCjsvLyAuL3NyYy9jb3JlL3hmYS91dGlscy5qcwoKY29uc3QgZGltQ29udmVydGVycyA9IHsKICBwdDogeCA9PiB4LAogIGNtOiB4ID0+IHggLyAyLjU0ICogNzIsCiAgbW06IHggPT4geCAvICgxMCAqIDIuNTQpICogNzIsCiAgaW46IHggPT4geCAqIDcyLAogIHB4OiB4ID0+IHgKfTsKY29uc3QgbWVhc3VyZW1lbnRQYXR0ZXJuID0gLyhbKy1dP1xkK1wuP1xkKikoLiopLzsKZnVuY3Rpb24gc3RyaXBRdW90ZXMoc3RyKSB7CiAgaWYgKHN0ci5zdGFydHNXaXRoKCInIikgfHwgc3RyLnN0YXJ0c1dpdGgoJyInKSkgewogICAgcmV0dXJuIHN0ci5zbGljZSgxLCAtMSk7CiAgfQogIHJldHVybiBzdHI7Cn0KZnVuY3Rpb24gZ2V0SW50ZWdlcih7CiAgZGF0YSwKICBkZWZhdWx0VmFsdWUsCiAgdmFsaWRhdGUKfSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKICB9CiAgZGF0YSA9IGRhdGEudHJpbSgpOwogIGNvbnN0IG4gPSBwYXJzZUludChkYXRhLCAxMCk7CiAgaWYgKCFpc05hTihuKSAmJiB2YWxpZGF0ZShuKSkgewogICAgcmV0dXJuIG47CiAgfQogIHJldHVybiBkZWZhdWx0VmFsdWU7Cn0KZnVuY3Rpb24gZ2V0RmxvYXQoewogIGRhdGEsCiAgZGVmYXVsdFZhbHVlLAogIHZhbGlkYXRlCn0pIHsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiBkZWZhdWx0VmFsdWU7CiAgfQogIGRhdGEgPSBkYXRhLnRyaW0oKTsKICBjb25zdCBuID0gcGFyc2VGbG9hdChkYXRhKTsKICBpZiAoIWlzTmFOKG4pICYmIHZhbGlkYXRlKG4pKSB7CiAgICByZXR1cm4gbjsKICB9CiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfQpmdW5jdGlvbiBnZXRLZXl3b3JkKHsKICBkYXRhLAogIGRlZmF1bHRWYWx1ZSwKICB2YWxpZGF0ZQp9KSB7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogIH0KICBkYXRhID0gZGF0YS50cmltKCk7CiAgaWYgKHZhbGlkYXRlKGRhdGEpKSB7CiAgICByZXR1cm4gZGF0YTsKICB9CiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfQpmdW5jdGlvbiBnZXRTdHJpbmdPcHRpb24oZGF0YSwgb3B0aW9ucykgewogIHJldHVybiBnZXRLZXl3b3JkKHsKICAgIGRhdGEsCiAgICBkZWZhdWx0VmFsdWU6IG9wdGlvbnNbMF0sCiAgICB2YWxpZGF0ZTogayA9PiBvcHRpb25zLmluY2x1ZGVzKGspCiAgfSk7Cn0KZnVuY3Rpb24gZ2V0TWVhc3VyZW1lbnQoc3RyLCBkZWYgPSAiMCIpIHsKICBkZWYgfHw9ICIwIjsKICBpZiAoIXN0cikgewogICAgcmV0dXJuIGdldE1lYXN1cmVtZW50KGRlZik7CiAgfQogIGNvbnN0IG1hdGNoID0gc3RyLnRyaW0oKS5tYXRjaChtZWFzdXJlbWVudFBhdHRlcm4pOwogIGlmICghbWF0Y2gpIHsKICAgIHJldHVybiBnZXRNZWFzdXJlbWVudChkZWYpOwogIH0KICBjb25zdCBbLCB2YWx1ZVN0ciwgdW5pdF0gPSBtYXRjaDsKICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWVTdHIpOwogIGlmIChpc05hTih2YWx1ZSkpIHsKICAgIHJldHVybiBnZXRNZWFzdXJlbWVudChkZWYpOwogIH0KICBpZiAodmFsdWUgPT09IDApIHsKICAgIHJldHVybiAwOwogIH0KICBjb25zdCBjb252ID0gZGltQ29udmVydGVyc1t1bml0XTsKICBpZiAoY29udikgewogICAgcmV0dXJuIGNvbnYodmFsdWUpOwogIH0KICByZXR1cm4gdmFsdWU7Cn0KZnVuY3Rpb24gZ2V0UmF0aW8oZGF0YSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIHsKICAgICAgbnVtOiAxLAogICAgICBkZW46IDEKICAgIH07CiAgfQogIGNvbnN0IHJhdGlvID0gZGF0YS5zcGxpdCgiOiIsIDIpLm1hcCh4ID0+IHBhcnNlRmxvYXQoeC50cmltKCkpKS5maWx0ZXIoeCA9PiAhaXNOYU4oeCkpOwogIGlmIChyYXRpby5sZW5ndGggPT09IDEpIHsKICAgIHJhdGlvLnB1c2goMSk7CiAgfQogIGlmIChyYXRpby5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIG51bTogMSwKICAgICAgZGVuOiAxCiAgICB9OwogIH0KICBjb25zdCBbbnVtLCBkZW5dID0gcmF0aW87CiAgcmV0dXJuIHsKICAgIG51bSwKICAgIGRlbgogIH07Cn0KZnVuY3Rpb24gZ2V0UmVsZXZhbnQoZGF0YSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIFtdOwogIH0KICByZXR1cm4gZGF0YS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcChlID0+ICh7CiAgICBleGNsdWRlZDogZVswXSA9PT0gIi0iLAogICAgdmlld25hbWU6IGUuc3Vic3RyaW5nKDEpCiAgfSkpOwp9CmZ1bmN0aW9uIGdldENvbG9yKGRhdGEsIGRlZiA9IFswLCAwLCAwXSkgewogIGxldCBbciwgZywgYl0gPSBkZWY7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gewogICAgICByLAogICAgICBnLAogICAgICBiCiAgICB9OwogIH0KICBjb25zdCBjb2xvciA9IGRhdGEuc3BsaXQoIiwiLCAzKS5tYXAoYyA9PiBNYXRoQ2xhbXAocGFyc2VJbnQoYy50cmltKCksIDEwKSwgMCwgMjU1KSkubWFwKGMgPT4gaXNOYU4oYykgPyAwIDogYyk7CiAgaWYgKGNvbG9yLmxlbmd0aCA8IDMpIHsKICAgIHJldHVybiB7CiAgICAgIHIsCiAgICAgIGcsCiAgICAgIGIKICAgIH07CiAgfQogIFtyLCBnLCBiXSA9IGNvbG9yOwogIHJldHVybiB7CiAgICByLAogICAgZywKICAgIGIKICB9Owp9CmZ1bmN0aW9uIGdldEJCb3goZGF0YSkgewogIGNvbnN0IGRlZiA9IC0xOwogIGlmICghZGF0YSkgewogICAgcmV0dXJuIHsKICAgICAgeDogZGVmLAogICAgICB5OiBkZWYsCiAgICAgIHdpZHRoOiBkZWYsCiAgICAgIGhlaWdodDogZGVmCiAgICB9OwogIH0KICBjb25zdCBiYm94ID0gZGF0YS5zcGxpdCgiLCIsIDQpLm1hcChtID0+IGdldE1lYXN1cmVtZW50KG0udHJpbSgpLCAiLTEiKSk7CiAgaWYgKGJib3gubGVuZ3RoIDwgNCB8fCBiYm94WzJdIDwgMCB8fCBiYm94WzNdIDwgMCkgewogICAgcmV0dXJuIHsKICAgICAgeDogZGVmLAogICAgICB5OiBkZWYsCiAgICAgIHdpZHRoOiBkZWYsCiAgICAgIGhlaWdodDogZGVmCiAgICB9OwogIH0KICBjb25zdCBbeCwgeSwgd2lkdGgsIGhlaWdodF0gPSBiYm94OwogIHJldHVybiB7CiAgICB4LAogICAgeSwKICAgIHdpZHRoLAogICAgaGVpZ2h0CiAgfTsKfQpjbGFzcyBIVE1MUmVzdWx0IHsKICBzdGF0aWMgZ2V0IEZBSUxVUkUoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJGQUlMVVJFIiwgbmV3IEhUTUxSZXN1bHQoZmFsc2UsIG51bGwsIG51bGwsIG51bGwpKTsKICB9CiAgc3RhdGljIGdldCBFTVBUWSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIkVNUFRZIiwgbmV3IEhUTUxSZXN1bHQodHJ1ZSwgbnVsbCwgbnVsbCwgbnVsbCkpOwogIH0KICBjb25zdHJ1Y3RvcihzdWNjZXNzLCBodG1sLCBiYm94LCBicmVha05vZGUpIHsKICAgIHRoaXMuc3VjY2VzcyA9IHN1Y2Nlc3M7CiAgICB0aGlzLmh0bWwgPSBodG1sOwogICAgdGhpcy5iYm94ID0gYmJveDsKICAgIHRoaXMuYnJlYWtOb2RlID0gYnJlYWtOb2RlOwogIH0KICBpc0JyZWFrKCkgewogICAgcmV0dXJuICEhdGhpcy5icmVha05vZGU7CiAgfQogIHN0YXRpYyBicmVha05vZGUobm9kZSkgewogICAgcmV0dXJuIG5ldyBIVE1MUmVzdWx0KGZhbHNlLCBudWxsLCBudWxsLCBub2RlKTsKICB9CiAgc3RhdGljIHN1Y2Nlc3MoaHRtbCwgYmJveCA9IG51bGwpIHsKICAgIHJldHVybiBuZXcgSFRNTFJlc3VsdCh0cnVlLCBodG1sLCBiYm94LCBudWxsKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9mb250cy5qcwoKCgpjbGFzcyBGb250RmluZGVyIHsKICBjb25zdHJ1Y3RvcihwZGZGb250cykgewogICAgdGhpcy5mb250cyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuY2FjaGUgPSBuZXcgTWFwKCk7CiAgICB0aGlzLndhcm5lZCA9IG5ldyBTZXQoKTsKICAgIHRoaXMuZGVmYXVsdEZvbnQgPSBudWxsOwogICAgdGhpcy5hZGQocGRmRm9udHMpOwogIH0KICBhZGQocGRmRm9udHMsIHJlYWxseU1pc3NpbmdGb250cyA9IG51bGwpIHsKICAgIGZvciAoY29uc3QgcGRmRm9udCBvZiBwZGZGb250cykgewogICAgICB0aGlzLmFkZFBkZkZvbnQocGRmRm9udCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHBkZkZvbnQgb2YgdGhpcy5mb250cy52YWx1ZXMoKSkgewogICAgICBpZiAoIXBkZkZvbnQucmVndWxhcikgewogICAgICAgIHBkZkZvbnQucmVndWxhciA9IHBkZkZvbnQuaXRhbGljIHx8IHBkZkZvbnQuYm9sZCB8fCBwZGZGb250LmJvbGRpdGFsaWM7CiAgICAgIH0KICAgIH0KICAgIGlmICghcmVhbGx5TWlzc2luZ0ZvbnRzIHx8IHJlYWxseU1pc3NpbmdGb250cy5zaXplID09PSAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG15cmlhZCA9IHRoaXMuZm9udHMuZ2V0KCJQZGZKUy1GYWxsYmFjay1QZGZKUy1YRkEiKTsKICAgIGZvciAoY29uc3QgbWlzc2luZyBvZiByZWFsbHlNaXNzaW5nRm9udHMpIHsKICAgICAgdGhpcy5mb250cy5zZXQobWlzc2luZywgbXlyaWFkKTsKICAgIH0KICB9CiAgYWRkUGRmRm9udChwZGZGb250KSB7CiAgICBjb25zdCBjc3NGb250SW5mbyA9IHBkZkZvbnQuY3NzRm9udEluZm87CiAgICBjb25zdCBuYW1lID0gY3NzRm9udEluZm8uZm9udEZhbWlseTsKICAgIGxldCBmb250ID0gdGhpcy5mb250cy5nZXQobmFtZSk7CiAgICBpZiAoIWZvbnQpIHsKICAgICAgZm9udCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHRoaXMuZm9udHMuc2V0KG5hbWUsIGZvbnQpOwogICAgICBpZiAoIXRoaXMuZGVmYXVsdEZvbnQpIHsKICAgICAgICB0aGlzLmRlZmF1bHRGb250ID0gZm9udDsKICAgICAgfQogICAgfQogICAgbGV0IHByb3BlcnR5ID0gIiI7CiAgICBjb25zdCBmb250V2VpZ2h0ID0gcGFyc2VGbG9hdChjc3NGb250SW5mby5mb250V2VpZ2h0KTsKICAgIGlmIChwYXJzZUZsb2F0KGNzc0ZvbnRJbmZvLml0YWxpY0FuZ2xlKSAhPT0gMCkgewogICAgICBwcm9wZXJ0eSA9IGZvbnRXZWlnaHQgPj0gNzAwID8gImJvbGRpdGFsaWMiIDogIml0YWxpYyI7CiAgICB9IGVsc2UgaWYgKGZvbnRXZWlnaHQgPj0gNzAwKSB7CiAgICAgIHByb3BlcnR5ID0gImJvbGQiOwogICAgfQogICAgaWYgKCFwcm9wZXJ0eSkgewogICAgICBpZiAocGRmRm9udC5uYW1lLmluY2x1ZGVzKCJCb2xkIikgfHwgcGRmRm9udC5wc05hbWU/LmluY2x1ZGVzKCJCb2xkIikpIHsKICAgICAgICBwcm9wZXJ0eSA9ICJib2xkIjsKICAgICAgfQogICAgICBpZiAocGRmRm9udC5uYW1lLmluY2x1ZGVzKCJJdGFsaWMiKSB8fCBwZGZGb250Lm5hbWUuZW5kc1dpdGgoIkl0IikgfHwgcGRmRm9udC5wc05hbWU/LmluY2x1ZGVzKCJJdGFsaWMiKSB8fCBwZGZGb250LnBzTmFtZT8uZW5kc1dpdGgoIkl0IikpIHsKICAgICAgICBwcm9wZXJ0eSArPSAiaXRhbGljIjsKICAgICAgfQogICAgfQogICAgaWYgKCFwcm9wZXJ0eSkgewogICAgICBwcm9wZXJ0eSA9ICJyZWd1bGFyIjsKICAgIH0KICAgIGZvbnRbcHJvcGVydHldID0gcGRmRm9udDsKICB9CiAgZ2V0RGVmYXVsdCgpIHsKICAgIHJldHVybiB0aGlzLmRlZmF1bHRGb250OwogIH0KICBmaW5kKGZvbnROYW1lLCBtdXN0V2FybiA9IHRydWUpIHsKICAgIGxldCBmb250ID0gdGhpcy5mb250cy5nZXQoZm9udE5hbWUpIHx8IHRoaXMuY2FjaGUuZ2V0KGZvbnROYW1lKTsKICAgIGlmIChmb250KSB7CiAgICAgIHJldHVybiBmb250OwogICAgfQogICAgY29uc3QgcGF0dGVybiA9IC8sfC18X3wgfGJvbGRpdGFsaWN8Ym9sZHxpdGFsaWN8cmVndWxhcnxpdC9naTsKICAgIGxldCBuYW1lID0gZm9udE5hbWUucmVwbGFjZUFsbChwYXR0ZXJuLCAiIik7CiAgICBmb250ID0gdGhpcy5mb250cy5nZXQobmFtZSk7CiAgICBpZiAoZm9udCkgewogICAgICB0aGlzLmNhY2hlLnNldChmb250TmFtZSwgZm9udCk7CiAgICAgIHJldHVybiBmb250OwogICAgfQogICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIGNvbnN0IG1heWJlID0gW107CiAgICBmb3IgKGNvbnN0IFtmYW1pbHksIHBkZkZvbnRdIG9mIHRoaXMuZm9udHMuZW50cmllcygpKSB7CiAgICAgIGlmIChmYW1pbHkucmVwbGFjZUFsbChwYXR0ZXJuLCAiIikudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKG5hbWUpKSB7CiAgICAgICAgbWF5YmUucHVzaChwZGZGb250KTsKICAgICAgfQogICAgfQogICAgaWYgKG1heWJlLmxlbmd0aCA9PT0gMCkgewogICAgICBmb3IgKGNvbnN0IFssIHBkZkZvbnRdIG9mIHRoaXMuZm9udHMuZW50cmllcygpKSB7CiAgICAgICAgaWYgKHBkZkZvbnQucmVndWxhci5uYW1lPy5yZXBsYWNlQWxsKHBhdHRlcm4sICIiKS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgobmFtZSkpIHsKICAgICAgICAgIG1heWJlLnB1c2gocGRmRm9udCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobWF5YmUubGVuZ3RoID09PSAwKSB7CiAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2VBbGwoL3BzbXR8bXQvZ2ksICIiKTsKICAgICAgZm9yIChjb25zdCBbZmFtaWx5LCBwZGZGb250XSBvZiB0aGlzLmZvbnRzLmVudHJpZXMoKSkgewogICAgICAgIGlmIChmYW1pbHkucmVwbGFjZUFsbChwYXR0ZXJuLCAiIikudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKG5hbWUpKSB7CiAgICAgICAgICBtYXliZS5wdXNoKHBkZkZvbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG1heWJlLmxlbmd0aCA9PT0gMCkgewogICAgICBmb3IgKGNvbnN0IHBkZkZvbnQgb2YgdGhpcy5mb250cy52YWx1ZXMoKSkgewogICAgICAgIGlmIChwZGZGb250LnJlZ3VsYXIubmFtZT8ucmVwbGFjZUFsbChwYXR0ZXJuLCAiIikudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKG5hbWUpKSB7CiAgICAgICAgICBtYXliZS5wdXNoKHBkZkZvbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG1heWJlLmxlbmd0aCA+PSAxKSB7CiAgICAgIGlmIChtYXliZS5sZW5ndGggIT09IDEgJiYgbXVzdFdhcm4pIHsKICAgICAgICB3YXJuKGBYRkEgLSBUb28gbWFueSBjaG9pY2VzIHRvIGd1ZXNzIHRoZSBjb3JyZWN0IGZvbnQ6ICR7Zm9udE5hbWV9YCk7CiAgICAgIH0KICAgICAgdGhpcy5jYWNoZS5zZXQoZm9udE5hbWUsIG1heWJlWzBdKTsKICAgICAgcmV0dXJuIG1heWJlWzBdOwogICAgfQogICAgaWYgKG11c3RXYXJuICYmICF0aGlzLndhcm5lZC5oYXMoZm9udE5hbWUpKSB7CiAgICAgIHRoaXMud2FybmVkLmFkZChmb250TmFtZSk7CiAgICAgIHdhcm4oYFhGQSAtIENhbm5vdCBmaW5kIHRoZSBmb250OiAke2ZvbnROYW1lfWApOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQp9CmZ1bmN0aW9uIHNlbGVjdEZvbnQoeGZhRm9udCwgdHlwZWZhY2UpIHsKICBpZiAoeGZhRm9udC5wb3N0dXJlID09PSAiaXRhbGljIikgewogICAgaWYgKHhmYUZvbnQud2VpZ2h0ID09PSAiYm9sZCIpIHsKICAgICAgcmV0dXJuIHR5cGVmYWNlLmJvbGRpdGFsaWM7CiAgICB9CiAgICByZXR1cm4gdHlwZWZhY2UuaXRhbGljOwogIH0gZWxzZSBpZiAoeGZhRm9udC53ZWlnaHQgPT09ICJib2xkIikgewogICAgcmV0dXJuIHR5cGVmYWNlLmJvbGQ7CiAgfQogIHJldHVybiB0eXBlZmFjZS5yZWd1bGFyOwp9CmZ1bmN0aW9uIGZvbnRzX2dldE1ldHJpY3MoeGZhRm9udCwgcmVhbCA9IGZhbHNlKSB7CiAgbGV0IHBkZkZvbnQgPSBudWxsOwogIGlmICh4ZmFGb250KSB7CiAgICBjb25zdCBuYW1lID0gc3RyaXBRdW90ZXMoeGZhRm9udC50eXBlZmFjZSk7CiAgICBjb25zdCB0eXBlZmFjZSA9IHhmYUZvbnRbJGdsb2JhbERhdGFdLmZvbnRGaW5kZXIuZmluZChuYW1lKTsKICAgIHBkZkZvbnQgPSBzZWxlY3RGb250KHhmYUZvbnQsIHR5cGVmYWNlKTsKICB9CiAgaWYgKCFwZGZGb250KSB7CiAgICByZXR1cm4gewogICAgICBsaW5lSGVpZ2h0OiAxMiwKICAgICAgbGluZUdhcDogMiwKICAgICAgbGluZU5vR2FwOiAxMAogICAgfTsKICB9CiAgY29uc3Qgc2l6ZSA9IHhmYUZvbnQuc2l6ZSB8fCAxMDsKICBjb25zdCBsaW5lSGVpZ2h0ID0gcGRmRm9udC5saW5lSGVpZ2h0ID8gTWF0aC5tYXgocmVhbCA/IDAgOiAxLjIsIHBkZkZvbnQubGluZUhlaWdodCkgOiAxLjI7CiAgY29uc3QgbGluZUdhcCA9IHBkZkZvbnQubGluZUdhcCA9PT0gdW5kZWZpbmVkID8gMC4yIDogcGRmRm9udC5saW5lR2FwOwogIHJldHVybiB7CiAgICBsaW5lSGVpZ2h0OiBsaW5lSGVpZ2h0ICogc2l6ZSwKICAgIGxpbmVHYXA6IGxpbmVHYXAgKiBzaXplLAogICAgbGluZU5vR2FwOiBNYXRoLm1heCgxLCBsaW5lSGVpZ2h0IC0gbGluZUdhcCkgKiBzaXplCiAgfTsKfQoKOy8vIC4vc3JjL2NvcmUveGZhL3RleHQuanMKCmNvbnN0IFdJRFRIX0ZBQ1RPUiA9IDEuMDI7CmNsYXNzIHRleHRfRm9udEluZm8gewogIGNvbnN0cnVjdG9yKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCwgZm9udEZpbmRlcikgewogICAgdGhpcy5saW5lSGVpZ2h0ID0gbGluZUhlaWdodDsKICAgIHRoaXMucGFyYU1hcmdpbiA9IG1hcmdpbiB8fCB7CiAgICAgIHRvcDogMCwKICAgICAgYm90dG9tOiAwLAogICAgICBsZWZ0OiAwLAogICAgICByaWdodDogMAogICAgfTsKICAgIGlmICgheGZhRm9udCkgewogICAgICBbdGhpcy5wZGZGb250LCB0aGlzLnhmYUZvbnRdID0gdGhpcy5kZWZhdWx0Rm9udChmb250RmluZGVyKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy54ZmFGb250ID0gewogICAgICB0eXBlZmFjZTogeGZhRm9udC50eXBlZmFjZSwKICAgICAgcG9zdHVyZTogeGZhRm9udC5wb3N0dXJlLAogICAgICB3ZWlnaHQ6IHhmYUZvbnQud2VpZ2h0LAogICAgICBzaXplOiB4ZmFGb250LnNpemUsCiAgICAgIGxldHRlclNwYWNpbmc6IHhmYUZvbnQubGV0dGVyU3BhY2luZwogICAgfTsKICAgIGNvbnN0IHR5cGVmYWNlID0gZm9udEZpbmRlci5maW5kKHhmYUZvbnQudHlwZWZhY2UpOwogICAgaWYgKCF0eXBlZmFjZSkgewogICAgICBbdGhpcy5wZGZGb250LCB0aGlzLnhmYUZvbnRdID0gdGhpcy5kZWZhdWx0Rm9udChmb250RmluZGVyKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wZGZGb250ID0gc2VsZWN0Rm9udCh4ZmFGb250LCB0eXBlZmFjZSk7CiAgICBpZiAoIXRoaXMucGRmRm9udCkgewogICAgICBbdGhpcy5wZGZGb250LCB0aGlzLnhmYUZvbnRdID0gdGhpcy5kZWZhdWx0Rm9udChmb250RmluZGVyKTsKICAgIH0KICB9CiAgZGVmYXVsdEZvbnQoZm9udEZpbmRlcikgewogICAgY29uc3QgZm9udCA9IGZvbnRGaW5kZXIuZmluZCgiSGVsdmV0aWNhIiwgZmFsc2UpIHx8IGZvbnRGaW5kZXIuZmluZCgiTXlyaWFkIFBybyIsIGZhbHNlKSB8fCBmb250RmluZGVyLmZpbmQoIkFyaWFsIiwgZmFsc2UpIHx8IGZvbnRGaW5kZXIuZ2V0RGVmYXVsdCgpOwogICAgaWYgKGZvbnQ/LnJlZ3VsYXIpIHsKICAgICAgY29uc3QgcGRmRm9udCA9IGZvbnQucmVndWxhcjsKICAgICAgY29uc3QgaW5mbyA9IHBkZkZvbnQuY3NzRm9udEluZm87CiAgICAgIGNvbnN0IHhmYUZvbnQgPSB7CiAgICAgICAgdHlwZWZhY2U6IGluZm8uZm9udEZhbWlseSwKICAgICAgICBwb3N0dXJlOiAibm9ybWFsIiwKICAgICAgICB3ZWlnaHQ6ICJub3JtYWwiLAogICAgICAgIHNpemU6IDEwLAogICAgICAgIGxldHRlclNwYWNpbmc6IDAKICAgICAgfTsKICAgICAgcmV0dXJuIFtwZGZGb250LCB4ZmFGb250XTsKICAgIH0KICAgIGNvbnN0IHhmYUZvbnQgPSB7CiAgICAgIHR5cGVmYWNlOiAiQ291cmllciIsCiAgICAgIHBvc3R1cmU6ICJub3JtYWwiLAogICAgICB3ZWlnaHQ6ICJub3JtYWwiLAogICAgICBzaXplOiAxMCwKICAgICAgbGV0dGVyU3BhY2luZzogMAogICAgfTsKICAgIHJldHVybiBbbnVsbCwgeGZhRm9udF07CiAgfQp9CmNsYXNzIEZvbnRTZWxlY3RvciB7CiAgY29uc3RydWN0b3IoZGVmYXVsdFhmYUZvbnQsIGRlZmF1bHRQYXJhTWFyZ2luLCBkZWZhdWx0TGluZUhlaWdodCwgZm9udEZpbmRlcikgewogICAgdGhpcy5mb250RmluZGVyID0gZm9udEZpbmRlcjsKICAgIHRoaXMuc3RhY2sgPSBbbmV3IHRleHRfRm9udEluZm8oZGVmYXVsdFhmYUZvbnQsIGRlZmF1bHRQYXJhTWFyZ2luLCBkZWZhdWx0TGluZUhlaWdodCwgZm9udEZpbmRlcildOwogIH0KICBwdXNoRGF0YSh4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQpIHsKICAgIGNvbnN0IGxhc3RGb250ID0gdGhpcy5zdGFjay5hdCgtMSk7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgWyJ0eXBlZmFjZSIsICJwb3N0dXJlIiwgIndlaWdodCIsICJzaXplIiwgImxldHRlclNwYWNpbmciXSkgewogICAgICBpZiAoIXhmYUZvbnRbbmFtZV0pIHsKICAgICAgICB4ZmFGb250W25hbWVdID0gbGFzdEZvbnQueGZhRm9udFtuYW1lXTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIFsidG9wIiwgImJvdHRvbSIsICJsZWZ0IiwgInJpZ2h0Il0pIHsKICAgICAgaWYgKGlzTmFOKG1hcmdpbltuYW1lXSkpIHsKICAgICAgICBtYXJnaW5bbmFtZV0gPSBsYXN0Rm9udC5wYXJhTWFyZ2luW25hbWVdOwogICAgICB9CiAgICB9CiAgICBjb25zdCBmb250SW5mbyA9IG5ldyB0ZXh0X0ZvbnRJbmZvKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCB8fCBsYXN0Rm9udC5saW5lSGVpZ2h0LCB0aGlzLmZvbnRGaW5kZXIpOwogICAgaWYgKCFmb250SW5mby5wZGZGb250KSB7CiAgICAgIGZvbnRJbmZvLnBkZkZvbnQgPSBsYXN0Rm9udC5wZGZGb250OwogICAgfQogICAgdGhpcy5zdGFjay5wdXNoKGZvbnRJbmZvKTsKICB9CiAgcG9wRm9udCgpIHsKICAgIHRoaXMuc3RhY2sucG9wKCk7CiAgfQogIHRvcEZvbnQoKSB7CiAgICByZXR1cm4gdGhpcy5zdGFjay5hdCgtMSk7CiAgfQp9CmNsYXNzIFRleHRNZWFzdXJlIHsKICBjb25zdHJ1Y3RvcihkZWZhdWx0WGZhRm9udCwgZGVmYXVsdFBhcmFNYXJnaW4sIGRlZmF1bHRMaW5lSGVpZ2h0LCBmb250cykgewogICAgdGhpcy5nbHlwaHMgPSBbXTsKICAgIHRoaXMuZm9udFNlbGVjdG9yID0gbmV3IEZvbnRTZWxlY3RvcihkZWZhdWx0WGZhRm9udCwgZGVmYXVsdFBhcmFNYXJnaW4sIGRlZmF1bHRMaW5lSGVpZ2h0LCBmb250cyk7CiAgICB0aGlzLmV4dHJhSGVpZ2h0ID0gMDsKICB9CiAgcHVzaERhdGEoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0KSB7CiAgICB0aGlzLmZvbnRTZWxlY3Rvci5wdXNoRGF0YSh4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQpOwogIH0KICBwb3BGb250KHhmYUZvbnQpIHsKICAgIHJldHVybiB0aGlzLmZvbnRTZWxlY3Rvci5wb3BGb250KCk7CiAgfQogIGFkZFBhcmEoKSB7CiAgICBjb25zdCBsYXN0Rm9udCA9IHRoaXMuZm9udFNlbGVjdG9yLnRvcEZvbnQoKTsKICAgIHRoaXMuZXh0cmFIZWlnaHQgKz0gbGFzdEZvbnQucGFyYU1hcmdpbi50b3AgKyBsYXN0Rm9udC5wYXJhTWFyZ2luLmJvdHRvbTsKICB9CiAgYWRkU3RyaW5nKHN0cikgewogICAgaWYgKCFzdHIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbGFzdEZvbnQgPSB0aGlzLmZvbnRTZWxlY3Rvci50b3BGb250KCk7CiAgICBjb25zdCBmb250U2l6ZSA9IGxhc3RGb250LnhmYUZvbnQuc2l6ZTsKICAgIGlmIChsYXN0Rm9udC5wZGZGb250KSB7CiAgICAgIGNvbnN0IGxldHRlclNwYWNpbmcgPSBsYXN0Rm9udC54ZmFGb250LmxldHRlclNwYWNpbmc7CiAgICAgIGNvbnN0IHBkZkZvbnQgPSBsYXN0Rm9udC5wZGZGb250OwogICAgICBjb25zdCBmb250TGluZUhlaWdodCA9IHBkZkZvbnQubGluZUhlaWdodCB8fCAxLjI7CiAgICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBsYXN0Rm9udC5saW5lSGVpZ2h0IHx8IE1hdGgubWF4KDEuMiwgZm9udExpbmVIZWlnaHQpICogZm9udFNpemU7CiAgICAgIGNvbnN0IGxpbmVHYXAgPSBwZGZGb250LmxpbmVHYXAgPT09IHVuZGVmaW5lZCA/IDAuMiA6IHBkZkZvbnQubGluZUdhcDsKICAgICAgY29uc3Qgbm9HYXAgPSBmb250TGluZUhlaWdodCAtIGxpbmVHYXA7CiAgICAgIGNvbnN0IGZpcnN0TGluZUhlaWdodCA9IE1hdGgubWF4KDEsIG5vR2FwKSAqIGZvbnRTaXplOwogICAgICBjb25zdCBzY2FsZSA9IGZvbnRTaXplIC8gMTAwMDsKICAgICAgY29uc3QgZmFsbGJhY2tXaWR0aCA9IHBkZkZvbnQuZGVmYXVsdFdpZHRoIHx8IHBkZkZvbnQuY2hhcnNUb0dseXBocygiICIpWzBdLndpZHRoOwogICAgICBmb3IgKGNvbnN0IGxpbmUgb2Ygc3RyLnNwbGl0KC9bXHUyMDI5XG5dLykpIHsKICAgICAgICBjb25zdCBlbmNvZGVkTGluZSA9IHBkZkZvbnQuZW5jb2RlU3RyaW5nKGxpbmUpLmpvaW4oIiIpOwogICAgICAgIGNvbnN0IGdseXBocyA9IHBkZkZvbnQuY2hhcnNUb0dseXBocyhlbmNvZGVkTGluZSk7CiAgICAgICAgZm9yIChjb25zdCBnbHlwaCBvZiBnbHlwaHMpIHsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gZ2x5cGgud2lkdGggfHwgZmFsbGJhY2tXaWR0aDsKICAgICAgICAgIHRoaXMuZ2x5cGhzLnB1c2goW3dpZHRoICogc2NhbGUgKyBsZXR0ZXJTcGFjaW5nLCBsaW5lSGVpZ2h0LCBmaXJzdExpbmVIZWlnaHQsIGdseXBoLnVuaWNvZGUsIGZhbHNlXSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2x5cGhzLnB1c2goWzAsIDAsIDAsICJcbiIsIHRydWVdKTsKICAgICAgfQogICAgICB0aGlzLmdseXBocy5wb3AoKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBsaW5lIG9mIHN0ci5zcGxpdCgvW1x1MjAyOVxuXS8pKSB7CiAgICAgIGZvciAoY29uc3QgY2hhciBvZiBsaW5lLnNwbGl0KCIiKSkgewogICAgICAgIHRoaXMuZ2x5cGhzLnB1c2goW2ZvbnRTaXplLCAxLjIgKiBmb250U2l6ZSwgZm9udFNpemUsIGNoYXIsIGZhbHNlXSk7CiAgICAgIH0KICAgICAgdGhpcy5nbHlwaHMucHVzaChbMCwgMCwgMCwgIlxuIiwgdHJ1ZV0pOwogICAgfQogICAgdGhpcy5nbHlwaHMucG9wKCk7CiAgfQogIGNvbXB1dGUobWF4V2lkdGgpIHsKICAgIGxldCBsYXN0U3BhY2VQb3MgPSAtMSwKICAgICAgbGFzdFNwYWNlV2lkdGggPSAwLAogICAgICB3aWR0aCA9IDAsCiAgICAgIGhlaWdodCA9IDAsCiAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSAwLAogICAgICBjdXJyZW50TGluZUhlaWdodCA9IDA7CiAgICBsZXQgaXNCcm9rZW4gPSBmYWxzZTsKICAgIGxldCBpc0ZpcnN0TGluZSA9IHRydWU7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLmdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IFtnbHlwaFdpZHRoLCBsaW5lSGVpZ2h0LCBmaXJzdExpbmVIZWlnaHQsIGNoYXIsIGlzRU9MXSA9IHRoaXMuZ2x5cGhzW2ldOwogICAgICBjb25zdCBpc1NwYWNlID0gY2hhciA9PT0gIiAiOwogICAgICBjb25zdCBnbHlwaEhlaWdodCA9IGlzRmlyc3RMaW5lID8gZmlyc3RMaW5lSGVpZ2h0IDogbGluZUhlaWdodDsKICAgICAgaWYgKGlzRU9MKSB7CiAgICAgICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgY3VycmVudExpbmVXaWR0aCk7CiAgICAgICAgY3VycmVudExpbmVXaWR0aCA9IDA7CiAgICAgICAgaGVpZ2h0ICs9IGN1cnJlbnRMaW5lSGVpZ2h0OwogICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7CiAgICAgICAgbGFzdFNwYWNlUG9zID0gLTE7CiAgICAgICAgbGFzdFNwYWNlV2lkdGggPSAwOwogICAgICAgIGlzRmlyc3RMaW5lID0gZmFsc2U7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGlzU3BhY2UpIHsKICAgICAgICBpZiAoY3VycmVudExpbmVXaWR0aCArIGdseXBoV2lkdGggPiBtYXhXaWR0aCkgewogICAgICAgICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgY3VycmVudExpbmVXaWR0aCk7CiAgICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gMDsKICAgICAgICAgIGhlaWdodCArPSBjdXJyZW50TGluZUhlaWdodDsKICAgICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7CiAgICAgICAgICBsYXN0U3BhY2VQb3MgPSAtMTsKICAgICAgICAgIGxhc3RTcGFjZVdpZHRoID0gMDsKICAgICAgICAgIGlzQnJva2VuID0gdHJ1ZTsKICAgICAgICAgIGlzRmlyc3RMaW5lID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gTWF0aC5tYXgoZ2x5cGhIZWlnaHQsIGN1cnJlbnRMaW5lSGVpZ2h0KTsKICAgICAgICAgIGxhc3RTcGFjZVdpZHRoID0gY3VycmVudExpbmVXaWR0aDsKICAgICAgICAgIGN1cnJlbnRMaW5lV2lkdGggKz0gZ2x5cGhXaWR0aDsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IGk7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjdXJyZW50TGluZVdpZHRoICsgZ2x5cGhXaWR0aCA+IG1heFdpZHRoKSB7CiAgICAgICAgaGVpZ2h0ICs9IGN1cnJlbnRMaW5lSGVpZ2h0OwogICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7CiAgICAgICAgaWYgKGxhc3RTcGFjZVBvcyAhPT0gLTEpIHsKICAgICAgICAgIGkgPSBsYXN0U3BhY2VQb3M7CiAgICAgICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBsYXN0U3BhY2VXaWR0aCk7CiAgICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gMDsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IC0xOwogICAgICAgICAgbGFzdFNwYWNlV2lkdGggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBjdXJyZW50TGluZVdpZHRoKTsKICAgICAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSBnbHlwaFdpZHRoOwogICAgICAgIH0KICAgICAgICBpc0Jyb2tlbiA9IHRydWU7CiAgICAgICAgaXNGaXJzdExpbmUgPSBmYWxzZTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjdXJyZW50TGluZVdpZHRoICs9IGdseXBoV2lkdGg7CiAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gTWF0aC5tYXgoZ2x5cGhIZWlnaHQsIGN1cnJlbnRMaW5lSGVpZ2h0KTsKICAgIH0KICAgIHdpZHRoID0gTWF0aC5tYXgod2lkdGgsIGN1cnJlbnRMaW5lV2lkdGgpOwogICAgaGVpZ2h0ICs9IGN1cnJlbnRMaW5lSGVpZ2h0ICsgdGhpcy5leHRyYUhlaWdodDsKICAgIHJldHVybiB7CiAgICAgIHdpZHRoOiBXSURUSF9GQUNUT1IgKiB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBpc0Jyb2tlbgogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9zb20uanMKCgpjb25zdCBuYW1lUGF0dGVybiA9IC9eW14uW10rLzsKY29uc3QgaW5kZXhQYXR0ZXJuID0gL15bXlxdXSsvOwpjb25zdCBvcGVyYXRvcnMgPSB7CiAgZG90OiAwLAogIGRvdERvdDogMSwKICBkb3RIYXNoOiAyLAogIGRvdEJyYWNrZXQ6IDMsCiAgZG90UGFyZW46IDQKfTsKY29uc3Qgc2hvcnRjdXRzID0gbmV3IE1hcChbWyIkZGF0YSIsIChyb290LCBjdXJyZW50KSA9PiByb290LmRhdGFzZXRzID8gcm9vdC5kYXRhc2V0cy5kYXRhIDogcm9vdF0sIFsiJHJlY29yZCIsIChyb290LCBjdXJyZW50KSA9PiAocm9vdC5kYXRhc2V0cyA/IHJvb3QuZGF0YXNldHMuZGF0YSA6IHJvb3QpWyRnZXRDaGlsZHJlbl0oKVswXV0sIFsiJHRlbXBsYXRlIiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QudGVtcGxhdGVdLCBbIiRjb25uZWN0aW9uU2V0IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuY29ubmVjdGlvblNldF0sIFsiJGZvcm0iLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5mb3JtXSwgWyIkbGF5b3V0IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QubGF5b3V0XSwgWyIkaG9zdCIsIChyb290LCBjdXJyZW50KSA9PiByb290Lmhvc3RdLCBbIiRkYXRhV2luZG93IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuZGF0YVdpbmRvd10sIFsiJGV2ZW50IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuZXZlbnRdLCBbIiEiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5kYXRhc2V0c10sIFsiJHhmYSIsIChyb290LCBjdXJyZW50KSA9PiByb290XSwgWyJ4ZmEiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdF0sIFsiJCIsIChyb290LCBjdXJyZW50KSA9PiBjdXJyZW50XV0pOwpjb25zdCBzb21DYWNoZSA9IG5ldyBXZWFrTWFwKCk7CmZ1bmN0aW9uIHBhcnNlSW5kZXgoaW5kZXgpIHsKICBpbmRleCA9IGluZGV4LnRyaW0oKTsKICBpZiAoaW5kZXggPT09ICIqIikgewogICAgcmV0dXJuIEluZmluaXR5OwogIH0KICByZXR1cm4gcGFyc2VJbnQoaW5kZXgsIDEwKSB8fCAwOwp9CmZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbihleHByLCBkb3REb3RBbGxvd2VkLCBub0V4cHIgPSB0cnVlKSB7CiAgbGV0IG1hdGNoID0gZXhwci5tYXRjaChuYW1lUGF0dGVybik7CiAgaWYgKCFtYXRjaCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGxldCBbbmFtZV0gPSBtYXRjaDsKICBjb25zdCBwYXJzZWQgPSBbewogICAgbmFtZSwKICAgIGNhY2hlTmFtZTogIi4iICsgbmFtZSwKICAgIGluZGV4OiAwLAogICAganM6IG51bGwsCiAgICBmb3JtQ2FsYzogbnVsbCwKICAgIG9wZXJhdG9yOiBvcGVyYXRvcnMuZG90CiAgfV07CiAgbGV0IHBvcyA9IG5hbWUubGVuZ3RoOwogIHdoaWxlIChwb3MgPCBleHByLmxlbmd0aCkgewogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIGNvbnN0IGNoYXIgPSBleHByLmNoYXJBdChwb3MrKyk7CiAgICBpZiAoY2hhciA9PT0gIlsiKSB7CiAgICAgIG1hdGNoID0gZXhwci5zbGljZShwb3MpLm1hdGNoKGluZGV4UGF0dGVybik7CiAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICB3YXJuKCJYRkEgLSBJbnZhbGlkIGluZGV4IGluIFNPTSBleHByZXNzaW9uIik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcGFyc2VkLmF0KC0xKS5pbmRleCA9IHBhcnNlSW5kZXgobWF0Y2hbMF0pOwogICAgICBwb3MgKz0gbWF0Y2hbMF0ubGVuZ3RoICsgMTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgb3BlcmF0b3I7CiAgICBzd2l0Y2ggKGV4cHIuY2hhckF0KHBvcykpIHsKICAgICAgY2FzZSAiLiI6CiAgICAgICAgaWYgKCFkb3REb3RBbGxvd2VkKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgcG9zKys7CiAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvcnMuZG90RG90OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICIjIjoKICAgICAgICBwb3MrKzsKICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3RIYXNoOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJbIjoKICAgICAgICBpZiAobm9FeHByKSB7CiAgICAgICAgICB3YXJuKCJYRkEgLSBTT00gZXhwcmVzc2lvbiBjb250YWlucyBhIEZvcm1DYWxjIHN1YmV4cHJlc3Npb24gd2hpY2ggaXMgbm90IHN1cHBvcnRlZCBmb3Igbm93LiIpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzLmRvdEJyYWNrZXQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIigiOgogICAgICAgIGlmIChub0V4cHIpIHsKICAgICAgICAgIHdhcm4oIlhGQSAtIFNPTSBleHByZXNzaW9uIGNvbnRhaW5zIGEgSmF2YVNjcmlwdCBzdWJleHByZXNzaW9uIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIG5vdy4iKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3RQYXJlbjsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3Q7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBtYXRjaCA9IGV4cHIuc2xpY2UocG9zKS5tYXRjaChuYW1lUGF0dGVybik7CiAgICBpZiAoIW1hdGNoKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgW25hbWVdID0gbWF0Y2g7CiAgICBwb3MgKz0gbmFtZS5sZW5ndGg7CiAgICBwYXJzZWQucHVzaCh7CiAgICAgIG5hbWUsCiAgICAgIGNhY2hlTmFtZTogZXhwci5zbGljZShzcG9zLCBwb3MpLAogICAgICBvcGVyYXRvciwKICAgICAgaW5kZXg6IDAsCiAgICAgIGpzOiBudWxsLAogICAgICBmb3JtQ2FsYzogbnVsbAogICAgfSk7CiAgfQogIHJldHVybiBwYXJzZWQ7Cn0KZnVuY3Rpb24gc2VhcmNoTm9kZShyb290LCBjb250YWluZXIsIGV4cHIsIGRvdERvdEFsbG93ZWQgPSB0cnVlLCB1c2VDYWNoZSA9IHRydWUpIHsKICBjb25zdCBwYXJzZWQgPSBwYXJzZUV4cHJlc3Npb24oZXhwciwgZG90RG90QWxsb3dlZCk7CiAgaWYgKCFwYXJzZWQpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBmbiA9IHNob3J0Y3V0cy5nZXQocGFyc2VkWzBdLm5hbWUpOwogIGxldCBpID0gMDsKICBsZXQgaXNRdWFsaWZpZWQ7CiAgaWYgKGZuKSB7CiAgICBpc1F1YWxpZmllZCA9IHRydWU7CiAgICByb290ID0gW2ZuKHJvb3QsIGNvbnRhaW5lcildOwogICAgaSA9IDE7CiAgfSBlbHNlIHsKICAgIGlzUXVhbGlmaWVkID0gY29udGFpbmVyID09PSBudWxsOwogICAgcm9vdCA9IFtjb250YWluZXIgfHwgcm9vdF07CiAgfQogIGZvciAobGV0IGlpID0gcGFyc2VkLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgY2FjaGVOYW1lLAogICAgICBvcGVyYXRvciwKICAgICAgaW5kZXgKICAgIH0gPSBwYXJzZWRbaV07CiAgICBjb25zdCBub2RlcyA9IFtdOwogICAgZm9yIChjb25zdCBub2RlIG9mIHJvb3QpIHsKICAgICAgaWYgKCFub2RlLmlzWEZBT2JqZWN0KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IGNoaWxkcmVuLCBjYWNoZWQ7CiAgICAgIGlmICh1c2VDYWNoZSkgewogICAgICAgIGNhY2hlZCA9IHNvbUNhY2hlLmdldChub2RlKTsKICAgICAgICBpZiAoIWNhY2hlZCkgewogICAgICAgICAgY2FjaGVkID0gbmV3IE1hcCgpOwogICAgICAgICAgc29tQ2FjaGUuc2V0KG5vZGUsIGNhY2hlZCk7CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuID0gY2FjaGVkLmdldChjYWNoZU5hbWUpOwogICAgICB9CiAgICAgIGlmICghY2hpbGRyZW4pIHsKICAgICAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7CiAgICAgICAgICBjYXNlIG9wZXJhdG9ycy5kb3Q6CiAgICAgICAgICAgIGNoaWxkcmVuID0gbm9kZVskZ2V0Q2hpbGRyZW5CeU5hbWVdKG5hbWUsIGZhbHNlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIG9wZXJhdG9ycy5kb3REb3Q6CiAgICAgICAgICAgIGNoaWxkcmVuID0gbm9kZVskZ2V0Q2hpbGRyZW5CeU5hbWVdKG5hbWUsIHRydWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2Ugb3BlcmF0b3JzLmRvdEhhc2g6CiAgICAgICAgICAgIGNoaWxkcmVuID0gbm9kZVskZ2V0Q2hpbGRyZW5CeUNsYXNzXShuYW1lKTsKICAgICAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5pc1hGQU9iamVjdEFycmF5ID8gY2hpbGRyZW4uY2hpbGRyZW4gOiBbY2hpbGRyZW5dOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodXNlQ2FjaGUpIHsKICAgICAgICAgIGNhY2hlZC5zZXQoY2FjaGVOYW1lLCBjaGlsZHJlbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgbm9kZXMucHVzaChjaGlsZHJlbik7CiAgICAgIH0KICAgIH0KICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDAgJiYgIWlzUXVhbGlmaWVkICYmIGkgPT09IDApIHsKICAgICAgY29uc3QgcGFyZW50ID0gY29udGFpbmVyWyRnZXRQYXJlbnRdKCk7CiAgICAgIGNvbnRhaW5lciA9IHBhcmVudDsKICAgICAgaWYgKCFjb250YWluZXIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpID0gLTE7CiAgICAgIHJvb3QgPSBbY29udGFpbmVyXTsKICAgICAgY29udGludWU7CiAgICB9CiAgICByb290ID0gaXNGaW5pdGUoaW5kZXgpID8gbm9kZXMuZmlsdGVyKG5vZGUgPT4gaW5kZXggPCBub2RlLmxlbmd0aCkubWFwKG5vZGUgPT4gbm9kZVtpbmRleF0pIDogbm9kZXMuZmxhdCgpOwogIH0KICBpZiAocm9vdC5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBudWxsOwogIH0KICByZXR1cm4gcm9vdDsKfQpmdW5jdGlvbiBjcmVhdGVEYXRhTm9kZShyb290LCBjb250YWluZXIsIGV4cHIpIHsKICBjb25zdCBwYXJzZWQgPSBwYXJzZUV4cHJlc3Npb24oZXhwcik7CiAgaWYgKCFwYXJzZWQpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBpZiAocGFyc2VkLnNvbWUoeCA9PiB4Lm9wZXJhdG9yID09PSBvcGVyYXRvcnMuZG90RG90KSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGZuID0gc2hvcnRjdXRzLmdldChwYXJzZWRbMF0ubmFtZSk7CiAgbGV0IGkgPSAwOwogIGlmIChmbikgewogICAgcm9vdCA9IGZuKHJvb3QsIGNvbnRhaW5lcik7CiAgICBpID0gMTsKICB9IGVsc2UgewogICAgcm9vdCA9IGNvbnRhaW5lciB8fCByb290OwogIH0KICBmb3IgKGxldCBpaSA9IHBhcnNlZC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIG9wZXJhdG9yLAogICAgICBpbmRleAogICAgfSA9IHBhcnNlZFtpXTsKICAgIGlmICghaXNGaW5pdGUoaW5kZXgpKSB7CiAgICAgIHBhcnNlZFtpXS5pbmRleCA9IDA7CiAgICAgIHJldHVybiByb290LmNyZWF0ZU5vZGVzKHBhcnNlZC5zbGljZShpKSk7CiAgICB9CiAgICBsZXQgY2hpbGRyZW47CiAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7CiAgICAgIGNhc2Ugb3BlcmF0b3JzLmRvdDoKICAgICAgICBjaGlsZHJlbiA9IHJvb3RbJGdldENoaWxkcmVuQnlOYW1lXShuYW1lLCBmYWxzZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2Ugb3BlcmF0b3JzLmRvdERvdDoKICAgICAgICBjaGlsZHJlbiA9IHJvb3RbJGdldENoaWxkcmVuQnlOYW1lXShuYW1lLCB0cnVlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBvcGVyYXRvcnMuZG90SGFzaDoKICAgICAgICBjaGlsZHJlbiA9IHJvb3RbJGdldENoaWxkcmVuQnlDbGFzc10obmFtZSk7CiAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5pc1hGQU9iamVjdEFycmF5ID8gY2hpbGRyZW4uY2hpbGRyZW4gOiBbY2hpbGRyZW5dOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gcm9vdC5jcmVhdGVOb2RlcyhwYXJzZWQuc2xpY2UoaSkpOwogICAgfQogICAgaWYgKGluZGV4IDwgY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baW5kZXhdOwogICAgICBpZiAoIWNoaWxkLmlzWEZBT2JqZWN0KSB7CiAgICAgICAgd2FybihgWEZBIC0gQ2Fubm90IGNyZWF0ZSBhIG5vZGUuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcm9vdCA9IGNoaWxkOwogICAgfSBlbHNlIHsKICAgICAgcGFyc2VkW2ldLmluZGV4ID0gaW5kZXggLSBjaGlsZHJlbi5sZW5ndGg7CiAgICAgIHJldHVybiByb290LmNyZWF0ZU5vZGVzKHBhcnNlZC5zbGljZShpKSk7CiAgICB9CiAgfQogIHJldHVybiBudWxsOwp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEveGZhX29iamVjdC5qcwoKCgoKCgpjb25zdCBfYXBwbHlQcm90b3R5cGUgPSBTeW1ib2woKTsKY29uc3QgX2F0dHJpYnV0ZXMgPSBTeW1ib2woKTsKY29uc3QgX2F0dHJpYnV0ZU5hbWVzID0gU3ltYm9sKCk7CmNvbnN0IF9jaGlsZHJlbiA9IFN5bWJvbCgiX2NoaWxkcmVuIik7CmNvbnN0IF9jbG9uZUF0dHJpYnV0ZSA9IFN5bWJvbCgpOwpjb25zdCBfZGF0YVZhbHVlID0gU3ltYm9sKCk7CmNvbnN0IF9kZWZhdWx0VmFsdWUgPSBTeW1ib2woKTsKY29uc3QgX2ZpbHRlcmVkQ2hpbGRyZW5HZW5lcmF0b3IgPSBTeW1ib2woKTsKY29uc3QgX2dldFByb3RvdHlwZSA9IFN5bWJvbCgpOwpjb25zdCBfZ2V0VW5zZXRBdHRyaWJ1dGVzID0gU3ltYm9sKCk7CmNvbnN0IF9oYXNDaGlsZHJlbiA9IFN5bWJvbCgpOwpjb25zdCBfbWF4ID0gU3ltYm9sKCk7CmNvbnN0IF9vcHRpb25zID0gU3ltYm9sKCk7CmNvbnN0IF9wYXJlbnQgPSBTeW1ib2woInBhcmVudCIpOwpjb25zdCBfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXIgPSBTeW1ib2woKTsKY29uc3QgX3NldEF0dHJpYnV0ZXMgPSBTeW1ib2woKTsKY29uc3QgX3ZhbGlkYXRvciA9IFN5bWJvbCgpOwpsZXQgdWlkID0gMDsKY29uc3QgTlNfREFUQVNFVFMgPSBOYW1lc3BhY2VJZHMuZGF0YXNldHMuaWQ7CmNsYXNzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSwgaGFzQ2hpbGRyZW4gPSBmYWxzZSkgewogICAgdGhpc1skbmFtZXNwYWNlSWRdID0gbnNJZDsKICAgIHRoaXNbJG5vZGVOYW1lXSA9IG5hbWU7CiAgICB0aGlzW19oYXNDaGlsZHJlbl0gPSBoYXNDaGlsZHJlbjsKICAgIHRoaXNbX3BhcmVudF0gPSBudWxsOwogICAgdGhpc1tfY2hpbGRyZW5dID0gW107CiAgICB0aGlzWyR1aWRdID0gYCR7bmFtZX0ke3VpZCsrfWA7CiAgICB0aGlzWyRnbG9iYWxEYXRhXSA9IG51bGw7CiAgfQogIGdldCBpc1hGQU9iamVjdCgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBnZXQgaXNYRkFPYmplY3RBcnJheSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY3JlYXRlTm9kZXMocGF0aCkgewogICAgbGV0IHJvb3QgPSB0aGlzLAogICAgICBub2RlID0gbnVsbDsKICAgIGZvciAoY29uc3QgewogICAgICBuYW1lLAogICAgICBpbmRleAogICAgfSBvZiBwYXRoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGlzRmluaXRlKGluZGV4KSA/IGluZGV4IDogMDsgaSA8PSBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgbnNJZCA9IHJvb3RbJG5hbWVzcGFjZUlkXSA9PT0gTlNfREFUQVNFVFMgPyAtMSA6IHJvb3RbJG5hbWVzcGFjZUlkXTsKICAgICAgICBub2RlID0gbmV3IFhtbE9iamVjdChuc0lkLCBuYW1lKTsKICAgICAgICByb290WyRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgIH0KICAgICAgcm9vdCA9IG5vZGU7CiAgICB9CiAgICByZXR1cm4gbm9kZTsKICB9CiAgWyRvbkNoaWxkXShjaGlsZCkgewogICAgaWYgKCF0aGlzW19oYXNDaGlsZHJlbl0gfHwgIXRoaXNbJG9uQ2hpbGRDaGVja10oY2hpbGQpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IG5hbWUgPSBjaGlsZFskbm9kZU5hbWVdOwogICAgY29uc3Qgbm9kZSA9IHRoaXNbbmFtZV07CiAgICBpZiAobm9kZSBpbnN0YW5jZW9mIFhGQU9iamVjdEFycmF5KSB7CiAgICAgIGlmIChub2RlLnB1c2goY2hpbGQpKSB7CiAgICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKGNoaWxkKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKG5vZGUgIT09IG51bGwpIHsKICAgICAgICB0aGlzWyRyZW1vdmVDaGlsZF0obm9kZSk7CiAgICAgIH0KICAgICAgdGhpc1tuYW1lXSA9IGNoaWxkOwogICAgICB0aGlzWyRhcHBlbmRDaGlsZF0oY2hpbGQpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGxldCBpZCA9ICIiOwogICAgaWYgKHRoaXMuaWQpIHsKICAgICAgaWQgPSBgIChpZDogJHt0aGlzLmlkfSlgOwogICAgfSBlbHNlIGlmICh0aGlzLm5hbWUpIHsKICAgICAgaWQgPSBgIChuYW1lOiAke3RoaXMubmFtZX0gJHt0aGlzLmgudmFsdWV9KWA7CiAgICB9CiAgICB3YXJuKGBYRkEgLSBub2RlICIke3RoaXNbJG5vZGVOYW1lXX0iJHtpZH0gaGFzIGFscmVhZHkgZW5vdWdoICIke25hbWV9IiFgKTsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRvbkNoaWxkQ2hlY2tdKGNoaWxkKSB7CiAgICByZXR1cm4gdGhpcy5oYXNPd25Qcm9wZXJ0eShjaGlsZFskbm9kZU5hbWVdKSAmJiBjaGlsZFskbmFtZXNwYWNlSWRdID09PSB0aGlzWyRuYW1lc3BhY2VJZF07CiAgfQogIFskaXNOc0Fnbm9zdGljXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRhY2NlcHRXaGl0ZXNwYWNlXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRpc0NEQVRBWG1sXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRpc0JpbmRhYmxlXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRwb3BQYXJhXSgpIHsKICAgIGlmICh0aGlzLnBhcmEpIHsKICAgICAgdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ucGFyYVN0YWNrLnBvcCgpOwogICAgfQogIH0KICBbJHB1c2hQYXJhXSgpIHsKICAgIHRoaXNbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLnBhcmFTdGFjay5wdXNoKHRoaXMucGFyYSk7CiAgfQogIFskc2V0SWRdKGlkcykgewogICAgaWYgKHRoaXMuaWQgJiYgdGhpc1skbmFtZXNwYWNlSWRdID09PSBOYW1lc3BhY2VJZHMudGVtcGxhdGUuaWQpIHsKICAgICAgaWRzLnNldCh0aGlzLmlkLCB0aGlzKTsKICAgIH0KICB9CiAgWyRnZXRUZW1wbGF0ZVJvb3RdKCkgewogICAgcmV0dXJuIHRoaXNbJGdsb2JhbERhdGFdLnRlbXBsYXRlOwogIH0KICBbJGlzU3BsaXR0YWJsZV0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskaXNUaGVyZU1vcmVXaWR0aF0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskYXBwZW5kQ2hpbGRdKGNoaWxkKSB7CiAgICBjaGlsZFtfcGFyZW50XSA9IHRoaXM7CiAgICB0aGlzW19jaGlsZHJlbl0ucHVzaChjaGlsZCk7CiAgICBpZiAoIWNoaWxkWyRnbG9iYWxEYXRhXSAmJiB0aGlzWyRnbG9iYWxEYXRhXSkgewogICAgICBjaGlsZFskZ2xvYmFsRGF0YV0gPSB0aGlzWyRnbG9iYWxEYXRhXTsKICAgIH0KICB9CiAgWyRyZW1vdmVDaGlsZF0oY2hpbGQpIHsKICAgIGNvbnN0IGkgPSB0aGlzW19jaGlsZHJlbl0uaW5kZXhPZihjaGlsZCk7CiAgICB0aGlzW19jaGlsZHJlbl0uc3BsaWNlKGksIDEpOwogIH0KICBbJGhhc1NldHRhYmxlVmFsdWVdKCkgewogICAgcmV0dXJuIHRoaXMuaGFzT3duUHJvcGVydHkoInZhbHVlIik7CiAgfQogIFskc2V0VmFsdWVdKF8pIHt9CiAgWyRvblRleHRdKF8pIHt9CiAgWyRmaW5hbGl6ZV0oKSB7fQogIFskY2xlYW5dKGJ1aWxkZXIpIHsKICAgIGRlbGV0ZSB0aGlzW19oYXNDaGlsZHJlbl07CiAgICBpZiAodGhpc1skY2xlYW51cF0pIHsKICAgICAgYnVpbGRlci5jbGVhbih0aGlzWyRjbGVhbnVwXSk7CiAgICAgIGRlbGV0ZSB0aGlzWyRjbGVhbnVwXTsKICAgIH0KICB9CiAgWyRpbmRleE9mXShjaGlsZCkgewogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5pbmRleE9mKGNoaWxkKTsKICB9CiAgWyRpbnNlcnRBdF0oaSwgY2hpbGQpIHsKICAgIGNoaWxkW19wYXJlbnRdID0gdGhpczsKICAgIHRoaXNbX2NoaWxkcmVuXS5zcGxpY2UoaSwgMCwgY2hpbGQpOwogICAgaWYgKCFjaGlsZFskZ2xvYmFsRGF0YV0gJiYgdGhpc1skZ2xvYmFsRGF0YV0pIHsKICAgICAgY2hpbGRbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICB9CiAgfQogIFskaXNUcmFuc3BhcmVudF0oKSB7CiAgICByZXR1cm4gIXRoaXMubmFtZTsKICB9CiAgWyRsYXN0QXR0cmlidXRlXSgpIHsKICAgIHJldHVybiAiIjsKICB9CiAgWyR0ZXh0XSgpIHsKICAgIGlmICh0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiB0aGlzWyRjb250ZW50XTsKICAgIH0KICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0ubWFwKGMgPT4gY1skdGV4dF0oKSkuam9pbigiIik7CiAgfQogIGdldCBbX2F0dHJpYnV0ZU5hbWVzXSgpIHsKICAgIGNvbnN0IHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpOwogICAgaWYgKCFwcm90by5fYXR0cmlidXRlcykgewogICAgICBjb25zdCBhdHRyaWJ1dGVzID0gcHJvdG8uX2F0dHJpYnV0ZXMgPSBuZXcgU2V0KCk7CiAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICAgIGlmICh0aGlzW25hbWVdID09PSBudWxsIHx8IHRoaXNbbmFtZV0gaW5zdGFuY2VvZiBYRkFPYmplY3QgfHwgdGhpc1tuYW1lXSBpbnN0YW5jZW9mIFhGQU9iamVjdEFycmF5KSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgYXR0cmlidXRlcy5hZGQobmFtZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgX2F0dHJpYnV0ZU5hbWVzLCBwcm90by5fYXR0cmlidXRlcyk7CiAgfQogIFskaXNEZXNjZW5kZW50XShwYXJlbnQpIHsKICAgIGxldCBub2RlID0gdGhpczsKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChub2RlID09PSBwYXJlbnQpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBub2RlID0gbm9kZVskZ2V0UGFyZW50XSgpOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJGdldFBhcmVudF0oKSB7CiAgICByZXR1cm4gdGhpc1tfcGFyZW50XTsKICB9CiAgWyRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIHJldHVybiB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgfQogIFskZ2V0Q2hpbGRyZW5dKG5hbWUgPSBudWxsKSB7CiAgICBpZiAoIW5hbWUpIHsKICAgICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXTsKICAgIH0KICAgIHJldHVybiB0aGlzW25hbWVdOwogIH0KICBbJGR1bXBdKCkgewogICAgY29uc3QgZHVtcGVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzWyRjb250ZW50XSkgewogICAgICBkdW1wZWQuJGNvbnRlbnQgPSB0aGlzWyRjb250ZW50XTsKICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBjb25zdCB2YWx1ZSA9IHRoaXNbbmFtZV07CiAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFhGQU9iamVjdCkgewogICAgICAgIGR1bXBlZFtuYW1lXSA9IHZhbHVlWyRkdW1wXSgpOwogICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkpIHsKICAgICAgICBpZiAoIXZhbHVlLmlzRW1wdHkoKSkgewogICAgICAgICAgZHVtcGVkW25hbWVdID0gdmFsdWUuZHVtcCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBkdW1wZWRbbmFtZV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGR1bXBlZDsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBbJHRvSFRNTF0oKSB7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICB9CiAgKlskZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkgewogICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXNbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgIHlpZWxkIG5vZGU7CiAgICB9CiAgfQogICpbX2ZpbHRlcmVkQ2hpbGRyZW5HZW5lcmF0b3JdKGZpbHRlciwgaW5jbHVkZSkgewogICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXNbJGdldENvbnRhaW5lZENoaWxkcmVuXSgpKSB7CiAgICAgIGlmICghZmlsdGVyIHx8IGluY2x1ZGUgPT09IGZpbHRlci5oYXMobm9kZVskbm9kZU5hbWVdKSkgewogICAgICAgIGNvbnN0IGF2YWlsYWJsZVNwYWNlID0gdGhpc1skZ2V0QXZhaWxhYmxlU3BhY2VdKCk7CiAgICAgICAgY29uc3QgcmVzID0gbm9kZVskdG9IVE1MXShhdmFpbGFibGVTcGFjZSk7CiAgICAgICAgaWYgKCFyZXMuc3VjY2VzcykgewogICAgICAgICAgdGhpc1skZXh0cmFdLmZhaWxpbmdOb2RlID0gbm9kZTsKICAgICAgICB9CiAgICAgICAgeWllbGQgcmVzOwogICAgICB9CiAgICB9CiAgfQogIFskZmx1c2hIVE1MXSgpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBbJGFkZEhUTUxdKGh0bWwsIGJib3gpIHsKICAgIHRoaXNbJGV4dHJhXS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogIH0KICBbJGdldEF2YWlsYWJsZVNwYWNlXSgpIHt9CiAgWyRjaGlsZHJlblRvSFRNTF0oewogICAgZmlsdGVyID0gbnVsbCwKICAgIGluY2x1ZGUgPSB0cnVlCiAgfSkgewogICAgaWYgKCF0aGlzWyRleHRyYV0uZ2VuZXJhdG9yKSB7CiAgICAgIHRoaXNbJGV4dHJhXS5nZW5lcmF0b3IgPSB0aGlzW19maWx0ZXJlZENoaWxkcmVuR2VuZXJhdG9yXShmaWx0ZXIsIGluY2x1ZGUpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgYXZhaWxhYmxlU3BhY2UgPSB0aGlzWyRnZXRBdmFpbGFibGVTcGFjZV0oKTsKICAgICAgY29uc3QgcmVzID0gdGhpc1skZXh0cmFdLmZhaWxpbmdOb2RlWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgICAgaWYgKCFyZXMuc3VjY2VzcykgewogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KICAgICAgaWYgKHJlcy5odG1sKSB7CiAgICAgICAgdGhpc1skYWRkSFRNTF0ocmVzLmh0bWwsIHJlcy5iYm94KTsKICAgICAgfQogICAgICBkZWxldGUgdGhpc1skZXh0cmFdLmZhaWxpbmdOb2RlOwogICAgfQogICAgd2hpbGUgKHRydWUpIHsKICAgICAgY29uc3QgZ2VuID0gdGhpc1skZXh0cmFdLmdlbmVyYXRvci5uZXh0KCk7CiAgICAgIGlmIChnZW4uZG9uZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNvbnN0IHJlcyA9IGdlbi52YWx1ZTsKICAgICAgaWYgKCFyZXMuc3VjY2VzcykgewogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KICAgICAgaWYgKHJlcy5odG1sKSB7CiAgICAgICAgdGhpc1skYWRkSFRNTF0ocmVzLmh0bWwsIHJlcy5iYm94KTsKICAgICAgfQogICAgfQogICAgdGhpc1skZXh0cmFdLmdlbmVyYXRvciA9IG51bGw7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICB9CiAgWyRzZXRTZXRBdHRyaWJ1dGVzXShhdHRyaWJ1dGVzKSB7CiAgICB0aGlzW19zZXRBdHRyaWJ1dGVzXSA9IG5ldyBTZXQoT2JqZWN0LmtleXMoYXR0cmlidXRlcykpOwogIH0KICBbX2dldFVuc2V0QXR0cmlidXRlc10ocHJvdG9BdHRyaWJ1dGVzKSB7CiAgICBjb25zdCBhbGxBdHRyID0gdGhpc1tfYXR0cmlidXRlTmFtZXNdOwogICAgY29uc3Qgc2V0QXR0ciA9IHRoaXNbX3NldEF0dHJpYnV0ZXNdOwogICAgcmV0dXJuIFsuLi5wcm90b0F0dHJpYnV0ZXNdLmZpbHRlcih4ID0+IGFsbEF0dHIuaGFzKHgpICYmICFzZXRBdHRyLmhhcyh4KSk7CiAgfQogIFskcmVzb2x2ZVByb3RvdHlwZXNdKGlkcywgYW5jZXN0b3JzID0gbmV3IFNldCgpKSB7CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICBjaGlsZFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKTsKICAgIH0KICB9CiAgW19yZXNvbHZlUHJvdG90eXBlc0hlbHBlcl0oaWRzLCBhbmNlc3RvcnMpIHsKICAgIGNvbnN0IHByb3RvID0gdGhpc1tfZ2V0UHJvdG90eXBlXShpZHMsIGFuY2VzdG9ycyk7CiAgICBpZiAocHJvdG8pIHsKICAgICAgdGhpc1tfYXBwbHlQcm90b3R5cGVdKHByb3RvLCBpZHMsIGFuY2VzdG9ycyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzWyRyZXNvbHZlUHJvdG90eXBlc10oaWRzLCBhbmNlc3RvcnMpOwogICAgfQogIH0KICBbX2dldFByb3RvdHlwZV0oaWRzLCBhbmNlc3RvcnMpIHsKICAgIGNvbnN0IHsKICAgICAgdXNlLAogICAgICB1c2VocmVmCiAgICB9ID0gdGhpczsKICAgIGlmICghdXNlICYmICF1c2VocmVmKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IHByb3RvID0gbnVsbDsKICAgIGxldCBzb21FeHByZXNzaW9uID0gbnVsbDsKICAgIGxldCBpZCA9IG51bGw7CiAgICBsZXQgcmVmID0gdXNlOwogICAgaWYgKHVzZWhyZWYpIHsKICAgICAgcmVmID0gdXNlaHJlZjsKICAgICAgaWYgKHVzZWhyZWYuc3RhcnRzV2l0aCgiI3NvbSgiKSAmJiB1c2VocmVmLmVuZHNXaXRoKCIpIikpIHsKICAgICAgICBzb21FeHByZXNzaW9uID0gdXNlaHJlZi5zbGljZSgiI3NvbSgiLmxlbmd0aCwgLTEpOwogICAgICB9IGVsc2UgaWYgKHVzZWhyZWYuc3RhcnRzV2l0aCgiLiNzb20oIikgJiYgdXNlaHJlZi5lbmRzV2l0aCgiKSIpKSB7CiAgICAgICAgc29tRXhwcmVzc2lvbiA9IHVzZWhyZWYuc2xpY2UoIi4jc29tKCIubGVuZ3RoLCAtMSk7CiAgICAgIH0gZWxzZSBpZiAodXNlaHJlZi5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgICBpZCA9IHVzZWhyZWYuc2xpY2UoMSk7CiAgICAgIH0gZWxzZSBpZiAodXNlaHJlZi5zdGFydHNXaXRoKCIuIyIpKSB7CiAgICAgICAgaWQgPSB1c2VocmVmLnNsaWNlKDIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHVzZS5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgaWQgPSB1c2Uuc2xpY2UoMSk7CiAgICB9IGVsc2UgewogICAgICBzb21FeHByZXNzaW9uID0gdXNlOwogICAgfQogICAgdGhpcy51c2UgPSB0aGlzLnVzZWhyZWYgPSAiIjsKICAgIGlmIChpZCkgewogICAgICBwcm90byA9IGlkcy5nZXQoaWQpOwogICAgfSBlbHNlIHsKICAgICAgcHJvdG8gPSBzZWFyY2hOb2RlKGlkcy5nZXQoJHJvb3QpLCB0aGlzLCBzb21FeHByZXNzaW9uLCB0cnVlLCBmYWxzZSk7CiAgICAgIGlmIChwcm90bykgewogICAgICAgIHByb3RvID0gcHJvdG9bMF07CiAgICAgIH0KICAgIH0KICAgIGlmICghcHJvdG8pIHsKICAgICAgd2FybihgWEZBIC0gSW52YWxpZCBwcm90b3R5cGUgcmVmZXJlbmNlOiAke3JlZn0uYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKHByb3RvWyRub2RlTmFtZV0gIT09IHRoaXNbJG5vZGVOYW1lXSkgewogICAgICB3YXJuKGBYRkEgLSBJbmNvbXBhdGlibGUgcHJvdG90eXBlOiAke3Byb3RvWyRub2RlTmFtZV19ICE9PSAke3RoaXNbJG5vZGVOYW1lXX0uYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKGFuY2VzdG9ycy5oYXMocHJvdG8pKSB7CiAgICAgIHdhcm4oYFhGQSAtIEN5Y2xlIGRldGVjdGVkIGluIHByb3RvdHlwZXMgdXNlLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGFuY2VzdG9ycy5hZGQocHJvdG8pOwogICAgY29uc3QgcHJvdG9Qcm90byA9IHByb3RvW19nZXRQcm90b3R5cGVdKGlkcywgYW5jZXN0b3JzKTsKICAgIGlmIChwcm90b1Byb3RvKSB7CiAgICAgIHByb3RvW19hcHBseVByb3RvdHlwZV0ocHJvdG9Qcm90bywgaWRzLCBhbmNlc3RvcnMpOwogICAgfQogICAgcHJvdG9bJHJlc29sdmVQcm90b3R5cGVzXShpZHMsIGFuY2VzdG9ycyk7CiAgICBhbmNlc3RvcnMuZGVsZXRlKHByb3RvKTsKICAgIHJldHVybiBwcm90bzsKICB9CiAgW19hcHBseVByb3RvdHlwZV0ocHJvdG8sIGlkcywgYW5jZXN0b3JzKSB7CiAgICBpZiAoYW5jZXN0b3JzLmhhcyhwcm90bykpIHsKICAgICAgd2FybihgWEZBIC0gQ3ljbGUgZGV0ZWN0ZWQgaW4gcHJvdG90eXBlcyB1c2UuYCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpc1skY29udGVudF0gJiYgcHJvdG9bJGNvbnRlbnRdKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdID0gcHJvdG9bJGNvbnRlbnRdOwogICAgfQogICAgY29uc3QgbmV3QW5jZXN0b3JzID0gbmV3IFNldChhbmNlc3RvcnMpOwogICAgbmV3QW5jZXN0b3JzLmFkZChwcm90byk7CiAgICBmb3IgKGNvbnN0IHVuc2V0QXR0ck5hbWUgb2YgdGhpc1tfZ2V0VW5zZXRBdHRyaWJ1dGVzXShwcm90b1tfc2V0QXR0cmlidXRlc10pKSB7CiAgICAgIHRoaXNbdW5zZXRBdHRyTmFtZV0gPSBwcm90b1t1bnNldEF0dHJOYW1lXTsKICAgICAgaWYgKHRoaXNbX3NldEF0dHJpYnV0ZXNdKSB7CiAgICAgICAgdGhpc1tfc2V0QXR0cmlidXRlc10uYWRkKHVuc2V0QXR0ck5hbWUpOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgaWYgKHRoaXNbX2F0dHJpYnV0ZU5hbWVzXS5oYXMobmFtZSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IHRoaXNbbmFtZV07CiAgICAgIGNvbnN0IHByb3RvVmFsdWUgPSBwcm90b1tuYW1lXTsKICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkpIHsKICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHZhbHVlW19jaGlsZHJlbl0pIHsKICAgICAgICAgIGNoaWxkW19yZXNvbHZlUHJvdG90eXBlc0hlbHBlcl0oaWRzLCBhbmNlc3RvcnMpOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gdmFsdWVbX2NoaWxkcmVuXS5sZW5ndGgsIGlpID0gcHJvdG9WYWx1ZVtfY2hpbGRyZW5dLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGNoaWxkID0gcHJvdG9bX2NoaWxkcmVuXVtpXVskY2xvbmVdKCk7CiAgICAgICAgICBpZiAodmFsdWUucHVzaChjaGlsZCkpIHsKICAgICAgICAgICAgY2hpbGRbX3BhcmVudF0gPSB0aGlzOwogICAgICAgICAgICB0aGlzW19jaGlsZHJlbl0ucHVzaChjaGlsZCk7CiAgICAgICAgICAgIGNoaWxkW19yZXNvbHZlUHJvdG90eXBlc0hlbHBlcl0oaWRzLCBhbmNlc3RvcnMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewogICAgICAgIHZhbHVlWyRyZXNvbHZlUHJvdG90eXBlc10oaWRzLCBhbmNlc3RvcnMpOwogICAgICAgIGlmIChwcm90b1ZhbHVlKSB7CiAgICAgICAgICB2YWx1ZVtfYXBwbHlQcm90b3R5cGVdKHByb3RvVmFsdWUsIGlkcywgYW5jZXN0b3JzKTsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHByb3RvVmFsdWUgIT09IG51bGwpIHsKICAgICAgICBjb25zdCBjaGlsZCA9IHByb3RvVmFsdWVbJGNsb25lXSgpOwogICAgICAgIGNoaWxkW19wYXJlbnRdID0gdGhpczsKICAgICAgICB0aGlzW25hbWVdID0gY2hpbGQ7CiAgICAgICAgdGhpc1tfY2hpbGRyZW5dLnB1c2goY2hpbGQpOwogICAgICAgIGNoaWxkW19yZXNvbHZlUHJvdG90eXBlc0hlbHBlcl0oaWRzLCBhbmNlc3RvcnMpOwogICAgICB9CiAgICB9CiAgfQogIHN0YXRpYyBbX2Nsb25lQXR0cmlidXRlXShvYmopIHsKICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgcmV0dXJuIG9iai5tYXAoeCA9PiBYRkFPYmplY3RbX2Nsb25lQXR0cmlidXRlXSh4KSk7CiAgICB9CiAgICBpZiAodHlwZW9mIG9iaiA9PT0gIm9iamVjdCIgJiYgb2JqICE9PSBudWxsKSB7CiAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBvYmopOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CiAgWyRjbG9uZV0oKSB7CiAgICBjb25zdCBjbG9uZSA9IE9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpKTsKICAgIGZvciAoY29uc3QgJHN5bWJvbCBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHRoaXMpKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY2xvbmVbJHN5bWJvbF0gPSB0aGlzWyRzeW1ib2xdOwogICAgICB9IGNhdGNoIHsKICAgICAgICBzaGFkb3coY2xvbmUsICRzeW1ib2wsIHRoaXNbJHN5bWJvbF0pOwogICAgICB9CiAgICB9CiAgICBjbG9uZVskdWlkXSA9IGAke2Nsb25lWyRub2RlTmFtZV19JHt1aWQrK31gOwogICAgY2xvbmVbX2NoaWxkcmVuXSA9IFtdOwogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGlmICh0aGlzW19hdHRyaWJ1dGVOYW1lc10uaGFzKG5hbWUpKSB7CiAgICAgICAgY2xvbmVbbmFtZV0gPSBYRkFPYmplY3RbX2Nsb25lQXR0cmlidXRlXSh0aGlzW25hbWVdKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IHRoaXNbbmFtZV07CiAgICAgIGNsb25lW25hbWVdID0gdmFsdWUgaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSA/IG5ldyBYRkFPYmplY3RBcnJheSh2YWx1ZVtfbWF4XSkgOiBudWxsOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgY29uc3QgbmFtZSA9IGNoaWxkWyRub2RlTmFtZV07CiAgICAgIGNvbnN0IGNsb25lZENoaWxkID0gY2hpbGRbJGNsb25lXSgpOwogICAgICBjbG9uZVtfY2hpbGRyZW5dLnB1c2goY2xvbmVkQ2hpbGQpOwogICAgICBjbG9uZWRDaGlsZFtfcGFyZW50XSA9IGNsb25lOwogICAgICBpZiAoY2xvbmVbbmFtZV0gPT09IG51bGwpIHsKICAgICAgICBjbG9uZVtuYW1lXSA9IGNsb25lZENoaWxkOwogICAgICB9IGVsc2UgewogICAgICAgIGNsb25lW25hbWVdW19jaGlsZHJlbl0ucHVzaChjbG9uZWRDaGlsZCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjbG9uZTsKICB9CiAgWyRnZXRDaGlsZHJlbl0obmFtZSA9IG51bGwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dOwogICAgfQogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5maWx0ZXIoYyA9PiBjWyRub2RlTmFtZV0gPT09IG5hbWUpOwogIH0KICBbJGdldENoaWxkcmVuQnlDbGFzc10obmFtZSkgewogICAgcmV0dXJuIHRoaXNbbmFtZV07CiAgfQogIFskZ2V0Q2hpbGRyZW5CeU5hbWVdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBmaXJzdCA9IHRydWUpIHsKICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXNbJGdldENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBmaXJzdCkpOwogIH0KICAqWyRnZXRDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCwgZmlyc3QgPSB0cnVlKSB7CiAgICBpZiAobmFtZSA9PT0gInBhcmVudCIpIHsKICAgICAgeWllbGQgdGhpc1tfcGFyZW50XTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgaWYgKGNoaWxkWyRub2RlTmFtZV0gPT09IG5hbWUpIHsKICAgICAgICB5aWVsZCBjaGlsZDsKICAgICAgfQogICAgICBpZiAoY2hpbGQubmFtZSA9PT0gbmFtZSkgewogICAgICAgIHlpZWxkIGNoaWxkOwogICAgICB9CiAgICAgIGlmIChhbGxUcmFuc3BhcmVudCB8fCBjaGlsZFskaXNUcmFuc3BhcmVudF0oKSkgewogICAgICAgIHlpZWxkKiBjaGlsZFskZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIGZhbHNlKTsKICAgICAgfQogICAgfQogICAgaWYgKGZpcnN0ICYmIHRoaXNbX2F0dHJpYnV0ZU5hbWVzXS5oYXMobmFtZSkpIHsKICAgICAgeWllbGQgbmV3IFhGQUF0dHJpYnV0ZSh0aGlzLCBuYW1lLCB0aGlzW25hbWVdKTsKICAgIH0KICB9Cn0KY2xhc3MgWEZBT2JqZWN0QXJyYXkgewogIGNvbnN0cnVjdG9yKG1heCA9IEluZmluaXR5KSB7CiAgICB0aGlzW19tYXhdID0gbWF4OwogICAgdGhpc1tfY2hpbGRyZW5dID0gW107CiAgfQogIGdldCBpc1hGQU9iamVjdCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGlzWEZBT2JqZWN0QXJyYXkoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcHVzaChjaGlsZCkgewogICAgY29uc3QgbGVuID0gdGhpc1tfY2hpbGRyZW5dLmxlbmd0aDsKICAgIGlmIChsZW4gPD0gdGhpc1tfbWF4XSkgewogICAgICB0aGlzW19jaGlsZHJlbl0ucHVzaChjaGlsZCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgd2FybihgWEZBIC0gbm9kZSAiJHtjaGlsZFskbm9kZU5hbWVdfSIgYWNjZXB0cyBubyBtb3JlIHRoYW4gJHt0aGlzW19tYXhdfSBjaGlsZHJlbmApOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpc0VtcHR5KCkgewogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPT09IDA7CiAgfQogIGR1bXAoKSB7CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMSA/IHRoaXNbX2NoaWxkcmVuXVswXVskZHVtcF0oKSA6IHRoaXNbX2NoaWxkcmVuXS5tYXAoeCA9PiB4WyRkdW1wXSgpKTsKICB9CiAgWyRjbG9uZV0oKSB7CiAgICBjb25zdCBjbG9uZSA9IG5ldyBYRkFPYmplY3RBcnJheSh0aGlzW19tYXhdKTsKICAgIGNsb25lW19jaGlsZHJlbl0gPSB0aGlzW19jaGlsZHJlbl0ubWFwKGMgPT4gY1skY2xvbmVdKCkpOwogICAgcmV0dXJuIGNsb25lOwogIH0KICBnZXQgY2hpbGRyZW4oKSB7CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPSAwOwogIH0KfQpjbGFzcyBYRkFBdHRyaWJ1dGUgewogIGNvbnN0cnVjdG9yKG5vZGUsIG5hbWUsIHZhbHVlKSB7CiAgICB0aGlzW19wYXJlbnRdID0gbm9kZTsKICAgIHRoaXNbJG5vZGVOYW1lXSA9IG5hbWU7CiAgICB0aGlzWyRjb250ZW50XSA9IHZhbHVlOwogICAgdGhpc1skY29uc3VtZWRdID0gZmFsc2U7CiAgICB0aGlzWyR1aWRdID0gYGF0dHJpYnV0ZSR7dWlkKyt9YDsKICB9CiAgWyRnZXRQYXJlbnRdKCkgewogICAgcmV0dXJuIHRoaXNbX3BhcmVudF07CiAgfQogIFskaXNEYXRhVmFsdWVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskZ2V0RGF0YVZhbHVlXSgpIHsKICAgIHJldHVybiB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgfQogIFskc2V0VmFsdWVdKHZhbHVlKSB7CiAgICB2YWx1ZSA9IHZhbHVlLnZhbHVlIHx8ICIiOwogICAgdGhpc1skY29udGVudF0gPSB2YWx1ZS50b1N0cmluZygpOwogIH0KICBbJHRleHRdKCkgewogICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdOwogIH0KICBbJGlzRGVzY2VuZGVudF0ocGFyZW50KSB7CiAgICByZXR1cm4gdGhpc1tfcGFyZW50XSA9PT0gcGFyZW50IHx8IHRoaXNbX3BhcmVudF1bJGlzRGVzY2VuZGVudF0ocGFyZW50KTsKICB9Cn0KY2xhc3MgWG1sT2JqZWN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lLCBhdHRyaWJ1dGVzID0ge30pIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUpOwogICAgdGhpc1skY29udGVudF0gPSAiIjsKICAgIHRoaXNbX2RhdGFWYWx1ZV0gPSBudWxsOwogICAgaWYgKG5hbWUgIT09ICIjdGV4dCIpIHsKICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgICB0aGlzW19hdHRyaWJ1dGVzXSA9IG1hcDsKICAgICAgZm9yIChjb25zdCBbYXR0ck5hbWUsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhhdHRyaWJ1dGVzKSkgewogICAgICAgIG1hcC5zZXQoYXR0ck5hbWUsIG5ldyBYRkFBdHRyaWJ1dGUodGhpcywgYXR0ck5hbWUsIHZhbHVlKSk7CiAgICAgIH0KICAgICAgaWYgKGF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoJG5zQXR0cmlidXRlcykpIHsKICAgICAgICBjb25zdCBkYXRhTm9kZSA9IGF0dHJpYnV0ZXNbJG5zQXR0cmlidXRlc10ueGZhLmRhdGFOb2RlOwogICAgICAgIGlmIChkYXRhTm9kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAoZGF0YU5vZGUgPT09ICJkYXRhR3JvdXAiKSB7CiAgICAgICAgICAgIHRoaXNbX2RhdGFWYWx1ZV0gPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YU5vZGUgPT09ICJkYXRhVmFsdWUiKSB7CiAgICAgICAgICAgIHRoaXNbX2RhdGFWYWx1ZV0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpc1skY29uc3VtZWRdID0gZmFsc2U7CiAgfQogIFskdG9TdHJpbmddKGJ1ZikgewogICAgY29uc3QgdGFnTmFtZSA9IHRoaXNbJG5vZGVOYW1lXTsKICAgIGlmICh0YWdOYW1lID09PSAiI3RleHQiKSB7CiAgICAgIGJ1Zi5wdXNoKGVuY29kZVRvWG1sU3RyaW5nKHRoaXNbJGNvbnRlbnRdKSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHV0ZjhUYWdOYW1lID0gdXRmOFN0cmluZ1RvU3RyaW5nKHRhZ05hbWUpOwogICAgY29uc3QgcHJlZml4ID0gdGhpc1skbmFtZXNwYWNlSWRdID09PSBOU19EQVRBU0VUUyA/ICJ4ZmE6IiA6ICIiOwogICAgYnVmLnB1c2goYDwke3ByZWZpeH0ke3V0ZjhUYWdOYW1lfWApOwogICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIHRoaXNbX2F0dHJpYnV0ZXNdLmVudHJpZXMoKSkgewogICAgICBjb25zdCB1dGY4TmFtZSA9IHV0ZjhTdHJpbmdUb1N0cmluZyhuYW1lKTsKICAgICAgYnVmLnB1c2goYCAke3V0ZjhOYW1lfT0iJHtlbmNvZGVUb1htbFN0cmluZyh2YWx1ZVskY29udGVudF0pfSJgKTsKICAgIH0KICAgIGlmICh0aGlzW19kYXRhVmFsdWVdICE9PSBudWxsKSB7CiAgICAgIGlmICh0aGlzW19kYXRhVmFsdWVdKSB7CiAgICAgICAgYnVmLnB1c2goYCB4ZmE6ZGF0YU5vZGU9ImRhdGFWYWx1ZSJgKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBidWYucHVzaChgIHhmYTpkYXRhTm9kZT0iZGF0YUdyb3VwImApOwogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXNbJGNvbnRlbnRdICYmIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPT09IDApIHsKICAgICAgYnVmLnB1c2goIi8+Iik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGJ1Zi5wdXNoKCI+Iik7CiAgICBpZiAodGhpc1skY29udGVudF0pIHsKICAgICAgaWYgKHR5cGVvZiB0aGlzWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgICBidWYucHVzaChlbmNvZGVUb1htbFN0cmluZyh0aGlzWyRjb250ZW50XSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXNbJGNvbnRlbnRdWyR0b1N0cmluZ10oYnVmKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgICBjaGlsZFskdG9TdHJpbmddKGJ1Zik7CiAgICAgIH0KICAgIH0KICAgIGJ1Zi5wdXNoKGA8LyR7cHJlZml4fSR7dXRmOFRhZ05hbWV9PmApOwogIH0KICBbJG9uQ2hpbGRdKGNoaWxkKSB7CiAgICBpZiAodGhpc1skY29udGVudF0pIHsKICAgICAgY29uc3Qgbm9kZSA9IG5ldyBYbWxPYmplY3QodGhpc1skbmFtZXNwYWNlSWRdLCAiI3RleHQiKTsKICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICBub2RlWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdOwogICAgICB0aGlzWyRjb250ZW50XSA9ICIiOwogICAgfQogICAgdGhpc1skYXBwZW5kQ2hpbGRdKGNoaWxkKTsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJG9uVGV4dF0oc3RyKSB7CiAgICB0aGlzWyRjb250ZW50XSArPSBzdHI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgaWYgKHRoaXNbJGNvbnRlbnRdICYmIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBuZXcgWG1sT2JqZWN0KHRoaXNbJG5hbWVzcGFjZUlkXSwgIiN0ZXh0Iik7CiAgICAgIHRoaXNbJGFwcGVuZENoaWxkXShub2RlKTsKICAgICAgbm9kZVskY29udGVudF0gPSB0aGlzWyRjb250ZW50XTsKICAgICAgZGVsZXRlIHRoaXNbJGNvbnRlbnRdOwogICAgfQogIH0KICBbJHRvSFRNTF0oKSB7CiAgICBpZiAodGhpc1skbm9kZU5hbWVdID09PSAiI3RleHQiKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICAgIG5hbWU6ICIjdGV4dCIsCiAgICAgICAgdmFsdWU6IHRoaXNbJGNvbnRlbnRdCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgfQogIFskZ2V0Q2hpbGRyZW5dKG5hbWUgPSBudWxsKSB7CiAgICBpZiAoIW5hbWUpIHsKICAgICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXTsKICAgIH0KICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0uZmlsdGVyKGMgPT4gY1skbm9kZU5hbWVdID09PSBuYW1lKTsKICB9CiAgWyRnZXRBdHRyaWJ1dGVzXSgpIHsKICAgIHJldHVybiB0aGlzW19hdHRyaWJ1dGVzXTsKICB9CiAgWyRnZXRDaGlsZHJlbkJ5Q2xhc3NdKG5hbWUpIHsKICAgIGNvbnN0IHZhbHVlID0gdGhpc1tfYXR0cmlidXRlc10uZ2V0KG5hbWUpOwogICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGdldENoaWxkcmVuXShuYW1lKTsKICB9CiAgKlskZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQpIHsKICAgIGNvbnN0IHZhbHVlID0gdGhpc1tfYXR0cmlidXRlc10uZ2V0KG5hbWUpOwogICAgaWYgKHZhbHVlKSB7CiAgICAgIHlpZWxkIHZhbHVlOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgaWYgKGNoaWxkWyRub2RlTmFtZV0gPT09IG5hbWUpIHsKICAgICAgICB5aWVsZCBjaGlsZDsKICAgICAgfQogICAgICBpZiAoYWxsVHJhbnNwYXJlbnQpIHsKICAgICAgICB5aWVsZCogY2hpbGRbJGdldENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50KTsKICAgICAgfQogICAgfQogIH0KICAqWyRnZXRBdHRyaWJ1dGVJdF0obmFtZSwgc2tpcENvbnN1bWVkKSB7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXNbX2F0dHJpYnV0ZXNdLmdldChuYW1lKTsKICAgIGlmICh2YWx1ZSAmJiAoIXNraXBDb25zdW1lZCB8fCAhdmFsdWVbJGNvbnN1bWVkXSkpIHsKICAgICAgeWllbGQgdmFsdWU7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICB5aWVsZCogY2hpbGRbJGdldEF0dHJpYnV0ZUl0XShuYW1lLCBza2lwQ29uc3VtZWQpOwogICAgfQogIH0KICAqWyRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIHNraXBDb25zdW1lZCkgewogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgaWYgKGNoaWxkWyRub2RlTmFtZV0gPT09IG5hbWUgJiYgKCFza2lwQ29uc3VtZWQgfHwgIWNoaWxkWyRjb25zdW1lZF0pKSB7CiAgICAgICAgeWllbGQgY2hpbGQ7CiAgICAgIH0KICAgICAgaWYgKGFsbFRyYW5zcGFyZW50KSB7CiAgICAgICAgeWllbGQqIGNoaWxkWyRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIHNraXBDb25zdW1lZCk7CiAgICAgIH0KICAgIH0KICB9CiAgWyRpc0RhdGFWYWx1ZV0oKSB7CiAgICBpZiAodGhpc1tfZGF0YVZhbHVlXSA9PT0gbnVsbCkgewogICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMCB8fCB0aGlzW19jaGlsZHJlbl1bMF1bJG5hbWVzcGFjZUlkXSA9PT0gTmFtZXNwYWNlSWRzLnhodG1sLmlkOwogICAgfQogICAgcmV0dXJuIHRoaXNbX2RhdGFWYWx1ZV07CiAgfQogIFskZ2V0RGF0YVZhbHVlXSgpIHsKICAgIGlmICh0aGlzW19kYXRhVmFsdWVdID09PSBudWxsKSB7CiAgICAgIGlmICh0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgICAgfQogICAgICBpZiAodGhpc1tfY2hpbGRyZW5dWzBdWyRuYW1lc3BhY2VJZF0gPT09IE5hbWVzcGFjZUlkcy54aHRtbC5pZCkgewogICAgICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl1bMF1bJHRleHRdKCkudHJpbSgpOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICB9CiAgWyRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIHZhbHVlID0gdmFsdWUudmFsdWUgfHwgIiI7CiAgICB0aGlzWyRjb250ZW50XSA9IHZhbHVlLnRvU3RyaW5nKCk7CiAgfQogIFskZHVtcF0oaGFzTlMgPSBmYWxzZSkgewogICAgY29uc3QgZHVtcGVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmIChoYXNOUykgewogICAgICBkdW1wZWQuJG5zID0gdGhpc1skbmFtZXNwYWNlSWRdOwogICAgfQogICAgaWYgKHRoaXNbJGNvbnRlbnRdKSB7CiAgICAgIGR1bXBlZC4kY29udGVudCA9IHRoaXNbJGNvbnRlbnRdOwogICAgfQogICAgZHVtcGVkLiRuYW1lID0gdGhpc1skbm9kZU5hbWVdOwogICAgZHVtcGVkLmNoaWxkcmVuID0gW107CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICBkdW1wZWQuY2hpbGRyZW4ucHVzaChjaGlsZFskZHVtcF0oaGFzTlMpKTsKICAgIH0KICAgIGR1bXBlZC5hdHRyaWJ1dGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiB0aGlzW19hdHRyaWJ1dGVzXSkgewogICAgICBkdW1wZWQuYXR0cmlidXRlc1tuYW1lXSA9IHZhbHVlWyRjb250ZW50XTsKICAgIH0KICAgIHJldHVybiBkdW1wZWQ7CiAgfQp9CmNsYXNzIENvbnRlbnRPYmplY3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUpIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUpOwogICAgdGhpc1skY29udGVudF0gPSAiIjsKICB9CiAgWyRvblRleHRdKHRleHQpIHsKICAgIHRoaXNbJGNvbnRlbnRdICs9IHRleHQ7CiAgfQogIFskZmluYWxpemVdKCkge30KfQpjbGFzcyBPcHRpb25PYmplY3QgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lLCBvcHRpb25zKSB7CiAgICBzdXBlcihuc0lkLCBuYW1lKTsKICAgIHRoaXNbX29wdGlvbnNdID0gb3B0aW9uczsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IGdldEtleXdvcmQoewogICAgICBkYXRhOiB0aGlzWyRjb250ZW50XSwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzW19vcHRpb25zXVswXSwKICAgICAgdmFsaWRhdGU6IGsgPT4gdGhpc1tfb3B0aW9uc10uaW5jbHVkZXMoaykKICAgIH0pOwogIH0KICBbJGNsZWFuXShidWlsZGVyKSB7CiAgICBzdXBlclskY2xlYW5dKGJ1aWxkZXIpOwogICAgZGVsZXRlIHRoaXNbX29wdGlvbnNdOwogIH0KfQpjbGFzcyBTdHJpbmdPYmplY3QgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0udHJpbSgpOwogIH0KfQpjbGFzcyBJbnRlZ2VyT2JqZWN0IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSwgZGVmYXVsdFZhbHVlLCB2YWxpZGF0b3IpIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUpOwogICAgdGhpc1tfZGVmYXVsdFZhbHVlXSA9IGRlZmF1bHRWYWx1ZTsKICAgIHRoaXNbX3ZhbGlkYXRvcl0gPSB2YWxpZGF0b3I7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogdGhpc1skY29udGVudF0sCiAgICAgIGRlZmF1bHRWYWx1ZTogdGhpc1tfZGVmYXVsdFZhbHVlXSwKICAgICAgdmFsaWRhdGU6IHRoaXNbX3ZhbGlkYXRvcl0KICAgIH0pOwogIH0KICBbJGNsZWFuXShidWlsZGVyKSB7CiAgICBzdXBlclskY2xlYW5dKGJ1aWxkZXIpOwogICAgZGVsZXRlIHRoaXNbX2RlZmF1bHRWYWx1ZV07CiAgICBkZWxldGUgdGhpc1tfdmFsaWRhdG9yXTsKICB9Cn0KY2xhc3MgT3B0aW9uMDEgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lKSB7CiAgICBzdXBlcihuc0lkLCBuYW1lLCAwLCBuID0+IG4gPT09IDEpOwogIH0KfQpjbGFzcyBPcHRpb24xMCBleHRlbmRzIEludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUpIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUsIDEsIG4gPT4gbiA9PT0gMCk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvaHRtbF91dGlscy5qcwoKCgoKCgpmdW5jdGlvbiBtZWFzdXJlVG9TdHJpbmcobSkgewogIGlmICh0eXBlb2YgbSA9PT0gInN0cmluZyIpIHsKICAgIHJldHVybiAiMHB4IjsKICB9CiAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIobSkgPyBgJHttfXB4YCA6IGAke20udG9GaXhlZCgyKX1weGA7Cn0KY29uc3QgY29udmVydGVycyA9IHsKICBhbmNob3JUeXBlKG5vZGUsIHN0eWxlKSB7CiAgICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgaWYgKCFwYXJlbnQgfHwgcGFyZW50LmxheW91dCAmJiBwYXJlbnQubGF5b3V0ICE9PSAicG9zaXRpb24iKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghKCJ0cmFuc2Zvcm0iIGluIHN0eWxlKSkgewogICAgICBzdHlsZS50cmFuc2Zvcm0gPSAiIjsKICAgIH0KICAgIHN3aXRjaCAobm9kZS5hbmNob3JUeXBlKSB7CiAgICAgIGNhc2UgImJvdHRvbUNlbnRlciI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTUwJSwgLTEwMCUpIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiYm90dG9tTGVmdCI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoMCwtMTAwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJib3R0b21SaWdodCI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTEwMCUsLTEwMCUpIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAibWlkZGxlQ2VudGVyIjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgtNTAlLC01MCUpIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAibWlkZGxlTGVmdCI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoMCwtNTAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm1pZGRsZVJpZ2h0IjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgtMTAwJSwtNTAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInRvcENlbnRlciI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTUwJSwwKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInRvcFJpZ2h0IjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgtMTAwJSwwKSI7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfSwKICBkaW1lbnNpb25zKG5vZGUsIHN0eWxlKSB7CiAgICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgbGV0IHdpZHRoID0gbm9kZS53OwogICAgY29uc3QgaGVpZ2h0ID0gbm9kZS5oOwogICAgaWYgKHBhcmVudC5sYXlvdXQ/LmluY2x1ZGVzKCJyb3ciKSkgewogICAgICBjb25zdCBleHRyYSA9IHBhcmVudFskZXh0cmFdOwogICAgICBjb25zdCBjb2xTcGFuID0gbm9kZS5jb2xTcGFuOwogICAgICBsZXQgdzsKICAgICAgaWYgKGNvbFNwYW4gPT09IC0xKSB7CiAgICAgICAgdyA9IE1hdGguc3VtUHJlY2lzZShleHRyYS5jb2x1bW5XaWR0aHMuc2xpY2UoZXh0cmEuY3VycmVudENvbHVtbikpOwogICAgICAgIGV4dHJhLmN1cnJlbnRDb2x1bW4gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHcgPSBNYXRoLnN1bVByZWNpc2UoZXh0cmEuY29sdW1uV2lkdGhzLnNsaWNlKGV4dHJhLmN1cnJlbnRDb2x1bW4sIGV4dHJhLmN1cnJlbnRDb2x1bW4gKyBjb2xTcGFuKSk7CiAgICAgICAgZXh0cmEuY3VycmVudENvbHVtbiA9IChleHRyYS5jdXJyZW50Q29sdW1uICsgbm9kZS5jb2xTcGFuKSAlIGV4dHJhLmNvbHVtbldpZHRocy5sZW5ndGg7CiAgICAgIH0KICAgICAgaWYgKCFpc05hTih3KSkgewogICAgICAgIHdpZHRoID0gbm9kZS53ID0gdzsKICAgICAgfQogICAgfQogICAgc3R5bGUud2lkdGggPSB3aWR0aCAhPT0gIiIgPyBtZWFzdXJlVG9TdHJpbmcod2lkdGgpIDogImF1dG8iOwogICAgc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICE9PSAiIiA/IG1lYXN1cmVUb1N0cmluZyhoZWlnaHQpIDogImF1dG8iOwogIH0sCiAgcG9zaXRpb24obm9kZSwgc3R5bGUpIHsKICAgIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICBpZiAocGFyZW50Py5sYXlvdXQgJiYgcGFyZW50LmxheW91dCAhPT0gInBvc2l0aW9uIikgewogICAgICByZXR1cm47CiAgICB9CiAgICBzdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICBzdHlsZS5sZWZ0ID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUueCk7CiAgICBzdHlsZS50b3AgPSBtZWFzdXJlVG9TdHJpbmcobm9kZS55KTsKICB9LAogIHJvdGF0ZShub2RlLCBzdHlsZSkgewogICAgaWYgKG5vZGUucm90YXRlKSB7CiAgICAgIGlmICghKCJ0cmFuc2Zvcm0iIGluIHN0eWxlKSkgewogICAgICAgIHN0eWxlLnRyYW5zZm9ybSA9ICIiOwogICAgICB9CiAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSBgcm90YXRlKC0ke25vZGUucm90YXRlfWRlZylgOwogICAgICBzdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAidG9wIGxlZnQiOwogICAgfQogIH0sCiAgcHJlc2VuY2Uobm9kZSwgc3R5bGUpIHsKICAgIHN3aXRjaCAobm9kZS5wcmVzZW5jZSkgewogICAgICBjYXNlICJpbnZpc2libGUiOgogICAgICAgIHN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiaGlkZGVuIjoKICAgICAgY2FzZSAiaW5hY3RpdmUiOgogICAgICAgIHN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfSwKICBoQWxpZ24obm9kZSwgc3R5bGUpIHsKICAgIGlmIChub2RlWyRub2RlTmFtZV0gPT09ICJwYXJhIikgewogICAgICBzd2l0Y2ggKG5vZGUuaEFsaWduKSB7CiAgICAgICAgY2FzZSAianVzdGlmeUFsbCI6CiAgICAgICAgICBzdHlsZS50ZXh0QWxpZ24gPSAianVzdGlmeS1hbGwiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmFkaXgiOgogICAgICAgICAgc3R5bGUudGV4dEFsaWduID0gImxlZnQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHN0eWxlLnRleHRBbGlnbiA9IG5vZGUuaEFsaWduOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBzd2l0Y2ggKG5vZGUuaEFsaWduKSB7CiAgICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgICBzdHlsZS5hbGlnblNlbGYgPSAic3RhcnQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICAgIHN0eWxlLmFsaWduU2VsZiA9ICJjZW50ZXIiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgICAgc3R5bGUuYWxpZ25TZWxmID0gImVuZCI7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0sCiAgbWFyZ2luKG5vZGUsIHN0eWxlKSB7CiAgICBpZiAobm9kZS5tYXJnaW4pIHsKICAgICAgc3R5bGUubWFyZ2luID0gbm9kZS5tYXJnaW5bJHRvU3R5bGVdKCkubWFyZ2luOwogICAgfQogIH0KfTsKZnVuY3Rpb24gc2V0TWluTWF4RGltZW5zaW9ucyhub2RlLCBzdHlsZSkgewogIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgaWYgKHBhcmVudC5sYXlvdXQgPT09ICJwb3NpdGlvbiIpIHsKICAgIGlmIChub2RlLm1pblcgPiAwKSB7CiAgICAgIHN0eWxlLm1pbldpZHRoID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUubWluVyk7CiAgICB9CiAgICBpZiAobm9kZS5tYXhXID4gMCkgewogICAgICBzdHlsZS5tYXhXaWR0aCA9IG1lYXN1cmVUb1N0cmluZyhub2RlLm1heFcpOwogICAgfQogICAgaWYgKG5vZGUubWluSCA+IDApIHsKICAgICAgc3R5bGUubWluSGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUubWluSCk7CiAgICB9CiAgICBpZiAobm9kZS5tYXhIID4gMCkgewogICAgICBzdHlsZS5tYXhIZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcobm9kZS5tYXhIKTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gbGF5b3V0VGV4dCh0ZXh0LCB4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIsIHdpZHRoKSB7CiAgY29uc3QgbWVhc3VyZSA9IG5ldyBUZXh0TWVhc3VyZSh4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIpOwogIGlmICh0eXBlb2YgdGV4dCA9PT0gInN0cmluZyIpIHsKICAgIG1lYXN1cmUuYWRkU3RyaW5nKHRleHQpOwogIH0gZWxzZSB7CiAgICB0ZXh0WyRwdXNoR2x5cGhzXShtZWFzdXJlKTsKICB9CiAgcmV0dXJuIG1lYXN1cmUuY29tcHV0ZSh3aWR0aCk7Cn0KZnVuY3Rpb24gbGF5b3V0Tm9kZShub2RlLCBhdmFpbGFibGVTcGFjZSkgewogIGxldCBoZWlnaHQgPSBudWxsOwogIGxldCB3aWR0aCA9IG51bGw7CiAgbGV0IGlzQnJva2VuID0gZmFsc2U7CiAgaWYgKCghbm9kZS53IHx8ICFub2RlLmgpICYmIG5vZGUudmFsdWUpIHsKICAgIGxldCBtYXJnaW5IID0gMDsKICAgIGxldCBtYXJnaW5WID0gMDsKICAgIGlmIChub2RlLm1hcmdpbikgewogICAgICBtYXJnaW5IID0gbm9kZS5tYXJnaW4ubGVmdEluc2V0ICsgbm9kZS5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgbWFyZ2luViA9IG5vZGUubWFyZ2luLnRvcEluc2V0ICsgbm9kZS5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICB9CiAgICBsZXQgbGluZUhlaWdodCA9IG51bGw7CiAgICBsZXQgbWFyZ2luID0gbnVsbDsKICAgIGlmIChub2RlLnBhcmEpIHsKICAgICAgbWFyZ2luID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgbGluZUhlaWdodCA9IG5vZGUucGFyYS5saW5lSGVpZ2h0ID09PSAiIiA/IG51bGwgOiBub2RlLnBhcmEubGluZUhlaWdodDsKICAgICAgbWFyZ2luLnRvcCA9IG5vZGUucGFyYS5zcGFjZUFib3ZlID09PSAiIiA/IDAgOiBub2RlLnBhcmEuc3BhY2VBYm92ZTsKICAgICAgbWFyZ2luLmJvdHRvbSA9IG5vZGUucGFyYS5zcGFjZUJlbG93ID09PSAiIiA/IDAgOiBub2RlLnBhcmEuc3BhY2VCZWxvdzsKICAgICAgbWFyZ2luLmxlZnQgPSBub2RlLnBhcmEubWFyZ2luTGVmdCA9PT0gIiIgPyAwIDogbm9kZS5wYXJhLm1hcmdpbkxlZnQ7CiAgICAgIG1hcmdpbi5yaWdodCA9IG5vZGUucGFyYS5tYXJnaW5SaWdodCA9PT0gIiIgPyAwIDogbm9kZS5wYXJhLm1hcmdpblJpZ2h0OwogICAgfQogICAgbGV0IGZvbnQgPSBub2RlLmZvbnQ7CiAgICBpZiAoIWZvbnQpIHsKICAgICAgY29uc3Qgcm9vdCA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKTsKICAgICAgbGV0IHBhcmVudCA9IG5vZGVbJGdldFBhcmVudF0oKTsKICAgICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT09IHJvb3QpIHsKICAgICAgICBpZiAocGFyZW50LmZvbnQpIHsKICAgICAgICAgIGZvbnQgPSBwYXJlbnQuZm9udDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbJGdldFBhcmVudF0oKTsKICAgICAgfQogICAgfQogICAgY29uc3QgbWF4V2lkdGggPSAobm9kZS53IHx8IGF2YWlsYWJsZVNwYWNlLndpZHRoKSAtIG1hcmdpbkg7CiAgICBjb25zdCBmb250RmluZGVyID0gbm9kZVskZ2xvYmFsRGF0YV0uZm9udEZpbmRlcjsKICAgIGlmIChub2RlLnZhbHVlLmV4RGF0YSAmJiBub2RlLnZhbHVlLmV4RGF0YVskY29udGVudF0gJiYgbm9kZS52YWx1ZS5leERhdGEuY29udGVudFR5cGUgPT09ICJ0ZXh0L2h0bWwiKSB7CiAgICAgIGNvbnN0IHJlcyA9IGxheW91dFRleHQobm9kZS52YWx1ZS5leERhdGFbJGNvbnRlbnRdLCBmb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIsIG1heFdpZHRoKTsKICAgICAgd2lkdGggPSByZXMud2lkdGg7CiAgICAgIGhlaWdodCA9IHJlcy5oZWlnaHQ7CiAgICAgIGlzQnJva2VuID0gcmVzLmlzQnJva2VuOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgdGV4dCA9IG5vZGUudmFsdWVbJHRleHRdKCk7CiAgICAgIGlmICh0ZXh0KSB7CiAgICAgICAgY29uc3QgcmVzID0gbGF5b3V0VGV4dCh0ZXh0LCBmb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIsIG1heFdpZHRoKTsKICAgICAgICB3aWR0aCA9IHJlcy53aWR0aDsKICAgICAgICBoZWlnaHQgPSByZXMuaGVpZ2h0OwogICAgICAgIGlzQnJva2VuID0gcmVzLmlzQnJva2VuOwogICAgICB9CiAgICB9CiAgICBpZiAod2lkdGggIT09IG51bGwgJiYgIW5vZGUudykgewogICAgICB3aWR0aCArPSBtYXJnaW5IOwogICAgfQogICAgaWYgKGhlaWdodCAhPT0gbnVsbCAmJiAhbm9kZS5oKSB7CiAgICAgIGhlaWdodCArPSBtYXJnaW5WOwogICAgfQogIH0KICByZXR1cm4gewogICAgdzogd2lkdGgsCiAgICBoOiBoZWlnaHQsCiAgICBpc0Jyb2tlbgogIH07Cn0KZnVuY3Rpb24gY29tcHV0ZUJib3gobm9kZSwgaHRtbCwgYXZhaWxhYmxlU3BhY2UpIHsKICBsZXQgYmJveDsKICBpZiAobm9kZS53ICE9PSAiIiAmJiBub2RlLmggIT09ICIiKSB7CiAgICBiYm94ID0gW25vZGUueCwgbm9kZS55LCBub2RlLncsIG5vZGUuaF07CiAgfSBlbHNlIHsKICAgIGlmICghYXZhaWxhYmxlU3BhY2UpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgd2lkdGggPSBub2RlLnc7CiAgICBpZiAod2lkdGggPT09ICIiKSB7CiAgICAgIGlmIChub2RlLm1heFcgPT09IDApIHsKICAgICAgICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgICAgIHdpZHRoID0gcGFyZW50LmxheW91dCA9PT0gInBvc2l0aW9uIiAmJiBwYXJlbnQudyAhPT0gIiIgPyAwIDogbm9kZS5taW5XOwogICAgICB9IGVsc2UgewogICAgICAgIHdpZHRoID0gTWF0aC5taW4obm9kZS5tYXhXLCBhdmFpbGFibGVTcGFjZS53aWR0aCk7CiAgICAgIH0KICAgICAgaHRtbC5hdHRyaWJ1dGVzLnN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHdpZHRoKTsKICAgIH0KICAgIGxldCBoZWlnaHQgPSBub2RlLmg7CiAgICBpZiAoaGVpZ2h0ID09PSAiIikgewogICAgICBpZiAobm9kZS5tYXhIID09PSAwKSB7CiAgICAgICAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgICAgICBoZWlnaHQgPSBwYXJlbnQubGF5b3V0ID09PSAicG9zaXRpb24iICYmIHBhcmVudC5oICE9PSAiIiA/IDAgOiBub2RlLm1pbkg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGVpZ2h0ID0gTWF0aC5taW4obm9kZS5tYXhILCBhdmFpbGFibGVTcGFjZS5oZWlnaHQpOwogICAgICB9CiAgICAgIGh0bWwuYXR0cmlidXRlcy5zdHlsZS5oZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcoaGVpZ2h0KTsKICAgIH0KICAgIGJib3ggPSBbbm9kZS54LCBub2RlLnksIHdpZHRoLCBoZWlnaHRdOwogIH0KICByZXR1cm4gYmJveDsKfQpmdW5jdGlvbiBmaXhEaW1lbnNpb25zKG5vZGUpIHsKICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogIGlmIChwYXJlbnQubGF5b3V0Py5pbmNsdWRlcygicm93IikpIHsKICAgIGNvbnN0IGV4dHJhID0gcGFyZW50WyRleHRyYV07CiAgICBjb25zdCBjb2xTcGFuID0gbm9kZS5jb2xTcGFuOwogICAgbGV0IHdpZHRoOwogICAgaWYgKGNvbFNwYW4gPT09IC0xKSB7CiAgICAgIHdpZHRoID0gTWF0aC5zdW1QcmVjaXNlKGV4dHJhLmNvbHVtbldpZHRocy5zbGljZShleHRyYS5jdXJyZW50Q29sdW1uKSk7CiAgICB9IGVsc2UgewogICAgICB3aWR0aCA9IE1hdGguc3VtUHJlY2lzZShleHRyYS5jb2x1bW5XaWR0aHMuc2xpY2UoZXh0cmEuY3VycmVudENvbHVtbiwgZXh0cmEuY3VycmVudENvbHVtbiArIGNvbFNwYW4pKTsKICAgIH0KICAgIGlmICghaXNOYU4od2lkdGgpKSB7CiAgICAgIG5vZGUudyA9IHdpZHRoOwogICAgfQogIH0KICBpZiAocGFyZW50LmxheW91dCAmJiBwYXJlbnQubGF5b3V0ICE9PSAicG9zaXRpb24iKSB7CiAgICBub2RlLnggPSBub2RlLnkgPSAwOwogIH0KICBpZiAobm9kZS5sYXlvdXQgPT09ICJ0YWJsZSIpIHsKICAgIGlmIChub2RlLncgPT09ICIiICYmIEFycmF5LmlzQXJyYXkobm9kZS5jb2x1bW5XaWR0aHMpKSB7CiAgICAgIG5vZGUudyA9IE1hdGguc3VtUHJlY2lzZShub2RlLmNvbHVtbldpZHRocyk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGxheW91dENsYXNzKG5vZGUpIHsKICBzd2l0Y2ggKG5vZGUubGF5b3V0KSB7CiAgICBjYXNlICJwb3NpdGlvbiI6CiAgICAgIHJldHVybiAieGZhUG9zaXRpb24iOwogICAgY2FzZSAibHItdGIiOgogICAgICByZXR1cm4gInhmYUxyVGIiOwogICAgY2FzZSAicmwtcm93IjoKICAgICAgcmV0dXJuICJ4ZmFSbFJvdyI7CiAgICBjYXNlICJybC10YiI6CiAgICAgIHJldHVybiAieGZhUmxUYiI7CiAgICBjYXNlICJyb3ciOgogICAgICByZXR1cm4gInhmYVJvdyI7CiAgICBjYXNlICJ0YWJsZSI6CiAgICAgIHJldHVybiAieGZhVGFibGUiOwogICAgY2FzZSAidGIiOgogICAgICByZXR1cm4gInhmYVRiIjsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiAieGZhUG9zaXRpb24iOwogIH0KfQpmdW5jdGlvbiB0b1N0eWxlKG5vZGUsIC4uLm5hbWVzKSB7CiAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykgewogICAgY29uc3QgdmFsdWUgPSBub2RlW25hbWVdOwogICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKGNvbnZlcnRlcnMuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgY29udmVydGVyc1tuYW1lXShub2RlLCBzdHlsZSk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgWEZBT2JqZWN0KSB7CiAgICAgIGNvbnN0IG5ld1N0eWxlID0gdmFsdWVbJHRvU3R5bGVdKCk7CiAgICAgIGlmIChuZXdTdHlsZSkgewogICAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIG5ld1N0eWxlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKGAoREVCVUcpIC0gWEZBIC0gc3R5bGUgZm9yICR7bmFtZX0gbm90IGltcGxlbWVudGVkIHlldGApOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiBzdHlsZTsKfQpmdW5jdGlvbiBjcmVhdGVXcmFwcGVyKG5vZGUsIGh0bWwpIHsKICBjb25zdCB7CiAgICBhdHRyaWJ1dGVzCiAgfSA9IGh0bWw7CiAgY29uc3QgewogICAgc3R5bGUKICB9ID0gYXR0cmlidXRlczsKICBjb25zdCB3cmFwcGVyID0gewogICAgbmFtZTogImRpdiIsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGNsYXNzOiBbInhmYVdyYXBwZXIiXSwKICAgICAgc3R5bGU6IE9iamVjdC5jcmVhdGUobnVsbCkKICAgIH0sCiAgICBjaGlsZHJlbjogW10KICB9OwogIGF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhV3JhcHBlZCIpOwogIGlmIChub2RlLmJvcmRlcikgewogICAgY29uc3QgewogICAgICB3aWR0aHMsCiAgICAgIGluc2V0cwogICAgfSA9IG5vZGUuYm9yZGVyWyRleHRyYV07CiAgICBsZXQgd2lkdGgsIGhlaWdodDsKICAgIGxldCB0b3AgPSBpbnNldHNbMF07CiAgICBsZXQgbGVmdCA9IGluc2V0c1szXTsKICAgIGNvbnN0IGluc2V0c0ggPSBpbnNldHNbMF0gKyBpbnNldHNbMl07CiAgICBjb25zdCBpbnNldHNXID0gaW5zZXRzWzFdICsgaW5zZXRzWzNdOwogICAgc3dpdGNoIChub2RlLmJvcmRlci5oYW5kKSB7CiAgICAgIGNhc2UgImV2ZW4iOgogICAgICAgIHRvcCAtPSB3aWR0aHNbMF0gLyAyOwogICAgICAgIGxlZnQgLT0gd2lkdGhzWzNdIC8gMjsKICAgICAgICB3aWR0aCA9IGBjYWxjKDEwMCUgKyAkeyh3aWR0aHNbMV0gKyB3aWR0aHNbM10pIC8gMiAtIGluc2V0c1d9cHgpYDsKICAgICAgICBoZWlnaHQgPSBgY2FsYygxMDAlICsgJHsod2lkdGhzWzBdICsgd2lkdGhzWzJdKSAvIDIgLSBpbnNldHNIfXB4KWA7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImxlZnQiOgogICAgICAgIHRvcCAtPSB3aWR0aHNbMF07CiAgICAgICAgbGVmdCAtPSB3aWR0aHNbM107CiAgICAgICAgd2lkdGggPSBgY2FsYygxMDAlICsgJHt3aWR0aHNbMV0gKyB3aWR0aHNbM10gLSBpbnNldHNXfXB4KWA7CiAgICAgICAgaGVpZ2h0ID0gYGNhbGMoMTAwJSArICR7d2lkdGhzWzBdICsgd2lkdGhzWzJdIC0gaW5zZXRzSH1weClgOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgd2lkdGggPSBpbnNldHNXID8gYGNhbGMoMTAwJSAtICR7aW5zZXRzV31weClgIDogIjEwMCUiOwogICAgICAgIGhlaWdodCA9IGluc2V0c0ggPyBgY2FsYygxMDAlIC0gJHtpbnNldHNIfXB4KWAgOiAiMTAwJSI7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFCb3JkZXIiXTsKICAgIGlmIChpc1ByaW50T25seShub2RlLmJvcmRlcikpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIGNvbnN0IGJvcmRlciA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogY2xhc3NOYW1lcywKICAgICAgICBzdHlsZTogewogICAgICAgICAgdG9wOiBgJHt0b3B9cHhgLAogICAgICAgICAgbGVmdDogYCR7bGVmdH1weGAsCiAgICAgICAgICB3aWR0aCwKICAgICAgICAgIGhlaWdodAogICAgICAgIH0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFtdCiAgICB9OwogICAgZm9yIChjb25zdCBrZXkgb2YgWyJib3JkZXIiLCAiYm9yZGVyV2lkdGgiLCAiYm9yZGVyQ29sb3IiLCAiYm9yZGVyUmFkaXVzIiwgImJvcmRlclN0eWxlIl0pIHsKICAgICAgaWYgKHN0eWxlW2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIGJvcmRlci5hdHRyaWJ1dGVzLnN0eWxlW2tleV0gPSBzdHlsZVtrZXldOwogICAgICAgIGRlbGV0ZSBzdHlsZVtrZXldOwogICAgICB9CiAgICB9CiAgICB3cmFwcGVyLmNoaWxkcmVuLnB1c2goYm9yZGVyLCBodG1sKTsKICB9IGVsc2UgewogICAgd3JhcHBlci5jaGlsZHJlbi5wdXNoKGh0bWwpOwogIH0KICBmb3IgKGNvbnN0IGtleSBvZiBbImJhY2tncm91bmQiLCAiYmFja2dyb3VuZENsaXAiLCAidG9wIiwgImxlZnQiLCAid2lkdGgiLCAiaGVpZ2h0IiwgIm1pbldpZHRoIiwgIm1pbkhlaWdodCIsICJtYXhXaWR0aCIsICJtYXhIZWlnaHQiLCAidHJhbnNmb3JtIiwgInRyYW5zZm9ybU9yaWdpbiIsICJ2aXNpYmlsaXR5Il0pIHsKICAgIGlmIChzdHlsZVtrZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgd3JhcHBlci5hdHRyaWJ1dGVzLnN0eWxlW2tleV0gPSBzdHlsZVtrZXldOwogICAgICBkZWxldGUgc3R5bGVba2V5XTsKICAgIH0KICB9CiAgd3JhcHBlci5hdHRyaWJ1dGVzLnN0eWxlLnBvc2l0aW9uID0gc3R5bGUucG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgPyAiYWJzb2x1dGUiIDogInJlbGF0aXZlIjsKICBkZWxldGUgc3R5bGUucG9zaXRpb247CiAgaWYgKHN0eWxlLmFsaWduU2VsZikgewogICAgd3JhcHBlci5hdHRyaWJ1dGVzLnN0eWxlLmFsaWduU2VsZiA9IHN0eWxlLmFsaWduU2VsZjsKICAgIGRlbGV0ZSBzdHlsZS5hbGlnblNlbGY7CiAgfQogIHJldHVybiB3cmFwcGVyOwp9CmZ1bmN0aW9uIGZpeFRleHRJbmRlbnQoc3R5bGVzKSB7CiAgY29uc3QgaW5kZW50ID0gZ2V0TWVhc3VyZW1lbnQoc3R5bGVzLnRleHRJbmRlbnQsICIwcHgiKTsKICBpZiAoaW5kZW50ID49IDApIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgYWxpZ24gPSBzdHlsZXMudGV4dEFsaWduID09PSAicmlnaHQiID8gInJpZ2h0IiA6ICJsZWZ0IjsKICBjb25zdCBuYW1lID0gInBhZGRpbmciICsgKGFsaWduID09PSAibGVmdCIgPyAiTGVmdCIgOiAiUmlnaHQiKTsKICBjb25zdCBwYWRkaW5nID0gZ2V0TWVhc3VyZW1lbnQoc3R5bGVzW25hbWVdLCAiMHB4Iik7CiAgc3R5bGVzW25hbWVdID0gYCR7cGFkZGluZyAtIGluZGVudH1weGA7Cn0KZnVuY3Rpb24gc2V0QWNjZXNzKG5vZGUsIGNsYXNzTmFtZXMpIHsKICBzd2l0Y2ggKG5vZGUuYWNjZXNzKSB7CiAgICBjYXNlICJub25JbnRlcmFjdGl2ZSI6CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhTm9uSW50ZXJhY3RpdmUiKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJyZWFkT25seSI6CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUmVhZE9ubHkiKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJwcm90ZWN0ZWQiOgogICAgICBjbGFzc05hbWVzLnB1c2goInhmYURpc2FibGVkIik7CiAgICAgIGJyZWFrOwogIH0KfQpmdW5jdGlvbiBpc1ByaW50T25seShub2RlKSB7CiAgcmV0dXJuIG5vZGUucmVsZXZhbnQubGVuZ3RoID4gMCAmJiAhbm9kZS5yZWxldmFudFswXS5leGNsdWRlZCAmJiBub2RlLnJlbGV2YW50WzBdLnZpZXduYW1lID09PSAicHJpbnQiOwp9CmZ1bmN0aW9uIGdldEN1cnJlbnRQYXJhKG5vZGUpIHsKICBjb25zdCBzdGFjayA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLnBhcmFTdGFjazsKICByZXR1cm4gc3RhY2subGVuZ3RoID8gc3RhY2suYXQoLTEpIDogbnVsbDsKfQpmdW5jdGlvbiBzZXRQYXJhKG5vZGUsIG5vZGVTdHlsZSwgdmFsdWUpIHsKICBpZiAodmFsdWUuYXR0cmlidXRlcy5jbGFzcz8uaW5jbHVkZXMoInhmYVJpY2giKSkgewogICAgaWYgKG5vZGVTdHlsZSkgewogICAgICBpZiAobm9kZS5oID09PSAiIikgewogICAgICAgIG5vZGVTdHlsZS5oZWlnaHQgPSAiYXV0byI7CiAgICAgIH0KICAgICAgaWYgKG5vZGUudyA9PT0gIiIpIHsKICAgICAgICBub2RlU3R5bGUud2lkdGggPSAiYXV0byI7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHBhcmEgPSBnZXRDdXJyZW50UGFyYShub2RlKTsKICAgIGlmIChwYXJhKSB7CiAgICAgIGNvbnN0IHZhbHVlU3R5bGUgPSB2YWx1ZS5hdHRyaWJ1dGVzLnN0eWxlOwogICAgICB2YWx1ZVN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICAgIHZhbHVlU3R5bGUuZmxleERpcmVjdGlvbiA9ICJjb2x1bW4iOwogICAgICBzd2l0Y2ggKHBhcmEudkFsaWduKSB7CiAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICAgIHZhbHVlU3R5bGUuanVzdGlmeUNvbnRlbnQgPSAic3RhcnQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgIHZhbHVlU3R5bGUuanVzdGlmeUNvbnRlbnQgPSAiZW5kIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1pZGRsZSI6CiAgICAgICAgICB2YWx1ZVN0eWxlLmp1c3RpZnlDb250ZW50ID0gImNlbnRlciI7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb25zdCBwYXJhU3R5bGUgPSBwYXJhWyR0b1N0eWxlXSgpOwogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgT2JqZWN0LmVudHJpZXMocGFyYVN0eWxlKSkgewogICAgICAgIGlmICghKGtleSBpbiB2YWx1ZVN0eWxlKSkgewogICAgICAgICAgdmFsdWVTdHlsZVtrZXldID0gdmFsOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQpmdW5jdGlvbiBzZXRGb250RmFtaWx5KHhmYUZvbnQsIG5vZGUsIGZvbnRGaW5kZXIsIHN0eWxlKSB7CiAgaWYgKCFmb250RmluZGVyKSB7CiAgICBkZWxldGUgc3R5bGUuZm9udEZhbWlseTsKICAgIHJldHVybjsKICB9CiAgY29uc3QgbmFtZSA9IHN0cmlwUXVvdGVzKHhmYUZvbnQudHlwZWZhY2UpOwogIHN0eWxlLmZvbnRGYW1pbHkgPSBgIiR7bmFtZX0iYDsKICBjb25zdCB0eXBlZmFjZSA9IGZvbnRGaW5kZXIuZmluZChuYW1lKTsKICBpZiAodHlwZWZhY2UpIHsKICAgIGNvbnN0IHsKICAgICAgZm9udEZhbWlseQogICAgfSA9IHR5cGVmYWNlLnJlZ3VsYXIuY3NzRm9udEluZm87CiAgICBpZiAoZm9udEZhbWlseSAhPT0gbmFtZSkgewogICAgICBzdHlsZS5mb250RmFtaWx5ID0gYCIke2ZvbnRGYW1pbHl9ImA7CiAgICB9CiAgICBjb25zdCBwYXJhID0gZ2V0Q3VycmVudFBhcmEobm9kZSk7CiAgICBpZiAocGFyYSAmJiBwYXJhLmxpbmVIZWlnaHQgIT09ICIiKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChzdHlsZS5saW5lSGVpZ2h0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBkZkZvbnQgPSBzZWxlY3RGb250KHhmYUZvbnQsIHR5cGVmYWNlKTsKICAgIGlmIChwZGZGb250KSB7CiAgICAgIHN0eWxlLmxpbmVIZWlnaHQgPSBNYXRoLm1heCgxLjIsIHBkZkZvbnQubGluZUhlaWdodCk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGZpeFVSTChzdHIpIHsKICBjb25zdCBhYnNvbHV0ZVVybCA9IGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwoc3RyLCBudWxsLCB7CiAgICBhZGREZWZhdWx0UHJvdG9jb2w6IHRydWUsCiAgICB0cnlDb252ZXJ0RW5jb2Rpbmc6IHRydWUKICB9KTsKICByZXR1cm4gYWJzb2x1dGVVcmwgPyBhYnNvbHV0ZVVybC5ocmVmIDogbnVsbDsKfQoKOy8vIC4vc3JjL2NvcmUveGZhL2xheW91dC5qcwoKCgpmdW5jdGlvbiBjcmVhdGVMaW5lKG5vZGUsIGNoaWxkcmVuKSB7CiAgcmV0dXJuIHsKICAgIG5hbWU6ICJkaXYiLAogICAgYXR0cmlidXRlczogewogICAgICBjbGFzczogW25vZGUubGF5b3V0ID09PSAibHItdGIiID8gInhmYUxyIiA6ICJ4ZmFSbCJdCiAgICB9LAogICAgY2hpbGRyZW4KICB9Owp9CmZ1bmN0aW9uIGZsdXNoSFRNTChub2RlKSB7CiAgaWYgKCFub2RlWyRleHRyYV0pIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBhdHRyaWJ1dGVzID0gbm9kZVskZXh0cmFdLmF0dHJpYnV0ZXM7CiAgY29uc3QgaHRtbCA9IHsKICAgIG5hbWU6ICJkaXYiLAogICAgYXR0cmlidXRlcywKICAgIGNoaWxkcmVuOiBub2RlWyRleHRyYV0uY2hpbGRyZW4KICB9OwogIGlmIChub2RlWyRleHRyYV0uZmFpbGluZ05vZGUpIHsKICAgIGNvbnN0IGh0bWxGcm9tRmFpbGluZyA9IG5vZGVbJGV4dHJhXS5mYWlsaW5nTm9kZVskZmx1c2hIVE1MXSgpOwogICAgaWYgKGh0bWxGcm9tRmFpbGluZykgewogICAgICBpZiAobm9kZS5sYXlvdXQuZW5kc1dpdGgoIi10YiIpKSB7CiAgICAgICAgaHRtbC5jaGlsZHJlbi5wdXNoKGNyZWF0ZUxpbmUobm9kZSwgW2h0bWxGcm9tRmFpbGluZ10pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBodG1sLmNoaWxkcmVuLnB1c2goaHRtbEZyb21GYWlsaW5nKTsKICAgICAgfQogICAgfQogIH0KICBpZiAoaHRtbC5jaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBudWxsOwogIH0KICByZXR1cm4gaHRtbDsKfQpmdW5jdGlvbiBhZGRIVE1MKG5vZGUsIGh0bWwsIGJib3gpIHsKICBjb25zdCBleHRyYSA9IG5vZGVbJGV4dHJhXTsKICBjb25zdCBhdmFpbGFibGVTcGFjZSA9IGV4dHJhLmF2YWlsYWJsZVNwYWNlOwogIGNvbnN0IFt4LCB5LCB3LCBoXSA9IGJib3g7CiAgc3dpdGNoIChub2RlLmxheW91dCkgewogICAgY2FzZSAicG9zaXRpb24iOgogICAgICB7CiAgICAgICAgZXh0cmEud2lkdGggPSBNYXRoLm1heChleHRyYS53aWR0aCwgeCArIHcpOwogICAgICAgIGV4dHJhLmhlaWdodCA9IE1hdGgubWF4KGV4dHJhLmhlaWdodCwgeSArIGgpOwogICAgICAgIGV4dHJhLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIGNhc2UgImxyLXRiIjoKICAgIGNhc2UgInJsLXRiIjoKICAgICAgaWYgKCFleHRyYS5saW5lIHx8IGV4dHJhLmF0dGVtcHQgPT09IDEpIHsKICAgICAgICBleHRyYS5saW5lID0gY3JlYXRlTGluZShub2RlLCBbXSk7CiAgICAgICAgZXh0cmEuY2hpbGRyZW4ucHVzaChleHRyYS5saW5lKTsKICAgICAgICBleHRyYS5udW1iZXJJbkxpbmUgPSAwOwogICAgICB9CiAgICAgIGV4dHJhLm51bWJlckluTGluZSArPSAxOwogICAgICBleHRyYS5saW5lLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgICAgIGlmIChleHRyYS5hdHRlbXB0ID09PSAwKSB7CiAgICAgICAgZXh0cmEuY3VycmVudFdpZHRoICs9IHc7CiAgICAgICAgZXh0cmEuaGVpZ2h0ID0gTWF0aC5tYXgoZXh0cmEuaGVpZ2h0LCBleHRyYS5wcmV2SGVpZ2h0ICsgaCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXh0cmEuY3VycmVudFdpZHRoID0gdzsKICAgICAgICBleHRyYS5wcmV2SGVpZ2h0ID0gZXh0cmEuaGVpZ2h0OwogICAgICAgIGV4dHJhLmhlaWdodCArPSBoOwogICAgICAgIGV4dHJhLmF0dGVtcHQgPSAwOwogICAgICB9CiAgICAgIGV4dHJhLndpZHRoID0gTWF0aC5tYXgoZXh0cmEud2lkdGgsIGV4dHJhLmN1cnJlbnRXaWR0aCk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAicmwtcm93IjoKICAgIGNhc2UgInJvdyI6CiAgICAgIHsKICAgICAgICBleHRyYS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIGV4dHJhLndpZHRoICs9IHc7CiAgICAgICAgZXh0cmEuaGVpZ2h0ID0gTWF0aC5tYXgoZXh0cmEuaGVpZ2h0LCBoKTsKICAgICAgICBjb25zdCBoZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcoZXh0cmEuaGVpZ2h0KTsKICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGV4dHJhLmNoaWxkcmVuKSB7CiAgICAgICAgICBjaGlsZC5hdHRyaWJ1dGVzLnN0eWxlLmhlaWdodCA9IGhlaWdodDsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIGNhc2UgInRhYmxlIjoKICAgICAgewogICAgICAgIGV4dHJhLndpZHRoID0gTWF0aENsYW1wKHcsIGV4dHJhLndpZHRoLCBhdmFpbGFibGVTcGFjZS53aWR0aCk7CiAgICAgICAgZXh0cmEuaGVpZ2h0ICs9IGg7CiAgICAgICAgZXh0cmEuY2hpbGRyZW4ucHVzaChodG1sKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgY2FzZSAidGIiOgogICAgICB7CiAgICAgICAgZXh0cmEud2lkdGggPSBNYXRoQ2xhbXAodywgZXh0cmEud2lkdGgsIGF2YWlsYWJsZVNwYWNlLndpZHRoKTsKICAgICAgICBleHRyYS5oZWlnaHQgKz0gaDsKICAgICAgICBleHRyYS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgfQp9CmZ1bmN0aW9uIGdldEF2YWlsYWJsZVNwYWNlKG5vZGUpIHsKICBjb25zdCBhdmFpbGFibGVTcGFjZSA9IG5vZGVbJGV4dHJhXS5hdmFpbGFibGVTcGFjZTsKICBjb25zdCBtYXJnaW5WID0gbm9kZS5tYXJnaW4gPyBub2RlLm1hcmdpbi50b3BJbnNldCArIG5vZGUubWFyZ2luLmJvdHRvbUluc2V0IDogMDsKICBjb25zdCBtYXJnaW5IID0gbm9kZS5tYXJnaW4gPyBub2RlLm1hcmdpbi5sZWZ0SW5zZXQgKyBub2RlLm1hcmdpbi5yaWdodEluc2V0IDogMDsKICBzd2l0Y2ggKG5vZGUubGF5b3V0KSB7CiAgICBjYXNlICJsci10YiI6CiAgICBjYXNlICJybC10YiI6CiAgICAgIGlmIChub2RlWyRleHRyYV0uYXR0ZW1wdCA9PT0gMCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB3aWR0aDogYXZhaWxhYmxlU3BhY2Uud2lkdGggLSBtYXJnaW5IIC0gbm9kZVskZXh0cmFdLmN1cnJlbnRXaWR0aCwKICAgICAgICAgIGhlaWdodDogYXZhaWxhYmxlU3BhY2UuaGVpZ2h0IC0gbWFyZ2luViAtIG5vZGVbJGV4dHJhXS5wcmV2SGVpZ2h0CiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIHdpZHRoOiBhdmFpbGFibGVTcGFjZS53aWR0aCAtIG1hcmdpbkgsCiAgICAgICAgaGVpZ2h0OiBhdmFpbGFibGVTcGFjZS5oZWlnaHQgLSBtYXJnaW5WIC0gbm9kZVskZXh0cmFdLmhlaWdodAogICAgICB9OwogICAgY2FzZSAicmwtcm93IjoKICAgIGNhc2UgInJvdyI6CiAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5zdW1QcmVjaXNlKG5vZGVbJGV4dHJhXS5jb2x1bW5XaWR0aHMuc2xpY2Uobm9kZVskZXh0cmFdLmN1cnJlbnRDb2x1bW4pKTsKICAgICAgcmV0dXJuIHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQ6IGF2YWlsYWJsZVNwYWNlLmhlaWdodCAtIG1hcmdpbkgKICAgICAgfTsKICAgIGNhc2UgInRhYmxlIjoKICAgIGNhc2UgInRiIjoKICAgICAgcmV0dXJuIHsKICAgICAgICB3aWR0aDogYXZhaWxhYmxlU3BhY2Uud2lkdGggLSBtYXJnaW5ILAogICAgICAgIGhlaWdodDogYXZhaWxhYmxlU3BhY2UuaGVpZ2h0IC0gbWFyZ2luViAtIG5vZGVbJGV4dHJhXS5oZWlnaHQKICAgICAgfTsKICAgIGNhc2UgInBvc2l0aW9uIjoKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBhdmFpbGFibGVTcGFjZTsKICB9Cn0KZnVuY3Rpb24gZ2V0VHJhbnNmb3JtZWRCQm94KG5vZGUpIHsKICBsZXQgdyA9IG5vZGUudyA9PT0gIiIgPyBOYU4gOiBub2RlLnc7CiAgbGV0IGggPSBub2RlLmggPT09ICIiID8gTmFOIDogbm9kZS5oOwogIGxldCBbY2VudGVyWCwgY2VudGVyWV0gPSBbMCwgMF07CiAgc3dpdGNoIChub2RlLmFuY2hvclR5cGUgfHwgIiIpIHsKICAgIGNhc2UgImJvdHRvbUNlbnRlciI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFt3IC8gMiwgaF07CiAgICAgIGJyZWFrOwogICAgY2FzZSAiYm90dG9tTGVmdCI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFswLCBoXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJib3R0b21SaWdodCI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFt3LCBoXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJtaWRkbGVDZW50ZXIiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbdyAvIDIsIGggLyAyXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJtaWRkbGVMZWZ0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gWzAsIGggLyAyXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJtaWRkbGVSaWdodCI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFt3LCBoIC8gMl07CiAgICAgIGJyZWFrOwogICAgY2FzZSAidG9wQ2VudGVyIjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3cgLyAyLCAwXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJ0b3BSaWdodCI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFt3LCAwXTsKICAgICAgYnJlYWs7CiAgfQogIGxldCB4LCB5OwogIHN3aXRjaCAobm9kZS5yb3RhdGUgfHwgMCkgewogICAgY2FzZSAwOgogICAgICBbeCwgeV0gPSBbLWNlbnRlclgsIC1jZW50ZXJZXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDkwOgogICAgICBbeCwgeV0gPSBbLWNlbnRlclksIGNlbnRlclhdOwogICAgICBbdywgaF0gPSBbaCwgLXddOwogICAgICBicmVhazsKICAgIGNhc2UgMTgwOgogICAgICBbeCwgeV0gPSBbY2VudGVyWCwgY2VudGVyWV07CiAgICAgIFt3LCBoXSA9IFstdywgLWhdOwogICAgICBicmVhazsKICAgIGNhc2UgMjcwOgogICAgICBbeCwgeV0gPSBbY2VudGVyWSwgLWNlbnRlclhdOwogICAgICBbdywgaF0gPSBbLWgsIHddOwogICAgICBicmVhazsKICB9CiAgcmV0dXJuIFtub2RlLnggKyB4ICsgTWF0aC5taW4oMCwgdyksIG5vZGUueSArIHkgKyBNYXRoLm1pbigwLCBoKSwgTWF0aC5hYnModyksIE1hdGguYWJzKGgpXTsKfQpmdW5jdGlvbiBjaGVja0RpbWVuc2lvbnMobm9kZSwgc3BhY2UpIHsKICBpZiAobm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPT09IG51bGwpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAobm9kZS53ID09PSAwIHx8IG5vZGUuaCA9PT0gMCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGNvbnN0IEVSUk9SID0gMjsKICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogIGNvbnN0IGF0dGVtcHQgPSBwYXJlbnRbJGV4dHJhXT8uYXR0ZW1wdCB8fCAwOwogIGNvbnN0IFssIHksIHcsIGhdID0gZ2V0VHJhbnNmb3JtZWRCQm94KG5vZGUpOwogIHN3aXRjaCAocGFyZW50LmxheW91dCkgewogICAgY2FzZSAibHItdGIiOgogICAgY2FzZSAicmwtdGIiOgogICAgICBpZiAoYXR0ZW1wdCA9PT0gMCkgewogICAgICAgIGlmICghbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgICBpZiAobm9kZS5oICE9PSAiIiAmJiBNYXRoLnJvdW5kKGggLSBzcGFjZS5oZWlnaHQpID4gRVJST1IpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5vZGUudyAhPT0gIiIpIHsKICAgICAgICAgICAgaWYgKE1hdGgucm91bmQodyAtIHNwYWNlLndpZHRoKSA8PSBFUlJPUikgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwYXJlbnRbJGV4dHJhXS5udW1iZXJJbkxpbmUgPT09IDApIHsKICAgICAgICAgICAgICByZXR1cm4gc3BhY2UuaGVpZ2h0ID4gRVJST1I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHNwYWNlLndpZHRoID4gRVJST1I7CiAgICAgICAgfQogICAgICAgIGlmIChub2RlLncgIT09ICIiKSB7CiAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh3IC0gc3BhY2Uud2lkdGgpIDw9IEVSUk9SOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3BhY2Uud2lkdGggPiBFUlJPUjsKICAgICAgfQogICAgICBpZiAobm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG5vZGUuaCAhPT0gIiIgJiYgTWF0aC5yb3VuZChoIC0gc3BhY2UuaGVpZ2h0KSA+IEVSUk9SKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChub2RlLncgPT09ICIiIHx8IE1hdGgucm91bmQodyAtIHNwYWNlLndpZHRoKSA8PSBFUlJPUikgewogICAgICAgIHJldHVybiBzcGFjZS5oZWlnaHQgPiBFUlJPUjsKICAgICAgfQogICAgICBpZiAocGFyZW50WyRpc1RoZXJlTW9yZVdpZHRoXSgpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiBzcGFjZS5oZWlnaHQgPiBFUlJPUjsKICAgIGNhc2UgInRhYmxlIjoKICAgIGNhc2UgInRiIjoKICAgICAgaWYgKG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChub2RlLmggIT09ICIiICYmICFub2RlWyRpc1NwbGl0dGFibGVdKCkpIHsKICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChoIC0gc3BhY2UuaGVpZ2h0KSA8PSBFUlJPUjsKICAgICAgfQogICAgICBpZiAobm9kZS53ID09PSAiIiB8fCBNYXRoLnJvdW5kKHcgLSBzcGFjZS53aWR0aCkgPD0gRVJST1IpIHsKICAgICAgICByZXR1cm4gc3BhY2UuaGVpZ2h0ID4gRVJST1I7CiAgICAgIH0KICAgICAgaWYgKHBhcmVudFskaXNUaGVyZU1vcmVXaWR0aF0oKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gc3BhY2UuaGVpZ2h0ID4gRVJST1I7CiAgICBjYXNlICJwb3NpdGlvbiI6CiAgICAgIGlmIChub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAobm9kZS5oID09PSAiIiB8fCBNYXRoLnJvdW5kKGggKyB5IC0gc3BhY2UuaGVpZ2h0KSA8PSBFUlJPUikgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IGFyZWEgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5jdXJyZW50Q29udGVudEFyZWE7CiAgICAgIHJldHVybiBoICsgeSA+IGFyZWEuaDsKICAgIGNhc2UgInJsLXJvdyI6CiAgICBjYXNlICJyb3ciOgogICAgICBpZiAobm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG5vZGUuaCAhPT0gIiIpIHsKICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChoIC0gc3BhY2UuaGVpZ2h0KSA8PSBFUlJPUjsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3RlbXBsYXRlLmpzCgoKCgoKCgoKCgpjb25zdCBURU1QTEFURV9OU19JRCA9IE5hbWVzcGFjZUlkcy50ZW1wbGF0ZS5pZDsKY29uc3QgU1ZHX05TID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjsKY29uc3QgTUFYX0FUVEVNUFRTX0ZPUl9MUlRCX0xBWU9VVCA9IDI7CmNvbnN0IE1BWF9FTVBUWV9QQUdFUyA9IDM7CmNvbnN0IERFRkFVTFRfVEFCX0lOREVYID0gNTAwMDsKY29uc3QgSEVBRElOR19QQVRURVJOID0gL15IKFxkKykkLzsKY29uc3QgTUlNRVMgPSBuZXcgU2V0KFsiaW1hZ2UvZ2lmIiwgImltYWdlL2pwZWciLCAiaW1hZ2UvanBnIiwgImltYWdlL3BqcGVnIiwgImltYWdlL3BuZyIsICJpbWFnZS9hcG5nIiwgImltYWdlL3gtcG5nIiwgImltYWdlL2JtcCIsICJpbWFnZS94LW1zLWJtcCIsICJpbWFnZS90aWZmIiwgImltYWdlL3RpZiIsICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iXSk7CmNvbnN0IElNQUdFU19IRUFERVJTID0gW1tbMHg0MiwgMHg0ZF0sICJpbWFnZS9ibXAiXSwgW1sweGZmLCAweGQ4LCAweGZmXSwgImltYWdlL2pwZWciXSwgW1sweDQ5LCAweDQ5LCAweDJhLCAweDAwXSwgImltYWdlL3RpZmYiXSwgW1sweDRkLCAweDRkLCAweDAwLCAweDJhXSwgImltYWdlL3RpZmYiXSwgW1sweDQ3LCAweDQ5LCAweDQ2LCAweDM4LCAweDM5LCAweDYxXSwgImltYWdlL2dpZiJdLCBbWzB4ODksIDB4NTAsIDB4NGUsIDB4NDcsIDB4MGQsIDB4MGEsIDB4MWEsIDB4MGFdLCAiaW1hZ2UvcG5nIl1dOwpmdW5jdGlvbiBnZXRCb3JkZXJEaW1zKG5vZGUpIHsKICBpZiAoIW5vZGUgfHwgIW5vZGUuYm9yZGVyKSB7CiAgICByZXR1cm4gewogICAgICB3OiAwLAogICAgICBoOiAwCiAgICB9OwogIH0KICBjb25zdCBib3JkZXJFeHRyYSA9IG5vZGUuYm9yZGVyWyRnZXRFeHRyYV0oKTsKICBpZiAoIWJvcmRlckV4dHJhKSB7CiAgICByZXR1cm4gewogICAgICB3OiAwLAogICAgICBoOiAwCiAgICB9OwogIH0KICByZXR1cm4gewogICAgdzogYm9yZGVyRXh0cmEud2lkdGhzWzBdICsgYm9yZGVyRXh0cmEud2lkdGhzWzJdICsgYm9yZGVyRXh0cmEuaW5zZXRzWzBdICsgYm9yZGVyRXh0cmEuaW5zZXRzWzJdLAogICAgaDogYm9yZGVyRXh0cmEud2lkdGhzWzFdICsgYm9yZGVyRXh0cmEud2lkdGhzWzNdICsgYm9yZGVyRXh0cmEuaW5zZXRzWzFdICsgYm9yZGVyRXh0cmEuaW5zZXRzWzNdCiAgfTsKfQpmdW5jdGlvbiBoYXNNYXJnaW4obm9kZSkgewogIHJldHVybiBub2RlLm1hcmdpbiAmJiAobm9kZS5tYXJnaW4udG9wSW5zZXQgfHwgbm9kZS5tYXJnaW4ucmlnaHRJbnNldCB8fCBub2RlLm1hcmdpbi5ib3R0b21JbnNldCB8fCBub2RlLm1hcmdpbi5sZWZ0SW5zZXQpOwp9CmZ1bmN0aW9uIF9zZXRWYWx1ZSh0ZW1wbGF0ZU5vZGUsIHZhbHVlKSB7CiAgaWYgKCF0ZW1wbGF0ZU5vZGUudmFsdWUpIHsKICAgIGNvbnN0IG5vZGVWYWx1ZSA9IG5ldyBWYWx1ZSh7fSk7CiAgICB0ZW1wbGF0ZU5vZGVbJGFwcGVuZENoaWxkXShub2RlVmFsdWUpOwogICAgdGVtcGxhdGVOb2RlLnZhbHVlID0gbm9kZVZhbHVlOwogIH0KICB0ZW1wbGF0ZU5vZGUudmFsdWVbJHNldFZhbHVlXSh2YWx1ZSk7Cn0KZnVuY3Rpb24qIGdldENvbnRhaW5lZENoaWxkcmVuKG5vZGUpIHsKICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGVbJGdldENoaWxkcmVuXSgpKSB7CiAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBTdWJmb3JtU2V0KSB7CiAgICAgIHlpZWxkKiBjaGlsZFskZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgeWllbGQgY2hpbGQ7CiAgfQp9CmZ1bmN0aW9uIGlzUmVxdWlyZWQobm9kZSkgewogIHJldHVybiBub2RlLnZhbGlkYXRlPy5udWxsVGVzdCA9PT0gImVycm9yIjsKfQpmdW5jdGlvbiBzZXRUYWJJbmRleChub2RlKSB7CiAgd2hpbGUgKG5vZGUpIHsKICAgIGlmICghbm9kZS50cmF2ZXJzYWwpIHsKICAgICAgbm9kZVskdGFiSW5kZXhdID0gbm9kZVskZ2V0UGFyZW50XSgpWyR0YWJJbmRleF07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChub2RlWyR0YWJJbmRleF0pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IG5leHQgPSBudWxsOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiBub2RlLnRyYXZlcnNhbFskZ2V0Q2hpbGRyZW5dKCkpIHsKICAgICAgaWYgKGNoaWxkLm9wZXJhdGlvbiA9PT0gIm5leHQiKSB7CiAgICAgICAgbmV4dCA9IGNoaWxkOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAoIW5leHQgfHwgIW5leHQucmVmKSB7CiAgICAgIG5vZGVbJHRhYkluZGV4XSA9IG5vZGVbJGdldFBhcmVudF0oKVskdGFiSW5kZXhdOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByb290ID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpOwogICAgbm9kZVskdGFiSW5kZXhdID0gKytyb290WyR0YWJJbmRleF07CiAgICBjb25zdCByZWYgPSByb290WyRzZWFyY2hOb2RlXShuZXh0LnJlZiwgbm9kZSk7CiAgICBpZiAoIXJlZikgewogICAgICByZXR1cm47CiAgICB9CiAgICBub2RlID0gcmVmWzBdOwogIH0KfQpmdW5jdGlvbiBhcHBseUFzc2lzdChvYmosIGF0dHJpYnV0ZXMpIHsKICBjb25zdCBhc3Npc3QgPSBvYmouYXNzaXN0OwogIGlmIChhc3Npc3QpIHsKICAgIGNvbnN0IGFzc2lzdFRpdGxlID0gYXNzaXN0WyR0b0hUTUxdKCk7CiAgICBpZiAoYXNzaXN0VGl0bGUpIHsKICAgICAgYXR0cmlidXRlcy50aXRsZSA9IGFzc2lzdFRpdGxlOwogICAgfQogICAgY29uc3Qgcm9sZSA9IGFzc2lzdC5yb2xlOwogICAgY29uc3QgbWF0Y2ggPSByb2xlLm1hdGNoKEhFQURJTkdfUEFUVEVSTik7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgY29uc3QgYXJpYVJvbGUgPSAiaGVhZGluZyI7CiAgICAgIGNvbnN0IGFyaWFMZXZlbCA9IG1hdGNoWzFdOwogICAgICBhdHRyaWJ1dGVzLnJvbGUgPSBhcmlhUm9sZTsKICAgICAgYXR0cmlidXRlc1siYXJpYS1sZXZlbCJdID0gYXJpYUxldmVsOwogICAgfQogIH0KICBpZiAob2JqLmxheW91dCA9PT0gInRhYmxlIikgewogICAgYXR0cmlidXRlcy5yb2xlID0gInRhYmxlIjsKICB9IGVsc2UgaWYgKG9iai5sYXlvdXQgPT09ICJyb3ciKSB7CiAgICBhdHRyaWJ1dGVzLnJvbGUgPSAicm93IjsKICB9IGVsc2UgewogICAgY29uc3QgcGFyZW50ID0gb2JqWyRnZXRQYXJlbnRdKCk7CiAgICBpZiAocGFyZW50LmxheW91dCA9PT0gInJvdyIpIHsKICAgICAgYXR0cmlidXRlcy5yb2xlID0gcGFyZW50LmFzc2lzdD8ucm9sZSA9PT0gIlRIIiA/ICJjb2x1bW5oZWFkZXIiIDogImNlbGwiOwogICAgfQogIH0KfQpmdW5jdGlvbiBhcmlhTGFiZWwob2JqKSB7CiAgaWYgKCFvYmouYXNzaXN0KSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgYXNzaXN0ID0gb2JqLmFzc2lzdDsKICBpZiAoYXNzaXN0LnNwZWFrICYmIGFzc2lzdC5zcGVha1skY29udGVudF0gIT09ICIiKSB7CiAgICByZXR1cm4gYXNzaXN0LnNwZWFrWyRjb250ZW50XTsKICB9CiAgaWYgKGFzc2lzdC50b29sVGlwKSB7CiAgICByZXR1cm4gYXNzaXN0LnRvb2xUaXBbJGNvbnRlbnRdOwogIH0KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiB2YWx1ZVRvSHRtbCh2YWx1ZSkgewogIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgbmFtZTogImRpdiIsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGNsYXNzOiBbInhmYVJpY2giXSwKICAgICAgc3R5bGU6IE9iamVjdC5jcmVhdGUobnVsbCkKICAgIH0sCiAgICBjaGlsZHJlbjogW3sKICAgICAgbmFtZTogInNwYW4iLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgc3R5bGU6IE9iamVjdC5jcmVhdGUobnVsbCkKICAgICAgfSwKICAgICAgdmFsdWUKICAgIH1dCiAgfSk7Cn0KZnVuY3Rpb24gc2V0Rmlyc3RVbnNwbGl0dGFibGUobm9kZSkgewogIGNvbnN0IHJvb3QgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgaWYgKHJvb3RbJGV4dHJhXS5maXJzdFVuc3BsaXR0YWJsZSA9PT0gbnVsbCkgewogICAgcm9vdFskZXh0cmFdLmZpcnN0VW5zcGxpdHRhYmxlID0gbm9kZTsKICAgIHJvb3RbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSB0cnVlOwogIH0KfQpmdW5jdGlvbiB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKG5vZGUpIHsKICBjb25zdCByb290ID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpOwogIGlmIChyb290WyRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPT09IG5vZGUpIHsKICAgIHJvb3RbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSBmYWxzZTsKICB9Cn0KZnVuY3Rpb24gaGFuZGxlQnJlYWsobm9kZSkgewogIGlmIChub2RlWyRleHRyYV0pIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgbm9kZVskZXh0cmFdID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAiYXV0byIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3Qgcm9vdCA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKTsKICBsZXQgdGFyZ2V0ID0gbnVsbDsKICBpZiAobm9kZS50YXJnZXQpIHsKICAgIHRhcmdldCA9IHJvb3RbJHNlYXJjaE5vZGVdKG5vZGUudGFyZ2V0LCBub2RlWyRnZXRQYXJlbnRdKCkpOwogICAgaWYgKCF0YXJnZXQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGFyZ2V0ID0gdGFyZ2V0WzBdOwogIH0KICBjb25zdCB7CiAgICBjdXJyZW50UGFnZUFyZWEsCiAgICBjdXJyZW50Q29udGVudEFyZWEKICB9ID0gcm9vdFskZXh0cmFdOwogIGlmIChub2RlLnRhcmdldFR5cGUgPT09ICJwYWdlQXJlYSIpIHsKICAgIGlmICghKHRhcmdldCBpbnN0YW5jZW9mIFBhZ2VBcmVhKSkgewogICAgICB0YXJnZXQgPSBudWxsOwogICAgfQogICAgaWYgKG5vZGUuc3RhcnROZXcpIHsKICAgICAgbm9kZVskZXh0cmFdLnRhcmdldCA9IHRhcmdldCB8fCBjdXJyZW50UGFnZUFyZWE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIGlmICh0YXJnZXQgJiYgdGFyZ2V0ICE9PSBjdXJyZW50UGFnZUFyZWEpIHsKICAgICAgbm9kZVskZXh0cmFdLnRhcmdldCA9IHRhcmdldDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmICghKHRhcmdldCBpbnN0YW5jZW9mIENvbnRlbnRBcmVhKSkgewogICAgdGFyZ2V0ID0gbnVsbDsKICB9CiAgY29uc3QgcGFnZUFyZWEgPSB0YXJnZXQgJiYgdGFyZ2V0WyRnZXRQYXJlbnRdKCk7CiAgbGV0IGluZGV4OwogIGxldCBuZXh0UGFnZUFyZWEgPSBwYWdlQXJlYTsKICBpZiAobm9kZS5zdGFydE5ldykgewogICAgaWYgKHRhcmdldCkgewogICAgICBjb25zdCBjb250ZW50QXJlYXMgPSBwYWdlQXJlYS5jb250ZW50QXJlYS5jaGlsZHJlbjsKICAgICAgY29uc3QgaW5kZXhGb3JDdXJyZW50ID0gY29udGVudEFyZWFzLmluZGV4T2YoY3VycmVudENvbnRlbnRBcmVhKTsKICAgICAgY29uc3QgaW5kZXhGb3JUYXJnZXQgPSBjb250ZW50QXJlYXMuaW5kZXhPZih0YXJnZXQpOwogICAgICBpZiAoaW5kZXhGb3JDdXJyZW50ICE9PSAtMSAmJiBpbmRleEZvckN1cnJlbnQgPCBpbmRleEZvclRhcmdldCkgewogICAgICAgIG5leHRQYWdlQXJlYSA9IG51bGw7CiAgICAgIH0KICAgICAgaW5kZXggPSBpbmRleEZvclRhcmdldCAtIDE7CiAgICB9IGVsc2UgewogICAgICBpbmRleCA9IGN1cnJlbnRQYWdlQXJlYS5jb250ZW50QXJlYS5jaGlsZHJlbi5pbmRleE9mKGN1cnJlbnRDb250ZW50QXJlYSk7CiAgICB9CiAgfSBlbHNlIGlmICh0YXJnZXQgJiYgdGFyZ2V0ICE9PSBjdXJyZW50Q29udGVudEFyZWEpIHsKICAgIGNvbnN0IGNvbnRlbnRBcmVhcyA9IHBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuOwogICAgaW5kZXggPSBjb250ZW50QXJlYXMuaW5kZXhPZih0YXJnZXQpIC0gMTsKICAgIG5leHRQYWdlQXJlYSA9IHBhZ2VBcmVhID09PSBjdXJyZW50UGFnZUFyZWEgPyBudWxsIDogcGFnZUFyZWE7CiAgfSBlbHNlIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgbm9kZVskZXh0cmFdLnRhcmdldCA9IG5leHRQYWdlQXJlYTsKICBub2RlWyRleHRyYV0uaW5kZXggPSBpbmRleDsKICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBoYW5kbGVPdmVyZmxvdyhub2RlLCBleHRyYU5vZGUsIHNwYWNlKSB7CiAgY29uc3Qgcm9vdCA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKTsKICBjb25zdCBzYXZlZCA9IHJvb3RbJGV4dHJhXS5ub0xheW91dEZhaWx1cmU7CiAgY29uc3Qgc2F2ZWRNZXRob2QgPSBleHRyYU5vZGVbJGdldFN1YmZvcm1QYXJlbnRdOwogIGV4dHJhTm9kZVskZ2V0U3ViZm9ybVBhcmVudF0gPSAoKSA9PiBub2RlOwogIHJvb3RbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSB0cnVlOwogIGNvbnN0IHJlcyA9IGV4dHJhTm9kZVskdG9IVE1MXShzcGFjZSk7CiAgbm9kZVskYWRkSFRNTF0ocmVzLmh0bWwsIHJlcy5iYm94KTsKICByb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlID0gc2F2ZWQ7CiAgZXh0cmFOb2RlWyRnZXRTdWJmb3JtUGFyZW50XSA9IHNhdmVkTWV0aG9kOwp9CmNsYXNzIEFwcGVhcmFuY2VGaWx0ZXIgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYXBwZWFyYW5jZUZpbHRlciIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgQXJjIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImFyYyIsIHRydWUpOwogICAgdGhpcy5jaXJjdWxhciA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNpcmN1bGFyLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5oYW5kID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaGFuZCwgWyJldmVuIiwgImxlZnQiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuc3RhcnRBbmdsZSA9IGdldEZsb2F0KHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zdGFydEFuZ2xlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pOwogICAgdGhpcy5zd2VlcEFuZ2xlID0gZ2V0RmxvYXQoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnN3ZWVwQW5nbGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMzYwLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVkZ2UgPSBudWxsOwogICAgdGhpcy5maWxsID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgY29uc3QgZWRnZSA9IHRoaXMuZWRnZSB8fCBuZXcgRWRnZSh7fSk7CiAgICBjb25zdCBlZGdlU3R5bGUgPSBlZGdlWyR0b1N0eWxlXSgpOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKHRoaXMuZmlsbD8ucHJlc2VuY2UgPT09ICJ2aXNpYmxlIikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLmZpbGxbJHRvU3R5bGVdKCkpOwogICAgfSBlbHNlIHsKICAgICAgc3R5bGUuZmlsbCA9ICJ0cmFuc3BhcmVudCI7CiAgICB9CiAgICBzdHlsZS5zdHJva2VXaWR0aCA9IG1lYXN1cmVUb1N0cmluZyhlZGdlLnByZXNlbmNlID09PSAidmlzaWJsZSIgPyBlZGdlLnRoaWNrbmVzcyA6IDApOwogICAgc3R5bGUuc3Ryb2tlID0gZWRnZVN0eWxlLmNvbG9yOwogICAgbGV0IGFyYzsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgIHN0eWxlOiB7CiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICBvdmVyZmxvdzogInZpc2libGUiCiAgICAgIH0KICAgIH07CiAgICBpZiAodGhpcy5zd2VlcEFuZ2xlID09PSAzNjApIHsKICAgICAgYXJjID0gewogICAgICAgIG5hbWU6ICJlbGxpcHNlIiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgICAgY3g6ICI1MCUiLAogICAgICAgICAgY3k6ICI1MCUiLAogICAgICAgICAgcng6ICI1MCUiLAogICAgICAgICAgcnk6ICI1MCUiLAogICAgICAgICAgc3R5bGUKICAgICAgICB9CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBjb25zdCBzdGFydEFuZ2xlID0gdGhpcy5zdGFydEFuZ2xlICogTWF0aC5QSSAvIDE4MDsKICAgICAgY29uc3Qgc3dlZXBBbmdsZSA9IHRoaXMuc3dlZXBBbmdsZSAqIE1hdGguUEkgLyAxODA7CiAgICAgIGNvbnN0IGxhcmdlQXJjID0gdGhpcy5zd2VlcEFuZ2xlID4gMTgwID8gMSA6IDA7CiAgICAgIGNvbnN0IFt4MSwgeTEsIHgyLCB5Ml0gPSBbNTAgKiAoMSArIE1hdGguY29zKHN0YXJ0QW5nbGUpKSwgNTAgKiAoMSAtIE1hdGguc2luKHN0YXJ0QW5nbGUpKSwgNTAgKiAoMSArIE1hdGguY29zKHN0YXJ0QW5nbGUgKyBzd2VlcEFuZ2xlKSksIDUwICogKDEgLSBNYXRoLnNpbihzdGFydEFuZ2xlICsgc3dlZXBBbmdsZSkpXTsKICAgICAgYXJjID0gewogICAgICAgIG5hbWU6ICJwYXRoIiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgICAgZDogYE0gJHt4MX0gJHt5MX0gQSA1MCA1MCAwICR7bGFyZ2VBcmN9IDAgJHt4Mn0gJHt5Mn1gLAogICAgICAgICAgdmVjdG9yRWZmZWN0OiAibm9uLXNjYWxpbmctc3Ryb2tlIiwKICAgICAgICAgIHN0eWxlCiAgICAgICAgfQogICAgICB9OwogICAgICBPYmplY3QuYXNzaWduKGF0dHJpYnV0ZXMsIHsKICAgICAgICB2aWV3Qm94OiAiMCAwIDEwMCAxMDAiLAogICAgICAgIHByZXNlcnZlQXNwZWN0UmF0aW86ICJub25lIgogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHN2ZyA9IHsKICAgICAgbmFtZTogInN2ZyIsCiAgICAgIGNoaWxkcmVuOiBbYXJjXSwKICAgICAgYXR0cmlidXRlcwogICAgfTsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKVskZ2V0UGFyZW50XSgpOwogICAgaWYgKGhhc01hcmdpbihwYXJlbnQpKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICAgIG5hbWU6ICJkaXYiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUiLAogICAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2hpbGRyZW46IFtzdmddCiAgICAgIH0pOwogICAgfQogICAgc3ZnLmF0dHJpYnV0ZXMuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhzdmcpOwogIH0KfQpjbGFzcyBBcmVhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImFyZWEiLCB0cnVlKTsKICAgIHRoaXMuY29sU3BhbiA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNvbFNwYW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxIHx8IG4gPT09IC0xCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMueCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5hcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRyYXcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhPYmplY3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhjbEdyb3VwID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZpZWxkID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybVNldCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICAqWyRnZXRDb250YWluZWRDaGlsZHJlbl0oKSB7CiAgICB5aWVsZCogZ2V0Q29udGFpbmVkQ2hpbGRyZW4odGhpcyk7CiAgfQogIFskaXNUcmFuc3BhcmVudF0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRpc0JpbmRhYmxlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGFkZEhUTUxdKGh0bWwsIGJib3gpIHsKICAgIGNvbnN0IFt4LCB5LCB3LCBoXSA9IGJib3g7CiAgICB0aGlzWyRleHRyYV0ud2lkdGggPSBNYXRoLm1heCh0aGlzWyRleHRyYV0ud2lkdGgsIHggKyB3KTsKICAgIHRoaXNbJGV4dHJhXS5oZWlnaHQgPSBNYXRoLm1heCh0aGlzWyRleHRyYV0uaGVpZ2h0LCB5ICsgaCk7CiAgICB0aGlzWyRleHRyYV0uY2hpbGRyZW4ucHVzaChodG1sKTsKICB9CiAgWyRnZXRBdmFpbGFibGVTcGFjZV0oKSB7CiAgICByZXR1cm4gdGhpc1skZXh0cmFdLmF2YWlsYWJsZVNwYWNlOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAicG9zaXRpb24iKTsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIHN0eWxlLAogICAgICBpZDogdGhpc1skdWlkXSwKICAgICAgY2xhc3M6IFsieGZhQXJlYSJdCiAgICB9OwogICAgaWYgKGlzUHJpbnRPbmx5KHRoaXMpKSB7CiAgICAgIGF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICBpZiAodGhpcy5uYW1lKSB7CiAgICAgIGF0dHJpYnV0ZXMueGZhTmFtZSA9IHRoaXMubmFtZTsKICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICB0aGlzWyRleHRyYV0gPSB7CiAgICAgIGNoaWxkcmVuLAogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwLAogICAgICBhdmFpbGFibGVTcGFjZQogICAgfTsKICAgIGNvbnN0IHJlc3VsdCA9IHRoaXNbJGNoaWxkcmVuVG9IVE1MXSh7CiAgICAgIGZpbHRlcjogbmV3IFNldChbImFyZWEiLCAiZHJhdyIsICJmaWVsZCIsICJleGNsR3JvdXAiLCAic3ViZm9ybSIsICJzdWJmb3JtU2V0Il0pLAogICAgICBpbmNsdWRlOiB0cnVlCiAgICB9KTsKICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgaWYgKHJlc3VsdC5pc0JyZWFrKCkpIHsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIGRlbGV0ZSB0aGlzWyRleHRyYV07CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICBzdHlsZS53aWR0aCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzWyRleHRyYV0ud2lkdGgpOwogICAgc3R5bGUuaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXNbJGV4dHJhXS5oZWlnaHQpOwogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgY29uc3QgYmJveCA9IFt0aGlzLngsIHRoaXMueSwgdGhpc1skZXh0cmFdLndpZHRoLCB0aGlzWyRleHRyYV0uaGVpZ2h0XTsKICAgIGRlbGV0ZSB0aGlzWyRleHRyYV07CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGh0bWwsIGJib3gpOwogIH0KfQpjbGFzcyBBc3Npc3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYXNzaXN0IiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucm9sZSA9IGF0dHJpYnV0ZXMucm9sZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnNwZWFrID0gbnVsbDsKICAgIHRoaXMudG9vbFRpcCA9IG51bGw7CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIHJldHVybiB0aGlzLnRvb2xUaXA/LlskY29udGVudF0gfHwgbnVsbDsKICB9Cn0KY2xhc3MgQmFyY29kZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJiYXJjb2RlIiwgdHJ1ZSk7CiAgICB0aGlzLmNoYXJFbmNvZGluZyA9IGdldEtleXdvcmQoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNoYXJFbmNvZGluZyA/IGF0dHJpYnV0ZXMuY2hhckVuY29kaW5nLnRvTG93ZXJDYXNlKCkgOiAiIiwKICAgICAgZGVmYXVsdFZhbHVlOiAiIiwKICAgICAgdmFsaWRhdGU6IGsgPT4gWyJ1dGYtOCIsICJiaWctZml2ZSIsICJmb250c3BlY2lmaWMiLCAiZ2JrIiwgImdiLTE4MDMwIiwgImdiLTIzMTIiLCAia3NjLTU2MDEiLCAibm9uZSIsICJzaGlmdC1qaXMiLCAidWNzLTIiLCAidXRmLTE2Il0uaW5jbHVkZXMoaykgfHwgay5tYXRjaCgvaXNvLTg4NTktXGR7Mn0vKQogICAgfSk7CiAgICB0aGlzLmNoZWNrc3VtID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuY2hlY2tzdW0sIFsibm9uZSIsICIxbW9kMTAiLCAiMW1vZDEwXzFtb2QxMSIsICIybW9kMTAiLCAiYXV0byJdKTsKICAgIHRoaXMuZGF0YUNvbHVtbkNvdW50ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZGF0YUNvbHVtbkNvdW50LAogICAgICBkZWZhdWx0VmFsdWU6IC0xLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5kYXRhTGVuZ3RoID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZGF0YUxlbmd0aCwKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMuZGF0YVByZXAgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5kYXRhUHJlcCwgWyJub25lIiwgImZsYXRlQ29tcHJlc3MiXSk7CiAgICB0aGlzLmRhdGFSb3dDb3VudCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmRhdGFSb3dDb3VudCwKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMuZW5kQ2hhciA9IGF0dHJpYnV0ZXMuZW5kQ2hhciB8fCAiIjsKICAgIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5lcnJvckNvcnJlY3Rpb25MZXZlbCwKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwICYmIHggPD0gOAogICAgfSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubW9kdWxlSGVpZ2h0ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tb2R1bGVIZWlnaHQsICI1bW0iKTsKICAgIHRoaXMubW9kdWxlV2lkdGggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1vZHVsZVdpZHRoLCAiMC4yNW1tIik7CiAgICB0aGlzLnByaW50Q2hlY2tEaWdpdCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnByaW50Q2hlY2tEaWdpdCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMucm93Q29sdW1uUmF0aW8gPSBnZXRSYXRpbyhhdHRyaWJ1dGVzLnJvd0NvbHVtblJhdGlvKTsKICAgIHRoaXMuc3RhcnRDaGFyID0gYXR0cmlidXRlcy5zdGFydENoYXIgfHwgIiI7CiAgICB0aGlzLnRleHRMb2NhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnRleHRMb2NhdGlvbiwgWyJiZWxvdyIsICJhYm92ZSIsICJhYm92ZUVtYmVkZGVkIiwgImJlbG93RW1iZWRkZWQiLCAibm9uZSJdKTsKICAgIHRoaXMudHJ1bmNhdGUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy50cnVuY2F0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUgPyBhdHRyaWJ1dGVzLnR5cGUudG9Mb3dlckNhc2UoKSA6ICIiLCBbImF6dGVjIiwgImNvZGFiYXIiLCAiY29kZTJvZjVpbmR1c3RyaWFsIiwgImNvZGUyb2Y1aW50ZXJsZWF2ZWQiLCAiY29kZTJvZjVtYXRyaXgiLCAiY29kZTJvZjVzdGFuZGFyZCIsICJjb2RlM29mOSIsICJjb2RlM29mOWV4dGVuZGVkIiwgImNvZGUxMSIsICJjb2RlNDkiLCAiY29kZTkzIiwgImNvZGUxMjgiLCAiY29kZTEyOGEiLCAiY29kZTEyOGIiLCAiY29kZTEyOGMiLCAiY29kZTEyOHNzY2MiLCAiZGF0YW1hdHJpeCIsICJlYW44IiwgImVhbjhhZGQyIiwgImVhbjhhZGQ1IiwgImVhbjEzIiwgImVhbjEzYWRkMiIsICJlYW4xM2FkZDUiLCAiZWFuMTNwd2NkIiwgImZpbSIsICJsb2dtYXJzIiwgIm1heGljb2RlIiwgIm1zaSIsICJwZGY0MTciLCAicGRmNDE3bWFjcm8iLCAicGxlc3NleSIsICJwb3N0YXVzY3VzdDIiLCAicG9zdGF1c2N1c3QzIiwgInBvc3RhdXNyZXBseXBhaWQiLCAicG9zdGF1c3N0YW5kYXJkIiwgInBvc3R1a3JtNHNjYyIsICJwb3N0dXNkcGJjIiwgInBvc3R1c2ltYiIsICJwb3N0dXNzdGFuZGFyZCIsICJwb3N0dXM1emlwIiwgInFyY29kZSIsICJyZmlkIiwgInJzczE0IiwgInJzczE0ZXhwYW5kZWQiLCAicnNzMTRsaW1pdGVkIiwgInJzczE0c3RhY2tlZCIsICJyc3MxNHN0YWNrZWRvbW5pIiwgInJzczE0dHJ1bmNhdGVkIiwgInRlbGVwZW4iLCAidWNjMTI4IiwgInVjYzEyOHJhbmRvbSIsICJ1Y2MxMjhzc2NjIiwgInVwY2EiLCAidXBjYWFkZDIiLCAidXBjYWFkZDUiLCAidXBjYXB3Y2QiLCAidXBjZSIsICJ1cGNlYWRkMiIsICJ1cGNlYWRkNSIsICJ1cGNlYW4yIiwgInVwY2VhbjUiLCAidXBzbWF4aWNvZGUiXSk7CiAgICB0aGlzLnVwc01vZGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy51cHNNb2RlLCBbInVzQ2FycmllciIsICJpbnRlcm5hdGlvbmFsQ2FycmllciIsICJzZWN1cmVTeW1ib2wiLCAic3RhbmRhcmRTeW1ib2wiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53aWRlTmFycm93UmF0aW8gPSBnZXRSYXRpbyhhdHRyaWJ1dGVzLndpZGVOYXJyb3dSYXRpbyk7CiAgICB0aGlzLmVuY3J5cHQgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KfQpjbGFzcyBCaW5kIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJpbmQiLCB0cnVlKTsKICAgIHRoaXMubWF0Y2ggPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5tYXRjaCwgWyJvbmNlIiwgImRhdGFSZWYiLCAiZ2xvYmFsIiwgIm5vbmUiXSk7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICB9Cn0KY2xhc3MgQmluZEl0ZW1zIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJpbmRJdGVtcyIpOwogICAgdGhpcy5jb25uZWN0aW9uID0gYXR0cmlidXRlcy5jb25uZWN0aW9uIHx8ICIiOwogICAgdGhpcy5sYWJlbFJlZiA9IGF0dHJpYnV0ZXMubGFiZWxSZWYgfHwgIiI7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy52YWx1ZVJlZiA9IGF0dHJpYnV0ZXMudmFsdWVSZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEJvb2tlbmQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYm9va2VuZCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxlYWRlciA9IGF0dHJpYnV0ZXMubGVhZGVyIHx8ICIiOwogICAgdGhpcy50cmFpbGVyID0gYXR0cmlidXRlcy50cmFpbGVyIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgQm9vbGVhbkVsZW1lbnQgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJib29sZWFuIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdID09PSAxID8gIjEiIDogIjAiKTsKICB9Cn0KY2xhc3MgQm9yZGVyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJvcmRlciIsIHRydWUpOwogICAgdGhpcy5icmVhayA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmJyZWFrLCBbImNsb3NlIiwgIm9wZW4iXSk7CiAgICB0aGlzLmhhbmQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oYW5kLCBbImV2ZW4iLCAibGVmdCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvcm5lciA9IG5ldyBYRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZWRnZSA9IG5ldyBYRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZmlsbCA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFskZ2V0RXh0cmFdKCkgewogICAgaWYgKCF0aGlzWyRleHRyYV0pIHsKICAgICAgY29uc3QgZWRnZXMgPSB0aGlzLmVkZ2UuY2hpbGRyZW4uc2xpY2UoKTsKICAgICAgaWYgKGVkZ2VzLmxlbmd0aCA8IDQpIHsKICAgICAgICBjb25zdCBkZWZhdWx0RWRnZSA9IGVkZ2VzLmF0KC0xKSB8fCBuZXcgRWRnZSh7fSk7CiAgICAgICAgZm9yIChsZXQgaSA9IGVkZ2VzLmxlbmd0aDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgZWRnZXMucHVzaChkZWZhdWx0RWRnZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHdpZHRocyA9IGVkZ2VzLm1hcChlZGdlID0+IGVkZ2UudGhpY2tuZXNzKTsKICAgICAgY29uc3QgaW5zZXRzID0gWzAsIDAsIDAsIDBdOwogICAgICBpZiAodGhpcy5tYXJnaW4pIHsKICAgICAgICBpbnNldHNbMF0gPSB0aGlzLm1hcmdpbi50b3BJbnNldDsKICAgICAgICBpbnNldHNbMV0gPSB0aGlzLm1hcmdpbi5yaWdodEluc2V0OwogICAgICAgIGluc2V0c1syXSA9IHRoaXMubWFyZ2luLmJvdHRvbUluc2V0OwogICAgICAgIGluc2V0c1szXSA9IHRoaXMubWFyZ2luLmxlZnRJbnNldDsKICAgICAgfQogICAgICB0aGlzWyRleHRyYV0gPSB7CiAgICAgICAgd2lkdGhzLAogICAgICAgIGluc2V0cywKICAgICAgICBlZGdlcwogICAgICB9OwogICAgfQogICAgcmV0dXJuIHRoaXNbJGV4dHJhXTsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHsKICAgICAgZWRnZXMKICAgIH0gPSB0aGlzWyRnZXRFeHRyYV0oKTsKICAgIGNvbnN0IGVkZ2VTdHlsZXMgPSBlZGdlcy5tYXAobm9kZSA9PiB7CiAgICAgIGNvbnN0IHN0eWxlID0gbm9kZVskdG9TdHlsZV0oKTsKICAgICAgc3R5bGUuY29sb3IgfHw9ICIjMDAwMDAwIjsKICAgICAgcmV0dXJuIHN0eWxlOwogICAgfSk7CiAgICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAodGhpcy5tYXJnaW4pIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgdGhpcy5tYXJnaW5bJHRvU3R5bGVdKCkpOwogICAgfQogICAgaWYgKHRoaXMuZmlsbD8ucHJlc2VuY2UgPT09ICJ2aXNpYmxlIikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLmZpbGxbJHRvU3R5bGVdKCkpOwogICAgfQogICAgaWYgKHRoaXMuY29ybmVyLmNoaWxkcmVuLnNvbWUobm9kZSA9PiBub2RlLnJhZGl1cyAhPT0gMCkpIHsKICAgICAgY29uc3QgY29ybmVyU3R5bGVzID0gdGhpcy5jb3JuZXIuY2hpbGRyZW4ubWFwKG5vZGUgPT4gbm9kZVskdG9TdHlsZV0oKSk7CiAgICAgIGlmIChjb3JuZXJTdHlsZXMubGVuZ3RoID09PSAyIHx8IGNvcm5lclN0eWxlcy5sZW5ndGggPT09IDMpIHsKICAgICAgICBjb25zdCBsYXN0ID0gY29ybmVyU3R5bGVzLmF0KC0xKTsKICAgICAgICBmb3IgKGxldCBpID0gY29ybmVyU3R5bGVzLmxlbmd0aDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgY29ybmVyU3R5bGVzLnB1c2gobGFzdCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0eWxlLmJvcmRlclJhZGl1cyA9IGNvcm5lclN0eWxlcy5tYXAocyA9PiBzLnJhZGl1cykuam9pbigiICIpOwogICAgfQogICAgc3dpdGNoICh0aGlzLnByZXNlbmNlKSB7CiAgICAgIGNhc2UgImludmlzaWJsZSI6CiAgICAgIGNhc2UgImhpZGRlbiI6CiAgICAgICAgc3R5bGUuYm9yZGVyU3R5bGUgPSAiIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiaW5hY3RpdmUiOgogICAgICAgIHN0eWxlLmJvcmRlclN0eWxlID0gIm5vbmUiOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHN0eWxlLmJvcmRlclN0eWxlID0gZWRnZVN0eWxlcy5tYXAocyA9PiBzLnN0eWxlKS5qb2luKCIgIik7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBzdHlsZS5ib3JkZXJXaWR0aCA9IGVkZ2VTdHlsZXMubWFwKHMgPT4gcy53aWR0aCkuam9pbigiICIpOwogICAgc3R5bGUuYm9yZGVyQ29sb3IgPSBlZGdlU3R5bGVzLm1hcChzID0+IHMuY29sb3IpLmpvaW4oIiAiKTsKICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgQnJlYWsgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYnJlYWsiLCB0cnVlKTsKICAgIHRoaXMuYWZ0ZXIgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hZnRlciwgWyJhdXRvIiwgImNvbnRlbnRBcmVhIiwgInBhZ2VBcmVhIiwgInBhZ2VFdmVuIiwgInBhZ2VPZGQiXSk7CiAgICB0aGlzLmFmdGVyVGFyZ2V0ID0gYXR0cmlidXRlcy5hZnRlclRhcmdldCB8fCAiIjsKICAgIHRoaXMuYmVmb3JlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYmVmb3JlLCBbImF1dG8iLCAiY29udGVudEFyZWEiLCAicGFnZUFyZWEiLCAicGFnZUV2ZW4iLCAicGFnZU9kZCJdKTsKICAgIHRoaXMuYmVmb3JlVGFyZ2V0ID0gYXR0cmlidXRlcy5iZWZvcmVUYXJnZXQgfHwgIiI7CiAgICB0aGlzLmJvb2tlbmRMZWFkZXIgPSBhdHRyaWJ1dGVzLmJvb2tlbmRMZWFkZXIgfHwgIiI7CiAgICB0aGlzLmJvb2tlbmRUcmFpbGVyID0gYXR0cmlidXRlcy5ib29rZW5kVHJhaWxlciB8fCAiIjsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5vdmVyZmxvd0xlYWRlciA9IGF0dHJpYnV0ZXMub3ZlcmZsb3dMZWFkZXIgfHwgIiI7CiAgICB0aGlzLm92ZXJmbG93VGFyZ2V0ID0gYXR0cmlidXRlcy5vdmVyZmxvd1RhcmdldCB8fCAiIjsKICAgIHRoaXMub3ZlcmZsb3dUcmFpbGVyID0gYXR0cmlidXRlcy5vdmVyZmxvd1RyYWlsZXIgfHwgIiI7CiAgICB0aGlzLnN0YXJ0TmV3ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuc3RhcnROZXcsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KfQpjbGFzcyBCcmVha0FmdGVyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJyZWFrQWZ0ZXIiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWFkZXIgPSBhdHRyaWJ1dGVzLmxlYWRlciB8fCAiIjsKICAgIHRoaXMuc3RhcnROZXcgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zdGFydE5ldywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnRhcmdldFR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50YXJnZXRUeXBlLCBbImF1dG8iLCAiY29udGVudEFyZWEiLCAicGFnZUFyZWEiXSk7CiAgICB0aGlzLnRyYWlsZXIgPSBhdHRyaWJ1dGVzLnRyYWlsZXIgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogIH0KfQpjbGFzcyBCcmVha0JlZm9yZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJicmVha0JlZm9yZSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxlYWRlciA9IGF0dHJpYnV0ZXMubGVhZGVyIHx8ICIiOwogICAgdGhpcy5zdGFydE5ldyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnN0YXJ0TmV3LAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudGFyZ2V0VHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnRhcmdldFR5cGUsIFsiYXV0byIsICJjb250ZW50QXJlYSIsICJwYWdlQXJlYSJdKTsKICAgIHRoaXMudHJhaWxlciA9IGF0dHJpYnV0ZXMudHJhaWxlciB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgdGhpc1skZXh0cmFdID0ge307CiAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogIH0KfQpjbGFzcyBCdXR0b24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYnV0dG9uIiwgdHJ1ZSk7CiAgICB0aGlzLmhpZ2hsaWdodCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhpZ2hsaWdodCwgWyJpbnZlcnRlZCIsICJub25lIiwgIm91dGxpbmUiLCAicHVzaCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBncmFuZHBhID0gcGFyZW50WyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBodG1sQnV0dG9uID0gewogICAgICBuYW1lOiAiYnV0dG9uIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICAgIGNsYXNzOiBbInhmYUJ1dHRvbiJdLAogICAgICAgIHN0eWxlOiB7fQogICAgICB9LAogICAgICBjaGlsZHJlbjogW10KICAgIH07CiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGdyYW5kcGEuZXZlbnQuY2hpbGRyZW4pIHsKICAgICAgaWYgKGV2ZW50LmFjdGl2aXR5ICE9PSAiY2xpY2siIHx8ICFldmVudC5zY3JpcHQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBqc1VSTCA9IHJlY292ZXJKc1VSTChldmVudC5zY3JpcHRbJGNvbnRlbnRdKTsKICAgICAgaWYgKCFqc1VSTCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGhyZWYgPSBmaXhVUkwoanNVUkwudXJsKTsKICAgICAgaWYgKCFocmVmKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaHRtbEJ1dHRvbi5jaGlsZHJlbi5wdXNoKHsKICAgICAgICBuYW1lOiAiYSIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgaWQ6ICJsaW5rIiArIHRoaXNbJHVpZF0sCiAgICAgICAgICBocmVmLAogICAgICAgICAgbmV3V2luZG93OiBqc1VSTC5uZXdXaW5kb3csCiAgICAgICAgICBjbGFzczogWyJ4ZmFMaW5rIl0sCiAgICAgICAgICBzdHlsZToge30KICAgICAgICB9LAogICAgICAgIGNoaWxkcmVuOiBbXQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoaHRtbEJ1dHRvbik7CiAgfQp9CmNsYXNzIENhbGN1bGF0ZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjYWxjdWxhdGUiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5vdmVycmlkZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm92ZXJyaWRlLCBbImRpc2FibGVkIiwgImVycm9yIiwgImlnbm9yZSIsICJ3YXJuaW5nIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWVzc2FnZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQp9CmNsYXNzIENhcHRpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2FwdGlvbiIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnBsYWNlbWVudCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnBsYWNlbWVudCwgWyJsZWZ0IiwgImJvdHRvbSIsICJpbmxpbmUiLCAicmlnaHQiLCAidG9wIl0pOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVzZXJ2ZSA9IE1hdGguY2VpbChnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnJlc2VydmUpKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZvbnQgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudmFsdWUgPSBudWxsOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgX3NldFZhbHVlKHRoaXMsIHZhbHVlKTsKICB9CiAgWyRnZXRFeHRyYV0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGlmICghdGhpc1skZXh0cmFdKSB7CiAgICAgIGxldCB7CiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0gPSBhdmFpbGFibGVTcGFjZTsKICAgICAgc3dpdGNoICh0aGlzLnBsYWNlbWVudCkgewogICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICBjYXNlICJpbmxpbmUiOgogICAgICAgICAgd2lkdGggPSB0aGlzLnJlc2VydmUgPD0gMCA/IHdpZHRoIDogdGhpcy5yZXNlcnZlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICBjYXNlICJib3R0b20iOgogICAgICAgICAgaGVpZ2h0ID0gdGhpcy5yZXNlcnZlIDw9IDAgPyBoZWlnaHQgOiB0aGlzLnJlc2VydmU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzWyRleHRyYV0gPSBsYXlvdXROb2RlKHRoaXMsIHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gdGhpc1skZXh0cmFdOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGlmICghdGhpcy52YWx1ZSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIHRoaXNbJHB1c2hQYXJhXSgpOwogICAgY29uc3QgdmFsdWUgPSB0aGlzLnZhbHVlWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKS5odG1sOwogICAgaWYgKCF2YWx1ZSkgewogICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGNvbnN0IHNhdmVkUmVzZXJ2ZSA9IHRoaXMucmVzZXJ2ZTsKICAgIGlmICh0aGlzLnJlc2VydmUgPD0gMCkgewogICAgICBjb25zdCB7CiAgICAgICAgdywKICAgICAgICBoCiAgICAgIH0gPSB0aGlzWyRnZXRFeHRyYV0oYXZhaWxhYmxlU3BhY2UpOwogICAgICBzd2l0Y2ggKHRoaXMucGxhY2VtZW50KSB7CiAgICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIGNhc2UgImlubGluZSI6CiAgICAgICAgICB0aGlzLnJlc2VydmUgPSB3OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICBjYXNlICJib3R0b20iOgogICAgICAgICAgdGhpcy5yZXNlcnZlID0gaDsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgbmFtZTogIiN0ZXh0IiwKICAgICAgICB2YWx1ZQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkcmVuLnB1c2godmFsdWUpOwogICAgfQogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJmb250IiwgIm1hcmdpbiIsICJ2aXNpYmlsaXR5Iik7CiAgICBzd2l0Y2ggKHRoaXMucGxhY2VtZW50KSB7CiAgICAgIGNhc2UgImxlZnQiOgogICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgaWYgKHRoaXMucmVzZXJ2ZSA+IDApIHsKICAgICAgICAgIHN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMucmVzZXJ2ZSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ0b3AiOgogICAgICBjYXNlICJib3R0b20iOgogICAgICAgIGlmICh0aGlzLnJlc2VydmUgPiAwKSB7CiAgICAgICAgICBzdHlsZS5oZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5yZXNlcnZlKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBzZXRQYXJhKHRoaXMsIG51bGwsIHZhbHVlKTsKICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICB0aGlzLnJlc2VydmUgPSBzYXZlZFJlc2VydmU7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBzdHlsZSwKICAgICAgICBjbGFzczogWyJ4ZmFDYXB0aW9uIl0KICAgICAgfSwKICAgICAgY2hpbGRyZW4KICAgIH0pOwogIH0KfQpjbGFzcyBDZXJ0aWZpY2F0ZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjZXJ0aWZpY2F0ZSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBDZXJ0aWZpY2F0ZXMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2VydGlmaWNhdGVzIiwgdHJ1ZSk7CiAgICB0aGlzLmNyZWRlbnRpYWxTZXJ2ZXJQb2xpY3kgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5jcmVkZW50aWFsU2VydmVyUG9saWN5LCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVybCA9IGF0dHJpYnV0ZXMudXJsIHx8ICIiOwogICAgdGhpcy51cmxQb2xpY3kgPSBhdHRyaWJ1dGVzLnVybFBvbGljeSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVuY3J5cHRpb24gPSBudWxsOwogICAgdGhpcy5pc3N1ZXJzID0gbnVsbDsKICAgIHRoaXMua2V5VXNhZ2UgPSBudWxsOwogICAgdGhpcy5vaWRzID0gbnVsbDsKICAgIHRoaXMuc2lnbmluZyA9IG51bGw7CiAgICB0aGlzLnN1YmplY3RETnMgPSBudWxsOwogIH0KfQpjbGFzcyBDaGVja0J1dHRvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjaGVja0J1dHRvbiIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm1hcmsgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5tYXJrLCBbImRlZmF1bHQiLCAiY2hlY2siLCAiY2lyY2xlIiwgImNyb3NzIiwgImRpYW1vbmQiLCAic3F1YXJlIiwgInN0YXIiXSk7CiAgICB0aGlzLnNoYXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc2hhcGUsIFsic3F1YXJlIiwgInJvdW5kIl0pOwogICAgdGhpcy5zaXplID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5zaXplLCAiMTBwdCIpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgIm1hcmdpbiIpOwogICAgY29uc3Qgc2l6ZSA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLnNpemUpOwogICAgc3R5bGUud2lkdGggPSBzdHlsZS5oZWlnaHQgPSBzaXplOwogICAgbGV0IHR5cGU7CiAgICBsZXQgY2xhc3NOYW1lOwogICAgbGV0IGdyb3VwSWQ7CiAgICBjb25zdCBmaWVsZCA9IHRoaXNbJGdldFBhcmVudF0oKVskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgaXRlbXMgPSBmaWVsZC5pdGVtcy5jaGlsZHJlbi5sZW5ndGggJiYgZmllbGQuaXRlbXMuY2hpbGRyZW5bMF1bJHRvSFRNTF0oKS5odG1sIHx8IFtdOwogICAgY29uc3QgZXhwb3J0ZWRWYWx1ZSA9IHsKICAgICAgb246IChpdGVtc1swXSAhPT0gdW5kZWZpbmVkID8gaXRlbXNbMF0gOiAib24iKS50b1N0cmluZygpLAogICAgICBvZmY6IChpdGVtc1sxXSAhPT0gdW5kZWZpbmVkID8gaXRlbXNbMV0gOiAib2ZmIikudG9TdHJpbmcoKQogICAgfTsKICAgIGNvbnN0IHZhbHVlID0gZmllbGQudmFsdWU/LlskdGV4dF0oKSB8fCAib2ZmIjsKICAgIGNvbnN0IGNoZWNrZWQgPSB2YWx1ZSA9PT0gZXhwb3J0ZWRWYWx1ZS5vbiB8fCB1bmRlZmluZWQ7CiAgICBjb25zdCBjb250YWluZXIgPSBmaWVsZFskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGNvbnN0IGZpZWxkSWQgPSBmaWVsZFskdWlkXTsKICAgIGxldCBkYXRhSWQ7CiAgICBpZiAoY29udGFpbmVyIGluc3RhbmNlb2YgRXhjbEdyb3VwKSB7CiAgICAgIGdyb3VwSWQgPSBjb250YWluZXJbJHVpZF07CiAgICAgIHR5cGUgPSAicmFkaW8iOwogICAgICBjbGFzc05hbWUgPSAieGZhUmFkaW8iOwogICAgICBkYXRhSWQgPSBjb250YWluZXJbJGRhdGFdPy5bJHVpZF0gfHwgY29udGFpbmVyWyR1aWRdOwogICAgfSBlbHNlIHsKICAgICAgdHlwZSA9ICJjaGVja2JveCI7CiAgICAgIGNsYXNzTmFtZSA9ICJ4ZmFDaGVja2JveCI7CiAgICAgIGRhdGFJZCA9IGZpZWxkWyRkYXRhXT8uWyR1aWRdIHx8IGZpZWxkWyR1aWRdOwogICAgfQogICAgY29uc3QgaW5wdXQgPSB7CiAgICAgIG5hbWU6ICJpbnB1dCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogW2NsYXNzTmFtZV0sCiAgICAgICAgc3R5bGUsCiAgICAgICAgZmllbGRJZCwKICAgICAgICBkYXRhSWQsCiAgICAgICAgdHlwZSwKICAgICAgICBjaGVja2VkLAogICAgICAgIHhmYU9uOiBleHBvcnRlZFZhbHVlLm9uLAogICAgICAgIHhmYU9mZjogZXhwb3J0ZWRWYWx1ZS5vZmYsCiAgICAgICAgImFyaWEtbGFiZWwiOiBhcmlhTGFiZWwoZmllbGQpLAogICAgICAgICJhcmlhLXJlcXVpcmVkIjogZmFsc2UKICAgICAgfQogICAgfTsKICAgIGlmIChncm91cElkKSB7CiAgICAgIGlucHV0LmF0dHJpYnV0ZXMubmFtZSA9IGdyb3VwSWQ7CiAgICB9CiAgICBpZiAoaXNSZXF1aXJlZChmaWVsZCkpIHsKICAgICAgaW5wdXQuYXR0cmlidXRlc1siYXJpYS1yZXF1aXJlZCJdID0gdHJ1ZTsKICAgICAgaW5wdXQuYXR0cmlidXRlcy5yZXF1aXJlZCA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImxhYmVsIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYUxhYmVsIl0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFtpbnB1dF0KICAgIH0pOwogIH0KfQpjbGFzcyBDaG9pY2VMaXN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNob2ljZUxpc3QiLCB0cnVlKTsKICAgIHRoaXMuY29tbWl0T24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5jb21taXRPbiwgWyJzZWxlY3QiLCAiZXhpdCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5vcGVuID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3BlbiwgWyJ1c2VyQ29udHJvbCIsICJhbHdheXMiLCAibXVsdGlTZWxlY3QiLCAib25FbnRyeSJdKTsKICAgIHRoaXMudGV4dEVudHJ5ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMudGV4dEVudHJ5LAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImJvcmRlciIsICJtYXJnaW4iKTsKICAgIGNvbnN0IHVpID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgY29uc3QgZmllbGQgPSB1aVskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgZm9udFNpemUgPSBmaWVsZC5mb250Py5zaXplIHx8IDEwOwogICAgY29uc3Qgb3B0aW9uU3R5bGUgPSB7CiAgICAgIGZvbnRTaXplOiBgY2FsYygke2ZvbnRTaXplfXB4ICogdmFyKC0tdG90YWwtc2NhbGUtZmFjdG9yKSlgCiAgICB9OwogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIGlmIChmaWVsZC5pdGVtcy5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGl0ZW1zID0gZmllbGQuaXRlbXM7CiAgICAgIGxldCBkaXNwbGF5ZWRJbmRleCA9IDA7CiAgICAgIGxldCBzYXZlSW5kZXggPSAwOwogICAgICBpZiAoaXRlbXMuY2hpbGRyZW4ubGVuZ3RoID09PSAyKSB7CiAgICAgICAgZGlzcGxheWVkSW5kZXggPSBpdGVtcy5jaGlsZHJlblswXS5zYXZlOwogICAgICAgIHNhdmVJbmRleCA9IDEgLSBkaXNwbGF5ZWRJbmRleDsKICAgICAgfQogICAgICBjb25zdCBkaXNwbGF5ZWQgPSBpdGVtcy5jaGlsZHJlbltkaXNwbGF5ZWRJbmRleF1bJHRvSFRNTF0oKS5odG1sOwogICAgICBjb25zdCB2YWx1ZXMgPSBpdGVtcy5jaGlsZHJlbltzYXZlSW5kZXhdWyR0b0hUTUxdKCkuaHRtbDsKICAgICAgbGV0IHNlbGVjdGVkID0gZmFsc2U7CiAgICAgIGNvbnN0IHZhbHVlID0gZmllbGQudmFsdWU/LlskdGV4dF0oKSB8fCAiIjsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGlzcGxheWVkLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBvcHRpb24gPSB7CiAgICAgICAgICBuYW1lOiAib3B0aW9uIiwKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgdmFsdWU6IHZhbHVlc1tpXSB8fCBkaXNwbGF5ZWRbaV0sCiAgICAgICAgICAgIHN0eWxlOiBvcHRpb25TdHlsZQogICAgICAgICAgfSwKICAgICAgICAgIHZhbHVlOiBkaXNwbGF5ZWRbaV0KICAgICAgICB9OwogICAgICAgIGlmICh2YWx1ZXNbaV0gPT09IHZhbHVlKSB7CiAgICAgICAgICBvcHRpb24uYXR0cmlidXRlcy5zZWxlY3RlZCA9IHNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgY2hpbGRyZW4ucHVzaChvcHRpb24pOwogICAgICB9CiAgICAgIGlmICghc2VsZWN0ZWQpIHsKICAgICAgICBjaGlsZHJlbi5zcGxpY2UoMCwgMCwgewogICAgICAgICAgbmFtZTogIm9wdGlvbiIsCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIGhpZGRlbjogdHJ1ZSwKICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUKICAgICAgICAgIH0sCiAgICAgICAgICB2YWx1ZTogIiAiCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHNlbGVjdEF0dHJpYnV0ZXMgPSB7CiAgICAgIGNsYXNzOiBbInhmYVNlbGVjdCJdLAogICAgICBmaWVsZElkOiBmaWVsZFskdWlkXSwKICAgICAgZGF0YUlkOiBmaWVsZFskZGF0YV0/LlskdWlkXSB8fCBmaWVsZFskdWlkXSwKICAgICAgc3R5bGUsCiAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgfTsKICAgIGlmIChpc1JlcXVpcmVkKGZpZWxkKSkgewogICAgICBzZWxlY3RBdHRyaWJ1dGVzWyJhcmlhLXJlcXVpcmVkIl0gPSB0cnVlOwogICAgICBzZWxlY3RBdHRyaWJ1dGVzLnJlcXVpcmVkID0gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLm9wZW4gPT09ICJtdWx0aVNlbGVjdCIpIHsKICAgICAgc2VsZWN0QXR0cmlidXRlcy5tdWx0aXBsZSA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImxhYmVsIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYUxhYmVsIl0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFt7CiAgICAgICAgbmFtZTogInNlbGVjdCIsCiAgICAgICAgY2hpbGRyZW4sCiAgICAgICAgYXR0cmlidXRlczogc2VsZWN0QXR0cmlidXRlcwogICAgICB9XQogICAgfSk7CiAgfQp9CmNsYXNzIENvbG9yIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNvbG9yIiwgdHJ1ZSk7CiAgICB0aGlzLmNTcGFjZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmNTcGFjZSwgWyJTUkdCIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy52YWx1ZSA9IGF0dHJpYnV0ZXMudmFsdWUgPyBnZXRDb2xvcihhdHRyaWJ1dGVzLnZhbHVlKSA6ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJGhhc1NldHRhYmxlVmFsdWVdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgcmV0dXJuIHRoaXMudmFsdWUgPyBVdGlsLm1ha2VIZXhDb2xvcih0aGlzLnZhbHVlLnIsIHRoaXMudmFsdWUuZywgdGhpcy52YWx1ZS5iKSA6IG51bGw7CiAgfQp9CmNsYXNzIENvbWIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29tYiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm51bWJlck9mQ2VsbHMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5udW1iZXJPZkNlbGxzLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBDb25uZWN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNvbm5lY3QiLCB0cnVlKTsKICAgIHRoaXMuY29ubmVjdGlvbiA9IGF0dHJpYnV0ZXMuY29ubmVjdGlvbiB8fCAiIjsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudXNhZ2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy51c2FnZSwgWyJleHBvcnRBbmRJbXBvcnQiLCAiZXhwb3J0T25seSIsICJpbXBvcnRPbmx5Il0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMucGljdHVyZSA9IG51bGw7CiAgfQp9CmNsYXNzIENvbnRlbnRBcmVhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNvbnRlbnRBcmVhIiwgdHJ1ZSk7CiAgICB0aGlzLmggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmgpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy53KTsKICAgIHRoaXMueCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IGxlZnQgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy54KTsKICAgIGNvbnN0IHRvcCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLnkpOwogICAgY29uc3Qgc3R5bGUgPSB7CiAgICAgIGxlZnQsCiAgICAgIHRvcCwKICAgICAgd2lkdGg6IG1lYXN1cmVUb1N0cmluZyh0aGlzLncpLAogICAgICBoZWlnaHQ6IG1lYXN1cmVUb1N0cmluZyh0aGlzLmgpCiAgICB9OwogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhQ29udGVudGFyZWEiXTsKICAgIGlmIChpc1ByaW50T25seSh0aGlzKSkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBjaGlsZHJlbjogW10sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBzdHlsZSwKICAgICAgICBjbGFzczogY2xhc3NOYW1lcywKICAgICAgICBpZDogdGhpc1skdWlkXQogICAgICB9CiAgICB9KTsKICB9Cn0KY2xhc3MgQ29ybmVyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNvcm5lciIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmludmVydGVkID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuaW52ZXJ0ZWQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmpvaW4gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5qb2luLCBbInNxdWFyZSIsICJyb3VuZCJdKTsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJhZGl1cyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMucmFkaXVzKTsKICAgIHRoaXMuc3Ryb2tlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc3Ryb2tlLCBbInNvbGlkIiwgImRhc2hEb3QiLCAiZGFzaERvdERvdCIsICJkYXNoZWQiLCAiZG90dGVkIiwgImVtYm9zc2VkIiwgImV0Y2hlZCIsICJsb3dlcmVkIiwgInJhaXNlZCJdKTsKICAgIHRoaXMudGhpY2tuZXNzID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy50aGlja25lc3MsICIwLjVwdCIpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJ2aXNpYmlsaXR5Iik7CiAgICBzdHlsZS5yYWRpdXMgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5qb2luID09PSAic3F1YXJlIiA/IDAgOiB0aGlzLnJhZGl1cyk7CiAgICByZXR1cm4gc3R5bGU7CiAgfQp9CmNsYXNzIERhdGVFbGVtZW50IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkYXRlIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgZGF0ZSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gZGF0ZSA/IG5ldyBEYXRlKGRhdGUpIDogbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gPyB0aGlzWyRjb250ZW50XS50b1N0cmluZygpIDogIiIpOwogIH0KfQpjbGFzcyBEYXRlVGltZSBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGF0ZVRpbWUiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBkYXRlID0gdGhpc1skY29udGVudF0udHJpbSgpOwogICAgdGhpc1skY29udGVudF0gPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkgOiBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiB2YWx1ZVRvSHRtbCh0aGlzWyRjb250ZW50XSA/IHRoaXNbJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIERhdGVUaW1lRWRpdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkYXRlVGltZUVkaXQiLCB0cnVlKTsKICAgIHRoaXMuaFNjcm9sbFBvbGljeSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhTY3JvbGxQb2xpY3ksIFsiYXV0byIsICJvZmYiLCAib24iXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucGlja2VyID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucGlja2VyLCBbImhvc3QiLCAibm9uZSJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNvbWIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiYm9yZGVyIiwgImZvbnQiLCAibWFyZ2luIik7CiAgICBjb25zdCBmaWVsZCA9IHRoaXNbJGdldFBhcmVudF0oKVskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImlucHV0IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHR5cGU6ICJ0ZXh0IiwKICAgICAgICBmaWVsZElkOiBmaWVsZFskdWlkXSwKICAgICAgICBkYXRhSWQ6IGZpZWxkWyRkYXRhXT8uWyR1aWRdIHx8IGZpZWxkWyR1aWRdLAogICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgIHN0eWxlLAogICAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgIH0KICAgIH07CiAgICBpZiAoaXNSZXF1aXJlZChmaWVsZCkpIHsKICAgICAgaHRtbC5hdHRyaWJ1dGVzWyJhcmlhLXJlcXVpcmVkIl0gPSB0cnVlOwogICAgICBodG1sLmF0dHJpYnV0ZXMucmVxdWlyZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJsYWJlbCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFMYWJlbCJdCiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbaHRtbF0KICAgIH0pOwogIH0KfQpjbGFzcyBEZWNpbWFsIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkZWNpbWFsIik7CiAgICB0aGlzLmZyYWNEaWdpdHMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5mcmFjRGlnaXRzLAogICAgICBkZWZhdWx0VmFsdWU6IDIsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxlYWREaWdpdHMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5sZWFkRGlnaXRzLAogICAgICBkZWZhdWx0VmFsdWU6IC0xLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgbnVtYmVyID0gcGFyc2VGbG9hdCh0aGlzWyRjb250ZW50XS50cmltKCkpOwogICAgdGhpc1skY29udGVudF0gPSBpc05hTihudW1iZXIpID8gbnVsbCA6IG51bWJlcjsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gIT09IG51bGwgPyB0aGlzWyRjb250ZW50XS50b1N0cmluZygpIDogIiIpOwogIH0KfQpjbGFzcyBEZWZhdWx0VWkgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGVmYXVsdFVpIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQp9CmNsYXNzIERlc2MgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGVzYyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib29sZWFuID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZVRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVjaW1hbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leERhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmxvYXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW1hZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW50ZWdlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZXh0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRGlnZXN0TWV0aG9kIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRpZ2VzdE1ldGhvZCIsIFsiIiwgIlNIQTEiLCAiU0hBMjU2IiwgIlNIQTUxMiIsICJSSVBFTUQxNjAiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIERpZ2VzdE1ldGhvZHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGlnZXN0TWV0aG9kcyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZGlnZXN0TWV0aG9kID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIERyYXcgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZHJhdyIsIHRydWUpOwogICAgdGhpcy5hbmNob3JUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYW5jaG9yVHlwZSwgWyJ0b3BMZWZ0IiwgImJvdHRvbUNlbnRlciIsICJib3R0b21MZWZ0IiwgImJvdHRvbVJpZ2h0IiwgIm1pZGRsZUNlbnRlciIsICJtaWRkbGVMZWZ0IiwgIm1pZGRsZVJpZ2h0IiwgInRvcENlbnRlciIsICJ0b3BSaWdodCJdKTsKICAgIHRoaXMuY29sU3BhbiA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNvbFNwYW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxIHx8IG4gPT09IC0xCiAgICB9KTsKICAgIHRoaXMuaCA9IGF0dHJpYnV0ZXMuaCA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuaCkgOiAiIjsKICAgIHRoaXMuaEFsaWduID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaEFsaWduLCBbImxlZnQiLCAiY2VudGVyIiwgImp1c3RpZnkiLCAianVzdGlmeUFsbCIsICJyYWRpeCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sb2NhbGUgPSBhdHRyaWJ1dGVzLmxvY2FsZSB8fCAiIjsKICAgIHRoaXMubWF4SCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4SCwgIjBwdCIpOwogICAgdGhpcy5tYXhXID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhXLCAiMHB0Iik7CiAgICB0aGlzLm1pbkggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pbkgsICIwcHQiKTsKICAgIHRoaXMubWluVyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWluVywgIjBwdCIpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMucm90YXRlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucm90YXRlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggJSA5MCA9PT0gMAogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ID0gYXR0cmlidXRlcy53ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy53KSA6ICIiOwogICAgdGhpcy54ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuYXNzaXN0ID0gbnVsbDsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuY2FwdGlvbiA9IG51bGw7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5mb250ID0gbnVsbDsKICAgIHRoaXMua2VlcCA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgICB0aGlzLnBhcmEgPSBudWxsOwogICAgdGhpcy50cmF2ZXJzYWwgPSBudWxsOwogICAgdGhpcy51aSA9IG51bGw7CiAgICB0aGlzLnZhbHVlID0gbnVsbDsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIF9zZXRWYWx1ZSh0aGlzLCB2YWx1ZSk7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgc2V0VGFiSW5kZXgodGhpcyk7CiAgICBpZiAodGhpcy5wcmVzZW5jZSA9PT0gImhpZGRlbiIgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImluYWN0aXZlIikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGZpeERpbWVuc2lvbnModGhpcyk7CiAgICB0aGlzWyRwdXNoUGFyYV0oKTsKICAgIGNvbnN0IHNhdmVkVyA9IHRoaXMudzsKICAgIGNvbnN0IHNhdmVkSCA9IHRoaXMuaDsKICAgIGNvbnN0IHsKICAgICAgdywKICAgICAgaCwKICAgICAgaXNCcm9rZW4KICAgIH0gPSBsYXlvdXROb2RlKHRoaXMsIGF2YWlsYWJsZVNwYWNlKTsKICAgIGlmICh3ICYmIHRoaXMudyA9PT0gIiIpIHsKICAgICAgaWYgKGlzQnJva2VuICYmIHRoaXNbJGdldFN1YmZvcm1QYXJlbnRdKClbJGlzVGhlcmVNb3JlV2lkdGhdKCkpIHsKICAgICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICAgIH0KICAgICAgdGhpcy53ID0gdzsKICAgIH0KICAgIGlmIChoICYmIHRoaXMuaCA9PT0gIiIpIHsKICAgICAgdGhpcy5oID0gaDsKICAgIH0KICAgIHNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgaWYgKCFjaGVja0RpbWVuc2lvbnModGhpcywgYXZhaWxhYmxlU3BhY2UpKSB7CiAgICAgIHRoaXMudyA9IHNhdmVkVzsKICAgICAgdGhpcy5oID0gc2F2ZWRIOwogICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgdW5zZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiZm9udCIsICJoQWxpZ24iLCAiZGltZW5zaW9ucyIsICJwb3NpdGlvbiIsICJwcmVzZW5jZSIsICJyb3RhdGUiLCAiYW5jaG9yVHlwZSIsICJib3JkZXIiLCAibWFyZ2luIik7CiAgICBzZXRNaW5NYXhEaW1lbnNpb25zKHRoaXMsIHN0eWxlKTsKICAgIGlmIChzdHlsZS5tYXJnaW4pIHsKICAgICAgc3R5bGUucGFkZGluZyA9IHN0eWxlLm1hcmdpbjsKICAgICAgZGVsZXRlIHN0eWxlLm1hcmdpbjsKICAgIH0KICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYURyYXciXTsKICAgIGlmICh0aGlzLmZvbnQpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFGb250Iik7CiAgICB9CiAgICBpZiAoaXNQcmludE9ubHkodGhpcykpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIHN0eWxlLAogICAgICBpZDogdGhpc1skdWlkXSwKICAgICAgY2xhc3M6IGNsYXNzTmFtZXMKICAgIH07CiAgICBpZiAodGhpcy5uYW1lKSB7CiAgICAgIGF0dHJpYnV0ZXMueGZhTmFtZSA9IHRoaXMubmFtZTsKICAgIH0KICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBjaGlsZHJlbjogW10KICAgIH07CiAgICBhcHBseUFzc2lzdCh0aGlzLCBhdHRyaWJ1dGVzKTsKICAgIGNvbnN0IGJib3ggPSBjb21wdXRlQmJveCh0aGlzLCBodG1sLCBhdmFpbGFibGVTcGFjZSk7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMudmFsdWUgPyB0aGlzLnZhbHVlWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKS5odG1sIDogbnVsbDsKICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICB0aGlzLncgPSBzYXZlZFc7CiAgICAgIHRoaXMuaCA9IHNhdmVkSDsKICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjcmVhdGVXcmFwcGVyKHRoaXMsIGh0bWwpLCBiYm94KTsKICAgIH0KICAgIGh0bWwuY2hpbGRyZW4ucHVzaCh2YWx1ZSk7CiAgICBzZXRQYXJhKHRoaXMsIHN0eWxlLCB2YWx1ZSk7CiAgICB0aGlzLncgPSBzYXZlZFc7CiAgICB0aGlzLmggPSBzYXZlZEg7CiAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjcmVhdGVXcmFwcGVyKHRoaXMsIGh0bWwpLCBiYm94KTsKICB9Cn0KY2xhc3MgRWRnZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlZGdlIiwgdHJ1ZSk7CiAgICB0aGlzLmNhcCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmNhcCwgWyJzcXVhcmUiLCAiYnV0dCIsICJyb3VuZCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMuc3Ryb2tlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc3Ryb2tlLCBbInNvbGlkIiwgImRhc2hEb3QiLCAiZGFzaERvdERvdCIsICJkYXNoZWQiLCAiZG90dGVkIiwgImVtYm9zc2VkIiwgImV0Y2hlZCIsICJsb3dlcmVkIiwgInJhaXNlZCJdKTsKICAgIHRoaXMudGhpY2tuZXNzID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy50aGlja25lc3MsICIwLjVwdCIpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJ2aXNpYmlsaXR5Iik7CiAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB7CiAgICAgIGxpbmVjYXA6IHRoaXMuY2FwLAogICAgICB3aWR0aDogbWVhc3VyZVRvU3RyaW5nKHRoaXMudGhpY2tuZXNzKSwKICAgICAgY29sb3I6IHRoaXMuY29sb3IgPyB0aGlzLmNvbG9yWyR0b1N0eWxlXSgpIDogIiMwMDAwMDAiLAogICAgICBzdHlsZTogIiIKICAgIH0pOwogICAgaWYgKHRoaXMucHJlc2VuY2UgIT09ICJ2aXNpYmxlIikgewogICAgICBzdHlsZS5zdHlsZSA9ICJub25lIjsKICAgIH0gZWxzZSB7CiAgICAgIHN3aXRjaCAodGhpcy5zdHJva2UpIHsKICAgICAgICBjYXNlICJzb2xpZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJzb2xpZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkYXNoRG90IjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gImRhc2hlZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkYXNoRG90RG90IjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gImRhc2hlZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkYXNoZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAiZGFzaGVkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRvdHRlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJkb3R0ZWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZW1ib3NzZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAicmlkZ2UiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXRjaGVkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gImdyb292ZSI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsb3dlcmVkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gImluc2V0IjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInJhaXNlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJvdXRzZXQiOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgRW5jb2RpbmcgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jb2RpbmciLCBbImFkYmUueDUwOS5yc2Ffc2hhMSIsICJhZGJlLnBrY3M3LmRldGFjaGVkIiwgImFkYmUucGtjczcuc2hhMSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgRW5jb2RpbmdzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY29kaW5ncyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZW5jb2RpbmcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRW5jcnlwdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNyeXB0IiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNlcnRpZmljYXRlID0gbnVsbDsKICB9Cn0KY2xhc3MgRW5jcnlwdERhdGEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdERhdGEiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5vcGVyYXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5vcGVyYXRpb24sIFsiZW5jcnlwdCIsICJkZWNyeXB0Il0pOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmZpbHRlciA9IG51bGw7CiAgICB0aGlzLm1hbmlmZXN0ID0gbnVsbDsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNyeXB0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jZXJ0aWZpY2F0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBFbmNyeXB0aW9uTWV0aG9kIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY3J5cHRpb25NZXRob2QiLCBbIiIsICJBRVMyNTYtQ0JDIiwgIlRSSVBMRURFUy1DQkMiLCAiQUVTMTI4LUNCQyIsICJBRVMxOTItQ0JDIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBFbmNyeXB0aW9uTWV0aG9kcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNyeXB0aW9uTWV0aG9kcyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZW5jcnlwdGlvbk1ldGhvZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBFdmVudCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJldmVudCIsIHRydWUpOwogICAgdGhpcy5hY3Rpdml0eSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFjdGl2aXR5LCBbImNsaWNrIiwgImNoYW5nZSIsICJkb2NDbG9zZSIsICJkb2NSZWFkeSIsICJlbnRlciIsICJleGl0IiwgImZ1bGwiLCAiaW5kZXhDaGFuZ2UiLCAiaW5pdGlhbGl6ZSIsICJtb3VzZURvd24iLCAibW91c2VFbnRlciIsICJtb3VzZUV4aXQiLCAibW91c2VVcCIsICJwb3N0RXhlY3V0ZSIsICJwb3N0T3BlbiIsICJwb3N0UHJpbnQiLCAicG9zdFNhdmUiLCAicG9zdFNpZ24iLCAicG9zdFN1Ym1pdCIsICJwcmVFeGVjdXRlIiwgInByZU9wZW4iLCAicHJlUHJpbnQiLCAicHJlU2F2ZSIsICJwcmVTaWduIiwgInByZVN1Ym1pdCIsICJyZWFkeSIsICJ2YWxpZGF0aW9uU3RhdGUiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGlzdGVuID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubGlzdGVuLCBbInJlZk9ubHkiLCAicmVmQW5kRGVzY2VuZGVudHMiXSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZW5jcnlwdERhdGEgPSBudWxsOwogICAgdGhpcy5leGVjdXRlID0gbnVsbDsKICAgIHRoaXMuc2NyaXB0ID0gbnVsbDsKICAgIHRoaXMuc2lnbkRhdGEgPSBudWxsOwogICAgdGhpcy5zdWJtaXQgPSBudWxsOwogIH0KfQpjbGFzcyBFeERhdGEgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImV4RGF0YSIpOwogICAgdGhpcy5jb250ZW50VHlwZSA9IGF0dHJpYnV0ZXMuY29udGVudFR5cGUgfHwgIiI7CiAgICB0aGlzLmhyZWYgPSBhdHRyaWJ1dGVzLmhyZWYgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubWF4TGVuZ3RoID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubWF4TGVuZ3RoLAogICAgICBkZWZhdWx0VmFsdWU6IC0xLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IC0xCiAgICB9KTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmlkID0gYXR0cmlidXRlcy5yaWQgfHwgIiI7CiAgICB0aGlzLnRyYW5zZmVyRW5jb2RpbmcgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50cmFuc2ZlckVuY29kaW5nLCBbIm5vbmUiLCAiYmFzZTY0IiwgInBhY2thZ2UiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGlzQ0RBVEFYbWxdKCkgewogICAgcmV0dXJuIHRoaXMuY29udGVudFR5cGUgPT09ICJ0ZXh0L2h0bWwiOwogIH0KICBbJG9uQ2hpbGRdKGNoaWxkKSB7CiAgICBpZiAodGhpcy5jb250ZW50VHlwZSA9PT0gInRleHQvaHRtbCIgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gTmFtZXNwYWNlSWRzLnhodG1sLmlkKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdID0gY2hpbGQ7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHRoaXMuY29udGVudFR5cGUgPT09ICJ0ZXh0L3htbCIpIHsKICAgICAgdGhpc1skY29udGVudF0gPSBjaGlsZDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKHRoaXMuY29udGVudFR5cGUgIT09ICJ0ZXh0L2h0bWwiIHx8ICF0aGlzWyRjb250ZW50XSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIHJldHVybiB0aGlzWyRjb250ZW50XVskdG9IVE1MXShhdmFpbGFibGVTcGFjZSk7CiAgfQp9CmNsYXNzIEV4T2JqZWN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImV4T2JqZWN0IiwgdHJ1ZSk7CiAgICB0aGlzLmFyY2hpdmUgPSBhdHRyaWJ1dGVzLmFyY2hpdmUgfHwgIiI7CiAgICB0aGlzLmNsYXNzSWQgPSBhdHRyaWJ1dGVzLmNsYXNzSWQgfHwgIiI7CiAgICB0aGlzLmNvZGVCYXNlID0gYXR0cmlidXRlcy5jb2RlQmFzZSB8fCAiIjsKICAgIHRoaXMuY29kZVR5cGUgPSBhdHRyaWJ1dGVzLmNvZGVUeXBlIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5ib29sZWFuID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZVRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVjaW1hbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leERhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhPYmplY3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmxvYXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW1hZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW50ZWdlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZXh0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRXhjbEdyb3VwIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImV4Y2xHcm91cCIsIHRydWUpOwogICAgdGhpcy5hY2Nlc3MgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hY2Nlc3MsIFsib3BlbiIsICJub25JbnRlcmFjdGl2ZSIsICJwcm90ZWN0ZWQiLCAicmVhZE9ubHkiXSk7CiAgICB0aGlzLmFjY2Vzc0tleSA9IGF0dHJpYnV0ZXMuYWNjZXNzS2V5IHx8ICIiOwogICAgdGhpcy5hbmNob3JUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYW5jaG9yVHlwZSwgWyJ0b3BMZWZ0IiwgImJvdHRvbUNlbnRlciIsICJib3R0b21MZWZ0IiwgImJvdHRvbVJpZ2h0IiwgIm1pZGRsZUNlbnRlciIsICJtaWRkbGVMZWZ0IiwgIm1pZGRsZVJpZ2h0IiwgInRvcENlbnRlciIsICJ0b3BSaWdodCJdKTsKICAgIHRoaXMuY29sU3BhbiA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNvbFNwYW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxIHx8IG4gPT09IC0xCiAgICB9KTsKICAgIHRoaXMuaCA9IGF0dHJpYnV0ZXMuaCA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuaCkgOiAiIjsKICAgIHRoaXMuaEFsaWduID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaEFsaWduLCBbImxlZnQiLCAiY2VudGVyIiwgImp1c3RpZnkiLCAianVzdGlmeUFsbCIsICJyYWRpeCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sYXlvdXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5sYXlvdXQsIFsicG9zaXRpb24iLCAibHItdGIiLCAicmwtcm93IiwgInJsLXRiIiwgInJvdyIsICJ0YWJsZSIsICJ0YiJdKTsKICAgIHRoaXMubWF4SCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4SCwgIjBwdCIpOwogICAgdGhpcy5tYXhXID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhXLCAiMHB0Iik7CiAgICB0aGlzLm1pbkggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pbkgsICIwcHQiKTsKICAgIHRoaXMubWluVyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWluVywgIjBwdCIpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLncgPSBhdHRyaWJ1dGVzLncgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLncpIDogIiI7CiAgICB0aGlzLnggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLngsICIwcHQiKTsKICAgIHRoaXMueSA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueSwgIjBwdCIpOwogICAgdGhpcy5hc3Npc3QgPSBudWxsOwogICAgdGhpcy5iaW5kID0gbnVsbDsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuY2FsY3VsYXRlID0gbnVsbDsKICAgIHRoaXMuY2FwdGlvbiA9IG51bGw7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudHJhdmVyc2FsID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy5jb25uZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV2ZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZpZWxkID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNldFByb3BlcnR5ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogIFskaXNCaW5kYWJsZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRoYXNTZXR0YWJsZVZhbHVlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgZm9yIChjb25zdCBmaWVsZCBvZiB0aGlzLmZpZWxkLmNoaWxkcmVuKSB7CiAgICAgIGlmICghZmllbGQudmFsdWUpIHsKICAgICAgICBjb25zdCBub2RlVmFsdWUgPSBuZXcgVmFsdWUoe30pOwogICAgICAgIGZpZWxkWyRhcHBlbmRDaGlsZF0obm9kZVZhbHVlKTsKICAgICAgICBmaWVsZC52YWx1ZSA9IG5vZGVWYWx1ZTsKICAgICAgfQogICAgICBmaWVsZC52YWx1ZVskc2V0VmFsdWVdKHZhbHVlKTsKICAgIH0KICB9CiAgWyRpc1RoZXJlTW9yZVdpZHRoXSgpIHsKICAgIHJldHVybiB0aGlzLmxheW91dC5lbmRzV2l0aCgiLXRiIikgJiYgdGhpc1skZXh0cmFdLmF0dGVtcHQgPT09IDAgJiYgdGhpc1skZXh0cmFdLm51bWJlckluTGluZSA+IDAgfHwgdGhpc1skZ2V0UGFyZW50XSgpWyRpc1RoZXJlTW9yZVdpZHRoXSgpOwogIH0KICBbJGlzU3BsaXR0YWJsZV0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgaWYgKCFwYXJlbnRbJGlzU3BsaXR0YWJsZV0oKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGUgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGU7CiAgICB9CiAgICBpZiAodGhpcy5sYXlvdXQgPT09ICJwb3NpdGlvbiIgfHwgdGhpcy5sYXlvdXQuaW5jbHVkZXMoInJvdyIpKSB7CiAgICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gZmFsc2U7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChwYXJlbnQubGF5b3V0Py5lbmRzV2l0aCgiLXRiIikgJiYgcGFyZW50WyRleHRyYV0ubnVtYmVySW5MaW5lICE9PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGZsdXNoSFRNTF0oKSB7CiAgICByZXR1cm4gZmx1c2hIVE1MKHRoaXMpOwogIH0KICBbJGFkZEhUTUxdKGh0bWwsIGJib3gpIHsKICAgIGFkZEhUTUwodGhpcywgaHRtbCwgYmJveCk7CiAgfQogIFskZ2V0QXZhaWxhYmxlU3BhY2VdKCkgewogICAgcmV0dXJuIGdldEF2YWlsYWJsZVNwYWNlKHRoaXMpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHNldFRhYkluZGV4KHRoaXMpOwogICAgaWYgKHRoaXMucHJlc2VuY2UgPT09ICJoaWRkZW4iIHx8IHRoaXMucHJlc2VuY2UgPT09ICJpbmFjdGl2ZSIgfHwgdGhpcy5oID09PSAwIHx8IHRoaXMudyA9PT0gMCkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGZpeERpbWVuc2lvbnModGhpcyk7CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgaWQ6IHRoaXNbJHVpZF0sCiAgICAgIGNsYXNzOiBbXQogICAgfTsKICAgIHNldEFjY2Vzcyh0aGlzLCBhdHRyaWJ1dGVzLmNsYXNzKTsKICAgIHRoaXNbJGV4dHJhXSB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIE9iamVjdC5hc3NpZ24odGhpc1skZXh0cmFdLCB7CiAgICAgIGNoaWxkcmVuLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBhdHRlbXB0OiAwLAogICAgICBsaW5lOiBudWxsLAogICAgICBudW1iZXJJbkxpbmU6IDAsCiAgICAgIGF2YWlsYWJsZVNwYWNlOiB7CiAgICAgICAgd2lkdGg6IE1hdGgubWluKHRoaXMudyB8fCBJbmZpbml0eSwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5taW4odGhpcy5oIHx8IEluZmluaXR5LCBhdmFpbGFibGVTcGFjZS5oZWlnaHQpCiAgICAgIH0sCiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAsCiAgICAgIHByZXZIZWlnaHQ6IDAsCiAgICAgIGN1cnJlbnRXaWR0aDogMAogICAgfSk7CiAgICBjb25zdCBpc1NwbGl0dGFibGUgPSB0aGlzWyRpc1NwbGl0dGFibGVdKCk7CiAgICBpZiAoIWlzU3BsaXR0YWJsZSkgewogICAgICBzZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIH0KICAgIGlmICghY2hlY2tEaW1lbnNpb25zKHRoaXMsIGF2YWlsYWJsZVNwYWNlKSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgY29uc3QgZmlsdGVyID0gbmV3IFNldChbImZpZWxkIl0pOwogICAgaWYgKHRoaXMubGF5b3V0LmluY2x1ZGVzKCJyb3ciKSkgewogICAgICBjb25zdCBjb2x1bW5XaWR0aHMgPSB0aGlzWyRnZXRTdWJmb3JtUGFyZW50XSgpLmNvbHVtbldpZHRoczsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29sdW1uV2lkdGhzKSAmJiBjb2x1bW5XaWR0aHMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXNbJGV4dHJhXS5jb2x1bW5XaWR0aHMgPSBjb2x1bW5XaWR0aHM7CiAgICAgICAgdGhpc1skZXh0cmFdLmN1cnJlbnRDb2x1bW4gPSAwOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImFuY2hvclR5cGUiLCAiZGltZW5zaW9ucyIsICJwb3NpdGlvbiIsICJwcmVzZW5jZSIsICJib3JkZXIiLCAibWFyZ2luIiwgImhBbGlnbiIpOwogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhRXhjbGdyb3VwIl07CiAgICBjb25zdCBjbCA9IGxheW91dENsYXNzKHRoaXMpOwogICAgaWYgKGNsKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaChjbCk7CiAgICB9CiAgICBpZiAoaXNQcmludE9ubHkodGhpcykpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIGF0dHJpYnV0ZXMuc3R5bGUgPSBzdHlsZTsKICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBjbGFzc05hbWVzOwogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICB0aGlzWyRwdXNoUGFyYV0oKTsKICAgIGNvbnN0IGlzTHJUYiA9IHRoaXMubGF5b3V0ID09PSAibHItdGIiIHx8IHRoaXMubGF5b3V0ID09PSAicmwtdGIiOwogICAgY29uc3QgbWF4UnVuID0gaXNMclRiID8gTUFYX0FUVEVNUFRTX0ZPUl9MUlRCX0xBWU9VVCA6IDE7CiAgICBmb3IgKDsgdGhpc1skZXh0cmFdLmF0dGVtcHQgPCBtYXhSdW47IHRoaXNbJGV4dHJhXS5hdHRlbXB0KyspIHsKICAgICAgaWYgKGlzTHJUYiAmJiB0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gTUFYX0FUVEVNUFRTX0ZPUl9MUlRCX0xBWU9VVCAtIDEpIHsKICAgICAgICB0aGlzWyRleHRyYV0ubnVtYmVySW5MaW5lID0gMDsKICAgICAgfQogICAgICBjb25zdCByZXN1bHQgPSB0aGlzWyRjaGlsZHJlblRvSFRNTF0oewogICAgICAgIGZpbHRlciwKICAgICAgICBpbmNsdWRlOiB0cnVlCiAgICAgIH0pOwogICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAocmVzdWx0LmlzQnJlYWsoKSkgewogICAgICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICBpZiAoaXNMclRiICYmIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSAwICYmIHRoaXNbJGV4dHJhXS5udW1iZXJJbkxpbmUgPT09IDAgJiYgIXRoaXNbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID0gbWF4UnVuOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgdW5zZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIH0KICAgIGlmICh0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gbWF4UnVuKSB7CiAgICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgICAgZGVsZXRlIHRoaXNbJGV4dHJhXTsKICAgICAgfQogICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgbGV0IG1hcmdpbkggPSAwOwogICAgbGV0IG1hcmdpblYgPSAwOwogICAgaWYgKHRoaXMubWFyZ2luKSB7CiAgICAgIG1hcmdpbkggPSB0aGlzLm1hcmdpbi5sZWZ0SW5zZXQgKyB0aGlzLm1hcmdpbi5yaWdodEluc2V0OwogICAgICBtYXJnaW5WID0gdGhpcy5tYXJnaW4udG9wSW5zZXQgKyB0aGlzLm1hcmdpbi5ib3R0b21JbnNldDsKICAgIH0KICAgIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgodGhpc1skZXh0cmFdLndpZHRoICsgbWFyZ2luSCwgdGhpcy53IHx8IDApOwogICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5tYXgodGhpc1skZXh0cmFdLmhlaWdodCArIG1hcmdpblYsIHRoaXMuaCB8fCAwKTsKICAgIGNvbnN0IGJib3ggPSBbdGhpcy54LCB0aGlzLnksIHdpZHRoLCBoZWlnaHRdOwogICAgaWYgKHRoaXMudyA9PT0gIiIpIHsKICAgICAgc3R5bGUud2lkdGggPSBtZWFzdXJlVG9TdHJpbmcod2lkdGgpOwogICAgfQogICAgaWYgKHRoaXMuaCA9PT0gIiIpIHsKICAgICAgc3R5bGUuaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKGhlaWdodCk7CiAgICB9CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlcywKICAgICAgY2hpbGRyZW4KICAgIH07CiAgICBhcHBseUFzc2lzdCh0aGlzLCBhdHRyaWJ1dGVzKTsKICAgIGRlbGV0ZSB0aGlzWyRleHRyYV07CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGNyZWF0ZVdyYXBwZXIodGhpcywgaHRtbCksIGJib3gpOwogIH0KfQpjbGFzcyBFeGVjdXRlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImV4ZWN1dGUiKTsKICAgIHRoaXMuY29ubmVjdGlvbiA9IGF0dHJpYnV0ZXMuY29ubmVjdGlvbiB8fCAiIjsKICAgIHRoaXMuZXhlY3V0ZVR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5leGVjdXRlVHlwZSwgWyJpbXBvcnQiLCAicmVtZXJnZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5ydW5BdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnJ1bkF0LCBbImNsaWVudCIsICJib3RoIiwgInNlcnZlciJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEV4dHJhcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJleHRyYXMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4dHJhcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBGaWVsZCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmaWVsZCIsIHRydWUpOwogICAgdGhpcy5hY2Nlc3MgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hY2Nlc3MsIFsib3BlbiIsICJub25JbnRlcmFjdGl2ZSIsICJwcm90ZWN0ZWQiLCAicmVhZE9ubHkiXSk7CiAgICB0aGlzLmFjY2Vzc0tleSA9IGF0dHJpYnV0ZXMuYWNjZXNzS2V5IHx8ICIiOwogICAgdGhpcy5hbmNob3JUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYW5jaG9yVHlwZSwgWyJ0b3BMZWZ0IiwgImJvdHRvbUNlbnRlciIsICJib3R0b21MZWZ0IiwgImJvdHRvbVJpZ2h0IiwgIm1pZGRsZUNlbnRlciIsICJtaWRkbGVMZWZ0IiwgIm1pZGRsZVJpZ2h0IiwgInRvcENlbnRlciIsICJ0b3BSaWdodCJdKTsKICAgIHRoaXMuY29sU3BhbiA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNvbFNwYW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxIHx8IG4gPT09IC0xCiAgICB9KTsKICAgIHRoaXMuaCA9IGF0dHJpYnV0ZXMuaCA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuaCkgOiAiIjsKICAgIHRoaXMuaEFsaWduID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaEFsaWduLCBbImxlZnQiLCAiY2VudGVyIiwgImp1c3RpZnkiLCAianVzdGlmeUFsbCIsICJyYWRpeCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sb2NhbGUgPSBhdHRyaWJ1dGVzLmxvY2FsZSB8fCAiIjsKICAgIHRoaXMubWF4SCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4SCwgIjBwdCIpOwogICAgdGhpcy5tYXhXID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhXLCAiMHB0Iik7CiAgICB0aGlzLm1pbkggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pbkgsICIwcHQiKTsKICAgIHRoaXMubWluVyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWluVywgIjBwdCIpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMucm90YXRlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucm90YXRlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggJSA5MCA9PT0gMAogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ID0gYXR0cmlidXRlcy53ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy53KSA6ICIiOwogICAgdGhpcy54ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuYXNzaXN0ID0gbnVsbDsKICAgIHRoaXMuYmluZCA9IG51bGw7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNhbGN1bGF0ZSA9IG51bGw7CiAgICB0aGlzLmNhcHRpb24gPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLmZvcm1hdCA9IG51bGw7CiAgICB0aGlzLml0ZW1zID0gbmV3IFhGQU9iamVjdEFycmF5KDIpOwogICAgdGhpcy5rZWVwID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICAgIHRoaXMucGFyYSA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNhbCA9IG51bGw7CiAgICB0aGlzLnVpID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy52YWx1ZSA9IG51bGw7CiAgICB0aGlzLmJpbmRJdGVtcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb25uZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV2ZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNldFByb3BlcnR5ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogIFskaXNCaW5kYWJsZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIF9zZXRWYWx1ZSh0aGlzLCB2YWx1ZSk7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgc2V0VGFiSW5kZXgodGhpcyk7CiAgICBpZiAoIXRoaXMudWkpIHsKICAgICAgdGhpcy51aSA9IG5ldyBVaSh7fSk7CiAgICAgIHRoaXMudWlbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICAgIHRoaXNbJGFwcGVuZENoaWxkXSh0aGlzLnVpKTsKICAgICAgbGV0IG5vZGU7CiAgICAgIHN3aXRjaCAodGhpcy5pdGVtcy5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBub2RlID0gbmV3IFRleHRFZGl0KHt9KTsKICAgICAgICAgIHRoaXMudWkudGV4dEVkaXQgPSBub2RlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgbm9kZSA9IG5ldyBDaGVja0J1dHRvbih7fSk7CiAgICAgICAgICB0aGlzLnVpLmNoZWNrQnV0dG9uID0gbm9kZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIG5vZGUgPSBuZXcgQ2hvaWNlTGlzdCh7fSk7CiAgICAgICAgICB0aGlzLnVpLmNob2ljZUxpc3QgPSBub2RlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy51aVskYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgfQogICAgaWYgKCF0aGlzLnVpIHx8IHRoaXMucHJlc2VuY2UgPT09ICJoaWRkZW4iIHx8IHRoaXMucHJlc2VuY2UgPT09ICJpbmFjdGl2ZSIgfHwgdGhpcy5oID09PSAwIHx8IHRoaXMudyA9PT0gMCkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGlmICh0aGlzLmNhcHRpb24pIHsKICAgICAgZGVsZXRlIHRoaXMuY2FwdGlvblskZXh0cmFdOwogICAgfQogICAgdGhpc1skcHVzaFBhcmFdKCk7CiAgICBjb25zdCBjYXB0aW9uID0gdGhpcy5jYXB0aW9uID8gdGhpcy5jYXB0aW9uWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKS5odG1sIDogbnVsbDsKICAgIGNvbnN0IHNhdmVkVyA9IHRoaXMudzsKICAgIGNvbnN0IHNhdmVkSCA9IHRoaXMuaDsKICAgIGxldCBtYXJnaW5IID0gMDsKICAgIGxldCBtYXJnaW5WID0gMDsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBtYXJnaW5IID0gdGhpcy5tYXJnaW4ubGVmdEluc2V0ICsgdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgbWFyZ2luViA9IHRoaXMubWFyZ2luLnRvcEluc2V0ICsgdGhpcy5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICB9CiAgICBsZXQgYm9yZGVyRGltcyA9IG51bGw7CiAgICBpZiAodGhpcy53ID09PSAiIiB8fCB0aGlzLmggPT09ICIiKSB7CiAgICAgIGxldCB3aWR0aCA9IG51bGw7CiAgICAgIGxldCBoZWlnaHQgPSBudWxsOwogICAgICBsZXQgdWlXID0gMDsKICAgICAgbGV0IHVpSCA9IDA7CiAgICAgIGlmICh0aGlzLnVpLmNoZWNrQnV0dG9uKSB7CiAgICAgICAgdWlXID0gdWlIID0gdGhpcy51aS5jaGVja0J1dHRvbi5zaXplOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHcsCiAgICAgICAgICBoCiAgICAgICAgfSA9IGxheW91dE5vZGUodGhpcywgYXZhaWxhYmxlU3BhY2UpOwogICAgICAgIGlmICh3ICE9PSBudWxsKSB7CiAgICAgICAgICB1aVcgPSB3OwogICAgICAgICAgdWlIID0gaDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdWlIID0gZm9udHNfZ2V0TWV0cmljcyh0aGlzLmZvbnQsIHRydWUpLmxpbmVOb0dhcDsKICAgICAgICB9CiAgICAgIH0KICAgICAgYm9yZGVyRGltcyA9IGdldEJvcmRlckRpbXModGhpcy51aVskZ2V0RXh0cmFdKCkpOwogICAgICB1aVcgKz0gYm9yZGVyRGltcy53OwogICAgICB1aUggKz0gYm9yZGVyRGltcy5oOwogICAgICBpZiAodGhpcy5jYXB0aW9uKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgdywKICAgICAgICAgIGgsCiAgICAgICAgICBpc0Jyb2tlbgogICAgICAgIH0gPSB0aGlzLmNhcHRpb25bJGdldEV4dHJhXShhdmFpbGFibGVTcGFjZSk7CiAgICAgICAgaWYgKGlzQnJva2VuICYmIHRoaXNbJGdldFN1YmZvcm1QYXJlbnRdKClbJGlzVGhlcmVNb3JlV2lkdGhdKCkpIHsKICAgICAgICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICAgICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgICAgIH0KICAgICAgICB3aWR0aCA9IHc7CiAgICAgICAgaGVpZ2h0ID0gaDsKICAgICAgICBzd2l0Y2ggKHRoaXMuY2FwdGlvbi5wbGFjZW1lbnQpIHsKICAgICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgICAgY2FzZSAiaW5saW5lIjoKICAgICAgICAgICAgd2lkdGggKz0gdWlXOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgICBjYXNlICJib3R0b20iOgogICAgICAgICAgICBoZWlnaHQgKz0gdWlIOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2lkdGggPSB1aVc7CiAgICAgICAgaGVpZ2h0ID0gdWlIOwogICAgICB9CiAgICAgIGlmICh3aWR0aCAmJiB0aGlzLncgPT09ICIiKSB7CiAgICAgICAgd2lkdGggKz0gbWFyZ2luSDsKICAgICAgICB0aGlzLncgPSBNYXRoLm1pbih0aGlzLm1heFcgPD0gMCA/IEluZmluaXR5IDogdGhpcy5tYXhXLCB0aGlzLm1pblcgKyAxIDwgd2lkdGggPyB3aWR0aCA6IHRoaXMubWluVyk7CiAgICAgIH0KICAgICAgaWYgKGhlaWdodCAmJiB0aGlzLmggPT09ICIiKSB7CiAgICAgICAgaGVpZ2h0ICs9IG1hcmdpblY7CiAgICAgICAgdGhpcy5oID0gTWF0aC5taW4odGhpcy5tYXhIIDw9IDAgPyBJbmZpbml0eSA6IHRoaXMubWF4SCwgdGhpcy5taW5IICsgMSA8IGhlaWdodCA/IGhlaWdodCA6IHRoaXMubWluSCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICBmaXhEaW1lbnNpb25zKHRoaXMpOwogICAgc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICBpZiAoIWNoZWNrRGltZW5zaW9ucyh0aGlzLCBhdmFpbGFibGVTcGFjZSkpIHsKICAgICAgdGhpcy53ID0gc2F2ZWRXOwogICAgICB0aGlzLmggPSBzYXZlZEg7CiAgICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJmb250IiwgImRpbWVuc2lvbnMiLCAicG9zaXRpb24iLCAicm90YXRlIiwgImFuY2hvclR5cGUiLCAicHJlc2VuY2UiLCAibWFyZ2luIiwgImhBbGlnbiIpOwogICAgc2V0TWluTWF4RGltZW5zaW9ucyh0aGlzLCBzdHlsZSk7CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFGaWVsZCJdOwogICAgaWYgKHRoaXMuZm9udCkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYUZvbnQiKTsKICAgIH0KICAgIGlmIChpc1ByaW50T25seSh0aGlzKSkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgc3R5bGUsCiAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICBjbGFzczogY2xhc3NOYW1lcwogICAgfTsKICAgIGlmIChzdHlsZS5tYXJnaW4pIHsKICAgICAgc3R5bGUucGFkZGluZyA9IHN0eWxlLm1hcmdpbjsKICAgICAgZGVsZXRlIHN0eWxlLm1hcmdpbjsKICAgIH0KICAgIHNldEFjY2Vzcyh0aGlzLCBjbGFzc05hbWVzKTsKICAgIGlmICh0aGlzLm5hbWUpIHsKICAgICAgYXR0cmlidXRlcy54ZmFOYW1lID0gdGhpcy5uYW1lOwogICAgfQogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBjaGlsZHJlbgogICAgfTsKICAgIGFwcGx5QXNzaXN0KHRoaXMsIGF0dHJpYnV0ZXMpOwogICAgY29uc3QgYm9yZGVyU3R5bGUgPSB0aGlzLmJvcmRlciA/IHRoaXMuYm9yZGVyWyR0b1N0eWxlXSgpIDogbnVsbDsKICAgIGNvbnN0IGJib3ggPSBjb21wdXRlQmJveCh0aGlzLCBodG1sLCBhdmFpbGFibGVTcGFjZSk7CiAgICBjb25zdCB1aSA9IHRoaXMudWlbJHRvSFRNTF0oKS5odG1sOwogICAgaWYgKCF1aSkgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCBib3JkZXJTdHlsZSk7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgICB9CiAgICBpZiAodGhpc1skdGFiSW5kZXhdKSB7CiAgICAgIGlmICh1aS5jaGlsZHJlbj8uWzBdKSB7CiAgICAgICAgdWkuY2hpbGRyZW5bMF0uYXR0cmlidXRlcy50YWJpbmRleCA9IHRoaXNbJHRhYkluZGV4XTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1aS5hdHRyaWJ1dGVzLnRhYmluZGV4ID0gdGhpc1skdGFiSW5kZXhdOwogICAgICB9CiAgICB9CiAgICB1aS5hdHRyaWJ1dGVzLnN0eWxlIHx8PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbGV0IGFFbGVtZW50ID0gbnVsbDsKICAgIGlmICh0aGlzLnVpLmJ1dHRvbikgewogICAgICBpZiAodWkuY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgICAgW2FFbGVtZW50XSA9IHVpLmNoaWxkcmVuLnNwbGljZSgwLCAxKTsKICAgICAgfQogICAgICBPYmplY3QuYXNzaWduKHVpLmF0dHJpYnV0ZXMuc3R5bGUsIGJvcmRlclN0eWxlKTsKICAgIH0gZWxzZSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIGJvcmRlclN0eWxlKTsKICAgIH0KICAgIGNoaWxkcmVuLnB1c2godWkpOwogICAgaWYgKHRoaXMudmFsdWUpIHsKICAgICAgaWYgKHRoaXMudWkuaW1hZ2VFZGl0KSB7CiAgICAgICAgdWkuY2hpbGRyZW4ucHVzaCh0aGlzLnZhbHVlWyR0b0hUTUxdKCkuaHRtbCk7CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMudWkuYnV0dG9uKSB7CiAgICAgICAgbGV0IHZhbHVlID0gIiI7CiAgICAgICAgaWYgKHRoaXMudmFsdWUuZXhEYXRhKSB7CiAgICAgICAgICB2YWx1ZSA9IHRoaXMudmFsdWUuZXhEYXRhWyR0ZXh0XSgpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy52YWx1ZS50ZXh0KSB7CiAgICAgICAgICB2YWx1ZSA9IHRoaXMudmFsdWUudGV4dFskZ2V0RXh0cmFdKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGh0bWxWYWx1ZSA9IHRoaXMudmFsdWVbJHRvSFRNTF0oKS5odG1sOwogICAgICAgICAgaWYgKGh0bWxWYWx1ZSAhPT0gbnVsbCkgewogICAgICAgICAgICB2YWx1ZSA9IGh0bWxWYWx1ZS5jaGlsZHJlblswXS52YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudWkudGV4dEVkaXQgJiYgdGhpcy52YWx1ZS50ZXh0Py5tYXhDaGFycykgewogICAgICAgICAgdWkuY2hpbGRyZW5bMF0uYXR0cmlidXRlcy5tYXhMZW5ndGggPSB0aGlzLnZhbHVlLnRleHQubWF4Q2hhcnM7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgaWYgKHRoaXMudWkubnVtZXJpY0VkaXQpIHsKICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTsKICAgICAgICAgICAgdmFsdWUgPSBpc05hTih2YWx1ZSkgPyAiIiA6IHZhbHVlLnRvU3RyaW5nKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodWkuY2hpbGRyZW5bMF0ubmFtZSA9PT0gInRleHRhcmVhIikgewogICAgICAgICAgICB1aS5jaGlsZHJlblswXS5hdHRyaWJ1dGVzLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aS5jaGlsZHJlblswXS5hdHRyaWJ1dGVzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMudWkuaW1hZ2VFZGl0ICYmIHVpLmNoaWxkcmVuPy5bMF0gJiYgdGhpcy5oKSB7CiAgICAgIGJvcmRlckRpbXMgPSBib3JkZXJEaW1zIHx8IGdldEJvcmRlckRpbXModGhpcy51aVskZ2V0RXh0cmFdKCkpOwogICAgICBsZXQgY2FwdGlvbkhlaWdodCA9IDA7CiAgICAgIGlmICh0aGlzLmNhcHRpb24gJiYgWyJ0b3AiLCAiYm90dG9tIl0uaW5jbHVkZXModGhpcy5jYXB0aW9uLnBsYWNlbWVudCkpIHsKICAgICAgICBjYXB0aW9uSGVpZ2h0ID0gdGhpcy5jYXB0aW9uLnJlc2VydmU7CiAgICAgICAgaWYgKGNhcHRpb25IZWlnaHQgPD0gMCkgewogICAgICAgICAgY2FwdGlvbkhlaWdodCA9IHRoaXMuY2FwdGlvblskZ2V0RXh0cmFdKGF2YWlsYWJsZVNwYWNlKS5oOwogICAgICAgIH0KICAgICAgICBjb25zdCBpbnB1dEhlaWdodCA9IHRoaXMuaCAtIGNhcHRpb25IZWlnaHQgLSBtYXJnaW5WIC0gYm9yZGVyRGltcy5oOwogICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMuc3R5bGUuaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKGlucHV0SGVpZ2h0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1aS5jaGlsZHJlblswXS5hdHRyaWJ1dGVzLnN0eWxlLmhlaWdodCA9ICIxMDAlIjsKICAgICAgfQogICAgfQogICAgaWYgKGFFbGVtZW50KSB7CiAgICAgIHVpLmNoaWxkcmVuLnB1c2goYUVsZW1lbnQpOwogICAgfQogICAgaWYgKCFjYXB0aW9uKSB7CiAgICAgIGlmICh1aS5hdHRyaWJ1dGVzLmNsYXNzKSB7CiAgICAgICAgdWkuYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFMZWZ0Iik7CiAgICAgIH0KICAgICAgdGhpcy53ID0gc2F2ZWRXOwogICAgICB0aGlzLmggPSBzYXZlZEg7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgICB9CiAgICBpZiAodGhpcy51aS5idXR0b24pIHsKICAgICAgaWYgKHN0eWxlLnBhZGRpbmcpIHsKICAgICAgICBkZWxldGUgc3R5bGUucGFkZGluZzsKICAgICAgfQogICAgICBpZiAoY2FwdGlvbi5uYW1lID09PSAiZGl2IikgewogICAgICAgIGNhcHRpb24ubmFtZSA9ICJzcGFuIjsKICAgICAgfQogICAgICB1aS5jaGlsZHJlbi5wdXNoKGNhcHRpb24pOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGh0bWwsIGJib3gpOwogICAgfSBlbHNlIGlmICh0aGlzLnVpLmNoZWNrQnV0dG9uKSB7CiAgICAgIGNhcHRpb24uYXR0cmlidXRlcy5jbGFzc1swXSA9ICJ4ZmFDYXB0aW9uRm9yQ2hlY2tCdXR0b24iOwogICAgfQogICAgdWkuYXR0cmlidXRlcy5jbGFzcyB8fD0gW107CiAgICB1aS5jaGlsZHJlbi5zcGxpY2UoMCwgMCwgY2FwdGlvbik7CiAgICBzd2l0Y2ggKHRoaXMuY2FwdGlvbi5wbGFjZW1lbnQpIHsKICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgdWkuYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFMZWZ0Iik7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYVJpZ2h0Iik7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgdWkuYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFUb3AiKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYUJvdHRvbSIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJpbmxpbmUiOgogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhTGVmdCIpOwogICAgICAgIGJyZWFrOwogICAgfQogICAgdGhpcy53ID0gc2F2ZWRXOwogICAgdGhpcy5oID0gc2F2ZWRIOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjcmVhdGVXcmFwcGVyKHRoaXMsIGh0bWwpLCBiYm94KTsKICB9Cn0KY2xhc3MgRmlsbCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmaWxsIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmxpbmVhciA9IG51bGw7CiAgICB0aGlzLnBhdHRlcm4gPSBudWxsOwogICAgdGhpcy5yYWRpYWwgPSBudWxsOwogICAgdGhpcy5zb2xpZCA9IG51bGw7CiAgICB0aGlzLnN0aXBwbGUgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgY29uc3QgZ3JhbmRwYSA9IHBhcmVudFskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgZ2dyYW5kcGEgPSBncmFuZHBhWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgcHJvcE5hbWUgPSAiY29sb3IiOwogICAgbGV0IGFsdFByb3BOYW1lID0gcHJvcE5hbWU7CiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgQm9yZGVyKSB7CiAgICAgIHByb3BOYW1lID0gImJhY2tncm91bmQtY29sb3IiOwogICAgICBhbHRQcm9wTmFtZSA9ICJiYWNrZ3JvdW5kIjsKICAgICAgaWYgKGdncmFuZHBhIGluc3RhbmNlb2YgVWkpIHsKICAgICAgICBzdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAid2hpdGUiOwogICAgICB9CiAgICB9CiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgUmVjdGFuZ2xlIHx8IHBhcmVudCBpbnN0YW5jZW9mIEFyYykgewogICAgICBwcm9wTmFtZSA9IGFsdFByb3BOYW1lID0gImZpbGwiOwogICAgICBzdHlsZS5maWxsID0gIndoaXRlIjsKICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBpZiAobmFtZSA9PT0gImV4dHJhcyIgfHwgbmFtZSA9PT0gImNvbG9yIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIFhGQU9iamVjdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBjb2xvciA9IG9ialskdG9TdHlsZV0odGhpcy5jb2xvcik7CiAgICAgIGlmIChjb2xvcikgewogICAgICAgIHN0eWxlW2NvbG9yLnN0YXJ0c1dpdGgoIiMiKSA/IHByb3BOYW1lIDogYWx0UHJvcE5hbWVdID0gY29sb3I7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0eWxlOwogICAgfQogICAgaWYgKHRoaXMuY29sb3I/LnZhbHVlKSB7CiAgICAgIGNvbnN0IGNvbG9yID0gdGhpcy5jb2xvclskdG9TdHlsZV0oKTsKICAgICAgc3R5bGVbY29sb3Iuc3RhcnRzV2l0aCgiIyIpID8gcHJvcE5hbWUgOiBhbHRQcm9wTmFtZV0gPSBjb2xvcjsKICAgIH0KICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgRmlsdGVyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImZpbHRlciIsIHRydWUpOwogICAgdGhpcy5hZGRSZXZvY2F0aW9uSW5mbyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFkZFJldm9jYXRpb25JbmZvLCBbIiIsICJyZXF1aXJlZCIsICJvcHRpb25hbCIsICJub25lIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy52ZXJzaW9uID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IHRoaXMudmVyc2lvbiwKICAgICAgZGVmYXVsdFZhbHVlOiA1LAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDEgJiYgeCA8PSA1CiAgICB9KTsKICAgIHRoaXMuYXBwZWFyYW5jZUZpbHRlciA9IG51bGw7CiAgICB0aGlzLmNlcnRpZmljYXRlcyA9IG51bGw7CiAgICB0aGlzLmRpZ2VzdE1ldGhvZHMgPSBudWxsOwogICAgdGhpcy5lbmNvZGluZ3MgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0aW9uTWV0aG9kcyA9IG51bGw7CiAgICB0aGlzLmhhbmRsZXIgPSBudWxsOwogICAgdGhpcy5sb2NrRG9jdW1lbnQgPSBudWxsOwogICAgdGhpcy5tZHAgPSBudWxsOwogICAgdGhpcy5yZWFzb25zID0gbnVsbDsKICAgIHRoaXMudGltZVN0YW1wID0gbnVsbDsKICB9Cn0KY2xhc3MgRmxvYXQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImZsb2F0Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgbnVtYmVyID0gcGFyc2VGbG9hdCh0aGlzWyRjb250ZW50XS50cmltKCkpOwogICAgdGhpc1skY29udGVudF0gPSBpc05hTihudW1iZXIpID8gbnVsbCA6IG51bWJlcjsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gIT09IG51bGwgPyB0aGlzWyRjb250ZW50XS50b1N0cmluZygpIDogIiIpOwogIH0KfQpjbGFzcyB0ZW1wbGF0ZV9Gb250IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImZvbnQiLCB0cnVlKTsKICAgIHRoaXMuYmFzZWxpbmVTaGlmdCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuYmFzZWxpbmVTaGlmdCk7CiAgICB0aGlzLmZvbnRIb3Jpem9udGFsU2NhbGUgPSBnZXRGbG9hdCh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZm9udEhvcml6b250YWxTY2FsZSwKICAgICAgZGVmYXVsdFZhbHVlOiAxMDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmZvbnRWZXJ0aWNhbFNjYWxlID0gZ2V0RmxvYXQoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmZvbnRWZXJ0aWNhbFNjYWxlLAogICAgICBkZWZhdWx0VmFsdWU6IDEwMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5rZXJuaW5nTW9kZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmtlcm5pbmdNb2RlLCBbIm5vbmUiLCAicGFpciJdKTsKICAgIHRoaXMubGV0dGVyU3BhY2luZyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubGV0dGVyU3BhY2luZywgIjAiKTsKICAgIHRoaXMubGluZVRocm91Z2ggPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5saW5lVGhyb3VnaCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxIHx8IHggPT09IDIKICAgIH0pOwogICAgdGhpcy5saW5lVGhyb3VnaFBlcmlvZCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmxpbmVUaHJvdWdoUGVyaW9kLCBbImFsbCIsICJ3b3JkIl0pOwogICAgdGhpcy5vdmVybGluZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm92ZXJsaW5lLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEgfHwgeCA9PT0gMgogICAgfSk7CiAgICB0aGlzLm92ZXJsaW5lUGVyaW9kID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3ZlcmxpbmVQZXJpb2QsIFsiYWxsIiwgIndvcmQiXSk7CiAgICB0aGlzLnBvc3R1cmUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wb3N0dXJlLCBbIm5vcm1hbCIsICJpdGFsaWMiXSk7CiAgICB0aGlzLnNpemUgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnNpemUsICIxMHB0Iik7CiAgICB0aGlzLnR5cGVmYWNlID0gYXR0cmlidXRlcy50eXBlZmFjZSB8fCAiQ291cmllciI7CiAgICB0aGlzLnVuZGVybGluZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnVuZGVybGluZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxIHx8IHggPT09IDIKICAgIH0pOwogICAgdGhpcy51bmRlcmxpbmVQZXJpb2QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy51bmRlcmxpbmVQZXJpb2QsIFsiYWxsIiwgIndvcmQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ZWlnaHQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy53ZWlnaHQsIFsibm9ybWFsIiwgImJvbGQiXSk7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZpbGwgPSBudWxsOwogIH0KICBbJGNsZWFuXShidWlsZGVyKSB7CiAgICBzdXBlclskY2xlYW5dKGJ1aWxkZXIpOwogICAgdGhpc1skZ2xvYmFsRGF0YV0udXNlZFR5cGVmYWNlcy5hZGQodGhpcy50eXBlZmFjZSk7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImZpbGwiKTsKICAgIGNvbnN0IGNvbG9yID0gc3R5bGUuY29sb3I7CiAgICBpZiAoY29sb3IpIHsKICAgICAgaWYgKGNvbG9yID09PSAiIzAwMDAwMCIpIHsKICAgICAgICBkZWxldGUgc3R5bGUuY29sb3I7CiAgICAgIH0gZWxzZSBpZiAoIWNvbG9yLnN0YXJ0c1dpdGgoIiMiKSkgewogICAgICAgIHN0eWxlLmJhY2tncm91bmQgPSBjb2xvcjsKICAgICAgICBzdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICJ0ZXh0IjsKICAgICAgICBzdHlsZS5jb2xvciA9ICJ0cmFuc3BhcmVudCI7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLmJhc2VsaW5lU2hpZnQpIHsKICAgICAgc3R5bGUudmVydGljYWxBbGlnbiA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLmJhc2VsaW5lU2hpZnQpOwogICAgfQogICAgc3R5bGUuZm9udEtlcm5pbmcgPSB0aGlzLmtlcm5pbmdNb2RlID09PSAibm9uZSIgPyAibm9uZSIgOiAibm9ybWFsIjsKICAgIHN0eWxlLmxldHRlclNwYWNpbmcgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5sZXR0ZXJTcGFjaW5nKTsKICAgIGlmICh0aGlzLmxpbmVUaHJvdWdoICE9PSAwKSB7CiAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uID0gImxpbmUtdGhyb3VnaCI7CiAgICAgIGlmICh0aGlzLmxpbmVUaHJvdWdoID09PSAyKSB7CiAgICAgICAgc3R5bGUudGV4dERlY29yYXRpb25TdHlsZSA9ICJkb3VibGUiOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5vdmVybGluZSAhPT0gMCkgewogICAgICBzdHlsZS50ZXh0RGVjb3JhdGlvbiA9ICJvdmVybGluZSI7CiAgICAgIGlmICh0aGlzLm92ZXJsaW5lID09PSAyKSB7CiAgICAgICAgc3R5bGUudGV4dERlY29yYXRpb25TdHlsZSA9ICJkb3VibGUiOwogICAgICB9CiAgICB9CiAgICBzdHlsZS5mb250U3R5bGUgPSB0aGlzLnBvc3R1cmU7CiAgICBzdHlsZS5mb250U2l6ZSA9IG1lYXN1cmVUb1N0cmluZygwLjk5ICogdGhpcy5zaXplKTsKICAgIHNldEZvbnRGYW1pbHkodGhpcywgdGhpcywgdGhpc1skZ2xvYmFsRGF0YV0uZm9udEZpbmRlciwgc3R5bGUpOwogICAgaWYgKHRoaXMudW5kZXJsaW5lICE9PSAwKSB7CiAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uID0gInVuZGVybGluZSI7CiAgICAgIGlmICh0aGlzLnVuZGVybGluZSA9PT0gMikgewogICAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uU3R5bGUgPSAiZG91YmxlIjsKICAgICAgfQogICAgfQogICAgc3R5bGUuZm9udFdlaWdodCA9IHRoaXMud2VpZ2h0OwogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBGb3JtYXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZm9ybWF0IiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogIH0KfQpjbGFzcyBIYW5kbGVyIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImhhbmRsZXIiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEh5cGhlbmF0aW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImh5cGhlbmF0aW9uIik7CiAgICB0aGlzLmV4Y2x1ZGVBbGxDYXBzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZXhjbHVkZUFsbENhcHMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmV4Y2x1ZGVJbml0aWFsQ2FwID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZXhjbHVkZUluaXRpYWxDYXAsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmh5cGhlbmF0ZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmh5cGhlbmF0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wdXNoQ2hhcmFjdGVyQ291bnQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5wdXNoQ2hhcmFjdGVyQ291bnQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMywKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMucmVtYWluQ2hhcmFjdGVyQ291bnQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5yZW1haW5DaGFyYWN0ZXJDb3VudCwKICAgICAgZGVmYXVsdFZhbHVlOiAzLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMud29yZENoYXJhY3RlckNvdW50ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMud29yZENoYXJhY3RlckNvdW50LAogICAgICBkZWZhdWx0VmFsdWU6IDcsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgfQp9CmNsYXNzIEltYWdlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImltYWdlIik7CiAgICB0aGlzLmFzcGVjdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFzcGVjdCwgWyJmaXQiLCAiYWN0dWFsIiwgImhlaWdodCIsICJub25lIiwgIndpZHRoIl0pOwogICAgdGhpcy5jb250ZW50VHlwZSA9IGF0dHJpYnV0ZXMuY29udGVudFR5cGUgfHwgIiI7CiAgICB0aGlzLmhyZWYgPSBhdHRyaWJ1dGVzLmhyZWYgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudHJhbnNmZXJFbmNvZGluZyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnRyYW5zZmVyRW5jb2RpbmcsIFsiYmFzZTY0IiwgIm5vbmUiLCAicGFja2FnZSJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlICYmICFNSU1FUy5oYXModGhpcy5jb250ZW50VHlwZS50b0xvd2VyQ2FzZSgpKSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGxldCBidWZmZXIgPSB0aGlzWyRnbG9iYWxEYXRhXS5pbWFnZXM/LmdldCh0aGlzLmhyZWYpOwogICAgaWYgKCFidWZmZXIgJiYgKHRoaXMuaHJlZiB8fCAhdGhpc1skY29udGVudF0pKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgaWYgKCFidWZmZXIgJiYgdGhpcy50cmFuc2ZlckVuY29kaW5nID09PSAiYmFzZTY0IikgewogICAgICBidWZmZXIgPSBmcm9tQmFzZTY0VXRpbCh0aGlzWyRjb250ZW50XSk7CiAgICB9CiAgICBpZiAoIWJ1ZmZlcikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGlmICghdGhpcy5jb250ZW50VHlwZSkgewogICAgICBmb3IgKGNvbnN0IFtoZWFkZXIsIHR5cGVdIG9mIElNQUdFU19IRUFERVJTKSB7CiAgICAgICAgaWYgKGJ1ZmZlci5sZW5ndGggPiBoZWFkZXIubGVuZ3RoICYmIGhlYWRlci5ldmVyeSgoeCwgaSkgPT4geCA9PT0gYnVmZmVyW2ldKSkgewogICAgICAgICAgdGhpcy5jb250ZW50VHlwZSA9IHR5cGU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmNvbnRlbnRUeXBlKSB7CiAgICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYnVmZmVyXSwgewogICAgICB0eXBlOiB0aGlzLmNvbnRlbnRUeXBlCiAgICB9KTsKICAgIGxldCBzdHlsZTsKICAgIHN3aXRjaCAodGhpcy5hc3BlY3QpIHsKICAgICAgY2FzZSAiZml0IjoKICAgICAgY2FzZSAiYWN0dWFsIjoKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiaGVpZ2h0IjoKICAgICAgICBzdHlsZSA9IHsKICAgICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgICAgb2JqZWN0Rml0OiAiZmlsbCIKICAgICAgICB9OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJub25lIjoKICAgICAgICBzdHlsZSA9IHsKICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgIG9iamVjdEZpdDogImZpbGwiCiAgICAgICAgfTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAid2lkdGgiOgogICAgICAgIHN0eWxlID0gewogICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgIG9iamVjdEZpdDogImZpbGwiCiAgICAgICAgfTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiaW1nIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYUltYWdlIl0sCiAgICAgICAgc3R5bGUsCiAgICAgICAgc3JjOiBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpLAogICAgICAgIGFsdDogcGFyZW50ID8gYXJpYUxhYmVsKHBhcmVudFskZ2V0UGFyZW50XSgpKSA6IG51bGwKICAgICAgfQogICAgfSk7CiAgfQp9CmNsYXNzIEltYWdlRWRpdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJpbWFnZUVkaXQiLCB0cnVlKTsKICAgIHRoaXMuZGF0YSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmRhdGEsIFsibGluayIsICJlbWJlZCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBpZiAodGhpcy5kYXRhID09PSAiZW1iZWQiKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICAgIG5hbWU6ICJkaXYiLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBhdHRyaWJ1dGVzOiB7fQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogIH0KfQpjbGFzcyBJbnRlZ2VyIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJpbnRlZ2VyIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgbnVtYmVyID0gcGFyc2VJbnQodGhpc1skY29udGVudF0udHJpbSgpLCAxMCk7CiAgICB0aGlzWyRjb250ZW50XSA9IGlzTmFOKG51bWJlcikgPyBudWxsIDogbnVtYmVyOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiB2YWx1ZVRvSHRtbCh0aGlzWyRjb250ZW50XSAhPT0gbnVsbCA/IHRoaXNbJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIElzc3VlcnMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaXNzdWVycyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY2VydGlmaWNhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgSXRlbXMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaXRlbXMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnNhdmUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zYXZlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIGNvbnN0IG91dHB1dCA9IFtdOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzWyRnZXRDaGlsZHJlbl0oKSkgewogICAgICBvdXRwdXQucHVzaChjaGlsZFskdGV4dF0oKSk7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKG91dHB1dCk7CiAgfQp9CmNsYXNzIEtlZXAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAia2VlcCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICBjb25zdCBvcHRpb25zID0gWyJub25lIiwgImNvbnRlbnRBcmVhIiwgInBhZ2VBcmVhIl07CiAgICB0aGlzLmludGFjdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmludGFjdCwgb3B0aW9ucyk7CiAgICB0aGlzLm5leHQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uZXh0LCBvcHRpb25zKTsKICAgIHRoaXMucHJldmlvdXMgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmV2aW91cywgb3B0aW9ucyk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KfQpjbGFzcyBLZXlVc2FnZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJrZXlVc2FnZSIpOwogICAgY29uc3Qgb3B0aW9ucyA9IFsiIiwgInllcyIsICJubyJdOwogICAgdGhpcy5jcmxTaWduID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuY3JsU2lnbiwgb3B0aW9ucyk7CiAgICB0aGlzLmRhdGFFbmNpcGhlcm1lbnQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5kYXRhRW5jaXBoZXJtZW50LCBvcHRpb25zKTsKICAgIHRoaXMuZGVjaXBoZXJPbmx5ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZGVjaXBoZXJPbmx5LCBvcHRpb25zKTsKICAgIHRoaXMuZGlnaXRhbFNpZ25hdHVyZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmRpZ2l0YWxTaWduYXR1cmUsIG9wdGlvbnMpOwogICAgdGhpcy5lbmNpcGhlck9ubHkgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5lbmNpcGhlck9ubHksIG9wdGlvbnMpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmtleUFncmVlbWVudCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmtleUFncmVlbWVudCwgb3B0aW9ucyk7CiAgICB0aGlzLmtleUNlcnRTaWduID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMua2V5Q2VydFNpZ24sIG9wdGlvbnMpOwogICAgdGhpcy5rZXlFbmNpcGhlcm1lbnQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5rZXlFbmNpcGhlcm1lbnQsIG9wdGlvbnMpOwogICAgdGhpcy5ub25SZXB1ZGlhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm5vblJlcHVkaWF0aW9uLCBvcHRpb25zKTsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBMaW5lIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImxpbmUiLCB0cnVlKTsKICAgIHRoaXMuaGFuZCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhhbmQsIFsiZXZlbiIsICJsZWZ0IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnNsb3BlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc2xvcGUsIFsiXFwiLCAiLyJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVkZ2UgPSBudWxsOwogIH0KICBbJHRvSFRNTF0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGVkZ2UgPSB0aGlzLmVkZ2UgfHwgbmV3IEVkZ2Uoe30pOwogICAgY29uc3QgZWRnZVN0eWxlID0gZWRnZVskdG9TdHlsZV0oKTsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbnN0IHRoaWNrbmVzcyA9IGVkZ2UucHJlc2VuY2UgPT09ICJ2aXNpYmxlIiA/IGVkZ2UudGhpY2tuZXNzIDogMDsKICAgIHN0eWxlLnN0cm9rZVdpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHRoaWNrbmVzcyk7CiAgICBzdHlsZS5zdHJva2UgPSBlZGdlU3R5bGUuY29sb3I7CiAgICBsZXQgeDEsIHkxLCB4MiwgeTI7CiAgICBsZXQgd2lkdGggPSAiMTAwJSI7CiAgICBsZXQgaGVpZ2h0ID0gIjEwMCUiOwogICAgaWYgKHBhcmVudC53IDw9IHRoaWNrbmVzcykgewogICAgICBbeDEsIHkxLCB4MiwgeTJdID0gWyI1MCUiLCAwLCAiNTAlIiwgIjEwMCUiXTsKICAgICAgd2lkdGggPSBzdHlsZS5zdHJva2VXaWR0aDsKICAgIH0gZWxzZSBpZiAocGFyZW50LmggPD0gdGhpY2tuZXNzKSB7CiAgICAgIFt4MSwgeTEsIHgyLCB5Ml0gPSBbMCwgIjUwJSIsICIxMDAlIiwgIjUwJSJdOwogICAgICBoZWlnaHQgPSBzdHlsZS5zdHJva2VXaWR0aDsKICAgIH0gZWxzZSBpZiAodGhpcy5zbG9wZSA9PT0gIlxcIikgewogICAgICBbeDEsIHkxLCB4MiwgeTJdID0gWzAsIDAsICIxMDAlIiwgIjEwMCUiXTsKICAgIH0gZWxzZSB7CiAgICAgIFt4MSwgeTEsIHgyLCB5Ml0gPSBbMCwgIjEwMCUiLCAiMTAwJSIsIDBdOwogICAgfQogICAgY29uc3QgbGluZSA9IHsKICAgICAgbmFtZTogImxpbmUiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgICB4MSwKICAgICAgICB5MSwKICAgICAgICB4MiwKICAgICAgICB5MiwKICAgICAgICBzdHlsZQogICAgICB9CiAgICB9OwogICAgY29uc3Qgc3ZnID0gewogICAgICBuYW1lOiAic3ZnIiwKICAgICAgY2hpbGRyZW46IFtsaW5lXSwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBvdmVyZmxvdzogInZpc2libGUiCiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgaWYgKGhhc01hcmdpbihwYXJlbnQpKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICAgIG5hbWU6ICJkaXYiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUiLAogICAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2hpbGRyZW46IFtzdmddCiAgICAgIH0pOwogICAgfQogICAgc3ZnLmF0dHJpYnV0ZXMuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhzdmcpOwogIH0KfQpjbGFzcyBMaW5lYXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibGluZWFyIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsidG9SaWdodCIsICJ0b0JvdHRvbSIsICJ0b0xlZnQiLCAidG9Ub3AiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oc3RhcnRDb2xvcikgewogICAgc3RhcnRDb2xvciA9IHN0YXJ0Q29sb3IgPyBzdGFydENvbG9yWyR0b1N0eWxlXSgpIDogIiNGRkZGRkYiOwogICAgY29uc3QgdHJhbnNmID0gdGhpcy50eXBlLnJlcGxhY2UoLyhbUkJMVF0pLywgIiAkMSIpLnRvTG93ZXJDYXNlKCk7CiAgICBjb25zdCBlbmRDb2xvciA9IHRoaXMuY29sb3IgPyB0aGlzLmNvbG9yWyR0b1N0eWxlXSgpIDogIiMwMDAwMDAiOwogICAgcmV0dXJuIGBsaW5lYXItZ3JhZGllbnQoJHt0cmFuc2Z9LCAke3N0YXJ0Q29sb3J9LCAke2VuZENvbG9yfSlgOwogIH0KfQpjbGFzcyBMb2NrRG9jdW1lbnQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImxvY2tEb2N1bWVudCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IGdldFN0cmluZ09wdGlvbih0aGlzWyRjb250ZW50XSwgWyJhdXRvIiwgIjAiLCAiMSJdKTsKICB9Cn0KY2xhc3MgTWFuaWZlc3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibWFuaWZlc3QiLCB0cnVlKTsKICAgIHRoaXMuYWN0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYWN0aW9uLCBbImluY2x1ZGUiLCAiYWxsIiwgImV4Y2x1ZGUiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnJlZiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBNYXJnaW4gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibWFyZ2luIiwgdHJ1ZSk7CiAgICB0aGlzLmJvdHRvbUluc2V0ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5ib3R0b21JbnNldCwgIjAiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWZ0SW5zZXQgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmxlZnRJbnNldCwgIjAiKTsKICAgIHRoaXMucmlnaHRJbnNldCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMucmlnaHRJbnNldCwgIjAiKTsKICAgIHRoaXMudG9wSW5zZXQgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnRvcEluc2V0LCAiMCIpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIHJldHVybiB7CiAgICAgIG1hcmdpbjogbWVhc3VyZVRvU3RyaW5nKHRoaXMudG9wSW5zZXQpICsgIiAiICsgbWVhc3VyZVRvU3RyaW5nKHRoaXMucmlnaHRJbnNldCkgKyAiICIgKyBtZWFzdXJlVG9TdHJpbmcodGhpcy5ib3R0b21JbnNldCkgKyAiICIgKyBtZWFzdXJlVG9TdHJpbmcodGhpcy5sZWZ0SW5zZXQpCiAgICB9OwogIH0KfQpjbGFzcyBNZHAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibWRwIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucGVybWlzc2lvbnMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5wZXJtaXNzaW9ucywKICAgICAgZGVmYXVsdFZhbHVlOiAyLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxIHx8IHggPT09IDMKICAgIH0pOwogICAgdGhpcy5zaWduYXR1cmVUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc2lnbmF0dXJlVHlwZSwgWyJmaWxsZXIiLCAiYXV0aG9yIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgTWVkaXVtIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm1lZGl1bSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmltYWdpbmdCQm94ID0gZ2V0QkJveChhdHRyaWJ1dGVzLmltYWdpbmdCQm94KTsKICAgIHRoaXMubG9uZyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubG9uZyk7CiAgICB0aGlzLm9yaWVudGF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3JpZW50YXRpb24sIFsicG9ydHJhaXQiLCAibGFuZHNjYXBlIl0pOwogICAgdGhpcy5zaG9ydCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuc2hvcnQpOwogICAgdGhpcy5zdG9jayA9IGF0dHJpYnV0ZXMuc3RvY2sgfHwgIiI7CiAgICB0aGlzLnRyYXlJbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnRyYXlJbiwgWyJhdXRvIiwgImRlbGVnYXRlIiwgInBhZ2VGcm9udCJdKTsKICAgIHRoaXMudHJheU91dCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnRyYXlPdXQsIFsiYXV0byIsICJkZWxlZ2F0ZSJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIE1lc3NhZ2UgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibWVzc2FnZSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy50ZXh0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE51bWVyaWNFZGl0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm51bWVyaWNFZGl0IiwgdHJ1ZSk7CiAgICB0aGlzLmhTY3JvbGxQb2xpY3kgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oU2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jb21iID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImJvcmRlciIsICJmb250IiwgIm1hcmdpbiIpOwogICAgY29uc3QgZmllbGQgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJpbnB1dCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgZmllbGRJZDogZmllbGRbJHVpZF0sCiAgICAgICAgZGF0YUlkOiBmaWVsZFskZGF0YV0/LlskdWlkXSB8fCBmaWVsZFskdWlkXSwKICAgICAgICBjbGFzczogWyJ4ZmFUZXh0ZmllbGQiXSwKICAgICAgICBzdHlsZSwKICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgICB9CiAgICB9OwogICAgaWYgKGlzUmVxdWlyZWQoZmllbGQpKSB7CiAgICAgIGh0bWwuYXR0cmlidXRlc1siYXJpYS1yZXF1aXJlZCJdID0gdHJ1ZTsKICAgICAgaHRtbC5hdHRyaWJ1dGVzLnJlcXVpcmVkID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2h0bWxdCiAgICB9KTsKICB9Cn0KY2xhc3MgT2NjdXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAib2NjdXIiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbml0aWFsID0gYXR0cmlidXRlcy5pbml0aWFsICE9PSAiIiA/IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmluaXRpYWwsCiAgICAgIGRlZmF1bHRWYWx1ZTogIiIsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pIDogIiI7CiAgICB0aGlzLm1heCA9IGF0dHJpYnV0ZXMubWF4ICE9PSAiIiA/IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1heCwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KSA6ICIiOwogICAgdGhpcy5taW4gPSBhdHRyaWJ1dGVzLm1pbiAhPT0gIiIgPyBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5taW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSkgOiAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskY2xlYW5dKCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgY29uc3Qgb3JpZ2luYWxNaW4gPSB0aGlzLm1pbjsKICAgIGlmICh0aGlzLm1pbiA9PT0gIiIpIHsKICAgICAgdGhpcy5taW4gPSBwYXJlbnQgaW5zdGFuY2VvZiBQYWdlQXJlYSB8fCBwYXJlbnQgaW5zdGFuY2VvZiBQYWdlU2V0ID8gMCA6IDE7CiAgICB9CiAgICBpZiAodGhpcy5tYXggPT09ICIiKSB7CiAgICAgIGlmIChvcmlnaW5hbE1pbiA9PT0gIiIpIHsKICAgICAgICB0aGlzLm1heCA9IHBhcmVudCBpbnN0YW5jZW9mIFBhZ2VBcmVhIHx8IHBhcmVudCBpbnN0YW5jZW9mIFBhZ2VTZXQgPyAtMSA6IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5tYXggPSB0aGlzLm1pbjsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMubWF4ICE9PSAtMSAmJiB0aGlzLm1heCA8IHRoaXMubWluKSB7CiAgICAgIHRoaXMubWF4ID0gdGhpcy5taW47CiAgICB9CiAgICBpZiAodGhpcy5pbml0aWFsID09PSAiIikgewogICAgICB0aGlzLmluaXRpYWwgPSBwYXJlbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZSA/IDEgOiB0aGlzLm1pbjsKICAgIH0KICB9Cn0KY2xhc3MgT2lkIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm9pZCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBPaWRzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm9pZHMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLm9pZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBPdmVyZmxvdyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJvdmVyZmxvdyIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxlYWRlciA9IGF0dHJpYnV0ZXMubGVhZGVyIHx8ICIiOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudHJhaWxlciA9IGF0dHJpYnV0ZXMudHJhaWxlciB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZ2V0RXh0cmFdKCkgewogICAgaWYgKCF0aGlzWyRleHRyYV0pIHsKICAgICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgICBjb25zdCByb290ID0gdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpOwogICAgICBjb25zdCB0YXJnZXQgPSByb290WyRzZWFyY2hOb2RlXSh0aGlzLnRhcmdldCwgcGFyZW50KTsKICAgICAgY29uc3QgbGVhZGVyID0gcm9vdFskc2VhcmNoTm9kZV0odGhpcy5sZWFkZXIsIHBhcmVudCk7CiAgICAgIGNvbnN0IHRyYWlsZXIgPSByb290WyRzZWFyY2hOb2RlXSh0aGlzLnRyYWlsZXIsIHBhcmVudCk7CiAgICAgIHRoaXNbJGV4dHJhXSA9IHsKICAgICAgICB0YXJnZXQ6IHRhcmdldD8uWzBdIHx8IG51bGwsCiAgICAgICAgbGVhZGVyOiBsZWFkZXI/LlswXSB8fCBudWxsLAogICAgICAgIHRyYWlsZXI6IHRyYWlsZXI/LlswXSB8fCBudWxsLAogICAgICAgIGFkZExlYWRlcjogZmFsc2UsCiAgICAgICAgYWRkVHJhaWxlcjogZmFsc2UKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB0aGlzWyRleHRyYV07CiAgfQp9CmNsYXNzIFBhZ2VBcmVhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInBhZ2VBcmVhIiwgdHJ1ZSk7CiAgICB0aGlzLmJsYW5rT3JOb3RCbGFuayA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmJsYW5rT3JOb3RCbGFuaywgWyJhbnkiLCAiYmxhbmsiLCAibm90QmxhbmsiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuaW5pdGlhbE51bWJlciA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmluaXRpYWxOdW1iZXIsCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLm51bWJlcmVkID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubnVtYmVyZWQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLm9kZE9yRXZlbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm9kZE9yRXZlbiwgWyJhbnkiLCAiZXZlbiIsICJvZGQiXSk7CiAgICB0aGlzLnBhZ2VQb3NpdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnBhZ2VQb3NpdGlvbiwgWyJhbnkiLCAiZmlyc3QiLCAibGFzdCIsICJvbmx5IiwgInJlc3QiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWVkaXVtID0gbnVsbDsKICAgIHRoaXMub2NjdXIgPSBudWxsOwogICAgdGhpcy5hcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbnRlbnRBcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRyYXcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhjbEdyb3VwID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZpZWxkID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRpc1VzYWJsZV0oKSB7CiAgICBpZiAoIXRoaXNbJGV4dHJhXSkgewogICAgICB0aGlzWyRleHRyYV0gPSB7CiAgICAgICAgbnVtYmVyT2ZVc2U6IDAKICAgICAgfTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gIXRoaXMub2NjdXIgfHwgdGhpcy5vY2N1ci5tYXggPT09IC0xIHx8IHRoaXNbJGV4dHJhXS5udW1iZXJPZlVzZSA8IHRoaXMub2NjdXIubWF4OwogIH0KICBbJGNsZWFuUGFnZV0oKSB7CiAgICBkZWxldGUgdGhpc1skZXh0cmFdOwogIH0KICBbJGdldE5leHRQYWdlXSgpIHsKICAgIHRoaXNbJGV4dHJhXSB8fD0gewogICAgICBudW1iZXJPZlVzZTogMAogICAgfTsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQucmVsYXRpb24gPT09ICJvcmRlcmVkT2NjdXJyZW5jZSIpIHsKICAgICAgaWYgKHRoaXNbJGlzVXNhYmxlXSgpKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm51bWJlck9mVXNlICs9IDE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwYXJlbnRbJGdldE5leHRQYWdlXSgpOwogIH0KICBbJGdldEF2YWlsYWJsZVNwYWNlXSgpIHsKICAgIHJldHVybiB0aGlzWyRleHRyYV0uc3BhY2UgfHwgewogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwCiAgICB9OwogIH0KICBbJHRvSFRNTF0oKSB7CiAgICB0aGlzWyRleHRyYV0gfHw9IHsKICAgICAgbnVtYmVyT2ZVc2U6IDEKICAgIH07CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgdGhpc1skZXh0cmFdLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAodGhpcy5tZWRpdW0gJiYgdGhpcy5tZWRpdW0uc2hvcnQgJiYgdGhpcy5tZWRpdW0ubG9uZykgewogICAgICBzdHlsZS53aWR0aCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLm1lZGl1bS5zaG9ydCk7CiAgICAgIHN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLm1lZGl1bS5sb25nKTsKICAgICAgdGhpc1skZXh0cmFdLnNwYWNlID0gewogICAgICAgIHdpZHRoOiB0aGlzLm1lZGl1bS5zaG9ydCwKICAgICAgICBoZWlnaHQ6IHRoaXMubWVkaXVtLmxvbmcKICAgICAgfTsKICAgICAgaWYgKHRoaXMubWVkaXVtLm9yaWVudGF0aW9uID09PSAibGFuZHNjYXBlIikgewogICAgICAgIGNvbnN0IHggPSBzdHlsZS53aWR0aDsKICAgICAgICBzdHlsZS53aWR0aCA9IHN0eWxlLmhlaWdodDsKICAgICAgICBzdHlsZS5oZWlnaHQgPSB4OwogICAgICAgIHRoaXNbJGV4dHJhXS5zcGFjZSA9IHsKICAgICAgICAgIHdpZHRoOiB0aGlzLm1lZGl1bS5sb25nLAogICAgICAgICAgaGVpZ2h0OiB0aGlzLm1lZGl1bS5zaG9ydAogICAgICAgIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oIlhGQSAtIE5vIG1lZGl1bSBzcGVjaWZpZWQgaW4gcGFnZUFyZWE6IHBsZWFzZSBmaWxlIGEgYnVnLiIpOwogICAgfQogICAgdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgZmlsdGVyOiBuZXcgU2V0KFsiYXJlYSIsICJkcmF3IiwgImZpZWxkIiwgInN1YmZvcm0iXSksCiAgICAgIGluY2x1ZGU6IHRydWUKICAgIH0pOwogICAgdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgZmlsdGVyOiBuZXcgU2V0KFsiY29udGVudEFyZWEiXSksCiAgICAgIGluY2x1ZGU6IHRydWUKICAgIH0pOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBjaGlsZHJlbiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYVBhZ2UiXSwKICAgICAgICBpZDogdGhpc1skdWlkXSwKICAgICAgICBzdHlsZSwKICAgICAgICB4ZmFOYW1lOiB0aGlzLm5hbWUKICAgICAgfQogICAgfSk7CiAgfQp9CmNsYXNzIFBhZ2VTZXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFnZVNldCIsIHRydWUpOwogICAgdGhpcy5kdXBsZXhJbXBvc2l0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZHVwbGV4SW1wb3NpdGlvbiwgWyJsb25nRWRnZSIsICJzaG9ydEVkZ2UiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVsYXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5yZWxhdGlvbiwgWyJvcmRlcmVkT2NjdXJyZW5jZSIsICJkdXBsZXhQYWdpbmF0ZWQiLCAic2ltcGxleFBhZ2luYXRlZCJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm9jY3VyID0gbnVsbDsKICAgIHRoaXMucGFnZUFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFnZVNldCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGNsZWFuUGFnZV0oKSB7CiAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgdGhpcy5wYWdlQXJlYS5jaGlsZHJlbikgewogICAgICBwYWdlWyRjbGVhblBhZ2VdKCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgdGhpcy5wYWdlU2V0LmNoaWxkcmVuKSB7CiAgICAgIHBhZ2VbJGNsZWFuUGFnZV0oKTsKICAgIH0KICB9CiAgWyRpc1VzYWJsZV0oKSB7CiAgICByZXR1cm4gIXRoaXMub2NjdXIgfHwgdGhpcy5vY2N1ci5tYXggPT09IC0xIHx8IHRoaXNbJGV4dHJhXS5udW1iZXJPZlVzZSA8IHRoaXMub2NjdXIubWF4OwogIH0KICBbJGdldE5leHRQYWdlXSgpIHsKICAgIHRoaXNbJGV4dHJhXSB8fD0gewogICAgICBudW1iZXJPZlVzZTogMSwKICAgICAgcGFnZUluZGV4OiAtMSwKICAgICAgcGFnZVNldEluZGV4OiAtMQogICAgfTsKICAgIGlmICh0aGlzLnJlbGF0aW9uID09PSAib3JkZXJlZE9jY3VycmVuY2UiKSB7CiAgICAgIGlmICh0aGlzWyRleHRyYV0ucGFnZUluZGV4ICsgMSA8IHRoaXMucGFnZUFyZWEuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLnBhZ2VJbmRleCArPSAxOwogICAgICAgIGNvbnN0IHBhZ2VBcmVhID0gdGhpcy5wYWdlQXJlYS5jaGlsZHJlblt0aGlzWyRleHRyYV0ucGFnZUluZGV4XTsKICAgICAgICByZXR1cm4gcGFnZUFyZWFbJGdldE5leHRQYWdlXSgpOwogICAgICB9CiAgICAgIGlmICh0aGlzWyRleHRyYV0ucGFnZVNldEluZGV4ICsgMSA8IHRoaXMucGFnZVNldC5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICB0aGlzWyRleHRyYV0ucGFnZVNldEluZGV4ICs9IDE7CiAgICAgICAgcmV0dXJuIHRoaXMucGFnZVNldC5jaGlsZHJlblt0aGlzWyRleHRyYV0ucGFnZVNldEluZGV4XVskZ2V0TmV4dFBhZ2VdKCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXNbJGlzVXNhYmxlXSgpKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm51bWJlck9mVXNlICs9IDE7CiAgICAgICAgdGhpc1skZXh0cmFdLnBhZ2VJbmRleCA9IC0xOwogICAgICAgIHRoaXNbJGV4dHJhXS5wYWdlU2V0SW5kZXggPSAtMTsKICAgICAgICByZXR1cm4gdGhpc1skZ2V0TmV4dFBhZ2VdKCk7CiAgICAgIH0KICAgICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgUGFnZVNldCkgewogICAgICAgIHJldHVybiBwYXJlbnRbJGdldE5leHRQYWdlXSgpOwogICAgICB9CiAgICAgIHRoaXNbJGNsZWFuUGFnZV0oKTsKICAgICAgcmV0dXJuIHRoaXNbJGdldE5leHRQYWdlXSgpOwogICAgfQogICAgY29uc3QgcGFnZU51bWJlciA9IHRoaXNbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLnBhZ2VOdW1iZXI7CiAgICBjb25zdCBwYXJpdHkgPSBwYWdlTnVtYmVyICUgMiA9PT0gMCA/ICJldmVuIiA6ICJvZGQiOwogICAgY29uc3QgcG9zaXRpb24gPSBwYWdlTnVtYmVyID09PSAwID8gImZpcnN0IiA6ICJyZXN0IjsKICAgIGxldCBwYWdlID0gdGhpcy5wYWdlQXJlYS5jaGlsZHJlbi5maW5kKHAgPT4gcC5vZGRPckV2ZW4gPT09IHBhcml0eSAmJiBwLnBhZ2VQb3NpdGlvbiA9PT0gcG9zaXRpb24pOwogICAgaWYgKHBhZ2UpIHsKICAgICAgcmV0dXJuIHBhZ2U7CiAgICB9CiAgICBwYWdlID0gdGhpcy5wYWdlQXJlYS5jaGlsZHJlbi5maW5kKHAgPT4gcC5vZGRPckV2ZW4gPT09ICJhbnkiICYmIHAucGFnZVBvc2l0aW9uID09PSBwb3NpdGlvbik7CiAgICBpZiAocGFnZSkgewogICAgICByZXR1cm4gcGFnZTsKICAgIH0KICAgIHBhZ2UgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuLmZpbmQocCA9PiBwLm9kZE9yRXZlbiA9PT0gImFueSIgJiYgcC5wYWdlUG9zaXRpb24gPT09ICJhbnkiKTsKICAgIGlmIChwYWdlKSB7CiAgICAgIHJldHVybiBwYWdlOwogICAgfQogICAgcmV0dXJuIHRoaXMucGFnZUFyZWEuY2hpbGRyZW5bMF07CiAgfQp9CmNsYXNzIFBhcmEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFyYSIsIHRydWUpOwogICAgdGhpcy5oQWxpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxpbmVIZWlnaHQgPSBhdHRyaWJ1dGVzLmxpbmVIZWlnaHQgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmxpbmVIZWlnaHQsICIwcHQiKSA6ICIiOwogICAgdGhpcy5tYXJnaW5MZWZ0ID0gYXR0cmlidXRlcy5tYXJnaW5MZWZ0ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXJnaW5MZWZ0LCAiMHB0IikgOiAiIjsKICAgIHRoaXMubWFyZ2luUmlnaHQgPSBhdHRyaWJ1dGVzLm1hcmdpblJpZ2h0ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXJnaW5SaWdodCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLm9ycGhhbnMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5vcnBoYW5zLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLnByZXNlcnZlID0gYXR0cmlidXRlcy5wcmVzZXJ2ZSB8fCAiIjsKICAgIHRoaXMucmFkaXhPZmZzZXQgPSBhdHRyaWJ1dGVzLnJhZGl4T2Zmc2V0ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5yYWRpeE9mZnNldCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLnNwYWNlQWJvdmUgPSBhdHRyaWJ1dGVzLnNwYWNlQWJvdmUgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnNwYWNlQWJvdmUsICIwcHQiKSA6ICIiOwogICAgdGhpcy5zcGFjZUJlbG93ID0gYXR0cmlidXRlcy5zcGFjZUJlbG93ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5zcGFjZUJlbG93LCAiMHB0IikgOiAiIjsKICAgIHRoaXMudGFiRGVmYXVsdCA9IGF0dHJpYnV0ZXMudGFiRGVmYXVsdCA/IGdldE1lYXN1cmVtZW50KHRoaXMudGFiRGVmYXVsdCkgOiAiIjsKICAgIHRoaXMudGFiU3RvcHMgPSAoYXR0cmlidXRlcy50YWJTdG9wcyB8fCAiIikudHJpbSgpLnNwbGl0KC9ccysvKS5tYXAoKHgsIGkpID0+IGkgJSAyID09PSAxID8gZ2V0TWVhc3VyZW1lbnQoeCkgOiB4KTsKICAgIHRoaXMudGV4dEluZGVudCA9IGF0dHJpYnV0ZXMudGV4dEluZGVudCA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudGV4dEluZGVudCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy52QWxpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy52QWxpZ24sIFsidG9wIiwgImJvdHRvbSIsICJtaWRkbGUiXSk7CiAgICB0aGlzLndpZG93cyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLndpZG93cywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5oeXBoZW5hdGlvbiA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImhBbGlnbiIpOwogICAgaWYgKHRoaXMubWFyZ2luTGVmdCAhPT0gIiIpIHsKICAgICAgc3R5bGUucGFkZGluZ0xlZnQgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5tYXJnaW5MZWZ0KTsKICAgIH0KICAgIGlmICh0aGlzLm1hcmdpblJpZ2h0ICE9PSAiIikgewogICAgICBzdHlsZS5wYWRkaW5nUmlnaHQgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5tYXJnaW5SaWdodCk7CiAgICB9CiAgICBpZiAodGhpcy5zcGFjZUFib3ZlICE9PSAiIikgewogICAgICBzdHlsZS5wYWRkaW5nVG9wID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMuc3BhY2VBYm92ZSk7CiAgICB9CiAgICBpZiAodGhpcy5zcGFjZUJlbG93ICE9PSAiIikgewogICAgICBzdHlsZS5wYWRkaW5nQm90dG9tID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMuc3BhY2VCZWxvdyk7CiAgICB9CiAgICBpZiAodGhpcy50ZXh0SW5kZW50ICE9PSAiIikgewogICAgICBzdHlsZS50ZXh0SW5kZW50ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMudGV4dEluZGVudCk7CiAgICAgIGZpeFRleHRJbmRlbnQoc3R5bGUpOwogICAgfQogICAgaWYgKHRoaXMubGluZUhlaWdodCA+IDApIHsKICAgICAgc3R5bGUubGluZUhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLmxpbmVIZWlnaHQpOwogICAgfQogICAgaWYgKHRoaXMudGFiRGVmYXVsdCAhPT0gIiIpIHsKICAgICAgc3R5bGUudGFiU2l6ZSA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLnRhYkRlZmF1bHQpOwogICAgfQogICAgaWYgKHRoaXMudGFiU3RvcHMubGVuZ3RoID4gMCkge30KICAgIGlmICh0aGlzLmh5cGhlbmF0YXRpb24pIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgdGhpcy5oeXBoZW5hdGF0aW9uWyR0b1N0eWxlXSgpKTsKICAgIH0KICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgUGFzc3dvcmRFZGl0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInBhc3N3b3JkRWRpdCIsIHRydWUpOwogICAgdGhpcy5oU2Nyb2xsUG9saWN5ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaFNjcm9sbFBvbGljeSwgWyJhdXRvIiwgIm9mZiIsICJvbiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wYXNzd29yZENoYXIgPSBhdHRyaWJ1dGVzLnBhc3N3b3JkQ2hhciB8fCAiKiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KfQpjbGFzcyB0ZW1wbGF0ZV9QYXR0ZXJuIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInBhdHRlcm4iLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJjcm9zc0hhdGNoIiwgImNyb3NzRGlhZ29uYWwiLCAiZGlhZ29uYWxMZWZ0IiwgImRpYWdvbmFsUmlnaHQiLCAiaG9yaXpvbnRhbCIsICJ2ZXJ0aWNhbCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXShzdGFydENvbG9yKSB7CiAgICBzdGFydENvbG9yID0gc3RhcnRDb2xvciA/IHN0YXJ0Q29sb3JbJHRvU3R5bGVdKCkgOiAiI0ZGRkZGRiI7CiAgICBjb25zdCBlbmRDb2xvciA9IHRoaXMuY29sb3IgPyB0aGlzLmNvbG9yWyR0b1N0eWxlXSgpIDogIiMwMDAwMDAiOwogICAgY29uc3Qgd2lkdGggPSA1OwogICAgY29uc3QgY21kID0gInJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQiOwogICAgY29uc3QgY29sb3JzID0gYCR7c3RhcnRDb2xvcn0sJHtzdGFydENvbG9yfSAke3dpZHRofXB4LCR7ZW5kQ29sb3J9ICR7d2lkdGh9cHgsJHtlbmRDb2xvcn0gJHsyICogd2lkdGh9cHhgOwogICAgc3dpdGNoICh0aGlzLnR5cGUpIHsKICAgICAgY2FzZSAiY3Jvc3NIYXRjaCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0odG8gdG9wLCR7Y29sb3JzfSkgJHtjbWR9KHRvIHJpZ2h0LCR7Y29sb3JzfSlgOwogICAgICBjYXNlICJjcm9zc0RpYWdvbmFsIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSg0NWRlZywke2NvbG9yc30pICR7Y21kfSgtNDVkZWcsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgImRpYWdvbmFsTGVmdCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0oNDVkZWcsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgImRpYWdvbmFsUmlnaHQiOgogICAgICAgIHJldHVybiBgJHtjbWR9KC00NWRlZywke2NvbG9yc30pYDsKICAgICAgY2FzZSAiaG9yaXpvbnRhbCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0odG8gdG9wLCR7Y29sb3JzfSlgOwogICAgICBjYXNlICJ2ZXJ0aWNhbCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0odG8gcmlnaHQsJHtjb2xvcnN9KWA7CiAgICB9CiAgICByZXR1cm4gIiI7CiAgfQp9CmNsYXNzIFBpY3R1cmUgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGljdHVyZSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBQcm90byBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwcm90byIsIHRydWUpOwogICAgdGhpcy5hcHBlYXJhbmNlRmlsdGVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmFyYyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5hcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmFzc2lzdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5iYXJjb2RlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJpbmRJdGVtcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ib29rZW5kID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYm9yZGVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrQWZ0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtCZWZvcmUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnV0dG9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNhbGN1bGF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jYXB0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNlcnRpZmljYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNlcnRpZmljYXRlcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jaGVja0J1dHRvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jaG9pY2VMaXN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbG9yID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbWIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29ubmVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb250ZW50QXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb3JuZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZUVkaXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVjaW1hbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWZhdWx0VWkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVzYyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kaWdlc3RNZXRob2QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGlnZXN0TWV0aG9kcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kcmF3ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVkZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jb2RpbmcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jb2RpbmdzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVuY3J5cHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdERhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdGlvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNyeXB0aW9uTWV0aG9kID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVuY3J5cHRpb25NZXRob2RzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV2ZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhlY3V0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leHRyYXMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmlsbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWx0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmxvYXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZm9udCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mb3JtYXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaGFuZGxlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5oeXBoZW5hdGlvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZUVkaXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW50ZWdlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pc3N1ZXJzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLml0ZW1zID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmtlZXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMua2V5VXNhZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubGluZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5saW5lYXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubG9ja0RvY3VtZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1hbmlmZXN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1hcmdpbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5tZHAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWVkaXVtID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1lc3NhZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubnVtZXJpY0VkaXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub2NjdXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub2lkID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm9pZHMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub3ZlcmZsb3cgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFnZUFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFnZVNldCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYXJhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBhc3N3b3JkRWRpdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYXR0ZXJuID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBpY3R1cmUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucmFkaWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlYXNvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5yZWFzb25zID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlY3RhbmdsZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5yZWYgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2NyaXB0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNldFByb3BlcnR5ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNpZ25EYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNpZ25hdHVyZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zaWduaW5nID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNvbGlkID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNwZWFrID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN0aXBwbGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmplY3RETiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJqZWN0RE5zID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1Ym1pdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZXh0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHRFZGl0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZVN0YW1wID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRvb2xUaXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudHJhdmVyc2FsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRyYXZlcnNlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnVpID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnZhbGlkYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnZhbHVlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnZhcmlhYmxlcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBSYWRpYWwgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicmFkaWFsIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsidG9FZGdlIiwgInRvQ2VudGVyIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKHN0YXJ0Q29sb3IpIHsKICAgIHN0YXJ0Q29sb3IgPSBzdGFydENvbG9yID8gc3RhcnRDb2xvclskdG9TdHlsZV0oKSA6ICIjRkZGRkZGIjsKICAgIGNvbnN0IGVuZENvbG9yID0gdGhpcy5jb2xvciA/IHRoaXMuY29sb3JbJHRvU3R5bGVdKCkgOiAiIzAwMDAwMCI7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLnR5cGUgPT09ICJ0b0VkZ2UiID8gYCR7c3RhcnRDb2xvcn0sJHtlbmRDb2xvcn1gIDogYCR7ZW5kQ29sb3J9LCR7c3RhcnRDb2xvcn1gOwogICAgcmV0dXJuIGByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IGNlbnRlciwgJHtjb2xvcnN9KWA7CiAgfQp9CmNsYXNzIFJlYXNvbiBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyZWFzb24iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgUmVhc29ucyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyZWFzb25zIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5yZWFzb24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgUmVjdGFuZ2xlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInJlY3RhbmdsZSIsIHRydWUpOwogICAgdGhpcy5oYW5kID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaGFuZCwgWyJldmVuIiwgImxlZnQiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvcm5lciA9IG5ldyBYRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZWRnZSA9IG5ldyBYRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZmlsbCA9IG51bGw7CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIGNvbnN0IGVkZ2UgPSB0aGlzLmVkZ2UuY2hpbGRyZW4ubGVuZ3RoID8gdGhpcy5lZGdlLmNoaWxkcmVuWzBdIDogbmV3IEVkZ2Uoe30pOwogICAgY29uc3QgZWRnZVN0eWxlID0gZWRnZVskdG9TdHlsZV0oKTsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzLmZpbGw/LnByZXNlbmNlID09PSAidmlzaWJsZSIpIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgdGhpcy5maWxsWyR0b1N0eWxlXSgpKTsKICAgIH0gZWxzZSB7CiAgICAgIHN0eWxlLmZpbGwgPSAidHJhbnNwYXJlbnQiOwogICAgfQogICAgc3R5bGUuc3Ryb2tlV2lkdGggPSBtZWFzdXJlVG9TdHJpbmcoZWRnZS5wcmVzZW5jZSA9PT0gInZpc2libGUiID8gZWRnZS50aGlja25lc3MgOiAwKTsKICAgIHN0eWxlLnN0cm9rZSA9IGVkZ2VTdHlsZS5jb2xvcjsKICAgIGNvbnN0IGNvcm5lciA9IHRoaXMuY29ybmVyLmNoaWxkcmVuLmxlbmd0aCA/IHRoaXMuY29ybmVyLmNoaWxkcmVuWzBdIDogbmV3IENvcm5lcih7fSk7CiAgICBjb25zdCBjb3JuZXJTdHlsZSA9IGNvcm5lclskdG9TdHlsZV0oKTsKICAgIGNvbnN0IHJlY3QgPSB7CiAgICAgIG5hbWU6ICJyZWN0IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgICAgcng6IGNvcm5lclN0eWxlLnJhZGl1cywKICAgICAgICByeTogY29ybmVyU3R5bGUucmFkaXVzLAogICAgICAgIHN0eWxlCiAgICAgIH0KICAgIH07CiAgICBjb25zdCBzdmcgPSB7CiAgICAgIG5hbWU6ICJzdmciLAogICAgICBjaGlsZHJlbjogW3JlY3RdLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgICBzdHlsZTogewogICAgICAgICAgb3ZlcmZsb3c6ICJ2aXNpYmxlIgogICAgICAgIH0sCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBoZWlnaHQ6ICIxMDAlIgogICAgICB9CiAgICB9OwogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBpZiAoaGFzTWFyZ2luKHBhcmVudCkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogImlubGluZSIsCiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjaGlsZHJlbjogW3N2Z10KICAgICAgfSk7CiAgICB9CiAgICBzdmcuYXR0cmlidXRlcy5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHN2Zyk7CiAgfQp9CmNsYXNzIFJlZkVsZW1lbnQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicmVmIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFNjcmlwdCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzY3JpcHQiKTsKICAgIHRoaXMuYmluZGluZyA9IGF0dHJpYnV0ZXMuYmluZGluZyB8fCAiIjsKICAgIHRoaXMuY29udGVudFR5cGUgPSBhdHRyaWJ1dGVzLmNvbnRlbnRUeXBlIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJ1bkF0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucnVuQXQsIFsiY2xpZW50IiwgImJvdGgiLCAic2VydmVyIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgU2V0UHJvcGVydHkgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic2V0UHJvcGVydHkiKTsKICAgIHRoaXMuY29ubmVjdGlvbiA9IGF0dHJpYnV0ZXMuY29ubmVjdGlvbiB8fCAiIjsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogIH0KfQpjbGFzcyBTaWduRGF0YSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzaWduRGF0YSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm9wZXJhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm9wZXJhdGlvbiwgWyJzaWduIiwgImNsZWFyIiwgInZlcmlmeSJdKTsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZmlsdGVyID0gbnVsbDsKICAgIHRoaXMubWFuaWZlc3QgPSBudWxsOwogIH0KfQpjbGFzcyBTaWduYXR1cmUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic2lnbmF0dXJlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsiUERGMS4zIiwgIlBERjEuNiJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZpbHRlciA9IG51bGw7CiAgICB0aGlzLm1hbmlmZXN0ID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9Cn0KY2xhc3MgU2lnbmluZyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzaWduaW5nIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jZXJ0aWZpY2F0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBTb2xpZCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzb2xpZCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKHN0YXJ0Q29sb3IpIHsKICAgIHJldHVybiBzdGFydENvbG9yID8gc3RhcnRDb2xvclskdG9TdHlsZV0oKSA6ICIjRkZGRkZGIjsKICB9Cn0KY2xhc3MgU3BlYWsgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3BlYWsiKTsKICAgIHRoaXMuZGlzYWJsZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmRpc2FibGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucHJpb3JpdHkgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmlvcml0eSwgWyJjdXN0b20iLCAiY2FwdGlvbiIsICJuYW1lIiwgInRvb2xUaXAiXSk7CiAgICB0aGlzLnJpZCA9IGF0dHJpYnV0ZXMucmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgU3RpcHBsZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdGlwcGxlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucmF0ZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnJhdGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogNTAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMCAmJiB4IDw9IDEwMAogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oYmdDb2xvcikgewogICAgY29uc3QgYWxwaGEgPSB0aGlzLnJhdGUgLyAxMDA7CiAgICByZXR1cm4gVXRpbC5tYWtlSGV4Q29sb3IoTWF0aC5yb3VuZChiZ0NvbG9yLnZhbHVlLnIgKiAoMSAtIGFscGhhKSArIHRoaXMudmFsdWUuciAqIGFscGhhKSwgTWF0aC5yb3VuZChiZ0NvbG9yLnZhbHVlLmcgKiAoMSAtIGFscGhhKSArIHRoaXMudmFsdWUuZyAqIGFscGhhKSwgTWF0aC5yb3VuZChiZ0NvbG9yLnZhbHVlLmIgKiAoMSAtIGFscGhhKSArIHRoaXMudmFsdWUuYiAqIGFscGhhKSk7CiAgfQp9CmNsYXNzIFN1YmZvcm0gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3ViZm9ybSIsIHRydWUpOwogICAgdGhpcy5hY2Nlc3MgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hY2Nlc3MsIFsib3BlbiIsICJub25JbnRlcmFjdGl2ZSIsICJwcm90ZWN0ZWQiLCAicmVhZE9ubHkiXSk7CiAgICB0aGlzLmFsbG93TWFjcm8gPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5hbGxvd01hY3JvLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5hbmNob3JUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYW5jaG9yVHlwZSwgWyJ0b3BMZWZ0IiwgImJvdHRvbUNlbnRlciIsICJib3R0b21MZWZ0IiwgImJvdHRvbVJpZ2h0IiwgIm1pZGRsZUNlbnRlciIsICJtaWRkbGVMZWZ0IiwgIm1pZGRsZVJpZ2h0IiwgInRvcENlbnRlciIsICJ0b3BSaWdodCJdKTsKICAgIHRoaXMuY29sU3BhbiA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNvbFNwYW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxIHx8IG4gPT09IC0xCiAgICB9KTsKICAgIHRoaXMuY29sdW1uV2lkdGhzID0gKGF0dHJpYnV0ZXMuY29sdW1uV2lkdGhzIHx8ICIiKS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcCh4ID0+IHggPT09ICItMSIgPyAtMSA6IGdldE1lYXN1cmVtZW50KHgpKTsKICAgIHRoaXMuaCA9IGF0dHJpYnV0ZXMuaCA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuaCkgOiAiIjsKICAgIHRoaXMuaEFsaWduID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaEFsaWduLCBbImxlZnQiLCAiY2VudGVyIiwgImp1c3RpZnkiLCAianVzdGlmeUFsbCIsICJyYWRpeCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sYXlvdXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5sYXlvdXQsIFsicG9zaXRpb24iLCAibHItdGIiLCAicmwtcm93IiwgInJsLXRiIiwgInJvdyIsICJ0YWJsZSIsICJ0YiJdKTsKICAgIHRoaXMubG9jYWxlID0gYXR0cmlidXRlcy5sb2NhbGUgfHwgIiI7CiAgICB0aGlzLm1heEggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1heEgsICIwcHQiKTsKICAgIHRoaXMubWF4VyA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4VywgIjBwdCIpOwogICAgdGhpcy5tZXJnZU1vZGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5tZXJnZU1vZGUsIFsiY29uc3VtZURhdGEiLCAibWF0Y2hUZW1wbGF0ZSJdKTsKICAgIHRoaXMubWluSCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWluSCwgIjBwdCIpOwogICAgdGhpcy5taW5XID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5XLCAiMHB0Iik7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy5yZXN0b3JlU3RhdGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5yZXN0b3JlU3RhdGUsIFsibWFudWFsIiwgImF1dG8iXSk7CiAgICB0aGlzLnNjb3BlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc2NvcGUsIFsibmFtZSIsICJub25lIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGF0dHJpYnV0ZXMudyA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudykgOiAiIjsKICAgIHRoaXMueCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmFzc2lzdCA9IG51bGw7CiAgICB0aGlzLmJpbmQgPSBudWxsOwogICAgdGhpcy5ib29rZW5kID0gbnVsbDsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuYnJlYWsgPSBudWxsOwogICAgdGhpcy5jYWxjdWxhdGUgPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMua2VlcCA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgICB0aGlzLm9jY3VyID0gbnVsbDsKICAgIHRoaXMub3ZlcmZsb3cgPSBudWxsOwogICAgdGhpcy5wYWdlU2V0ID0gbnVsbDsKICAgIHRoaXMucGFyYSA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNhbCA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRlID0gbnVsbDsKICAgIHRoaXMudmFyaWFibGVzID0gbnVsbDsKICAgIHRoaXMuYXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5icmVha0FmdGVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrQmVmb3JlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbm5lY3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZHJhdyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ldmVudCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucHJvdG8gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogIFskZ2V0U3ViZm9ybVBhcmVudF0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgU3ViZm9ybVNldCkgewogICAgICByZXR1cm4gcGFyZW50WyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKICB9CiAgWyRpc0JpbmRhYmxlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGlzVGhlcmVNb3JlV2lkdGhdKCkgewogICAgcmV0dXJuIHRoaXMubGF5b3V0LmVuZHNXaXRoKCItdGIiKSAmJiB0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gMCAmJiB0aGlzWyRleHRyYV0ubnVtYmVySW5MaW5lID4gMCB8fCB0aGlzWyRnZXRQYXJlbnRdKClbJGlzVGhlcmVNb3JlV2lkdGhdKCk7CiAgfQogICpbJGdldENvbnRhaW5lZENoaWxkcmVuXSgpIHsKICAgIHlpZWxkKiBnZXRDb250YWluZWRDaGlsZHJlbih0aGlzKTsKICB9CiAgWyRmbHVzaEhUTUxdKCkgewogICAgcmV0dXJuIGZsdXNoSFRNTCh0aGlzKTsKICB9CiAgWyRhZGRIVE1MXShodG1sLCBiYm94KSB7CiAgICBhZGRIVE1MKHRoaXMsIGh0bWwsIGJib3gpOwogIH0KICBbJGdldEF2YWlsYWJsZVNwYWNlXSgpIHsKICAgIHJldHVybiBnZXRBdmFpbGFibGVTcGFjZSh0aGlzKTsKICB9CiAgWyRpc1NwbGl0dGFibGVdKCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGlmICghcGFyZW50WyRpc1NwbGl0dGFibGVdKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlOwogICAgfQogICAgaWYgKHRoaXMubGF5b3V0ID09PSAicG9zaXRpb24iIHx8IHRoaXMubGF5b3V0LmluY2x1ZGVzKCJyb3ciKSkgewogICAgICB0aGlzWyRleHRyYV0uX2lzU3BsaXR0YWJsZSA9IGZhbHNlOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5rZWVwICYmIHRoaXMua2VlcC5pbnRhY3QgIT09ICJub25lIikgewogICAgICB0aGlzWyRleHRyYV0uX2lzU3BsaXR0YWJsZSA9IGZhbHNlOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAocGFyZW50LmxheW91dD8uZW5kc1dpdGgoIi10YiIpICYmIHBhcmVudFskZXh0cmFdLm51bWJlckluTGluZSAhPT0gMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzWyRleHRyYV0uX2lzU3BsaXR0YWJsZSA9IHRydWU7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBzZXRUYWJJbmRleCh0aGlzKTsKICAgIGlmICh0aGlzLmJyZWFrKSB7CiAgICAgIGlmICh0aGlzLmJyZWFrLmFmdGVyICE9PSAiYXV0byIgfHwgdGhpcy5icmVhay5hZnRlclRhcmdldCAhPT0gIiIpIHsKICAgICAgICBjb25zdCBub2RlID0gbmV3IEJyZWFrQWZ0ZXIoewogICAgICAgICAgdGFyZ2V0VHlwZTogdGhpcy5icmVhay5hZnRlciwKICAgICAgICAgIHRhcmdldDogdGhpcy5icmVhay5hZnRlclRhcmdldCwKICAgICAgICAgIHN0YXJ0TmV3OiB0aGlzLmJyZWFrLnN0YXJ0TmV3LnRvU3RyaW5nKCkKICAgICAgICB9KTsKICAgICAgICBub2RlWyRnbG9iYWxEYXRhXSA9IHRoaXNbJGdsb2JhbERhdGFdOwogICAgICAgIHRoaXNbJGFwcGVuZENoaWxkXShub2RlKTsKICAgICAgICB0aGlzLmJyZWFrQWZ0ZXIucHVzaChub2RlKTsKICAgICAgfQogICAgICBpZiAodGhpcy5icmVhay5iZWZvcmUgIT09ICJhdXRvIiB8fCB0aGlzLmJyZWFrLmJlZm9yZVRhcmdldCAhPT0gIiIpIHsKICAgICAgICBjb25zdCBub2RlID0gbmV3IEJyZWFrQmVmb3JlKHsKICAgICAgICAgIHRhcmdldFR5cGU6IHRoaXMuYnJlYWsuYmVmb3JlLAogICAgICAgICAgdGFyZ2V0OiB0aGlzLmJyZWFrLmJlZm9yZVRhcmdldCwKICAgICAgICAgIHN0YXJ0TmV3OiB0aGlzLmJyZWFrLnN0YXJ0TmV3LnRvU3RyaW5nKCkKICAgICAgICB9KTsKICAgICAgICBub2RlWyRnbG9iYWxEYXRhXSA9IHRoaXNbJGdsb2JhbERhdGFdOwogICAgICAgIHRoaXNbJGFwcGVuZENoaWxkXShub2RlKTsKICAgICAgICB0aGlzLmJyZWFrQmVmb3JlLnB1c2gobm9kZSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYnJlYWsub3ZlcmZsb3dUYXJnZXQgIT09ICIiKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5ldyBPdmVyZmxvdyh7CiAgICAgICAgICB0YXJnZXQ6IHRoaXMuYnJlYWsub3ZlcmZsb3dUYXJnZXQsCiAgICAgICAgICBsZWFkZXI6IHRoaXMuYnJlYWsub3ZlcmZsb3dMZWFkZXIsCiAgICAgICAgICB0cmFpbGVyOiB0aGlzLmJyZWFrLm92ZXJmbG93VHJhaWxlcgogICAgICAgIH0pOwogICAgICAgIG5vZGVbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICAgIHRoaXMub3ZlcmZsb3cucHVzaChub2RlKTsKICAgICAgfQogICAgICB0aGlzWyRyZW1vdmVDaGlsZF0odGhpcy5icmVhayk7CiAgICAgIHRoaXMuYnJlYWsgPSBudWxsOwogICAgfQogICAgaWYgKHRoaXMucHJlc2VuY2UgPT09ICJoaWRkZW4iIHx8IHRoaXMucHJlc2VuY2UgPT09ICJpbmFjdGl2ZSIpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBpZiAodGhpcy5icmVha0JlZm9yZS5jaGlsZHJlbi5sZW5ndGggPiAxIHx8IHRoaXMuYnJlYWtBZnRlci5jaGlsZHJlbi5sZW5ndGggPiAxKSB7CiAgICAgIHdhcm4oIlhGQSAtIFNldmVyYWwgYnJlYWtCZWZvcmUgb3IgYnJlYWtBZnRlciBpbiBzdWJmb3JtczogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICBpZiAodGhpcy5icmVha0JlZm9yZS5jaGlsZHJlbi5sZW5ndGggPj0gMSkgewogICAgICBjb25zdCBicmVha0JlZm9yZSA9IHRoaXMuYnJlYWtCZWZvcmUuY2hpbGRyZW5bMF07CiAgICAgIGlmIChoYW5kbGVCcmVhayhicmVha0JlZm9yZSkpIHsKICAgICAgICByZXR1cm4gSFRNTFJlc3VsdC5icmVha05vZGUoYnJlYWtCZWZvcmUpOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpc1skZXh0cmFdPy5hZnRlckJyZWFrQWZ0ZXIpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBmaXhEaW1lbnNpb25zKHRoaXMpOwogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICBjbGFzczogW10KICAgIH07CiAgICBzZXRBY2Nlc3ModGhpcywgYXR0cmlidXRlcy5jbGFzcyk7CiAgICB0aGlzWyRleHRyYV0gfHw9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBPYmplY3QuYXNzaWduKHRoaXNbJGV4dHJhXSwgewogICAgICBjaGlsZHJlbiwKICAgICAgbGluZTogbnVsbCwKICAgICAgYXR0cmlidXRlcywKICAgICAgYXR0ZW1wdDogMCwKICAgICAgbnVtYmVySW5MaW5lOiAwLAogICAgICBhdmFpbGFibGVTcGFjZTogewogICAgICAgIHdpZHRoOiBNYXRoLm1pbih0aGlzLncgfHwgSW5maW5pdHksIGF2YWlsYWJsZVNwYWNlLndpZHRoKSwKICAgICAgICBoZWlnaHQ6IE1hdGgubWluKHRoaXMuaCB8fCBJbmZpbml0eSwgYXZhaWxhYmxlU3BhY2UuaGVpZ2h0KQogICAgICB9LAogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwLAogICAgICBwcmV2SGVpZ2h0OiAwLAogICAgICBjdXJyZW50V2lkdGg6IDAKICAgIH0pOwogICAgY29uc3Qgcm9vdCA9IHRoaXNbJGdldFRlbXBsYXRlUm9vdF0oKTsKICAgIGNvbnN0IHNhdmVkTm9MYXlvdXRGYWlsdXJlID0gcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZTsKICAgIGNvbnN0IGlzU3BsaXR0YWJsZSA9IHRoaXNbJGlzU3BsaXR0YWJsZV0oKTsKICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgIHNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgfQogICAgaWYgKCFjaGVja0RpbWVuc2lvbnModGhpcywgYXZhaWxhYmxlU3BhY2UpKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICBjb25zdCBmaWx0ZXIgPSBuZXcgU2V0KFsiYXJlYSIsICJkcmF3IiwgImV4Y2xHcm91cCIsICJmaWVsZCIsICJzdWJmb3JtIiwgInN1YmZvcm1TZXQiXSk7CiAgICBpZiAodGhpcy5sYXlvdXQuaW5jbHVkZXMoInJvdyIpKSB7CiAgICAgIGNvbnN0IGNvbHVtbldpZHRocyA9IHRoaXNbJGdldFN1YmZvcm1QYXJlbnRdKCkuY29sdW1uV2lkdGhzOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShjb2x1bW5XaWR0aHMpICYmIGNvbHVtbldpZHRocy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLmNvbHVtbldpZHRocyA9IGNvbHVtbldpZHRoczsKICAgICAgICB0aGlzWyRleHRyYV0uY3VycmVudENvbHVtbiA9IDA7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiYW5jaG9yVHlwZSIsICJkaW1lbnNpb25zIiwgInBvc2l0aW9uIiwgInByZXNlbmNlIiwgImJvcmRlciIsICJtYXJnaW4iLCAiaEFsaWduIik7CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFTdWJmb3JtIl07CiAgICBjb25zdCBjbCA9IGxheW91dENsYXNzKHRoaXMpOwogICAgaWYgKGNsKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaChjbCk7CiAgICB9CiAgICBhdHRyaWJ1dGVzLnN0eWxlID0gc3R5bGU7CiAgICBhdHRyaWJ1dGVzLmNsYXNzID0gY2xhc3NOYW1lczsKICAgIGlmICh0aGlzLm5hbWUpIHsKICAgICAgYXR0cmlidXRlcy54ZmFOYW1lID0gdGhpcy5uYW1lOwogICAgfQogICAgaWYgKHRoaXMub3ZlcmZsb3cpIHsKICAgICAgY29uc3Qgb3ZlcmZsb3dFeHRyYSA9IHRoaXMub3ZlcmZsb3dbJGdldEV4dHJhXSgpOwogICAgICBpZiAob3ZlcmZsb3dFeHRyYS5hZGRMZWFkZXIpIHsKICAgICAgICBvdmVyZmxvd0V4dHJhLmFkZExlYWRlciA9IGZhbHNlOwogICAgICAgIGhhbmRsZU92ZXJmbG93KHRoaXMsIG92ZXJmbG93RXh0cmEubGVhZGVyLCBhdmFpbGFibGVTcGFjZSk7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbJHB1c2hQYXJhXSgpOwogICAgY29uc3QgaXNMclRiID0gdGhpcy5sYXlvdXQgPT09ICJsci10YiIgfHwgdGhpcy5sYXlvdXQgPT09ICJybC10YiI7CiAgICBjb25zdCBtYXhSdW4gPSBpc0xyVGIgPyBNQVhfQVRURU1QVFNfRk9SX0xSVEJfTEFZT1VUIDogMTsKICAgIGZvciAoOyB0aGlzWyRleHRyYV0uYXR0ZW1wdCA8IG1heFJ1bjsgdGhpc1skZXh0cmFdLmF0dGVtcHQrKykgewogICAgICBpZiAoaXNMclRiICYmIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSBNQVhfQVRURU1QVFNfRk9SX0xSVEJfTEFZT1VUIC0gMSkgewogICAgICAgIHRoaXNbJGV4dHJhXS5udW1iZXJJbkxpbmUgPSAwOwogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXNbJGNoaWxkcmVuVG9IVE1MXSh7CiAgICAgICAgZmlsdGVyLAogICAgICAgIGluY2x1ZGU6IHRydWUKICAgICAgfSk7CiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChyZXN1bHQuaXNCcmVhaygpKSB7CiAgICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIGlmIChpc0xyVGIgJiYgdGhpc1skZXh0cmFdLmF0dGVtcHQgPT09IDAgJiYgdGhpc1skZXh0cmFdLm51bWJlckluTGluZSA9PT0gMCAmJiAhcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID0gbWF4UnVuOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgdW5zZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIH0KICAgIHJvb3RbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSBzYXZlZE5vTGF5b3V0RmFpbHVyZTsKICAgIGlmICh0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gbWF4UnVuKSB7CiAgICAgIGlmICh0aGlzLm92ZXJmbG93KSB7CiAgICAgICAgdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ub3ZlcmZsb3dOb2RlID0gdGhpcy5vdmVyZmxvdzsKICAgICAgfQogICAgICBpZiAoIWlzU3BsaXR0YWJsZSkgewogICAgICAgIGRlbGV0ZSB0aGlzWyRleHRyYV07CiAgICAgIH0KICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIGlmICh0aGlzLm92ZXJmbG93KSB7CiAgICAgIGNvbnN0IG92ZXJmbG93RXh0cmEgPSB0aGlzLm92ZXJmbG93WyRnZXRFeHRyYV0oKTsKICAgICAgaWYgKG92ZXJmbG93RXh0cmEuYWRkVHJhaWxlcikgewogICAgICAgIG92ZXJmbG93RXh0cmEuYWRkVHJhaWxlciA9IGZhbHNlOwogICAgICAgIGhhbmRsZU92ZXJmbG93KHRoaXMsIG92ZXJmbG93RXh0cmEudHJhaWxlciwgYXZhaWxhYmxlU3BhY2UpOwogICAgICB9CiAgICB9CiAgICBsZXQgbWFyZ2luSCA9IDA7CiAgICBsZXQgbWFyZ2luViA9IDA7CiAgICBpZiAodGhpcy5tYXJnaW4pIHsKICAgICAgbWFyZ2luSCA9IHRoaXMubWFyZ2luLmxlZnRJbnNldCArIHRoaXMubWFyZ2luLnJpZ2h0SW5zZXQ7CiAgICAgIG1hcmdpblYgPSB0aGlzLm1hcmdpbi50b3BJbnNldCArIHRoaXMubWFyZ2luLmJvdHRvbUluc2V0OwogICAgfQogICAgY29uc3Qgd2lkdGggPSBNYXRoLm1heCh0aGlzWyRleHRyYV0ud2lkdGggKyBtYXJnaW5ILCB0aGlzLncgfHwgMCk7CiAgICBjb25zdCBoZWlnaHQgPSBNYXRoLm1heCh0aGlzWyRleHRyYV0uaGVpZ2h0ICsgbWFyZ2luViwgdGhpcy5oIHx8IDApOwogICAgY29uc3QgYmJveCA9IFt0aGlzLngsIHRoaXMueSwgd2lkdGgsIGhlaWdodF07CiAgICBpZiAodGhpcy53ID09PSAiIikgewogICAgICBzdHlsZS53aWR0aCA9IG1lYXN1cmVUb1N0cmluZyh3aWR0aCk7CiAgICB9CiAgICBpZiAodGhpcy5oID09PSAiIikgewogICAgICBzdHlsZS5oZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcoaGVpZ2h0KTsKICAgIH0KICAgIGlmICgoc3R5bGUud2lkdGggPT09ICIwcHgiIHx8IHN0eWxlLmhlaWdodCA9PT0gIjBweCIpICYmIGNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBjaGlsZHJlbgogICAgfTsKICAgIGFwcGx5QXNzaXN0KHRoaXMsIGF0dHJpYnV0ZXMpOwogICAgY29uc3QgcmVzdWx0ID0gSFRNTFJlc3VsdC5zdWNjZXNzKGNyZWF0ZVdyYXBwZXIodGhpcywgaHRtbCksIGJib3gpOwogICAgaWYgKHRoaXMuYnJlYWtBZnRlci5jaGlsZHJlbi5sZW5ndGggPj0gMSkgewogICAgICBjb25zdCBicmVha0FmdGVyID0gdGhpcy5icmVha0FmdGVyLmNoaWxkcmVuWzBdOwogICAgICBpZiAoaGFuZGxlQnJlYWsoYnJlYWtBZnRlcikpIHsKICAgICAgICB0aGlzWyRleHRyYV0uYWZ0ZXJCcmVha0FmdGVyID0gcmVzdWx0OwogICAgICAgIHJldHVybiBIVE1MUmVzdWx0LmJyZWFrTm9kZShicmVha0FmdGVyKTsKICAgICAgfQogICAgfQogICAgZGVsZXRlIHRoaXNbJGV4dHJhXTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQp9CmNsYXNzIFN1YmZvcm1TZXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3ViZm9ybVNldCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJlbGF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucmVsYXRpb24sIFsib3JkZXJlZCIsICJjaG9pY2UiLCAidW5vcmRlcmVkIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9va2VuZCA9IG51bGw7CiAgICB0aGlzLmJyZWFrID0gbnVsbDsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm9jY3VyID0gbnVsbDsKICAgIHRoaXMub3ZlcmZsb3cgPSBudWxsOwogICAgdGhpcy5icmVha0FmdGVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrQmVmb3JlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybVNldCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICAqWyRnZXRDb250YWluZWRDaGlsZHJlbl0oKSB7CiAgICB5aWVsZCogZ2V0Q29udGFpbmVkQ2hpbGRyZW4odGhpcyk7CiAgfQogIFskZ2V0U3ViZm9ybVBhcmVudF0oKSB7CiAgICBsZXQgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgd2hpbGUgKCEocGFyZW50IGluc3RhbmNlb2YgU3ViZm9ybSkpIHsKICAgICAgcGFyZW50ID0gcGFyZW50WyRnZXRQYXJlbnRdKCk7CiAgICB9CiAgICByZXR1cm4gcGFyZW50OwogIH0KICBbJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFN1YmplY3RETiBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3ViamVjdEROIik7CiAgICB0aGlzLmRlbGltaXRlciA9IGF0dHJpYnV0ZXMuZGVsaW1pdGVyIHx8ICIsIjsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IG5ldyBNYXAodGhpc1skY29udGVudF0uc3BsaXQodGhpcy5kZWxpbWl0ZXIpLm1hcChrdiA9PiB7CiAgICAgIGt2ID0ga3Yuc3BsaXQoIj0iLCAyKTsKICAgICAga3ZbMF0gPSBrdlswXS50cmltKCk7CiAgICAgIHJldHVybiBrdjsKICAgIH0pKTsKICB9Cn0KY2xhc3MgU3ViamVjdEROcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJqZWN0RE5zIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5zdWJqZWN0RE4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgU3VibWl0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInN1Ym1pdCIsIHRydWUpOwogICAgdGhpcy5lbWJlZFBERiA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmVtYmVkUERGLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5mb3JtYXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5mb3JtYXQsIFsieGRwIiwgImZvcm1kYXRhIiwgInBkZiIsICJ1cmxlbmNvZGVkIiwgInhmZCIsICJ4bWwiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnRleHRFbmNvZGluZyA9IGdldEtleXdvcmQoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnRleHRFbmNvZGluZyA/IGF0dHJpYnV0ZXMudGV4dEVuY29kaW5nLnRvTG93ZXJDYXNlKCkgOiAiIiwKICAgICAgZGVmYXVsdFZhbHVlOiAiIiwKICAgICAgdmFsaWRhdGU6IGsgPT4gWyJ1dGYtOCIsICJiaWctZml2ZSIsICJmb250c3BlY2lmaWMiLCAiZ2JrIiwgImdiLTE4MDMwIiwgImdiLTIzMTIiLCAia3NjLTU2MDEiLCAibm9uZSIsICJzaGlmdC1qaXMiLCAidWNzLTIiLCAidXRmLTE2Il0uaW5jbHVkZXMoaykgfHwgay5tYXRjaCgvaXNvLTg4NTktXGR7Mn0vKQogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy54ZHBDb250ZW50ID0gYXR0cmlidXRlcy54ZHBDb250ZW50IHx8ICIiOwogICAgdGhpcy5lbmNyeXB0ID0gbnVsbDsKICAgIHRoaXMuZW5jcnlwdERhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2lnbkRhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgVGVtcGxhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidGVtcGxhdGUiLCB0cnVlKTsKICAgIHRoaXMuYmFzZVByb2ZpbGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5iYXNlUHJvZmlsZSwgWyJmdWxsIiwgImludGVyYWN0aXZlRm9ybXMiXSk7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnN1YmZvcm0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBpZiAodGhpcy5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICB3YXJuKCJYRkEgLSBObyBzdWJmb3JtcyBpbiB0ZW1wbGF0ZSBub2RlLiIpOwogICAgfQogICAgaWYgKHRoaXMuc3ViZm9ybS5jaGlsZHJlbi5sZW5ndGggPj0gMikgewogICAgICB3YXJuKCJYRkEgLSBTZXZlcmFsIHN1YmZvcm1zIGluIHRlbXBsYXRlIG5vZGU6IHBsZWFzZSBmaWxlIGEgYnVnLiIpOwogICAgfQogICAgdGhpc1skdGFiSW5kZXhdID0gREVGQVVMVF9UQUJfSU5ERVg7CiAgfQogIFskaXNTcGxpdHRhYmxlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJHNlYXJjaE5vZGVdKGV4cHIsIGNvbnRhaW5lcikgewogICAgaWYgKGV4cHIuc3RhcnRzV2l0aCgiIyIpKSB7CiAgICAgIHJldHVybiBbdGhpc1skaWRzXS5nZXQoZXhwci5zbGljZSgxKSldOwogICAgfQogICAgcmV0dXJuIHNlYXJjaE5vZGUodGhpcywgY29udGFpbmVyLCBleHByLCB0cnVlLCB0cnVlKTsKICB9CiAgKlskdG9QYWdlc10oKSB7CiAgICBpZiAoIXRoaXMuc3ViZm9ybS5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgY2hpbGRyZW46IFtdCiAgICAgIH0pOwogICAgfQogICAgdGhpc1skZXh0cmFdID0gewogICAgICBvdmVyZmxvd05vZGU6IG51bGwsCiAgICAgIGZpcnN0VW5zcGxpdHRhYmxlOiBudWxsLAogICAgICBjdXJyZW50Q29udGVudEFyZWE6IG51bGwsCiAgICAgIGN1cnJlbnRQYWdlQXJlYTogbnVsbCwKICAgICAgbm9MYXlvdXRGYWlsdXJlOiBmYWxzZSwKICAgICAgcGFnZU51bWJlcjogMSwKICAgICAgcGFnZVBvc2l0aW9uOiAiZmlyc3QiLAogICAgICBvZGRPckV2ZW46ICJvZGQiLAogICAgICBibGFua09yTm90Qmxhbms6ICJub25CbGFuayIsCiAgICAgIHBhcmFTdGFjazogW10KICAgIH07CiAgICBjb25zdCByb290ID0gdGhpcy5zdWJmb3JtLmNoaWxkcmVuWzBdOwogICAgcm9vdC5wYWdlU2V0WyRjbGVhblBhZ2VdKCk7CiAgICBjb25zdCBwYWdlQXJlYXMgPSByb290LnBhZ2VTZXQucGFnZUFyZWEuY2hpbGRyZW47CiAgICBjb25zdCBtYWluSHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGNoaWxkcmVuOiBbXQogICAgfTsKICAgIGxldCBwYWdlQXJlYSA9IG51bGw7CiAgICBsZXQgYnJlYWtCZWZvcmUgPSBudWxsOwogICAgbGV0IGJyZWFrQmVmb3JlVGFyZ2V0ID0gbnVsbDsKICAgIGlmIChyb290LmJyZWFrQmVmb3JlLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSB7CiAgICAgIGJyZWFrQmVmb3JlID0gcm9vdC5icmVha0JlZm9yZS5jaGlsZHJlblswXTsKICAgICAgYnJlYWtCZWZvcmVUYXJnZXQgPSBicmVha0JlZm9yZS50YXJnZXQ7CiAgICB9IGVsc2UgaWYgKHJvb3Quc3ViZm9ybS5jaGlsZHJlbi5sZW5ndGggPj0gMSAmJiByb290LnN1YmZvcm0uY2hpbGRyZW5bMF0uYnJlYWtCZWZvcmUuY2hpbGRyZW4ubGVuZ3RoID49IDEpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LnN1YmZvcm0uY2hpbGRyZW5bMF0uYnJlYWtCZWZvcmUuY2hpbGRyZW5bMF07CiAgICAgIGJyZWFrQmVmb3JlVGFyZ2V0ID0gYnJlYWtCZWZvcmUudGFyZ2V0OwogICAgfSBlbHNlIGlmIChyb290LmJyZWFrPy5iZWZvcmVUYXJnZXQpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LmJyZWFrOwogICAgICBicmVha0JlZm9yZVRhcmdldCA9IGJyZWFrQmVmb3JlLmJlZm9yZVRhcmdldDsKICAgIH0gZWxzZSBpZiAocm9vdC5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCA+PSAxICYmIHJvb3Quc3ViZm9ybS5jaGlsZHJlblswXS5icmVhaz8uYmVmb3JlVGFyZ2V0KSB7CiAgICAgIGJyZWFrQmVmb3JlID0gcm9vdC5zdWJmb3JtLmNoaWxkcmVuWzBdLmJyZWFrOwogICAgICBicmVha0JlZm9yZVRhcmdldCA9IGJyZWFrQmVmb3JlLmJlZm9yZVRhcmdldDsKICAgIH0KICAgIGlmIChicmVha0JlZm9yZSkgewogICAgICBjb25zdCB0YXJnZXQgPSB0aGlzWyRzZWFyY2hOb2RlXShicmVha0JlZm9yZVRhcmdldCwgYnJlYWtCZWZvcmVbJGdldFBhcmVudF0oKSk7CiAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBQYWdlQXJlYSkgewogICAgICAgIHBhZ2VBcmVhID0gdGFyZ2V0OwogICAgICAgIGJyZWFrQmVmb3JlWyRleHRyYV0gPSB7fTsKICAgICAgfQogICAgfQogICAgcGFnZUFyZWEgfHw9IHBhZ2VBcmVhc1swXTsKICAgIHBhZ2VBcmVhWyRleHRyYV0gPSB7CiAgICAgIG51bWJlck9mVXNlOiAxCiAgICB9OwogICAgY29uc3QgcGFnZUFyZWFQYXJlbnQgPSBwYWdlQXJlYVskZ2V0UGFyZW50XSgpOwogICAgcGFnZUFyZWFQYXJlbnRbJGV4dHJhXSA9IHsKICAgICAgbnVtYmVyT2ZVc2U6IDEsCiAgICAgIHBhZ2VJbmRleDogcGFnZUFyZWFQYXJlbnQucGFnZUFyZWEuY2hpbGRyZW4uaW5kZXhPZihwYWdlQXJlYSksCiAgICAgIHBhZ2VTZXRJbmRleDogMAogICAgfTsKICAgIGxldCB0YXJnZXRQYWdlQXJlYTsKICAgIGxldCBsZWFkZXIgPSBudWxsOwogICAgbGV0IHRyYWlsZXIgPSBudWxsOwogICAgbGV0IGhhc1NvbWV0aGluZyA9IHRydWU7CiAgICBsZXQgaGFzU29tZXRoaW5nQ291bnRlciA9IDA7CiAgICBsZXQgc3RhcnRJbmRleCA9IDA7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoIWhhc1NvbWV0aGluZykgewogICAgICAgIG1haW5IdG1sLmNoaWxkcmVuLnBvcCgpOwogICAgICAgIGlmICgrK2hhc1NvbWV0aGluZ0NvdW50ZXIgPT09IE1BWF9FTVBUWV9QQUdFUykgewogICAgICAgICAgd2FybigiWEZBIC0gU29tZXRoaW5nIGdvZXMgd3Jvbmc6IHBsZWFzZSBmaWxlIGEgYnVnLiIpOwogICAgICAgICAgcmV0dXJuIG1haW5IdG1sOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBoYXNTb21ldGhpbmdDb3VudGVyID0gMDsKICAgICAgfQogICAgICB0YXJnZXRQYWdlQXJlYSA9IG51bGw7CiAgICAgIHRoaXNbJGV4dHJhXS5jdXJyZW50UGFnZUFyZWEgPSBwYWdlQXJlYTsKICAgICAgY29uc3QgcGFnZSA9IHBhZ2VBcmVhWyR0b0hUTUxdKCkuaHRtbDsKICAgICAgbWFpbkh0bWwuY2hpbGRyZW4ucHVzaChwYWdlKTsKICAgICAgaWYgKGxlYWRlcikgewogICAgICAgIHRoaXNbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSB0cnVlOwogICAgICAgIHBhZ2UuY2hpbGRyZW4ucHVzaChsZWFkZXJbJHRvSFRNTF0ocGFnZUFyZWFbJGV4dHJhXS5zcGFjZSkuaHRtbCk7CiAgICAgICAgbGVhZGVyID0gbnVsbDsKICAgICAgfQogICAgICBpZiAodHJhaWxlcikgewogICAgICAgIHRoaXNbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSB0cnVlOwogICAgICAgIHBhZ2UuY2hpbGRyZW4ucHVzaCh0cmFpbGVyWyR0b0hUTUxdKHBhZ2VBcmVhWyRleHRyYV0uc3BhY2UpLmh0bWwpOwogICAgICAgIHRyYWlsZXIgPSBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRlbnRBcmVhcyA9IHBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuOwogICAgICBjb25zdCBodG1sQ29udGVudEFyZWFzID0gcGFnZS5jaGlsZHJlbi5maWx0ZXIobm9kZSA9PiBub2RlLmF0dHJpYnV0ZXMuY2xhc3MuaW5jbHVkZXMoInhmYUNvbnRlbnRhcmVhIikpOwogICAgICBoYXNTb21ldGhpbmcgPSBmYWxzZTsKICAgICAgdGhpc1skZXh0cmFdLmZpcnN0VW5zcGxpdHRhYmxlID0gbnVsbDsKICAgICAgdGhpc1skZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IGZhbHNlOwogICAgICBjb25zdCBmbHVzaCA9IGluZGV4ID0+IHsKICAgICAgICBjb25zdCBodG1sID0gcm9vdFskZmx1c2hIVE1MXSgpOwogICAgICAgIGlmIChodG1sKSB7CiAgICAgICAgICBoYXNTb21ldGhpbmcgfHw9IGh0bWwuY2hpbGRyZW4/Lmxlbmd0aCA+IDA7CiAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2luZGV4XS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXgsIGlpID0gY29udGVudEFyZWFzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBjb250ZW50QXJlYSA9IHRoaXNbJGV4dHJhXS5jdXJyZW50Q29udGVudEFyZWEgPSBjb250ZW50QXJlYXNbaV07CiAgICAgICAgY29uc3Qgc3BhY2UgPSB7CiAgICAgICAgICB3aWR0aDogY29udGVudEFyZWEudywKICAgICAgICAgIGhlaWdodDogY29udGVudEFyZWEuaAogICAgICAgIH07CiAgICAgICAgc3RhcnRJbmRleCA9IDA7CiAgICAgICAgaWYgKGxlYWRlcikgewogICAgICAgICAgaHRtbENvbnRlbnRBcmVhc1tpXS5jaGlsZHJlbi5wdXNoKGxlYWRlclskdG9IVE1MXShzcGFjZSkuaHRtbCk7CiAgICAgICAgICBsZWFkZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAodHJhaWxlcikgewogICAgICAgICAgaHRtbENvbnRlbnRBcmVhc1tpXS5jaGlsZHJlbi5wdXNoKHRyYWlsZXJbJHRvSFRNTF0oc3BhY2UpLmh0bWwpOwogICAgICAgICAgdHJhaWxlciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGh0bWwgPSByb290WyR0b0hUTUxdKHNwYWNlKTsKICAgICAgICBpZiAoaHRtbC5zdWNjZXNzKSB7CiAgICAgICAgICBpZiAoaHRtbC5odG1sKSB7CiAgICAgICAgICAgIGhhc1NvbWV0aGluZyB8fD0gaHRtbC5odG1sLmNoaWxkcmVuPy5sZW5ndGggPiAwOwogICAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2ldLmNoaWxkcmVuLnB1c2goaHRtbC5odG1sKTsKICAgICAgICAgIH0gZWxzZSBpZiAoIWhhc1NvbWV0aGluZyAmJiBtYWluSHRtbC5jaGlsZHJlbi5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIG1haW5IdG1sLmNoaWxkcmVuLnBvcCgpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG1haW5IdG1sOwogICAgICAgIH0KICAgICAgICBpZiAoaHRtbC5pc0JyZWFrKCkpIHsKICAgICAgICAgIGNvbnN0IG5vZGUgPSBodG1sLmJyZWFrTm9kZTsKICAgICAgICAgIGZsdXNoKGkpOwogICAgICAgICAgaWYgKG5vZGUudGFyZ2V0VHlwZSA9PT0gImF1dG8iKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5vZGUubGVhZGVyKSB7CiAgICAgICAgICAgIGxlYWRlciA9IHRoaXNbJHNlYXJjaE5vZGVdKG5vZGUubGVhZGVyLCBub2RlWyRnZXRQYXJlbnRdKCkpOwogICAgICAgICAgICBsZWFkZXIgPSBsZWFkZXIgPyBsZWFkZXJbMF0gOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5vZGUudHJhaWxlcikgewogICAgICAgICAgICB0cmFpbGVyID0gdGhpc1skc2VhcmNoTm9kZV0obm9kZS50cmFpbGVyLCBub2RlWyRnZXRQYXJlbnRdKCkpOwogICAgICAgICAgICB0cmFpbGVyID0gdHJhaWxlciA/IHRyYWlsZXJbMF0gOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5vZGUudGFyZ2V0VHlwZSA9PT0gInBhZ2VBcmVhIikgewogICAgICAgICAgICB0YXJnZXRQYWdlQXJlYSA9IG5vZGVbJGV4dHJhXS50YXJnZXQ7CiAgICAgICAgICAgIGkgPSBJbmZpbml0eTsKICAgICAgICAgIH0gZWxzZSBpZiAoIW5vZGVbJGV4dHJhXS50YXJnZXQpIHsKICAgICAgICAgICAgaSA9IG5vZGVbJGV4dHJhXS5pbmRleDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhcmdldFBhZ2VBcmVhID0gbm9kZVskZXh0cmFdLnRhcmdldDsKICAgICAgICAgICAgc3RhcnRJbmRleCA9IG5vZGVbJGV4dHJhXS5pbmRleCArIDE7CiAgICAgICAgICAgIGkgPSBJbmZpbml0eTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAodGhpc1skZXh0cmFdLm92ZXJmbG93Tm9kZSkgewogICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXNbJGV4dHJhXS5vdmVyZmxvd05vZGU7CiAgICAgICAgICB0aGlzWyRleHRyYV0ub3ZlcmZsb3dOb2RlID0gbnVsbDsKICAgICAgICAgIGNvbnN0IG92ZXJmbG93RXh0cmEgPSBub2RlWyRnZXRFeHRyYV0oKTsKICAgICAgICAgIGNvbnN0IHRhcmdldCA9IG92ZXJmbG93RXh0cmEudGFyZ2V0OwogICAgICAgICAgb3ZlcmZsb3dFeHRyYS5hZGRMZWFkZXIgPSBvdmVyZmxvd0V4dHJhLmxlYWRlciAhPT0gbnVsbDsKICAgICAgICAgIG92ZXJmbG93RXh0cmEuYWRkVHJhaWxlciA9IG92ZXJmbG93RXh0cmEudHJhaWxlciAhPT0gbnVsbDsKICAgICAgICAgIGZsdXNoKGkpOwogICAgICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gaTsKICAgICAgICAgIGkgPSBJbmZpbml0eTsKICAgICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBQYWdlQXJlYSkgewogICAgICAgICAgICB0YXJnZXRQYWdlQXJlYSA9IHRhcmdldDsKICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgQ29udGVudEFyZWEpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjb250ZW50QXJlYXMuaW5kZXhPZih0YXJnZXQpOwogICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gY3VycmVudEluZGV4KSB7CiAgICAgICAgICAgICAgICBpID0gaW5kZXggLSAxOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGFydEluZGV4ID0gaW5kZXg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRhcmdldFBhZ2VBcmVhID0gdGFyZ2V0WyRnZXRQYXJlbnRdKCk7CiAgICAgICAgICAgICAgc3RhcnRJbmRleCA9IHRhcmdldFBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuLmluZGV4T2YodGFyZ2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZsdXNoKGkpOwogICAgICB9CiAgICAgIHRoaXNbJGV4dHJhXS5wYWdlTnVtYmVyICs9IDE7CiAgICAgIGlmICh0YXJnZXRQYWdlQXJlYSkgewogICAgICAgIGlmICh0YXJnZXRQYWdlQXJlYVskaXNVc2FibGVdKCkpIHsKICAgICAgICAgIHRhcmdldFBhZ2VBcmVhWyRleHRyYV0ubnVtYmVyT2ZVc2UgKz0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICBwYWdlQXJlYSA9IHRhcmdldFBhZ2VBcmVhIHx8IHBhZ2VBcmVhWyRnZXROZXh0UGFnZV0oKTsKICAgICAgeWllbGQgbnVsbDsKICAgIH0KICB9Cn0KY2xhc3MgVGV4dCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidGV4dCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm1heENoYXJzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubWF4Q2hhcnMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmlkID0gYXR0cmlidXRlcy5yaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGFjY2VwdFdoaXRlc3BhY2VdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskb25DaGlsZF0oY2hpbGQpIHsKICAgIGlmIChjaGlsZFskbmFtZXNwYWNlSWRdID09PSBOYW1lc3BhY2VJZHMueGh0bWwuaWQpIHsKICAgICAgdGhpc1skY29udGVudF0gPSBjaGlsZDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIGNvbnRlbnQgaW4gVGV4dDogJHtjaGlsZFskbm9kZU5hbWVdfS5gKTsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRvblRleHRdKHN0cikgewogICAgaWYgKHRoaXNbJGNvbnRlbnRdIGluc3RhbmNlb2YgWEZBT2JqZWN0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN1cGVyWyRvblRleHRdKHN0cik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgaWYgKHR5cGVvZiB0aGlzWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS5yZXBsYWNlQWxsKCJcclxuIiwgIlxuIik7CiAgICB9CiAgfQogIFskZ2V0RXh0cmFdKCkgewogICAgaWYgKHR5cGVvZiB0aGlzWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdLnNwbGl0KC9bXHUyMDI5XHUyMDI4XG5dLykuZmlsdGVyKGxpbmUgPT4gISFsaW5lKS5qb2luKCJcbiIpOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdWyR0ZXh0XSgpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGlmICh0eXBlb2YgdGhpc1skY29udGVudF0gPT09ICJzdHJpbmciKSB7CiAgICAgIGNvbnN0IGh0bWwgPSB2YWx1ZVRvSHRtbCh0aGlzWyRjb250ZW50XSkuaHRtbDsKICAgICAgaWYgKHRoaXNbJGNvbnRlbnRdLmluY2x1ZGVzKCJcdTIwMjkiKSkgewogICAgICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgICAgIGh0bWwuY2hpbGRyZW4gPSBbXTsKICAgICAgICB0aGlzWyRjb250ZW50XS5zcGxpdCgiXHUyMDI5IikubWFwKHBhcmEgPT4gcGFyYS5zcGxpdCgvW1x1MjAyOFxuXS8pLmZsYXRNYXAobGluZSA9PiBbewogICAgICAgICAgbmFtZTogInNwYW4iLAogICAgICAgICAgdmFsdWU6IGxpbmUKICAgICAgICB9LCB7CiAgICAgICAgICBuYW1lOiAiYnIiCiAgICAgICAgfV0pKS5mb3JFYWNoKGxpbmVzID0+IHsKICAgICAgICAgIGh0bWwuY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgICAgIG5hbWU6ICJwIiwKICAgICAgICAgICAgY2hpbGRyZW46IGxpbmVzCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICgvW1x1MjAyOFxuXS8udGVzdCh0aGlzWyRjb250ZW50XSkpIHsKICAgICAgICBodG1sLm5hbWUgPSAiZGl2IjsKICAgICAgICBodG1sLmNoaWxkcmVuID0gW107CiAgICAgICAgdGhpc1skY29udGVudF0uc3BsaXQoL1tcdTIwMjhcbl0vKS5mb3JFYWNoKGxpbmUgPT4gewogICAgICAgICAgaHRtbC5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgbmFtZTogInNwYW4iLAogICAgICAgICAgICB2YWx1ZTogbGluZQogICAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiYnIiCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGh0bWwpOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICB9Cn0KY2xhc3MgVGV4dEVkaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidGV4dEVkaXQiLCB0cnVlKTsKICAgIHRoaXMuYWxsb3dSaWNoVGV4dCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFsbG93UmljaFRleHQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmhTY3JvbGxQb2xpY3kgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oU2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm11bHRpTGluZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm11bHRpTGluZSwKICAgICAgZGVmYXVsdFZhbHVlOiAiIiwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMCB8fCB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnZTY3JvbGxQb2xpY3kgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy52U2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jb21iID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImJvcmRlciIsICJmb250IiwgIm1hcmdpbiIpOwogICAgbGV0IGh0bWw7CiAgICBjb25zdCBmaWVsZCA9IHRoaXNbJGdldFBhcmVudF0oKVskZ2V0UGFyZW50XSgpOwogICAgaWYgKHRoaXMubXVsdGlMaW5lID09PSAiIikgewogICAgICB0aGlzLm11bHRpTGluZSA9IGZpZWxkIGluc3RhbmNlb2YgRHJhdyA/IDEgOiAwOwogICAgfQogICAgaWYgKHRoaXMubXVsdGlMaW5lID09PSAxKSB7CiAgICAgIGh0bWwgPSB7CiAgICAgICAgbmFtZTogInRleHRhcmVhIiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBkYXRhSWQ6IGZpZWxkWyRkYXRhXT8uWyR1aWRdIHx8IGZpZWxkWyR1aWRdLAogICAgICAgICAgZmllbGRJZDogZmllbGRbJHVpZF0sCiAgICAgICAgICBjbGFzczogWyJ4ZmFUZXh0ZmllbGQiXSwKICAgICAgICAgIHN0eWxlLAogICAgICAgICAgImFyaWEtbGFiZWwiOiBhcmlhTGFiZWwoZmllbGQpLAogICAgICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgICAgIH0KICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGh0bWwgPSB7CiAgICAgICAgbmFtZTogImlucHV0IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgICBkYXRhSWQ6IGZpZWxkWyRkYXRhXT8uWyR1aWRdIHx8IGZpZWxkWyR1aWRdLAogICAgICAgICAgZmllbGRJZDogZmllbGRbJHVpZF0sCiAgICAgICAgICBjbGFzczogWyJ4ZmFUZXh0ZmllbGQiXSwKICAgICAgICAgIHN0eWxlLAogICAgICAgICAgImFyaWEtbGFiZWwiOiBhcmlhTGFiZWwoZmllbGQpLAogICAgICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICAgIGlmIChpc1JlcXVpcmVkKGZpZWxkKSkgewogICAgICBodG1sLmF0dHJpYnV0ZXNbImFyaWEtcmVxdWlyZWQiXSA9IHRydWU7CiAgICAgIGh0bWwuYXR0cmlidXRlcy5yZXF1aXJlZCA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImxhYmVsIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYUxhYmVsIl0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFtodG1sXQogICAgfSk7CiAgfQp9CmNsYXNzIFRpbWUgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidGltZSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IGRhdGUgPSB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgICB0aGlzWyRjb250ZW50XSA9IGRhdGUgPyBuZXcgRGF0ZShkYXRlKSA6IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdID8gdGhpc1skY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgVGltZVN0YW1wIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInRpbWVTdGFtcCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnNlcnZlciA9IGF0dHJpYnV0ZXMuc2VydmVyIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFRvb2xUaXAgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidG9vbFRpcCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnJpZCA9IGF0dHJpYnV0ZXMucmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgVHJhdmVyc2FsIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInRyYXZlcnNhbCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy50cmF2ZXJzZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBUcmF2ZXJzZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0cmF2ZXJzZSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm9wZXJhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm9wZXJhdGlvbiwgWyJuZXh0IiwgImJhY2siLCAiZG93biIsICJmaXJzdCIsICJsZWZ0IiwgInJpZ2h0IiwgInVwIl0pOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQogIGdldCBuYW1lKCkgewogICAgcmV0dXJuIHRoaXMub3BlcmF0aW9uOwogIH0KICBbJGlzVHJhbnNwYXJlbnRdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBVaSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ1aSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICAgIHRoaXMuYmFyY29kZSA9IG51bGw7CiAgICB0aGlzLmJ1dHRvbiA9IG51bGw7CiAgICB0aGlzLmNoZWNrQnV0dG9uID0gbnVsbDsKICAgIHRoaXMuY2hvaWNlTGlzdCA9IG51bGw7CiAgICB0aGlzLmRhdGVUaW1lRWRpdCA9IG51bGw7CiAgICB0aGlzLmRlZmF1bHRVaSA9IG51bGw7CiAgICB0aGlzLmltYWdlRWRpdCA9IG51bGw7CiAgICB0aGlzLm51bWVyaWNFZGl0ID0gbnVsbDsKICAgIHRoaXMucGFzc3dvcmRFZGl0ID0gbnVsbDsKICAgIHRoaXMuc2lnbmF0dXJlID0gbnVsbDsKICAgIHRoaXMudGV4dEVkaXQgPSBudWxsOwogIH0KICBbJGdldEV4dHJhXSgpIHsKICAgIGlmICh0aGlzWyRleHRyYV0gPT09IHVuZGVmaW5lZCkgewogICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgICBpZiAobmFtZSA9PT0gImV4dHJhcyIgfHwgbmFtZSA9PT0gInBpY3R1cmUiKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb2JqID0gdGhpc1tuYW1lXTsKICAgICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBYRkFPYmplY3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhpc1skZXh0cmFdID0gb2JqOwogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH0KICAgICAgdGhpc1skZXh0cmFdID0gbnVsbDsKICAgIH0KICAgIHJldHVybiB0aGlzWyRleHRyYV07CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgb2JqID0gdGhpc1skZ2V0RXh0cmFdKCk7CiAgICBpZiAob2JqKSB7CiAgICAgIHJldHVybiBvYmpbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgfQp9CmNsYXNzIFZhbGlkYXRlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInZhbGlkYXRlIiwgdHJ1ZSk7CiAgICB0aGlzLmZvcm1hdFRlc3QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5mb3JtYXRUZXN0LCBbIndhcm5pbmciLCAiZGlzYWJsZWQiLCAiZXJyb3IiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubnVsbFRlc3QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5udWxsVGVzdCwgWyJkaXNhYmxlZCIsICJlcnJvciIsICJ3YXJuaW5nIl0pOwogICAgdGhpcy5zY3JpcHRUZXN0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc2NyaXB0VGVzdCwgWyJlcnJvciIsICJkaXNhYmxlZCIsICJ3YXJuaW5nIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWVzc2FnZSA9IG51bGw7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogIH0KfQpjbGFzcyBWYWx1ZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ2YWx1ZSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm92ZXJyaWRlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMub3ZlcnJpZGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5hcmMgPSBudWxsOwogICAgdGhpcy5ib29sZWFuID0gbnVsbDsKICAgIHRoaXMuZGF0ZSA9IG51bGw7CiAgICB0aGlzLmRhdGVUaW1lID0gbnVsbDsKICAgIHRoaXMuZGVjaW1hbCA9IG51bGw7CiAgICB0aGlzLmV4RGF0YSA9IG51bGw7CiAgICB0aGlzLmZsb2F0ID0gbnVsbDsKICAgIHRoaXMuaW1hZ2UgPSBudWxsOwogICAgdGhpcy5pbnRlZ2VyID0gbnVsbDsKICAgIHRoaXMubGluZSA9IG51bGw7CiAgICB0aGlzLnJlY3RhbmdsZSA9IG51bGw7CiAgICB0aGlzLnRleHQgPSBudWxsOwogICAgdGhpcy50aW1lID0gbnVsbDsKICB9CiAgWyRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBGaWVsZCkgewogICAgICBpZiAocGFyZW50LnVpPy5pbWFnZUVkaXQpIHsKICAgICAgICBpZiAoIXRoaXMuaW1hZ2UpIHsKICAgICAgICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2Uoe30pOwogICAgICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKHRoaXMuaW1hZ2UpOwogICAgICAgIH0KICAgICAgICB0aGlzLmltYWdlWyRjb250ZW50XSA9IHZhbHVlWyRjb250ZW50XTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHZhbHVlTmFtZSA9IHZhbHVlWyRub2RlTmFtZV07CiAgICBpZiAodGhpc1t2YWx1ZU5hbWVdICE9PSBudWxsKSB7CiAgICAgIHRoaXNbdmFsdWVOYW1lXVskY29udGVudF0gPSB2YWx1ZVskY29udGVudF07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBjb25zdCBvYmogPSB0aGlzW25hbWVdOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgWEZBT2JqZWN0KSB7CiAgICAgICAgdGhpc1tuYW1lXSA9IG51bGw7CiAgICAgICAgdGhpc1skcmVtb3ZlQ2hpbGRdKG9iaik7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbdmFsdWVbJG5vZGVOYW1lXV0gPSB2YWx1ZTsKICAgIHRoaXNbJGFwcGVuZENoaWxkXSh2YWx1ZSk7CiAgfQogIFskdGV4dF0oKSB7CiAgICBpZiAodGhpcy5leERhdGEpIHsKICAgICAgaWYgKHR5cGVvZiB0aGlzLmV4RGF0YVskY29udGVudF0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhEYXRhWyRjb250ZW50XS50cmltKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZXhEYXRhWyRjb250ZW50XVskdGV4dF0oKS50cmltKCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgaWYgKG5hbWUgPT09ICJpbWFnZSIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBvYmogPSB0aGlzW25hbWVdOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgWEZBT2JqZWN0KSB7CiAgICAgICAgcmV0dXJuIChvYmpbJGNvbnRlbnRdIHx8ICIiKS50b1N0cmluZygpLnRyaW0oKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIFhGQU9iamVjdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByZXR1cm4gb2JqWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogIH0KfQpjbGFzcyBWYXJpYWJsZXMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidmFyaWFibGVzIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1hbmlmZXN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNjcmlwdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZXh0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRpc1RyYW5zcGFyZW50XSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBUZW1wbGF0ZU5hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChUZW1wbGF0ZU5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICBjb25zdCBub2RlID0gVGVtcGxhdGVOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICAgIG5vZGVbJHNldFNldEF0dHJpYnV0ZXNdKGF0dHJpYnV0ZXMpOwogICAgICByZXR1cm4gbm9kZTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHN0YXRpYyBhcHBlYXJhbmNlRmlsdGVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFwcGVhcmFuY2VGaWx0ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgYXJjKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFyYyhhdHRycyk7CiAgfQogIHN0YXRpYyBhcmVhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgYXNzaXN0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFzc2lzdChhdHRycyk7CiAgfQogIHN0YXRpYyBiYXJjb2RlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJhcmNvZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgYmluZChhdHRycykgewogICAgcmV0dXJuIG5ldyBCaW5kKGF0dHJzKTsKICB9CiAgc3RhdGljIGJpbmRJdGVtcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBCaW5kSXRlbXMoYXR0cnMpOwogIH0KICBzdGF0aWMgYm9va2VuZChhdHRycykgewogICAgcmV0dXJuIG5ldyBCb29rZW5kKGF0dHJzKTsKICB9CiAgc3RhdGljIGJvb2xlYW4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQm9vbGVhbkVsZW1lbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgYm9yZGVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJvcmRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBicmVhayhhdHRycykgewogICAgcmV0dXJuIG5ldyBCcmVhayhhdHRycyk7CiAgfQogIHN0YXRpYyBicmVha0FmdGVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJyZWFrQWZ0ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgYnJlYWtCZWZvcmUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQnJlYWtCZWZvcmUoYXR0cnMpOwogIH0KICBzdGF0aWMgYnV0dG9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJ1dHRvbihhdHRycyk7CiAgfQogIHN0YXRpYyBjYWxjdWxhdGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2FsY3VsYXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNhcHRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2FwdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBjZXJ0aWZpY2F0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDZXJ0aWZpY2F0ZShhdHRycyk7CiAgfQogIHN0YXRpYyBjZXJ0aWZpY2F0ZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2VydGlmaWNhdGVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGNoZWNrQnV0dG9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENoZWNrQnV0dG9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNob2ljZUxpc3QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2hvaWNlTGlzdChhdHRycyk7CiAgfQogIHN0YXRpYyBjb2xvcihhdHRycykgewogICAgcmV0dXJuIG5ldyBDb2xvcihhdHRycyk7CiAgfQogIHN0YXRpYyBjb21iKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbWIoYXR0cnMpOwogIH0KICBzdGF0aWMgY29ubmVjdChhdHRycykgewogICAgcmV0dXJuIG5ldyBDb25uZWN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbnRlbnRBcmVhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbnRlbnRBcmVhKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvcm5lcihhdHRycykgewogICAgcmV0dXJuIG5ldyBDb3JuZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlRWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlVGltZShhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlVGltZShhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlVGltZUVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGF0ZVRpbWVFZGl0KGF0dHJzKTsKICB9CiAgc3RhdGljIGRlY2ltYWwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGVjaW1hbChhdHRycyk7CiAgfQogIHN0YXRpYyBkZWZhdWx0VWkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGVmYXVsdFVpKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlc2MoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGVzYyhhdHRycyk7CiAgfQogIHN0YXRpYyBkaWdlc3RNZXRob2QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGlnZXN0TWV0aG9kKGF0dHJzKTsKICB9CiAgc3RhdGljIGRpZ2VzdE1ldGhvZHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGlnZXN0TWV0aG9kcyhhdHRycyk7CiAgfQogIHN0YXRpYyBkcmF3KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERyYXcoYXR0cnMpOwogIH0KICBzdGF0aWMgZWRnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFZGdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY29kaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY29kaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY29kaW5ncyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNvZGluZ3MoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0KGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHREYXRhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY3J5cHREYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0aW9uTWV0aG9kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY3J5cHRpb25NZXRob2QoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdGlvbk1ldGhvZHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdGlvbk1ldGhvZHMoYXR0cnMpOwogIH0KICBzdGF0aWMgZXZlbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXZlbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgZXhEYXRhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4RGF0YShhdHRycyk7CiAgfQogIHN0YXRpYyBleE9iamVjdChhdHRycykgewogICAgcmV0dXJuIG5ldyBFeE9iamVjdChhdHRycyk7CiAgfQogIHN0YXRpYyBleGNsR3JvdXAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXhjbEdyb3VwKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4ZWN1dGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXhlY3V0ZShhdHRycyk7CiAgfQogIHN0YXRpYyBleHRyYXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXh0cmFzKGF0dHJzKTsKICB9CiAgc3RhdGljIGZpZWxkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEZpZWxkKGF0dHJzKTsKICB9CiAgc3RhdGljIGZpbGwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmlsbChhdHRycyk7CiAgfQogIHN0YXRpYyBmaWx0ZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmlsdGVyKGF0dHJzKTsKICB9CiAgc3RhdGljIGZsb2F0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEZsb2F0KGF0dHJzKTsKICB9CiAgc3RhdGljIGZvbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgdGVtcGxhdGVfRm9udChhdHRycyk7CiAgfQogIHN0YXRpYyBmb3JtYXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRm9ybWF0KGF0dHJzKTsKICB9CiAgc3RhdGljIGhhbmRsZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSGFuZGxlcihhdHRycyk7CiAgfQogIHN0YXRpYyBoeXBoZW5hdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBIeXBoZW5hdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBpbWFnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBJbWFnZShhdHRycyk7CiAgfQogIHN0YXRpYyBpbWFnZUVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSW1hZ2VFZGl0KGF0dHJzKTsKICB9CiAgc3RhdGljIGludGVnZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSW50ZWdlcihhdHRycyk7CiAgfQogIHN0YXRpYyBpc3N1ZXJzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IElzc3VlcnMoYXR0cnMpOwogIH0KICBzdGF0aWMgaXRlbXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSXRlbXMoYXR0cnMpOwogIH0KICBzdGF0aWMga2VlcChhdHRycykgewogICAgcmV0dXJuIG5ldyBLZWVwKGF0dHJzKTsKICB9CiAgc3RhdGljIGtleVVzYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEtleVVzYWdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGxpbmUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTGluZShhdHRycyk7CiAgfQogIHN0YXRpYyBsaW5lYXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTGluZWFyKGF0dHJzKTsKICB9CiAgc3RhdGljIGxvY2tEb2N1bWVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBMb2NrRG9jdW1lbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgbWFuaWZlc3QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWFuaWZlc3QoYXR0cnMpOwogIH0KICBzdGF0aWMgbWFyZ2luKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1hcmdpbihhdHRycyk7CiAgfQogIHN0YXRpYyBtZHAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWRwKGF0dHJzKTsKICB9CiAgc3RhdGljIG1lZGl1bShhdHRycykgewogICAgcmV0dXJuIG5ldyBNZWRpdW0oYXR0cnMpOwogIH0KICBzdGF0aWMgbWVzc2FnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBNZXNzYWdlKGF0dHJzKTsKICB9CiAgc3RhdGljIG51bWVyaWNFZGl0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE51bWVyaWNFZGl0KGF0dHJzKTsKICB9CiAgc3RhdGljIG9jY3VyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9jY3VyKGF0dHJzKTsKICB9CiAgc3RhdGljIG9pZChhdHRycykgewogICAgcmV0dXJuIG5ldyBPaWQoYXR0cnMpOwogIH0KICBzdGF0aWMgb2lkcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBPaWRzKGF0dHJzKTsKICB9CiAgc3RhdGljIG92ZXJmbG93KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE92ZXJmbG93KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2VBcmVhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBhZ2VBcmVhKGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2VTZXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnZVNldChhdHRycyk7CiAgfQogIHN0YXRpYyBwYXJhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBhcmEoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFzc3dvcmRFZGl0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBhc3N3b3JkRWRpdChhdHRycyk7CiAgfQogIHN0YXRpYyBwYXR0ZXJuKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IHRlbXBsYXRlX1BhdHRlcm4oYXR0cnMpOwogIH0KICBzdGF0aWMgcGljdHVyZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQaWN0dXJlKGF0dHJzKTsKICB9CiAgc3RhdGljIHByb3RvKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByb3RvKGF0dHJzKTsKICB9CiAgc3RhdGljIHJhZGlhbChhdHRycykgewogICAgcmV0dXJuIG5ldyBSYWRpYWwoYXR0cnMpOwogIH0KICBzdGF0aWMgcmVhc29uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlYXNvbihhdHRycyk7CiAgfQogIHN0YXRpYyByZWFzb25zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlYXNvbnMoYXR0cnMpOwogIH0KICBzdGF0aWMgcmVjdGFuZ2xlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlY3RhbmdsZShhdHRycyk7CiAgfQogIHN0YXRpYyByZWYoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVmRWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBzY3JpcHQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU2NyaXB0KGF0dHJzKTsKICB9CiAgc3RhdGljIHNldFByb3BlcnR5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNldFByb3BlcnR5KGF0dHJzKTsKICB9CiAgc3RhdGljIHNpZ25EYXRhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25EYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIHNpZ25hdHVyZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTaWduYXR1cmUoYXR0cnMpOwogIH0KICBzdGF0aWMgc2lnbmluZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBTaWduaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIHNvbGlkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNvbGlkKGF0dHJzKTsKICB9CiAgc3RhdGljIHNwZWFrKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNwZWFrKGF0dHJzKTsKICB9CiAgc3RhdGljIHN0aXBwbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3RpcHBsZShhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJmb3JtKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmZvcm0oYXR0cnMpOwogIH0KICBzdGF0aWMgc3ViZm9ybVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJmb3JtU2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIHN1YmplY3RETihhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJqZWN0RE4oYXR0cnMpOwogIH0KICBzdGF0aWMgc3ViamVjdEROcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJqZWN0RE5zKGF0dHJzKTsKICB9CiAgc3RhdGljIHN1Ym1pdChhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJtaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgdGVtcGxhdGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGVtcGxhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdGV4dChhdHRycykgewogICAgcmV0dXJuIG5ldyBUZXh0KGF0dHJzKTsKICB9CiAgc3RhdGljIHRleHRFZGl0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRleHRFZGl0KGF0dHJzKTsKICB9CiAgc3RhdGljIHRpbWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGltZShhdHRycyk7CiAgfQogIHN0YXRpYyB0aW1lU3RhbXAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGltZVN0YW1wKGF0dHJzKTsKICB9CiAgc3RhdGljIHRvb2xUaXAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVG9vbFRpcChhdHRycyk7CiAgfQogIHN0YXRpYyB0cmF2ZXJzYWwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhdmVyc2FsKGF0dHJzKTsKICB9CiAgc3RhdGljIHRyYXZlcnNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRyYXZlcnNlKGF0dHJzKTsKICB9CiAgc3RhdGljIHVpKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFVpKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhbGlkYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhbGlkYXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhbHVlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhbHVlKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhcmlhYmxlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBWYXJpYWJsZXMoYXR0cnMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2JpbmQuanMKCgoKCgoKY29uc3QgYmluZF9OU19EQVRBU0VUUyA9IE5hbWVzcGFjZUlkcy5kYXRhc2V0cy5pZDsKZnVuY3Rpb24gY3JlYXRlVGV4dChjb250ZW50KSB7CiAgY29uc3Qgbm9kZSA9IG5ldyBUZXh0KHt9KTsKICBub2RlWyRjb250ZW50XSA9IGNvbnRlbnQ7CiAgcmV0dXJuIG5vZGU7Cn0KY2xhc3MgQmluZGVyIHsKICBjb25zdHJ1Y3Rvcihyb290KSB7CiAgICB0aGlzLnJvb3QgPSByb290OwogICAgdGhpcy5kYXRhc2V0cyA9IHJvb3QuZGF0YXNldHM7CiAgICB0aGlzLmRhdGEgPSByb290LmRhdGFzZXRzPy5kYXRhIHx8IG5ldyBYbWxPYmplY3QoTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkLCAiZGF0YSIpOwogICAgdGhpcy5lbXB0eU1lcmdlID0gdGhpcy5kYXRhWyRnZXRDaGlsZHJlbl0oKS5sZW5ndGggPT09IDA7CiAgICB0aGlzLnJvb3QuZm9ybSA9IHRoaXMuZm9ybSA9IHJvb3QudGVtcGxhdGVbJGNsb25lXSgpOwogIH0KICBfaXNDb25zdW1lRGF0YSgpIHsKICAgIHJldHVybiAhdGhpcy5lbXB0eU1lcmdlICYmIHRoaXMuX21lcmdlTW9kZTsKICB9CiAgX2lzTWF0Y2hUZW1wbGF0ZSgpIHsKICAgIHJldHVybiAhdGhpcy5faXNDb25zdW1lRGF0YSgpOwogIH0KICBiaW5kKCkgewogICAgdGhpcy5fYmluZEVsZW1lbnQodGhpcy5mb3JtLCB0aGlzLmRhdGEpOwogICAgcmV0dXJuIHRoaXMuZm9ybTsKICB9CiAgZ2V0RGF0YSgpIHsKICAgIHJldHVybiB0aGlzLmRhdGE7CiAgfQogIF9iaW5kVmFsdWUoZm9ybU5vZGUsIGRhdGEsIHBpY3R1cmUpIHsKICAgIGZvcm1Ob2RlWyRkYXRhXSA9IGRhdGE7CiAgICBpZiAoZm9ybU5vZGVbJGhhc1NldHRhYmxlVmFsdWVdKCkpIHsKICAgICAgaWYgKGRhdGFbJGlzRGF0YVZhbHVlXSgpKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhWyRnZXREYXRhVmFsdWVdKCk7CiAgICAgICAgZm9ybU5vZGVbJHNldFZhbHVlXShjcmVhdGVUZXh0KHZhbHVlKSk7CiAgICAgIH0gZWxzZSBpZiAoZm9ybU5vZGUgaW5zdGFuY2VvZiBGaWVsZCAmJiBmb3JtTm9kZS51aT8uY2hvaWNlTGlzdD8ub3BlbiA9PT0gIm11bHRpU2VsZWN0IikgewogICAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVskZ2V0Q2hpbGRyZW5dKCkubWFwKGNoaWxkID0+IGNoaWxkWyRjb250ZW50XS50cmltKCkpLmpvaW4oIlxuIik7CiAgICAgICAgZm9ybU5vZGVbJHNldFZhbHVlXShjcmVhdGVUZXh0KHZhbHVlKSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5faXNDb25zdW1lRGF0YSgpKSB7CiAgICAgICAgd2FybihgWEZBIC0gTm9kZXMgaGF2ZW4ndCB0aGUgc2FtZSB0eXBlLmApOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCFkYXRhWyRpc0RhdGFWYWx1ZV0oKSB8fCB0aGlzLl9pc01hdGNoVGVtcGxhdGUoKSkgewogICAgICB0aGlzLl9iaW5kRWxlbWVudChmb3JtTm9kZSwgZGF0YSk7CiAgICB9IGVsc2UgewogICAgICB3YXJuKGBYRkEgLSBOb2RlcyBoYXZlbid0IHRoZSBzYW1lIHR5cGUuYCk7CiAgICB9CiAgfQogIF9maW5kRGF0YUJ5TmFtZVRvQ29uc3VtZShuYW1lLCBpc1ZhbHVlLCBkYXRhTm9kZSwgZ2xvYmFsKSB7CiAgICBpZiAoIW5hbWUpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgZ2VuZXJhdG9yLCBtYXRjaDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgIGdlbmVyYXRvciA9IGRhdGFOb2RlWyRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgZmFsc2UsIHRydWUpOwogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIG1hdGNoID0gZ2VuZXJhdG9yLm5leHQoKS52YWx1ZTsKICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGlzVmFsdWUgPT09IG1hdGNoWyRpc0RhdGFWYWx1ZV0oKSkgewogICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZGF0YU5vZGVbJG5hbWVzcGFjZUlkXSA9PT0gTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkICYmIGRhdGFOb2RlWyRub2RlTmFtZV0gPT09ICJkYXRhIikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGRhdGFOb2RlID0gZGF0YU5vZGVbJGdldFBhcmVudF0oKTsKICAgIH0KICAgIGlmICghZ2xvYmFsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZ2VuZXJhdG9yID0gdGhpcy5kYXRhWyRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgdHJ1ZSwgZmFsc2UpOwogICAgbWF0Y2ggPSBnZW5lcmF0b3IubmV4dCgpLnZhbHVlOwogICAgaWYgKG1hdGNoKSB7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0KICAgIGdlbmVyYXRvciA9IHRoaXMuZGF0YVskZ2V0QXR0cmlidXRlSXRdKG5hbWUsIHRydWUpOwogICAgbWF0Y2ggPSBnZW5lcmF0b3IubmV4dCgpLnZhbHVlOwogICAgaWYgKG1hdGNoPy5bJGlzRGF0YVZhbHVlXSgpKSB7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBfc2V0UHJvcGVydGllcyhmb3JtTm9kZSwgZGF0YU5vZGUpIHsKICAgIGlmICghZm9ybU5vZGUuaGFzT3duUHJvcGVydHkoInNldFByb3BlcnR5IikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCB7CiAgICAgIHJlZiwKICAgICAgdGFyZ2V0LAogICAgICBjb25uZWN0aW9uCiAgICB9IG9mIGZvcm1Ob2RlLnNldFByb3BlcnR5LmNoaWxkcmVuKSB7CiAgICAgIGlmIChjb25uZWN0aW9uKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFyZWYpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBub2RlcyA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBkYXRhTm9kZSwgcmVmLCBmYWxzZSwgZmFsc2UpOwogICAgICBpZiAoIW5vZGVzKSB7CiAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCByZWZlcmVuY2U6ICR7cmVmfS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBbbm9kZV0gPSBub2RlczsKICAgICAgaWYgKCFub2RlWyRpc0Rlc2NlbmRlbnRdKHRoaXMuZGF0YSkpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIG5vZGU6IG11c3QgYmUgYSBkYXRhIG5vZGUuYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdGFyZ2V0Tm9kZXMgPSBzZWFyY2hOb2RlKHRoaXMucm9vdCwgZm9ybU5vZGUsIHRhcmdldCwgZmFsc2UsIGZhbHNlKTsKICAgICAgaWYgKCF0YXJnZXROb2RlcykgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgdGFyZ2V0OiAke3RhcmdldH0uYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgW3RhcmdldE5vZGVdID0gdGFyZ2V0Tm9kZXM7CiAgICAgIGlmICghdGFyZ2V0Tm9kZVskaXNEZXNjZW5kZW50XShmb3JtTm9kZSkpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHRhcmdldDogbXVzdCBiZSBhIHByb3BlcnR5IG9yIHN1YnByb3BlcnR5LmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHRhcmdldFBhcmVudCA9IHRhcmdldE5vZGVbJGdldFBhcmVudF0oKTsKICAgICAgaWYgKHRhcmdldE5vZGUgaW5zdGFuY2VvZiBTZXRQcm9wZXJ0eSB8fCB0YXJnZXRQYXJlbnQgaW5zdGFuY2VvZiBTZXRQcm9wZXJ0eSkgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgdGFyZ2V0OiBjYW5ub3QgYmUgYSBzZXRQcm9wZXJ0eSBvciBvbmUgb2YgaXRzIHByb3BlcnRpZXMuYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHRhcmdldE5vZGUgaW5zdGFuY2VvZiBCaW5kSXRlbXMgfHwgdGFyZ2V0UGFyZW50IGluc3RhbmNlb2YgQmluZEl0ZW1zKSB7CiAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCB0YXJnZXQ6IGNhbm5vdCBiZSBhIGJpbmRJdGVtcyBvciBvbmUgb2YgaXRzIHByb3BlcnRpZXMuYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgY29udGVudCA9IG5vZGVbJHRleHRdKCk7CiAgICAgIGNvbnN0IG5hbWUgPSB0YXJnZXROb2RlWyRub2RlTmFtZV07CiAgICAgIGlmICh0YXJnZXROb2RlIGluc3RhbmNlb2YgWEZBQXR0cmlidXRlKSB7CiAgICAgICAgY29uc3QgYXR0cnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIGF0dHJzW25hbWVdID0gY29udGVudDsKICAgICAgICBjb25zdCBvYmogPSBSZWZsZWN0LmNvbnN0cnVjdChPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0UGFyZW50KS5jb25zdHJ1Y3RvciwgW2F0dHJzXSk7CiAgICAgICAgdGFyZ2V0UGFyZW50W25hbWVdID0gb2JqW25hbWVdOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghdGFyZ2V0Tm9kZS5oYXNPd25Qcm9wZXJ0eSgkY29udGVudCkpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIG5vZGUgdG8gdXNlIGluIHNldFByb3BlcnR5YCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGFyZ2V0Tm9kZVskZGF0YV0gPSBub2RlOwogICAgICB0YXJnZXROb2RlWyRjb250ZW50XSA9IGNvbnRlbnQ7CiAgICAgIHRhcmdldE5vZGVbJGZpbmFsaXplXSgpOwogICAgfQogIH0KICBfYmluZEl0ZW1zKGZvcm1Ob2RlLCBkYXRhTm9kZSkgewogICAgaWYgKCFmb3JtTm9kZS5oYXNPd25Qcm9wZXJ0eSgiaXRlbXMiKSB8fCAhZm9ybU5vZGUuaGFzT3duUHJvcGVydHkoImJpbmRJdGVtcyIpIHx8IGZvcm1Ob2RlLmJpbmRJdGVtcy5pc0VtcHR5KCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBpdGVtIG9mIGZvcm1Ob2RlLml0ZW1zLmNoaWxkcmVuKSB7CiAgICAgIGZvcm1Ob2RlWyRyZW1vdmVDaGlsZF0oaXRlbSk7CiAgICB9CiAgICBmb3JtTm9kZS5pdGVtcy5jbGVhcigpOwogICAgY29uc3QgbGFiZWxzID0gbmV3IEl0ZW1zKHt9KTsKICAgIGNvbnN0IHZhbHVlcyA9IG5ldyBJdGVtcyh7fSk7CiAgICBmb3JtTm9kZVskYXBwZW5kQ2hpbGRdKGxhYmVscyk7CiAgICBmb3JtTm9kZS5pdGVtcy5wdXNoKGxhYmVscyk7CiAgICBmb3JtTm9kZVskYXBwZW5kQ2hpbGRdKHZhbHVlcyk7CiAgICBmb3JtTm9kZS5pdGVtcy5wdXNoKHZhbHVlcyk7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcmVmLAogICAgICBsYWJlbFJlZiwKICAgICAgdmFsdWVSZWYsCiAgICAgIGNvbm5lY3Rpb24KICAgIH0gb2YgZm9ybU5vZGUuYmluZEl0ZW1zLmNoaWxkcmVuKSB7CiAgICAgIGlmIChjb25uZWN0aW9uKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFyZWYpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBub2RlcyA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBkYXRhTm9kZSwgcmVmLCBmYWxzZSwgZmFsc2UpOwogICAgICBpZiAoIW5vZGVzKSB7CiAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCByZWZlcmVuY2U6ICR7cmVmfS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHsKICAgICAgICBpZiAoIW5vZGVbJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhc2V0cykpIHsKICAgICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgcmVmICgke3JlZn0pOiBtdXN0IGJlIGEgZGF0YXNldHMgY2hpbGQuYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbGFiZWxOb2RlcyA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBub2RlLCBsYWJlbFJlZiwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIGlmICghbGFiZWxOb2RlcykgewogICAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCBsYWJlbDogJHtsYWJlbFJlZn0uYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgW2xhYmVsTm9kZV0gPSBsYWJlbE5vZGVzOwogICAgICAgIGlmICghbGFiZWxOb2RlWyRpc0Rlc2NlbmRlbnRdKHRoaXMuZGF0YXNldHMpKSB7CiAgICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIGxhYmVsOiBtdXN0IGJlIGEgZGF0YXNldHMgY2hpbGQuYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsdWVOb2RlcyA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBub2RlLCB2YWx1ZVJlZiwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIGlmICghdmFsdWVOb2RlcykgewogICAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCB2YWx1ZTogJHt2YWx1ZVJlZn0uYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgW3ZhbHVlTm9kZV0gPSB2YWx1ZU5vZGVzOwogICAgICAgIGlmICghdmFsdWVOb2RlWyRpc0Rlc2NlbmRlbnRdKHRoaXMuZGF0YXNldHMpKSB7CiAgICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHZhbHVlOiBtdXN0IGJlIGEgZGF0YXNldHMgY2hpbGQuYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbGFiZWwgPSBjcmVhdGVUZXh0KGxhYmVsTm9kZVskdGV4dF0oKSk7CiAgICAgICAgY29uc3QgdmFsdWUgPSBjcmVhdGVUZXh0KHZhbHVlTm9kZVskdGV4dF0oKSk7CiAgICAgICAgbGFiZWxzWyRhcHBlbmRDaGlsZF0obGFiZWwpOwogICAgICAgIGxhYmVscy50ZXh0LnB1c2gobGFiZWwpOwogICAgICAgIHZhbHVlc1skYXBwZW5kQ2hpbGRdKHZhbHVlKTsKICAgICAgICB2YWx1ZXMudGV4dC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogIH0KICBfYmluZE9jY3VycmVuY2VzKGZvcm1Ob2RlLCBtYXRjaGVzLCBwaWN0dXJlKSB7CiAgICBsZXQgYmFzZUNsb25lOwogICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gMSkgewogICAgICBiYXNlQ2xvbmUgPSBmb3JtTm9kZVskY2xvbmVdKCk7CiAgICAgIGJhc2VDbG9uZVskcmVtb3ZlQ2hpbGRdKGJhc2VDbG9uZS5vY2N1cik7CiAgICAgIGJhc2VDbG9uZS5vY2N1ciA9IG51bGw7CiAgICB9CiAgICB0aGlzLl9iaW5kVmFsdWUoZm9ybU5vZGUsIG1hdGNoZXNbMF0sIHBpY3R1cmUpOwogICAgdGhpcy5fc2V0UHJvcGVydGllcyhmb3JtTm9kZSwgbWF0Y2hlc1swXSk7CiAgICB0aGlzLl9iaW5kSXRlbXMoZm9ybU5vZGUsIG1hdGNoZXNbMF0pOwogICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAxKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBhcmVudCA9IGZvcm1Ob2RlWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBuYW1lID0gZm9ybU5vZGVbJG5vZGVOYW1lXTsKICAgIGNvbnN0IHBvcyA9IHBhcmVudFskaW5kZXhPZl0oZm9ybU5vZGUpOwogICAgZm9yIChsZXQgaSA9IDEsIGlpID0gbWF0Y2hlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IG1hdGNoID0gbWF0Y2hlc1tpXTsKICAgICAgY29uc3QgY2xvbmUgPSBiYXNlQ2xvbmVbJGNsb25lXSgpOwogICAgICBwYXJlbnRbbmFtZV0ucHVzaChjbG9uZSk7CiAgICAgIHBhcmVudFskaW5zZXJ0QXRdKHBvcyArIGksIGNsb25lKTsKICAgICAgdGhpcy5fYmluZFZhbHVlKGNsb25lLCBtYXRjaCwgcGljdHVyZSk7CiAgICAgIHRoaXMuX3NldFByb3BlcnRpZXMoY2xvbmUsIG1hdGNoKTsKICAgICAgdGhpcy5fYmluZEl0ZW1zKGNsb25lLCBtYXRjaCk7CiAgICB9CiAgfQogIF9jcmVhdGVPY2N1cnJlbmNlcyhmb3JtTm9kZSkgewogICAgaWYgKCF0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgewogICAgICBvY2N1cgogICAgfSA9IGZvcm1Ob2RlOwogICAgaWYgKCFvY2N1ciB8fCBvY2N1ci5pbml0aWFsIDw9IDEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFyZW50ID0gZm9ybU5vZGVbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IG5hbWUgPSBmb3JtTm9kZVskbm9kZU5hbWVdOwogICAgaWYgKCEocGFyZW50W25hbWVdIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBjdXJyZW50TnVtYmVyOwogICAgaWYgKGZvcm1Ob2RlLm5hbWUpIHsKICAgICAgY3VycmVudE51bWJlciA9IHBhcmVudFtuYW1lXS5jaGlsZHJlbi5maWx0ZXIoZSA9PiBlLm5hbWUgPT09IGZvcm1Ob2RlLm5hbWUpLmxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnROdW1iZXIgPSBwYXJlbnRbbmFtZV0uY2hpbGRyZW4ubGVuZ3RoOwogICAgfQogICAgY29uc3QgcG9zID0gcGFyZW50WyRpbmRleE9mXShmb3JtTm9kZSkgKyAxOwogICAgY29uc3QgaWkgPSBvY2N1ci5pbml0aWFsIC0gY3VycmVudE51bWJlcjsKICAgIGlmIChpaSkgewogICAgICBjb25zdCBub2RlQ2xvbmUgPSBmb3JtTm9kZVskY2xvbmVdKCk7CiAgICAgIG5vZGVDbG9uZVskcmVtb3ZlQ2hpbGRdKG5vZGVDbG9uZS5vY2N1cik7CiAgICAgIG5vZGVDbG9uZS5vY2N1ciA9IG51bGw7CiAgICAgIHBhcmVudFtuYW1lXS5wdXNoKG5vZGVDbG9uZSk7CiAgICAgIHBhcmVudFskaW5zZXJ0QXRdKHBvcywgbm9kZUNsb25lKTsKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgY2xvbmUgPSBub2RlQ2xvbmVbJGNsb25lXSgpOwogICAgICAgIHBhcmVudFtuYW1lXS5wdXNoKGNsb25lKTsKICAgICAgICBwYXJlbnRbJGluc2VydEF0XShwb3MgKyBpLCBjbG9uZSk7CiAgICAgIH0KICAgIH0KICB9CiAgX2dldE9jY3VySW5mbyhmb3JtTm9kZSkgewogICAgY29uc3QgewogICAgICBuYW1lLAogICAgICBvY2N1cgogICAgfSA9IGZvcm1Ob2RlOwogICAgaWYgKCFvY2N1ciB8fCAhbmFtZSkgewogICAgICByZXR1cm4gWzEsIDFdOwogICAgfQogICAgY29uc3QgbWF4ID0gb2NjdXIubWF4ID09PSAtMSA/IEluZmluaXR5IDogb2NjdXIubWF4OwogICAgcmV0dXJuIFtvY2N1ci5taW4sIG1heF07CiAgfQogIF9zZXRBbmRCaW5kKGZvcm1Ob2RlLCBkYXRhTm9kZSkgewogICAgdGhpcy5fc2V0UHJvcGVydGllcyhmb3JtTm9kZSwgZGF0YU5vZGUpOwogICAgdGhpcy5fYmluZEl0ZW1zKGZvcm1Ob2RlLCBkYXRhTm9kZSk7CiAgICB0aGlzLl9iaW5kRWxlbWVudChmb3JtTm9kZSwgZGF0YU5vZGUpOwogIH0KICBfYmluZEVsZW1lbnQoZm9ybU5vZGUsIGRhdGFOb2RlKSB7CiAgICBjb25zdCB1c2VsZXNzTm9kZXMgPSBbXTsKICAgIHRoaXMuX2NyZWF0ZU9jY3VycmVuY2VzKGZvcm1Ob2RlKTsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgZm9ybU5vZGVbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgIGlmIChjaGlsZFskZGF0YV0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodGhpcy5fbWVyZ2VNb2RlID09PSB1bmRlZmluZWQgJiYgY2hpbGRbJG5vZGVOYW1lXSA9PT0gInN1YmZvcm0iKSB7CiAgICAgICAgdGhpcy5fbWVyZ2VNb2RlID0gY2hpbGQubWVyZ2VNb2RlID09PSAiY29uc3VtZURhdGEiOwogICAgICAgIGNvbnN0IGRhdGFDaGlsZHJlbiA9IGRhdGFOb2RlWyRnZXRDaGlsZHJlbl0oKTsKICAgICAgICBpZiAoZGF0YUNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMuX2JpbmRPY2N1cnJlbmNlcyhjaGlsZCwgW2RhdGFDaGlsZHJlblswXV0sIG51bGwpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5lbXB0eU1lcmdlKSB7CiAgICAgICAgICBjb25zdCBuc0lkID0gZGF0YU5vZGVbJG5hbWVzcGFjZUlkXSA9PT0gYmluZF9OU19EQVRBU0VUUyA/IC0xIDogZGF0YU5vZGVbJG5hbWVzcGFjZUlkXTsKICAgICAgICAgIGNvbnN0IGRhdGFDaGlsZCA9IGNoaWxkWyRkYXRhXSA9IG5ldyBYbWxPYmplY3QobnNJZCwgY2hpbGQubmFtZSB8fCAicm9vdCIpOwogICAgICAgICAgZGF0YU5vZGVbJGFwcGVuZENoaWxkXShkYXRhQ2hpbGQpOwogICAgICAgICAgdGhpcy5fYmluZEVsZW1lbnQoY2hpbGQsIGRhdGFDaGlsZCk7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghY2hpbGRbJGlzQmluZGFibGVdKCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgZ2xvYmFsID0gZmFsc2U7CiAgICAgIGxldCBwaWN0dXJlID0gbnVsbDsKICAgICAgbGV0IHJlZiA9IG51bGw7CiAgICAgIGxldCBtYXRjaCA9IG51bGw7CiAgICAgIGlmIChjaGlsZC5iaW5kKSB7CiAgICAgICAgc3dpdGNoIChjaGlsZC5iaW5kLm1hdGNoKSB7CiAgICAgICAgICBjYXNlICJub25lIjoKICAgICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgZGF0YU5vZGUpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGNhc2UgImdsb2JhbCI6CiAgICAgICAgICAgIGdsb2JhbCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiZGF0YVJlZiI6CiAgICAgICAgICAgIGlmICghY2hpbGQuYmluZC5yZWYpIHsKICAgICAgICAgICAgICB3YXJuKGBYRkEgLSByZWYgaXMgZW1wdHkgaW4gbm9kZSAke2NoaWxkWyRub2RlTmFtZV19LmApOwogICAgICAgICAgICAgIHRoaXMuX3NldEFuZEJpbmQoY2hpbGQsIGRhdGFOb2RlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWYgPSBjaGlsZC5iaW5kLnJlZjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGNoaWxkLmJpbmQucGljdHVyZSkgewogICAgICAgICAgcGljdHVyZSA9IGNoaWxkLmJpbmQucGljdHVyZVskY29udGVudF07CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IFttaW4sIG1heF0gPSB0aGlzLl9nZXRPY2N1ckluZm8oY2hpbGQpOwogICAgICBpZiAocmVmKSB7CiAgICAgICAgbWF0Y2ggPSBzZWFyY2hOb2RlKHRoaXMucm9vdCwgZGF0YU5vZGUsIHJlZiwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkgewogICAgICAgICAgbWF0Y2ggPSBjcmVhdGVEYXRhTm9kZSh0aGlzLmRhdGEsIGRhdGFOb2RlLCByZWYpOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICAgICAgbWF0Y2hbJGNvbnN1bWVkXSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9zZXRBbmRCaW5kKGNoaWxkLCBtYXRjaCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRoaXMuX2lzQ29uc3VtZURhdGEoKSkgewogICAgICAgICAgICBtYXRjaCA9IG1hdGNoLmZpbHRlcihub2RlID0+ICFub2RlWyRjb25zdW1lZF0pOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+IG1heCkgewogICAgICAgICAgICBtYXRjaCA9IG1hdGNoLnNsaWNlKDAsIG1heCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBtYXRjaCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobWF0Y2ggJiYgdGhpcy5faXNDb25zdW1lRGF0YSgpKSB7CiAgICAgICAgICAgIG1hdGNoLmZvckVhY2gobm9kZSA9PiB7CiAgICAgICAgICAgICAgbm9kZVskY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghY2hpbGQubmFtZSkgewogICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgZGF0YU5vZGUpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbXTsKICAgICAgICAgIHdoaWxlIChtYXRjaGVzLmxlbmd0aCA8IG1heCkgewogICAgICAgICAgICBjb25zdCBmb3VuZCA9IHRoaXMuX2ZpbmREYXRhQnlOYW1lVG9Db25zdW1lKGNoaWxkLm5hbWUsIGNoaWxkWyRoYXNTZXR0YWJsZVZhbHVlXSgpLCBkYXRhTm9kZSwgZ2xvYmFsKTsKICAgICAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvdW5kWyRjb25zdW1lZF0gPSB0cnVlOwogICAgICAgICAgICBtYXRjaGVzLnB1c2goZm91bmQpOwogICAgICAgICAgfQogICAgICAgICAgbWF0Y2ggPSBtYXRjaGVzLmxlbmd0aCA+IDAgPyBtYXRjaGVzIDogbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0Y2ggPSBkYXRhTm9kZVskZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXRdKGNoaWxkLm5hbWUsIGZhbHNlLCB0aGlzLmVtcHR5TWVyZ2UpLm5leHQoKS52YWx1ZTsKICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgaWYgKG1pbiA9PT0gMCkgewogICAgICAgICAgICAgIHVzZWxlc3NOb2Rlcy5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBuc0lkID0gZGF0YU5vZGVbJG5hbWVzcGFjZUlkXSA9PT0gYmluZF9OU19EQVRBU0VUUyA/IC0xIDogZGF0YU5vZGVbJG5hbWVzcGFjZUlkXTsKICAgICAgICAgICAgbWF0Y2ggPSBjaGlsZFskZGF0YV0gPSBuZXcgWG1sT2JqZWN0KG5zSWQsIGNoaWxkLm5hbWUpOwogICAgICAgICAgICBpZiAodGhpcy5lbXB0eU1lcmdlKSB7CiAgICAgICAgICAgICAgbWF0Y2hbJGNvbnN1bWVkXSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YU5vZGVbJGFwcGVuZENoaWxkXShtYXRjaCk7CiAgICAgICAgICAgIHRoaXMuX3NldEFuZEJpbmQoY2hpbGQsIG1hdGNoKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5lbXB0eU1lcmdlKSB7CiAgICAgICAgICAgIG1hdGNoWyRjb25zdW1lZF0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgbWF0Y2ggPSBbbWF0Y2hdOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobWF0Y2gpIHsKICAgICAgICB0aGlzLl9iaW5kT2NjdXJyZW5jZXMoY2hpbGQsIG1hdGNoLCBwaWN0dXJlKTsKICAgICAgfSBlbHNlIGlmIChtaW4gPiAwKSB7CiAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgZGF0YU5vZGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHVzZWxlc3NOb2Rlcy5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogICAgdXNlbGVzc05vZGVzLmZvckVhY2gobm9kZSA9PiBub2RlWyRnZXRQYXJlbnRdKClbJHJlbW92ZUNoaWxkXShub2RlKSk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvZGF0YS5qcwoKY2xhc3MgRGF0YUhhbmRsZXIgewogIGNvbnN0cnVjdG9yKHJvb3QsIGRhdGEpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLmRhdGFzZXQgPSByb290LmRhdGFzZXRzIHx8IG51bGw7CiAgfQogIHNlcmlhbGl6ZShzdG9yYWdlKSB7CiAgICBjb25zdCBzdGFjayA9IFtbLTEsIHRoaXMuZGF0YVskZ2V0Q2hpbGRyZW5dKCldXTsKICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGxhc3QgPSBzdGFjay5hdCgtMSk7CiAgICAgIGNvbnN0IFtpLCBjaGlsZHJlbl0gPSBsYXN0OwogICAgICBpZiAoaSArIDEgPT09IGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5bKytsYXN0WzBdXTsKICAgICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gc3RvcmFnZS5nZXQoY2hpbGRbJHVpZF0pOwogICAgICBpZiAoc3RvcmFnZUVudHJ5KSB7CiAgICAgICAgY2hpbGRbJHNldFZhbHVlXShzdG9yYWdlRW50cnkpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBjaGlsZFskZ2V0QXR0cmlidXRlc10oKTsKICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIGF0dHJpYnV0ZXMudmFsdWVzKCkpIHsKICAgICAgICAgIGNvbnN0IGVudHJ5ID0gc3RvcmFnZS5nZXQodmFsdWVbJHVpZF0pOwogICAgICAgICAgaWYgKGVudHJ5KSB7CiAgICAgICAgICAgIHZhbHVlWyRzZXRWYWx1ZV0oZW50cnkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3Qgbm9kZXMgPSBjaGlsZFskZ2V0Q2hpbGRyZW5dKCk7CiAgICAgIGlmIChub2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgc3RhY2sucHVzaChbLTEsIG5vZGVzXSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGJ1ZiA9IFtgPHhmYTpkYXRhc2V0cyB4bWxuczp4ZmE9Imh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWRhdGEvMS4wLyI+YF07CiAgICBpZiAodGhpcy5kYXRhc2V0KSB7CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5kYXRhc2V0WyRnZXRDaGlsZHJlbl0oKSkgewogICAgICAgIGlmIChjaGlsZFskbm9kZU5hbWVdICE9PSAiZGF0YSIpIHsKICAgICAgICAgIGNoaWxkWyR0b1N0cmluZ10oYnVmKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZGF0YVskdG9TdHJpbmddKGJ1Zik7CiAgICBidWYucHVzaCgiPC94ZmE6ZGF0YXNldHM+Iik7CiAgICByZXR1cm4gYnVmLmpvaW4oIiIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2NvbmZpZy5qcwoKCgoKCmNvbnN0IENPTkZJR19OU19JRCA9IE5hbWVzcGFjZUlkcy5jb25maWcuaWQ7CmNsYXNzIEFjcm9iYXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFjcm9iYXQiLCB0cnVlKTsKICAgIHRoaXMuYWNyb2JhdDcgPSBudWxsOwogICAgdGhpcy5hdXRvU2F2ZSA9IG51bGw7CiAgICB0aGlzLmNvbW1vbiA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRlID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGVBcHByb3ZhbFNpZ25hdHVyZXMgPSBudWxsOwogICAgdGhpcy5zdWJtaXRVcmwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgQWNyb2JhdDcgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFjcm9iYXQ3IiwgdHJ1ZSk7CiAgICB0aGlzLmR5bmFtaWNSZW5kZXIgPSBudWxsOwogIH0KfQpjbGFzcyBBREJFX0pTQ29uc29sZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiQURCRV9KU0NvbnNvbGUiLCBbImRlbGVnYXRlIiwgIkVuYWJsZSIsICJEaXNhYmxlIl0pOwogIH0KfQpjbGFzcyBBREJFX0pTRGVidWdnZXIgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIkFEQkVfSlNEZWJ1Z2dlciIsIFsiZGVsZWdhdGUiLCAiRW5hYmxlIiwgIkRpc2FibGUiXSk7CiAgfQp9CmNsYXNzIEFkZFNpbGVudFByaW50IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFkZFNpbGVudFByaW50Iik7CiAgfQp9CmNsYXNzIEFkZFZpZXdlclByZWZlcmVuY2VzIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFkZFZpZXdlclByZWZlcmVuY2VzIik7CiAgfQp9CmNsYXNzIEFkanVzdERhdGEgZXh0ZW5kcyBPcHRpb24xMCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRqdXN0RGF0YSIpOwogIH0KfQpjbGFzcyBBZG9iZUV4dGVuc2lvbkxldmVsIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRvYmVFeHRlbnNpb25MZXZlbCIsIDAsIG4gPT4gbiA+PSAxICYmIG4gPD0gOCk7CiAgfQp9CmNsYXNzIEFnZW50IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhZ2VudCIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lID8gYXR0cmlidXRlcy5uYW1lLnRyaW0oKSA6ICIiOwogICAgdGhpcy5jb21tb24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgQWx3YXlzRW1iZWQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhbHdheXNFbWJlZCIpOwogIH0KfQpjbGFzcyBBbWQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFtZCIpOwogIH0KfQpjbGFzcyBjb25maWdfQXJlYSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYXJlYSIpOwogICAgdGhpcy5sZXZlbCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmxldmVsLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPj0gMSAmJiBuIDw9IDMKICAgIH0pOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyIiLCAiYmFyY29kZSIsICJjb3JlaW5pdCIsICJkZXZpY2VEcml2ZXIiLCAiZm9udCIsICJnZW5lcmFsIiwgImxheW91dCIsICJtZXJnZSIsICJzY3JpcHQiLCAic2lnbmF0dXJlIiwgInNvdXJjZVNldCIsICJ0ZW1wbGF0ZUNhY2hlIl0pOwogIH0KfQpjbGFzcyBBdHRyaWJ1dGVzIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhdHRyaWJ1dGVzIiwgWyJwcmVzZXJ2ZSIsICJkZWxlZ2F0ZSIsICJpZ25vcmUiXSk7CiAgfQp9CmNsYXNzIEF1dG9TYXZlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhdXRvU2F2ZSIsIFsiZGlzYWJsZWQiLCAiZW5hYmxlZCJdKTsKICB9Cn0KY2xhc3MgQmFzZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYmFzZSIpOwogIH0KfQpjbGFzcyBCYXRjaE91dHB1dCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYmF0Y2hPdXRwdXQiKTsKICAgIHRoaXMuZm9ybWF0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZm9ybWF0LCBbIm5vbmUiLCAiY29uY2F0IiwgInppcCIsICJ6aXBDb21wcmVzcyJdKTsKICB9Cn0KY2xhc3MgQmVoYXZpb3JPdmVycmlkZSBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImJlaGF2aW9yT3ZlcnJpZGUiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IG5ldyBNYXAodGhpc1skY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKS5maWx0ZXIoeCA9PiB4LmluY2x1ZGVzKCI6IikpLm1hcCh4ID0+IHguc3BsaXQoIjoiLCAyKSkpOwogIH0KfQpjbGFzcyBDYWNoZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY2FjaGUiLCB0cnVlKTsKICAgIHRoaXMudGVtcGxhdGVDYWNoZSA9IG51bGw7CiAgfQp9CmNsYXNzIENoYW5nZSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjaGFuZ2UiKTsKICB9Cn0KY2xhc3MgQ29tbW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb21tb24iLCB0cnVlKTsKICAgIHRoaXMuZGF0YSA9IG51bGw7CiAgICB0aGlzLmxvY2FsZSA9IG51bGw7CiAgICB0aGlzLmxvY2FsZVNldCA9IG51bGw7CiAgICB0aGlzLm1lc3NhZ2luZyA9IG51bGw7CiAgICB0aGlzLnN1cHByZXNzQmFubmVyID0gbnVsbDsKICAgIHRoaXMudGVtcGxhdGUgPSBudWxsOwogICAgdGhpcy52YWxpZGF0aW9uTWVzc2FnaW5nID0gbnVsbDsKICAgIHRoaXMudmVyc2lvbkNvbnRyb2wgPSBudWxsOwogICAgdGhpcy5sb2cgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgQ29tcHJlc3MgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbXByZXNzIik7CiAgICB0aGlzLnNjb3BlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc2NvcGUsIFsiaW1hZ2VPbmx5IiwgImRvY3VtZW50Il0pOwogIH0KfQpjbGFzcyBDb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29tcHJlc3NMb2dpY2FsU3RydWN0dXJlIik7CiAgfQp9CmNsYXNzIENvbXByZXNzT2JqZWN0U3RyZWFtIGV4dGVuZHMgT3B0aW9uMTAgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbXByZXNzT2JqZWN0U3RyZWFtIik7CiAgfQp9CmNsYXNzIENvbXByZXNzaW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb21wcmVzc2lvbiIsIHRydWUpOwogICAgdGhpcy5jb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUgPSBudWxsOwogICAgdGhpcy5jb21wcmVzc09iamVjdFN0cmVhbSA9IG51bGw7CiAgICB0aGlzLmxldmVsID0gbnVsbDsKICAgIHRoaXMudHlwZSA9IG51bGw7CiAgfQp9CmNsYXNzIENvbmZpZyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29uZmlnIiwgdHJ1ZSk7CiAgICB0aGlzLmFjcm9iYXQgPSBudWxsOwogICAgdGhpcy5wcmVzZW50ID0gbnVsbDsKICAgIHRoaXMudHJhY2UgPSBudWxsOwogICAgdGhpcy5hZ2VudCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBDb25mb3JtYW5jZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29uZm9ybWFuY2UiLCBbIkEiLCAiQiJdKTsKICB9Cn0KY2xhc3MgQ29udGVudENvcHkgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29udGVudENvcHkiKTsKICB9Cn0KY2xhc3MgQ29waWVzIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29waWVzIiwgMSwgbiA9PiBuID49IDEpOwogIH0KfQpjbGFzcyBDcmVhdG9yIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjcmVhdG9yIik7CiAgfQp9CmNsYXNzIEN1cnJlbnRQYWdlIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY3VycmVudFBhZ2UiLCAwLCBuID0+IG4gPj0gMCk7CiAgfQp9CmNsYXNzIERhdGEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRhdGEiLCB0cnVlKTsKICAgIHRoaXMuYWRqdXN0RGF0YSA9IG51bGw7CiAgICB0aGlzLmF0dHJpYnV0ZXMgPSBudWxsOwogICAgdGhpcy5pbmNyZW1lbnRhbExvYWQgPSBudWxsOwogICAgdGhpcy5vdXRwdXRYU0wgPSBudWxsOwogICAgdGhpcy5yYW5nZSA9IG51bGw7CiAgICB0aGlzLnJlY29yZCA9IG51bGw7CiAgICB0aGlzLnN0YXJ0Tm9kZSA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgICB0aGlzLndpbmRvdyA9IG51bGw7CiAgICB0aGlzLnhzbCA9IG51bGw7CiAgICB0aGlzLmV4Y2x1ZGVOUyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50cmFuc2Zvcm0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRGVidWcgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRlYnVnIiwgdHJ1ZSk7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIERlZmF1bHRUeXBlZmFjZSBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRlZmF1bHRUeXBlZmFjZSIpOwogICAgdGhpcy53cml0aW5nU2NyaXB0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMud3JpdGluZ1NjcmlwdCwgWyIqIiwgIkFyYWJpYyIsICJDeXJpbGxpYyIsICJFYXN0RXVyb3BlYW5Sb21hbiIsICJHcmVlayIsICJIZWJyZXciLCAiSmFwYW5lc2UiLCAiS29yZWFuIiwgIlJvbWFuIiwgIlNpbXBsaWZpZWRDaGluZXNlIiwgIlRoYWkiLCAiVHJhZGl0aW9uYWxDaGluZXNlIiwgIlZpZXRuYW1lc2UiXSk7CiAgfQp9CmNsYXNzIERlc3RpbmF0aW9uIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkZXN0aW5hdGlvbiIsIFsicGRmIiwgInBjbCIsICJwcyIsICJ3ZWJDbGllbnQiLCAienBsIl0pOwogIH0KfQpjbGFzcyBEb2N1bWVudEFzc2VtYmx5IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRvY3VtZW50QXNzZW1ibHkiKTsKICB9Cn0KY2xhc3MgRHJpdmVyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkcml2ZXIiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSA/IGF0dHJpYnV0ZXMubmFtZS50cmltKCkgOiAiIjsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBEdXBsZXhPcHRpb24gZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImR1cGxleE9wdGlvbiIsIFsic2ltcGxleCIsICJkdXBsZXhGbGlwTG9uZ0VkZ2UiLCAiZHVwbGV4RmxpcFNob3J0RWRnZSJdKTsKICB9Cn0KY2xhc3MgRHluYW1pY1JlbmRlciBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZHluYW1pY1JlbmRlciIsIFsiZm9yYmlkZGVuIiwgInJlcXVpcmVkIl0pOwogIH0KfQpjbGFzcyBFbWJlZCBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlbWJlZCIpOwogIH0KfQpjbGFzcyBjb25maWdfRW5jcnlwdCBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlbmNyeXB0Iik7CiAgfQp9CmNsYXNzIGNvbmZpZ19FbmNyeXB0aW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlbmNyeXB0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmVuY3J5cHQgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0aW9uTGV2ZWwgPSBudWxsOwogICAgdGhpcy5wZXJtaXNzaW9ucyA9IG51bGw7CiAgfQp9CmNsYXNzIEVuY3J5cHRpb25MZXZlbCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZW5jcnlwdGlvbkxldmVsIiwgWyI0MGJpdCIsICIxMjhiaXQiXSk7CiAgfQp9CmNsYXNzIEVuZm9yY2UgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVuZm9yY2UiKTsKICB9Cn0KY2xhc3MgRXF1YXRlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlcXVhdGUiKTsKICAgIHRoaXMuZm9yY2UgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5mb3JjZSwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID09PSAwCiAgICB9KTsKICAgIHRoaXMuZnJvbSA9IGF0dHJpYnV0ZXMuZnJvbSB8fCAiIjsKICAgIHRoaXMudG8gPSBhdHRyaWJ1dGVzLnRvIHx8ICIiOwogIH0KfQpjbGFzcyBFcXVhdGVSYW5nZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZXF1YXRlUmFuZ2UiKTsKICAgIHRoaXMuZnJvbSA9IGF0dHJpYnV0ZXMuZnJvbSB8fCAiIjsKICAgIHRoaXMudG8gPSBhdHRyaWJ1dGVzLnRvIHx8ICIiOwogICAgdGhpcy5fdW5pY29kZVJhbmdlID0gYXR0cmlidXRlcy51bmljb2RlUmFuZ2UgfHwgIiI7CiAgfQogIGdldCB1bmljb2RlUmFuZ2UoKSB7CiAgICBjb25zdCByYW5nZXMgPSBbXTsKICAgIGNvbnN0IHVuaWNvZGVSZWdleCA9IC9VXCsoWzAtOWEtZkEtRl0rKS87CiAgICBjb25zdCB1bmljb2RlUmFuZ2UgPSB0aGlzLl91bmljb2RlUmFuZ2U7CiAgICBmb3IgKGxldCByYW5nZSBvZiB1bmljb2RlUmFuZ2Uuc3BsaXQoIiwiKS5tYXAoeCA9PiB4LnRyaW0oKSkuZmlsdGVyKHggPT4gISF4KSkgewogICAgICByYW5nZSA9IHJhbmdlLnNwbGl0KCItIiwgMikubWFwKHggPT4gewogICAgICAgIGNvbnN0IGZvdW5kID0geC5tYXRjaCh1bmljb2RlUmVnZXgpOwogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcGFyc2VJbnQoZm91bmRbMV0sIDE2KTsKICAgICAgfSk7CiAgICAgIGlmIChyYW5nZS5sZW5ndGggPT09IDEpIHsKICAgICAgICByYW5nZS5wdXNoKHJhbmdlWzBdKTsKICAgICAgfQogICAgICByYW5nZXMucHVzaChyYW5nZSk7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ1bmljb2RlUmFuZ2UiLCByYW5nZXMpOwogIH0KfQpjbGFzcyBFeGNsdWRlIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZXhjbHVkZSIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKS5maWx0ZXIoeCA9PiB4ICYmIFsiY2FsY3VsYXRlIiwgImNsb3NlIiwgImVudGVyIiwgImV4aXQiLCAiaW5pdGlhbGl6ZSIsICJyZWFkeSIsICJ2YWxpZGF0ZSJdLmluY2x1ZGVzKHgpKTsKICB9Cn0KY2xhc3MgRXhjbHVkZU5TIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJleGNsdWRlTlMiKTsKICB9Cn0KY2xhc3MgRmxpcExhYmVsIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJmbGlwTGFiZWwiLCBbInVzZVByaW50ZXJTZXR0aW5nIiwgIm9uIiwgIm9mZiJdKTsKICB9Cn0KY2xhc3MgY29uZmlnX0ZvbnRJbmZvIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJmb250SW5mbyIsIHRydWUpOwogICAgdGhpcy5lbWJlZCA9IG51bGw7CiAgICB0aGlzLm1hcCA9IG51bGw7CiAgICB0aGlzLnN1YnNldEJlbG93ID0gbnVsbDsKICAgIHRoaXMuYWx3YXlzRW1iZWQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVmYXVsdFR5cGVmYWNlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm5ldmVyRW1iZWQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRm9ybUZpZWxkRmlsbGluZyBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJmb3JtRmllbGRGaWxsaW5nIik7CiAgfQp9CmNsYXNzIEdyb3VwUGFyZW50IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJncm91cFBhcmVudCIpOwogIH0KfQpjbGFzcyBJZkVtcHR5IGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJpZkVtcHR5IiwgWyJkYXRhVmFsdWUiLCAiZGF0YUdyb3VwIiwgImlnbm9yZSIsICJyZW1vdmUiXSk7CiAgfQp9CmNsYXNzIEluY2x1ZGVYRFBDb250ZW50IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJpbmNsdWRlWERQQ29udGVudCIpOwogIH0KfQpjbGFzcyBJbmNyZW1lbnRhbExvYWQgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImluY3JlbWVudGFsTG9hZCIsIFsibm9uZSIsICJmb3J3YXJkT25seSJdKTsKICB9Cn0KY2xhc3MgSW5jcmVtZW50YWxNZXJnZSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJpbmNyZW1lbnRhbE1lcmdlIik7CiAgfQp9CmNsYXNzIEludGVyYWN0aXZlIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImludGVyYWN0aXZlIik7CiAgfQp9CmNsYXNzIEpvZyBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiam9nIiwgWyJ1c2VQcmludGVyU2V0dGluZyIsICJub25lIiwgInBhZ2VTZXQiXSk7CiAgfQp9CmNsYXNzIExhYmVsUHJpbnRlciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibGFiZWxQcmludGVyIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uYW1lLCBbInpwbCIsICJkcGwiLCAiaXBsIiwgInRjcGwiXSk7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuZmxpcExhYmVsID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBMYXlvdXQgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImxheW91dCIsIFsicGFnaW5hdGUiLCAicGFuZWwiXSk7CiAgfQp9CmNsYXNzIExldmVsIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibGV2ZWwiLCAwLCBuID0+IG4gPiAwKTsKICB9Cn0KY2xhc3MgTGluZWFyaXplZCBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsaW5lYXJpemVkIik7CiAgfQp9CmNsYXNzIExvY2FsZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibG9jYWxlIik7CiAgfQp9CmNsYXNzIExvY2FsZVNldCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibG9jYWxlU2V0Iik7CiAgfQp9CmNsYXNzIExvZyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibG9nIiwgdHJ1ZSk7CiAgICB0aGlzLm1vZGUgPSBudWxsOwogICAgdGhpcy50aHJlc2hvbGQgPSBudWxsOwogICAgdGhpcy50byA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIE1hcEVsZW1lbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1hcCIsIHRydWUpOwogICAgdGhpcy5lcXVhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXF1YXRlUmFuZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgTWVkaXVtSW5mbyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibWVkaXVtSW5mbyIsIHRydWUpOwogICAgdGhpcy5tYXAgPSBudWxsOwogIH0KfQpjbGFzcyBjb25maWdfTWVzc2FnZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibWVzc2FnZSIsIHRydWUpOwogICAgdGhpcy5tc2dJZCA9IG51bGw7CiAgICB0aGlzLnNldmVyaXR5ID0gbnVsbDsKICB9Cn0KY2xhc3MgTWVzc2FnaW5nIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtZXNzYWdpbmciLCB0cnVlKTsKICAgIHRoaXMubWVzc2FnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBNb2RlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtb2RlIiwgWyJhcHBlbmQiLCAib3ZlcndyaXRlIl0pOwogIH0KfQpjbGFzcyBNb2RpZnlBbm5vdHMgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibW9kaWZ5QW5ub3RzIik7CiAgfQp9CmNsYXNzIE1zZ0lkIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibXNnSWQiLCAxLCBuID0+IG4gPj0gMSk7CiAgfQp9CmNsYXNzIE5hbWVBdHRyIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJuYW1lQXR0ciIpOwogIH0KfQpjbGFzcyBOZXZlckVtYmVkIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibmV2ZXJFbWJlZCIpOwogIH0KfQpjbGFzcyBOdW1iZXJPZkNvcGllcyBleHRlbmRzIEludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm51bWJlck9mQ29waWVzIiwgbnVsbCwgbiA9PiBuID49IDIgJiYgbiA8PSA1KTsKICB9Cn0KY2xhc3MgT3BlbkFjdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAib3BlbkFjdGlvbiIsIHRydWUpOwogICAgdGhpcy5kZXN0aW5hdGlvbiA9IG51bGw7CiAgfQp9CmNsYXNzIE91dHB1dCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAib3V0cHV0IiwgdHJ1ZSk7CiAgICB0aGlzLnRvID0gbnVsbDsKICAgIHRoaXMudHlwZSA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIE91dHB1dEJpbiBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAib3V0cHV0QmluIik7CiAgfQp9CmNsYXNzIE91dHB1dFhTTCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAib3V0cHV0WFNMIiwgdHJ1ZSk7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIE92ZXJwcmludCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAib3ZlcnByaW50IiwgWyJub25lIiwgImJvdGgiLCAiZHJhdyIsICJmaWVsZCJdKTsKICB9Cn0KY2xhc3MgUGFja2V0cyBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFja2V0cyIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGlmICh0aGlzWyRjb250ZW50XSA9PT0gIioiKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKS5maWx0ZXIoeCA9PiBbImNvbmZpZyIsICJkYXRhc2V0cyIsICJ0ZW1wbGF0ZSIsICJ4ZmRmIiwgInhzbHQiXS5pbmNsdWRlcyh4KSk7CiAgfQp9CmNsYXNzIFBhZ2VPZmZzZXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBhZ2VPZmZzZXQiKTsKICAgIHRoaXMueCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLngsCiAgICAgIGRlZmF1bHRWYWx1ZTogInVzZVhEQ1NldHRpbmciLAogICAgICB2YWxpZGF0ZTogbiA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMueSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnksCiAgICAgIGRlZmF1bHRWYWx1ZTogInVzZVhEQ1NldHRpbmciLAogICAgICB2YWxpZGF0ZTogbiA9PiB0cnVlCiAgICB9KTsKICB9Cn0KY2xhc3MgUGFnZVJhbmdlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYWdlUmFuZ2UiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBudW1iZXJzID0gdGhpc1skY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKS5tYXAoeCA9PiBwYXJzZUludCh4LCAxMCkpOwogICAgY29uc3QgcmFuZ2VzID0gW107CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBudW1iZXJzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgcmFuZ2VzLnB1c2gobnVtYmVycy5zbGljZShpLCBpICsgMikpOwogICAgfQogICAgdGhpc1skY29udGVudF0gPSByYW5nZXM7CiAgfQp9CmNsYXNzIFBhZ2luYXRpb24gZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBhZ2luYXRpb24iLCBbInNpbXBsZXgiLCAiZHVwbGV4U2hvcnRFZGdlIiwgImR1cGxleExvbmdFZGdlIl0pOwogIH0KfQpjbGFzcyBQYWdpbmF0aW9uT3ZlcnJpZGUgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBhZ2luYXRpb25PdmVycmlkZSIsIFsibm9uZSIsICJmb3JjZUR1cGxleCIsICJmb3JjZUR1cGxleExvbmdFZGdlIiwgImZvcmNlRHVwbGV4U2hvcnRFZGdlIiwgImZvcmNlU2ltcGxleCJdKTsKICB9Cn0KY2xhc3MgUGFydCBleHRlbmRzIEludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBhcnQiLCAxLCBuID0+IGZhbHNlKTsKICB9Cn0KY2xhc3MgUGNsIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwY2wiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMuYmF0Y2hPdXRwdXQgPSBudWxsOwogICAgdGhpcy5mb250SW5mbyA9IG51bGw7CiAgICB0aGlzLmpvZyA9IG51bGw7CiAgICB0aGlzLm1lZGl1bUluZm8gPSBudWxsOwogICAgdGhpcy5vdXRwdXRCaW4gPSBudWxsOwogICAgdGhpcy5wYWdlT2Zmc2V0ID0gbnVsbDsKICAgIHRoaXMuc3RhcGxlID0gbnVsbDsKICAgIHRoaXMueGRjID0gbnVsbDsKICB9Cn0KY2xhc3MgUGRmIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwZGYiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMuYWRvYmVFeHRlbnNpb25MZXZlbCA9IG51bGw7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuY29tcHJlc3Npb24gPSBudWxsOwogICAgdGhpcy5jcmVhdG9yID0gbnVsbDsKICAgIHRoaXMuZW5jcnlwdGlvbiA9IG51bGw7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMuaW50ZXJhY3RpdmUgPSBudWxsOwogICAgdGhpcy5saW5lYXJpemVkID0gbnVsbDsKICAgIHRoaXMub3BlbkFjdGlvbiA9IG51bGw7CiAgICB0aGlzLnBkZmEgPSBudWxsOwogICAgdGhpcy5wcm9kdWNlciA9IG51bGw7CiAgICB0aGlzLnJlbmRlclBvbGljeSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdE1vZGVsID0gbnVsbDsKICAgIHRoaXMuc2lsZW50UHJpbnQgPSBudWxsOwogICAgdGhpcy5zdWJtaXRGb3JtYXQgPSBudWxsOwogICAgdGhpcy50YWdnZWQgPSBudWxsOwogICAgdGhpcy52ZXJzaW9uID0gbnVsbDsKICAgIHRoaXMudmlld2VyUHJlZmVyZW5jZXMgPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBQZGZhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwZGZhIiwgdHJ1ZSk7CiAgICB0aGlzLmFtZCA9IG51bGw7CiAgICB0aGlzLmNvbmZvcm1hbmNlID0gbnVsbDsKICAgIHRoaXMuaW5jbHVkZVhEUENvbnRlbnQgPSBudWxsOwogICAgdGhpcy5wYXJ0ID0gbnVsbDsKICB9Cn0KY2xhc3MgUGVybWlzc2lvbnMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBlcm1pc3Npb25zIiwgdHJ1ZSk7CiAgICB0aGlzLmFjY2Vzc2libGVDb250ZW50ID0gbnVsbDsKICAgIHRoaXMuY2hhbmdlID0gbnVsbDsKICAgIHRoaXMuY29udGVudENvcHkgPSBudWxsOwogICAgdGhpcy5kb2N1bWVudEFzc2VtYmx5ID0gbnVsbDsKICAgIHRoaXMuZm9ybUZpZWxkRmlsbGluZyA9IG51bGw7CiAgICB0aGlzLm1vZGlmeUFubm90cyA9IG51bGw7CiAgICB0aGlzLnBsYWludGV4dE1ldGFkYXRhID0gbnVsbDsKICAgIHRoaXMucHJpbnQgPSBudWxsOwogICAgdGhpcy5wcmludEhpZ2hRdWFsaXR5ID0gbnVsbDsKICB9Cn0KY2xhc3MgUGlja1RyYXlCeVBERlNpemUgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGlja1RyYXlCeVBERlNpemUiKTsKICB9Cn0KY2xhc3MgY29uZmlnX1BpY3R1cmUgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBpY3R1cmUiKTsKICB9Cn0KY2xhc3MgUGxhaW50ZXh0TWV0YWRhdGEgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGxhaW50ZXh0TWV0YWRhdGEiKTsKICB9Cn0KY2xhc3MgUHJlc2VuY2UgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByZXNlbmNlIiwgWyJwcmVzZXJ2ZSIsICJkaXNzb2x2ZSIsICJkaXNzb2x2ZVN0cnVjdHVyZSIsICJpZ25vcmUiLCAicmVtb3ZlIl0pOwogIH0KfQpjbGFzcyBQcmVzZW50IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmVzZW50IiwgdHJ1ZSk7CiAgICB0aGlzLmJlaGF2aW9yT3ZlcnJpZGUgPSBudWxsOwogICAgdGhpcy5jYWNoZSA9IG51bGw7CiAgICB0aGlzLmNvbW1vbiA9IG51bGw7CiAgICB0aGlzLmNvcGllcyA9IG51bGw7CiAgICB0aGlzLmRlc3RpbmF0aW9uID0gbnVsbDsKICAgIHRoaXMuaW5jcmVtZW50YWxNZXJnZSA9IG51bGw7CiAgICB0aGlzLmxheW91dCA9IG51bGw7CiAgICB0aGlzLm91dHB1dCA9IG51bGw7CiAgICB0aGlzLm92ZXJwcmludCA9IG51bGw7CiAgICB0aGlzLnBhZ2luYXRpb24gPSBudWxsOwogICAgdGhpcy5wYWdpbmF0aW9uT3ZlcnJpZGUgPSBudWxsOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZSA9IG51bGw7CiAgICB0aGlzLnhkcCA9IG51bGw7CiAgICB0aGlzLmRyaXZlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5sYWJlbFByaW50ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGNsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBkZiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJtaXRVcmwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMud2ViQ2xpZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnpwbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBQcmludCBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmludCIpOwogIH0KfQpjbGFzcyBQcmludEhpZ2hRdWFsaXR5IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByaW50SGlnaFF1YWxpdHkiKTsKICB9Cn0KY2xhc3MgUHJpbnRTY2FsaW5nIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmludFNjYWxpbmciLCBbImFwcGRlZmF1bHQiLCAibm9TY2FsaW5nIl0pOwogIH0KfQpjbGFzcyBQcmludGVyTmFtZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJpbnRlck5hbWUiKTsKICB9Cn0KY2xhc3MgUHJvZHVjZXIgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByb2R1Y2VyIik7CiAgfQp9CmNsYXNzIFBzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcyIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5iYXRjaE91dHB1dCA9IG51bGw7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMuam9nID0gbnVsbDsKICAgIHRoaXMubWVkaXVtSW5mbyA9IG51bGw7CiAgICB0aGlzLm91dHB1dEJpbiA9IG51bGw7CiAgICB0aGlzLnN0YXBsZSA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIFJhbmdlIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicmFuZ2UiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnNwbGl0KCIsIiwgMikubWFwKHJhbmdlID0+IHJhbmdlLnNwbGl0KCItIikubWFwKHggPT4gcGFyc2VJbnQoeC50cmltKCksIDEwKSkpLmZpbHRlcihyYW5nZSA9PiByYW5nZS5ldmVyeSh4ID0+ICFpc05hTih4KSkpLm1hcChyYW5nZSA9PiB7CiAgICAgIGlmIChyYW5nZS5sZW5ndGggPT09IDEpIHsKICAgICAgICByYW5nZS5wdXNoKHJhbmdlWzBdKTsKICAgICAgfQogICAgICByZXR1cm4gcmFuZ2U7CiAgICB9KTsKICB9Cn0KY2xhc3MgUmVjb3JkIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicmVjb3JkIik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgICBjb25zdCBuID0gcGFyc2VJbnQodGhpc1skY29udGVudF0sIDEwKTsKICAgIGlmICghaXNOYU4obikgJiYgbiA+PSAwKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdID0gbjsKICAgIH0KICB9Cn0KY2xhc3MgUmVsZXZhbnQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyZWxldmFudCIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKTsKICB9Cn0KY2xhc3MgUmVuYW1lIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicmVuYW1lIik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgICBpZiAodGhpc1skY29udGVudF0udG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCJ4bWwiKSB8fCBuZXcgUmVnRXhwKCJbXFxwe0x9X11bXFxwe0x9XFxkLl9cXHB7TX0tXSoiLCAidSIpLnRlc3QodGhpc1skY29udGVudF0pKSB7CiAgICAgIHdhcm4oIlhGQSAtIFJlbmFtZTogaW52YWxpZCBYRkEgbmFtZSIpOwogICAgfQogIH0KfQpjbGFzcyBSZW5kZXJQb2xpY3kgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInJlbmRlclBvbGljeSIsIFsic2VydmVyIiwgImNsaWVudCJdKTsKICB9Cn0KY2xhc3MgUnVuU2NyaXB0cyBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicnVuU2NyaXB0cyIsIFsiYm90aCIsICJjbGllbnQiLCAibm9uZSIsICJzZXJ2ZXIiXSk7CiAgfQp9CmNsYXNzIGNvbmZpZ19TY3JpcHQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInNjcmlwdCIsIHRydWUpOwogICAgdGhpcy5jdXJyZW50UGFnZSA9IG51bGw7CiAgICB0aGlzLmV4Y2x1ZGUgPSBudWxsOwogICAgdGhpcy5ydW5TY3JpcHRzID0gbnVsbDsKICB9Cn0KY2xhc3MgU2NyaXB0TW9kZWwgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInNjcmlwdE1vZGVsIiwgWyJYRkEiLCAibm9uZSJdKTsKICB9Cn0KY2xhc3MgU2V2ZXJpdHkgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInNldmVyaXR5IiwgWyJpZ25vcmUiLCAiZXJyb3IiLCAiaW5mb3JtYXRpb24iLCAidHJhY2UiLCAid2FybmluZyJdKTsKICB9Cn0KY2xhc3MgU2lsZW50UHJpbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInNpbGVudFByaW50IiwgdHJ1ZSk7CiAgICB0aGlzLmFkZFNpbGVudFByaW50ID0gbnVsbDsKICAgIHRoaXMucHJpbnRlck5hbWUgPSBudWxsOwogIH0KfQpjbGFzcyBTdGFwbGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInN0YXBsZSIpOwogICAgdGhpcy5tb2RlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubW9kZSwgWyJ1c2VQcmludGVyU2V0dGluZyIsICJvbiIsICJvZmYiXSk7CiAgfQp9CmNsYXNzIFN0YXJ0Tm9kZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3RhcnROb2RlIik7CiAgfQp9CmNsYXNzIFN0YXJ0UGFnZSBleHRlbmRzIEludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInN0YXJ0UGFnZSIsIDAsIG4gPT4gdHJ1ZSk7CiAgfQp9CmNsYXNzIFN1Ym1pdEZvcm1hdCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3VibWl0Rm9ybWF0IiwgWyJodG1sIiwgImRlbGVnYXRlIiwgImZkZiIsICJ4bWwiLCAicGRmIl0pOwogIH0KfQpjbGFzcyBTdWJtaXRVcmwgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInN1Ym1pdFVybCIpOwogIH0KfQpjbGFzcyBTdWJzZXRCZWxvdyBleHRlbmRzIEludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInN1YnNldEJlbG93IiwgMTAwLCBuID0+IG4gPj0gMCAmJiBuIDw9IDEwMCk7CiAgfQp9CmNsYXNzIFN1cHByZXNzQmFubmVyIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInN1cHByZXNzQmFubmVyIik7CiAgfQp9CmNsYXNzIFRhZ2dlZCBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ0YWdnZWQiKTsKICB9Cn0KY2xhc3MgY29uZmlnX1RlbXBsYXRlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ0ZW1wbGF0ZSIsIHRydWUpOwogICAgdGhpcy5iYXNlID0gbnVsbDsKICAgIHRoaXMucmVsZXZhbnQgPSBudWxsOwogICAgdGhpcy5zdGFydFBhZ2UgPSBudWxsOwogICAgdGhpcy51cmkgPSBudWxsOwogICAgdGhpcy54c2wgPSBudWxsOwogIH0KfQpjbGFzcyBUaHJlc2hvbGQgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRocmVzaG9sZCIsIFsidHJhY2UiLCAiZXJyb3IiLCAiaW5mb3JtYXRpb24iLCAid2FybmluZyJdKTsKICB9Cn0KY2xhc3MgVG8gZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRvIiwgWyJudWxsIiwgIm1lbW9yeSIsICJzdGRlcnIiLCAic3Rkb3V0IiwgInN5c3RlbSIsICJ1cmkiXSk7CiAgfQp9CmNsYXNzIFRlbXBsYXRlQ2FjaGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRlbXBsYXRlQ2FjaGUiKTsKICAgIHRoaXMubWF4RW50cmllcyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1heEVudHJpZXMsCiAgICAgIGRlZmF1bHRWYWx1ZTogNSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAwCiAgICB9KTsKICB9Cn0KY2xhc3MgVHJhY2UgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRyYWNlIiwgdHJ1ZSk7CiAgICB0aGlzLmFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgVHJhbnNmb3JtIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ0cmFuc2Zvcm0iLCB0cnVlKTsKICAgIHRoaXMuZ3JvdXBQYXJlbnQgPSBudWxsOwogICAgdGhpcy5pZkVtcHR5ID0gbnVsbDsKICAgIHRoaXMubmFtZUF0dHIgPSBudWxsOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICAgIHRoaXMucHJlc2VuY2UgPSBudWxsOwogICAgdGhpcy5yZW5hbWUgPSBudWxsOwogICAgdGhpcy53aGl0ZXNwYWNlID0gbnVsbDsKICB9Cn0KY2xhc3MgVHlwZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidHlwZSIsIFsibm9uZSIsICJhc2NpaTg1IiwgImFzY2lpSGV4IiwgImNjaXR0ZmF4IiwgImZsYXRlIiwgImx6dyIsICJydW5MZW5ndGgiLCAibmF0aXZlIiwgInhkcCIsICJtZXJnZWRYRFAiXSk7CiAgfQp9CmNsYXNzIFVyaSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidXJpIik7CiAgfQp9CmNsYXNzIGNvbmZpZ19WYWxpZGF0ZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmFsaWRhdGUiLCBbInByZVN1Ym1pdCIsICJwcmVQcmludCIsICJwcmVFeGVjdXRlIiwgInByZVNhdmUiXSk7CiAgfQp9CmNsYXNzIFZhbGlkYXRlQXBwcm92YWxTaWduYXR1cmVzIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmFsaWRhdGVBcHByb3ZhbFNpZ25hdHVyZXMiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKS5zcGxpdCgvXHMrLykuZmlsdGVyKHggPT4gWyJkb2NSZWFkeSIsICJwb3N0U2lnbiJdLmluY2x1ZGVzKHgpKTsKICB9Cn0KY2xhc3MgVmFsaWRhdGlvbk1lc3NhZ2luZyBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmFsaWRhdGlvbk1lc3NhZ2luZyIsIFsiYWxsTWVzc2FnZXNJbmRpdmlkdWFsbHkiLCAiYWxsTWVzc2FnZXNUb2dldGhlciIsICJmaXJzdE1lc3NhZ2VPbmx5IiwgIm5vTWVzc2FnZXMiXSk7CiAgfQp9CmNsYXNzIFZlcnNpb24gZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInZlcnNpb24iLCBbIjEuNyIsICIxLjYiLCAiMS41IiwgIjEuNCIsICIxLjMiLCAiMS4yIl0pOwogIH0KfQpjbGFzcyBWZXJzaW9uQ29udHJvbCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiVmVyc2lvbkNvbnRyb2wiKTsKICAgIHRoaXMub3V0cHV0QmVsb3cgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5vdXRwdXRCZWxvdywgWyJ3YXJuIiwgImVycm9yIiwgInVwZGF0ZSJdKTsKICAgIHRoaXMuc291cmNlQWJvdmUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zb3VyY2VBYm92ZSwgWyJ3YXJuIiwgImVycm9yIl0pOwogICAgdGhpcy5zb3VyY2VCZWxvdyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnNvdXJjZUJlbG93LCBbInVwZGF0ZSIsICJtYWludGFpbiJdKTsKICB9Cn0KY2xhc3MgVmlld2VyUHJlZmVyZW5jZXMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInZpZXdlclByZWZlcmVuY2VzIiwgdHJ1ZSk7CiAgICB0aGlzLkFEQkVfSlNDb25zb2xlID0gbnVsbDsKICAgIHRoaXMuQURCRV9KU0RlYnVnZ2VyID0gbnVsbDsKICAgIHRoaXMuYWRkVmlld2VyUHJlZmVyZW5jZXMgPSBudWxsOwogICAgdGhpcy5kdXBsZXhPcHRpb24gPSBudWxsOwogICAgdGhpcy5lbmZvcmNlID0gbnVsbDsKICAgIHRoaXMubnVtYmVyT2ZDb3BpZXMgPSBudWxsOwogICAgdGhpcy5wYWdlUmFuZ2UgPSBudWxsOwogICAgdGhpcy5waWNrVHJheUJ5UERGU2l6ZSA9IG51bGw7CiAgICB0aGlzLnByaW50U2NhbGluZyA9IG51bGw7CiAgfQp9CmNsYXNzIFdlYkNsaWVudCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAid2ViQ2xpZW50IiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgPyBhdHRyaWJ1dGVzLm5hbWUudHJpbSgpIDogIiI7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMueGRjID0gbnVsbDsKICB9Cn0KY2xhc3MgV2hpdGVzcGFjZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAid2hpdGVzcGFjZSIsIFsicHJlc2VydmUiLCAibHRyaW0iLCAibm9ybWFsaXplIiwgInJ0cmltIiwgInRyaW0iXSk7CiAgfQp9CmNsYXNzIFdpbmRvdyBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIndpbmRvdyIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IHBhaXIgPSB0aGlzWyRjb250ZW50XS5zcGxpdCgiLCIsIDIpLm1hcCh4ID0+IHBhcnNlSW50KHgudHJpbSgpLCAxMCkpOwogICAgaWYgKHBhaXIuc29tZSh4ID0+IGlzTmFOKHgpKSkgewogICAgICB0aGlzWyRjb250ZW50XSA9IFswLCAwXTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHBhaXIubGVuZ3RoID09PSAxKSB7CiAgICAgIHBhaXIucHVzaChwYWlyWzBdKTsKICAgIH0KICAgIHRoaXNbJGNvbnRlbnRdID0gcGFpcjsKICB9Cn0KY2xhc3MgWGRjIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ4ZGMiLCB0cnVlKTsKICAgIHRoaXMudXJpID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnhzbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBYZHAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInhkcCIsIHRydWUpOwogICAgdGhpcy5wYWNrZXRzID0gbnVsbDsKICB9Cn0KY2xhc3MgWHNsIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ4c2wiLCB0cnVlKTsKICAgIHRoaXMuZGVidWcgPSBudWxsOwogICAgdGhpcy51cmkgPSBudWxsOwogIH0KfQpjbGFzcyBacGwgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInpwbCIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lID8gYXR0cmlidXRlcy5uYW1lLnRyaW0oKSA6ICIiOwogICAgdGhpcy5iYXRjaE91dHB1dCA9IG51bGw7CiAgICB0aGlzLmZsaXBMYWJlbCA9IG51bGw7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMueGRjID0gbnVsbDsKICB9Cn0KY2xhc3MgQ29uZmlnTmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKENvbmZpZ05hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gQ29uZmlnTmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGFjcm9iYXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWNyb2JhdChhdHRycyk7CiAgfQogIHN0YXRpYyBhY3JvYmF0NyhhdHRycykgewogICAgcmV0dXJuIG5ldyBBY3JvYmF0NyhhdHRycyk7CiAgfQogIHN0YXRpYyBBREJFX0pTQ29uc29sZShhdHRycykgewogICAgcmV0dXJuIG5ldyBBREJFX0pTQ29uc29sZShhdHRycyk7CiAgfQogIHN0YXRpYyBBREJFX0pTRGVidWdnZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQURCRV9KU0RlYnVnZ2VyKGF0dHJzKTsKICB9CiAgc3RhdGljIGFkZFNpbGVudFByaW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFkZFNpbGVudFByaW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGFkZFZpZXdlclByZWZlcmVuY2VzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFkZFZpZXdlclByZWZlcmVuY2VzKGF0dHJzKTsKICB9CiAgc3RhdGljIGFkanVzdERhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWRqdXN0RGF0YShhdHRycyk7CiAgfQogIHN0YXRpYyBhZG9iZUV4dGVuc2lvbkxldmVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFkb2JlRXh0ZW5zaW9uTGV2ZWwoYXR0cnMpOwogIH0KICBzdGF0aWMgYWdlbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWdlbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgYWx3YXlzRW1iZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWx3YXlzRW1iZWQoYXR0cnMpOwogIH0KICBzdGF0aWMgYW1kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFtZChhdHRycyk7CiAgfQogIHN0YXRpYyBhcmVhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19BcmVhKGF0dHJzKTsKICB9CiAgc3RhdGljIGF0dHJpYnV0ZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXR0cmlidXRlcyhhdHRycyk7CiAgfQogIHN0YXRpYyBhdXRvU2F2ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBBdXRvU2F2ZShhdHRycyk7CiAgfQogIHN0YXRpYyBiYXNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJhc2UoYXR0cnMpOwogIH0KICBzdGF0aWMgYmF0Y2hPdXRwdXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQmF0Y2hPdXRwdXQoYXR0cnMpOwogIH0KICBzdGF0aWMgYmVoYXZpb3JPdmVycmlkZShhdHRycykgewogICAgcmV0dXJuIG5ldyBCZWhhdmlvck92ZXJyaWRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNhY2hlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENhY2hlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNoYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDaGFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgY29tbW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbW1vbihhdHRycyk7CiAgfQogIHN0YXRpYyBjb21wcmVzcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDb21wcmVzcyhhdHRycyk7CiAgfQogIHN0YXRpYyBjb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tcHJlc3NMb2dpY2FsU3RydWN0dXJlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzT2JqZWN0U3RyZWFtKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbXByZXNzT2JqZWN0U3RyZWFtKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzaW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbXByZXNzaW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbmZpZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDb25maWcoYXR0cnMpOwogIH0KICBzdGF0aWMgY29uZm9ybWFuY2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29uZm9ybWFuY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgY29udGVudENvcHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29udGVudENvcHkoYXR0cnMpOwogIH0KICBzdGF0aWMgY29waWVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvcGllcyhhdHRycyk7CiAgfQogIHN0YXRpYyBjcmVhdG9yKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENyZWF0b3IoYXR0cnMpOwogIH0KICBzdGF0aWMgY3VycmVudFBhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ3VycmVudFBhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF0YShhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlYnVnKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERlYnVnKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlZmF1bHRUeXBlZmFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWZhdWx0VHlwZWZhY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVzdGluYXRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGVzdGluYXRpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgZG9jdW1lbnRBc3NlbWJseShhdHRycykgewogICAgcmV0dXJuIG5ldyBEb2N1bWVudEFzc2VtYmx5KGF0dHJzKTsKICB9CiAgc3RhdGljIGRyaXZlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBEcml2ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZHVwbGV4T3B0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IER1cGxleE9wdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBkeW5hbWljUmVuZGVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IER5bmFtaWNSZW5kZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZW1iZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW1iZWQoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfRW5jcnlwdChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19FbmNyeXB0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb25MZXZlbChhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0aW9uTGV2ZWwoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5mb3JjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmZvcmNlKGF0dHJzKTsKICB9CiAgc3RhdGljIGVxdWF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFcXVhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgZXF1YXRlUmFuZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXF1YXRlUmFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZXhjbHVkZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGNsdWRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4Y2x1ZGVOUyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGNsdWRlTlMoYXR0cnMpOwogIH0KICBzdGF0aWMgZmxpcExhYmVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEZsaXBMYWJlbChhdHRycyk7CiAgfQogIHN0YXRpYyBmb250SW5mbyhhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfRm9udEluZm8oYXR0cnMpOwogIH0KICBzdGF0aWMgZm9ybUZpZWxkRmlsbGluZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBGb3JtRmllbGRGaWxsaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIGdyb3VwUGFyZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEdyb3VwUGFyZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGlmRW1wdHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSWZFbXB0eShhdHRycyk7CiAgfQogIHN0YXRpYyBpbmNsdWRlWERQQ29udGVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBJbmNsdWRlWERQQ29udGVudChhdHRycyk7CiAgfQogIHN0YXRpYyBpbmNyZW1lbnRhbExvYWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSW5jcmVtZW50YWxMb2FkKGF0dHJzKTsKICB9CiAgc3RhdGljIGluY3JlbWVudGFsTWVyZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSW5jcmVtZW50YWxNZXJnZShhdHRycyk7CiAgfQogIHN0YXRpYyBpbnRlcmFjdGl2ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBJbnRlcmFjdGl2ZShhdHRycyk7CiAgfQogIHN0YXRpYyBqb2coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSm9nKGF0dHJzKTsKICB9CiAgc3RhdGljIGxhYmVsUHJpbnRlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBMYWJlbFByaW50ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgbGF5b3V0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExheW91dChhdHRycyk7CiAgfQogIHN0YXRpYyBsZXZlbChhdHRycykgewogICAgcmV0dXJuIG5ldyBMZXZlbChhdHRycyk7CiAgfQogIHN0YXRpYyBsaW5lYXJpemVkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExpbmVhcml6ZWQoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9jYWxlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExvY2FsZShhdHRycyk7CiAgfQogIHN0YXRpYyBsb2NhbGVTZXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTG9jYWxlU2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIGxvZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBMb2coYXR0cnMpOwogIH0KICBzdGF0aWMgbWFwKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1hcEVsZW1lbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVkaXVtSW5mbyhhdHRycykgewogICAgcmV0dXJuIG5ldyBNZWRpdW1JbmZvKGF0dHJzKTsKICB9CiAgc3RhdGljIG1lc3NhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29uZmlnX01lc3NhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVzc2FnaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lc3NhZ2luZyhhdHRycyk7CiAgfQogIHN0YXRpYyBtb2RlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1vZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgbW9kaWZ5QW5ub3RzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1vZGlmeUFubm90cyhhdHRycyk7CiAgfQogIHN0YXRpYyBtc2dJZChhdHRycykgewogICAgcmV0dXJuIG5ldyBNc2dJZChhdHRycyk7CiAgfQogIHN0YXRpYyBuYW1lQXR0cihhdHRycykgewogICAgcmV0dXJuIG5ldyBOYW1lQXR0cihhdHRycyk7CiAgfQogIHN0YXRpYyBuZXZlckVtYmVkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE5ldmVyRW1iZWQoYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtYmVyT2ZDb3BpZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyT2ZDb3BpZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgb3BlbkFjdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBPcGVuQWN0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIG91dHB1dChhdHRycykgewogICAgcmV0dXJuIG5ldyBPdXRwdXQoYXR0cnMpOwogIH0KICBzdGF0aWMgb3V0cHV0QmluKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE91dHB1dEJpbihhdHRycyk7CiAgfQogIHN0YXRpYyBvdXRwdXRYU0woYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3V0cHV0WFNMKGF0dHJzKTsKICB9CiAgc3RhdGljIG92ZXJwcmludChhdHRycykgewogICAgcmV0dXJuIG5ldyBPdmVycHJpbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFja2V0cyhhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWNrZXRzKGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2VPZmZzZXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnZU9mZnNldChhdHRycyk7CiAgfQogIHN0YXRpYyBwYWdlUmFuZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnZVJhbmdlKGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2luYXRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnaW5hdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBwYWdpbmF0aW9uT3ZlcnJpZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnaW5hdGlvbk92ZXJyaWRlKGF0dHJzKTsKICB9CiAgc3RhdGljIHBhcnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFydChhdHRycyk7CiAgfQogIHN0YXRpYyBwY2woYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGNsKGF0dHJzKTsKICB9CiAgc3RhdGljIHBkZihhdHRycykgewogICAgcmV0dXJuIG5ldyBQZGYoYXR0cnMpOwogIH0KICBzdGF0aWMgcGRmYShhdHRycykgewogICAgcmV0dXJuIG5ldyBQZGZhKGF0dHJzKTsKICB9CiAgc3RhdGljIHBlcm1pc3Npb25zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBlcm1pc3Npb25zKGF0dHJzKTsKICB9CiAgc3RhdGljIHBpY2tUcmF5QnlQREZTaXplKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBpY2tUcmF5QnlQREZTaXplKGF0dHJzKTsKICB9CiAgc3RhdGljIHBpY3R1cmUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29uZmlnX1BpY3R1cmUoYXR0cnMpOwogIH0KICBzdGF0aWMgcGxhaW50ZXh0TWV0YWRhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGxhaW50ZXh0TWV0YWRhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJlc2VuY2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJlc2VuY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJlc2VudChhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmVzZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHByaW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByaW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHByaW50SGlnaFF1YWxpdHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJpbnRIaWdoUXVhbGl0eShhdHRycyk7CiAgfQogIHN0YXRpYyBwcmludFNjYWxpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJpbnRTY2FsaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIHByaW50ZXJOYW1lKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByaW50ZXJOYW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIHByb2R1Y2VyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByb2R1Y2VyKGF0dHJzKTsKICB9CiAgc3RhdGljIHBzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBzKGF0dHJzKTsKICB9CiAgc3RhdGljIHJhbmdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJhbmdlKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlY29yZChhdHRycykgewogICAgcmV0dXJuIG5ldyBSZWNvcmQoYXR0cnMpOwogIH0KICBzdGF0aWMgcmVsZXZhbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVsZXZhbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgcmVuYW1lKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlbmFtZShhdHRycyk7CiAgfQogIHN0YXRpYyByZW5kZXJQb2xpY3koYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVuZGVyUG9saWN5KGF0dHJzKTsKICB9CiAgc3RhdGljIHJ1blNjcmlwdHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUnVuU2NyaXB0cyhhdHRycyk7CiAgfQogIHN0YXRpYyBzY3JpcHQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29uZmlnX1NjcmlwdChhdHRycyk7CiAgfQogIHN0YXRpYyBzY3JpcHRNb2RlbChhdHRycykgewogICAgcmV0dXJuIG5ldyBTY3JpcHRNb2RlbChhdHRycyk7CiAgfQogIHN0YXRpYyBzZXZlcml0eShhdHRycykgewogICAgcmV0dXJuIG5ldyBTZXZlcml0eShhdHRycyk7CiAgfQogIHN0YXRpYyBzaWxlbnRQcmludChhdHRycykgewogICAgcmV0dXJuIG5ldyBTaWxlbnRQcmludChhdHRycyk7CiAgfQogIHN0YXRpYyBzdGFwbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3RhcGxlKGF0dHJzKTsKICB9CiAgc3RhdGljIHN0YXJ0Tm9kZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTdGFydE5vZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgc3RhcnRQYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN0YXJ0UGFnZShhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJtaXRGb3JtYXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3VibWl0Rm9ybWF0KGF0dHJzKTsKICB9CiAgc3RhdGljIHN1Ym1pdFVybChhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJtaXRVcmwoYXR0cnMpOwogIH0KICBzdGF0aWMgc3Vic2V0QmVsb3coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3Vic2V0QmVsb3coYXR0cnMpOwogIH0KICBzdGF0aWMgc3VwcHJlc3NCYW5uZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3VwcHJlc3NCYW5uZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgdGFnZ2VkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRhZ2dlZChhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfVGVtcGxhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdGVtcGxhdGVDYWNoZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUZW1wbGF0ZUNhY2hlKGF0dHJzKTsKICB9CiAgc3RhdGljIHRocmVzaG9sZChhdHRycykgewogICAgcmV0dXJuIG5ldyBUaHJlc2hvbGQoYXR0cnMpOwogIH0KICBzdGF0aWMgdG8oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVG8oYXR0cnMpOwogIH0KICBzdGF0aWMgdHJhY2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgdHJhbnNmb3JtKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRyYW5zZm9ybShhdHRycyk7CiAgfQogIHN0YXRpYyB0eXBlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFR5cGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdXJpKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFVyaShhdHRycyk7CiAgfQogIHN0YXRpYyB2YWxpZGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfVmFsaWRhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsaWRhdGVBcHByb3ZhbFNpZ25hdHVyZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsaWRhdGVBcHByb3ZhbFNpZ25hdHVyZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsaWRhdGlvbk1lc3NhZ2luZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uTWVzc2FnaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIHZlcnNpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmVyc2lvbihhdHRycyk7CiAgfQogIHN0YXRpYyB2ZXJzaW9uQ29udHJvbChhdHRycykgewogICAgcmV0dXJuIG5ldyBWZXJzaW9uQ29udHJvbChhdHRycyk7CiAgfQogIHN0YXRpYyB2aWV3ZXJQcmVmZXJlbmNlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBWaWV3ZXJQcmVmZXJlbmNlcyhhdHRycyk7CiAgfQogIHN0YXRpYyB3ZWJDbGllbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgV2ViQ2xpZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHdoaXRlc3BhY2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgV2hpdGVzcGFjZShhdHRycyk7CiAgfQogIHN0YXRpYyB3aW5kb3coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgV2luZG93KGF0dHJzKTsKICB9CiAgc3RhdGljIHhkYyhhdHRycykgewogICAgcmV0dXJuIG5ldyBYZGMoYXR0cnMpOwogIH0KICBzdGF0aWMgeGRwKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFhkcChhdHRycyk7CiAgfQogIHN0YXRpYyB4c2woYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWHNsKGF0dHJzKTsKICB9CiAgc3RhdGljIHpwbChhdHRycykgewogICAgcmV0dXJuIG5ldyBacGwoYXR0cnMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2Nvbm5lY3Rpb25fc2V0LmpzCgoKY29uc3QgQ09OTkVDVElPTl9TRVRfTlNfSUQgPSBOYW1lc3BhY2VJZHMuY29ubmVjdGlvblNldC5pZDsKY2xhc3MgQ29ubmVjdGlvblNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJjb25uZWN0aW9uU2V0IiwgdHJ1ZSk7CiAgICB0aGlzLndzZGxDb25uZWN0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnhtbENvbm5lY3Rpb24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMueHNkQ29ubmVjdGlvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBFZmZlY3RpdmVJbnB1dFBvbGljeSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJlZmZlY3RpdmVJbnB1dFBvbGljeSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBFZmZlY3RpdmVPdXRwdXRQb2xpY3kgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAiZWZmZWN0aXZlT3V0cHV0UG9saWN5Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIE9wZXJhdGlvbiBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJvcGVyYXRpb24iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbnB1dCA9IGF0dHJpYnV0ZXMuaW5wdXQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLm91dHB1dCA9IGF0dHJpYnV0ZXMub3V0cHV0IHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgUm9vdEVsZW1lbnQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAicm9vdEVsZW1lbnQiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgU29hcEFjdGlvbiBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJzb2FwQWN0aW9uIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFNvYXBBZGRyZXNzIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInNvYXBBZGRyZXNzIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIGNvbm5lY3Rpb25fc2V0X1VyaSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ1cmkiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgV3NkbEFkZHJlc3MgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAid3NkbEFkZHJlc3MiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgV3NkbENvbm5lY3Rpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAid3NkbENvbm5lY3Rpb24iLCB0cnVlKTsKICAgIHRoaXMuZGF0YURlc2NyaXB0aW9uID0gYXR0cmlidXRlcy5kYXRhRGVzY3JpcHRpb24gfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLmVmZmVjdGl2ZUlucHV0UG9saWN5ID0gbnVsbDsKICAgIHRoaXMuZWZmZWN0aXZlT3V0cHV0UG9saWN5ID0gbnVsbDsKICAgIHRoaXMub3BlcmF0aW9uID0gbnVsbDsKICAgIHRoaXMuc29hcEFjdGlvbiA9IG51bGw7CiAgICB0aGlzLnNvYXBBZGRyZXNzID0gbnVsbDsKICAgIHRoaXMud3NkbEFkZHJlc3MgPSBudWxsOwogIH0KfQpjbGFzcyBYbWxDb25uZWN0aW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInhtbENvbm5lY3Rpb24iLCB0cnVlKTsKICAgIHRoaXMuZGF0YURlc2NyaXB0aW9uID0gYXR0cmlidXRlcy5kYXRhRGVzY3JpcHRpb24gfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIFhzZENvbm5lY3Rpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAieHNkQ29ubmVjdGlvbiIsIHRydWUpOwogICAgdGhpcy5kYXRhRGVzY3JpcHRpb24gPSBhdHRyaWJ1dGVzLmRhdGFEZXNjcmlwdGlvbiB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucm9vdEVsZW1lbnQgPSBudWxsOwogICAgdGhpcy51cmkgPSBudWxsOwogIH0KfQpjbGFzcyBDb25uZWN0aW9uU2V0TmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKENvbm5lY3Rpb25TZXROYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIENvbm5lY3Rpb25TZXROYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgY29ubmVjdGlvblNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBDb25uZWN0aW9uU2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIGVmZmVjdGl2ZUlucHV0UG9saWN5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVmZmVjdGl2ZUlucHV0UG9saWN5KGF0dHJzKTsKICB9CiAgc3RhdGljIGVmZmVjdGl2ZU91dHB1dFBvbGljeShhdHRycykgewogICAgcmV0dXJuIG5ldyBFZmZlY3RpdmVPdXRwdXRQb2xpY3koYXR0cnMpOwogIH0KICBzdGF0aWMgb3BlcmF0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9wZXJhdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyByb290RWxlbWVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBSb290RWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBzb2FwQWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNvYXBBY3Rpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgc29hcEFkZHJlc3MoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU29hcEFkZHJlc3MoYXR0cnMpOwogIH0KICBzdGF0aWMgdXJpKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbm5lY3Rpb25fc2V0X1VyaShhdHRycyk7CiAgfQogIHN0YXRpYyB3c2RsQWRkcmVzcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBXc2RsQWRkcmVzcyhhdHRycyk7CiAgfQogIHN0YXRpYyB3c2RsQ29ubmVjdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBXc2RsQ29ubmVjdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyB4bWxDb25uZWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFhtbENvbm5lY3Rpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgeHNkQ29ubmVjdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBYc2RDb25uZWN0aW9uKGF0dHJzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9kYXRhc2V0cy5qcwoKCgpjb25zdCBEQVRBU0VUU19OU19JRCA9IE5hbWVzcGFjZUlkcy5kYXRhc2V0cy5pZDsKY2xhc3MgZGF0YXNldHNfRGF0YSBleHRlbmRzIFhtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoREFUQVNFVFNfTlNfSUQsICJkYXRhIiwgYXR0cmlidXRlcyk7CiAgfQogIFskaXNOc0Fnbm9zdGljXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBEYXRhc2V0cyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoREFUQVNFVFNfTlNfSUQsICJkYXRhc2V0cyIsIHRydWUpOwogICAgdGhpcy5kYXRhID0gbnVsbDsKICAgIHRoaXMuU2lnbmF0dXJlID0gbnVsbDsKICB9CiAgWyRvbkNoaWxkXShjaGlsZCkgewogICAgY29uc3QgbmFtZSA9IGNoaWxkWyRub2RlTmFtZV07CiAgICBpZiAobmFtZSA9PT0gImRhdGEiICYmIGNoaWxkWyRuYW1lc3BhY2VJZF0gPT09IERBVEFTRVRTX05TX0lEIHx8IG5hbWUgPT09ICJTaWduYXR1cmUiICYmIGNoaWxkWyRuYW1lc3BhY2VJZF0gPT09IE5hbWVzcGFjZUlkcy5zaWduYXR1cmUuaWQpIHsKICAgICAgdGhpc1tuYW1lXSA9IGNoaWxkOwogICAgfQogICAgdGhpc1skYXBwZW5kQ2hpbGRdKGNoaWxkKTsKICB9Cn0KY2xhc3MgRGF0YXNldHNOYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoRGF0YXNldHNOYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIERhdGFzZXRzTmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGRhdGFzZXRzKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgRGF0YXNldHMoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBkYXRhKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgZGF0YXNldHNfRGF0YShhdHRyaWJ1dGVzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9sb2NhbGVfc2V0LmpzCgoKCmNvbnN0IExPQ0FMRV9TRVRfTlNfSUQgPSBOYW1lc3BhY2VJZHMubG9jYWxlU2V0LmlkOwpjbGFzcyBDYWxlbmRhclN5bWJvbHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJjYWxlbmRhclN5bWJvbHMiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9ICJncmVnb3JpYW4iOwogICAgdGhpcy5kYXlOYW1lcyA9IG5ldyBYRkFPYmplY3RBcnJheSgyKTsKICAgIHRoaXMuZXJhTmFtZXMgPSBudWxsOwogICAgdGhpcy5tZXJpZGllbU5hbWVzID0gbnVsbDsKICAgIHRoaXMubW9udGhOYW1lcyA9IG5ldyBYRkFPYmplY3RBcnJheSgyKTsKICB9Cn0KY2xhc3MgQ3VycmVuY3lTeW1ib2wgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJjdXJyZW5jeVN5bWJvbCIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJzeW1ib2wiLCAiaXNvbmFtZSIsICJkZWNpbWFsIl0pOwogIH0KfQpjbGFzcyBDdXJyZW5jeVN5bWJvbHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJjdXJyZW5jeVN5bWJvbHMiLCB0cnVlKTsKICAgIHRoaXMuY3VycmVuY3lTeW1ib2wgPSBuZXcgWEZBT2JqZWN0QXJyYXkoMyk7CiAgfQp9CmNsYXNzIERhdGVQYXR0ZXJuIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF0ZVBhdHRlcm4iKTsKICAgIHRoaXMubmFtZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm5hbWUsIFsiZnVsbCIsICJsb25nIiwgIm1lZCIsICJzaG9ydCJdKTsKICB9Cn0KY2xhc3MgRGF0ZVBhdHRlcm5zIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF0ZVBhdHRlcm5zIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGVQYXR0ZXJuID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogIH0KfQpjbGFzcyBEYXRlVGltZVN5bWJvbHMgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF0ZVRpbWVTeW1ib2xzIik7CiAgfQp9CmNsYXNzIERheSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImRheSIpOwogIH0KfQpjbGFzcyBEYXlOYW1lcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImRheU5hbWVzIiwgdHJ1ZSk7CiAgICB0aGlzLmFiYnIgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5hYmJyLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5kYXkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoNyk7CiAgfQp9CmNsYXNzIEVyYSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImVyYSIpOwogIH0KfQpjbGFzcyBFcmFOYW1lcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImVyYU5hbWVzIiwgdHJ1ZSk7CiAgICB0aGlzLmVyYSA9IG5ldyBYRkFPYmplY3RBcnJheSgyKTsKICB9Cn0KY2xhc3MgbG9jYWxlX3NldF9Mb2NhbGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJsb2NhbGUiLCB0cnVlKTsKICAgIHRoaXMuZGVzYyA9IGF0dHJpYnV0ZXMuZGVzYyB8fCAiIjsKICAgIHRoaXMubmFtZSA9ICJpc29uYW1lIjsKICAgIHRoaXMuY2FsZW5kYXJTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMuY3VycmVuY3lTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMuZGF0ZVBhdHRlcm5zID0gbnVsbDsKICAgIHRoaXMuZGF0ZVRpbWVTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMubnVtYmVyUGF0dGVybnMgPSBudWxsOwogICAgdGhpcy5udW1iZXJTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMudGltZVBhdHRlcm5zID0gbnVsbDsKICAgIHRoaXMudHlwZUZhY2VzID0gbnVsbDsKICB9Cn0KY2xhc3MgbG9jYWxlX3NldF9Mb2NhbGVTZXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJsb2NhbGVTZXQiLCB0cnVlKTsKICAgIHRoaXMubG9jYWxlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE1lcmlkaWVtIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibWVyaWRpZW0iKTsKICB9Cn0KY2xhc3MgTWVyaWRpZW1OYW1lcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm1lcmlkaWVtTmFtZXMiLCB0cnVlKTsKICAgIHRoaXMubWVyaWRpZW0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoMik7CiAgfQp9CmNsYXNzIE1vbnRoIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibW9udGgiKTsKICB9Cn0KY2xhc3MgTW9udGhOYW1lcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm1vbnRoTmFtZXMiLCB0cnVlKTsKICAgIHRoaXMuYWJiciA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFiYnIsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLm1vbnRoID0gbmV3IFhGQU9iamVjdEFycmF5KDEyKTsKICB9Cn0KY2xhc3MgTnVtYmVyUGF0dGVybiBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm51bWJlclBhdHRlcm4iKTsKICAgIHRoaXMubmFtZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm5hbWUsIFsiZnVsbCIsICJsb25nIiwgIm1lZCIsICJzaG9ydCJdKTsKICB9Cn0KY2xhc3MgTnVtYmVyUGF0dGVybnMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJudW1iZXJQYXR0ZXJucyIsIHRydWUpOwogICAgdGhpcy5udW1iZXJQYXR0ZXJuID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogIH0KfQpjbGFzcyBOdW1iZXJTeW1ib2wgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJudW1iZXJTeW1ib2wiKTsKICAgIHRoaXMubmFtZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm5hbWUsIFsiZGVjaW1hbCIsICJncm91cGluZyIsICJwZXJjZW50IiwgIm1pbnVzIiwgInplcm8iXSk7CiAgfQp9CmNsYXNzIE51bWJlclN5bWJvbHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJudW1iZXJTeW1ib2xzIiwgdHJ1ZSk7CiAgICB0aGlzLm51bWJlclN5bWJvbCA9IG5ldyBYRkFPYmplY3RBcnJheSg1KTsKICB9Cn0KY2xhc3MgVGltZVBhdHRlcm4gZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJ0aW1lUGF0dGVybiIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJmdWxsIiwgImxvbmciLCAibWVkIiwgInNob3J0Il0pOwogIH0KfQpjbGFzcyBUaW1lUGF0dGVybnMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJ0aW1lUGF0dGVybnMiLCB0cnVlKTsKICAgIHRoaXMudGltZVBhdHRlcm4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoNCk7CiAgfQp9CmNsYXNzIFR5cGVGYWNlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAidHlwZUZhY2UiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8ICIiOwogIH0KfQpjbGFzcyBUeXBlRmFjZXMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJ0eXBlRmFjZXMiLCB0cnVlKTsKICAgIHRoaXMudHlwZUZhY2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgTG9jYWxlU2V0TmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKExvY2FsZVNldE5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gTG9jYWxlU2V0TmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGNhbGVuZGFyU3ltYm9scyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDYWxlbmRhclN5bWJvbHMoYXR0cnMpOwogIH0KICBzdGF0aWMgY3VycmVuY3lTeW1ib2woYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ3VycmVuY3lTeW1ib2woYXR0cnMpOwogIH0KICBzdGF0aWMgY3VycmVuY3lTeW1ib2xzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEN1cnJlbmN5U3ltYm9scyhhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlUGF0dGVybihhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlUGF0dGVybnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGF0ZVBhdHRlcm5zKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVUaW1lU3ltYm9scyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlVGltZVN5bWJvbHMoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERheShhdHRycyk7CiAgfQogIHN0YXRpYyBkYXlOYW1lcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXlOYW1lcyhhdHRycyk7CiAgfQogIHN0YXRpYyBlcmEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXJhKGF0dHJzKTsKICB9CiAgc3RhdGljIGVyYU5hbWVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVyYU5hbWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGxvY2FsZShhdHRycykgewogICAgcmV0dXJuIG5ldyBsb2NhbGVfc2V0X0xvY2FsZShhdHRycyk7CiAgfQogIHN0YXRpYyBsb2NhbGVTZXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgbG9jYWxlX3NldF9Mb2NhbGVTZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVyaWRpZW0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWVyaWRpZW0oYXR0cnMpOwogIH0KICBzdGF0aWMgbWVyaWRpZW1OYW1lcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBNZXJpZGllbU5hbWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIG1vbnRoKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1vbnRoKGF0dHJzKTsKICB9CiAgc3RhdGljIG1vbnRoTmFtZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9udGhOYW1lcyhhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJQYXR0ZXJuKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE51bWJlclBhdHRlcm4oYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtYmVyUGF0dGVybnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyUGF0dGVybnMoYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtYmVyU3ltYm9sKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE51bWJlclN5bWJvbChhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJTeW1ib2xzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE51bWJlclN5bWJvbHMoYXR0cnMpOwogIH0KICBzdGF0aWMgdGltZVBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGltZVBhdHRlcm4oYXR0cnMpOwogIH0KICBzdGF0aWMgdGltZVBhdHRlcm5zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRpbWVQYXR0ZXJucyhhdHRycyk7CiAgfQogIHN0YXRpYyB0eXBlRmFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUeXBlRmFjZShhdHRycyk7CiAgfQogIHN0YXRpYyB0eXBlRmFjZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHlwZUZhY2VzKGF0dHJzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9zaWduYXR1cmUuanMKCgpjb25zdCBTSUdOQVRVUkVfTlNfSUQgPSBOYW1lc3BhY2VJZHMuc2lnbmF0dXJlLmlkOwpjbGFzcyBzaWduYXR1cmVfU2lnbmF0dXJlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihTSUdOQVRVUkVfTlNfSUQsICJzaWduYXR1cmUiLCB0cnVlKTsKICB9Cn0KY2xhc3MgU2lnbmF0dXJlTmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKFNpZ25hdHVyZU5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gU2lnbmF0dXJlTmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIHNpZ25hdHVyZShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IHNpZ25hdHVyZV9TaWduYXR1cmUoYXR0cmlidXRlcyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvc3R5bGVzaGVldC5qcwoKCmNvbnN0IFNUWUxFU0hFRVRfTlNfSUQgPSBOYW1lc3BhY2VJZHMuc3R5bGVzaGVldC5pZDsKY2xhc3MgU3R5bGVzaGVldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoU1RZTEVTSEVFVF9OU19JRCwgInN0eWxlc2hlZXQiLCB0cnVlKTsKICB9Cn0KY2xhc3MgU3R5bGVzaGVldE5hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChTdHlsZXNoZWV0TmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBTdHlsZXNoZWV0TmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIHN0eWxlc2hlZXQoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdHlsZXNoZWV0KGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3hkcC5qcwoKCgpjb25zdCBYRFBfTlNfSUQgPSBOYW1lc3BhY2VJZHMueGRwLmlkOwpjbGFzcyB4ZHBfWGRwIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihYRFBfTlNfSUQsICJ4ZHAiLCB0cnVlKTsKICAgIHRoaXMudXVpZCA9IGF0dHJpYnV0ZXMudXVpZCB8fCAiIjsKICAgIHRoaXMudGltZVN0YW1wID0gYXR0cmlidXRlcy50aW1lU3RhbXAgfHwgIiI7CiAgICB0aGlzLmNvbmZpZyA9IG51bGw7CiAgICB0aGlzLmNvbm5lY3Rpb25TZXQgPSBudWxsOwogICAgdGhpcy5kYXRhc2V0cyA9IG51bGw7CiAgICB0aGlzLmxvY2FsZVNldCA9IG51bGw7CiAgICB0aGlzLnN0eWxlc2hlZXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGVtcGxhdGUgPSBudWxsOwogIH0KICBbJG9uQ2hpbGRDaGVja10oY2hpbGQpIHsKICAgIGNvbnN0IG5zID0gTmFtZXNwYWNlSWRzW2NoaWxkWyRub2RlTmFtZV1dOwogICAgcmV0dXJuIG5zICYmIGNoaWxkWyRuYW1lc3BhY2VJZF0gPT09IG5zLmlkOwogIH0KfQpjbGFzcyBYZHBOYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoWGRwTmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBYZHBOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgeGRwKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgeGRwX1hkcChhdHRyaWJ1dGVzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS94aHRtbC5qcwoKCgoKCmNvbnN0IFhIVE1MX05TX0lEID0gTmFtZXNwYWNlSWRzLnhodG1sLmlkOwpjb25zdCAkcmljaFRleHQgPSBTeW1ib2woKTsKY29uc3QgVkFMSURfU1RZTEVTID0gbmV3IFNldChbImNvbG9yIiwgImZvbnQiLCAiZm9udC1mYW1pbHkiLCAiZm9udC1zaXplIiwgImZvbnQtc3RyZXRjaCIsICJmb250LXN0eWxlIiwgImZvbnQtd2VpZ2h0IiwgIm1hcmdpbiIsICJtYXJnaW4tYm90dG9tIiwgIm1hcmdpbi1sZWZ0IiwgIm1hcmdpbi1yaWdodCIsICJtYXJnaW4tdG9wIiwgImxldHRlci1zcGFjaW5nIiwgImxpbmUtaGVpZ2h0IiwgIm9ycGhhbnMiLCAicGFnZS1icmVhay1hZnRlciIsICJwYWdlLWJyZWFrLWJlZm9yZSIsICJwYWdlLWJyZWFrLWluc2lkZSIsICJ0YWItaW50ZXJ2YWwiLCAidGFiLXN0b3AiLCAidGV4dC1hbGlnbiIsICJ0ZXh0LWRlY29yYXRpb24iLCAidGV4dC1pbmRlbnQiLCAidmVydGljYWwtYWxpZ24iLCAid2lkb3dzIiwgImtlcm5pbmctbW9kZSIsICJ4ZmEtZm9udC1ob3Jpem9udGFsLXNjYWxlIiwgInhmYS1mb250LXZlcnRpY2FsLXNjYWxlIiwgInhmYS1zcGFjZXJ1biIsICJ4ZmEtdGFiLXN0b3BzIl0pOwpjb25zdCBTdHlsZU1hcHBpbmcgPSBuZXcgTWFwKFtbInBhZ2UtYnJlYWstYWZ0ZXIiLCAiYnJlYWtBZnRlciJdLCBbInBhZ2UtYnJlYWstYmVmb3JlIiwgImJyZWFrQmVmb3JlIl0sIFsicGFnZS1icmVhay1pbnNpZGUiLCAiYnJlYWtJbnNpZGUiXSwgWyJrZXJuaW5nLW1vZGUiLCB2YWx1ZSA9PiB2YWx1ZSA9PT0gIm5vbmUiID8gIm5vbmUiIDogIm5vcm1hbCJdLCBbInhmYS1mb250LWhvcml6b250YWwtc2NhbGUiLCB2YWx1ZSA9PiBgc2NhbGVYKCR7TWF0aC5tYXgoMCwgcGFyc2VJbnQodmFsdWUpIC8gMTAwKS50b0ZpeGVkKDIpfSlgXSwgWyJ4ZmEtZm9udC12ZXJ0aWNhbC1zY2FsZSIsIHZhbHVlID0+IGBzY2FsZVkoJHtNYXRoLm1heCgwLCBwYXJzZUludCh2YWx1ZSkgLyAxMDApLnRvRml4ZWQoMil9KWBdLCBbInhmYS1zcGFjZXJ1biIsICIiXSwgWyJ4ZmEtdGFiLXN0b3BzIiwgIiJdLCBbImZvbnQtc2l6ZSIsICh2YWx1ZSwgb3JpZ2luYWwpID0+IHsKICB2YWx1ZSA9IG9yaWdpbmFsLmZvbnRTaXplID0gTWF0aC5hYnMoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKTsKICByZXR1cm4gbWVhc3VyZVRvU3RyaW5nKDAuOTkgKiB2YWx1ZSk7Cn1dLCBbImxldHRlci1zcGFjaW5nIiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbImxpbmUtaGVpZ2h0IiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbIm1hcmdpbiIsIHZhbHVlID0+IG1lYXN1cmVUb1N0cmluZyhnZXRNZWFzdXJlbWVudCh2YWx1ZSkpXSwgWyJtYXJnaW4tYm90dG9tIiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbIm1hcmdpbi1sZWZ0IiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbIm1hcmdpbi1yaWdodCIsIHZhbHVlID0+IG1lYXN1cmVUb1N0cmluZyhnZXRNZWFzdXJlbWVudCh2YWx1ZSkpXSwgWyJtYXJnaW4tdG9wIiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbInRleHQtaW5kZW50IiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbImZvbnQtZmFtaWx5IiwgdmFsdWUgPT4gdmFsdWVdLCBbInZlcnRpY2FsLWFsaWduIiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldXSk7CmNvbnN0IHNwYWNlc1JlZ0V4cCA9IC9ccysvZzsKY29uc3QgY3JsZlJlZ0V4cCA9IC9bXHJcbl0rL2c7CmNvbnN0IGNybGZGb3JSaWNoVGV4dFJlZ0V4cCA9IC9cclxuPy9nOwpmdW5jdGlvbiBtYXBTdHlsZShzdHlsZVN0ciwgbm9kZSwgcmljaFRleHQpIHsKICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgaWYgKCFzdHlsZVN0cikgewogICAgcmV0dXJuIHN0eWxlOwogIH0KICBjb25zdCBvcmlnaW5hbCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2Ygc3R5bGVTdHIuc3BsaXQoIjsiKS5tYXAocyA9PiBzLnNwbGl0KCI6IiwgMikpKSB7CiAgICBjb25zdCBtYXBwaW5nID0gU3R5bGVNYXBwaW5nLmdldChrZXkpOwogICAgaWYgKG1hcHBpbmcgPT09ICIiKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgbGV0IG5ld1ZhbHVlID0gdmFsdWU7CiAgICBpZiAobWFwcGluZykgewogICAgICBuZXdWYWx1ZSA9IHR5cGVvZiBtYXBwaW5nID09PSAic3RyaW5nIiA/IG1hcHBpbmcgOiBtYXBwaW5nKHZhbHVlLCBvcmlnaW5hbCk7CiAgICB9CiAgICBpZiAoa2V5LmVuZHNXaXRoKCJzY2FsZSIpKSB7CiAgICAgIHN0eWxlLnRyYW5zZm9ybSA9IHN0eWxlLnRyYW5zZm9ybSA/IGAke3N0eWxlW2tleV19ICR7bmV3VmFsdWV9YCA6IG5ld1ZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgc3R5bGVba2V5LnJlcGxhY2VBbGwoLy0oW2EtekEtWl0pL2csIChfLCB4KSA9PiB4LnRvVXBwZXJDYXNlKCkpXSA9IG5ld1ZhbHVlOwogICAgfQogIH0KICBpZiAoc3R5bGUuZm9udEZhbWlseSkgewogICAgc2V0Rm9udEZhbWlseSh7CiAgICAgIHR5cGVmYWNlOiBzdHlsZS5mb250RmFtaWx5LAogICAgICB3ZWlnaHQ6IHN0eWxlLmZvbnRXZWlnaHQgfHwgIm5vcm1hbCIsCiAgICAgIHBvc3R1cmU6IHN0eWxlLmZvbnRTdHlsZSB8fCAibm9ybWFsIiwKICAgICAgc2l6ZTogb3JpZ2luYWwuZm9udFNpemUgfHwgMAogICAgfSwgbm9kZSwgbm9kZVskZ2xvYmFsRGF0YV0uZm9udEZpbmRlciwgc3R5bGUpOwogIH0KICBpZiAocmljaFRleHQgJiYgc3R5bGUudmVydGljYWxBbGlnbiAmJiBzdHlsZS52ZXJ0aWNhbEFsaWduICE9PSAiMHB4IiAmJiBzdHlsZS5mb250U2l6ZSkgewogICAgY29uc3QgU1VCX1NVUEVSX1NDUklQVF9GQUNUT1IgPSAwLjU4MzsKICAgIGNvbnN0IFZFUlRJQ0FMX0ZBQ1RPUiA9IDAuMzMzOwogICAgY29uc3QgZm9udFNpemUgPSBnZXRNZWFzdXJlbWVudChzdHlsZS5mb250U2l6ZSk7CiAgICBzdHlsZS5mb250U2l6ZSA9IG1lYXN1cmVUb1N0cmluZyhmb250U2l6ZSAqIFNVQl9TVVBFUl9TQ1JJUFRfRkFDVE9SKTsKICAgIHN0eWxlLnZlcnRpY2FsQWxpZ24gPSBtZWFzdXJlVG9TdHJpbmcoTWF0aC5zaWduKGdldE1lYXN1cmVtZW50KHN0eWxlLnZlcnRpY2FsQWxpZ24pKSAqIGZvbnRTaXplICogVkVSVElDQUxfRkFDVE9SKTsKICB9CiAgaWYgKHJpY2hUZXh0ICYmIHN0eWxlLmZvbnRTaXplKSB7CiAgICBzdHlsZS5mb250U2l6ZSA9IGBjYWxjKCR7c3R5bGUuZm9udFNpemV9ICogdmFyKC0tdG90YWwtc2NhbGUtZmFjdG9yKSlgOwogIH0KICBmaXhUZXh0SW5kZW50KHN0eWxlKTsKICByZXR1cm4gc3R5bGU7Cn0KZnVuY3Rpb24gY2hlY2tTdHlsZShub2RlKSB7CiAgaWYgKCFub2RlLnN0eWxlKSB7CiAgICByZXR1cm4gIiI7CiAgfQogIHJldHVybiBub2RlLnN0eWxlLnNwbGl0KCI7IikuZmlsdGVyKHMgPT4gISFzLnRyaW0oKSkubWFwKHMgPT4gcy5zcGxpdCgiOiIsIDIpLm1hcCh0ID0+IHQudHJpbSgpKSkuZmlsdGVyKChba2V5LCB2YWx1ZV0pID0+IHsKICAgIGlmIChrZXkgPT09ICJmb250LWZhbWlseSIpIHsKICAgICAgbm9kZVskZ2xvYmFsRGF0YV0udXNlZFR5cGVmYWNlcy5hZGQodmFsdWUpOwogICAgfQogICAgcmV0dXJuIFZBTElEX1NUWUxFUy5oYXMoa2V5KTsKICB9KS5tYXAoa3YgPT4ga3Yuam9pbigiOiIpKS5qb2luKCI7Iik7Cn0KY29uc3QgTm9XaGl0ZXMgPSBuZXcgU2V0KFsiYm9keSIsICJodG1sIl0pOwpjbGFzcyBYaHRtbE9iamVjdCBleHRlbmRzIFhtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcywgbmFtZSkgewogICAgc3VwZXIoWEhUTUxfTlNfSUQsIG5hbWUpOwogICAgdGhpc1skcmljaFRleHRdID0gZmFsc2U7CiAgICB0aGlzLnN0eWxlID0gYXR0cmlidXRlcy5zdHlsZSB8fCAiIjsKICB9CiAgWyRjbGVhbl0oYnVpbGRlcikgewogICAgc3VwZXJbJGNsZWFuXShidWlsZGVyKTsKICAgIHRoaXMuc3R5bGUgPSBjaGVja1N0eWxlKHRoaXMpOwogIH0KICBbJGFjY2VwdFdoaXRlc3BhY2VdKCkgewogICAgcmV0dXJuICFOb1doaXRlcy5oYXModGhpc1skbm9kZU5hbWVdKTsKICB9CiAgWyRvblRleHRdKHN0ciwgcmljaFRleHQgPSBmYWxzZSkgewogICAgaWYgKCFyaWNoVGV4dCkgewogICAgICBzdHIgPSBzdHIucmVwbGFjZUFsbChjcmxmUmVnRXhwLCAiIik7CiAgICAgIGlmICghdGhpcy5zdHlsZS5pbmNsdWRlcygieGZhLXNwYWNlcnVuOnllcyIpKSB7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2VBbGwoc3BhY2VzUmVnRXhwLCAiICIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzWyRyaWNoVGV4dF0gPSB0cnVlOwogICAgfQogICAgaWYgKHN0cikgewogICAgICB0aGlzWyRjb250ZW50XSArPSBzdHI7CiAgICB9CiAgfQogIFskcHVzaEdseXBoc10obWVhc3VyZSwgbXVzdFBvcCA9IHRydWUpIHsKICAgIGNvbnN0IHhmYUZvbnQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgbWFyZ2luID0gewogICAgICB0b3A6IE5hTiwKICAgICAgYm90dG9tOiBOYU4sCiAgICAgIGxlZnQ6IE5hTiwKICAgICAgcmlnaHQ6IE5hTgogICAgfTsKICAgIGxldCBsaW5lSGVpZ2h0ID0gbnVsbDsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuc3R5bGUuc3BsaXQoIjsiKS5tYXAocyA9PiBzLnNwbGl0KCI6IiwgMikpKSB7CiAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgY2FzZSAiZm9udC1mYW1pbHkiOgogICAgICAgICAgeGZhRm9udC50eXBlZmFjZSA9IHN0cmlwUXVvdGVzKHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZvbnQtc2l6ZSI6CiAgICAgICAgICB4ZmFGb250LnNpemUgPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJmb250LXdlaWdodCI6CiAgICAgICAgICB4ZmFGb250LndlaWdodCA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZm9udC1zdHlsZSI6CiAgICAgICAgICB4ZmFGb250LnBvc3R1cmUgPSB2YWx1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxldHRlci1zcGFjaW5nIjoKICAgICAgICAgIHhmYUZvbnQubGV0dGVyU3BhY2luZyA9IGdldE1lYXN1cmVtZW50KHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1hcmdpbiI6CiAgICAgICAgICBjb25zdCB2YWx1ZXMgPSB2YWx1ZS5zcGxpdCgvIFx0LykubWFwKHggPT4gZ2V0TWVhc3VyZW1lbnQoeCkpOwogICAgICAgICAgc3dpdGNoICh2YWx1ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gbWFyZ2luLmJvdHRvbSA9IG1hcmdpbi5sZWZ0ID0gbWFyZ2luLnJpZ2h0ID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgbWFyZ2luLnRvcCA9IG1hcmdpbi5ib3R0b20gPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgbWFyZ2luLmxlZnQgPSBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgIG1hcmdpbi5ib3R0b20gPSB2YWx1ZXNbMl07CiAgICAgICAgICAgICAgbWFyZ2luLmxlZnQgPSBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgIG1hcmdpbi5sZWZ0ID0gdmFsdWVzWzFdOwogICAgICAgICAgICAgIG1hcmdpbi5ib3R0b20gPSB2YWx1ZXNbMl07CiAgICAgICAgICAgICAgbWFyZ2luLnJpZ2h0ID0gdmFsdWVzWzNdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luLXRvcCI6CiAgICAgICAgICBtYXJnaW4udG9wID0gZ2V0TWVhc3VyZW1lbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luLWJvdHRvbSI6CiAgICAgICAgICBtYXJnaW4uYm90dG9tID0gZ2V0TWVhc3VyZW1lbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luLWxlZnQiOgogICAgICAgICAgbWFyZ2luLmxlZnQgPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tcmlnaHQiOgogICAgICAgICAgbWFyZ2luLnJpZ2h0ID0gZ2V0TWVhc3VyZW1lbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibGluZS1oZWlnaHQiOgogICAgICAgICAgbGluZUhlaWdodCA9IGdldE1lYXN1cmVtZW50KHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBtZWFzdXJlLnB1c2hEYXRhKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCk7CiAgICBpZiAodGhpc1skY29udGVudF0pIHsKICAgICAgbWVhc3VyZS5hZGRTdHJpbmcodGhpc1skY29udGVudF0pOwogICAgfSBlbHNlIHsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzWyRnZXRDaGlsZHJlbl0oKSkgewogICAgICAgIGlmIChjaGlsZFskbm9kZU5hbWVdID09PSAiI3RleHQiKSB7CiAgICAgICAgICBtZWFzdXJlLmFkZFN0cmluZyhjaGlsZFskY29udGVudF0pOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNoaWxkWyRwdXNoR2x5cGhzXShtZWFzdXJlKTsKICAgICAgfQogICAgfQogICAgaWYgKG11c3RQb3ApIHsKICAgICAgbWVhc3VyZS5wb3BGb250KCk7CiAgICB9CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIHRoaXNbJGV4dHJhXSA9IHsKICAgICAgY2hpbGRyZW4KICAgIH07CiAgICB0aGlzWyRjaGlsZHJlblRvSFRNTF0oe30pOwogICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCAmJiAhdGhpc1skY29udGVudF0pIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBsZXQgdmFsdWU7CiAgICBpZiAodGhpc1skcmljaFRleHRdKSB7CiAgICAgIHZhbHVlID0gdGhpc1skY29udGVudF0gPyB0aGlzWyRjb250ZW50XS5yZXBsYWNlQWxsKGNybGZGb3JSaWNoVGV4dFJlZ0V4cCwgIlxuIikgOiB1bmRlZmluZWQ7CiAgICB9IGVsc2UgewogICAgICB2YWx1ZSA9IHRoaXNbJGNvbnRlbnRdIHx8IHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiB0aGlzWyRub2RlTmFtZV0sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBocmVmOiB0aGlzLmhyZWYsCiAgICAgICAgc3R5bGU6IG1hcFN0eWxlKHRoaXMuc3R5bGUsIHRoaXMsIHRoaXNbJHJpY2hUZXh0XSkKICAgICAgfSwKICAgICAgY2hpbGRyZW4sCiAgICAgIHZhbHVlCiAgICB9KTsKICB9Cn0KY2xhc3MgQSBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYSIpOwogICAgdGhpcy5ocmVmID0gZml4VVJMKGF0dHJpYnV0ZXMuaHJlZikgfHwgIiI7CiAgfQp9CmNsYXNzIEIgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImIiKTsKICB9CiAgWyRwdXNoR2x5cGhzXShtZWFzdXJlKSB7CiAgICBtZWFzdXJlLnB1c2hGb250KHsKICAgICAgd2VpZ2h0OiAiYm9sZCIKICAgIH0pOwogICAgc3VwZXJbJHB1c2hHbHlwaHNdKG1lYXN1cmUpOwogICAgbWVhc3VyZS5wb3BGb250KCk7CiAgfQp9CmNsYXNzIEJvZHkgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImJvZHkiKTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCByZXMgPSBzdXBlclskdG9IVE1MXShhdmFpbGFibGVTcGFjZSk7CiAgICBjb25zdCB7CiAgICAgIGh0bWwKICAgIH0gPSByZXM7CiAgICBpZiAoIWh0bWwpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBodG1sLm5hbWUgPSAiZGl2IjsKICAgIGh0bWwuYXR0cmlidXRlcy5jbGFzcyA9IFsieGZhUmljaCJdOwogICAgcmV0dXJuIHJlczsKICB9Cn0KY2xhc3MgQnIgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImJyIik7CiAgfQogIFskdGV4dF0oKSB7CiAgICByZXR1cm4gIlxuIjsKICB9CiAgWyRwdXNoR2x5cGhzXShtZWFzdXJlKSB7CiAgICBtZWFzdXJlLmFkZFN0cmluZygiXG4iKTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImJyIgogICAgfSk7CiAgfQp9CmNsYXNzIEh0bWwgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImh0bWwiKTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgdGhpc1skZXh0cmFdID0gewogICAgICBjaGlsZHJlbgogICAgfTsKICAgIHRoaXNbJGNoaWxkcmVuVG9IVE1MXSh7fSk7CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICAgIG5hbWU6ICJkaXYiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNsYXNzOiBbInhmYVJpY2giXSwKICAgICAgICAgIHN0eWxlOiB7fQogICAgICAgIH0sCiAgICAgICAgdmFsdWU6IHRoaXNbJGNvbnRlbnRdIHx8ICIiCiAgICAgIH0pOwogICAgfQogICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMSkgewogICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuWzBdOwogICAgICBpZiAoY2hpbGQuYXR0cmlidXRlcz8uY2xhc3MuaW5jbHVkZXMoInhmYVJpY2giKSkgewogICAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoY2hpbGQpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFSaWNoIl0sCiAgICAgICAgc3R5bGU6IHt9CiAgICAgIH0sCiAgICAgIGNoaWxkcmVuCiAgICB9KTsKICB9Cn0KY2xhc3MgSSBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiaSIpOwogIH0KICBbJHB1c2hHbHlwaHNdKG1lYXN1cmUpIHsKICAgIG1lYXN1cmUucHVzaEZvbnQoewogICAgICBwb3N0dXJlOiAiaXRhbGljIgogICAgfSk7CiAgICBzdXBlclskcHVzaEdseXBoc10obWVhc3VyZSk7CiAgICBtZWFzdXJlLnBvcEZvbnQoKTsKICB9Cn0KY2xhc3MgTGkgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImxpIik7CiAgfQp9CmNsYXNzIE9sIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJvbCIpOwogIH0KfQpjbGFzcyBQIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJwIik7CiAgfQogIFskcHVzaEdseXBoc10obWVhc3VyZSkgewogICAgc3VwZXJbJHB1c2hHbHlwaHNdKG1lYXN1cmUsIGZhbHNlKTsKICAgIG1lYXN1cmUuYWRkU3RyaW5nKCJcbiIpOwogICAgbWVhc3VyZS5hZGRQYXJhKCk7CiAgICBtZWFzdXJlLnBvcEZvbnQoKTsKICB9CiAgWyR0ZXh0XSgpIHsKICAgIGNvbnN0IHNpYmxpbmdzID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRDaGlsZHJlbl0oKTsKICAgIGlmIChzaWJsaW5ncy5hdCgtMSkgPT09IHRoaXMpIHsKICAgICAgcmV0dXJuIHN1cGVyWyR0ZXh0XSgpOwogICAgfQogICAgcmV0dXJuIHN1cGVyWyR0ZXh0XSgpICsgIlxuIjsKICB9Cn0KY2xhc3MgU3BhbiBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAic3BhbiIpOwogIH0KfQpjbGFzcyBTdWIgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgInN1YiIpOwogIH0KfQpjbGFzcyBTdXAgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgInN1cCIpOwogIH0KfQpjbGFzcyBVbCBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAidWwiKTsKICB9Cn0KY2xhc3MgWGh0bWxOYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoWGh0bWxOYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIFhodG1sTmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGEoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBBKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgYihhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IEIoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBib2R5KGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgQm9keShhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGJyKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgQnIoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBodG1sKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgSHRtbChhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGkoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBJKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgbGkoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBMaShhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIG9sKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgT2woYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBwKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgUChhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIHNwYW4oYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTcGFuKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgc3ViKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgU3ViKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgc3VwKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgU3VwKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgdWwoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBVbChhdHRyaWJ1dGVzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9zZXR1cC5qcwoKCgoKCgoKCgpjb25zdCBOYW1lc3BhY2VTZXRVcCA9IHsKICBjb25maWc6IENvbmZpZ05hbWVzcGFjZSwKICBjb25uZWN0aW9uOiBDb25uZWN0aW9uU2V0TmFtZXNwYWNlLAogIGRhdGFzZXRzOiBEYXRhc2V0c05hbWVzcGFjZSwKICBsb2NhbGVTZXQ6IExvY2FsZVNldE5hbWVzcGFjZSwKICBzaWduYXR1cmU6IFNpZ25hdHVyZU5hbWVzcGFjZSwKICBzdHlsZXNoZWV0OiBTdHlsZXNoZWV0TmFtZXNwYWNlLAogIHRlbXBsYXRlOiBUZW1wbGF0ZU5hbWVzcGFjZSwKICB4ZHA6IFhkcE5hbWVzcGFjZSwKICB4aHRtbDogWGh0bWxOYW1lc3BhY2UKfTsKCjsvLyAuL3NyYy9jb3JlL3hmYS91bmtub3duLmpzCgoKY2xhc3MgVW5rbm93bk5hbWVzcGFjZSB7CiAgY29uc3RydWN0b3IobnNJZCkgewogICAgdGhpcy5uYW1lc3BhY2VJZCA9IG5zSWQ7CiAgfQogIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgWG1sT2JqZWN0KHRoaXMubmFtZXNwYWNlSWQsIG5hbWUsIGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2J1aWxkZXIuanMKCgoKCgoKCmNsYXNzIFJvb3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGlkcykgewogICAgc3VwZXIoLTEsICJyb290IiwgT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgICB0aGlzLmVsZW1lbnQgPSBudWxsOwogICAgdGhpc1skaWRzXSA9IGlkczsKICB9CiAgWyRvbkNoaWxkXShjaGlsZCkgewogICAgdGhpcy5lbGVtZW50ID0gY2hpbGQ7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBzdXBlclskZmluYWxpemVdKCk7CiAgICBpZiAodGhpcy5lbGVtZW50LnRlbXBsYXRlIGluc3RhbmNlb2YgVGVtcGxhdGUpIHsKICAgICAgdGhpc1skaWRzXS5zZXQoJHJvb3QsIHRoaXMuZWxlbWVudCk7CiAgICAgIHRoaXMuZWxlbWVudC50ZW1wbGF0ZVskcmVzb2x2ZVByb3RvdHlwZXNdKHRoaXNbJGlkc10pOwogICAgICB0aGlzLmVsZW1lbnQudGVtcGxhdGVbJGlkc10gPSB0aGlzWyRpZHNdOwogICAgfQogIH0KfQpjbGFzcyBFbXB0eSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigtMSwgIiIsIE9iamVjdC5jcmVhdGUobnVsbCkpOwogIH0KICBbJG9uQ2hpbGRdKF8pIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0KY2xhc3MgQnVpbGRlciB7CiAgY29uc3RydWN0b3Iocm9vdE5hbWVTcGFjZSA9IG51bGwpIHsKICAgIHRoaXMuX25hbWVzcGFjZVN0YWNrID0gW107CiAgICB0aGlzLl9uc0Fnbm9zdGljTGV2ZWwgPSAwOwogICAgdGhpcy5fbmFtZXNwYWNlUHJlZml4ZXMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9uYW1lc3BhY2VzID0gbmV3IE1hcCgpOwogICAgdGhpcy5fbmV4dE5zSWQgPSBNYXRoLm1heCguLi5PYmplY3QudmFsdWVzKE5hbWVzcGFjZUlkcykubWFwKCh7CiAgICAgIGlkCiAgICB9KSA9PiBpZCkpOwogICAgdGhpcy5fY3VycmVudE5hbWVzcGFjZSA9IHJvb3ROYW1lU3BhY2UgfHwgbmV3IFVua25vd25OYW1lc3BhY2UoKyt0aGlzLl9uZXh0TnNJZCk7CiAgfQogIGJ1aWxkUm9vdChpZHMpIHsKICAgIHJldHVybiBuZXcgUm9vdChpZHMpOwogIH0KICBidWlsZCh7CiAgICBuc1ByZWZpeCwKICAgIG5hbWUsCiAgICBhdHRyaWJ1dGVzLAogICAgbmFtZXNwYWNlLAogICAgcHJlZml4ZXMKICB9KSB7CiAgICBjb25zdCBoYXNOYW1lc3BhY2VEZWYgPSBuYW1lc3BhY2UgIT09IG51bGw7CiAgICBpZiAoaGFzTmFtZXNwYWNlRGVmKSB7CiAgICAgIHRoaXMuX25hbWVzcGFjZVN0YWNrLnB1c2godGhpcy5fY3VycmVudE5hbWVzcGFjZSk7CiAgICAgIHRoaXMuX2N1cnJlbnROYW1lc3BhY2UgPSB0aGlzLl9zZWFyY2hOYW1lc3BhY2UobmFtZXNwYWNlKTsKICAgIH0KICAgIGlmIChwcmVmaXhlcykgewogICAgICB0aGlzLl9hZGROYW1lc3BhY2VQcmVmaXgocHJlZml4ZXMpOwogICAgfQogICAgaWYgKGF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoJG5zQXR0cmlidXRlcykpIHsKICAgICAgY29uc3QgZGF0YVRlbXBsYXRlID0gTmFtZXNwYWNlU2V0VXAuZGF0YXNldHM7CiAgICAgIGNvbnN0IG5zQXR0cnMgPSBhdHRyaWJ1dGVzWyRuc0F0dHJpYnV0ZXNdOwogICAgICBsZXQgeGZhQXR0cnMgPSBudWxsOwogICAgICBmb3IgKGNvbnN0IFtucywgYXR0cnNdIG9mIE9iamVjdC5lbnRyaWVzKG5zQXR0cnMpKSB7CiAgICAgICAgY29uc3QgbnNUb1VzZSA9IHRoaXMuX2dldE5hbWVzcGFjZVRvVXNlKG5zKTsKICAgICAgICBpZiAobnNUb1VzZSA9PT0gZGF0YVRlbXBsYXRlKSB7CiAgICAgICAgICB4ZmFBdHRycyA9IHsKICAgICAgICAgICAgeGZhOiBhdHRycwogICAgICAgICAgfTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoeGZhQXR0cnMpIHsKICAgICAgICBhdHRyaWJ1dGVzWyRuc0F0dHJpYnV0ZXNdID0geGZhQXR0cnM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbJG5zQXR0cmlidXRlc107CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG5hbWVzcGFjZVRvVXNlID0gdGhpcy5fZ2V0TmFtZXNwYWNlVG9Vc2UobnNQcmVmaXgpOwogICAgY29uc3Qgbm9kZSA9IG5hbWVzcGFjZVRvVXNlPy5bJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB8fCBuZXcgRW1wdHkoKTsKICAgIGlmIChub2RlWyRpc05zQWdub3N0aWNdKCkpIHsKICAgICAgdGhpcy5fbnNBZ25vc3RpY0xldmVsKys7CiAgICB9CiAgICBpZiAoaGFzTmFtZXNwYWNlRGVmIHx8IHByZWZpeGVzIHx8IG5vZGVbJGlzTnNBZ25vc3RpY10oKSkgewogICAgICBub2RlWyRjbGVhbnVwXSA9IHsKICAgICAgICBoYXNOYW1lc3BhY2U6IGhhc05hbWVzcGFjZURlZiwKICAgICAgICBwcmVmaXhlcywKICAgICAgICBuc0Fnbm9zdGljOiBub2RlWyRpc05zQWdub3N0aWNdKCkKICAgICAgfTsKICAgIH0KICAgIHJldHVybiBub2RlOwogIH0KICBpc05zQWdub3N0aWMoKSB7CiAgICByZXR1cm4gdGhpcy5fbnNBZ25vc3RpY0xldmVsID4gMDsKICB9CiAgX3NlYXJjaE5hbWVzcGFjZShuc05hbWUpIHsKICAgIGxldCBucyA9IHRoaXMuX25hbWVzcGFjZXMuZ2V0KG5zTmFtZSk7CiAgICBpZiAobnMpIHsKICAgICAgcmV0dXJuIG5zOwogICAgfQogICAgZm9yIChjb25zdCBbbmFtZSwgewogICAgICBjaGVjawogICAgfV0gb2YgT2JqZWN0LmVudHJpZXMoTmFtZXNwYWNlSWRzKSkgewogICAgICBpZiAoY2hlY2sobnNOYW1lKSkgewogICAgICAgIG5zID0gTmFtZXNwYWNlU2V0VXBbbmFtZV07CiAgICAgICAgaWYgKG5zKSB7CiAgICAgICAgICB0aGlzLl9uYW1lc3BhY2VzLnNldChuc05hbWUsIG5zKTsKICAgICAgICAgIHJldHVybiBuczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIG5zID0gbmV3IFVua25vd25OYW1lc3BhY2UoKyt0aGlzLl9uZXh0TnNJZCk7CiAgICB0aGlzLl9uYW1lc3BhY2VzLnNldChuc05hbWUsIG5zKTsKICAgIHJldHVybiBuczsKICB9CiAgX2FkZE5hbWVzcGFjZVByZWZpeChwcmVmaXhlcykgewogICAgZm9yIChjb25zdCB7CiAgICAgIHByZWZpeCwKICAgICAgdmFsdWUKICAgIH0gb2YgcHJlZml4ZXMpIHsKICAgICAgY29uc3QgbmFtZXNwYWNlID0gdGhpcy5fc2VhcmNoTmFtZXNwYWNlKHZhbHVlKTsKICAgICAgbGV0IHByZWZpeFN0YWNrID0gdGhpcy5fbmFtZXNwYWNlUHJlZml4ZXMuZ2V0KHByZWZpeCk7CiAgICAgIGlmICghcHJlZml4U3RhY2spIHsKICAgICAgICBwcmVmaXhTdGFjayA9IFtdOwogICAgICAgIHRoaXMuX25hbWVzcGFjZVByZWZpeGVzLnNldChwcmVmaXgsIHByZWZpeFN0YWNrKTsKICAgICAgfQogICAgICBwcmVmaXhTdGFjay5wdXNoKG5hbWVzcGFjZSk7CiAgICB9CiAgfQogIF9nZXROYW1lc3BhY2VUb1VzZShwcmVmaXgpIHsKICAgIGlmICghcHJlZml4KSB7CiAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50TmFtZXNwYWNlOwogICAgfQogICAgY29uc3QgcHJlZml4U3RhY2sgPSB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcy5nZXQocHJlZml4KTsKICAgIGlmIChwcmVmaXhTdGFjaz8ubGVuZ3RoID4gMCkgewogICAgICByZXR1cm4gcHJlZml4U3RhY2suYXQoLTEpOwogICAgfQogICAgd2FybihgVW5rbm93biBuYW1lc3BhY2UgcHJlZml4OiAke3ByZWZpeH0uYCk7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY2xlYW4oZGF0YSkgewogICAgY29uc3QgewogICAgICBoYXNOYW1lc3BhY2UsCiAgICAgIHByZWZpeGVzLAogICAgICBuc0Fnbm9zdGljCiAgICB9ID0gZGF0YTsKICAgIGlmIChoYXNOYW1lc3BhY2UpIHsKICAgICAgdGhpcy5fY3VycmVudE5hbWVzcGFjZSA9IHRoaXMuX25hbWVzcGFjZVN0YWNrLnBvcCgpOwogICAgfQogICAgaWYgKHByZWZpeGVzKSB7CiAgICAgIHByZWZpeGVzLmZvckVhY2goKHsKICAgICAgICBwcmVmaXgKICAgICAgfSkgPT4gewogICAgICAgIHRoaXMuX25hbWVzcGFjZVByZWZpeGVzLmdldChwcmVmaXgpLnBvcCgpOwogICAgICB9KTsKICAgIH0KICAgIGlmIChuc0Fnbm9zdGljKSB7CiAgICAgIHRoaXMuX25zQWdub3N0aWNMZXZlbC0tOwogICAgfQogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3BhcnNlci5qcwoKCgoKY2xhc3MgWEZBUGFyc2VyIGV4dGVuZHMgWE1MUGFyc2VyQmFzZSB7CiAgY29uc3RydWN0b3Iocm9vdE5hbWVTcGFjZSA9IG51bGwsIHJpY2hUZXh0ID0gZmFsc2UpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLl9idWlsZGVyID0gbmV3IEJ1aWxkZXIocm9vdE5hbWVTcGFjZSk7CiAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgdGhpcy5fZ2xvYmFsRGF0YSA9IHsKICAgICAgdXNlZFR5cGVmYWNlczogbmV3IFNldCgpCiAgICB9OwogICAgdGhpcy5faWRzID0gbmV3IE1hcCgpOwogICAgdGhpcy5fY3VycmVudCA9IHRoaXMuX2J1aWxkZXIuYnVpbGRSb290KHRoaXMuX2lkcyk7CiAgICB0aGlzLl9lcnJvckNvZGUgPSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcjsKICAgIHRoaXMuX3doaXRlUmVnZXggPSAvXlxzKyQvOwogICAgdGhpcy5fbmJzcHMgPSAvXHhhMCsvZzsKICAgIHRoaXMuX3JpY2hUZXh0ID0gcmljaFRleHQ7CiAgfQogIHBhcnNlKGRhdGEpIHsKICAgIHRoaXMucGFyc2VYbWwoZGF0YSk7CiAgICBpZiAodGhpcy5fZXJyb3JDb2RlICE9PSBYTUxQYXJzZXJFcnJvckNvZGUuTm9FcnJvcikgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgdGhpcy5fY3VycmVudFskZmluYWxpemVdKCk7CiAgICByZXR1cm4gdGhpcy5fY3VycmVudC5lbGVtZW50OwogIH0KICBvblRleHQodGV4dCkgewogICAgdGV4dCA9IHRleHQucmVwbGFjZSh0aGlzLl9uYnNwcywgbWF0Y2ggPT4gbWF0Y2guc2xpY2UoMSkgKyAiICIpOwogICAgaWYgKHRoaXMuX3JpY2hUZXh0IHx8IHRoaXMuX2N1cnJlbnRbJGFjY2VwdFdoaXRlc3BhY2VdKCkpIHsKICAgICAgdGhpcy5fY3VycmVudFskb25UZXh0XSh0ZXh0LCB0aGlzLl9yaWNoVGV4dCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl93aGl0ZVJlZ2V4LnRlc3QodGV4dCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fY3VycmVudFskb25UZXh0XSh0ZXh0LnRyaW0oKSk7CiAgfQogIG9uQ2RhdGEodGV4dCkgewogICAgdGhpcy5fY3VycmVudFskb25UZXh0XSh0ZXh0KTsKICB9CiAgX21rQXR0cmlidXRlcyhhdHRyaWJ1dGVzLCB0YWdOYW1lKSB7CiAgICBsZXQgbmFtZXNwYWNlID0gbnVsbDsKICAgIGxldCBwcmVmaXhlcyA9IG51bGw7CiAgICBjb25zdCBhdHRyaWJ1dGVPYmogPSBPYmplY3QuY3JlYXRlKHt9KTsKICAgIGZvciAoY29uc3QgewogICAgICBuYW1lLAogICAgICB2YWx1ZQogICAgfSBvZiBhdHRyaWJ1dGVzKSB7CiAgICAgIGlmIChuYW1lID09PSAieG1sbnMiKSB7CiAgICAgICAgaWYgKCFuYW1lc3BhY2UpIHsKICAgICAgICAgIG5hbWVzcGFjZSA9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3YXJuKGBYRkEgLSBtdWx0aXBsZSBuYW1lc3BhY2UgZGVmaW5pdGlvbiBpbiA8JHt0YWdOYW1lfT5gKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobmFtZS5zdGFydHNXaXRoKCJ4bWxuczoiKSkgewogICAgICAgIGNvbnN0IHByZWZpeCA9IG5hbWUuc3Vic3RyaW5nKCJ4bWxuczoiLmxlbmd0aCk7CiAgICAgICAgcHJlZml4ZXMgPz89IFtdOwogICAgICAgIHByZWZpeGVzLnB1c2goewogICAgICAgICAgcHJlZml4LAogICAgICAgICAgdmFsdWUKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBpID0gbmFtZS5pbmRleE9mKCI6Iik7CiAgICAgICAgaWYgKGkgPT09IC0xKSB7CiAgICAgICAgICBhdHRyaWJ1dGVPYmpbbmFtZV0gPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgbnNBdHRycyA9IGF0dHJpYnV0ZU9ialskbnNBdHRyaWJ1dGVzXSA/Pz0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGNvbnN0IFtucywgYXR0ck5hbWVdID0gW25hbWUuc2xpY2UoMCwgaSksIG5hbWUuc2xpY2UoaSArIDEpXTsKICAgICAgICAgIGNvbnN0IGF0dHJzID0gbnNBdHRyc1tuc10gfHw9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICBhdHRyc1thdHRyTmFtZV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBbbmFtZXNwYWNlLCBwcmVmaXhlcywgYXR0cmlidXRlT2JqXTsKICB9CiAgX2dldE5hbWVBbmRQcmVmaXgobmFtZSwgbnNBZ25vc3RpYykgewogICAgY29uc3QgaSA9IG5hbWUuaW5kZXhPZigiOiIpOwogICAgaWYgKGkgPT09IC0xKSB7CiAgICAgIHJldHVybiBbbmFtZSwgbnVsbF07CiAgICB9CiAgICByZXR1cm4gW25hbWUuc3Vic3RyaW5nKGkgKyAxKSwgbnNBZ25vc3RpYyA/ICIiIDogbmFtZS5zdWJzdHJpbmcoMCwgaSldOwogIH0KICBvbkJlZ2luRWxlbWVudCh0YWdOYW1lLCBhdHRyaWJ1dGVzLCBpc0VtcHR5KSB7CiAgICBjb25zdCBbbmFtZXNwYWNlLCBwcmVmaXhlcywgYXR0cmlidXRlc09ial0gPSB0aGlzLl9ta0F0dHJpYnV0ZXMoYXR0cmlidXRlcywgdGFnTmFtZSk7CiAgICBjb25zdCBbbmFtZSwgbnNQcmVmaXhdID0gdGhpcy5fZ2V0TmFtZUFuZFByZWZpeCh0YWdOYW1lLCB0aGlzLl9idWlsZGVyLmlzTnNBZ25vc3RpYygpKTsKICAgIGNvbnN0IG5vZGUgPSB0aGlzLl9idWlsZGVyLmJ1aWxkKHsKICAgICAgbnNQcmVmaXgsCiAgICAgIG5hbWUsCiAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXNPYmosCiAgICAgIG5hbWVzcGFjZSwKICAgICAgcHJlZml4ZXMKICAgIH0pOwogICAgbm9kZVskZ2xvYmFsRGF0YV0gPSB0aGlzLl9nbG9iYWxEYXRhOwogICAgaWYgKGlzRW1wdHkpIHsKICAgICAgbm9kZVskZmluYWxpemVdKCk7CiAgICAgIGlmICh0aGlzLl9jdXJyZW50WyRvbkNoaWxkXShub2RlKSkgewogICAgICAgIG5vZGVbJHNldElkXSh0aGlzLl9pZHMpOwogICAgICB9CiAgICAgIG5vZGVbJGNsZWFuXSh0aGlzLl9idWlsZGVyKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fc3RhY2sucHVzaCh0aGlzLl9jdXJyZW50KTsKICAgIHRoaXMuX2N1cnJlbnQgPSBub2RlOwogIH0KICBvbkVuZEVsZW1lbnQobmFtZSkgewogICAgY29uc3Qgbm9kZSA9IHRoaXMuX2N1cnJlbnQ7CiAgICBpZiAobm9kZVskaXNDREFUQVhtbF0oKSAmJiB0eXBlb2Ygbm9kZVskY29udGVudF0gPT09ICJzdHJpbmciKSB7CiAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBYRkFQYXJzZXIoKTsKICAgICAgcGFyc2VyLl9nbG9iYWxEYXRhID0gdGhpcy5fZ2xvYmFsRGF0YTsKICAgICAgY29uc3Qgcm9vdCA9IHBhcnNlci5wYXJzZShub2RlWyRjb250ZW50XSk7CiAgICAgIG5vZGVbJGNvbnRlbnRdID0gbnVsbDsKICAgICAgbm9kZVskb25DaGlsZF0ocm9vdCk7CiAgICB9CiAgICBub2RlWyRmaW5hbGl6ZV0oKTsKICAgIHRoaXMuX2N1cnJlbnQgPSB0aGlzLl9zdGFjay5wb3AoKTsKICAgIGlmICh0aGlzLl9jdXJyZW50WyRvbkNoaWxkXShub2RlKSkgewogICAgICBub2RlWyRzZXRJZF0odGhpcy5faWRzKTsKICAgIH0KICAgIG5vZGVbJGNsZWFuXSh0aGlzLl9idWlsZGVyKTsKICB9CiAgb25FcnJvcihjb2RlKSB7CiAgICB0aGlzLl9lcnJvckNvZGUgPSBjb2RlOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2ZhY3RvcnkuanMKCgoKCgoKCgpjbGFzcyBYRkFGYWN0b3J5IHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICB0cnkgewogICAgICB0aGlzLnJvb3QgPSBuZXcgWEZBUGFyc2VyKCkucGFyc2UoWEZBRmFjdG9yeS5fY3JlYXRlRG9jdW1lbnQoZGF0YSkpOwogICAgICBjb25zdCBiaW5kZXIgPSBuZXcgQmluZGVyKHRoaXMucm9vdCk7CiAgICAgIHRoaXMuZm9ybSA9IGJpbmRlci5iaW5kKCk7CiAgICAgIHRoaXMuZGF0YUhhbmRsZXIgPSBuZXcgRGF0YUhhbmRsZXIodGhpcy5yb290LCBiaW5kZXIuZ2V0RGF0YSgpKTsKICAgICAgdGhpcy5mb3JtWyRnbG9iYWxEYXRhXS50ZW1wbGF0ZSA9IHRoaXMuZm9ybTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihgWEZBIC0gYW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIHBhcnNpbmcgYW5kIGJpbmRpbmc6ICR7ZX1gKTsKICAgIH0KICB9CiAgaXNWYWxpZCgpIHsKICAgIHJldHVybiAhISh0aGlzLnJvb3QgJiYgdGhpcy5mb3JtKTsKICB9CiAgX2NyZWF0ZVBhZ2VzSGVscGVyKCkgewogICAgY29uc3QgaXRlcmF0b3IgPSB0aGlzLmZvcm1bJHRvUGFnZXNdKCk7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCBuZXh0SXRlcmF0aW9uID0gKCkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZXJhdG9yLm5leHQoKTsKICAgICAgICAgIGlmICh2YWx1ZS5kb25lKSB7CiAgICAgICAgICAgIHJlc29sdmUodmFsdWUudmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2V0VGltZW91dChuZXh0SXRlcmF0aW9uLCAwKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzZXRUaW1lb3V0KG5leHRJdGVyYXRpb24sIDApOwogICAgfSk7CiAgfQogIGFzeW5jIF9jcmVhdGVQYWdlcygpIHsKICAgIHRyeSB7CiAgICAgIHRoaXMucGFnZXMgPSBhd2FpdCB0aGlzLl9jcmVhdGVQYWdlc0hlbHBlcigpOwogICAgICB0aGlzLmRpbXMgPSB0aGlzLnBhZ2VzLmNoaWxkcmVuLm1hcChjID0+IHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICB3aWR0aCwKICAgICAgICAgIGhlaWdodAogICAgICAgIH0gPSBjLmF0dHJpYnV0ZXMuc3R5bGU7CiAgICAgICAgcmV0dXJuIFswLCAwLCBwYXJzZUludCh3aWR0aCksIHBhcnNlSW50KGhlaWdodCldOwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihgWEZBIC0gYW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIGxheW91dDogJHtlfWApOwogICAgfQogIH0KICBnZXRCb3VuZGluZ0JveChwYWdlSW5kZXgpIHsKICAgIHJldHVybiB0aGlzLmRpbXNbcGFnZUluZGV4XTsKICB9CiAgYXN5bmMgZ2V0TnVtUGFnZXMoKSB7CiAgICBpZiAoIXRoaXMucGFnZXMpIHsKICAgICAgYXdhaXQgdGhpcy5fY3JlYXRlUGFnZXMoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmRpbXMubGVuZ3RoOwogIH0KICBzZXRJbWFnZXMoaW1hZ2VzKSB7CiAgICB0aGlzLmZvcm1bJGdsb2JhbERhdGFdLmltYWdlcyA9IGltYWdlczsKICB9CiAgc2V0Rm9udHMoZm9udHMpIHsKICAgIHRoaXMuZm9ybVskZ2xvYmFsRGF0YV0uZm9udEZpbmRlciA9IG5ldyBGb250RmluZGVyKGZvbnRzKTsKICAgIGNvbnN0IG1pc3NpbmdGb250cyA9IFtdOwogICAgZm9yIChsZXQgdHlwZWZhY2Ugb2YgdGhpcy5mb3JtWyRnbG9iYWxEYXRhXS51c2VkVHlwZWZhY2VzKSB7CiAgICAgIHR5cGVmYWNlID0gc3RyaXBRdW90ZXModHlwZWZhY2UpOwogICAgICBjb25zdCBmb250ID0gdGhpcy5mb3JtWyRnbG9iYWxEYXRhXS5mb250RmluZGVyLmZpbmQodHlwZWZhY2UpOwogICAgICBpZiAoIWZvbnQpIHsKICAgICAgICBtaXNzaW5nRm9udHMucHVzaCh0eXBlZmFjZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChtaXNzaW5nRm9udHMubGVuZ3RoID4gMCkgewogICAgICByZXR1cm4gbWlzc2luZ0ZvbnRzOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGFwcGVuZEZvbnRzKGZvbnRzLCByZWFsbHlNaXNzaW5nRm9udHMpIHsKICAgIHRoaXMuZm9ybVskZ2xvYmFsRGF0YV0uZm9udEZpbmRlci5hZGQoZm9udHMsIHJlYWxseU1pc3NpbmdGb250cyk7CiAgfQogIGFzeW5jIGdldFBhZ2VzKCkgewogICAgaWYgKCF0aGlzLnBhZ2VzKSB7CiAgICAgIGF3YWl0IHRoaXMuX2NyZWF0ZVBhZ2VzKCk7CiAgICB9CiAgICBjb25zdCBwYWdlcyA9IHRoaXMucGFnZXM7CiAgICB0aGlzLnBhZ2VzID0gbnVsbDsKICAgIHJldHVybiBwYWdlczsKICB9CiAgc2VyaWFsaXplRGF0YShzdG9yYWdlKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhSGFuZGxlci5zZXJpYWxpemUoc3RvcmFnZSk7CiAgfQogIHN0YXRpYyBfY3JlYXRlRG9jdW1lbnQoZGF0YSkgewogICAgaWYgKCFkYXRhWyIveGRwOnhkcCJdKSB7CiAgICAgIHJldHVybiBkYXRhWyJ4ZHA6eGRwIl07CiAgICB9CiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhkYXRhKS5qb2luKCIiKTsKICB9CiAgc3RhdGljIGdldFJpY2hUZXh0QXNIdG1sKHJjKSB7CiAgICBpZiAoIXJjIHx8IHR5cGVvZiByYyAhPT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0cnkgewogICAgICBsZXQgcm9vdCA9IG5ldyBYRkFQYXJzZXIoWGh0bWxOYW1lc3BhY2UsIHRydWUpLnBhcnNlKHJjKTsKICAgICAgaWYgKCFbImJvZHkiLCAieGh0bWwiXS5pbmNsdWRlcyhyb290WyRub2RlTmFtZV0pKSB7CiAgICAgICAgY29uc3QgbmV3Um9vdCA9IFhodG1sTmFtZXNwYWNlLmJvZHkoe30pOwogICAgICAgIG5ld1Jvb3RbJGFwcGVuZENoaWxkXShyb290KTsKICAgICAgICByb290ID0gbmV3Um9vdDsKICAgICAgfQogICAgICBjb25zdCByZXN1bHQgPSByb290WyR0b0hUTUxdKCk7CiAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgaHRtbAogICAgICB9ID0gcmVzdWx0OwogICAgICBjb25zdCB7CiAgICAgICAgYXR0cmlidXRlcwogICAgICB9ID0gaHRtbDsKICAgICAgaWYgKGF0dHJpYnV0ZXMpIHsKICAgICAgICBpZiAoYXR0cmlidXRlcy5jbGFzcykgewogICAgICAgICAgYXR0cmlidXRlcy5jbGFzcyA9IGF0dHJpYnV0ZXMuY2xhc3MuZmlsdGVyKGF0dHIgPT4gIWF0dHIuc3RhcnRzV2l0aCgieGZhIikpOwogICAgICAgIH0KICAgICAgICBhdHRyaWJ1dGVzLmRpciA9ICJhdXRvIjsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGh0bWwsCiAgICAgICAgc3RyOiByb290WyR0ZXh0XSgpCiAgICAgIH07CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHdhcm4oYFhGQSAtIGFuIGVycm9yIG9jY3VycmVkIGR1cmluZyBwYXJzaW5nIG9mIHJpY2ggdGV4dDogJHtlfWApOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9hbm5vdGF0aW9uLmpzCgoKCgoKCgoKCgoKCgoKCmNsYXNzIEFubm90YXRpb25GYWN0b3J5IHsKICBzdGF0aWMgY3JlYXRlR2xvYmFscyhwZGZNYW5hZ2VyKSB7CiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3BkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYWNyb0Zvcm0iKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoInhmYURhdGFzZXRzIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygic3RydWN0VHJlZVJvb3QiKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJiYXNlVXJsIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYXR0YWNobWVudHMiKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJnbG9iYWxDb2xvclNwYWNlQ2FjaGUiKV0pLnRoZW4oKFthY3JvRm9ybSwgeGZhRGF0YXNldHMsIHN0cnVjdFRyZWVSb290LCBiYXNlVXJsLCBhdHRhY2htZW50cywgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlXSkgPT4gKHsKICAgICAgcGRmTWFuYWdlciwKICAgICAgYWNyb0Zvcm06IGFjcm9Gb3JtIGluc3RhbmNlb2YgRGljdCA/IGFjcm9Gb3JtIDogRGljdC5lbXB0eSwKICAgICAgeGZhRGF0YXNldHMsCiAgICAgIHN0cnVjdFRyZWVSb290LAogICAgICBiYXNlVXJsLAogICAgICBhdHRhY2htZW50cywKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlCiAgICB9KSwgcmVhc29uID0+IHsKICAgICAgd2FybihgY3JlYXRlR2xvYmFsczogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfSk7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGUoeHJlZiwgcmVmLCBhbm5vdGF0aW9uR2xvYmFscywgaWRGYWN0b3J5LCBjb2xsZWN0RmllbGRzLCBvcnBoYW5GaWVsZHMsIGNvbGxlY3RCeVR5cGUsIHBhZ2VSZWYpIHsKICAgIGNvbnN0IHBhZ2VJbmRleCA9IGNvbGxlY3RGaWVsZHMgPyBhd2FpdCB0aGlzLl9nZXRQYWdlSW5kZXgoeHJlZiwgcmVmLCBhbm5vdGF0aW9uR2xvYmFscy5wZGZNYW5hZ2VyKSA6IG51bGw7CiAgICByZXR1cm4gYW5ub3RhdGlvbkdsb2JhbHMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgIl9jcmVhdGUiLCBbeHJlZiwgcmVmLCBhbm5vdGF0aW9uR2xvYmFscywgaWRGYWN0b3J5LCBjb2xsZWN0RmllbGRzLCBvcnBoYW5GaWVsZHMsIGNvbGxlY3RCeVR5cGUsIHBhZ2VJbmRleCwgcGFnZVJlZl0pOwogIH0KICBzdGF0aWMgX2NyZWF0ZSh4cmVmLCByZWYsIGFubm90YXRpb25HbG9iYWxzLCBpZEZhY3RvcnksIGNvbGxlY3RGaWVsZHMgPSBmYWxzZSwgb3JwaGFuRmllbGRzID0gbnVsbCwgY29sbGVjdEJ5VHlwZSA9IG51bGwsIHBhZ2VJbmRleCA9IG51bGwsIHBhZ2VSZWYgPSBudWxsKSB7CiAgICBjb25zdCBkaWN0ID0geHJlZi5mZXRjaElmUmVmKHJlZik7CiAgICBpZiAoIShkaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGxldCBzdWJ0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgIHN1YnR5cGUgPSBzdWJ0eXBlIGluc3RhbmNlb2YgTmFtZSA/IHN1YnR5cGUubmFtZSA6IG51bGw7CiAgICBpZiAoY29sbGVjdEJ5VHlwZSAmJiAhY29sbGVjdEJ5VHlwZS5oYXMoQW5ub3RhdGlvblR5cGVbc3VidHlwZS50b1VwcGVyQ2FzZSgpXSkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGFjcm9Gb3JtLAogICAgICBwZGZNYW5hZ2VyCiAgICB9ID0gYW5ub3RhdGlvbkdsb2JhbHM7CiAgICBjb25zdCBpZCA9IHJlZiBpbnN0YW5jZW9mIFJlZiA/IHJlZi50b1N0cmluZygpIDogYGFubm90XyR7aWRGYWN0b3J5LmNyZWF0ZU9iaklkKCl9YDsKICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB7CiAgICAgIHhyZWYsCiAgICAgIHJlZiwKICAgICAgZGljdCwKICAgICAgc3VidHlwZSwKICAgICAgaWQsCiAgICAgIGFubm90YXRpb25HbG9iYWxzLAogICAgICBjb2xsZWN0RmllbGRzLAogICAgICBvcnBoYW5GaWVsZHMsCiAgICAgIG5lZWRBcHBlYXJhbmNlczogIWNvbGxlY3RGaWVsZHMgJiYgYWNyb0Zvcm0uZ2V0KCJOZWVkQXBwZWFyYW5jZXMiKSA9PT0gdHJ1ZSwKICAgICAgcGFnZUluZGV4LAogICAgICBldmFsdWF0b3JPcHRpb25zOiBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnMsCiAgICAgIHBhZ2VSZWYKICAgIH07CiAgICBzd2l0Y2ggKHN1YnR5cGUpIHsKICAgICAgY2FzZSAiTGluayI6CiAgICAgICAgcmV0dXJuIG5ldyBMaW5rQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiVGV4dCI6CiAgICAgICAgcmV0dXJuIG5ldyBUZXh0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiV2lkZ2V0IjoKICAgICAgICBsZXQgZmllbGRUeXBlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgICAgICBkaWN0LAogICAgICAgICAga2V5OiAiRlQiCiAgICAgICAgfSk7CiAgICAgICAgZmllbGRUeXBlID0gZmllbGRUeXBlIGluc3RhbmNlb2YgTmFtZSA/IGZpZWxkVHlwZS5uYW1lIDogbnVsbDsKICAgICAgICBzd2l0Y2ggKGZpZWxkVHlwZSkgewogICAgICAgICAgY2FzZSAiVHgiOgogICAgICAgICAgICByZXR1cm4gbmV3IFRleHRXaWRnZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICAgICAgY2FzZSAiQnRuIjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBCdXR0b25XaWRnZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICAgICAgY2FzZSAiQ2giOgogICAgICAgICAgICByZXR1cm4gbmV3IENob2ljZVdpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgICAgICBjYXNlICJTaWciOgogICAgICAgICAgICByZXR1cm4gbmV3IFNpZ25hdHVyZVdpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgICAgfQogICAgICAgIHdhcm4oYFVuaW1wbGVtZW50ZWQgd2lkZ2V0IGZpZWxkIHR5cGUgIiR7ZmllbGRUeXBlfSIsIGAgKyAiZmFsbGluZyBiYWNrIHRvIGJhc2UgZmllbGQgdHlwZS4iKTsKICAgICAgICByZXR1cm4gbmV3IFdpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlBvcHVwIjoKICAgICAgICByZXR1cm4gbmV3IFBvcHVwQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiRnJlZVRleHQiOgogICAgICAgIHJldHVybiBuZXcgRnJlZVRleHRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJMaW5lIjoKICAgICAgICByZXR1cm4gbmV3IExpbmVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJTcXVhcmUiOgogICAgICAgIHJldHVybiBuZXcgU3F1YXJlQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiQ2lyY2xlIjoKICAgICAgICByZXR1cm4gbmV3IENpcmNsZUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlBvbHlMaW5lIjoKICAgICAgICByZXR1cm4gbmV3IFBvbHlsaW5lQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiUG9seWdvbiI6CiAgICAgICAgcmV0dXJuIG5ldyBQb2x5Z29uQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiQ2FyZXQiOgogICAgICAgIHJldHVybiBuZXcgQ2FyZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJJbmsiOgogICAgICAgIHJldHVybiBuZXcgSW5rQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiSGlnaGxpZ2h0IjoKICAgICAgICByZXR1cm4gbmV3IEhpZ2hsaWdodEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlVuZGVybGluZSI6CiAgICAgICAgcmV0dXJuIG5ldyBVbmRlcmxpbmVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJTcXVpZ2dseSI6CiAgICAgICAgcmV0dXJuIG5ldyBTcXVpZ2dseUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlN0cmlrZU91dCI6CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpa2VPdXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJTdGFtcCI6CiAgICAgICAgcmV0dXJuIG5ldyBTdGFtcEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkZpbGVBdHRhY2htZW50IjoKICAgICAgICByZXR1cm4gbmV3IEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgZGVmYXVsdDoKICAgICAgICBpZiAoIWNvbGxlY3RGaWVsZHMpIHsKICAgICAgICAgIGlmICghc3VidHlwZSkgewogICAgICAgICAgICB3YXJuKCJBbm5vdGF0aW9uIGlzIG1pc3NpbmcgdGhlIHJlcXVpcmVkIC9TdWJ0eXBlLiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2FybihgVW5pbXBsZW1lbnRlZCBhbm5vdGF0aW9uIHR5cGUgIiR7c3VidHlwZX0iLCBgICsgImZhbGxpbmcgYmFjayB0byBiYXNlIGFubm90YXRpb24uIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgIH0KICB9CiAgc3RhdGljIGFzeW5jIF9nZXRQYWdlSW5kZXgoeHJlZiwgcmVmLCBwZGZNYW5hZ2VyKSB7CiAgICB0cnkgewogICAgICBjb25zdCBhbm5vdERpY3QgPSBhd2FpdCB4cmVmLmZldGNoSWZSZWZBc3luYyhyZWYpOwogICAgICBpZiAoIShhbm5vdERpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICBjb25zdCBwYWdlUmVmID0gYW5ub3REaWN0LmdldFJhdygiUCIpOwogICAgICBpZiAocGFnZVJlZiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBwYWdlSW5kZXggPSBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImdldFBhZ2VJbmRleCIsIFtwYWdlUmVmXSk7CiAgICAgICAgICByZXR1cm4gcGFnZUluZGV4OwogICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICBpbmZvKGBfZ2V0UGFnZUluZGV4IC0tIG5vdCBhIHZhbGlkIHBhZ2UgcmVmZXJlbmNlOiAiJHtleH0iLmApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoYW5ub3REaWN0LmhhcygiS2lkcyIpKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIGNvbnN0IG51bVBhZ2VzID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoIm51bVBhZ2VzIik7CiAgICAgIGZvciAobGV0IHBhZ2VJbmRleCA9IDA7IHBhZ2VJbmRleCA8IG51bVBhZ2VzOyBwYWdlSW5kZXgrKykgewogICAgICAgIGNvbnN0IHBhZ2UgPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgICBjb25zdCBhbm5vdGF0aW9ucyA9IGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJhbm5vdGF0aW9ucyIpOwogICAgICAgIGZvciAoY29uc3QgYW5ub3RSZWYgb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgICAgIGlmIChhbm5vdFJlZiBpbnN0YW5jZW9mIFJlZiAmJiBpc1JlZnNFcXVhbChhbm5vdFJlZiwgcmVmKSkgewogICAgICAgICAgICByZXR1cm4gcGFnZUluZGV4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgd2FybihgX2dldFBhZ2VJbmRleDogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgc3RhdGljIGdlbmVyYXRlSW1hZ2VzKGFubm90YXRpb25zLCB4cmVmLCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgaWYgKCFpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICB3YXJuKCJnZW5lcmF0ZUltYWdlczogT2Zmc2NyZWVuQ2FudmFzIGlzIG5vdCBzdXBwb3J0ZWQsIGNhbm5vdCBzYXZlIG9yIHByaW50IHNvbWUgYW5ub3RhdGlvbnMgd2l0aCBpbWFnZXMuIik7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IGltYWdlUHJvbWlzZXM7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgYml0bWFwSWQsCiAgICAgIGJpdG1hcAogICAgfSBvZiBhbm5vdGF0aW9ucykgewogICAgICBpZiAoIWJpdG1hcCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGltYWdlUHJvbWlzZXMgfHw9IG5ldyBNYXAoKTsKICAgICAgaW1hZ2VQcm9taXNlcy5zZXQoYml0bWFwSWQsIFN0YW1wQW5ub3RhdGlvbi5jcmVhdGVJbWFnZShiaXRtYXAsIHhyZWYpKTsKICAgIH0KICAgIHJldHVybiBpbWFnZVByb21pc2VzOwogIH0KICBzdGF0aWMgYXN5bmMgc2F2ZU5ld0Fubm90YXRpb25zKGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvbnMsIGltYWdlUHJvbWlzZXMsIGNoYW5nZXMpIHsKICAgIGNvbnN0IHhyZWYgPSBldmFsdWF0b3IueHJlZjsKICAgIGxldCBiYXNlRm9udFJlZjsKICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICBjb25zdCB7CiAgICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkCiAgICB9ID0gZXZhbHVhdG9yLm9wdGlvbnM7CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGFubm90YXRpb24uZGVsZXRlZCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHN3aXRjaCAoYW5ub3RhdGlvbi5hbm5vdGF0aW9uVHlwZSkgewogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuRlJFRVRFWFQ6CiAgICAgICAgICBpZiAoIWJhc2VGb250UmVmKSB7CiAgICAgICAgICAgIGNvbnN0IGJhc2VGb250ID0gbmV3IERpY3QoeHJlZik7CiAgICAgICAgICAgIGJhc2VGb250LnNldElmTmFtZSgiQmFzZUZvbnQiLCAiSGVsdmV0aWNhIik7CiAgICAgICAgICAgIGJhc2VGb250LnNldElmTmFtZSgiVHlwZSIsICJGb250Iik7CiAgICAgICAgICAgIGJhc2VGb250LnNldElmTmFtZSgiU3VidHlwZSIsICJUeXBlMSIpOwogICAgICAgICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIkVuY29kaW5nIiwgIldpbkFuc2lFbmNvZGluZyIpOwogICAgICAgICAgICBiYXNlRm9udFJlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgICAgICAgIGNoYW5nZXMucHV0KGJhc2VGb250UmVmLCB7CiAgICAgICAgICAgICAgZGF0YTogYmFzZUZvbnQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBwcm9taXNlcy5wdXNoKEZyZWVUZXh0QW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGNoYW5nZXMsIHsKICAgICAgICAgICAgZXZhbHVhdG9yLAogICAgICAgICAgICB0YXNrLAogICAgICAgICAgICBiYXNlRm9udFJlZgogICAgICAgICAgfSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQ6CiAgICAgICAgICBpZiAoYW5ub3RhdGlvbi5xdWFkUG9pbnRzKSB7CiAgICAgICAgICAgIHByb21pc2VzLnB1c2goSGlnaGxpZ2h0QW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGNoYW5nZXMpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByb21pc2VzLnB1c2goSW5rQW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGNoYW5nZXMpKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuSU5LOgogICAgICAgICAgcHJvbWlzZXMucHVzaChJbmtBbm5vdGF0aW9uLmNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgY2hhbmdlcykpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5TVEFNUDoKICAgICAgICAgIGNvbnN0IGltYWdlID0gaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPyBhd2FpdCBpbWFnZVByb21pc2VzPy5nZXQoYW5ub3RhdGlvbi5iaXRtYXBJZCkgOiBudWxsOwogICAgICAgICAgaWYgKGltYWdlPy5pbWFnZVN0cmVhbSkgewogICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgaW1hZ2VTdHJlYW0sCiAgICAgICAgICAgICAgc21hc2tTdHJlYW0KICAgICAgICAgICAgfSA9IGltYWdlOwogICAgICAgICAgICBpZiAoc21hc2tTdHJlYW0pIHsKICAgICAgICAgICAgICBjb25zdCBzbWFza1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgICAgICAgICAgY2hhbmdlcy5wdXQoc21hc2tSZWYsIHsKICAgICAgICAgICAgICAgIGRhdGE6IHNtYXNrU3RyZWFtCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaW1hZ2VTdHJlYW0uZGljdC5zZXQoIlNNYXNrIiwgc21hc2tSZWYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGltYWdlUmVmID0gaW1hZ2UuaW1hZ2VSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgICAgICBjaGFuZ2VzLnB1dChpbWFnZVJlZiwgewogICAgICAgICAgICAgIGRhdGE6IGltYWdlU3RyZWFtCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpbWFnZS5pbWFnZVN0cmVhbSA9IGltYWdlLnNtYXNrU3RyZWFtID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHByb21pc2VzLnB1c2goU3RhbXBBbm5vdGF0aW9uLmNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgY2hhbmdlcywgewogICAgICAgICAgICBpbWFnZQogICAgICAgICAgfSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5TSUdOQVRVUkU6CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFN0YW1wQW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGNoYW5nZXMsIHt9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgYW5ub3RhdGlvbnM6IChhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcykpLmZsYXQoKQogICAgfTsKICB9CiAgc3RhdGljIGFzeW5jIHByaW50TmV3QW5ub3RhdGlvbnMoYW5ub3RhdGlvbkdsb2JhbHMsIGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvbnMsIGltYWdlUHJvbWlzZXMpIHsKICAgIGlmICghYW5ub3RhdGlvbnMpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIG9wdGlvbnMsCiAgICAgIHhyZWYKICAgIH0gPSBldmFsdWF0b3I7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmIChhbm5vdGF0aW9uLmRlbGV0ZWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzd2l0Y2ggKGFubm90YXRpb24uYW5ub3RhdGlvblR5cGUpIHsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLkZSRUVURVhUOgogICAgICAgICAgcHJvbWlzZXMucHVzaChGcmVlVGV4dEFubm90YXRpb24uY3JlYXRlTmV3UHJpbnRBbm5vdGF0aW9uKGFubm90YXRpb25HbG9iYWxzLCB4cmVmLCBhbm5vdGF0aW9uLCB7CiAgICAgICAgICAgIGV2YWx1YXRvciwKICAgICAgICAgICAgdGFzaywKICAgICAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogb3B0aW9ucwogICAgICAgICAgfSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5ISUdITElHSFQ6CiAgICAgICAgICBpZiAoYW5ub3RhdGlvbi5xdWFkUG9pbnRzKSB7CiAgICAgICAgICAgIHByb21pc2VzLnB1c2goSGlnaGxpZ2h0QW5ub3RhdGlvbi5jcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHsKICAgICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByb21pc2VzLnB1c2goSW5rQW5ub3RhdGlvbi5jcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHsKICAgICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuSU5LOgogICAgICAgICAgcHJvbWlzZXMucHVzaChJbmtBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QOgogICAgICAgICAgY29uc3QgaW1hZ2UgPSBvcHRpb25zLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID8gYXdhaXQgaW1hZ2VQcm9taXNlcz8uZ2V0KGFubm90YXRpb24uYml0bWFwSWQpIDogbnVsbDsKICAgICAgICAgIGlmIChpbWFnZT8uaW1hZ2VTdHJlYW0pIHsKICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIGltYWdlU3RyZWFtLAogICAgICAgICAgICAgIHNtYXNrU3RyZWFtCiAgICAgICAgICAgIH0gPSBpbWFnZTsKICAgICAgICAgICAgaWYgKHNtYXNrU3RyZWFtKSB7CiAgICAgICAgICAgICAgaW1hZ2VTdHJlYW0uZGljdC5zZXQoIlNNYXNrIiwgc21hc2tTdHJlYW0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGltYWdlLmltYWdlUmVmID0gbmV3IEpwZWdTdHJlYW0oaW1hZ2VTdHJlYW0sIGltYWdlU3RyZWFtLmxlbmd0aCk7CiAgICAgICAgICAgIGltYWdlLmltYWdlU3RyZWFtID0gaW1hZ2Uuc21hc2tTdHJlYW0gPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcHJvbWlzZXMucHVzaChTdGFtcEFubm90YXRpb24uY3JlYXRlTmV3UHJpbnRBbm5vdGF0aW9uKGFubm90YXRpb25HbG9iYWxzLCB4cmVmLCBhbm5vdGF0aW9uLCB7CiAgICAgICAgICAgIGltYWdlLAogICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLlNJR05BVFVSRToKICAgICAgICAgIHByb21pc2VzLnB1c2goU3RhbXBBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKTsKICB9Cn0KZnVuY3Rpb24gZ2V0UmdiQ29sb3IoY29sb3IsIGRlZmF1bHRDb2xvciA9IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKSkgewogIGlmICghQXJyYXkuaXNBcnJheShjb2xvcikpIHsKICAgIHJldHVybiBkZWZhdWx0Q29sb3I7CiAgfQogIGNvbnN0IHJnYkNvbG9yID0gZGVmYXVsdENvbG9yIHx8IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKTsKICBzd2l0Y2ggKGNvbG9yLmxlbmd0aCkgewogICAgY2FzZSAwOgogICAgICByZXR1cm4gbnVsbDsKICAgIGNhc2UgMToKICAgICAgQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSXRlbShjb2xvciwgMCwgcmdiQ29sb3IsIDApOwogICAgICByZXR1cm4gcmdiQ29sb3I7CiAgICBjYXNlIDM6CiAgICAgIENvbG9yU3BhY2VVdGlscy5yZ2IuZ2V0UmdiSXRlbShjb2xvciwgMCwgcmdiQ29sb3IsIDApOwogICAgICByZXR1cm4gcmdiQ29sb3I7CiAgICBjYXNlIDQ6CiAgICAgIENvbG9yU3BhY2VVdGlscy5jbXlrLmdldFJnYkl0ZW0oY29sb3IsIDAsIHJnYkNvbG9yLCAwKTsKICAgICAgcmV0dXJuIHJnYkNvbG9yOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGRlZmF1bHRDb2xvcjsKICB9Cn0KZnVuY3Rpb24gZ2V0UGRmQ29sb3JBcnJheShjb2xvciwgZGVmYXVsdFZhbHVlID0gbnVsbCkgewogIHJldHVybiBjb2xvciAmJiBBcnJheS5mcm9tKGNvbG9yLCBjID0+IGMgLyAyNTUpIHx8IGRlZmF1bHRWYWx1ZTsKfQpmdW5jdGlvbiBnZXRRdWFkUG9pbnRzKGRpY3QsIHJlY3QpIHsKICBjb25zdCBxdWFkUG9pbnRzID0gZGljdC5nZXRBcnJheSgiUXVhZFBvaW50cyIpOwogIGlmICghaXNOdW1iZXJBcnJheShxdWFkUG9pbnRzLCBudWxsKSB8fCBxdWFkUG9pbnRzLmxlbmd0aCA9PT0gMCB8fCBxdWFkUG9pbnRzLmxlbmd0aCAlIDggPiAwKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgbmV3UXVhZFBvaW50cyA9IG5ldyBGbG9hdDMyQXJyYXkocXVhZFBvaW50cy5sZW5ndGgpOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHF1YWRQb2ludHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gOCkgewogICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyLCB4MywgeTMsIHg0LCB5NF0gPSBxdWFkUG9pbnRzLnNsaWNlKGksIGkgKyA4KTsKICAgIGNvbnN0IG1pblggPSBNYXRoLm1pbih4MSwgeDIsIHgzLCB4NCk7CiAgICBjb25zdCBtYXhYID0gTWF0aC5tYXgoeDEsIHgyLCB4MywgeDQpOwogICAgY29uc3QgbWluWSA9IE1hdGgubWluKHkxLCB5MiwgeTMsIHk0KTsKICAgIGNvbnN0IG1heFkgPSBNYXRoLm1heCh5MSwgeTIsIHkzLCB5NCk7CiAgICBpZiAocmVjdCAhPT0gbnVsbCAmJiAobWluWCA8IHJlY3RbMF0gfHwgbWF4WCA+IHJlY3RbMl0gfHwgbWluWSA8IHJlY3RbMV0gfHwgbWF4WSA+IHJlY3RbM10pKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbmV3UXVhZFBvaW50cy5zZXQoW21pblgsIG1heFksIG1heFgsIG1heFksIG1pblgsIG1pblksIG1heFgsIG1pblldLCBpKTsKICB9CiAgcmV0dXJuIG5ld1F1YWRQb2ludHM7Cn0KZnVuY3Rpb24gZ2V0VHJhbnNmb3JtTWF0cml4KHJlY3QsIGJib3gsIG1hdHJpeCkgewogIGNvbnN0IG1pbk1heCA9IG5ldyBGbG9hdDMyQXJyYXkoW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldKTsKICBVdGlsLmF4aWFsQWxpZ25lZEJvdW5kaW5nQm94KGJib3gsIG1hdHJpeCwgbWluTWF4KTsKICBjb25zdCBbbWluWCwgbWluWSwgbWF4WCwgbWF4WV0gPSBtaW5NYXg7CiAgaWYgKG1pblggPT09IG1heFggfHwgbWluWSA9PT0gbWF4WSkgewogICAgcmV0dXJuIFsxLCAwLCAwLCAxLCByZWN0WzBdLCByZWN0WzFdXTsKICB9CiAgY29uc3QgeFJhdGlvID0gKHJlY3RbMl0gLSByZWN0WzBdKSAvIChtYXhYIC0gbWluWCk7CiAgY29uc3QgeVJhdGlvID0gKHJlY3RbM10gLSByZWN0WzFdKSAvIChtYXhZIC0gbWluWSk7CiAgcmV0dXJuIFt4UmF0aW8sIDAsIDAsIHlSYXRpbywgcmVjdFswXSAtIG1pblggKiB4UmF0aW8sIHJlY3RbMV0gLSBtaW5ZICogeVJhdGlvXTsKfQpjbGFzcyBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZiwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMsCiAgICAgIHJlZiwKICAgICAgb3JwaGFuRmllbGRzCiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgcGFyZW50UmVmID0gb3JwaGFuRmllbGRzPy5nZXQocmVmKTsKICAgIGlmIChwYXJlbnRSZWYpIHsKICAgICAgZGljdC5zZXQoIlBhcmVudCIsIHBhcmVudFJlZik7CiAgICB9CiAgICB0aGlzLnNldFRpdGxlKGRpY3QuZ2V0KCJUIikpOwogICAgdGhpcy5zZXRDb250ZW50cyhkaWN0LmdldCgiQ29udGVudHMiKSk7CiAgICB0aGlzLnNldE1vZGlmaWNhdGlvbkRhdGUoZGljdC5nZXQoIk0iKSk7CiAgICB0aGlzLnNldEZsYWdzKGRpY3QuZ2V0KCJGIikpOwogICAgdGhpcy5zZXRSZWN0YW5nbGUoZGljdC5nZXRBcnJheSgiUmVjdCIpKTsKICAgIHRoaXMuc2V0Q29sb3IoZGljdC5nZXRBcnJheSgiQyIpKTsKICAgIHRoaXMuc2V0Qm9yZGVyU3R5bGUoZGljdCk7CiAgICB0aGlzLnNldEFwcGVhcmFuY2UoZGljdCk7CiAgICB0aGlzLnNldE9wdGlvbmFsQ29udGVudChkaWN0KTsKICAgIGNvbnN0IE1LID0gZGljdC5nZXQoIk1LIik7CiAgICB0aGlzLnNldEJvcmRlckFuZEJhY2tncm91bmRDb2xvcnMoTUspOwogICAgdGhpcy5zZXRSb3RhdGlvbihNSywgZGljdCk7CiAgICB0aGlzLnJlZiA9IHBhcmFtcy5yZWYgaW5zdGFuY2VvZiBSZWYgPyBwYXJhbXMucmVmIDogbnVsbDsKICAgIHRoaXMuX3N0cmVhbXMgPSBbXTsKICAgIGlmICh0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgdGhpcy5fc3RyZWFtcy5wdXNoKHRoaXMuYXBwZWFyYW5jZSk7CiAgICB9CiAgICBjb25zdCBpc0xvY2tlZCA9ICEhKHRoaXMuZmxhZ3MgJiBBbm5vdGF0aW9uRmxhZy5MT0NLRUQpOwogICAgY29uc3QgaXNDb250ZW50TG9ja2VkID0gISEodGhpcy5mbGFncyAmIEFubm90YXRpb25GbGFnLkxPQ0tFRENPTlRFTlRTKTsKICAgIHRoaXMuZGF0YSA9IHsKICAgICAgYW5ub3RhdGlvbkZsYWdzOiB0aGlzLmZsYWdzLAogICAgICBib3JkZXJTdHlsZTogdGhpcy5ib3JkZXJTdHlsZSwKICAgICAgY29sb3I6IHRoaXMuY29sb3IsCiAgICAgIGJhY2tncm91bmRDb2xvcjogdGhpcy5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIGJvcmRlckNvbG9yOiB0aGlzLmJvcmRlckNvbG9yLAogICAgICByb3RhdGlvbjogdGhpcy5yb3RhdGlvbiwKICAgICAgY29udGVudHNPYmo6IHRoaXMuX2NvbnRlbnRzLAogICAgICBoYXNBcHBlYXJhbmNlOiAhIXRoaXMuYXBwZWFyYW5jZSwKICAgICAgaWQ6IHBhcmFtcy5pZCwKICAgICAgbW9kaWZpY2F0aW9uRGF0ZTogdGhpcy5tb2RpZmljYXRpb25EYXRlLAogICAgICByZWN0OiB0aGlzLnJlY3RhbmdsZSwKICAgICAgc3VidHlwZTogcGFyYW1zLnN1YnR5cGUsCiAgICAgIGhhc093bkNhbnZhczogZmFsc2UsCiAgICAgIG5vUm90YXRlOiAhISh0aGlzLmZsYWdzICYgQW5ub3RhdGlvbkZsYWcuTk9ST1RBVEUpLAogICAgICBub0hUTUw6IGlzTG9ja2VkICYmIGlzQ29udGVudExvY2tlZCwKICAgICAgaXNFZGl0YWJsZTogZmFsc2UsCiAgICAgIHN0cnVjdFBhcmVudDogLTEKICAgIH07CiAgICBpZiAoYW5ub3RhdGlvbkdsb2JhbHMuc3RydWN0VHJlZVJvb3QpIHsKICAgICAgbGV0IHN0cnVjdFBhcmVudCA9IGRpY3QuZ2V0KCJTdHJ1Y3RQYXJlbnQiKTsKICAgICAgdGhpcy5kYXRhLnN0cnVjdFBhcmVudCA9IHN0cnVjdFBhcmVudCA9IE51bWJlci5pc0ludGVnZXIoc3RydWN0UGFyZW50KSAmJiBzdHJ1Y3RQYXJlbnQgPj0gMCA/IHN0cnVjdFBhcmVudCA6IC0xOwogICAgICBhbm5vdGF0aW9uR2xvYmFscy5zdHJ1Y3RUcmVlUm9vdC5hZGRBbm5vdGF0aW9uSWRUb1BhZ2UocGFyYW1zLnBhZ2VSZWYsIHN0cnVjdFBhcmVudCk7CiAgICB9CiAgICBpZiAocGFyYW1zLmNvbGxlY3RGaWVsZHMpIHsKICAgICAgY29uc3Qga2lkcyA9IGRpY3QuZ2V0KCJLaWRzIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGtpZHMpKSB7CiAgICAgICAgY29uc3Qga2lkSWRzID0gW107CiAgICAgICAgZm9yIChjb25zdCBraWQgb2Yga2lkcykgewogICAgICAgICAgaWYgKGtpZCBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgICBraWRJZHMucHVzaChraWQudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChraWRJZHMubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICB0aGlzLmRhdGEua2lkSWRzID0ga2lkSWRzOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmRhdGEuYWN0aW9ucyA9IGNvbGxlY3RBY3Rpb25zKHhyZWYsIGRpY3QsIEFubm90YXRpb25BY3Rpb25FdmVudFR5cGUpOwogICAgICB0aGlzLmRhdGEuZmllbGROYW1lID0gdGhpcy5fY29uc3RydWN0RmllbGROYW1lKGRpY3QpOwogICAgICB0aGlzLmRhdGEucGFnZUluZGV4ID0gcGFyYW1zLnBhZ2VJbmRleDsKICAgIH0KICAgIGNvbnN0IGl0ID0gZGljdC5nZXQoIklUIik7CiAgICBpZiAoaXQgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHRoaXMuZGF0YS5pdCA9IGl0Lm5hbWU7CiAgICB9CiAgICB0aGlzLl9pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IHBhcmFtcy5ldmFsdWF0b3JPcHRpb25zLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOwogICAgdGhpcy5fZmFsbGJhY2tGb250RGljdCA9IG51bGw7CiAgICB0aGlzLl9uZWVkQXBwZWFyYW5jZXMgPSBmYWxzZTsKICB9CiAgX2hhc0ZsYWcoZmxhZ3MsIGZsYWcpIHsKICAgIHJldHVybiAhIShmbGFncyAmIGZsYWcpOwogIH0KICBfYnVpbGRGbGFncyhub1ZpZXcsIG5vUHJpbnQpIHsKICAgIGxldCB7CiAgICAgIGZsYWdzCiAgICB9ID0gdGhpczsKICAgIGlmIChub1ZpZXcgPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAobm9QcmludCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQogICAgICBpZiAobm9QcmludCkgewogICAgICAgIHJldHVybiBmbGFncyAmIH5Bbm5vdGF0aW9uRmxhZy5QUklOVDsKICAgICAgfQogICAgICByZXR1cm4gZmxhZ3MgJiB+QW5ub3RhdGlvbkZsYWcuSElEREVOIHwgQW5ub3RhdGlvbkZsYWcuUFJJTlQ7CiAgICB9CiAgICBpZiAobm9WaWV3KSB7CiAgICAgIGZsYWdzIHw9IEFubm90YXRpb25GbGFnLlBSSU5UOwogICAgICBpZiAobm9QcmludCkgewogICAgICAgIHJldHVybiBmbGFncyAmIH5Bbm5vdGF0aW9uRmxhZy5OT1ZJRVcgfCBBbm5vdGF0aW9uRmxhZy5ISURERU47CiAgICAgIH0KICAgICAgcmV0dXJuIGZsYWdzICYgfkFubm90YXRpb25GbGFnLkhJRERFTiB8IEFubm90YXRpb25GbGFnLk5PVklFVzsKICAgIH0KICAgIGZsYWdzICY9IH4oQW5ub3RhdGlvbkZsYWcuSElEREVOIHwgQW5ub3RhdGlvbkZsYWcuTk9WSUVXKTsKICAgIGlmIChub1ByaW50KSB7CiAgICAgIHJldHVybiBmbGFncyAmIH5Bbm5vdGF0aW9uRmxhZy5QUklOVDsKICAgIH0KICAgIHJldHVybiBmbGFncyB8IEFubm90YXRpb25GbGFnLlBSSU5UOwogIH0KICBfaXNWaWV3YWJsZShmbGFncykgewogICAgcmV0dXJuICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBBbm5vdGF0aW9uRmxhZy5JTlZJU0lCTEUpICYmICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBBbm5vdGF0aW9uRmxhZy5OT1ZJRVcpOwogIH0KICBfaXNQcmludGFibGUoZmxhZ3MpIHsKICAgIHJldHVybiB0aGlzLl9oYXNGbGFnKGZsYWdzLCBBbm5vdGF0aW9uRmxhZy5QUklOVCkgJiYgIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIEFubm90YXRpb25GbGFnLkhJRERFTikgJiYgIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIEFubm90YXRpb25GbGFnLklOVklTSUJMRSk7CiAgfQogIG11c3RCZVZpZXdlZChhbm5vdGF0aW9uU3RvcmFnZSwgX3JlbmRlckZvcm1zKSB7CiAgICBjb25zdCBub1ZpZXcgPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk/Lm5vVmlldzsKICAgIGlmIChub1ZpZXcgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gIW5vVmlldzsKICAgIH0KICAgIHJldHVybiB0aGlzLnZpZXdhYmxlICYmICF0aGlzLl9oYXNGbGFnKHRoaXMuZmxhZ3MsIEFubm90YXRpb25GbGFnLkhJRERFTik7CiAgfQogIG11c3RCZVByaW50ZWQoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGNvbnN0IG5vUHJpbnQgPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk/Lm5vUHJpbnQ7CiAgICBpZiAobm9QcmludCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiAhbm9QcmludDsKICAgIH0KICAgIHJldHVybiB0aGlzLnByaW50YWJsZTsKICB9CiAgbXVzdEJlVmlld2VkV2hlbkVkaXRpbmcoaXNFZGl0aW5nLCBtb2RpZmllZElkcyA9IG51bGwpIHsKICAgIHJldHVybiBpc0VkaXRpbmcgPyAhdGhpcy5kYXRhLmlzRWRpdGFibGUgOiAhbW9kaWZpZWRJZHM/Lmhhcyh0aGlzLmRhdGEuaWQpOwogIH0KICBnZXQgdmlld2FibGUoKSB7CiAgICBpZiAodGhpcy5kYXRhLnF1YWRQb2ludHMgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXMuZmxhZ3MgPT09IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gdGhpcy5faXNWaWV3YWJsZSh0aGlzLmZsYWdzKTsKICB9CiAgZ2V0IHByaW50YWJsZSgpIHsKICAgIGlmICh0aGlzLmRhdGEucXVhZFBvaW50cyA9PT0gbnVsbCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5mbGFncyA9PT0gMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdGhpcy5faXNQcmludGFibGUodGhpcy5mbGFncyk7CiAgfQogIF9wYXJzZVN0cmluZ0hlbHBlcihkYXRhKSB7CiAgICBjb25zdCBzdHIgPSB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb1BERlN0cmluZyhkYXRhKSA6ICIiOwogICAgY29uc3QgZGlyID0gc3RyICYmIGJpZGkoc3RyKS5kaXIgPT09ICJydGwiID8gInJ0bCIgOiAibHRyIjsKICAgIHJldHVybiB7CiAgICAgIHN0ciwKICAgICAgZGlyCiAgICB9OwogIH0KICBzZXREZWZhdWx0QXBwZWFyYW5jZShwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBkZWZhdWx0QXBwZWFyYW5jZSA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJEQSIKICAgIH0pIHx8IGFubm90YXRpb25HbG9iYWxzLmFjcm9Gb3JtLmdldCgiREEiKTsKICAgIHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlID0gdHlwZW9mIGRlZmF1bHRBcHBlYXJhbmNlID09PSAic3RyaW5nIiA/IGRlZmF1bHRBcHBlYXJhbmNlIDogIiI7CiAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhID0gcGFyc2VEZWZhdWx0QXBwZWFyYW5jZSh0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSk7CiAgfQogIHNldFRpdGxlKHRpdGxlKSB7CiAgICB0aGlzLl90aXRsZSA9IHRoaXMuX3BhcnNlU3RyaW5nSGVscGVyKHRpdGxlKTsKICB9CiAgc2V0Q29udGVudHMoY29udGVudHMpIHsKICAgIHRoaXMuX2NvbnRlbnRzID0gdGhpcy5fcGFyc2VTdHJpbmdIZWxwZXIoY29udGVudHMpOwogIH0KICBzZXRNb2RpZmljYXRpb25EYXRlKG1vZGlmaWNhdGlvbkRhdGUpIHsKICAgIHRoaXMubW9kaWZpY2F0aW9uRGF0ZSA9IHR5cGVvZiBtb2RpZmljYXRpb25EYXRlID09PSAic3RyaW5nIiA/IG1vZGlmaWNhdGlvbkRhdGUgOiBudWxsOwogIH0KICBzZXRGbGFncyhmbGFncykgewogICAgdGhpcy5mbGFncyA9IE51bWJlci5pc0ludGVnZXIoZmxhZ3MpICYmIGZsYWdzID4gMCA/IGZsYWdzIDogMDsKICAgIGlmICh0aGlzLmZsYWdzICYgQW5ub3RhdGlvbkZsYWcuSU5WSVNJQkxFICYmIHRoaXMuY29uc3RydWN0b3IubmFtZSAhPT0gIkFubm90YXRpb24iKSB7CiAgICAgIHRoaXMuZmxhZ3MgXj0gQW5ub3RhdGlvbkZsYWcuSU5WSVNJQkxFOwogICAgfQogIH0KICBoYXNGbGFnKGZsYWcpIHsKICAgIHJldHVybiB0aGlzLl9oYXNGbGFnKHRoaXMuZmxhZ3MsIGZsYWcpOwogIH0KICBzZXRSZWN0YW5nbGUocmVjdGFuZ2xlKSB7CiAgICB0aGlzLnJlY3RhbmdsZSA9IGxvb2t1cE5vcm1hbFJlY3QocmVjdGFuZ2xlLCBbMCwgMCwgMCwgMF0pOwogIH0KICBzZXRDb2xvcihjb2xvcikgewogICAgdGhpcy5jb2xvciA9IGdldFJnYkNvbG9yKGNvbG9yKTsKICB9CiAgc2V0TGluZUVuZGluZ3MobGluZUVuZGluZ3MpIHsKICAgIHRoaXMubGluZUVuZGluZ3MgPSBbIk5vbmUiLCAiTm9uZSJdOwogICAgaWYgKEFycmF5LmlzQXJyYXkobGluZUVuZGluZ3MpICYmIGxpbmVFbmRpbmdzLmxlbmd0aCA9PT0gMikgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgIGNvbnN0IG9iaiA9IGxpbmVFbmRpbmdzW2ldOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICBzd2l0Y2ggKG9iai5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIk5vbmUiOgogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlICJTcXVhcmUiOgogICAgICAgICAgICBjYXNlICJDaXJjbGUiOgogICAgICAgICAgICBjYXNlICJEaWFtb25kIjoKICAgICAgICAgICAgY2FzZSAiT3BlbkFycm93IjoKICAgICAgICAgICAgY2FzZSAiQ2xvc2VkQXJyb3ciOgogICAgICAgICAgICBjYXNlICJCdXR0IjoKICAgICAgICAgICAgY2FzZSAiUk9wZW5BcnJvdyI6CiAgICAgICAgICAgIGNhc2UgIlJDbG9zZWRBcnJvdyI6CiAgICAgICAgICAgIGNhc2UgIlNsYXNoIjoKICAgICAgICAgICAgICB0aGlzLmxpbmVFbmRpbmdzW2ldID0gb2JqLm5hbWU7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHdhcm4oYElnbm9yaW5nIGludmFsaWQgbGluZUVuZGluZzogJHtvYmp9YCk7CiAgICAgIH0KICAgIH0KICB9CiAgc2V0Um90YXRpb24obWssIGRpY3QpIHsKICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgbGV0IGFuZ2xlID0gbWsgaW5zdGFuY2VvZiBEaWN0ID8gbWsuZ2V0KCJSIikgfHwgMCA6IGRpY3QuZ2V0KCJSb3RhdGUiKSB8fCAwOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIoYW5nbGUpICYmIGFuZ2xlICE9PSAwKSB7CiAgICAgIGFuZ2xlICU9IDM2MDsKICAgICAgaWYgKGFuZ2xlIDwgMCkgewogICAgICAgIGFuZ2xlICs9IDM2MDsKICAgICAgfQogICAgICBpZiAoYW5nbGUgJSA5MCA9PT0gMCkgewogICAgICAgIHRoaXMucm90YXRpb24gPSBhbmdsZTsKICAgICAgfQogICAgfQogIH0KICBzZXRCb3JkZXJBbmRCYWNrZ3JvdW5kQ29sb3JzKG1rKSB7CiAgICBpZiAobWsgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIHRoaXMuYm9yZGVyQ29sb3IgPSBnZXRSZ2JDb2xvcihtay5nZXRBcnJheSgiQkMiKSwgbnVsbCk7CiAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gZ2V0UmdiQ29sb3IobWsuZ2V0QXJyYXkoIkJHIiksIG51bGwpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5ib3JkZXJDb2xvciA9IHRoaXMuYmFja2dyb3VuZENvbG9yID0gbnVsbDsKICAgIH0KICB9CiAgc2V0Qm9yZGVyU3R5bGUoYm9yZGVyU3R5bGUpIHsKICAgIHRoaXMuYm9yZGVyU3R5bGUgPSBuZXcgQW5ub3RhdGlvbkJvcmRlclN0eWxlKCk7CiAgICBpZiAoIShib3JkZXJTdHlsZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChib3JkZXJTdHlsZS5oYXMoIkJTIikpIHsKICAgICAgY29uc3QgZGljdCA9IGJvcmRlclN0eWxlLmdldCgiQlMiKTsKICAgICAgaWYgKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgZGljdFR5cGUgPSBkaWN0LmdldCgiVHlwZSIpOwogICAgICAgIGlmICghZGljdFR5cGUgfHwgaXNOYW1lKGRpY3RUeXBlLCAiQm9yZGVyIikpIHsKICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0V2lkdGgoZGljdC5nZXQoIlciKSwgdGhpcy5yZWN0YW5nbGUpOwogICAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRTdHlsZShkaWN0LmdldCgiUyIpKTsKICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0RGFzaEFycmF5KGRpY3QuZ2V0QXJyYXkoIkQiKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKGJvcmRlclN0eWxlLmhhcygiQm9yZGVyIikpIHsKICAgICAgY29uc3QgYXJyYXkgPSBib3JkZXJTdHlsZS5nZXRBcnJheSgiQm9yZGVyIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycmF5KSAmJiBhcnJheS5sZW5ndGggPj0gMykgewogICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0SG9yaXpvbnRhbENvcm5lclJhZGl1cyhhcnJheVswXSk7CiAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRWZXJ0aWNhbENvcm5lclJhZGl1cyhhcnJheVsxXSk7CiAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXRXaWR0aChhcnJheVsyXSwgdGhpcy5yZWN0YW5nbGUpOwogICAgICAgIGlmIChhcnJheS5sZW5ndGggPT09IDQpIHsKICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0RGFzaEFycmF5KGFycmF5WzNdLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0V2lkdGgoMCk7CiAgICB9CiAgfQogIHNldEFwcGVhcmFuY2UoZGljdCkgewogICAgdGhpcy5hcHBlYXJhbmNlID0gbnVsbDsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdGF0ZXMgPSBkaWN0LmdldCgiQVAiKTsKICAgIGlmICghKGFwcGVhcmFuY2VTdGF0ZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBub3JtYWxBcHBlYXJhbmNlU3RhdGUgPSBhcHBlYXJhbmNlU3RhdGVzLmdldCgiTiIpOwogICAgaWYgKG5vcm1hbEFwcGVhcmFuY2VTdGF0ZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgdGhpcy5hcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZVN0YXRlOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIShub3JtYWxBcHBlYXJhbmNlU3RhdGUgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBhcyA9IGRpY3QuZ2V0KCJBUyIpOwogICAgaWYgKCEoYXMgaW5zdGFuY2VvZiBOYW1lKSB8fCAhbm9ybWFsQXBwZWFyYW5jZVN0YXRlLmhhcyhhcy5uYW1lKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZVN0YXRlLmdldChhcy5uYW1lKTsKICAgIGlmIChhcHBlYXJhbmNlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlOwogICAgfQogIH0KICBzZXRPcHRpb25hbENvbnRlbnQoZGljdCkgewogICAgdGhpcy5vYyA9IG51bGw7CiAgICBjb25zdCBvYyA9IGRpY3QuZ2V0KCJPQyIpOwogICAgaWYgKG9jIGluc3RhbmNlb2YgTmFtZSkgewogICAgICB3YXJuKCJzZXRPcHRpb25hbENvbnRlbnQ6IFN1cHBvcnQgZm9yIC9OYW1lLWVudHJ5IGlzIG5vdCBpbXBsZW1lbnRlZC4iKTsKICAgIH0gZWxzZSBpZiAob2MgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIHRoaXMub2MgPSBvYzsKICAgIH0KICB9CiAgYXN5bmMgbG9hZFJlc291cmNlcyhrZXlzLCBhcHBlYXJhbmNlKSB7CiAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCBhcHBlYXJhbmNlLmRpY3QuZ2V0QXN5bmMoIlJlc291cmNlcyIpOwogICAgaWYgKHJlc291cmNlcykgewogICAgICBhd2FpdCBPYmplY3RMb2FkZXIubG9hZChyZXNvdXJjZXMsIGtleXMsIHJlc291cmNlcy54cmVmKTsKICAgIH0KICAgIHJldHVybiByZXNvdXJjZXM7CiAgfQogIGFzeW5jIGdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGNvbnN0IHsKICAgICAgaGFzT3duQ2FudmFzLAogICAgICBpZCwKICAgICAgcmVjdAogICAgfSA9IHRoaXMuZGF0YTsKICAgIGxldCBhcHBlYXJhbmNlID0gdGhpcy5hcHBlYXJhbmNlOwogICAgY29uc3QgaXNVc2luZ093bkNhbnZhcyA9ICEhKGhhc093bkNhbnZhcyAmJiBpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkRJU1BMQVkpOwogICAgaWYgKGlzVXNpbmdPd25DYW52YXMgJiYgKHRoaXMud2lkdGggPT09IDAgfHwgdGhpcy5oZWlnaHQgPT09IDApKSB7CiAgICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSBmYWxzZTsKICAgICAgcmV0dXJuIHsKICAgICAgICBvcExpc3Q6IG5ldyBPcGVyYXRvckxpc3QoKSwKICAgICAgICBzZXBhcmF0ZUZvcm06IGZhbHNlLAogICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICB9OwogICAgfQogICAgaWYgKCFhcHBlYXJhbmNlKSB7CiAgICAgIGlmICghaXNVc2luZ093bkNhbnZhcykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBvcExpc3Q6IG5ldyBPcGVyYXRvckxpc3QoKSwKICAgICAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgICAgICBzZXBhcmF0ZUNhbnZhczogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIGFwcGVhcmFuY2UgPSBuZXcgU3RyaW5nU3RyZWFtKCIiKTsKICAgICAgYXBwZWFyYW5jZS5kaWN0ID0gbmV3IERpY3QoKTsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2VEaWN0ID0gYXBwZWFyYW5jZS5kaWN0OwogICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgdGhpcy5sb2FkUmVzb3VyY2VzKFJFU09VUkNFU19LRVlTX09QRVJBVE9SX0xJU1QsIGFwcGVhcmFuY2UpOwogICAgY29uc3QgYmJveCA9IGxvb2t1cFJlY3QoYXBwZWFyYW5jZURpY3QuZ2V0QXJyYXkoIkJCb3giKSwgWzAsIDAsIDEsIDFdKTsKICAgIGNvbnN0IG1hdHJpeCA9IGxvb2t1cE1hdHJpeChhcHBlYXJhbmNlRGljdC5nZXRBcnJheSgiTWF0cml4IiksIElERU5USVRZX01BVFJJWCk7CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBnZXRUcmFuc2Zvcm1NYXRyaXgocmVjdCwgYmJveCwgbWF0cml4KTsKICAgIGNvbnN0IG9wTGlzdCA9IG5ldyBPcGVyYXRvckxpc3QoKTsKICAgIGxldCBvcHRpb25hbENvbnRlbnQ7CiAgICBpZiAodGhpcy5vYykgewogICAgICBvcHRpb25hbENvbnRlbnQgPSBhd2FpdCBldmFsdWF0b3IucGFyc2VNYXJrZWRDb250ZW50UHJvcHModGhpcy5vYywgbnVsbCk7CiAgICB9CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgb3BMaXN0LmFkZE9wKE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG9wdGlvbmFsQ29udGVudF0pOwogICAgfQogICAgb3BMaXN0LmFkZE9wKE9QUy5iZWdpbkFubm90YXRpb24sIFtpZCwgcmVjdCwgdHJhbnNmb3JtLCBtYXRyaXgsIGlzVXNpbmdPd25DYW52YXNdKTsKICAgIGF3YWl0IGV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICBzdHJlYW06IGFwcGVhcmFuY2UsCiAgICAgIHRhc2ssCiAgICAgIHJlc291cmNlcywKICAgICAgb3BlcmF0b3JMaXN0OiBvcExpc3QsCiAgICAgIGZhbGxiYWNrRm9udERpY3Q6IHRoaXMuX2ZhbGxiYWNrRm9udERpY3QKICAgIH0pOwogICAgb3BMaXN0LmFkZE9wKE9QUy5lbmRBbm5vdGF0aW9uLCBbXSk7CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgb3BMaXN0LmFkZE9wKE9QUy5lbmRNYXJrZWRDb250ZW50LCBbXSk7CiAgICB9CiAgICB0aGlzLnJlc2V0KCk7CiAgICByZXR1cm4gewogICAgICBvcExpc3QsCiAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgIHNlcGFyYXRlQ2FudmFzOiBpc1VzaW5nT3duQ2FudmFzCiAgICB9OwogIH0KICBhc3luYyBzYXZlKGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBnZXQgb3ZlcmxheXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGhhc1RleHRDb250ZW50KCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBhc3luYyBleHRyYWN0VGV4dENvbnRlbnQoZXZhbHVhdG9yLCB0YXNrLCB2aWV3Qm94KSB7CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCB0aGlzLmxvYWRSZXNvdXJjZXMoUkVTT1VSQ0VTX0tFWVNfVEVYVF9DT05URU5ULCB0aGlzLmFwcGVhcmFuY2UpOwogICAgY29uc3QgdGV4dCA9IFtdOwogICAgY29uc3QgYnVmZmVyID0gW107CiAgICBsZXQgZmlyc3RQb3NpdGlvbiA9IG51bGw7CiAgICBjb25zdCBzaW5rID0gewogICAgICBkZXNpcmVkU2l6ZTogTWF0aC5JbmZpbml0eSwKICAgICAgcmVhZHk6IHRydWUsCiAgICAgIGVucXVldWUoY2h1bmssIHNpemUpIHsKICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2h1bmsuaXRlbXMpIHsKICAgICAgICAgIGlmIChpdGVtLnN0ciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgZmlyc3RQb3NpdGlvbiB8fD0gaXRlbS50cmFuc2Zvcm0uc2xpY2UoLTIpOwogICAgICAgICAgYnVmZmVyLnB1c2goaXRlbS5zdHIpOwogICAgICAgICAgaWYgKGl0ZW0uaGFzRU9MKSB7CiAgICAgICAgICAgIHRleHQucHVzaChidWZmZXIuam9pbigiIikudHJpbUVuZCgpKTsKICAgICAgICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgYXdhaXQgZXZhbHVhdG9yLmdldFRleHRDb250ZW50KHsKICAgICAgc3RyZWFtOiB0aGlzLmFwcGVhcmFuY2UsCiAgICAgIHRhc2ssCiAgICAgIHJlc291cmNlcywKICAgICAgaW5jbHVkZU1hcmtlZENvbnRlbnQ6IHRydWUsCiAgICAgIGtlZXBXaGl0ZVNwYWNlOiB0cnVlLAogICAgICBzaW5rLAogICAgICB2aWV3Qm94CiAgICB9KTsKICAgIHRoaXMucmVzZXQoKTsKICAgIGlmIChidWZmZXIubGVuZ3RoKSB7CiAgICAgIHRleHQucHVzaChidWZmZXIuam9pbigiIikudHJpbUVuZCgpKTsKICAgIH0KICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDEgfHwgdGV4dFswXSkgewogICAgICBjb25zdCBhcHBlYXJhbmNlRGljdCA9IHRoaXMuYXBwZWFyYW5jZS5kaWN0OwogICAgICBjb25zdCBiYm94ID0gbG9va3VwUmVjdChhcHBlYXJhbmNlRGljdC5nZXRBcnJheSgiQkJveCIpLCBudWxsKTsKICAgICAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGFwcGVhcmFuY2VEaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgbnVsbCk7CiAgICAgIHRoaXMuZGF0YS50ZXh0UG9zaXRpb24gPSB0aGlzLl90cmFuc2Zvcm1Qb2ludChmaXJzdFBvc2l0aW9uLCBiYm94LCBtYXRyaXgpOwogICAgICB0aGlzLmRhdGEudGV4dENvbnRlbnQgPSB0ZXh0OwogICAgfQogIH0KICBfdHJhbnNmb3JtUG9pbnQoY29vcmRzLCBiYm94LCBtYXRyaXgpIHsKICAgIGNvbnN0IHsKICAgICAgcmVjdAogICAgfSA9IHRoaXMuZGF0YTsKICAgIGJib3ggfHw9IFswLCAwLCAxLCAxXTsKICAgIG1hdHJpeCB8fD0gWzEsIDAsIDAsIDEsIDAsIDBdOwogICAgY29uc3QgdHJhbnNmb3JtID0gZ2V0VHJhbnNmb3JtTWF0cml4KHJlY3QsIGJib3gsIG1hdHJpeCk7CiAgICB0cmFuc2Zvcm1bNF0gLT0gcmVjdFswXTsKICAgIHRyYW5zZm9ybVs1XSAtPSByZWN0WzFdOwogICAgY29uc3QgcCA9IGNvb3Jkcy5zbGljZSgpOwogICAgVXRpbC5hcHBseVRyYW5zZm9ybShwLCB0cmFuc2Zvcm0pOwogICAgVXRpbC5hcHBseVRyYW5zZm9ybShwLCBtYXRyaXgpOwogICAgcmV0dXJuIHA7CiAgfQogIGdldEZpZWxkT2JqZWN0KCkgewogICAgaWYgKHRoaXMuZGF0YS5raWRJZHMpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogdGhpcy5kYXRhLmlkLAogICAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICAgIG5hbWU6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgICAgc3Ryb2tlQ29sb3I6IHRoaXMuZGF0YS5ib3JkZXJDb2xvciwKICAgICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgICAgdHlwZTogIiIsCiAgICAgICAga2lkSWRzOiB0aGlzLmRhdGEua2lkSWRzLAogICAgICAgIHBhZ2U6IHRoaXMuZGF0YS5wYWdlSW5kZXgsCiAgICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24KICAgICAgfTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICByZXNldCgpIHsKICAgIGZvciAoY29uc3Qgc3RyZWFtIG9mIHRoaXMuX3N0cmVhbXMpIHsKICAgICAgc3RyZWFtLnJlc2V0KCk7CiAgICB9CiAgfQogIF9jb25zdHJ1Y3RGaWVsZE5hbWUoZGljdCkgewogICAgaWYgKCFkaWN0LmhhcygiVCIpICYmICFkaWN0LmhhcygiUGFyZW50IikpIHsKICAgICAgd2FybigiVW5rbm93biBmaWVsZCBuYW1lLCBmYWxsaW5nIGJhY2sgdG8gZW1wdHkgZmllbGQgbmFtZS4iKTsKICAgICAgcmV0dXJuICIiOwogICAgfQogICAgaWYgKCFkaWN0LmhhcygiUGFyZW50IikpIHsKICAgICAgcmV0dXJuIHN0cmluZ1RvUERGU3RyaW5nKGRpY3QuZ2V0KCJUIikpOwogICAgfQogICAgY29uc3QgZmllbGROYW1lID0gW107CiAgICBpZiAoZGljdC5oYXMoIlQiKSkgewogICAgICBmaWVsZE5hbWUudW5zaGlmdChzdHJpbmdUb1BERlN0cmluZyhkaWN0LmdldCgiVCIpKSk7CiAgICB9CiAgICBsZXQgbG9vcERpY3QgPSBkaWN0OwogICAgY29uc3QgdmlzaXRlZCA9IG5ldyBSZWZTZXQoKTsKICAgIGlmIChkaWN0Lm9iaklkKSB7CiAgICAgIHZpc2l0ZWQucHV0KGRpY3Qub2JqSWQpOwogICAgfQogICAgd2hpbGUgKGxvb3BEaWN0LmhhcygiUGFyZW50IikpIHsKICAgICAgbG9vcERpY3QgPSBsb29wRGljdC5nZXQoIlBhcmVudCIpOwogICAgICBpZiAoIShsb29wRGljdCBpbnN0YW5jZW9mIERpY3QpIHx8IGxvb3BEaWN0Lm9iaklkICYmIHZpc2l0ZWQuaGFzKGxvb3BEaWN0Lm9iaklkKSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChsb29wRGljdC5vYmpJZCkgewogICAgICAgIHZpc2l0ZWQucHV0KGxvb3BEaWN0Lm9iaklkKTsKICAgICAgfQogICAgICBpZiAobG9vcERpY3QuaGFzKCJUIikpIHsKICAgICAgICBmaWVsZE5hbWUudW5zaGlmdChzdHJpbmdUb1BERlN0cmluZyhsb29wRGljdC5nZXQoIlQiKSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmllbGROYW1lLmpvaW4oIi4iKTsKICB9CiAgZ2V0IHdpZHRoKCkgewogICAgcmV0dXJuIHRoaXMuZGF0YS5yZWN0WzJdIC0gdGhpcy5kYXRhLnJlY3RbMF07CiAgfQogIGdldCBoZWlnaHQoKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhLnJlY3RbM10gLSB0aGlzLmRhdGEucmVjdFsxXTsKICB9Cn0KY2xhc3MgQW5ub3RhdGlvbkJvcmRlclN0eWxlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMud2lkdGggPSAxOwogICAgdGhpcy5yYXdXaWR0aCA9IDE7CiAgICB0aGlzLnN0eWxlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5TT0xJRDsKICAgIHRoaXMuZGFzaEFycmF5ID0gWzNdOwogICAgdGhpcy5ob3Jpem9udGFsQ29ybmVyUmFkaXVzID0gMDsKICAgIHRoaXMudmVydGljYWxDb3JuZXJSYWRpdXMgPSAwOwogIH0KICBzZXRXaWR0aCh3aWR0aCwgcmVjdCA9IFswLCAwLCAwLCAwXSkgewogICAgaWYgKHdpZHRoIGluc3RhbmNlb2YgTmFtZSkgewogICAgICB0aGlzLndpZHRoID0gMDsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHR5cGVvZiB3aWR0aCA9PT0gIm51bWJlciIpIHsKICAgICAgaWYgKHdpZHRoID4gMCkgewogICAgICAgIHRoaXMucmF3V2lkdGggPSB3aWR0aDsKICAgICAgICBjb25zdCBtYXhXaWR0aCA9IChyZWN0WzJdIC0gcmVjdFswXSkgLyAyOwogICAgICAgIGNvbnN0IG1heEhlaWdodCA9IChyZWN0WzNdIC0gcmVjdFsxXSkgLyAyOwogICAgICAgIGlmIChtYXhXaWR0aCA+IDAgJiYgbWF4SGVpZ2h0ID4gMCAmJiAod2lkdGggPiBtYXhXaWR0aCB8fCB3aWR0aCA+IG1heEhlaWdodCkpIHsKICAgICAgICAgIHdhcm4oYEFubm90YXRpb25Cb3JkZXJTdHlsZS5zZXRXaWR0aCAtIGlnbm9yaW5nIHdpZHRoOiAke3dpZHRofWApOwogICAgICAgICAgd2lkdGggPSAxOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICB9CiAgfQogIHNldFN0eWxlKHN0eWxlKSB7CiAgICBpZiAoIShzdHlsZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN3aXRjaCAoc3R5bGUubmFtZSkgewogICAgICBjYXNlICJTIjoKICAgICAgICB0aGlzLnN0eWxlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5TT0xJRDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiRCI6CiAgICAgICAgdGhpcy5zdHlsZSA9IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuREFTSEVEOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJCIjoKICAgICAgICB0aGlzLnN0eWxlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5CRVZFTEVEOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJJIjoKICAgICAgICB0aGlzLnN0eWxlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5JTlNFVDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiVSI6CiAgICAgICAgdGhpcy5zdHlsZSA9IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuVU5ERVJMSU5FOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGJyZWFrOwogICAgfQogIH0KICBzZXREYXNoQXJyYXkoZGFzaEFycmF5LCBmb3JjZVN0eWxlID0gZmFsc2UpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGRhc2hBcnJheSkpIHsKICAgICAgbGV0IGlzVmFsaWQgPSB0cnVlOwogICAgICBsZXQgYWxsWmVyb3MgPSB0cnVlOwogICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZGFzaEFycmF5KSB7CiAgICAgICAgY29uc3QgdmFsaWROdW1iZXIgPSArZWxlbWVudCA+PSAwOwogICAgICAgIGlmICghdmFsaWROdW1iZXIpIHsKICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudCA+IDApIHsKICAgICAgICAgIGFsbFplcm9zID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChkYXNoQXJyYXkubGVuZ3RoID09PSAwIHx8IGlzVmFsaWQgJiYgIWFsbFplcm9zKSB7CiAgICAgICAgdGhpcy5kYXNoQXJyYXkgPSBkYXNoQXJyYXk7CiAgICAgICAgaWYgKGZvcmNlU3R5bGUpIHsKICAgICAgICAgIHRoaXMuc2V0U3R5bGUoTmFtZS5nZXQoIkQiKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMud2lkdGggPSAwOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGRhc2hBcnJheSkgewogICAgICB0aGlzLndpZHRoID0gMDsKICAgIH0KICB9CiAgc2V0SG9yaXpvbnRhbENvcm5lclJhZGl1cyhyYWRpdXMpIHsKICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHJhZGl1cykpIHsKICAgICAgdGhpcy5ob3Jpem9udGFsQ29ybmVyUmFkaXVzID0gcmFkaXVzOwogICAgfQogIH0KICBzZXRWZXJ0aWNhbENvcm5lclJhZGl1cyhyYWRpdXMpIHsKICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHJhZGl1cykpIHsKICAgICAgdGhpcy52ZXJ0aWNhbENvcm5lclJhZGl1cyA9IHJhZGl1czsKICAgIH0KICB9Cn0KY2xhc3MgTWFya3VwQW5ub3RhdGlvbiBleHRlbmRzIEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IHBhcmFtczsKICAgIGlmIChkaWN0LmhhcygiSVJUIikpIHsKICAgICAgY29uc3QgcmF3SVJUID0gZGljdC5nZXRSYXcoIklSVCIpOwogICAgICB0aGlzLmRhdGEuaW5SZXBseVRvID0gcmF3SVJUIGluc3RhbmNlb2YgUmVmID8gcmF3SVJULnRvU3RyaW5nKCkgOiBudWxsOwogICAgICBjb25zdCBydCA9IGRpY3QuZ2V0KCJSVCIpOwogICAgICB0aGlzLmRhdGEucmVwbHlUeXBlID0gcnQgaW5zdGFuY2VvZiBOYW1lID8gcnQubmFtZSA6IEFubm90YXRpb25SZXBseVR5cGUuUkVQTFk7CiAgICB9CiAgICBsZXQgcG9wdXBSZWYgPSBudWxsOwogICAgaWYgKHRoaXMuZGF0YS5yZXBseVR5cGUgPT09IEFubm90YXRpb25SZXBseVR5cGUuR1JPVVApIHsKICAgICAgY29uc3QgcGFyZW50ID0gZGljdC5nZXQoIklSVCIpOwogICAgICB0aGlzLnNldFRpdGxlKHBhcmVudC5nZXQoIlQiKSk7CiAgICAgIHRoaXMuZGF0YS50aXRsZU9iaiA9IHRoaXMuX3RpdGxlOwogICAgICB0aGlzLnNldENvbnRlbnRzKHBhcmVudC5nZXQoIkNvbnRlbnRzIikpOwogICAgICB0aGlzLmRhdGEuY29udGVudHNPYmogPSB0aGlzLl9jb250ZW50czsKICAgICAgaWYgKCFwYXJlbnQuaGFzKCJDcmVhdGlvbkRhdGUiKSkgewogICAgICAgIHRoaXMuZGF0YS5jcmVhdGlvbkRhdGUgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2V0Q3JlYXRpb25EYXRlKHBhcmVudC5nZXQoIkNyZWF0aW9uRGF0ZSIpKTsKICAgICAgICB0aGlzLmRhdGEuY3JlYXRpb25EYXRlID0gdGhpcy5jcmVhdGlvbkRhdGU7CiAgICAgIH0KICAgICAgaWYgKCFwYXJlbnQuaGFzKCJNIikpIHsKICAgICAgICB0aGlzLmRhdGEubW9kaWZpY2F0aW9uRGF0ZSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRNb2RpZmljYXRpb25EYXRlKHBhcmVudC5nZXQoIk0iKSk7CiAgICAgICAgdGhpcy5kYXRhLm1vZGlmaWNhdGlvbkRhdGUgPSB0aGlzLm1vZGlmaWNhdGlvbkRhdGU7CiAgICAgIH0KICAgICAgcG9wdXBSZWYgPSBwYXJlbnQuZ2V0UmF3KCJQb3B1cCIpOwogICAgICBpZiAoIXBhcmVudC5oYXMoIkMiKSkgewogICAgICAgIHRoaXMuZGF0YS5jb2xvciA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRDb2xvcihwYXJlbnQuZ2V0QXJyYXkoIkMiKSk7CiAgICAgICAgdGhpcy5kYXRhLmNvbG9yID0gdGhpcy5jb2xvcjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnRpdGxlT2JqID0gdGhpcy5fdGl0bGU7CiAgICAgIHRoaXMuc2V0Q3JlYXRpb25EYXRlKGRpY3QuZ2V0KCJDcmVhdGlvbkRhdGUiKSk7CiAgICAgIHRoaXMuZGF0YS5jcmVhdGlvbkRhdGUgPSB0aGlzLmNyZWF0aW9uRGF0ZTsKICAgICAgcG9wdXBSZWYgPSBkaWN0LmdldFJhdygiUG9wdXAiKTsKICAgICAgaWYgKCFkaWN0LmhhcygiQyIpKSB7CiAgICAgICAgdGhpcy5kYXRhLmNvbG9yID0gbnVsbDsKICAgICAgfQogICAgfQogICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gcG9wdXBSZWYgaW5zdGFuY2VvZiBSZWYgPyBwb3B1cFJlZi50b1N0cmluZygpIDogbnVsbDsKICAgIGlmIChkaWN0LmhhcygiUkMiKSkgewogICAgICB0aGlzLmRhdGEucmljaFRleHQgPSBYRkFGYWN0b3J5LmdldFJpY2hUZXh0QXNIdG1sKGRpY3QuZ2V0KCJSQyIpKTsKICAgIH0KICB9CiAgc2V0Q3JlYXRpb25EYXRlKGNyZWF0aW9uRGF0ZSkgewogICAgdGhpcy5jcmVhdGlvbkRhdGUgPSB0eXBlb2YgY3JlYXRpb25EYXRlID09PSAic3RyaW5nIiA/IGNyZWF0aW9uRGF0ZSA6IG51bGw7CiAgfQogIF9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICB4cmVmLAogICAgZXh0cmEsCiAgICBzdHJva2VDb2xvciwKICAgIGZpbGxDb2xvciwKICAgIGJsZW5kTW9kZSwKICAgIHN0cm9rZUFscGhhLAogICAgZmlsbEFscGhhLAogICAgcG9pbnRzQ2FsbGJhY2sKICB9KSB7CiAgICBjb25zdCBiYm94ID0gdGhpcy5kYXRhLnJlY3QgPSBbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV07CiAgICBjb25zdCBidWZmZXIgPSBbInEiXTsKICAgIGlmIChleHRyYSkgewogICAgICBidWZmZXIucHVzaChleHRyYSk7CiAgICB9CiAgICBpZiAoc3Ryb2tlQ29sb3IpIHsKICAgICAgYnVmZmVyLnB1c2goYCR7c3Ryb2tlQ29sb3JbMF19ICR7c3Ryb2tlQ29sb3JbMV19ICR7c3Ryb2tlQ29sb3JbMl19IFJHYCk7CiAgICB9CiAgICBpZiAoZmlsbENvbG9yKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGAke2ZpbGxDb2xvclswXX0gJHtmaWxsQ29sb3JbMV19ICR7ZmlsbENvbG9yWzJdfSByZ2ApOwogICAgfQogICAgY29uc3QgcG9pbnRzQXJyYXkgPSB0aGlzLmRhdGEucXVhZFBvaW50cyB8fCBGbG9hdDMyQXJyYXkuZnJvbShbdGhpcy5yZWN0YW5nbGVbMF0sIHRoaXMucmVjdGFuZ2xlWzNdLCB0aGlzLnJlY3RhbmdsZVsyXSwgdGhpcy5yZWN0YW5nbGVbM10sIHRoaXMucmVjdGFuZ2xlWzBdLCB0aGlzLnJlY3RhbmdsZVsxXSwgdGhpcy5yZWN0YW5nbGVbMl0sIHRoaXMucmVjdGFuZ2xlWzFdXSk7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBwb2ludHNBcnJheS5sZW5ndGg7IGkgPCBpaTsgaSArPSA4KSB7CiAgICAgIGNvbnN0IHBvaW50cyA9IHBvaW50c0NhbGxiYWNrKGJ1ZmZlciwgcG9pbnRzQXJyYXkuc3ViYXJyYXkoaSwgaSArIDgpKTsKICAgICAgVXRpbC5yZWN0Qm91bmRpbmdCb3goLi4ucG9pbnRzLCBiYm94KTsKICAgIH0KICAgIGJ1ZmZlci5wdXNoKCJRIik7CiAgICBjb25zdCBmb3JtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbShidWZmZXIuam9pbigiICIpKTsKICAgIGFwcGVhcmFuY2VTdHJlYW0uZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgZm9ybURpY3Quc2V0KCJGbTAiLCBhcHBlYXJhbmNlU3RyZWFtKTsKICAgIGNvbnN0IGdzRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgaWYgKGJsZW5kTW9kZSkgewogICAgICBnc0RpY3Quc2V0SWZOYW1lKCJCTSIsIGJsZW5kTW9kZSk7CiAgICB9CiAgICBnc0RpY3Quc2V0SWZOdW1iZXIoIkNBIiwgc3Ryb2tlQWxwaGEpOwogICAgZ3NEaWN0LnNldElmTnVtYmVyKCJjYSIsIGZpbGxBbHBoYSk7CiAgICBjb25zdCBzdGF0ZURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIHN0YXRlRGljdC5zZXQoIkdTMCIsIGdzRGljdCk7CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgRGljdCh4cmVmKTsKICAgIHJlc291cmNlcy5zZXQoIkV4dEdTdGF0ZSIsIHN0YXRlRGljdCk7CiAgICByZXNvdXJjZXMuc2V0KCJYT2JqZWN0IiwgZm9ybURpY3QpOwogICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VEaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGFwcGVhcmFuY2VEaWN0LnNldCgiQkJveCIsIGJib3gpOwogICAgdGhpcy5hcHBlYXJhbmNlID0gbmV3IFN0cmluZ1N0cmVhbSgiL0dTMCBncyAvRm0wIERvIik7CiAgICB0aGlzLmFwcGVhcmFuY2UuZGljdCA9IGFwcGVhcmFuY2VEaWN0OwogICAgdGhpcy5fc3RyZWFtcy5wdXNoKHRoaXMuYXBwZWFyYW5jZSwgYXBwZWFyYW5jZVN0cmVhbSk7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGNoYW5nZXMsIHBhcmFtcykgewogICAgY29uc3QgYW5ub3RhdGlvblJlZiA9IGFubm90YXRpb24ucmVmIHx8PSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgY29uc3QgYXAgPSBhd2FpdCB0aGlzLmNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKTsKICAgIGxldCBhbm5vdGF0aW9uRGljdDsKICAgIGlmIChhcCkgewogICAgICBjb25zdCBhcFJlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIGFubm90YXRpb25EaWN0ID0gdGhpcy5jcmVhdGVOZXdEaWN0KGFubm90YXRpb24sIHhyZWYsIHsKICAgICAgICBhcFJlZgogICAgICB9KTsKICAgICAgY2hhbmdlcy5wdXQoYXBSZWYsIHsKICAgICAgICBkYXRhOiBhcAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGFubm90YXRpb25EaWN0ID0gdGhpcy5jcmVhdGVOZXdEaWN0KGFubm90YXRpb24sIHhyZWYsIHt9KTsKICAgIH0KICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGFubm90YXRpb24ucGFyZW50VHJlZUlkKSkgewogICAgICBhbm5vdGF0aW9uRGljdC5zZXQoIlN0cnVjdFBhcmVudCIsIGFubm90YXRpb24ucGFyZW50VHJlZUlkKTsKICAgIH0KICAgIGNoYW5nZXMucHV0KGFubm90YXRpb25SZWYsIHsKICAgICAgZGF0YTogYW5ub3RhdGlvbkRpY3QKICAgIH0pOwogICAgY29uc3QgcmV0UmVmID0gewogICAgICByZWY6IGFubm90YXRpb25SZWYKICAgIH07CiAgICBjb25zdCB7CiAgICAgIHBvcHVwCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGlmIChwb3B1cCkgewogICAgICBpZiAocG9wdXAuZGVsZXRlZCkgewogICAgICAgIGFubm90YXRpb25EaWN0LmRlbGV0ZSgiUG9wdXAiKTsKICAgICAgICBhbm5vdGF0aW9uRGljdC5kZWxldGUoIkNvbnRlbnRzIik7CiAgICAgICAgYW5ub3RhdGlvbkRpY3QuZGVsZXRlKCJSQyIpOwogICAgICAgIHJldHVybiByZXRSZWY7CiAgICAgIH0KICAgICAgY29uc3QgcG9wdXBSZWYgPSBwb3B1cC5yZWYgfHw9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIHBvcHVwLnBhcmVudCA9IGFubm90YXRpb25SZWY7CiAgICAgIGNvbnN0IHBvcHVwRGljdCA9IFBvcHVwQW5ub3RhdGlvbi5jcmVhdGVOZXdEaWN0KHBvcHVwLCB4cmVmKTsKICAgICAgY2hhbmdlcy5wdXQocG9wdXBSZWYsIHsKICAgICAgICBkYXRhOiBwb3B1cERpY3QKICAgICAgfSk7CiAgICAgIGFubm90YXRpb25EaWN0LnNldElmRGVmaW5lZCgiQ29udGVudHMiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHBvcHVwLmNvbnRlbnRzKSk7CiAgICAgIGFubm90YXRpb25EaWN0LnNldCgiUG9wdXAiLCBwb3B1cFJlZik7CiAgICAgIHJldHVybiBbcmV0UmVmLCB7CiAgICAgICAgcmVmOiBwb3B1cFJlZgogICAgICB9XTsKICAgIH0KICAgIHJldHVybiByZXRSZWY7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHBhcmFtcykgewogICAgY29uc3QgYXAgPSBhd2FpdCB0aGlzLmNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKTsKICAgIGNvbnN0IGFubm90YXRpb25EaWN0ID0gdGhpcy5jcmVhdGVOZXdEaWN0KGFubm90YXRpb24sIHhyZWYsIGFwID8gewogICAgICBhcAogICAgfSA6IHt9KTsKICAgIGNvbnN0IG5ld0Fubm90YXRpb24gPSBuZXcgdGhpcy5wcm90b3R5cGUuY29uc3RydWN0b3IoewogICAgICBkaWN0OiBhbm5vdGF0aW9uRGljdCwKICAgICAgeHJlZiwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMsCiAgICAgIGV2YWx1YXRvck9wdGlvbnM6IHBhcmFtcy5ldmFsdWF0b3JPcHRpb25zCiAgICB9KTsKICAgIGlmIChhbm5vdGF0aW9uLnJlZikgewogICAgICBuZXdBbm5vdGF0aW9uLnJlZiA9IG5ld0Fubm90YXRpb24ucmVmVG9SZXBsYWNlID0gYW5ub3RhdGlvbi5yZWY7CiAgICB9CiAgICByZXR1cm4gbmV3QW5ub3RhdGlvbjsKICB9Cn0KY2xhc3MgV2lkZ2V0QW5ub3RhdGlvbiBleHRlbmRzIEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZiwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgdGhpcy5fbmVlZEFwcGVhcmFuY2VzID0gcGFyYW1zLm5lZWRBcHBlYXJhbmNlczsKICAgIGRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5XSURHRVQ7CiAgICBpZiAoZGF0YS5maWVsZE5hbWUgPT09IHVuZGVmaW5lZCkgewogICAgICBkYXRhLmZpZWxkTmFtZSA9IHRoaXMuX2NvbnN0cnVjdEZpZWxkTmFtZShkaWN0KTsKICAgIH0KICAgIGlmIChkYXRhLmFjdGlvbnMgPT09IHVuZGVmaW5lZCkgewogICAgICBkYXRhLmFjdGlvbnMgPSBjb2xsZWN0QWN0aW9ucyh4cmVmLCBkaWN0LCBBbm5vdGF0aW9uQWN0aW9uRXZlbnRUeXBlKTsKICAgIH0KICAgIGxldCBmaWVsZFZhbHVlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIlYiLAogICAgICBnZXRBcnJheTogdHJ1ZQogICAgfSk7CiAgICBkYXRhLmZpZWxkVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoZmllbGRWYWx1ZSk7CiAgICBjb25zdCBkZWZhdWx0RmllbGRWYWx1ZSA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJEViIsCiAgICAgIGdldEFycmF5OiB0cnVlCiAgICB9KTsKICAgIGRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoZGVmYXVsdEZpZWxkVmFsdWUpOwogICAgaWYgKGZpZWxkVmFsdWUgPT09IHVuZGVmaW5lZCAmJiBhbm5vdGF0aW9uR2xvYmFscy54ZmFEYXRhc2V0cykgewogICAgICBjb25zdCBwYXRoID0gdGhpcy5fdGl0bGUuc3RyOwogICAgICBpZiAocGF0aCkgewogICAgICAgIHRoaXMuX2hhc1ZhbHVlRnJvbVhGQSA9IHRydWU7CiAgICAgICAgZGF0YS5maWVsZFZhbHVlID0gZmllbGRWYWx1ZSA9IGFubm90YXRpb25HbG9iYWxzLnhmYURhdGFzZXRzLmdldFZhbHVlKHBhdGgpOwogICAgICB9CiAgICB9CiAgICBpZiAoZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkICYmIGRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgIT09IG51bGwpIHsKICAgICAgZGF0YS5maWVsZFZhbHVlID0gZGF0YS5kZWZhdWx0RmllbGRWYWx1ZTsKICAgIH0KICAgIGRhdGEuYWx0ZXJuYXRpdmVUZXh0ID0gc3RyaW5nVG9QREZTdHJpbmcoZGljdC5nZXQoIlRVIikgfHwgIiIpOwogICAgdGhpcy5zZXREZWZhdWx0QXBwZWFyYW5jZShwYXJhbXMpOwogICAgZGF0YS5oYXNBcHBlYXJhbmNlIHx8PSB0aGlzLl9uZWVkQXBwZWFyYW5jZXMgJiYgZGF0YS5maWVsZFZhbHVlICE9PSB1bmRlZmluZWQgJiYgZGF0YS5maWVsZFZhbHVlICE9PSBudWxsOwogICAgY29uc3QgZmllbGRUeXBlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkZUIgogICAgfSk7CiAgICBkYXRhLmZpZWxkVHlwZSA9IGZpZWxkVHlwZSBpbnN0YW5jZW9mIE5hbWUgPyBmaWVsZFR5cGUubmFtZSA6IG51bGw7CiAgICBjb25zdCBsb2NhbFJlc291cmNlcyA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJEUiIKICAgIH0pOwogICAgY29uc3QgYWNyb0Zvcm1SZXNvdXJjZXMgPSBhbm5vdGF0aW9uR2xvYmFscy5hY3JvRm9ybS5nZXQoIkRSIik7CiAgICBjb25zdCBhcHBlYXJhbmNlUmVzb3VyY2VzID0gdGhpcy5hcHBlYXJhbmNlPy5kaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICB0aGlzLl9maWVsZFJlc291cmNlcyA9IHsKICAgICAgbG9jYWxSZXNvdXJjZXMsCiAgICAgIGFjcm9Gb3JtUmVzb3VyY2VzLAogICAgICBhcHBlYXJhbmNlUmVzb3VyY2VzLAogICAgICBtZXJnZWRSZXNvdXJjZXM6IERpY3QubWVyZ2UoewogICAgICAgIHhyZWYsCiAgICAgICAgZGljdEFycmF5OiBbbG9jYWxSZXNvdXJjZXMsIGFwcGVhcmFuY2VSZXNvdXJjZXMsIGFjcm9Gb3JtUmVzb3VyY2VzXSwKICAgICAgICBtZXJnZVN1YkRpY3RzOiB0cnVlCiAgICAgIH0pCiAgICB9OwogICAgZGF0YS5maWVsZEZsYWdzID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkZmIgogICAgfSk7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZGF0YS5maWVsZEZsYWdzKSB8fCBkYXRhLmZpZWxkRmxhZ3MgPCAwKSB7CiAgICAgIGRhdGEuZmllbGRGbGFncyA9IDA7CiAgICB9CiAgICBkYXRhLnBhc3N3b3JkID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5QQVNTV09SRCk7CiAgICBkYXRhLnJlYWRPbmx5ID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5SRUFET05MWSk7CiAgICBkYXRhLnJlcXVpcmVkID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5SRVFVSVJFRCk7CiAgICBkYXRhLmhpZGRlbiA9IHRoaXMuX2hhc0ZsYWcoZGF0YS5hbm5vdGF0aW9uRmxhZ3MsIEFubm90YXRpb25GbGFnLkhJRERFTikgfHwgdGhpcy5faGFzRmxhZyhkYXRhLmFubm90YXRpb25GbGFncywgQW5ub3RhdGlvbkZsYWcuTk9WSUVXKTsKICB9CiAgX2RlY29kZUZvcm1WYWx1ZShmb3JtVmFsdWUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGZvcm1WYWx1ZSkpIHsKICAgICAgcmV0dXJuIGZvcm1WYWx1ZS5maWx0ZXIoaXRlbSA9PiB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpLm1hcChpdGVtID0+IHN0cmluZ1RvUERGU3RyaW5nKGl0ZW0pKTsKICAgIH0gZWxzZSBpZiAoZm9ybVZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICByZXR1cm4gc3RyaW5nVG9QREZTdHJpbmcoZm9ybVZhbHVlLm5hbWUpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgZm9ybVZhbHVlID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gc3RyaW5nVG9QREZTdHJpbmcoZm9ybVZhbHVlKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBoYXNGaWVsZEZsYWcoZmxhZykgewogICAgcmV0dXJuICEhKHRoaXMuZGF0YS5maWVsZEZsYWdzICYgZmxhZyk7CiAgfQogIF9pc1ZpZXdhYmxlKGZsYWdzKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgbXVzdEJlVmlld2VkKGFubm90YXRpb25TdG9yYWdlLCByZW5kZXJGb3JtcykgewogICAgaWYgKHJlbmRlckZvcm1zKSB7CiAgICAgIHJldHVybiB0aGlzLnZpZXdhYmxlOwogICAgfQogICAgcmV0dXJuIHN1cGVyLm11c3RCZVZpZXdlZChhbm5vdGF0aW9uU3RvcmFnZSwgcmVuZGVyRm9ybXMpICYmICF0aGlzLl9oYXNGbGFnKHRoaXMuZmxhZ3MsIEFubm90YXRpb25GbGFnLk5PVklFVyk7CiAgfQogIGdldFJvdGF0aW9uTWF0cml4KGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBsZXQgcm90YXRpb24gPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk/LnJvdGF0aW9uOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgcmV0dXJuIHJvdGF0aW9uID09PSAwID8gSURFTlRJVFlfTUFUUklYIDogZ2V0Um90YXRpb25NYXRyaXgocm90YXRpb24sIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKICB9CiAgZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBsZXQgcm90YXRpb24gPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk/LnJvdGF0aW9uOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgaWYgKCF0aGlzLmJhY2tncm91bmRDb2xvciAmJiAhdGhpcy5ib3JkZXJDb2xvcikgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCByZWN0ID0gcm90YXRpb24gPT09IDAgfHwgcm90YXRpb24gPT09IDE4MCA/IGAwIDAgJHt0aGlzLndpZHRofSAke3RoaXMuaGVpZ2h0fSByZWAgOiBgMCAwICR7dGhpcy5oZWlnaHR9ICR7dGhpcy53aWR0aH0gcmVgOwogICAgbGV0IHN0ciA9ICIiOwogICAgaWYgKHRoaXMuYmFja2dyb3VuZENvbG9yKSB7CiAgICAgIHN0ciA9IGAke2dldFBkZkNvbG9yKHRoaXMuYmFja2dyb3VuZENvbG9yLCB0cnVlKX0gJHtyZWN0fSBmIGA7CiAgICB9CiAgICBpZiAodGhpcy5ib3JkZXJDb2xvcikgewogICAgICBjb25zdCBib3JkZXJXaWR0aCA9IHRoaXMuYm9yZGVyU3R5bGUud2lkdGggfHwgMTsKICAgICAgc3RyICs9IGAke2JvcmRlcldpZHRofSB3ICR7Z2V0UGRmQ29sb3IodGhpcy5ib3JkZXJDb2xvciwgZmFsc2UpfSAke3JlY3R9IFMgYDsKICAgIH0KICAgIHJldHVybiBzdHI7CiAgfQogIGFzeW5jIGdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGlmIChpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkFOTk9UQVRJT05TX0ZPUk1TICYmICEodGhpcyBpbnN0YW5jZW9mIFNpZ25hdHVyZVdpZGdldEFubm90YXRpb24pICYmICF0aGlzLmRhdGEubm9IVE1MICYmICF0aGlzLmRhdGEuaGFzT3duQ2FudmFzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3BMaXN0OiBuZXcgT3BlcmF0b3JMaXN0KCksCiAgICAgICAgc2VwYXJhdGVGb3JtOiB0cnVlLAogICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICB9OwogICAgfQogICAgaWYgKCF0aGlzLl9oYXNUZXh0KSB7CiAgICAgIHJldHVybiBzdXBlci5nZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLl9nZXRBcHBlYXJhbmNlKGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICBpZiAodGhpcy5hcHBlYXJhbmNlICYmIGNvbnRlbnQgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgY29uc3Qgb3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgaWYgKCF0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSB8fCBjb250ZW50ID09PSBudWxsKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3BMaXN0LAogICAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgICAgc2VwYXJhdGVDYW52YXM6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBpc1VzaW5nT3duQ2FudmFzID0gISEodGhpcy5kYXRhLmhhc093bkNhbnZhcyAmJiBpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkRJU1BMQVkpOwogICAgY29uc3QgbWF0cml4ID0gWzEsIDAsIDAsIDEsIDAsIDBdOwogICAgY29uc3QgYmJveCA9IFswLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodF07CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBnZXRUcmFuc2Zvcm1NYXRyaXgodGhpcy5kYXRhLnJlY3QsIGJib3gsIG1hdHJpeCk7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKHRoaXMub2MpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgZXZhbHVhdG9yLnBhcnNlTWFya2VkQ29udGVudFByb3BzKHRoaXMub2MsIG51bGwpOwogICAgfQogICAgaWYgKG9wdGlvbmFsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG9wTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBvcHRpb25hbENvbnRlbnRdKTsKICAgIH0KICAgIG9wTGlzdC5hZGRPcChPUFMuYmVnaW5Bbm5vdGF0aW9uLCBbdGhpcy5kYXRhLmlkLCB0aGlzLmRhdGEucmVjdCwgdHJhbnNmb3JtLCB0aGlzLmdldFJvdGF0aW9uTWF0cml4KGFubm90YXRpb25TdG9yYWdlKSwgaXNVc2luZ093bkNhbnZhc10pOwogICAgY29uc3Qgc3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbShjb250ZW50KTsKICAgIGF3YWl0IGV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICBzdHJlYW0sCiAgICAgIHRhc2ssCiAgICAgIHJlc291cmNlczogdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzLAogICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdAogICAgfSk7CiAgICBvcExpc3QuYWRkT3AoT1BTLmVuZEFubm90YXRpb24sIFtdKTsKICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcExpc3QuYWRkT3AoT1BTLmVuZE1hcmtlZENvbnRlbnQsIFtdKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG9wTGlzdCwKICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgc2VwYXJhdGVDYW52YXM6IGlzVXNpbmdPd25DYW52YXMKICAgIH07CiAgfQogIF9nZXRNS0RpY3Qocm90YXRpb24pIHsKICAgIGNvbnN0IG1rID0gbmV3IERpY3QobnVsbCk7CiAgICBpZiAocm90YXRpb24pIHsKICAgICAgbWsuc2V0KCJSIiwgcm90YXRpb24pOwogICAgfQogICAgbWsuc2V0SWZBcnJheSgiQkMiLCBnZXRQZGZDb2xvckFycmF5KHRoaXMuYm9yZGVyQ29sb3IpKTsKICAgIG1rLnNldElmQXJyYXkoIkJHIiwgZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmJhY2tncm91bmRDb2xvcikpOwogICAgcmV0dXJuIG1rLnNpemUgPiAwID8gbWsgOiBudWxsOwogIH0KICBhbWVuZFNhdmVkRGljdChhbm5vdGF0aW9uU3RvcmFnZSwgZGljdCkge30KICBzZXRWYWx1ZShkaWN0LCB2YWx1ZSwgeHJlZiwgY2hhbmdlcykgewogICAgY29uc3QgewogICAgICBkaWN0OiBwYXJlbnREaWN0LAogICAgICByZWY6IHBhcmVudFJlZgogICAgfSA9IGdldFBhcmVudFRvVXBkYXRlKGRpY3QsIHRoaXMucmVmLCB4cmVmKTsKICAgIGlmICghcGFyZW50RGljdCkgewogICAgICBkaWN0LnNldCgiViIsIHZhbHVlKTsKICAgIH0gZWxzZSBpZiAoIWNoYW5nZXMuaGFzKHBhcmVudFJlZikpIHsKICAgICAgY29uc3QgbmV3UGFyZW50RGljdCA9IHBhcmVudERpY3QuY2xvbmUoKTsKICAgICAgbmV3UGFyZW50RGljdC5zZXQoIlYiLCB2YWx1ZSk7CiAgICAgIGNoYW5nZXMucHV0KHBhcmVudFJlZiwgewogICAgICAgIGRhdGE6IG5ld1BhcmVudERpY3QKICAgICAgfSk7CiAgICAgIHJldHVybiBuZXdQYXJlbnREaWN0OwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGFzeW5jIHNhdmUoZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcykgewogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpOwogICAgY29uc3QgZmxhZ3MgPSB0aGlzLl9idWlsZEZsYWdzKHN0b3JhZ2VFbnRyeT8ubm9WaWV3LCBzdG9yYWdlRW50cnk/Lm5vUHJpbnQpOwogICAgbGV0IHZhbHVlID0gc3RvcmFnZUVudHJ5Py52YWx1ZSwKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnk/LnJvdGF0aW9uOwogICAgaWYgKHZhbHVlID09PSB0aGlzLmRhdGEuZmllbGRWYWx1ZSB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICghdGhpcy5faGFzVmFsdWVGcm9tWEZBICYmIHJvdGF0aW9uID09PSB1bmRlZmluZWQgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YWx1ZSB8fD0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiAhdGhpcy5faGFzVmFsdWVGcm9tWEZBICYmIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIEFycmF5LmlzQXJyYXkodGhpcy5kYXRhLmZpZWxkVmFsdWUpICYmIGlzQXJyYXlFcXVhbCh2YWx1ZSwgdGhpcy5kYXRhLmZpZWxkVmFsdWUpICYmIGZsYWdzID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgbGV0IGFwcGVhcmFuY2UgPSBudWxsOwogICAgaWYgKCF0aGlzLl9uZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgYXBwZWFyYW5jZSA9IGF3YWl0IHRoaXMuX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBSZW5kZXJpbmdJbnRlbnRGbGFnLlNBVkUsIGFubm90YXRpb25TdG9yYWdlKTsKICAgICAgaWYgKGFwcGVhcmFuY2UgPT09IG51bGwgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHt9CiAgICBsZXQgbmVlZEFwcGVhcmFuY2VzID0gZmFsc2U7CiAgICBpZiAoYXBwZWFyYW5jZT8ubmVlZEFwcGVhcmFuY2VzKSB7CiAgICAgIG5lZWRBcHBlYXJhbmNlcyA9IHRydWU7CiAgICAgIGFwcGVhcmFuY2UgPSBudWxsOwogICAgfQogICAgY29uc3QgewogICAgICB4cmVmCiAgICB9ID0gZXZhbHVhdG9yOwogICAgY29uc3Qgb3JpZ2luYWxEaWN0ID0geHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKG9yaWdpbmFsRGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGZvciAoY29uc3Qga2V5IG9mIG9yaWdpbmFsRGljdC5nZXRLZXlzKCkpIHsKICAgICAgaWYgKGtleSAhPT0gIkFQIikgewogICAgICAgIGRpY3Quc2V0KGtleSwgb3JpZ2luYWxEaWN0LmdldFJhdyhrZXkpKTsKICAgICAgfQogICAgfQogICAgaWYgKGZsYWdzICE9PSB1bmRlZmluZWQpIHsKICAgICAgZGljdC5zZXQoIkYiLCBmbGFncyk7CiAgICAgIGlmIChhcHBlYXJhbmNlID09PSBudWxsICYmICFuZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgICBjb25zdCBhcCA9IG9yaWdpbmFsRGljdC5nZXRSYXcoIkFQIik7CiAgICAgICAgaWYgKGFwKSB7CiAgICAgICAgICBkaWN0LnNldCgiQVAiLCBhcCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCB4ZmEgPSB7CiAgICAgIHBhdGg6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHZhbHVlCiAgICB9OwogICAgY29uc3QgbmV3UGFyZW50RGljdCA9IHRoaXMuc2V0VmFsdWUoZGljdCwgQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAoc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRSkgOiBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHZhbHVlKSwgeHJlZiwgY2hhbmdlcyk7CiAgICB0aGlzLmFtZW5kU2F2ZWREaWN0KGFubm90YXRpb25TdG9yYWdlLCBuZXdQYXJlbnREaWN0IHx8IGRpY3QpOwogICAgY29uc3QgbWF5YmVNSyA9IHRoaXMuX2dldE1LRGljdChyb3RhdGlvbik7CiAgICBpZiAobWF5YmVNSykgewogICAgICBkaWN0LnNldCgiTUsiLCBtYXliZU1LKTsKICAgIH0KICAgIGNoYW5nZXMucHV0KHRoaXMucmVmLCB7CiAgICAgIGRhdGE6IGRpY3QsCiAgICAgIHhmYSwKICAgICAgbmVlZEFwcGVhcmFuY2VzCiAgICB9KTsKICAgIGlmIChhcHBlYXJhbmNlICE9PSBudWxsKSB7CiAgICAgIGNvbnN0IG5ld1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIGNvbnN0IEFQID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGRpY3Quc2V0KCJBUCIsIEFQKTsKICAgICAgQVAuc2V0KCJOIiwgbmV3UmVmKTsKICAgICAgY29uc3QgcmVzb3VyY2VzID0gdGhpcy5fZ2V0U2F2ZUZpZWxkUmVzb3VyY2VzKHhyZWYpOwogICAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSBhcHBlYXJhbmNlU3RyZWFtLmRpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgICBjb25zdCBiYm94ID0gcm90YXRpb24gJSAxODAgPT09IDAgPyBbMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdIDogWzAsIDAsIHRoaXMuaGVpZ2h0LCB0aGlzLndpZHRoXTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJCQm94IiwgYmJveCk7CiAgICAgIGNvbnN0IHJvdGF0aW9uTWF0cml4ID0gdGhpcy5nZXRSb3RhdGlvbk1hdHJpeChhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICAgIGlmIChyb3RhdGlvbk1hdHJpeCAhPT0gSURFTlRJVFlfTUFUUklYKSB7CiAgICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJNYXRyaXgiLCByb3RhdGlvbk1hdHJpeCk7CiAgICAgIH0KICAgICAgY2hhbmdlcy5wdXQobmV3UmVmLCB7CiAgICAgICAgZGF0YTogYXBwZWFyYW5jZVN0cmVhbSwKICAgICAgICB4ZmE6IG51bGwsCiAgICAgICAgbmVlZEFwcGVhcmFuY2VzOiBmYWxzZQogICAgICB9KTsKICAgIH0KICAgIGRpY3Quc2V0KCJNIiwgYEQ6JHtnZXRNb2RpZmljYXRpb25EYXRlKCl9YCk7CiAgfQogIGFzeW5jIF9nZXRBcHBlYXJhbmNlKGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgaWYgKHRoaXMuZGF0YS5wYXNzd29yZCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKTsKICAgIGxldCB2YWx1ZSwgcm90YXRpb247CiAgICBpZiAoc3RvcmFnZUVudHJ5KSB7CiAgICAgIHZhbHVlID0gc3RvcmFnZUVudHJ5LmZvcm1hdHRlZFZhbHVlIHx8IHN0b3JhZ2VFbnRyeS52YWx1ZTsKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnkucm90YXRpb247CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkICYmICF0aGlzLl9uZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgaWYgKCF0aGlzLl9oYXNWYWx1ZUZyb21YRkEgfHwgdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31RIEVNQ2A7CiAgICAgIH0KICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgdmFsdWUgPSB2YWx1ZVswXTsKICAgIH0KICAgIGFzc2VydCh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciLCAiRXhwZWN0ZWQgYHZhbHVlYCB0byBiZSBhIHN0cmluZy4iKTsKICAgIHZhbHVlID0gdmFsdWUudHJpbUVuZCgpOwogICAgaWYgKHRoaXMuZGF0YS5jb21ibykgewogICAgICBjb25zdCBvcHRpb24gPSB0aGlzLmRhdGEub3B0aW9ucy5maW5kKCh7CiAgICAgICAgZXhwb3J0VmFsdWUKICAgICAgfSkgPT4gdmFsdWUgPT09IGV4cG9ydFZhbHVlKTsKICAgICAgdmFsdWUgPSBvcHRpb24/LmRpc3BsYXlWYWx1ZSB8fCB2YWx1ZTsKICAgIH0KICAgIGlmICh2YWx1ZSA9PT0gIiIpIHsKICAgICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9USBFTUNgOwogICAgfQogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgbGV0IGxpbmVDb3VudCA9IC0xOwogICAgbGV0IGxpbmVzOwogICAgaWYgKHRoaXMuZGF0YS5tdWx0aUxpbmUpIHsKICAgICAgbGluZXMgPSB2YWx1ZS5zcGxpdCgvXHJcbj98XG4vKS5tYXAobGluZSA9PiBsaW5lLm5vcm1hbGl6ZSgiTkZDIikpOwogICAgICBsaW5lQ291bnQgPSBsaW5lcy5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBsaW5lcyA9IFt2YWx1ZS5yZXBsYWNlKC9cclxuP3xcbi8sICIiKS5ub3JtYWxpemUoIk5GQyIpXTsKICAgIH0KICAgIGNvbnN0IGRlZmF1bHRQYWRkaW5nID0gMTsKICAgIGNvbnN0IGRlZmF1bHRIUGFkZGluZyA9IDI7CiAgICBsZXQgewogICAgICB3aWR0aDogdG90YWxXaWR0aCwKICAgICAgaGVpZ2h0OiB0b3RhbEhlaWdodAogICAgfSA9IHRoaXM7CiAgICBpZiAocm90YXRpb24gPT09IDkwIHx8IHJvdGF0aW9uID09PSAyNzApIHsKICAgICAgW3RvdGFsV2lkdGgsIHRvdGFsSGVpZ2h0XSA9IFt0b3RhbEhlaWdodCwgdG90YWxXaWR0aF07CiAgICB9CiAgICBpZiAoIXRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSBwYXJzZURlZmF1bHRBcHBlYXJhbmNlKHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlID0gIi9IZWx2ZXRpY2EgMCBUZiAwIGciKTsKICAgIH0KICAgIGxldCBmb250ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLCB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMpOwogICAgbGV0IGRlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgbGluZUhlaWdodDsKICAgIGNvbnN0IGVuY29kZWRMaW5lcyA9IFtdOwogICAgbGV0IGVuY29kaW5nRXJyb3IgPSBmYWxzZTsKICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykgewogICAgICBjb25zdCBlbmNvZGVkU3RyaW5nID0gZm9udC5lbmNvZGVTdHJpbmcobGluZSk7CiAgICAgIGlmIChlbmNvZGVkU3RyaW5nLmxlbmd0aCA+IDEpIHsKICAgICAgICBlbmNvZGluZ0Vycm9yID0gdHJ1ZTsKICAgICAgfQogICAgICBlbmNvZGVkTGluZXMucHVzaChlbmNvZGVkU3RyaW5nLmpvaW4oIiIpKTsKICAgIH0KICAgIGlmIChlbmNvZGluZ0Vycm9yICYmIGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuU0FWRSkgewogICAgICByZXR1cm4gewogICAgICAgIG5lZWRBcHBlYXJhbmNlczogdHJ1ZQogICAgICB9OwogICAgfQogICAgaWYgKGVuY29kaW5nRXJyb3IgJiYgdGhpcy5faXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgY29uc3QgZm9udEZhbWlseSA9IHRoaXMuZGF0YS5jb21iID8gIm1vbm9zcGFjZSIgOiAic2Fucy1zZXJpZiI7CiAgICAgIGNvbnN0IGZha2VVbmljb2RlRm9udCA9IG5ldyBGYWtlVW5pY29kZUZvbnQoZXZhbHVhdG9yLnhyZWYsIGZvbnRGYW1pbHkpOwogICAgICBjb25zdCByZXNvdXJjZXMgPSBmYWtlVW5pY29kZUZvbnQuY3JlYXRlRm9udFJlc291cmNlcyhsaW5lcy5qb2luKCIiKSk7CiAgICAgIGNvbnN0IG5ld0ZvbnQgPSByZXNvdXJjZXMuZ2V0UmF3KCJGb250Iik7CiAgICAgIGlmICh0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMuaGFzKCJGb250IikpIHsKICAgICAgICBjb25zdCBvbGRGb250ID0gdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgICAgIGZvciAoY29uc3Qga2V5IG9mIG5ld0ZvbnQuZ2V0S2V5cygpKSB7CiAgICAgICAgICBvbGRGb250LnNldChrZXksIG5ld0ZvbnQuZ2V0UmF3KGtleSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMuc2V0KCJGb250IiwgbmV3Rm9udCk7CiAgICAgIH0KICAgICAgY29uc3QgZm9udE5hbWUgPSBmYWtlVW5pY29kZUZvbnQuZm9udE5hbWUubmFtZTsKICAgICAgZm9udCA9IGF3YWl0IFdpZGdldEFubm90YXRpb24uX2dldEZvbnREYXRhKGV2YWx1YXRvciwgdGFzaywgewogICAgICAgIGZvbnROYW1lLAogICAgICAgIGZvbnRTaXplOiAwCiAgICAgIH0sIHJlc291cmNlcyk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGVuY29kZWRMaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgZW5jb2RlZExpbmVzW2ldID0gc3RyaW5nVG9VVEYxNlN0cmluZyhsaW5lc1tpXSk7CiAgICAgIH0KICAgICAgY29uc3Qgc2F2ZWREZWZhdWx0QXBwZWFyYW5jZSA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSk7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udFNpemUgPSAwOwogICAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLmZvbnROYW1lID0gZm9udE5hbWU7CiAgICAgIFtkZWZhdWx0QXBwZWFyYW5jZSwgZm9udFNpemUsIGxpbmVIZWlnaHRdID0gdGhpcy5fY29tcHV0ZUZvbnRTaXplKHRvdGFsSGVpZ2h0IC0gMiAqIGRlZmF1bHRQYWRkaW5nLCB0b3RhbFdpZHRoIC0gMiAqIGRlZmF1bHRIUGFkZGluZywgdmFsdWUsIGZvbnQsIGxpbmVDb3VudCk7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSBzYXZlZERlZmF1bHRBcHBlYXJhbmNlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCF0aGlzLl9pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICAgIHdhcm4oIl9nZXRBcHBlYXJhbmNlOiBPZmZzY3JlZW5DYW52YXMgaXMgbm90IHN1cHBvcnRlZCwgYW5ub3RhdGlvbiBtYXkgbm90IHJlbmRlciBjb3JyZWN0bHkuIik7CiAgICAgIH0KICAgICAgW2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgbGluZUhlaWdodF0gPSB0aGlzLl9jb21wdXRlRm9udFNpemUodG90YWxIZWlnaHQgLSAyICogZGVmYXVsdFBhZGRpbmcsIHRvdGFsV2lkdGggLSAyICogZGVmYXVsdEhQYWRkaW5nLCB2YWx1ZSwgZm9udCwgbGluZUNvdW50KTsKICAgIH0KICAgIGxldCBkZXNjZW50ID0gZm9udC5kZXNjZW50OwogICAgaWYgKGlzTmFOKGRlc2NlbnQpKSB7CiAgICAgIGRlc2NlbnQgPSBCQVNFTElORV9GQUNUT1IgKiBsaW5lSGVpZ2h0OwogICAgfSBlbHNlIHsKICAgICAgZGVzY2VudCA9IE1hdGgubWF4KEJBU0VMSU5FX0ZBQ1RPUiAqIGxpbmVIZWlnaHQsIE1hdGguYWJzKGRlc2NlbnQpICogZm9udFNpemUpOwogICAgfQogICAgY29uc3QgZGVmYXVsdFZQYWRkaW5nID0gTWF0aC5taW4oTWF0aC5mbG9vcigodG90YWxIZWlnaHQgLSBmb250U2l6ZSkgLyAyKSwgZGVmYXVsdFBhZGRpbmcpOwogICAgY29uc3QgYWxpZ25tZW50ID0gdGhpcy5kYXRhLnRleHRBbGlnbm1lbnQ7CiAgICBpZiAodGhpcy5kYXRhLm11bHRpTGluZSkgewogICAgICByZXR1cm4gdGhpcy5fZ2V0TXVsdGlsaW5lQXBwZWFyYW5jZShkZWZhdWx0QXBwZWFyYW5jZSwgZW5jb2RlZExpbmVzLCBmb250LCBmb250U2l6ZSwgdG90YWxXaWR0aCwgdG90YWxIZWlnaHQsIGFsaWdubWVudCwgZGVmYXVsdEhQYWRkaW5nLCBkZWZhdWx0VlBhZGRpbmcsIGRlc2NlbnQsIGxpbmVIZWlnaHQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGlmICh0aGlzLmRhdGEuY29tYikgewogICAgICByZXR1cm4gdGhpcy5fZ2V0Q29tYkFwcGVhcmFuY2UoZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnQsIGVuY29kZWRMaW5lc1swXSwgZm9udFNpemUsIHRvdGFsV2lkdGgsIHRvdGFsSGVpZ2h0LCBkZWZhdWx0SFBhZGRpbmcsIGRlZmF1bHRWUGFkZGluZywgZGVzY2VudCwgbGluZUhlaWdodCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgY29uc3QgYm90dG9tUGFkZGluZyA9IGRlZmF1bHRWUGFkZGluZyArIGRlc2NlbnQ7CiAgICBpZiAoYWxpZ25tZW50ID09PSAwIHx8IGFsaWdubWVudCA+IDIpIHsKICAgICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9QlQgYCArIGRlZmF1bHRBcHBlYXJhbmNlICsgYCAxIDAgMCAxICR7bnVtYmVyVG9TdHJpbmcoZGVmYXVsdEhQYWRkaW5nKX0gJHtudW1iZXJUb1N0cmluZyhib3R0b21QYWRkaW5nKX0gVG0gKCR7ZXNjYXBlU3RyaW5nKGVuY29kZWRMaW5lc1swXSl9KSBUamAgKyAiIEVUIFEgRU1DIjsKICAgIH0KICAgIGNvbnN0IHByZXZJbmZvID0gewogICAgICBzaGlmdDogMAogICAgfTsKICAgIGNvbnN0IHJlbmRlcmVkVGV4dCA9IHRoaXMuX3JlbmRlclRleHQoZW5jb2RlZExpbmVzWzBdLCBmb250LCBmb250U2l6ZSwgdG90YWxXaWR0aCwgYWxpZ25tZW50LCBwcmV2SW5mbywgZGVmYXVsdEhQYWRkaW5nLCBib3R0b21QYWRkaW5nKTsKICAgIHJldHVybiBgL1R4IEJNQyBxICR7Y29sb3JzfUJUIGAgKyBkZWZhdWx0QXBwZWFyYW5jZSArIGAgMSAwIDAgMSAwIDAgVG0gJHtyZW5kZXJlZFRleHR9YCArICIgRVQgUSBFTUMiOwogIH0KICBzdGF0aWMgYXN5bmMgX2dldEZvbnREYXRhKGV2YWx1YXRvciwgdGFzaywgYXBwZWFyYW5jZURhdGEsIHJlc291cmNlcykgewogICAgY29uc3Qgb3BlcmF0b3JMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgY29uc3QgaW5pdGlhbFN0YXRlID0gewogICAgICBmb250OiBudWxsLAogICAgICBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHsKICAgICAgZm9udE5hbWUsCiAgICAgIGZvbnRTaXplCiAgICB9ID0gYXBwZWFyYW5jZURhdGE7CiAgICBhd2FpdCBldmFsdWF0b3IuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIFtmb250TmFtZSAmJiBOYW1lLmdldChmb250TmFtZSksIGZvbnRTaXplXSwgbnVsbCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBpbml0aWFsU3RhdGUsIG51bGwpOwogICAgcmV0dXJuIGluaXRpYWxTdGF0ZS5mb250OwogIH0KICBfZ2V0VGV4dFdpZHRoKHRleHQsIGZvbnQpIHsKICAgIHJldHVybiBNYXRoLnN1bVByZWNpc2UoZm9udC5jaGFyc1RvR2x5cGhzKHRleHQpLm1hcChnID0+IGcud2lkdGgpKSAvIDEwMDA7CiAgfQogIF9jb21wdXRlRm9udFNpemUoaGVpZ2h0LCB3aWR0aCwgdGV4dCwgZm9udCwgbGluZUNvdW50KSB7CiAgICBsZXQgewogICAgICBmb250U2l6ZQogICAgfSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE7CiAgICBsZXQgbGluZUhlaWdodCA9IChmb250U2l6ZSB8fCAxMikgKiBMSU5FX0ZBQ1RPUiwKICAgICAgbnVtYmVyT2ZMaW5lcyA9IE1hdGgucm91bmQoaGVpZ2h0IC8gbGluZUhlaWdodCk7CiAgICBpZiAoIWZvbnRTaXplKSB7CiAgICAgIGNvbnN0IHJvdW5kV2l0aFR3b0RpZ2l0cyA9IHggPT4gTWF0aC5mbG9vcih4ICogMTAwKSAvIDEwMDsKICAgICAgaWYgKGxpbmVDb3VudCA9PT0gLTEpIHsKICAgICAgICBjb25zdCB0ZXh0V2lkdGggPSB0aGlzLl9nZXRUZXh0V2lkdGgodGV4dCwgZm9udCk7CiAgICAgICAgZm9udFNpemUgPSByb3VuZFdpdGhUd29EaWdpdHMoTWF0aC5taW4oaGVpZ2h0IC8gTElORV9GQUNUT1IsIHdpZHRoIC8gdGV4dFdpZHRoKSk7CiAgICAgICAgbnVtYmVyT2ZMaW5lcyA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KC9cclxuP3xcbi8pOwogICAgICAgIGNvbnN0IGNhY2hlZExpbmVzID0gW107CiAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7CiAgICAgICAgICBjb25zdCBlbmNvZGVkID0gZm9udC5lbmNvZGVTdHJpbmcobGluZSkuam9pbigiIik7CiAgICAgICAgICBjb25zdCBnbHlwaHMgPSBmb250LmNoYXJzVG9HbHlwaHMoZW5jb2RlZCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBmb250LmdldENoYXJQb3NpdGlvbnMoZW5jb2RlZCk7CiAgICAgICAgICBjYWNoZWRMaW5lcy5wdXNoKHsKICAgICAgICAgICAgbGluZTogZW5jb2RlZCwKICAgICAgICAgICAgZ2x5cGhzLAogICAgICAgICAgICBwb3NpdGlvbnMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBpc1Rvb0JpZyA9IGZzaXplID0+IHsKICAgICAgICAgIGxldCB0b3RhbEhlaWdodCA9IDA7CiAgICAgICAgICBmb3IgKGNvbnN0IGNhY2hlIG9mIGNhY2hlZExpbmVzKSB7CiAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX3NwbGl0TGluZShudWxsLCBmb250LCBmc2l6ZSwgd2lkdGgsIGNhY2hlKTsKICAgICAgICAgICAgdG90YWxIZWlnaHQgKz0gY2h1bmtzLmxlbmd0aCAqIGZzaXplOwogICAgICAgICAgICBpZiAodG90YWxIZWlnaHQgPiBoZWlnaHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CiAgICAgICAgbnVtYmVyT2ZMaW5lcyA9IE1hdGgubWF4KG51bWJlck9mTGluZXMsIGxpbmVDb3VudCk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGxpbmVIZWlnaHQgPSBoZWlnaHQgLyBudW1iZXJPZkxpbmVzOwogICAgICAgICAgZm9udFNpemUgPSByb3VuZFdpdGhUd29EaWdpdHMobGluZUhlaWdodCAvIExJTkVfRkFDVE9SKTsKICAgICAgICAgIGlmIChpc1Rvb0JpZyhmb250U2l6ZSkpIHsKICAgICAgICAgICAgbnVtYmVyT2ZMaW5lcysrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgZm9udE5hbWUsCiAgICAgICAgZm9udENvbG9yCiAgICAgIH0gPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhOwogICAgICB0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSA9IGNyZWF0ZURlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICBmb250U2l6ZSwKICAgICAgICBmb250TmFtZSwKICAgICAgICBmb250Q29sb3IKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gW3RoaXMuX2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgaGVpZ2h0IC8gbnVtYmVyT2ZMaW5lc107CiAgfQogIF9yZW5kZXJUZXh0KHRleHQsIGZvbnQsIGZvbnRTaXplLCB0b3RhbFdpZHRoLCBhbGlnbm1lbnQsIHByZXZJbmZvLCBoUGFkZGluZywgdlBhZGRpbmcpIHsKICAgIGxldCBzaGlmdDsKICAgIGlmIChhbGlnbm1lbnQgPT09IDEpIHsKICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLl9nZXRUZXh0V2lkdGgodGV4dCwgZm9udCkgKiBmb250U2l6ZTsKICAgICAgc2hpZnQgPSAodG90YWxXaWR0aCAtIHdpZHRoKSAvIDI7CiAgICB9IGVsc2UgaWYgKGFsaWdubWVudCA9PT0gMikgewogICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX2dldFRleHRXaWR0aCh0ZXh0LCBmb250KSAqIGZvbnRTaXplOwogICAgICBzaGlmdCA9IHRvdGFsV2lkdGggLSB3aWR0aCAtIGhQYWRkaW5nOwogICAgfSBlbHNlIHsKICAgICAgc2hpZnQgPSBoUGFkZGluZzsKICAgIH0KICAgIGNvbnN0IHNoaWZ0U3RyID0gbnVtYmVyVG9TdHJpbmcoc2hpZnQgLSBwcmV2SW5mby5zaGlmdCk7CiAgICBwcmV2SW5mby5zaGlmdCA9IHNoaWZ0OwogICAgdlBhZGRpbmcgPSBudW1iZXJUb1N0cmluZyh2UGFkZGluZyk7CiAgICByZXR1cm4gYCR7c2hpZnRTdHJ9ICR7dlBhZGRpbmd9IFRkICgke2VzY2FwZVN0cmluZyh0ZXh0KX0pIFRqYDsKICB9CiAgX2dldFNhdmVGaWVsZFJlc291cmNlcyh4cmVmKSB7CiAgICBjb25zdCB7CiAgICAgIGxvY2FsUmVzb3VyY2VzLAogICAgICBhcHBlYXJhbmNlUmVzb3VyY2VzLAogICAgICBhY3JvRm9ybVJlc291cmNlcwogICAgfSA9IHRoaXMuX2ZpZWxkUmVzb3VyY2VzOwogICAgY29uc3QgZm9udE5hbWUgPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhPy5mb250TmFtZTsKICAgIGlmICghZm9udE5hbWUpIHsKICAgICAgcmV0dXJuIGxvY2FsUmVzb3VyY2VzIHx8IERpY3QuZW1wdHk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHJlc291cmNlcyBvZiBbbG9jYWxSZXNvdXJjZXMsIGFwcGVhcmFuY2VSZXNvdXJjZXNdKSB7CiAgICAgIGlmIChyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgbG9jYWxGb250ID0gcmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgICAgIGlmIChsb2NhbEZvbnQgaW5zdGFuY2VvZiBEaWN0ICYmIGxvY2FsRm9udC5oYXMoZm9udE5hbWUpKSB7CiAgICAgICAgICByZXR1cm4gcmVzb3VyY2VzOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGFjcm9Gb3JtUmVzb3VyY2VzIGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBhY3JvRm9ybUZvbnQgPSBhY3JvRm9ybVJlc291cmNlcy5nZXQoIkZvbnQiKTsKICAgICAgaWYgKGFjcm9Gb3JtRm9udCBpbnN0YW5jZW9mIERpY3QgJiYgYWNyb0Zvcm1Gb250Lmhhcyhmb250TmFtZSkpIHsKICAgICAgICBjb25zdCBzdWJGb250RGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICAgIHN1YkZvbnREaWN0LnNldChmb250TmFtZSwgYWNyb0Zvcm1Gb250LmdldFJhdyhmb250TmFtZSkpOwogICAgICAgIGNvbnN0IHN1YlJlc291cmNlc0RpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgICBzdWJSZXNvdXJjZXNEaWN0LnNldCgiRm9udCIsIHN1YkZvbnREaWN0KTsKICAgICAgICByZXR1cm4gRGljdC5tZXJnZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZGljdEFycmF5OiBbc3ViUmVzb3VyY2VzRGljdCwgbG9jYWxSZXNvdXJjZXNdLAogICAgICAgICAgbWVyZ2VTdWJEaWN0czogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbG9jYWxSZXNvdXJjZXMgfHwgRGljdC5lbXB0eTsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KY2xhc3MgVGV4dFdpZGdldEFubm90YXRpb24gZXh0ZW5kcyBXaWRnZXRBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSBwYXJhbXM7CiAgICBpZiAoZGljdC5oYXMoIlBNRCIpKSB7CiAgICAgIHRoaXMuZmxhZ3MgfD0gQW5ub3RhdGlvbkZsYWcuSElEREVOOwogICAgICB0aGlzLmRhdGEuaGlkZGVuID0gdHJ1ZTsKICAgICAgd2FybigiQmFyY29kZXMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIH0KICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEucmVhZE9ubHkgJiYgIXRoaXMuZGF0YS5ub0hUTUw7CiAgICB0aGlzLl9oYXNUZXh0ID0gdHJ1ZTsKICAgIGlmICh0eXBlb2YgdGhpcy5kYXRhLmZpZWxkVmFsdWUgIT09ICJzdHJpbmciKSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gIiI7CiAgICB9CiAgICBsZXQgYWxpZ25tZW50ID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIlEiCiAgICB9KTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihhbGlnbm1lbnQpIHx8IGFsaWdubWVudCA8IDAgfHwgYWxpZ25tZW50ID4gMikgewogICAgICBhbGlnbm1lbnQgPSBudWxsOwogICAgfQogICAgdGhpcy5kYXRhLnRleHRBbGlnbm1lbnQgPSBhbGlnbm1lbnQ7CiAgICBsZXQgbWF4aW11bUxlbmd0aCA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJNYXhMZW4iCiAgICB9KTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihtYXhpbXVtTGVuZ3RoKSB8fCBtYXhpbXVtTGVuZ3RoIDwgMCkgewogICAgICBtYXhpbXVtTGVuZ3RoID0gMDsKICAgIH0KICAgIHRoaXMuZGF0YS5tYXhMZW4gPSBtYXhpbXVtTGVuZ3RoOwogICAgdGhpcy5kYXRhLm11bHRpTGluZSA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuTVVMVElMSU5FKTsKICAgIHRoaXMuZGF0YS5jb21iID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5DT01CKSAmJiAhdGhpcy5kYXRhLm11bHRpTGluZSAmJiAhdGhpcy5kYXRhLnBhc3N3b3JkICYmICF0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLkZJTEVTRUxFQ1QpICYmIHRoaXMuZGF0YS5tYXhMZW4gIT09IDA7CiAgICB0aGlzLmRhdGEuZG9Ob3RTY3JvbGwgPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLkRPTk9UU0NST0xMKTsKICAgIGNvbnN0IHsKICAgICAgZGF0YTogewogICAgICAgIGFjdGlvbnMKICAgICAgfQogICAgfSA9IHRoaXM7CiAgICBpZiAoIWFjdGlvbnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgQUZEYXRlVGltZSA9IC9eQUYoRGF0ZXxUaW1lKV8oPzpLZXlzdHJva2V8Rm9ybWF0KSg/OkV4KT9cKFsnIl0/KFteJyJdKylbJyJdP1wpOyQvOwogICAgbGV0IGNhblVzZUhUTUxEYXRlVGltZSA9IGZhbHNlOwogICAgaWYgKGFjdGlvbnMuRm9ybWF0Py5sZW5ndGggPT09IDEgJiYgYWN0aW9ucy5LZXlzdHJva2U/Lmxlbmd0aCA9PT0gMSAmJiBBRkRhdGVUaW1lLnRlc3QoYWN0aW9ucy5Gb3JtYXRbMF0pICYmIEFGRGF0ZVRpbWUudGVzdChhY3Rpb25zLktleXN0cm9rZVswXSkgfHwgYWN0aW9ucy5Gb3JtYXQ/Lmxlbmd0aCA9PT0gMCAmJiBhY3Rpb25zLktleXN0cm9rZT8ubGVuZ3RoID09PSAxICYmIEFGRGF0ZVRpbWUudGVzdChhY3Rpb25zLktleXN0cm9rZVswXSkgfHwgYWN0aW9ucy5LZXlzdHJva2U/Lmxlbmd0aCA9PT0gMCAmJiBhY3Rpb25zLkZvcm1hdD8ubGVuZ3RoID09PSAxICYmIEFGRGF0ZVRpbWUudGVzdChhY3Rpb25zLkZvcm1hdFswXSkpIHsKICAgICAgY2FuVXNlSFRNTERhdGVUaW1lID0gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IGFjdGlvbnNUb1Zpc2l0ID0gW107CiAgICBpZiAoYWN0aW9ucy5Gb3JtYXQpIHsKICAgICAgYWN0aW9uc1RvVmlzaXQucHVzaCguLi5hY3Rpb25zLkZvcm1hdCk7CiAgICB9CiAgICBpZiAoYWN0aW9ucy5LZXlzdHJva2UpIHsKICAgICAgYWN0aW9uc1RvVmlzaXQucHVzaCguLi5hY3Rpb25zLktleXN0cm9rZSk7CiAgICB9CiAgICBpZiAoY2FuVXNlSFRNTERhdGVUaW1lKSB7CiAgICAgIGRlbGV0ZSBhY3Rpb25zLktleXN0cm9rZTsKICAgICAgYWN0aW9ucy5Gb3JtYXQgPSBhY3Rpb25zVG9WaXNpdDsKICAgIH0KICAgIGZvciAoY29uc3QgZm9ybWF0QWN0aW9uIG9mIGFjdGlvbnNUb1Zpc2l0KSB7CiAgICAgIGNvbnN0IG0gPSBmb3JtYXRBY3Rpb24ubWF0Y2goQUZEYXRlVGltZSk7CiAgICAgIGlmICghbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGlzRGF0ZSA9IG1bMV0gPT09ICJEYXRlIjsKICAgICAgbGV0IGZvcm1hdCA9IG1bMl07CiAgICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KGZvcm1hdCwgMTApOwogICAgICBpZiAoIWlzTmFOKG51bSkgJiYgTWF0aC5mbG9vcihNYXRoLmxvZzEwKG51bSkpICsgMSA9PT0gbVsyXS5sZW5ndGgpIHsKICAgICAgICBmb3JtYXQgPSAoaXNEYXRlID8gRGF0ZUZvcm1hdHMgOiBUaW1lRm9ybWF0cylbbnVtXSA/PyBmb3JtYXQ7CiAgICAgIH0KICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lRm9ybWF0ID0gZm9ybWF0OwogICAgICBpZiAoIWNhblVzZUhUTUxEYXRlVGltZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChpc0RhdGUpIHsKICAgICAgICBpZiAoL0hIfE1NfHNzfGgvLnRlc3QoZm9ybWF0KSkgewogICAgICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSA9ICJkYXRldGltZS1sb2NhbCI7CiAgICAgICAgICB0aGlzLmRhdGEudGltZVN0ZXAgPSAvc3MvLnRlc3QoZm9ybWF0KSA/IDEgOiA2MDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSA9ICJkYXRlIjsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSA9ICJ0aW1lIjsKICAgICAgdGhpcy5kYXRhLnRpbWVTdGVwID0gL3NzLy50ZXN0KGZvcm1hdCkgPyAxIDogNjA7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICBnZXQgaGFzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gISF0aGlzLmFwcGVhcmFuY2UgJiYgIXRoaXMuX25lZWRBcHBlYXJhbmNlczsKICB9CiAgX2dldENvbWJBcHBlYXJhbmNlKGRlZmF1bHRBcHBlYXJhbmNlLCBmb250LCB0ZXh0LCBmb250U2l6ZSwgd2lkdGgsIGhlaWdodCwgaFBhZGRpbmcsIHZQYWRkaW5nLCBkZXNjZW50LCBsaW5lSGVpZ2h0LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3QgY29tYldpZHRoID0gd2lkdGggLyB0aGlzLmRhdGEubWF4TGVuOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5nZXRCb3JkZXJBbmRCYWNrZ3JvdW5kQXBwZWFyYW5jZXMoYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgY29uc3QgYnVmID0gW107CiAgICBjb25zdCBwb3NpdGlvbnMgPSBmb250LmdldENoYXJQb3NpdGlvbnModGV4dCk7CiAgICBmb3IgKGNvbnN0IFtzdGFydCwgZW5kXSBvZiBwb3NpdGlvbnMpIHsKICAgICAgYnVmLnB1c2goYCgke2VzY2FwZVN0cmluZyh0ZXh0LnN1YnN0cmluZyhzdGFydCwgZW5kKSl9KSBUamApOwogICAgfQogICAgY29uc3QgcmVuZGVyZWRDb21iID0gYnVmLmpvaW4oYCAke251bWJlclRvU3RyaW5nKGNvbWJXaWR0aCl9IDAgVGQgYCk7CiAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31CVCBgICsgZGVmYXVsdEFwcGVhcmFuY2UgKyBgIDEgMCAwIDEgJHtudW1iZXJUb1N0cmluZyhoUGFkZGluZyl9ICR7bnVtYmVyVG9TdHJpbmcodlBhZGRpbmcgKyBkZXNjZW50KX0gVG0gJHtyZW5kZXJlZENvbWJ9YCArICIgRVQgUSBFTUMiOwogIH0KICBfZ2V0TXVsdGlsaW5lQXBwZWFyYW5jZShkZWZhdWx0QXBwZWFyYW5jZSwgbGluZXMsIGZvbnQsIGZvbnRTaXplLCB3aWR0aCwgaGVpZ2h0LCBhbGlnbm1lbnQsIGhQYWRkaW5nLCB2UGFkZGluZywgZGVzY2VudCwgbGluZUhlaWdodCwgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGNvbnN0IGJ1ZiA9IFtdOwogICAgY29uc3QgdG90YWxXaWR0aCA9IHdpZHRoIC0gMiAqIGhQYWRkaW5nOwogICAgY29uc3QgcHJldkluZm8gPSB7CiAgICAgIHNoaWZ0OiAwCiAgICB9OwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gbGluZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07CiAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX3NwbGl0TGluZShsaW5lLCBmb250LCBmb250U2l6ZSwgdG90YWxXaWR0aCk7CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IGNodW5rcy5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgY29uc3QgY2h1bmsgPSBjaHVua3Nbal07CiAgICAgICAgY29uc3QgdlNoaWZ0ID0gaSA9PT0gMCAmJiBqID09PSAwID8gLXZQYWRkaW5nIC0gKGxpbmVIZWlnaHQgLSBkZXNjZW50KSA6IC1saW5lSGVpZ2h0OwogICAgICAgIGJ1Zi5wdXNoKHRoaXMuX3JlbmRlclRleHQoY2h1bmssIGZvbnQsIGZvbnRTaXplLCB3aWR0aCwgYWxpZ25tZW50LCBwcmV2SW5mbywgaFBhZGRpbmcsIHZTaGlmdCkpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmdldEJvcmRlckFuZEJhY2tncm91bmRBcHBlYXJhbmNlcyhhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICBjb25zdCByZW5kZXJlZFRleHQgPSBidWYuam9pbigiXG4iKTsKICAgIHJldHVybiBgL1R4IEJNQyBxICR7Y29sb3JzfUJUIGAgKyBkZWZhdWx0QXBwZWFyYW5jZSArIGAgMSAwIDAgMSAwICR7bnVtYmVyVG9TdHJpbmcoaGVpZ2h0KX0gVG0gJHtyZW5kZXJlZFRleHR9YCArICIgRVQgUSBFTUMiOwogIH0KICBfc3BsaXRMaW5lKGxpbmUsIGZvbnQsIGZvbnRTaXplLCB3aWR0aCwgY2FjaGUgPSB7fSkgewogICAgbGluZSA9IGNhY2hlLmxpbmUgfHwgbGluZTsKICAgIGNvbnN0IGdseXBocyA9IGNhY2hlLmdseXBocyB8fCBmb250LmNoYXJzVG9HbHlwaHMobGluZSk7CiAgICBpZiAoZ2x5cGhzLmxlbmd0aCA8PSAxKSB7CiAgICAgIHJldHVybiBbbGluZV07CiAgICB9CiAgICBjb25zdCBwb3NpdGlvbnMgPSBjYWNoZS5wb3NpdGlvbnMgfHwgZm9udC5nZXRDaGFyUG9zaXRpb25zKGxpbmUpOwogICAgY29uc3Qgc2NhbGUgPSBmb250U2l6ZSAvIDEwMDA7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGxldCBsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ID0gLTEsCiAgICAgIGxhc3RTcGFjZVBvc0luU3RyaW5nRW5kID0gLTEsCiAgICAgIGxhc3RTcGFjZVBvcyA9IC0xLAogICAgICBzdGFydENodW5rID0gMCwKICAgICAgY3VycmVudFdpZHRoID0gMDsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IFtzdGFydCwgZW5kXSA9IHBvc2l0aW9uc1tpXTsKICAgICAgY29uc3QgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgIGNvbnN0IGdseXBoV2lkdGggPSBnbHlwaC53aWR0aCAqIHNjYWxlOwogICAgICBpZiAoZ2x5cGgudW5pY29kZSA9PT0gIiAiKSB7CiAgICAgICAgaWYgKGN1cnJlbnRXaWR0aCArIGdseXBoV2lkdGggPiB3aWR0aCkgewogICAgICAgICAgY2h1bmtzLnB1c2gobGluZS5zdWJzdHJpbmcoc3RhcnRDaHVuaywgc3RhcnQpKTsKICAgICAgICAgIHN0YXJ0Q2h1bmsgPSBzdGFydDsKICAgICAgICAgIGN1cnJlbnRXaWR0aCA9IGdseXBoV2lkdGg7CiAgICAgICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ID0gLTE7CiAgICAgICAgICBsYXN0U3BhY2VQb3MgPSAtMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFdpZHRoICs9IGdseXBoV2lkdGg7CiAgICAgICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ID0gc3RhcnQ7CiAgICAgICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ0VuZCA9IGVuZDsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IGk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGN1cnJlbnRXaWR0aCArIGdseXBoV2lkdGggPiB3aWR0aCkgewogICAgICAgIGlmIChsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ICE9PSAtMSkgewogICAgICAgICAgY2h1bmtzLnB1c2gobGluZS5zdWJzdHJpbmcoc3RhcnRDaHVuaywgbGFzdFNwYWNlUG9zSW5TdHJpbmdFbmQpKTsKICAgICAgICAgIHN0YXJ0Q2h1bmsgPSBsYXN0U3BhY2VQb3NJblN0cmluZ0VuZDsKICAgICAgICAgIGkgPSBsYXN0U3BhY2VQb3MgKyAxOwogICAgICAgICAgbGFzdFNwYWNlUG9zSW5TdHJpbmdTdGFydCA9IC0xOwogICAgICAgICAgY3VycmVudFdpZHRoID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2h1bmtzLnB1c2gobGluZS5zdWJzdHJpbmcoc3RhcnRDaHVuaywgc3RhcnQpKTsKICAgICAgICAgIHN0YXJ0Q2h1bmsgPSBzdGFydDsKICAgICAgICAgIGN1cnJlbnRXaWR0aCA9IGdseXBoV2lkdGg7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRXaWR0aCArPSBnbHlwaFdpZHRoOwogICAgICB9CiAgICB9CiAgICBpZiAoc3RhcnRDaHVuayA8IGxpbmUubGVuZ3RoKSB7CiAgICAgIGNodW5rcy5wdXNoKGxpbmUuc3Vic3RyaW5nKHN0YXJ0Q2h1bmssIGxpbmUubGVuZ3RoKSk7CiAgICB9CiAgICByZXR1cm4gY2h1bmtzOwogIH0KICBhc3luYyBleHRyYWN0VGV4dENvbnRlbnQoZXZhbHVhdG9yLCB0YXNrLCB2aWV3Qm94KSB7CiAgICBhd2FpdCBzdXBlci5leHRyYWN0VGV4dENvbnRlbnQoZXZhbHVhdG9yLCB0YXNrLCB2aWV3Qm94KTsKICAgIGNvbnN0IHRleHQgPSB0aGlzLmRhdGEudGV4dENvbnRlbnQ7CiAgICBpZiAoIXRleHQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYWxsVGV4dCA9IHRleHQuam9pbigiXG4iKTsKICAgIGlmIChhbGxUZXh0ID09PSB0aGlzLmRhdGEuZmllbGRWYWx1ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByZWdleCA9IGFsbFRleHQucmVwbGFjZUFsbCgvKFsuKis/XiR7fSgpfFtcXVxcXSl8KFxzKykvZywgKF9tLCBwMSkgPT4gcDEgPyBgXFwke3AxfWAgOiAiXFxzKyIpOwogICAgaWYgKG5ldyBSZWdFeHAoYF5cXHMqJHtyZWdleH1cXHMqJGApLnRlc3QodGhpcy5kYXRhLmZpZWxkVmFsdWUpKSB7CiAgICAgIHRoaXMuZGF0YS50ZXh0Q29udGVudCA9IHRoaXMuZGF0YS5maWVsZFZhbHVlLnNwbGl0KCJcbiIpOwogICAgfQogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgIHZhbHVlOiB0aGlzLmRhdGEuZmllbGRWYWx1ZSwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgfHwgIiIsCiAgICAgIG11bHRpbGluZTogdGhpcy5kYXRhLm11bHRpTGluZSwKICAgICAgcGFzc3dvcmQ6IHRoaXMuZGF0YS5wYXNzd29yZCwKICAgICAgY2hhckxpbWl0OiB0aGlzLmRhdGEubWF4TGVuLAogICAgICBjb21iOiB0aGlzLmRhdGEuY29tYiwKICAgICAgZWRpdGFibGU6ICF0aGlzLmRhdGEucmVhZE9ubHksCiAgICAgIGhpZGRlbjogdGhpcy5kYXRhLmhpZGRlbiwKICAgICAgbmFtZTogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgcmVjdDogdGhpcy5kYXRhLnJlY3QsCiAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICBkYXRldGltZUZvcm1hdDogdGhpcy5kYXRhLmRhdGV0aW1lRm9ybWF0LAogICAgICBoYXNEYXRldGltZUhUTUw6ICEhdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSwKICAgICAgdHlwZTogInRleHQiCiAgICB9OwogIH0KfQpjbGFzcyBCdXR0b25XaWRnZXRBbm5vdGF0aW9uIGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5jaGVja2VkQXBwZWFyYW5jZSA9IG51bGw7CiAgICB0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2UgPSBudWxsOwogICAgY29uc3QgaXNSYWRpbyA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuUkFESU8pLAogICAgICBpc1B1c2hCdXR0b24gPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLlBVU0hCVVRUT04pOwogICAgdGhpcy5kYXRhLmNoZWNrQm94ID0gIWlzUmFkaW8gJiYgIWlzUHVzaEJ1dHRvbjsKICAgIHRoaXMuZGF0YS5yYWRpb0J1dHRvbiA9IGlzUmFkaW8gJiYgIWlzUHVzaEJ1dHRvbjsKICAgIHRoaXMuZGF0YS5wdXNoQnV0dG9uID0gaXNQdXNoQnV0dG9uOwogICAgdGhpcy5kYXRhLmlzVG9vbHRpcE9ubHkgPSBmYWxzZTsKICAgIGlmICh0aGlzLmRhdGEuY2hlY2tCb3gpIHsKICAgICAgdGhpcy5fcHJvY2Vzc0NoZWNrQm94KHBhcmFtcyk7CiAgICB9IGVsc2UgaWYgKHRoaXMuZGF0YS5yYWRpb0J1dHRvbikgewogICAgICB0aGlzLl9wcm9jZXNzUmFkaW9CdXR0b24ocGFyYW1zKTsKICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLnB1c2hCdXR0b24pIHsKICAgICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRydWU7CiAgICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgICAgdGhpcy5fcHJvY2Vzc1B1c2hCdXR0b24ocGFyYW1zKTsKICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oIkludmFsaWQgZmllbGQgZmxhZ3MgZm9yIGJ1dHRvbiB3aWRnZXQgYW5ub3RhdGlvbiIpOwogICAgfQogIH0KICBhc3luYyBnZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAodGhpcy5kYXRhLnB1c2hCdXR0b24pIHsKICAgICAgcmV0dXJuIHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgZmFsc2UsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGxldCB2YWx1ZSA9IG51bGw7CiAgICBsZXQgcm90YXRpb24gPSBudWxsOwogICAgaWYgKGFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlLmdldCh0aGlzLmRhdGEuaWQpOwogICAgICB2YWx1ZSA9IHN0b3JhZ2VFbnRyeSA/IHN0b3JhZ2VFbnRyeS52YWx1ZSA6IG51bGw7CiAgICAgIHJvdGF0aW9uID0gc3RvcmFnZUVudHJ5ID8gc3RvcmFnZUVudHJ5LnJvdGF0aW9uIDogbnVsbDsKICAgIH0KICAgIGlmICh2YWx1ZSA9PT0gbnVsbCAmJiB0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgcmV0dXJuIHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuY2hlY2tCb3ggPyB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlIDogdGhpcy5kYXRhLmZpZWxkVmFsdWUgPT09IHRoaXMuZGF0YS5idXR0b25WYWx1ZTsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2UgPSB2YWx1ZSA/IHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgOiB0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2U7CiAgICBpZiAoYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzYXZlZEFwcGVhcmFuY2UgPSB0aGlzLmFwcGVhcmFuY2U7CiAgICAgIGNvbnN0IHNhdmVkTWF0cml4ID0gbG9va3VwTWF0cml4KGFwcGVhcmFuY2UuZGljdC5nZXRBcnJheSgiTWF0cml4IiksIElERU5USVRZX01BVFJJWCk7CiAgICAgIGlmIChyb3RhdGlvbikgewogICAgICAgIGFwcGVhcmFuY2UuZGljdC5zZXQoIk1hdHJpeCIsIHRoaXMuZ2V0Um90YXRpb25NYXRyaXgoYW5ub3RhdGlvblN0b3JhZ2UpKTsKICAgICAgfQogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlOwogICAgICBjb25zdCBvcGVyYXRvckxpc3QgPSBzdXBlci5nZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgICAgdGhpcy5hcHBlYXJhbmNlID0gc2F2ZWRBcHBlYXJhbmNlOwogICAgICBhcHBlYXJhbmNlLmRpY3Quc2V0KCJNYXRyaXgiLCBzYXZlZE1hdHJpeCk7CiAgICAgIHJldHVybiBvcGVyYXRvckxpc3Q7CiAgICB9CiAgICByZXR1cm4gewogICAgICBvcExpc3Q6IG5ldyBPcGVyYXRvckxpc3QoKSwKICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgc2VwYXJhdGVDYW52YXM6IGZhbHNlCiAgICB9OwogIH0KICBhc3luYyBzYXZlKGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpIHsKICAgIGlmICh0aGlzLmRhdGEuY2hlY2tCb3gpIHsKICAgICAgdGhpcy5fc2F2ZUNoZWNrYm94KGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5kYXRhLnJhZGlvQnV0dG9uKSB7CiAgICAgIHRoaXMuX3NhdmVSYWRpb0J1dHRvbihldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKTsKICAgIH0KICB9CiAgYXN5bmMgX3NhdmVDaGVja2JveChldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlLmdldCh0aGlzLmRhdGEuaWQpOwogICAgY29uc3QgZmxhZ3MgPSB0aGlzLl9idWlsZEZsYWdzKHN0b3JhZ2VFbnRyeT8ubm9WaWV3LCBzdG9yYWdlRW50cnk/Lm5vUHJpbnQpOwogICAgbGV0IHJvdGF0aW9uID0gc3RvcmFnZUVudHJ5Py5yb3RhdGlvbiwKICAgICAgdmFsdWUgPSBzdG9yYWdlRW50cnk/LnZhbHVlOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlOwogICAgICBpZiAoZGVmYXVsdFZhbHVlID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgbGV0IGRpY3QgPSBldmFsdWF0b3IueHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkaWN0ID0gZGljdC5jbG9uZSgpOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlOwogICAgfQogICAgY29uc3QgeGZhID0gewogICAgICBwYXRoOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICB2YWx1ZTogdmFsdWUgPyB0aGlzLmRhdGEuZXhwb3J0VmFsdWUgOiAiIgogICAgfTsKICAgIGNvbnN0IG5hbWUgPSBOYW1lLmdldCh2YWx1ZSA/IHRoaXMuZGF0YS5leHBvcnRWYWx1ZSA6ICJPZmYiKTsKICAgIHRoaXMuc2V0VmFsdWUoZGljdCwgbmFtZSwgZXZhbHVhdG9yLnhyZWYsIGNoYW5nZXMpOwogICAgZGljdC5zZXQoIkFTIiwgbmFtZSk7CiAgICBkaWN0LnNldCgiTSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZSgpfWApOwogICAgaWYgKGZsYWdzICE9PSB1bmRlZmluZWQpIHsKICAgICAgZGljdC5zZXQoIkYiLCBmbGFncyk7CiAgICB9CiAgICBjb25zdCBtYXliZU1LID0gdGhpcy5fZ2V0TUtEaWN0KHJvdGF0aW9uKTsKICAgIGlmIChtYXliZU1LKSB7CiAgICAgIGRpY3Quc2V0KCJNSyIsIG1heWJlTUspOwogICAgfQogICAgY2hhbmdlcy5wdXQodGhpcy5yZWYsIHsKICAgICAgZGF0YTogZGljdCwKICAgICAgeGZhLAogICAgICBuZWVkQXBwZWFyYW5jZXM6IGZhbHNlCiAgICB9KTsKICB9CiAgYXN5bmMgX3NhdmVSYWRpb0J1dHRvbihldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlLmdldCh0aGlzLmRhdGEuaWQpOwogICAgY29uc3QgZmxhZ3MgPSB0aGlzLl9idWlsZEZsYWdzKHN0b3JhZ2VFbnRyeT8ubm9WaWV3LCBzdG9yYWdlRW50cnk/Lm5vUHJpbnQpOwogICAgbGV0IHJvdGF0aW9uID0gc3RvcmFnZUVudHJ5Py5yb3RhdGlvbiwKICAgICAgdmFsdWUgPSBzdG9yYWdlRW50cnk/LnZhbHVlOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlOwogICAgICBpZiAoZGVmYXVsdFZhbHVlID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgbGV0IGRpY3QgPSBldmFsdWF0b3IueHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkaWN0ID0gZGljdC5jbG9uZSgpOwogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlOwogICAgfQogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgY29uc3QgeGZhID0gewogICAgICBwYXRoOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICB2YWx1ZTogdmFsdWUgPyB0aGlzLmRhdGEuYnV0dG9uVmFsdWUgOiAiIgogICAgfTsKICAgIGNvbnN0IG5hbWUgPSBOYW1lLmdldCh2YWx1ZSA/IHRoaXMuZGF0YS5idXR0b25WYWx1ZSA6ICJPZmYiKTsKICAgIGlmICh2YWx1ZSkgewogICAgICB0aGlzLnNldFZhbHVlKGRpY3QsIG5hbWUsIGV2YWx1YXRvci54cmVmLCBjaGFuZ2VzKTsKICAgIH0KICAgIGRpY3Quc2V0KCJBUyIsIG5hbWUpOwogICAgZGljdC5zZXQoIk0iLCBgRDoke2dldE1vZGlmaWNhdGlvbkRhdGUoKX1gKTsKICAgIGlmIChmbGFncyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGRpY3Quc2V0KCJGIiwgZmxhZ3MpOwogICAgfQogICAgY29uc3QgbWF5YmVNSyA9IHRoaXMuX2dldE1LRGljdChyb3RhdGlvbik7CiAgICBpZiAobWF5YmVNSykgewogICAgICBkaWN0LnNldCgiTUsiLCBtYXliZU1LKTsKICAgIH0KICAgIGNoYW5nZXMucHV0KHRoaXMucmVmLCB7CiAgICAgIGRhdGE6IGRpY3QsCiAgICAgIHhmYSwKICAgICAgbmVlZEFwcGVhcmFuY2VzOiBmYWxzZQogICAgfSk7CiAgfQogIF9nZXREZWZhdWx0Q2hlY2tlZEFwcGVhcmFuY2UocGFyYW1zLCB0eXBlKSB7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSB0aGlzOwogICAgY29uc3QgYmJveCA9IFswLCAwLCB3aWR0aCwgaGVpZ2h0XTsKICAgIGNvbnN0IEZPTlRfUkFUSU8gPSAwLjg7CiAgICBjb25zdCBmb250U2l6ZSA9IE1hdGgubWluKHdpZHRoLCBoZWlnaHQpICogRk9OVF9SQVRJTzsKICAgIGxldCBtZXRyaWNzLCBjaGFyOwogICAgaWYgKHR5cGUgPT09ICJjaGVjayIpIHsKICAgICAgbWV0cmljcyA9IHsKICAgICAgICB3aWR0aDogMC43NTUgKiBmb250U2l6ZSwKICAgICAgICBoZWlnaHQ6IDAuNzA1ICogZm9udFNpemUKICAgICAgfTsKICAgICAgY2hhciA9ICJceDMzIjsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImRpc2MiKSB7CiAgICAgIG1ldHJpY3MgPSB7CiAgICAgICAgd2lkdGg6IDAuNzkxICogZm9udFNpemUsCiAgICAgICAgaGVpZ2h0OiAwLjcwNSAqIGZvbnRTaXplCiAgICAgIH07CiAgICAgIGNoYXIgPSAiXHg2QyI7CiAgICB9IGVsc2UgewogICAgICB1bnJlYWNoYWJsZShgX2dldERlZmF1bHRDaGVja2VkQXBwZWFyYW5jZSAtIHVuc3VwcG9ydGVkIHR5cGU6ICR7dHlwZX1gKTsKICAgIH0KICAgIGNvbnN0IHhTaGlmdCA9IG51bWJlclRvU3RyaW5nKCh3aWR0aCAtIG1ldHJpY3Mud2lkdGgpIC8gMik7CiAgICBjb25zdCB5U2hpZnQgPSBudW1iZXJUb1N0cmluZygoaGVpZ2h0IC0gbWV0cmljcy5oZWlnaHQpIC8gMik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYHEgQlQgL1BkZkpzWmFEYiAke2ZvbnRTaXplfSBUZiAwIGcgJHt4U2hpZnR9ICR7eVNoaWZ0fSBUZCAoJHtjaGFyfSkgVGogRVQgUWA7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHBhcmFtcy54cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgYmJveCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIk1hdHJpeCIsIFsxLCAwLCAwLCAxLCAwLCAwXSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBEaWN0KHBhcmFtcy54cmVmKTsKICAgIGNvbnN0IGZvbnQgPSBuZXcgRGljdChwYXJhbXMueHJlZik7CiAgICBmb250LnNldCgiUGRmSnNaYURiIiwgdGhpcy5mYWxsYmFja0ZvbnREaWN0KTsKICAgIHJlc291cmNlcy5zZXQoIkZvbnQiLCBmb250KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgdGhpcy5jaGVja2VkQXBwZWFyYW5jZS5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5jaGVja2VkQXBwZWFyYW5jZSk7CiAgfQogIF9wcm9jZXNzQ2hlY2tCb3gocGFyYW1zKSB7CiAgICBjb25zdCBjdXN0b21BcHBlYXJhbmNlID0gcGFyYW1zLmRpY3QuZ2V0KCJBUCIpOwogICAgaWYgKCEoY3VzdG9tQXBwZWFyYW5jZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG5vcm1hbEFwcGVhcmFuY2UgPSBjdXN0b21BcHBlYXJhbmNlLmdldCgiTiIpOwogICAgaWYgKCEobm9ybWFsQXBwZWFyYW5jZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFzVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUocGFyYW1zLmRpY3QuZ2V0KCJBUyIpKTsKICAgIGlmICh0eXBlb2YgYXNWYWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBhc1ZhbHVlOwogICAgfQogICAgY29uc3QgeWVzID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUgIT09IG51bGwgJiYgdGhpcy5kYXRhLmZpZWxkVmFsdWUgIT09ICJPZmYiID8gdGhpcy5kYXRhLmZpZWxkVmFsdWUgOiAiWWVzIjsKICAgIGNvbnN0IGV4cG9ydFZhbHVlcyA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShub3JtYWxBcHBlYXJhbmNlLmdldEtleXMoKSk7CiAgICBpZiAoZXhwb3J0VmFsdWVzLmxlbmd0aCA9PT0gMCkgewogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgeWVzKTsKICAgIH0gZWxzZSBpZiAoZXhwb3J0VmFsdWVzLmxlbmd0aCA9PT0gMSkgewogICAgICBpZiAoZXhwb3J0VmFsdWVzWzBdID09PSAiT2ZmIikgewogICAgICAgIGV4cG9ydFZhbHVlcy5wdXNoKHllcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXhwb3J0VmFsdWVzLnVuc2hpZnQoIk9mZiIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV4cG9ydFZhbHVlcy5pbmNsdWRlcyh5ZXMpKSB7CiAgICAgIGV4cG9ydFZhbHVlcy5sZW5ndGggPSAwOwogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgeWVzKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IG90aGVyWWVzID0gZXhwb3J0VmFsdWVzLmZpbmQodiA9PiB2ICE9PSAiT2ZmIik7CiAgICAgIGV4cG9ydFZhbHVlcy5sZW5ndGggPSAwOwogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgb3RoZXJZZXMpOwogICAgfQogICAgaWYgKCFleHBvcnRWYWx1ZXMuaW5jbHVkZXModGhpcy5kYXRhLmZpZWxkVmFsdWUpKSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gIk9mZiI7CiAgICB9CiAgICB0aGlzLmRhdGEuZXhwb3J0VmFsdWUgPSBleHBvcnRWYWx1ZXNbMV07CiAgICBjb25zdCBjaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KHRoaXMuZGF0YS5leHBvcnRWYWx1ZSk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlID0gY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gY2hlY2tlZEFwcGVhcmFuY2UgOiBudWxsOwogICAgY29uc3QgdW5jaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KCJPZmYiKTsKICAgIHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSA9IHVuY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gdW5jaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBpZiAodGhpcy5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5jaGVja2VkQXBwZWFyYW5jZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9nZXREZWZhdWx0Q2hlY2tlZEFwcGVhcmFuY2UocGFyYW1zLCAiY2hlY2siKTsKICAgIH0KICAgIGlmICh0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2UpIHsKICAgICAgdGhpcy5fc3RyZWFtcy5wdXNoKHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSk7CiAgICB9CiAgICB0aGlzLl9mYWxsYmFja0ZvbnREaWN0ID0gdGhpcy5mYWxsYmFja0ZvbnREaWN0OwogICAgaWYgKHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9PT0gbnVsbCkgewogICAgICB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgPSAiT2ZmIjsKICAgIH0KICB9CiAgX3Byb2Nlc3NSYWRpb0J1dHRvbihwYXJhbXMpIHsKICAgIHRoaXMuZGF0YS5idXR0b25WYWx1ZSA9IG51bGw7CiAgICBjb25zdCBmaWVsZFBhcmVudCA9IHBhcmFtcy5kaWN0LmdldCgiUGFyZW50Iik7CiAgICBpZiAoZmllbGRQYXJlbnQgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIHRoaXMucGFyZW50ID0gcGFyYW1zLmRpY3QuZ2V0UmF3KCJQYXJlbnQiKTsKICAgICAgY29uc3QgZmllbGRQYXJlbnRWYWx1ZSA9IGZpZWxkUGFyZW50LmdldCgiViIpOwogICAgICBpZiAoZmllbGRQYXJlbnRWYWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShmaWVsZFBhcmVudFZhbHVlKTsKICAgICAgfQogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZVN0YXRlcyA9IHBhcmFtcy5kaWN0LmdldCgiQVAiKTsKICAgIGlmICghKGFwcGVhcmFuY2VTdGF0ZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBub3JtYWxBcHBlYXJhbmNlID0gYXBwZWFyYW5jZVN0YXRlcy5nZXQoIk4iKTsKICAgIGlmICghKG5vcm1hbEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBvZiBub3JtYWxBcHBlYXJhbmNlLmdldEtleXMoKSkgewogICAgICBpZiAoa2V5ICE9PSAiT2ZmIikgewogICAgICAgIHRoaXMuZGF0YS5idXR0b25WYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShrZXkpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KHRoaXMuZGF0YS5idXR0b25WYWx1ZSk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlID0gY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gY2hlY2tlZEFwcGVhcmFuY2UgOiBudWxsOwogICAgY29uc3QgdW5jaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KCJPZmYiKTsKICAgIHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSA9IHVuY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gdW5jaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBpZiAodGhpcy5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5jaGVja2VkQXBwZWFyYW5jZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9nZXREZWZhdWx0Q2hlY2tlZEFwcGVhcmFuY2UocGFyYW1zLCAiZGlzYyIpOwogICAgfQogICAgaWYgKHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0KICAgIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSB0aGlzLmZhbGxiYWNrRm9udERpY3Q7CiAgICBpZiAodGhpcy5kYXRhLmRlZmF1bHRGaWVsZFZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9ICJPZmYiOwogICAgfQogIH0KICBfcHJvY2Vzc1B1c2hCdXR0b24ocGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIGFubm90YXRpb25HbG9iYWxzCiAgICB9ID0gcGFyYW1zOwogICAgaWYgKCFkaWN0LmhhcygiQSIpICYmICFkaWN0LmhhcygiQUEiKSAmJiAhdGhpcy5kYXRhLmFsdGVybmF0aXZlVGV4dCkgewogICAgICB3YXJuKCJQdXNoIGJ1dHRvbnMgd2l0aG91dCBhY3Rpb24gZGljdGlvbmFyaWVzIGFyZSBub3Qgc3VwcG9ydGVkIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZGF0YS5pc1Rvb2x0aXBPbmx5ID0gIWRpY3QuaGFzKCJBIikgJiYgIWRpY3QuaGFzKCJBQSIpOwogICAgQ2F0YWxvZy5wYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgICAgZGVzdERpY3Q6IGRpY3QsCiAgICAgIHJlc3VsdE9iajogdGhpcy5kYXRhLAogICAgICBkb2NCYXNlVXJsOiBhbm5vdGF0aW9uR2xvYmFscy5iYXNlVXJsLAogICAgICBkb2NBdHRhY2htZW50czogYW5ub3RhdGlvbkdsb2JhbHMuYXR0YWNobWVudHMKICAgIH0pOwogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIGxldCB0eXBlID0gImJ1dHRvbiI7CiAgICBsZXQgZXhwb3J0VmFsdWVzOwogICAgaWYgKHRoaXMuZGF0YS5jaGVja0JveCkgewogICAgICB0eXBlID0gImNoZWNrYm94IjsKICAgICAgZXhwb3J0VmFsdWVzID0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlOwogICAgfSBlbHNlIGlmICh0aGlzLmRhdGEucmFkaW9CdXR0b24pIHsKICAgICAgdHlwZSA9ICJyYWRpb2J1dHRvbiI7CiAgICAgIGV4cG9ydFZhbHVlcyA9IHRoaXMuZGF0YS5idXR0b25WYWx1ZTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgIHZhbHVlOiB0aGlzLmRhdGEuZmllbGRWYWx1ZSB8fCAiT2ZmIiwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUsCiAgICAgIGV4cG9ydFZhbHVlcywKICAgICAgZWRpdGFibGU6ICF0aGlzLmRhdGEucmVhZE9ubHksCiAgICAgIG5hbWU6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHJlY3Q6IHRoaXMuZGF0YS5yZWN0LAogICAgICBoaWRkZW46IHRoaXMuZGF0YS5oaWRkZW4sCiAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICB0eXBlCiAgICB9OwogIH0KICBnZXQgZmFsbGJhY2tGb250RGljdCgpIHsKICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCgpOwogICAgZGljdC5zZXRJZk5hbWUoIkJhc2VGb250IiwgIlphcGZEaW5nYmF0cyIpOwogICAgZGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiRmFsbGJhY2tUeXBlIik7CiAgICBkaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGYWxsYmFja1R5cGUiKTsKICAgIGRpY3Quc2V0SWZOYW1lKCJFbmNvZGluZyIsICJaYXBmRGluZ2JhdHNFbmNvZGluZyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZmFsbGJhY2tGb250RGljdCIsIGRpY3QpOwogIH0KfQpjbGFzcyBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uIGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5pbmRpY2VzID0gZGljdC5nZXRBcnJheSgiSSIpOwogICAgdGhpcy5oYXNJbmRpY2VzID0gQXJyYXkuaXNBcnJheSh0aGlzLmluZGljZXMpICYmIHRoaXMuaW5kaWNlcy5sZW5ndGggPiAwOwogICAgdGhpcy5kYXRhLm9wdGlvbnMgPSBbXTsKICAgIGNvbnN0IG9wdGlvbnMgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdCwKICAgICAga2V5OiAiT3B0IgogICAgfSk7CiAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zKSkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBvcHRpb25zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBvcHRpb24gPSB4cmVmLmZldGNoSWZSZWYob3B0aW9uc1tpXSk7CiAgICAgICAgY29uc3QgaXNPcHRpb25BcnJheSA9IEFycmF5LmlzQXJyYXkob3B0aW9uKTsKICAgICAgICB0aGlzLmRhdGEub3B0aW9uc1tpXSA9IHsKICAgICAgICAgIGV4cG9ydFZhbHVlOiB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoaXNPcHRpb25BcnJheSA/IHhyZWYuZmV0Y2hJZlJlZihvcHRpb25bMF0pIDogb3B0aW9uKSwKICAgICAgICAgIGRpc3BsYXlWYWx1ZTogdGhpcy5fZGVjb2RlRm9ybVZhbHVlKGlzT3B0aW9uQXJyYXkgPyB4cmVmLmZldGNoSWZSZWYob3B0aW9uWzFdKSA6IG9wdGlvbikKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuaGFzSW5kaWNlcykgewogICAgICBpZiAodHlwZW9mIHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSAic3RyaW5nIikgewogICAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gW3RoaXMuZGF0YS5maWVsZFZhbHVlXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSB8fD0gW107CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gW107CiAgICAgIGNvbnN0IGlpID0gdGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoOwogICAgICBmb3IgKGNvbnN0IGkgb2YgdGhpcy5pbmRpY2VzKSB7CiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoaSkgJiYgaSA+PSAwICYmIGkgPCBpaSkgewogICAgICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUucHVzaCh0aGlzLmRhdGEub3B0aW9uc1tpXS5leHBvcnRWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoID09PSAwICYmIHRoaXMuZGF0YS5maWVsZFZhbHVlLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5kYXRhLm9wdGlvbnMgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZS5tYXAodmFsdWUgPT4gKHsKICAgICAgICBleHBvcnRWYWx1ZTogdmFsdWUsCiAgICAgICAgZGlzcGxheVZhbHVlOiB2YWx1ZQogICAgICB9KSk7CiAgICB9CiAgICB0aGlzLmRhdGEuY29tYm8gPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLkNPTUJPKTsKICAgIHRoaXMuZGF0YS5tdWx0aVNlbGVjdCA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuTVVMVElTRUxFQ1QpOwogICAgdGhpcy5faGFzVGV4dCA9IHRydWU7CiAgfQogIGdldEZpZWxkT2JqZWN0KCkgewogICAgY29uc3QgdHlwZSA9IHRoaXMuZGF0YS5jb21ibyA/ICJjb21ib2JveCIgOiAibGlzdGJveCI7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlLmxlbmd0aCA+IDAgPyB0aGlzLmRhdGEuZmllbGRWYWx1ZVswXSA6IG51bGw7CiAgICByZXR1cm4gewogICAgICBpZDogdGhpcy5kYXRhLmlkLAogICAgICB2YWx1ZSwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUsCiAgICAgIGVkaXRhYmxlOiAhdGhpcy5kYXRhLnJlYWRPbmx5LAogICAgICBuYW1lOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICByZWN0OiB0aGlzLmRhdGEucmVjdCwKICAgICAgbnVtSXRlbXM6IHRoaXMuZGF0YS5maWVsZFZhbHVlLmxlbmd0aCwKICAgICAgbXVsdGlwbGVTZWxlY3Rpb246IHRoaXMuZGF0YS5tdWx0aVNlbGVjdCwKICAgICAgaGlkZGVuOiB0aGlzLmRhdGEuaGlkZGVuLAogICAgICBhY3Rpb25zOiB0aGlzLmRhdGEuYWN0aW9ucywKICAgICAgaXRlbXM6IHRoaXMuZGF0YS5vcHRpb25zLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICB0eXBlCiAgICB9OwogIH0KICBhbWVuZFNhdmVkRGljdChhbm5vdGF0aW9uU3RvcmFnZSwgZGljdCkgewogICAgaWYgKCF0aGlzLmhhc0luZGljZXMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IHZhbHVlcyA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKT8udmFsdWU7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWVzKSkgewogICAgICB2YWx1ZXMgPSBbdmFsdWVzXTsKICAgIH0KICAgIGNvbnN0IGluZGljZXMgPSBbXTsKICAgIGNvbnN0IHsKICAgICAgb3B0aW9ucwogICAgfSA9IHRoaXMuZGF0YTsKICAgIGZvciAobGV0IGkgPSAwLCBqID0gMCwgaWkgPSBvcHRpb25zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgaWYgKG9wdGlvbnNbaV0uZXhwb3J0VmFsdWUgPT09IHZhbHVlc1tqXSkgewogICAgICAgIGluZGljZXMucHVzaChpKTsKICAgICAgICBqICs9IDE7CiAgICAgIH0KICAgIH0KICAgIGRpY3Quc2V0KCJJIiwgaW5kaWNlcyk7CiAgfQogIGFzeW5jIF9nZXRBcHBlYXJhbmNlKGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgaWYgKHRoaXMuZGF0YS5jb21ibykgewogICAgICByZXR1cm4gc3VwZXIuX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGxldCBleHBvcnRlZFZhbHVlLCByb3RhdGlvbjsKICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKTsKICAgIGlmIChzdG9yYWdlRW50cnkpIHsKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnkucm90YXRpb247CiAgICAgIGV4cG9ydGVkVmFsdWUgPSBzdG9yYWdlRW50cnkudmFsdWU7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiBleHBvcnRlZFZhbHVlID09PSB1bmRlZmluZWQgJiYgIXRoaXMuX25lZWRBcHBlYXJhbmNlcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChleHBvcnRlZFZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgZXhwb3J0ZWRWYWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlOwogICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShleHBvcnRlZFZhbHVlKSkgewogICAgICBleHBvcnRlZFZhbHVlID0gW2V4cG9ydGVkVmFsdWVdOwogICAgfQogICAgY29uc3QgZGVmYXVsdFBhZGRpbmcgPSAxOwogICAgY29uc3QgZGVmYXVsdEhQYWRkaW5nID0gMjsKICAgIGxldCB7CiAgICAgIHdpZHRoOiB0b3RhbFdpZHRoLAogICAgICBoZWlnaHQ6IHRvdGFsSGVpZ2h0CiAgICB9ID0gdGhpczsKICAgIGlmIChyb3RhdGlvbiA9PT0gOTAgfHwgcm90YXRpb24gPT09IDI3MCkgewogICAgICBbdG90YWxXaWR0aCwgdG90YWxIZWlnaHRdID0gW3RvdGFsSGVpZ2h0LCB0b3RhbFdpZHRoXTsKICAgIH0KICAgIGNvbnN0IGxpbmVDb3VudCA9IHRoaXMuZGF0YS5vcHRpb25zLmxlbmd0aDsKICAgIGNvbnN0IHZhbHVlSW5kaWNlcyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lQ291bnQ7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgZXhwb3J0VmFsdWUKICAgICAgfSA9IHRoaXMuZGF0YS5vcHRpb25zW2ldOwogICAgICBpZiAoZXhwb3J0ZWRWYWx1ZS5pbmNsdWRlcyhleHBvcnRWYWx1ZSkpIHsKICAgICAgICB2YWx1ZUluZGljZXMucHVzaChpKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSkgewogICAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhID0gcGFyc2VEZWZhdWx0QXBwZWFyYW5jZSh0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSA9ICIvSGVsdmV0aWNhIDAgVGYgMCBnIik7CiAgICB9CiAgICBjb25zdCBmb250ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLCB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMpOwogICAgbGV0IGRlZmF1bHRBcHBlYXJhbmNlOwogICAgbGV0IHsKICAgICAgZm9udFNpemUKICAgIH0gPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhOwogICAgaWYgKCFmb250U2l6ZSkgewogICAgICBjb25zdCBsaW5lSGVpZ2h0ID0gKHRvdGFsSGVpZ2h0IC0gZGVmYXVsdFBhZGRpbmcpIC8gbGluZUNvdW50OwogICAgICBsZXQgbGluZVdpZHRoID0gLTE7CiAgICAgIGxldCB2YWx1ZTsKICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgZGlzcGxheVZhbHVlCiAgICAgIH0gb2YgdGhpcy5kYXRhLm9wdGlvbnMpIHsKICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX2dldFRleHRXaWR0aChkaXNwbGF5VmFsdWUsIGZvbnQpOwogICAgICAgIGlmICh3aWR0aCA+IGxpbmVXaWR0aCkgewogICAgICAgICAgbGluZVdpZHRoID0gd2lkdGg7CiAgICAgICAgICB2YWx1ZSA9IGRpc3BsYXlWYWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgW2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZV0gPSB0aGlzLl9jb21wdXRlRm9udFNpemUobGluZUhlaWdodCwgdG90YWxXaWR0aCAtIDIgKiBkZWZhdWx0SFBhZGRpbmcsIHZhbHVlLCBmb250LCAtMSk7CiAgICB9IGVsc2UgewogICAgICBkZWZhdWx0QXBwZWFyYW5jZSA9IHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlOwogICAgfQogICAgY29uc3QgbGluZUhlaWdodCA9IGZvbnRTaXplICogTElORV9GQUNUT1I7CiAgICBjb25zdCB2UGFkZGluZyA9IChsaW5lSGVpZ2h0IC0gZm9udFNpemUpIC8gMjsKICAgIGNvbnN0IG51bWJlck9mVmlzaWJsZUxpbmVzID0gTWF0aC5mbG9vcih0b3RhbEhlaWdodCAvIGxpbmVIZWlnaHQpOwogICAgbGV0IGZpcnN0SW5kZXggPSAwOwogICAgaWYgKHZhbHVlSW5kaWNlcy5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IG1pbkluZGV4ID0gTWF0aC5taW4oLi4udmFsdWVJbmRpY2VzKTsKICAgICAgY29uc3QgbWF4SW5kZXggPSBNYXRoLm1heCguLi52YWx1ZUluZGljZXMpOwogICAgICBmaXJzdEluZGV4ID0gTWF0aC5tYXgoMCwgbWF4SW5kZXggLSBudW1iZXJPZlZpc2libGVMaW5lcyArIDEpOwogICAgICBpZiAoZmlyc3RJbmRleCA+IG1pbkluZGV4KSB7CiAgICAgICAgZmlyc3RJbmRleCA9IG1pbkluZGV4OwogICAgICB9CiAgICB9CiAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihmaXJzdEluZGV4ICsgbnVtYmVyT2ZWaXNpYmxlTGluZXMgKyAxLCBsaW5lQ291bnQpOwogICAgY29uc3QgYnVmID0gWyIvVHggQk1DIHEiLCBgMSAxICR7dG90YWxXaWR0aH0gJHt0b3RhbEhlaWdodH0gcmUgVyBuYF07CiAgICBpZiAodmFsdWVJbmRpY2VzLmxlbmd0aCkgewogICAgICBidWYucHVzaCgiMC42MDAwMDYgMC43NTY4NjYgMC44NTQ5MDQgcmciKTsKICAgICAgZm9yIChjb25zdCBpbmRleCBvZiB2YWx1ZUluZGljZXMpIHsKICAgICAgICBpZiAoZmlyc3RJbmRleCA8PSBpbmRleCAmJiBpbmRleCA8IGVuZCkgewogICAgICAgICAgYnVmLnB1c2goYDEgJHt0b3RhbEhlaWdodCAtIChpbmRleCAtIGZpcnN0SW5kZXggKyAxKSAqIGxpbmVIZWlnaHR9ICR7dG90YWxXaWR0aH0gJHtsaW5lSGVpZ2h0fSByZSBmYCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBidWYucHVzaCgiQlQiLCBkZWZhdWx0QXBwZWFyYW5jZSwgYDEgMCAwIDEgMCAke3RvdGFsSGVpZ2h0fSBUbWApOwogICAgY29uc3QgcHJldkluZm8gPSB7CiAgICAgIHNoaWZ0OiAwCiAgICB9OwogICAgZm9yIChsZXQgaSA9IGZpcnN0SW5kZXg7IGkgPCBlbmQ7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgZGlzcGxheVZhbHVlCiAgICAgIH0gPSB0aGlzLmRhdGEub3B0aW9uc1tpXTsKICAgICAgY29uc3QgdnBhZGRpbmcgPSBpID09PSBmaXJzdEluZGV4ID8gdlBhZGRpbmcgOiAwOwogICAgICBidWYucHVzaCh0aGlzLl9yZW5kZXJUZXh0KGRpc3BsYXlWYWx1ZSwgZm9udCwgZm9udFNpemUsIHRvdGFsV2lkdGgsIDAsIHByZXZJbmZvLCBkZWZhdWx0SFBhZGRpbmcsIC1saW5lSGVpZ2h0ICsgdnBhZGRpbmcpKTsKICAgIH0KICAgIGJ1Zi5wdXNoKCJFVCBRIEVNQyIpOwogICAgcmV0dXJuIGJ1Zi5qb2luKCJcbiIpOwogIH0KfQpjbGFzcyBTaWduYXR1cmVXaWRnZXRBbm5vdGF0aW9uIGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBudWxsOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSAhdGhpcy5kYXRhLmhhc093bkNhbnZhczsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICByZXR1cm4gewogICAgICBpZDogdGhpcy5kYXRhLmlkLAogICAgICB2YWx1ZTogbnVsbCwKICAgICAgcGFnZTogdGhpcy5kYXRhLnBhZ2VJbmRleCwKICAgICAgdHlwZTogInNpZ25hdHVyZSIKICAgIH07CiAgfQp9CmNsYXNzIFRleHRBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBjb25zdCBERUZBVUxUX0lDT05fU0laRSA9IDIyOwogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5ub1JvdGF0ZSA9IHRydWU7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgY29uc3QgewogICAgICBkaWN0CiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuVEVYVDsKICAgIGlmICh0aGlzLmRhdGEuaGFzQXBwZWFyYW5jZSkgewogICAgICB0aGlzLmRhdGEubmFtZSA9ICJOb0ljb24iOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnJlY3RbMV0gPSB0aGlzLmRhdGEucmVjdFszXSAtIERFRkFVTFRfSUNPTl9TSVpFOwogICAgICB0aGlzLmRhdGEucmVjdFsyXSA9IHRoaXMuZGF0YS5yZWN0WzBdICsgREVGQVVMVF9JQ09OX1NJWkU7CiAgICAgIHRoaXMuZGF0YS5uYW1lID0gZGljdC5oYXMoIk5hbWUiKSA/IGRpY3QuZ2V0KCJOYW1lIikubmFtZSA6ICJOb3RlIjsKICAgIH0KICAgIGlmIChkaWN0LmhhcygiU3RhdGUiKSkgewogICAgICB0aGlzLmRhdGEuc3RhdGUgPSBkaWN0LmdldCgiU3RhdGUiKSB8fCBudWxsOwogICAgICB0aGlzLmRhdGEuc3RhdGVNb2RlbCA9IGRpY3QuZ2V0KCJTdGF0ZU1vZGVsIikgfHwgbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5zdGF0ZSA9IG51bGw7CiAgICAgIHRoaXMuZGF0YS5zdGF0ZU1vZGVsID0gbnVsbDsKICAgIH0KICB9Cn0KY2xhc3MgTGlua0Fubm90YXRpb24gZXh0ZW5kcyBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIGFubm90YXRpb25HbG9iYWxzCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuTElOSzsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzKGRpY3QsIHRoaXMucmVjdGFuZ2xlKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gcXVhZFBvaW50czsKICAgIH0KICAgIHRoaXMuZGF0YS5ib3JkZXJDb2xvciB8fD0gdGhpcy5kYXRhLmNvbG9yOwogICAgQ2F0YWxvZy5wYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgICAgZGVzdERpY3Q6IGRpY3QsCiAgICAgIHJlc3VsdE9iajogdGhpcy5kYXRhLAogICAgICBkb2NCYXNlVXJsOiBhbm5vdGF0aW9uR2xvYmFscy5iYXNlVXJsLAogICAgICBkb2NBdHRhY2htZW50czogYW5ub3RhdGlvbkdsb2JhbHMuYXR0YWNobWVudHMKICAgIH0pOwogIH0KICBnZXQgb3ZlcmxheXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBQb3B1cEFubm90YXRpb24gZXh0ZW5kcyBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5QT1BVUDsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIGlmICh0aGlzLndpZHRoID09PSAwIHx8IHRoaXMuaGVpZ2h0ID09PSAwKSB7CiAgICAgIHRoaXMuZGF0YS5yZWN0ID0gbnVsbDsKICAgIH0KICAgIGxldCBwYXJlbnRJdGVtID0gZGljdC5nZXQoIlBhcmVudCIpOwogICAgaWYgKCFwYXJlbnRJdGVtKSB7CiAgICAgIHdhcm4oIlBvcHVwIGFubm90YXRpb24gaGFzIGEgbWlzc2luZyBvciBpbnZhbGlkIHBhcmVudCBhbm5vdGF0aW9uLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmRhdGEucGFyZW50UmVjdCA9IGxvb2t1cE5vcm1hbFJlY3QocGFyZW50SXRlbS5nZXRBcnJheSgiUmVjdCIpLCBudWxsKTsKICAgIHRoaXMuZGF0YS5jcmVhdGlvbkRhdGUgPSBwYXJlbnRJdGVtLmdldCgiQ3JlYXRpb25EYXRlIikgfHwgIiI7CiAgICBjb25zdCBydCA9IHBhcmVudEl0ZW0uZ2V0KCJSVCIpOwogICAgaWYgKGlzTmFtZShydCwgQW5ub3RhdGlvblJlcGx5VHlwZS5HUk9VUCkpIHsKICAgICAgcGFyZW50SXRlbSA9IHBhcmVudEl0ZW0uZ2V0KCJJUlQiKTsKICAgIH0KICAgIGlmICghcGFyZW50SXRlbS5oYXMoIk0iKSkgewogICAgICB0aGlzLmRhdGEubW9kaWZpY2F0aW9uRGF0ZSA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNldE1vZGlmaWNhdGlvbkRhdGUocGFyZW50SXRlbS5nZXQoIk0iKSk7CiAgICAgIHRoaXMuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gdGhpcy5tb2RpZmljYXRpb25EYXRlOwogICAgfQogICAgaWYgKCFwYXJlbnRJdGVtLmhhcygiQyIpKSB7CiAgICAgIHRoaXMuZGF0YS5jb2xvciA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNldENvbG9yKHBhcmVudEl0ZW0uZ2V0QXJyYXkoIkMiKSk7CiAgICAgIHRoaXMuZGF0YS5jb2xvciA9IHRoaXMuY29sb3I7CiAgICB9CiAgICBpZiAoIXRoaXMudmlld2FibGUpIHsKICAgICAgY29uc3QgcGFyZW50RmxhZ3MgPSBwYXJlbnRJdGVtLmdldCgiRiIpOwogICAgICBpZiAodGhpcy5faXNWaWV3YWJsZShwYXJlbnRGbGFncykpIHsKICAgICAgICB0aGlzLnNldEZsYWdzKHBhcmVudEZsYWdzKTsKICAgICAgfQogICAgfQogICAgdGhpcy5zZXRUaXRsZShwYXJlbnRJdGVtLmdldCgiVCIpKTsKICAgIHRoaXMuZGF0YS50aXRsZU9iaiA9IHRoaXMuX3RpdGxlOwogICAgdGhpcy5zZXRDb250ZW50cyhwYXJlbnRJdGVtLmdldCgiQ29udGVudHMiKSk7CiAgICB0aGlzLmRhdGEuY29udGVudHNPYmogPSB0aGlzLl9jb250ZW50czsKICAgIGlmIChwYXJlbnRJdGVtLmhhcygiUkMiKSkgewogICAgICB0aGlzLmRhdGEucmljaFRleHQgPSBYRkFGYWN0b3J5LmdldFJpY2hUZXh0QXNIdG1sKHBhcmVudEl0ZW0uZ2V0KCJSQyIpKTsKICAgIH0KICAgIHRoaXMuZGF0YS5vcGVuID0gISFkaWN0LmdldCgiT3BlbiIpOwogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCBfcGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIG9sZEFubm90YXRpb24sCiAgICAgIHJlY3QsCiAgICAgIHBhcmVudAogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBwb3B1cCA9IG9sZEFubm90YXRpb24gfHwgbmV3IERpY3QoeHJlZik7CiAgICBwb3B1cC5zZXRJZk5vdEV4aXN0cygiVHlwZSIsIE5hbWUuZ2V0KCJBbm5vdCIpKTsKICAgIHBvcHVwLnNldElmTm90RXhpc3RzKCJTdWJ0eXBlIiwgTmFtZS5nZXQoIlBvcHVwIikpOwogICAgcG9wdXAuc2V0SWZOb3RFeGlzdHMoIk9wZW4iLCBmYWxzZSk7CiAgICBwb3B1cC5zZXRJZkFycmF5KCJSZWN0IiwgcmVjdCk7CiAgICBwb3B1cC5zZXQoIlBhcmVudCIsIHBhcmVudCk7CiAgICByZXR1cm4gcG9wdXA7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CmNsYXNzIEZyZWVUZXh0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEuaXNFZGl0YWJsZSA9ICF0aGlzLmRhdGEubm9IVE1MOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgY29uc3QgewogICAgICBhbm5vdGF0aW9uR2xvYmFscywKICAgICAgZXZhbHVhdG9yT3B0aW9ucywKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLkZSRUVURVhUOwogICAgdGhpcy5zZXREZWZhdWx0QXBwZWFyYW5jZShwYXJhbXMpOwogICAgdGhpcy5faGFzQXBwZWFyYW5jZSA9ICEhdGhpcy5hcHBlYXJhbmNlOwogICAgaWYgKHRoaXMuX2hhc0FwcGVhcmFuY2UpIHsKICAgICAgY29uc3QgewogICAgICAgIGZvbnRDb2xvciwKICAgICAgICBmb250U2l6ZQogICAgICB9ID0gcGFyc2VBcHBlYXJhbmNlU3RyZWFtKHRoaXMuYXBwZWFyYW5jZSwgZXZhbHVhdG9yT3B0aW9ucywgeHJlZiwgYW5ub3RhdGlvbkdsb2JhbHMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YS5mb250Q29sb3IgPSBmb250Q29sb3I7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udFNpemUgPSBmb250U2l6ZSB8fCAxMDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udFNpemUgfHw9IDEwOwogICAgICBjb25zdCB7CiAgICAgICAgZm9udENvbG9yLAogICAgICAgIGZvbnRTaXplCiAgICAgIH0gPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhOwogICAgICBpZiAodGhpcy5fY29udGVudHMuc3RyKSB7CiAgICAgICAgdGhpcy5kYXRhLnRleHRDb250ZW50ID0gdGhpcy5fY29udGVudHMuc3RyLnNwbGl0KC9cclxuP3xcbi8pLm1hcChsaW5lID0+IGxpbmUudHJpbUVuZCgpKTsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjb29yZHMsCiAgICAgICAgICBiYm94LAogICAgICAgICAgbWF0cml4CiAgICAgICAgfSA9IEZha2VVbmljb2RlRm9udC5nZXRGaXJzdFBvc2l0aW9uSW5mbyh0aGlzLnJlY3RhbmdsZSwgdGhpcy5yb3RhdGlvbiwgZm9udFNpemUpOwogICAgICAgIHRoaXMuZGF0YS50ZXh0UG9zaXRpb24gPSB0aGlzLl90cmFuc2Zvcm1Qb2ludChjb29yZHMsIGJib3gsIG1hdHJpeCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX2lzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBwYXJhbXMuZGljdC5nZXQoIkNBIik7CiAgICAgICAgY29uc3QgZmFrZVVuaWNvZGVGb250ID0gbmV3IEZha2VVbmljb2RlRm9udCh4cmVmLCAic2Fucy1zZXJpZiIpOwogICAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IGZha2VVbmljb2RlRm9udC5jcmVhdGVBcHBlYXJhbmNlKHRoaXMuX2NvbnRlbnRzLnN0ciwgdGhpcy5yZWN0YW5nbGUsIHRoaXMucm90YXRpb24sIGZvbnRTaXplLCBmb250Q29sb3IsIHN0cm9rZUFscGhhKTsKICAgICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5hcHBlYXJhbmNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJGcmVlVGV4dEFubm90YXRpb246IE9mZnNjcmVlbkNhbnZhcyBpcyBub3Qgc3VwcG9ydGVkLCBhbm5vdGF0aW9uIG1heSBub3QgcmVuZGVyIGNvcnJlY3RseS4iKTsKICAgICAgfQogICAgfQogIH0KICBnZXQgaGFzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdGhpcy5faGFzQXBwZWFyYW5jZTsKICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIGRhdGUsCiAgICAgIGZvbnRTaXplLAogICAgICBvbGRBbm5vdGF0aW9uLAogICAgICByZWN0LAogICAgICByb3RhdGlvbiwKICAgICAgdXNlciwKICAgICAgdmFsdWUKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgY29uc3QgZnJlZXRleHQgPSBvbGRBbm5vdGF0aW9uIHx8IG5ldyBEaWN0KHhyZWYpOwogICAgZnJlZXRleHQuc2V0SWZOb3RFeGlzdHMoIlR5cGUiLCBOYW1lLmdldCgiQW5ub3QiKSk7CiAgICBmcmVldGV4dC5zZXRJZk5vdEV4aXN0cygiU3VidHlwZSIsIE5hbWUuZ2V0KCJGcmVlVGV4dCIpKTsKICAgIGZyZWV0ZXh0LnNldChvbGRBbm5vdGF0aW9uID8gIk0iIDogIkNyZWF0aW9uRGF0ZSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZShkYXRlKX1gKTsKICAgIGlmIChvbGRBbm5vdGF0aW9uKSB7CiAgICAgIGZyZWV0ZXh0LmRlbGV0ZSgiUkMiKTsKICAgIH0KICAgIGZyZWV0ZXh0LnNldElmQXJyYXkoIlJlY3QiLCByZWN0KTsKICAgIGNvbnN0IGRhID0gYC9IZWx2ICR7Zm9udFNpemV9IFRmICR7Z2V0UGRmQ29sb3IoY29sb3IsIHRydWUpfWA7CiAgICBmcmVldGV4dC5zZXQoIkRBIiwgZGEpOwogICAgZnJlZXRleHQuc2V0SWZEZWZpbmVkKCJDb250ZW50cyIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodmFsdWUpKTsKICAgIGZyZWV0ZXh0LnNldElmTm90RXhpc3RzKCJGIiwgNCk7CiAgICBmcmVldGV4dC5zZXRJZk5vdEV4aXN0cygiQm9yZGVyIiwgWzAsIDAsIDBdKTsKICAgIGZyZWV0ZXh0LnNldElmTnVtYmVyKCJSb3RhdGUiLCByb3RhdGlvbik7CiAgICBmcmVldGV4dC5zZXRJZkRlZmluZWQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHVzZXIpKTsKICAgIGlmIChhcFJlZiB8fCBhcCkgewogICAgICBjb25zdCBuID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGZyZWV0ZXh0LnNldCgiQVAiLCBuKTsKICAgICAgbi5zZXQoIk4iLCBhcFJlZiB8fCBhcCk7CiAgICB9CiAgICByZXR1cm4gZnJlZXRleHQ7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgY29uc3QgewogICAgICBiYXNlRm9udFJlZiwKICAgICAgZXZhbHVhdG9yLAogICAgICB0YXNrCiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgZm9udFNpemUsCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB2YWx1ZQogICAgfSA9IGFubm90YXRpb247CiAgICBpZiAoIWNvbG9yKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCBmb250ID0gbmV3IERpY3QoeHJlZik7CiAgICBpZiAoYmFzZUZvbnRSZWYpIHsKICAgICAgZm9udC5zZXQoIkhlbHYiLCBiYXNlRm9udFJlZik7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBiYXNlRm9udCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIkJhc2VGb250IiwgIkhlbHZldGljYSIpOwogICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlR5cGUiLCAiRm9udCIpOwogICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiVHlwZTEiKTsKICAgICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJFbmNvZGluZyIsICJXaW5BbnNpRW5jb2RpbmciKTsKICAgICAgZm9udC5zZXQoIkhlbHYiLCBiYXNlRm9udCk7CiAgICB9CiAgICByZXNvdXJjZXMuc2V0KCJGb250IiwgZm9udCk7CiAgICBjb25zdCBoZWx2ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB7CiAgICAgIGZvbnROYW1lOiAiSGVsdiIsCiAgICAgIGZvbnRTaXplCiAgICB9LCByZXNvdXJjZXMpOwogICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IHJlY3Q7CiAgICBsZXQgdyA9IHgyIC0geDE7CiAgICBsZXQgaCA9IHkyIC0geTE7CiAgICBpZiAocm90YXRpb24gJSAxODAgIT09IDApIHsKICAgICAgW3csIGhdID0gW2gsIHddOwogICAgfQogICAgY29uc3QgbGluZXMgPSB2YWx1ZS5zcGxpdCgiXG4iKTsKICAgIGNvbnN0IHNjYWxlID0gZm9udFNpemUgLyAxMDAwOwogICAgbGV0IHRvdGFsV2lkdGggPSAtSW5maW5pdHk7CiAgICBjb25zdCBlbmNvZGVkTGluZXMgPSBbXTsKICAgIGZvciAobGV0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgY29uc3QgZW5jb2RlZCA9IGhlbHYuZW5jb2RlU3RyaW5nKGxpbmUpOwogICAgICBpZiAoZW5jb2RlZC5sZW5ndGggPiAxKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgbGluZSA9IGVuY29kZWQuam9pbigiIik7CiAgICAgIGVuY29kZWRMaW5lcy5wdXNoKGxpbmUpOwogICAgICBsZXQgbGluZVdpZHRoID0gMDsKICAgICAgY29uc3QgZ2x5cGhzID0gaGVsdi5jaGFyc1RvR2x5cGhzKGxpbmUpOwogICAgICBmb3IgKGNvbnN0IGdseXBoIG9mIGdseXBocykgewogICAgICAgIGxpbmVXaWR0aCArPSBnbHlwaC53aWR0aCAqIHNjYWxlOwogICAgICB9CiAgICAgIHRvdGFsV2lkdGggPSBNYXRoLm1heCh0b3RhbFdpZHRoLCBsaW5lV2lkdGgpOwogICAgfQogICAgbGV0IGhzY2FsZSA9IDE7CiAgICBpZiAodG90YWxXaWR0aCA+IHcpIHsKICAgICAgaHNjYWxlID0gdyAvIHRvdGFsV2lkdGg7CiAgICB9CiAgICBsZXQgdnNjYWxlID0gMTsKICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBMSU5FX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgY29uc3QgbGluZUFzY2VudCA9IChMSU5FX0ZBQ1RPUiAtIExJTkVfREVTQ0VOVF9GQUNUT1IpICogZm9udFNpemU7CiAgICBjb25zdCB0b3RhbEhlaWdodCA9IGxpbmVIZWlnaHQgKiBsaW5lcy5sZW5ndGg7CiAgICBpZiAodG90YWxIZWlnaHQgPiBoKSB7CiAgICAgIHZzY2FsZSA9IGggLyB0b3RhbEhlaWdodDsKICAgIH0KICAgIGNvbnN0IGZzY2FsZSA9IE1hdGgubWluKGhzY2FsZSwgdnNjYWxlKTsKICAgIGNvbnN0IG5ld0ZvbnRTaXplID0gZm9udFNpemUgKiBmc2NhbGU7CiAgICBsZXQgZmlyc3RQb2ludCwgY2xpcEJveCwgbWF0cml4OwogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDA6CiAgICAgICAgbWF0cml4ID0gWzEsIDAsIDAsIDFdOwogICAgICAgIGNsaXBCb3ggPSBbcmVjdFswXSwgcmVjdFsxXSwgdywgaF07CiAgICAgICAgZmlyc3RQb2ludCA9IFtyZWN0WzBdLCByZWN0WzNdIC0gbGluZUFzY2VudF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgbWF0cml4ID0gWzAsIDEsIC0xLCAwXTsKICAgICAgICBjbGlwQm94ID0gW3JlY3RbMV0sIC1yZWN0WzJdLCB3LCBoXTsKICAgICAgICBmaXJzdFBvaW50ID0gW3JlY3RbMV0sIC1yZWN0WzBdIC0gbGluZUFzY2VudF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMTgwOgogICAgICAgIG1hdHJpeCA9IFstMSwgMCwgMCwgLTFdOwogICAgICAgIGNsaXBCb3ggPSBbLXJlY3RbMl0sIC1yZWN0WzNdLCB3LCBoXTsKICAgICAgICBmaXJzdFBvaW50ID0gWy1yZWN0WzJdLCAtcmVjdFsxXSAtIGxpbmVBc2NlbnRdOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI3MDoKICAgICAgICBtYXRyaXggPSBbMCwgLTEsIDEsIDBdOwogICAgICAgIGNsaXBCb3ggPSBbLXJlY3RbM10sIHJlY3RbMF0sIHcsIGhdOwogICAgICAgIGZpcnN0UG9pbnQgPSBbLXJlY3RbM10sIHJlY3RbMl0gLSBsaW5lQXNjZW50XTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlciA9IFsicSIsIGAke21hdHJpeC5qb2luKCIgIil9IDAgMCBjbWAsIGAke2NsaXBCb3guam9pbigiICIpfSByZSBXIG5gLCBgQlRgLCBgJHtnZXRQZGZDb2xvcihjb2xvciwgdHJ1ZSl9YCwgYDAgVGMgL0hlbHYgJHtudW1iZXJUb1N0cmluZyhuZXdGb250U2l6ZSl9IFRmYF07CiAgICBidWZmZXIucHVzaChgJHtmaXJzdFBvaW50LmpvaW4oIiAiKX0gVGQgKCR7ZXNjYXBlU3RyaW5nKGVuY29kZWRMaW5lc1swXSl9KSBUamApOwogICAgY29uc3QgdlNoaWZ0ID0gbnVtYmVyVG9TdHJpbmcobGluZUhlaWdodCk7CiAgICBmb3IgKGxldCBpID0gMSwgaWkgPSBlbmNvZGVkTGluZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBsaW5lID0gZW5jb2RlZExpbmVzW2ldOwogICAgICBidWZmZXIucHVzaChgMCAtJHt2U2hpZnR9IFRkICgke2VzY2FwZVN0cmluZyhsaW5lKX0pIFRqYCk7CiAgICB9CiAgICBidWZmZXIucHVzaCgiRVQiLCAiUSIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgcmVjdCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIk1hdHJpeCIsIFsxLCAwLCAwLCAxLCAtcmVjdFswXSwgLXJlY3RbMV1dKTsKICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9Cn0KY2xhc3MgTGluZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5MSU5FOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIGNvbnN0IGxpbmVDb29yZGluYXRlcyA9IGxvb2t1cFJlY3QoZGljdC5nZXRBcnJheSgiTCIpLCBbMCwgMCwgMCwgMF0pOwogICAgdGhpcy5kYXRhLmxpbmVDb29yZGluYXRlcyA9IFV0aWwubm9ybWFsaXplUmVjdChsaW5lQ29vcmRpbmF0ZXMpOwogICAgdGhpcy5zZXRMaW5lRW5kaW5ncyhkaWN0LmdldEFycmF5KCJMRSIpKTsKICAgIHRoaXMuZGF0YS5saW5lRW5kaW5ncyA9IHRoaXMubGluZUVuZGluZ3M7CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzAsIDAsIDBdKTsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgY29uc3QgaW50ZXJpb3JDb2xvciA9IGdldFJnYkNvbG9yKGRpY3QuZ2V0QXJyYXkoIklDIiksIG51bGwpOwogICAgICBjb25zdCBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KGludGVyaW9yQ29sb3IpOwogICAgICBjb25zdCBmaWxsQWxwaGEgPSBmaWxsQ29sb3IgPyBzdHJva2VBbHBoYSA6IG51bGw7CiAgICAgIGNvbnN0IGJvcmRlcldpZHRoID0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCB8fCAxLAogICAgICAgIGJvcmRlckFkanVzdCA9IDIgKiBib3JkZXJXaWR0aDsKICAgICAgY29uc3QgYmJveCA9IFt0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzBdIC0gYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzFdIC0gYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzJdICsgYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzNdICsgYm9yZGVyQWRqdXN0XTsKICAgICAgaWYgKCFVdGlsLmludGVyc2VjdCh0aGlzLnJlY3RhbmdsZSwgYmJveCkpIHsKICAgICAgICB0aGlzLnJlY3RhbmdsZSA9IGJib3g7CiAgICAgIH0KICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgIHhyZWYsCiAgICAgICAgZXh0cmE6IGAke2JvcmRlcldpZHRofSB3YCwKICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbEFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke2xpbmVDb29yZGluYXRlc1swXX0gJHtsaW5lQ29vcmRpbmF0ZXNbMV19IG1gLCBgJHtsaW5lQ29vcmRpbmF0ZXNbMl19ICR7bGluZUNvb3JkaW5hdGVzWzNdfSBsYCwgIlMiKTsKICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdIC0gYm9yZGVyV2lkdGgsIHBvaW50c1s3XSAtIGJvcmRlcldpZHRoLCBwb2ludHNbMl0gKyBib3JkZXJXaWR0aCwgcG9pbnRzWzNdICsgYm9yZGVyV2lkdGhdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9CmNsYXNzIFNxdWFyZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5TUVVBUkU7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgIGNvbnN0IGludGVyaW9yQ29sb3IgPSBnZXRSZ2JDb2xvcihkaWN0LmdldEFycmF5KCJJQyIpLCBudWxsKTsKICAgICAgY29uc3QgZmlsbENvbG9yID0gZ2V0UGRmQ29sb3JBcnJheShpbnRlcmlvckNvbG9yKTsKICAgICAgY29uc3QgZmlsbEFscGhhID0gZmlsbENvbG9yID8gc3Ryb2tlQWxwaGEgOiBudWxsOwogICAgICBpZiAodGhpcy5ib3JkZXJTdHlsZS53aWR0aCA9PT0gMCAmJiAhZmlsbENvbG9yKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICB4cmVmLAogICAgICAgIGV4dHJhOiBgJHt0aGlzLmJvcmRlclN0eWxlLndpZHRofSB3YCwKICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbEFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGNvbnN0IHggPSBwb2ludHNbNF0gKyB0aGlzLmJvcmRlclN0eWxlLndpZHRoIC8gMjsKICAgICAgICAgIGNvbnN0IHkgPSBwb2ludHNbNV0gKyB0aGlzLmJvcmRlclN0eWxlLndpZHRoIC8gMjsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gcG9pbnRzWzZdIC0gcG9pbnRzWzRdIC0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aDsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IHBvaW50c1szXSAtIHBvaW50c1s3XSAtIHRoaXMuYm9yZGVyU3R5bGUud2lkdGg7CiAgICAgICAgICBidWZmZXIucHVzaChgJHt4fSAke3l9ICR7d2lkdGh9ICR7aGVpZ2h0fSByZWApOwogICAgICAgICAgaWYgKGZpbGxDb2xvcikgewogICAgICAgICAgICBidWZmZXIucHVzaCgiQiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KfQpjbGFzcyBDaXJjbGVBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuQ0lSQ0xFOwogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgIGNvbnN0IGludGVyaW9yQ29sb3IgPSBnZXRSZ2JDb2xvcihkaWN0LmdldEFycmF5KCJJQyIpLCBudWxsKTsKICAgICAgY29uc3QgZmlsbENvbG9yID0gZ2V0UGRmQ29sb3JBcnJheShpbnRlcmlvckNvbG9yKTsKICAgICAgY29uc3QgZmlsbEFscGhhID0gZmlsbENvbG9yID8gc3Ryb2tlQWxwaGEgOiBudWxsOwogICAgICBpZiAodGhpcy5ib3JkZXJTdHlsZS53aWR0aCA9PT0gMCAmJiAhZmlsbENvbG9yKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRyb2xQb2ludHNEaXN0YW5jZSA9IDQgLyAzICogTWF0aC50YW4oTWF0aC5QSSAvICgyICogNCkpOwogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7dGhpcy5ib3JkZXJTdHlsZS53aWR0aH0gd2AsCiAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgZmlsbENvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIGZpbGxBbHBoYSwKICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICBjb25zdCB4MCA9IHBvaW50c1swXSArIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3QgeTAgPSBwb2ludHNbMV0gLSB0aGlzLmJvcmRlclN0eWxlLndpZHRoIC8gMjsKICAgICAgICAgIGNvbnN0IHgxID0gcG9pbnRzWzZdIC0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB5MSA9IHBvaW50c1s3XSArIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3QgeE1pZCA9IHgwICsgKHgxIC0geDApIC8gMjsKICAgICAgICAgIGNvbnN0IHlNaWQgPSB5MCArICh5MSAtIHkwKSAvIDI7CiAgICAgICAgICBjb25zdCB4T2Zmc2V0ID0gKHgxIC0geDApIC8gMiAqIGNvbnRyb2xQb2ludHNEaXN0YW5jZTsKICAgICAgICAgIGNvbnN0IHlPZmZzZXQgPSAoeTEgLSB5MCkgLyAyICogY29udHJvbFBvaW50c0Rpc3RhbmNlOwogICAgICAgICAgYnVmZmVyLnB1c2goYCR7eE1pZH0gJHt5MX0gbWAsIGAke3hNaWQgKyB4T2Zmc2V0fSAke3kxfSAke3gxfSAke3lNaWQgKyB5T2Zmc2V0fSAke3gxfSAke3lNaWR9IGNgLCBgJHt4MX0gJHt5TWlkIC0geU9mZnNldH0gJHt4TWlkICsgeE9mZnNldH0gJHt5MH0gJHt4TWlkfSAke3kwfSBjYCwgYCR7eE1pZCAtIHhPZmZzZXR9ICR7eTB9ICR7eDB9ICR7eU1pZCAtIHlPZmZzZXR9ICR7eDB9ICR7eU1pZH0gY2AsIGAke3gwfSAke3lNaWQgKyB5T2Zmc2V0fSAke3hNaWQgLSB4T2Zmc2V0fSAke3kxfSAke3hNaWR9ICR7eTF9IGNgLCAiaCIpOwogICAgICAgICAgaWYgKGZpbGxDb2xvcikgewogICAgICAgICAgICBidWZmZXIucHVzaCgiQiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KfQpjbGFzcyBQb2x5bGluZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5QT0xZTElORTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICB0aGlzLmRhdGEudmVydGljZXMgPSBudWxsOwogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFBvbHlnb25Bbm5vdGF0aW9uKSkgewogICAgICB0aGlzLnNldExpbmVFbmRpbmdzKGRpY3QuZ2V0QXJyYXkoIkxFIikpOwogICAgICB0aGlzLmRhdGEubGluZUVuZGluZ3MgPSB0aGlzLmxpbmVFbmRpbmdzOwogICAgfQogICAgY29uc3QgcmF3VmVydGljZXMgPSBkaWN0LmdldEFycmF5KCJWZXJ0aWNlcyIpOwogICAgaWYgKCFpc051bWJlckFycmF5KHJhd1ZlcnRpY2VzLCBudWxsKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMuZGF0YS52ZXJ0aWNlcyA9IEZsb2F0MzJBcnJheS5mcm9tKHJhd1ZlcnRpY2VzKTsKICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICBjb25zdCBzdHJva2VBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICBsZXQgZmlsbENvbG9yID0gZ2V0UmdiQ29sb3IoZGljdC5nZXRBcnJheSgiSUMiKSwgbnVsbCk7CiAgICAgIGlmIChmaWxsQ29sb3IpIHsKICAgICAgICBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KGZpbGxDb2xvcik7CiAgICAgIH0KICAgICAgbGV0IG9wZXJhdG9yOwogICAgICBpZiAoZmlsbENvbG9yKSB7CiAgICAgICAgaWYgKHRoaXMuY29sb3IpIHsKICAgICAgICAgIG9wZXJhdG9yID0gZmlsbENvbG9yLmV2ZXJ5KChjLCBpKSA9PiBjID09PSBzdHJva2VDb2xvcltpXSkgPyAiZiIgOiAiQiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9wZXJhdG9yID0gImYiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBvcGVyYXRvciA9ICJTIjsKICAgICAgfQogICAgICBjb25zdCBib3JkZXJXaWR0aCA9IHRoaXMuYm9yZGVyU3R5bGUud2lkdGggfHwgMSwKICAgICAgICBib3JkZXJBZGp1c3QgPSAyICogYm9yZGVyV2lkdGg7CiAgICAgIGNvbnN0IGJib3ggPSBbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV07CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZlcnRpY2VzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCh2ZXJ0aWNlc1tpXSAtIGJvcmRlckFkanVzdCwgdmVydGljZXNbaSArIDFdIC0gYm9yZGVyQWRqdXN0LCB2ZXJ0aWNlc1tpXSArIGJvcmRlckFkanVzdCwgdmVydGljZXNbaSArIDFdICsgYm9yZGVyQWRqdXN0LCBiYm94KTsKICAgICAgfQogICAgICBpZiAoIVV0aWwuaW50ZXJzZWN0KHRoaXMucmVjdGFuZ2xlLCBiYm94KSkgewogICAgICAgIHRoaXMucmVjdGFuZ2xlID0gYmJveDsKICAgICAgfQogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7Ym9yZGVyV2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIGZpbGxDb2xvciwKICAgICAgICBmaWxsQWxwaGE6IGZpbGxDb2xvciA/IHN0cm9rZUFscGhhIDogbnVsbCwKICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB2ZXJ0aWNlcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke3ZlcnRpY2VzW2ldfSAke3ZlcnRpY2VzW2kgKyAxXX0gJHtpID09PSAwID8gIm0iIDogImwifWApOwogICAgICAgICAgfQogICAgICAgICAgYnVmZmVyLnB1c2gob3BlcmF0b3IpOwogICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0sIHBvaW50c1s3XSwgcG9pbnRzWzJdLCBwb2ludHNbM11dOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9CmNsYXNzIFBvbHlnb25Bbm5vdGF0aW9uIGV4dGVuZHMgUG9seWxpbmVBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5QT0xZR09OOwogIH0KfQpjbGFzcyBDYXJldEFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5DQVJFVDsKICB9Cn0KY2xhc3MgSW5rQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5JTks7CiAgICB0aGlzLmRhdGEuaW5rTGlzdHMgPSBbXTsKICAgIHRoaXMuZGF0YS5pc0VkaXRhYmxlID0gIXRoaXMuZGF0YS5ub0hUTUw7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICB0aGlzLmRhdGEub3BhY2l0eSA9IGRpY3QuZ2V0KCJDQSIpIHx8IDE7CiAgICBjb25zdCByYXdJbmtMaXN0cyA9IGRpY3QuZ2V0QXJyYXkoIklua0xpc3QiKTsKICAgIGlmICghQXJyYXkuaXNBcnJheShyYXdJbmtMaXN0cykpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcmF3SW5rTGlzdHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmF3SW5rTGlzdHNbaV0pKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaW5rTGlzdCA9IG5ldyBGbG9hdDMyQXJyYXkocmF3SW5rTGlzdHNbaV0ubGVuZ3RoKTsKICAgICAgdGhpcy5kYXRhLmlua0xpc3RzLnB1c2goaW5rTGlzdCk7CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJhd0lua0xpc3RzW2ldLmxlbmd0aDsgaiA8IGpqOyBqICs9IDIpIHsKICAgICAgICBjb25zdCB4ID0geHJlZi5mZXRjaElmUmVmKHJhd0lua0xpc3RzW2ldW2pdKSwKICAgICAgICAgIHkgPSB4cmVmLmZldGNoSWZSZWYocmF3SW5rTGlzdHNbaV1baiArIDFdKTsKICAgICAgICBpZiAodHlwZW9mIHggPT09ICJudW1iZXIiICYmIHR5cGVvZiB5ID09PSAibnVtYmVyIikgewogICAgICAgICAgaW5rTGlzdFtqXSA9IHg7CiAgICAgICAgICBpbmtMaXN0W2ogKyAxXSA9IHk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzAsIDAsIDBdKTsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgY29uc3QgYm9yZGVyV2lkdGggPSB0aGlzLmJvcmRlclN0eWxlLndpZHRoIHx8IDEsCiAgICAgICAgYm9yZGVyQWRqdXN0ID0gMiAqIGJvcmRlcldpZHRoOwogICAgICBjb25zdCBiYm94ID0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogICAgICBmb3IgKGNvbnN0IGlua0xpc3Qgb2YgdGhpcy5kYXRhLmlua0xpc3RzKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5rTGlzdC5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveChpbmtMaXN0W2ldIC0gYm9yZGVyQWRqdXN0LCBpbmtMaXN0W2kgKyAxXSAtIGJvcmRlckFkanVzdCwgaW5rTGlzdFtpXSArIGJvcmRlckFkanVzdCwgaW5rTGlzdFtpICsgMV0gKyBib3JkZXJBZGp1c3QsIGJib3gpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIVV0aWwuaW50ZXJzZWN0KHRoaXMucmVjdGFuZ2xlLCBiYm94KSkgewogICAgICAgIHRoaXMucmVjdGFuZ2xlID0gYmJveDsKICAgICAgfQogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7Ym9yZGVyV2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGZvciAoY29uc3QgaW5rTGlzdCBvZiB0aGlzLmRhdGEuaW5rTGlzdHMpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5rTGlzdC5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7aW5rTGlzdFtpXX0gJHtpbmtMaXN0W2kgKyAxXX0gJHtpID09PSAwID8gIm0iIDogImwifWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJTIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW3BvaW50c1swXSwgcG9pbnRzWzddLCBwb2ludHNbMl0sIHBvaW50c1szXV07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgb2xkQW5ub3RhdGlvbiwKICAgICAgY29sb3IsCiAgICAgIGRhdGUsCiAgICAgIG9wYWNpdHksCiAgICAgIHBhdGhzLAogICAgICBvdXRsaW5lcywKICAgICAgcmVjdCwKICAgICAgcm90YXRpb24sCiAgICAgIHRoaWNrbmVzcywKICAgICAgdXNlcgogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBpbmsgPSBvbGRBbm5vdGF0aW9uIHx8IG5ldyBEaWN0KHhyZWYpOwogICAgaW5rLnNldElmTm90RXhpc3RzKCJUeXBlIiwgTmFtZS5nZXQoIkFubm90IikpOwogICAgaW5rLnNldElmTm90RXhpc3RzKCJTdWJ0eXBlIiwgTmFtZS5nZXQoIkluayIpKTsKICAgIGluay5zZXQob2xkQW5ub3RhdGlvbiA/ICJNIiA6ICJDcmVhdGlvbkRhdGUiLCBgRDoke2dldE1vZGlmaWNhdGlvbkRhdGUoZGF0ZSl9YCk7CiAgICBpbmsuc2V0SWZBcnJheSgiUmVjdCIsIHJlY3QpOwogICAgaW5rLnNldElmQXJyYXkoIklua0xpc3QiLCBvdXRsaW5lcz8ucG9pbnRzIHx8IHBhdGhzPy5wb2ludHMpOwogICAgaW5rLnNldElmTm90RXhpc3RzKCJGIiwgNCk7CiAgICBpbmsuc2V0SWZOdW1iZXIoIlJvdGF0ZSIsIHJvdGF0aW9uKTsKICAgIGluay5zZXRJZkRlZmluZWQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHVzZXIpKTsKICAgIGlmIChvdXRsaW5lcykgewogICAgICBpbmsuc2V0SWZOYW1lKCJJVCIsICJJbmtIaWdobGlnaHQiKTsKICAgIH0KICAgIGlmICh0aGlja25lc3MgPiAwKSB7CiAgICAgIGNvbnN0IGJzID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGluay5zZXQoIkJTIiwgYnMpOwogICAgICBicy5zZXQoIlciLCB0aGlja25lc3MpOwogICAgfQogICAgaW5rLnNldElmQXJyYXkoIkMiLCBnZXRQZGZDb2xvckFycmF5KGNvbG9yKSk7CiAgICBpbmsuc2V0SWZOdW1iZXIoIkNBIiwgb3BhY2l0eSk7CiAgICBpZiAoYXAgfHwgYXBSZWYpIHsKICAgICAgY29uc3QgbiA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBpbmsuc2V0KCJBUCIsIG4pOwogICAgICBuLnNldCgiTiIsIGFwUmVmIHx8IGFwKTsKICAgIH0KICAgIHJldHVybiBpbms7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgaWYgKGFubm90YXRpb24ub3V0bGluZXMpIHsKICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbUZvckhpZ2hsaWdodChhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpOwogICAgfQogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgcmVjdCwKICAgICAgcGF0aHMsCiAgICAgIHRoaWNrbmVzcywKICAgICAgb3BhY2l0eQogICAgfSA9IGFubm90YXRpb247CiAgICBpZiAoIWNvbG9yKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZUJ1ZmZlciA9IFtgJHt0aGlja25lc3N9IHcgMSBKIDEgamAsIGAke2dldFBkZkNvbG9yKGNvbG9yLCBmYWxzZSl9YF07CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goIi9SMCBncyIpOwogICAgfQogICAgZm9yIChjb25zdCBvdXRsaW5lIG9mIHBhdGhzLmxpbmVzKSB7CiAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzRdKX0gJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzVdKX0gbWApOwogICAgICBmb3IgKGxldCBpID0gNiwgaWkgPSBvdXRsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgICBpZiAoaXNOYU4ob3V0bGluZVtpXSkpIHsKICAgICAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lW2kgKyA0XSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpICsgNV0pfSBsYCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldID0gb3V0bGluZS5zbGljZShpLCBpICsgNik7CiAgICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0ubWFwKG51bWJlclRvU3RyaW5nKS5qb2luKCIgIikgKyAiIGMiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG91dGxpbmUubGVuZ3RoID09PSA2KSB7CiAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKG91dGxpbmVbNF0pfSAke251bWJlclRvU3RyaW5nKG91dGxpbmVbNV0pfSBsYCk7CiAgICAgIH0KICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaCgiUyIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGFwcGVhcmFuY2VCdWZmZXIuam9pbigiXG4iKTsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkZvcm1UeXBlIiwgMSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiRm9ybSIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJUeXBlIiwgIlhPYmplY3QiKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiQkJveCIsIHJlY3QpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJMZW5ndGgiLCBhcHBlYXJhbmNlLmxlbmd0aCk7CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgY29uc3QgZXh0R1N0YXRlID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGNvbnN0IHIwID0gbmV3IERpY3QoeHJlZik7CiAgICAgIHIwLnNldCgiQ0EiLCBvcGFjaXR5KTsKICAgICAgcjAuc2V0SWZOYW1lKCJUeXBlIiwgIkV4dEdTdGF0ZSIpOwogICAgICBleHRHU3RhdGUuc2V0KCJSMCIsIHIwKTsKICAgICAgcmVzb3VyY2VzLnNldCgiRXh0R1N0YXRlIiwgZXh0R1N0YXRlKTsKICAgICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbUZvckhpZ2hsaWdodChhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIHJlY3QsCiAgICAgIG91dGxpbmVzOiB7CiAgICAgICAgb3V0bGluZQogICAgICB9LAogICAgICBvcGFjaXR5CiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGlmICghY29sb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlQnVmZmVyID0gW2Ake2dldFBkZkNvbG9yKGNvbG9yLCB0cnVlKX1gLCAiL1IwIGdzIl07CiAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVs0XSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVs1XSl9IG1gKTsKICAgIGZvciAobGV0IGkgPSA2LCBpaSA9IG91dGxpbmUubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNikgewogICAgICBpZiAoaXNOYU4ob3V0bGluZVtpXSkpIHsKICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpICsgNF0pfSAke251bWJlclRvU3RyaW5nKG91dGxpbmVbaSArIDVdKX0gbGApOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldID0gb3V0bGluZS5zbGljZShpLCBpICsgNik7CiAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldLm1hcChudW1iZXJUb1N0cmluZykuam9pbigiICIpICsgIiBjIik7CiAgICAgIH0KICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaCgiaCBmIik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYXBwZWFyYW5jZUJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgcmVjdCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBEaWN0KHhyZWYpOwogICAgY29uc3QgZXh0R1N0YXRlID0gbmV3IERpY3QoeHJlZik7CiAgICByZXNvdXJjZXMuc2V0KCJFeHRHU3RhdGUiLCBleHRHU3RhdGUpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgY29uc3QgcjAgPSBuZXcgRGljdCh4cmVmKTsKICAgIGV4dEdTdGF0ZS5zZXQoIlIwIiwgcjApOwogICAgcjAuc2V0SWZOYW1lKCJCTSIsICJNdWx0aXBseSIpOwogICAgaWYgKG9wYWNpdHkgIT09IDEpIHsKICAgICAgcjAuc2V0KCJjYSIsIG9wYWNpdHkpOwogICAgICByMC5zZXRJZk5hbWUoIlR5cGUiLCAiRXh0R1N0YXRlIik7CiAgICB9CiAgICBjb25zdCBhcCA9IG5ldyBTdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQp9CmNsYXNzIEhpZ2hsaWdodEFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5ISUdITElHSFQ7CiAgICB0aGlzLmRhdGEuaXNFZGl0YWJsZSA9ICF0aGlzLmRhdGEubm9IVE1MOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgdGhpcy5kYXRhLm9wYWNpdHkgPSBkaWN0LmdldCgiQ0EiKSB8fCAxOwogICAgY29uc3QgcXVhZFBvaW50cyA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCBudWxsKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRoaXMuYXBwZWFyYW5jZT8uZGljdC5nZXQoIlJlc291cmNlcyIpOwogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSB8fCAhcmVzb3VyY2VzPy5oYXMoIkV4dEdTdGF0ZSIpKSB7CiAgICAgICAgaWYgKHRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgICAgd2FybigiSGlnaGxpZ2h0QW5ub3RhdGlvbiAtIGlnbm9yaW5nIGJ1aWx0LWluIGFwcGVhcmFuY2Ugc3RyZWFtLiIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFsxLCAxLCAwXSk7CiAgICAgICAgY29uc3QgZmlsbEFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGZpbGxDb2xvciwKICAgICAgICAgIGJsZW5kTW9kZTogIk11bHRpcGx5IiwKICAgICAgICAgIGZpbGxBbHBoYSwKICAgICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7cG9pbnRzWzBdfSAke3BvaW50c1sxXX0gbWAsIGAke3BvaW50c1syXX0gJHtwb2ludHNbM119IGxgLCBgJHtwb2ludHNbNl19ICR7cG9pbnRzWzddfSBsYCwgYCR7cG9pbnRzWzRdfSAke3BvaW50c1s1XX0gbGAsICJmIik7CiAgICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9CiAgZ2V0IG92ZXJsYXlzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIGRhdGUsCiAgICAgIG9sZEFubm90YXRpb24sCiAgICAgIG9wYWNpdHksCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB1c2VyLAogICAgICBxdWFkUG9pbnRzCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IGhpZ2hsaWdodCA9IG9sZEFubm90YXRpb24gfHwgbmV3IERpY3QoeHJlZik7CiAgICBoaWdobGlnaHQuc2V0SWZOb3RFeGlzdHMoIlR5cGUiLCBOYW1lLmdldCgiQW5ub3QiKSk7CiAgICBoaWdobGlnaHQuc2V0SWZOb3RFeGlzdHMoIlN1YnR5cGUiLCBOYW1lLmdldCgiSGlnaGxpZ2h0IikpOwogICAgaGlnaGxpZ2h0LnNldChvbGRBbm5vdGF0aW9uID8gIk0iIDogIkNyZWF0aW9uRGF0ZSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZShkYXRlKX1gKTsKICAgIGhpZ2hsaWdodC5zZXRJZkFycmF5KCJSZWN0IiwgcmVjdCk7CiAgICBoaWdobGlnaHQuc2V0SWZOb3RFeGlzdHMoIkYiLCA0KTsKICAgIGhpZ2hsaWdodC5zZXRJZk5vdEV4aXN0cygiQm9yZGVyIiwgWzAsIDAsIDBdKTsKICAgIGhpZ2hsaWdodC5zZXRJZk51bWJlcigiUm90YXRlIiwgcm90YXRpb24pOwogICAgaGlnaGxpZ2h0LnNldElmQXJyYXkoIlF1YWRQb2ludHMiLCBxdWFkUG9pbnRzKTsKICAgIGhpZ2hsaWdodC5zZXRJZkFycmF5KCJDIiwgZ2V0UGRmQ29sb3JBcnJheShjb2xvcikpOwogICAgaGlnaGxpZ2h0LnNldElmTnVtYmVyKCJDQSIsIG9wYWNpdHkpOwogICAgaGlnaGxpZ2h0LnNldElmRGVmaW5lZCgiVCIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodXNlcikpOwogICAgaWYgKGFwUmVmIHx8IGFwKSB7CiAgICAgIGNvbnN0IG4gPSBuZXcgRGljdCh4cmVmKTsKICAgICAgaGlnaGxpZ2h0LnNldCgiQVAiLCBuKTsKICAgICAgbi5zZXQoIk4iLCBhcFJlZiB8fCBhcCk7CiAgICB9CiAgICByZXR1cm4gaGlnaGxpZ2h0OwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbShhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIHJlY3QsCiAgICAgIG91dGxpbmVzLAogICAgICBvcGFjaXR5CiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGlmICghY29sb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlQnVmZmVyID0gW2Ake2dldFBkZkNvbG9yKGNvbG9yLCB0cnVlKX1gLCAiL1IwIGdzIl07CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGZvciAoY29uc3Qgb3V0bGluZSBvZiBvdXRsaW5lcykgewogICAgICBidWZmZXIubGVuZ3RoID0gMDsKICAgICAgYnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVswXSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVsxXSl9IG1gKTsKICAgICAgZm9yIChsZXQgaSA9IDIsIGlpID0gb3V0bGluZS5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgYnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpXSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpICsgMV0pfSBsYCk7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goImgiKTsKICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGJ1ZmZlci5qb2luKCJcbiIpKTsKICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaCgiZioiKTsKICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlQnVmZmVyLmpvaW4oIlxuIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCByZWN0KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTGVuZ3RoIiwgYXBwZWFyYW5jZS5sZW5ndGgpOwogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCBleHRHU3RhdGUgPSBuZXcgRGljdCh4cmVmKTsKICAgIHJlc291cmNlcy5zZXQoIkV4dEdTdGF0ZSIsIGV4dEdTdGF0ZSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBjb25zdCByMCA9IG5ldyBEaWN0KHhyZWYpOwogICAgZXh0R1N0YXRlLnNldCgiUjAiLCByMCk7CiAgICByMC5zZXRJZk5hbWUoIkJNIiwgIk11bHRpcGx5Iik7CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICByMC5zZXQoImNhIiwgb3BhY2l0eSk7CiAgICAgIHIwLnNldElmTmFtZSgiVHlwZSIsICJFeHRHU3RhdGUiKTsKICAgIH0KICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9Cn0KY2xhc3MgVW5kZXJsaW5lQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlVOREVSTElORTsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLmRhdGEucXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMoZGljdCwgbnVsbCk7CiAgICBpZiAocXVhZFBvaW50cykgewogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGV4dHJhOiAiW10gMCBkIDAuNTcxIHciLAogICAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgICBzdHJva2VBbHBoYSwKICAgICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7cG9pbnRzWzRdfSAke3BvaW50c1s1XSArIDEuM30gbWAsIGAke3BvaW50c1s2XX0gJHtwb2ludHNbN10gKyAxLjN9IGxgLCAiUyIpOwogICAgICAgICAgICByZXR1cm4gW3BvaW50c1swXSwgcG9pbnRzWzddLCBwb2ludHNbMl0sIHBvaW50c1szXV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5wb3B1cFJlZiA9IG51bGw7CiAgICB9CiAgfQogIGdldCBvdmVybGF5c1RleHRDb250ZW50KCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFNxdWlnZ2x5QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlNRVUlHR0xZOwogICAgY29uc3QgcXVhZFBvaW50cyA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCBudWxsKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZXh0cmE6ICJbXSAwIGQgMSB3IiwKICAgICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gKHBvaW50c1sxXSAtIHBvaW50c1s1XSkgLyA2OwogICAgICAgICAgICBsZXQgc2hpZnQgPSBkeTsKICAgICAgICAgICAgbGV0IHggPSBwb2ludHNbNF07CiAgICAgICAgICAgIGNvbnN0IHkgPSBwb2ludHNbNV07CiAgICAgICAgICAgIGNvbnN0IHhFbmQgPSBwb2ludHNbNl07CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke3h9ICR7eSArIHNoaWZ0fSBtYCk7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICB4ICs9IDI7CiAgICAgICAgICAgICAgc2hpZnQgPSBzaGlmdCA9PT0gMCA/IGR5IDogMDsKICAgICAgICAgICAgICBidWZmZXIucHVzaChgJHt4fSAke3kgKyBzaGlmdH0gbGApOwogICAgICAgICAgICB9IHdoaWxlICh4IDwgeEVuZCk7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJTIik7CiAgICAgICAgICAgIHJldHVybiBbcG9pbnRzWzRdLCB5IC0gMiAqIGR5LCB4RW5kLCB5ICsgMiAqIGR5XTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9CiAgZ2V0IG92ZXJsYXlzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgU3RyaWtlT3V0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlNUUklLRU9VVDsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLmRhdGEucXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMoZGljdCwgbnVsbCk7CiAgICBpZiAocXVhZFBvaW50cykgewogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGV4dHJhOiAiW10gMCBkIDEgdyIsCiAgICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgICAgcG9pbnRzQ2FsbGJhY2s6IChidWZmZXIsIHBvaW50cykgPT4gewogICAgICAgICAgICBidWZmZXIucHVzaChgJHsocG9pbnRzWzBdICsgcG9pbnRzWzRdKSAvIDJ9IGAgKyBgJHsocG9pbnRzWzFdICsgcG9pbnRzWzVdKSAvIDJ9IG1gLCBgJHsocG9pbnRzWzJdICsgcG9pbnRzWzZdKSAvIDJ9IGAgKyBgJHsocG9pbnRzWzNdICsgcG9pbnRzWzddKSAvIDJ9IGxgLCAiUyIpOwogICAgICAgICAgICByZXR1cm4gW3BvaW50c1swXSwgcG9pbnRzWzddLCBwb2ludHNbMl0sIHBvaW50c1szXV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5wb3B1cFJlZiA9IG51bGw7CiAgICB9CiAgfQogIGdldCBvdmVybGF5c1RleHRDb250ZW50KCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFN0YW1wQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogICNzYXZlZEhhc093bkNhbnZhcyA9IG51bGw7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuU1RBTVA7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLmlzRWRpdGFibGUgPSAhdGhpcy5kYXRhLm5vSFRNTDsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICB9CiAgbXVzdEJlVmlld2VkV2hlbkVkaXRpbmcoaXNFZGl0aW5nLCBtb2RpZmllZElkcyA9IG51bGwpIHsKICAgIGlmIChpc0VkaXRpbmcpIHsKICAgICAgaWYgKCF0aGlzLmRhdGEuaXNFZGl0YWJsZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHRoaXMuI3NhdmVkSGFzT3duQ2FudmFzID8/PSB0aGlzLmRhdGEuaGFzT3duQ2FudmFzOwogICAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAodGhpcy4jc2F2ZWRIYXNPd25DYW52YXMgIT09IG51bGwpIHsKICAgICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuI3NhdmVkSGFzT3duQ2FudmFzOwogICAgICB0aGlzLiNzYXZlZEhhc093bkNhbnZhcyA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gIW1vZGlmaWVkSWRzPy5oYXModGhpcy5kYXRhLmlkKTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZUltYWdlKGJpdG1hcCwgeHJlZikgewogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gYml0bWFwOwogICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIsIHsKICAgICAgYWxwaGE6IHRydWUKICAgIH0pOwogICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDApOwogICAgY29uc3QgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgd2lkdGgsIGhlaWdodCkuZGF0YTsKICAgIGNvbnN0IGJ1ZjMyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyKTsKICAgIGNvbnN0IGhhc0FscGhhID0gYnVmMzIuc29tZShGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IHggPT4geCA+Pj4gMjQgIT09IDB4ZmYgOiB4ID0+ICh4ICYgMHhmZikgIT09IDB4ZmYpOwogICAgaWYgKGhhc0FscGhhKSB7CiAgICAgIGN0eC5maWxsU3R5bGUgPSAid2hpdGUiOwogICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsKICAgIH0KICAgIGNvbnN0IGpwZWdCdWZmZXJQcm9taXNlID0gY2FudmFzLmNvbnZlcnRUb0Jsb2IoewogICAgICB0eXBlOiAiaW1hZ2UvanBlZyIsCiAgICAgIHF1YWxpdHk6IDEKICAgIH0pLnRoZW4oYmxvYiA9PiBibG9iLmFycmF5QnVmZmVyKCkpOwogICAgY29uc3QgeG9iamVjdE5hbWUgPSBOYW1lLmdldCgiWE9iamVjdCIpOwogICAgY29uc3QgaW1hZ2VOYW1lID0gTmFtZS5nZXQoIkltYWdlIik7CiAgICBjb25zdCBpbWFnZSA9IG5ldyBEaWN0KHhyZWYpOwogICAgaW1hZ2Uuc2V0KCJUeXBlIiwgeG9iamVjdE5hbWUpOwogICAgaW1hZ2Uuc2V0KCJTdWJ0eXBlIiwgaW1hZ2VOYW1lKTsKICAgIGltYWdlLnNldCgiQml0c1BlckNvbXBvbmVudCIsIDgpOwogICAgaW1hZ2Uuc2V0SWZOYW1lKCJDb2xvclNwYWNlIiwgIkRldmljZVJHQiIpOwogICAgaW1hZ2Uuc2V0SWZOYW1lKCJGaWx0ZXIiLCAiRENURGVjb2RlIik7CiAgICBpbWFnZS5zZXQoIkJCb3giLCBbMCwgMCwgd2lkdGgsIGhlaWdodF0pOwogICAgaW1hZ2Uuc2V0KCJXaWR0aCIsIHdpZHRoKTsKICAgIGltYWdlLnNldCgiSGVpZ2h0IiwgaGVpZ2h0KTsKICAgIGxldCBzbWFza1N0cmVhbSA9IG51bGw7CiAgICBpZiAoaGFzQWxwaGEpIHsKICAgICAgY29uc3QgYWxwaGFCdWZmZXIgPSBuZXcgVWludDhBcnJheShidWYzMi5sZW5ndGgpOwogICAgICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBidWYzMi5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBhbHBoYUJ1ZmZlcltpXSA9IGJ1ZjMyW2ldID4+PiAyNDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYnVmMzIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgYWxwaGFCdWZmZXJbaV0gPSBidWYzMltpXSAmIDB4ZmY7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHNtYXNrID0gbmV3IERpY3QoeHJlZik7CiAgICAgIHNtYXNrLnNldCgiVHlwZSIsIHhvYmplY3ROYW1lKTsKICAgICAgc21hc2suc2V0KCJTdWJ0eXBlIiwgaW1hZ2VOYW1lKTsKICAgICAgc21hc2suc2V0KCJCaXRzUGVyQ29tcG9uZW50IiwgOCk7CiAgICAgIHNtYXNrLnNldElmTmFtZSgiQ29sb3JTcGFjZSIsICJEZXZpY2VHcmF5Iik7CiAgICAgIHNtYXNrLnNldCgiV2lkdGgiLCB3aWR0aCk7CiAgICAgIHNtYXNrLnNldCgiSGVpZ2h0IiwgaGVpZ2h0KTsKICAgICAgc21hc2tTdHJlYW0gPSBuZXcgU3RyZWFtKGFscGhhQnVmZmVyLCAwLCAwLCBzbWFzayk7CiAgICB9CiAgICBjb25zdCBpbWFnZVN0cmVhbSA9IG5ldyBTdHJlYW0oYXdhaXQganBlZ0J1ZmZlclByb21pc2UsIDAsIDAsIGltYWdlKTsKICAgIHJldHVybiB7CiAgICAgIGltYWdlU3RyZWFtLAogICAgICBzbWFza1N0cmVhbSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfTsKICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgZGF0ZSwKICAgICAgb2xkQW5ub3RhdGlvbiwKICAgICAgcmVjdCwKICAgICAgcm90YXRpb24sCiAgICAgIHVzZXIKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgY29uc3Qgc3RhbXAgPSBvbGRBbm5vdGF0aW9uIHx8IG5ldyBEaWN0KHhyZWYpOwogICAgc3RhbXAuc2V0SWZOb3RFeGlzdHMoIlR5cGUiLCBOYW1lLmdldCgiQW5ub3QiKSk7CiAgICBzdGFtcC5zZXRJZk5vdEV4aXN0cygiU3VidHlwZSIsIE5hbWUuZ2V0KCJTdGFtcCIpKTsKICAgIHN0YW1wLnNldChvbGRBbm5vdGF0aW9uID8gIk0iIDogIkNyZWF0aW9uRGF0ZSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZShkYXRlKX1gKTsKICAgIHN0YW1wLnNldElmQXJyYXkoIlJlY3QiLCByZWN0KTsKICAgIHN0YW1wLnNldElmTm90RXhpc3RzKCJGIiwgNCk7CiAgICBzdGFtcC5zZXRJZk5vdEV4aXN0cygiQm9yZGVyIiwgWzAsIDAsIDBdKTsKICAgIHN0YW1wLnNldElmTnVtYmVyKCJSb3RhdGUiLCByb3RhdGlvbik7CiAgICBzdGFtcC5zZXRJZkRlZmluZWQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHVzZXIpKTsKICAgIGlmIChhcFJlZiB8fCBhcCkgewogICAgICBjb25zdCBuID0gbmV3IERpY3QoeHJlZik7CiAgICAgIHN0YW1wLnNldCgiQVAiLCBuKTsKICAgICAgbi5zZXQoIk4iLCBhcFJlZiB8fCBhcCk7CiAgICB9CiAgICByZXR1cm4gc3RhbXA7CiAgfQogIHN0YXRpYyBhc3luYyAjY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbUZvckRyYXdpbmcoYW5ub3RhdGlvbiwgeHJlZikgewogICAgY29uc3QgewogICAgICBhcmVDb250b3VycywKICAgICAgY29sb3IsCiAgICAgIHJlY3QsCiAgICAgIGxpbmVzLAogICAgICB0aGlja25lc3MKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgaWYgKCFjb2xvcikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2VCdWZmZXIgPSBbYCR7dGhpY2tuZXNzfSB3IDEgSiAxIGpgLCBgJHtnZXRQZGZDb2xvcihjb2xvciwgYXJlQ29udG91cnMpfWBdOwogICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7CiAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhsaW5lWzRdKX0gJHtudW1iZXJUb1N0cmluZyhsaW5lWzVdKX0gbWApOwogICAgICBmb3IgKGxldCBpID0gNiwgaWkgPSBsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgICBpZiAoaXNOYU4obGluZVtpXSkpIHsKICAgICAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhsaW5lW2kgKyA0XSl9ICR7bnVtYmVyVG9TdHJpbmcobGluZVtpICsgNV0pfSBsYCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldID0gbGluZS5zbGljZShpLCBpICsgNik7CiAgICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0ubWFwKG51bWJlclRvU3RyaW5nKS5qb2luKCIgIikgKyAiIGMiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGxpbmUubGVuZ3RoID09PSA2KSB7CiAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKGxpbmVbNF0pfSAke251bWJlclRvU3RyaW5nKGxpbmVbNV0pfSBsYCk7CiAgICAgIH0KICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChhcmVDb250b3VycyA/ICJGIiA6ICJTIik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYXBwZWFyYW5jZUJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgcmVjdCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKSB7CiAgICBpZiAoYW5ub3RhdGlvbi5vbGRBbm5vdGF0aW9uKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKGFubm90YXRpb24uaXNTaWduYXR1cmUpIHsKICAgICAgcmV0dXJuIHRoaXMuI2NyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW1Gb3JEcmF3aW5nKGFubm90YXRpb24sIHhyZWYpOwogICAgfQogICAgY29uc3QgewogICAgICByb3RhdGlvbgogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCB7CiAgICAgIGltYWdlUmVmLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gcGFyYW1zLmltYWdlOwogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCB4b2JqZWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICByZXNvdXJjZXMuc2V0KCJYT2JqZWN0IiwgeG9iamVjdCk7CiAgICB4b2JqZWN0LnNldCgiSW0wIiwgaW1hZ2VSZWYpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGBxICR7d2lkdGh9IDAgMCAke2hlaWdodH0gMCAwIGNtIC9JbTAgRG8gUWA7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCBbMCwgMCwgd2lkdGgsIGhlaWdodF0pOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgaWYgKHJvdGF0aW9uKSB7CiAgICAgIGNvbnN0IG1hdHJpeCA9IGdldFJvdGF0aW9uTWF0cml4KHJvdGF0aW9uLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJNYXRyaXgiLCBtYXRyaXgpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KfQpjbGFzcyBGaWxlQXR0YWNobWVudEFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBmaWxlID0gbmV3IEZpbGVTcGVjKGRpY3QuZ2V0KCJGUyIpLCB4cmVmKTsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLkZJTEVBVFRBQ0hNRU5UOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIHRoaXMuZGF0YS5maWxlID0gZmlsZS5zZXJpYWxpemFibGU7CiAgICBjb25zdCBuYW1lID0gZGljdC5nZXQoIk5hbWUiKTsKICAgIHRoaXMuZGF0YS5uYW1lID0gbmFtZSBpbnN0YW5jZW9mIE5hbWUgPyBzdHJpbmdUb1BERlN0cmluZyhuYW1lLm5hbWUpIDogIlB1c2hQaW4iOwogICAgY29uc3QgZmlsbEFscGhhID0gZGljdC5nZXQoImNhIik7CiAgICB0aGlzLmRhdGEuZmlsbEFscGhhID0gdHlwZW9mIGZpbGxBbHBoYSA9PT0gIm51bWJlciIgJiYgZmlsbEFscGhhID49IDAgJiYgZmlsbEFscGhhIDw9IDEgPyBmaWxsQWxwaGEgOiBudWxsOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2FsY3VsYXRlX21kNS5qcwoKY29uc3QgUEFSQU1TID0gewogIGdldCByKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiciIsIG5ldyBVaW50OEFycmF5KFs3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA1LCA5LCAxNCwgMjAsIDUsIDksIDE0LCAyMCwgNSwgOSwgMTQsIDIwLCA1LCA5LCAxNCwgMjAsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjFdKSk7CiAgfSwKICBnZXQgaygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImsiLCBuZXcgSW50MzJBcnJheShbLTY4MDg3NjkzNiwgLTM4OTU2NDU4NiwgNjA2MTA1ODE5LCAtMTA0NDUyNTMzMCwgLTE3NjQxODg5NywgMTIwMDA4MDQyNiwgLTE0NzMyMzEzNDEsIC00NTcwNTk4MywgMTc3MDAzNTQxNiwgLTE5NTg0MTQ0MTcsIC00MjA2MywgLTE5OTA0MDQxNjIsIDE4MDQ2MDM2ODIsIC00MDM0MTEwMSwgLTE1MDIwMDIyOTAsIDEyMzY1MzUzMjksIC0xNjU3OTY1MTAsIC0xMDY5NTAxNjMyLCA2NDM3MTc3MTMsIC0zNzM4OTczMDIsIC03MDE1NTg2OTEsIDM4MDE2MDgzLCAtNjYwNDc4MzM1LCAtNDA1NTM3ODQ4LCA1Njg0NDY0MzgsIC0xMDE5ODAzNjkwLCAtMTg3MzYzOTYxLCAxMTYzNTMxNTAxLCAtMTQ0NDY4MTQ2NywgLTUxNDAzNzg0LCAxNzM1MzI4NDczLCAtMTkyNjYwNzczNCwgLTM3ODU1OCwgLTIwMjI1NzQ0NjMsIDE4MzkwMzA1NjIsIC0zNTMwOTU1NiwgLTE1MzA5OTIwNjAsIDEyNzI4OTMzNTMsIC0xNTU0OTc2MzIsIC0xMDk0NzMwNjQwLCA2ODEyNzkxNzQsIC0zNTg1MzcyMjIsIC03MjI1MjE5NzksIDc2MDI5MTg5LCAtNjQwMzY0NDg3LCAtNDIxODE1ODM1LCA1MzA3NDI1MjAsIC05OTUzMzg2NTEsIC0xOTg2MzA4NDQsIDExMjY4OTE0MTUsIC0xNDE2MzU0OTA1LCAtNTc0MzQwNTUsIDE3MDA0ODU1NzEsIC0xODk0OTg2NjA2LCAtMTA1MTUyMywgLTIwNTQ5MjI3OTksIDE4NzMzMTMzNTksIC0zMDYxMTc0NCwgLTE1NjAxOTgzODAsIDEzMDkxNTE2NDksIC0xNDU1MjMwNzAsIC0xMTIwMjEwMzc5LCA3MTg3ODcyNTksIC0zNDM0ODU1NTFdKSk7CiAgfQp9OwpmdW5jdGlvbiBjYWxjdWxhdGVNRDUoZGF0YSwgb2Zmc2V0LCBsZW5ndGgpIHsKICBsZXQgaDAgPSAxNzMyNTg0MTkzLAogICAgaDEgPSAtMjcxNzMzODc5LAogICAgaDIgPSAtMTczMjU4NDE5NCwKICAgIGgzID0gMjcxNzMzODc4OwogIGNvbnN0IHBhZGRlZExlbmd0aCA9IGxlbmd0aCArIDcyICYgfjYzOwogIGNvbnN0IHBhZGRlZCA9IG5ldyBVaW50OEFycmF5KHBhZGRlZExlbmd0aCk7CiAgbGV0IGksIGo7CiAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICBwYWRkZWRbaV0gPSBkYXRhW29mZnNldCsrXTsKICB9CiAgcGFkZGVkW2krK10gPSAweDgwOwogIGNvbnN0IG4gPSBwYWRkZWRMZW5ndGggLSA4OwogIGlmIChpIDwgbikgewogICAgaSA9IG47CiAgfQogIHBhZGRlZFtpKytdID0gbGVuZ3RoIDw8IDMgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDUgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDEzICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAyMSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4+IDI5ICYgMHhmZjsKICBpICs9IDM7CiAgY29uc3QgdyA9IG5ldyBJbnQzMkFycmF5KDE2KTsKICBjb25zdCB7CiAgICBrLAogICAgcgogIH0gPSBQQVJBTVM7CiAgZm9yIChpID0gMDsgaSA8IHBhZGRlZExlbmd0aDspIHsKICAgIGZvciAoaiA9IDA7IGogPCAxNjsgKytqLCBpICs9IDQpIHsKICAgICAgd1tqXSA9IHBhZGRlZFtpXSB8IHBhZGRlZFtpICsgMV0gPDwgOCB8IHBhZGRlZFtpICsgMl0gPDwgMTYgfCBwYWRkZWRbaSArIDNdIDw8IDI0OwogICAgfQogICAgbGV0IGEgPSBoMCwKICAgICAgYiA9IGgxLAogICAgICBjID0gaDIsCiAgICAgIGQgPSBoMywKICAgICAgZiwKICAgICAgZzsKICAgIGZvciAoaiA9IDA7IGogPCA2NDsgKytqKSB7CiAgICAgIGlmIChqIDwgMTYpIHsKICAgICAgICBmID0gYiAmIGMgfCB+YiAmIGQ7CiAgICAgICAgZyA9IGo7CiAgICAgIH0gZWxzZSBpZiAoaiA8IDMyKSB7CiAgICAgICAgZiA9IGQgJiBiIHwgfmQgJiBjOwogICAgICAgIGcgPSA1ICogaiArIDEgJiAxNTsKICAgICAgfSBlbHNlIGlmIChqIDwgNDgpIHsKICAgICAgICBmID0gYiBeIGMgXiBkOwogICAgICAgIGcgPSAzICogaiArIDUgJiAxNTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmID0gYyBeIChiIHwgfmQpOwogICAgICAgIGcgPSA3ICogaiAmIDE1OwogICAgICB9CiAgICAgIGNvbnN0IHRtcCA9IGQsCiAgICAgICAgcm90YXRlQXJnID0gYSArIGYgKyBrW2pdICsgd1tnXSB8IDAsCiAgICAgICAgcm90YXRlID0gcltqXTsKICAgICAgZCA9IGM7CiAgICAgIGMgPSBiOwogICAgICBiID0gYiArIChyb3RhdGVBcmcgPDwgcm90YXRlIHwgcm90YXRlQXJnID4+PiAzMiAtIHJvdGF0ZSkgfCAwOwogICAgICBhID0gdG1wOwogICAgfQogICAgaDAgPSBoMCArIGEgfCAwOwogICAgaDEgPSBoMSArIGIgfCAwOwogICAgaDIgPSBoMiArIGMgfCAwOwogICAgaDMgPSBoMyArIGQgfCAwOwogIH0KICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoW2gwICYgMHhGRiwgaDAgPj4gOCAmIDB4RkYsIGgwID4+IDE2ICYgMHhGRiwgaDAgPj4+IDI0ICYgMHhGRiwgaDEgJiAweEZGLCBoMSA+PiA4ICYgMHhGRiwgaDEgPj4gMTYgJiAweEZGLCBoMSA+Pj4gMjQgJiAweEZGLCBoMiAmIDB4RkYsIGgyID4+IDggJiAweEZGLCBoMiA+PiAxNiAmIDB4RkYsIGgyID4+PiAyNCAmIDB4RkYsIGgzICYgMHhGRiwgaDMgPj4gOCAmIDB4RkYsIGgzID4+IDE2ICYgMHhGRiwgaDMgPj4+IDI0ICYgMHhGRl0pOwp9Cgo7Ly8gLi9zcmMvY29yZS9kYXRhc2V0X3JlYWRlci5qcwoKCgpmdW5jdGlvbiBkZWNvZGVTdHJpbmcoc3RyKSB7CiAgdHJ5IHsKICAgIHJldHVybiBzdHJpbmdUb1VURjhTdHJpbmcoc3RyKTsKICB9IGNhdGNoIChleCkgewogICAgd2FybihgVVRGLTggZGVjb2RpbmcgZmFpbGVkOiAiJHtleH0iLmApOwogICAgcmV0dXJuIHN0cjsKICB9Cn0KY2xhc3MgRGF0YXNldFhNTFBhcnNlciBleHRlbmRzIFNpbXBsZVhNTFBhcnNlciB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgc3VwZXIob3B0aW9ucyk7CiAgICB0aGlzLm5vZGUgPSBudWxsOwogIH0KICBvbkVuZEVsZW1lbnQobmFtZSkgewogICAgY29uc3Qgbm9kZSA9IHN1cGVyLm9uRW5kRWxlbWVudChuYW1lKTsKICAgIGlmIChub2RlICYmIG5hbWUgPT09ICJ4ZmE6ZGF0YXNldHMiKSB7CiAgICAgIHRoaXMubm9kZSA9IG5vZGU7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQWJvcnRpbmcgRGF0YXNldFhNTFBhcnNlci4iKTsKICAgIH0KICB9Cn0KY2xhc3MgRGF0YXNldFJlYWRlciB7CiAgY29uc3RydWN0b3IoZGF0YSkgewogICAgaWYgKGRhdGEuZGF0YXNldHMpIHsKICAgICAgdGhpcy5ub2RlID0gbmV3IFNpbXBsZVhNTFBhcnNlcih7CiAgICAgICAgaGFzQXR0cmlidXRlczogdHJ1ZQogICAgICB9KS5wYXJzZUZyb21TdHJpbmcoZGF0YS5kYXRhc2V0cykuZG9jdW1lbnRFbGVtZW50OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IERhdGFzZXRYTUxQYXJzZXIoewogICAgICAgIGhhc0F0dHJpYnV0ZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRyeSB7CiAgICAgICAgcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhkYXRhWyJ4ZHA6eGRwIl0pOwogICAgICB9IGNhdGNoIHt9CiAgICAgIHRoaXMubm9kZSA9IHBhcnNlci5ub2RlOwogICAgfQogIH0KICBnZXRWYWx1ZShwYXRoKSB7CiAgICBpZiAoIXRoaXMubm9kZSB8fCAhcGF0aCkgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCBub2RlID0gdGhpcy5ub2RlLnNlYXJjaE5vZGUocGFyc2VYRkFQYXRoKHBhdGgpLCAwKTsKICAgIGlmICghbm9kZSkgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCBmaXJzdCA9IG5vZGUuZmlyc3RDaGlsZDsKICAgIGlmIChmaXJzdD8ubm9kZU5hbWUgPT09ICJ2YWx1ZSIpIHsKICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW4ubWFwKGNoaWxkID0+IGRlY29kZVN0cmluZyhjaGlsZC50ZXh0Q29udGVudCkpOwogICAgfQogICAgcmV0dXJuIGRlY29kZVN0cmluZyhub2RlLnRleHRDb250ZW50KTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ludGVyc2VjdG9yLmpzCmNsYXNzIFNpbmdsZUludGVyc2VjdG9yIHsKICAjYW5ub3RhdGlvbjsKICAjbWluWCA9IEluZmluaXR5OwogICNtaW5ZID0gSW5maW5pdHk7CiAgI21heFggPSAtSW5maW5pdHk7CiAgI21heFkgPSAtSW5maW5pdHk7CiAgI3F1YWRQb2ludHMgPSBudWxsOwogICN0ZXh0ID0gW107CiAgI2V4dHJhQ2hhcnMgPSBbXTsKICAjbGFzdEludGVyc2VjdGluZ1F1YWRJbmRleCA9IC0xOwogICNjYW5UYWtlRXh0cmFDaGFycyA9IGZhbHNlOwogIGNvbnN0cnVjdG9yKGFubm90YXRpb24pIHsKICAgIHRoaXMuI2Fubm90YXRpb24gPSBhbm5vdGF0aW9uOwogICAgY29uc3QgcXVhZFBvaW50cyA9IGFubm90YXRpb24uZGF0YS5xdWFkUG9pbnRzOwogICAgaWYgKCFxdWFkUG9pbnRzKSB7CiAgICAgIFt0aGlzLiNtaW5YLCB0aGlzLiNtaW5ZLCB0aGlzLiNtYXhYLCB0aGlzLiNtYXhZXSA9IGFubm90YXRpb24uZGF0YS5yZWN0OwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBxdWFkUG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDgpIHsKICAgICAgdGhpcy4jbWluWCA9IE1hdGgubWluKHRoaXMuI21pblgsIHF1YWRQb2ludHNbaV0pOwogICAgICB0aGlzLiNtYXhYID0gTWF0aC5tYXgodGhpcy4jbWF4WCwgcXVhZFBvaW50c1tpICsgMl0pOwogICAgICB0aGlzLiNtaW5ZID0gTWF0aC5taW4odGhpcy4jbWluWSwgcXVhZFBvaW50c1tpICsgNV0pOwogICAgICB0aGlzLiNtYXhZID0gTWF0aC5tYXgodGhpcy4jbWF4WSwgcXVhZFBvaW50c1tpICsgMV0pOwogICAgfQogICAgaWYgKHF1YWRQb2ludHMubGVuZ3RoID4gOCkgewogICAgICB0aGlzLiNxdWFkUG9pbnRzID0gcXVhZFBvaW50czsKICAgIH0KICB9CiAgb3ZlcmxhcHMob3RoZXIpIHsKICAgIHJldHVybiAhKHRoaXMuI21pblggPj0gb3RoZXIuI21heFggfHwgdGhpcy4jbWF4WCA8PSBvdGhlci4jbWluWCB8fCB0aGlzLiNtaW5ZID49IG90aGVyLiNtYXhZIHx8IHRoaXMuI21heFkgPD0gb3RoZXIuI21pblkpOwogIH0KICAjaW50ZXJzZWN0cyh4LCB5KSB7CiAgICBpZiAodGhpcy4jbWluWCA+PSB4IHx8IHRoaXMuI21heFggPD0geCB8fCB0aGlzLiNtaW5ZID49IHkgfHwgdGhpcy4jbWF4WSA8PSB5KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLiNxdWFkUG9pbnRzOwogICAgaWYgKCFxdWFkUG9pbnRzKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHRoaXMuI2xhc3RJbnRlcnNlY3RpbmdRdWFkSW5kZXggPj0gMCkgewogICAgICBjb25zdCBpID0gdGhpcy4jbGFzdEludGVyc2VjdGluZ1F1YWRJbmRleDsKICAgICAgaWYgKCEocXVhZFBvaW50c1tpXSA+PSB4IHx8IHF1YWRQb2ludHNbaSArIDJdIDw9IHggfHwgcXVhZFBvaW50c1tpICsgNV0gPj0geSB8fCBxdWFkUG9pbnRzW2kgKyAxXSA8PSB5KSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHRoaXMuI2xhc3RJbnRlcnNlY3RpbmdRdWFkSW5kZXggPSAtMTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHF1YWRQb2ludHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gOCkgewogICAgICBpZiAoIShxdWFkUG9pbnRzW2ldID49IHggfHwgcXVhZFBvaW50c1tpICsgMl0gPD0geCB8fCBxdWFkUG9pbnRzW2kgKyA1XSA+PSB5IHx8IHF1YWRQb2ludHNbaSArIDFdIDw9IHkpKSB7CiAgICAgICAgdGhpcy4jbGFzdEludGVyc2VjdGluZ1F1YWRJbmRleCA9IGk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgYWRkR2x5cGgoeCwgeSwgZ2x5cGgpIHsKICAgIGlmICghdGhpcy4jaW50ZXJzZWN0cyh4LCB5KSkgewogICAgICB0aGlzLmRpc2FibGVFeHRyYUNoYXJzKCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLiNleHRyYUNoYXJzLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy4jdGV4dC5wdXNoKHRoaXMuI2V4dHJhQ2hhcnMuam9pbigiIikpOwogICAgICB0aGlzLiNleHRyYUNoYXJzLmxlbmd0aCA9IDA7CiAgICB9CiAgICB0aGlzLiN0ZXh0LnB1c2goZ2x5cGgpOwogICAgdGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMgPSB0cnVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGFkZEV4dHJhQ2hhcihjaGFyKSB7CiAgICBpZiAodGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMpIHsKICAgICAgdGhpcy4jZXh0cmFDaGFycy5wdXNoKGNoYXIpOwogICAgfQogIH0KICBkaXNhYmxlRXh0cmFDaGFycygpIHsKICAgIGlmICghdGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMgPSBmYWxzZTsKICAgIHRoaXMuI2V4dHJhQ2hhcnMubGVuZ3RoID0gMDsKICB9CiAgc2V0VGV4dCgpIHsKICAgIHRoaXMuI2Fubm90YXRpb24uZGF0YS5vdmVybGFpZFRleHQgPSB0aGlzLiN0ZXh0LmpvaW4oIiIpOwogIH0KfQpjbGFzcyBJbnRlcnNlY3RvciB7CiAgI2ludGVyc2VjdG9ycyA9IG5ldyBNYXAoKTsKICBjb25zdHJ1Y3Rvcihhbm5vdGF0aW9ucykgewogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmICghYW5ub3RhdGlvbi5kYXRhLnF1YWRQb2ludHMgJiYgIWFubm90YXRpb24uZGF0YS5yZWN0KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaW50ZXJzZWN0b3IgPSBuZXcgU2luZ2xlSW50ZXJzZWN0b3IoYW5ub3RhdGlvbik7CiAgICAgIGZvciAoY29uc3QgW290aGVySW50ZXJzZWN0b3IsIG92ZXJsYXBwaW5nXSBvZiB0aGlzLiNpbnRlcnNlY3RvcnMpIHsKICAgICAgICBpZiAob3RoZXJJbnRlcnNlY3Rvci5vdmVybGFwcyhpbnRlcnNlY3RvcikpIHsKICAgICAgICAgIGlmICghb3ZlcmxhcHBpbmcpIHsKICAgICAgICAgICAgdGhpcy4jaW50ZXJzZWN0b3JzLnNldChvdGhlckludGVyc2VjdG9yLCBuZXcgU2V0KFtpbnRlcnNlY3Rvcl0pKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG92ZXJsYXBwaW5nLmFkZChpbnRlcnNlY3Rvcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuI2ludGVyc2VjdG9ycy5zZXQoaW50ZXJzZWN0b3IsIG51bGwpOwogICAgfQogIH0KICBhZGRHbHlwaCh0cmFuc2Zvcm0sIHdpZHRoLCBoZWlnaHQsIGdseXBoKSB7CiAgICBjb25zdCB4ID0gdHJhbnNmb3JtWzRdICsgd2lkdGggLyAyOwogICAgY29uc3QgeSA9IHRyYW5zZm9ybVs1XSArIGhlaWdodCAvIDI7CiAgICBsZXQgb3ZlcmxhcHBpbmdJbnRlcnNlY3RvcnM7CiAgICBmb3IgKGNvbnN0IFtpbnRlcnNlY3Rvciwgb3ZlcmxhcHBpbmddIG9mIHRoaXMuI2ludGVyc2VjdG9ycykgewogICAgICBpZiAob3ZlcmxhcHBpbmdJbnRlcnNlY3RvcnMpIHsKICAgICAgICBpZiAob3ZlcmxhcHBpbmdJbnRlcnNlY3RvcnMuaGFzKGludGVyc2VjdG9yKSkgewogICAgICAgICAgaW50ZXJzZWN0b3IuYWRkR2x5cGgoeCwgeSwgZ2x5cGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpbnRlcnNlY3Rvci5kaXNhYmxlRXh0cmFDaGFycygpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWludGVyc2VjdG9yLmFkZEdseXBoKHgsIHksIGdseXBoKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIG92ZXJsYXBwaW5nSW50ZXJzZWN0b3JzID0gb3ZlcmxhcHBpbmc7CiAgICB9CiAgfQogIGFkZEV4dHJhQ2hhcihjaGFyKSB7CiAgICBmb3IgKGNvbnN0IGludGVyc2VjdG9yIG9mIHRoaXMuI2ludGVyc2VjdG9ycy5rZXlzKCkpIHsKICAgICAgaW50ZXJzZWN0b3IuYWRkRXh0cmFDaGFyKGNoYXIpOwogICAgfQogIH0KICBzZXRUZXh0KCkgewogICAgZm9yIChjb25zdCBpbnRlcnNlY3RvciBvZiB0aGlzLiNpbnRlcnNlY3RvcnMua2V5cygpKSB7CiAgICAgIGludGVyc2VjdG9yLnNldFRleHQoKTsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NhbGN1bGF0ZV9zaGFfb3RoZXIuanMKCmNsYXNzIFdvcmQ2NCB7CiAgY29uc3RydWN0b3IoaGlnaEludGVnZXIsIGxvd0ludGVnZXIpIHsKICAgIHRoaXMuaGlnaCA9IGhpZ2hJbnRlZ2VyIHwgMDsKICAgIHRoaXMubG93ID0gbG93SW50ZWdlciB8IDA7CiAgfQogIGFuZCh3b3JkKSB7CiAgICB0aGlzLmhpZ2ggJj0gd29yZC5oaWdoOwogICAgdGhpcy5sb3cgJj0gd29yZC5sb3c7CiAgfQogIHhvcih3b3JkKSB7CiAgICB0aGlzLmhpZ2ggXj0gd29yZC5oaWdoOwogICAgdGhpcy5sb3cgXj0gd29yZC5sb3c7CiAgfQogIHNoaWZ0UmlnaHQocGxhY2VzKSB7CiAgICBpZiAocGxhY2VzID49IDMyKSB7CiAgICAgIHRoaXMubG93ID0gdGhpcy5oaWdoID4+PiBwbGFjZXMgLSAzMiB8IDA7CiAgICAgIHRoaXMuaGlnaCA9IDA7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmxvdyA9IHRoaXMubG93ID4+PiBwbGFjZXMgfCB0aGlzLmhpZ2ggPDwgMzIgLSBwbGFjZXM7CiAgICAgIHRoaXMuaGlnaCA9IHRoaXMuaGlnaCA+Pj4gcGxhY2VzIHwgMDsKICAgIH0KICB9CiAgcm90YXRlUmlnaHQocGxhY2VzKSB7CiAgICBsZXQgbG93LCBoaWdoOwogICAgaWYgKHBsYWNlcyAmIDMyKSB7CiAgICAgIGhpZ2ggPSB0aGlzLmxvdzsKICAgICAgbG93ID0gdGhpcy5oaWdoOwogICAgfSBlbHNlIHsKICAgICAgbG93ID0gdGhpcy5sb3c7CiAgICAgIGhpZ2ggPSB0aGlzLmhpZ2g7CiAgICB9CiAgICBwbGFjZXMgJj0gMzE7CiAgICB0aGlzLmxvdyA9IGxvdyA+Pj4gcGxhY2VzIHwgaGlnaCA8PCAzMiAtIHBsYWNlczsKICAgIHRoaXMuaGlnaCA9IGhpZ2ggPj4+IHBsYWNlcyB8IGxvdyA8PCAzMiAtIHBsYWNlczsKICB9CiAgbm90KCkgewogICAgdGhpcy5oaWdoID0gfnRoaXMuaGlnaDsKICAgIHRoaXMubG93ID0gfnRoaXMubG93OwogIH0KICBhZGQod29yZCkgewogICAgY29uc3QgbG93QWRkID0gKHRoaXMubG93ID4+PiAwKSArICh3b3JkLmxvdyA+Pj4gMCk7CiAgICBsZXQgaGlnaEFkZCA9ICh0aGlzLmhpZ2ggPj4+IDApICsgKHdvcmQuaGlnaCA+Pj4gMCk7CiAgICBpZiAobG93QWRkID4gMHhmZmZmZmZmZikgewogICAgICBoaWdoQWRkICs9IDE7CiAgICB9CiAgICB0aGlzLmxvdyA9IGxvd0FkZCB8IDA7CiAgICB0aGlzLmhpZ2ggPSBoaWdoQWRkIHwgMDsKICB9CiAgY29weVRvKGJ5dGVzLCBvZmZzZXQpIHsKICAgIGJ5dGVzW29mZnNldF0gPSB0aGlzLmhpZ2ggPj4+IDI0ICYgMHhmZjsKICAgIGJ5dGVzW29mZnNldCArIDFdID0gdGhpcy5oaWdoID4+IDE2ICYgMHhmZjsKICAgIGJ5dGVzW29mZnNldCArIDJdID0gdGhpcy5oaWdoID4+IDggJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgM10gPSB0aGlzLmhpZ2ggJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgNF0gPSB0aGlzLmxvdyA+Pj4gMjQgJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgNV0gPSB0aGlzLmxvdyA+PiAxNiAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA2XSA9IHRoaXMubG93ID4+IDggJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgN10gPSB0aGlzLmxvdyAmIDB4ZmY7CiAgfQogIGFzc2lnbih3b3JkKSB7CiAgICB0aGlzLmhpZ2ggPSB3b3JkLmhpZ2g7CiAgICB0aGlzLmxvdyA9IHdvcmQubG93OwogIH0KfQpjb25zdCBjYWxjdWxhdGVfc2hhX290aGVyX1BBUkFNUyA9IHsKICBnZXQgaygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImsiLCBbbmV3IFdvcmQ2NCgweDQyOGEyZjk4LCAweGQ3MjhhZTIyKSwgbmV3IFdvcmQ2NCgweDcxMzc0NDkxLCAweDIzZWY2NWNkKSwgbmV3IFdvcmQ2NCgweGI1YzBmYmNmLCAweGVjNGQzYjJmKSwgbmV3IFdvcmQ2NCgweGU5YjVkYmE1LCAweDgxODlkYmJjKSwgbmV3IFdvcmQ2NCgweDM5NTZjMjViLCAweGYzNDhiNTM4KSwgbmV3IFdvcmQ2NCgweDU5ZjExMWYxLCAweGI2MDVkMDE5KSwgbmV3IFdvcmQ2NCgweDkyM2Y4MmE0LCAweGFmMTk0ZjliKSwgbmV3IFdvcmQ2NCgweGFiMWM1ZWQ1LCAweGRhNmQ4MTE4KSwgbmV3IFdvcmQ2NCgweGQ4MDdhYTk4LCAweGEzMDMwMjQyKSwgbmV3IFdvcmQ2NCgweDEyODM1YjAxLCAweDQ1NzA2ZmJlKSwgbmV3IFdvcmQ2NCgweDI0MzE4NWJlLCAweDRlZTRiMjhjKSwgbmV3IFdvcmQ2NCgweDU1MGM3ZGMzLCAweGQ1ZmZiNGUyKSwgbmV3IFdvcmQ2NCgweDcyYmU1ZDc0LCAweGYyN2I4OTZmKSwgbmV3IFdvcmQ2NCgweDgwZGViMWZlLCAweDNiMTY5NmIxKSwgbmV3IFdvcmQ2NCgweDliZGMwNmE3LCAweDI1YzcxMjM1KSwgbmV3IFdvcmQ2NCgweGMxOWJmMTc0LCAweGNmNjkyNjk0KSwgbmV3IFdvcmQ2NCgweGU0OWI2OWMxLCAweDllZjE0YWQyKSwgbmV3IFdvcmQ2NCgweGVmYmU0Nzg2LCAweDM4NGYyNWUzKSwgbmV3IFdvcmQ2NCgweDBmYzE5ZGM2LCAweDhiOGNkNWI1KSwgbmV3IFdvcmQ2NCgweDI0MGNhMWNjLCAweDc3YWM5YzY1KSwgbmV3IFdvcmQ2NCgweDJkZTkyYzZmLCAweDU5MmIwMjc1KSwgbmV3IFdvcmQ2NCgweDRhNzQ4NGFhLCAweDZlYTZlNDgzKSwgbmV3IFdvcmQ2NCgweDVjYjBhOWRjLCAweGJkNDFmYmQ0KSwgbmV3IFdvcmQ2NCgweDc2Zjk4OGRhLCAweDgzMTE1M2I1KSwgbmV3IFdvcmQ2NCgweDk4M2U1MTUyLCAweGVlNjZkZmFiKSwgbmV3IFdvcmQ2NCgweGE4MzFjNjZkLCAweDJkYjQzMjEwKSwgbmV3IFdvcmQ2NCgweGIwMDMyN2M4LCAweDk4ZmIyMTNmKSwgbmV3IFdvcmQ2NCgweGJmNTk3ZmM3LCAweGJlZWYwZWU0KSwgbmV3IFdvcmQ2NCgweGM2ZTAwYmYzLCAweDNkYTg4ZmMyKSwgbmV3IFdvcmQ2NCgweGQ1YTc5MTQ3LCAweDkzMGFhNzI1KSwgbmV3IFdvcmQ2NCgweDA2Y2E2MzUxLCAweGUwMDM4MjZmKSwgbmV3IFdvcmQ2NCgweDE0MjkyOTY3LCAweDBhMGU2ZTcwKSwgbmV3IFdvcmQ2NCgweDI3YjcwYTg1LCAweDQ2ZDIyZmZjKSwgbmV3IFdvcmQ2NCgweDJlMWIyMTM4LCAweDVjMjZjOTI2KSwgbmV3IFdvcmQ2NCgweDRkMmM2ZGZjLCAweDVhYzQyYWVkKSwgbmV3IFdvcmQ2NCgweDUzMzgwZDEzLCAweDlkOTViM2RmKSwgbmV3IFdvcmQ2NCgweDY1MGE3MzU0LCAweDhiYWY2M2RlKSwgbmV3IFdvcmQ2NCgweDc2NmEwYWJiLCAweDNjNzdiMmE4KSwgbmV3IFdvcmQ2NCgweDgxYzJjOTJlLCAweDQ3ZWRhZWU2KSwgbmV3IFdvcmQ2NCgweDkyNzIyYzg1LCAweDE0ODIzNTNiKSwgbmV3IFdvcmQ2NCgweGEyYmZlOGExLCAweDRjZjEwMzY0KSwgbmV3IFdvcmQ2NCgweGE4MWE2NjRiLCAweGJjNDIzMDAxKSwgbmV3IFdvcmQ2NCgweGMyNGI4YjcwLCAweGQwZjg5NzkxKSwgbmV3IFdvcmQ2NCgweGM3NmM1MWEzLCAweDA2NTRiZTMwKSwgbmV3IFdvcmQ2NCgweGQxOTJlODE5LCAweGQ2ZWY1MjE4KSwgbmV3IFdvcmQ2NCgweGQ2OTkwNjI0LCAweDU1NjVhOTEwKSwgbmV3IFdvcmQ2NCgweGY0MGUzNTg1LCAweDU3NzEyMDJhKSwgbmV3IFdvcmQ2NCgweDEwNmFhMDcwLCAweDMyYmJkMWI4KSwgbmV3IFdvcmQ2NCgweDE5YTRjMTE2LCAweGI4ZDJkMGM4KSwgbmV3IFdvcmQ2NCgweDFlMzc2YzA4LCAweDUxNDFhYjUzKSwgbmV3IFdvcmQ2NCgweDI3NDg3NzRjLCAweGRmOGVlYjk5KSwgbmV3IFdvcmQ2NCgweDM0YjBiY2I1LCAweGUxOWI0OGE4KSwgbmV3IFdvcmQ2NCgweDM5MWMwY2IzLCAweGM1Yzk1YTYzKSwgbmV3IFdvcmQ2NCgweDRlZDhhYTRhLCAweGUzNDE4YWNiKSwgbmV3IFdvcmQ2NCgweDViOWNjYTRmLCAweDc3NjNlMzczKSwgbmV3IFdvcmQ2NCgweDY4MmU2ZmYzLCAweGQ2YjJiOGEzKSwgbmV3IFdvcmQ2NCgweDc0OGY4MmVlLCAweDVkZWZiMmZjKSwgbmV3IFdvcmQ2NCgweDc4YTU2MzZmLCAweDQzMTcyZjYwKSwgbmV3IFdvcmQ2NCgweDg0Yzg3ODE0LCAweGExZjBhYjcyKSwgbmV3IFdvcmQ2NCgweDhjYzcwMjA4LCAweDFhNjQzOWVjKSwgbmV3IFdvcmQ2NCgweDkwYmVmZmZhLCAweDIzNjMxZTI4KSwgbmV3IFdvcmQ2NCgweGE0NTA2Y2ViLCAweGRlODJiZGU5KSwgbmV3IFdvcmQ2NCgweGJlZjlhM2Y3LCAweGIyYzY3OTE1KSwgbmV3IFdvcmQ2NCgweGM2NzE3OGYyLCAweGUzNzI1MzJiKSwgbmV3IFdvcmQ2NCgweGNhMjczZWNlLCAweGVhMjY2MTljKSwgbmV3IFdvcmQ2NCgweGQxODZiOGM3LCAweDIxYzBjMjA3KSwgbmV3IFdvcmQ2NCgweGVhZGE3ZGQ2LCAweGNkZTBlYjFlKSwgbmV3IFdvcmQ2NCgweGY1N2Q0ZjdmLCAweGVlNmVkMTc4KSwgbmV3IFdvcmQ2NCgweDA2ZjA2N2FhLCAweDcyMTc2ZmJhKSwgbmV3IFdvcmQ2NCgweDBhNjM3ZGM1LCAweGEyYzg5OGE2KSwgbmV3IFdvcmQ2NCgweDExM2Y5ODA0LCAweGJlZjkwZGFlKSwgbmV3IFdvcmQ2NCgweDFiNzEwYjM1LCAweDEzMWM0NzFiKSwgbmV3IFdvcmQ2NCgweDI4ZGI3N2Y1LCAweDIzMDQ3ZDg0KSwgbmV3IFdvcmQ2NCgweDMyY2FhYjdiLCAweDQwYzcyNDkzKSwgbmV3IFdvcmQ2NCgweDNjOWViZTBhLCAweDE1YzliZWJjKSwgbmV3IFdvcmQ2NCgweDQzMWQ2N2M0LCAweDljMTAwZDRjKSwgbmV3IFdvcmQ2NCgweDRjYzVkNGJlLCAweGNiM2U0MmI2KSwgbmV3IFdvcmQ2NCgweDU5N2YyOTljLCAweGZjNjU3ZTJhKSwgbmV3IFdvcmQ2NCgweDVmY2I2ZmFiLCAweDNhZDZmYWVjKSwgbmV3IFdvcmQ2NCgweDZjNDQxOThjLCAweDRhNDc1ODE3KV0pOwogIH0KfTsKZnVuY3Rpb24gY2gocmVzdWx0LCB4LCB5LCB6LCB0bXApIHsKICByZXN1bHQuYXNzaWduKHgpOwogIHJlc3VsdC5hbmQoeSk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAubm90KCk7CiAgdG1wLmFuZCh6KTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gbWFqKHJlc3VsdCwgeCwgeSwgeiwgdG1wKSB7CiAgcmVzdWx0LmFzc2lnbih4KTsKICByZXN1bHQuYW5kKHkpOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLmFuZCh6KTsKICByZXN1bHQueG9yKHRtcCk7CiAgdG1wLmFzc2lnbih5KTsKICB0bXAuYW5kKHopOwogIHJlc3VsdC54b3IodG1wKTsKfQpmdW5jdGlvbiBzaWdtYShyZXN1bHQsIHgsIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDI4KTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCgzNCk7CiAgcmVzdWx0Lnhvcih0bXApOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDM5KTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gc2lnbWFQcmltZShyZXN1bHQsIHgsIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDE0KTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCgxOCk7CiAgcmVzdWx0Lnhvcih0bXApOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDQxKTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gbGl0dGxlU2lnbWEocmVzdWx0LCB4LCB0bXApIHsKICByZXN1bHQuYXNzaWduKHgpOwogIHJlc3VsdC5yb3RhdGVSaWdodCgxKTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCg4KTsKICByZXN1bHQueG9yKHRtcCk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAuc2hpZnRSaWdodCg3KTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gbGl0dGxlU2lnbWFQcmltZShyZXN1bHQsIHgsIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDE5KTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCg2MSk7CiAgcmVzdWx0Lnhvcih0bXApOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnNoaWZ0UmlnaHQoNik7CiAgcmVzdWx0Lnhvcih0bXApOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZVNIQTUxMihkYXRhLCBvZmZzZXQsIGxlbmd0aCwgbW9kZTM4NCA9IGZhbHNlKSB7CiAgbGV0IGgwLCBoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBoNzsKICBpZiAoIW1vZGUzODQpIHsKICAgIGgwID0gbmV3IFdvcmQ2NCgweDZhMDllNjY3LCAweGYzYmNjOTA4KTsKICAgIGgxID0gbmV3IFdvcmQ2NCgweGJiNjdhZTg1LCAweDg0Y2FhNzNiKTsKICAgIGgyID0gbmV3IFdvcmQ2NCgweDNjNmVmMzcyLCAweGZlOTRmODJiKTsKICAgIGgzID0gbmV3IFdvcmQ2NCgweGE1NGZmNTNhLCAweDVmMWQzNmYxKTsKICAgIGg0ID0gbmV3IFdvcmQ2NCgweDUxMGU1MjdmLCAweGFkZTY4MmQxKTsKICAgIGg1ID0gbmV3IFdvcmQ2NCgweDliMDU2ODhjLCAweDJiM2U2YzFmKTsKICAgIGg2ID0gbmV3IFdvcmQ2NCgweDFmODNkOWFiLCAweGZiNDFiZDZiKTsKICAgIGg3ID0gbmV3IFdvcmQ2NCgweDViZTBjZDE5LCAweDEzN2UyMTc5KTsKICB9IGVsc2UgewogICAgaDAgPSBuZXcgV29yZDY0KDB4Y2JiYjlkNWQsIDB4YzEwNTllZDgpOwogICAgaDEgPSBuZXcgV29yZDY0KDB4NjI5YTI5MmEsIDB4MzY3Y2Q1MDcpOwogICAgaDIgPSBuZXcgV29yZDY0KDB4OTE1OTAxNWEsIDB4MzA3MGRkMTcpOwogICAgaDMgPSBuZXcgV29yZDY0KDB4MTUyZmVjZDgsIDB4ZjcwZTU5MzkpOwogICAgaDQgPSBuZXcgV29yZDY0KDB4NjczMzI2NjcsIDB4ZmZjMDBiMzEpOwogICAgaDUgPSBuZXcgV29yZDY0KDB4OGViNDRhODcsIDB4Njg1ODE1MTEpOwogICAgaDYgPSBuZXcgV29yZDY0KDB4ZGIwYzJlMGQsIDB4NjRmOThmYTcpOwogICAgaDcgPSBuZXcgV29yZDY0KDB4NDdiNTQ4MWQsIDB4YmVmYTRmYTQpOwogIH0KICBjb25zdCBwYWRkZWRMZW5ndGggPSBNYXRoLmNlaWwoKGxlbmd0aCArIDE3KSAvIDEyOCkgKiAxMjg7CiAgY29uc3QgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkocGFkZGVkTGVuZ3RoKTsKICBsZXQgaSwgajsKICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIHBhZGRlZFtpXSA9IGRhdGFbb2Zmc2V0KytdOwogIH0KICBwYWRkZWRbaSsrXSA9IDB4ODA7CiAgY29uc3QgbiA9IHBhZGRlZExlbmd0aCAtIDE2OwogIGlmIChpIDwgbikgewogICAgaSA9IG47CiAgfQogIGkgKz0gMTE7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4+IDI5ICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAyMSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMTMgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDUgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoIDw8IDMgJiAweGZmOwogIGNvbnN0IHcgPSBuZXcgQXJyYXkoODApOwogIGZvciAoaSA9IDA7IGkgPCA4MDsgaSsrKSB7CiAgICB3W2ldID0gbmV3IFdvcmQ2NCgwLCAwKTsKICB9CiAgY29uc3QgewogICAgawogIH0gPSBjYWxjdWxhdGVfc2hhX290aGVyX1BBUkFNUzsKICBsZXQgYSA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICBiID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgIGMgPSBuZXcgV29yZDY0KDAsIDApOwogIGxldCBkID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgIGUgPSBuZXcgV29yZDY0KDAsIDApLAogICAgZiA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgbGV0IGcgPSBuZXcgV29yZDY0KDAsIDApLAogICAgaCA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgY29uc3QgdDEgPSBuZXcgV29yZDY0KDAsIDApLAogICAgdDIgPSBuZXcgV29yZDY0KDAsIDApOwogIGNvbnN0IHRtcDEgPSBuZXcgV29yZDY0KDAsIDApLAogICAgdG1wMiA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgbGV0IHRtcDM7CiAgZm9yIChpID0gMDsgaSA8IHBhZGRlZExlbmd0aDspIHsKICAgIGZvciAoaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgIHdbal0uaGlnaCA9IHBhZGRlZFtpXSA8PCAyNCB8IHBhZGRlZFtpICsgMV0gPDwgMTYgfCBwYWRkZWRbaSArIDJdIDw8IDggfCBwYWRkZWRbaSArIDNdOwogICAgICB3W2pdLmxvdyA9IHBhZGRlZFtpICsgNF0gPDwgMjQgfCBwYWRkZWRbaSArIDVdIDw8IDE2IHwgcGFkZGVkW2kgKyA2XSA8PCA4IHwgcGFkZGVkW2kgKyA3XTsKICAgICAgaSArPSA4OwogICAgfQogICAgZm9yIChqID0gMTY7IGogPCA4MDsgKytqKSB7CiAgICAgIHRtcDMgPSB3W2pdOwogICAgICBsaXR0bGVTaWdtYVByaW1lKHRtcDMsIHdbaiAtIDJdLCB0bXAyKTsKICAgICAgdG1wMy5hZGQod1tqIC0gN10pOwogICAgICBsaXR0bGVTaWdtYSh0bXAxLCB3W2ogLSAxNV0sIHRtcDIpOwogICAgICB0bXAzLmFkZCh0bXAxKTsKICAgICAgdG1wMy5hZGQod1tqIC0gMTZdKTsKICAgIH0KICAgIGEuYXNzaWduKGgwKTsKICAgIGIuYXNzaWduKGgxKTsKICAgIGMuYXNzaWduKGgyKTsKICAgIGQuYXNzaWduKGgzKTsKICAgIGUuYXNzaWduKGg0KTsKICAgIGYuYXNzaWduKGg1KTsKICAgIGcuYXNzaWduKGg2KTsKICAgIGguYXNzaWduKGg3KTsKICAgIGZvciAoaiA9IDA7IGogPCA4MDsgKytqKSB7CiAgICAgIHQxLmFzc2lnbihoKTsKICAgICAgc2lnbWFQcmltZSh0bXAxLCBlLCB0bXAyKTsKICAgICAgdDEuYWRkKHRtcDEpOwogICAgICBjaCh0bXAxLCBlLCBmLCBnLCB0bXAyKTsKICAgICAgdDEuYWRkKHRtcDEpOwogICAgICB0MS5hZGQoa1tqXSk7CiAgICAgIHQxLmFkZCh3W2pdKTsKICAgICAgc2lnbWEodDIsIGEsIHRtcDIpOwogICAgICBtYWoodG1wMSwgYSwgYiwgYywgdG1wMik7CiAgICAgIHQyLmFkZCh0bXAxKTsKICAgICAgdG1wMyA9IGg7CiAgICAgIGggPSBnOwogICAgICBnID0gZjsKICAgICAgZiA9IGU7CiAgICAgIGQuYWRkKHQxKTsKICAgICAgZSA9IGQ7CiAgICAgIGQgPSBjOwogICAgICBjID0gYjsKICAgICAgYiA9IGE7CiAgICAgIHRtcDMuYXNzaWduKHQxKTsKICAgICAgdG1wMy5hZGQodDIpOwogICAgICBhID0gdG1wMzsKICAgIH0KICAgIGgwLmFkZChhKTsKICAgIGgxLmFkZChiKTsKICAgIGgyLmFkZChjKTsKICAgIGgzLmFkZChkKTsKICAgIGg0LmFkZChlKTsKICAgIGg1LmFkZChmKTsKICAgIGg2LmFkZChnKTsKICAgIGg3LmFkZChoKTsKICB9CiAgbGV0IHJlc3VsdDsKICBpZiAoIW1vZGUzODQpIHsKICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KDY0KTsKICAgIGgwLmNvcHlUbyhyZXN1bHQsIDApOwogICAgaDEuY29weVRvKHJlc3VsdCwgOCk7CiAgICBoMi5jb3B5VG8ocmVzdWx0LCAxNik7CiAgICBoMy5jb3B5VG8ocmVzdWx0LCAyNCk7CiAgICBoNC5jb3B5VG8ocmVzdWx0LCAzMik7CiAgICBoNS5jb3B5VG8ocmVzdWx0LCA0MCk7CiAgICBoNi5jb3B5VG8ocmVzdWx0LCA0OCk7CiAgICBoNy5jb3B5VG8ocmVzdWx0LCA1Nik7CiAgfSBlbHNlIHsKICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KDQ4KTsKICAgIGgwLmNvcHlUbyhyZXN1bHQsIDApOwogICAgaDEuY29weVRvKHJlc3VsdCwgOCk7CiAgICBoMi5jb3B5VG8ocmVzdWx0LCAxNik7CiAgICBoMy5jb3B5VG8ocmVzdWx0LCAyNCk7CiAgICBoNC5jb3B5VG8ocmVzdWx0LCAzMik7CiAgICBoNS5jb3B5VG8ocmVzdWx0LCA0MCk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlU0hBMzg0KGRhdGEsIG9mZnNldCwgbGVuZ3RoKSB7CiAgcmV0dXJuIGNhbGN1bGF0ZVNIQTUxMihkYXRhLCBvZmZzZXQsIGxlbmd0aCwgdHJ1ZSk7Cn0KCjsvLyAuL3NyYy9jb3JlL2NhbGN1bGF0ZV9zaGEyNTYuanMKCmNvbnN0IGNhbGN1bGF0ZV9zaGEyNTZfUEFSQU1TID0gewogIGdldCBrKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiayIsIFsweDQyOGEyZjk4LCAweDcxMzc0NDkxLCAweGI1YzBmYmNmLCAweGU5YjVkYmE1LCAweDM5NTZjMjViLCAweDU5ZjExMWYxLCAweDkyM2Y4MmE0LCAweGFiMWM1ZWQ1LCAweGQ4MDdhYTk4LCAweDEyODM1YjAxLCAweDI0MzE4NWJlLCAweDU1MGM3ZGMzLCAweDcyYmU1ZDc0LCAweDgwZGViMWZlLCAweDliZGMwNmE3LCAweGMxOWJmMTc0LCAweGU0OWI2OWMxLCAweGVmYmU0Nzg2LCAweDBmYzE5ZGM2LCAweDI0MGNhMWNjLCAweDJkZTkyYzZmLCAweDRhNzQ4NGFhLCAweDVjYjBhOWRjLCAweDc2Zjk4OGRhLCAweDk4M2U1MTUyLCAweGE4MzFjNjZkLCAweGIwMDMyN2M4LCAweGJmNTk3ZmM3LCAweGM2ZTAwYmYzLCAweGQ1YTc5MTQ3LCAweDA2Y2E2MzUxLCAweDE0MjkyOTY3LCAweDI3YjcwYTg1LCAweDJlMWIyMTM4LCAweDRkMmM2ZGZjLCAweDUzMzgwZDEzLCAweDY1MGE3MzU0LCAweDc2NmEwYWJiLCAweDgxYzJjOTJlLCAweDkyNzIyYzg1LCAweGEyYmZlOGExLCAweGE4MWE2NjRiLCAweGMyNGI4YjcwLCAweGM3NmM1MWEzLCAweGQxOTJlODE5LCAweGQ2OTkwNjI0LCAweGY0MGUzNTg1LCAweDEwNmFhMDcwLCAweDE5YTRjMTE2LCAweDFlMzc2YzA4LCAweDI3NDg3NzRjLCAweDM0YjBiY2I1LCAweDM5MWMwY2IzLCAweDRlZDhhYTRhLCAweDViOWNjYTRmLCAweDY4MmU2ZmYzLCAweDc0OGY4MmVlLCAweDc4YTU2MzZmLCAweDg0Yzg3ODE0LCAweDhjYzcwMjA4LCAweDkwYmVmZmZhLCAweGE0NTA2Y2ViLCAweGJlZjlhM2Y3LCAweGM2NzE3OGYyXSk7CiAgfQp9OwpmdW5jdGlvbiByb3RyKHgsIG4pIHsKICByZXR1cm4geCA+Pj4gbiB8IHggPDwgMzIgLSBuOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZV9zaGEyNTZfY2goeCwgeSwgeikgewogIHJldHVybiB4ICYgeSBeIH54ICYgejsKfQpmdW5jdGlvbiBjYWxjdWxhdGVfc2hhMjU2X21haih4LCB5LCB6KSB7CiAgcmV0dXJuIHggJiB5IF4geCAmIHogXiB5ICYgejsKfQpmdW5jdGlvbiBjYWxjdWxhdGVfc2hhMjU2X3NpZ21hKHgpIHsKICByZXR1cm4gcm90cih4LCAyKSBeIHJvdHIoeCwgMTMpIF4gcm90cih4LCAyMik7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlX3NoYTI1Nl9zaWdtYVByaW1lKHgpIHsKICByZXR1cm4gcm90cih4LCA2KSBeIHJvdHIoeCwgMTEpIF4gcm90cih4LCAyNSk7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlX3NoYTI1Nl9saXR0bGVTaWdtYSh4KSB7CiAgcmV0dXJuIHJvdHIoeCwgNykgXiByb3RyKHgsIDE4KSBeIHggPj4+IDM7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlX3NoYTI1Nl9saXR0bGVTaWdtYVByaW1lKHgpIHsKICByZXR1cm4gcm90cih4LCAxNykgXiByb3RyKHgsIDE5KSBeIHggPj4+IDEwOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZVNIQTI1NihkYXRhLCBvZmZzZXQsIGxlbmd0aCkgewogIGxldCBoMCA9IDB4NmEwOWU2NjcsCiAgICBoMSA9IDB4YmI2N2FlODUsCiAgICBoMiA9IDB4M2M2ZWYzNzIsCiAgICBoMyA9IDB4YTU0ZmY1M2EsCiAgICBoNCA9IDB4NTEwZTUyN2YsCiAgICBoNSA9IDB4OWIwNTY4OGMsCiAgICBoNiA9IDB4MWY4M2Q5YWIsCiAgICBoNyA9IDB4NWJlMGNkMTk7CiAgY29uc3QgcGFkZGVkTGVuZ3RoID0gTWF0aC5jZWlsKChsZW5ndGggKyA5KSAvIDY0KSAqIDY0OwogIGNvbnN0IHBhZGRlZCA9IG5ldyBVaW50OEFycmF5KHBhZGRlZExlbmd0aCk7CiAgbGV0IGksIGo7CiAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICBwYWRkZWRbaV0gPSBkYXRhW29mZnNldCsrXTsKICB9CiAgcGFkZGVkW2krK10gPSAweDgwOwogIGNvbnN0IG4gPSBwYWRkZWRMZW5ndGggLSA4OwogIGlmIChpIDwgbikgewogICAgaSA9IG47CiAgfQogIGkgKz0gMzsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+Pj4gMjkgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDIxICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAxMyAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gNSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPDwgMyAmIDB4ZmY7CiAgY29uc3QgdyA9IG5ldyBVaW50MzJBcnJheSg2NCk7CiAgY29uc3QgewogICAgawogIH0gPSBjYWxjdWxhdGVfc2hhMjU2X1BBUkFNUzsKICBmb3IgKGkgPSAwOyBpIDwgcGFkZGVkTGVuZ3RoOykgewogICAgZm9yIChqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgd1tqXSA9IHBhZGRlZFtpXSA8PCAyNCB8IHBhZGRlZFtpICsgMV0gPDwgMTYgfCBwYWRkZWRbaSArIDJdIDw8IDggfCBwYWRkZWRbaSArIDNdOwogICAgICBpICs9IDQ7CiAgICB9CiAgICBmb3IgKGogPSAxNjsgaiA8IDY0OyArK2opIHsKICAgICAgd1tqXSA9IGNhbGN1bGF0ZV9zaGEyNTZfbGl0dGxlU2lnbWFQcmltZSh3W2ogLSAyXSkgKyB3W2ogLSA3XSArIGNhbGN1bGF0ZV9zaGEyNTZfbGl0dGxlU2lnbWEod1tqIC0gMTVdKSArIHdbaiAtIDE2XSB8IDA7CiAgICB9CiAgICBsZXQgYSA9IGgwLAogICAgICBiID0gaDEsCiAgICAgIGMgPSBoMiwKICAgICAgZCA9IGgzLAogICAgICBlID0gaDQsCiAgICAgIGYgPSBoNSwKICAgICAgZyA9IGg2LAogICAgICBoID0gaDcsCiAgICAgIHQxLAogICAgICB0MjsKICAgIGZvciAoaiA9IDA7IGogPCA2NDsgKytqKSB7CiAgICAgIHQxID0gaCArIGNhbGN1bGF0ZV9zaGEyNTZfc2lnbWFQcmltZShlKSArIGNhbGN1bGF0ZV9zaGEyNTZfY2goZSwgZiwgZykgKyBrW2pdICsgd1tqXTsKICAgICAgdDIgPSBjYWxjdWxhdGVfc2hhMjU2X3NpZ21hKGEpICsgY2FsY3VsYXRlX3NoYTI1Nl9tYWooYSwgYiwgYyk7CiAgICAgIGggPSBnOwogICAgICBnID0gZjsKICAgICAgZiA9IGU7CiAgICAgIGUgPSBkICsgdDEgfCAwOwogICAgICBkID0gYzsKICAgICAgYyA9IGI7CiAgICAgIGIgPSBhOwogICAgICBhID0gdDEgKyB0MiB8IDA7CiAgICB9CiAgICBoMCA9IGgwICsgYSB8IDA7CiAgICBoMSA9IGgxICsgYiB8IDA7CiAgICBoMiA9IGgyICsgYyB8IDA7CiAgICBoMyA9IGgzICsgZCB8IDA7CiAgICBoNCA9IGg0ICsgZSB8IDA7CiAgICBoNSA9IGg1ICsgZiB8IDA7CiAgICBoNiA9IGg2ICsgZyB8IDA7CiAgICBoNyA9IGg3ICsgaCB8IDA7CiAgfQogIHJldHVybiBuZXcgVWludDhBcnJheShbaDAgPj4gMjQgJiAweEZGLCBoMCA+PiAxNiAmIDB4RkYsIGgwID4+IDggJiAweEZGLCBoMCAmIDB4RkYsIGgxID4+IDI0ICYgMHhGRiwgaDEgPj4gMTYgJiAweEZGLCBoMSA+PiA4ICYgMHhGRiwgaDEgJiAweEZGLCBoMiA+PiAyNCAmIDB4RkYsIGgyID4+IDE2ICYgMHhGRiwgaDIgPj4gOCAmIDB4RkYsIGgyICYgMHhGRiwgaDMgPj4gMjQgJiAweEZGLCBoMyA+PiAxNiAmIDB4RkYsIGgzID4+IDggJiAweEZGLCBoMyAmIDB4RkYsIGg0ID4+IDI0ICYgMHhGRiwgaDQgPj4gMTYgJiAweEZGLCBoNCA+PiA4ICYgMHhGRiwgaDQgJiAweEZGLCBoNSA+PiAyNCAmIDB4RkYsIGg1ID4+IDE2ICYgMHhGRiwgaDUgPj4gOCAmIDB4RkYsIGg1ICYgMHhGRiwgaDYgPj4gMjQgJiAweEZGLCBoNiA+PiAxNiAmIDB4RkYsIGg2ID4+IDggJiAweEZGLCBoNiAmIDB4RkYsIGg3ID4+IDI0ICYgMHhGRiwgaDcgPj4gMTYgJiAweEZGLCBoNyA+PiA4ICYgMHhGRiwgaDcgJiAweEZGXSk7Cn0KCjsvLyAuL3NyYy9jb3JlL2RlY3J5cHRfc3RyZWFtLmpzCgpjb25zdCBjaHVua1NpemUgPSA1MTI7CmNsYXNzIERlY3J5cHRTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgsIGRlY3J5cHQpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICB0aGlzLmRlY3J5cHQgPSBkZWNyeXB0OwogICAgdGhpcy5uZXh0Q2h1bmsgPSBudWxsOwogICAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBsZXQgY2h1bms7CiAgICBpZiAodGhpcy5pbml0aWFsaXplZCkgewogICAgICBjaHVuayA9IHRoaXMubmV4dENodW5rOwogICAgfSBlbHNlIHsKICAgICAgY2h1bmsgPSB0aGlzLnN0ci5nZXRCeXRlcyhjaHVua1NpemUpOwogICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgIH0KICAgIGlmICghY2h1bms/Lmxlbmd0aCkgewogICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMubmV4dENodW5rID0gdGhpcy5zdHIuZ2V0Qnl0ZXMoY2h1bmtTaXplKTsKICAgIGNvbnN0IGhhc01vcmVEYXRhID0gdGhpcy5uZXh0Q2h1bms/Lmxlbmd0aCA+IDA7CiAgICBjb25zdCBkZWNyeXB0ID0gdGhpcy5kZWNyeXB0OwogICAgY2h1bmsgPSBkZWNyeXB0KGNodW5rLCAhaGFzTW9yZURhdGEpOwogICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGgsCiAgICAgIG5ld0xlbmd0aCA9IGJ1ZmZlckxlbmd0aCArIGNodW5rLmxlbmd0aCwKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIobmV3TGVuZ3RoKTsKICAgIGJ1ZmZlci5zZXQoY2h1bmssIGJ1ZmZlckxlbmd0aCk7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IG5ld0xlbmd0aDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NyeXB0by5qcwoKCgoKCgpjbGFzcyBBUkNGb3VyQ2lwaGVyIHsKICBjb25zdHJ1Y3RvcihrZXkpIHsKICAgIHRoaXMuYSA9IDA7CiAgICB0aGlzLmIgPSAwOwogICAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgICBjb25zdCBrZXlMZW5ndGggPSBrZXkubGVuZ3RoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICBzW2ldID0gaTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IDI1NjsgKytpKSB7CiAgICAgIGNvbnN0IHRtcCA9IHNbaV07CiAgICAgIGogPSBqICsgdG1wICsga2V5W2kgJSBrZXlMZW5ndGhdICYgMHhmZjsKICAgICAgc1tpXSA9IHNbal07CiAgICAgIHNbal0gPSB0bXA7CiAgICB9CiAgICB0aGlzLnMgPSBzOwogIH0KICBlbmNyeXB0QmxvY2soZGF0YSkgewogICAgbGV0IGEgPSB0aGlzLmEsCiAgICAgIGIgPSB0aGlzLmI7CiAgICBjb25zdCBzID0gdGhpcy5zOwogICAgY29uc3QgbiA9IGRhdGEubGVuZ3RoOwogICAgY29uc3Qgb3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47ICsraSkgewogICAgICBhID0gYSArIDEgJiAweGZmOwogICAgICBjb25zdCB0bXAgPSBzW2FdOwogICAgICBiID0gYiArIHRtcCAmIDB4ZmY7CiAgICAgIGNvbnN0IHRtcDIgPSBzW2JdOwogICAgICBzW2FdID0gdG1wMjsKICAgICAgc1tiXSA9IHRtcDsKICAgICAgb3V0cHV0W2ldID0gZGF0YVtpXSBeIHNbdG1wICsgdG1wMiAmIDB4ZmZdOwogICAgfQogICAgdGhpcy5hID0gYTsKICAgIHRoaXMuYiA9IGI7CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBkZWNyeXB0QmxvY2soZGF0YSkgewogICAgcmV0dXJuIHRoaXMuZW5jcnlwdEJsb2NrKGRhdGEpOwogIH0KICBlbmNyeXB0KGRhdGEpIHsKICAgIHJldHVybiB0aGlzLmVuY3J5cHRCbG9jayhkYXRhKTsKICB9Cn0KY2xhc3MgTnVsbENpcGhlciB7CiAgZGVjcnlwdEJsb2NrKGRhdGEpIHsKICAgIHJldHVybiBkYXRhOwogIH0KICBlbmNyeXB0KGRhdGEpIHsKICAgIHJldHVybiBkYXRhOwogIH0KfQpjbGFzcyBBRVNCYXNlQ2lwaGVyIHsKICBfcyA9IG5ldyBVaW50OEFycmF5KFsweDYzLCAweDdjLCAweDc3LCAweDdiLCAweGYyLCAweDZiLCAweDZmLCAweGM1LCAweDMwLCAweDAxLCAweDY3LCAweDJiLCAweGZlLCAweGQ3LCAweGFiLCAweDc2LCAweGNhLCAweDgyLCAweGM5LCAweDdkLCAweGZhLCAweDU5LCAweDQ3LCAweGYwLCAweGFkLCAweGQ0LCAweGEyLCAweGFmLCAweDljLCAweGE0LCAweDcyLCAweGMwLCAweGI3LCAweGZkLCAweDkzLCAweDI2LCAweDM2LCAweDNmLCAweGY3LCAweGNjLCAweDM0LCAweGE1LCAweGU1LCAweGYxLCAweDcxLCAweGQ4LCAweDMxLCAweDE1LCAweDA0LCAweGM3LCAweDIzLCAweGMzLCAweDE4LCAweDk2LCAweDA1LCAweDlhLCAweDA3LCAweDEyLCAweDgwLCAweGUyLCAweGViLCAweDI3LCAweGIyLCAweDc1LCAweDA5LCAweDgzLCAweDJjLCAweDFhLCAweDFiLCAweDZlLCAweDVhLCAweGEwLCAweDUyLCAweDNiLCAweGQ2LCAweGIzLCAweDI5LCAweGUzLCAweDJmLCAweDg0LCAweDUzLCAweGQxLCAweDAwLCAweGVkLCAweDIwLCAweGZjLCAweGIxLCAweDViLCAweDZhLCAweGNiLCAweGJlLCAweDM5LCAweDRhLCAweDRjLCAweDU4LCAweGNmLCAweGQwLCAweGVmLCAweGFhLCAweGZiLCAweDQzLCAweDRkLCAweDMzLCAweDg1LCAweDQ1LCAweGY5LCAweDAyLCAweDdmLCAweDUwLCAweDNjLCAweDlmLCAweGE4LCAweDUxLCAweGEzLCAweDQwLCAweDhmLCAweDkyLCAweDlkLCAweDM4LCAweGY1LCAweGJjLCAweGI2LCAweGRhLCAweDIxLCAweDEwLCAweGZmLCAweGYzLCAweGQyLCAweGNkLCAweDBjLCAweDEzLCAweGVjLCAweDVmLCAweDk3LCAweDQ0LCAweDE3LCAweGM0LCAweGE3LCAweDdlLCAweDNkLCAweDY0LCAweDVkLCAweDE5LCAweDczLCAweDYwLCAweDgxLCAweDRmLCAweGRjLCAweDIyLCAweDJhLCAweDkwLCAweDg4LCAweDQ2LCAweGVlLCAweGI4LCAweDE0LCAweGRlLCAweDVlLCAweDBiLCAweGRiLCAweGUwLCAweDMyLCAweDNhLCAweDBhLCAweDQ5LCAweDA2LCAweDI0LCAweDVjLCAweGMyLCAweGQzLCAweGFjLCAweDYyLCAweDkxLCAweDk1LCAweGU0LCAweDc5LCAweGU3LCAweGM4LCAweDM3LCAweDZkLCAweDhkLCAweGQ1LCAweDRlLCAweGE5LCAweDZjLCAweDU2LCAweGY0LCAweGVhLCAweDY1LCAweDdhLCAweGFlLCAweDA4LCAweGJhLCAweDc4LCAweDI1LCAweDJlLCAweDFjLCAweGE2LCAweGI0LCAweGM2LCAweGU4LCAweGRkLCAweDc0LCAweDFmLCAweDRiLCAweGJkLCAweDhiLCAweDhhLCAweDcwLCAweDNlLCAweGI1LCAweDY2LCAweDQ4LCAweDAzLCAweGY2LCAweDBlLCAweDYxLCAweDM1LCAweDU3LCAweGI5LCAweDg2LCAweGMxLCAweDFkLCAweDllLCAweGUxLCAweGY4LCAweDk4LCAweDExLCAweDY5LCAweGQ5LCAweDhlLCAweDk0LCAweDliLCAweDFlLCAweDg3LCAweGU5LCAweGNlLCAweDU1LCAweDI4LCAweGRmLCAweDhjLCAweGExLCAweDg5LCAweDBkLCAweGJmLCAweGU2LCAweDQyLCAweDY4LCAweDQxLCAweDk5LCAweDJkLCAweDBmLCAweGIwLCAweDU0LCAweGJiLCAweDE2XSk7CiAgX2ludl9zID0gbmV3IFVpbnQ4QXJyYXkoWzB4NTIsIDB4MDksIDB4NmEsIDB4ZDUsIDB4MzAsIDB4MzYsIDB4YTUsIDB4MzgsIDB4YmYsIDB4NDAsIDB4YTMsIDB4OWUsIDB4ODEsIDB4ZjMsIDB4ZDcsIDB4ZmIsIDB4N2MsIDB4ZTMsIDB4MzksIDB4ODIsIDB4OWIsIDB4MmYsIDB4ZmYsIDB4ODcsIDB4MzQsIDB4OGUsIDB4NDMsIDB4NDQsIDB4YzQsIDB4ZGUsIDB4ZTksIDB4Y2IsIDB4NTQsIDB4N2IsIDB4OTQsIDB4MzIsIDB4YTYsIDB4YzIsIDB4MjMsIDB4M2QsIDB4ZWUsIDB4NGMsIDB4OTUsIDB4MGIsIDB4NDIsIDB4ZmEsIDB4YzMsIDB4NGUsIDB4MDgsIDB4MmUsIDB4YTEsIDB4NjYsIDB4MjgsIDB4ZDksIDB4MjQsIDB4YjIsIDB4NzYsIDB4NWIsIDB4YTIsIDB4NDksIDB4NmQsIDB4OGIsIDB4ZDEsIDB4MjUsIDB4NzIsIDB4ZjgsIDB4ZjYsIDB4NjQsIDB4ODYsIDB4NjgsIDB4OTgsIDB4MTYsIDB4ZDQsIDB4YTQsIDB4NWMsIDB4Y2MsIDB4NWQsIDB4NjUsIDB4YjYsIDB4OTIsIDB4NmMsIDB4NzAsIDB4NDgsIDB4NTAsIDB4ZmQsIDB4ZWQsIDB4YjksIDB4ZGEsIDB4NWUsIDB4MTUsIDB4NDYsIDB4NTcsIDB4YTcsIDB4OGQsIDB4OWQsIDB4ODQsIDB4OTAsIDB4ZDgsIDB4YWIsIDB4MDAsIDB4OGMsIDB4YmMsIDB4ZDMsIDB4MGEsIDB4ZjcsIDB4ZTQsIDB4NTgsIDB4MDUsIDB4YjgsIDB4YjMsIDB4NDUsIDB4MDYsIDB4ZDAsIDB4MmMsIDB4MWUsIDB4OGYsIDB4Y2EsIDB4M2YsIDB4MGYsIDB4MDIsIDB4YzEsIDB4YWYsIDB4YmQsIDB4MDMsIDB4MDEsIDB4MTMsIDB4OGEsIDB4NmIsIDB4M2EsIDB4OTEsIDB4MTEsIDB4NDEsIDB4NGYsIDB4NjcsIDB4ZGMsIDB4ZWEsIDB4OTcsIDB4ZjIsIDB4Y2YsIDB4Y2UsIDB4ZjAsIDB4YjQsIDB4ZTYsIDB4NzMsIDB4OTYsIDB4YWMsIDB4NzQsIDB4MjIsIDB4ZTcsIDB4YWQsIDB4MzUsIDB4ODUsIDB4ZTIsIDB4ZjksIDB4MzcsIDB4ZTgsIDB4MWMsIDB4NzUsIDB4ZGYsIDB4NmUsIDB4NDcsIDB4ZjEsIDB4MWEsIDB4NzEsIDB4MWQsIDB4MjksIDB4YzUsIDB4ODksIDB4NmYsIDB4YjcsIDB4NjIsIDB4MGUsIDB4YWEsIDB4MTgsIDB4YmUsIDB4MWIsIDB4ZmMsIDB4NTYsIDB4M2UsIDB4NGIsIDB4YzYsIDB4ZDIsIDB4NzksIDB4MjAsIDB4OWEsIDB4ZGIsIDB4YzAsIDB4ZmUsIDB4NzgsIDB4Y2QsIDB4NWEsIDB4ZjQsIDB4MWYsIDB4ZGQsIDB4YTgsIDB4MzMsIDB4ODgsIDB4MDcsIDB4YzcsIDB4MzEsIDB4YjEsIDB4MTIsIDB4MTAsIDB4NTksIDB4MjcsIDB4ODAsIDB4ZWMsIDB4NWYsIDB4NjAsIDB4NTEsIDB4N2YsIDB4YTksIDB4MTksIDB4YjUsIDB4NGEsIDB4MGQsIDB4MmQsIDB4ZTUsIDB4N2EsIDB4OWYsIDB4OTMsIDB4YzksIDB4OWMsIDB4ZWYsIDB4YTAsIDB4ZTAsIDB4M2IsIDB4NGQsIDB4YWUsIDB4MmEsIDB4ZjUsIDB4YjAsIDB4YzgsIDB4ZWIsIDB4YmIsIDB4M2MsIDB4ODMsIDB4NTMsIDB4OTksIDB4NjEsIDB4MTcsIDB4MmIsIDB4MDQsIDB4N2UsIDB4YmEsIDB4NzcsIDB4ZDYsIDB4MjYsIDB4ZTEsIDB4NjksIDB4MTQsIDB4NjMsIDB4NTUsIDB4MjEsIDB4MGMsIDB4N2RdKTsKICBfbWl4ID0gbmV3IFVpbnQzMkFycmF5KFsweDAwMDAwMDAwLCAweDBlMDkwZDBiLCAweDFjMTIxYTE2LCAweDEyMWIxNzFkLCAweDM4MjQzNDJjLCAweDM2MmQzOTI3LCAweDI0MzYyZTNhLCAweDJhM2YyMzMxLCAweDcwNDg2ODU4LCAweDdlNDE2NTUzLCAweDZjNWE3MjRlLCAweDYyNTM3ZjQ1LCAweDQ4NmM1Yzc0LCAweDQ2NjU1MTdmLCAweDU0N2U0NjYyLCAweDVhNzc0YjY5LCAweGUwOTBkMGIwLCAweGVlOTlkZGJiLCAweGZjODJjYWE2LCAweGYyOGJjN2FkLCAweGQ4YjRlNDljLCAweGQ2YmRlOTk3LCAweGM0YTZmZThhLCAweGNhYWZmMzgxLCAweDkwZDhiOGU4LCAweDllZDFiNWUzLCAweDhjY2FhMmZlLCAweDgyYzNhZmY1LCAweGE4ZmM4Y2M0LCAweGE2ZjU4MWNmLCAweGI0ZWU5NmQyLCAweGJhZTc5YmQ5LCAweGRiM2JiYjdiLCAweGQ1MzJiNjcwLCAweGM3MjlhMTZkLCAweGM5MjBhYzY2LCAweGUzMWY4ZjU3LCAweGVkMTY4MjVjLCAweGZmMGQ5NTQxLCAweGYxMDQ5ODRhLCAweGFiNzNkMzIzLCAweGE1N2FkZTI4LCAweGI3NjFjOTM1LCAweGI5NjhjNDNlLCAweDkzNTdlNzBmLCAweDlkNWVlYTA0LCAweDhmNDVmZDE5LCAweDgxNGNmMDEyLCAweDNiYWI2YmNiLCAweDM1YTI2NmMwLCAweDI3Yjk3MWRkLCAweDI5YjA3Y2Q2LCAweDAzOGY1ZmU3LCAweDBkODY1MmVjLCAweDFmOWQ0NWYxLCAweDExOTQ0OGZhLCAweDRiZTMwMzkzLCAweDQ1ZWEwZTk4LCAweDU3ZjExOTg1LCAweDU5ZjgxNDhlLCAweDczYzczN2JmLCAweDdkY2UzYWI0LCAweDZmZDUyZGE5LCAweDYxZGMyMGEyLCAweGFkNzY2ZGY2LCAweGEzN2Y2MGZkLCAweGIxNjQ3N2UwLCAweGJmNmQ3YWViLCAweDk1NTI1OWRhLCAweDliNWI1NGQxLCAweDg5NDA0M2NjLCAweDg3NDk0ZWM3LCAweGRkM2UwNWFlLCAweGQzMzcwOGE1LCAweGMxMmMxZmI4LCAweGNmMjUxMmIzLCAweGU1MWEzMTgyLCAweGViMTMzYzg5LCAweGY5MDgyYjk0LCAweGY3MDEyNjlmLCAweDRkZTZiZDQ2LCAweDQzZWZiMDRkLCAweDUxZjRhNzUwLCAweDVmZmRhYTViLCAweDc1YzI4OTZhLCAweDdiY2I4NDYxLCAweDY5ZDA5MzdjLCAweDY3ZDk5ZTc3LCAweDNkYWVkNTFlLCAweDMzYTdkODE1LCAweDIxYmNjZjA4LCAweDJmYjVjMjAzLCAweDA1OGFlMTMyLCAweDBiODNlYzM5LCAweDE5OThmYjI0LCAweDE3OTFmNjJmLCAweDc2NGRkNjhkLCAweDc4NDRkYjg2LCAweDZhNWZjYzliLCAweDY0NTZjMTkwLCAweDRlNjllMmExLCAweDQwNjBlZmFhLCAweDUyN2JmOGI3LCAweDVjNzJmNWJjLCAweDA2MDViZWQ1LCAweDA4MGNiM2RlLCAweDFhMTdhNGMzLCAweDE0MWVhOWM4LCAweDNlMjE4YWY5LCAweDMwMjg4N2YyLCAweDIyMzM5MGVmLCAweDJjM2E5ZGU0LCAweDk2ZGQwNjNkLCAweDk4ZDQwYjM2LCAweDhhY2YxYzJiLCAweDg0YzYxMTIwLCAweGFlZjkzMjExLCAweGEwZjAzZjFhLCAweGIyZWIyODA3LCAweGJjZTIyNTBjLCAweGU2OTU2ZTY1LCAweGU4OWM2MzZlLCAweGZhODc3NDczLCAweGY0OGU3OTc4LCAweGRlYjE1YTQ5LCAweGQwYjg1NzQyLCAweGMyYTM0MDVmLCAweGNjYWE0ZDU0LCAweDQxZWNkYWY3LCAweDRmZTVkN2ZjLCAweDVkZmVjMGUxLCAweDUzZjdjZGVhLCAweDc5YzhlZWRiLCAweDc3YzFlM2QwLCAweDY1ZGFmNGNkLCAweDZiZDNmOWM2LCAweDMxYTRiMmFmLCAweDNmYWRiZmE0LCAweDJkYjZhOGI5LCAweDIzYmZhNWIyLCAweDA5ODA4NjgzLCAweDA3ODk4Yjg4LCAweDE1OTI5Yzk1LCAweDFiOWI5MTllLCAweGExN2MwYTQ3LCAweGFmNzUwNzRjLCAweGJkNmUxMDUxLCAweGIzNjcxZDVhLCAweDk5NTgzZTZiLCAweDk3NTEzMzYwLCAweDg1NGEyNDdkLCAweDhiNDMyOTc2LCAweGQxMzQ2MjFmLCAweGRmM2Q2ZjE0LCAweGNkMjY3ODA5LCAweGMzMmY3NTAyLCAweGU5MTA1NjMzLCAweGU3MTk1YjM4LCAweGY1MDI0YzI1LCAweGZiMGI0MTJlLCAweDlhZDc2MThjLCAweDk0ZGU2Yzg3LCAweDg2YzU3YjlhLCAweDg4Y2M3NjkxLCAweGEyZjM1NWEwLCAweGFjZmE1OGFiLCAweGJlZTE0ZmI2LCAweGIwZTg0MmJkLCAweGVhOWYwOWQ0LCAweGU0OTYwNGRmLCAweGY2OGQxM2MyLCAweGY4ODQxZWM5LCAweGQyYmIzZGY4LCAweGRjYjIzMGYzLCAweGNlYTkyN2VlLCAweGMwYTAyYWU1LCAweDdhNDdiMTNjLCAweDc0NGViYzM3LCAweDY2NTVhYjJhLCAweDY4NWNhNjIxLCAweDQyNjM4NTEwLCAweDRjNmE4ODFiLCAweDVlNzE5ZjA2LCAweDUwNzg5MjBkLCAweDBhMGZkOTY0LCAweDA0MDZkNDZmLCAweDE2MWRjMzcyLCAweDE4MTRjZTc5LCAweDMyMmJlZDQ4LCAweDNjMjJlMDQzLCAweDJlMzlmNzVlLCAweDIwMzBmYTU1LCAweGVjOWFiNzAxLCAweGUyOTNiYTBhLCAweGYwODhhZDE3LCAweGZlODFhMDFjLCAweGQ0YmU4MzJkLCAweGRhYjc4ZTI2LCAweGM4YWM5OTNiLCAweGM2YTU5NDMwLCAweDljZDJkZjU5LCAweDkyZGJkMjUyLCAweDgwYzBjNTRmLCAweDhlYzljODQ0LCAweGE0ZjZlYjc1LCAweGFhZmZlNjdlLCAweGI4ZTRmMTYzLCAweGI2ZWRmYzY4LCAweDBjMGE2N2IxLCAweDAyMDM2YWJhLCAweDEwMTg3ZGE3LCAweDFlMTE3MGFjLCAweDM0MmU1MzlkLCAweDNhMjc1ZTk2LCAweDI4M2M0OThiLCAweDI2MzU0NDgwLCAweDdjNDIwZmU5LCAweDcyNGIwMmUyLCAweDYwNTAxNWZmLCAweDZlNTkxOGY0LCAweDQ0NjYzYmM1LCAweDRhNmYzNmNlLCAweDU4NzQyMWQzLCAweDU2N2QyY2Q4LCAweDM3YTEwYzdhLCAweDM5YTgwMTcxLCAweDJiYjMxNjZjLCAweDI1YmExYjY3LCAweDBmODUzODU2LCAweDAxOGMzNTVkLCAweDEzOTcyMjQwLCAweDFkOWUyZjRiLCAweDQ3ZTk2NDIyLCAweDQ5ZTA2OTI5LCAweDViZmI3ZTM0LCAweDU1ZjI3MzNmLCAweDdmY2Q1MDBlLCAweDcxYzQ1ZDA1LCAweDYzZGY0YTE4LCAweDZkZDY0NzEzLCAweGQ3MzFkY2NhLCAweGQ5MzhkMWMxLCAweGNiMjNjNmRjLCAweGM1MmFjYmQ3LCAweGVmMTVlOGU2LCAweGUxMWNlNWVkLCAweGYzMDdmMmYwLCAweGZkMGVmZmZiLCAweGE3NzliNDkyLCAweGE5NzBiOTk5LCAweGJiNmJhZTg0LCAweGI1NjJhMzhmLCAweDlmNWQ4MGJlLCAweDkxNTQ4ZGI1LCAweDgzNGY5YWE4LCAweDhkNDY5N2EzXSk7CiAgX21peENvbCA9IG5ldyBVaW50OEFycmF5KDI1NikubWFwKChfLCBpKSA9PiBpIDwgMTI4ID8gaSA8PCAxIDogaSA8PCAxIF4gMHgxYik7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIHRoaXMuYnVmZmVyUG9zaXRpb24gPSAwOwogIH0KICBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgdW5yZWFjaGFibGUoIkNhbm5vdCBjYWxsIGBfZXhwYW5kS2V5YCBvbiB0aGUgYmFzZSBjbGFzcyIpOwogIH0KICBfZGVjcnlwdChpbnB1dCwga2V5KSB7CiAgICBsZXQgdCwgdSwgdjsKICAgIGNvbnN0IHN0YXRlID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgc3RhdGUuc2V0KGlucHV0KTsKICAgIGZvciAobGV0IGogPSAwLCBrID0gdGhpcy5fa2V5U2l6ZTsgaiA8IDE2OyArK2osICsraykgewogICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICB9CiAgICBmb3IgKGxldCBpID0gdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uIC0gMTsgaSA+PSAxOyAtLWkpIHsKICAgICAgdCA9IHN0YXRlWzEzXTsKICAgICAgc3RhdGVbMTNdID0gc3RhdGVbOV07CiAgICAgIHN0YXRlWzldID0gc3RhdGVbNV07CiAgICAgIHN0YXRlWzVdID0gc3RhdGVbMV07CiAgICAgIHN0YXRlWzFdID0gdDsKICAgICAgdCA9IHN0YXRlWzE0XTsKICAgICAgdSA9IHN0YXRlWzEwXTsKICAgICAgc3RhdGVbMTRdID0gc3RhdGVbNl07CiAgICAgIHN0YXRlWzEwXSA9IHN0YXRlWzJdOwogICAgICBzdGF0ZVs2XSA9IHQ7CiAgICAgIHN0YXRlWzJdID0gdTsKICAgICAgdCA9IHN0YXRlWzE1XTsKICAgICAgdSA9IHN0YXRlWzExXTsKICAgICAgdiA9IHN0YXRlWzddOwogICAgICBzdGF0ZVsxNV0gPSBzdGF0ZVszXTsKICAgICAgc3RhdGVbMTFdID0gdDsKICAgICAgc3RhdGVbN10gPSB1OwogICAgICBzdGF0ZVszXSA9IHY7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICAgIHN0YXRlW2pdID0gdGhpcy5faW52X3Nbc3RhdGVbal1dOwogICAgICB9CiAgICAgIGZvciAobGV0IGogPSAwLCBrID0gaSAqIDE2OyBqIDwgMTY7ICsraiwgKytrKSB7CiAgICAgICAgc3RhdGVbal0gXj0ga2V5W2tdOwogICAgICB9CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7IGogKz0gNCkgewogICAgICAgIGNvbnN0IHMwID0gdGhpcy5fbWl4W3N0YXRlW2pdXTsKICAgICAgICBjb25zdCBzMSA9IHRoaXMuX21peFtzdGF0ZVtqICsgMV1dOwogICAgICAgIGNvbnN0IHMyID0gdGhpcy5fbWl4W3N0YXRlW2ogKyAyXV07CiAgICAgICAgY29uc3QgczMgPSB0aGlzLl9taXhbc3RhdGVbaiArIDNdXTsKICAgICAgICB0ID0gczAgXiBzMSA+Pj4gOCBeIHMxIDw8IDI0IF4gczIgPj4+IDE2IF4gczIgPDwgMTYgXiBzMyA+Pj4gMjQgXiBzMyA8PCA4OwogICAgICAgIHN0YXRlW2pdID0gdCA+Pj4gMjQgJiAweGZmOwogICAgICAgIHN0YXRlW2ogKyAxXSA9IHQgPj4gMTYgJiAweGZmOwogICAgICAgIHN0YXRlW2ogKyAyXSA9IHQgPj4gOCAmIDB4ZmY7CiAgICAgICAgc3RhdGVbaiArIDNdID0gdCAmIDB4ZmY7CiAgICAgIH0KICAgIH0KICAgIHQgPSBzdGF0ZVsxM107CiAgICBzdGF0ZVsxM10gPSBzdGF0ZVs5XTsKICAgIHN0YXRlWzldID0gc3RhdGVbNV07CiAgICBzdGF0ZVs1XSA9IHN0YXRlWzFdOwogICAgc3RhdGVbMV0gPSB0OwogICAgdCA9IHN0YXRlWzE0XTsKICAgIHUgPSBzdGF0ZVsxMF07CiAgICBzdGF0ZVsxNF0gPSBzdGF0ZVs2XTsKICAgIHN0YXRlWzEwXSA9IHN0YXRlWzJdOwogICAgc3RhdGVbNl0gPSB0OwogICAgc3RhdGVbMl0gPSB1OwogICAgdCA9IHN0YXRlWzE1XTsKICAgIHUgPSBzdGF0ZVsxMV07CiAgICB2ID0gc3RhdGVbN107CiAgICBzdGF0ZVsxNV0gPSBzdGF0ZVszXTsKICAgIHN0YXRlWzExXSA9IHQ7CiAgICBzdGF0ZVs3XSA9IHU7CiAgICBzdGF0ZVszXSA9IHY7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgc3RhdGVbal0gPSB0aGlzLl9pbnZfc1tzdGF0ZVtqXV07CiAgICAgIHN0YXRlW2pdIF49IGtleVtqXTsKICAgIH0KICAgIHJldHVybiBzdGF0ZTsKICB9CiAgX2VuY3J5cHQoaW5wdXQsIGtleSkgewogICAgY29uc3QgcyA9IHRoaXMuX3M7CiAgICBsZXQgdCwgdSwgdjsKICAgIGNvbnN0IHN0YXRlID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgc3RhdGUuc2V0KGlucHV0KTsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICBzdGF0ZVtqXSBePSBrZXlbal07CiAgICB9CiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuX2N5Y2xlc09mUmVwZXRpdGlvbjsgaSsrKSB7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICAgIHN0YXRlW2pdID0gc1tzdGF0ZVtqXV07CiAgICAgIH0KICAgICAgdiA9IHN0YXRlWzFdOwogICAgICBzdGF0ZVsxXSA9IHN0YXRlWzVdOwogICAgICBzdGF0ZVs1XSA9IHN0YXRlWzldOwogICAgICBzdGF0ZVs5XSA9IHN0YXRlWzEzXTsKICAgICAgc3RhdGVbMTNdID0gdjsKICAgICAgdiA9IHN0YXRlWzJdOwogICAgICB1ID0gc3RhdGVbNl07CiAgICAgIHN0YXRlWzJdID0gc3RhdGVbMTBdOwogICAgICBzdGF0ZVs2XSA9IHN0YXRlWzE0XTsKICAgICAgc3RhdGVbMTBdID0gdjsKICAgICAgc3RhdGVbMTRdID0gdTsKICAgICAgdiA9IHN0YXRlWzNdOwogICAgICB1ID0gc3RhdGVbN107CiAgICAgIHQgPSBzdGF0ZVsxMV07CiAgICAgIHN0YXRlWzNdID0gc3RhdGVbMTVdOwogICAgICBzdGF0ZVs3XSA9IHY7CiAgICAgIHN0YXRlWzExXSA9IHU7CiAgICAgIHN0YXRlWzE1XSA9IHQ7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7IGogKz0gNCkgewogICAgICAgIGNvbnN0IHMwID0gc3RhdGVbal07CiAgICAgICAgY29uc3QgczEgPSBzdGF0ZVtqICsgMV07CiAgICAgICAgY29uc3QgczIgPSBzdGF0ZVtqICsgMl07CiAgICAgICAgY29uc3QgczMgPSBzdGF0ZVtqICsgM107CiAgICAgICAgdCA9IHMwIF4gczEgXiBzMiBeIHMzOwogICAgICAgIHN0YXRlW2pdIF49IHQgXiB0aGlzLl9taXhDb2xbczAgXiBzMV07CiAgICAgICAgc3RhdGVbaiArIDFdIF49IHQgXiB0aGlzLl9taXhDb2xbczEgXiBzMl07CiAgICAgICAgc3RhdGVbaiArIDJdIF49IHQgXiB0aGlzLl9taXhDb2xbczIgXiBzM107CiAgICAgICAgc3RhdGVbaiArIDNdIF49IHQgXiB0aGlzLl9taXhDb2xbczMgXiBzMF07CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGsgPSBpICogMTY7IGogPCAxNjsgKytqLCArK2spIHsKICAgICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICAgIH0KICAgIH0KICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICBzdGF0ZVtqXSA9IHNbc3RhdGVbal1dOwogICAgfQogICAgdiA9IHN0YXRlWzFdOwogICAgc3RhdGVbMV0gPSBzdGF0ZVs1XTsKICAgIHN0YXRlWzVdID0gc3RhdGVbOV07CiAgICBzdGF0ZVs5XSA9IHN0YXRlWzEzXTsKICAgIHN0YXRlWzEzXSA9IHY7CiAgICB2ID0gc3RhdGVbMl07CiAgICB1ID0gc3RhdGVbNl07CiAgICBzdGF0ZVsyXSA9IHN0YXRlWzEwXTsKICAgIHN0YXRlWzZdID0gc3RhdGVbMTRdOwogICAgc3RhdGVbMTBdID0gdjsKICAgIHN0YXRlWzE0XSA9IHU7CiAgICB2ID0gc3RhdGVbM107CiAgICB1ID0gc3RhdGVbN107CiAgICB0ID0gc3RhdGVbMTFdOwogICAgc3RhdGVbM10gPSBzdGF0ZVsxNV07CiAgICBzdGF0ZVs3XSA9IHY7CiAgICBzdGF0ZVsxMV0gPSB1OwogICAgc3RhdGVbMTVdID0gdDsKICAgIGZvciAobGV0IGogPSAwLCBrID0gdGhpcy5fa2V5U2l6ZTsgaiA8IDE2OyArK2osICsraykgewogICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICB9CiAgICByZXR1cm4gc3RhdGU7CiAgfQogIF9kZWNyeXB0QmxvY2syKGRhdGEsIGZpbmFsaXplKSB7CiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwKICAgICAgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgbGV0IGl2ID0gdGhpcy5pdjsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlTGVuZ3RoOyArK2kpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aF0gPSBkYXRhW2ldOwogICAgICArK2J1ZmZlckxlbmd0aDsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA8IDE2KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgcGxhaW4gPSB0aGlzLl9kZWNyeXB0KGJ1ZmZlciwgdGhpcy5fa2V5KTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgcGxhaW5bal0gXj0gaXZbal07CiAgICAgIH0KICAgICAgaXYgPSBidWZmZXI7CiAgICAgIHJlc3VsdC5wdXNoKHBsYWluKTsKICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBidWZmZXJMZW5ndGggPSAwOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgIHRoaXMuaXYgPSBpdjsKICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgIH0KICAgIGxldCBvdXRwdXRMZW5ndGggPSAxNiAqIHJlc3VsdC5sZW5ndGg7CiAgICBpZiAoZmluYWxpemUpIHsKICAgICAgY29uc3QgbGFzdEJsb2NrID0gcmVzdWx0LmF0KC0xKTsKICAgICAgbGV0IHBzTGVuID0gbGFzdEJsb2NrWzE1XTsKICAgICAgaWYgKHBzTGVuIDw9IDE2KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE1LCBpaSA9IDE2IC0gcHNMZW47IGkgPj0gaWk7IC0taSkgewogICAgICAgICAgaWYgKGxhc3RCbG9ja1tpXSAhPT0gcHNMZW4pIHsKICAgICAgICAgICAgcHNMZW4gPSAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3V0cHV0TGVuZ3RoIC09IHBzTGVuOwogICAgICAgIHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMV0gPSBsYXN0QmxvY2suc3ViYXJyYXkoMCwgMTYgLSBwc0xlbik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG91dHB1dCA9IG5ldyBVaW50OEFycmF5KG91dHB1dExlbmd0aCk7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGlpID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGlpOyArK2ksIGogKz0gMTYpIHsKICAgICAgb3V0cHV0LnNldChyZXN1bHRbaV0sIGopOwogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9CiAgZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplLCBpdiA9IG51bGwpIHsKICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICBsZXQgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGlmIChpdikgewogICAgICB0aGlzLml2ID0gaXY7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBpID0gMDsgYnVmZmVyTGVuZ3RoIDwgMTYgJiYgaSA8IHNvdXJjZUxlbmd0aDsgKytpLCArK2J1ZmZlckxlbmd0aCkgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGhdID0gZGF0YVtpXTsKICAgICAgfQogICAgICBpZiAoYnVmZmVyTGVuZ3RoIDwgMTYpIHsKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgIH0KICAgICAgdGhpcy5pdiA9IGJ1ZmZlcjsKICAgICAgZGF0YSA9IGRhdGEuc3ViYXJyYXkoMTYpOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDA7CiAgICB0aGlzLmRlY3J5cHRCbG9jayA9IHRoaXMuX2RlY3J5cHRCbG9jazI7CiAgICByZXR1cm4gdGhpcy5kZWNyeXB0QmxvY2soZGF0YSwgZmluYWxpemUpOwogIH0KICBlbmNyeXB0KGRhdGEsIGl2KSB7CiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwKICAgICAgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgaXYgfHw9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlTGVuZ3RoOyArK2kpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aF0gPSBkYXRhW2ldOwogICAgICArK2J1ZmZlckxlbmd0aDsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA8IDE2KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgYnVmZmVyW2pdIF49IGl2W2pdOwogICAgICB9CiAgICAgIGNvbnN0IGNpcGhlciA9IHRoaXMuX2VuY3J5cHQoYnVmZmVyLCB0aGlzLl9rZXkpOwogICAgICBpdiA9IGNpcGhlcjsKICAgICAgcmVzdWx0LnB1c2goY2lwaGVyKTsKICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBidWZmZXJMZW5ndGggPSAwOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgIHRoaXMuaXYgPSBpdjsKICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgIH0KICAgIGNvbnN0IG91dHB1dExlbmd0aCA9IDE2ICogcmVzdWx0Lmxlbmd0aDsKICAgIGNvbnN0IG91dHB1dCA9IG5ldyBVaW50OEFycmF5KG91dHB1dExlbmd0aCk7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGlpID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGlpOyArK2ksIGogKz0gMTYpIHsKICAgICAgb3V0cHV0LnNldChyZXN1bHRbaV0sIGopOwogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9Cn0KY2xhc3MgQUVTMTI4Q2lwaGVyIGV4dGVuZHMgQUVTQmFzZUNpcGhlciB7CiAgX3Jjb24gPSBuZXcgVWludDhBcnJheShbMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZF0pOwogIGNvbnN0cnVjdG9yKGtleSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2N5Y2xlc09mUmVwZXRpdGlvbiA9IDEwOwogICAgdGhpcy5fa2V5U2l6ZSA9IDE2MDsKICAgIHRoaXMuX2tleSA9IHRoaXMuX2V4cGFuZEtleShrZXkpOwogIH0KICBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgY29uc3QgYiA9IDE3NjsKICAgIGNvbnN0IHMgPSB0aGlzLl9zOwogICAgY29uc3QgcmNvbiA9IHRoaXMuX3Jjb247CiAgICBjb25zdCByZXN1bHQgPSBuZXcgVWludDhBcnJheShiKTsKICAgIHJlc3VsdC5zZXQoY2lwaGVyS2V5KTsKICAgIGZvciAobGV0IGogPSAxNiwgaSA9IDE7IGogPCBiOyArK2kpIHsKICAgICAgbGV0IHQxID0gcmVzdWx0W2ogLSAzXTsKICAgICAgbGV0IHQyID0gcmVzdWx0W2ogLSAyXTsKICAgICAgbGV0IHQzID0gcmVzdWx0W2ogLSAxXTsKICAgICAgbGV0IHQ0ID0gcmVzdWx0W2ogLSA0XTsKICAgICAgdDEgPSBzW3QxXTsKICAgICAgdDIgPSBzW3QyXTsKICAgICAgdDMgPSBzW3QzXTsKICAgICAgdDQgPSBzW3Q0XTsKICAgICAgdDEgXj0gcmNvbltpXTsKICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCA0OyArK24pIHsKICAgICAgICByZXN1bHRbal0gPSB0MSBePSByZXN1bHRbaiAtIDE2XTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDIgXj0gcmVzdWx0W2ogLSAxNl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQzIF49IHJlc3VsdFtqIC0gMTZdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0NCBePSByZXN1bHRbaiAtIDE2XTsKICAgICAgICBqKys7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQp9CmNsYXNzIEFFUzI1NkNpcGhlciBleHRlbmRzIEFFU0Jhc2VDaXBoZXIgewogIGNvbnN0cnVjdG9yKGtleSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2N5Y2xlc09mUmVwZXRpdGlvbiA9IDE0OwogICAgdGhpcy5fa2V5U2l6ZSA9IDIyNDsKICAgIHRoaXMuX2tleSA9IHRoaXMuX2V4cGFuZEtleShrZXkpOwogIH0KICBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgY29uc3QgYiA9IDI0MDsKICAgIGNvbnN0IHMgPSB0aGlzLl9zOwogICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoYik7CiAgICByZXN1bHQuc2V0KGNpcGhlcktleSk7CiAgICBsZXQgciA9IDE7CiAgICBsZXQgdDEsIHQyLCB0MywgdDQ7CiAgICBmb3IgKGxldCBqID0gMzIsIGkgPSAxOyBqIDwgYjsgKytpKSB7CiAgICAgIGlmIChqICUgMzIgPT09IDE2KSB7CiAgICAgICAgdDEgPSBzW3QxXTsKICAgICAgICB0MiA9IHNbdDJdOwogICAgICAgIHQzID0gc1t0M107CiAgICAgICAgdDQgPSBzW3Q0XTsKICAgICAgfSBlbHNlIGlmIChqICUgMzIgPT09IDApIHsKICAgICAgICB0MSA9IHJlc3VsdFtqIC0gM107CiAgICAgICAgdDIgPSByZXN1bHRbaiAtIDJdOwogICAgICAgIHQzID0gcmVzdWx0W2ogLSAxXTsKICAgICAgICB0NCA9IHJlc3VsdFtqIC0gNF07CiAgICAgICAgdDEgPSBzW3QxXTsKICAgICAgICB0MiA9IHNbdDJdOwogICAgICAgIHQzID0gc1t0M107CiAgICAgICAgdDQgPSBzW3Q0XTsKICAgICAgICB0MSBePSByOwogICAgICAgIGlmICgociA8PD0gMSkgPj0gMjU2KSB7CiAgICAgICAgICByID0gKHIgXiAweDFiKSAmIDB4ZmY7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgNDsgKytuKSB7CiAgICAgICAgcmVzdWx0W2pdID0gdDEgXj0gcmVzdWx0W2ogLSAzMl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQyIF49IHJlc3VsdFtqIC0gMzJdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0MyBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDQgXj0gcmVzdWx0W2ogLSAzMl07CiAgICAgICAgaisrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KfQpjbGFzcyBQREZCYXNlIHsKICBfaGFzaChwYXNzd29yZCwgaW5wdXQsIHVzZXJCeXRlcykgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgX2hhc2hgIGNhbGxlZCIpOwogIH0KICBjaGVja093bmVyUGFzc3dvcmQocGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIHVzZXJCeXRlcywgb3duZXJQYXNzd29yZCkgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA1Nik7CiAgICBoYXNoRGF0YS5zZXQocGFzc3dvcmQsIDApOwogICAgaGFzaERhdGEuc2V0KG93bmVyVmFsaWRhdGlvblNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBoYXNoRGF0YS5zZXQodXNlckJ5dGVzLCBwYXNzd29yZC5sZW5ndGggKyBvd25lclZhbGlkYXRpb25TYWx0Lmxlbmd0aCk7CiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgdXNlckJ5dGVzKTsKICAgIHJldHVybiBpc0FycmF5RXF1YWwocmVzdWx0LCBvd25lclBhc3N3b3JkKTsKICB9CiAgY2hlY2tVc2VyUGFzc3dvcmQocGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlclBhc3N3b3JkKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDgpOwogICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgIGhhc2hEYXRhLnNldCh1c2VyVmFsaWRhdGlvblNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgW10pOwogICAgcmV0dXJuIGlzQXJyYXlFcXVhbChyZXN1bHQsIHVzZXJQYXNzd29yZCk7CiAgfQogIGdldE93bmVyS2V5KHBhc3N3b3JkLCBvd25lcktleVNhbHQsIHVzZXJCeXRlcywgb3duZXJFbmNyeXB0aW9uKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDU2KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQob3duZXJLZXlTYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgaGFzaERhdGEuc2V0KHVzZXJCeXRlcywgcGFzc3dvcmQubGVuZ3RoICsgb3duZXJLZXlTYWx0Lmxlbmd0aCk7CiAgICBjb25zdCBrZXkgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgdXNlckJ5dGVzKTsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKG93bmVyRW5jcnlwdGlvbiwgZmFsc2UsIG5ldyBVaW50OEFycmF5KDE2KSk7CiAgfQogIGdldFVzZXJLZXkocGFzc3dvcmQsIHVzZXJLZXlTYWx0LCB1c2VyRW5jcnlwdGlvbikgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA4KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQodXNlcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBjb25zdCBrZXkgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgW10pOwogICAgY29uc3QgY2lwaGVyID0gbmV3IEFFUzI1NkNpcGhlcihrZXkpOwogICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0QmxvY2sodXNlckVuY3J5cHRpb24sIGZhbHNlLCBuZXcgVWludDhBcnJheSgxNikpOwogIH0KfQpjbGFzcyBQREYxNyBleHRlbmRzIFBERkJhc2UgewogIF9oYXNoKHBhc3N3b3JkLCBpbnB1dCwgdXNlckJ5dGVzKSB7CiAgICByZXR1cm4gY2FsY3VsYXRlU0hBMjU2KGlucHV0LCAwLCBpbnB1dC5sZW5ndGgpOwogIH0KfQpjbGFzcyBQREYyMCBleHRlbmRzIFBERkJhc2UgewogIF9oYXNoKHBhc3N3b3JkLCBpbnB1dCwgdXNlckJ5dGVzKSB7CiAgICBsZXQgayA9IGNhbGN1bGF0ZVNIQTI1NihpbnB1dCwgMCwgaW5wdXQubGVuZ3RoKS5zdWJhcnJheSgwLCAzMik7CiAgICBsZXQgZSA9IFswXTsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlIChpIDwgNjQgfHwgZS5hdCgtMSkgPiBpIC0gMzIpIHsKICAgICAgY29uc3QgY29tYmluZWRMZW5ndGggPSBwYXNzd29yZC5sZW5ndGggKyBrLmxlbmd0aCArIHVzZXJCeXRlcy5sZW5ndGgsCiAgICAgICAgY29tYmluZWRBcnJheSA9IG5ldyBVaW50OEFycmF5KGNvbWJpbmVkTGVuZ3RoKTsKICAgICAgbGV0IHdyaXRlT2Zmc2V0ID0gMDsKICAgICAgY29tYmluZWRBcnJheS5zZXQocGFzc3dvcmQsIHdyaXRlT2Zmc2V0KTsKICAgICAgd3JpdGVPZmZzZXQgKz0gcGFzc3dvcmQubGVuZ3RoOwogICAgICBjb21iaW5lZEFycmF5LnNldChrLCB3cml0ZU9mZnNldCk7CiAgICAgIHdyaXRlT2Zmc2V0ICs9IGsubGVuZ3RoOwogICAgICBjb21iaW5lZEFycmF5LnNldCh1c2VyQnl0ZXMsIHdyaXRlT2Zmc2V0KTsKICAgICAgY29uc3QgazEgPSBuZXcgVWludDhBcnJheShjb21iaW5lZExlbmd0aCAqIDY0KTsKICAgICAgZm9yIChsZXQgaiA9IDAsIHBvcyA9IDA7IGogPCA2NDsgaisrLCBwb3MgKz0gY29tYmluZWRMZW5ndGgpIHsKICAgICAgICBrMS5zZXQoY29tYmluZWRBcnJheSwgcG9zKTsKICAgICAgfQogICAgICBjb25zdCBjaXBoZXIgPSBuZXcgQUVTMTI4Q2lwaGVyKGsuc3ViYXJyYXkoMCwgMTYpKTsKICAgICAgZSA9IGNpcGhlci5lbmNyeXB0KGsxLCBrLnN1YmFycmF5KDE2LCAzMikpOwogICAgICBjb25zdCByZW1haW5kZXIgPSBNYXRoLnN1bVByZWNpc2UoZS5zbGljZSgwLCAxNikpICUgMzsKICAgICAgaWYgKHJlbWFpbmRlciA9PT0gMCkgewogICAgICAgIGsgPSBjYWxjdWxhdGVTSEEyNTYoZSwgMCwgZS5sZW5ndGgpOwogICAgICB9IGVsc2UgaWYgKHJlbWFpbmRlciA9PT0gMSkgewogICAgICAgIGsgPSBjYWxjdWxhdGVTSEEzODQoZSwgMCwgZS5sZW5ndGgpOwogICAgICB9IGVsc2UgaWYgKHJlbWFpbmRlciA9PT0gMikgewogICAgICAgIGsgPSBjYWxjdWxhdGVTSEE1MTIoZSwgMCwgZS5sZW5ndGgpOwogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICAgIHJldHVybiBrLnN1YmFycmF5KDAsIDMyKTsKICB9Cn0KY2xhc3MgQ2lwaGVyVHJhbnNmb3JtIHsKICBjb25zdHJ1Y3RvcihzdHJpbmdDaXBoZXJDb25zdHJ1Y3Rvciwgc3RyZWFtQ2lwaGVyQ29uc3RydWN0b3IpIHsKICAgIHRoaXMuU3RyaW5nQ2lwaGVyQ29uc3RydWN0b3IgPSBzdHJpbmdDaXBoZXJDb25zdHJ1Y3RvcjsKICAgIHRoaXMuU3RyZWFtQ2lwaGVyQ29uc3RydWN0b3IgPSBzdHJlYW1DaXBoZXJDb25zdHJ1Y3RvcjsKICB9CiAgY3JlYXRlU3RyZWFtKHN0cmVhbSwgbGVuZ3RoKSB7CiAgICBjb25zdCBjaXBoZXIgPSBuZXcgdGhpcy5TdHJlYW1DaXBoZXJDb25zdHJ1Y3RvcigpOwogICAgcmV0dXJuIG5ldyBEZWNyeXB0U3RyZWFtKHN0cmVhbSwgbGVuZ3RoLCBmdW5jdGlvbiBjaXBoZXJUcmFuc2Zvcm1EZWNyeXB0U3RyZWFtKGRhdGEsIGZpbmFsaXplKSB7CiAgICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplKTsKICAgIH0pOwogIH0KICBkZWNyeXB0U3RyaW5nKHMpIHsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyB0aGlzLlN0cmluZ0NpcGhlckNvbnN0cnVjdG9yKCk7CiAgICBsZXQgZGF0YSA9IHN0cmluZ1RvQnl0ZXMocyk7CiAgICBkYXRhID0gY2lwaGVyLmRlY3J5cHRCbG9jayhkYXRhLCB0cnVlKTsKICAgIHJldHVybiBieXRlc1RvU3RyaW5nKGRhdGEpOwogIH0KICBlbmNyeXB0U3RyaW5nKHMpIHsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyB0aGlzLlN0cmluZ0NpcGhlckNvbnN0cnVjdG9yKCk7CiAgICBpZiAoY2lwaGVyIGluc3RhbmNlb2YgQUVTQmFzZUNpcGhlcikgewogICAgICBjb25zdCBzdHJMZW4gPSBzLmxlbmd0aDsKICAgICAgY29uc3QgcGFkID0gMTYgLSBzdHJMZW4gJSAxNjsKICAgICAgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhZCkucmVwZWF0KHBhZCk7CiAgICAgIGNvbnN0IGl2ID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGl2KTsKICAgICAgbGV0IGRhdGEgPSBzdHJpbmdUb0J5dGVzKHMpOwogICAgICBkYXRhID0gY2lwaGVyLmVuY3J5cHQoZGF0YSwgaXYpOwogICAgICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheSgxNiArIGRhdGEubGVuZ3RoKTsKICAgICAgYnVmLnNldChpdik7CiAgICAgIGJ1Zi5zZXQoZGF0YSwgMTYpOwogICAgICByZXR1cm4gYnl0ZXNUb1N0cmluZyhidWYpOwogICAgfQogICAgbGV0IGRhdGEgPSBzdHJpbmdUb0J5dGVzKHMpOwogICAgZGF0YSA9IGNpcGhlci5lbmNyeXB0KGRhdGEpOwogICAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoZGF0YSk7CiAgfQp9CmNsYXNzIENpcGhlclRyYW5zZm9ybUZhY3RvcnkgewogIHN0YXRpYyBnZXQgX2RlZmF1bHRQYXNzd29yZEJ5dGVzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX2RlZmF1bHRQYXNzd29yZEJ5dGVzIiwgbmV3IFVpbnQ4QXJyYXkoWzB4MjgsIDB4YmYsIDB4NGUsIDB4NWUsIDB4NGUsIDB4NzUsIDB4OGEsIDB4NDEsIDB4NjQsIDB4MDAsIDB4NGUsIDB4NTYsIDB4ZmYsIDB4ZmEsIDB4MDEsIDB4MDgsIDB4MmUsIDB4MmUsIDB4MDAsIDB4YjYsIDB4ZDAsIDB4NjgsIDB4M2UsIDB4ODAsIDB4MmYsIDB4MGMsIDB4YTksIDB4ZmUsIDB4NjQsIDB4NTMsIDB4NjksIDB4N2FdKSk7CiAgfQogICNjcmVhdGVFbmNyeXB0aW9uS2V5MjAocmV2aXNpb24sIHBhc3N3b3JkLCBvd25lclBhc3N3b3JkLCBvd25lclZhbGlkYXRpb25TYWx0LCBvd25lcktleVNhbHQsIHVCeXRlcywgdXNlclBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJLZXlTYWx0LCBvd25lckVuY3J5cHRpb24sIHVzZXJFbmNyeXB0aW9uLCBwZXJtcykgewogICAgaWYgKHBhc3N3b3JkKSB7CiAgICAgIGNvbnN0IHBhc3N3b3JkTGVuZ3RoID0gTWF0aC5taW4oMTI3LCBwYXNzd29yZC5sZW5ndGgpOwogICAgICBwYXNzd29yZCA9IHBhc3N3b3JkLnN1YmFycmF5KDAsIHBhc3N3b3JkTGVuZ3RoKTsKICAgIH0gZWxzZSB7CiAgICAgIHBhc3N3b3JkID0gW107CiAgICB9CiAgICBjb25zdCBwZGZBbGdvcml0aG0gPSByZXZpc2lvbiA9PT0gNiA/IG5ldyBQREYyMCgpIDogbmV3IFBERjE3KCk7CiAgICBpZiAocGRmQWxnb3JpdGhtLmNoZWNrVXNlclBhc3N3b3JkKHBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJQYXNzd29yZCkpIHsKICAgICAgcmV0dXJuIHBkZkFsZ29yaXRobS5nZXRVc2VyS2V5KHBhc3N3b3JkLCB1c2VyS2V5U2FsdCwgdXNlckVuY3J5cHRpb24pOwogICAgfSBlbHNlIGlmIChwYXNzd29yZC5sZW5ndGggJiYgcGRmQWxnb3JpdGhtLmNoZWNrT3duZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJWYWxpZGF0aW9uU2FsdCwgdUJ5dGVzLCBvd25lclBhc3N3b3JkKSkgewogICAgICByZXR1cm4gcGRmQWxnb3JpdGhtLmdldE93bmVyS2V5KHBhc3N3b3JkLCBvd25lcktleVNhbHQsIHVCeXRlcywgb3duZXJFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICAjcHJlcGFyZUtleURhdGEoZmlsZUlkLCBwYXNzd29yZCwgb3duZXJQYXNzd29yZCwgdXNlclBhc3N3b3JkLCBmbGFncywgcmV2aXNpb24sIGtleUxlbmd0aCwgZW5jcnlwdE1ldGFkYXRhKSB7CiAgICBjb25zdCBoYXNoRGF0YVNpemUgPSA0MCArIG93bmVyUGFzc3dvcmQubGVuZ3RoICsgZmlsZUlkLmxlbmd0aDsKICAgIGNvbnN0IGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaGFzaERhdGFTaXplKTsKICAgIGxldCBpID0gMCwKICAgICAgaiwKICAgICAgbjsKICAgIGlmIChwYXNzd29yZCkgewogICAgICBuID0gTWF0aC5taW4oMzIsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgIGZvciAoOyBpIDwgbjsgKytpKSB7CiAgICAgICAgaGFzaERhdGFbaV0gPSBwYXNzd29yZFtpXTsKICAgICAgfQogICAgfQogICAgaiA9IDA7CiAgICB3aGlsZSAoaSA8IDMyKSB7CiAgICAgIGhhc2hEYXRhW2krK10gPSBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5Ll9kZWZhdWx0UGFzc3dvcmRCeXRlc1tqKytdOwogICAgfQogICAgaGFzaERhdGEuc2V0KG93bmVyUGFzc3dvcmQsIGkpOwogICAgaSArPSBvd25lclBhc3N3b3JkLmxlbmd0aDsKICAgIGhhc2hEYXRhW2krK10gPSBmbGFncyAmIDB4ZmY7CiAgICBoYXNoRGF0YVtpKytdID0gZmxhZ3MgPj4gOCAmIDB4ZmY7CiAgICBoYXNoRGF0YVtpKytdID0gZmxhZ3MgPj4gMTYgJiAweGZmOwogICAgaGFzaERhdGFbaSsrXSA9IGZsYWdzID4+PiAyNCAmIDB4ZmY7CiAgICBoYXNoRGF0YS5zZXQoZmlsZUlkLCBpKTsKICAgIGkgKz0gZmlsZUlkLmxlbmd0aDsKICAgIGlmIChyZXZpc2lvbiA+PSA0ICYmICFlbmNyeXB0TWV0YWRhdGEpIHsKICAgICAgaGFzaERhdGEuZmlsbCgweGZmLCBpLCBpICsgNCk7CiAgICAgIGkgKz0gNDsKICAgIH0KICAgIGxldCBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2hEYXRhLCAwLCBpKTsKICAgIGNvbnN0IGtleUxlbmd0aEluQnl0ZXMgPSBrZXlMZW5ndGggPj4gMzsKICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCA1MDsgKytqKSB7CiAgICAgICAgaGFzaCA9IGNhbGN1bGF0ZU1ENShoYXNoLCAwLCBrZXlMZW5ndGhJbkJ5dGVzKTsKICAgICAgfQogICAgfQogICAgY29uc3QgZW5jcnlwdGlvbktleSA9IGhhc2guc3ViYXJyYXkoMCwga2V5TGVuZ3RoSW5CeXRlcyk7CiAgICBsZXQgY2lwaGVyLCBjaGVja0RhdGE7CiAgICBpZiAocmV2aXNpb24gPj0gMykgewogICAgICBpID0gMDsKICAgICAgaGFzaERhdGEuc2V0KENpcGhlclRyYW5zZm9ybUZhY3RvcnkuX2RlZmF1bHRQYXNzd29yZEJ5dGVzLCBpKTsKICAgICAgaSArPSAzMjsKICAgICAgaGFzaERhdGEuc2V0KGZpbGVJZCwgaSk7CiAgICAgIGkgKz0gZmlsZUlkLmxlbmd0aDsKICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoZW5jcnlwdGlvbktleSk7CiAgICAgIGNoZWNrRGF0YSA9IGNpcGhlci5lbmNyeXB0QmxvY2soY2FsY3VsYXRlTUQ1KGhhc2hEYXRhLCAwLCBpKSk7CiAgICAgIG4gPSBlbmNyeXB0aW9uS2V5Lmxlbmd0aDsKICAgICAgY29uc3QgZGVyaXZlZEtleSA9IG5ldyBVaW50OEFycmF5KG4pOwogICAgICBmb3IgKGogPSAxOyBqIDw9IDE5OyArK2opIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG47ICsraykgewogICAgICAgICAgZGVyaXZlZEtleVtrXSA9IGVuY3J5cHRpb25LZXlba10gXiBqOwogICAgICAgIH0KICAgICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihkZXJpdmVkS2V5KTsKICAgICAgICBjaGVja0RhdGEgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKGNoZWNrRGF0YSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGVuY3J5cHRpb25LZXkpOwogICAgICBjaGVja0RhdGEgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKENpcGhlclRyYW5zZm9ybUZhY3RvcnkuX2RlZmF1bHRQYXNzd29yZEJ5dGVzKTsKICAgIH0KICAgIHJldHVybiBjaGVja0RhdGEuZXZlcnkoKGRhdGEsIGspID0+IHVzZXJQYXNzd29yZFtrXSA9PT0gZGF0YSkgPyBlbmNyeXB0aW9uS2V5IDogbnVsbDsKICB9CiAgI2RlY29kZVVzZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJQYXNzd29yZCwgcmV2aXNpb24sIGtleUxlbmd0aCkgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICBsZXQgaSA9IDA7CiAgICBjb25zdCBuID0gTWF0aC5taW4oMzIsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBmb3IgKDsgaSA8IG47ICsraSkgewogICAgICBoYXNoRGF0YVtpXSA9IHBhc3N3b3JkW2ldOwogICAgfQogICAgbGV0IGogPSAwOwogICAgd2hpbGUgKGkgPCAzMikgewogICAgICBoYXNoRGF0YVtpKytdID0gQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeS5fZGVmYXVsdFBhc3N3b3JkQnl0ZXNbaisrXTsKICAgIH0KICAgIGxldCBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2hEYXRhLCAwLCBpKTsKICAgIGNvbnN0IGtleUxlbmd0aEluQnl0ZXMgPSBrZXlMZW5ndGggPj4gMzsKICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCA1MDsgKytqKSB7CiAgICAgICAgaGFzaCA9IGNhbGN1bGF0ZU1ENShoYXNoLCAwLCBoYXNoLmxlbmd0aCk7CiAgICAgIH0KICAgIH0KICAgIGxldCBjaXBoZXIsIHVzZXJQYXNzd29yZDsKICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgIHVzZXJQYXNzd29yZCA9IG93bmVyUGFzc3dvcmQ7CiAgICAgIGNvbnN0IGRlcml2ZWRLZXkgPSBuZXcgVWludDhBcnJheShrZXlMZW5ndGhJbkJ5dGVzKTsKICAgICAgZm9yIChqID0gMTk7IGogPj0gMDsgai0tKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBrZXlMZW5ndGhJbkJ5dGVzOyArK2spIHsKICAgICAgICAgIGRlcml2ZWRLZXlba10gPSBoYXNoW2tdIF4gajsKICAgICAgICB9CiAgICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoZGVyaXZlZEtleSk7CiAgICAgICAgdXNlclBhc3N3b3JkID0gY2lwaGVyLmVuY3J5cHRCbG9jayh1c2VyUGFzc3dvcmQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihoYXNoLnN1YmFycmF5KDAsIGtleUxlbmd0aEluQnl0ZXMpKTsKICAgICAgdXNlclBhc3N3b3JkID0gY2lwaGVyLmVuY3J5cHRCbG9jayhvd25lclBhc3N3b3JkKTsKICAgIH0KICAgIHJldHVybiB1c2VyUGFzc3dvcmQ7CiAgfQogICNidWlsZE9iamVjdEtleShudW0sIGdlbiwgZW5jcnlwdGlvbktleSwgaXNBZXMgPSBmYWxzZSkgewogICAgY29uc3QgbiA9IGVuY3J5cHRpb25LZXkubGVuZ3RoOwogICAgY29uc3Qga2V5ID0gbmV3IFVpbnQ4QXJyYXkobiArIDkpOwogICAga2V5LnNldChlbmNyeXB0aW9uS2V5KTsKICAgIGxldCBpID0gbjsKICAgIGtleVtpKytdID0gbnVtICYgMHhmZjsKICAgIGtleVtpKytdID0gbnVtID4+IDggJiAweGZmOwogICAga2V5W2krK10gPSBudW0gPj4gMTYgJiAweGZmOwogICAga2V5W2krK10gPSBnZW4gJiAweGZmOwogICAga2V5W2krK10gPSBnZW4gPj4gOCAmIDB4ZmY7CiAgICBpZiAoaXNBZXMpIHsKICAgICAga2V5W2krK10gPSAweDczOwogICAgICBrZXlbaSsrXSA9IDB4NDE7CiAgICAgIGtleVtpKytdID0gMHg2YzsKICAgICAga2V5W2krK10gPSAweDU0OwogICAgfQogICAgY29uc3QgaGFzaCA9IGNhbGN1bGF0ZU1ENShrZXksIDAsIGkpOwogICAgcmV0dXJuIGhhc2guc3ViYXJyYXkoMCwgTWF0aC5taW4obiArIDUsIDE2KSk7CiAgfQogICNidWlsZENpcGhlckNvbnN0cnVjdG9yKGNmLCBuYW1lLCBudW0sIGdlbiwga2V5KSB7CiAgICBpZiAoIShuYW1lIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIGNyeXB0IGZpbHRlciBuYW1lLiIpOwogICAgfQogICAgY29uc3Qgc2VsZiA9IHRoaXM7CiAgICBjb25zdCBjcnlwdEZpbHRlciA9IGNmLmdldChuYW1lLm5hbWUpOwogICAgY29uc3QgY2ZtID0gY3J5cHRGaWx0ZXI/LmdldCgiQ0ZNIik7CiAgICBpZiAoIWNmbSB8fCBjZm0ubmFtZSA9PT0gIk5vbmUiKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBOdWxsQ2lwaGVyKCk7CiAgICAgIH07CiAgICB9CiAgICBpZiAoY2ZtLm5hbWUgPT09ICJWMiIpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IEFSQ0ZvdXJDaXBoZXIoc2VsZi4jYnVpbGRPYmplY3RLZXkobnVtLCBnZW4sIGtleSwgZmFsc2UpKTsKICAgICAgfTsKICAgIH0KICAgIGlmIChjZm0ubmFtZSA9PT0gIkFFU1YyIikgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgQUVTMTI4Q2lwaGVyKHNlbGYuI2J1aWxkT2JqZWN0S2V5KG51bSwgZ2VuLCBrZXksIHRydWUpKTsKICAgICAgfTsKICAgIH0KICAgIGlmIChjZm0ubmFtZSA9PT0gIkFFU1YzIikgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgQUVTMjU2Q2lwaGVyKGtleSk7CiAgICAgIH07CiAgICB9CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gY3J5cHRvIG1ldGhvZCIpOwogIH0KICBjb25zdHJ1Y3RvcihkaWN0LCBmaWxlSWQsIHBhc3N3b3JkKSB7CiAgICBjb25zdCBmaWx0ZXIgPSBkaWN0LmdldCgiRmlsdGVyIik7CiAgICBpZiAoIWlzTmFtZShmaWx0ZXIsICJTdGFuZGFyZCIpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigidW5rbm93biBlbmNyeXB0aW9uIG1ldGhvZCIpOwogICAgfQogICAgdGhpcy5maWx0ZXJOYW1lID0gZmlsdGVyLm5hbWU7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogICAgY29uc3QgYWxnb3JpdGhtID0gZGljdC5nZXQoIlYiKTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihhbGdvcml0aG0pIHx8IGFsZ29yaXRobSAhPT0gMSAmJiBhbGdvcml0aG0gIT09IDIgJiYgYWxnb3JpdGhtICE9PSA0ICYmIGFsZ29yaXRobSAhPT0gNSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoInVuc3VwcG9ydGVkIGVuY3J5cHRpb24gYWxnb3JpdGhtIik7CiAgICB9CiAgICB0aGlzLmFsZ29yaXRobSA9IGFsZ29yaXRobTsKICAgIGxldCBrZXlMZW5ndGggPSBkaWN0LmdldCgiTGVuZ3RoIik7CiAgICBpZiAoIWtleUxlbmd0aCkgewogICAgICBpZiAoYWxnb3JpdGhtIDw9IDMpIHsKICAgICAgICBrZXlMZW5ndGggPSA0MDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBjZkRpY3QgPSBkaWN0LmdldCgiQ0YiKTsKICAgICAgICBjb25zdCBzdHJlYW1DcnlwdG9OYW1lID0gZGljdC5nZXQoIlN0bUYiKTsKICAgICAgICBpZiAoY2ZEaWN0IGluc3RhbmNlb2YgRGljdCAmJiBzdHJlYW1DcnlwdG9OYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgY2ZEaWN0LnN1cHByZXNzRW5jcnlwdGlvbiA9IHRydWU7CiAgICAgICAgICBjb25zdCBoYW5kbGVyRGljdCA9IGNmRGljdC5nZXQoc3RyZWFtQ3J5cHRvTmFtZS5uYW1lKTsKICAgICAgICAgIGtleUxlbmd0aCA9IGhhbmRsZXJEaWN0Py5nZXQoIkxlbmd0aCIpIHx8IDEyODsKICAgICAgICAgIGlmIChrZXlMZW5ndGggPCA0MCkgewogICAgICAgICAgICBrZXlMZW5ndGggPDw9IDM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoa2V5TGVuZ3RoKSB8fCBrZXlMZW5ndGggPCA0MCB8fCBrZXlMZW5ndGggJSA4ICE9PSAwKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiaW52YWxpZCBrZXkgbGVuZ3RoIik7CiAgICB9CiAgICBjb25zdCBvd25lckJ5dGVzID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiTyIpKSwKICAgICAgdXNlckJ5dGVzID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiVSIpKTsKICAgIGNvbnN0IG93bmVyUGFzc3dvcmQgPSBvd25lckJ5dGVzLnN1YmFycmF5KDAsIDMyKTsKICAgIGNvbnN0IHVzZXJQYXNzd29yZCA9IHVzZXJCeXRlcy5zdWJhcnJheSgwLCAzMik7CiAgICBjb25zdCBmbGFncyA9IGRpY3QuZ2V0KCJQIik7CiAgICBjb25zdCByZXZpc2lvbiA9IGRpY3QuZ2V0KCJSIik7CiAgICBjb25zdCBlbmNyeXB0TWV0YWRhdGEgPSAoYWxnb3JpdGhtID09PSA0IHx8IGFsZ29yaXRobSA9PT0gNSkgJiYgZGljdC5nZXQoIkVuY3J5cHRNZXRhZGF0YSIpICE9PSBmYWxzZTsKICAgIHRoaXMuZW5jcnlwdE1ldGFkYXRhID0gZW5jcnlwdE1ldGFkYXRhOwogICAgY29uc3QgZmlsZUlkQnl0ZXMgPSBzdHJpbmdUb0J5dGVzKGZpbGVJZCk7CiAgICBsZXQgcGFzc3dvcmRCeXRlczsKICAgIGlmIChwYXNzd29yZCkgewogICAgICBpZiAocmV2aXNpb24gPT09IDYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcGFzc3dvcmQgPSB1dGY4U3RyaW5nVG9TdHJpbmcocGFzc3dvcmQpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgd2FybigiQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeTogVW5hYmxlIHRvIGNvbnZlcnQgVVRGOCBlbmNvZGVkIHBhc3N3b3JkLiIpOwogICAgICAgIH0KICAgICAgfQogICAgICBwYXNzd29yZEJ5dGVzID0gc3RyaW5nVG9CeXRlcyhwYXNzd29yZCk7CiAgICB9CiAgICBsZXQgZW5jcnlwdGlvbktleTsKICAgIGlmIChhbGdvcml0aG0gIT09IDUpIHsKICAgICAgZW5jcnlwdGlvbktleSA9IHRoaXMuI3ByZXBhcmVLZXlEYXRhKGZpbGVJZEJ5dGVzLCBwYXNzd29yZEJ5dGVzLCBvd25lclBhc3N3b3JkLCB1c2VyUGFzc3dvcmQsIGZsYWdzLCByZXZpc2lvbiwga2V5TGVuZ3RoLCBlbmNyeXB0TWV0YWRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3Qgb3duZXJWYWxpZGF0aW9uU2FsdCA9IG93bmVyQnl0ZXMuc3ViYXJyYXkoMzIsIDQwKTsKICAgICAgY29uc3Qgb3duZXJLZXlTYWx0ID0gb3duZXJCeXRlcy5zdWJhcnJheSg0MCwgNDgpOwogICAgICBjb25zdCB1Qnl0ZXMgPSB1c2VyQnl0ZXMuc3ViYXJyYXkoMCwgNDgpOwogICAgICBjb25zdCB1c2VyVmFsaWRhdGlvblNhbHQgPSB1c2VyQnl0ZXMuc3ViYXJyYXkoMzIsIDQwKTsKICAgICAgY29uc3QgdXNlcktleVNhbHQgPSB1c2VyQnl0ZXMuc3ViYXJyYXkoNDAsIDQ4KTsKICAgICAgY29uc3Qgb3duZXJFbmNyeXB0aW9uID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiT0UiKSk7CiAgICAgIGNvbnN0IHVzZXJFbmNyeXB0aW9uID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiVUUiKSk7CiAgICAgIGNvbnN0IHBlcm1zID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiUGVybXMiKSk7CiAgICAgIGVuY3J5cHRpb25LZXkgPSB0aGlzLiNjcmVhdGVFbmNyeXB0aW9uS2V5MjAocmV2aXNpb24sIHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCB1c2VyUGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlcktleVNhbHQsIG93bmVyRW5jcnlwdGlvbiwgdXNlckVuY3J5cHRpb24sIHBlcm1zKTsKICAgIH0KICAgIGlmICghZW5jcnlwdGlvbktleSkgewogICAgICBpZiAoIXBhc3N3b3JkKSB7CiAgICAgICAgdGhyb3cgbmV3IFBhc3N3b3JkRXhjZXB0aW9uKCJObyBwYXNzd29yZCBnaXZlbiIsIFBhc3N3b3JkUmVzcG9uc2VzLk5FRURfUEFTU1dPUkQpOwogICAgICB9CiAgICAgIGNvbnN0IGRlY29kZWRQYXNzd29yZCA9IHRoaXMuI2RlY29kZVVzZXJQYXNzd29yZChwYXNzd29yZEJ5dGVzLCBvd25lclBhc3N3b3JkLCByZXZpc2lvbiwga2V5TGVuZ3RoKTsKICAgICAgZW5jcnlwdGlvbktleSA9IHRoaXMuI3ByZXBhcmVLZXlEYXRhKGZpbGVJZEJ5dGVzLCBkZWNvZGVkUGFzc3dvcmQsIG93bmVyUGFzc3dvcmQsIHVzZXJQYXNzd29yZCwgZmxhZ3MsIHJldmlzaW9uLCBrZXlMZW5ndGgsIGVuY3J5cHRNZXRhZGF0YSk7CiAgICB9CiAgICBpZiAoIWVuY3J5cHRpb25LZXkpIHsKICAgICAgdGhyb3cgbmV3IFBhc3N3b3JkRXhjZXB0aW9uKCJJbmNvcnJlY3QgUGFzc3dvcmQiLCBQYXNzd29yZFJlc3BvbnNlcy5JTkNPUlJFQ1RfUEFTU1dPUkQpOwogICAgfQogICAgaWYgKGFsZ29yaXRobSA9PT0gNCAmJiBlbmNyeXB0aW9uS2V5Lmxlbmd0aCA8IDE2KSB7CiAgICAgIHRoaXMuZW5jcnlwdGlvbktleSA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgdGhpcy5lbmNyeXB0aW9uS2V5LnNldChlbmNyeXB0aW9uS2V5KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZW5jcnlwdGlvbktleSA9IGVuY3J5cHRpb25LZXk7CiAgICB9CiAgICBpZiAoYWxnb3JpdGhtID49IDQpIHsKICAgICAgY29uc3QgY2YgPSBkaWN0LmdldCgiQ0YiKTsKICAgICAgaWYgKGNmIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGNmLnN1cHByZXNzRW5jcnlwdGlvbiA9IHRydWU7CiAgICAgIH0KICAgICAgdGhpcy5jZiA9IGNmOwogICAgICB0aGlzLnN0bWYgPSBkaWN0LmdldCgiU3RtRiIpIHx8IE5hbWUuZ2V0KCJJZGVudGl0eSIpOwogICAgICB0aGlzLnN0cmYgPSBkaWN0LmdldCgiU3RyRiIpIHx8IE5hbWUuZ2V0KCJJZGVudGl0eSIpOwogICAgICB0aGlzLmVmZiA9IGRpY3QuZ2V0KCJFRkYiKSB8fCB0aGlzLnN0bWY7CiAgICB9CiAgfQogIGNyZWF0ZUNpcGhlclRyYW5zZm9ybShudW0sIGdlbikgewogICAgaWYgKHRoaXMuYWxnb3JpdGhtID09PSA0IHx8IHRoaXMuYWxnb3JpdGhtID09PSA1KSB7CiAgICAgIHJldHVybiBuZXcgQ2lwaGVyVHJhbnNmb3JtKHRoaXMuI2J1aWxkQ2lwaGVyQ29uc3RydWN0b3IodGhpcy5jZiwgdGhpcy5zdHJmLCBudW0sIGdlbiwgdGhpcy5lbmNyeXB0aW9uS2V5KSwgdGhpcy4jYnVpbGRDaXBoZXJDb25zdHJ1Y3Rvcih0aGlzLmNmLCB0aGlzLnN0bWYsIG51bSwgZ2VuLCB0aGlzLmVuY3J5cHRpb25LZXkpKTsKICAgIH0KICAgIGNvbnN0IGtleSA9IHRoaXMuI2J1aWxkT2JqZWN0S2V5KG51bSwgZ2VuLCB0aGlzLmVuY3J5cHRpb25LZXksIGZhbHNlKTsKICAgIGNvbnN0IGNpcGhlckNvbnN0cnVjdG9yID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbmV3IEFSQ0ZvdXJDaXBoZXIoa2V5KTsKICAgIH07CiAgICByZXR1cm4gbmV3IENpcGhlclRyYW5zZm9ybShjaXBoZXJDb25zdHJ1Y3RvciwgY2lwaGVyQ29uc3RydWN0b3IpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveHJlZi5qcwoKCgoKCgpjbGFzcyBYUmVmIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHBkZk1hbmFnZXIpIHsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMuZW50cmllcyA9IFtdOwogICAgdGhpcy5feHJlZlN0bXMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl9jYWNoZU1hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3BlbmRpbmdSZWZzID0gbmV3IFJlZlNldCgpOwogICAgdGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSA9IG51bGw7CiAgICB0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPSBudWxsOwogICAgdGhpcy5fcGVyc2lzdGVudFJlZnNDYWNoZSA9IG51bGw7CiAgfQogIGdldE5ld1BlcnNpc3RlbnRSZWYob2JqKSB7CiAgICBpZiAodGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSA9PT0gbnVsbCkgewogICAgICB0aGlzLl9uZXdQZXJzaXN0ZW50UmVmTnVtID0gdGhpcy5lbnRyaWVzLmxlbmd0aCB8fCAxOwogICAgfQogICAgY29uc3QgbnVtID0gdGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSsrOwogICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgb2JqKTsKICAgIHJldHVybiBSZWYuZ2V0KG51bSwgMCk7CiAgfQogIGdldE5ld1RlbXBvcmFyeVJlZigpIHsKICAgIGlmICh0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPT09IG51bGwpIHsKICAgICAgdGhpcy5fbmV3VGVtcG9yYXJ5UmVmTnVtID0gdGhpcy5lbnRyaWVzLmxlbmd0aCB8fCAxOwogICAgICBpZiAodGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSkgewogICAgICAgIHRoaXMuX3BlcnNpc3RlbnRSZWZzQ2FjaGUgPSBuZXcgTWFwKCk7CiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bTsgaSA8IHRoaXMuX25ld1BlcnNpc3RlbnRSZWZOdW07IGkrKykgewogICAgICAgICAgdGhpcy5fcGVyc2lzdGVudFJlZnNDYWNoZS5zZXQoaSwgdGhpcy5fY2FjaGVNYXAuZ2V0KGkpKTsKICAgICAgICAgIHRoaXMuX2NhY2hlTWFwLmRlbGV0ZShpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBSZWYuZ2V0KHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bSsrLCAwKTsKICB9CiAgcmVzZXROZXdUZW1wb3JhcnlSZWYoKSB7CiAgICB0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPSBudWxsOwogICAgaWYgKHRoaXMuX3BlcnNpc3RlbnRSZWZzQ2FjaGUpIHsKICAgICAgZm9yIChjb25zdCBbbnVtLCBvYmpdIG9mIHRoaXMuX3BlcnNpc3RlbnRSZWZzQ2FjaGUpIHsKICAgICAgICB0aGlzLl9jYWNoZU1hcC5zZXQobnVtLCBvYmopOwogICAgICB9CiAgICB9CiAgICB0aGlzLl9wZXJzaXN0ZW50UmVmc0NhY2hlID0gbnVsbDsKICB9CiAgc2V0U3RhcnRYUmVmKHN0YXJ0WFJlZikgewogICAgdGhpcy5zdGFydFhSZWZRdWV1ZSA9IFtzdGFydFhSZWZdOwogIH0KICBwYXJzZShyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgbGV0IHRyYWlsZXJEaWN0OwogICAgaWYgKCFyZWNvdmVyeU1vZGUpIHsKICAgICAgdHJhaWxlckRpY3QgPSB0aGlzLnJlYWRYUmVmKCk7CiAgICB9IGVsc2UgewogICAgICB3YXJuKCJJbmRleGluZyBhbGwgUERGIG9iamVjdHMiKTsKICAgICAgdHJhaWxlckRpY3QgPSB0aGlzLmluZGV4T2JqZWN0cygpOwogICAgfQogICAgdHJhaWxlckRpY3QuYXNzaWduWHJlZih0aGlzKTsKICAgIHRoaXMudHJhaWxlciA9IHRyYWlsZXJEaWN0OwogICAgbGV0IGVuY3J5cHQ7CiAgICB0cnkgewogICAgICBlbmNyeXB0ID0gdHJhaWxlckRpY3QuZ2V0KCJFbmNyeXB0Iik7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYFhSZWYucGFyc2UgLSBJbnZhbGlkICJFbmNyeXB0IiByZWZlcmVuY2U6ICIke2V4fSIuYCk7CiAgICB9CiAgICBpZiAoZW5jcnlwdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgaWRzID0gdHJhaWxlckRpY3QuZ2V0KCJJRCIpOwogICAgICBjb25zdCBmaWxlSWQgPSBpZHM/Lmxlbmd0aCA/IGlkc1swXSA6ICIiOwogICAgICBlbmNyeXB0LnN1cHByZXNzRW5jcnlwdGlvbiA9IHRydWU7CiAgICAgIHRoaXMuZW5jcnlwdCA9IG5ldyBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5KGVuY3J5cHQsIGZpbGVJZCwgdGhpcy5wZGZNYW5hZ2VyLnBhc3N3b3JkKTsKICAgIH0KICAgIGxldCByb290OwogICAgdHJ5IHsKICAgICAgcm9vdCA9IHRyYWlsZXJEaWN0LmdldCgiUm9vdCIpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGBYUmVmLnBhcnNlIC0gSW52YWxpZCAiUm9vdCIgcmVmZXJlbmNlOiAiJHtleH0iLmApOwogICAgfQogICAgaWYgKHJvb3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcGFnZXMgPSByb290LmdldCgiUGFnZXMiKTsKICAgICAgICBpZiAocGFnZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICB0aGlzLnJvb3QgPSByb290OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgfQogICAgICAgIHdhcm4oYFhSZWYucGFyc2UgLSBJbnZhbGlkICJQYWdlcyIgcmVmZXJlbmNlOiAiJHtleH0iLmApOwogICAgICB9CiAgICB9CiAgICBpZiAoIXJlY292ZXJ5TW9kZSkgewogICAgICB0aHJvdyBuZXcgWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgICB9CiAgICB0aHJvdyBuZXcgSW52YWxpZFBERkV4Y2VwdGlvbigiSW52YWxpZCBSb290IHJlZmVyZW5jZS4iKTsKICB9CiAgcHJvY2Vzc1hSZWZUYWJsZShwYXJzZXIpIHsKICAgIGlmICghKCJ0YWJsZVN0YXRlIiBpbiB0aGlzKSkgewogICAgICB0aGlzLnRhYmxlU3RhdGUgPSB7CiAgICAgICAgZW50cnlOdW06IDAsCiAgICAgICAgc3RyZWFtUG9zOiBwYXJzZXIubGV4ZXIuc3RyZWFtLnBvcywKICAgICAgICBwYXJzZXJCdWYxOiBwYXJzZXIuYnVmMSwKICAgICAgICBwYXJzZXJCdWYyOiBwYXJzZXIuYnVmMgogICAgICB9OwogICAgfQogICAgY29uc3Qgb2JqID0gdGhpcy5yZWFkWFJlZlRhYmxlKHBhcnNlcik7CiAgICBpZiAoIWlzQ21kKG9iaiwgInRyYWlsZXIiKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogY291bGQgbm90IGZpbmQgdHJhaWxlciBkaWN0aW9uYXJ5Iik7CiAgICB9CiAgICBsZXQgZGljdCA9IHBhcnNlci5nZXRPYmooKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSAmJiBkaWN0LmRpY3QpIHsKICAgICAgZGljdCA9IGRpY3QuZGljdDsKICAgIH0KICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogY291bGQgbm90IHBhcnNlIHRyYWlsZXIgZGljdGlvbmFyeSIpOwogICAgfQogICAgZGVsZXRlIHRoaXMudGFibGVTdGF0ZTsKICAgIHJldHVybiBkaWN0OwogIH0KICByZWFkWFJlZlRhYmxlKHBhcnNlcikgewogICAgY29uc3Qgc3RyZWFtID0gcGFyc2VyLmxleGVyLnN0cmVhbTsKICAgIGNvbnN0IHRhYmxlU3RhdGUgPSB0aGlzLnRhYmxlU3RhdGU7CiAgICBzdHJlYW0ucG9zID0gdGFibGVTdGF0ZS5zdHJlYW1Qb3M7CiAgICBwYXJzZXIuYnVmMSA9IHRhYmxlU3RhdGUucGFyc2VyQnVmMTsKICAgIHBhcnNlci5idWYyID0gdGFibGVTdGF0ZS5wYXJzZXJCdWYyOwogICAgbGV0IG9iajsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmICghKCJmaXJzdEVudHJ5TnVtIiBpbiB0YWJsZVN0YXRlKSB8fCAhKCJlbnRyeUNvdW50IiBpbiB0YWJsZVN0YXRlKSkgewogICAgICAgIGlmIChpc0NtZChvYmogPSBwYXJzZXIuZ2V0T2JqKCksICJ0cmFpbGVyIikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0YWJsZVN0YXRlLmZpcnN0RW50cnlOdW0gPSBvYmo7CiAgICAgICAgdGFibGVTdGF0ZS5lbnRyeUNvdW50ID0gcGFyc2VyLmdldE9iaigpOwogICAgICB9CiAgICAgIGxldCBmaXJzdCA9IHRhYmxlU3RhdGUuZmlyc3RFbnRyeU51bTsKICAgICAgY29uc3QgY291bnQgPSB0YWJsZVN0YXRlLmVudHJ5Q291bnQ7CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihmaXJzdCkgfHwgIU51bWJlci5pc0ludGVnZXIoY291bnQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgdGFibGU6IHdyb25nIHR5cGVzIGluIHN1YnNlY3Rpb24gaGVhZGVyIik7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IHRhYmxlU3RhdGUuZW50cnlOdW07IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgdGFibGVTdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICAgIHRhYmxlU3RhdGUuZW50cnlOdW0gPSBpOwogICAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMSA9IHBhcnNlci5idWYxOwogICAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMiA9IHBhcnNlci5idWYyOwogICAgICAgIGNvbnN0IGVudHJ5ID0ge307CiAgICAgICAgZW50cnkub2Zmc2V0ID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgIGVudHJ5LmdlbiA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICBjb25zdCB0eXBlID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgQ21kKSB7CiAgICAgICAgICBzd2l0Y2ggKHR5cGUuY21kKSB7CiAgICAgICAgICAgIGNhc2UgImYiOgogICAgICAgICAgICAgIGVudHJ5LmZyZWUgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJuIjoKICAgICAgICAgICAgICBlbnRyeS51bmNvbXByZXNzZWQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZW50cnkub2Zmc2V0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihlbnRyeS5nZW4pIHx8ICEoZW50cnkuZnJlZSB8fCBlbnRyeS51bmNvbXByZXNzZWQpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZW50cnkgaW4gWFJlZiBzdWJzZWN0aW9uOiAke2ZpcnN0fSwgJHtjb3VudH1gKTsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPT09IDAgJiYgZW50cnkuZnJlZSAmJiBmaXJzdCA9PT0gMSkgewogICAgICAgICAgZmlyc3QgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuZW50cmllc1tpICsgZmlyc3RdKSB7CiAgICAgICAgICB0aGlzLmVudHJpZXNbaSArIGZpcnN0XSA9IGVudHJ5OwogICAgICAgIH0KICAgICAgfQogICAgICB0YWJsZVN0YXRlLmVudHJ5TnVtID0gMDsKICAgICAgdGFibGVTdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICB0YWJsZVN0YXRlLnBhcnNlckJ1ZjEgPSBwYXJzZXIuYnVmMTsKICAgICAgdGFibGVTdGF0ZS5wYXJzZXJCdWYyID0gcGFyc2VyLmJ1ZjI7CiAgICAgIGRlbGV0ZSB0YWJsZVN0YXRlLmZpcnN0RW50cnlOdW07CiAgICAgIGRlbGV0ZSB0YWJsZVN0YXRlLmVudHJ5Q291bnQ7CiAgICB9CiAgICBpZiAodGhpcy5lbnRyaWVzWzBdICYmICF0aGlzLmVudHJpZXNbMF0uZnJlZSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogdW5leHBlY3RlZCBmaXJzdCBvYmplY3QiKTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogIHByb2Nlc3NYUmVmU3RyZWFtKHN0cmVhbSkgewogICAgaWYgKCEoInN0cmVhbVN0YXRlIiBpbiB0aGlzKSkgewogICAgICBjb25zdCB7CiAgICAgICAgZGljdCwKICAgICAgICBwb3MKICAgICAgfSA9IHN0cmVhbTsKICAgICAgY29uc3QgYnl0ZVdpZHRocyA9IGRpY3QuZ2V0KCJXIik7CiAgICAgIGNvbnN0IHJhbmdlID0gZGljdC5nZXQoIkluZGV4IikgfHwgWzAsIGRpY3QuZ2V0KCJTaXplIildOwogICAgICB0aGlzLnN0cmVhbVN0YXRlID0gewogICAgICAgIGVudHJ5UmFuZ2VzOiByYW5nZSwKICAgICAgICBieXRlV2lkdGhzLAogICAgICAgIGVudHJ5TnVtOiAwLAogICAgICAgIHN0cmVhbVBvczogcG9zCiAgICAgIH07CiAgICB9CiAgICB0aGlzLnJlYWRYUmVmU3RyZWFtKHN0cmVhbSk7CiAgICBkZWxldGUgdGhpcy5zdHJlYW1TdGF0ZTsKICAgIHJldHVybiBzdHJlYW0uZGljdDsKICB9CiAgcmVhZFhSZWZTdHJlYW0oc3RyZWFtKSB7CiAgICBjb25zdCBzdHJlYW1TdGF0ZSA9IHRoaXMuc3RyZWFtU3RhdGU7CiAgICBzdHJlYW0ucG9zID0gc3RyZWFtU3RhdGUuc3RyZWFtUG9zOwogICAgY29uc3QgW3R5cGVGaWVsZFdpZHRoLCBvZmZzZXRGaWVsZFdpZHRoLCBnZW5lcmF0aW9uRmllbGRXaWR0aF0gPSBzdHJlYW1TdGF0ZS5ieXRlV2lkdGhzOwogICAgY29uc3QgZW50cnlSYW5nZXMgPSBzdHJlYW1TdGF0ZS5lbnRyeVJhbmdlczsKICAgIHdoaWxlIChlbnRyeVJhbmdlcy5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IFtmaXJzdCwgbl0gPSBlbnRyeVJhbmdlczsKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBYUmVmIHJhbmdlIGZpZWxkczogJHtmaXJzdH0sICR7bn1gKTsKICAgICAgfQogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodHlwZUZpZWxkV2lkdGgpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG9mZnNldEZpZWxkV2lkdGgpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKGdlbmVyYXRpb25GaWVsZFdpZHRoKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBYUmVmIGVudHJ5IGZpZWxkcyBsZW5ndGg6ICR7Zmlyc3R9LCAke259YCk7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IHN0cmVhbVN0YXRlLmVudHJ5TnVtOyBpIDwgbjsgKytpKSB7CiAgICAgICAgc3RyZWFtU3RhdGUuZW50cnlOdW0gPSBpOwogICAgICAgIHN0cmVhbVN0YXRlLnN0cmVhbVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgbGV0IHR5cGUgPSAwLAogICAgICAgICAgb2Zmc2V0ID0gMCwKICAgICAgICAgIGdlbmVyYXRpb24gPSAwOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdHlwZUZpZWxkV2lkdGg7ICsraikgewogICAgICAgICAgY29uc3QgdHlwZUJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgaWYgKHR5cGVCeXRlID09PSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBieXRlV2lkdGhzICd0eXBlJy4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHR5cGUgPSB0eXBlIDw8IDggfCB0eXBlQnl0ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVGaWVsZFdpZHRoID09PSAwKSB7CiAgICAgICAgICB0eXBlID0gMTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBvZmZzZXRGaWVsZFdpZHRoOyArK2opIHsKICAgICAgICAgIGNvbnN0IG9mZnNldEJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgaWYgKG9mZnNldEJ5dGUgPT09IC0xKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIGJ5dGVXaWR0aHMgJ29mZnNldCcuIik7CiAgICAgICAgICB9CiAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPDwgOCB8IG9mZnNldEJ5dGU7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZ2VuZXJhdGlvbkZpZWxkV2lkdGg7ICsraikgewogICAgICAgICAgY29uc3QgZ2VuZXJhdGlvbkJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgaWYgKGdlbmVyYXRpb25CeXRlID09PSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBieXRlV2lkdGhzICdnZW5lcmF0aW9uJy4iKTsKICAgICAgICAgIH0KICAgICAgICAgIGdlbmVyYXRpb24gPSBnZW5lcmF0aW9uIDw8IDggfCBnZW5lcmF0aW9uQnl0ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZW50cnkgPSB7fTsKICAgICAgICBlbnRyeS5vZmZzZXQgPSBvZmZzZXQ7CiAgICAgICAgZW50cnkuZ2VuID0gZ2VuZXJhdGlvbjsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZW50cnkuZnJlZSA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBlbnRyeS51bmNvbXByZXNzZWQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgWFJlZiBlbnRyeSB0eXBlOiAke3R5cGV9YCk7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5lbnRyaWVzW2ZpcnN0ICsgaV0pIHsKICAgICAgICAgIHRoaXMuZW50cmllc1tmaXJzdCArIGldID0gZW50cnk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0cmVhbVN0YXRlLmVudHJ5TnVtID0gMDsKICAgICAgc3RyZWFtU3RhdGUuc3RyZWFtUG9zID0gc3RyZWFtLnBvczsKICAgICAgZW50cnlSYW5nZXMuc3BsaWNlKDAsIDIpOwogICAgfQogIH0KICBpbmRleE9iamVjdHMoKSB7CiAgICBjb25zdCBUQUIgPSAweDksCiAgICAgIExGID0gMHhhLAogICAgICBDUiA9IDB4ZCwKICAgICAgU1BBQ0UgPSAweDIwOwogICAgY29uc3QgUEVSQ0VOVCA9IDB4MjUsCiAgICAgIExUID0gMHgzYzsKICAgIGZ1bmN0aW9uIHJlYWRUb2tlbihkYXRhLCBvZmZzZXQpIHsKICAgICAgbGV0IHRva2VuID0gIiIsCiAgICAgICAgY2ggPSBkYXRhW29mZnNldF07CiAgICAgIHdoaWxlIChjaCAhPT0gTEYgJiYgY2ggIT09IENSICYmIGNoICE9PSBMVCkgewogICAgICAgIGlmICgrK29mZnNldCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHRva2VuICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgIGNoID0gZGF0YVtvZmZzZXRdOwogICAgICB9CiAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KICAgIGZ1bmN0aW9uIHNraXBVbnRpbChkYXRhLCBvZmZzZXQsIHdoYXQpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gd2hhdC5sZW5ndGgsCiAgICAgICAgZGF0YUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgICBsZXQgc2tpcHBlZCA9IDA7CiAgICAgIHdoaWxlIChvZmZzZXQgPCBkYXRhTGVuZ3RoKSB7CiAgICAgICAgbGV0IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgbGVuZ3RoICYmIGRhdGFbb2Zmc2V0ICsgaV0gPT09IHdoYXRbaV0pIHsKICAgICAgICAgICsraTsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPj0gbGVuZ3RoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgc2tpcHBlZCsrOwogICAgICB9CiAgICAgIHJldHVybiBza2lwcGVkOwogICAgfQogICAgY29uc3QgZ0VuZG9ialJlZ0V4cCA9IC9cYihlbmRvYmp8XGQrXHMrXGQrXHMrb2JqfHhyZWZ8dHJhaWxlclxzKjw8KVxiL2c7CiAgICBjb25zdCBnU3RhcnR4cmVmUmVnRXhwID0gL1xiKHN0YXJ0eHJlZnxcZCtccytcZCtccytvYmopXGIvZzsKICAgIGNvbnN0IG9ialJlZ0V4cCA9IC9eKFxkKylccysoXGQrKVxzK29ialxiLzsKICAgIGNvbnN0IHRyYWlsZXJCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxMTYsIDExNCwgOTcsIDEwNSwgMTA4LCAxMDEsIDExNF0pOwogICAgY29uc3Qgc3RhcnR4cmVmQnl0ZXMgPSBuZXcgVWludDhBcnJheShbMTE1LCAxMTYsIDk3LCAxMTQsIDExNiwgMTIwLCAxMTQsIDEwMSwgMTAyXSk7CiAgICBjb25zdCB4cmVmQnl0ZXMgPSBuZXcgVWludDhBcnJheShbNDcsIDg4LCA4MiwgMTAxLCAxMDJdKTsKICAgIHRoaXMuZW50cmllcy5sZW5ndGggPSAwOwogICAgdGhpcy5fY2FjaGVNYXAuY2xlYXIoKTsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgc3RyZWFtLnBvcyA9IDA7CiAgICBjb25zdCBidWZmZXIgPSBzdHJlYW0uZ2V0Qnl0ZXMoKSwKICAgICAgYnVmZmVyU3RyID0gYnl0ZXNUb1N0cmluZyhidWZmZXIpLAogICAgICBsZW5ndGggPSBidWZmZXIubGVuZ3RoOwogICAgbGV0IHBvc2l0aW9uID0gc3RyZWFtLnN0YXJ0OwogICAgY29uc3QgdHJhaWxlcnMgPSBbXSwKICAgICAgeHJlZlN0bXMgPSBbXTsKICAgIHdoaWxlIChwb3NpdGlvbiA8IGxlbmd0aCkgewogICAgICBsZXQgY2ggPSBidWZmZXJbcG9zaXRpb25dOwogICAgICBpZiAoY2ggPT09IFRBQiB8fCBjaCA9PT0gTEYgfHwgY2ggPT09IENSIHx8IGNoID09PSBTUEFDRSkgewogICAgICAgICsrcG9zaXRpb247CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNoID09PSBQRVJDRU5UKSB7CiAgICAgICAgZG8gewogICAgICAgICAgKytwb3NpdGlvbjsKICAgICAgICAgIGlmIChwb3NpdGlvbiA+PSBsZW5ndGgpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjaCA9IGJ1ZmZlcltwb3NpdGlvbl07CiAgICAgICAgfSB3aGlsZSAoY2ggIT09IExGICYmIGNoICE9PSBDUik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdG9rZW4gPSByZWFkVG9rZW4oYnVmZmVyLCBwb3NpdGlvbik7CiAgICAgIGxldCBtOwogICAgICBpZiAodG9rZW4uc3RhcnRzV2l0aCgieHJlZiIpICYmICh0b2tlbi5sZW5ndGggPT09IDQgfHwgL1xzLy50ZXN0KHRva2VuWzRdKSkpIHsKICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgdHJhaWxlckJ5dGVzKTsKICAgICAgICB0cmFpbGVycy5wdXNoKHBvc2l0aW9uKTsKICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgc3RhcnR4cmVmQnl0ZXMpOwogICAgICB9IGVsc2UgaWYgKG0gPSBvYmpSZWdFeHAuZXhlYyh0b2tlbikpIHsKICAgICAgICBjb25zdCBudW0gPSBtWzFdIHwgMCwKICAgICAgICAgIGdlbiA9IG1bMl0gfCAwOwogICAgICAgIGNvbnN0IHN0YXJ0UG9zID0gcG9zaXRpb24gKyB0b2tlbi5sZW5ndGg7CiAgICAgICAgbGV0IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICB1cGRhdGVFbnRyaWVzID0gZmFsc2U7CiAgICAgICAgaWYgKCF0aGlzLmVudHJpZXNbbnVtXSkgewogICAgICAgICAgdXBkYXRlRW50cmllcyA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVudHJpZXNbbnVtXS5nZW4gPT09IGdlbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgICAgICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydFBvcykpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICAgIHVwZGF0ZUVudHJpZXMgPSB0cnVlOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgUGFyc2VyRU9GRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgd2FybihgaW5kZXhPYmplY3RzIC0tIGNoZWNraW5nIG9iamVjdCAoJHt0b2tlbn0pOiAiJHtleH0iLmApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHVwZGF0ZUVudHJpZXMgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh1cGRhdGVFbnRyaWVzKSB7CiAgICAgICAgICB0aGlzLmVudHJpZXNbbnVtXSA9IHsKICAgICAgICAgICAgb2Zmc2V0OiBwb3NpdGlvbiAtIHN0cmVhbS5zdGFydCwKICAgICAgICAgICAgZ2VuLAogICAgICAgICAgICB1bmNvbXByZXNzZWQ6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGdFbmRvYmpSZWdFeHAubGFzdEluZGV4ID0gc3RhcnRQb3M7CiAgICAgICAgY29uc3QgbWF0Y2ggPSBnRW5kb2JqUmVnRXhwLmV4ZWMoYnVmZmVyU3RyKTsKICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgIGNvbnN0IGVuZFBvcyA9IGdFbmRvYmpSZWdFeHAubGFzdEluZGV4ICsgMTsKICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBlbmRQb3MgLSBwb3NpdGlvbjsKICAgICAgICAgIGlmIChtYXRjaFsxXSAhPT0gImVuZG9iaiIpIHsKICAgICAgICAgICAgd2FybihgaW5kZXhPYmplY3RzOiBGb3VuZCAiJHttYXRjaFsxXX0iIGluc2lkZSBvZiBhbm90aGVyICJvYmoiLCBgICsgJ2NhdXNlZCBieSBtaXNzaW5nICJlbmRvYmoiIC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgICAgICBjb250ZW50TGVuZ3RoIC09IG1hdGNoWzFdLmxlbmd0aCArIDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBsZW5ndGggLSBwb3NpdGlvbjsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29udGVudCA9IGJ1ZmZlci5zdWJhcnJheShwb3NpdGlvbiwgcG9zaXRpb24gKyBjb250ZW50TGVuZ3RoKTsKICAgICAgICBjb25zdCB4cmVmVGFnT2Zmc2V0ID0gc2tpcFVudGlsKGNvbnRlbnQsIDAsIHhyZWZCeXRlcyk7CiAgICAgICAgaWYgKHhyZWZUYWdPZmZzZXQgPCBjb250ZW50TGVuZ3RoICYmIGNvbnRlbnRbeHJlZlRhZ09mZnNldCArIDVdIDwgNjQpIHsKICAgICAgICAgIHhyZWZTdG1zLnB1c2gocG9zaXRpb24gLSBzdHJlYW0uc3RhcnQpOwogICAgICAgICAgdGhpcy5feHJlZlN0bXMuYWRkKHBvc2l0aW9uIC0gc3RyZWFtLnN0YXJ0KTsKICAgICAgICB9CiAgICAgICAgcG9zaXRpb24gKz0gY29udGVudExlbmd0aDsKICAgICAgfSBlbHNlIGlmICh0b2tlbi5zdGFydHNXaXRoKCJ0cmFpbGVyIikgJiYgKHRva2VuLmxlbmd0aCA9PT0gNyB8fCAvXHMvLnRlc3QodG9rZW5bN10pKSkgewogICAgICAgIHRyYWlsZXJzLnB1c2gocG9zaXRpb24pOwogICAgICAgIGNvbnN0IHN0YXJ0UG9zID0gcG9zaXRpb24gKyB0b2tlbi5sZW5ndGg7CiAgICAgICAgbGV0IGNvbnRlbnRMZW5ndGg7CiAgICAgICAgZ1N0YXJ0eHJlZlJlZ0V4cC5sYXN0SW5kZXggPSBzdGFydFBvczsKICAgICAgICBjb25zdCBtYXRjaCA9IGdTdGFydHhyZWZSZWdFeHAuZXhlYyhidWZmZXJTdHIpOwogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgY29uc3QgZW5kUG9zID0gZ1N0YXJ0eHJlZlJlZ0V4cC5sYXN0SW5kZXggKyAxOwogICAgICAgICAgY29udGVudExlbmd0aCA9IGVuZFBvcyAtIHBvc2l0aW9uOwogICAgICAgICAgaWYgKG1hdGNoWzFdICE9PSAic3RhcnR4cmVmIikgewogICAgICAgICAgICB3YXJuKGBpbmRleE9iamVjdHM6IEZvdW5kICIke21hdGNoWzFdfSIgYWZ0ZXIgInRyYWlsZXIiLCBgICsgJ2NhdXNlZCBieSBtaXNzaW5nICJzdGFydHhyZWYiIC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgICAgICBjb250ZW50TGVuZ3RoIC09IG1hdGNoWzFdLmxlbmd0aCArIDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBsZW5ndGggLSBwb3NpdGlvbjsKICAgICAgICB9CiAgICAgICAgcG9zaXRpb24gKz0gY29udGVudExlbmd0aDsKICAgICAgfSBlbHNlIHsKICAgICAgICBwb3NpdGlvbiArPSB0b2tlbi5sZW5ndGggKyAxOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IHhyZWZTdG0gb2YgeHJlZlN0bXMpIHsKICAgICAgdGhpcy5zdGFydFhSZWZRdWV1ZS5wdXNoKHhyZWZTdG0pOwogICAgICB0aGlzLnJlYWRYUmVmKHRydWUpOwogICAgfQogICAgY29uc3QgdHJhaWxlckRpY3RzID0gW107CiAgICBsZXQgaXNFbmNyeXB0ZWQgPSBmYWxzZTsKICAgIGZvciAoY29uc3QgdHJhaWxlciBvZiB0cmFpbGVycykgewogICAgICBzdHJlYW0ucG9zID0gdHJhaWxlcjsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0pLAogICAgICAgIHhyZWY6IHRoaXMsCiAgICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlLAogICAgICAgIHJlY292ZXJ5TW9kZTogdHJ1ZQogICAgICB9KTsKICAgICAgY29uc3Qgb2JqID0gcGFyc2VyLmdldE9iaigpOwogICAgICBpZiAoIWlzQ21kKG9iaiwgInRyYWlsZXIiKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRpY3QgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyYWlsZXJEaWN0cy5wdXNoKGRpY3QpOwogICAgICBpZiAoZGljdC5oYXMoIkVuY3J5cHQiKSkgewogICAgICAgIGlzRW5jcnlwdGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgbGV0IHRyYWlsZXJEaWN0LCB0cmFpbGVyRXJyb3I7CiAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgWy4uLnRyYWlsZXJEaWN0cywgImdlbkZhbGxiYWNrIiwgLi4udHJhaWxlckRpY3RzXSkgewogICAgICBpZiAoZGljdCA9PT0gImdlbkZhbGxiYWNrIikgewogICAgICAgIGlmICghdHJhaWxlckVycm9yKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdGhpcy5fZ2VuZXJhdGlvbkZhbGxiYWNrID0gdHJ1ZTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgdmFsaWRQYWdlc0RpY3QgPSBmYWxzZTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByb290RGljdCA9IGRpY3QuZ2V0KCJSb290Iik7CiAgICAgICAgaWYgKCEocm9vdERpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBhZ2VzRGljdCA9IHJvb3REaWN0LmdldCgiUGFnZXMiKTsKICAgICAgICBpZiAoIShwYWdlc0RpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBhZ2VzQ291bnQgPSBwYWdlc0RpY3QuZ2V0KCJDb3VudCIpOwogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHBhZ2VzQ291bnQpKSB7CiAgICAgICAgICB2YWxpZFBhZ2VzRGljdCA9IHRydWU7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHRyYWlsZXJFcnJvciA9IGV4OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh2YWxpZFBhZ2VzRGljdCAmJiAoIWlzRW5jcnlwdGVkIHx8IGRpY3QuaGFzKCJFbmNyeXB0IikpICYmIGRpY3QuaGFzKCJJRCIpKSB7CiAgICAgICAgcmV0dXJuIGRpY3Q7CiAgICAgIH0KICAgICAgdHJhaWxlckRpY3QgPSBkaWN0OwogICAgfQogICAgaWYgKHRyYWlsZXJEaWN0KSB7CiAgICAgIHJldHVybiB0cmFpbGVyRGljdDsKICAgIH0KICAgIGlmICh0aGlzLnRvcERpY3QpIHsKICAgICAgcmV0dXJuIHRoaXMudG9wRGljdDsKICAgIH0KICAgIGlmICghdHJhaWxlckRpY3RzLmxlbmd0aCkgewogICAgICBmb3IgKGNvbnN0IG51bSBpbiB0aGlzLmVudHJpZXMpIHsKICAgICAgICBpZiAoIU9iamVjdC5oYXNPd24odGhpcy5lbnRyaWVzLCBudW0pKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmVudHJpZXNbbnVtXTsKICAgICAgICBjb25zdCByZWYgPSBSZWYuZ2V0KHBhcnNlSW50KG51bSksIGVudHJ5Lmdlbik7CiAgICAgICAgbGV0IG9iajsKICAgICAgICB0cnkgewogICAgICAgICAgb2JqID0gdGhpcy5mZXRjaChyZWYpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgICBvYmogPSBvYmouZGljdDsKICAgICAgICB9CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QgJiYgb2JqLmhhcygiUm9vdCIpKSB7CiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhyb3cgbmV3IEludmFsaWRQREZFeGNlcHRpb24oIkludmFsaWQgUERGIHN0cnVjdHVyZS4iKTsKICB9CiAgcmVhZFhSZWYocmVjb3ZlcnlNb2RlID0gZmFsc2UpIHsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgY29uc3Qgc3RhcnRYUmVmUGFyc2VkQ2FjaGUgPSBuZXcgU2V0KCk7CiAgICB3aGlsZSAodGhpcy5zdGFydFhSZWZRdWV1ZS5sZW5ndGgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBzdGFydFhSZWYgPSB0aGlzLnN0YXJ0WFJlZlF1ZXVlWzBdOwogICAgICAgIGlmIChzdGFydFhSZWZQYXJzZWRDYWNoZS5oYXMoc3RhcnRYUmVmKSkgewogICAgICAgICAgd2FybigicmVhZFhSZWYgLSBza2lwcGluZyBYUmVmIHRhYmxlIHNpbmNlIGl0IHdhcyBhbHJlYWR5IHBhcnNlZC4iKTsKICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUuc2hpZnQoKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBzdGFydFhSZWZQYXJzZWRDYWNoZS5hZGQoc3RhcnRYUmVmKTsKICAgICAgICBzdHJlYW0ucG9zID0gc3RhcnRYUmVmICsgc3RyZWFtLnN0YXJ0OwogICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBQYXJzZXIoewogICAgICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0pLAogICAgICAgICAgeHJlZjogdGhpcywKICAgICAgICAgIGFsbG93U3RyZWFtczogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGxldCBvYmogPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgbGV0IGRpY3Q7CiAgICAgICAgaWYgKGlzQ21kKG9iaiwgInhyZWYiKSkgewogICAgICAgICAgZGljdCA9IHRoaXMucHJvY2Vzc1hSZWZUYWJsZShwYXJzZXIpOwogICAgICAgICAgaWYgKCF0aGlzLnRvcERpY3QpIHsKICAgICAgICAgICAgdGhpcy50b3BEaWN0ID0gZGljdDsKICAgICAgICAgIH0KICAgICAgICAgIG9iaiA9IGRpY3QuZ2V0KCJYUmVmU3RtIik7CiAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihvYmopICYmICF0aGlzLl94cmVmU3Rtcy5oYXMob2JqKSkgewogICAgICAgICAgICB0aGlzLl94cmVmU3Rtcy5hZGQob2JqKTsKICAgICAgICAgICAgdGhpcy5zdGFydFhSZWZRdWV1ZS5wdXNoKG9iaik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihwYXJzZXIuZ2V0T2JqKCkpIHx8ICFpc0NtZChwYXJzZXIuZ2V0T2JqKCksICJvYmoiKSB8fCAhKChvYmogPSBwYXJzZXIuZ2V0T2JqKCkpIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgc3RyZWFtIik7CiAgICAgICAgICB9CiAgICAgICAgICBkaWN0ID0gdGhpcy5wcm9jZXNzWFJlZlN0cmVhbShvYmopOwogICAgICAgICAgaWYgKCF0aGlzLnRvcERpY3QpIHsKICAgICAgICAgICAgdGhpcy50b3BEaWN0ID0gZGljdDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghZGljdCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkZhaWxlZCB0byByZWFkIFhSZWYgc3RyZWFtIik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHN0cmVhbSBoZWFkZXIiKTsKICAgICAgICB9CiAgICAgICAgb2JqID0gZGljdC5nZXQoIlByZXYiKTsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihvYmopKSB7CiAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2gob2JqKTsKICAgICAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgdGhpcy5zdGFydFhSZWZRdWV1ZS5wdXNoKG9iai5udW0pOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChlIGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICAgIGluZm8oIih3aGlsZSByZWFkaW5nIFhSZWYpOiAiICsgZSk7CiAgICAgIH0KICAgICAgdGhpcy5zdGFydFhSZWZRdWV1ZS5zaGlmdCgpOwogICAgfQogICAgaWYgKHRoaXMudG9wRGljdCkgewogICAgICByZXR1cm4gdGhpcy50b3BEaWN0OwogICAgfQogICAgaWYgKHJlY292ZXJ5TW9kZSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgdGhyb3cgbmV3IFhSZWZQYXJzZUV4Y2VwdGlvbigpOwogIH0KICBnZXRFbnRyeShpKSB7CiAgICBjb25zdCB4cmVmRW50cnkgPSB0aGlzLmVudHJpZXNbaV07CiAgICBpZiAoeHJlZkVudHJ5ICYmICF4cmVmRW50cnkuZnJlZSAmJiB4cmVmRW50cnkub2Zmc2V0KSB7CiAgICAgIHJldHVybiB4cmVmRW50cnk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZmV0Y2hJZlJlZihvYmosIHN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlKSB7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHJldHVybiB0aGlzLmZldGNoKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogIGZldGNoKHJlZiwgc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2UpIHsKICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJyZWYgb2JqZWN0IGlzIG5vdCBhIHJlZmVyZW5jZSIpOwogICAgfQogICAgY29uc3QgbnVtID0gcmVmLm51bTsKICAgIGNvbnN0IGNhY2hlRW50cnkgPSB0aGlzLl9jYWNoZU1hcC5nZXQobnVtKTsKICAgIGlmIChjYWNoZUVudHJ5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKGNhY2hlRW50cnkgaW5zdGFuY2VvZiBEaWN0ICYmICFjYWNoZUVudHJ5Lm9iaklkKSB7CiAgICAgICAgY2FjaGVFbnRyeS5vYmpJZCA9IHJlZi50b1N0cmluZygpOwogICAgICB9CiAgICAgIHJldHVybiBjYWNoZUVudHJ5OwogICAgfQogICAgbGV0IHhyZWZFbnRyeSA9IHRoaXMuZ2V0RW50cnkobnVtKTsKICAgIGlmICh4cmVmRW50cnkgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHhyZWZFbnRyeTsKICAgIH0KICAgIGlmICh0aGlzLl9wZW5kaW5nUmVmcy5oYXMocmVmKSkgewogICAgICB0aGlzLl9wZW5kaW5nUmVmcy5yZW1vdmUocmVmKTsKICAgICAgd2FybihgSWdub3JpbmcgY2lyY3VsYXIgcmVmZXJlbmNlOiAke3JlZn0uYCk7CiAgICAgIHJldHVybiBDSVJDVUxBUl9SRUY7CiAgICB9CiAgICB0aGlzLl9wZW5kaW5nUmVmcy5wdXQocmVmKTsKICAgIHRyeSB7CiAgICAgIHhyZWZFbnRyeSA9IHhyZWZFbnRyeS51bmNvbXByZXNzZWQgPyB0aGlzLmZldGNoVW5jb21wcmVzc2VkKHJlZiwgeHJlZkVudHJ5LCBzdXBwcmVzc0VuY3J5cHRpb24pIDogdGhpcy5mZXRjaENvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgIHRoaXMuX3BlbmRpbmdSZWZzLnJlbW92ZShyZWYpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgdGhpcy5fcGVuZGluZ1JlZnMucmVtb3ZlKHJlZik7CiAgICAgIHRocm93IGV4OwogICAgfQogICAgaWYgKHhyZWZFbnRyeSBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgeHJlZkVudHJ5Lm9iaklkID0gcmVmLnRvU3RyaW5nKCk7CiAgICB9IGVsc2UgaWYgKHhyZWZFbnRyeSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgeHJlZkVudHJ5LmRpY3Qub2JqSWQgPSByZWYudG9TdHJpbmcoKTsKICAgIH0KICAgIHJldHVybiB4cmVmRW50cnk7CiAgfQogIGZldGNoVW5jb21wcmVzc2VkKHJlZiwgeHJlZkVudHJ5LCBzdXBwcmVzc0VuY3J5cHRpb24gPSBmYWxzZSkgewogICAgY29uc3QgZ2VuID0gcmVmLmdlbjsKICAgIGxldCBudW0gPSByZWYubnVtOwogICAgaWYgKHhyZWZFbnRyeS5nZW4gIT09IGdlbikgewogICAgICBjb25zdCBtc2cgPSBgSW5jb25zaXN0ZW50IGdlbmVyYXRpb24gaW4gWFJlZjogJHtyZWZ9YDsKICAgICAgaWYgKHRoaXMuX2dlbmVyYXRpb25GYWxsYmFjayAmJiB4cmVmRW50cnkuZ2VuIDwgZ2VuKSB7CiAgICAgICAgd2Fybihtc2cpOwogICAgICAgIHJldHVybiB0aGlzLmZldGNoVW5jb21wcmVzc2VkKFJlZi5nZXQobnVtLCB4cmVmRW50cnkuZ2VuKSwgeHJlZkVudHJ5LCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgICB9CiAgICAgIHRocm93IG5ldyBYUmVmRW50cnlFeGNlcHRpb24obXNnKTsKICAgIH0KICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtLm1ha2VTdWJTdHJlYW0oeHJlZkVudHJ5Lm9mZnNldCArIHRoaXMuc3RyZWFtLnN0YXJ0KTsKICAgIGNvbnN0IHBhcnNlciA9IG5ldyBQYXJzZXIoewogICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbSksCiAgICAgIHhyZWY6IHRoaXMsCiAgICAgIGFsbG93U3RyZWFtczogdHJ1ZQogICAgfSk7CiAgICBjb25zdCBvYmoxID0gcGFyc2VyLmdldE9iaigpOwogICAgY29uc3Qgb2JqMiA9IHBhcnNlci5nZXRPYmooKTsKICAgIGNvbnN0IG9iajMgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqMSAhPT0gbnVtIHx8IG9iajIgIT09IGdlbiB8fCAhKG9iajMgaW5zdGFuY2VvZiBDbWQpKSB7CiAgICAgIHRocm93IG5ldyBYUmVmRW50cnlFeGNlcHRpb24oYEJhZCAodW5jb21wcmVzc2VkKSBYUmVmIGVudHJ5OiAke3JlZn1gKTsKICAgIH0KICAgIGlmIChvYmozLmNtZCAhPT0gIm9iaiIpIHsKICAgICAgaWYgKG9iajMuY21kLnN0YXJ0c1dpdGgoIm9iaiIpKSB7CiAgICAgICAgbnVtID0gcGFyc2VJbnQob2JqMy5jbWQuc3Vic3RyaW5nKDMpLCAxMCk7CiAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4obnVtKSkgewogICAgICAgICAgcmV0dXJuIG51bTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IFhSZWZFbnRyeUV4Y2VwdGlvbihgQmFkICh1bmNvbXByZXNzZWQpIFhSZWYgZW50cnk6ICR7cmVmfWApOwogICAgfQogICAgeHJlZkVudHJ5ID0gdGhpcy5lbmNyeXB0ICYmICFzdXBwcmVzc0VuY3J5cHRpb24gPyBwYXJzZXIuZ2V0T2JqKHRoaXMuZW5jcnlwdC5jcmVhdGVDaXBoZXJUcmFuc2Zvcm0obnVtLCBnZW4pKSA6IHBhcnNlci5nZXRPYmooKTsKICAgIGlmICghKHhyZWZFbnRyeSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgIHRoaXMuX2NhY2hlTWFwLnNldChudW0sIHhyZWZFbnRyeSk7CiAgICB9CiAgICByZXR1cm4geHJlZkVudHJ5OwogIH0KICBmZXRjaENvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlKSB7CiAgICBjb25zdCB0YWJsZU9mZnNldCA9IHhyZWZFbnRyeS5vZmZzZXQ7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLmZldGNoKFJlZi5nZXQodGFibGVPZmZzZXQsIDApKTsKICAgIGlmICghKHN0cmVhbSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiYmFkIE9ialN0bSBzdHJlYW0iKTsKICAgIH0KICAgIGNvbnN0IGZpcnN0ID0gc3RyZWFtLmRpY3QuZ2V0KCJGaXJzdCIpOwogICAgY29uc3QgbiA9IHN0cmVhbS5kaWN0LmdldCgiTiIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoImludmFsaWQgZmlyc3QgYW5kIG4gcGFyYW1ldGVycyBmb3IgT2JqU3RtIHN0cmVhbSIpOwogICAgfQogICAgbGV0IHBhcnNlciA9IG5ldyBQYXJzZXIoewogICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbSksCiAgICAgIHhyZWY6IHRoaXMsCiAgICAgIGFsbG93U3RyZWFtczogdHJ1ZQogICAgfSk7CiAgICBjb25zdCBudW1zID0gbmV3IEFycmF5KG4pOwogICAgY29uc3Qgb2Zmc2V0cyA9IG5ldyBBcnJheShuKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGNvbnN0IG51bSA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG51bSkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYGludmFsaWQgb2JqZWN0IG51bWJlciBpbiB0aGUgT2JqU3RtIHN0cmVhbTogJHtudW19YCk7CiAgICAgIH0KICAgICAgY29uc3Qgb2Zmc2V0ID0gcGFyc2VyLmdldE9iaigpOwogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIob2Zmc2V0KSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgaW52YWxpZCBvYmplY3Qgb2Zmc2V0IGluIHRoZSBPYmpTdG0gc3RyZWFtOiAke29mZnNldH1gKTsKICAgICAgfQogICAgICBudW1zW2ldID0gbnVtOwogICAgICBjb25zdCBlbnRyeSA9IHRoaXMuZ2V0RW50cnkobnVtKTsKICAgICAgaWYgKGVudHJ5Py5vZmZzZXQgPT09IHRhYmxlT2Zmc2V0ICYmIGVudHJ5LmdlbiAhPT0gaSkgewogICAgICAgIGVudHJ5LmdlbiA9IGk7CiAgICAgIH0KICAgICAgb2Zmc2V0c1tpXSA9IG9mZnNldDsKICAgIH0KICAgIGNvbnN0IHN0YXJ0ID0gKHN0cmVhbS5zdGFydCB8fCAwKSArIGZpcnN0OwogICAgY29uc3QgZW50cmllcyA9IG5ldyBBcnJheShuKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IGkgPCBuIC0gMSA/IG9mZnNldHNbaSArIDFdIC0gb2Zmc2V0c1tpXSA6IHVuZGVmaW5lZDsKICAgICAgaWYgKGxlbmd0aCA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgb2Zmc2V0IGluIHRoZSBPYmpTdG0gc3RyZWFtLiIpOwogICAgICB9CiAgICAgIHBhcnNlciA9IG5ldyBQYXJzZXIoewogICAgICAgIGxleGVyOiBuZXcgTGV4ZXIoc3RyZWFtLm1ha2VTdWJTdHJlYW0oc3RhcnQgKyBvZmZzZXRzW2ldLCBsZW5ndGgsIHN0cmVhbS5kaWN0KSksCiAgICAgICAgeHJlZjogdGhpcywKICAgICAgICBhbGxvd1N0cmVhbXM6IHRydWUKICAgICAgfSk7CiAgICAgIGNvbnN0IG9iaiA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgZW50cmllc1tpXSA9IG9iajsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBudW0gPSBudW1zW2ldLAogICAgICAgIGVudHJ5ID0gdGhpcy5lbnRyaWVzW251bV07CiAgICAgIGlmIChlbnRyeSAmJiBlbnRyeS5vZmZzZXQgPT09IHRhYmxlT2Zmc2V0ICYmIGVudHJ5LmdlbiA9PT0gaSkgewogICAgICAgIHRoaXMuX2NhY2hlTWFwLnNldChudW0sIG9iaik7CiAgICAgIH0KICAgIH0KICAgIHhyZWZFbnRyeSA9IGVudHJpZXNbeHJlZkVudHJ5Lmdlbl07CiAgICBpZiAoeHJlZkVudHJ5ID09PSB1bmRlZmluZWQpIHsKICAgICAgdGhyb3cgbmV3IFhSZWZFbnRyeUV4Y2VwdGlvbihgQmFkIChjb21wcmVzc2VkKSBYUmVmIGVudHJ5OiAke3JlZn1gKTsKICAgIH0KICAgIHJldHVybiB4cmVmRW50cnk7CiAgfQogIGFzeW5jIGZldGNoSWZSZWZBc3luYyhvYmosIHN1cHByZXNzRW5jcnlwdGlvbikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICByZXR1cm4gdGhpcy5mZXRjaEFzeW5jKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogIGFzeW5jIGZldGNoQXN5bmMocmVmLCBzdXBwcmVzc0VuY3J5cHRpb24pIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiB0aGlzLmZldGNoKHJlZiwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmICghKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy5wZGZNYW5hZ2VyLnJlcXVlc3RSYW5nZShleC5iZWdpbiwgZXguZW5kKTsKICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hBc3luYyhyZWYsIHN1cHByZXNzRW5jcnlwdGlvbik7CiAgICB9CiAgfQogIGdldENhdGFsb2dPYmooKSB7CiAgICByZXR1cm4gdGhpcy5yb290OwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZG9jdW1lbnQuanMKCgoKCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBMRVRURVJfU0laRV9NRURJQUJPWCA9IFswLCAwLCA2MTIsIDc5Ml07CmNsYXNzIFBhZ2UgewogICNhcmVBbm5vdGF0aW9uc0NhY2hlZCA9IGZhbHNlOwogICNyZXNvdXJjZXNQcm9taXNlID0gbnVsbDsKICBjb25zdHJ1Y3Rvcih7CiAgICBwZGZNYW5hZ2VyLAogICAgeHJlZiwKICAgIHBhZ2VJbmRleCwKICAgIHBhZ2VEaWN0LAogICAgcmVmLAogICAgZ2xvYmFsSWRGYWN0b3J5LAogICAgZm9udENhY2hlLAogICAgYnVpbHRJbkNNYXBDYWNoZSwKICAgIHN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgIGdsb2JhbEltYWdlQ2FjaGUsCiAgICBzeXN0ZW1Gb250Q2FjaGUsCiAgICBub25CbGVuZE1vZGVzU2V0LAogICAgeGZhRmFjdG9yeQogIH0pIHsKICAgIHRoaXMucGRmTWFuYWdlciA9IHBkZk1hbmFnZXI7CiAgICB0aGlzLnBhZ2VJbmRleCA9IHBhZ2VJbmRleDsKICAgIHRoaXMucGFnZURpY3QgPSBwYWdlRGljdDsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLnJlZiA9IHJlZjsKICAgIHRoaXMuZm9udENhY2hlID0gZm9udENhY2hlOwogICAgdGhpcy5idWlsdEluQ01hcENhY2hlID0gYnVpbHRJbkNNYXBDYWNoZTsKICAgIHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlID0gc3RhbmRhcmRGb250RGF0YUNhY2hlOwogICAgdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGU7CiAgICB0aGlzLmdsb2JhbEltYWdlQ2FjaGUgPSBnbG9iYWxJbWFnZUNhY2hlOwogICAgdGhpcy5zeXN0ZW1Gb250Q2FjaGUgPSBzeXN0ZW1Gb250Q2FjaGU7CiAgICB0aGlzLm5vbkJsZW5kTW9kZXNTZXQgPSBub25CbGVuZE1vZGVzU2V0OwogICAgdGhpcy5ldmFsdWF0b3JPcHRpb25zID0gcGRmTWFuYWdlci5ldmFsdWF0b3JPcHRpb25zOwogICAgdGhpcy54ZmFGYWN0b3J5ID0geGZhRmFjdG9yeTsKICAgIGNvbnN0IGlkQ291bnRlcnMgPSB7CiAgICAgIG9iajogMAogICAgfTsKICAgIHRoaXMuX2xvY2FsSWRGYWN0b3J5ID0gY2xhc3MgZXh0ZW5kcyBnbG9iYWxJZEZhY3RvcnkgewogICAgICBzdGF0aWMgY3JlYXRlT2JqSWQoKSB7CiAgICAgICAgcmV0dXJuIGBwJHtwYWdlSW5kZXh9XyR7KytpZENvdW50ZXJzLm9ian1gOwogICAgICB9CiAgICAgIHN0YXRpYyBnZXRQYWdlT2JqSWQoKSB7CiAgICAgICAgcmV0dXJuIGBwJHtyZWYudG9TdHJpbmcoKX1gOwogICAgICB9CiAgICB9OwogIH0KICAjY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKSB7CiAgICByZXR1cm4gbmV3IFBhcnRpYWxFdmFsdWF0b3IoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGhhbmRsZXIsCiAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsCiAgICAgIGlkRmFjdG9yeTogdGhpcy5fbG9jYWxJZEZhY3RvcnksCiAgICAgIGZvbnRDYWNoZTogdGhpcy5mb250Q2FjaGUsCiAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IHRoaXMuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogdGhpcy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICBzeXN0ZW1Gb250Q2FjaGU6IHRoaXMuc3lzdGVtRm9udENhY2hlLAogICAgICBvcHRpb25zOiB0aGlzLmV2YWx1YXRvck9wdGlvbnMKICAgIH0pOwogIH0KICAjZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eShrZXksIGdldEFycmF5ID0gZmFsc2UpIHsKICAgIGNvbnN0IHZhbHVlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3Q6IHRoaXMucGFnZURpY3QsCiAgICAgIGtleSwKICAgICAgZ2V0QXJyYXksCiAgICAgIHN0b3BXaGVuRm91bmQ6IGZhbHNlCiAgICB9KTsKICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMSB8fCAhKHZhbHVlWzBdIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIHZhbHVlWzBdOwogICAgfQogICAgcmV0dXJuIERpY3QubWVyZ2UoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGRpY3RBcnJheTogdmFsdWUKICAgIH0pOwogIH0KICBnZXQgY29udGVudCgpIHsKICAgIHJldHVybiB0aGlzLnBhZ2VEaWN0LmdldEFycmF5KCJDb250ZW50cyIpOwogIH0KICBnZXQgcmVzb3VyY2VzKCkgewogICAgY29uc3QgcmVzb3VyY2VzID0gdGhpcy4jZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiUmVzb3VyY2VzIik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJyZXNvdXJjZXMiLCByZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0ID8gcmVzb3VyY2VzIDogRGljdC5lbXB0eSk7CiAgfQogICNnZXRCb3VuZGluZ0JveChuYW1lKSB7CiAgICBpZiAodGhpcy54ZmFEYXRhKSB7CiAgICAgIHJldHVybiB0aGlzLnhmYURhdGEuYmJveDsKICAgIH0KICAgIGNvbnN0IGJveCA9IGxvb2t1cE5vcm1hbFJlY3QodGhpcy4jZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eShuYW1lLCB0cnVlKSwgbnVsbCk7CiAgICBpZiAoYm94KSB7CiAgICAgIGlmIChib3hbMl0gLSBib3hbMF0gPiAwICYmIGJveFszXSAtIGJveFsxXSA+IDApIHsKICAgICAgICByZXR1cm4gYm94OwogICAgICB9CiAgICAgIHdhcm4oYEVtcHR5LCBvciBpbnZhbGlkLCAvJHtuYW1lfSBlbnRyeS5gKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBnZXQgbWVkaWFCb3goKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJtZWRpYUJveCIsIHRoaXMuI2dldEJvdW5kaW5nQm94KCJNZWRpYUJveCIpIHx8IExFVFRFUl9TSVpFX01FRElBQk9YKTsKICB9CiAgZ2V0IGNyb3BCb3goKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjcm9wQm94IiwgdGhpcy4jZ2V0Qm91bmRpbmdCb3goIkNyb3BCb3giKSB8fCB0aGlzLm1lZGlhQm94KTsKICB9CiAgZ2V0IHVzZXJVbml0KCkgewogICAgY29uc3Qgb2JqID0gdGhpcy5wYWdlRGljdC5nZXQoIlVzZXJVbml0Iik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ1c2VyVW5pdCIsIHR5cGVvZiBvYmogPT09ICJudW1iZXIiICYmIG9iaiA+IDAgPyBvYmogOiAxLjApOwogIH0KICBnZXQgdmlldygpIHsKICAgIGNvbnN0IHsKICAgICAgY3JvcEJveCwKICAgICAgbWVkaWFCb3gKICAgIH0gPSB0aGlzOwogICAgaWYgKGNyb3BCb3ggIT09IG1lZGlhQm94ICYmICFpc0FycmF5RXF1YWwoY3JvcEJveCwgbWVkaWFCb3gpKSB7CiAgICAgIGNvbnN0IGJveCA9IFV0aWwuaW50ZXJzZWN0KGNyb3BCb3gsIG1lZGlhQm94KTsKICAgICAgaWYgKGJveCAmJiBib3hbMl0gLSBib3hbMF0gPiAwICYmIGJveFszXSAtIGJveFsxXSA+IDApIHsKICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ2aWV3IiwgYm94KTsKICAgICAgfQogICAgICB3YXJuKCJFbXB0eSAvQ3JvcEJveCBhbmQgL01lZGlhQm94IGludGVyc2VjdGlvbi4iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInZpZXciLCBtZWRpYUJveCk7CiAgfQogIGdldCByb3RhdGUoKSB7CiAgICBsZXQgcm90YXRlID0gdGhpcy4jZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiUm90YXRlIikgfHwgMDsKICAgIGlmIChyb3RhdGUgJSA5MCAhPT0gMCkgewogICAgICByb3RhdGUgPSAwOwogICAgfSBlbHNlIGlmIChyb3RhdGUgPj0gMzYwKSB7CiAgICAgIHJvdGF0ZSAlPSAzNjA7CiAgICB9IGVsc2UgaWYgKHJvdGF0ZSA8IDApIHsKICAgICAgcm90YXRlID0gKHJvdGF0ZSAlIDM2MCArIDM2MCkgJSAzNjA7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJyb3RhdGUiLCByb3RhdGUpOwogIH0KICAjb25TdWJTdHJlYW1FcnJvcihyZWFzb24sIG9iaklkKSB7CiAgICBpZiAodGhpcy5ldmFsdWF0b3JPcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICB3YXJuKGBnZXRDb250ZW50U3RyZWFtIC0gaWdub3Jpbmcgc3ViLXN0cmVhbSAoJHtvYmpJZH0pOiAiJHtyZWFzb259Ii5gKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhyb3cgcmVhc29uOwogIH0KICBhc3luYyBnZXRDb250ZW50U3RyZWFtKCkgewogICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgImNvbnRlbnQiKTsKICAgIGlmIChjb250ZW50IGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICByZXR1cm4gY29udGVudDsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KGNvbnRlbnQpKSB7CiAgICAgIHJldHVybiBuZXcgU3RyZWFtc1NlcXVlbmNlU3RyZWFtKGNvbnRlbnQsIHRoaXMuI29uU3ViU3RyZWFtRXJyb3IuYmluZCh0aGlzKSk7CiAgICB9CiAgICByZXR1cm4gbmV3IE51bGxTdHJlYW0oKTsKICB9CiAgZ2V0IHhmYURhdGEoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ4ZmFEYXRhIiwgdGhpcy54ZmFGYWN0b3J5ID8gewogICAgICBiYm94OiB0aGlzLnhmYUZhY3RvcnkuZ2V0Qm91bmRpbmdCb3godGhpcy5wYWdlSW5kZXgpCiAgICB9IDogbnVsbCk7CiAgfQogIGFzeW5jICNyZXBsYWNlSWRCeVJlZihhbm5vdGF0aW9ucywgZGVsZXRlZEFubm90YXRpb25zLCBleGlzdGluZ0Fubm90YXRpb25zKSB7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmIChhbm5vdGF0aW9uLmlkKSB7CiAgICAgICAgY29uc3QgcmVmID0gUmVmLmZyb21TdHJpbmcoYW5ub3RhdGlvbi5pZCk7CiAgICAgICAgaWYgKCFyZWYpIHsKICAgICAgICAgIHdhcm4oYEEgbm9uLWxpbmtlZCBhbm5vdGF0aW9uIGNhbm5vdCBiZSBtb2RpZmllZDogJHthbm5vdGF0aW9uLmlkfWApOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChhbm5vdGF0aW9uLmRlbGV0ZWQpIHsKICAgICAgICAgIGRlbGV0ZWRBbm5vdGF0aW9ucy5wdXQocmVmLCByZWYpOwogICAgICAgICAgaWYgKGFubm90YXRpb24ucG9wdXBSZWYpIHsKICAgICAgICAgICAgY29uc3QgcG9wdXBSZWYgPSBSZWYuZnJvbVN0cmluZyhhbm5vdGF0aW9uLnBvcHVwUmVmKTsKICAgICAgICAgICAgaWYgKHBvcHVwUmVmKSB7CiAgICAgICAgICAgICAgZGVsZXRlZEFubm90YXRpb25zLnB1dChwb3B1cFJlZiwgcG9wdXBSZWYpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFubm90YXRpb24ucG9wdXA/LmRlbGV0ZWQpIHsKICAgICAgICAgIGNvbnN0IHBvcHVwUmVmID0gUmVmLmZyb21TdHJpbmcoYW5ub3RhdGlvbi5wb3B1cFJlZik7CiAgICAgICAgICBpZiAocG9wdXBSZWYpIHsKICAgICAgICAgICAgZGVsZXRlZEFubm90YXRpb25zLnB1dChwb3B1cFJlZiwgcG9wdXBSZWYpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBleGlzdGluZ0Fubm90YXRpb25zPy5wdXQocmVmKTsKICAgICAgICBhbm5vdGF0aW9uLnJlZiA9IHJlZjsKICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMueHJlZi5mZXRjaEFzeW5jKHJlZikudGhlbihvYmogPT4gewogICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgICAgYW5ub3RhdGlvbi5vbGRBbm5vdGF0aW9uID0gb2JqLmNsb25lKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgKCkgPT4gewogICAgICAgICAgd2FybihgQ2Fubm90IGZldGNoIFxgb2xkQW5ub3RhdGlvblxgIGZvcjogJHtyZWZ9LmApOwogICAgICAgIH0pKTsKICAgICAgICBkZWxldGUgYW5ub3RhdGlvbi5pZDsKICAgICAgfQogICAgfQogICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogIH0KICBhc3luYyBzYXZlTmV3QW5ub3RhdGlvbnMoaGFuZGxlciwgdGFzaywgYW5ub3RhdGlvbnMsIGltYWdlUHJvbWlzZXMsIGNoYW5nZXMpIHsKICAgIGlmICh0aGlzLnhmYUZhY3RvcnkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJYRkE6IENhbm5vdCBzYXZlIG5ldyBhbm5vdGF0aW9ucy4iKTsKICAgIH0KICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSB0aGlzLiNjcmVhdGVQYXJ0aWFsRXZhbHVhdG9yKGhhbmRsZXIpOwogICAgY29uc3QgZGVsZXRlZEFubm90YXRpb25zID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICBjb25zdCBleGlzdGluZ0Fubm90YXRpb25zID0gbmV3IFJlZlNldCgpOwogICAgYXdhaXQgdGhpcy4jcmVwbGFjZUlkQnlSZWYoYW5ub3RhdGlvbnMsIGRlbGV0ZWRBbm5vdGF0aW9ucywgZXhpc3RpbmdBbm5vdGF0aW9ucyk7CiAgICBjb25zdCBwYWdlRGljdCA9IHRoaXMucGFnZURpY3Q7CiAgICBjb25zdCBhbm5vdGF0aW9uc0FycmF5ID0gdGhpcy5hbm5vdGF0aW9ucy5maWx0ZXIoYSA9PiAhKGEgaW5zdGFuY2VvZiBSZWYgJiYgZGVsZXRlZEFubm90YXRpb25zLmhhcyhhKSkpOwogICAgY29uc3QgbmV3RGF0YSA9IGF3YWl0IEFubm90YXRpb25GYWN0b3J5LnNhdmVOZXdBbm5vdGF0aW9ucyhwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcywgY2hhbmdlcyk7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcmVmCiAgICB9IG9mIG5ld0RhdGEuYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFJlZiAmJiAhZXhpc3RpbmdBbm5vdGF0aW9ucy5oYXMocmVmKSkgewogICAgICAgIGFubm90YXRpb25zQXJyYXkucHVzaChyZWYpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBkaWN0ID0gcGFnZURpY3QuY2xvbmUoKTsKICAgIGRpY3Quc2V0KCJBbm5vdHMiLCBhbm5vdGF0aW9uc0FycmF5KTsKICAgIGNoYW5nZXMucHV0KHRoaXMucmVmLCB7CiAgICAgIGRhdGE6IGRpY3QKICAgIH0pOwogICAgZm9yIChjb25zdCBkZWxldGVkUmVmIG9mIGRlbGV0ZWRBbm5vdGF0aW9ucykgewogICAgICBjaGFuZ2VzLnB1dChkZWxldGVkUmVmLCB7CiAgICAgICAgZGF0YTogbnVsbAogICAgICB9KTsKICAgIH0KICB9CiAgYXN5bmMgc2F2ZShoYW5kbGVyLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcykgewogICAgY29uc3QgcGFydGlhbEV2YWx1YXRvciA9IHRoaXMuI2NyZWF0ZVBhcnRpYWxFdmFsdWF0b3IoaGFuZGxlcik7CiAgICBjb25zdCBhbm5vdGF0aW9ucyA9IGF3YWl0IHRoaXMuX3BhcnNlZEFubm90YXRpb25zOwogICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgIGZvciAoY29uc3QgYW5ub3RhdGlvbiBvZiBhbm5vdGF0aW9ucykgewogICAgICBwcm9taXNlcy5wdXNoKGFubm90YXRpb24uc2F2ZShwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcykuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIHdhcm4oInNhdmUgLSBpZ25vcmluZyBhbm5vdGF0aW9uIGRhdGEgZHVyaW5nICIgKyBgIiR7dGFzay5uYW1lfSIgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0pKTsKICAgIH0KICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgfQogIGFzeW5jIGxvYWRSZXNvdXJjZXMoa2V5cykgewogICAgYXdhaXQgKHRoaXMuI3Jlc291cmNlc1Byb21pc2UgPz89IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgInJlc291cmNlcyIpKTsKICAgIGF3YWl0IE9iamVjdExvYWRlci5sb2FkKHRoaXMucmVzb3VyY2VzLCBrZXlzLCB0aGlzLnhyZWYpOwogIH0KICBhc3luYyAjZ2V0TWVyZ2VkUmVzb3VyY2VzKHN0cmVhbURpY3QsIGtleXMpIHsKICAgIGNvbnN0IGxvY2FsUmVzb3VyY2VzID0gc3RyZWFtRGljdD8uZ2V0KCJSZXNvdXJjZXMiKTsKICAgIGlmICghKGxvY2FsUmVzb3VyY2VzIGluc3RhbmNlb2YgRGljdCAmJiBsb2NhbFJlc291cmNlcy5zaXplKSkgewogICAgICByZXR1cm4gdGhpcy5yZXNvdXJjZXM7CiAgICB9CiAgICBhd2FpdCBPYmplY3RMb2FkZXIubG9hZChsb2NhbFJlc291cmNlcywga2V5cywgdGhpcy54cmVmKTsKICAgIHJldHVybiBEaWN0Lm1lcmdlKHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBkaWN0QXJyYXk6IFtsb2NhbFJlc291cmNlcywgdGhpcy5yZXNvdXJjZXNdLAogICAgICBtZXJnZVN1YkRpY3RzOiB0cnVlCiAgICB9KTsKICB9CiAgYXN5bmMgZ2V0T3BlcmF0b3JMaXN0KHsKICAgIGhhbmRsZXIsCiAgICBzaW5rLAogICAgdGFzaywKICAgIGludGVudCwKICAgIGNhY2hlS2V5LAogICAgYW5ub3RhdGlvblN0b3JhZ2UgPSBudWxsLAogICAgbW9kaWZpZWRJZHMgPSBudWxsCiAgfSkgewogICAgY29uc3QgY29udGVudFN0cmVhbVByb21pc2UgPSB0aGlzLmdldENvbnRlbnRTdHJlYW0oKTsKICAgIGNvbnN0IHJlc291cmNlc1Byb21pc2UgPSB0aGlzLmxvYWRSZXNvdXJjZXMoUkVTT1VSQ0VTX0tFWVNfT1BFUkFUT1JfTElTVCk7CiAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgIGNvbnN0IG5ld0Fubm90c0J5UGFnZSA9ICF0aGlzLnhmYUZhY3RvcnkgPyBnZXROZXdBbm5vdGF0aW9uc01hcChhbm5vdGF0aW9uU3RvcmFnZSkgOiBudWxsOwogICAgY29uc3QgbmV3QW5ub3RzID0gbmV3QW5ub3RzQnlQYWdlPy5nZXQodGhpcy5wYWdlSW5kZXgpOwogICAgbGV0IG5ld0Fubm90YXRpb25zUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgIGxldCBkZWxldGVkQW5ub3RhdGlvbnMgPSBudWxsOwogICAgaWYgKG5ld0Fubm90cykgewogICAgICBjb25zdCBhbm5vdGF0aW9uR2xvYmFsc1Byb21pc2UgPSB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlRG9jKCJhbm5vdGF0aW9uR2xvYmFscyIpOwogICAgICBsZXQgaW1hZ2VQcm9taXNlczsKICAgICAgY29uc3QgbWlzc2luZ0JpdG1hcHMgPSBuZXcgU2V0KCk7CiAgICAgIGZvciAoY29uc3QgewogICAgICAgIGJpdG1hcElkLAogICAgICAgIGJpdG1hcAogICAgICB9IG9mIG5ld0Fubm90cykgewogICAgICAgIGlmIChiaXRtYXBJZCAmJiAhYml0bWFwICYmICFtaXNzaW5nQml0bWFwcy5oYXMoYml0bWFwSWQpKSB7CiAgICAgICAgICBtaXNzaW5nQml0bWFwcy5hZGQoYml0bWFwSWQpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQKICAgICAgfSA9IHRoaXMuZXZhbHVhdG9yT3B0aW9uczsKICAgICAgaWYgKG1pc3NpbmdCaXRtYXBzLnNpemUgPiAwKSB7CiAgICAgICAgY29uc3QgYW5ub3RhdGlvbldpdGhCaXRtYXBzID0gbmV3QW5ub3RzLnNsaWNlKCk7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCBhbm5vdGF0aW9uXSBvZiBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgICAgICAgaWYgKCFrZXkuc3RhcnRzV2l0aChBbm5vdGF0aW9uRWRpdG9yUHJlZml4KSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhbm5vdGF0aW9uLmJpdG1hcCAmJiBtaXNzaW5nQml0bWFwcy5oYXMoYW5ub3RhdGlvbi5iaXRtYXBJZCkpIHsKICAgICAgICAgICAgYW5ub3RhdGlvbldpdGhCaXRtYXBzLnB1c2goYW5ub3RhdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGltYWdlUHJvbWlzZXMgPSBBbm5vdGF0aW9uRmFjdG9yeS5nZW5lcmF0ZUltYWdlcyhhbm5vdGF0aW9uV2l0aEJpdG1hcHMsIHRoaXMueHJlZiwgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpOwogICAgICB9IGVsc2UgewogICAgICAgIGltYWdlUHJvbWlzZXMgPSBBbm5vdGF0aW9uRmFjdG9yeS5nZW5lcmF0ZUltYWdlcyhuZXdBbm5vdHMsIHRoaXMueHJlZiwgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpOwogICAgICB9CiAgICAgIGRlbGV0ZWRBbm5vdGF0aW9ucyA9IG5ldyBSZWZTZXQoKTsKICAgICAgbmV3QW5ub3RhdGlvbnNQcm9taXNlID0gUHJvbWlzZS5hbGwoW2Fubm90YXRpb25HbG9iYWxzUHJvbWlzZSwgdGhpcy4jcmVwbGFjZUlkQnlSZWYobmV3QW5ub3RzLCBkZWxldGVkQW5ub3RhdGlvbnMsIG51bGwpXSkudGhlbigoW2Fubm90YXRpb25HbG9iYWxzXSkgPT4gewogICAgICAgIGlmICghYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQW5ub3RhdGlvbkZhY3RvcnkucHJpbnROZXdBbm5vdGF0aW9ucyhhbm5vdGF0aW9uR2xvYmFscywgcGFydGlhbEV2YWx1YXRvciwgdGFzaywgbmV3QW5ub3RzLCBpbWFnZVByb21pc2VzKTsKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBwYWdlTGlzdFByb21pc2UgPSBQcm9taXNlLmFsbChbY29udGVudFN0cmVhbVByb21pc2UsIHJlc291cmNlc1Byb21pc2VdKS50aGVuKGFzeW5jIChbY29udGVudFN0cmVhbV0pID0+IHsKICAgICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgdGhpcy4jZ2V0TWVyZ2VkUmVzb3VyY2VzKGNvbnRlbnRTdHJlYW0uZGljdCwgUkVTT1VSQ0VTX0tFWVNfT1BFUkFUT1JfTElTVCk7CiAgICAgIGNvbnN0IG9wTGlzdCA9IG5ldyBPcGVyYXRvckxpc3QoaW50ZW50LCBzaW5rKTsKICAgICAgaGFuZGxlci5zZW5kKCJTdGFydFJlbmRlclBhZ2UiLCB7CiAgICAgICAgdHJhbnNwYXJlbmN5OiBwYXJ0aWFsRXZhbHVhdG9yLmhhc0JsZW5kTW9kZXMocmVzb3VyY2VzLCB0aGlzLm5vbkJsZW5kTW9kZXNTZXQpLAogICAgICAgIHBhZ2VJbmRleDogdGhpcy5wYWdlSW5kZXgsCiAgICAgICAgY2FjaGVLZXkKICAgICAgfSk7CiAgICAgIGF3YWl0IHBhcnRpYWxFdmFsdWF0b3IuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgICBzdHJlYW06IGNvbnRlbnRTdHJlYW0sCiAgICAgICAgdGFzaywKICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgb3BlcmF0b3JMaXN0OiBvcExpc3QKICAgICAgfSk7CiAgICAgIHJldHVybiBvcExpc3Q7CiAgICB9KTsKICAgIGxldCBbcGFnZU9wTGlzdCwgYW5ub3RhdGlvbnMsIG5ld0Fubm90YXRpb25zXSA9IGF3YWl0IFByb21pc2UuYWxsKFtwYWdlTGlzdFByb21pc2UsIHRoaXMuX3BhcnNlZEFubm90YXRpb25zLCBuZXdBbm5vdGF0aW9uc1Byb21pc2VdKTsKICAgIGlmIChuZXdBbm5vdGF0aW9ucykgewogICAgICBhbm5vdGF0aW9ucyA9IGFubm90YXRpb25zLmZpbHRlcihhID0+ICEoYS5yZWYgJiYgZGVsZXRlZEFubm90YXRpb25zLmhhcyhhLnJlZikpKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gbmV3QW5ub3RhdGlvbnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IG5ld0Fubm90YXRpb24gPSBuZXdBbm5vdGF0aW9uc1tpXTsKICAgICAgICBpZiAobmV3QW5ub3RhdGlvbi5yZWZUb1JlcGxhY2UpIHsKICAgICAgICAgIGNvbnN0IGogPSBhbm5vdGF0aW9ucy5maW5kSW5kZXgoYSA9PiBhLnJlZiAmJiBpc1JlZnNFcXVhbChhLnJlZiwgbmV3QW5ub3RhdGlvbi5yZWZUb1JlcGxhY2UpKTsKICAgICAgICAgIGlmIChqID49IDApIHsKICAgICAgICAgICAgYW5ub3RhdGlvbnMuc3BsaWNlKGosIDEsIG5ld0Fubm90YXRpb24pOwogICAgICAgICAgICBuZXdBbm5vdGF0aW9ucy5zcGxpY2UoaS0tLCAxKTsKICAgICAgICAgICAgaWktLTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgYW5ub3RhdGlvbnMgPSBhbm5vdGF0aW9ucy5jb25jYXQobmV3QW5ub3RhdGlvbnMpOwogICAgfQogICAgaWYgKGFubm90YXRpb25zLmxlbmd0aCA9PT0gMCB8fCBpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkFOTk9UQVRJT05TX0RJU0FCTEUpIHsKICAgICAgcGFnZU9wTGlzdC5mbHVzaCh0cnVlKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBsZW5ndGg6IHBhZ2VPcExpc3QudG90YWxMZW5ndGgKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IHJlbmRlckZvcm1zID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5BTk5PVEFUSU9OU19GT1JNUyksCiAgICAgIGlzRWRpdGluZyA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuSVNfRURJVElORyksCiAgICAgIGludGVudEFueSA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuQU5ZKSwKICAgICAgaW50ZW50RGlzcGxheSA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSksCiAgICAgIGludGVudFByaW50ID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5QUklOVCk7CiAgICBjb25zdCBvcExpc3RQcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmIChpbnRlbnRBbnkgfHwgaW50ZW50RGlzcGxheSAmJiBhbm5vdGF0aW9uLm11c3RCZVZpZXdlZChhbm5vdGF0aW9uU3RvcmFnZSwgcmVuZGVyRm9ybXMpICYmIGFubm90YXRpb24ubXVzdEJlVmlld2VkV2hlbkVkaXRpbmcoaXNFZGl0aW5nLCBtb2RpZmllZElkcykgfHwgaW50ZW50UHJpbnQgJiYgYW5ub3RhdGlvbi5tdXN0QmVQcmludGVkKGFubm90YXRpb25TdG9yYWdlKSkgewogICAgICAgIG9wTGlzdFByb21pc2VzLnB1c2goYW5ub3RhdGlvbi5nZXRPcGVyYXRvckxpc3QocGFydGlhbEV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgd2FybigiZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgYW5ub3RhdGlvbiBkYXRhIGR1cmluZyAiICsgYCIke3Rhc2submFtZX0iIHRhc2s6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb3BMaXN0OiBudWxsLAogICAgICAgICAgICBzZXBhcmF0ZUZvcm06IGZhbHNlLAogICAgICAgICAgICBzZXBhcmF0ZUNhbnZhczogZmFsc2UKICAgICAgICAgIH07CiAgICAgICAgfSkpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBvcExpc3RzID0gYXdhaXQgUHJvbWlzZS5hbGwob3BMaXN0UHJvbWlzZXMpOwogICAgbGV0IGZvcm0gPSBmYWxzZSwKICAgICAgY2FudmFzID0gZmFsc2U7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgb3BMaXN0LAogICAgICBzZXBhcmF0ZUZvcm0sCiAgICAgIHNlcGFyYXRlQ2FudmFzCiAgICB9IG9mIG9wTGlzdHMpIHsKICAgICAgcGFnZU9wTGlzdC5hZGRPcExpc3Qob3BMaXN0KTsKICAgICAgZm9ybSB8fD0gc2VwYXJhdGVGb3JtOwogICAgICBjYW52YXMgfHw9IHNlcGFyYXRlQ2FudmFzOwogICAgfQogICAgcGFnZU9wTGlzdC5mbHVzaCh0cnVlLCB7CiAgICAgIGZvcm0sCiAgICAgIGNhbnZhcwogICAgfSk7CiAgICByZXR1cm4gewogICAgICBsZW5ndGg6IHBhZ2VPcExpc3QudG90YWxMZW5ndGgKICAgIH07CiAgfQogIGFzeW5jIGV4dHJhY3RUZXh0Q29udGVudCh7CiAgICBoYW5kbGVyLAogICAgdGFzaywKICAgIGluY2x1ZGVNYXJrZWRDb250ZW50LAogICAgZGlzYWJsZU5vcm1hbGl6YXRpb24sCiAgICBzaW5rLAogICAgaW50ZXJzZWN0b3IgPSBudWxsCiAgfSkgewogICAgY29uc3QgY29udGVudFN0cmVhbVByb21pc2UgPSB0aGlzLmdldENvbnRlbnRTdHJlYW0oKTsKICAgIGNvbnN0IHJlc291cmNlc1Byb21pc2UgPSB0aGlzLmxvYWRSZXNvdXJjZXMoUkVTT1VSQ0VTX0tFWVNfVEVYVF9DT05URU5UKTsKICAgIGNvbnN0IGxhbmdQcm9taXNlID0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImxhbmciKTsKICAgIGNvbnN0IFtjb250ZW50U3RyZWFtLCwgbGFuZ10gPSBhd2FpdCBQcm9taXNlLmFsbChbY29udGVudFN0cmVhbVByb21pc2UsIHJlc291cmNlc1Byb21pc2UsIGxhbmdQcm9taXNlXSk7CiAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCB0aGlzLiNnZXRNZXJnZWRSZXNvdXJjZXMoY29udGVudFN0cmVhbS5kaWN0LCBSRVNPVVJDRVNfS0VZU19URVhUX0NPTlRFTlQpOwogICAgY29uc3QgcGFydGlhbEV2YWx1YXRvciA9IHRoaXMuI2NyZWF0ZVBhcnRpYWxFdmFsdWF0b3IoaGFuZGxlcik7CiAgICByZXR1cm4gcGFydGlhbEV2YWx1YXRvci5nZXRUZXh0Q29udGVudCh7CiAgICAgIHN0cmVhbTogY29udGVudFN0cmVhbSwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzLAogICAgICBpbmNsdWRlTWFya2VkQ29udGVudCwKICAgICAgZGlzYWJsZU5vcm1hbGl6YXRpb24sCiAgICAgIHNpbmssCiAgICAgIHZpZXdCb3g6IHRoaXMudmlldywKICAgICAgbGFuZywKICAgICAgaW50ZXJzZWN0b3IKICAgIH0pOwogIH0KICBhc3luYyBnZXRTdHJ1Y3RUcmVlKCkgewogICAgY29uc3Qgc3RydWN0VHJlZVJvb3QgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygic3RydWN0VHJlZVJvb3QiKTsKICAgIGlmICghc3RydWN0VHJlZVJvb3QpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBhd2FpdCB0aGlzLl9wYXJzZWRBbm5vdGF0aW9uczsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHN0cnVjdFRyZWUgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJfcGFyc2VTdHJ1Y3RUcmVlIiwgW3N0cnVjdFRyZWVSb290XSk7CiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlKHN0cnVjdFRyZWUsICJzZXJpYWxpemFibGUiKTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9IGNhdGNoIChleCkgewogICAgICB3YXJuKGBnZXRTdHJ1Y3RUcmVlOiAiJHtleH0iLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9CiAgX3BhcnNlU3RydWN0VHJlZShzdHJ1Y3RUcmVlUm9vdCkgewogICAgY29uc3QgdHJlZSA9IG5ldyBTdHJ1Y3RUcmVlUGFnZShzdHJ1Y3RUcmVlUm9vdCwgdGhpcy5wYWdlRGljdCk7CiAgICB0cmVlLnBhcnNlKHRoaXMucmVmKTsKICAgIHJldHVybiB0cmVlOwogIH0KICBhc3luYyBnZXRBbm5vdGF0aW9uc0RhdGEoaGFuZGxlciwgdGFzaywgaW50ZW50KSB7CiAgICBjb25zdCBhbm5vdGF0aW9ucyA9IGF3YWl0IHRoaXMuX3BhcnNlZEFubm90YXRpb25zOwogICAgaWYgKGFubm90YXRpb25zLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gYW5ub3RhdGlvbnM7CiAgICB9CiAgICBjb25zdCBhbm5vdGF0aW9uc0RhdGEgPSBbXSwKICAgICAgdGV4dENvbnRlbnRQcm9taXNlcyA9IFtdOwogICAgbGV0IHBhcnRpYWxFdmFsdWF0b3I7CiAgICBjb25zdCBpbnRlbnRBbnkgPSAhIShpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkFOWSksCiAgICAgIGludGVudERpc3BsYXkgPSAhIShpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkRJU1BMQVkpLAogICAgICBpbnRlbnRQcmludCA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuUFJJTlQpOwogICAgY29uc3QgaGlnaGxpZ2h0ZWRBbm5vdGF0aW9ucyA9IFtdOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGNvbnN0IGlzVmlzaWJsZSA9IGludGVudEFueSB8fCBpbnRlbnREaXNwbGF5ICYmIGFubm90YXRpb24udmlld2FibGU7CiAgICAgIGlmIChpc1Zpc2libGUgfHwgaW50ZW50UHJpbnQgJiYgYW5ub3RhdGlvbi5wcmludGFibGUpIHsKICAgICAgICBhbm5vdGF0aW9uc0RhdGEucHVzaChhbm5vdGF0aW9uLmRhdGEpOwogICAgICB9CiAgICAgIGlmIChhbm5vdGF0aW9uLmhhc1RleHRDb250ZW50ICYmIGlzVmlzaWJsZSkgewogICAgICAgIHBhcnRpYWxFdmFsdWF0b3IgPz89IHRoaXMuI2NyZWF0ZVBhcnRpYWxFdmFsdWF0b3IoaGFuZGxlcik7CiAgICAgICAgdGV4dENvbnRlbnRQcm9taXNlcy5wdXNoKGFubm90YXRpb24uZXh0cmFjdFRleHRDb250ZW50KHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIFstSW5maW5pdHksIC1JbmZpbml0eSwgSW5maW5pdHksIEluZmluaXR5XSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgd2FybihgZ2V0QW5ub3RhdGlvbnNEYXRhIC0gaWdub3JpbmcgdGV4dENvbnRlbnQgZHVyaW5nICIke3Rhc2submFtZX0iIHRhc2s6ICIke3JlYXNvbn0iLmApOwogICAgICAgIH0pKTsKICAgICAgfSBlbHNlIGlmIChhbm5vdGF0aW9uLm92ZXJsYXlzVGV4dENvbnRlbnQgJiYgaXNWaXNpYmxlKSB7CiAgICAgICAgaGlnaGxpZ2h0ZWRBbm5vdGF0aW9ucy5wdXNoKGFubm90YXRpb24pOwogICAgICB9CiAgICB9CiAgICBpZiAoaGlnaGxpZ2h0ZWRBbm5vdGF0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGludGVyc2VjdG9yID0gbmV3IEludGVyc2VjdG9yKGhpZ2hsaWdodGVkQW5ub3RhdGlvbnMpOwogICAgICB0ZXh0Q29udGVudFByb21pc2VzLnB1c2godGhpcy5leHRyYWN0VGV4dENvbnRlbnQoewogICAgICAgIGhhbmRsZXIsCiAgICAgICAgdGFzaywKICAgICAgICBpbmNsdWRlTWFya2VkQ29udGVudDogZmFsc2UsCiAgICAgICAgZGlzYWJsZU5vcm1hbGl6YXRpb246IGZhbHNlLAogICAgICAgIHNpbms6IG51bGwsCiAgICAgICAgdmlld0JveDogdGhpcy52aWV3LAogICAgICAgIGxhbmc6IG51bGwsCiAgICAgICAgaW50ZXJzZWN0b3IKICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgaW50ZXJzZWN0b3Iuc2V0VGV4dCgpOwogICAgICB9KSk7CiAgICB9CiAgICBhd2FpdCBQcm9taXNlLmFsbCh0ZXh0Q29udGVudFByb21pc2VzKTsKICAgIHJldHVybiBhbm5vdGF0aW9uc0RhdGE7CiAgfQogIGdldCBhbm5vdGF0aW9ucygpIHsKICAgIGNvbnN0IGFubm90cyA9IHRoaXMuI2dldEluaGVyaXRhYmxlUHJvcGVydHkoIkFubm90cyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYW5ub3RhdGlvbnMiLCBBcnJheS5pc0FycmF5KGFubm90cykgPyBhbm5vdHMgOiBbXSk7CiAgfQogIGdldCBfcGFyc2VkQW5ub3RhdGlvbnMoKSB7CiAgICBjb25zdCBwcm9taXNlID0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAiYW5ub3RhdGlvbnMiKS50aGVuKGFzeW5jIGFubm90cyA9PiB7CiAgICAgIGlmIChhbm5vdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGFubm90czsKICAgICAgfQogICAgICBjb25zdCBbYW5ub3RhdGlvbkdsb2JhbHMsIGZpZWxkT2JqZWN0c10gPSBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiYW5ub3RhdGlvbkdsb2JhbHMiKSwgdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiZmllbGRPYmplY3RzIildKTsKICAgICAgaWYgKCFhbm5vdGF0aW9uR2xvYmFscykgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgICBjb25zdCBvcnBoYW5GaWVsZHMgPSBmaWVsZE9iamVjdHM/Lm9ycGhhbkZpZWxkczsKICAgICAgY29uc3QgYW5ub3RhdGlvblByb21pc2VzID0gW107CiAgICAgIGZvciAoY29uc3QgYW5ub3RhdGlvblJlZiBvZiBhbm5vdHMpIHsKICAgICAgICBhbm5vdGF0aW9uUHJvbWlzZXMucHVzaChBbm5vdGF0aW9uRmFjdG9yeS5jcmVhdGUodGhpcy54cmVmLCBhbm5vdGF0aW9uUmVmLCBhbm5vdGF0aW9uR2xvYmFscywgdGhpcy5fbG9jYWxJZEZhY3RvcnksIGZhbHNlLCBvcnBoYW5GaWVsZHMsIG51bGwsIHRoaXMucmVmKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICB3YXJuKGBfcGFyc2VkQW5ub3RhdGlvbnM6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSkpOwogICAgICB9CiAgICAgIGNvbnN0IHNvcnRlZEFubm90YXRpb25zID0gW107CiAgICAgIGxldCBwb3B1cEFubm90YXRpb25zLCB3aWRnZXRBbm5vdGF0aW9uczsKICAgICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGF3YWl0IFByb21pc2UuYWxsKGFubm90YXRpb25Qcm9taXNlcykpIHsKICAgICAgICBpZiAoIWFubm90YXRpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYW5ub3RhdGlvbiBpbnN0YW5jZW9mIFdpZGdldEFubm90YXRpb24pIHsKICAgICAgICAgICh3aWRnZXRBbm5vdGF0aW9ucyB8fD0gW10pLnB1c2goYW5ub3RhdGlvbik7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFubm90YXRpb24gaW5zdGFuY2VvZiBQb3B1cEFubm90YXRpb24pIHsKICAgICAgICAgIChwb3B1cEFubm90YXRpb25zIHx8PSBbXSkucHVzaChhbm5vdGF0aW9uKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBzb3J0ZWRBbm5vdGF0aW9ucy5wdXNoKGFubm90YXRpb24pOwogICAgICB9CiAgICAgIGlmICh3aWRnZXRBbm5vdGF0aW9ucykgewogICAgICAgIHNvcnRlZEFubm90YXRpb25zLnB1c2goLi4ud2lkZ2V0QW5ub3RhdGlvbnMpOwogICAgICB9CiAgICAgIGlmIChwb3B1cEFubm90YXRpb25zKSB7CiAgICAgICAgc29ydGVkQW5ub3RhdGlvbnMucHVzaCguLi5wb3B1cEFubm90YXRpb25zKTsKICAgICAgfQogICAgICByZXR1cm4gc29ydGVkQW5ub3RhdGlvbnM7CiAgICB9KTsKICAgIHRoaXMuI2FyZUFubm90YXRpb25zQ2FjaGVkID0gdHJ1ZTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9wYXJzZWRBbm5vdGF0aW9ucyIsIHByb21pc2UpOwogIH0KICBnZXQganNBY3Rpb25zKCkgewogICAgY29uc3QgYWN0aW9ucyA9IGNvbGxlY3RBY3Rpb25zKHRoaXMueHJlZiwgdGhpcy5wYWdlRGljdCwgUGFnZUFjdGlvbkV2ZW50VHlwZSk7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJqc0FjdGlvbnMiLCBhY3Rpb25zKTsKICB9CiAgYXN5bmMgY29sbGVjdEFubm90YXRpb25zQnlUeXBlKGhhbmRsZXIsIHRhc2ssIHR5cGVzLCBwcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgIGNvbnN0IHsKICAgICAgcGFnZUluZGV4CiAgICB9ID0gdGhpczsKICAgIGlmICh0aGlzLiNhcmVBbm5vdGF0aW9uc0NhY2hlZCkgewogICAgICBjb25zdCBjYWNoZWRBbm5vdGF0aW9ucyA9IGF3YWl0IHRoaXMuX3BhcnNlZEFubm90YXRpb25zOwogICAgICBmb3IgKGNvbnN0IHsKICAgICAgICBkYXRhCiAgICAgIH0gb2YgY2FjaGVkQW5ub3RhdGlvbnMpIHsKICAgICAgICBpZiAoIXR5cGVzIHx8IHR5cGVzLmhhcyhkYXRhLmFubm90YXRpb25UeXBlKSkgewogICAgICAgICAgZGF0YS5wYWdlSW5kZXggPSBwYWdlSW5kZXg7CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFByb21pc2UucmVzb2x2ZShkYXRhKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFubm90cyA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgImFubm90YXRpb25zIik7CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb25SZWYgb2YgYW5ub3RzKSB7CiAgICAgIHByb21pc2VzLnB1c2goQW5ub3RhdGlvbkZhY3RvcnkuY3JlYXRlKHRoaXMueHJlZiwgYW5ub3RhdGlvblJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIHRoaXMuX2xvY2FsSWRGYWN0b3J5LCBmYWxzZSwgbnVsbCwgdHlwZXMsIHRoaXMucmVmKS50aGVuKGFzeW5jIGFubm90YXRpb24gPT4gewogICAgICAgIGlmICghYW5ub3RhdGlvbikgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGFubm90YXRpb24uZGF0YS5wYWdlSW5kZXggPSBwYWdlSW5kZXg7CiAgICAgICAgaWYgKGFubm90YXRpb24uaGFzVGV4dENvbnRlbnQgJiYgYW5ub3RhdGlvbi52aWV3YWJsZSkgewogICAgICAgICAgY29uc3QgcGFydGlhbEV2YWx1YXRvciA9IHRoaXMuI2NyZWF0ZVBhcnRpYWxFdmFsdWF0b3IoaGFuZGxlcik7CiAgICAgICAgICBhd2FpdCBhbm5vdGF0aW9uLmV4dHJhY3RUZXh0Q29udGVudChwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBbLUluZmluaXR5LCAtSW5maW5pdHksIEluZmluaXR5LCBJbmZpbml0eV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW5ub3RhdGlvbi5kYXRhOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgd2FybihgY29sbGVjdEFubm90YXRpb25zQnlUeXBlOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSkpOwogICAgfQogIH0KfQpjb25zdCBQREZfSEVBREVSX1NJR05BVFVSRSA9IG5ldyBVaW50OEFycmF5KFsweDI1LCAweDUwLCAweDQ0LCAweDQ2LCAweDJkXSk7CmNvbnN0IFNUQVJUWFJFRl9TSUdOQVRVUkUgPSBuZXcgVWludDhBcnJheShbMHg3MywgMHg3NCwgMHg2MSwgMHg3MiwgMHg3NCwgMHg3OCwgMHg3MiwgMHg2NSwgMHg2Nl0pOwpjb25zdCBFTkRPQkpfU0lHTkFUVVJFID0gbmV3IFVpbnQ4QXJyYXkoWzB4NjUsIDB4NmUsIDB4NjQsIDB4NmYsIDB4NjIsIDB4NmFdKTsKZnVuY3Rpb24gZmluZChzdHJlYW0sIHNpZ25hdHVyZSwgbGltaXQgPSAxMDI0LCBiYWNrd2FyZHMgPSBmYWxzZSkgewogIGNvbnN0IHNpZ25hdHVyZUxlbmd0aCA9IHNpZ25hdHVyZS5sZW5ndGg7CiAgY29uc3Qgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhsaW1pdCk7CiAgY29uc3Qgc2Nhbkxlbmd0aCA9IHNjYW5CeXRlcy5sZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CiAgaWYgKHNjYW5MZW5ndGggPD0gMCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoYmFja3dhcmRzKSB7CiAgICBjb25zdCBzaWduYXR1cmVFbmQgPSBzaWduYXR1cmVMZW5ndGggLSAxOwogICAgbGV0IHBvcyA9IHNjYW5CeXRlcy5sZW5ndGggLSAxOwogICAgd2hpbGUgKHBvcyA+PSBzaWduYXR1cmVFbmQpIHsKICAgICAgbGV0IGogPSAwOwogICAgICB3aGlsZSAoaiA8IHNpZ25hdHVyZUxlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zIC0gal0gPT09IHNpZ25hdHVyZVtzaWduYXR1cmVFbmQgLSBqXSkgewogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoaiA+PSBzaWduYXR1cmVMZW5ndGgpIHsKICAgICAgICBzdHJlYW0ucG9zICs9IHBvcyAtIHNpZ25hdHVyZUVuZDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBwb3MtLTsKICAgIH0KICB9IGVsc2UgewogICAgbGV0IHBvcyA9IDA7CiAgICB3aGlsZSAocG9zIDw9IHNjYW5MZW5ndGgpIHsKICAgICAgbGV0IGogPSAwOwogICAgICB3aGlsZSAoaiA8IHNpZ25hdHVyZUxlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zICsgal0gPT09IHNpZ25hdHVyZVtqXSkgewogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoaiA+PSBzaWduYXR1cmVMZW5ndGgpIHsKICAgICAgICBzdHJlYW0ucG9zICs9IHBvczsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBwb3MrKzsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9CmNsYXNzIFBERkRvY3VtZW50IHsKICAjcGFnZVByb21pc2VzID0gbmV3IE1hcCgpOwogICN2ZXJzaW9uID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwZGZNYW5hZ2VyLCBzdHJlYW0pIHsKICAgIGlmIChzdHJlYW0ubGVuZ3RoIDw9IDApIHsKICAgICAgdGhyb3cgbmV3IEludmFsaWRQREZFeGNlcHRpb24oIlRoZSBQREYgZmlsZSBpcyBlbXB0eSwgaS5lLiBpdHMgc2l6ZSBpcyB6ZXJvIGJ5dGVzLiIpOwogICAgfQogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy54cmVmID0gbmV3IFhSZWYoc3RyZWFtLCBwZGZNYW5hZ2VyKTsKICAgIGNvbnN0IGlkQ291bnRlcnMgPSB7CiAgICAgIGZvbnQ6IDAKICAgIH07CiAgICB0aGlzLl9nbG9iYWxJZEZhY3RvcnkgPSBjbGFzcyB7CiAgICAgIHN0YXRpYyBnZXREb2NJZCgpIHsKICAgICAgICByZXR1cm4gYGdfJHtwZGZNYW5hZ2VyLmRvY0lkfWA7CiAgICAgIH0KICAgICAgc3RhdGljIGNyZWF0ZUZvbnRJZCgpIHsKICAgICAgICByZXR1cm4gYGYkeysraWRDb3VudGVycy5mb250fWA7CiAgICAgIH0KICAgICAgc3RhdGljIGNyZWF0ZU9iaklkKCkgewogICAgICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYGNyZWF0ZU9iaklkYCBjYWxsZWQuIik7CiAgICAgIH0KICAgICAgc3RhdGljIGdldFBhZ2VPYmpJZCgpIHsKICAgICAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRQYWdlT2JqSWRgIGNhbGxlZC4iKTsKICAgICAgfQogICAgfTsKICB9CiAgcGFyc2UocmVjb3ZlcnlNb2RlKSB7CiAgICB0aGlzLnhyZWYucGFyc2UocmVjb3ZlcnlNb2RlKTsKICAgIHRoaXMuY2F0YWxvZyA9IG5ldyBDYXRhbG9nKHRoaXMucGRmTWFuYWdlciwgdGhpcy54cmVmKTsKICB9CiAgZ2V0IGxpbmVhcml6YXRpb24oKSB7CiAgICBsZXQgbGluZWFyaXphdGlvbiA9IG51bGw7CiAgICB0cnkgewogICAgICBsaW5lYXJpemF0aW9uID0gTGluZWFyaXphdGlvbi5jcmVhdGUodGhpcy5zdHJlYW0pOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGVycjsKICAgICAgfQogICAgICBpbmZvKGVycik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJsaW5lYXJpemF0aW9uIiwgbGluZWFyaXphdGlvbik7CiAgfQogIGdldCBzdGFydFhSZWYoKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgIGxldCBzdGFydFhSZWYgPSAwOwogICAgaWYgKHRoaXMubGluZWFyaXphdGlvbikgewogICAgICBzdHJlYW0ucmVzZXQoKTsKICAgICAgaWYgKGZpbmQoc3RyZWFtLCBFTkRPQkpfU0lHTkFUVVJFKSkgewogICAgICAgIHN0cmVhbS5za2lwKDYpOwogICAgICAgIGxldCBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgICAgIHdoaWxlIChpc1doaXRlU3BhY2UoY2gpKSB7CiAgICAgICAgICBzdHJlYW0ucG9zKys7CiAgICAgICAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgICAgIH0KICAgICAgICBzdGFydFhSZWYgPSBzdHJlYW0ucG9zIC0gc3RyZWFtLnN0YXJ0OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBzdGVwID0gMTAyNDsKICAgICAgY29uc3Qgc3RhcnRYUmVmTGVuZ3RoID0gU1RBUlRYUkVGX1NJR05BVFVSRS5sZW5ndGg7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlLAogICAgICAgIHBvcyA9IHN0cmVhbS5lbmQ7CiAgICAgIHdoaWxlICghZm91bmQgJiYgcG9zID4gMCkgewogICAgICAgIHBvcyAtPSBzdGVwIC0gc3RhcnRYUmVmTGVuZ3RoOwogICAgICAgIGlmIChwb3MgPCAwKSB7CiAgICAgICAgICBwb3MgPSAwOwogICAgICAgIH0KICAgICAgICBzdHJlYW0ucG9zID0gcG9zOwogICAgICAgIGZvdW5kID0gZmluZChzdHJlYW0sIFNUQVJUWFJFRl9TSUdOQVRVUkUsIHN0ZXAsIHRydWUpOwogICAgICB9CiAgICAgIGlmIChmb3VuZCkgewogICAgICAgIHN0cmVhbS5za2lwKDkpOwogICAgICAgIGxldCBjaDsKICAgICAgICBkbyB7CiAgICAgICAgICBjaCA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgfSB3aGlsZSAoaXNXaGl0ZVNwYWNlKGNoKSk7CiAgICAgICAgbGV0IHN0ciA9ICIiOwogICAgICAgIHdoaWxlIChjaCA+PSAweDIwICYmIGNoIDw9IDB4MzkpIHsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgICAgICAgIGNoID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICB9CiAgICAgICAgc3RhcnRYUmVmID0gcGFyc2VJbnQoc3RyLCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKHN0YXJ0WFJlZikpIHsKICAgICAgICAgIHN0YXJ0WFJlZiA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJzdGFydFhSZWYiLCBzdGFydFhSZWYpOwogIH0KICBjaGVja0hlYWRlcigpIHsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgc3RyZWFtLnJlc2V0KCk7CiAgICBpZiAoIWZpbmQoc3RyZWFtLCBQREZfSEVBREVSX1NJR05BVFVSRSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3RyZWFtLm1vdmVTdGFydCgpOwogICAgc3RyZWFtLnNraXAoUERGX0hFQURFUl9TSUdOQVRVUkUubGVuZ3RoKTsKICAgIGxldCB2ZXJzaW9uID0gIiIsCiAgICAgIGNoOwogICAgd2hpbGUgKChjaCA9IHN0cmVhbS5nZXRCeXRlKCkpID4gMHgyMCAmJiB2ZXJzaW9uLmxlbmd0aCA8IDcpIHsKICAgICAgdmVyc2lvbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgIH0KICAgIGlmIChQREZfVkVSU0lPTl9SRUdFWFAudGVzdCh2ZXJzaW9uKSkgewogICAgICB0aGlzLiN2ZXJzaW9uID0gdmVyc2lvbjsKICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oYEludmFsaWQgUERGIGhlYWRlciB2ZXJzaW9uOiAke3ZlcnNpb259YCk7CiAgICB9CiAgfQogIHBhcnNlU3RhcnRYUmVmKCkgewogICAgdGhpcy54cmVmLnNldFN0YXJ0WFJlZih0aGlzLnN0YXJ0WFJlZik7CiAgfQogIGdldCBudW1QYWdlcygpIHsKICAgIGxldCBudW0gPSAwOwogICAgaWYgKHRoaXMuY2F0YWxvZy5oYXNBY3R1YWxOdW1QYWdlcykgewogICAgICBudW0gPSB0aGlzLmNhdGFsb2cubnVtUGFnZXM7CiAgICB9IGVsc2UgaWYgKHRoaXMueGZhRmFjdG9yeSkgewogICAgICBudW0gPSB0aGlzLnhmYUZhY3RvcnkuZ2V0TnVtUGFnZXMoKTsKICAgIH0gZWxzZSBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgIG51bSA9IHRoaXMubGluZWFyaXphdGlvbi5udW1QYWdlczsKICAgIH0gZWxzZSB7CiAgICAgIG51bSA9IHRoaXMuY2F0YWxvZy5udW1QYWdlczsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgIm51bVBhZ2VzIiwgbnVtKTsKICB9CiAgI2hhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMoZmllbGRzLCByZWN1cnNpb25EZXB0aCA9IDApIHsKICAgIGNvbnN0IFJFQ1VSU0lPTl9MSU1JVCA9IDEwOwogICAgaWYgKCFBcnJheS5pc0FycmF5KGZpZWxkcykpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIGZpZWxkcy5ldmVyeShmaWVsZCA9PiB7CiAgICAgIGZpZWxkID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZmllbGQpOwogICAgICBpZiAoIShmaWVsZCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChmaWVsZC5oYXMoIktpZHMiKSkgewogICAgICAgIGlmICgrK3JlY3Vyc2lvbkRlcHRoID4gUkVDVVJTSU9OX0xJTUlUKSB7CiAgICAgICAgICB3YXJuKCIjaGFzT25seURvY3VtZW50U2lnbmF0dXJlczogbWF4aW11bSByZWN1cnNpb24gZGVwdGggcmVhY2hlZCIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy4jaGFzT25seURvY3VtZW50U2lnbmF0dXJlcyhmaWVsZC5nZXQoIktpZHMiKSwgcmVjdXJzaW9uRGVwdGgpOwogICAgICB9CiAgICAgIGNvbnN0IGlzU2lnbmF0dXJlID0gaXNOYW1lKGZpZWxkLmdldCgiRlQiKSwgIlNpZyIpOwogICAgICBjb25zdCByZWN0YW5nbGUgPSBmaWVsZC5nZXQoIlJlY3QiKTsKICAgICAgY29uc3QgaXNJbnZpc2libGUgPSBBcnJheS5pc0FycmF5KHJlY3RhbmdsZSkgJiYgcmVjdGFuZ2xlLmV2ZXJ5KHZhbHVlID0+IHZhbHVlID09PSAwKTsKICAgICAgcmV0dXJuIGlzU2lnbmF0dXJlICYmIGlzSW52aXNpYmxlOwogICAgfSk7CiAgfQogICNjb2xsZWN0U2lnbmF0dXJlQ2VydGlmaWNhdGVzKGZpZWxkcywgY29sbGVjdGVkU2lnbmF0dXJlQ2VydGlmaWNhdGVzLCB2aXNpdGVkID0gbmV3IFJlZlNldCgpKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZmllbGRzKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBmaWVsZCBvZiBmaWVsZHMpIHsKICAgICAgaWYgKGZpZWxkIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaWYgKHZpc2l0ZWQuaGFzKGZpZWxkKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZpc2l0ZWQucHV0KGZpZWxkKTsKICAgICAgfQogICAgICBmaWVsZCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZpZWxkKTsKICAgICAgaWYgKCEoZmllbGQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChmaWVsZC5oYXMoIktpZHMiKSkgewogICAgICAgIHRoaXMuI2NvbGxlY3RTaWduYXR1cmVDZXJ0aWZpY2F0ZXMoZmllbGQuZ2V0KCJLaWRzIiksIGNvbGxlY3RlZFNpZ25hdHVyZUNlcnRpZmljYXRlcywgdmlzaXRlZCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaXNTaWduYXR1cmUgPSBpc05hbWUoZmllbGQuZ2V0KCJGVCIpLCAiU2lnIik7CiAgICAgIGlmICghaXNTaWduYXR1cmUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IGZpZWxkLmdldCgiViIpOwogICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViRmlsdGVyID0gdmFsdWUuZ2V0KCJTdWJGaWx0ZXIiKTsKICAgICAgaWYgKCEoc3ViRmlsdGVyIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb2xsZWN0ZWRTaWduYXR1cmVDZXJ0aWZpY2F0ZXMuYWRkKHN1YkZpbHRlci5uYW1lKTsKICAgIH0KICB9CiAgZ2V0IF94ZmFTdHJlYW1zKCkgewogICAgY29uc3QgewogICAgICBhY3JvRm9ybQogICAgfSA9IHRoaXMuY2F0YWxvZzsKICAgIGlmICghYWNyb0Zvcm0pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCB4ZmEgPSBhY3JvRm9ybS5nZXQoIlhGQSIpOwogICAgY29uc3QgZW50cmllcyA9IG5ldyBNYXAoWyJ4ZHA6eGRwIiwgInRlbXBsYXRlIiwgImRhdGFzZXRzIiwgImNvbmZpZyIsICJjb25uZWN0aW9uU2V0IiwgImxvY2FsZVNldCIsICJzdHlsZXNoZWV0IiwgIi94ZHA6eGRwIl0ubWFwKGUgPT4gW2UsIG51bGxdKSk7CiAgICBpZiAoeGZhIGluc3RhbmNlb2YgQmFzZVN0cmVhbSAmJiAheGZhLmlzRW1wdHkpIHsKICAgICAgZW50cmllcy5zZXQoInhkcDp4ZHAiLCB4ZmEpOwogICAgICByZXR1cm4gZW50cmllczsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheSh4ZmEpIHx8IHhmYS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB4ZmEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICBsZXQgbmFtZTsKICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICBuYW1lID0gInhkcDp4ZHAiOwogICAgICB9IGVsc2UgaWYgKGkgPT09IGlpIC0gMikgewogICAgICAgIG5hbWUgPSAiL3hkcDp4ZHAiOwogICAgICB9IGVsc2UgewogICAgICAgIG5hbWUgPSB4ZmFbaV07CiAgICAgIH0KICAgICAgaWYgKCFlbnRyaWVzLmhhcyhuYW1lKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZih4ZmFbaSArIDFdKTsKICAgICAgaWYgKCEoZGF0YSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHx8IGRhdGEuaXNFbXB0eSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGVudHJpZXMuc2V0KG5hbWUsIGRhdGEpOwogICAgfQogICAgcmV0dXJuIGVudHJpZXM7CiAgfQogIGdldCB4ZmFEYXRhc2V0cygpIHsKICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLl94ZmFTdHJlYW1zOwogICAgaWYgKCFzdHJlYW1zKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGFzZXRzIiwgbnVsbCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBvZiBbImRhdGFzZXRzIiwgInhkcDp4ZHAiXSkgewogICAgICBjb25zdCBzdHJlYW0gPSBzdHJlYW1zLmdldChrZXkpOwogICAgICBpZiAoIXN0cmVhbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc3RyID0gc3RyaW5nVG9VVEY4U3RyaW5nKHN0cmVhbS5nZXRTdHJpbmcoKSk7CiAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgIFtrZXldOiBzdHIKICAgICAgICB9OwogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGFzZXRzIiwgbmV3IERhdGFzZXRSZWFkZXIoZGF0YSkpOwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKCJYRkEgLSBJbnZhbGlkIHV0Zi04IHN0cmluZy4iKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAieGZhRGF0YXNldHMiLCBudWxsKTsKICB9CiAgZ2V0IHhmYURhdGEoKSB7CiAgICBjb25zdCBzdHJlYW1zID0gdGhpcy5feGZhU3RyZWFtczsKICAgIGlmICghc3RyZWFtcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBba2V5LCBzdHJlYW1dIG9mIHN0cmVhbXMpIHsKICAgICAgaWYgKCFzdHJlYW0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGRhdGFba2V5XSA9IHN0cmluZ1RvVVRGOFN0cmluZyhzdHJlYW0uZ2V0U3RyaW5nKCkpOwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKCJYRkEgLSBJbnZhbGlkIHV0Zi04IHN0cmluZy4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCB4ZmFGYWN0b3J5KCkgewogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5wZGZNYW5hZ2VyLmVuYWJsZVhmYSAmJiB0aGlzLmNhdGFsb2cubmVlZHNSZW5kZXJpbmcgJiYgdGhpcy5mb3JtSW5mby5oYXNYZmEgJiYgIXRoaXMuZm9ybUluZm8uaGFzQWNyb0Zvcm0pIHsKICAgICAgZGF0YSA9IHRoaXMueGZhRGF0YTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYUZhY3RvcnkiLCBkYXRhID8gbmV3IFhGQUZhY3RvcnkoZGF0YSkgOiBudWxsKTsKICB9CiAgZ2V0IGlzUHVyZVhmYSgpIHsKICAgIHJldHVybiB0aGlzLnhmYUZhY3RvcnkgPyB0aGlzLnhmYUZhY3RvcnkuaXNWYWxpZCgpIDogZmFsc2U7CiAgfQogIGdldCBodG1sRm9yWGZhKCkgewogICAgcmV0dXJuIHRoaXMueGZhRmFjdG9yeSA/IHRoaXMueGZhRmFjdG9yeS5nZXRQYWdlcygpIDogbnVsbDsKICB9CiAgYXN5bmMgI2xvYWRYZmFJbWFnZXMoKSB7CiAgICBjb25zdCB4ZmFJbWFnZXMgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygieGZhSW1hZ2VzIik7CiAgICBpZiAoIXhmYUltYWdlcykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnhmYUZhY3Rvcnkuc2V0SW1hZ2VzKHhmYUltYWdlcyk7CiAgfQogIGFzeW5jICNsb2FkWGZhRm9udHMoaGFuZGxlciwgdGFzaykgewogICAgY29uc3QgYWNyb0Zvcm0gPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYWNyb0Zvcm0iKTsKICAgIGlmICghYWNyb0Zvcm0pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgYWNyb0Zvcm0uZ2V0QXN5bmMoIkRSIik7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBhd2FpdCBPYmplY3RMb2FkZXIubG9hZChyZXNvdXJjZXMsIFsiRm9udCJdLCB0aGlzLnhyZWYpOwogICAgY29uc3QgZm9udFJlcyA9IHJlc291cmNlcy5nZXQoIkZvbnQiKTsKICAgIGlmICghKGZvbnRSZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKG51bGwpLCB0aGlzLnBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucywgewogICAgICB1c2VTeXN0ZW1Gb250czogZmFsc2UKICAgIH0pOwogICAgY29uc3QgewogICAgICBidWlsdEluQ01hcENhY2hlLAogICAgICBmb250Q2FjaGUsCiAgICAgIHN0YW5kYXJkRm9udERhdGFDYWNoZQogICAgfSA9IHRoaXMuY2F0YWxvZzsKICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSBuZXcgUGFydGlhbEV2YWx1YXRvcih7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaGFuZGxlciwKICAgICAgcGFnZUluZGV4OiAtMSwKICAgICAgaWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgIGZvbnRDYWNoZSwKICAgICAgYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBvcHRpb25zCiAgICB9KTsKICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IG5ldyBPcGVyYXRvckxpc3QoKTsKICAgIGNvbnN0IHBkZkZvbnRzID0gW107CiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7CiAgICAgIGdldCBmb250KCkgewogICAgICAgIHJldHVybiBwZGZGb250cy5hdCgtMSk7CiAgICAgIH0sCiAgICAgIHNldCBmb250KGZvbnQpIHsKICAgICAgICBwZGZGb250cy5wdXNoKGZvbnQpOwogICAgICB9LAogICAgICBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHBhcnNlRm9udCA9IChmb250TmFtZSwgZmFsbGJhY2tGb250RGljdCwgY3NzRm9udEluZm8pID0+IHBhcnRpYWxFdmFsdWF0b3IuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIFtOYW1lLmdldChmb250TmFtZSksIDFdLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgZmFsbGJhY2tGb250RGljdCwgY3NzRm9udEluZm8pLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgIHdhcm4oYGxvYWRYZmFGb250czogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfSk7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBbZm9udE5hbWUsIGZvbnRdIG9mIGZvbnRSZXMpIHsKICAgICAgY29uc3QgZGVzY3JpcHRvciA9IGZvbnQuZ2V0KCJGb250RGVzY3JpcHRvciIpOwogICAgICBpZiAoIShkZXNjcmlwdG9yIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgZm9udEZhbWlseSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250RmFtaWx5Iik7CiAgICAgIGZvbnRGYW1pbHkgPSBmb250RmFtaWx5LnJlcGxhY2VBbGwoL1sgXSsoXGQpL2csICIkMSIpOwogICAgICBjb25zdCBmb250V2VpZ2h0ID0gZGVzY3JpcHRvci5nZXQoIkZvbnRXZWlnaHQiKTsKICAgICAgY29uc3QgaXRhbGljQW5nbGUgPSAtZGVzY3JpcHRvci5nZXQoIkl0YWxpY0FuZ2xlIik7CiAgICAgIGNvbnN0IGNzc0ZvbnRJbmZvID0gewogICAgICAgIGZvbnRGYW1pbHksCiAgICAgICAgZm9udFdlaWdodCwKICAgICAgICBpdGFsaWNBbmdsZQogICAgICB9OwogICAgICBpZiAoIXZhbGlkYXRlQ1NTRm9udChjc3NGb250SW5mbykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcm9taXNlcy5wdXNoKHBhcnNlRm9udChmb250TmFtZSwgbnVsbCwgY3NzRm9udEluZm8pKTsKICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsKICAgIGNvbnN0IG1pc3NpbmdGb250cyA9IHRoaXMueGZhRmFjdG9yeS5zZXRGb250cyhwZGZGb250cyk7CiAgICBpZiAoIW1pc3NpbmdGb250cykgewogICAgICByZXR1cm47CiAgICB9CiAgICBvcHRpb25zLmlnbm9yZUVycm9ycyA9IHRydWU7CiAgICBwcm9taXNlcy5sZW5ndGggPSAwOwogICAgcGRmRm9udHMubGVuZ3RoID0gMDsKICAgIGNvbnN0IHJlYWxseU1pc3NpbmdGb250cyA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgbWlzc2luZyBvZiBtaXNzaW5nRm9udHMpIHsKICAgICAgaWYgKCFnZXRYZmFGb250TmFtZShgJHttaXNzaW5nfS1SZWd1bGFyYCkpIHsKICAgICAgICByZWFsbHlNaXNzaW5nRm9udHMuYWRkKG1pc3NpbmcpOwogICAgICB9CiAgICB9CiAgICBpZiAocmVhbGx5TWlzc2luZ0ZvbnRzLnNpemUpIHsKICAgICAgbWlzc2luZ0ZvbnRzLnB1c2goIlBkZkpTLUZhbGxiYWNrIik7CiAgICB9CiAgICBmb3IgKGNvbnN0IG1pc3Npbmcgb2YgbWlzc2luZ0ZvbnRzKSB7CiAgICAgIGlmIChyZWFsbHlNaXNzaW5nRm9udHMuaGFzKG1pc3NpbmcpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBmb250SW5mbyBvZiBbewogICAgICAgIG5hbWU6ICJSZWd1bGFyIiwKICAgICAgICBmb250V2VpZ2h0OiA0MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDAKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJCb2xkIiwKICAgICAgICBmb250V2VpZ2h0OiA3MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDAKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJJdGFsaWMiLAogICAgICAgIGZvbnRXZWlnaHQ6IDQwMCwKICAgICAgICBpdGFsaWNBbmdsZTogMTIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJCb2xkSXRhbGljIiwKICAgICAgICBmb250V2VpZ2h0OiA3MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDEyCiAgICAgIH1dKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGAke21pc3Npbmd9LSR7Zm9udEluZm8ubmFtZX1gOwogICAgICAgIHByb21pc2VzLnB1c2gocGFyc2VGb250KG5hbWUsIGdldFhmYUZvbnREaWN0KG5hbWUpLCB7CiAgICAgICAgICBmb250RmFtaWx5OiBtaXNzaW5nLAogICAgICAgICAgZm9udFdlaWdodDogZm9udEluZm8uZm9udFdlaWdodCwKICAgICAgICAgIGl0YWxpY0FuZ2xlOiBmb250SW5mby5pdGFsaWNBbmdsZQogICAgICAgIH0pKTsKICAgICAgfQogICAgfQogICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgdGhpcy54ZmFGYWN0b3J5LmFwcGVuZEZvbnRzKHBkZkZvbnRzLCByZWFsbHlNaXNzaW5nRm9udHMpOwogIH0KICBsb2FkWGZhUmVzb3VyY2VzKGhhbmRsZXIsIHRhc2spIHsKICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy4jbG9hZFhmYUZvbnRzKGhhbmRsZXIsIHRhc2spLmNhdGNoKCgpID0+IHt9KSwgdGhpcy4jbG9hZFhmYUltYWdlcygpXSk7CiAgfQogIHNlcmlhbGl6ZVhmYURhdGEoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIHJldHVybiB0aGlzLnhmYUZhY3RvcnkgPyB0aGlzLnhmYUZhY3Rvcnkuc2VyaWFsaXplRGF0YShhbm5vdGF0aW9uU3RvcmFnZSkgOiBudWxsOwogIH0KICBnZXQgdmVyc2lvbigpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cudmVyc2lvbiB8fCB0aGlzLiN2ZXJzaW9uOwogIH0KICBnZXQgZm9ybUluZm8oKSB7CiAgICBjb25zdCBmb3JtSW5mbyA9IHsKICAgICAgaGFzRmllbGRzOiBmYWxzZSwKICAgICAgaGFzQWNyb0Zvcm06IGZhbHNlLAogICAgICBoYXNYZmE6IGZhbHNlLAogICAgICBoYXNTaWduYXR1cmVzOiBmYWxzZQogICAgfTsKICAgIGNvbnN0IHsKICAgICAgYWNyb0Zvcm0KICAgIH0gPSB0aGlzLmNhdGFsb2c7CiAgICBpZiAoIWFjcm9Gb3JtKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgImZvcm1JbmZvIiwgZm9ybUluZm8pOwogICAgfQogICAgdHJ5IHsKICAgICAgY29uc3QgZmllbGRzID0gYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKTsKICAgICAgY29uc3QgaGFzRmllbGRzID0gQXJyYXkuaXNBcnJheShmaWVsZHMpICYmIGZpZWxkcy5sZW5ndGggPiAwOwogICAgICBmb3JtSW5mby5oYXNGaWVsZHMgPSBoYXNGaWVsZHM7CiAgICAgIGNvbnN0IHhmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIik7CiAgICAgIGZvcm1JbmZvLmhhc1hmYSA9IEFycmF5LmlzQXJyYXkoeGZhKSAmJiB4ZmEubGVuZ3RoID4gMCB8fCB4ZmEgaW5zdGFuY2VvZiBCYXNlU3RyZWFtICYmICF4ZmEuaXNFbXB0eTsKICAgICAgY29uc3Qgc2lnRmxhZ3MgPSBhY3JvRm9ybS5nZXQoIlNpZ0ZsYWdzIik7CiAgICAgIGNvbnN0IGhhc1NpZ25hdHVyZXMgPSAhIShzaWdGbGFncyAmIDB4MSk7CiAgICAgIGNvbnN0IGhhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMgPSBoYXNTaWduYXR1cmVzICYmIHRoaXMuI2hhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMoZmllbGRzKTsKICAgICAgZm9ybUluZm8uaGFzQWNyb0Zvcm0gPSBoYXNGaWVsZHMgJiYgIWhhc09ubHlEb2N1bWVudFNpZ25hdHVyZXM7CiAgICAgIGZvcm1JbmZvLmhhc1NpZ25hdHVyZXMgPSBoYXNTaWduYXR1cmVzOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGBDYW5ub3QgZmV0Y2ggZm9ybSBpbmZvcm1hdGlvbjogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImZvcm1JbmZvIiwgZm9ybUluZm8pOwogIH0KICBnZXQgZG9jdW1lbnRJbmZvKCkgewogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBmb3JtSW5mbywKICAgICAgeHJlZgogICAgfSA9IHRoaXM7CiAgICBjb25zdCBkb2NJbmZvID0gewogICAgICBQREZGb3JtYXRWZXJzaW9uOiB0aGlzLnZlcnNpb24sCiAgICAgIExhbmd1YWdlOiBjYXRhbG9nLmxhbmcsCiAgICAgIEVuY3J5cHRGaWx0ZXJOYW1lOiB4cmVmLmVuY3J5cHQ/LmZpbHRlck5hbWUgPz8gbnVsbCwKICAgICAgSXNMaW5lYXJpemVkOiAhIXRoaXMubGluZWFyaXphdGlvbiwKICAgICAgSXNBY3JvRm9ybVByZXNlbnQ6IGZvcm1JbmZvLmhhc0Fjcm9Gb3JtLAogICAgICBJc1hGQVByZXNlbnQ6IGZvcm1JbmZvLmhhc1hmYSwKICAgICAgSXNDb2xsZWN0aW9uUHJlc2VudDogISFjYXRhbG9nLmNvbGxlY3Rpb24sCiAgICAgIElzU2lnbmF0dXJlc1ByZXNlbnQ6IGZvcm1JbmZvLmhhc1NpZ25hdHVyZXMKICAgIH07CiAgICBsZXQgaW5mb0RpY3Q7CiAgICB0cnkgewogICAgICBpbmZvRGljdCA9IHhyZWYudHJhaWxlci5nZXQoIkluZm8iKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBpZiAoZXJyIGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBlcnI7CiAgICAgIH0KICAgICAgaW5mbygiVGhlIGRvY3VtZW50IGluZm9ybWF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC4iKTsKICAgIH0KICAgIGlmICghKGluZm9EaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZG9jdW1lbnRJbmZvIiwgZG9jSW5mbyk7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBpbmZvRGljdCkgewogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgIlRpdGxlIjoKICAgICAgICBjYXNlICJBdXRob3IiOgogICAgICAgIGNhc2UgIlN1YmplY3QiOgogICAgICAgIGNhc2UgIktleXdvcmRzIjoKICAgICAgICBjYXNlICJDcmVhdG9yIjoKICAgICAgICBjYXNlICJQcm9kdWNlciI6CiAgICAgICAgY2FzZSAiQ3JlYXRpb25EYXRlIjoKICAgICAgICBjYXNlICJNb2REYXRlIjoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGRvY0luZm9ba2V5XSA9IHN0cmluZ1RvUERGU3RyaW5nKHZhbHVlKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUcmFwcGVkIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgZG9jSW5mb1trZXldID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGxldCBjdXN0b21WYWx1ZTsKICAgICAgICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7CiAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSBzdHJpbmdUb1BERlN0cmluZyh2YWx1ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgIGN1c3RvbVZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY3VzdG9tVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB3YXJuKGBCYWQgdmFsdWUsIGZvciBjdXN0b20ga2V5ICIke2tleX0iLCBpbiBJbmZvOiAke3ZhbHVlfS5gKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBkb2NJbmZvLkN1c3RvbSA/Pz0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGRvY0luZm8uQ3VzdG9tW2tleV0gPSBjdXN0b21WYWx1ZTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHdhcm4oYEJhZCB2YWx1ZSwgZm9yIGtleSAiJHtrZXl9IiwgaW4gSW5mbzogJHt2YWx1ZX0uYCk7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkb2N1bWVudEluZm8iLCBkb2NJbmZvKTsKICB9CiAgZ2V0IGZpbmdlcnByaW50cygpIHsKICAgIGNvbnN0IEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTID0gMTAyNDsKICAgIGNvbnN0IEVNUFRZX0ZJTkdFUlBSSU5UID0gIlx4MDAiLnJlcGVhdCgxNik7CiAgICBmdW5jdGlvbiB2YWxpZGF0ZShkYXRhKSB7CiAgICAgIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgJiYgZGF0YS5sZW5ndGggPT09IDE2ICYmIGRhdGEgIT09IEVNUFRZX0ZJTkdFUlBSSU5UOwogICAgfQogICAgY29uc3QgaWQgPSB0aGlzLnhyZWYudHJhaWxlci5nZXQoIklEIik7CiAgICBsZXQgaGFzaE9yaWdpbmFsLCBoYXNoTW9kaWZpZWQ7CiAgICBpZiAoQXJyYXkuaXNBcnJheShpZCkgJiYgdmFsaWRhdGUoaWRbMF0pKSB7CiAgICAgIGhhc2hPcmlnaW5hbCA9IHN0cmluZ1RvQnl0ZXMoaWRbMF0pOwogICAgICBpZiAoaWRbMV0gIT09IGlkWzBdICYmIHZhbGlkYXRlKGlkWzFdKSkgewogICAgICAgIGhhc2hNb2RpZmllZCA9IHN0cmluZ1RvQnl0ZXMoaWRbMV0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBoYXNoT3JpZ2luYWwgPSBjYWxjdWxhdGVNRDUodGhpcy5zdHJlYW0uZ2V0Qnl0ZVJhbmdlKDAsIEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTKSwgMCwgRklOR0VSUFJJTlRfRklSU1RfQllURVMpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZmluZ2VycHJpbnRzIiwgW3RvSGV4VXRpbChoYXNoT3JpZ2luYWwpLCBoYXNoTW9kaWZpZWQgPyB0b0hleFV0aWwoaGFzaE1vZGlmaWVkKSA6IG51bGxdKTsKICB9CiAgYXN5bmMgI2dldExpbmVhcml6YXRpb25QYWdlKHBhZ2VJbmRleCkgewogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBsaW5lYXJpemF0aW9uLAogICAgICB4cmVmCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHJlZiA9IFJlZi5nZXQobGluZWFyaXphdGlvbi5vYmplY3ROdW1iZXJGaXJzdCwgMCk7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMocmVmKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBsZXQgdHlwZSA9IG9iai5nZXRSYXcoIlR5cGUiKTsKICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiUGFnZSIpIHx8ICFvYmouaGFzKCJUeXBlIikgJiYgIW9iai5oYXMoIktpZHMiKSAmJiBvYmouaGFzKCJDb250ZW50cyIpKSB7CiAgICAgICAgICBpZiAoIWNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLnB1dChyZWYsIDEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFjYXRhbG9nLnBhZ2VJbmRleENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUluZGV4Q2FjaGUucHV0KHJlZiwgMCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW29iaiwgcmVmXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJUaGUgTGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGRvZXNuJ3QgcG9pbnQgdG8gYSB2YWxpZCBQYWdlIGRpY3Rpb25hcnkuIik7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgX2dldExpbmVhcml6YXRpb25QYWdlOiAiJHtyZWFzb24ubWVzc2FnZX0iLmApOwogICAgICByZXR1cm4gY2F0YWxvZy5nZXRQYWdlRGljdChwYWdlSW5kZXgpOwogICAgfQogIH0KICBnZXRQYWdlKHBhZ2VJbmRleCkgewogICAgY29uc3QgY2FjaGVkUHJvbWlzZSA9IHRoaXMuI3BhZ2VQcm9taXNlcy5nZXQocGFnZUluZGV4KTsKICAgIGlmIChjYWNoZWRQcm9taXNlKSB7CiAgICAgIHJldHVybiBjYWNoZWRQcm9taXNlOwogICAgfQogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBsaW5lYXJpemF0aW9uLAogICAgICB4ZmFGYWN0b3J5CiAgICB9ID0gdGhpczsKICAgIGxldCBwcm9taXNlOwogICAgaWYgKHhmYUZhY3RvcnkpIHsKICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShbRGljdC5lbXB0eSwgbnVsbF0pOwogICAgfSBlbHNlIGlmIChsaW5lYXJpemF0aW9uPy5wYWdlRmlyc3QgPT09IHBhZ2VJbmRleCkgewogICAgICBwcm9taXNlID0gdGhpcy4jZ2V0TGluZWFyaXphdGlvblBhZ2UocGFnZUluZGV4KTsKICAgIH0gZWxzZSB7CiAgICAgIHByb21pc2UgPSBjYXRhbG9nLmdldFBhZ2VEaWN0KHBhZ2VJbmRleCk7CiAgICB9CiAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKChbcGFnZURpY3QsIHJlZl0pID0+IG5ldyBQYWdlKHsKICAgICAgcGRmTWFuYWdlcjogdGhpcy5wZGZNYW5hZ2VyLAogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIHBhZ2VJbmRleCwKICAgICAgcGFnZURpY3QsCiAgICAgIHJlZiwKICAgICAgZ2xvYmFsSWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiBjYXRhbG9nLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiBjYXRhbG9nLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogY2F0YWxvZy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICBub25CbGVuZE1vZGVzU2V0OiBjYXRhbG9nLm5vbkJsZW5kTW9kZXNTZXQsCiAgICAgIHhmYUZhY3RvcnkKICAgIH0pKTsKICAgIHRoaXMuI3BhZ2VQcm9taXNlcy5zZXQocGFnZUluZGV4LCBwcm9taXNlKTsKICAgIHJldHVybiBwcm9taXNlOwogIH0KICBhc3luYyBjaGVja0ZpcnN0UGFnZShyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgaWYgKHJlY292ZXJ5TW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLmdldFBhZ2UoMCk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIFhSZWZFbnRyeUV4Y2VwdGlvbikgewogICAgICAgIHRoaXMuI3BhZ2VQcm9taXNlcy5kZWxldGUoMCk7CiAgICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7CiAgICAgICAgdGhyb3cgbmV3IFhSZWZQYXJzZUV4Y2VwdGlvbigpOwogICAgICB9CiAgICB9CiAgfQogIGFzeW5jIGNoZWNrTGFzdFBhZ2UocmVjb3ZlcnlNb2RlID0gZmFsc2UpIHsKICAgIGNvbnN0IHsKICAgICAgY2F0YWxvZywKICAgICAgcGRmTWFuYWdlcgogICAgfSA9IHRoaXM7CiAgICBjYXRhbG9nLnNldEFjdHVhbE51bVBhZ2VzKCk7CiAgICBsZXQgbnVtUGFnZXM7CiAgICB0cnkgewogICAgICBhd2FpdCBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVEb2MoInhmYUZhY3RvcnkiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImxpbmVhcml6YXRpb24iKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJudW1QYWdlcyIpXSk7CiAgICAgIGlmICh0aGlzLnhmYUZhY3RvcnkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgICAgbnVtUGFnZXMgPSB0aGlzLmxpbmVhcml6YXRpb24ubnVtUGFnZXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbnVtUGFnZXMgPSBjYXRhbG9nLm51bVBhZ2VzOwogICAgICB9CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihudW1QYWdlcykpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgY291bnQgaXMgbm90IGFuIGludGVnZXIuIik7CiAgICAgIH0gZWxzZSBpZiAobnVtUGFnZXMgPD0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLmdldFBhZ2UobnVtUGFnZXMgLSAxKTsKICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICB0aGlzLiNwYWdlUHJvbWlzZXMuZGVsZXRlKG51bVBhZ2VzIC0gMSk7CiAgICAgIGF3YWl0IHRoaXMuY2xlYW51cCgpOwogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICB0aHJvdyBuZXcgWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgICAgIH0KICAgICAgd2FybihgY2hlY2tMYXN0UGFnZSAtIGludmFsaWQgL1BhZ2VzIHRyZWUgL0NvdW50OiAke251bVBhZ2VzfS5gKTsKICAgICAgbGV0IHBhZ2VzVHJlZTsKICAgICAgdHJ5IHsKICAgICAgICBwYWdlc1RyZWUgPSBhd2FpdCBjYXRhbG9nLmdldEFsbFBhZ2VEaWN0cyhyZWNvdmVyeU1vZGUpOwogICAgICB9IGNhdGNoIChyZWFzb25BbGwpIHsKICAgICAgICBpZiAocmVhc29uQWxsIGluc3RhbmNlb2YgWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICAgIHRocm93IG5ldyBYUmVmUGFyc2VFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgY2F0YWxvZy5zZXRBY3R1YWxOdW1QYWdlcygxKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBbcGFnZURpY3QsIHJlZl1dIG9mIHBhZ2VzVHJlZSkgewogICAgICAgIGxldCBwcm9taXNlOwogICAgICAgIGlmIChwYWdlRGljdCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZWplY3QocGFnZURpY3QpOwogICAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUobmV3IFBhZ2UoewogICAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICAgIHBhZ2VJbmRleCwKICAgICAgICAgICAgcGFnZURpY3QsCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgZ2xvYmFsSWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgICAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiBjYXRhbG9nLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogY2F0YWxvZy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICAgICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICAgICAgICBub25CbGVuZE1vZGVzU2V0OiBjYXRhbG9nLm5vbkJsZW5kTW9kZXNTZXQsCiAgICAgICAgICAgIHhmYUZhY3Rvcnk6IG51bGwKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jcGFnZVByb21pc2VzLnNldChwYWdlSW5kZXgsIHByb21pc2UpOwogICAgICB9CiAgICAgIGNhdGFsb2cuc2V0QWN0dWFsTnVtUGFnZXMocGFnZXNUcmVlLnNpemUpOwogICAgfQogIH0KICBhc3luYyBmb250RmFsbGJhY2soaWQsIGhhbmRsZXIpIHsKICAgIGNvbnN0IHsKICAgICAgY2F0YWxvZywKICAgICAgcGRmTWFuYWdlcgogICAgfSA9IHRoaXM7CiAgICBmb3IgKGNvbnN0IHRyYW5zbGF0ZWRGb250IG9mIGF3YWl0IFByb21pc2UuYWxsKGNhdGFsb2cuZm9udENhY2hlKSkgewogICAgICBpZiAodHJhbnNsYXRlZEZvbnQubG9hZGVkTmFtZSA9PT0gaWQpIHsKICAgICAgICB0cmFuc2xhdGVkRm9udC5mYWxsYmFjayhoYW5kbGVyLCBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnMpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogIH0KICBhc3luYyBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cgPyB0aGlzLmNhdGFsb2cuY2xlYW51cChtYW51YWxseVRyaWdnZXJlZCkgOiBjbGVhckdsb2JhbENhY2hlcygpOwogIH0KICBhc3luYyAjY29sbGVjdEZpZWxkT2JqZWN0cyhuYW1lLCBwYXJlbnRSZWYsIGZpZWxkUmVmLCBwcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMsIHZpc2l0ZWRSZWZzLCBvcnBoYW5GaWVsZHMpIHsKICAgIGNvbnN0IHsKICAgICAgeHJlZgogICAgfSA9IHRoaXM7CiAgICBpZiAoIShmaWVsZFJlZiBpbnN0YW5jZW9mIFJlZikgfHwgdmlzaXRlZFJlZnMuaGFzKGZpZWxkUmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB2aXNpdGVkUmVmcy5wdXQoZmllbGRSZWYpOwogICAgY29uc3QgZmllbGQgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMoZmllbGRSZWYpOwogICAgaWYgKCEoZmllbGQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgc3VidHlwZSA9IGF3YWl0IGZpZWxkLmdldEFzeW5jKCJTdWJ0eXBlIik7CiAgICBzdWJ0eXBlID0gc3VidHlwZSBpbnN0YW5jZW9mIE5hbWUgPyBzdWJ0eXBlLm5hbWUgOiBudWxsOwogICAgc3dpdGNoIChzdWJ0eXBlKSB7CiAgICAgIGNhc2UgIkxpbmsiOgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChmaWVsZC5oYXMoIlQiKSkgewogICAgICBjb25zdCBwYXJ0TmFtZSA9IHN0cmluZ1RvUERGU3RyaW5nKGF3YWl0IGZpZWxkLmdldEFzeW5jKCJUIikpOwogICAgICBuYW1lID0gbmFtZSA9PT0gIiIgPyBwYXJ0TmFtZSA6IGAke25hbWV9LiR7cGFydE5hbWV9YDsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBvYmogPSBmaWVsZDsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBvYmogPSBvYmouZ2V0UmF3KCJQYXJlbnQiKSB8fCBwYXJlbnRSZWY7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgaWYgKHZpc2l0ZWRSZWZzLmhhcyhvYmopKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgb2JqID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKG9iaik7CiAgICAgICAgfQogICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKG9iai5oYXMoIlQiKSkgewogICAgICAgICAgY29uc3QgcGFydE5hbWUgPSBzdHJpbmdUb1BERlN0cmluZyhhd2FpdCBvYmouZ2V0QXN5bmMoIlQiKSk7CiAgICAgICAgICBuYW1lID0gbmFtZSA9PT0gIiIgPyBwYXJ0TmFtZSA6IGAke25hbWV9LiR7cGFydE5hbWV9YDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHBhcmVudFJlZiAmJiAhZmllbGQuaGFzKCJQYXJlbnQiKSAmJiBpc05hbWUoZmllbGQuZ2V0KCJTdWJ0eXBlIiksICJXaWRnZXQiKSkgewogICAgICBvcnBoYW5GaWVsZHMucHV0KGZpZWxkUmVmLCBwYXJlbnRSZWYpOwogICAgfQogICAgaWYgKCFwcm9taXNlcy5oYXMobmFtZSkpIHsKICAgICAgcHJvbWlzZXMuc2V0KG5hbWUsIFtdKTsKICAgIH0KICAgIHByb21pc2VzLmdldChuYW1lKS5wdXNoKEFubm90YXRpb25GYWN0b3J5LmNyZWF0ZSh4cmVmLCBmaWVsZFJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIG51bGwsIHRydWUsIG9ycGhhbkZpZWxkcywgbnVsbCwgbnVsbCkudGhlbihhbm5vdGF0aW9uID0+IGFubm90YXRpb24/LmdldEZpZWxkT2JqZWN0KCkpLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgd2FybihgI2NvbGxlY3RGaWVsZE9iamVjdHM6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0pKTsKICAgIGlmICghZmllbGQuaGFzKCJLaWRzIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qga2lkcyA9IGF3YWl0IGZpZWxkLmdldEFzeW5jKCJLaWRzIik7CiAgICBpZiAoQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICBmb3IgKGNvbnN0IGtpZCBvZiBraWRzKSB7CiAgICAgICAgYXdhaXQgdGhpcy4jY29sbGVjdEZpZWxkT2JqZWN0cyhuYW1lLCBmaWVsZFJlZiwga2lkLCBwcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMsIHZpc2l0ZWRSZWZzLCBvcnBoYW5GaWVsZHMpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBmaWVsZE9iamVjdHMoKSB7CiAgICBjb25zdCBwcm9taXNlID0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiZm9ybUluZm8iKS50aGVuKGFzeW5jIGZvcm1JbmZvID0+IHsKICAgICAgaWYgKCFmb3JtSW5mby5oYXNGaWVsZHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBhbm5vdGF0aW9uR2xvYmFscyA9IGF3YWl0IHRoaXMuYW5ub3RhdGlvbkdsb2JhbHM7CiAgICAgIGlmICghYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgYWNyb0Zvcm0KICAgICAgfSA9IGFubm90YXRpb25HbG9iYWxzOwogICAgICBjb25zdCB2aXNpdGVkUmVmcyA9IG5ldyBSZWZTZXQoKTsKICAgICAgY29uc3QgYWxsRmllbGRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgY29uc3QgZmllbGRQcm9taXNlcyA9IG5ldyBNYXAoKTsKICAgICAgY29uc3Qgb3JwaGFuRmllbGRzID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICAgIGZvciAoY29uc3QgZmllbGRSZWYgb2YgYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKSkgewogICAgICAgIGF3YWl0IHRoaXMuI2NvbGxlY3RGaWVsZE9iamVjdHMoIiIsIG51bGwsIGZpZWxkUmVmLCBmaWVsZFByb21pc2VzLCBhbm5vdGF0aW9uR2xvYmFscywgdmlzaXRlZFJlZnMsIG9ycGhhbkZpZWxkcyk7CiAgICAgIH0KICAgICAgY29uc3QgYWxsUHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBbbmFtZSwgcHJvbWlzZXNdIG9mIGZpZWxkUHJvbWlzZXMpIHsKICAgICAgICBhbGxQcm9taXNlcy5wdXNoKFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZpZWxkcyA9PiB7CiAgICAgICAgICBmaWVsZHMgPSBmaWVsZHMuZmlsdGVyKGZpZWxkID0+ICEhZmllbGQpOwogICAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGFsbEZpZWxkc1tuYW1lXSA9IGZpZWxkczsKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYWxsUHJvbWlzZXMpOwogICAgICByZXR1cm4gewogICAgICAgIGFsbEZpZWxkczogb2JqZWN0U2l6ZShhbGxGaWVsZHMpID4gMCA/IGFsbEZpZWxkcyA6IG51bGwsCiAgICAgICAgb3JwaGFuRmllbGRzCiAgICAgIH07CiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImZpZWxkT2JqZWN0cyIsIHByb21pc2UpOwogIH0KICBnZXQgaGFzSlNBY3Rpb25zKCkgewogICAgY29uc3QgcHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmVEb2MoIl9wYXJzZUhhc0pTQWN0aW9ucyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaGFzSlNBY3Rpb25zIiwgcHJvbWlzZSk7CiAgfQogIGFzeW5jIF9wYXJzZUhhc0pTQWN0aW9ucygpIHsKICAgIGNvbnN0IFtjYXRhbG9nSnNBY3Rpb25zLCBmaWVsZE9iamVjdHNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3RoaXMucGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJqc0FjdGlvbnMiKSwgdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiZmllbGRPYmplY3RzIildKTsKICAgIGlmIChjYXRhbG9nSnNBY3Rpb25zKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKGZpZWxkT2JqZWN0cz8uYWxsRmllbGRzKSB7CiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkT2JqZWN0cy5hbGxGaWVsZHMpLnNvbWUoZmllbGRPYmplY3QgPT4gZmllbGRPYmplY3Quc29tZShvYmplY3QgPT4gb2JqZWN0LmFjdGlvbnMgIT09IG51bGwpKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGNhbGN1bGF0aW9uT3JkZXJJZHMoKSB7CiAgICBjb25zdCBjYWxjdWxhdGlvbk9yZGVyID0gdGhpcy5jYXRhbG9nLmFjcm9Gb3JtPy5nZXQoIkNPIik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoY2FsY3VsYXRpb25PcmRlcikgfHwgY2FsY3VsYXRpb25PcmRlci5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY2FsY3VsYXRpb25PcmRlcklkcyIsIG51bGwpOwogICAgfQogICAgY29uc3QgaWRzID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIGNhbGN1bGF0aW9uT3JkZXIpIHsKICAgICAgaWYgKGlkIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaWRzLnB1c2goaWQudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImNhbGN1bGF0aW9uT3JkZXJJZHMiLCBpZHMubGVuZ3RoID8gaWRzIDogbnVsbCk7CiAgfQogIGdldCBhbm5vdGF0aW9uR2xvYmFscygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImFubm90YXRpb25HbG9iYWxzIiwgQW5ub3RhdGlvbkZhY3RvcnkuY3JlYXRlR2xvYmFscyh0aGlzLnBkZk1hbmFnZXIpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3BkZl9tYW5hZ2VyLmpzCgoKCgoKCgoKCgpmdW5jdGlvbiBwYXJzZURvY0Jhc2VVcmwodXJsKSB7CiAgaWYgKHVybCkgewogICAgY29uc3QgYWJzb2x1dGVVcmwgPSBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCk7CiAgICBpZiAoYWJzb2x1dGVVcmwpIHsKICAgICAgcmV0dXJuIGFic29sdXRlVXJsLmhyZWY7CiAgICB9CiAgICB3YXJuKGBJbnZhbGlkIGFic29sdXRlIGRvY0Jhc2VVcmw6ICIke3VybH0iLmApOwogIH0KICByZXR1cm4gbnVsbDsKfQpjbGFzcyBCYXNlUGRmTWFuYWdlciB7CiAgY29uc3RydWN0b3IoewogICAgZG9jQmFzZVVybCwKICAgIGRvY0lkLAogICAgZW5hYmxlWGZhLAogICAgZXZhbHVhdG9yT3B0aW9ucywKICAgIGhhbmRsZXIsCiAgICBwYXNzd29yZAogIH0pIHsKICAgIHRoaXMuX2RvY0Jhc2VVcmwgPSBwYXJzZURvY0Jhc2VVcmwoZG9jQmFzZVVybCk7CiAgICB0aGlzLl9kb2NJZCA9IGRvY0lkOwogICAgdGhpcy5fcGFzc3dvcmQgPSBwYXNzd29yZDsKICAgIHRoaXMuZW5hYmxlWGZhID0gZW5hYmxlWGZhOwogICAgZXZhbHVhdG9yT3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJj0gRmVhdHVyZVRlc3QuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ7CiAgICBldmFsdWF0b3JPcHRpb25zLmlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkICYmPSBGZWF0dXJlVGVzdC5pc0ltYWdlRGVjb2RlclN1cHBvcnRlZDsKICAgIHRoaXMuZXZhbHVhdG9yT3B0aW9ucyA9IE9iamVjdC5mcmVlemUoZXZhbHVhdG9yT3B0aW9ucyk7CiAgICBJbWFnZVJlc2l6ZXIuc2V0T3B0aW9ucyhldmFsdWF0b3JPcHRpb25zKTsKICAgIEpwZWdTdHJlYW0uc2V0T3B0aW9ucyhldmFsdWF0b3JPcHRpb25zKTsKICAgIE9wZXJhdG9yTGlzdC5zZXRPcHRpb25zKGV2YWx1YXRvck9wdGlvbnMpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgLi4uZXZhbHVhdG9yT3B0aW9ucywKICAgICAgaGFuZGxlcgogICAgfTsKICAgIEpweEltYWdlLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICBJY2NDb2xvclNwYWNlLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICBDbXlrSUNDQmFzZWRDUy5zZXRPcHRpb25zKG9wdGlvbnMpOwogIH0KICBnZXQgZG9jSWQoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jSWQ7CiAgfQogIGdldCBwYXNzd29yZCgpIHsKICAgIHJldHVybiB0aGlzLl9wYXNzd29yZDsKICB9CiAgZ2V0IGRvY0Jhc2VVcmwoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jQmFzZVVybDsKICB9CiAgZW5zdXJlRG9jKHByb3AsIGFyZ3MpIHsKICAgIHJldHVybiB0aGlzLmVuc3VyZSh0aGlzLnBkZkRvY3VtZW50LCBwcm9wLCBhcmdzKTsKICB9CiAgZW5zdXJlWFJlZihwcm9wLCBhcmdzKSB7CiAgICByZXR1cm4gdGhpcy5lbnN1cmUodGhpcy5wZGZEb2N1bWVudC54cmVmLCBwcm9wLCBhcmdzKTsKICB9CiAgZW5zdXJlQ2F0YWxvZyhwcm9wLCBhcmdzKSB7CiAgICByZXR1cm4gdGhpcy5lbnN1cmUodGhpcy5wZGZEb2N1bWVudC5jYXRhbG9nLCBwcm9wLCBhcmdzKTsKICB9CiAgZ2V0UGFnZShwYWdlSW5kZXgpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmdldFBhZ2UocGFnZUluZGV4KTsKICB9CiAgZm9udEZhbGxiYWNrKGlkLCBoYW5kbGVyKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5mb250RmFsbGJhY2soaWQsIGhhbmRsZXIpOwogIH0KICBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmNsZWFudXAobWFudWFsbHlUcmlnZ2VyZWQpOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBlbnN1cmVgIGNhbGxlZCIpOwogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgcmVxdWVzdFJhbmdlYCBjYWxsZWQiKTsKICB9CiAgcmVxdWVzdExvYWRlZFN0cmVhbShub0ZldGNoID0gZmFsc2UpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYHJlcXVlc3RMb2FkZWRTdHJlYW1gIGNhbGxlZCIpOwogIH0KICBzZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBzZW5kUHJvZ3Jlc3NpdmVEYXRhYCBjYWxsZWQiKTsKICB9CiAgdXBkYXRlUGFzc3dvcmQocGFzc3dvcmQpIHsKICAgIHRoaXMuX3Bhc3N3b3JkID0gcGFzc3dvcmQ7CiAgfQogIHRlcm1pbmF0ZShyZWFzb24pIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYHRlcm1pbmF0ZWAgY2FsbGVkIik7CiAgfQp9CmNsYXNzIExvY2FsUGRmTWFuYWdlciBleHRlbmRzIEJhc2VQZGZNYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihhcmdzKSB7CiAgICBzdXBlcihhcmdzKTsKICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBTdHJlYW0oYXJncy5zb3VyY2UpOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBQREZEb2N1bWVudCh0aGlzLCBzdHJlYW0pOwogICAgdGhpcy5fbG9hZGVkU3RyZWFtUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShzdHJlYW0pOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICBjb25zdCB2YWx1ZSA9IG9ialtwcm9wXTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIHZhbHVlLmFwcGx5KG9iaiwgYXJncyk7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIHJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKSB7CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgfQogIHJlcXVlc3RMb2FkZWRTdHJlYW0obm9GZXRjaCA9IGZhbHNlKSB7CiAgICByZXR1cm4gdGhpcy5fbG9hZGVkU3RyZWFtUHJvbWlzZTsKICB9CiAgdGVybWluYXRlKHJlYXNvbikge30KfQpjbGFzcyBOZXR3b3JrUGRmTWFuYWdlciBleHRlbmRzIEJhc2VQZGZNYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihhcmdzKSB7CiAgICBzdXBlcihhcmdzKTsKICAgIHRoaXMuc3RyZWFtTWFuYWdlciA9IG5ldyBDaHVua2VkU3RyZWFtTWFuYWdlcihhcmdzLnNvdXJjZSwgewogICAgICBtc2dIYW5kbGVyOiBhcmdzLmhhbmRsZXIsCiAgICAgIGxlbmd0aDogYXJncy5sZW5ndGgsCiAgICAgIGRpc2FibGVBdXRvRmV0Y2g6IGFyZ3MuZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgcmFuZ2VDaHVua1NpemU6IGFyZ3MucmFuZ2VDaHVua1NpemUKICAgIH0pOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBQREZEb2N1bWVudCh0aGlzLCB0aGlzLnN0cmVhbU1hbmFnZXIuZ2V0U3RyZWFtKCkpOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICB0cnkgewogICAgICBjb25zdCB2YWx1ZSA9IG9ialtwcm9wXTsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHJldHVybiB2YWx1ZS5hcHBseShvYmosIGFyZ3MpOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmICghKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy5yZXF1ZXN0UmFuZ2UoZXguYmVnaW4sIGV4LmVuZCk7CiAgICAgIHJldHVybiB0aGlzLmVuc3VyZShvYmosIHByb3AsIGFyZ3MpOwogICAgfQogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtTWFuYWdlci5yZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCk7CiAgfQogIHJlcXVlc3RMb2FkZWRTdHJlYW0obm9GZXRjaCA9IGZhbHNlKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW1NYW5hZ2VyLnJlcXVlc3RBbGxDaHVua3Mobm9GZXRjaCk7CiAgfQogIHNlbmRQcm9ncmVzc2l2ZURhdGEoY2h1bmspIHsKICAgIHRoaXMuc3RyZWFtTWFuYWdlci5vblJlY2VpdmVEYXRhKHsKICAgICAgY2h1bmsKICAgIH0pOwogIH0KICB0ZXJtaW5hdGUocmVhc29uKSB7CiAgICB0aGlzLnN0cmVhbU1hbmFnZXIuYWJvcnQocmVhc29uKTsKICB9Cn0KCjsvLyAuL3NyYy9zaGFyZWQvbWVzc2FnZV9oYW5kbGVyLmpzCgpjb25zdCBDYWxsYmFja0tpbmQgPSB7CiAgREFUQTogMSwKICBFUlJPUjogMgp9Owpjb25zdCBTdHJlYW1LaW5kID0gewogIENBTkNFTDogMSwKICBDQU5DRUxfQ09NUExFVEU6IDIsCiAgQ0xPU0U6IDMsCiAgRU5RVUVVRTogNCwKICBFUlJPUjogNSwKICBQVUxMOiA2LAogIFBVTExfQ09NUExFVEU6IDcsCiAgU1RBUlRfQ09NUExFVEU6IDgKfTsKZnVuY3Rpb24gb25GbigpIHt9CmZ1bmN0aW9uIHdyYXBSZWFzb24oZXgpIHsKICBpZiAoZXggaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIEludmFsaWRQREZFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBQYXNzd29yZEV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIFJlc3BvbnNlRXhjZXB0aW9uIHx8IGV4IGluc3RhbmNlb2YgVW5rbm93bkVycm9yRXhjZXB0aW9uKSB7CiAgICByZXR1cm4gZXg7CiAgfQogIGlmICghKGV4IGluc3RhbmNlb2YgRXJyb3IgfHwgdHlwZW9mIGV4ID09PSAib2JqZWN0IiAmJiBleCAhPT0gbnVsbCkpIHsKICAgIHVucmVhY2hhYmxlKCd3cmFwUmVhc29uOiBFeHBlY3RlZCAicmVhc29uIiB0byBiZSBhIChwb3NzaWJseSBjbG9uZWQpIEVycm9yLicpOwogIH0KICBzd2l0Y2ggKGV4Lm5hbWUpIHsKICAgIGNhc2UgIkFib3J0RXhjZXB0aW9uIjoKICAgICAgcmV0dXJuIG5ldyBBYm9ydEV4Y2VwdGlvbihleC5tZXNzYWdlKTsKICAgIGNhc2UgIkludmFsaWRQREZFeGNlcHRpb24iOgogICAgICByZXR1cm4gbmV3IEludmFsaWRQREZFeGNlcHRpb24oZXgubWVzc2FnZSk7CiAgICBjYXNlICJQYXNzd29yZEV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgUGFzc3dvcmRFeGNlcHRpb24oZXgubWVzc2FnZSwgZXguY29kZSk7CiAgICBjYXNlICJSZXNwb25zZUV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2VFeGNlcHRpb24oZXgubWVzc2FnZSwgZXguc3RhdHVzLCBleC5taXNzaW5nKTsKICAgIGNhc2UgIlVua25vd25FcnJvckV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgVW5rbm93bkVycm9yRXhjZXB0aW9uKGV4Lm1lc3NhZ2UsIGV4LmRldGFpbHMpOwogIH0KICByZXR1cm4gbmV3IFVua25vd25FcnJvckV4Y2VwdGlvbihleC5tZXNzYWdlLCBleC50b1N0cmluZygpKTsKfQpjbGFzcyBNZXNzYWdlSGFuZGxlciB7CiAgI21lc3NhZ2VBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICBjb25zdHJ1Y3Rvcihzb3VyY2VOYW1lLCB0YXJnZXROYW1lLCBjb21PYmopIHsKICAgIHRoaXMuc291cmNlTmFtZSA9IHNvdXJjZU5hbWU7CiAgICB0aGlzLnRhcmdldE5hbWUgPSB0YXJnZXROYW1lOwogICAgdGhpcy5jb21PYmogPSBjb21PYmo7CiAgICB0aGlzLmNhbGxiYWNrSWQgPSAxOwogICAgdGhpcy5zdHJlYW1JZCA9IDE7CiAgICB0aGlzLnN0cmVhbVNpbmtzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLmFjdGlvbkhhbmRsZXIgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29tT2JqLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCB0aGlzLiNvbk1lc3NhZ2UuYmluZCh0aGlzKSwgewogICAgICBzaWduYWw6IHRoaXMuI21lc3NhZ2VBQy5zaWduYWwKICAgIH0pOwogIH0KICAjb25NZXNzYWdlKHsKICAgIGRhdGEKICB9KSB7CiAgICBpZiAoZGF0YS50YXJnZXROYW1lICE9PSB0aGlzLnNvdXJjZU5hbWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGRhdGEuc3RyZWFtKSB7CiAgICAgIHRoaXMuI3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoZGF0YS5jYWxsYmFjaykgewogICAgICBjb25zdCBjYWxsYmFja0lkID0gZGF0YS5jYWxsYmFja0lkOwogICAgICBjb25zdCBjYXBhYmlsaXR5ID0gdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXTsKICAgICAgaWYgKCFjYXBhYmlsaXR5KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcmVzb2x2ZSBjYWxsYmFjayAke2NhbGxiYWNrSWR9YCk7CiAgICAgIH0KICAgICAgZGVsZXRlIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF07CiAgICAgIGlmIChkYXRhLmNhbGxiYWNrID09PSBDYWxsYmFja0tpbmQuREFUQSkgewogICAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZShkYXRhLmRhdGEpOwogICAgICB9IGVsc2UgaWYgKGRhdGEuY2FsbGJhY2sgPT09IENhbGxiYWNrS2luZC5FUlJPUikgewogICAgICAgIGNhcGFiaWxpdHkucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgY2FsbGJhY2sgY2FzZSIpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuYWN0aW9uSGFuZGxlcltkYXRhLmFjdGlvbl07CiAgICBpZiAoIWFjdGlvbikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYWN0aW9uIGZyb20gd29ya2VyOiAke2RhdGEuYWN0aW9ufWApOwogICAgfQogICAgaWYgKGRhdGEuY2FsbGJhY2tJZCkgewogICAgICBjb25zdCBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWUsCiAgICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICAgIFByb21pc2UudHJ5KGFjdGlvbiwgZGF0YS5kYXRhKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBjYWxsYmFjazogQ2FsbGJhY2tLaW5kLkRBVEEsCiAgICAgICAgICBjYWxsYmFja0lkOiBkYXRhLmNhbGxiYWNrSWQsCiAgICAgICAgICBkYXRhOiByZXN1bHQKICAgICAgICB9KTsKICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIGNhbGxiYWNrOiBDYWxsYmFja0tpbmQuRVJST1IsCiAgICAgICAgICBjYWxsYmFja0lkOiBkYXRhLmNhbGxiYWNrSWQsCiAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGRhdGEuc3RyZWFtSWQpIHsKICAgICAgdGhpcy4jY3JlYXRlU3RyZWFtU2luayhkYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYWN0aW9uKGRhdGEuZGF0YSk7CiAgfQogIG9uKGFjdGlvbk5hbWUsIGhhbmRsZXIpIHsKICAgIGNvbnN0IGFoID0gdGhpcy5hY3Rpb25IYW5kbGVyOwogICAgaWYgKGFoW2FjdGlvbk5hbWVdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgaXMgYWxyZWFkeSBhbiBhY3Rpb25OYW1lIGNhbGxlZCAiJHthY3Rpb25OYW1lfSJgKTsKICAgIH0KICAgIGFoW2FjdGlvbk5hbWVdID0gaGFuZGxlcjsKICB9CiAgc2VuZChhY3Rpb25OYW1lLCBkYXRhLCB0cmFuc2ZlcnMpIHsKICAgIHRoaXMuY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lOiB0aGlzLnRhcmdldE5hbWUsCiAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgZGF0YQogICAgfSwgdHJhbnNmZXJzKTsKICB9CiAgc2VuZFdpdGhQcm9taXNlKGFjdGlvbk5hbWUsIGRhdGEsIHRyYW5zZmVycykgewogICAgY29uc3QgY2FsbGJhY2tJZCA9IHRoaXMuY2FsbGJhY2tJZCsrOwogICAgY29uc3QgY2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXSA9IGNhcGFiaWxpdHk7CiAgICB0cnkgewogICAgICB0aGlzLmNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWU6IHRoaXMudGFyZ2V0TmFtZSwKICAgICAgICBhY3Rpb246IGFjdGlvbk5hbWUsCiAgICAgICAgY2FsbGJhY2tJZCwKICAgICAgICBkYXRhCiAgICAgIH0sIHRyYW5zZmVycyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBjYXBhYmlsaXR5LnJlamVjdChleCk7CiAgICB9CiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBzZW5kV2l0aFN0cmVhbShhY3Rpb25OYW1lLCBkYXRhLCBxdWV1ZWluZ1N0cmF0ZWd5LCB0cmFuc2ZlcnMpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gdGhpcy5zdHJlYW1JZCsrLAogICAgICBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lID0gdGhpcy50YXJnZXROYW1lLAogICAgICBjb21PYmogPSB0aGlzLmNvbU9iajsKICAgIHJldHVybiBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICBzdGFydDogY29udHJvbGxlciA9PiB7CiAgICAgICAgY29uc3Qgc3RhcnRDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0gPSB7CiAgICAgICAgICBjb250cm9sbGVyLAogICAgICAgICAgc3RhcnRDYWxsOiBzdGFydENhcGFiaWxpdHksCiAgICAgICAgICBwdWxsQ2FsbDogbnVsbCwKICAgICAgICAgIGNhbmNlbENhbGw6IG51bGwsCiAgICAgICAgICBpc0Nsb3NlZDogZmFsc2UKICAgICAgICB9OwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIGRlc2lyZWRTaXplOiBjb250cm9sbGVyLmRlc2lyZWRTaXplCiAgICAgICAgfSwgdHJhbnNmZXJzKTsKICAgICAgICByZXR1cm4gc3RhcnRDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0sCiAgICAgIHB1bGw6IGNvbnRyb2xsZXIgPT4gewogICAgICAgIGNvbnN0IHB1bGxDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0ucHVsbENhbGwgPSBwdWxsQ2FwYWJpbGl0eTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTCwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGVzaXJlZFNpemU6IGNvbnRyb2xsZXIuZGVzaXJlZFNpemUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcHVsbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfSwKICAgICAgY2FuY2VsOiByZWFzb24gPT4gewogICAgICAgIGFzc2VydChyZWFzb24gaW5zdGFuY2VvZiBFcnJvciwgImNhbmNlbCBtdXN0IGhhdmUgYSB2YWxpZCByZWFzb24iKTsKICAgICAgICBjb25zdCBjYW5jZWxDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY2FuY2VsQ2FsbCA9IGNhbmNlbENhcGFiaWxpdHk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUwsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNhbmNlbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfQogICAgfSwgcXVldWVpbmdTdHJhdGVneSk7CiAgfQogICNjcmVhdGVTdHJlYW1TaW5rKGRhdGEpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZCwKICAgICAgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZSA9IGRhdGEuc291cmNlTmFtZSwKICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICBjb25zdCBzZWxmID0gdGhpcywKICAgICAgYWN0aW9uID0gdGhpcy5hY3Rpb25IYW5kbGVyW2RhdGEuYWN0aW9uXTsKICAgIGNvbnN0IHN0cmVhbVNpbmsgPSB7CiAgICAgIGVucXVldWUoY2h1bmssIHNpemUgPSAxLCB0cmFuc2ZlcnMpIHsKICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYXN0RGVzaXJlZFNpemUgPSB0aGlzLmRlc2lyZWRTaXplOwogICAgICAgIHRoaXMuZGVzaXJlZFNpemUgLT0gc2l6ZTsKICAgICAgICBpZiAobGFzdERlc2lyZWRTaXplID4gMCAmJiB0aGlzLmRlc2lyZWRTaXplIDw9IDApIHsKICAgICAgICAgIHRoaXMuc2lua0NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgICAgICAgIHRoaXMucmVhZHkgPSB0aGlzLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5FTlFVRVVFLAogICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICBjaHVuawogICAgICAgIH0sIHRyYW5zZmVycyk7CiAgICAgIH0sCiAgICAgIGNsb3NlKCkgewogICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsbGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuaXNDYW5jZWxsZWQgPSB0cnVlOwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DTE9TRSwKICAgICAgICAgIHN0cmVhbUlkCiAgICAgICAgfSk7CiAgICAgICAgZGVsZXRlIHNlbGYuc3RyZWFtU2lua3Nbc3RyZWFtSWRdOwogICAgICB9LAogICAgICBlcnJvcihyZWFzb24pIHsKICAgICAgICBhc3NlcnQocmVhc29uIGluc3RhbmNlb2YgRXJyb3IsICJlcnJvciBtdXN0IGhhdmUgYSB2YWxpZCByZWFzb24iKTsKICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuRVJST1IsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNpbmtDYXBhYmlsaXR5OiBQcm9taXNlLndpdGhSZXNvbHZlcnMoKSwKICAgICAgb25QdWxsOiBudWxsLAogICAgICBvbkNhbmNlbDogbnVsbCwKICAgICAgaXNDYW5jZWxsZWQ6IGZhbHNlLAogICAgICBkZXNpcmVkU2l6ZTogZGF0YS5kZXNpcmVkU2l6ZSwKICAgICAgcmVhZHk6IG51bGwKICAgIH07CiAgICBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIHN0cmVhbVNpbmsucmVhZHkgPSBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXSA9IHN0cmVhbVNpbms7CiAgICBQcm9taXNlLnRyeShhY3Rpb24sIGRhdGEuZGF0YSwgc3RyZWFtU2luaykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZSwKICAgICAgICB0YXJnZXROYW1lLAogICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURSwKICAgICAgICBzdHJlYW1JZCwKICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgIH0pOwogICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuU1RBUlRfQ09NUExFVEUsCiAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgfSk7CiAgICB9KTsKICB9CiAgI3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZCwKICAgICAgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZSA9IGRhdGEuc291cmNlTmFtZSwKICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICBjb25zdCBzdHJlYW1Db250cm9sbGVyID0gdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0sCiAgICAgIHN0cmVhbVNpbmsgPSB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXTsKICAgIHN3aXRjaCAoZGF0YS5zdHJlYW0pIHsKICAgICAgY2FzZSBTdHJlYW1LaW5kLlNUQVJUX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuc3RhcnRDYWxsLnJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5zdGFydENhbGwucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIucHVsbENhbGwucmVzb2x2ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1Db250cm9sbGVyLnB1bGxDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuUFVMTDoKICAgICAgICBpZiAoIXN0cmVhbVNpbmspIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFLAogICAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbVNpbmsuZGVzaXJlZFNpemUgPD0gMCAmJiBkYXRhLmRlc2lyZWRTaXplID4gMCkgewogICAgICAgICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbVNpbmsuZGVzaXJlZFNpemUgPSBkYXRhLmRlc2lyZWRTaXplOwogICAgICAgIFByb21pc2UudHJ5KHN0cmVhbVNpbmsub25QdWxsIHx8IG9uRm4pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURSwKICAgICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkVOUVVFVUU6CiAgICAgICAgYXNzZXJ0KHN0cmVhbUNvbnRyb2xsZXIsICJlbnF1ZXVlIHNob3VsZCBoYXZlIHN0cmVhbSBjb250cm9sbGVyIik7CiAgICAgICAgaWYgKHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHJlYW1Db250cm9sbGVyLmNvbnRyb2xsZXIuZW5xdWV1ZShkYXRhLmNodW5rKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkNMT1NFOgogICAgICAgIGFzc2VydChzdHJlYW1Db250cm9sbGVyLCAiY2xvc2Ugc2hvdWxkIGhhdmUgc3RyZWFtIGNvbnRyb2xsZXIiKTsKICAgICAgICBpZiAoc3RyZWFtQ29udHJvbGxlci5pc0Nsb3NlZCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY29udHJvbGxlci5jbG9zZSgpOwogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuRVJST1I6CiAgICAgICAgYXNzZXJ0KHN0cmVhbUNvbnRyb2xsZXIsICJlcnJvciBzaG91bGQgaGF2ZSBzdHJlYW0gY29udHJvbGxlciIpOwogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY29udHJvbGxlci5lcnJvcih3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgdGhpcy4jZGVsZXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW1Db250cm9sbGVyLCBzdHJlYW1JZCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEU6CiAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsLnJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuQ0FOQ0VMOgogICAgICAgIGlmICghc3RyZWFtU2luaykgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRhdGFSZWFzb24gPSB3cmFwUmVhc29uKGRhdGEucmVhc29uKTsKICAgICAgICBQcm9taXNlLnRyeShzdHJlYW1TaW5rLm9uQ2FuY2VsIHx8IG9uRm4sIGRhdGFSZWFzb24pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkNBTkNFTF9DT01QTEVURSwKICAgICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZWplY3QoZGF0YVJlYXNvbik7CiAgICAgICAgc3RyZWFtU2luay5pc0NhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgZGVsZXRlIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBzdHJlYW0gY2FzZSIpOwogICAgfQogIH0KICBhc3luYyAjZGVsZXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW1Db250cm9sbGVyLCBzdHJlYW1JZCkgewogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFtzdHJlYW1Db250cm9sbGVyLnN0YXJ0Q2FsbD8ucHJvbWlzZSwgc3RyZWFtQ29udHJvbGxlci5wdWxsQ2FsbD8ucHJvbWlzZSwgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsPy5wcm9taXNlXSk7CiAgICBkZWxldGUgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF07CiAgfQogIGRlc3Ryb3koKSB7CiAgICB0aGlzLiNtZXNzYWdlQUM/LmFib3J0KCk7CiAgICB0aGlzLiNtZXNzYWdlQUMgPSBudWxsOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvd3JpdGVyLmpzCgoKCgoKCgphc3luYyBmdW5jdGlvbiB3cml0ZU9iamVjdChyZWYsIG9iaiwgYnVmZmVyLCB7CiAgZW5jcnlwdCA9IG51bGwKfSkgewogIGNvbnN0IHRyYW5zZm9ybSA9IGVuY3J5cHQ/LmNyZWF0ZUNpcGhlclRyYW5zZm9ybShyZWYubnVtLCByZWYuZ2VuKTsKICBidWZmZXIucHVzaChgJHtyZWYubnVtfSAke3JlZi5nZW59IG9ialxuYCk7CiAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgIGF3YWl0IHdyaXRlRGljdChvYmosIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgIGF3YWl0IHdyaXRlU3RyZWFtKG9iaiwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopIHx8IEFycmF5QnVmZmVyLmlzVmlldyhvYmopKSB7CiAgICBhd2FpdCB3cml0ZUFycmF5KG9iaiwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIH0KICBidWZmZXIucHVzaCgiXG5lbmRvYmpcbiIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlRGljdChkaWN0LCBidWZmZXIsIHRyYW5zZm9ybSkgewogIGJ1ZmZlci5wdXNoKCI8PCIpOwogIGZvciAoY29uc3Qga2V5IG9mIGRpY3QuZ2V0S2V5cygpKSB7CiAgICBidWZmZXIucHVzaChgIC8ke2VzY2FwZVBERk5hbWUoa2V5KX0gYCk7CiAgICBhd2FpdCB3cml0ZVZhbHVlKGRpY3QuZ2V0UmF3KGtleSksIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9CiAgYnVmZmVyLnB1c2goIj4+Iik7Cn0KYXN5bmMgZnVuY3Rpb24gd3JpdGVTdHJlYW0oc3RyZWFtLCBidWZmZXIsIHRyYW5zZm9ybSkgewogIGxldCBieXRlcyA9IHN0cmVhbS5nZXRCeXRlcygpOwogIGNvbnN0IHsKICAgIGRpY3QKICB9ID0gc3RyZWFtOwogIGNvbnN0IFtmaWx0ZXIsIHBhcmFtc10gPSBhd2FpdCBQcm9taXNlLmFsbChbZGljdC5nZXRBc3luYygiRmlsdGVyIiksIGRpY3QuZ2V0QXN5bmMoIkRlY29kZVBhcm1zIildKTsKICBjb25zdCBmaWx0ZXJaZXJvID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gYXdhaXQgZGljdC54cmVmLmZldGNoSWZSZWZBc3luYyhmaWx0ZXJbMF0pIDogZmlsdGVyOwogIGNvbnN0IGlzRmlsdGVyWmVyb0ZsYXRlRGVjb2RlID0gaXNOYW1lKGZpbHRlclplcm8sICJGbGF0ZURlY29kZSIpOwogIGNvbnN0IE1JTl9MRU5HVEhfRk9SX0NPTVBSRVNTSU5HID0gMjU2OwogIGlmIChieXRlcy5sZW5ndGggPj0gTUlOX0xFTkdUSF9GT1JfQ09NUFJFU1NJTkcgfHwgaXNGaWx0ZXJaZXJvRmxhdGVEZWNvZGUpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGNzID0gbmV3IENvbXByZXNzaW9uU3RyZWFtKCJkZWZsYXRlIik7CiAgICAgIGNvbnN0IHdyaXRlciA9IGNzLndyaXRhYmxlLmdldFdyaXRlcigpOwogICAgICBhd2FpdCB3cml0ZXIucmVhZHk7CiAgICAgIHdyaXRlci53cml0ZShieXRlcykudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgYXdhaXQgd3JpdGVyLnJlYWR5OwogICAgICAgIGF3YWl0IHdyaXRlci5jbG9zZSgpOwogICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgIGNvbnN0IGJ1ZiA9IGF3YWl0IG5ldyBSZXNwb25zZShjcy5yZWFkYWJsZSkuYXJyYXlCdWZmZXIoKTsKICAgICAgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWYpOwogICAgICBsZXQgbmV3RmlsdGVyLCBuZXdQYXJhbXM7CiAgICAgIGlmICghZmlsdGVyKSB7CiAgICAgICAgbmV3RmlsdGVyID0gTmFtZS5nZXQoIkZsYXRlRGVjb2RlIik7CiAgICAgIH0gZWxzZSBpZiAoIWlzRmlsdGVyWmVyb0ZsYXRlRGVjb2RlKSB7CiAgICAgICAgbmV3RmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gW05hbWUuZ2V0KCJGbGF0ZURlY29kZSIpLCAuLi5maWx0ZXJdIDogW05hbWUuZ2V0KCJGbGF0ZURlY29kZSIpLCBmaWx0ZXJdOwogICAgICAgIGlmIChwYXJhbXMpIHsKICAgICAgICAgIG5ld1BhcmFtcyA9IEFycmF5LmlzQXJyYXkocGFyYW1zKSA/IFtudWxsLCAuLi5wYXJhbXNdIDogW251bGwsIHBhcmFtc107CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuZXdGaWx0ZXIpIHsKICAgICAgICBkaWN0LnNldCgiRmlsdGVyIiwgbmV3RmlsdGVyKTsKICAgICAgfQogICAgICBpZiAobmV3UGFyYW1zKSB7CiAgICAgICAgZGljdC5zZXQoIkRlY29kZVBhcm1zIiwgbmV3UGFyYW1zKTsKICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaW5mbyhgd3JpdGVTdHJlYW0gLSBjYW5ub3QgY29tcHJlc3MgZGF0YTogIiR7ZXh9Ii5gKTsKICAgIH0KICB9CiAgbGV0IHN0cmluZyA9IGJ5dGVzVG9TdHJpbmcoYnl0ZXMpOwogIGlmICh0cmFuc2Zvcm0pIHsKICAgIHN0cmluZyA9IHRyYW5zZm9ybS5lbmNyeXB0U3RyaW5nKHN0cmluZyk7CiAgfQogIGRpY3Quc2V0KCJMZW5ndGgiLCBzdHJpbmcubGVuZ3RoKTsKICBhd2FpdCB3cml0ZURpY3QoZGljdCwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIGJ1ZmZlci5wdXNoKCIgc3RyZWFtXG4iLCBzdHJpbmcsICJcbmVuZHN0cmVhbSIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlQXJyYXkoYXJyYXksIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgYnVmZmVyLnB1c2goIlsiKTsKICBsZXQgZmlyc3QgPSB0cnVlOwogIGZvciAoY29uc3QgdmFsIG9mIGFycmF5KSB7CiAgICBpZiAoIWZpcnN0KSB7CiAgICAgIGJ1ZmZlci5wdXNoKCIgIik7CiAgICB9IGVsc2UgewogICAgICBmaXJzdCA9IGZhbHNlOwogICAgfQogICAgYXdhaXQgd3JpdGVWYWx1ZSh2YWwsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9CiAgYnVmZmVyLnB1c2goIl0iKTsKfQphc3luYyBmdW5jdGlvbiB3cml0ZVZhbHVlKHZhbHVlLCBidWZmZXIsIHRyYW5zZm9ybSkgewogIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgIGJ1ZmZlci5wdXNoKGAvJHtlc2NhcGVQREZOYW1lKHZhbHVlLm5hbWUpfWApOwogIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYpIHsKICAgIGJ1ZmZlci5wdXNoKGAke3ZhbHVlLm51bX0gJHt2YWx1ZS5nZW59IFJgKTsKICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpIHx8IEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkpIHsKICAgIGF3YWl0IHdyaXRlQXJyYXkodmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgdmFsdWUgPSB0cmFuc2Zvcm0uZW5jcnlwdFN0cmluZyh2YWx1ZSk7CiAgICB9CiAgICBidWZmZXIucHVzaChgKCR7ZXNjYXBlU3RyaW5nKHZhbHVlKX0pYCk7CiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICBidWZmZXIucHVzaChudW1iZXJUb1N0cmluZyh2YWx1ZSkpOwogIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgIGJ1ZmZlci5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOwogIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICBhd2FpdCB3cml0ZURpY3QodmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgYXdhaXQgd3JpdGVTdHJlYW0odmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICBidWZmZXIucHVzaCgibnVsbCIpOwogIH0gZWxzZSB7CiAgICB3YXJuKGBVbmhhbmRsZWQgdmFsdWUgaW4gd3JpdGVyOiAke3R5cGVvZiB2YWx1ZX0sIHBsZWFzZSBmaWxlIGEgYnVnLmApOwogIH0KfQpmdW5jdGlvbiB3cml0ZUludChudW1iZXIsIHNpemUsIG9mZnNldCwgYnVmZmVyKSB7CiAgZm9yIChsZXQgaSA9IHNpemUgKyBvZmZzZXQgLSAxOyBpID4gb2Zmc2V0IC0gMTsgaS0tKSB7CiAgICBidWZmZXJbaV0gPSBudW1iZXIgJiAweGZmOwogICAgbnVtYmVyID4+PSA4OwogIH0KICByZXR1cm4gb2Zmc2V0ICsgc2l6ZTsKfQpmdW5jdGlvbiB3cml0ZVN0cmluZyhzdHJpbmcsIG9mZnNldCwgYnVmZmVyKSB7CiAgY29uc3QgaWkgPSBzdHJpbmcubGVuZ3RoOwogIGZvciAobGV0IGkgPSAwOyBpIDwgaWk7IGkrKykgewogICAgYnVmZmVyW29mZnNldCArIGldID0gc3RyaW5nLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogIH0KICByZXR1cm4gb2Zmc2V0ICsgaWk7Cn0KZnVuY3Rpb24gY29tcHV0ZU1ENShmaWxlc2l6ZSwgeHJlZkluZm8pIHsKICBjb25zdCB0aW1lID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7CiAgY29uc3QgZmlsZW5hbWUgPSB4cmVmSW5mby5maWxlbmFtZSB8fCAiIjsKICBjb25zdCBtZDVCdWZmZXIgPSBbdGltZS50b1N0cmluZygpLCBmaWxlbmFtZSwgZmlsZXNpemUudG9TdHJpbmcoKSwgLi4ueHJlZkluZm8uaW5mb01hcC52YWx1ZXMoKV07CiAgY29uc3QgbWQ1QnVmZmVyTGVuID0gTWF0aC5zdW1QcmVjaXNlKG1kNUJ1ZmZlci5tYXAoc3RyID0+IHN0ci5sZW5ndGgpKTsKICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KG1kNUJ1ZmZlckxlbik7CiAgbGV0IG9mZnNldCA9IDA7CiAgZm9yIChjb25zdCBzdHIgb2YgbWQ1QnVmZmVyKSB7CiAgICBvZmZzZXQgPSB3cml0ZVN0cmluZyhzdHIsIG9mZnNldCwgYXJyYXkpOwogIH0KICByZXR1cm4gYnl0ZXNUb1N0cmluZyhjYWxjdWxhdGVNRDUoYXJyYXksIDAsIGFycmF5Lmxlbmd0aCkpOwp9CmZ1bmN0aW9uIHdyaXRlWEZBRGF0YUZvckFjcm9mb3JtKHN0ciwgY2hhbmdlcykgewogIGNvbnN0IHhtbCA9IG5ldyBTaW1wbGVYTUxQYXJzZXIoewogICAgaGFzQXR0cmlidXRlczogdHJ1ZQogIH0pLnBhcnNlRnJvbVN0cmluZyhzdHIpOwogIGZvciAoY29uc3QgewogICAgeGZhCiAgfSBvZiBjaGFuZ2VzKSB7CiAgICBpZiAoIXhmYSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcGF0aCwKICAgICAgdmFsdWUKICAgIH0gPSB4ZmE7CiAgICBpZiAoIXBhdGgpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBub2RlUGF0aCA9IHBhcnNlWEZBUGF0aChwYXRoKTsKICAgIGxldCBub2RlID0geG1sLmRvY3VtZW50RWxlbWVudC5zZWFyY2hOb2RlKG5vZGVQYXRoLCAwKTsKICAgIGlmICghbm9kZSAmJiBub2RlUGF0aC5sZW5ndGggPiAxKSB7CiAgICAgIG5vZGUgPSB4bWwuZG9jdW1lbnRFbGVtZW50LnNlYXJjaE5vZGUoW25vZGVQYXRoLmF0KC0xKV0sIDApOwogICAgfQogICAgaWYgKG5vZGUpIHsKICAgICAgbm9kZS5jaGlsZE5vZGVzID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAodmFsID0+IG5ldyBTaW1wbGVET01Ob2RlKCJ2YWx1ZSIsIHZhbCkpIDogW25ldyBTaW1wbGVET01Ob2RlKCIjdGV4dCIsIHZhbHVlKV07CiAgICB9IGVsc2UgewogICAgICB3YXJuKGBOb2RlIG5vdCBmb3VuZCBmb3IgcGF0aDogJHtwYXRofWApOwogICAgfQogIH0KICBjb25zdCBidWZmZXIgPSBbXTsKICB4bWwuZG9jdW1lbnRFbGVtZW50LmR1bXAoYnVmZmVyKTsKICByZXR1cm4gYnVmZmVyLmpvaW4oIiIpOwp9CmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUFjcm9mb3JtKHsKICB4cmVmLAogIGFjcm9Gb3JtLAogIGFjcm9Gb3JtUmVmLAogIGhhc1hmYSwKICBoYXNYZmFEYXRhc2V0c0VudHJ5LAogIHhmYURhdGFzZXRzUmVmLAogIG5lZWRBcHBlYXJhbmNlcywKICBjaGFuZ2VzCn0pIHsKICBpZiAoaGFzWGZhICYmICFoYXNYZmFEYXRhc2V0c0VudHJ5ICYmICF4ZmFEYXRhc2V0c1JlZikgewogICAgd2FybigiWEZBIC0gQ2Fubm90IHNhdmUgaXQiKTsKICB9CiAgaWYgKCFuZWVkQXBwZWFyYW5jZXMgJiYgKCFoYXNYZmEgfHwgIXhmYURhdGFzZXRzUmVmIHx8IGhhc1hmYURhdGFzZXRzRW50cnkpKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IGRpY3QgPSBhY3JvRm9ybS5jbG9uZSgpOwogIGlmIChoYXNYZmEgJiYgIWhhc1hmYURhdGFzZXRzRW50cnkpIHsKICAgIGNvbnN0IG5ld1hmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIikuc2xpY2UoKTsKICAgIG5ld1hmYS5zcGxpY2UoMiwgMCwgImRhdGFzZXRzIik7CiAgICBuZXdYZmEuc3BsaWNlKDMsIDAsIHhmYURhdGFzZXRzUmVmKTsKICAgIGRpY3Quc2V0KCJYRkEiLCBuZXdYZmEpOwogIH0KICBpZiAobmVlZEFwcGVhcmFuY2VzKSB7CiAgICBkaWN0LnNldCgiTmVlZEFwcGVhcmFuY2VzIiwgdHJ1ZSk7CiAgfQogIGNoYW5nZXMucHV0KGFjcm9Gb3JtUmVmLCB7CiAgICBkYXRhOiBkaWN0CiAgfSk7Cn0KZnVuY3Rpb24gdXBkYXRlWEZBKHsKICB4ZmFEYXRhLAogIHhmYURhdGFzZXRzUmVmLAogIGNoYW5nZXMsCiAgeHJlZgp9KSB7CiAgaWYgKHhmYURhdGEgPT09IG51bGwpIHsKICAgIGNvbnN0IGRhdGFzZXRzID0geHJlZi5mZXRjaElmUmVmKHhmYURhdGFzZXRzUmVmKTsKICAgIHhmYURhdGEgPSB3cml0ZVhGQURhdGFGb3JBY3JvZm9ybShkYXRhc2V0cy5nZXRTdHJpbmcoKSwgY2hhbmdlcyk7CiAgfQogIGNvbnN0IHhmYURhdGFTdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKHhmYURhdGEpOwogIHhmYURhdGFTdHJlYW0uZGljdCA9IG5ldyBEaWN0KHhyZWYpOwogIHhmYURhdGFTdHJlYW0uZGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiRW1iZWRkZWRGaWxlIik7CiAgY2hhbmdlcy5wdXQoeGZhRGF0YXNldHNSZWYsIHsKICAgIGRhdGE6IHhmYURhdGFTdHJlYW0KICB9KTsKfQphc3luYyBmdW5jdGlvbiBnZXRYUmVmVGFibGUoeHJlZkluZm8sIGJhc2VPZmZzZXQsIG5ld1JlZnMsIG5ld1hyZWYsIGJ1ZmZlcikgewogIGJ1ZmZlci5wdXNoKCJ4cmVmXG4iKTsKICBjb25zdCBpbmRleGVzID0gZ2V0SW5kZXhlcyhuZXdSZWZzKTsKICBsZXQgaW5kZXhlc1Bvc2l0aW9uID0gMDsKICBmb3IgKGNvbnN0IHsKICAgIHJlZiwKICAgIGRhdGEKICB9IG9mIG5ld1JlZnMpIHsKICAgIGlmIChyZWYubnVtID09PSBpbmRleGVzW2luZGV4ZXNQb3NpdGlvbl0pIHsKICAgICAgYnVmZmVyLnB1c2goYCR7aW5kZXhlc1tpbmRleGVzUG9zaXRpb25dfSAke2luZGV4ZXNbaW5kZXhlc1Bvc2l0aW9uICsgMV19XG5gKTsKICAgICAgaW5kZXhlc1Bvc2l0aW9uICs9IDI7CiAgICB9CiAgICBpZiAoZGF0YSAhPT0gbnVsbCkgewogICAgICBidWZmZXIucHVzaChgJHtiYXNlT2Zmc2V0LnRvU3RyaW5nKCkucGFkU3RhcnQoMTAsICIwIil9ICR7TWF0aC5taW4ocmVmLmdlbiwgMHhmZmZmKS50b1N0cmluZygpLnBhZFN0YXJ0KDUsICIwIil9IG5cclxuYCk7CiAgICAgIGJhc2VPZmZzZXQgKz0gZGF0YS5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIucHVzaChgMDAwMDAwMDAwMCAke01hdGgubWluKHJlZi5nZW4gKyAxLCAweGZmZmYpLnRvU3RyaW5nKCkucGFkU3RhcnQoNSwgIjAiKX0gZlxyXG5gKTsKICAgIH0KICB9CiAgY29tcHV0ZUlEcyhiYXNlT2Zmc2V0LCB4cmVmSW5mbywgbmV3WHJlZik7CiAgYnVmZmVyLnB1c2goInRyYWlsZXJcbiIpOwogIGF3YWl0IHdyaXRlRGljdChuZXdYcmVmLCBidWZmZXIpOwogIGJ1ZmZlci5wdXNoKCJcbnN0YXJ0eHJlZlxuIiwgYmFzZU9mZnNldC50b1N0cmluZygpLCAiXG4lJUVPRlxuIik7Cn0KZnVuY3Rpb24gZ2V0SW5kZXhlcyhuZXdSZWZzKSB7CiAgY29uc3QgaW5kZXhlcyA9IFtdOwogIGZvciAoY29uc3QgewogICAgcmVmCiAgfSBvZiBuZXdSZWZzKSB7CiAgICBpZiAocmVmLm51bSA9PT0gaW5kZXhlcy5hdCgtMikgKyBpbmRleGVzLmF0KC0xKSkgewogICAgICBpbmRleGVzW2luZGV4ZXMubGVuZ3RoIC0gMV0gKz0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4ZXMucHVzaChyZWYubnVtLCAxKTsKICAgIH0KICB9CiAgcmV0dXJuIGluZGV4ZXM7Cn0KYXN5bmMgZnVuY3Rpb24gZ2V0WFJlZlN0cmVhbVRhYmxlKHhyZWZJbmZvLCBiYXNlT2Zmc2V0LCBuZXdSZWZzLCBuZXdYcmVmLCBidWZmZXIpIHsKICBjb25zdCB4cmVmVGFibGVEYXRhID0gW107CiAgbGV0IG1heE9mZnNldCA9IDA7CiAgbGV0IG1heEdlbiA9IDA7CiAgZm9yIChjb25zdCB7CiAgICByZWYsCiAgICBkYXRhCiAgfSBvZiBuZXdSZWZzKSB7CiAgICBsZXQgZ2VuOwogICAgbWF4T2Zmc2V0ID0gTWF0aC5tYXgobWF4T2Zmc2V0LCBiYXNlT2Zmc2V0KTsKICAgIGlmIChkYXRhICE9PSBudWxsKSB7CiAgICAgIGdlbiA9IE1hdGgubWluKHJlZi5nZW4sIDB4ZmZmZik7CiAgICAgIHhyZWZUYWJsZURhdGEucHVzaChbMSwgYmFzZU9mZnNldCwgZ2VuXSk7CiAgICAgIGJhc2VPZmZzZXQgKz0gZGF0YS5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBnZW4gPSBNYXRoLm1pbihyZWYuZ2VuICsgMSwgMHhmZmZmKTsKICAgICAgeHJlZlRhYmxlRGF0YS5wdXNoKFswLCAwLCBnZW5dKTsKICAgIH0KICAgIG1heEdlbiA9IE1hdGgubWF4KG1heEdlbiwgZ2VuKTsKICB9CiAgbmV3WHJlZi5zZXQoIkluZGV4IiwgZ2V0SW5kZXhlcyhuZXdSZWZzKSk7CiAgY29uc3Qgb2Zmc2V0U2l6ZSA9IGdldFNpemVJbkJ5dGVzKG1heE9mZnNldCk7CiAgY29uc3QgbWF4R2VuU2l6ZSA9IGdldFNpemVJbkJ5dGVzKG1heEdlbik7CiAgY29uc3Qgc2l6ZXMgPSBbMSwgb2Zmc2V0U2l6ZSwgbWF4R2VuU2l6ZV07CiAgbmV3WHJlZi5zZXQoIlciLCBzaXplcyk7CiAgY29tcHV0ZUlEcyhiYXNlT2Zmc2V0LCB4cmVmSW5mbywgbmV3WHJlZik7CiAgY29uc3Qgc3RydWN0U2l6ZSA9IE1hdGguc3VtUHJlY2lzZShzaXplcyk7CiAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KHN0cnVjdFNpemUgKiB4cmVmVGFibGVEYXRhLmxlbmd0aCk7CiAgY29uc3Qgc3RyZWFtID0gbmV3IFN0cmVhbShkYXRhKTsKICBzdHJlYW0uZGljdCA9IG5ld1hyZWY7CiAgbGV0IG9mZnNldCA9IDA7CiAgZm9yIChjb25zdCBbdHlwZSwgb2JqT2Zmc2V0LCBnZW5dIG9mIHhyZWZUYWJsZURhdGEpIHsKICAgIG9mZnNldCA9IHdyaXRlSW50KHR5cGUsIHNpemVzWzBdLCBvZmZzZXQsIGRhdGEpOwogICAgb2Zmc2V0ID0gd3JpdGVJbnQob2JqT2Zmc2V0LCBzaXplc1sxXSwgb2Zmc2V0LCBkYXRhKTsKICAgIG9mZnNldCA9IHdyaXRlSW50KGdlbiwgc2l6ZXNbMl0sIG9mZnNldCwgZGF0YSk7CiAgfQogIGF3YWl0IHdyaXRlT2JqZWN0KHhyZWZJbmZvLm5ld1JlZiwgc3RyZWFtLCBidWZmZXIsIHt9KTsKICBidWZmZXIucHVzaCgic3RhcnR4cmVmXG4iLCBiYXNlT2Zmc2V0LnRvU3RyaW5nKCksICJcbiUlRU9GXG4iKTsKfQpmdW5jdGlvbiBjb21wdXRlSURzKGJhc2VPZmZzZXQsIHhyZWZJbmZvLCBuZXdYcmVmKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoeHJlZkluZm8uZmlsZUlkcykgJiYgeHJlZkluZm8uZmlsZUlkcy5sZW5ndGggPiAwKSB7CiAgICBjb25zdCBtZDUgPSBjb21wdXRlTUQ1KGJhc2VPZmZzZXQsIHhyZWZJbmZvKTsKICAgIG5ld1hyZWYuc2V0KCJJRCIsIFt4cmVmSW5mby5maWxlSWRzWzBdLCBtZDVdKTsKICB9Cn0KZnVuY3Rpb24gZ2V0VHJhaWxlckRpY3QoeHJlZkluZm8sIGNoYW5nZXMsIHVzZVhyZWZTdHJlYW0pIHsKICBjb25zdCBuZXdYcmVmID0gbmV3IERpY3QobnVsbCk7CiAgbmV3WHJlZi5zZXQoIlByZXYiLCB4cmVmSW5mby5zdGFydFhSZWYpOwogIGNvbnN0IHJlZkZvclhyZWZUYWJsZSA9IHhyZWZJbmZvLm5ld1JlZjsKICBpZiAodXNlWHJlZlN0cmVhbSkgewogICAgY2hhbmdlcy5wdXQocmVmRm9yWHJlZlRhYmxlLCB7CiAgICAgIGRhdGE6ICIiCiAgICB9KTsKICAgIG5ld1hyZWYuc2V0KCJTaXplIiwgcmVmRm9yWHJlZlRhYmxlLm51bSArIDEpOwogICAgbmV3WHJlZi5zZXRJZk5hbWUoIlR5cGUiLCAiWFJlZiIpOwogIH0gZWxzZSB7CiAgICBuZXdYcmVmLnNldCgiU2l6ZSIsIHJlZkZvclhyZWZUYWJsZS5udW0pOwogIH0KICBpZiAoeHJlZkluZm8ucm9vdFJlZiAhPT0gbnVsbCkgewogICAgbmV3WHJlZi5zZXQoIlJvb3QiLCB4cmVmSW5mby5yb290UmVmKTsKICB9CiAgaWYgKHhyZWZJbmZvLmluZm9SZWYgIT09IG51bGwpIHsKICAgIG5ld1hyZWYuc2V0KCJJbmZvIiwgeHJlZkluZm8uaW5mb1JlZik7CiAgfQogIGlmICh4cmVmSW5mby5lbmNyeXB0UmVmICE9PSBudWxsKSB7CiAgICBuZXdYcmVmLnNldCgiRW5jcnlwdCIsIHhyZWZJbmZvLmVuY3J5cHRSZWYpOwogIH0KICByZXR1cm4gbmV3WHJlZjsKfQphc3luYyBmdW5jdGlvbiB3cml0ZUNoYW5nZXMoY2hhbmdlcywgeHJlZiwgYnVmZmVyID0gW10pIHsKICBjb25zdCBuZXdSZWZzID0gW107CiAgZm9yIChjb25zdCBbcmVmLCB7CiAgICBkYXRhCiAgfV0gb2YgY2hhbmdlcy5pdGVtcygpKSB7CiAgICBpZiAoZGF0YSA9PT0gbnVsbCB8fCB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgbmV3UmVmcy5wdXNoKHsKICAgICAgICByZWYsCiAgICAgICAgZGF0YQogICAgICB9KTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBhd2FpdCB3cml0ZU9iamVjdChyZWYsIGRhdGEsIGJ1ZmZlciwgeHJlZik7CiAgICBuZXdSZWZzLnB1c2goewogICAgICByZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKQogICAgfSk7CiAgICBidWZmZXIubGVuZ3RoID0gMDsKICB9CiAgcmV0dXJuIG5ld1JlZnMuc29ydCgoYSwgYikgPT4gYS5yZWYubnVtIC0gYi5yZWYubnVtKTsKfQphc3luYyBmdW5jdGlvbiBpbmNyZW1lbnRhbFVwZGF0ZSh7CiAgb3JpZ2luYWxEYXRhLAogIHhyZWZJbmZvLAogIGNoYW5nZXMsCiAgeHJlZiA9IG51bGwsCiAgaGFzWGZhID0gZmFsc2UsCiAgeGZhRGF0YXNldHNSZWYgPSBudWxsLAogIGhhc1hmYURhdGFzZXRzRW50cnkgPSBmYWxzZSwKICBuZWVkQXBwZWFyYW5jZXMsCiAgYWNyb0Zvcm1SZWYgPSBudWxsLAogIGFjcm9Gb3JtID0gbnVsbCwKICB4ZmFEYXRhID0gbnVsbCwKICB1c2VYcmVmU3RyZWFtID0gZmFsc2UKfSkgewogIGF3YWl0IHVwZGF0ZUFjcm9mb3JtKHsKICAgIHhyZWYsCiAgICBhY3JvRm9ybSwKICAgIGFjcm9Gb3JtUmVmLAogICAgaGFzWGZhLAogICAgaGFzWGZhRGF0YXNldHNFbnRyeSwKICAgIHhmYURhdGFzZXRzUmVmLAogICAgbmVlZEFwcGVhcmFuY2VzLAogICAgY2hhbmdlcwogIH0pOwogIGlmIChoYXNYZmEpIHsKICAgIHVwZGF0ZVhGQSh7CiAgICAgIHhmYURhdGEsCiAgICAgIHhmYURhdGFzZXRzUmVmLAogICAgICBjaGFuZ2VzLAogICAgICB4cmVmCiAgICB9KTsKICB9CiAgY29uc3QgbmV3WHJlZiA9IGdldFRyYWlsZXJEaWN0KHhyZWZJbmZvLCBjaGFuZ2VzLCB1c2VYcmVmU3RyZWFtKTsKICBjb25zdCBidWZmZXIgPSBbXTsKICBjb25zdCBuZXdSZWZzID0gYXdhaXQgd3JpdGVDaGFuZ2VzKGNoYW5nZXMsIHhyZWYsIGJ1ZmZlcik7CiAgbGV0IGJhc2VPZmZzZXQgPSBvcmlnaW5hbERhdGEubGVuZ3RoOwogIGNvbnN0IGxhc3RCeXRlID0gb3JpZ2luYWxEYXRhLmF0KC0xKTsKICBpZiAobGFzdEJ5dGUgIT09IDB4MGEgJiYgbGFzdEJ5dGUgIT09IDB4MGQpIHsKICAgIGJ1ZmZlci5wdXNoKCJcbiIpOwogICAgYmFzZU9mZnNldCArPSAxOwogIH0KICBmb3IgKGNvbnN0IHsKICAgIGRhdGEKICB9IG9mIG5ld1JlZnMpIHsKICAgIGlmIChkYXRhICE9PSBudWxsKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGRhdGEpOwogICAgfQogIH0KICBhd2FpdCAodXNlWHJlZlN0cmVhbSA/IGdldFhSZWZTdHJlYW1UYWJsZSh4cmVmSW5mbywgYmFzZU9mZnNldCwgbmV3UmVmcywgbmV3WHJlZiwgYnVmZmVyKSA6IGdldFhSZWZUYWJsZSh4cmVmSW5mbywgYmFzZU9mZnNldCwgbmV3UmVmcywgbmV3WHJlZiwgYnVmZmVyKSk7CiAgY29uc3QgdG90YWxMZW5ndGggPSBvcmlnaW5hbERhdGEubGVuZ3RoICsgTWF0aC5zdW1QcmVjaXNlKGJ1ZmZlci5tYXAoc3RyID0+IHN0ci5sZW5ndGgpKTsKICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KHRvdGFsTGVuZ3RoKTsKICBhcnJheS5zZXQob3JpZ2luYWxEYXRhKTsKICBsZXQgb2Zmc2V0ID0gb3JpZ2luYWxEYXRhLmxlbmd0aDsKICBmb3IgKGNvbnN0IHN0ciBvZiBidWZmZXIpIHsKICAgIG9mZnNldCA9IHdyaXRlU3RyaW5nKHN0ciwgb2Zmc2V0LCBhcnJheSk7CiAgfQogIHJldHVybiBhcnJheTsKfQoKOy8vIC4vc3JjL2NvcmUvd29ya2VyX3N0cmVhbS5qcwoKY2xhc3MgUERGV29ya2VyU3RyZWFtIHsKICBjb25zdHJ1Y3Rvcihtc2dIYW5kbGVyKSB7CiAgICB0aGlzLl9tc2dIYW5kbGVyID0gbXNnSGFuZGxlcjsKICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBudWxsOwogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBudWxsOwogICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycyA9IFtdOwogIH0KICBnZXRGdWxsUmVhZGVyKCkgewogICAgYXNzZXJ0KCF0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciwgIlBERldvcmtlclN0cmVhbS5nZXRGdWxsUmVhZGVyIGNhbiBvbmx5IGJlIGNhbGxlZCBvbmNlLiIpOwogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBuZXcgUERGV29ya2VyU3RyZWFtUmVhZGVyKHRoaXMuX21zZ0hhbmRsZXIpOwogICAgcmV0dXJuIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyOwogIH0KICBnZXRSYW5nZVJlYWRlcihiZWdpbiwgZW5kKSB7CiAgICBjb25zdCByZWFkZXIgPSBuZXcgUERGV29ya2VyU3RyZWFtUmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCwgdGhpcy5fbXNnSGFuZGxlcik7CiAgICB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLnB1c2gocmVhZGVyKTsKICAgIHJldHVybiByZWFkZXI7CiAgfQogIGNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbikgewogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI/LmNhbmNlbChyZWFzb24pOwogICAgZm9yIChjb25zdCByZWFkZXIgb2YgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycy5zbGljZSgwKSkgewogICAgICByZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICB9CiAgfQp9CmNsYXNzIFBERldvcmtlclN0cmVhbVJlYWRlciB7CiAgY29uc3RydWN0b3IobXNnSGFuZGxlcikgewogICAgdGhpcy5fbXNnSGFuZGxlciA9IG1zZ0hhbmRsZXI7CiAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgdGhpcy5fY29udGVudExlbmd0aCA9IG51bGw7CiAgICB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkID0gZmFsc2U7CiAgICB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9IGZhbHNlOwogICAgY29uc3QgcmVhZGFibGVTdHJlYW0gPSB0aGlzLl9tc2dIYW5kbGVyLnNlbmRXaXRoU3RyZWFtKCJHZXRSZWFkZXIiKTsKICAgIHRoaXMuX3JlYWRlciA9IHJlYWRhYmxlU3RyZWFtLmdldFJlYWRlcigpOwogICAgdGhpcy5faGVhZGVyc1JlYWR5ID0gdGhpcy5fbXNnSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIlJlYWRlckhlYWRlcnNSZWFkeSIpLnRoZW4oZGF0YSA9PiB7CiAgICAgIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkID0gZGF0YS5pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICAgICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9IGRhdGEuaXNSYW5nZVN1cHBvcnRlZDsKICAgICAgdGhpcy5fY29udGVudExlbmd0aCA9IGRhdGEuY29udGVudExlbmd0aDsKICAgIH0pOwogIH0KICBnZXQgaGVhZGVyc1JlYWR5KCkgewogICAgcmV0dXJuIHRoaXMuX2hlYWRlcnNSZWFkeTsKICB9CiAgZ2V0IGNvbnRlbnRMZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5fY29udGVudExlbmd0aDsKICB9CiAgZ2V0IGlzU3RyZWFtaW5nU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkOwogIH0KICBnZXQgaXNSYW5nZVN1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkOwogIH0KICBhc3luYyByZWFkKCkgewogICAgY29uc3QgewogICAgICB2YWx1ZSwKICAgICAgZG9uZQogICAgfSA9IGF3YWl0IHRoaXMuX3JlYWRlci5yZWFkKCk7CiAgICBpZiAoZG9uZSkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9OwogICAgfQogICAgcmV0dXJuIHsKICAgICAgdmFsdWU6IHZhbHVlLmJ1ZmZlciwKICAgICAgZG9uZTogZmFsc2UKICAgIH07CiAgfQogIGNhbmNlbChyZWFzb24pIHsKICAgIHRoaXMuX3JlYWRlci5jYW5jZWwocmVhc29uKTsKICB9Cn0KY2xhc3MgUERGV29ya2VyU3RyZWFtUmFuZ2VSZWFkZXIgewogIGNvbnN0cnVjdG9yKGJlZ2luLCBlbmQsIG1zZ0hhbmRsZXIpIHsKICAgIHRoaXMuX21zZ0hhbmRsZXIgPSBtc2dIYW5kbGVyOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgIGNvbnN0IHJlYWRhYmxlU3RyZWFtID0gdGhpcy5fbXNnSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0UmFuZ2VSZWFkZXIiLCB7CiAgICAgIGJlZ2luLAogICAgICBlbmQKICAgIH0pOwogICAgdGhpcy5fcmVhZGVyID0gcmVhZGFibGVTdHJlYW0uZ2V0UmVhZGVyKCk7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGNvbnN0IHsKICAgICAgdmFsdWUsCiAgICAgIGRvbmUKICAgIH0gPSBhd2FpdCB0aGlzLl9yZWFkZXIucmVhZCgpOwogICAgaWYgKGRvbmUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHZhbHVlOiB2YWx1ZS5idWZmZXIsCiAgICAgIGRvbmU6IGZhbHNlCiAgICB9OwogIH0KICBjYW5jZWwocmVhc29uKSB7CiAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS93b3JrZXIuanMKCgoKCgoKCgoKCmNsYXNzIFdvcmtlclRhc2sgewogIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnRlcm1pbmF0ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICB9CiAgZ2V0IGZpbmlzaGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2NhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgZmluaXNoKCkgewogICAgdGhpcy5fY2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgfQogIHRlcm1pbmF0ZSgpIHsKICAgIHRoaXMudGVybWluYXRlZCA9IHRydWU7CiAgfQogIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKSB7CiAgICBpZiAodGhpcy50ZXJtaW5hdGVkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV29ya2VyIHRhc2sgd2FzIHRlcm1pbmF0ZWQiKTsKICAgIH0KICB9Cn0KY2xhc3MgV29ya2VyTWVzc2FnZUhhbmRsZXIgewogIHN0YXRpYyB7CiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIgJiYgIWlzTm9kZUpTICYmIHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygc2VsZi5wb3N0TWVzc2FnZSA9PT0gImZ1bmN0aW9uIiAmJiAib25tZXNzYWdlIiBpbiBzZWxmKSB7CiAgICAgIHRoaXMuaW5pdGlhbGl6ZUZyb21Qb3J0KHNlbGYpOwogICAgfQogIH0KICBzdGF0aWMgc2V0dXAoaGFuZGxlciwgcG9ydCkgewogICAgbGV0IHRlc3RNZXNzYWdlUHJvY2Vzc2VkID0gZmFsc2U7CiAgICBoYW5kbGVyLm9uKCJ0ZXN0IiwgZGF0YSA9PiB7CiAgICAgIGlmICh0ZXN0TWVzc2FnZVByb2Nlc3NlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0ZXN0TWVzc2FnZVByb2Nlc3NlZCA9IHRydWU7CiAgICAgIGhhbmRsZXIuc2VuZCgidGVzdCIsIGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiY29uZmlndXJlIiwgZGF0YSA9PiB7CiAgICAgIHNldFZlcmJvc2l0eUxldmVsKGRhdGEudmVyYm9zaXR5KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RG9jUmVxdWVzdCIsIGRhdGEgPT4gdGhpcy5jcmVhdGVEb2N1bWVudEhhbmRsZXIoZGF0YSwgcG9ydCkpOwogIH0KICBzdGF0aWMgY3JlYXRlRG9jdW1lbnRIYW5kbGVyKGRvY1BhcmFtcywgcG9ydCkgewogICAgbGV0IHBkZk1hbmFnZXI7CiAgICBsZXQgdGVybWluYXRlZCA9IGZhbHNlOwogICAgbGV0IGNhbmNlbFhIUnMgPSBudWxsOwogICAgY29uc3QgV29ya2VyVGFza3MgPSBuZXcgU2V0KCk7CiAgICBjb25zdCB2ZXJib3NpdHkgPSBnZXRWZXJib3NpdHlMZXZlbCgpOwogICAgY29uc3QgewogICAgICBkb2NJZCwKICAgICAgYXBpVmVyc2lvbgogICAgfSA9IGRvY1BhcmFtczsKICAgIGNvbnN0IHdvcmtlclZlcnNpb24gPSAiNS40LjI5NiI7CiAgICBpZiAoYXBpVmVyc2lvbiAhPT0gd29ya2VyVmVyc2lvbikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBBUEkgdmVyc2lvbiAiJHthcGlWZXJzaW9ufSIgZG9lcyBub3QgbWF0Y2ggYCArIGB0aGUgV29ya2VyIHZlcnNpb24gIiR7d29ya2VyVmVyc2lvbn0iLmApOwogICAgfQogICAgY29uc3QgYnVpbGRNc2cgPSAodHlwZSwgcHJvcCkgPT4gYFRoZSBcYCR7dHlwZX0ucHJvdG90eXBlXGAgY29udGFpbnMgdW5leHBlY3RlZCBlbnVtZXJhYmxlIHByb3BlcnR5IGAgKyBgIiR7cHJvcH0iLCB0aHVzIGJyZWFraW5nIGUuZy4gXGBmb3IuLi5pblxgIGl0ZXJhdGlvbiBvZiAke3R5cGV9cy5gOwogICAgZm9yIChjb25zdCBwcm9wIGluIHt9KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihidWlsZE1zZygiT2JqZWN0IiwgcHJvcCkpOwogICAgfQogICAgZm9yIChjb25zdCBwcm9wIGluIFtdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihidWlsZE1zZygiQXJyYXkiLCBwcm9wKSk7CiAgICB9CiAgICBjb25zdCB3b3JrZXJIYW5kbGVyTmFtZSA9IGRvY0lkICsgIl93b3JrZXIiOwogICAgbGV0IGhhbmRsZXIgPSBuZXcgTWVzc2FnZUhhbmRsZXIod29ya2VySGFuZGxlck5hbWUsIGRvY0lkLCBwb3J0KTsKICAgIGZ1bmN0aW9uIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKSB7CiAgICAgIGlmICh0ZXJtaW5hdGVkKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQiKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc3RhcnRXb3JrZXJUYXNrKHRhc2spIHsKICAgICAgV29ya2VyVGFza3MuYWRkKHRhc2spOwogICAgfQogICAgZnVuY3Rpb24gZmluaXNoV29ya2VyVGFzayh0YXNrKSB7CiAgICAgIHRhc2suZmluaXNoKCk7CiAgICAgIFdvcmtlclRhc2tzLmRlbGV0ZSh0YXNrKTsKICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWREb2N1bWVudChyZWNvdmVyeU1vZGUpIHsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImNoZWNrSGVhZGVyIik7CiAgICAgIGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJwYXJzZVN0YXJ0WFJlZiIpOwogICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygicGFyc2UiLCBbcmVjb3ZlcnlNb2RlXSk7CiAgICAgIGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJjaGVja0ZpcnN0UGFnZSIsIFtyZWNvdmVyeU1vZGVdKTsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImNoZWNrTGFzdFBhZ2UiLCBbcmVjb3ZlcnlNb2RlXSk7CiAgICAgIGNvbnN0IGlzUHVyZVhmYSA9IGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJpc1B1cmVYZmEiKTsKICAgICAgaWYgKGlzUHVyZVhmYSkgewogICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgV29ya2VyVGFzaygibG9hZFhmYVJlc291cmNlcyIpOwogICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygibG9hZFhmYVJlc291cmNlcyIsIFtoYW5kbGVyLCB0YXNrXSk7CiAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgfQogICAgICBjb25zdCBbbnVtUGFnZXMsIGZpbmdlcnByaW50c10gPSBhd2FpdCBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVEb2MoIm51bVBhZ2VzIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJmaW5nZXJwcmludHMiKV0pOwogICAgICBjb25zdCBodG1sRm9yWGZhID0gaXNQdXJlWGZhID8gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImh0bWxGb3JYZmEiKSA6IG51bGw7CiAgICAgIHJldHVybiB7CiAgICAgICAgbnVtUGFnZXMsCiAgICAgICAgZmluZ2VycHJpbnRzLAogICAgICAgIGh0bWxGb3JYZmEKICAgICAgfTsKICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIGdldFBkZk1hbmFnZXIoewogICAgICBkYXRhLAogICAgICBwYXNzd29yZCwKICAgICAgZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgcmFuZ2VDaHVua1NpemUsCiAgICAgIGxlbmd0aCwKICAgICAgZG9jQmFzZVVybCwKICAgICAgZW5hYmxlWGZhLAogICAgICBldmFsdWF0b3JPcHRpb25zCiAgICB9KSB7CiAgICAgIGNvbnN0IHBkZk1hbmFnZXJBcmdzID0gewogICAgICAgIHNvdXJjZTogbnVsbCwKICAgICAgICBkaXNhYmxlQXV0b0ZldGNoLAogICAgICAgIGRvY0Jhc2VVcmwsCiAgICAgICAgZG9jSWQsCiAgICAgICAgZW5hYmxlWGZhLAogICAgICAgIGV2YWx1YXRvck9wdGlvbnMsCiAgICAgICAgaGFuZGxlciwKICAgICAgICBsZW5ndGgsCiAgICAgICAgcGFzc3dvcmQsCiAgICAgICAgcmFuZ2VDaHVua1NpemUKICAgICAgfTsKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBwZGZNYW5hZ2VyQXJncy5zb3VyY2UgPSBkYXRhOwogICAgICAgIHJldHVybiBuZXcgTG9jYWxQZGZNYW5hZ2VyKHBkZk1hbmFnZXJBcmdzKTsKICAgICAgfQogICAgICBjb25zdCBwZGZTdHJlYW0gPSBuZXcgUERGV29ya2VyU3RyZWFtKGhhbmRsZXIpLAogICAgICAgIGZ1bGxSZXF1ZXN0ID0gcGRmU3RyZWFtLmdldEZ1bGxSZWFkZXIoKTsKICAgICAgY29uc3QgcGRmTWFuYWdlckNhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgICAgbGV0IG5ld1BkZk1hbmFnZXIsCiAgICAgICAgY2FjaGVkQ2h1bmtzID0gW10sCiAgICAgICAgbG9hZGVkID0gMDsKICAgICAgZnVsbFJlcXVlc3QuaGVhZGVyc1JlYWR5LnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghZnVsbFJlcXVlc3QuaXNSYW5nZVN1cHBvcnRlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBwZGZNYW5hZ2VyQXJncy5zb3VyY2UgPSBwZGZTdHJlYW07CiAgICAgICAgcGRmTWFuYWdlckFyZ3MubGVuZ3RoID0gZnVsbFJlcXVlc3QuY29udGVudExlbmd0aDsKICAgICAgICBwZGZNYW5hZ2VyQXJncy5kaXNhYmxlQXV0b0ZldGNoIHx8PSBmdWxsUmVxdWVzdC5pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICAgICAgICBuZXdQZGZNYW5hZ2VyID0gbmV3IE5ldHdvcmtQZGZNYW5hZ2VyKHBkZk1hbmFnZXJBcmdzKTsKICAgICAgICBmb3IgKGNvbnN0IGNodW5rIG9mIGNhY2hlZENodW5rcykgewogICAgICAgICAgbmV3UGRmTWFuYWdlci5zZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKTsKICAgICAgICB9CiAgICAgICAgY2FjaGVkQ2h1bmtzID0gW107CiAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVzb2x2ZShuZXdQZGZNYW5hZ2VyKTsKICAgICAgICBjYW5jZWxYSFJzID0gbnVsbDsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlamVjdChyZWFzb24pOwogICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICB9KTsKICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGNvbnN0IHJlYWRDaHVuayA9IGZ1bmN0aW9uICh7CiAgICAgICAgICB2YWx1ZSwKICAgICAgICAgIGRvbmUKICAgICAgICB9KSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgaWYgKCFuZXdQZGZNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwZGZGaWxlID0gYXJyYXlCdWZmZXJzVG9CeXRlcyhjYWNoZWRDaHVua3MpOwogICAgICAgICAgICAgICAgY2FjaGVkQ2h1bmtzID0gW107CiAgICAgICAgICAgICAgICBpZiAobGVuZ3RoICYmIHBkZkZpbGUubGVuZ3RoICE9PSBsZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgd2FybigicmVwb3J0ZWQgSFRUUCBsZW5ndGggaXMgZGlmZmVyZW50IGZyb20gYWN0dWFsIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwZGZNYW5hZ2VyQXJncy5zb3VyY2UgPSBwZGZGaWxlOwogICAgICAgICAgICAgICAgbmV3UGRmTWFuYWdlciA9IG5ldyBMb2NhbFBkZk1hbmFnZXIocGRmTWFuYWdlckFyZ3MpOwogICAgICAgICAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVzb2x2ZShuZXdQZGZNYW5hZ2VyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FuY2VsWEhScyA9IG51bGw7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvYWRlZCArPSB2YWx1ZS5ieXRlTGVuZ3RoOwogICAgICAgICAgICBpZiAoIWZ1bGxSZXF1ZXN0LmlzU3RyZWFtaW5nU3VwcG9ydGVkKSB7CiAgICAgICAgICAgICAgaGFuZGxlci5zZW5kKCJEb2NQcm9ncmVzcyIsIHsKICAgICAgICAgICAgICAgIGxvYWRlZCwKICAgICAgICAgICAgICAgIHRvdGFsOiBNYXRoLm1heChsb2FkZWQsIGZ1bGxSZXF1ZXN0LmNvbnRlbnRMZW5ndGggfHwgMCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV3UGRmTWFuYWdlcikgewogICAgICAgICAgICAgIG5ld1BkZk1hbmFnZXIuc2VuZFByb2dyZXNzaXZlRGF0YSh2YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY2FjaGVkQ2h1bmtzLnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bGxSZXF1ZXN0LnJlYWQoKS50aGVuKHJlYWRDaHVuaywgcmVqZWN0KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZnVsbFJlcXVlc3QucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlamVjdChlKTsKICAgICAgICBjYW5jZWxYSFJzID0gbnVsbDsKICAgICAgfSk7CiAgICAgIGNhbmNlbFhIUnMgPSByZWFzb24gPT4gewogICAgICAgIHBkZlN0cmVhbS5jYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pOwogICAgICB9OwogICAgICByZXR1cm4gcGRmTWFuYWdlckNhcGFiaWxpdHkucHJvbWlzZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldHVwRG9jKGRhdGEpIHsKICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKGRvYykgewogICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICBoYW5kbGVyLnNlbmQoIkdldERvYyIsIHsKICAgICAgICAgIHBkZkluZm86IGRvYwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9uRmFpbHVyZShleCkgewogICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBQYXNzd29yZEV4Y2VwdGlvbikgewogICAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBQYXNzd29yZEV4Y2VwdGlvbjogcmVzcG9uc2UgJHtleC5jb2RlfWApOwogICAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIlBhc3N3b3JkUmVxdWVzdCIsIGV4KS50aGVuKGZ1bmN0aW9uICh7CiAgICAgICAgICAgIHBhc3N3b3JkCiAgICAgICAgICB9KSB7CiAgICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgIHBkZk1hbmFnZXIudXBkYXRlUGFzc3dvcmQocGFzc3dvcmQpOwogICAgICAgICAgICBwZGZNYW5hZ2VyUmVhZHkoKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgaGFuZGxlci5zZW5kKCJEb2NFeGNlcHRpb24iLCBleCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaGFuZGxlci5zZW5kKCJEb2NFeGNlcHRpb24iLCB3cmFwUmVhc29uKGV4KSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBkZk1hbmFnZXJSZWFkeSgpIHsKICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgbG9hZERvY3VtZW50KGZhbHNlKS50aGVuKG9uU3VjY2VzcywgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgICAgaWYgKCEocmVhc29uIGluc3RhbmNlb2YgWFJlZlBhcnNlRXhjZXB0aW9uKSkgewogICAgICAgICAgICBvbkZhaWx1cmUocmVhc29uKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgcGRmTWFuYWdlci5yZXF1ZXN0TG9hZGVkU3RyZWFtKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICAgICAgbG9hZERvY3VtZW50KHRydWUpLnRoZW4ob25TdWNjZXNzLCBvbkZhaWx1cmUpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICBnZXRQZGZNYW5hZ2VyKGRhdGEpLnRoZW4oZnVuY3Rpb24gKG5ld1BkZk1hbmFnZXIpIHsKICAgICAgICBpZiAodGVybWluYXRlZCkgewogICAgICAgICAgbmV3UGRmTWFuYWdlci50ZXJtaW5hdGUobmV3IEFib3J0RXhjZXB0aW9uKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQuIikpOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQiKTsKICAgICAgICB9CiAgICAgICAgcGRmTWFuYWdlciA9IG5ld1BkZk1hbmFnZXI7CiAgICAgICAgcGRmTWFuYWdlci5yZXF1ZXN0TG9hZGVkU3RyZWFtKHRydWUpLnRoZW4oc3RyZWFtID0+IHsKICAgICAgICAgIGhhbmRsZXIuc2VuZCgiRGF0YUxvYWRlZCIsIHsKICAgICAgICAgICAgbGVuZ3RoOiBzdHJlYW0uYnl0ZXMuYnl0ZUxlbmd0aAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pLnRoZW4ocGRmTWFuYWdlclJlYWR5LCBvbkZhaWx1cmUpOwogICAgfQogICAgaGFuZGxlci5vbigiR2V0UGFnZSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmdldFBhZ2UoZGF0YS5wYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3BkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJyb3RhdGUiKSwgcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgInJlZiIpLCBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAidXNlclVuaXQiKSwgcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgInZpZXciKV0pLnRoZW4oZnVuY3Rpb24gKFtyb3RhdGUsIHJlZiwgdXNlclVuaXQsIHZpZXddKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICByb3RhdGUsCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgcmVmU3RyOiByZWY/LnRvU3RyaW5nKCkgPz8gbnVsbCwKICAgICAgICAgICAgdXNlclVuaXQsCiAgICAgICAgICAgIHZpZXcKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQYWdlSW5kZXgiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICBjb25zdCBwYWdlUmVmID0gUmVmLmdldChkYXRhLm51bSwgZGF0YS5nZW4pOwogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJnZXRQYWdlSW5kZXgiLCBbcGFnZVJlZl0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXREZXN0aW5hdGlvbnMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJkZXN0aW5hdGlvbnMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RGVzdGluYXRpb24iLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJnZXREZXN0aW5hdGlvbiIsIFtkYXRhLmlkXSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFBhZ2VMYWJlbHMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJwYWdlTGFiZWxzIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFBhZ2VMYXlvdXQiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJwYWdlTGF5b3V0Iik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFBhZ2VNb2RlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygicGFnZU1vZGUiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0Vmlld2VyUHJlZmVyZW5jZXMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJ2aWV3ZXJQcmVmZXJlbmNlcyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRPcGVuQWN0aW9uIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygib3BlbkFjdGlvbiIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRBdHRhY2htZW50cyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImF0dGFjaG1lbnRzIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldERvY0pTQWN0aW9ucyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImpzQWN0aW9ucyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQYWdlSlNBY3Rpb25zIiwgZnVuY3Rpb24gKHsKICAgICAgcGFnZUluZGV4CiAgICB9KSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKHBhZ2UgPT4gcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgImpzQWN0aW9ucyIpKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0QW5ub3RhdGlvbnNCeVR5cGUiLCBhc3luYyBmdW5jdGlvbiAoewogICAgICB0eXBlcywKICAgICAgcGFnZUluZGV4ZXNUb1NraXAKICAgIH0pIHsKICAgICAgY29uc3QgW251bVBhZ2VzLCBhbm5vdGF0aW9uR2xvYmFsc10gPSBhd2FpdCBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVEb2MoIm51bVBhZ2VzIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJhbm5vdGF0aW9uR2xvYmFscyIpXSk7CiAgICAgIGlmICghYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBwYWdlUHJvbWlzZXMgPSBbXTsKICAgICAgY29uc3QgYW5ub3RhdGlvblByb21pc2VzID0gW107CiAgICAgIGxldCB0YXNrID0gbnVsbDsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBudW1QYWdlczsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGlmIChwYWdlSW5kZXhlc1RvU2tpcD8uaGFzKGkpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCF0YXNrKSB7CiAgICAgICAgICAgIHRhc2sgPSBuZXcgV29ya2VyVGFzaygiR2V0QW5ub3RhdGlvbnNCeVR5cGUiKTsKICAgICAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgfQogICAgICAgICAgcGFnZVByb21pc2VzLnB1c2gocGRmTWFuYWdlci5nZXRQYWdlKGkpLnRoZW4oYXN5bmMgcGFnZSA9PiB7CiAgICAgICAgICAgIGlmICghcGFnZSkgewogICAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcGFnZS5jb2xsZWN0QW5ub3RhdGlvbnNCeVR5cGUoaGFuZGxlciwgdGFzaywgdHlwZXMsIGFubm90YXRpb25Qcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMpIHx8IFtdOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwYWdlUHJvbWlzZXMpOwogICAgICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgUHJvbWlzZS5hbGwoYW5ub3RhdGlvblByb21pc2VzKTsKICAgICAgICByZXR1cm4gYW5ub3RhdGlvbnMuZmlsdGVyKGEgPT4gISFhKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBpZiAodGFzaykgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0T3V0bGluZSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImRvY3VtZW50T3V0bGluZSIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRPcHRpb25hbENvbnRlbnRDb25maWciLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJvcHRpb25hbENvbnRlbnRDb25maWciKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGVybWlzc2lvbnMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJwZXJtaXNzaW9ucyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRNZXRhZGF0YSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVEb2MoImRvY3VtZW50SW5mbyIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coIm1ldGFkYXRhIildKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0TWFya0luZm8iLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJtYXJrSW5mbyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXREYXRhIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIucmVxdWVzdExvYWRlZFN0cmVhbSgpLnRoZW4oc3RyZWFtID0+IHN0cmVhbS5ieXRlcyk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldEFubm90YXRpb25zIiwgZnVuY3Rpb24gKHsKICAgICAgcGFnZUluZGV4LAogICAgICBpbnRlbnQKICAgIH0pIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYEdldEFubm90YXRpb25zOiBwYWdlICR7cGFnZUluZGV4fWApOwogICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICByZXR1cm4gcGFnZS5nZXRBbm5vdGF0aW9uc0RhdGEoaGFuZGxlciwgdGFzaywgaW50ZW50KS50aGVuKGRhdGEgPT4gewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgIH0sIHJlYXNvbiA9PiB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RmllbGRPYmplY3RzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJmaWVsZE9iamVjdHMiKS50aGVuKGZpZWxkT2JqZWN0cyA9PiBmaWVsZE9iamVjdHM/LmFsbEZpZWxkcyB8fCBudWxsKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiSGFzSlNBY3Rpb25zIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJoYXNKU0FjdGlvbnMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0Q2FsY3VsYXRpb25PcmRlcklkcyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2FsY3VsYXRpb25PcmRlcklkcyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJTYXZlRG9jdW1lbnQiLCBhc3luYyBmdW5jdGlvbiAoewogICAgICBpc1B1cmVYZmEsCiAgICAgIG51bVBhZ2VzLAogICAgICBhbm5vdGF0aW9uU3RvcmFnZSwKICAgICAgZmlsZW5hbWUKICAgIH0pIHsKICAgICAgY29uc3QgZ2xvYmFsUHJvbWlzZXMgPSBbcGRmTWFuYWdlci5yZXF1ZXN0TG9hZGVkU3RyZWFtKCksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYWNyb0Zvcm0iKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhY3JvRm9ybVJlZiIpLCBwZGZNYW5hZ2VyLmVuc3VyZURvYygic3RhcnRYUmVmIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJ4cmVmIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygic3RydWN0VHJlZVJvb3QiKV07CiAgICAgIGNvbnN0IGNoYW5nZXMgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgY29uc3QgbmV3QW5ub3RhdGlvbnNCeVBhZ2UgPSAhaXNQdXJlWGZhID8gZ2V0TmV3QW5ub3RhdGlvbnNNYXAoYW5ub3RhdGlvblN0b3JhZ2UpIDogbnVsbDsKICAgICAgY29uc3QgW3N0cmVhbSwgYWNyb0Zvcm0sIGFjcm9Gb3JtUmVmLCBzdGFydFhSZWYsIHhyZWYsIF9zdHJ1Y3RUcmVlUm9vdF0gPSBhd2FpdCBQcm9taXNlLmFsbChnbG9iYWxQcm9taXNlcyk7CiAgICAgIGNvbnN0IGNhdGFsb2dSZWYgPSB4cmVmLnRyYWlsZXIuZ2V0UmF3KCJSb290IikgfHwgbnVsbDsKICAgICAgbGV0IHN0cnVjdFRyZWVSb290OwogICAgICBpZiAobmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgICBpZiAoIV9zdHJ1Y3RUcmVlUm9vdCkgewogICAgICAgICAgaWYgKGF3YWl0IFN0cnVjdFRyZWVSb290LmNhbkNyZWF0ZVN0cnVjdHVyZVRyZWUoewogICAgICAgICAgICBjYXRhbG9nUmVmLAogICAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZQogICAgICAgICAgfSkpIHsKICAgICAgICAgICAgc3RydWN0VHJlZVJvb3QgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYXdhaXQgX3N0cnVjdFRyZWVSb290LmNhblVwZGF0ZVN0cnVjdFRyZWUoewogICAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlCiAgICAgICAgfSkpIHsKICAgICAgICAgIHN0cnVjdFRyZWVSb290ID0gX3N0cnVjdFRyZWVSb290OwogICAgICAgIH0KICAgICAgICBjb25zdCBpbWFnZVByb21pc2VzID0gQW5ub3RhdGlvbkZhY3RvcnkuZ2VuZXJhdGVJbWFnZXMoYW5ub3RhdGlvblN0b3JhZ2UudmFsdWVzKCksIHhyZWYsIHBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCk7CiAgICAgICAgY29uc3QgbmV3QW5ub3RhdGlvblByb21pc2VzID0gc3RydWN0VHJlZVJvb3QgPT09IHVuZGVmaW5lZCA/IHByb21pc2VzIDogW107CiAgICAgICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBhbm5vdGF0aW9uc10gb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgICAgIG5ld0Fubm90YXRpb25Qcm9taXNlcy5wdXNoKHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4ocGFnZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgV29ya2VyVGFzayhgU2F2ZSAoZWRpdG9yKTogcGFnZSAke3BhZ2VJbmRleH1gKTsKICAgICAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgICByZXR1cm4gcGFnZS5zYXZlTmV3QW5ub3RhdGlvbnMoaGFuZGxlciwgdGFzaywgYW5ub3RhdGlvbnMsIGltYWdlUHJvbWlzZXMsIGNoYW5nZXMpLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RydWN0VHJlZVJvb3QgPT09IG51bGwpIHsKICAgICAgICAgIHByb21pc2VzLnB1c2goUHJvbWlzZS5hbGwobmV3QW5ub3RhdGlvblByb21pc2VzKS50aGVuKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgYXdhaXQgU3RydWN0VHJlZVJvb3QuY3JlYXRlU3RydWN0dXJlVHJlZSh7CiAgICAgICAgICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICAgICAgICAgICAgeHJlZiwKICAgICAgICAgICAgICBjYXRhbG9nUmVmLAogICAgICAgICAgICAgIHBkZk1hbmFnZXIsCiAgICAgICAgICAgICAgY2hhbmdlcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKICAgICAgICB9IGVsc2UgaWYgKHN0cnVjdFRyZWVSb290KSB7CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFByb21pc2UuYWxsKG5ld0Fubm90YXRpb25Qcm9taXNlcykudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGF3YWl0IHN0cnVjdFRyZWVSb290LnVwZGF0ZVN0cnVjdHVyZVRyZWUoewogICAgICAgICAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgICAgICAgICAgIHBkZk1hbmFnZXIsCiAgICAgICAgICAgICAgY2hhbmdlcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGlzUHVyZVhmYSkgewogICAgICAgIHByb21pc2VzLnB1c2gocGRmTWFuYWdlci5lbnN1cmVEb2MoInNlcmlhbGl6ZVhmYURhdGEiLCBbYW5ub3RhdGlvblN0b3JhZ2VdKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgcGFnZUluZGV4ID0gMDsgcGFnZUluZGV4IDwgbnVtUGFnZXM7IHBhZ2VJbmRleCsrKSB7CiAgICAgICAgICBwcm9taXNlcy5wdXNoKHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBTYXZlOiBwYWdlICR7cGFnZUluZGV4fWApOwogICAgICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgIHJldHVybiBwYWdlLnNhdmUoaGFuZGxlciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCByZWZzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICBsZXQgeGZhRGF0YSA9IG51bGw7CiAgICAgIGlmIChpc1B1cmVYZmEpIHsKICAgICAgICB4ZmFEYXRhID0gcmVmc1swXTsKICAgICAgICBpZiAoIXhmYURhdGEpIHsKICAgICAgICAgIHJldHVybiBzdHJlYW0uYnl0ZXM7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNoYW5nZXMuc2l6ZSA9PT0gMCkgewogICAgICAgIHJldHVybiBzdHJlYW0uYnl0ZXM7CiAgICAgIH0KICAgICAgY29uc3QgbmVlZEFwcGVhcmFuY2VzID0gYWNyb0Zvcm1SZWYgJiYgYWNyb0Zvcm0gaW5zdGFuY2VvZiBEaWN0ICYmIGNoYW5nZXMudmFsdWVzKCkuc29tZShyZWYgPT4gcmVmLm5lZWRBcHBlYXJhbmNlcyk7CiAgICAgIGNvbnN0IHhmYSA9IGFjcm9Gb3JtIGluc3RhbmNlb2YgRGljdCAmJiBhY3JvRm9ybS5nZXQoIlhGQSIpIHx8IG51bGw7CiAgICAgIGxldCB4ZmFEYXRhc2V0c1JlZiA9IG51bGw7CiAgICAgIGxldCBoYXNYZmFEYXRhc2V0c0VudHJ5ID0gZmFsc2U7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHhmYSkpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB4ZmEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgICAgaWYgKHhmYVtpXSA9PT0gImRhdGFzZXRzIikgewogICAgICAgICAgICB4ZmFEYXRhc2V0c1JlZiA9IHhmYVtpICsgMV07CiAgICAgICAgICAgIGhhc1hmYURhdGFzZXRzRW50cnkgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoeGZhRGF0YXNldHNSZWYgPT09IG51bGwpIHsKICAgICAgICAgIHhmYURhdGFzZXRzUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoeGZhKSB7CiAgICAgICAgd2FybigiVW5zdXBwb3J0ZWQgWEZBIHR5cGUuIik7CiAgICAgIH0KICAgICAgbGV0IG5ld1hyZWZJbmZvID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgaWYgKHhyZWYudHJhaWxlcikgewogICAgICAgIGNvbnN0IGluZm9NYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgY29uc3QgeHJlZkluZm8gPSB4cmVmLnRyYWlsZXIuZ2V0KCJJbmZvIikgfHwgbnVsbDsKICAgICAgICBpZiAoeHJlZkluZm8gaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB4cmVmSW5mbykgewogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIGluZm9NYXAuc2V0KGtleSwgc3RyaW5nVG9QREZTdHJpbmcodmFsdWUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBuZXdYcmVmSW5mbyA9IHsKICAgICAgICAgIHJvb3RSZWY6IGNhdGFsb2dSZWYsCiAgICAgICAgICBlbmNyeXB0UmVmOiB4cmVmLnRyYWlsZXIuZ2V0UmF3KCJFbmNyeXB0IikgfHwgbnVsbCwKICAgICAgICAgIG5ld1JlZjogeHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKSwKICAgICAgICAgIGluZm9SZWY6IHhyZWYudHJhaWxlci5nZXRSYXcoIkluZm8iKSB8fCBudWxsLAogICAgICAgICAgaW5mb01hcCwKICAgICAgICAgIGZpbGVJZHM6IHhyZWYudHJhaWxlci5nZXQoIklEIikgfHwgbnVsbCwKICAgICAgICAgIHN0YXJ0WFJlZiwKICAgICAgICAgIGZpbGVuYW1lCiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gaW5jcmVtZW50YWxVcGRhdGUoewogICAgICAgIG9yaWdpbmFsRGF0YTogc3RyZWFtLmJ5dGVzLAogICAgICAgIHhyZWZJbmZvOiBuZXdYcmVmSW5mbywKICAgICAgICBjaGFuZ2VzLAogICAgICAgIHhyZWYsCiAgICAgICAgaGFzWGZhOiAhIXhmYSwKICAgICAgICB4ZmFEYXRhc2V0c1JlZiwKICAgICAgICBoYXNYZmFEYXRhc2V0c0VudHJ5LAogICAgICAgIG5lZWRBcHBlYXJhbmNlcywKICAgICAgICBhY3JvRm9ybVJlZiwKICAgICAgICBhY3JvRm9ybSwKICAgICAgICB4ZmFEYXRhLAogICAgICAgIHVzZVhyZWZTdHJlYW06IGlzRGljdCh4cmVmLnRvcERpY3QsICJYUmVmIikKICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgeHJlZi5yZXNldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0T3BlcmF0b3JMaXN0IiwgZnVuY3Rpb24gKGRhdGEsIHNpbmspIHsKICAgICAgY29uc3QgcGFnZUluZGV4ID0gZGF0YS5wYWdlSW5kZXg7CiAgICAgIHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYEdldE9wZXJhdG9yTGlzdDogcGFnZSAke3BhZ2VJbmRleH1gKTsKICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgY29uc3Qgc3RhcnQgPSB2ZXJib3NpdHkgPj0gVmVyYm9zaXR5TGV2ZWwuSU5GT1MgPyBEYXRlLm5vdygpIDogMDsKICAgICAgICBwYWdlLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgICAgICBoYW5kbGVyLAogICAgICAgICAgc2luaywKICAgICAgICAgIHRhc2ssCiAgICAgICAgICBpbnRlbnQ6IGRhdGEuaW50ZW50LAogICAgICAgICAgY2FjaGVLZXk6IGRhdGEuY2FjaGVLZXksCiAgICAgICAgICBhbm5vdGF0aW9uU3RvcmFnZTogZGF0YS5hbm5vdGF0aW9uU3RvcmFnZSwKICAgICAgICAgIG1vZGlmaWVkSWRzOiBkYXRhLm1vZGlmaWVkSWRzCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAob3BlcmF0b3JMaXN0SW5mbykgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIGlmIChzdGFydCkgewogICAgICAgICAgICBpbmZvKGBwYWdlPSR7cGFnZUluZGV4ICsgMX0gLSBnZXRPcGVyYXRvckxpc3Q6IHRpbWU9YCArIGAke0RhdGUubm93KCkgLSBzdGFydH1tcywgbGVuPSR7b3BlcmF0b3JMaXN0SW5mby5sZW5ndGh9YCk7CiAgICAgICAgICB9CiAgICAgICAgICBzaW5rLmNsb3NlKCk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIGlmICh0YXNrLnRlcm1pbmF0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgc2luay5lcnJvcihyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0VGV4dENvbnRlbnQiLCBmdW5jdGlvbiAoZGF0YSwgc2luaykgewogICAgICBjb25zdCB7CiAgICAgICAgcGFnZUluZGV4LAogICAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50LAogICAgICAgIGRpc2FibGVOb3JtYWxpemF0aW9uCiAgICAgIH0gPSBkYXRhOwogICAgICBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKCJHZXRUZXh0Q29udGVudDogcGFnZSAiICsgcGFnZUluZGV4KTsKICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgY29uc3Qgc3RhcnQgPSB2ZXJib3NpdHkgPj0gVmVyYm9zaXR5TGV2ZWwuSU5GT1MgPyBEYXRlLm5vdygpIDogMDsKICAgICAgICBwYWdlLmV4dHJhY3RUZXh0Q29udGVudCh7CiAgICAgICAgICBoYW5kbGVyLAogICAgICAgICAgdGFzaywKICAgICAgICAgIHNpbmssCiAgICAgICAgICBpbmNsdWRlTWFya2VkQ29udGVudCwKICAgICAgICAgIGRpc2FibGVOb3JtYWxpemF0aW9uCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgaWYgKHN0YXJ0KSB7CiAgICAgICAgICAgIGluZm8oYHBhZ2U9JHtwYWdlSW5kZXggKyAxfSAtIGdldFRleHRDb250ZW50OiB0aW1lPWAgKyBgJHtEYXRlLm5vdygpIC0gc3RhcnR9bXNgKTsKICAgICAgICAgIH0KICAgICAgICAgIHNpbmsuY2xvc2UoKTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgaWYgKHRhc2sudGVybWluYXRlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBzaW5rLmVycm9yKHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRTdHJ1Y3RUcmVlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShkYXRhLnBhZ2VJbmRleCkudGhlbihwYWdlID0+IHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJnZXRTdHJ1Y3RUcmVlIikpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJGb250RmFsbGJhY2siLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5mb250RmFsbGJhY2soZGF0YS5pZCwgaGFuZGxlcik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkNsZWFudXAiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5jbGVhbnVwKHRydWUpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJUZXJtaW5hdGUiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICB0ZXJtaW5hdGVkID0gdHJ1ZTsKICAgICAgY29uc3Qgd2FpdE9uID0gW107CiAgICAgIGlmIChwZGZNYW5hZ2VyKSB7CiAgICAgICAgcGRmTWFuYWdlci50ZXJtaW5hdGUobmV3IEFib3J0RXhjZXB0aW9uKCJXb3JrZXIgd2FzIHRlcm1pbmF0ZWQuIikpOwogICAgICAgIGNvbnN0IGNsZWFudXBQcm9taXNlID0gcGRmTWFuYWdlci5jbGVhbnVwKCk7CiAgICAgICAgd2FpdE9uLnB1c2goY2xlYW51cFByb21pc2UpOwogICAgICAgIHBkZk1hbmFnZXIgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIGNsZWFyR2xvYmFsQ2FjaGVzKCk7CiAgICAgIH0KICAgICAgY2FuY2VsWEhScz8uKG5ldyBBYm9ydEV4Y2VwdGlvbigiV29ya2VyIHdhcyB0ZXJtaW5hdGVkLiIpKTsKICAgICAgZm9yIChjb25zdCB0YXNrIG9mIFdvcmtlclRhc2tzKSB7CiAgICAgICAgd2FpdE9uLnB1c2godGFzay5maW5pc2hlZCk7CiAgICAgICAgdGFzay50ZXJtaW5hdGUoKTsKICAgICAgfQogICAgICByZXR1cm4gUHJvbWlzZS5hbGwod2FpdE9uKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBoYW5kbGVyLmRlc3Ryb3koKTsKICAgICAgICBoYW5kbGVyID0gbnVsbDsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIlJlYWR5IiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgc2V0dXBEb2MoZG9jUGFyYW1zKTsKICAgICAgZG9jUGFyYW1zID0gbnVsbDsKICAgIH0pOwogICAgcmV0dXJuIHdvcmtlckhhbmRsZXJOYW1lOwogIH0KICBzdGF0aWMgaW5pdGlhbGl6ZUZyb21Qb3J0KHBvcnQpIHsKICAgIGNvbnN0IGhhbmRsZXIgPSBuZXcgTWVzc2FnZUhhbmRsZXIoIndvcmtlciIsICJtYWluIiwgcG9ydCk7CiAgICB0aGlzLnNldHVwKGhhbmRsZXIsIHBvcnQpOwogICAgaGFuZGxlci5zZW5kKCJyZWFkeSIsIG51bGwpOwogIH0KfQoKOy8vIC4vc3JjL3BkZi53b3JrZXIuanMKCmdsb2JhbFRoaXMucGRmanNXb3JrZXIgPSB7CiAgV29ya2VyTWVzc2FnZUhhbmRsZXI6IFdvcmtlck1lc3NhZ2VIYW5kbGVyCn07CgpleHBvcnQgeyBXb3JrZXJNZXNzYWdlSGFuZGxlciB9OwoKLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGRmLndvcmtlci5tanMubWFw", {
  AbortException: ZZ,
  AnnotationEditorLayer: cZ,
  AnnotationEditorParamsType: pG,
  AnnotationEditorType: WI,
  AnnotationEditorUIManager: GZ,
  AnnotationLayer: bZ,
  AnnotationMode: LI,
  AnnotationType: kl,
  applyOpacity: FG,
  build: zG,
  ColorPicker: JG,
  createValidAbsoluteUrl: rl,
  CSSConstants: LG,
  DOMSVGFactory: kG,
  DrawLayer: oZ,
  FeatureTest: mZ,
  fetchData: ni,
  findContrastColor: rG,
  getDocument: TG,
  getFilenameFromUrl: jG,
  getPdfFilenameFromUrl: aZ,
  getRGB: QG,
  getUuid: xG,
  getXfaPageViewport: OG,
  GlobalWorkerOptions: UG,
  ImageKind: vG,
  InvalidPDFException: EG,
  isDataScheme: PG,
  isPdfFile: eZ,
  isValidExplicitDest: tZ,
  MathClamp: jA,
  noContextMenu: fG,
  normalizeUnicode: hZ,
  OPS: _G,
  OutputScale: VC,
  PasswordResponses: qG,
  PDFDataRangeTransport: $G,
  PDFDateString: Ib,
  PDFWorker: gb,
  PermissionFlag: eg,
  PixelsPerInch: TI,
  RenderingCancelledException: wA,
  renderRichText: Cb,
  ResponseException: Ab,
  setLayerDimensions: Tl,
  shadow: HC,
  SignatureExtractor: ib,
  stopEvent: nA,
  SupportedImageMimeTypes: lb,
  TextLayer: BZ,
  TouchManager: sb,
  updateUrlHash: WZ,
  Util: QA,
  VerbosityLevel: db,
  version: Yi,
  XfaLayer: _C
} = globalThis.pdfjsLib, wZ = "auto", jl = 1, Vi = 1.1, nZ = 0.1, YZ = 10, qC = 0, VZ = 1.25, Ni = 40, ui = 5, O = {
  INITIAL: 0,
  RUNNING: 1,
  PAUSED: 2,
  FINISHED: 3
}, ug = {
  UNKNOWN: 0,
  NORMAL: 1,
  CHANGING: 2,
  FULLSCREEN: 3
}, JI = {
  DISABLE: 0,
  ENABLE: 1,
  ENABLE_PERMISSIONS: 2
}, x = {
  UNKNOWN: -1,
  VERTICAL: 0,
  HORIZONTAL: 1,
  WRAPPED: 2,
  PAGE: 3
}, oI = {
  UNKNOWN: -1,
  NONE: 0,
  ODD: 1,
  EVEN: 2
};
function Ql(Z, I, g = !1) {
  let C = Z.offsetParent;
  if (!C) {
    console.error("offsetParent is not set -- cannot scroll");
    return;
  }
  let A = Z.offsetTop + Z.clientTop, i = Z.offsetLeft + Z.clientLeft;
  for (; C.clientHeight === C.scrollHeight && C.clientWidth === C.scrollWidth || g && (C.classList.contains("markedContent") || getComputedStyle(C).overflow === "hidden"); )
    if (A += C.offsetTop, i += C.offsetLeft, C = C.offsetParent, !C)
      return;
  if (I && (I.top !== void 0 && (A += I.top), I.left !== void 0)) {
    if (g) {
      const l = Z.getBoundingClientRect().width, s = jA((C.clientWidth - l) / 2, 20, 400);
      i += I.left - s;
    } else
      i += I.left;
    C.scrollLeft = i;
  }
  C.scrollTop = A;
}
function NZ(Z, I, g = void 0) {
  const C = function(l) {
    i || (i = window.requestAnimationFrame(function() {
      i = null;
      const d = Z.scrollLeft, c = A.lastX;
      d !== c && (A.right = d > c), A.lastX = d;
      const G = Z.scrollTop, b = A.lastY;
      G !== b && (A.down = G > b), A.lastY = G, I(A);
    }));
  }, A = {
    right: !0,
    down: !0,
    lastX: Z.scrollLeft,
    lastY: Z.scrollTop,
    _eventHandler: C
  };
  let i = null;
  return Z.addEventListener("scroll", C, {
    useCapture: !0,
    signal: g
  }), g?.addEventListener("abort", () => window.cancelAnimationFrame(i), {
    once: !0
  }), A;
}
function LC(Z) {
  const I = /* @__PURE__ */ new Map();
  for (const [g, C] of new URLSearchParams(Z))
    I.set(g.toLowerCase(), C);
  return I;
}
const Ri = /[\x00-\x1F]/g;
function jg(Z, I = !1) {
  return Ri.test(Z) ? I ? Z.replaceAll(Ri, (g) => g === "\0" ? "" : " ") : Z.replaceAll("\0", "") : Z;
}
function fg(Z, I, g = 0) {
  let C = g, A = Z.length - 1;
  if (A < 0 || !I(Z[A]))
    return Z.length;
  if (I(Z[C]))
    return C;
  for (; C < A; ) {
    const i = C + A >> 1, l = Z[i];
    I(l) ? A = i : C = i + 1;
  }
  return C;
}
function yi(Z) {
  if (Math.floor(Z) === Z)
    return [Z, 1];
  const I = 1 / Z, g = 8;
  if (I > g)
    return [1, g];
  if (Math.floor(I) === I)
    return [1, I];
  const C = Z > 1 ? I : Z;
  let A = 0, i = 1, l = 1, s = 1;
  for (; ; ) {
    const c = A + l, G = i + s;
    if (G > g)
      break;
    C <= c / G ? (l = c, s = G) : (A = c, i = G);
  }
  let d;
  return C - A / i < l / s - C ? d = C === Z ? [A, i] : [i, A] : d = C === Z ? [l, s] : [s, l], d;
}
function eC(Z, I) {
  return Z - Z % I;
}
function uZ(Z, I, g) {
  if (Z < 2)
    return Z;
  let C = I[Z].div, A = C.offsetTop + C.clientTop;
  A >= g && (C = I[Z - 1].div, A = C.offsetTop + C.clientTop);
  for (let i = Z - 2; i >= 0 && (C = I[i].div, !(C.offsetTop + C.clientTop + C.clientHeight <= A)); --i)
    Z = i;
  return Z;
}
function RZ({
  scrollEl: Z,
  views: I,
  sortByVisibility: g = !1,
  horizontal: C = !1,
  rtl: A = !1
}) {
  const i = Z.scrollTop, l = i + Z.clientHeight, s = Z.scrollLeft, d = s + Z.clientWidth;
  function c(W) {
    const B = W.div;
    return B.offsetTop + B.clientTop + B.clientHeight > i;
  }
  function G(W) {
    const B = W.div, w = B.offsetLeft + B.clientLeft, n = w + B.clientWidth;
    return A ? w < d : n > s;
  }
  const b = [], o = /* @__PURE__ */ new Set(), m = I.length;
  let e = fg(I, C ? G : c);
  e > 0 && e < m && !C && (e = uZ(e, I, i));
  let a = C ? d : -1;
  for (let W = e; W < m; W++) {
    const B = I[W], w = B.div, n = w.offsetLeft + w.clientLeft, V = w.offsetTop + w.clientTop, N = w.clientWidth, R = w.clientHeight, Y = n + N, y = V + R;
    if (a === -1)
      y >= l && (a = y);
    else if ((C ? n : V) > a)
      break;
    if (y <= i || V >= l || Y <= s || n >= d)
      continue;
    const X = Math.max(0, i - V), K = Math.max(0, s - n), S = X + Math.max(0, y - l), p = K + Math.max(0, Y - d), r = (R - S) / R, D = (N - p) / N, z = r * D * 100 | 0;
    b.push({
      id: B.id,
      x: n,
      y: V,
      visibleArea: z === 100 ? null : {
        minX: K,
        minY: X,
        maxX: Math.min(Y, d) - n,
        maxY: Math.min(y, l) - V
      },
      view: B,
      percent: z,
      widthPercent: D * 100 | 0
    }), o.add(B.id);
  }
  const h = b[0], t = b.at(-1);
  return g && b.sort(function(W, B) {
    const w = W.percent - B.percent;
    return Math.abs(w) > 1e-3 ? -w : W.id - B.id;
  }), {
    first: h,
    last: t,
    views: b,
    ids: o
  };
}
function xl(Z) {
  return Number.isInteger(Z) && Z % 90 === 0;
}
function yZ(Z) {
  return Number.isInteger(Z) && Object.values(x).includes(Z) && Z !== x.UNKNOWN;
}
function XZ(Z) {
  return Number.isInteger(Z) && Object.values(oI).includes(Z) && Z !== oI.UNKNOWN;
}
function Xi(Z) {
  return Z.width <= Z.height;
}
new Promise(function(Z) {
  window.requestAnimationFrame(Z);
});
const HZ = document.documentElement.style;
class MZ {
  #I = null;
  #g = null;
  #A = 0;
  #C = null;
  #i = !0;
  constructor(I) {
    this.#I = I.classList, this.#C = I.style;
  }
  get percent() {
    return this.#A;
  }
  set percent(I) {
    if (this.#A = jA(I, 0, 100), isNaN(I)) {
      this.#I.add("indeterminate");
      return;
    }
    this.#I.remove("indeterminate"), this.#C.setProperty("--progressBar-percent", `${this.#A}%`);
  }
  setWidth(I) {
    if (!I)
      return;
    const C = I.parentNode.offsetWidth - I.offsetWidth;
    C > 0 && this.#C.setProperty("--progressBar-end-offset", `${C}px`);
  }
  setDisableAutoFetch(I = 5e3) {
    this.#A === 100 || isNaN(this.#A) || (this.#g && clearTimeout(this.#g), this.show(), this.#g = setTimeout(() => {
      this.#g = null, this.hide();
    }, I));
  }
  hide() {
    this.#i && (this.#i = !1, this.#I.add("hidden"));
  }
  show() {
    this.#i || (this.#i = !0, this.#I.remove("hidden"));
  }
}
function DZ(Z) {
  let I = x.VERTICAL, g = oI.NONE;
  switch (Z) {
    case "SinglePage":
      I = x.PAGE;
      break;
    case "OneColumn":
      break;
    case "TwoPageLeft":
      I = x.PAGE;
    case "TwoColumnLeft":
      g = oI.ODD;
      break;
    case "TwoPageRight":
      I = x.PAGE;
    case "TwoColumnRight":
      g = oI.EVEN;
      break;
  }
  return {
    scrollMode: I,
    spreadMode: g
  };
}
const tC = (function() {
  const Z = document.createElement("div");
  return Z.style.width = "round(down, calc(1.6666666666666665 * 792px), 1px)", Z.style.width === "calc(1320px)" ? Math.fround : (I) => I;
})(), XI = {
  SPACE: 0,
  ALPHA_LETTER: 1,
  PUNCT: 2,
  HAN_LETTER: 3,
  KATAKANA_LETTER: 4,
  HIRAGANA_LETTER: 5,
  HALFWIDTH_KATAKANA_LETTER: 6,
  THAI_LETTER: 7
};
function KZ(Z) {
  return Z < 11904;
}
function SZ(Z) {
  return (Z & 65408) === 0;
}
function pZ(Z) {
  return Z >= 97 && Z <= 122 || Z >= 65 && Z <= 90;
}
function FZ(Z) {
  return Z >= 48 && Z <= 57;
}
function zZ(Z) {
  return Z === 32 || Z === 9 || Z === 13 || Z === 10;
}
function JZ(Z) {
  return Z >= 13312 && Z <= 40959 || Z >= 63744 && Z <= 64255;
}
function LZ(Z) {
  return Z >= 12448 && Z <= 12543;
}
function kZ(Z) {
  return Z >= 12352 && Z <= 12447;
}
function rZ(Z) {
  return Z >= 65376 && Z <= 65439;
}
function TZ(Z) {
  return (Z & 65408) === 3584;
}
function hC(Z) {
  return KZ(Z) ? SZ(Z) ? zZ(Z) ? XI.SPACE : pZ(Z) || FZ(Z) || Z === 95 ? XI.ALPHA_LETTER : XI.PUNCT : TZ(Z) ? XI.THAI_LETTER : Z === 160 ? XI.SPACE : XI.ALPHA_LETTER : JZ(Z) ? XI.HAN_LETTER : LZ(Z) ? XI.KATAKANA_LETTER : kZ(Z) ? XI.HIRAGANA_LETTER : rZ(Z) ? XI.HALFWIDTH_KATAKANA_LETTER : XI.ALPHA_LETTER;
}
let Hi;
function jZ() {
  return Hi ||= " ¨ª¯²-µ¸-º¼-¾Ĳ-ĳĿ-ŀŉſǄ-ǌǱ-ǳʰ-ʸ˘-˝ˠ-ˤʹͺ;΄-΅·ϐ-ϖϰ-ϲϴ-ϵϹևٵ-ٸक़-य़ড়-ঢ়য়ਲ਼ਸ਼ਖ਼-ਜ਼ਫ਼ଡ଼-ଢ଼ำຳໜ-ໝ༌གྷཌྷདྷབྷཛྷཀྵჼᴬ-ᴮᴰ-ᴺᴼ-ᵍᵏ-ᵪᵸᶛ-ᶿẚ-ẛάέήίόύώΆ᾽-῁ΈΉ῍-῏ΐΊ῝-῟ΰΎ῭-`ΌΏ´-῾ - ‑‗․-… ″-‴‶-‷‼‾⁇-⁉⁗ ⁰-ⁱ⁴-₎ₐ-ₜ₨℀-℃℅-ℇ℉-ℓℕ-№ℙ-ℝ℠-™ℤΩℨK-ℭℯ-ℱℳ-ℹ℻-⅀ⅅ-ⅉ⅐-ⅿ↉∬-∭∯-∰〈-〉①-⓪⨌⩴-⩶⫝̸ⱼ-ⱽⵯ⺟⻳⼀-⿕　〶〸-〺゛-゜ゟヿㄱ-ㆎ㆒-㆟㈀-㈞㈠-㉇㉐-㉾㊀-㏿ꚜ-ꚝꝰꟲ-ꟴꟸ-ꟹꭜ-ꭟꭩ豈-嗀塚晴凞-羽蘒諸逸-都飯-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-﷼︐-︙︰-﹄﹇-﹒﹔-﹦﹨-﹫ﹰ-ﹲﹴﹶ-ﻼ！-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ￠-￦", Hi;
}
const fI = {
  FOUND: 0,
  NOT_FOUND: 1,
  WRAPPED: 2,
  PENDING: 3
}, QZ = 250, xZ = -50, Mi = {
  "‐": "-",
  "‘": "'",
  "’": "'",
  "‚": "'",
  "‛": "'",
  "“": '"',
  "”": '"',
  "„": '"',
  "‟": '"',
  "¼": "1/4",
  "½": "1/2",
  "¾": "3/4"
}, Di = /* @__PURE__ */ new Set([12441, 12442, 2381, 2509, 2637, 2765, 2893, 3021, 3149, 3277, 3387, 3388, 3405, 3530, 3642, 3770, 3972, 4153, 4154, 5908, 5940, 6098, 6752, 6980, 7082, 7083, 7154, 7155, 11647, 43014, 43052, 43204, 43347, 43456, 43766, 44013, 3158, 3953, 3954, 3962, 3963, 3964, 3965, 3968, 3956]);
let Ki;
const OZ = new RegExp("\\p{M}+", "gu"), UZ = new RegExp("([.*+?^${}()|[\\]\\\\])|(\\p{P})|(\\s+)|(\\p{M})|(\\p{L})", "gu"), vZ = new RegExp("([^\\p{M}])\\p{M}*$", "u"), EZ = new RegExp("^\\p{M}*([^\\p{M}])", "u"), PZ = /[\uAC00-\uD7AF\uFA6C\uFACF-\uFAD1\uFAD5-\uFAD7]+/g, Si = /* @__PURE__ */ new Map(), fZ = "[\\u1100-\\u1112\\ud7a4-\\ud7af\\ud84a\\ud84c\\ud850\\ud854\\ud857\\ud85f]", pi = /* @__PURE__ */ new Map();
let $C = null, IA = null;
function NC(Z, I = {}) {
  const g = [];
  let C;
  for (; (C = PZ.exec(Z)) !== null; ) {
    let {
      index: W
    } = C;
    for (const B of C[0]) {
      let w = Si.get(B);
      w || (w = B.normalize("NFD").length, Si.set(B, w)), g.push([w, W++]);
    }
  }
  const A = g.length > 0, i = I.ignoreDashEOL ?? !1;
  let l;
  if (!A && $C)
    l = $C;
  else if (A && IA)
    l = IA;
  else {
    const W = Object.keys(Mi).join(""), B = jZ(), N = [`[${W}]`, `[${B}]`, "(?:゙|゚)\\n", "\\p{M}+(?:-\\n)?", "\\p{Ll}-\\n(?=\\p{Ll})|\\p{Lu}-\\n(?=\\p{L})", "\\S-\\n", "(?:\\p{Ideographic}|[぀-ヿ])\\n", "\\n", A ? fZ : "\\u0000"];
    l = new RegExp(N.map((R) => `(${R})`).join("|"), "gum"), A ? IA = l : $C = l;
  }
  const s = [];
  for (; (C = OZ.exec(Z)) !== null; )
    s.push([C[0].length, C.index]);
  let d = Z.normalize("NFD");
  const c = [0, 0];
  let G = 0, b = 0, o = 0, m = 0, e = 0, a = !1;
  d = d.replace(l, (W, B, w, n, V, N, R, Y, y, X, K) => {
    if (K -= m, B) {
      const S = Mi[B], p = S.length;
      for (let r = 1; r < p; r++)
        c.push(K - o + r, o - r);
      return o -= p - 1, S;
    }
    if (w) {
      let S = pi.get(w);
      S || (S = w.normalize("NFKC"), pi.set(w, S));
      const p = S.length;
      for (let r = 1; r < p; r++)
        c.push(K - o + r, o - r);
      return o -= p - 1, S;
    }
    if (n)
      return a = !0, K + e === s[G]?.[1] ? ++G : (c.push(K - 1 - o + 1, o - 1), o -= 1, m += 1), c.push(K - o + 1, o), m += 1, e += 1, n.charAt(0);
    if (V) {
      const S = V.endsWith(`
`), p = S ? V.length - 2 : V.length;
      a = !0;
      let r = p;
      K + e === s[G]?.[1] && (r -= s[G][0], ++G);
      for (let D = 1; D <= r; D++)
        c.push(K - 1 - o + D, o - D);
      return o -= r, m += r, S ? (K += p - 1, c.push(K - o + 1, 1 + o), o += 1, m += 1, e += 1, V.slice(0, p)) : V;
    }
    if (N) {
      if (i)
        return m += 1, e += 1, N.slice(0, -1);
      const S = N.length - 2;
      return c.push(K - o + S, 1 + o), o += 1, m += 1, e += 1, N.slice(0, -2);
    }
    if (R)
      return m += 1, e += 1, R.slice(0, -1);
    if (Y) {
      const S = Y.length - 1;
      return c.push(K - o + S, o), m += 1, e += 1, Y.slice(0, -1);
    }
    if (y)
      return c.push(K - o + 1, o - 1), o -= 1, m += 1, e += 1, " ";
    if (K + e === g[b]?.[1]) {
      const S = g[b][0] - 1;
      ++b;
      for (let p = 1; p <= S; p++)
        c.push(K - (o - p), o - p);
      o -= S, m += S;
    }
    return X;
  }), c.push(d.length, o);
  const h = new Uint32Array(c.length >> 1), t = new Int32Array(c.length >> 1);
  for (let W = 0, B = c.length; W < B; W += 2)
    h[W >> 1] = c[W], t[W >> 1] = c[W + 1];
  return [d, [h, t], a];
}
function Ol(Z, I, g) {
  if (!Z)
    return [I, g];
  const [C, A] = Z, i = I, l = I + g - 1;
  let s = fg(C, (o) => o >= i);
  C[s] > i && --s;
  let d = fg(C, (o) => o >= l, s);
  C[d] > l && --d;
  const c = i + A[s], b = l + A[d] + 1 - c;
  return [c, b];
}
class _Z {
  #I = null;
  #g = !0;
  #A = 0;
  constructor({
    linkService: I,
    eventBus: g,
    updateMatchesCountOnProgress: C = !0
  }) {
    this._linkService = I, this._eventBus = g, this.#g = C, this.onIsPageVisible = null, this.#i(), g._on("find", this.#C.bind(this)), g._on("findbarclose", this.#W.bind(this));
  }
  get highlightMatches() {
    return this._highlightMatches;
  }
  get pageMatches() {
    return this._pageMatches;
  }
  get pageMatchesLength() {
    return this._pageMatchesLength;
  }
  get selected() {
    return this._selected;
  }
  get state() {
    return this.#I;
  }
  setDocument(I) {
    this._pdfDocument && this.#i(), I && (this._pdfDocument = I, this._firstPageCapability.resolve());
  }
  #C(I) {
    if (!I)
      return;
    const g = this._pdfDocument, {
      type: C
    } = I;
    (this.#I === null || this.#s(I)) && (this._dirtyMatch = !0), this.#I = I, C !== "highlightallchange" && this.#w(fI.PENDING), this._firstPageCapability.promise.then(() => {
      if (!this._pdfDocument || g && this._pdfDocument !== g)
        return;
      this.#o();
      const A = !this._highlightMatches, i = !!this._findTimeout;
      this._findTimeout && (clearTimeout(this._findTimeout), this._findTimeout = null), C ? this._dirtyMatch ? this.#t() : C === "again" ? (this.#t(), A && this.#I.highlightAll && this.#m()) : C === "highlightallchange" ? (i ? this.#t() : this._highlightMatches = !0, this.#m()) : this.#t() : this._findTimeout = setTimeout(() => {
        this.#t(), this._findTimeout = null;
      }, QZ);
    });
  }
  scrollMatchIntoView({
    element: I = null,
    selectedLeft: g = 0,
    pageIndex: C = -1,
    matchIndex: A = -1
  }) {
    if (!this._scrollMatches || !I)
      return;
    if (A === -1 || A !== this._selected.matchIdx)
      return;
    if (C === -1 || C !== this._selected.pageIdx)
      return;
    this._scrollMatches = !1, Ql(I, {
      top: xZ,
      left: g
    }, !0);
  }
  #i() {
    this._highlightMatches = !1, this._scrollMatches = !1, this._pdfDocument = null, this._pageMatches = [], this._pageMatchesLength = [], this.#A = 0, this.#I = null, this._selected = {
      pageIdx: -1,
      matchIdx: -1
    }, this._offset = {
      pageIdx: null,
      matchIdx: null,
      wrapped: !1
    }, this._extractTextPromises = [], this._pageContents = [], this._pageDiffs = [], this._hasDiacritics = [], this._matchesCountTotal = 0, this._pagesToSearch = null, this._pendingFindMatches = /* @__PURE__ */ new Set(), this._resumePageIdx = null, this._dirtyMatch = !1, clearTimeout(this._findTimeout), this._findTimeout = null, this._firstPageCapability = Promise.withResolvers();
  }
  get #l() {
    const {
      query: I
    } = this.#I;
    return typeof I == "string" ? (I !== this._rawQuery && (this._rawQuery = I, [this._normalizedQuery] = NC(I)), this._normalizedQuery) : (I || []).filter((g) => !!g).map((g) => NC(g)[0]);
  }
  #s(I) {
    const g = I.query, C = this.#I.query, A = typeof g;
    if (A !== typeof C)
      return !0;
    if (A === "string") {
      if (g !== C)
        return !0;
    } else if (JSON.stringify(g) !== JSON.stringify(C))
      return !0;
    switch (I.type) {
      case "again":
        const l = this._selected.pageIdx + 1, s = this._linkService;
        return l >= 1 && l <= s.pagesCount && l !== s.page && !(this.onIsPageVisible?.(l) ?? !0);
      case "highlightallchange":
        return !1;
    }
    return !0;
  }
  #d(I, g, C) {
    let A = I.slice(0, g).match(vZ);
    if (A) {
      const i = I.charCodeAt(g), l = A[1].charCodeAt(0);
      if (hC(i) === hC(l))
        return !1;
    }
    if (A = I.slice(g + C).match(EZ), A) {
      const i = I.charCodeAt(g + C - 1), l = A[1].charCodeAt(0);
      if (hC(i) === hC(l))
        return !1;
    }
    return !0;
  }
  #c(I, g) {
    const {
      matchDiacritics: C
    } = this.#I;
    let A = !1;
    I = I.replaceAll(UZ, (l, s, d, c, G, b) => s ? `[ ]*\\${s}[ ]*` : d ? `[ ]*${d}[ ]*` : c ? "[ ]+" : C ? G || b : G ? Di.has(G.charCodeAt(0)) ? G : "" : g ? (A = !0, `${b}\\p{M}*`) : b);
    const i = "[ ]*";
    return I.endsWith(i) && (I = I.slice(0, I.length - i.length)), C && g && (Ki ||= String.fromCharCode(...Di), A = !0, I = `${I}(?=[${Ki}]|[^\\p{M}]|$)`), [A, I];
  }
  #Z(I) {
    if (!this.#I)
      return;
    const g = this.#l;
    if (g.length === 0)
      return;
    const C = this._pageContents[I], A = this.match(g, C, I), i = this._pageMatches[I] = [], l = this._pageMatchesLength[I] = [], s = this._pageDiffs[I];
    A?.forEach(({
      index: c,
      length: G
    }) => {
      const [b, o] = Ol(s, c, G);
      o && (i.push(b), l.push(o));
    }), this.#I.highlightAll && this.#b(I), this._resumePageIdx === I && (this._resumePageIdx = null, this.#G());
    const d = i.length;
    this._matchesCountTotal += d, this.#g ? d > 0 && this.#N() : ++this.#A === this._linkService.pagesCount && this.#N();
  }
  match(I, g, C) {
    const A = this._hasDiacritics[C];
    let i = !1;
    if (typeof I == "string" ? [i, I] = this.#c(I, A) : I = I.sort().reverse().map((b) => {
      const [o, m] = this.#c(b, A);
      return i ||= o, `(${m})`;
    }).join("|"), !I)
      return;
    const {
      caseSensitive: l,
      entireWord: s
    } = this.#I, d = `g${i ? "u" : ""}${l ? "" : "i"}`;
    I = new RegExp(I, d);
    const c = [];
    let G;
    for (; (G = I.exec(g)) !== null; )
      s && !this.#d(g, G.index, G[0].length) || c.push({
        index: G.index,
        length: G[0].length
      });
    return c;
  }
  #o() {
    if (this._extractTextPromises.length > 0)
      return;
    let I = Promise.resolve();
    const g = {
      disableNormalization: !0
    }, C = this._pdfDocument;
    for (let A = 0, i = this._linkService.pagesCount; A < i; A++) {
      const {
        promise: l,
        resolve: s
      } = Promise.withResolvers();
      this._extractTextPromises[A] = l, I = I.then(async () => {
        if (C !== this._pdfDocument) {
          s();
          return;
        }
        await C.getPage(A + 1).then((d) => d.getTextContent(g)).then((d) => {
          const c = [];
          for (const G of d.items)
            c.push(G.str), G.hasEOL && c.push(`
`);
          [this._pageContents[A], this._pageDiffs[A], this._hasDiacritics[A]] = NC(c.join("")), s();
        }, (d) => {
          console.error(`Unable to get text content for page ${A + 1}`, d), this._pageContents[A] = "", this._pageDiffs[A] = null, this._hasDiacritics[A] = !1, s();
        });
      });
    }
  }
  #b(I) {
    this._scrollMatches && this._selected.pageIdx === I && (this._linkService.page = I + 1), this._eventBus.dispatch("updatetextlayermatches", {
      source: this,
      pageIndex: I
    });
  }
  #m() {
    this._eventBus.dispatch("updatetextlayermatches", {
      source: this,
      pageIndex: -1
    });
  }
  #t() {
    const I = this.#I.findPrevious, g = this._linkService.page - 1, C = this._linkService.pagesCount;
    if (this._highlightMatches = !0, this._dirtyMatch) {
      this._dirtyMatch = !1, this._selected.pageIdx = this._selected.matchIdx = -1, this._offset.pageIdx = g, this._offset.matchIdx = null, this._offset.wrapped = !1, this._resumePageIdx = null, this._pageMatches.length = 0, this._pageMatchesLength.length = 0, this.#A = 0, this._matchesCountTotal = 0, this.#m();
      for (let l = 0; l < C; l++)
        this._pendingFindMatches.has(l) || (this._pendingFindMatches.add(l), this._extractTextPromises[l].then(() => {
          this._pendingFindMatches.delete(l), this.#Z(l);
        }));
    }
    if (this.#l.length === 0) {
      this.#w(fI.FOUND);
      return;
    }
    if (this._resumePageIdx)
      return;
    const i = this._offset;
    if (this._pagesToSearch = C, i.matchIdx !== null) {
      const l = this._pageMatches[i.pageIdx].length;
      if (!I && i.matchIdx + 1 < l || I && i.matchIdx > 0) {
        i.matchIdx = I ? i.matchIdx - 1 : i.matchIdx + 1, this.#B(!0);
        return;
      }
      this.#e(I);
    }
    this.#G();
  }
  #a(I) {
    const g = this._offset, C = I.length, A = this.#I.findPrevious;
    return C ? (g.matchIdx = A ? C - 1 : 0, this.#B(!0), !0) : (this.#e(A), g.wrapped && (g.matchIdx = null, this._pagesToSearch < 0) ? (this.#B(!1), !0) : !1);
  }
  #G() {
    this._resumePageIdx !== null && console.error("There can only be one pending page.");
    let I = null;
    do {
      const g = this._offset.pageIdx;
      if (I = this._pageMatches[g], !I) {
        this._resumePageIdx = g;
        break;
      }
    } while (!this.#a(I));
  }
  #e(I) {
    const g = this._offset, C = this._linkService.pagesCount;
    g.pageIdx = I ? g.pageIdx - 1 : g.pageIdx + 1, g.matchIdx = null, this._pagesToSearch--, (g.pageIdx >= C || g.pageIdx < 0) && (g.pageIdx = I ? C - 1 : 0, g.wrapped = !0);
  }
  #B(I = !1) {
    let g = fI.NOT_FOUND;
    const C = this._offset.wrapped;
    if (this._offset.wrapped = !1, I) {
      const A = this._selected.pageIdx;
      this._selected.pageIdx = this._offset.pageIdx, this._selected.matchIdx = this._offset.matchIdx, g = C ? fI.WRAPPED : fI.FOUND, A !== -1 && A !== this._selected.pageIdx && this.#b(A);
    }
    this.#w(g, this.#I.findPrevious), this._selected.pageIdx !== -1 && (this._scrollMatches = !0, this.#b(this._selected.pageIdx));
  }
  #W(I) {
    const g = this._pdfDocument;
    this._firstPageCapability.promise.then(() => {
      !this._pdfDocument || g && this._pdfDocument !== g || (this._findTimeout && (clearTimeout(this._findTimeout), this._findTimeout = null), this._resumePageIdx && (this._resumePageIdx = null, this._dirtyMatch = !0), this.#w(fI.FOUND), this._highlightMatches = !1, this.#m());
    });
  }
  #h() {
    const {
      pageIdx: I,
      matchIdx: g
    } = this._selected;
    let C = 0, A = this._matchesCountTotal;
    if (g !== -1) {
      for (let i = 0; i < I; i++)
        C += this._pageMatches[i]?.length || 0;
      C += g + 1;
    }
    return (C < 1 || C > A) && (C = A = 0), {
      current: C,
      total: A
    };
  }
  #N() {
    this._eventBus.dispatch("updatefindmatchescount", {
      source: this,
      matchesCount: this.#h()
    });
  }
  #w(I, g = !1) {
    !this.#g && (this.#A !== this._linkService.pagesCount || I === fI.PENDING) || this._eventBus.dispatch("updatefindcontrolstate", {
      source: this,
      state: I,
      previous: g,
      entireWord: this.#I?.entireWord ?? null,
      matchesCount: this.#h(),
      rawQuery: this.#I?.query ?? null
    });
  }
}
const qZ = "noopener noreferrer nofollow", Ag = {
  NONE: 0,
  SELF: 1,
  BLANK: 2,
  PARENT: 3,
  TOP: 4
};
class Ul {
  externalLinkEnabled = !0;
  constructor({
    eventBus: I,
    externalLinkTarget: g = null,
    externalLinkRel: C = null,
    ignoreDestinationZoom: A = !1
  } = {}) {
    this.eventBus = I, this.externalLinkTarget = g, this.externalLinkRel = C, this._ignoreDestinationZoom = A, this.baseUrl = null, this.pdfDocument = null, this.pdfViewer = null, this.pdfHistory = null;
  }
  setDocument(I, g = null) {
    this.baseUrl = g, this.pdfDocument = I;
  }
  setViewer(I) {
    this.pdfViewer = I;
  }
  setHistory(I) {
    this.pdfHistory = I;
  }
  get pagesCount() {
    return this.pdfDocument ? this.pdfDocument.numPages : 0;
  }
  get page() {
    return this.pdfDocument ? this.pdfViewer.currentPageNumber : 1;
  }
  set page(I) {
    this.pdfDocument && (this.pdfViewer.currentPageNumber = I);
  }
  get rotation() {
    return this.pdfDocument ? this.pdfViewer.pagesRotation : 0;
  }
  set rotation(I) {
    this.pdfDocument && (this.pdfViewer.pagesRotation = I);
  }
  get isInPresentationMode() {
    return this.pdfDocument ? this.pdfViewer.isInPresentationMode : !1;
  }
  async goToDestination(I) {
    if (!this.pdfDocument)
      return;
    let g, C, A;
    if (typeof I == "string" ? (g = I, C = await this.pdfDocument.getDestination(I)) : (g = null, C = await I), !Array.isArray(C)) {
      console.error(`goToDestination: "${C}" is not a valid destination array, for dest="${I}".`);
      return;
    }
    const [i] = C;
    if (i && typeof i == "object") {
      if (A = this.pdfDocument.cachedPageNumber(i), !A)
        try {
          A = await this.pdfDocument.getPageIndex(i) + 1;
        } catch {
          console.error(`goToDestination: "${i}" is not a valid page reference, for dest="${I}".`);
          return;
        }
    } else Number.isInteger(i) && (A = i + 1);
    if (!A || A < 1 || A > this.pagesCount) {
      console.error(`goToDestination: "${A}" is not a valid page number, for dest="${I}".`);
      return;
    }
    this.pdfHistory && (this.pdfHistory.pushCurrentPosition(), this.pdfHistory.push({
      namedDest: g,
      explicitDest: C,
      pageNumber: A
    })), this.pdfViewer.scrollPageIntoView({
      pageNumber: A,
      destArray: C,
      ignoreDestinationZoom: this._ignoreDestinationZoom
    });
    const l = new AbortController();
    this.eventBus._on("textlayerrendered", (s) => {
      s.pageNumber === A && (s.source.textLayer.div.focus(), l.abort());
    }, {
      signal: l.signal
    });
  }
  goToPage(I) {
    if (!this.pdfDocument)
      return;
    const g = typeof I == "string" && this.pdfViewer.pageLabelToPageNumber(I) || I | 0;
    if (!(Number.isInteger(g) && g > 0 && g <= this.pagesCount)) {
      console.error(`PDFLinkService.goToPage: "${I}" is not a valid page.`);
      return;
    }
    this.pdfHistory && (this.pdfHistory.pushCurrentPosition(), this.pdfHistory.pushPage(g)), this.pdfViewer.scrollPageIntoView({
      pageNumber: g
    });
  }
  goToXY(I, g, C, A = {}) {
    this.pdfViewer.scrollPageIntoView({
      pageNumber: I,
      destArray: [null, {
        name: "XYZ"
      }, g, C],
      ignoreDestinationZoom: !0,
      ...A
    });
  }
  addLinkAttributes(I, g, C = !1) {
    if (!g || typeof g != "string")
      throw new Error('A valid "url" parameter must provided.');
    const A = C ? Ag.BLANK : this.externalLinkTarget, i = this.externalLinkRel;
    this.externalLinkEnabled ? I.href = I.title = g : (I.href = "", I.title = `Disabled: ${g}`, I.onclick = () => !1);
    let l = "";
    switch (A) {
      case Ag.NONE:
        break;
      case Ag.SELF:
        l = "_self";
        break;
      case Ag.BLANK:
        l = "_blank";
        break;
      case Ag.PARENT:
        l = "_parent";
        break;
      case Ag.TOP:
        l = "_top";
        break;
    }
    I.target = l, I.rel = typeof i == "string" ? i : qZ;
  }
  getDestinationHash(I) {
    if (typeof I == "string") {
      if (I.length > 0)
        return this.getAnchorUrl("#" + escape(I));
    } else if (Array.isArray(I)) {
      const g = JSON.stringify(I);
      if (g.length > 0)
        return this.getAnchorUrl("#" + escape(g));
    }
    return this.getAnchorUrl("");
  }
  getAnchorUrl(I) {
    return this.baseUrl ? this.baseUrl + I : I;
  }
  setHash(I) {
    if (!this.pdfDocument)
      return;
    let g, C;
    if (I.includes("=")) {
      const A = LC(I);
      if (A.has("search")) {
        const i = A.get("search").replaceAll('"', ""), l = A.get("phrase") === "true";
        this.eventBus.dispatch("findfromurlhash", {
          source: this,
          query: l ? i : i.match(/\S+/g)
        });
      }
      if (A.has("page") && (g = A.get("page") | 0 || 1), A.has("zoom")) {
        const i = A.get("zoom").split(","), l = i[0], s = parseFloat(l);
        l.includes("Fit") ? l === "Fit" || l === "FitB" ? C = [null, {
          name: l
        }] : l === "FitH" || l === "FitBH" || l === "FitV" || l === "FitBV" ? C = [null, {
          name: l
        }, i.length > 1 ? i[1] | 0 : null] : l === "FitR" ? i.length !== 5 ? console.error('PDFLinkService.setHash: Not enough parameters for "FitR".') : C = [null, {
          name: l
        }, i[1] | 0, i[2] | 0, i[3] | 0, i[4] | 0] : console.error(`PDFLinkService.setHash: "${l}" is not a valid zoom value.`) : C = [null, {
          name: "XYZ"
        }, i.length > 1 ? i[1] | 0 : null, i.length > 2 ? i[2] | 0 : null, s ? s / 100 : l];
      }
      C ? this.pdfViewer.scrollPageIntoView({
        pageNumber: g || this.page,
        destArray: C,
        allowNegativeOffset: !0
      }) : g && (this.page = g), A.has("pagemode") && this.eventBus.dispatch("pagemode", {
        source: this,
        mode: A.get("pagemode")
      }), A.has("nameddest") && this.goToDestination(A.get("nameddest"));
      return;
    }
    C = unescape(I);
    try {
      C = JSON.parse(C), Array.isArray(C) || (C = C.toString());
    } catch {
    }
    if (typeof C == "string" || tZ(C)) {
      this.goToDestination(C);
      return;
    }
    console.error(`PDFLinkService.setHash: "${unescape(I)}" is not a valid destination.`);
  }
  executeNamedAction(I) {
    if (this.pdfDocument) {
      switch (I) {
        case "GoBack":
          this.pdfHistory?.back();
          break;
        case "GoForward":
          this.pdfHistory?.forward();
          break;
        case "NextPage":
          this.pdfViewer.nextPage();
          break;
        case "PrevPage":
          this.pdfViewer.previousPage();
          break;
        case "LastPage":
          this.page = this.pagesCount;
          break;
        case "FirstPage":
          this.page = 1;
          break;
      }
      this.eventBus.dispatch("namedaction", {
        source: this,
        action: I
      });
    }
  }
  async executeSetOCGState(I) {
    if (!this.pdfDocument)
      return;
    const g = this.pdfDocument, C = await this.pdfViewer.optionalContentConfigPromise;
    g === this.pdfDocument && (C.setOCGState(I), this.pdfViewer.optionalContentConfigPromise = Promise.resolve(C));
  }
}
class kC extends Ul {
  setDocument(I, g = null) {
  }
}
class vl {
  #I = null;
  #g = null;
  #A = !1;
  #C = null;
  #i = null;
  #l = !1;
  constructor({
    pdfPage: I,
    linkService: g,
    downloadManager: C,
    annotationStorage: A = null,
    imageResourcesPath: i = "",
    renderForms: l = !0,
    enableComment: s = !1,
    commentManager: d = null,
    enableScripting: c = !1,
    hasJSActionsPromise: G = null,
    fieldObjectsPromise: b = null,
    annotationCanvasMap: o = null,
    accessibilityManager: m = null,
    annotationEditorUIManager: e = null,
    onAppend: a = null
  }) {
    this.pdfPage = I, this.linkService = g, this.downloadManager = C, this.imageResourcesPath = i, this.renderForms = l, this.annotationStorage = A, this.enableComment = s, this.#g = d, this.enableScripting = c, this._hasJSActionsPromise = G || Promise.resolve(!1), this._fieldObjectsPromise = b || Promise.resolve(null), this._annotationCanvasMap = o, this._accessibilityManager = m, this._annotationEditorUIManager = e, this.#C = a, this.annotationLayer = null, this.div = null, this._cancelled = !1, this._eventBus = g.eventBus;
  }
  async render({
    viewport: I,
    intent: g = "display",
    structTreeLayer: C = null
  }) {
    if (this.div) {
      if (this._cancelled || !this.annotationLayer)
        return;
      this.annotationLayer.update({
        viewport: I.clone({
          dontFlip: !0
        })
      });
      return;
    }
    const [A, i, l] = await Promise.all([this.pdfPage.getAnnotations({
      intent: g
    }), this._hasJSActionsPromise, this._fieldObjectsPromise]);
    if (this._cancelled)
      return;
    const s = this.div = document.createElement("div");
    if (s.className = "annotationLayer", this.#C?.(s), this.#s(I, C), A.length === 0) {
      this.#I = A, Tl(this.div, I);
      return;
    }
    await this.annotationLayer.render({
      annotations: A,
      imageResourcesPath: this.imageResourcesPath,
      renderForms: this.renderForms,
      downloadManager: this.downloadManager,
      enableComment: this.enableComment,
      enableScripting: this.enableScripting,
      hasJSActions: i,
      fieldObjects: l
    }), this.#I = A, this.linkService.isInPresentationMode && this.#d(ug.FULLSCREEN), this.#i || (this.#i = new AbortController(), this._eventBus?._on("presentationmodechanged", (d) => {
      this.#d(d.state);
    }, {
      signal: this.#i.signal
    }));
  }
  #s(I, g) {
    this.annotationLayer = new bZ({
      div: this.div,
      accessibilityManager: this._accessibilityManager,
      annotationCanvasMap: this._annotationCanvasMap,
      annotationEditorUIManager: this._annotationEditorUIManager,
      annotationStorage: this.annotationStorage,
      page: this.pdfPage,
      viewport: I.clone({
        dontFlip: !0
      }),
      structTreeLayer: g,
      commentManager: this.#g,
      linkService: this.linkService
    });
  }
  cancel() {
    this._cancelled = !0, this.#i?.abort(), this.#i = null;
  }
  hide(I = !1) {
    this.#A = !I, this.div && (this.div.hidden = !0);
  }
  hasEditableAnnotations() {
    return !!this.annotationLayer?.hasEditableAnnotations();
  }
  async injectLinkAnnotations(I) {
    if (this.#I === null)
      throw new Error("`render` method must be called before `injectLinkAnnotations`.");
    if (this._cancelled || this.#l)
      return;
    this.#l = !0;
    const g = this.#I.length ? this.#c(I) : I;
    g.length && (await this.annotationLayer.addLinkAnnotations(g), this.#A || (this.div.hidden = !1));
  }
  #d(I) {
    if (!this.div)
      return;
    let g = !1;
    switch (I) {
      case ug.FULLSCREEN:
        g = !0;
        break;
      case ug.NORMAL:
        break;
      default:
        return;
    }
    for (const C of this.div.childNodes)
      C.hasAttribute("data-internal-link") || (C.inert = g);
  }
  #c(I) {
    function g(i) {
      if (!i.quadPoints)
        return [i.rect];
      const l = [];
      for (let s = 2, d = i.quadPoints.length; s < d; s += 8) {
        const c = i.quadPoints[s], G = i.quadPoints[s + 1], b = i.quadPoints[s + 2], o = i.quadPoints[s + 3];
        l.push([b, o, c, G]);
      }
      return l;
    }
    function C(i, l) {
      const s = [], d = g(i), c = g(l);
      for (const G of d)
        for (const b of c) {
          const o = QA.intersect(G, b);
          o && s.push(o);
        }
      return s;
    }
    function A(i) {
      let l = 0;
      for (const s of i)
        l += Math.abs((s[2] - s[0]) * (s[3] - s[1]));
      return l;
    }
    return I.filter((i) => {
      let l;
      for (const s of this.#I) {
        if (s.annotationType !== kl.LINK || !s.url)
          continue;
        const d = C(s, i);
        if (d.length !== 0 && (l ??= A(g(i)), A(d) / l > 0.5))
          return !1;
      }
      return !0;
    });
  }
}
function Fi(Z, I) {
  const g = document.createElement("a");
  if (!g.click)
    throw new Error('DownloadManager: "a.click()" is not supported.');
  g.href = Z, g.target = "_parent", "download" in g && (g.download = I), (document.body || document.documentElement).append(g), g.click(), g.remove();
}
class $Z {
  #I = /* @__PURE__ */ new WeakMap();
  downloadData(I, g, C) {
    const A = URL.createObjectURL(new Blob([I], {
      type: C
    }));
    Fi(A, g);
  }
  openOrDownloadData(I, g, C = null) {
    const i = eZ(g) ? "application/pdf" : "";
    return this.downloadData(I, g, i), !1;
  }
  download(I, g, C) {
    let A;
    if (I)
      A = URL.createObjectURL(new Blob([I], {
        type: "application/pdf"
      }));
    else {
      if (!rl(g, "http://example.com")) {
        console.error(`download - not a valid URL: ${g}`);
        return;
      }
      A = g + "#pdfjs.action=download";
    }
    Fi(A, C);
  }
}
const zi = {
  EVENT: "event",
  TIMEOUT: "timeout"
};
async function Ic({
  target: Z,
  name: I,
  delay: g = 0
}) {
  if (typeof Z != "object" || !(Number.isInteger(g) && g >= 0))
    throw new Error("waitOnEventOrTimeout - invalid parameters.");
  const {
    promise: C,
    resolve: A
  } = Promise.withResolvers(), i = new AbortController();
  function l(c) {
    i.abort(), clearTimeout(d), A(c);
  }
  const s = Z instanceof El ? "_on" : "addEventListener";
  Z[s](I, l.bind(null, zi.EVENT), {
    signal: i.signal
  });
  const d = setTimeout(l.bind(null, zi.TIMEOUT), g);
  return C;
}
class El {
  #I = /* @__PURE__ */ Object.create(null);
  on(I, g, C = null) {
    this._on(I, g, {
      external: !0,
      once: C?.once,
      signal: C?.signal
    });
  }
  off(I, g, C = null) {
    this._off(I, g);
  }
  dispatch(I, g) {
    const C = this.#I[I];
    if (!C || C.length === 0)
      return;
    let A;
    for (const {
      listener: i,
      external: l,
      once: s
    } of C.slice(0)) {
      if (s && this._off(I, i), l) {
        (A ||= []).push(i);
        continue;
      }
      i(g);
    }
    if (A) {
      for (const i of A)
        i(g);
      A = null;
    }
  }
  _on(I, g, C = null) {
    let A = null;
    if (C?.signal instanceof AbortSignal) {
      const {
        signal: l
      } = C;
      if (l.aborted) {
        console.error("Cannot use an `aborted` signal.");
        return;
      }
      const s = () => this._off(I, g);
      A = () => l.removeEventListener("abort", s), l.addEventListener("abort", s);
    }
    (this.#I[I] ||= []).push({
      listener: g,
      external: C?.external === !0,
      once: C?.once === !0,
      rmAbort: A
    });
  }
  _off(I, g, C = null) {
    const A = this.#I[I];
    if (A)
      for (let i = 0, l = A.length; i < l; i++) {
        const s = A[i];
        if (s.listener === g) {
          s.rmAbort?.(), A.splice(i, 1);
          return;
        }
      }
  }
}
class Rg {
  constructor(I) {
    this.value = I;
  }
  valueOf() {
    return this.value;
  }
}
class lI extends Rg {
  constructor(I = "???") {
    super(I);
  }
  toString(I) {
    return `{${this.value}}`;
  }
}
class OI extends Rg {
  constructor(I, g = {}) {
    super(I), this.opts = g;
  }
  toString(I) {
    if (I)
      try {
        return I.memoizeIntlObject(Intl.NumberFormat, this.opts).format(this.value);
      } catch (g) {
        I.reportError(g);
      }
    return this.value.toString(10);
  }
}
class gg extends Rg {
  static supportsValue(I) {
    if (typeof I == "number" || I instanceof Date) return !0;
    if (I instanceof Rg) return gg.supportsValue(I.valueOf());
    if ("Temporal" in globalThis) {
      const g = globalThis.Temporal;
      if (I instanceof g.Instant || I instanceof g.PlainDateTime || I instanceof g.PlainDate || I instanceof g.PlainMonthDay || I instanceof g.PlainTime || I instanceof g.PlainYearMonth)
        return !0;
    }
    return !1;
  }
  constructor(I, g = {}) {
    I instanceof gg ? (g = {
      ...I.opts,
      ...g
    }, I = I.value) : I instanceof Rg && (I = I.valueOf()), typeof I == "object" && "calendarId" in I && g.calendar === void 0 && (g = {
      ...g,
      calendar: I.calendarId
    }), super(I), this.opts = g;
  }
  [Symbol.toPrimitive](I) {
    return I === "string" ? this.toString() : this.toNumber();
  }
  toNumber() {
    const I = this.value;
    if (typeof I == "number") return I;
    if (I instanceof Date) return I.getTime();
    if ("epochMilliseconds" in I)
      return I.epochMilliseconds;
    if ("toZonedDateTime" in I)
      return I.toZonedDateTime("UTC").epochMilliseconds;
    throw new TypeError("Unwrapping a non-number value as a number");
  }
  toString(I) {
    if (I)
      try {
        return I.memoizeIntlObject(Intl.DateTimeFormat, this.opts).format(this.value);
      } catch (g) {
        I.reportError(g);
      }
    return typeof this.value == "number" || this.value instanceof Date ? new Date(this.value).toISOString() : this.value.toString();
  }
}
const Ji = 100, gc = "⁨", Cc = "⁩";
function Ac(Z, I, g) {
  if (g === I || g instanceof OI && I instanceof OI && g.value === I.value)
    return !0;
  if (I instanceof OI && typeof g == "string") {
    let C = Z.memoizeIntlObject(Intl.PluralRules, I.opts).select(I.value);
    if (g === C)
      return !0;
  }
  return !1;
}
function Li(Z, I, g) {
  return I[g] ? Mg(Z, I[g].value) : (Z.reportError(new RangeError("No default")), new lI());
}
function YA(Z, I) {
  const g = [], C = /* @__PURE__ */ Object.create(null);
  for (const A of I)
    A.type === "narg" ? C[A.name] = _g(Z, A.value) : g.push(_g(Z, A));
  return {
    positional: g,
    named: C
  };
}
function _g(Z, I) {
  switch (I.type) {
    case "str":
      return I.value;
    case "num":
      return new OI(I.value, {
        minimumFractionDigits: I.precision
      });
    case "var":
      return ic(Z, I);
    case "mesg":
      return lc(Z, I);
    case "term":
      return sc(Z, I);
    case "func":
      return dc(Z, I);
    case "select":
      return Zc(Z, I);
    default:
      return new lI();
  }
}
function ic(Z, {
  name: I
}) {
  let g;
  if (Z.params)
    if (Object.prototype.hasOwnProperty.call(Z.params, I))
      g = Z.params[I];
    else
      return new lI(`$${I}`);
  else if (Z.args && Object.prototype.hasOwnProperty.call(Z.args, I))
    g = Z.args[I];
  else
    return Z.reportError(new ReferenceError(`Unknown variable: $${I}`)), new lI(`$${I}`);
  if (g instanceof Rg)
    return g;
  switch (typeof g) {
    case "string":
      return g;
    case "number":
      return new OI(g);
    case "object":
      if (gg.supportsValue(g))
        return new gg(g);
    default:
      return Z.reportError(new TypeError(`Variable type not supported: $${I}, ${typeof g}`)), new lI(`$${I}`);
  }
}
function lc(Z, {
  name: I,
  attr: g
}) {
  const C = Z.bundle._messages.get(I);
  if (!C)
    return Z.reportError(new ReferenceError(`Unknown message: ${I}`)), new lI(I);
  if (g) {
    const A = C.attributes[g];
    return A ? Mg(Z, A) : (Z.reportError(new ReferenceError(`Unknown attribute: ${g}`)), new lI(`${I}.${g}`));
  }
  return C.value ? Mg(Z, C.value) : (Z.reportError(new ReferenceError(`No value: ${I}`)), new lI(I));
}
function sc(Z, {
  name: I,
  attr: g,
  args: C
}) {
  const A = `-${I}`, i = Z.bundle._terms.get(A);
  if (!i)
    return Z.reportError(new ReferenceError(`Unknown term: ${A}`)), new lI(A);
  if (g) {
    const s = i.attributes[g];
    if (s) {
      Z.params = YA(Z, C).named;
      const d = Mg(Z, s);
      return Z.params = null, d;
    }
    return Z.reportError(new ReferenceError(`Unknown attribute: ${g}`)), new lI(`${A}.${g}`);
  }
  Z.params = YA(Z, C).named;
  const l = Mg(Z, i.value);
  return Z.params = null, l;
}
function dc(Z, {
  name: I,
  args: g
}) {
  let C = Z.bundle._functions[I];
  if (!C)
    return Z.reportError(new ReferenceError(`Unknown function: ${I}()`)), new lI(`${I}()`);
  if (typeof C != "function")
    return Z.reportError(new TypeError(`Function ${I}() is not callable`)), new lI(`${I}()`);
  try {
    let A = YA(Z, g);
    return C(A.positional, A.named);
  } catch (A) {
    return Z.reportError(A), new lI(`${I}()`);
  }
}
function Zc(Z, {
  selector: I,
  variants: g,
  star: C
}) {
  let A = _g(Z, I);
  if (A instanceof lI)
    return Li(Z, g, C);
  for (const i of g) {
    const l = _g(Z, i.key);
    if (Ac(Z, A, l))
      return Mg(Z, i.value);
  }
  return Li(Z, g, C);
}
function Pl(Z, I) {
  if (Z.dirty.has(I))
    return Z.reportError(new RangeError("Cyclic reference")), new lI();
  Z.dirty.add(I);
  const g = [], C = Z.bundle._useIsolating && I.length > 1;
  for (const A of I) {
    if (typeof A == "string") {
      g.push(Z.bundle._transform(A));
      continue;
    }
    if (Z.placeables++, Z.placeables > Ji)
      throw Z.dirty.delete(I), new RangeError(`Too many placeables expanded: ${Z.placeables}, max allowed is ${Ji}`);
    C && g.push(gc), g.push(_g(Z, A).toString(Z)), C && g.push(Cc);
  }
  return Z.dirty.delete(I), g.join("");
}
function Mg(Z, I) {
  return typeof I == "string" ? Z.bundle._transform(I) : Pl(Z, I);
}
class cc {
  constructor(I, g, C) {
    this.dirty = /* @__PURE__ */ new WeakSet(), this.params = null, this.placeables = 0, this.bundle = I, this.errors = g, this.args = C;
  }
  reportError(I) {
    if (!this.errors || !(I instanceof Error))
      throw I;
    this.errors.push(I);
  }
  memoizeIntlObject(I, g) {
    let C = this.bundle._intls.get(I);
    C || (C = {}, this.bundle._intls.set(I, C));
    let A = JSON.stringify(g);
    return C[A] || (C[A] = new I(this.bundle.locales, g)), C[A];
  }
}
function VA(Z, I) {
  const g = /* @__PURE__ */ Object.create(null);
  for (const [C, A] of Object.entries(Z))
    I.includes(C) && (g[C] = A.valueOf());
  return g;
}
const ki = ["unitDisplay", "currencyDisplay", "useGrouping", "minimumIntegerDigits", "minimumFractionDigits", "maximumFractionDigits", "minimumSignificantDigits", "maximumSignificantDigits"];
function Gc(Z, I) {
  let g = Z[0];
  if (g instanceof lI)
    return new lI(`NUMBER(${g.valueOf()})`);
  if (g instanceof OI)
    return new OI(g.valueOf(), {
      ...g.opts,
      ...VA(I, ki)
    });
  if (g instanceof gg)
    return new OI(g.toNumber(), {
      ...VA(I, ki)
    });
  throw new TypeError("Invalid argument to NUMBER");
}
const bc = ["dateStyle", "timeStyle", "fractionalSecondDigits", "dayPeriod", "hour12", "weekday", "era", "year", "month", "day", "hour", "minute", "second", "timeZoneName"];
function oc(Z, I) {
  let g = Z[0];
  if (g instanceof lI)
    return new lI(`DATETIME(${g.valueOf()})`);
  if (g instanceof gg || g instanceof OI)
    return new gg(g, VA(I, bc));
  throw new TypeError("Invalid argument to DATETIME");
}
const ri = /* @__PURE__ */ new Map();
function mc(Z) {
  const I = Array.isArray(Z) ? Z.join(" ") : Z;
  let g = ri.get(I);
  return g === void 0 && (g = /* @__PURE__ */ new Map(), ri.set(I, g)), g;
}
class ac {
  constructor(I, {
    functions: g,
    useIsolating: C = !0,
    transform: A = (i) => i
  } = {}) {
    this._terms = /* @__PURE__ */ new Map(), this._messages = /* @__PURE__ */ new Map(), this.locales = Array.isArray(I) ? I : [I], this._functions = {
      NUMBER: Gc,
      DATETIME: oc,
      ...g
    }, this._useIsolating = C, this._transform = A, this._intls = mc(I);
  }
  hasMessage(I) {
    return this._messages.has(I);
  }
  getMessage(I) {
    return this._messages.get(I);
  }
  addResource(I, {
    allowOverrides: g = !1
  } = {}) {
    const C = [];
    for (let A = 0; A < I.body.length; A++) {
      let i = I.body[A];
      if (i.id.startsWith("-")) {
        if (g === !1 && this._terms.has(i.id)) {
          C.push(new Error(`Attempt to override an existing term: "${i.id}"`));
          continue;
        }
        this._terms.set(i.id, i);
      } else {
        if (g === !1 && this._messages.has(i.id)) {
          C.push(new Error(`Attempt to override an existing message: "${i.id}"`));
          continue;
        }
        this._messages.set(i.id, i);
      }
    }
    return C;
  }
  formatPattern(I, g = null, C = null) {
    if (typeof I == "string")
      return this._transform(I);
    let A = new cc(this, C, g);
    try {
      return Pl(A, I).toString(A);
    } catch (i) {
      if (A.errors && i instanceof Error)
        return A.errors.push(i), new lI().toString(A);
      throw i;
    }
  }
}
const gA = /^(-?[a-zA-Z][\w-]*) *= */gm, Ti = /\.([a-zA-Z][\w-]*) *= */y, ec = /\*?\[/y, CA = /(-?[0-9]+(?:\.([0-9]+))?)/y, tc = /([a-zA-Z][\w-]*)/y, ji = /([$-])?([a-zA-Z][\w-]*)(?:\.([a-zA-Z][\w-]*))?/y, hc = /^[A-Z][A-Z0-9_-]*$/, BC = /([^{}\n\r]+)/y, Bc = /([^\\"\n\r]*)/y, Qi = /\\([\\"])/y, xi = /\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{6})/y, Wc = /^\n+/, Oi = / +$/, wc = / *\r?\n/g, nc = /( *)$/, Yc = /{\s*/y, Ui = /\s*}/y, Vc = /\[\s*/y, Nc = /\s*] */y, uc = /\s*\(\s*/y, Rc = /\s*->\s*/y, yc = /\s*:\s*/y, Xc = /\s*,?\s*/y, Hc = /\s+/y;
class Mc {
  constructor(I) {
    this.body = [], gA.lastIndex = 0;
    let g = 0;
    for (; ; ) {
      let Y = gA.exec(I);
      if (Y === null)
        break;
      g = gA.lastIndex;
      try {
        this.body.push(d(Y[1]));
      } catch (y) {
        if (y instanceof SyntaxError)
          continue;
        throw y;
      }
    }
    function C(Y) {
      return Y.lastIndex = g, Y.test(I);
    }
    function A(Y, y) {
      if (I[g] === Y)
        return g++, !0;
      if (y)
        throw new y(`Expected ${Y}`);
      return !1;
    }
    function i(Y, y) {
      if (C(Y))
        return g = Y.lastIndex, !0;
      if (y)
        throw new y(`Expected ${Y.toString()}`);
      return !1;
    }
    function l(Y) {
      Y.lastIndex = g;
      let y = Y.exec(I);
      if (y === null)
        throw new SyntaxError(`Expected ${Y.toString()}`);
      return g = Y.lastIndex, y;
    }
    function s(Y) {
      return l(Y)[1];
    }
    function d(Y) {
      let y = G(), X = c();
      if (y === null && Object.keys(X).length === 0)
        throw new SyntaxError("Expected message value or attributes");
      return {
        id: Y,
        value: y,
        attributes: X
      };
    }
    function c() {
      let Y = /* @__PURE__ */ Object.create(null);
      for (; C(Ti); ) {
        let y = s(Ti), X = G();
        if (X === null)
          throw new SyntaxError("Expected attribute value");
        Y[y] = X;
      }
      return Y;
    }
    function G() {
      let Y;
      if (C(BC) && (Y = s(BC)), I[g] === "{" || I[g] === "}")
        return b(Y ? [Y] : [], 1 / 0);
      let y = V();
      return y ? Y ? b([Y, y], y.length) : (y.value = N(y.value, Wc), b([y], y.length)) : Y ? N(Y, Oi) : null;
    }
    function b(Y = [], y) {
      for (; ; ) {
        if (C(BC)) {
          Y.push(s(BC));
          continue;
        }
        if (I[g] === "{") {
          Y.push(o());
          continue;
        }
        if (I[g] === "}")
          throw new SyntaxError("Unbalanced closing brace");
        let p = V();
        if (p) {
          Y.push(p), y = Math.min(y, p.length);
          continue;
        }
        break;
      }
      let X = Y.length - 1, K = Y[X];
      typeof K == "string" && (Y[X] = N(K, Oi));
      let S = [];
      for (let p of Y)
        p instanceof vi && (p = p.value.slice(0, p.value.length - y)), p && S.push(p);
      return S;
    }
    function o() {
      i(Yc, SyntaxError);
      let Y = m();
      if (i(Ui))
        return Y;
      if (i(Rc)) {
        let y = h();
        return i(Ui, SyntaxError), {
          type: "select",
          selector: Y,
          ...y
        };
      }
      throw new SyntaxError("Unclosed placeable");
    }
    function m() {
      if (I[g] === "{")
        return o();
      if (C(ji)) {
        let [, Y, y, X = null] = l(ji);
        if (Y === "$")
          return {
            type: "var",
            name: y
          };
        if (i(uc)) {
          let K = e();
          if (Y === "-")
            return {
              type: "term",
              name: y,
              attr: X,
              args: K
            };
          if (hc.test(y))
            return {
              type: "func",
              name: y,
              args: K
            };
          throw new SyntaxError("Function names must be all upper-case");
        }
        return Y === "-" ? {
          type: "term",
          name: y,
          attr: X,
          args: []
        } : {
          type: "mesg",
          name: y,
          attr: X
        };
      }
      return W();
    }
    function e() {
      let Y = [];
      for (; ; ) {
        switch (I[g]) {
          case ")":
            return g++, Y;
          case void 0:
            throw new SyntaxError("Unclosed argument list");
        }
        Y.push(a()), i(Xc);
      }
    }
    function a() {
      let Y = m();
      return Y.type !== "mesg" ? Y : i(yc) ? {
        type: "narg",
        name: Y.name,
        value: W()
      } : Y;
    }
    function h() {
      let Y = [], y = 0, X;
      for (; C(ec); ) {
        A("*") && (X = y);
        let K = t(), S = G();
        if (S === null)
          throw new SyntaxError("Expected variant value");
        Y[y++] = {
          key: K,
          value: S
        };
      }
      if (y === 0)
        return null;
      if (X === void 0)
        throw new SyntaxError("Expected default variant");
      return {
        variants: Y,
        star: X
      };
    }
    function t() {
      i(Vc, SyntaxError);
      let Y;
      return C(CA) ? Y = B() : Y = {
        type: "str",
        value: s(tc)
      }, i(Nc, SyntaxError), Y;
    }
    function W() {
      if (C(CA))
        return B();
      if (I[g] === '"')
        return w();
      throw new SyntaxError("Invalid expression");
    }
    function B() {
      let [, Y, y = ""] = l(CA), X = y.length;
      return {
        type: "num",
        value: parseFloat(Y),
        precision: X
      };
    }
    function w() {
      A('"', SyntaxError);
      let Y = "";
      for (; ; ) {
        if (Y += s(Bc), I[g] === "\\") {
          Y += n();
          continue;
        }
        if (A('"'))
          return {
            type: "str",
            value: Y
          };
        throw new SyntaxError("Unclosed string literal");
      }
    }
    function n() {
      if (C(Qi))
        return s(Qi);
      if (C(xi)) {
        let [, Y, y] = l(xi), X = parseInt(Y || y, 16);
        return X <= 55295 || 57344 <= X ? String.fromCodePoint(X) : "�";
      }
      throw new SyntaxError("Unknown escape sequence");
    }
    function V() {
      let Y = g;
      switch (i(Hc), I[g]) {
        case ".":
        case "[":
        case "*":
        case "}":
        case void 0:
          return !1;
        case "{":
          return R(I.slice(Y, g));
      }
      return I[g - 1] === " " ? R(I.slice(Y, g)) : !1;
    }
    function N(Y, y) {
      return Y.replace(y, "");
    }
    function R(Y) {
      let y = Y.replace(wc, `
`), X = nc.exec(Y)[1].length;
      return new vi(y, X);
    }
  }
}
class vi {
  constructor(I, g) {
    this.value = I, this.length = g;
  }
}
const Dc = /<|&#?\w+;/, Kc = {
  "http://www.w3.org/1999/xhtml": ["em", "strong", "small", "s", "cite", "q", "dfn", "abbr", "data", "time", "code", "var", "samp", "kbd", "sub", "sup", "i", "b", "u", "mark", "bdi", "bdo", "span", "br", "wbr"]
}, Sc = {
  "http://www.w3.org/1999/xhtml": {
    global: ["title", "aria-description", "aria-label", "aria-valuetext"],
    a: ["download"],
    area: ["download", "alt"],
    input: ["alt", "placeholder"],
    menuitem: ["label"],
    menu: ["label"],
    optgroup: ["label"],
    option: ["label"],
    track: ["label"],
    img: ["alt"],
    textarea: ["placeholder"],
    th: ["abbr"]
  },
  "http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul": {
    global: ["accesskey", "aria-label", "aria-valuetext", "label", "title", "tooltiptext"],
    description: ["value"],
    key: ["key", "keycode"],
    label: ["value"],
    textbox: ["placeholder", "value"]
  }
};
function pc(Z, I) {
  const {
    value: g
  } = I;
  if (typeof g == "string")
    if (Z.localName === "title" && Z.namespaceURI === "http://www.w3.org/1999/xhtml")
      Z.textContent = g;
    else if (!Dc.test(g))
      Z.textContent = g;
    else {
      const C = Z.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml", "template");
      C.innerHTML = g, Fc(C.content, Z);
    }
  fl(I, Z);
}
function Fc(Z, I) {
  for (const g of Z.childNodes)
    if (g.nodeType !== g.TEXT_NODE) {
      if (g.hasAttribute("data-l10n-name")) {
        const C = Jc(I, g);
        Z.replaceChild(C, g);
        continue;
      }
      if (kc(g)) {
        const C = Lc(g);
        Z.replaceChild(C, g);
        continue;
      }
      console.warn(`An element of forbidden type "${g.localName}" was found in the translation. Only safe text-level elements and elements with data-l10n-name are allowed.`), Z.replaceChild(NA(g), g);
    }
  I.textContent = "", I.appendChild(Z);
}
function zc(Z, I) {
  if (!Z)
    return !1;
  for (let g of Z)
    if (g.name === I)
      return !0;
  return !1;
}
function fl(Z, I) {
  const g = I.hasAttribute("data-l10n-attrs") ? I.getAttribute("data-l10n-attrs").split(",").map((C) => C.trim()) : null;
  for (const C of Array.from(I.attributes))
    Ei(C.name, I, g) && !zc(Z.attributes, C.name) && I.removeAttribute(C.name);
  if (Z.attributes)
    for (const C of Array.from(Z.attributes))
      Ei(C.name, I, g) && I.getAttribute(C.name) !== C.value && I.setAttribute(C.name, C.value);
}
function Jc(Z, I) {
  const g = I.getAttribute("data-l10n-name"), C = Z.querySelector(`[data-l10n-name="${g}"]`);
  if (!C)
    return console.warn(`An element named "${g}" wasn't found in the source.`), NA(I);
  if (C.localName !== I.localName)
    return console.warn(`An element named "${g}" was found in the translation but its type ${I.localName} didn't match the element found in the source (${C.localName}).`), NA(I);
  Z.removeChild(C);
  const A = C.cloneNode(!1);
  return _l(I, A);
}
function Lc(Z) {
  const I = Z.ownerDocument.createElement(Z.localName);
  return _l(Z, I);
}
function NA(Z) {
  return Z.ownerDocument.createTextNode(Z.textContent);
}
function kc(Z) {
  const I = Kc[Z.namespaceURI];
  return I && I.includes(Z.localName);
}
function Ei(Z, I, g = null) {
  if (g && g.includes(Z))
    return !0;
  const C = Sc[I.namespaceURI];
  if (!C)
    return !1;
  const A = Z.toLowerCase(), i = I.localName;
  if (C.global.includes(A))
    return !0;
  if (!C[i])
    return !1;
  if (C[i].includes(A))
    return !0;
  if (I.namespaceURI === "http://www.w3.org/1999/xhtml" && i === "input" && A === "value") {
    const l = I.type.toLowerCase();
    if (l === "submit" || l === "button" || l === "reset")
      return !0;
  }
  return !1;
}
function _l(Z, I) {
  return I.textContent = Z.textContent, fl(Z, I), I;
}
class rc extends Array {
  static from(I) {
    return I instanceof this ? I : new this(I);
  }
}
class Tc extends rc {
  constructor(I) {
    if (super(), Symbol.asyncIterator in Object(I))
      this.iterator = I[Symbol.asyncIterator]();
    else if (Symbol.iterator in Object(I))
      this.iterator = I[Symbol.iterator]();
    else
      throw new TypeError("Argument must implement the iteration protocol.");
  }
  [Symbol.asyncIterator]() {
    const I = this;
    let g = 0;
    return {
      async next() {
        return I.length <= g && I.push(I.iterator.next()), I[g++];
      }
    };
  }
  async touchNext(I = 1) {
    let g = 0;
    for (; g++ < I; ) {
      const C = this[this.length - 1];
      if (C && (await C).done)
        break;
      this.push(this.iterator.next());
    }
    return this[this.length - 1];
  }
}
class jc {
  constructor(I = [], g) {
    this.resourceIds = I, this.generateBundles = g, this.onChange(!0);
  }
  addResourceIds(I, g = !1) {
    return this.resourceIds.push(...I), this.onChange(g), this.resourceIds.length;
  }
  removeResourceIds(I) {
    return this.resourceIds = this.resourceIds.filter((g) => !I.includes(g)), this.onChange(), this.resourceIds.length;
  }
  async formatWithFallback(I, g) {
    const C = [];
    let A = !1;
    for await (const i of this.bundles) {
      A = !0;
      const l = Oc(g, i, I, C);
      if (l.size === 0)
        break;
      if (typeof console < "u") {
        const s = i.locales[0], d = Array.from(l).join(", ");
        console.warn(`[fluent] Missing translations in ${s}: ${d}`);
      }
    }
    return !A && typeof console < "u" && console.warn(`[fluent] Request for keys failed because no resource bundles got generated.
  keys: ${JSON.stringify(I)}.
  resourceIds: ${JSON.stringify(this.resourceIds)}.`), C;
  }
  formatMessages(I) {
    return this.formatWithFallback(I, xc);
  }
  formatValues(I) {
    return this.formatWithFallback(I, Qc);
  }
  async formatValue(I, g) {
    const [C] = await this.formatValues([{
      id: I,
      args: g
    }]);
    return C;
  }
  handleEvent() {
    this.onChange();
  }
  onChange(I = !1) {
    this.bundles = Tc.from(this.generateBundles(this.resourceIds)), I && this.bundles.touchNext(2);
  }
}
function Qc(Z, I, g, C) {
  return g.value ? Z.formatPattern(g.value, C, I) : null;
}
function xc(Z, I, g, C) {
  const A = {
    value: null,
    attributes: null
  };
  g.value && (A.value = Z.formatPattern(g.value, C, I));
  let i = Object.keys(g.attributes);
  if (i.length > 0) {
    A.attributes = new Array(i.length);
    for (let [l, s] of i.entries()) {
      let d = Z.formatPattern(g.attributes[s], C, I);
      A.attributes[l] = {
        name: s,
        value: d
      };
    }
  }
  return A;
}
function Oc(Z, I, g, C) {
  const A = [], i = /* @__PURE__ */ new Set();
  return g.forEach(({
    id: l,
    args: s
  }, d) => {
    if (C[d] !== void 0)
      return;
    let c = I.getMessage(l);
    if (c) {
      if (A.length = 0, C[d] = Z(I, A, c, s), A.length > 0 && typeof console < "u") {
        const G = I.locales[0], b = A.join(", ");
        console.warn(`[fluent][resolver] errors in ${G}/${l}: ${b}.`);
      }
    } else
      i.add(l);
  }), i;
}
const ig = "data-l10n-id", Jg = "data-l10n-args", Uc = `[${ig}]`;
class vc extends jc {
  constructor(I, g) {
    super(I, g), this.roots = /* @__PURE__ */ new Set(), this.pendingrAF = null, this.pendingElements = /* @__PURE__ */ new Set(), this.windowElement = null, this.mutationObserver = null, this.observerConfig = {
      attributes: !0,
      characterData: !1,
      childList: !0,
      subtree: !0,
      attributeFilter: [ig, Jg]
    };
  }
  onChange(I = !1) {
    super.onChange(I), this.roots && this.translateRoots();
  }
  setAttributes(I, g, C) {
    return I.setAttribute(ig, g), C ? I.setAttribute(Jg, JSON.stringify(C)) : I.removeAttribute(Jg), I;
  }
  getAttributes(I) {
    return {
      id: I.getAttribute(ig),
      args: JSON.parse(I.getAttribute(Jg) || null)
    };
  }
  connectRoot(I) {
    for (const g of this.roots)
      if (g === I || g.contains(I) || I.contains(g))
        throw new Error("Cannot add a root that overlaps with existing root.");
    if (this.windowElement) {
      if (this.windowElement !== I.ownerDocument.defaultView)
        throw new Error(`Cannot connect a root:
          DOMLocalization already has a root from a different window.`);
    } else
      this.windowElement = I.ownerDocument.defaultView, this.mutationObserver = new this.windowElement.MutationObserver((g) => this.translateMutations(g));
    this.roots.add(I), this.mutationObserver.observe(I, this.observerConfig);
  }
  disconnectRoot(I) {
    return this.roots.delete(I), this.pauseObserving(), this.roots.size === 0 ? (this.mutationObserver = null, this.windowElement && this.pendingrAF && this.windowElement.cancelAnimationFrame(this.pendingrAF), this.windowElement = null, this.pendingrAF = null, this.pendingElements.clear(), !0) : (this.resumeObserving(), !1);
  }
  translateRoots() {
    const I = Array.from(this.roots);
    return Promise.all(I.map((g) => this.translateFragment(g)));
  }
  pauseObserving() {
    this.mutationObserver && (this.translateMutations(this.mutationObserver.takeRecords()), this.mutationObserver.disconnect());
  }
  resumeObserving() {
    if (this.mutationObserver)
      for (const I of this.roots)
        this.mutationObserver.observe(I, this.observerConfig);
  }
  translateMutations(I) {
    for (const g of I)
      switch (g.type) {
        case "attributes":
          g.target.hasAttribute("data-l10n-id") && this.pendingElements.add(g.target);
          break;
        case "childList":
          for (const C of g.addedNodes)
            if (C.nodeType === C.ELEMENT_NODE)
              if (C.childElementCount)
                for (const A of this.getTranslatables(C))
                  this.pendingElements.add(A);
              else C.hasAttribute(ig) && this.pendingElements.add(C);
          break;
      }
    this.pendingElements.size > 0 && this.pendingrAF === null && (this.pendingrAF = this.windowElement.requestAnimationFrame(() => {
      this.translateElements(Array.from(this.pendingElements)), this.pendingElements.clear(), this.pendingrAF = null;
    }));
  }
  translateFragment(I) {
    return this.translateElements(this.getTranslatables(I));
  }
  async translateElements(I) {
    if (!I.length)
      return;
    const g = I.map(this.getKeysForElement), C = await this.formatMessages(g);
    return this.applyTranslations(I, C);
  }
  applyTranslations(I, g) {
    this.pauseObserving();
    for (let C = 0; C < I.length; C++)
      g[C] !== void 0 && pc(I[C], g[C]);
    this.resumeObserving();
  }
  getTranslatables(I) {
    const g = Array.from(I.querySelectorAll(Uc));
    return typeof I.hasAttribute == "function" && I.hasAttribute(ig) && g.push(I), g;
  }
  getKeysForElement(I) {
    return {
      id: I.getAttribute(ig),
      args: JSON.parse(I.getAttribute(Jg) || null)
    };
  }
}
class MC {
  #I;
  #g;
  #A;
  #C;
  constructor({
    lang: I,
    isRTL: g
  }, C = null) {
    this.#A = MC.#i(I), this.#C = C, this.#I = g ?? MC.#l(this.#A) ? "rtl" : "ltr";
  }
  _setL10n(I) {
    this.#C = I;
  }
  getLanguage() {
    return this.#A;
  }
  getDirection() {
    return this.#I;
  }
  async get(I, g = null, C) {
    return Array.isArray(I) ? (I = I.map((l) => ({
      id: l
    })), (await this.#C.formatMessages(I)).map((l) => l.value)) : (await this.#C.formatMessages([{
      id: I,
      args: g
    }]))[0]?.value || C;
  }
  async translate(I) {
    (this.#g ||= /* @__PURE__ */ new Set()).add(I);
    try {
      this.#C.connectRoot(I), await this.#C.translateRoots();
    } catch {
    }
  }
  async translateOnce(I) {
    try {
      await this.#C.translateElements([I]);
    } catch (g) {
      console.error("translateOnce:", g);
    }
  }
  async destroy() {
    if (this.#g) {
      for (const I of this.#g)
        this.#C.disconnectRoot(I);
      this.#g.clear(), this.#g = null;
    }
    this.#C.pauseObserving();
  }
  pause() {
    this.#C.pauseObserving();
  }
  resume() {
    this.#C.resumeObserving();
  }
  static #i(I) {
    return I = I?.toLowerCase() || "en-us", {
      en: "en-us",
      es: "es-es",
      fy: "fy-nl",
      ga: "ga-ie",
      gu: "gu-in",
      hi: "hi-in",
      hy: "hy-am",
      nb: "nb-no",
      ne: "ne-np",
      nn: "nn-no",
      pa: "pa-in",
      pt: "pt-pt",
      sv: "sv-se",
      zh: "zh-cn"
    }[I] || I;
  }
  static #l(I) {
    const g = I.split("-", 1)[0];
    return ["ar", "he", "fa", "ps", "ur"].includes(g);
  }
}
function Ec() {
  const {
    isAndroid: Z,
    isLinux: I,
    isMac: g,
    isWindows: C
  } = mZ.platform;
  return I ? "linux" : C ? "windows" : g ? "macos" : Z ? "android" : "other";
}
function Pi(Z, I) {
  const g = new Mc(I), C = new ac(Z, {
    functions: {
      PLATFORM: Ec
    }
  }), A = C.addResource(g);
  return A.length && console.error("L10n errors", A), C;
}
class xI extends MC {
  constructor(I) {
    super({
      lang: I
    });
    const g = I ? xI.#I.bind(xI, "en-us", this.getLanguage()) : xI.#C.bind(xI, this.getLanguage());
    this._setL10n(new vc([], g));
  }
  static async *#I(I, g) {
    const {
      baseURL: C,
      paths: A
    } = await this.#A(), i = [g];
    if (I !== g) {
      const s = g.split("-", 1)[0];
      s !== g && i.push(s), i.push(I);
    }
    const l = i.map((s) => [s, this.#g(s, C, A)]);
    for (const [s, d] of l) {
      const c = await d;
      c ? yield c : s === "en-us" && (yield this.#i(s));
    }
  }
  static async #g(I, g, C) {
    const A = C[I];
    if (!A)
      return null;
    const i = new URL(A, g), l = await ni(i, "text");
    return Pi(I, l);
  }
  static async #A() {
    try {
      const {
        href: I
      } = document.querySelector('link[type="application/l10n"]'), g = await ni(I, "json");
      return {
        baseURL: I.substring(0, I.lastIndexOf("/") + 1) || "./",
        paths: g
      };
    } catch {
    }
    return {
      baseURL: "./",
      paths: /* @__PURE__ */ Object.create(null)
    };
  }
  static async *#C(I) {
    yield this.#i(I);
  }
  static async #i(I) {
    return Pi(I, `pdfjs-previous-button =
    .title = Previous Page
pdfjs-previous-button-label = Previous
pdfjs-next-button =
    .title = Next Page
pdfjs-next-button-label = Next
pdfjs-page-input =
    .title = Page
pdfjs-of-pages = of { $pagesCount }
pdfjs-page-of-pages = ({ $pageNumber } of { $pagesCount })
pdfjs-zoom-out-button =
    .title = Zoom Out
pdfjs-zoom-out-button-label = Zoom Out
pdfjs-zoom-in-button =
    .title = Zoom In
pdfjs-zoom-in-button-label = Zoom In
pdfjs-zoom-select =
    .title = Zoom
pdfjs-presentation-mode-button =
    .title = Switch to Presentation Mode
pdfjs-presentation-mode-button-label = Presentation Mode
pdfjs-open-file-button =
    .title = Open File
pdfjs-open-file-button-label = Open
pdfjs-print-button =
    .title = Print
pdfjs-print-button-label = Print
pdfjs-save-button =
    .title = Save
pdfjs-save-button-label = Save
pdfjs-download-button =
    .title = Download
pdfjs-download-button-label = Download
pdfjs-bookmark-button =
    .title = Current Page (View URL from Current Page)
pdfjs-bookmark-button-label = Current Page
pdfjs-tools-button =
    .title = Tools
pdfjs-tools-button-label = Tools
pdfjs-first-page-button =
    .title = Go to First Page
pdfjs-first-page-button-label = Go to First Page
pdfjs-last-page-button =
    .title = Go to Last Page
pdfjs-last-page-button-label = Go to Last Page
pdfjs-page-rotate-cw-button =
    .title = Rotate Clockwise
pdfjs-page-rotate-cw-button-label = Rotate Clockwise
pdfjs-page-rotate-ccw-button =
    .title = Rotate Counterclockwise
pdfjs-page-rotate-ccw-button-label = Rotate Counterclockwise
pdfjs-cursor-text-select-tool-button =
    .title = Enable Text Selection Tool
pdfjs-cursor-text-select-tool-button-label = Text Selection Tool
pdfjs-cursor-hand-tool-button =
    .title = Enable Hand Tool
pdfjs-cursor-hand-tool-button-label = Hand Tool
pdfjs-scroll-page-button =
    .title = Use Page Scrolling
pdfjs-scroll-page-button-label = Page Scrolling
pdfjs-scroll-vertical-button =
    .title = Use Vertical Scrolling
pdfjs-scroll-vertical-button-label = Vertical Scrolling
pdfjs-scroll-horizontal-button =
    .title = Use Horizontal Scrolling
pdfjs-scroll-horizontal-button-label = Horizontal Scrolling
pdfjs-scroll-wrapped-button =
    .title = Use Wrapped Scrolling
pdfjs-scroll-wrapped-button-label = Wrapped Scrolling
pdfjs-spread-none-button =
    .title = Do not join page spreads
pdfjs-spread-none-button-label = No Spreads
pdfjs-spread-odd-button =
    .title = Join page spreads starting with odd-numbered pages
pdfjs-spread-odd-button-label = Odd Spreads
pdfjs-spread-even-button =
    .title = Join page spreads starting with even-numbered pages
pdfjs-spread-even-button-label = Even Spreads
pdfjs-document-properties-button =
    .title = Document Properties…
pdfjs-document-properties-button-label = Document Properties…
pdfjs-document-properties-file-name = File name:
pdfjs-document-properties-file-size = File size:
pdfjs-document-properties-size-kb = { NUMBER($kb, maximumSignificantDigits: 3) } KB ({ $b } bytes)
pdfjs-document-properties-size-mb = { NUMBER($mb, maximumSignificantDigits: 3) } MB ({ $b } bytes)
pdfjs-document-properties-title = Title:
pdfjs-document-properties-author = Author:
pdfjs-document-properties-subject = Subject:
pdfjs-document-properties-keywords = Keywords:
pdfjs-document-properties-creation-date = Creation Date:
pdfjs-document-properties-modification-date = Modification Date:
pdfjs-document-properties-date-time-string = { DATETIME($dateObj, dateStyle: "short", timeStyle: "medium") }
pdfjs-document-properties-creator = Creator:
pdfjs-document-properties-producer = PDF Producer:
pdfjs-document-properties-version = PDF Version:
pdfjs-document-properties-page-count = Page Count:
pdfjs-document-properties-page-size = Page Size:
pdfjs-document-properties-page-size-unit-inches = in
pdfjs-document-properties-page-size-unit-millimeters = mm
pdfjs-document-properties-page-size-orientation-portrait = portrait
pdfjs-document-properties-page-size-orientation-landscape = landscape
pdfjs-document-properties-page-size-name-a-three = A3
pdfjs-document-properties-page-size-name-a-four = A4
pdfjs-document-properties-page-size-name-letter = Letter
pdfjs-document-properties-page-size-name-legal = Legal
pdfjs-document-properties-page-size-dimension-string = { $width } × { $height } { $unit } ({ $orientation })
pdfjs-document-properties-page-size-dimension-name-string = { $width } × { $height } { $unit } ({ $name }, { $orientation })
pdfjs-document-properties-linearized = Fast Web View:
pdfjs-document-properties-linearized-yes = Yes
pdfjs-document-properties-linearized-no = No
pdfjs-document-properties-close-button = Close
pdfjs-print-progress-message = Preparing document for printing…
pdfjs-print-progress-percent = { $progress }%
pdfjs-print-progress-close-button = Cancel
pdfjs-printing-not-supported = Warning: Printing is not fully supported by this browser.
pdfjs-printing-not-ready = Warning: The PDF is not fully loaded for printing.
pdfjs-toggle-sidebar-button =
    .title = Toggle Sidebar
pdfjs-toggle-sidebar-notification-button =
    .title = Toggle Sidebar (document contains outline/attachments/layers)
pdfjs-toggle-sidebar-button-label = Toggle Sidebar
pdfjs-document-outline-button =
    .title = Show Document Outline (double-click to expand/collapse all items)
pdfjs-document-outline-button-label = Document Outline
pdfjs-attachments-button =
    .title = Show Attachments
pdfjs-attachments-button-label = Attachments
pdfjs-layers-button =
    .title = Show Layers (double-click to reset all layers to the default state)
pdfjs-layers-button-label = Layers
pdfjs-thumbs-button =
    .title = Show Thumbnails
pdfjs-thumbs-button-label = Thumbnails
pdfjs-current-outline-item-button =
    .title = Find Current Outline Item
pdfjs-current-outline-item-button-label = Current Outline Item
pdfjs-findbar-button =
    .title = Find in Document
pdfjs-findbar-button-label = Find
pdfjs-additional-layers = Additional Layers
pdfjs-thumb-page-title =
    .title = Page { $page }
pdfjs-thumb-page-canvas =
    .aria-label = Thumbnail of Page { $page }
pdfjs-find-input =
    .title = Find
    .placeholder = Find in document…
pdfjs-find-previous-button =
    .title = Find the previous occurrence of the phrase
pdfjs-find-previous-button-label = Previous
pdfjs-find-next-button =
    .title = Find the next occurrence of the phrase
pdfjs-find-next-button-label = Next
pdfjs-find-highlight-checkbox = Highlight All
pdfjs-find-match-case-checkbox-label = Match Case
pdfjs-find-match-diacritics-checkbox-label = Match Diacritics
pdfjs-find-entire-word-checkbox-label = Whole Words
pdfjs-find-reached-top = Reached top of document, continued from bottom
pdfjs-find-reached-bottom = Reached end of document, continued from top
pdfjs-find-match-count =
    { $total ->
        [one] { $current } of { $total } match
       *[other] { $current } of { $total } matches
    }
pdfjs-find-match-count-limit =
    { $limit ->
        [one] More than { $limit } match
       *[other] More than { $limit } matches
    }
pdfjs-find-not-found = Phrase not found
pdfjs-page-scale-width = Page Width
pdfjs-page-scale-fit = Page Fit
pdfjs-page-scale-auto = Automatic Zoom
pdfjs-page-scale-actual = Actual Size
pdfjs-page-scale-percent = { $scale }%
pdfjs-page-landmark =
    .aria-label = Page { $page }
pdfjs-loading-error = An error occurred while loading the PDF.
pdfjs-invalid-file-error = Invalid or corrupted PDF file.
pdfjs-missing-file-error = Missing PDF file.
pdfjs-unexpected-response-error = Unexpected server response.
pdfjs-rendering-error = An error occurred while rendering the page.
pdfjs-annotation-date-time-string = { DATETIME($dateObj, dateStyle: "short", timeStyle: "medium") }
pdfjs-text-annotation-type =
    .alt = [{ $type } Annotation]
pdfjs-password-label = Enter the password to open this PDF file.
pdfjs-password-invalid = Invalid password. Please try again.
pdfjs-password-ok-button = OK
pdfjs-password-cancel-button = Cancel
pdfjs-web-fonts-disabled = Web fonts are disabled: unable to use embedded PDF fonts.
pdfjs-editor-free-text-button =
    .title = Text
pdfjs-editor-color-picker-free-text-input =
    .title = Change text color
pdfjs-editor-free-text-button-label = Text
pdfjs-editor-ink-button =
    .title = Draw
pdfjs-editor-color-picker-ink-input =
    .title = Change drawing color
pdfjs-editor-ink-button-label = Draw
pdfjs-editor-stamp-button =
    .title = Add or edit images
pdfjs-editor-stamp-button-label = Add or edit images
pdfjs-editor-highlight-button =
    .title = Highlight
pdfjs-editor-highlight-button-label = Highlight
pdfjs-highlight-floating-button1 =
    .title = Highlight
    .aria-label = Highlight
pdfjs-highlight-floating-button-label = Highlight
pdfjs-comment-floating-button =
    .title = Comment
    .aria-label = Comment
pdfjs-comment-floating-button-label = Comment
pdfjs-editor-comment-button =
    .title = Comment
    .aria-label = Comment
pdfjs-editor-comment-button-label = Comment
pdfjs-editor-signature-button =
    .title = Add signature
pdfjs-editor-signature-button-label = Add signature
pdfjs-editor-highlight-editor =
    .aria-label = Highlight editor
pdfjs-editor-ink-editor =
    .aria-label = Drawing editor
pdfjs-editor-signature-editor1 =
    .aria-description = Signature editor: { $description }
pdfjs-editor-stamp-editor =
    .aria-label = Image editor
pdfjs-editor-remove-ink-button =
    .title = Remove drawing
pdfjs-editor-remove-freetext-button =
    .title = Remove text
pdfjs-editor-remove-stamp-button =
    .title = Remove image
pdfjs-editor-remove-highlight-button =
    .title = Remove highlight
pdfjs-editor-remove-signature-button =
    .title = Remove signature
pdfjs-editor-free-text-color-input = Color
pdfjs-editor-free-text-size-input = Size
pdfjs-editor-ink-color-input = Color
pdfjs-editor-ink-thickness-input = Thickness
pdfjs-editor-ink-opacity-input = Opacity
pdfjs-editor-stamp-add-image-button =
    .title = Add image
pdfjs-editor-stamp-add-image-button-label = Add image
pdfjs-editor-free-highlight-thickness-input = Thickness
pdfjs-editor-free-highlight-thickness-title =
    .title = Change thickness when highlighting items other than text
pdfjs-editor-add-signature-container =
    .aria-label = Signature controls and saved signatures
pdfjs-editor-signature-add-signature-button =
    .title = Add new signature
pdfjs-editor-signature-add-signature-button-label = Add new signature
pdfjs-editor-add-saved-signature-button =
    .title = Saved signature: { $description }
pdfjs-free-text2 =
    .aria-label = Text Editor
    .default-content = Start typing…
pdfjs-editor-comments-sidebar-title =
    { $count ->
        [one] Comment
       *[other] Comments
    }
pdfjs-editor-comments-sidebar-close-button =
    .title = Close the sidebar
    .aria-label = Close the sidebar
pdfjs-editor-comments-sidebar-close-button-label = Close the sidebar
pdfjs-editor-comments-sidebar-no-comments1 = See something noteworthy? Highlight it and leave a comment.
pdfjs-editor-comments-sidebar-no-comments-link = Learn more
pdfjs-editor-alt-text-button =
    .aria-label = Alt text
pdfjs-editor-alt-text-button-label = Alt text
pdfjs-editor-alt-text-edit-button =
    .aria-label = Edit alt text
pdfjs-editor-alt-text-dialog-label = Choose an option
pdfjs-editor-alt-text-dialog-description = Alt text (alternative text) helps when people can’t see the image or when it doesn’t load.
pdfjs-editor-alt-text-add-description-label = Add a description
pdfjs-editor-alt-text-add-description-description = Aim for 1-2 sentences that describe the subject, setting, or actions.
pdfjs-editor-alt-text-mark-decorative-label = Mark as decorative
pdfjs-editor-alt-text-mark-decorative-description = This is used for ornamental images, like borders or watermarks.
pdfjs-editor-alt-text-cancel-button = Cancel
pdfjs-editor-alt-text-save-button = Save
pdfjs-editor-alt-text-decorative-tooltip = Marked as decorative
pdfjs-editor-alt-text-textarea =
    .placeholder = For example, “A young man sits down at a table to eat a meal”
pdfjs-editor-resizer-top-left =
    .aria-label = Top left corner — resize
pdfjs-editor-resizer-top-middle =
    .aria-label = Top middle — resize
pdfjs-editor-resizer-top-right =
    .aria-label = Top right corner — resize
pdfjs-editor-resizer-middle-right =
    .aria-label = Middle right — resize
pdfjs-editor-resizer-bottom-right =
    .aria-label = Bottom right corner — resize
pdfjs-editor-resizer-bottom-middle =
    .aria-label = Bottom middle — resize
pdfjs-editor-resizer-bottom-left =
    .aria-label = Bottom left corner — resize
pdfjs-editor-resizer-middle-left =
    .aria-label = Middle left — resize
pdfjs-editor-highlight-colorpicker-label = Highlight color
pdfjs-editor-colorpicker-button =
    .title = Change color
pdfjs-editor-colorpicker-dropdown =
    .aria-label = Color choices
pdfjs-editor-colorpicker-yellow =
    .title = Yellow
pdfjs-editor-colorpicker-green =
    .title = Green
pdfjs-editor-colorpicker-blue =
    .title = Blue
pdfjs-editor-colorpicker-pink =
    .title = Pink
pdfjs-editor-colorpicker-red =
    .title = Red
pdfjs-editor-highlight-show-all-button-label = Show all
pdfjs-editor-highlight-show-all-button =
    .title = Show all
pdfjs-editor-new-alt-text-dialog-edit-label = Edit alt text (image description)
pdfjs-editor-new-alt-text-dialog-add-label = Add alt text (image description)
pdfjs-editor-new-alt-text-textarea =
    .placeholder = Write your description here…
pdfjs-editor-new-alt-text-description = Short description for people who can’t see the image or when the image doesn’t load.
pdfjs-editor-new-alt-text-disclaimer1 = This alt text was created automatically and may be inaccurate.
pdfjs-editor-new-alt-text-disclaimer-learn-more-url = Learn more
pdfjs-editor-new-alt-text-create-automatically-button-label = Create alt text automatically
pdfjs-editor-new-alt-text-not-now-button = Not now
pdfjs-editor-new-alt-text-error-title = Couldn’t create alt text automatically
pdfjs-editor-new-alt-text-error-description = Please write your own alt text or try again later.
pdfjs-editor-new-alt-text-error-close-button = Close
pdfjs-editor-new-alt-text-ai-model-downloading-progress = Downloading alt text AI model ({ $downloadedSize } of { $totalSize } MB)
    .aria-valuetext = Downloading alt text AI model ({ $downloadedSize } of { $totalSize } MB)
pdfjs-editor-new-alt-text-added-button =
    .aria-label = Alt text added
pdfjs-editor-new-alt-text-added-button-label = Alt text added
pdfjs-editor-new-alt-text-missing-button =
    .aria-label = Missing alt text
pdfjs-editor-new-alt-text-missing-button-label = Missing alt text
pdfjs-editor-new-alt-text-to-review-button =
    .aria-label = Review alt text
pdfjs-editor-new-alt-text-to-review-button-label = Review alt text
pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer = Created automatically: { $generatedAltText }
pdfjs-image-alt-text-settings-button =
    .title = Image alt text settings
pdfjs-image-alt-text-settings-button-label = Image alt text settings
pdfjs-editor-alt-text-settings-dialog-label = Image alt text settings
pdfjs-editor-alt-text-settings-automatic-title = Automatic alt text
pdfjs-editor-alt-text-settings-create-model-button-label = Create alt text automatically
pdfjs-editor-alt-text-settings-create-model-description = Suggests descriptions to help people who can’t see the image or when the image doesn’t load.
pdfjs-editor-alt-text-settings-download-model-label = Alt text AI model ({ $totalSize } MB)
pdfjs-editor-alt-text-settings-ai-model-description = Runs locally on your device so your data stays private. Required for automatic alt text.
pdfjs-editor-alt-text-settings-delete-model-button = Delete
pdfjs-editor-alt-text-settings-download-model-button = Download
pdfjs-editor-alt-text-settings-downloading-model-button = Downloading…
pdfjs-editor-alt-text-settings-editor-title = Alt text editor
pdfjs-editor-alt-text-settings-show-dialog-button-label = Show alt text editor right away when adding an image
pdfjs-editor-alt-text-settings-show-dialog-description = Helps you make sure all your images have alt text.
pdfjs-editor-alt-text-settings-close-button = Close
pdfjs-editor-highlight-added-alert = Highlight added
pdfjs-editor-freetext-added-alert = Text added
pdfjs-editor-ink-added-alert = Drawing added
pdfjs-editor-stamp-added-alert = Image added
pdfjs-editor-signature-added-alert = Signature added
pdfjs-editor-undo-bar-message-highlight = Highlight removed
pdfjs-editor-undo-bar-message-freetext = Text removed
pdfjs-editor-undo-bar-message-ink = Drawing removed
pdfjs-editor-undo-bar-message-stamp = Image removed
pdfjs-editor-undo-bar-message-signature = Signature removed
pdfjs-editor-undo-bar-message-multiple =
    { $count ->
        [one] { $count } annotation removed
       *[other] { $count } annotations removed
    }
pdfjs-editor-undo-bar-undo-button =
    .title = Undo
pdfjs-editor-undo-bar-undo-button-label = Undo
pdfjs-editor-undo-bar-close-button =
    .title = Close
pdfjs-editor-undo-bar-close-button-label = Close
pdfjs-editor-add-signature-dialog-label = This modal allows the user to create a signature to add to a PDF document. The user can edit the name (which also serves as the alt text), and optionally save the signature for repeated use.
pdfjs-editor-add-signature-dialog-title = Add a signature
pdfjs-editor-add-signature-type-button = Type
    .title = Type
pdfjs-editor-add-signature-draw-button = Draw
    .title = Draw
pdfjs-editor-add-signature-image-button = Image
    .title = Image
pdfjs-editor-add-signature-type-input =
    .aria-label = Type your signature
    .placeholder = Type your signature
pdfjs-editor-add-signature-draw-placeholder = Draw your signature
pdfjs-editor-add-signature-draw-thickness-range-label = Thickness
pdfjs-editor-add-signature-draw-thickness-range =
    .title = Drawing thickness: { $thickness }
pdfjs-editor-add-signature-image-placeholder = Drag a file here to upload
pdfjs-editor-add-signature-image-browse-link =
    { PLATFORM() ->
        [macos] Or choose image files
       *[other] Or browse image files
    }
pdfjs-editor-add-signature-description-label = Description (alt text)
pdfjs-editor-add-signature-description-input =
    .title = Description (alt text)
pdfjs-editor-add-signature-description-default-when-drawing = Signature
pdfjs-editor-add-signature-clear-button-label = Clear signature
pdfjs-editor-add-signature-clear-button =
    .title = Clear signature
pdfjs-editor-add-signature-save-checkbox = Save signature
pdfjs-editor-add-signature-save-warning-message = You’ve reached the limit of 5 saved signatures. Remove one to save more.
pdfjs-editor-add-signature-image-upload-error-title = Couldn’t upload image
pdfjs-editor-add-signature-image-upload-error-description = Check your network connection or try another image.
pdfjs-editor-add-signature-image-no-data-error-title = Can’t convert this image into a signature
pdfjs-editor-add-signature-image-no-data-error-description = Please try uploading a different image.
pdfjs-editor-add-signature-error-close-button = Close
pdfjs-editor-add-signature-cancel-button = Cancel
pdfjs-editor-add-signature-add-button = Add
pdfjs-editor-delete-signature-button1 =
    .title = Remove saved signature
pdfjs-editor-delete-signature-button-label1 = Remove saved signature
pdfjs-editor-add-signature-edit-button-label = Edit description
pdfjs-editor-edit-signature-dialog-title = Edit description
pdfjs-editor-edit-signature-update-button = Update
pdfjs-show-comment-button =
    .title = Show comment
pdfjs-editor-edit-comment-popup-button-label = Edit comment
pdfjs-editor-edit-comment-popup-button =
    .title = Edit comment
pdfjs-editor-delete-comment-popup-button-label = Remove comment
pdfjs-editor-delete-comment-popup-button =
    .title = Remove comment
pdfjs-editor-edit-comment-dialog-title-when-editing = Edit comment
pdfjs-editor-edit-comment-dialog-save-button-when-editing = Update
pdfjs-editor-edit-comment-dialog-title-when-adding = Add comment
pdfjs-editor-edit-comment-dialog-save-button-when-adding = Add
pdfjs-editor-edit-comment-dialog-text-input =
    .placeholder = Start typing…
pdfjs-editor-edit-comment-dialog-cancel-button = Cancel
pdfjs-editor-edit-comment-button =
    .title = Edit comment`);
  }
}
const Pc = 1e3, fc = 50, _c = 1e3;
function AA() {
  return document.location.hash;
}
class qc {
  #I = null;
  constructor({
    linkService: I,
    eventBus: g
  }) {
    this.linkService = I, this.eventBus = g, this._initialized = !1, this._fingerprint = "", this.reset(), this.eventBus._on("pagesinit", () => {
      this._isPagesLoaded = !1, this.eventBus._on("pagesloaded", (C) => {
        this._isPagesLoaded = !!C.pagesCount;
      }, {
        once: !0
      });
    });
  }
  initialize({
    fingerprint: I,
    resetHistory: g = !1,
    updateUrl: C = !1
  }) {
    if (!I || typeof I != "string") {
      console.error('PDFHistory.initialize: The "fingerprint" must be a non-empty string.');
      return;
    }
    this._initialized && this.reset();
    const A = this._fingerprint !== "" && this._fingerprint !== I;
    this._fingerprint = I, this._updateUrl = C === !0, this._initialized = !0, this.#o();
    const i = window.history.state;
    if (this._popStateInProgress = !1, this._blockHashChange = 0, this._currentHash = AA(), this._numPositionUpdates = 0, this._uid = this._maxUid = 0, this._destination = null, this._position = null, !this.#i(i, !0) || g) {
      const {
        hash: s,
        page: d,
        rotation: c
      } = this.#s(!0);
      if (!s || A || g) {
        this.#g(null, !0);
        return;
      }
      this.#g({
        hash: s,
        page: d,
        rotation: c
      }, !0);
      return;
    }
    const l = i.destination;
    this.#l(l, i.uid, !0), l.rotation !== void 0 && (this._initialRotation = l.rotation), l.dest ? (this._initialBookmark = JSON.stringify(l.dest), this._destination.page = null) : l.hash ? this._initialBookmark = l.hash : l.page && (this._initialBookmark = `page=${l.page}`);
  }
  reset() {
    this._initialized && (this.#Z(), this._initialized = !1, this.#b()), this._updateViewareaTimeout && (clearTimeout(this._updateViewareaTimeout), this._updateViewareaTimeout = null), this._initialBookmark = null, this._initialRotation = null;
  }
  push({
    namedDest: I = null,
    explicitDest: g,
    pageNumber: C
  }) {
    if (!this._initialized)
      return;
    if (I && typeof I != "string") {
      console.error(`PDFHistory.push: "${I}" is not a valid namedDest parameter.`);
      return;
    } else if (Array.isArray(g)) {
      if (!this.#C(C) && (C !== null || this._destination)) {
        console.error(`PDFHistory.push: "${C}" is not a valid pageNumber parameter.`);
        return;
      }
    } else {
      console.error(`PDFHistory.push: "${g}" is not a valid explicitDest parameter.`);
      return;
    }
    const A = I || JSON.stringify(g);
    if (!A)
      return;
    let i = !1;
    if (this._destination && ($c(this._destination.hash, A) || IG(this._destination.dest, g))) {
      if (this._destination.page)
        return;
      i = !0;
    }
    this._popStateInProgress && !i || (this.#g({
      dest: g,
      hash: A,
      page: C,
      rotation: this.linkService.rotation
    }, i), this._popStateInProgress || (this._popStateInProgress = !0, Promise.resolve().then(() => {
      this._popStateInProgress = !1;
    })));
  }
  pushPage(I) {
    if (this._initialized) {
      if (!this.#C(I)) {
        console.error(`PDFHistory.pushPage: "${I}" is not a valid page number.`);
        return;
      }
      this._destination?.page !== I && (this._popStateInProgress || (this.#g({
        dest: null,
        hash: `page=${I}`,
        page: I,
        rotation: this.linkService.rotation
      }), this._popStateInProgress || (this._popStateInProgress = !0, Promise.resolve().then(() => {
        this._popStateInProgress = !1;
      }))));
    }
  }
  pushCurrentPosition() {
    !this._initialized || this._popStateInProgress || this.#A();
  }
  back() {
    if (!this._initialized || this._popStateInProgress)
      return;
    const I = window.history.state;
    this.#i(I) && I.uid > 0 && window.history.back();
  }
  forward() {
    if (!this._initialized || this._popStateInProgress)
      return;
    const I = window.history.state;
    this.#i(I) && I.uid < this._maxUid && window.history.forward();
  }
  get popStateInProgress() {
    return this._initialized && (this._popStateInProgress || this._blockHashChange > 0);
  }
  get initialBookmark() {
    return this._initialized ? this._initialBookmark : null;
  }
  get initialRotation() {
    return this._initialized ? this._initialRotation : null;
  }
  #g(I, g = !1) {
    const C = g || !this._destination, A = {
      fingerprint: this._fingerprint,
      uid: C ? this._uid : this._uid + 1,
      destination: I
    };
    this.#l(I, A.uid);
    let i;
    if (this._updateUrl && I?.hash) {
      const {
        href: l,
        protocol: s
      } = document.location;
      s !== "file:" && (i = WZ(l, I.hash));
    }
    C ? window.history.replaceState(A, "", i) : window.history.pushState(A, "", i);
  }
  #A(I = !1) {
    if (!this._position)
      return;
    let g = this._position;
    if (I && (g = Object.assign(/* @__PURE__ */ Object.create(null), this._position), g.temporary = !0), !this._destination) {
      this.#g(g);
      return;
    }
    if (this._destination.temporary) {
      this.#g(g, !0);
      return;
    }
    if (this._destination.hash === g.hash || !this._destination.page && this._numPositionUpdates <= fc)
      return;
    let C = !1;
    if (this._destination.page >= g.first && this._destination.page <= g.page) {
      if (this._destination.dest !== void 0 || !this._destination.first)
        return;
      C = !0;
    }
    this.#g(g, C);
  }
  #C(I) {
    return Number.isInteger(I) && I > 0 && I <= this.linkService.pagesCount;
  }
  #i(I, g = !1) {
    if (!I)
      return !1;
    if (I.fingerprint !== this._fingerprint)
      if (g) {
        if (typeof I.fingerprint != "string" || I.fingerprint.length !== this._fingerprint.length)
          return !1;
        const [C] = performance.getEntriesByType("navigation");
        if (C?.type !== "reload")
          return !1;
      } else
        return !1;
    return !(!Number.isInteger(I.uid) || I.uid < 0 || I.destination === null || typeof I.destination != "object");
  }
  #l(I, g, C = !1) {
    this._updateViewareaTimeout && (clearTimeout(this._updateViewareaTimeout), this._updateViewareaTimeout = null), C && I?.temporary && delete I.temporary, this._destination = I, this._uid = g, this._maxUid = Math.max(this._maxUid, g), this._numPositionUpdates = 0;
  }
  #s(I = !1) {
    const g = unescape(AA()).substring(1), C = LC(g), A = C.get("nameddest") || "";
    let i = C.get("page") | 0;
    return (!this.#C(i) || I && A.length > 0) && (i = null), {
      hash: g,
      page: i,
      rotation: this.linkService.rotation
    };
  }
  #d({
    location: I
  }) {
    this._updateViewareaTimeout && (clearTimeout(this._updateViewareaTimeout), this._updateViewareaTimeout = null), this._position = {
      hash: I.pdfOpenParams.substring(1),
      page: this.linkService.page,
      first: I.pageNumber,
      rotation: I.rotation
    }, !this._popStateInProgress && (this._isPagesLoaded && this._destination && !this._destination.page && this._numPositionUpdates++, this._updateViewareaTimeout = setTimeout(() => {
      this._popStateInProgress || this.#A(!0), this._updateViewareaTimeout = null;
    }, _c));
  }
  #c({
    state: I
  }) {
    const g = AA(), C = this._currentHash !== g;
    if (this._currentHash = g, !I) {
      this._uid++;
      const {
        hash: i,
        page: l,
        rotation: s
      } = this.#s();
      this.#g({
        hash: i,
        page: l,
        rotation: s
      }, !0);
      return;
    }
    if (!this.#i(I))
      return;
    this._popStateInProgress = !0, C && (this._blockHashChange++, Ic({
      target: window,
      name: "hashchange",
      delay: Pc
    }).then(() => {
      this._blockHashChange--;
    }));
    const A = I.destination;
    this.#l(A, I.uid, !0), xl(A.rotation) && (this.linkService.rotation = A.rotation), A.dest ? this.linkService.goToDestination(A.dest) : A.hash ? this.linkService.setHash(A.hash) : A.page && (this.linkService.page = A.page), Promise.resolve().then(() => {
      this._popStateInProgress = !1;
    });
  }
  #Z() {
    (!this._destination || this._destination.temporary) && this.#A();
  }
  #o() {
    if (this.#I)
      return;
    this.#I = new AbortController();
    const {
      signal: I
    } = this.#I;
    this.eventBus._on("updateviewarea", this.#d.bind(this), {
      signal: I
    }), window.addEventListener("popstate", this.#c.bind(this), {
      signal: I
    }), window.addEventListener("pagehide", this.#Z.bind(this), {
      signal: I
    });
  }
  #b() {
    this.#I?.abort(), this.#I = null;
  }
}
function $c(Z, I) {
  return typeof Z != "string" || typeof I != "string" ? !1 : Z === I || LC(Z).get("nameddest") === I;
}
function IG(Z, I) {
  function g(C, A) {
    if (typeof C != typeof A || Array.isArray(C) || Array.isArray(A))
      return !1;
    if (C !== null && typeof C == "object" && A !== null) {
      if (Object.keys(C).length !== Object.keys(A).length)
        return !1;
      for (const i in C)
        if (!g(C[i], A[i]))
          return !1;
      return !0;
    }
    return C === A || Number.isNaN(C) && Number.isNaN(A);
  }
  if (!(Array.isArray(Z) && Array.isArray(I)) || Z.length !== I.length)
    return !1;
  for (let C = 0, A = Z.length; C < A; C++)
    if (!g(Z[C], I[C]))
      return !1;
  return !0;
}
class gG {
  #I = null;
  #g = null;
  #A = null;
  #C = null;
  #i = null;
  #l;
  constructor(I) {
    this.pdfPage = I.pdfPage, this.accessibilityManager = I.accessibilityManager, this.l10n = I.l10n, this.l10n ||= new xI(), this.annotationEditorLayer = null, this.div = null, this._cancelled = !1, this.#l = I.uiManager, this.#I = I.annotationLayer || null, this.#i = I.textLayer || null, this.#g = I.drawLayer || null, this.#A = I.onAppend || null, this.#C = I.structTreeLayer || null;
  }
  async render({
    viewport: I,
    intent: g = "display"
  }) {
    if (g !== "display" || this._cancelled)
      return;
    const C = I.clone({
      dontFlip: !0
    });
    if (this.div) {
      this.annotationEditorLayer.update({
        viewport: C
      }), this.show();
      return;
    }
    const A = this.div = document.createElement("div");
    A.className = "annotationEditorLayer", A.hidden = !0, A.dir = this.#l.direction, this.#A?.(A), this.annotationEditorLayer = new cZ({
      uiManager: this.#l,
      div: A,
      structTreeLayer: this.#C,
      accessibilityManager: this.accessibilityManager,
      pageIndex: this.pdfPage.pageNumber - 1,
      l10n: this.l10n,
      viewport: C,
      annotationLayer: this.#I,
      textLayer: this.#i,
      drawLayer: this.#g
    });
    const i = {
      viewport: C,
      div: A,
      annotations: null,
      intent: g
    };
    this.annotationEditorLayer.render(i), this.show();
  }
  cancel() {
    this._cancelled = !0, this.div && this.annotationEditorLayer.destroy();
  }
  hide() {
    this.div && (this.annotationEditorLayer.pause(!0), this.div.hidden = !0);
  }
  show() {
    !this.div || this.annotationEditorLayer.isInvisible || (this.div.hidden = !1, this.annotationEditorLayer.pause(!1));
  }
}
{
  var uA = /* @__PURE__ */ new Map();
  const {
    maxTouchPoints: Z,
    platform: I,
    userAgent: g
  } = navigator, C = /Android/.test(g), A = /\b(iPad|iPhone|iPod)(?=;)/.test(g) || I === "MacIntel" && Z > 1;
  (function() {
    (A || C) && uA.set("maxCanvasPixels", 5242880);
  })(), (function() {
    C && uA.set("useSystemFonts", !1);
  })();
}
const u = {
  BROWSER: 1,
  VIEWER: 2,
  API: 4,
  WORKER: 8,
  EVENT_DISPATCH: 16,
  PREFERENCE: 128
}, RA = {
  BOOLEAN: 1,
  NUMBER: 2,
  OBJECT: 4,
  STRING: 8,
  UNDEFINED: 16
}, QI = {
  allowedGlobalEvents: {
    value: null,
    kind: u.BROWSER
  },
  canvasMaxAreaInBytes: {
    value: -1,
    kind: u.BROWSER + u.API
  },
  isInAutomation: {
    value: !1,
    kind: u.BROWSER
  },
  localeProperties: {
    value: {
      lang: navigator.language || "en-US"
    },
    kind: u.BROWSER
  },
  maxCanvasDim: {
    value: 32767,
    kind: u.BROWSER + u.VIEWER
  },
  nimbusDataStr: {
    value: "",
    kind: u.BROWSER
  },
  supportsCaretBrowsingMode: {
    value: !1,
    kind: u.BROWSER
  },
  supportsDocumentFonts: {
    value: !0,
    kind: u.BROWSER
  },
  supportsIntegratedFind: {
    value: !1,
    kind: u.BROWSER
  },
  supportsMouseWheelZoomCtrlKey: {
    value: !0,
    kind: u.BROWSER
  },
  supportsMouseWheelZoomMetaKey: {
    value: !0,
    kind: u.BROWSER
  },
  supportsPinchToZoom: {
    value: !0,
    kind: u.BROWSER
  },
  supportsPrinting: {
    value: !0,
    kind: u.BROWSER
  },
  toolbarDensity: {
    value: 0,
    kind: u.BROWSER + u.EVENT_DISPATCH
  },
  altTextLearnMoreUrl: {
    value: "",
    kind: u.VIEWER + u.PREFERENCE
  },
  annotationEditorMode: {
    value: 0,
    kind: u.VIEWER + u.PREFERENCE
  },
  annotationMode: {
    value: 2,
    kind: u.VIEWER + u.PREFERENCE
  },
  capCanvasAreaFactor: {
    value: 200,
    kind: u.VIEWER + u.PREFERENCE
  },
  commentLearnMoreUrl: {
    value: "",
    kind: u.VIEWER + u.PREFERENCE
  },
  cursorToolOnLoad: {
    value: 0,
    kind: u.VIEWER + u.PREFERENCE
  },
  debuggerSrc: {
    value: "./debugger.mjs",
    kind: u.VIEWER
  },
  defaultZoomDelay: {
    value: 400,
    kind: u.VIEWER + u.PREFERENCE
  },
  defaultZoomValue: {
    value: "",
    kind: u.VIEWER + u.PREFERENCE
  },
  disableHistory: {
    value: !1,
    kind: u.VIEWER
  },
  disablePageLabels: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableAltText: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableAltTextModelDownload: {
    value: !0,
    kind: u.VIEWER + u.PREFERENCE + u.EVENT_DISPATCH
  },
  enableAutoLinking: {
    value: !0,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableComment: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableDetailCanvas: {
    value: !0,
    kind: u.VIEWER
  },
  enableGuessAltText: {
    value: !0,
    kind: u.VIEWER + u.PREFERENCE + u.EVENT_DISPATCH
  },
  enableHighlightFloatingButton: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableNewAltTextWhenAddingImage: {
    value: !0,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableOptimizedPartialRendering: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  enablePermissions: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  enablePrintAutoRotate: {
    value: !0,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableScripting: {
    value: !0,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableSignatureEditor: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  enableUpdatedAddImage: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  externalLinkRel: {
    value: "noopener noreferrer nofollow",
    kind: u.VIEWER
  },
  externalLinkTarget: {
    value: 0,
    kind: u.VIEWER + u.PREFERENCE
  },
  highlightEditorColors: {
    value: "yellow=#FFFF98,green=#53FFBC,blue=#80EBFF,pink=#FFCBE6,red=#FF4F5F,yellow_HCM=#FFFFCC,green_HCM=#53FFBC,blue_HCM=#80EBFF,pink_HCM=#F6B8FF,red_HCM=#C50043",
    kind: u.VIEWER + u.PREFERENCE
  },
  historyUpdateUrl: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  ignoreDestinationZoom: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  imageResourcesPath: {
    value: "./images/",
    kind: u.VIEWER
  },
  maxCanvasPixels: {
    value: 2 ** 25,
    kind: u.VIEWER
  },
  minDurationToUpdateCanvas: {
    value: 500,
    kind: u.VIEWER
  },
  forcePageColors: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  pageColorsBackground: {
    value: "Canvas",
    kind: u.VIEWER + u.PREFERENCE
  },
  pageColorsForeground: {
    value: "CanvasText",
    kind: u.VIEWER + u.PREFERENCE
  },
  pdfBugEnabled: {
    value: !1,
    kind: u.VIEWER + u.PREFERENCE
  },
  printResolution: {
    value: 150,
    kind: u.VIEWER
  },
  sidebarViewOnLoad: {
    value: -1,
    kind: u.VIEWER + u.PREFERENCE
  },
  scrollModeOnLoad: {
    value: -1,
    kind: u.VIEWER + u.PREFERENCE
  },
  spreadModeOnLoad: {
    value: -1,
    kind: u.VIEWER + u.PREFERENCE
  },
  textLayerMode: {
    value: 1,
    kind: u.VIEWER + u.PREFERENCE
  },
  viewerCssTheme: {
    value: 0,
    kind: u.VIEWER + u.PREFERENCE
  },
  viewOnLoad: {
    value: 0,
    kind: u.VIEWER + u.PREFERENCE
  },
  cMapPacked: {
    value: !0,
    kind: u.API
  },
  cMapUrl: {
    value: "../web/cmaps/",
    kind: u.API
  },
  disableAutoFetch: {
    value: !1,
    kind: u.API + u.PREFERENCE
  },
  disableFontFace: {
    value: !1,
    kind: u.API + u.PREFERENCE
  },
  disableRange: {
    value: !1,
    kind: u.API + u.PREFERENCE
  },
  disableStream: {
    value: !1,
    kind: u.API + u.PREFERENCE
  },
  docBaseUrl: {
    value: "",
    kind: u.API
  },
  enableHWA: {
    value: !0,
    kind: u.API + u.VIEWER + u.PREFERENCE
  },
  enableXfa: {
    value: !0,
    kind: u.API + u.PREFERENCE
  },
  fontExtraProperties: {
    value: !1,
    kind: u.API
  },
  iccUrl: {
    value: "../web/iccs/",
    kind: u.API
  },
  isEvalSupported: {
    value: !0,
    kind: u.API
  },
  isOffscreenCanvasSupported: {
    value: !0,
    kind: u.API
  },
  maxImageSize: {
    value: -1,
    kind: u.API
  },
  pdfBug: {
    value: !1,
    kind: u.API
  },
  standardFontDataUrl: {
    value: "../web/standard_fonts/",
    kind: u.API
  },
  useSystemFonts: {
    value: void 0,
    kind: u.API,
    type: RA.BOOLEAN + RA.UNDEFINED
  },
  verbosity: {
    value: 1,
    kind: u.API
  },
  wasmUrl: {
    value: "../web/wasm/",
    kind: u.API
  },
  workerPort: {
    value: null,
    kind: u.WORKER
  },
  workerSrc: {
    value: "../build/pdf.worker.mjs",
    kind: u.WORKER
  }
};
QI.defaultUrl = {
  value: "compressed.tracemonkey-pldi-09.pdf",
  kind: u.VIEWER
}, QI.sandboxBundleSrc = {
  value: "../build/pdf.sandbox.mjs",
  kind: u.VIEWER
}, QI.enableFakeMLManager = {
  value: !0,
  kind: u.VIEWER
};
QI.disablePreferences = {
  value: !1,
  kind: u.VIEWER
};
var $I;
const FI = class FI {
  static get(I) {
    return v(this, $I).get(I);
  }
  static getAll(I = null, g = !1) {
    const C = /* @__PURE__ */ Object.create(null);
    for (const A in QI) {
      const i = QI[A];
      I && !(I & i.kind) || (C[A] = g ? i.value : v(this, $I).get(A));
    }
    return C;
  }
  static set(I, g) {
    this.setAll({
      [I]: g
    });
  }
  static setAll(I, g = !1) {
    this._hasInvokedSet ||= !0;
    let C;
    for (const A in I) {
      const i = QI[A], l = I[A];
      if (!i || !(typeof l == typeof i.value || RA[(typeof l).toUpperCase()] & i.type))
        continue;
      const {
        kind: s
      } = i;
      g && !(s & u.BROWSER || s & u.PREFERENCE) || (this.eventBus && s & u.EVENT_DISPATCH && (C ||= /* @__PURE__ */ new Map()).set(A, l), v(this, $I).set(A, l));
    }
    if (C)
      for (const [A, i] of C)
        this.eventBus.dispatch(A.toLowerCase(), {
          source: this,
          value: i
        });
  }
};
$I = new WeakMap(), UA(FI, "eventBus"), yI(FI, $I, /* @__PURE__ */ new Map()), (() => {
  for (const I in QI)
    v(FI, $I).set(I, QI[I].value);
  for (const [I, g] of uA)
    v(FI, $I).set(I, g);
  FI._hasInvokedSet = !1, FI._checkDisablePreferences = () => FI.get("disablePreferences") ? !0 : (FI._hasInvokedSet && console.warn('The Preferences may override manually set AppOptions; please use the "disablePreferences"-option to prevent that.'), !1);
})();
let Qg = FI;
function fi({
  width: Z,
  height: I,
  left: g,
  top: C
}, A) {
  if (Z === 0 || I === 0)
    return null;
  const i = A.textLayer.div.getBoundingClientRect(), l = A.getPagePoint(g - i.left, C - i.top), s = A.getPagePoint(g - i.left + Z, C - i.top + I);
  return QA.normalizeRect([l[0], l[1], s[0], s[1]]);
}
function CG(Z, I) {
  const g = Z.getClientRects();
  if (g.length === 1)
    return {
      rect: fi(g[0], I)
    };
  const C = [1 / 0, 1 / 0, -1 / 0, -1 / 0], A = [];
  let i = 0;
  for (const l of g) {
    const s = fi(l, I);
    s !== null && (A[i] = A[i + 4] = s[0], A[i + 1] = A[i + 3] = s[3], A[i + 2] = A[i + 6] = s[2], A[i + 5] = A[i + 7] = s[1], QA.rectBoundingBox(...s, C), i += 8);
  }
  return {
    quadPoints: A,
    rect: C
  };
}
function _i(Z, I) {
  let g = Z;
  do {
    if (g.nodeType === Node.TEXT_NODE) {
      const C = g.textContent.length;
      if (I <= C)
        return [g, I];
      I -= C;
    } else if (g.firstChild) {
      g = g.firstChild;
      continue;
    }
    for (; !g.nextSibling && g !== Z; )
      g = g.parentNode;
    g !== Z && (g = g.nextSibling);
  } while (g !== Z);
  throw new Error("Offset is bigger than container's contents length.");
}
function AG({
  url: Z,
  index: I,
  length: g
}, C, A) {
  const i = C._textHighlighter, [{
    begin: l,
    end: s
  }] = i._convertMatches([I], [g]), d = new Range();
  return d.setStart(..._i(i.textDivs[l.divIdx], l.offset)), d.setEnd(..._i(i.textDivs[s.divIdx], s.offset)), {
    id: `inferred_link_${A}`,
    unsafeUrl: Z,
    url: Z,
    annotationType: kl.LINK,
    rotation: 0,
    ...CG(d, C),
    borderStyle: null
  };
}
class iG {
  static #I = 0;
  static #g;
  static findLinks(I) {
    this.#g ??= new RegExp("\\b(?:https?:\\/\\/|mailto:|www\\.)(?:[\\S--[\\p{P}<>]]|\\/|[\\S--[\\[\\]]]+[\\S--[\\p{P}<>]])+|\\b[\\S--[@\\p{Ps}\\p{Pe}<>]]+@([\\S--[\\p{P}<>]]+(?:\\.[\\S--[\\p{P}<>]]+)+)", "gmv");
    const [g, C] = NC(I, {
      ignoreDashEOL: !0
    }), A = g.matchAll(this.#g), i = [];
    for (const l of A) {
      const [s, d] = l;
      let c;
      if (s.startsWith("www.") || s.startsWith("http://") || s.startsWith("https://"))
        c = s;
      else if (URL.canParse(`http://${d}`))
        c = s.startsWith("mailto:") ? s : `mailto:${s}`;
      else
        continue;
      const G = rl(c, null, {
        addDefaultProtocol: !0
      });
      if (G) {
        const [b, o] = Ol(C, l.index, s.length);
        i.push({
          url: G.href,
          index: b,
          length: o
        });
      }
    }
    return i;
  }
  static processLinks(I) {
    return this.findLinks(I._textHighlighter.textContentItemsStr.join(`
`)).map((g) => AG(g, I, this.#I++));
  }
}
class ql {
  #I = null;
  #g = 0;
  #A = null;
  #C = O.INITIAL;
  #i = null;
  #l = 0;
  #s = null;
  canvas = null;
  div = null;
  enableOptimizedPartialRendering = !1;
  eventBus = null;
  id = null;
  pageColors = null;
  recordedBBoxes = null;
  renderingQueue = null;
  renderTask = null;
  resume = null;
  constructor(I) {
    this.eventBus = I.eventBus, this.id = I.id, this.pageColors = I.pageColors || null, this.renderingQueue = I.renderingQueue, this.enableOptimizedPartialRendering = I.enableOptimizedPartialRendering ?? !1, this.#g = I.minDurationToUpdateCanvas ?? 500;
  }
  get renderingState() {
    return this.#C;
  }
  set renderingState(I) {
    if (I !== this.#C)
      switch (this.#C = I, this.#I && (clearTimeout(this.#I), this.#I = null), I) {
        case O.PAUSED:
          this.div.classList.remove("loading"), this.#l = 0, this.#i?.(!1);
          break;
        case O.RUNNING:
          this.div.classList.add("loadingIcon"), this.#I = setTimeout(() => {
            this.div.classList.add("loading"), this.#I = null;
          }, 0), this.#l = Date.now();
          break;
        case O.INITIAL:
        case O.FINISHED:
          this.div.classList.remove("loadingIcon", "loading"), this.#l = 0;
          break;
      }
  }
  _createCanvas(I, g = !1) {
    const {
      pageColors: C
    } = this, A = !!(C?.background && C?.foreground), i = this.canvas, l = !i && !A && !g;
    let s = this.canvas = document.createElement("canvas");
    return this.#i = (d) => {
      if (l) {
        let c = this.#s;
        if (!d && this.#g > 0) {
          if (Date.now() - this.#l < this.#g)
            return;
          c || (c = this.#s = s, s = this.canvas = s.cloneNode(!1), I(s));
        }
        if (c) {
          s.getContext("2d", {
            alpha: !1
          }).drawImage(c, 0, 0), d ? this.#c() : this.#l = Date.now();
          return;
        }
        I(s), this.#i = null;
        return;
      }
      d && (i ? (i.replaceWith(s), i.width = i.height = 0) : I(s));
    }, {
      canvas: s,
      prevCanvas: i
    };
  }
  #d = (I) => {
    if (this.#i?.(!1), this.renderingQueue && !this.renderingQueue.isHighestPriority(this)) {
      this.renderingState = O.PAUSED, this.resume = () => {
        this.renderingState = O.RUNNING, I();
      };
      return;
    }
    I();
  };
  _resetCanvas() {
    const {
      canvas: I
    } = this;
    I && (I.remove(), I.width = I.height = 0, this.canvas = null, this.#c());
  }
  #c() {
    this.#s && (this.#s.width = this.#s.height = 0, this.#s = null);
  }
  async _drawCanvas(I, g, C) {
    const A = this.renderTask = this.pdfPage.render(I);
    A.onContinue = this.#d, A.onError = (l) => {
      l instanceof wA && (g(), this.#A = null);
    };
    let i = null;
    try {
      await A.promise, this.#i?.(!0);
    } catch (l) {
      if (l instanceof wA)
        return;
      i = l, this.#i?.(!0);
    } finally {
      this.#A = i, A === this.renderTask && (this.renderTask = null, this.enableOptimizedPartialRendering && (this.recordedBBoxes ??= A.recordedBBoxes));
    }
    if (this.renderingState = O.FINISHED, C(A), i)
      throw i;
  }
  cancelRendering({
    cancelExtraDelay: I = 0
  } = {}) {
    this.renderTask && (this.renderTask.cancel(I), this.renderTask = null), this.resume = null;
  }
  dispatchPageRender() {
    this.eventBus.dispatch("pagerender", {
      source: this,
      pageNumber: this.id
    });
  }
  dispatchPageRendered(I, g) {
    this.eventBus.dispatch("pagerendered", {
      source: this,
      pageNumber: this.id,
      cssTransform: I,
      isDetailView: g,
      timestamp: performance.now(),
      error: this.#A
    });
  }
}
class lG {
  #I = null;
  constructor(I) {
    this.pageIndex = I.pageIndex;
  }
  async render({
    intent: I = "display"
  }) {
    I !== "display" || this.#I || this._cancelled || (this.#I = new oZ({
      pageIndex: this.pageIndex
    }));
  }
  cancel() {
    this._cancelled = !0, this.#I && (this.#I.destroy(), this.#I = null);
  }
  setParent(I) {
    this.#I?.setParent(I);
  }
  getDrawLayer() {
    return this.#I;
  }
}
class sG extends ql {
  #I = null;
  renderingCancelled = !1;
  constructor({
    pageView: I
  }) {
    super(I), this.pageView = I, this.renderingId = "detail" + this.id, this.div = I.div;
  }
  setPdfPage(I) {
    this.pageView.setPdfPage(I);
  }
  get pdfPage() {
    return this.pageView.pdfPage;
  }
  get renderingState() {
    return super.renderingState;
  }
  set renderingState(I) {
    this.renderingCancelled = !1, super.renderingState = I;
  }
  reset({
    keepCanvas: I = !1
  } = {}) {
    const g = this.renderingCancelled || this.renderingState === O.RUNNING || this.renderingState === O.PAUSED;
    this.cancelRendering(), this.renderingState = O.INITIAL, this.renderingCancelled = g, I || this._resetCanvas();
  }
  #g(I) {
    if (!this.#I)
      return !0;
    const g = this.#I.minX, C = this.#I.minY, A = this.#I.width + g, i = this.#I.height + C;
    if (I.minX < g || I.minY < C || I.maxX > A || I.maxY > i)
      return !0;
    const {
      width: l,
      height: s,
      scale: d
    } = this.pageView.viewport;
    if (this.#I.scale !== d)
      return !0;
    const c = I.minX - g, G = A - I.maxX, b = I.minY - C, o = i - I.maxY, m = 0.5, e = (1 + m) / m;
    return g > 0 && G / c > e || A < l && c / G > e || C > 0 && o / b > e || i < s && b / o > e;
  }
  update({
    visibleArea: I = null,
    underlyingViewUpdated: g = !1
  } = {}) {
    if (g) {
      this.cancelRendering(), this.renderingState = O.INITIAL;
      return;
    }
    if (!this.#g(I))
      return;
    const {
      viewport: C,
      maxCanvasPixels: A,
      capCanvasAreaFactor: i
    } = this.pageView, l = I.maxX - I.minX, s = I.maxY - I.minY, d = l * s * VC.pixelRatio ** 2, G = (Math.sqrt(VC.capPixels(A, i) / d) - 1) / 2;
    let b = Math.min(1, G);
    b < 0 && (b = 0);
    const o = l * b, m = s * b, e = Math.max(0, I.minX - o), a = Math.min(C.width, I.maxX + o), h = Math.max(0, I.minY - m), t = Math.min(C.height, I.maxY + m), W = a - e, B = t - h;
    this.#I = {
      minX: e,
      minY: h,
      width: W,
      height: B,
      scale: C.scale
    }, this.reset({
      keepCanvas: !0
    });
  }
  _getRenderingContext(I, g) {
    const C = this.pageView._getRenderingContext(I, g, !1), A = this.pdfPage.recordedBBoxes;
    if (!A || !this.enableOptimizedPartialRendering)
      return C;
    const {
      viewport: {
        width: i,
        height: l
      }
    } = this.pageView, {
      width: s,
      height: d,
      minX: c,
      minY: G
    } = this.#I, b = c / i, o = G / l, m = (c + s) / i, e = (G + d) / l;
    return {
      ...C,
      operationsFilter(a) {
        return A.isEmpty(a) ? !1 : A.minX(a) <= m && A.maxX(a) >= b && A.minY(a) <= e && A.maxY(a) >= o;
      }
    };
  }
  async draw() {
    if (this.pageView.detailView !== this)
      return;
    const I = this.pageView.renderingState === O.FINISHED || this.renderingState === O.FINISHED;
    this.renderingState !== O.INITIAL && (console.error("Must be in new state before drawing"), this.reset());
    const {
      div: g,
      pdfPage: C,
      viewport: A
    } = this.pageView;
    if (!C)
      throw this.renderingState = O.FINISHED, new Error("pdfPage is not loaded");
    this.renderingState = O.RUNNING;
    const i = this.pageView._ensureCanvasWrapper(), {
      canvas: l,
      prevCanvas: s
    } = this._createCanvas((a) => {
      i.firstElementChild?.tagName === "CANVAS" ? i.firstElementChild.after(a) : i.prepend(a);
    }, I);
    l.ariaHidden = !0, this.enableOptimizedPartialRendering && (l.className = "detailView");
    const {
      width: d,
      height: c
    } = A, G = this.#I, {
      pixelRatio: b
    } = VC, o = [b, 0, 0, b, -G.minX * b, -G.minY * b];
    l.width = G.width * b, l.height = G.height * b;
    const {
      style: m
    } = l;
    m.width = `${G.width * 100 / d}%`, m.height = `${G.height * 100 / c}%`, m.top = `${G.minY * 100 / c}%`, m.left = `${G.minX * 100 / d}%`;
    const e = this._drawCanvas(this._getRenderingContext(l, o), () => {
      this.canvas?.remove(), this.canvas = s;
    }, () => {
      this.dispatchPageRendered(!1, !0);
    });
    return g.setAttribute("data-loaded", !0), this.dispatchPageRender(), e;
  }
}
const qi = {
  Document: null,
  DocumentFragment: null,
  Part: "group",
  Sect: "group",
  Div: "group",
  Aside: "note",
  NonStruct: "none",
  P: null,
  H: "heading",
  Title: null,
  FENote: "note",
  Sub: "group",
  Lbl: null,
  Span: null,
  Em: null,
  Strong: null,
  Link: "link",
  Annot: "note",
  Form: "form",
  Ruby: null,
  RB: null,
  RT: null,
  RP: null,
  Warichu: null,
  WT: null,
  WP: null,
  L: "list",
  LI: "listitem",
  LBody: null,
  Table: "table",
  TR: "row",
  TH: "columnheader",
  TD: "cell",
  THead: "columnheader",
  TBody: null,
  TFoot: null,
  Caption: null,
  Figure: "figure",
  Formula: null,
  Artifact: null
}, dG = /^H(\d+)$/;
class $l {
  #I;
  #g = null;
  #A;
  #C = /* @__PURE__ */ new Map();
  #i;
  #l = null;
  constructor(I, g) {
    this.#I = I.getStructTree(), this.#i = g;
  }
  async render() {
    if (this.#A)
      return this.#A;
    const {
      promise: I,
      resolve: g,
      reject: C
    } = Promise.withResolvers();
    this.#A = I;
    try {
      this.#g = this.#c(await this.#I);
    } catch (A) {
      C(A);
    }
    return this.#I = null, this.#g?.classList.add("structTree"), g(this.#g), I;
  }
  async getAriaAttributes(I) {
    try {
      return await this.render(), this.#C.get(I);
    } catch {
    }
    return null;
  }
  hide() {
    this.#g && !this.#g.hidden && (this.#g.hidden = !0);
  }
  show() {
    this.#g?.hidden && (this.#g.hidden = !1);
  }
  #s(I, g) {
    const {
      alt: C,
      id: A,
      lang: i
    } = I;
    if (C !== void 0) {
      let l = !1;
      const s = jg(C);
      for (const d of I.children)
        if (d.type === "annotation") {
          let c = this.#C.get(d.id);
          c || (c = /* @__PURE__ */ new Map(), this.#C.set(d.id, c)), c.set("aria-label", s), l = !0;
        }
      l || g.setAttribute("aria-label", s);
    }
    A !== void 0 && g.setAttribute("aria-owns", A), i !== void 0 && g.setAttribute("lang", jg(i, !0));
  }
  #d(I, g) {
    const {
      alt: C,
      bbox: A,
      children: i
    } = I, l = i?.[0];
    if (!this.#i || !C || !A || l?.type !== "content")
      return !1;
    const {
      id: s
    } = l;
    if (!s)
      return !1;
    g.setAttribute("aria-owns", s);
    const d = document.createElement("span");
    (this.#l ||= /* @__PURE__ */ new Map()).set(s, d), d.setAttribute("role", "img"), d.setAttribute("aria-label", jg(C));
    const {
      pageHeight: c,
      pageX: G,
      pageY: b
    } = this.#i, o = "calc(var(--total-scale-factor) *", {
      style: m
    } = d;
    return m.width = `${o}${A[2] - A[0]}px)`, m.height = `${o}${A[3] - A[1]}px)`, m.left = `${o}${A[0] - G}px)`, m.top = `${o}${c - A[3] + b}px)`, !0;
  }
  addElementsToTextLayer() {
    if (this.#l) {
      for (const [I, g] of this.#l)
        document.getElementById(I)?.append(g);
      this.#l.clear(), this.#l = null;
    }
  }
  #c(I) {
    if (!I)
      return null;
    const g = document.createElement("span");
    if ("role" in I) {
      const {
        role: C
      } = I, A = C.match(dG);
      if (A ? (g.setAttribute("role", "heading"), g.setAttribute("aria-level", A[1])) : qi[C] && g.setAttribute("role", qi[C]), C === "Figure" && this.#d(I, g))
        return g;
    }
    if (this.#s(I, g), I.children)
      if (I.children.length === 1 && "id" in I.children[0])
        this.#s(I.children[0], g);
      else
        for (const C of I.children)
          g.append(this.#c(C));
    return g;
  }
}
class xg {
  #I = !1;
  #g = null;
  #A = /* @__PURE__ */ new Map();
  #C = /* @__PURE__ */ new Map();
  setTextMapping(I) {
    this.#g = I;
  }
  static #i(I, g) {
    const C = I.getBoundingClientRect(), A = g.getBoundingClientRect();
    if (C.width === 0 && C.height === 0)
      return 1;
    if (A.width === 0 && A.height === 0)
      return -1;
    const i = C.y, l = C.y + C.height, s = C.y + C.height / 2, d = A.y, c = A.y + A.height, G = A.y + A.height / 2;
    if (s <= d && G >= l)
      return -1;
    if (G <= i && s >= c)
      return 1;
    const b = C.x + C.width / 2, o = A.x + A.width / 2;
    return b - o;
  }
  enable() {
    if (this.#I)
      throw new Error("TextAccessibilityManager is already enabled.");
    if (!this.#g)
      throw new Error("Text divs and strings have not been set.");
    if (this.#I = !0, this.#g = this.#g.slice(), this.#g.sort(xg.#i), this.#A.size > 0) {
      const I = this.#g;
      for (const [g, C] of this.#A) {
        if (!document.getElementById(g)) {
          this.#A.delete(g);
          continue;
        }
        this.#l(g, I[C]);
      }
    }
    for (const [I, g] of this.#C)
      this.addPointerInTextLayer(I, g);
    this.#C.clear();
  }
  disable() {
    this.#I && (this.#C.clear(), this.#g = null, this.#I = !1);
  }
  removePointerInTextLayer(I) {
    if (!this.#I) {
      this.#C.delete(I);
      return;
    }
    const g = this.#g;
    if (!g || g.length === 0)
      return;
    const {
      id: C
    } = I, A = this.#A.get(C);
    if (A === void 0)
      return;
    const i = g[A];
    this.#A.delete(C);
    let l = i.getAttribute("aria-owns");
    l?.includes(C) && (l = l.split(" ").filter((s) => s !== C).join(" "), l ? i.setAttribute("aria-owns", l) : (i.removeAttribute("aria-owns"), i.setAttribute("role", "presentation")));
  }
  #l(I, g) {
    const C = g.getAttribute("aria-owns");
    C?.includes(I) || g.setAttribute("aria-owns", C ? `${C} ${I}` : I), g.removeAttribute("role");
  }
  addPointerInTextLayer(I, g) {
    const {
      id: C
    } = I;
    if (!C)
      return null;
    if (!this.#I)
      return this.#C.set(I, g), null;
    g && this.removePointerInTextLayer(I);
    const A = this.#g;
    if (!A || A.length === 0)
      return null;
    const i = fg(A, (c) => xg.#i(I, c) < 0), l = Math.max(0, i - 1), s = A[l];
    this.#l(C, s), this.#A.set(C, l);
    const d = s.parentNode;
    return d?.classList.contains("markedContent") ? d.id : null;
  }
  moveElementInDOM(I, g, C, A) {
    const i = this.addPointerInTextLayer(C, A);
    if (!I.hasChildNodes())
      return I.append(g), i;
    const l = Array.from(I.childNodes).filter((c) => c !== g);
    if (l.length === 0)
      return i;
    const s = C || g, d = fg(l, (c) => xg.#i(s, c) < 0);
    return d === 0 ? l[0].before(g) : l[d - 1].after(g), i;
  }
}
class ZG {
  #I = null;
  constructor({
    findController: I,
    eventBus: g,
    pageIndex: C
  }) {
    this.findController = I, this.matches = [], this.eventBus = g, this.pageIdx = C, this.textDivs = null, this.textContentItemsStr = null, this.enabled = !1;
  }
  setTextMapping(I, g) {
    this.textDivs = I, this.textContentItemsStr = g;
  }
  enable() {
    if (!this.textDivs || !this.textContentItemsStr)
      throw new Error("Text divs and strings have not been set.");
    if (this.enabled)
      throw new Error("TextHighlighter is already enabled.");
    this.enabled = !0, this.#I || (this.#I = new AbortController(), this.eventBus._on("updatetextlayermatches", (I) => {
      (I.pageIndex === this.pageIdx || I.pageIndex === -1) && this._updateMatches();
    }, {
      signal: this.#I.signal
    })), this._updateMatches();
  }
  disable() {
    this.enabled && (this.enabled = !1, this.#I?.abort(), this.#I = null, this._updateMatches(!0));
  }
  _convertMatches(I, g) {
    if (!I)
      return [];
    const {
      textContentItemsStr: C
    } = this;
    let A = 0, i = 0;
    const l = C.length - 1, s = [];
    for (let d = 0, c = I.length; d < c; d++) {
      let G = I[d];
      for (; A !== l && G >= i + C[A].length; )
        i += C[A].length, A++;
      A === C.length && console.error("Could not find a matching mapping");
      const b = {
        begin: {
          divIdx: A,
          offset: G - i
        }
      };
      for (G += g[d]; A !== l && G > i + C[A].length; )
        i += C[A].length, A++;
      b.end = {
        divIdx: A,
        offset: G - i
      }, s.push(b);
    }
    return s;
  }
  _renderMatches(I) {
    if (I.length === 0)
      return;
    const {
      findController: g,
      pageIdx: C
    } = this, {
      textContentItemsStr: A,
      textDivs: i
    } = this, l = C === g.selected.pageIdx, s = g.selected.matchIdx, d = g.state.highlightAll;
    let c = null;
    const G = {
      offset: void 0
    };
    function b(t, W) {
      const B = t.divIdx;
      return i[B].textContent = "", o(B, 0, t.offset, W);
    }
    function o(t, W, B, w) {
      let n = i[t];
      if (n.nodeType === Node.TEXT_NODE) {
        const R = document.createElement("span");
        n.before(R), R.append(n), i[t] = R, n = R;
      }
      const V = A[t].substring(W, B), N = document.createTextNode(V);
      if (w) {
        const R = document.createElement("span");
        if (R.className = `${w} appended`, R.append(N), n.append(R), w.includes("selected")) {
          const {
            left: Y
          } = R.getClientRects()[0], y = n.getBoundingClientRect().left;
          return Y - y;
        }
        return 0;
      }
      return n.append(N), 0;
    }
    let m = s, e = m + 1;
    if (d)
      m = 0, e = I.length;
    else if (!l)
      return;
    let a = -1, h = -1;
    for (let t = m; t < e; t++) {
      const W = I[t], B = W.begin;
      if (B.divIdx === a && B.offset === h)
        continue;
      a = B.divIdx, h = B.offset;
      const w = W.end, n = l && t === s, V = n ? " selected" : "";
      let N = 0;
      if (!c || B.divIdx !== c.divIdx ? (c !== null && o(c.divIdx, c.offset, G.offset), b(B)) : o(c.divIdx, c.offset, B.offset), B.divIdx === w.divIdx)
        N = o(B.divIdx, B.offset, w.offset, "highlight" + V);
      else {
        N = o(B.divIdx, B.offset, G.offset, "highlight begin" + V);
        for (let R = B.divIdx + 1, Y = w.divIdx; R < Y; R++)
          i[R].className = "highlight middle" + V;
        b(w, "highlight end" + V);
      }
      c = w, n && g.scrollMatchIntoView({
        element: i[B.divIdx],
        selectedLeft: N,
        pageIndex: C,
        matchIndex: s
      });
    }
    c && o(c.divIdx, c.offset, G.offset);
  }
  _updateMatches(I = !1) {
    if (!this.enabled && !I)
      return;
    const {
      findController: g,
      matches: C,
      pageIdx: A
    } = this, {
      textContentItemsStr: i,
      textDivs: l
    } = this;
    let s = -1;
    for (const G of C) {
      const b = Math.max(s, G.begin.divIdx);
      for (let o = b, m = G.end.divIdx; o <= m; o++) {
        const e = l[o];
        e.textContent = i[o], e.className = "";
      }
      s = G.end.divIdx + 1;
    }
    if (!g?.highlightMatches || I)
      return;
    const d = g.pageMatches[A] || null, c = g.pageMatchesLength[A] || null;
    this.matches = this._convertMatches(d, c), this._renderMatches(this.matches);
  }
}
class yg {
  #I = !1;
  #g = null;
  #A = !1;
  #C = null;
  static #i = /* @__PURE__ */ new Map();
  static #l = null;
  constructor({
    pdfPage: I,
    highlighter: g = null,
    accessibilityManager: C = null,
    enablePermissions: A = !1,
    onAppend: i = null
  }) {
    this.pdfPage = I, this.highlighter = g, this.accessibilityManager = C, this.#I = A === !0, this.#g = i, this.div = document.createElement("div"), this.div.tabIndex = 0, this.div.className = "textLayer";
  }
  async render({
    viewport: I,
    textContentParams: g = null
  }) {
    if (this.#A && this.#C) {
      this.#C.update({
        viewport: I,
        onBefore: this.hide.bind(this)
      }), this.show();
      return;
    }
    this.cancel(), this.#C = new BZ({
      textContentSource: this.pdfPage.streamTextContent(g || {
        includeMarkedContent: !0,
        disableNormalization: !0
      }),
      container: this.div,
      viewport: I
    });
    const {
      textDivs: C,
      textContentItemsStr: A
    } = this.#C;
    this.highlighter?.setTextMapping(C, A), this.accessibilityManager?.setTextMapping(C), await this.#C.render(), this.#A = !0;
    const i = document.createElement("div");
    i.className = "endOfContent", this.div.append(i), this.#s(i), this.#g?.(this.div), this.highlighter?.enable(), this.accessibilityManager?.enable();
  }
  hide() {
    !this.div.hidden && this.#A && (this.highlighter?.disable(), this.div.hidden = !0);
  }
  show() {
    this.div.hidden && this.#A && (this.div.hidden = !1, this.highlighter?.enable());
  }
  cancel() {
    this.#C?.cancel(), this.#C = null, this.highlighter?.disable(), this.accessibilityManager?.disable(), yg.#d(this.div);
  }
  #s(I) {
    const {
      div: g
    } = this;
    g.addEventListener("mousedown", () => {
      g.classList.add("selecting");
    }), g.addEventListener("copy", (C) => {
      if (!this.#I) {
        const A = document.getSelection();
        C.clipboardData.setData("text/plain", jg(hZ(A.toString())));
      }
      nA(C);
    }), yg.#i.set(g, I), yg.#c();
  }
  static #d(I) {
    this.#i.delete(I), this.#i.size === 0 && (this.#l?.abort(), this.#l = null);
  }
  static #c() {
    if (this.#l)
      return;
    this.#l = new AbortController();
    const {
      signal: I
    } = this.#l, g = (l, s) => {
      s.append(l), l.style.width = "", l.style.height = "", s.classList.remove("selecting");
    };
    let C = !1;
    document.addEventListener("pointerdown", () => {
      C = !0;
    }, {
      signal: I
    }), document.addEventListener("pointerup", () => {
      C = !1, this.#i.forEach(g);
    }, {
      signal: I
    }), window.addEventListener("blur", () => {
      C = !1, this.#i.forEach(g);
    }, {
      signal: I
    }), document.addEventListener("keyup", () => {
      C || this.#i.forEach(g);
    }, {
      signal: I
    });
    var A, i;
    document.addEventListener("selectionchange", () => {
      const l = document.getSelection();
      if (l.rangeCount === 0) {
        this.#i.forEach(g);
        return;
      }
      const s = /* @__PURE__ */ new Set();
      for (let m = 0; m < l.rangeCount; m++) {
        const e = l.getRangeAt(m);
        for (const a of this.#i.keys())
          !s.has(a) && e.intersectsNode(a) && s.add(a);
      }
      for (const [m, e] of this.#i)
        s.has(m) ? m.classList.add("selecting") : g(e, m);
      if (A ??= getComputedStyle(this.#i.values().next().value).getPropertyValue("-moz-user-select") === "none", A)
        return;
      const d = l.getRangeAt(0), c = i && (d.compareBoundaryPoints(Range.END_TO_END, i) === 0 || d.compareBoundaryPoints(Range.START_TO_END, i) === 0);
      let G = c ? d.startContainer : d.endContainer;
      if (G.nodeType === Node.TEXT_NODE && (G = G.parentNode), !c && d.endOffset === 0)
        do {
          for (; !G.previousSibling; )
            G = G.parentNode;
          G = G.previousSibling;
        } while (!G.childNodes.length);
      const b = G.parentElement?.closest(".textLayer"), o = this.#i.get(b);
      o && (o.style.width = b.style.width, o.style.height = b.style.height, G.parentElement.insertBefore(o, c ? G : G.nextSibling)), i = d.cloneRange();
    }, {
      signal: I
    });
  }
}
class Is {
  constructor({
    pdfPage: I,
    annotationStorage: g = null,
    linkService: C,
    xfaHtml: A = null
  }) {
    this.pdfPage = I, this.annotationStorage = g, this.linkService = C, this.xfaHtml = A, this.div = null, this._cancelled = !1;
  }
  async render({
    viewport: I,
    intent: g = "display"
  }) {
    if (g === "print") {
      const i = {
        viewport: I.clone({
          dontFlip: !0
        }),
        div: this.div,
        xfaHtml: this.xfaHtml,
        annotationStorage: this.annotationStorage,
        linkService: this.linkService,
        intent: g
      };
      return this.div = document.createElement("div"), i.div = this.div, _C.render(i);
    }
    const C = await this.pdfPage.getXfa();
    if (this._cancelled || !C)
      return {
        textDivs: []
      };
    const A = {
      viewport: I.clone({
        dontFlip: !0
      }),
      div: this.div,
      xfaHtml: C,
      annotationStorage: this.annotationStorage,
      linkService: this.linkService,
      intent: g
    };
    return this.div ? _C.update(A) : (this.div = document.createElement("div"), A.div = this.div, _C.render(A));
  }
  cancel() {
    this._cancelled = !0;
  }
  hide() {
    this.div && (this.div.hidden = !0);
  }
}
const cG = {
  annotationEditorUIManager: null,
  annotationStorage: null,
  downloadManager: null,
  enableScripting: !1,
  fieldObjectsPromise: null,
  findController: null,
  hasJSActionsPromise: null,
  get linkService() {
    return new kC();
  }
}, GG = /* @__PURE__ */ new Map([["canvasWrapper", 0], ["textLayer", 1], ["annotationLayer", 2], ["annotationEditorLayer", 3], ["xfaLayer", 3]]);
class gs extends ql {
  #I = LI.ENABLE_FORMS;
  #g = null;
  #A = null;
  #C = !0;
  #i = !1;
  #l = !1;
  #s = null;
  #d = !1;
  #c = null;
  #Z = null;
  #o = 1;
  #b = 1;
  #m = JI.ENABLE;
  #t = 1;
  #a = {
    directDrawing: !0,
    initialOptionalContent: !0,
    regularAnnotations: !0
  };
  #G = [null, null, null, null];
  constructor(I) {
    super(I);
    const g = I.container, C = I.defaultViewport;
    this.renderingId = "page" + this.id, this.#s = I.layerProperties || cG, this.pdfPage = null, this.pageLabel = null, this.rotation = 0, this.scale = I.scale || jl, this.viewport = C, this.pdfPageRotate = C.rotation, this._optionalContentConfigPromise = I.optionalContentConfigPromise || null, this.#m = I.textLayerMode ?? JI.ENABLE, this.#I = I.annotationMode ?? LI.ENABLE_FORMS, this.imageResourcesPath = I.imageResourcesPath || "", this.enableDetailCanvas = I.enableDetailCanvas ?? !0, this.maxCanvasPixels = I.maxCanvasPixels ?? Qg.get("maxCanvasPixels"), this.maxCanvasDim = I.maxCanvasDim || Qg.get("maxCanvasDim"), this.capCanvasAreaFactor = I.capCanvasAreaFactor ?? Qg.get("capCanvasAreaFactor"), this.#C = I.enableAutoLinking !== !1, this.#A = I.commentManager || null, this.l10n = I.l10n, this.l10n ||= new xI(), this._isStandalone = !this.renderingQueue?.hasViewer(), this._container = g, this._annotationCanvasMap = null, this.annotationLayer = null, this.annotationEditorLayer = null, this.textLayer = null, this.xfaLayer = null, this.structTreeLayer = null, this.drawLayer = null, this.detailView = null;
    const A = document.createElement("div");
    if (A.className = "page", A.setAttribute("data-page-number", this.id), A.setAttribute("role", "region"), A.setAttribute("data-l10n-id", "pdfjs-page-landmark"), A.setAttribute("data-l10n-args", JSON.stringify({
      page: this.id
    })), this.div = A, this.#B(), g?.append(A), this._isStandalone) {
      g?.style.setProperty("--scale-factor", this.scale * TI.PDF_TO_CSS_UNITS), this.pageColors?.background && g?.style.setProperty("--page-bg-color", this.pageColors.background);
      const {
        optionalContentConfigPromise: i
      } = I;
      i && i.then((l) => {
        i === this._optionalContentConfigPromise && (this.#a.initialOptionalContent = l.hasInitialVisibility);
      }), I.l10n || this.l10n.translate(this.div);
    }
  }
  #e(I, g) {
    const C = GG.get(g), A = this.#G[C];
    if (this.#G[C] = I, A) {
      A.replaceWith(I);
      return;
    }
    for (let i = C - 1; i >= 0; i--) {
      const l = this.#G[i];
      if (l) {
        l.after(I);
        return;
      }
    }
    this.div.prepend(I);
  }
  #B() {
    const {
      div: I,
      viewport: g
    } = this;
    if (g.userUnit !== this.#t && (g.userUnit !== 1 ? I.style.setProperty("--user-unit", g.userUnit) : I.style.removeProperty("--user-unit"), this.#t = g.userUnit), this.pdfPage) {
      if (this.#Z === g.rotation)
        return;
      this.#Z = g.rotation;
    }
    Tl(I, g, !0, !1);
  }
  setPdfPage(I) {
    this._isStandalone && (this.pageColors?.foreground === "CanvasText" || this.pageColors?.background === "Canvas") && (this._container?.style.setProperty("--hcm-highlight-filter", I.filterFactory.addHighlightHCMFilter("highlight", "CanvasText", "Canvas", "HighlightText", "Highlight")), this._container?.style.setProperty("--hcm-highlight-selected-filter", I.filterFactory.addHighlightHCMFilter("highlight_selected", "CanvasText", "Canvas", "HighlightText", "Highlight"))), this.pdfPage = I, this.pdfPageRotate = I.rotate;
    const g = (this.rotation + this.pdfPageRotate) % 360;
    this.viewport = I.getViewport({
      scale: this.scale * TI.PDF_TO_CSS_UNITS,
      rotation: g
    }), this.#B(), this.reset();
  }
  destroy() {
    this.reset(), this.pdfPage?.cleanup();
  }
  hasEditableAnnotations() {
    return !!this.annotationLayer?.hasEditableAnnotations();
  }
  get _textHighlighter() {
    return HC(this, "_textHighlighter", new ZG({
      pageIndex: this.id - 1,
      eventBus: this.eventBus,
      findController: this.#s.findController
    }));
  }
  #W(I, g) {
    this.eventBus.dispatch(I, {
      source: this,
      pageNumber: this.id,
      error: g
    });
  }
  async #h() {
    let I = null;
    try {
      await this.annotationLayer.render({
        viewport: this.viewport,
        intent: "display",
        structTreeLayer: this.structTreeLayer
      });
    } catch (g) {
      console.error("#renderAnnotationLayer:", g), I = g;
    } finally {
      this.#W("annotationlayerrendered", I);
    }
  }
  async #N() {
    let I = null;
    try {
      await this.annotationEditorLayer.render({
        viewport: this.viewport,
        intent: "display"
      });
    } catch (g) {
      console.error("#renderAnnotationEditorLayer:", g), I = g;
    } finally {
      this.#W("annotationeditorlayerrendered", I);
    }
  }
  async #w() {
    try {
      await this.drawLayer.render({
        intent: "display"
      });
    } catch (I) {
      console.error("#renderDrawLayer:", I);
    }
  }
  async #n() {
    let I = null;
    try {
      const g = await this.xfaLayer.render({
        viewport: this.viewport,
        intent: "display"
      });
      g?.textDivs && this._textHighlighter && this.#u(g.textDivs);
    } catch (g) {
      console.error("#renderXfaLayer:", g), I = g;
    } finally {
      this.xfaLayer?.div && (this.l10n.pause(), this.#e(this.xfaLayer.div, "xfaLayer"), this.l10n.resume()), this.#W("xfalayerrendered", I);
    }
  }
  async #R() {
    if (!this.textLayer)
      return;
    let I = null;
    try {
      await this.textLayer.render({
        viewport: this.viewport
      });
    } catch (g) {
      if (g instanceof ZZ)
        return;
      console.error("#renderTextLayer:", g), I = g;
    }
    this.#W("textlayerrendered", I), this.#Y();
  }
  async #Y() {
    if (!this.textLayer)
      return;
    const I = await this.structTreeLayer?.render();
    I && (this.l10n.pause(), this.structTreeLayer?.addElementsToTextLayer(), this.canvas && I.parentNode !== this.canvas && this.canvas.append(I), this.l10n.resume()), this.structTreeLayer?.show();
  }
  async #u(I) {
    const g = await this.pdfPage.getTextContent(), C = [];
    for (const A of g.items)
      C.push(A.str);
    this._textHighlighter.setTextMapping(I, C), this._textHighlighter.enable();
  }
  async #M(I) {
    try {
      if (await I, !this.annotationLayer)
        return;
      await this.annotationLayer.injectLinkAnnotations(iG.processLinks(this));
    } catch (g) {
      console.error("#injectLinkAnnotations:", g);
    }
  }
  _resetCanvas() {
    super._resetCanvas(), this.#c = null;
  }
  reset({
    keepAnnotationLayer: I = !1,
    keepAnnotationEditorLayer: g = !1,
    keepXfaLayer: C = !1,
    keepTextLayer: A = !1,
    keepCanvasWrapper: i = !1,
    preserveDetailViewState: l = !1
  } = {}) {
    const s = this.pdfPage?._pdfBug ?? !1;
    this.cancelRendering({
      keepAnnotationLayer: I,
      keepAnnotationEditorLayer: g,
      keepXfaLayer: C,
      keepTextLayer: A
    }), this.renderingState = O.INITIAL;
    const d = this.div, c = d.childNodes, G = I && this.annotationLayer?.div || null, b = g && this.annotationEditorLayer?.div || null, o = C && this.xfaLayer?.div || null, m = A && this.textLayer?.div || null, e = i && this.#g || null;
    for (let a = c.length - 1; a >= 0; a--) {
      const h = c[a];
      switch (h) {
        case G:
        case b:
        case o:
        case m:
        case e:
          continue;
      }
      if (s && h.classList.contains("pdfBugGroupsLayer"))
        continue;
      h.remove();
      const t = this.#G.indexOf(h);
      t >= 0 && (this.#G[t] = null);
    }
    d.removeAttribute("data-loaded"), G && this.annotationLayer.hide(), b && this.annotationEditorLayer.hide(), o && this.xfaLayer.hide(), m && this.textLayer.hide(), this.structTreeLayer?.hide(), !i && this.#g && (this.#g = null, this._resetCanvas()), l || (this.detailView?.reset({
      keepCanvas: i
    }), i || (this.detailView = null));
  }
  toggleEditingMode(I) {
    this.#l = I, this.hasEditableAnnotations() && this.reset({
      keepAnnotationLayer: !0,
      keepAnnotationEditorLayer: !0,
      keepXfaLayer: !0,
      keepTextLayer: !0,
      keepCanvasWrapper: !0
    });
  }
  updateVisibleArea(I) {
    this.enableDetailCanvas && (this.#d && this.maxCanvasPixels > 0 && I ? (this.detailView ??= new sG({
      pageView: this,
      enableOptimizedPartialRendering: this.enableOptimizedPartialRendering
    }), this.detailView.update({
      visibleArea: I
    })) : this.detailView && (this.detailView.reset(), this.detailView = null));
  }
  update({
    scale: I = 0,
    rotation: g = null,
    optionalContentConfigPromise: C = null,
    drawingDelay: A = -1
  }) {
    this.scale = I || this.scale, typeof g == "number" && (this.rotation = g), C instanceof Promise && (this._optionalContentConfigPromise = C, C.then((l) => {
      C === this._optionalContentConfigPromise && (this.#a.initialOptionalContent = l.hasInitialVisibility);
    })), this.#a.directDrawing = !0;
    const i = (this.rotation + this.pdfPageRotate) % 360;
    if (this.viewport = this.viewport.clone({
      scale: this.scale * TI.PDF_TO_CSS_UNITS,
      rotation: i
    }), this.#B(), this._isStandalone && this._container?.style.setProperty("--scale-factor", this.viewport.scale), this.#y(), this.canvas) {
      const l = this.#i && this.#d, s = A >= 0 && A < 1e3;
      if (s || l) {
        s && !l && this.renderingState !== O.FINISHED && (this.cancelRendering({
          keepAnnotationLayer: !0,
          keepAnnotationEditorLayer: !0,
          keepXfaLayer: !0,
          keepTextLayer: !0,
          cancelExtraDelay: A
        }), this.renderingState = O.FINISHED, this.#a.directDrawing = !1), this.cssTransform({
          redrawAnnotationLayer: !0,
          redrawAnnotationEditorLayer: !0,
          redrawXfaLayer: !0,
          redrawTextLayer: !s,
          hideTextLayer: s
        }), s || (this.detailView?.update({
          underlyingViewUpdated: !0
        }), this.dispatchPageRendered(!0, !1));
        return;
      }
    }
    this.cssTransform({}), this.reset({
      keepAnnotationLayer: !0,
      keepAnnotationEditorLayer: !0,
      keepXfaLayer: !0,
      keepTextLayer: !0,
      keepCanvasWrapper: !0,
      preserveDetailViewState: !0
    }), this.detailView?.update({
      underlyingViewUpdated: !0
    });
  }
  #y() {
    const {
      width: I,
      height: g
    } = this.viewport, C = this.outputScale = new VC();
    if (this.maxCanvasPixels === 0) {
      const A = 1 / this.scale;
      C.sx *= A, C.sy *= A, this.#d = !0;
    } else if (this.#d = C.limitCanvas(I, g, this.maxCanvasPixels, this.maxCanvasDim, this.capCanvasAreaFactor), this.#d && this.enableDetailCanvas) {
      const A = this.enableOptimizedPartialRendering ? 4 : 2;
      C.sx /= A, C.sy /= A;
    }
  }
  cancelRendering({
    keepAnnotationLayer: I = !1,
    keepAnnotationEditorLayer: g = !1,
    keepXfaLayer: C = !1,
    keepTextLayer: A = !1,
    cancelExtraDelay: i = 0
  } = {}) {
    super.cancelRendering({
      cancelExtraDelay: i
    }), this.textLayer && (!A || !this.textLayer.div) && (this.textLayer.cancel(), this.textLayer = null), this.annotationLayer && (!I || !this.annotationLayer.div) && (this.annotationLayer.cancel(), this.annotationLayer = null, this._annotationCanvasMap = null), this.structTreeLayer && !this.textLayer && (this.structTreeLayer = null), this.annotationEditorLayer && (!g || !this.annotationEditorLayer.div) && (this.drawLayer && (this.drawLayer.cancel(), this.drawLayer = null), this.annotationEditorLayer.cancel(), this.annotationEditorLayer = null), this.xfaLayer && (!C || !this.xfaLayer.div) && (this.xfaLayer.cancel(), this.xfaLayer = null, this._textHighlighter?.disable());
  }
  cssTransform({
    redrawAnnotationLayer: I = !1,
    redrawAnnotationEditorLayer: g = !1,
    redrawXfaLayer: C = !1,
    redrawTextLayer: A = !1,
    hideTextLayer: i = !1
  }) {
    const {
      canvas: l
    } = this;
    if (!l)
      return;
    const s = this.#c;
    if (this.viewport !== s) {
      const d = (360 + this.viewport.rotation - s.rotation) % 360;
      if (d === 90 || d === 270) {
        const {
          width: c,
          height: G
        } = this.viewport, b = G / c, o = c / G;
        l.style.transform = `rotate(${d}deg) scale(${b},${o})`;
      } else
        l.style.transform = d === 0 ? "" : `rotate(${d}deg)`;
    }
    I && this.annotationLayer && this.#h(), g && this.annotationEditorLayer && (this.drawLayer && this.#w(), this.#N()), C && this.xfaLayer && this.#n(), this.textLayer && (i ? (this.textLayer.hide(), this.structTreeLayer?.hide()) : A && this.#R());
  }
  get width() {
    return this.viewport.width;
  }
  get height() {
    return this.viewport.height;
  }
  getPagePoint(I, g) {
    return this.viewport.convertToPdfPoint(I, g);
  }
  _ensureCanvasWrapper() {
    let I = this.#g;
    return I || (I = this.#g = document.createElement("div"), I.classList.add("canvasWrapper"), this.#e(I, "canvasWrapper")), I;
  }
  _getRenderingContext(I, g, C) {
    return {
      canvas: I,
      transform: g,
      viewport: this.viewport,
      annotationMode: this.#I,
      optionalContentConfigPromise: this._optionalContentConfigPromise,
      annotationCanvasMap: this._annotationCanvasMap,
      pageColors: this.pageColors,
      isEditing: this.#l,
      recordOperations: C
    };
  }
  async draw() {
    this.renderingState !== O.INITIAL && (console.error("Must be in new state before drawing"), this.reset());
    const {
      div: I,
      l10n: g,
      pdfPage: C,
      viewport: A
    } = this;
    if (!C)
      throw this.renderingState = O.FINISHED, new Error("pdfPage is not loaded");
    this.renderingState = O.RUNNING;
    const i = this._ensureCanvasWrapper();
    if (!this.textLayer && this.#m !== JI.DISABLE && !C.isPureXfa && (this._accessibilityManager ||= new xg(), this.textLayer = new yg({
      pdfPage: C,
      highlighter: this._textHighlighter,
      accessibilityManager: this._accessibilityManager,
      enablePermissions: this.#m === JI.ENABLE_PERMISSIONS,
      onAppend: (w) => {
        this.l10n.pause(), this.#e(w, "textLayer"), this.l10n.resume();
      }
    })), !this.annotationLayer && this.#I !== LI.DISABLE) {
      const {
        annotationStorage: w,
        annotationEditorUIManager: n,
        downloadManager: V,
        enableComment: N,
        enableScripting: R,
        fieldObjectsPromise: Y,
        hasJSActionsPromise: y,
        linkService: X
      } = this.#s;
      this._annotationCanvasMap ||= /* @__PURE__ */ new Map(), this.annotationLayer = new vl({
        pdfPage: C,
        annotationStorage: w,
        imageResourcesPath: this.imageResourcesPath,
        renderForms: this.#I === LI.ENABLE_FORMS,
        linkService: X,
        downloadManager: V,
        enableComment: N,
        enableScripting: R,
        hasJSActionsPromise: y,
        fieldObjectsPromise: Y,
        annotationCanvasMap: this._annotationCanvasMap,
        accessibilityManager: this._accessibilityManager,
        annotationEditorUIManager: n,
        commentManager: this.#A,
        onAppend: (K) => {
          this.#e(K, "annotationLayer");
        }
      });
    }
    const {
      width: l,
      height: s
    } = A;
    this.#c = A;
    const {
      canvas: d,
      prevCanvas: c
    } = this._createCanvas((w) => {
      i.prepend(w);
    });
    d.setAttribute("role", "presentation"), this.outputScale || this.#y();
    const {
      outputScale: G
    } = this;
    this.#i = this.#d;
    const b = yi(G.sx), o = yi(G.sy), m = d.width = eC(tC(l * G.sx), b[0]), e = d.height = eC(tC(s * G.sy), o[0]), a = eC(tC(l), b[1]), h = eC(tC(s), o[1]);
    G.sx = m / a, G.sy = e / h, this.#o !== b[1] && (I.style.setProperty("--scale-round-x", `${b[1]}px`), this.#o = b[1]), this.#b !== o[1] && (I.style.setProperty("--scale-round-y", `${o[1]}px`), this.#b = o[1]);
    const t = this.enableOptimizedPartialRendering && this.#i && !this.recordedBBoxes, W = G.scaled ? [G.sx, 0, 0, G.sy, 0, 0] : null, B = this._drawCanvas(this._getRenderingContext(d, W, t), () => {
      c?.remove(), this._resetCanvas();
    }, (w) => {
      this.#a.regularAnnotations = !w.separateAnnots, this.dispatchPageRendered(!1, !1);
    }).then(async () => {
      if (this.renderingState !== O.FINISHED)
        return;
      this.structTreeLayer ||= new $l(C, A.rawDims);
      const w = this.#R();
      this.annotationLayer && (await this.#h(), this.#C && this.annotationLayer && this.textLayer && await this.#M(w));
      const {
        annotationEditorUIManager: n
      } = this.#s;
      n && (this.drawLayer ||= new lG({
        pageIndex: this.id
      }), await this.#w(), this.drawLayer.setParent(i), (this.annotationLayer || this.#I === LI.DISABLE) && (this.annotationEditorLayer ||= new gG({
        uiManager: n,
        pdfPage: C,
        l10n: g,
        structTreeLayer: this.structTreeLayer,
        accessibilityManager: this._accessibilityManager,
        annotationLayer: this.annotationLayer?.annotationLayer,
        textLayer: this.textLayer,
        drawLayer: this.drawLayer.getDrawLayer(),
        onAppend: (V) => {
          this.#e(V, "annotationEditorLayer");
        }
      }), this.#N()));
    });
    if (C.isPureXfa) {
      if (!this.xfaLayer) {
        const {
          annotationStorage: w,
          linkService: n
        } = this.#s;
        this.xfaLayer = new Is({
          pdfPage: C,
          annotationStorage: w,
          linkService: n
        });
      }
      this.#n();
    }
    return I.setAttribute("data-loaded", !0), this.dispatchPageRender(), B;
  }
  setPageLabel(I) {
    this.pageLabel = typeof I == "string" ? I : null, this.div.setAttribute("data-l10n-args", JSON.stringify({
      page: this.pageLabel ?? this.id
    })), this.pageLabel !== null ? this.div.setAttribute("data-page-label", this.pageLabel) : this.div.removeAttribute("data-page-label");
  }
  get thumbnailCanvas() {
    const {
      directDrawing: I,
      initialOptionalContent: g,
      regularAnnotations: C
    } = this.#a;
    return I && g && C ? this.canvas : null;
  }
}
async function bG(Z) {
  const {
    info: C,
    metadata: A,
    contentDispositionFilename: i,
    contentLength: l
  } = await Z.getMetadata();
  return {
    ...C,
    baseURL: "",
    filesize: l || (await Z.getDownloadInfo()).length,
    filename: i || aZ(""),
    metadata: A?.getRaw(),
    authors: A?.get("dc:creator"),
    numPages: Z.numPages,
    URL: ""
  };
}
class oG {
  constructor(I) {
    this._ready = new Promise((g, C) => {
      import(
        /*webpackIgnore: true*/
        /*@vite-ignore*/
        I
      ).then((i) => {
        g(i.QuickJSSandbox());
      }).catch(C);
    });
  }
  async createSandbox(I) {
    (await this._ready).create(I);
  }
  async dispatchEventInSandbox(I) {
    const g = await this._ready;
    setTimeout(() => g.dispatchEvent(I), 0);
  }
  async destroySandbox() {
    (await this._ready).nukeSandbox();
  }
}
class mG {
  #I = null;
  #g = null;
  #A = null;
  #C = null;
  #i = null;
  #l = null;
  #s = null;
  #d = null;
  #c = !1;
  #Z = null;
  #o = null;
  constructor({
    eventBus: I,
    externalServices: g = null,
    docProperties: C = null
  }) {
    this.#i = I, this.#l = g, this.#A = C;
  }
  setViewer(I) {
    this.#d = I;
  }
  async setDocument(I) {
    if (this.#s && await this.#G(), this.#s = I, !I)
      return;
    const [g, C, A] = await Promise.all([I.getFieldObjects(), I.getCalculationOrderIds(), I.getJSActions()]);
    if (!g && !A) {
      await this.#G();
      return;
    }
    if (I !== this.#s)
      return;
    try {
      this.#Z = this.#a();
    } catch (s) {
      console.error("setDocument:", s), await this.#G();
      return;
    }
    const i = this.#i;
    this.#C = new AbortController();
    const {
      signal: l
    } = this.#C;
    i._on("updatefromsandbox", (s) => {
      s?.source === window && this.#b(s.detail);
    }, {
      signal: l
    }), i._on("dispatcheventinsandbox", (s) => {
      this.#Z?.dispatchEventInSandbox(s.detail);
    }, {
      signal: l
    }), i._on("pagechanging", ({
      pageNumber: s,
      previous: d
    }) => {
      s !== d && (this.#t(d), this.#m(s));
    }, {
      signal: l
    }), i._on("pagerendered", ({
      pageNumber: s
    }) => {
      this._pageOpenPending.has(s) && s === this.#d.currentPageNumber && this.#m(s);
    }, {
      signal: l
    }), i._on("pagesdestroy", async () => {
      await this.#t(this.#d.currentPageNumber), await this.#Z?.dispatchEventInSandbox({
        id: "doc",
        name: "WillClose"
      }), this.#I?.resolve();
    }, {
      signal: l
    });
    try {
      const s = await this.#A(I);
      if (I !== this.#s)
        return;
      await this.#Z.createSandbox({
        objects: g,
        calculationOrder: C,
        appInfo: {
          platform: navigator.platform,
          language: navigator.language
        },
        docInfo: {
          ...s,
          actions: A
        }
      }), i.dispatch("sandboxcreated", {
        source: this
      });
    } catch (s) {
      console.error("setDocument:", s), await this.#G();
      return;
    }
    await this.#Z?.dispatchEventInSandbox({
      id: "doc",
      name: "Open"
    }), await this.#m(this.#d.currentPageNumber, !0), Promise.resolve().then(() => {
      I === this.#s && (this.#c = !0);
    });
  }
  async dispatchWillSave() {
    return this.#Z?.dispatchEventInSandbox({
      id: "doc",
      name: "WillSave"
    });
  }
  async dispatchDidSave() {
    return this.#Z?.dispatchEventInSandbox({
      id: "doc",
      name: "DidSave"
    });
  }
  async dispatchWillPrint() {
    if (this.#Z) {
      await this.#o?.promise, this.#o = Promise.withResolvers();
      try {
        await this.#Z.dispatchEventInSandbox({
          id: "doc",
          name: "WillPrint"
        });
      } catch (I) {
        throw this.#o.resolve(), this.#o = null, I;
      }
      await this.#o.promise;
    }
  }
  async dispatchDidPrint() {
    return this.#Z?.dispatchEventInSandbox({
      id: "doc",
      name: "DidPrint"
    });
  }
  get destroyPromise() {
    return this.#g?.promise || null;
  }
  get ready() {
    return this.#c;
  }
  get _pageOpenPending() {
    return HC(this, "_pageOpenPending", /* @__PURE__ */ new Set());
  }
  get _visitedPages() {
    return HC(this, "_visitedPages", /* @__PURE__ */ new Map());
  }
  async #b(I) {
    const g = this.#d, C = g.isInPresentationMode || g.isChangingPresentationMode, {
      id: A,
      siblings: i,
      command: l,
      value: s
    } = I;
    if (!A) {
      switch (l) {
        case "clear":
          console.clear();
          break;
        case "error":
          console.error(s);
          break;
        case "layout":
          if (!C) {
            const c = DZ(s);
            g.spreadMode = c.spreadMode;
          }
          break;
        case "page-num":
          g.currentPageNumber = s + 1;
          break;
        case "print":
          await g.pagesPromise, this.#i.dispatch("print", {
            source: this
          });
          break;
        case "println":
          console.log(s);
          break;
        case "zoom":
          C || (g.currentScaleValue = s);
          break;
        case "SaveAs":
          this.#i.dispatch("download", {
            source: this
          });
          break;
        case "FirstPage":
          g.currentPageNumber = 1;
          break;
        case "LastPage":
          g.currentPageNumber = g.pagesCount;
          break;
        case "NextPage":
          g.nextPage();
          break;
        case "PrevPage":
          g.previousPage();
          break;
        case "ZoomViewIn":
          C || g.increaseScale();
          break;
        case "ZoomViewOut":
          C || g.decreaseScale();
          break;
        case "WillPrintFinished":
          this.#o?.resolve(), this.#o = null;
          break;
      }
      return;
    }
    if (C && I.focus)
      return;
    delete I.id, delete I.siblings;
    const d = i ? [A, ...i] : [A];
    for (const c of d) {
      const G = document.querySelector(`[data-element-id="${c}"]`);
      G ? G.dispatchEvent(new CustomEvent("updatefromsandbox", {
        detail: I
      })) : this.#s?.annotationStorage.setValue(c, I);
    }
  }
  async #m(I, g = !1) {
    const C = this.#s, A = this._visitedPages;
    if (g && (this.#I = Promise.withResolvers()), !this.#I)
      return;
    const i = this.#d.getPageView(I - 1);
    if (i?.renderingState !== O.FINISHED) {
      this._pageOpenPending.add(I);
      return;
    }
    this._pageOpenPending.delete(I);
    const l = (async () => {
      const s = await (A.has(I) ? null : i.pdfPage?.getJSActions());
      C === this.#s && await this.#Z?.dispatchEventInSandbox({
        id: "page",
        name: "PageOpen",
        pageNumber: I,
        actions: s
      });
    })();
    A.set(I, l);
  }
  async #t(I) {
    const g = this.#s, C = this._visitedPages;
    if (!this.#I || this._pageOpenPending.has(I))
      return;
    const A = C.get(I);
    A && (C.set(I, null), await A, g === this.#s && await this.#Z?.dispatchEventInSandbox({
      id: "page",
      name: "PageClose",
      pageNumber: I
    }));
  }
  #a() {
    if (this.#g = Promise.withResolvers(), this.#Z)
      throw new Error("#initScripting: Scripting already exists.");
    return this.#l.createScripting();
  }
  async #G() {
    if (!this.#Z) {
      this.#s = null, this.#g?.resolve();
      return;
    }
    this.#I && (await Promise.race([this.#I.promise, new Promise((I) => {
      setTimeout(I, 1e3);
    })]).catch(() => {
    }), this.#I = null), this.#s = null;
    try {
      await this.#Z.destroySandbox();
    } catch {
    }
    this.#o?.reject(new Error("Scripting destroyed.")), this.#o = null, this.#C?.abort(), this.#C = null, this._pageOpenPending.clear(), this._visitedPages.clear(), this.#Z = null, this.#c = !1, this.#g?.resolve();
  }
}
class aG extends mG {
  constructor(I) {
    I.externalServices || window.addEventListener("updatefromsandbox", (g) => {
      I.eventBus.dispatch("updatefromsandbox", {
        source: window,
        detail: g.detail
      });
    }), I.externalServices ||= {
      createScripting: () => new oG(I.sandboxBundleSrc)
    }, I.docProperties ||= (g) => bG(g), super(I);
  }
}
const eG = 3e4;
class tG {
  constructor() {
    this.pdfViewer = null, this.pdfThumbnailViewer = null, this.onIdle = null, this.highestPriorityPage = null, this.idleTimeout = null, this.printing = !1, this.isThumbnailViewEnabled = !1, Object.defineProperty(this, "hasViewer", {
      value: () => !!this.pdfViewer
    });
  }
  setViewer(I) {
    this.pdfViewer = I;
  }
  setThumbnailViewer(I) {
    this.pdfThumbnailViewer = I;
  }
  isHighestPriority(I) {
    return this.highestPriorityPage === I.renderingId;
  }
  renderHighestPriority(I) {
    this.idleTimeout && (clearTimeout(this.idleTimeout), this.idleTimeout = null), !this.pdfViewer.forceRendering(I) && (this.isThumbnailViewEnabled && this.pdfThumbnailViewer?.forceRendering() || this.printing || this.onIdle && (this.idleTimeout = setTimeout(this.onIdle.bind(this), eG)));
  }
  getHighestPriority(I, g, C, A = !1, i = !1) {
    const l = I.views, s = l.length;
    if (s === 0)
      return null;
    for (let o = 0; o < s; o++) {
      const m = l[o].view;
      if (!this.isViewFinished(m))
        return m;
    }
    if (!i)
      for (let o = 0; o < s; o++) {
        const {
          detailView: m
        } = l[o].view;
        if (m && !this.isViewFinished(m))
          return m;
      }
    const d = I.first.id, c = I.last.id;
    if (c - d + 1 > s) {
      const o = I.ids;
      for (let m = 1, e = c - d; m < e; m++) {
        const a = C ? d + m : c - m;
        if (o.has(a))
          continue;
        const h = g[a - 1];
        if (!this.isViewFinished(h))
          return h;
      }
    }
    let G = C ? c : d - 2, b = g[G];
    return b && !this.isViewFinished(b) || A && (G += C ? 1 : -1, b = g[G], b && !this.isViewFinished(b)) ? b : null;
  }
  isViewFinished(I) {
    return I.renderingState === O.FINISHED;
  }
  renderView(I) {
    switch (I.renderingState) {
      case O.FINISHED:
        return !1;
      case O.PAUSED:
        this.highestPriorityPage = I.renderingId, I.resume();
        break;
      case O.RUNNING:
        this.highestPriorityPage = I.renderingId;
        break;
      case O.INITIAL:
        this.highestPriorityPage = I.renderingId, I.draw().finally(() => {
          this.renderHighestPriority();
        }).catch((g) => {
          g instanceof wA || console.error("renderView:", g);
        });
        break;
    }
    return !0;
  }
}
const $i = 10, WC = {
  FORCE_SCROLL_MODE_PAGE: 1e4,
  FORCE_LAZY_PAGE_INIT: 5e3,
  PAUSE_EAGER_PAGE_INIT: 250
};
function Il(Z) {
  return Object.values(WI).includes(Z) && Z !== WI.DISABLE;
}
class hG {
  #I = /* @__PURE__ */ new Set();
  #g = 0;
  constructor(I) {
    this.#g = I;
  }
  push(I) {
    const g = this.#I;
    g.has(I) && g.delete(I), g.add(I), g.size > this.#g && this.#A();
  }
  resize(I, g = null) {
    this.#g = I;
    const C = this.#I;
    if (g) {
      const A = C.size;
      let i = 1;
      for (const l of C)
        if (g.has(l.id) && (C.delete(l), C.add(l)), ++i > A)
          break;
    }
    for (; C.size > this.#g; )
      this.#A();
  }
  has(I) {
    return this.#I.has(I);
  }
  [Symbol.iterator]() {
    return this.#I.keys();
  }
  #A() {
    const I = this.#I.keys().next().value;
    I?.destroy(), this.#I.delete(I);
  }
}
class Cs {
  #I = null;
  #g = null;
  #A = null;
  #C = WI.NONE;
  #i = null;
  #l = LI.ENABLE_FORMS;
  #s = null;
  #d = null;
  #c = null;
  #Z = !1;
  #o = !1;
  #b = !1;
  #m = !1;
  #t = !1;
  #a = !0;
  #G = null;
  #e = 0;
  #B = null;
  #W = !0;
  #h = null;
  #N = null;
  #w = null;
  #n = !1;
  #R = null;
  #Y = !1;
  #u = 0;
  #M = new ResizeObserver(this.#q.bind(this));
  #y = null;
  #X = null;
  #p = null;
  #K = !0;
  #S = JI.ENABLE;
  #F = null;
  constructor(I) {
    const g = "5.4.296";
    if (Yi !== g)
      throw new Error(`The API version "${Yi}" does not match the Viewer version "${g}".`);
    if (this.container = I.container, this.viewer = I.viewer || I.container.firstElementChild, this.#F = I.viewerAlert || null, this.container?.tagName !== "DIV" || this.viewer?.tagName !== "DIV")
      throw new Error("Invalid `container` and/or `viewer` option.");
    if (this.container.offsetParent && getComputedStyle(this.container).position !== "absolute")
      throw new Error("The `container` must be absolutely positioned.");
    this.#M.observe(this.container), this.eventBus = I.eventBus, this.linkService = I.linkService || new kC(), this.downloadManager = I.downloadManager || null, this.findController = I.findController || null, this.#g = I.altTextManager || null, this.#s = I.commentManager || null, this.#p = I.signatureManager || null, this.#c = I.editorUndoBar || null, this.findController && (this.findController.onIsPageVisible = (A) => this._getVisiblePages().ids.has(A)), this._scriptingManager = I.scriptingManager || null, this.#S = I.textLayerMode ?? JI.ENABLE, this.#l = I.annotationMode ?? LI.ENABLE_FORMS, this.#C = I.annotationEditorMode ?? WI.NONE, this.#A = I.annotationEditorHighlightColors || null, this.#o = I.enableHighlightFloatingButton === !0, this.#m = I.enableUpdatedAddImage === !0, this.#t = I.enableNewAltTextWhenAddingImage === !0, this.imageResourcesPath = I.imageResourcesPath || "", this.enablePrintAutoRotate = I.enablePrintAutoRotate || !1, this.removePageBorders = I.removePageBorders || !1, this.maxCanvasPixels = I.maxCanvasPixels, this.maxCanvasDim = I.maxCanvasDim, this.capCanvasAreaFactor = I.capCanvasAreaFactor, this.enableDetailCanvas = I.enableDetailCanvas ?? !0, this.enableOptimizedPartialRendering = I.enableOptimizedPartialRendering ?? !1, this.l10n = I.l10n, this.l10n ||= new xI(), this.#b = I.enablePermissions || !1, this.pageColors = I.pageColors || null, this.#B = I.mlManager || null, this.#Z = I.enableHWA || !1, this.#K = I.supportsPinchToZoom !== !1, this.#a = I.enableAutoLinking !== !1, this.#e = I.minDurationToUpdateCanvas ?? 500, this.defaultRenderingQueue = !I.renderingQueue, this.defaultRenderingQueue ? (this.renderingQueue = new tG(), this.renderingQueue.setViewer(this)) : this.renderingQueue = I.renderingQueue;
    const {
      abortSignal: C
    } = I;
    C?.addEventListener("abort", () => {
      this.#M.disconnect(), this.#M = null;
    }, {
      once: !0
    }), this.scroll = NZ(this.container, this._scrollUpdate.bind(this), C), this.presentationModeState = ug.UNKNOWN, this._resetView(), this.removePageBorders && this.viewer.classList.add("removePageBorders"), this.#f(), this.eventBus._on("thumbnailrendered", ({
      pageNumber: A,
      pdfPage: i
    }) => {
      const l = this._pages[A - 1];
      this.#I.has(l) || i?.cleanup();
    }), I.l10n || this.l10n.translate(this.container);
  }
  get printingAllowed() {
    return this.#W;
  }
  get pagesCount() {
    return this._pages.length;
  }
  getPageView(I) {
    return this._pages[I];
  }
  getCachedPageViews() {
    return new Set(this.#I);
  }
  get pageViewsReady() {
    return this._pages.every((I) => I?.pdfPage);
  }
  get renderForms() {
    return this.#l === LI.ENABLE_FORMS;
  }
  get enableScripting() {
    return !!this._scriptingManager;
  }
  get currentPageNumber() {
    return this._currentPageNumber;
  }
  set currentPageNumber(I) {
    if (!Number.isInteger(I))
      throw new Error("Invalid page number.");
    this.pdfDocument && (this._setCurrentPageNumber(I, !0) || console.error(`currentPageNumber: "${I}" is not a valid page.`));
  }
  _setCurrentPageNumber(I, g = !1) {
    if (this._currentPageNumber === I)
      return g && this.#v(), !0;
    if (!(0 < I && I <= this.pagesCount))
      return !1;
    const C = this._currentPageNumber;
    return this._currentPageNumber = I, this.eventBus.dispatch("pagechanging", {
      source: this,
      pageNumber: I,
      pageLabel: this._pageLabels?.[I - 1] ?? null,
      previous: C
    }), g && this.#v(), !0;
  }
  get currentPageLabel() {
    return this._pageLabels?.[this._currentPageNumber - 1] ?? null;
  }
  set currentPageLabel(I) {
    if (!this.pdfDocument)
      return;
    let g = I | 0;
    if (this._pageLabels) {
      const C = this._pageLabels.indexOf(I);
      C >= 0 && (g = C + 1);
    }
    this._setCurrentPageNumber(g, !0) || console.error(`currentPageLabel: "${I}" is not a valid page.`);
  }
  get currentScale() {
    return this._currentScale !== qC ? this._currentScale : jl;
  }
  set currentScale(I) {
    if (isNaN(I))
      throw new Error("Invalid numeric scale.");
    this.pdfDocument && this.#k(I, {
      noScroll: !1
    });
  }
  get currentScaleValue() {
    return this._currentScaleValue;
  }
  set currentScaleValue(I) {
    this.pdfDocument && this.#k(I, {
      noScroll: !1
    });
  }
  get pagesRotation() {
    return this._pagesRotation;
  }
  set pagesRotation(I) {
    if (!xl(I))
      throw new Error("Invalid pages rotation angle.");
    if (!this.pdfDocument || (I %= 360, I < 0 && (I += 360), this._pagesRotation === I))
      return;
    this._pagesRotation = I;
    const g = this._currentPageNumber;
    this.refresh(!0, {
      rotation: I
    }), this._currentScaleValue && this.#k(this._currentScaleValue, {
      noScroll: !0
    }), this.eventBus.dispatch("rotationchanging", {
      source: this,
      pagesRotation: I,
      pageNumber: g
    }), this.defaultRenderingQueue && this.update();
  }
  get firstPagePromise() {
    return this.pdfDocument ? this._firstPageCapability.promise : null;
  }
  get onePageRendered() {
    return this.pdfDocument ? this._onePageRenderedCapability.promise : null;
  }
  get pagesPromise() {
    return this.pdfDocument ? this._pagesCapability.promise : null;
  }
  get _layerProperties() {
    const I = this;
    return HC(this, "_layerProperties", {
      get annotationEditorUIManager() {
        return I.#i;
      },
      get annotationStorage() {
        return I.pdfDocument?.annotationStorage;
      },
      get downloadManager() {
        return I.downloadManager;
      },
      get enableComment() {
        return !!I.#s;
      },
      get enableScripting() {
        return !!I._scriptingManager;
      },
      get fieldObjectsPromise() {
        return I.pdfDocument?.getFieldObjects();
      },
      get findController() {
        return I.findController;
      },
      get hasJSActionsPromise() {
        return I.pdfDocument?.hasJSActions();
      },
      get linkService() {
        return I.linkService;
      }
    });
  }
  #z(I) {
    const g = {
      annotationEditorMode: this.#C,
      annotationMode: this.#l,
      textLayerMode: this.#S
    };
    return I ? (this.#W = I.includes(eg.PRINT_HIGH_QUALITY) || I.includes(eg.PRINT), this.eventBus.dispatch("printingallowed", {
      source: this,
      isAllowed: this.#W
    }), !I.includes(eg.COPY) && this.#S === JI.ENABLE && (g.textLayerMode = JI.ENABLE_PERMISSIONS), I.includes(eg.MODIFY_CONTENTS) || (g.annotationEditorMode = WI.DISABLE), !I.includes(eg.MODIFY_ANNOTATIONS) && !I.includes(eg.FILL_INTERACTIVE_FORMS) && this.#l === LI.ENABLE_FORMS && (g.annotationMode = LI.ENABLE), g) : (this.#W = !0, this.eventBus.dispatch("printingallowed", {
      source: this,
      isAllowed: this.#W
    }), g);
  }
  async #x(I) {
    if (document.visibilityState === "hidden" || !this.container.offsetParent || this._getVisiblePages().views.length === 0)
      return;
    const g = Promise.withResolvers(), C = new AbortController();
    document.addEventListener("visibilitychange", () => {
      document.visibilityState === "hidden" && g.resolve();
    }, {
      signal: AbortSignal.any([I, C.signal])
    }), await Promise.race([this._onePageRenderedCapability.promise, g.promise]), C.abort();
  }
  async getAllText() {
    const I = [], g = [];
    for (let C = 1, A = this.pdfDocument.numPages; C <= A; ++C) {
      if (this.#Y)
        return null;
      g.length = 0;
      const i = await this.pdfDocument.getPage(C), {
        items: l
      } = await i.getTextContent();
      for (const s of l)
        s.str && g.push(s.str), s.hasEOL && g.push(`
`);
      I.push(jg(g.join("")));
    }
    return I.join(`
`);
  }
  #H(I, g) {
    const C = document.getSelection(), {
      focusNode: A,
      anchorNode: i
    } = C;
    if (i && A && C.containsNode(this.#R)) {
      if (this.#n || I === JI.ENABLE_PERMISSIONS) {
        nA(g);
        return;
      }
      this.#n = !0;
      const {
        classList: l
      } = this.viewer;
      l.add("copyAll");
      const s = new AbortController();
      window.addEventListener("keydown", (d) => this.#Y = d.key === "Escape", {
        signal: s.signal
      }), this.getAllText().then(async (d) => {
        d !== null && await navigator.clipboard.writeText(d);
      }).catch((d) => {
        console.warn(`Something goes wrong when extracting the text: ${d.message}`);
      }).finally(() => {
        this.#n = !1, this.#Y = !1, s.abort(), l.remove("copyAll");
      }), nA(g);
    }
  }
  setDocument(I) {
    if (this.pdfDocument && (this.eventBus.dispatch("pagesdestroy", {
      source: this
    }), this._cancelRendering(), this._resetView(), this.findController?.setDocument(null), this._scriptingManager?.setDocument(null), this.#i?.destroy(), this.#i = null, this.#C = WI.NONE, this.#W = !0), this.pdfDocument = I, !I)
      return;
    const g = I.numPages, C = I.getPage(1), A = I.getOptionalContentConfig({
      intent: "display"
    }), i = this.#b ? I.getPermissions() : Promise.resolve(), {
      eventBus: l,
      pageColors: s,
      viewer: d
    } = this;
    this.#G = new AbortController();
    const {
      signal: c
    } = this.#G;
    if (g > WC.FORCE_SCROLL_MODE_PAGE) {
      console.warn("Forcing PAGE-scrolling for performance reasons, given the length of the document.");
      const o = this._scrollMode = x.PAGE;
      l.dispatch("scrollmodechanged", {
        source: this,
        mode: o
      });
    }
    this._pagesCapability.promise.then(() => {
      l.dispatch("pagesloaded", {
        source: this,
        pagesCount: g
      });
    }, () => {
    });
    const G = (o) => {
      const m = this._pages[o.pageNumber - 1];
      m && this.#I.push(m);
    };
    l._on("pagerender", G, {
      signal: c
    });
    const b = (o) => {
      o.cssTransform || o.isDetailView || (this._onePageRenderedCapability.resolve({
        timestamp: o.timestamp
      }), l._off("pagerendered", b));
    };
    l._on("pagerendered", b, {
      signal: c
    }), Promise.all([C, i]).then(([o, m]) => {
      if (I !== this.pdfDocument)
        return;
      this._firstPageCapability.resolve(o), this._optionalContentConfigPromise = A;
      const {
        annotationEditorMode: e,
        annotationMode: a,
        textLayerMode: h
      } = this.#z(m);
      if (h !== JI.DISABLE) {
        const w = this.#R = document.createElement("div");
        w.id = "hiddenCopyElement", d.before(w);
      }
      if (e !== WI.DISABLE) {
        const w = e;
        I.isPureXfa ? console.warn("Warning: XFA-editing is not implemented.") : Il(w) ? (this.#i = new GZ(this.container, d, this.#F, this.#g, this.#s, this.#p, l, I, s, this.#A, this.#o, this.#m, this.#t, this.#B, this.#c, this.#K), l.dispatch("annotationeditoruimanager", {
          source: this,
          uiManager: this.#i
        }), w !== WI.NONE && (this.#_(w), this.#i.updateMode(w))) : console.error(`Invalid AnnotationEditor mode: ${w}`);
      }
      const t = this._scrollMode === x.PAGE ? null : d, W = this.currentScale, B = o.getViewport({
        scale: W * TI.PDF_TO_CSS_UNITS
      });
      d.style.setProperty("--scale-factor", B.scale), s?.background && d.style.setProperty("--page-bg-color", s.background), (s?.foreground === "CanvasText" || s?.background === "Canvas") && (d.style.setProperty("--hcm-highlight-filter", I.filterFactory.addHighlightHCMFilter("highlight", "CanvasText", "Canvas", "HighlightText", "Highlight")), d.style.setProperty("--hcm-highlight-selected-filter", I.filterFactory.addHighlightHCMFilter("highlight_selected", "CanvasText", "Canvas", "HighlightText", "ButtonText")));
      for (let w = 1; w <= g; ++w) {
        const n = new gs({
          container: t,
          eventBus: l,
          id: w,
          scale: W,
          defaultViewport: B.clone(),
          optionalContentConfigPromise: A,
          renderingQueue: this.renderingQueue,
          textLayerMode: h,
          annotationMode: a,
          imageResourcesPath: this.imageResourcesPath,
          maxCanvasPixels: this.maxCanvasPixels,
          maxCanvasDim: this.maxCanvasDim,
          capCanvasAreaFactor: this.capCanvasAreaFactor,
          enableDetailCanvas: this.enableDetailCanvas,
          enableOptimizedPartialRendering: this.enableOptimizedPartialRendering,
          pageColors: s,
          l10n: this.l10n,
          layerProperties: this._layerProperties,
          enableHWA: this.#Z,
          enableAutoLinking: this.#a,
          minDurationToUpdateCanvas: this.#e,
          commentManager: this.#s
        });
        this._pages.push(n);
      }
      this._pages[0]?.setPdfPage(o), this._scrollMode === x.PAGE ? this.#V() : this._spreadMode !== oI.NONE && this._updateSpreadMode(), l._on("annotationeditorlayerrendered", (w) => {
        this.#i && l.dispatch("annotationeditormodechanged", {
          source: this,
          mode: this.#C
        });
      }, {
        once: !0,
        signal: c
      }), this.#x(c).then(async () => {
        if (I !== this.pdfDocument)
          return;
        if (this.findController?.setDocument(I), this._scriptingManager?.setDocument(I), this.#R && document.addEventListener("copy", this.#H.bind(this, h), {
          signal: c
        }), I.loadingParams.disableAutoFetch || g > WC.FORCE_LAZY_PAGE_INIT) {
          this._pagesCapability.resolve();
          return;
        }
        let w = g - 1;
        if (w <= 0) {
          this._pagesCapability.resolve();
          return;
        }
        for (let n = 2; n <= g; ++n) {
          const V = I.getPage(n).then((N) => {
            const R = this._pages[n - 1];
            R.pdfPage || R.setPdfPage(N), --w === 0 && this._pagesCapability.resolve();
          }, (N) => {
            console.error(`Unable to get page ${n} to initialize viewer`, N), --w === 0 && this._pagesCapability.resolve();
          });
          n % WC.PAUSE_EAGER_PAGE_INIT === 0 && await V;
        }
      }), l.dispatch("pagesinit", {
        source: this
      }), I.getMetadata().then(({
        info: w
      }) => {
        I === this.pdfDocument && w.Language && (d.lang = w.Language);
      }), this.defaultRenderingQueue && this.update();
    }).catch((o) => {
      console.error("Unable to initialize viewer", o), this._pagesCapability.reject(o);
    });
  }
  setPageLabels(I) {
    if (this.pdfDocument) {
      I ? Array.isArray(I) && this.pdfDocument.numPages === I.length ? this._pageLabels = I : (this._pageLabels = null, console.error("setPageLabels: Invalid page labels.")) : this._pageLabels = null;
      for (let g = 0, C = this._pages.length; g < C; g++)
        this._pages[g].setPageLabel(this._pageLabels?.[g] ?? null);
    }
  }
  _resetView() {
    this._pages = [], this._currentPageNumber = 1, this._currentScale = qC, this._currentScaleValue = null, this._pageLabels = null, this.#I = new hG($i), this._location = null, this._pagesRotation = 0, this._optionalContentConfigPromise = null, this._firstPageCapability = Promise.withResolvers(), this._onePageRenderedCapability = Promise.withResolvers(), this._pagesCapability = Promise.withResolvers(), this._scrollMode = x.VERTICAL, this._previousScrollMode = x.UNKNOWN, this._spreadMode = oI.NONE, this.#y = {
      previousPageNumber: 1,
      scrollDown: !0,
      pages: []
    }, this.#G?.abort(), this.#G = null, this.viewer.textContent = "", this._updateScrollMode(), this.viewer.removeAttribute("lang"), this.#R?.remove(), this.#R = null, this.#T(), this.#E();
  }
  #V() {
    if (this._scrollMode !== x.PAGE)
      throw new Error("#ensurePageViewVisible: Invalid scrollMode value.");
    const I = this._currentPageNumber, g = this.#y, C = this.viewer;
    if (C.textContent = "", g.pages.length = 0, this._spreadMode === oI.NONE && !this.isInPresentationMode) {
      const A = this._pages[I - 1];
      C.append(A.div), g.pages.push(A);
    } else {
      const A = /* @__PURE__ */ new Set(), i = this._spreadMode - 1;
      i === -1 ? A.add(I - 1) : I % 2 !== i ? (A.add(I - 1), A.add(I)) : (A.add(I - 2), A.add(I - 1));
      const l = document.createElement("div");
      if (l.className = "spread", this.isInPresentationMode) {
        const s = document.createElement("div");
        s.className = "dummyPage", l.append(s);
      }
      for (const s of A) {
        const d = this._pages[s];
        d && (l.append(d.div), g.pages.push(d));
      }
      C.append(l);
    }
    g.scrollDown = I >= g.previousPageNumber, g.previousPageNumber = I;
  }
  _scrollUpdate() {
    this.pagesCount !== 0 && (this.#h && clearTimeout(this.#h), this.#h = setTimeout(() => {
      this.#h = null, this.update();
    }, 100), this.update());
  }
  #D(I, g = null) {
    const {
      div: C,
      id: A
    } = I;
    if (this._currentPageNumber !== A && this._setCurrentPageNumber(A), this._scrollMode === x.PAGE && (this.#V(), this.update()), !g && !this.isInPresentationMode) {
      const i = C.offsetLeft + C.clientLeft, l = i + C.clientWidth, {
        scrollLeft: s,
        clientWidth: d
      } = this.container;
      (this._scrollMode === x.HORIZONTAL || i < s || l > s + d) && (g = {
        left: 0,
        top: 0
      });
    }
    Ql(C, g), !this._currentScaleValue && this._location && (this._location = null);
  }
  #r(I) {
    return I === this._currentScale || Math.abs(I - this._currentScale) < 1e-15;
  }
  #j(I, g, {
    noScroll: C = !1,
    preset: A = !1,
    drawingDelay: i = -1,
    origin: l = null
  }) {
    if (this._currentScaleValue = g.toString(), this.#r(I)) {
      A && this.eventBus.dispatch("scalechanging", {
        source: this,
        scale: I,
        presetValue: g
      });
      return;
    }
    this.viewer.style.setProperty("--scale-factor", I * TI.PDF_TO_CSS_UNITS);
    const s = i >= 0 && i < 1e3;
    this.refresh(!0, {
      scale: I,
      drawingDelay: s ? i : -1
    }), s && (this.#X = setTimeout(() => {
      this.#X = null, this.refresh();
    }, i));
    const d = this._currentScale;
    if (this._currentScale = I, !C) {
      let c = this._currentPageNumber, G;
      if (this._location && !(this.isInPresentationMode || this.isChangingPresentationMode) && (c = this._location.pageNumber, G = [null, {
        name: "XYZ"
      }, this._location.left, this._location.top, null]), this.scrollPageIntoView({
        pageNumber: c,
        destArray: G,
        allowNegativeOffset: !0
      }), Array.isArray(l)) {
        const b = I / d - 1, [o, m] = this.containerTopLeft;
        this.container.scrollLeft += (l[0] - m) * b, this.container.scrollTop += (l[1] - o) * b;
      }
    }
    this.eventBus.dispatch("scalechanging", {
      source: this,
      scale: I,
      presetValue: A ? g : void 0
    }), this.defaultRenderingQueue && this.update();
  }
  get #P() {
    return this._spreadMode !== oI.NONE && this._scrollMode !== x.HORIZONTAL ? 2 : 1;
  }
  #k(I, g) {
    let C = parseFloat(I);
    if (C > 0)
      g.preset = !1, this.#j(C, I, g);
    else {
      const A = this._pages[this._currentPageNumber - 1];
      if (!A)
        return;
      let i = Ni, l = ui;
      this.isInPresentationMode ? (i = l = 4, this._spreadMode !== oI.NONE && (i *= 2)) : this.removePageBorders ? i = l = 0 : this._scrollMode === x.HORIZONTAL && ([i, l] = [l, i]);
      const s = (this.container.clientWidth - i) / A.width * A.scale / this.#P, d = (this.container.clientHeight - l) / A.height * A.scale;
      switch (I) {
        case "page-actual":
          C = 1;
          break;
        case "page-width":
          C = s;
          break;
        case "page-height":
          C = d;
          break;
        case "page-fit":
          C = Math.min(s, d);
          break;
        case "auto":
          const c = Xi(A) ? s : Math.min(d, s);
          C = Math.min(VZ, c);
          break;
        default:
          console.error(`#setScale: "${I}" is an unknown zoom value.`);
          return;
      }
      g.preset = !0, this.#j(C, I, g);
    }
  }
  #v() {
    const I = this._pages[this._currentPageNumber - 1];
    this.isInPresentationMode && this.#k(this._currentScaleValue, {
      noScroll: !0
    }), this.#D(I);
  }
  pageLabelToPageNumber(I) {
    if (!this._pageLabels)
      return null;
    const g = this._pageLabels.indexOf(I);
    return g < 0 ? null : g + 1;
  }
  scrollPageIntoView({
    pageNumber: I,
    destArray: g = null,
    allowNegativeOffset: C = !1,
    ignoreDestinationZoom: A = !1,
    center: i = null
  }) {
    if (!this.pdfDocument)
      return;
    const l = Number.isInteger(I) && this._pages[I - 1];
    if (!l) {
      console.error(`scrollPageIntoView: "${I}" is not a valid pageNumber parameter.`);
      return;
    }
    if (this.isInPresentationMode || !g) {
      this._setCurrentPageNumber(I, !0);
      return;
    }
    let s = 0, d = 0, c = 0, G = 0, b, o;
    const m = l.rotation % 180 !== 0, e = (m ? l.height : l.width) / l.scale / TI.PDF_TO_CSS_UNITS, a = (m ? l.width : l.height) / l.scale / TI.PDF_TO_CSS_UNITS;
    let h = 0;
    switch (g[1].name) {
      case "XYZ":
        s = g[2], d = g[3], h = g[4], s = s !== null ? s : 0, d = d !== null ? d : a;
        break;
      case "Fit":
      case "FitB":
        h = "page-fit";
        break;
      case "FitH":
      case "FitBH":
        d = g[2], h = "page-width", d === null && this._location ? (s = this._location.left, d = this._location.top) : (typeof d != "number" || d < 0) && (d = a);
        break;
      case "FitV":
      case "FitBV":
        s = g[2], c = e, G = a, h = "page-height";
        break;
      case "FitR":
        s = g[2], d = g[3], c = g[4] - s, G = g[5] - d;
        let w = Ni, n = ui;
        this.removePageBorders && (w = n = 0), b = (this.container.clientWidth - w) / c / TI.PDF_TO_CSS_UNITS, o = (this.container.clientHeight - n) / G / TI.PDF_TO_CSS_UNITS, h = Math.min(Math.abs(b), Math.abs(o));
        break;
      default:
        console.error(`scrollPageIntoView: "${g[1].name}" is not a valid destination type.`);
        return;
    }
    if (A || (h && h !== this._currentScale ? this.currentScaleValue = h : this._currentScale === qC && (this.currentScaleValue = wZ)), h === "page-fit" && !g[4]) {
      this.#D(l);
      return;
    }
    const t = [l.viewport.convertToViewportPoint(s, d), l.viewport.convertToViewportPoint(s + c, d + G)];
    let W = Math.min(t[0][0], t[1][0]), B = Math.min(t[0][1], t[1][1]);
    i ? ((i === "both" || i === "vertical") && (B -= (this.container.clientHeight - Math.abs(t[1][1] - t[0][1])) / 2), (i === "both" || i === "horizontal") && (W -= (this.container.clientWidth - Math.abs(t[1][0] - t[0][0])) / 2)) : C || (W = Math.max(W, 0), B = Math.max(B, 0)), this.#D(l, {
      left: W,
      top: B
    });
  }
  _updateLocation(I) {
    const g = this._currentScale, C = this._currentScaleValue, A = parseFloat(C) === g ? Math.round(g * 1e4) / 100 : C, i = I.id, l = this._pages[i - 1], s = this.container, d = l.getPagePoint(s.scrollLeft - I.x, s.scrollTop - I.y), c = Math.round(d[0]), G = Math.round(d[1]);
    let b = `#page=${i}`;
    this.isInPresentationMode || (b += `&zoom=${A},${c},${G}`), this._location = {
      pageNumber: i,
      scale: A,
      top: G,
      left: c,
      rotation: this._pagesRotation,
      pdfOpenParams: b
    };
  }
  update() {
    const I = this._getVisiblePages(), g = I.views, C = g.length;
    if (C === 0)
      return;
    const A = Math.max($i, 2 * C + 1);
    this.#I.resize(A, I.ids);
    for (const {
      view: d,
      visibleArea: c
    } of g)
      d.updateVisibleArea(c);
    for (const d of this.#I)
      I.ids.has(d.id) || d.updateVisibleArea(null);
    this.renderingQueue.renderHighestPriority(I);
    const i = this._spreadMode === oI.NONE && (this._scrollMode === x.PAGE || this._scrollMode === x.VERTICAL), l = this._currentPageNumber;
    let s = !1;
    for (const d of g) {
      if (d.percent < 100)
        break;
      if (d.id === l && i) {
        s = !0;
        break;
      }
    }
    this._setCurrentPageNumber(s ? l : g[0].id), this._updateLocation(I.first), this.eventBus.dispatch("updateviewarea", {
      source: this,
      location: this._location
    });
  }
  #Q() {
    const I = this._getVisiblePages(), g = [], {
      ids: C,
      views: A
    } = I;
    for (const i of A) {
      const {
        view: l
      } = i;
      if (!l.hasEditableAnnotations()) {
        C.delete(l.id);
        continue;
      }
      g.push(i);
    }
    return g.length === 0 ? null : (this.renderingQueue.renderHighestPriority({
      first: g[0],
      last: g.at(-1),
      views: g,
      ids: C
    }), C);
  }
  containsElement(I) {
    return this.container.contains(I);
  }
  focus() {
    this.container.focus();
  }
  get _isContainerRtl() {
    return getComputedStyle(this.container).direction === "rtl";
  }
  get isInPresentationMode() {
    return this.presentationModeState === ug.FULLSCREEN;
  }
  get isChangingPresentationMode() {
    return this.presentationModeState === ug.CHANGING;
  }
  get isHorizontalScrollbarEnabled() {
    return this.isInPresentationMode ? !1 : this.container.scrollWidth > this.container.clientWidth;
  }
  get isVerticalScrollbarEnabled() {
    return this.isInPresentationMode ? !1 : this.container.scrollHeight > this.container.clientHeight;
  }
  _getVisiblePages() {
    const I = this._scrollMode === x.PAGE ? this.#y.pages : this._pages, g = this._scrollMode === x.HORIZONTAL, C = g && this._isContainerRtl;
    return RZ({
      scrollEl: this.container,
      views: I,
      sortByVisibility: !0,
      horizontal: g,
      rtl: C
    });
  }
  cleanup() {
    for (const I of this._pages)
      I.renderingState !== O.FINISHED && I.reset();
  }
  _cancelRendering() {
    for (const I of this._pages)
      I.cancelRendering();
  }
  async #J(I) {
    if (I.pdfPage)
      return I.pdfPage;
    try {
      const g = await this.pdfDocument.getPage(I.id);
      return I.pdfPage || I.setPdfPage(g), g;
    } catch (g) {
      return console.error("Unable to get page for page view", g), null;
    }
  }
  #O(I) {
    if (I.first?.id === 1)
      return !0;
    if (I.last?.id === this.pagesCount)
      return !1;
    switch (this._scrollMode) {
      case x.PAGE:
        return this.#y.scrollDown;
      case x.HORIZONTAL:
        return this.scroll.right;
    }
    return this.scroll.down;
  }
  forceRendering(I) {
    const g = I || this._getVisiblePages(), C = this.#O(g), A = this._spreadMode !== oI.NONE && this._scrollMode !== x.HORIZONTAL, i = this.#X !== null || this.#h !== null && g.views.some((s) => s.detailView?.renderingCancelled), l = this.renderingQueue.getHighestPriority(g, this._pages, C, A, i);
    return l ? (this.#J(l).then(() => {
      this.renderingQueue.renderView(l);
    }), !0) : !1;
  }
  get hasEqualPageSizes() {
    const I = this._pages[0];
    for (let g = 1, C = this._pages.length; g < C; ++g) {
      const A = this._pages[g];
      if (A.width !== I.width || A.height !== I.height)
        return !1;
    }
    return !0;
  }
  getPagesOverview() {
    let I;
    return this._pages.map((g) => {
      const C = g.pdfPage.getViewport({
        scale: 1
      }), A = Xi(C);
      if (I === void 0)
        I = A;
      else if (this.enablePrintAutoRotate && A !== I)
        return {
          width: C.height,
          height: C.width,
          rotation: (C.rotation - 90) % 360
        };
      return {
        width: C.width,
        height: C.height,
        rotation: C.rotation
      };
    });
  }
  get optionalContentConfigPromise() {
    return this.pdfDocument ? this._optionalContentConfigPromise ? this._optionalContentConfigPromise : (console.error("optionalContentConfigPromise: Not initialized yet."), this.pdfDocument.getOptionalContentConfig({
      intent: "display"
    })) : Promise.resolve(null);
  }
  set optionalContentConfigPromise(I) {
    if (!(I instanceof Promise))
      throw new Error(`Invalid optionalContentConfigPromise: ${I}`);
    this.pdfDocument && this._optionalContentConfigPromise && (this._optionalContentConfigPromise = I, this.refresh(!1, {
      optionalContentConfigPromise: I
    }), this.eventBus.dispatch("optionalcontentconfigchanged", {
      source: this,
      promise: I
    }));
  }
  get scrollMode() {
    return this._scrollMode;
  }
  set scrollMode(I) {
    if (this._scrollMode !== I) {
      if (!yZ(I))
        throw new Error(`Invalid scroll mode: ${I}`);
      this.pagesCount > WC.FORCE_SCROLL_MODE_PAGE || (this._previousScrollMode = this._scrollMode, this._scrollMode = I, this.eventBus.dispatch("scrollmodechanged", {
        source: this,
        mode: I
      }), this._updateScrollMode(this._currentPageNumber));
    }
  }
  _updateScrollMode(I = null) {
    const g = this._scrollMode, C = this.viewer;
    C.classList.toggle("scrollHorizontal", g === x.HORIZONTAL), C.classList.toggle("scrollWrapped", g === x.WRAPPED), !(!this.pdfDocument || !I) && (g === x.PAGE ? this.#V() : this._previousScrollMode === x.PAGE && this._updateSpreadMode(), this._currentScaleValue && isNaN(this._currentScaleValue) && this.#k(this._currentScaleValue, {
      noScroll: !0
    }), this._setCurrentPageNumber(I, !0), this.update());
  }
  get spreadMode() {
    return this._spreadMode;
  }
  set spreadMode(I) {
    if (this._spreadMode !== I) {
      if (!XZ(I))
        throw new Error(`Invalid spread mode: ${I}`);
      this._spreadMode = I, this.eventBus.dispatch("spreadmodechanged", {
        source: this,
        mode: I
      }), this._updateSpreadMode(this._currentPageNumber);
    }
  }
  _updateSpreadMode(I = null) {
    if (!this.pdfDocument)
      return;
    const g = this.viewer, C = this._pages;
    if (this._scrollMode === x.PAGE)
      this.#V();
    else if (g.textContent = "", this._spreadMode === oI.NONE)
      for (const A of this._pages)
        g.append(A.div);
    else {
      const A = this._spreadMode - 1;
      let i = null;
      for (let l = 0, s = C.length; l < s; ++l)
        i === null ? (i = document.createElement("div"), i.className = "spread", g.append(i)) : l % 2 === A && (i = i.cloneNode(!1), g.append(i)), i.append(C[l].div);
    }
    I && (this._currentScaleValue && isNaN(this._currentScaleValue) && this.#k(this._currentScaleValue, {
      noScroll: !0
    }), this._setCurrentPageNumber(I, !0), this.update());
  }
  _getPageAdvance(I, g = !1) {
    switch (this._scrollMode) {
      case x.WRAPPED: {
        const {
          views: C
        } = this._getVisiblePages(), A = /* @__PURE__ */ new Map();
        for (const {
          id: i,
          y: l,
          percent: s,
          widthPercent: d
        } of C) {
          if (s === 0 || d < 100)
            continue;
          let c = A.get(l);
          c || A.set(l, c ||= []), c.push(i);
        }
        for (const i of A.values()) {
          const l = i.indexOf(I);
          if (l === -1)
            continue;
          const s = i.length;
          if (s === 1)
            break;
          if (g)
            for (let d = l - 1, c = 0; d >= c; d--) {
              const G = i[d], b = i[d + 1] - 1;
              if (G < b)
                return I - b;
            }
          else
            for (let d = l + 1, c = s; d < c; d++) {
              const G = i[d], b = i[d - 1] + 1;
              if (G > b)
                return b - I;
            }
          if (g) {
            const d = i[0];
            if (d < I)
              return I - d + 1;
          } else {
            const d = i[s - 1];
            if (d > I)
              return d - I + 1;
          }
          break;
        }
        break;
      }
      case x.HORIZONTAL:
        break;
      case x.PAGE:
      case x.VERTICAL: {
        if (this._spreadMode === oI.NONE)
          break;
        const C = this._spreadMode - 1;
        if (g && I % 2 !== C)
          break;
        if (!g && I % 2 === C)
          break;
        const {
          views: A
        } = this._getVisiblePages(), i = g ? I - 1 : I + 1;
        for (const {
          id: l,
          percent: s,
          widthPercent: d
        } of A)
          if (l === i) {
            if (s > 0 && d === 100)
              return 2;
            break;
          }
        break;
      }
    }
    return 1;
  }
  nextPage() {
    const I = this._currentPageNumber, g = this.pagesCount;
    if (I >= g)
      return !1;
    const C = this._getPageAdvance(I, !1) || 1;
    return this.currentPageNumber = Math.min(I + C, g), !0;
  }
  previousPage() {
    const I = this._currentPageNumber;
    if (I <= 1)
      return !1;
    const g = this._getPageAdvance(I, !0) || 1;
    return this.currentPageNumber = Math.max(I - g, 1), !0;
  }
  updateScale({
    drawingDelay: I,
    scaleFactor: g = null,
    steps: C = null,
    origin: A
  }) {
    if (C === null && g === null)
      throw new Error("Invalid updateScale options: either `steps` or `scaleFactor` must be provided.");
    if (!this.pdfDocument)
      return;
    let i = this._currentScale;
    if (g > 0 && g !== 1)
      i = Math.round(i * g * 100) / 100;
    else if (C) {
      const l = C > 0 ? Vi : 1 / Vi, s = C > 0 ? Math.ceil : Math.floor;
      C = Math.abs(C);
      do
        i = s((i * l).toFixed(2) * 10) / 10;
      while (--C > 0);
    }
    i = jA(i, nZ, YZ), this.#k(i, {
      noScroll: !1,
      drawingDelay: I,
      origin: A
    });
  }
  increaseScale(I = {}) {
    this.updateScale({
      ...I,
      steps: I.steps ?? 1
    });
  }
  decreaseScale(I = {}) {
    this.updateScale({
      ...I,
      steps: -(I.steps ?? 1)
    });
  }
  #f(I = this.container.clientHeight) {
    I !== this.#u && (this.#u = I, HZ.setProperty("--viewer-container-height", `${I}px`));
  }
  #q(I) {
    for (const g of I)
      if (g.target === this.container) {
        this.#f(Math.floor(g.borderBoxSize[0].blockSize)), this.#d = null;
        break;
      }
  }
  get containerTopLeft() {
    return this.#d ||= [this.container.offsetTop, this.container.offsetLeft];
  }
  #T() {
    this.#X !== null && (clearTimeout(this.#X), this.#X = null), this.#h !== null && (clearTimeout(this.#h), this.#h = null);
  }
  #E() {
    this.#N?.abort(), this.#N = null, this.#w !== null && (clearTimeout(this.#w), this.#w = null);
  }
  #_(I) {
    switch (I) {
      case WI.STAMP:
        this.#B?.loadModel("altText");
        break;
      case WI.SIGNATURE:
        this.#p?.loadSignatures();
        break;
    }
  }
  get annotationEditorMode() {
    return this.#i ? this.#C : WI.DISABLE;
  }
  set annotationEditorMode({
    mode: I,
    editId: g = null,
    isFromKeyboard: C = !1,
    mustEnterInEditMode: A = !1,
    editComment: i = !1
  }) {
    if (!this.#i)
      throw new Error("The AnnotationEditor is not enabled.");
    if (this.#C === I)
      return;
    if (!Il(I))
      throw new Error(`Invalid AnnotationEditor mode: ${I}`);
    if (!this.pdfDocument)
      return;
    this.#_(I);
    const {
      eventBus: l,
      pdfDocument: s
    } = this, d = async () => {
      this.#E(), this.#C = I, await this.#i.updateMode(I, g, C, A, i), !(I !== this.#C || s !== this.pdfDocument) && l.dispatch("annotationeditormodechanged", {
        source: this,
        mode: I
      });
    };
    if (I === WI.NONE || this.#C === WI.NONE) {
      const c = I !== WI.NONE;
      c || this.pdfDocument.annotationStorage.resetModifiedIds(), this.cleanup();
      for (const b of this._pages)
        b.toggleEditingMode(c);
      const G = this.#Q();
      if (c && G) {
        this.#E(), this.#N = new AbortController();
        const b = AbortSignal.any([this.#G.signal, this.#N.signal]);
        l._on("pagerendered", ({
          pageNumber: o
        }) => {
          G.delete(o), G.size === 0 && (this.#w = setTimeout(d, 0));
        }, {
          signal: b
        });
        return;
      }
    }
    d();
  }
  refresh(I = !1, g = /* @__PURE__ */ Object.create(null)) {
    if (this.pdfDocument) {
      for (const C of this._pages)
        C.update(g);
      this.#T(), I || this.update();
    }
  }
}
class BG extends Cs {
  _resetView() {
    super._resetView(), this._scrollMode = x.PAGE, this._spreadMode = oI.NONE;
  }
  set scrollMode(I) {
  }
  _updateScrollMode() {
  }
  set spreadMode(I) {
  }
  _updateSpreadMode() {
  }
}
globalThis.pdfjsViewer = {
  AnnotationLayerBuilder: vl,
  DownloadManager: $Z,
  EventBus: El,
  FindState: fI,
  GenericL10n: xI,
  LinkTarget: Ag,
  parseQueryString: LC,
  PDFFindController: _Z,
  PDFHistory: qc,
  PDFLinkService: Ul,
  PDFPageView: gs,
  PDFScriptingManager: aG,
  PDFSinglePageViewer: BG,
  PDFViewer: Cs,
  ProgressBar: MZ,
  RenderingStates: O,
  ScrollMode: x,
  SimpleLinkService: kC,
  SpreadMode: oI,
  StructTreeLayerBuilder: $l,
  TextLayerBuilder: yg,
  XfaLayerBuilder: Is
};
Ng.workerSrc = dZ;
class WG {
  constructor(I, g, C, A) {
    this.pdfProxy = I, this.canvasId = g, this.textLayerId = C, this.annotationLayerId = A;
  }
  async renderPage(I, g = 1, C = !1, A = !1) {
    const i = await this.pdfProxy.getPage(I), l = i.getViewport({ scale: g }), s = document.getElementById(this.canvasId), d = document.getElementById(this.textLayerId), c = document.getElementById(this.annotationLayerId), G = s.getContext("2d");
    s.width = l.width, s.height = l.height, await i.render({ canvasContext: G, viewport: l }).promise, C && d !== null && (i.getTextContent().then((b) => {
      d.style.setProperty("--total-scale-factor", `${g}`), d.style.setProperty("--scale-factor", `${g}`), d.style.setProperty("--scale-round-x", "1px"), d.style.setProperty("--scale-round-y", "1px"), new yC({
        container: d,
        textContentSource: b,
        viewport: l.clone({ dontFlip: !0 })
      }).render();
    }), A && c !== null && i.getAnnotations({ intent: "display" }).then((b) => {
      new Fl({
        div: c,
        accessibilityManager: void 0,
        annotationCanvasMap: void 0,
        annotationEditorUIManager: void 0,
        page: i,
        viewport: l,
        structTreeLayer: null
      }).render({
        div: c,
        viewport: l,
        page: i,
        annotations: b,
        imageResourcesPath: void 0,
        renderForms: !1,
        linkService: new kC(),
        downloadManager: null,
        annotationStorage: void 0,
        enableScripting: !1,
        hasJSActions: void 0,
        fieldObjects: void 0
      });
    }));
  }
}
async function Zb(Z, I, g = null, C = null) {
  const A = await fetch(I), i = new Uint8Array(await A.arrayBuffer()), s = await ul({ data: i }).promise;
  return new WG(s, Z, g, C);
}
export {
  WG as PdfHandle,
  Zb as loadPdf
};
